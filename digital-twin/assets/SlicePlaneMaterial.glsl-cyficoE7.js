import{bo as D,q0 as ye,Az as Ye,AA as Ze,bF as J,AJ as Te,AI as $e,Bi as ze,Br as Je,AL as Ke,AM as Qe,_ as et,AO as tt,AT as st,n9 as rt,Bu as at,mZ as it,A_ as nt,B6 as ot,Ci as ct,bp as T,B9 as lt,bs as Oe,j8 as dt,qp as Ve,qq as ut,nf as je,as as gt,j_ as ht,bj as R,bT as d,gM as ft,rw as we,r3 as We,Cj as oe,qu as pt,eh as Ae,a$ as f,xN as bt,k as mt,Ck as _t,vq as se,aV as K,aW as b,t$ as ge,qy as G,bZ as ke,kE as B,aU as M,bi as He,b8 as Tt,bg as w,aZ as V,qw as $t,z5 as Ot,aX as S,Cl as ce,Cm as wt,Cn as At,eS as Ct,u1 as De,aY as I,e0 as It,bu as H,e as he,P as fe,T as E,bn as P,bw as N,t_ as _,eq as Et,ep as Be,b$ as vt,c0 as Ce,k1 as X,ay as Q,w8 as Ie,pr as Ee,bY as ie,hQ as ve,rx as Pe,Co as Me,u3 as Re,z3 as Pt}from"./index--YEV5yv0.js";import{j as Mt,g as Rt,u as Se,v as St,C as z,e as Lt,i as Le,b as Ut,d as Ue,s as Nt,k as xt,q as yt,n as Ge,x as le,U as Vt,S as jt,l as Wt,a as kt,c as Ht}from"./sliceToolConfig-ChXitlil.js";import{O as Dt,e as pe,b as Bt,a as m,j as Fe}from"./ShadedColorMaterial.glsl-fk9J7Ej-.js";import{I as Gt}from"./ImageMaterial.glsl-Ukg7CdoW.js";import{d as Ft,r as qt}from"./LineVisualElement-C8deki4c.js";import{a as Xt}from"./Object3DVisualElement-BrpWXajY.js";import{f as Yt}from"./DefaultLayouts-DcGiycyZ.js";import{e as Zt}from"./TriangleMaterial-BbZw-82k.js";import{A as Y}from"./ColorMaterial.glsl-D6k9r1NW.js";const zt=D(0,0,0,.04);function Jt({accentColor:e}){return ye(e,.5)}function Kt({accentColor:e}){return ye(e,.7)}function qe(e){const t=new Ye,{vertex:n,fragment:a,attributes:r,varyings:i}=t;return Ze(n,e),r.add(J.POSITION,"vec3"),r.add(J.UV0,"vec2"),i.add("vUV","vec2"),n.main.add(Te`vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);`),a.uniforms.add(new $e("backgroundColor",s=>s.backgroundColor),new $e("gridColor",s=>s.gridColor),new ze("gridWidth",s=>s.gridWidth)).main.add(Te`const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;`),t}const Qt=Object.freeze(Object.defineProperty({__proto__:null,build:qe},Symbol.toStringTag,{value:"Module"}));class es extends Je{constructor(){super(...arguments),this.backgroundColor=D(1,0,0,.5),this.gridColor=D(0,1,0,.5),this.gridWidth=4}}let ts=class extends Ke{constructor(t,n){super(t,n,new Qe(Qt,()=>et(()=>Promise.resolve().then(()=>bs),void 0)))}initializePipeline(){return tt({blending:at,depthTest:{func:rt.LESS},colorWrite:st})}},ss=class extends Zt{constructor(t){super(t,as),this.produces=new Map([[it.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,n=>nt(n)]])}get visible(){return!0}createGLMaterial(t){return new rs(t)}createBufferWriter(){return new ot(Yt)}getConfiguration(){return ct}};class rs extends lt{constructor(t){super(t)}beginSlot(t){return this.getTechnique(ts,t)}}class as extends es{constructor(){super(...arguments),this.renderOccluded=T.Occlude,this.isDecoration=!1}}class is extends Xt{constructor(t){super(t),this._material=null,this._renderOccluded=T.OccludeAndTransparent,this._gridWidth=1,this._gridColor=D(1,0,0,1),this._backgroundColor=D(1,0,0,1),this.applyProperties(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(t){this._gridWidth!==t&&(this._gridWidth=t,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(t){Oe(this._gridColor,t),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){Oe(this._backgroundColor,t),this._updateMaterial()}createExternalResources(){this._material=new ss(this._materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(t){this._material!=null&&t(this._material)}createGeometries(t){if(this._material!=null){const n=dt(this._material);t.addGeometry(n)}}get _materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this._material!=null&&this._material.setParameters(this._materialParameters)}}function Ps(e,t,n,a,r,i,s,o){return ns(t,s.worldUpAtPosition(e,d.get()),r,i,o.basis1,o.basis2),f(o.basis1,o.basis1,n),f(o.basis2,o.basis2,a),M(o.origin,e),We(o.basis2,o.basis1,o.origin,o.plane),o}function ns(e,t,n,a,r,i){const s=V(e,t),o=d.get(),u=d.get();switch(a===v.HORIZONTAL_OR_VERTICAL?Math.abs(s)>Lt?v.HORIZONTAL:v.VERTICAL:a){case v.VERTICAL:{const c=Math.abs(s)<=Le?e:n.viewUp;I(o,c,t),M(u,t);break}case v.HORIZONTAL:I(o,n.viewUp,t),I(u,t,o);break;case v.TILTED:{const c=Math.abs(s)<=Le?t:n.viewUp;I(o,c,e),I(u,e,o);break}}const l=I(d.get(),o,u);V(l,n.viewForward)>0&&f(u,u,-1),S(r,o),S(i,u)}function os(e,t,n){const a=t.worldUpAtPosition(e.origin,d.get()),r=e.basis1,i=_e(e,a),s=Math.round(i/j)*j;return oe(e,s-i,r,n)}function Ms(e,t,n,a,r,i){const s=M(d.get(),r.origin);b(s,s,f(d.get(),r.basis1,e.direction[0]<0?1:-1)),b(s,s,f(d.get(),r.basis2,e.direction[1]<0?1:-1));const o=R(r.basis1),u=R(r.basis2),l=w(d.get(),n,s),c=w(d.get(),t,s);let g=0,h=0;if(me(e)){const re=de(r),W=de(i);g=o-.5*e.direction[0]*V(r.basis1,c)/o,h=u-.5*e.direction[1]*V(r.basis2,c)/u;const F=W/re;g*=F,h*=F}const p=g+.5*e.direction[0]*V(r.basis1,l)/o,O=h+.5*e.direction[1]*V(r.basis2,l)/u,x=f(d.get(),r.basis1,p/o),L=f(d.get(),r.basis2,O/u);(p<=0||Ne(i.origin,x,a)<=Se)&&M(x,i.basis1),(O<=0||Ne(i.origin,L,a)<=Se)&&M(L,i.basis2);const $=M(d.get(),s);return b($,$,f(d.get(),x,e.direction[0]<0?-1:1)),b($,$,f(d.get(),L,e.direction[1]<0?-1:1)),$t($,x,L,i)}function Rs(e,t){return St*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}function Ss(e,t,n,a){const r=I(d.get(),t,n);return I(r,r,t),He(e,r,a)}function Ls(e,t){return Dt(e.basis1,e.basis2,e.origin,t)}function Us(e,t,n,a){const r=t.worldUpAtPosition(e.origin,d.get()),i=d.get();switch(n){case ee.HEADING:M(i,r);break;case ee.TILT:M(i,e.basis1)}return He(e.origin,i,a)}function Ns(e,t,n,a){const r=be(n,A.NEGATIVE_X),i=G.get();Ot(i,t,r.edge*Math.PI/2);const s=S(d.get(),r.basis);let o=f(d.get(),s,r.direction*a.computeScreenPixelSizeAt(r.position)*z);b(o,o,r.position);const u=a.projectToRenderScreen(o,ce(d.get())),l=cs(a,u);wt(a,u,Z),S(Z.direction,Z.direction);const c=d.get();!l&&At(n,Z,c)&&(o=c),i[12]=0,i[13]=0,i[14]=0,e.modelTransform=i,e.renderLocation=Ct(o),l?e.state|=te:e.state&=~te}function cs(e,t){const[n,a,r,i]=e.viewport,s=Math.min(r,i)/16;let o=!0;return t[0]<n+s?(t[0]=n+s,o=!1):t[0]>n+r-s&&(t[0]=n+r-s,o=!1),t[1]<a+s?(t[1]=a+s,o=!1):t[1]>a+i-s&&(t[1]=a+i-s,o=!1),o}function xs(e,t,n,a){const r=R(a.basis1),i=R(a.basis2),s=Xe(a),o=de(a),u=K(d.get(),0,0,0);b(u,f(d.get(),a.basis1,t.direction[0]),f(d.get(),a.basis2,t.direction[1])),b(u,a.origin,u);let l=0,c=1;if(me(t))t.direction[0]===1&&t.direction[1]===-1?l=j:t.direction[0]===1&&t.direction[1]===1?l=Math.PI:t.direction[0]===-1&&t.direction[1]===1&&(l=3*Math.PI/2),c=o;else{const h=t.direction[0]!==0?1:2;l=h===1?j:0,c=(h===1?i:r)-s}const g=ge(G.get(),l);ke(g,g,K(d.get(),c,c,c)),B(g,n,g),g[12]=0,g[13]=0,g[14]=0,e.modelTransform=g,e.renderLocation=u}function ys(e,t,n,a){const r=a.worldUpAtPosition(n.origin,d.get()),i=be(n,A.POSITIVE_X),s=ge(G.get(),i.edge*Math.PI/2);De(s,s,-_e(n,r)),B(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=i.position}function Vs(e,t,n){const a=be(n,A.POSITIVE_Y),r=ge(G.get(),a.edge*Math.PI/2);De(r,r,j),B(r,t,r),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=a.position}var A;function be(e,t){switch(t){case A.POSITIVE_X:return{basis:e.basis1,direction:1,position:b(d.get(),e.origin,e.basis1),edge:t};case A.POSITIVE_Y:return{basis:e.basis2,direction:1,position:b(d.get(),e.origin,e.basis2),edge:t};case A.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:w(d.get(),e.origin,e.basis1),edge:t};case A.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:w(d.get(),e.origin,e.basis2),edge:t}}}function Ne(e,t,n){const a=n.projectToRenderScreen(b(d.get(),e,t),ce(d.get())),r=n.projectToRenderScreen(w(d.get(),e,t),ce(d.get()));return It(w(a,a,r))}function Xe(e){const t=R(e.basis1),n=R(e.basis2);return Rt*Math.min(t,n)}function de(e){return Xe(e)}function me(e){return e.direction[0]!==0&&e.direction[1]!==0}function js(e){const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]];return new Ft({view:e,attached:!1,color:Kt(e.effectiveTheme),width:Mt,renderOccluded:T.OccludeAndTransparent,geometry:[t],isDecoration:!0})}function Ws(e){return new is({view:e,attached:!1,backgroundColor:zt,gridColor:Jt(e.effectiveTheme),gridWidth:4,renderOccluded:T.OccludeAndTransparent,isDecoration:!0})}function ks(e,t,n,a=new ut){if(e==null)return null;const{renderCoordsHelper:r}=t,i=r.fromRenderCoords(e.origin,new gt({spatialReference:t.spatialReference}));if(i==null)return null;const s=ht(i,n);if(s==null)return null;a.position=s;const o=2*R(e.basis1),u=2*R(e.basis2),l=je.renderUnitScaleFactor(t.spatialReference,n);a.width=o*l,a.height=u*l;const c=r.worldUpAtPosition(e.origin,d.get());return a.tilt=ft(_e(e,c)),a.heading=r.headingAtPosition(e.origin,e.basis1)-90,a}function _e(e,t){return _t(t,e.basis2,e.basis1)+j}function ls(e,t,n,a,r,i,s=Ve()){return i.toRenderCoords(e,s.origin)?(i.worldBasisAtPosition(s.origin,we.X,s.basis1),i.worldBasisAtPosition(s.origin,we.Y,s.basis2),We(s.basis2,s.basis1,s.origin,s.plane),oe(s,-Ae(t),pt(s),s),oe(s,Ae(n),s.basis1,s),f(s.basis1,s.basis1,a/2),f(s.basis2,s.basis2,r/2),bt(s),s):(mt.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function Hs(e,t){if((e==null?void 0:e.position)==null)return null;const n=qt(e.position,t.spatialReference,t.elevationProvider);if(n==null)return null;const a=je.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference),r=e.width*a,i=e.height*a;return{position:n,heading:e.heading,tilt:e.tilt,renderWidth:r,renderHeight:i}}function Ds(e,t,n,a=Ve()){if(e==null)return null;const r=ls(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,a);return n.tiltEnabled||r==null||os(r,t.renderCoordsHelper,r),r}(function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"})(A||(A={}));const C=se.Custom1;var ee,v;(function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"})(ee||(ee={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(v||(v={}));const te=se.Custom2,Z=Tt(),j=Math.PI/2,ne=se.Custom1,ds=se.Custom2;function Bs(e){return(e.type==="building-scene-3d"?e:null)!=null}let Gs=class extends pe{constructor(t,n){const a=me(n),r=a?Ut:Ue,i=r*Nt,s=Ue,o={renderOccluded:T.OccludeAndTransparent,isDecoration:!0},u=new H({...o,width:r}),l=new H({...o,width:i}),c=new H({...o,width:s});super({view:t,...Bt,...us({isCorner:a,unfocusedMaterial:u,focusedMaterial:l,outlineMaterial:c})}),this._themeHandle=he(()=>t.effectiveTheme.accentColor,g=>{const h=E.toUnitRGBA(g);u.setParameters({color:h}),l.setParameters({color:h}),c.setParameters({color:h})},fe)}destroy(){this._themeHandle.remove(),super.destroy()}};function us({isCorner:e,unfocusedMaterial:t,focusedMaterial:n,outlineMaterial:a}){const r=e?[P(1,0,0),P(0,0,0),P(0,1,0)]:[P(1,0,0),P(-1,0,0)];return{renderObjects:[new m(N(t,r),_.Unfocused|ne),new m(N(n,r),_.Focused|ne),new m(N(a,r),ds)],collisionType:{type:"line",paths:[r]},radius:e?xt:yt,state:ne}}class qs extends pe{constructor(t,n){const a=new Gt({writeDepth:!1,renderOccluded:T.Opaque,isDecoration:!0}),r=Fe.calloutWidth,i=new H({width:r,renderOccluded:T.OccludeAndTransparent,isDecoration:!0});super({view:t,...gs({imageMaterial:a,calloutMaterial:i})}),this._currentTexture=null,this._themeHandle=he(()=>t.effectiveTheme.accentColor,s=>{const o=Et(s,.5),u=Be(s),l=this._currentTexture,c=n(o,u);a.setParameters({textureId:c.texture.id}),i.setParameters({color:E.toUnitRGBA(s)}),this._currentTexture=c,l==null||l.release()},fe)}destroy(){var t;this._themeHandle.remove(),(t=this._currentTexture)==null||t.release(),super.destroy()}}function gs({imageMaterial:e,calloutMaterial:t}){const{focusMultiplier:n,calloutLength:a,discRadius:r}=Fe,i=r*n,s=(c,g)=>{const h=[0,1,2,2,3,0];return new vt(g,[[J.POSITION,new Ce([a-c,-c,0,a+c,-c,0,a+c,c,0,a-c,c,0],h,3,!0)],[J.UV0,new Ce([0,0,1,0,1,1,0,1],h,2,!0)]])},o=N(t,[[0,0,0],[a-r,0,0]]),u=N(t,[[0,0,0],[a-i,0,0]]),l=C;return{autoScaleRenderObjects:!1,collisionPriority:1,collisionType:{type:"disc",direction:[0,0,1],offset:[a,0,0]},focusMultiplier:n,radius:r,renderObjects:[new m(s(r,e),_.Unfocused|l),new m(o,_.Unfocused|l),new m(s(i,e),_.Focused|l),new m(u,_.Focused|l)],state:l}}var ue;(function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"})(ue||(ue={}));class Xs extends pe{constructor(t,n){const a=new H({width:1,renderOccluded:T.OccludeAndTransparent,isDecoration:!0}),r=new Y({cullFace:X.Back,renderOccluded:T.Opaque,isDecoration:!0}),i=new Y({cullFace:X.Back,renderOccluded:T.Opaque,isDecoration:!0}),s=new Y({cullFace:X.Back,renderOccluded:T.Opaque,isDecoration:!0}),o=new Y({writeDepth:!1,cullFace:X.Front,renderOccluded:T.Transparent,isDecoration:!0});super({view:t,...hs({offsetMode:n,tubeMaterial:r,tipMaterial:i,capMaterial:s,outlineMaterial:o,calloutMaterial:a})}),this._themeHandle=he(()=>t.effectiveTheme.accentColor,u=>{const l=Be(u),c=E.toUnitRGBA(u),g=E.toUnitRGBA(l),h=E.toUnitRGBA(E.blendColors(l,u,.4)),p=E.toUnitRGBA(E.blendColors(l,u,.14));a.setParameters({color:c}),r.setParameters({color:p}),i.setParameters({color:g}),s.setParameters({color:h}),o.setParameters({color:c})},fe)}destroy(){this._themeHandle.remove(),super.destroy()}}function hs({offsetMode:e,tubeMaterial:t,tipMaterial:n,capMaterial:a,outlineMaterial:r,calloutMaterial:i}){const s=e===ue.CENTER_ON_CALLOUT?z:0,o=[P(s,0,-24),P(s,0,jt/2)],u=ps(o),l=xe({vertices:o,padding:0,materials:{tube:t,tip:n,cap:a}}),c=xe({vertices:o,padding:Vt,materials:{tube:r,tip:r,cap:r}}),g=N(i,[[s,0,0],[s-z,0,0]]),h=N(i,[[s,0,0],[s-z,0,0]]);return{renderObjects:[...l.normal.map(p=>new m(p,_.Unfocused|C)),...c.normal.map(p=>new m(p,_.Unfocused|C)),new m(g,_.Unfocused|C|te),...l.focused.map(p=>new m(p,_.Focused|C)),...c.focused.map(p=>new m(p,_.Focused|C)),new m(h,_.Focused|C|te)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[u]},collisionPriority:1,radius:Ge,state:C}}function xe({vertices:e,padding:t,materials:n}){const a=r=>{const i=e.slice(),s=w(d.get(),i[0],i[1]);S(s,s);const o=w(d.get(),i[i.length-1],i[i.length-2]);if(S(o,o),t>0){const k=f(Q(),o,-t);i[i.length-1]=b(k,k,i[i.length-1]);const y=f(Q(),s,-t);i[0]=b(y,y,i[0])}const u=r?Ht:1,l=le*u,c=Ge*u,g=Ie(G.get());if(t>0){const k=l/4,y=K(d.get(),0,k,0),q=1+t/k;Ee(g,g,y),ke(g,g,K(d.get(),q,q,q)),Ee(g,g,f(y,y,-1/q))}const h=Ie(ie()),p=P(0,1,0),O=ve(ie(),Pe(Me.get(),p,o));O[12]=i[i.length-1][0],O[13]=i[i.length-1][1],O[14]=i[i.length-1][2],B(O,O,g);const x=n.tube,L=fs(Wt*(r?kt:1)+t,i,x);L.transformation=h;const $=[L],re=n.tip,W=Re(re,l,c,24,!1,!1,!0);W.transformation=O,$.push(W);const F=n.cap,ae=Re(F,l,c,24,!1,!0,!1);ae.transformation=O,$.push(ae);const U=ve(ie(),Pe(Me.get(),p,s));return U[12]=i[0][0],U[13]=i[0][1],U[14]=i[0][2],B(U,U,g),$.push(W.instantiate({transformation:U})),$.push(ae.instantiate({transformation:U})),$};return{normal:a(!1),focused:a(!0)}}function fs(e,t,n){const a=[];for(let i=0;i<12;i++){const s=i/12*2*Math.PI;a.push([Math.cos(s)*e,Math.sin(s)*e])}return Pt(n,a,t,[],[],!1)}function ps(e,t){const n=w(Q(),e[e.length-1],e[e.length-2]);S(n,n),f(n,n,le),b(n,n,e[e.length-1]);{const a=w(Q(),e[0],e[1]);return S(a,a),f(a,a,le),b(a,a,e[0]),[a,...e,n]}}const bs=Object.freeze(Object.defineProperty({__proto__:null,build:qe},Symbol.toStringTag,{value:"Module"}));export{js as A,C,me as E,ue as H,Xs as I,Hs as L,v as M,ks as R,te as S,ds as U,Ds as V,ee as _,xs as a,Kt as b,Ls as c,Ss as d,Ps as e,Jt as f,qs as g,de as h,ne as i,Ws as j,Us as l,ys as m,Vs as p,Ms as r,Rs as s,zt as t,Ns as u,Gs as v,Bs as x};
