import{e as r,y as s,a as $,V as v,az as U,ie as H,Z as I,ay as O,n as _,jA as g,dx as C}from"./index-KaRZ5U2_.js";import{l as N}from"./LayerView3D-CC565s_1.js";import{y as T}from"./LayerView-L0dIwxYG.js";const u=Symbol(),D=F=>{let a=class extends F{constructor(){super(...arguments),this.layerViews=new v,this._debouncedUpdate=U(async()=>{const{layer:e,parent:t}=this,n=t==null?void 0:t.footprintLayerView;let d=[];const o=this._createQuery();if(o&&n){const{features:h}=await n.queryFeatures(o);this.suspended||(d=h.map(m=>e.acquireLayer(m)))}this.removeHandles(u),this.addHandles(d,u)})}get creatingLayerViews(){var e;return((e=this.view)==null?void 0:e.layerViewManager.isCreatingLayerViewsForLayer(this.layer))??!1}isUpdating(){return this.creatingLayerViews||this.layer.updating||this.layerViews.some(e=>e.updating)}enableLayerUpdates(){return H([this._updatingHandles.addWhen(()=>{var e,t;return((t=(e=this.parent)==null?void 0:e.footprintLayerView)==null?void 0:t.dataUpdating)===!1},()=>this.updateLayers()),this._updatingHandles.add(()=>{var e,t,n,d,o;return[this.layer.maximumVisibleSublayers,(e=this.layer.parent)==null?void 0:e.orderBy,(n=(t=this.parent)==null?void 0:t.footprintLayerView)==null?void 0:n.filter,(o=(d=this.parent)==null?void 0:d.footprintLayerView)==null?void 0:o.timeExtent,this.suspended]},()=>this.updateLayers()),I(()=>this.removeHandles(u))])}updateLayers(){this.suspended?this.removeHandles(u):this._updatingHandles.addPromise(O(this._debouncedUpdate()).catch(e=>{_.getLogger(this).error(e)}))}_createQuery(){var f,V;const e=(f=this.parent)==null?void 0:f.footprintLayerView,t=(V=this.layer)==null?void 0:V.parent;if(!e||!t||t.destroyed)return null;const{layer:{maximumVisibleSublayers:n},view:{scale:d}}=this;if(!n)return null;const{itemTypeField:o,itemSourceField:h,itemNameField:m,minScaleField:c,maxScaleField:L,objectIdField:b,orderBy:w}=t,S=g(`${c} IS NULL OR ${d} <= ${c} OR ${c} = 0`,`${L} IS NULL OR ${d} >= ${L}`),p=w==null?void 0:w.find(y=>y.field&&!y.valueExpression),i=e.createQuery();if(i.returnGeometry=!1,i.num=n,i.outFields=[b,h,m],i.where=g(i.where,S),this.unsupportedItemTypes!=null){const y=`${o} NOT IN (${this.unsupportedItemTypes.map(x=>`'${x}'`)})`;i.where=g(i.where,y)}return p!=null&&p.field&&(i.orderByFields=[`${p.field} ${p.order==="descending"?"DESC":"ASC"}`],i.outFields.push(p.field)),i}};return r([s({readOnly:!0})],a.prototype,"creatingLayerViews",null),r([s()],a.prototype,"layer",void 0),r([s()],a.prototype,"layerViews",void 0),r([s({readOnly:!0})],a.prototype,"unsupportedItemTypes",void 0),r([s()],a.prototype,"parent",void 0),r([s({readOnly:!0})],a.prototype,"isUpdating",null),a=r([$("esri.views.layers.CatalogDynamicGroupLayerView")],a),a};let l=class extends D(N(T)){constructor(){super(...arguments),this.type="catalog-dynamic-group-3d",this.layerViews=new v}initialize(){this.addHandles([this.enableLayerUpdates(),C(()=>this.view.stationary,()=>this.updateLayers())])}};r([s()],l.prototype,"layerViews",void 0),r([s()],l.prototype,"parent",void 0),r([s()],l.prototype,"view",void 0),l=r([$("esri.views.3d.layers.CatalogDynamicGroupLayerView3D")],l);const j=l;export{j as default};
