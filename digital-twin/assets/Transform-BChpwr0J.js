import{jD as j,jF as l,aP as H,bj as M,jI as y,pg as v,cK as w,g as F,ph as O,ba as z,bb as A,aV as I,ay as _,k as L,cX as b,cY as P,dh as C,hQ as G,bY as W,hd as B,hI as T,r as m,m as f,a as q}from"./index-BGUxYM9l.js";import{l as K}from"./RenderTexture-JaOrGJqM.js";function Q(e,n,t,s){const r=j(n,s);if(r==null)return!1;const o=r.source.spatialReferenceId,a=r.dest.spatialReferenceId;if(o===a&&o!==l.UNKNOWN||H(n,s))return t[0]=1,t[1]=1,t[2]=1,!0;if(o===l.SPHERICAL_ECEF){const u=M(e),d=u/Math.sqrt(e[0]*e[0]+e[1]*e[1]),i=u/y.radius;if(a===l.WEB_MERCATOR)return t[0]=d*i,t[1]=d*i,t[2]=1,!0;if(a===l.WGS84||a===l.CGCS2000){const h=v;return t[0]=h*d*i,t[1]=h*i,t[2]=1,!0}}else if(o===l.PLATE_CARREE){if(a===l.WGS84||a===l.CGCS2000)return t[0]=v,t[1]=v,t[2]=1,!0;if(a===l.WEB_MERCATOR){const u=e[1]/y.radius;return t[0]=1,t[1]=1/Math.cos(u),t[2]=1,!0}}return!1}let p=class extends w.EventedMixin(F){constructor(e){super(e),this._tmpEvent=new O,this._renderCoordsHelper=e.view.renderCoordsHelper,this._renderSR=this._renderCoordsHelper.spatialReference,this._layerElevationSource=e.layerElevationSource}initialize(){this._intersector=z(this.view.state.viewingMode),this._intersector.options.store=A.MIN,this._intersector.options.normalRequired=!1,this._tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"}get spatialReference(){var e,n;return(n=(e=this.view)==null?void 0:e.elevationProvider)==null?void 0:n.spatialReference}getElevation(e,n,t,s){const r=this._renderCoordsHelper,o=I(c,e,n,t);if(!r.toRenderCoords(o,s,o))return L.getLogger(this).error("could not project point to compute elevation"),null;const{layerElevationSource:a,_intersector:u,intersectionHandler:d}=this,i=a.fullExtent,h=i!=null&&Number.isFinite(i.xmin)&&Number.isFinite(i.xmax)&&Number.isFinite(i.ymin)&&Number.isFinite(i.ymax)&&Number.isFinite(i.zmin)&&Number.isFinite(i.zmax)?new b(i.zmin,i.zmax):a.elevationRange;if(h==null)return null;const R=a.elevationOffset,N=h.elevationRangeMin+R,$=h.elevationRangeMax+R,x=r.setAltitude(V,$,o),g=r.setAltitude(Y,N,o);return u.reset(x,g,null),d.intersect(u,null,x,g,null,!0),u.results.min.getIntersectionPoint(o)?r.getAltitude(o):null}getSphereElevationBounds(e,n){return K(e,n,S,this._renderSR),this._layerElevationSource.getElevationRange(S)}getRootElevationBounds(){const e=this.layerElevationSource.fullExtent;return e!=null&&e.hasZ?new b(e.zmin,e.zmax):null}objectsChanged(e){this.spatialReference&&(this._computeLayerExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}objectChanged(e){this.spatialReference&&(this._computeObjectExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}_computeObjectExtent(e,n){C(n),this._expandExtent(e,n)}_computeLayerExtent(e,n){C(n);for(const t of e)this._expandExtent(t,n)}_expandExtent(e,n){const t=this.spatialReference;if(t==null||e==null)return;G(E,e.quaternion),E[12]=e.center[0],E[13]=e.center[1],E[14]=e.center[2];const s=e.halfSize;for(let r=0;r<8;++r)c[0]=1&r?s[0]:-s[0],c[1]=2&r?s[1]:-s[1],c[2]=4&r?s[2]:-s[2],B(c,c,E),this._renderCoordsHelper.fromRenderCoords(c,c,t),T(n,c,n)}};m([f({constructOnly:!0})],p.prototype,"layerElevationSource",void 0),m([f({constructOnly:!0})],p.prototype,"intersectionHandler",void 0),m([f({constructOnly:!0})],p.prototype,"view",void 0),m([f()],p.prototype,"spatialReference",null),p=m([q("esri.views.3d.layers.i3s.LayerElevationProvider")],p);const E=W(),S=P(0,0,0,0),c=_(),V=_(),Y=_();class U{constructor(n,t,s,r){this.toMapSpace=n,this.transform=t,this.obb=s,this.geometry=r}}class X{constructor(n,t){this.position=n,this.rotationScale=t,this.origin=void 0}}export{X as i,Q as n,U as t,p as x};
