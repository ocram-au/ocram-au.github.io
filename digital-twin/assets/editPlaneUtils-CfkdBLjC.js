import{r as a,m as l,a as b,g as At,W as kt,h as ie,w as _t,j as rt,hT as oe,pU as ne,lW as re,i4 as se,i6 as ae,lU as le,xE as ce,eb as pe,xF as de,ar as ue,as as zt,xG as he,dn as ut,g5 as Ft,dc as ft,cU as ye,eF as ge,l8 as fe,xH as Ht,at as me,aO as ve,ay as mt,iX as we,lk as vt,aV as Lt,nJ as xe,vm as Oe,si as K,gN as E,rh as ke,aG as _e,rp as $e,e3 as be,xI as Me,xJ as Re,cK as Te,l9 as Nt,hM as Ue,l as Ie,e as Ve,xK as $t,A as Pe,C as Ce,u as pt,R as Se,a8 as tt,qp as Ee,ee as j,b6 as D,rT as bt,xL as Ge,xM as Ae,au as ze,iT as Fe,iS as Mt,aW as ht,xN as st,bn as He,o1 as Rt,bW as Tt,a$ as Ut,xr as It}from"./index--YEV5yv0.js";import{r as G,V as Le,R as Ne,a as Ze,b as je,O as De}from"./SketchTooltipInfo-Bs-fOuBn.js";import{a as We}from"./dehydratedFeatureComparison-D7wykoHT.js";import{distance as Ye,simplify as qe}from"./geometryEngine-qkw3BlfJ.js";import{g,Z as Je,b as Ke}from"./surfaceCoordinateSystems-dHJ1hYq6.js";import{h as Q,k as Qe,R as Xe,y as Zt,F as jt,Q as Be,w as ti,u as Dt}from"./automaticAreaMeasurementUtils-TNeFb30V.js";import{c as ei,m as at}from"./automaticLengthMeasurementUtils-D8SveFs_.js";import{j as ii,R as oi}from"./quantityFormatUtils-BpthlYuF.js";import{n as ni}from"./InteractiveToolBase-CBRGYbKm.js";import{t as ri,c as si,d as ai,f as li}from"./EditGeometryOperations-D70fs19-.js";var k;(function(t){t[t.NeverApplied=0]="NeverApplied",t[t.Applied=1]="Applied",t[t.Undone=2]="Undone"})(k||(k={}));var U;(function(t){t.UndoRedoUpdating="UndoRedoUpdating",t.UndoInvalidError="UndoInvalidError",t.RedoInvalidError="RedoInvalidError",t.ApplyInvalidError="ApplyInvalidError"})(U||(U={}));const lt={[U.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[U.UndoInvalidError]:"There are no items to Undo",[U.RedoInvalidError]:"There are no items to Redo",[U.ApplyInvalidError]:"Cannot apply an item that is already applied"};let W=class extends Error{constructor(){super(lt[U.UndoRedoUpdating]),this.type="undo-redo-updating-error"}},yt=class extends Error{constructor(){super(lt[U.UndoInvalidError]),this.type="undo-redo-undo-error"}},Vt=class extends Error{constructor(){super(lt[U.RedoInvalidError]),this.type="undo-redo-redo-error"}},ci=class extends Error{constructor(){super(lt[U.ApplyInvalidError]),this.type="undo-redo-apply-error"}};var V;(function(t){t[t.Apply=0]="Apply",t[t.Undo=1]="Undo",t[t.Redo=2]="Redo"})(V||(V={}));let et=class extends At{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=k.NeverApplied}get canUndo(){return this.status===k.Applied}get canRedo(){return this.status===k.Undone}async executeUndoRedoOperation(e){switch(e){case V.Apply:if(this.status!==k.NeverApplied)throw new ci;return await this.apply(),void(this.status=k.Applied);case V.Undo:if(this.status!==k.Applied)throw new yt;return await this.undo(),void(this.status=k.Undone);case V.Redo:if(this.status!==k.Undone)throw new yt;return await this.redo(),void(this.status=k.Applied)}}};a([l()],et.prototype,"name",void 0),a([l()],et.prototype,"tag",void 0),et=a([b("esri.undoredo.UndoableOperation")],et);let R=class extends At{constructor(){super(...arguments),this._stack=new kt,this._stackPosition=-1,this._updatingHandles=new ie}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(t=>t.destroy())}_drainStack(){this._stack.drain(t=>t.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new yt;if(this.updating)throw new W;const t=this._stack.getItemAt(this._stackPosition);t&&await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(V.Undo),--this._stackPosition,t.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new Vt;if(this.updating)throw new W;const t=this._stack.getItemAt(this._stackPosition+1);if(!t)throw new Vt;await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(V.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(t){if(this.updating)throw new W;await this._updatingHandles.addPromise((async()=>{t.status===k.NeverApplied&&await t.executeUndoRedoOperation(V.Apply),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(e=>e.destroy()),this._stackPosition=-1)})())}async add(t){if(this.updating)throw new W;await this._updatingHandles.addPromise((async()=>{t.status===k.NeverApplied&&await t.executeUndoRedoOperation(V.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(t,e=!1){if(this.updating&&!e)return;await _t(()=>!this.updating);const i=new kt;for(let o=0;o<this._stack.length;o++){const n=this._stack.getItemAt(o);n&&(n.tag===t?(n.destroy(),o===this._stackPosition&&(this._stackPosition=i.length-1)):i.push(n))}this._stack=i,this._stackPosition>i.length-1&&(this._stackPosition=i.length-1)}async clear(t=!1){if(this.updating&&!t)throw new W;await _t(()=>!this.updating),this._drainStack()}};a([l()],R.prototype,"_stack",void 0),a([l()],R.prototype,"_stackPosition",void 0),a([l()],R.prototype,"updating",null),a([l({readOnly:!0})],R.prototype,"canUndo",null),a([l({readOnly:!0})],R.prototype,"hasUndo",null),a([l({readOnly:!0})],R.prototype,"canRedo",null),a([l({readOnly:!0})],R.prototype,"hasRedo",null),R=a([b("esri.UndoRedo")],R);let pi=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};var gt;let C=gt=class extends rt{constructor(t){super(t),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}initialize(){const t=this.center,e=this.numberOfPoints;if(this.hasZ=(t==null?void 0:t.hasZ)??!1,this.rings.length!==0||!t)return;const i=oe(this.radius,this.radiusUnit,"meters"),o=t.spatialReference;let n,r="geographic";if(o.isWebMercator?r="webMercator":((o.wkid&&ne[o.wkid])!=null||(o.wkt2||o.wkt)&&re(o.wkt2||o.wkt))&&(r="projected"),this.geodesic){let s;switch(r){case"webMercator":s=se(t);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":s=t}n=this._createGeodesicCircle(s,i,e),r==="webMercator"&&(n=ae(n))}else{let s;r==="webMercator"||r==="projected"?s=i/le(t.spatialReference):r==="geographic"&&(s=ce(i,"meters",pe(t.spatialReference).radius)),n=this._createPlanarCircle(t,s,e)}this.spatialReference=n.spatialReference,this.addRing(n.rings[0])}clone(){const{center:t,numberOfPoints:e,radius:i,radiusUnit:o,geodesic:n}=this;return new gt({center:t==null?void 0:t.clone(),numberOfPoints:e,radius:i,radiusUnit:o,geodesic:n})}_createGeodesicCircle(t,e,i){const o=[],n=[t.x,t.y];for(let r=0;r<360;r+=360/i){const s=this.hasZ?[0,0,t.z??0]:[0,0];de(s,n,r,e,ue.WGS84),o.push(s)}return o.push(o[0]),new rt({rings:[o]})}_createPlanarCircle(t,e,i){const o=[],n=2*Math.PI/i;for(let r=0;r<i;++r){const s=n*r,p=[t.x+Math.cos(-s)*e,t.y+Math.sin(-s)*e];this.hasZ&&p.push(t.z??0),o.push(p)}return o.push(o[0]),new rt({spatialReference:t.spatialReference,rings:[o]})}};a([l({type:zt})],C.prototype,"center",void 0),a([l()],C.prototype,"geodesic",void 0),a([l()],C.prototype,"numberOfPoints",void 0),a([l()],C.prototype,"radius",void 0),a([l()],C.prototype,"radiusUnit",void 0),C=gt=a([b("esri.geometry.Circle")],C);const di=C;function S(t,e){const i=new zt({x:t[0],y:t[1],spatialReference:e});return t.length>2&&(i.z=t[2]),i}function ui(t,e){return new ve({points:t,spatialReference:e})}function Pt(t,e,i){const o=new me({paths:t,spatialReference:e});return i&&Ht(o),o}function X(t,e,i,o=!0){const n=ye(t);n.forEach(s=>{const p=s[0],c=s[s.length-1];ge(p,c)&&s.length!==1||s.push(s[0])});let r=new rt({rings:n,spatialReference:e});return r.rings.forEach(s=>{fe(s)||s.reverse()}),i&&Ht(r),o&&r.isSelfIntersecting&&Ft(e)&&(r=qe(r)),r}function Ct(t,e,i){const o=e.mapToLocalMultiple(t),n=[],r={x:o[0].x,y:o[0].y},s={x:o[1].x,y:o[1].y},p=Math.round(s.x-r.x),c=Math.round(s.y-r.y),d=Math.max(Math.abs(p),Math.abs(c));if(i){const h={x:r.x+d,y:r.y+d},m={x:r.x-d,y:r.y-d};n.push(g(h.x,m.y),g(m.x,m.y),g(m.x,h.y),g(h.x,h.y))}else{const h={x:p>0?r.x+d:r.x-d,y:c>0?r.y+d:r.y-d};n.push(g(r.x,r.y),g(h.x,r.y),g(h.x,h.y),g(r.x,h.y))}return Wt(X([n.map(h=>e.localToMap(h)).filter(ft)],e.spatialReference,e.doUnnormalization,!0),n,e)}function hi(t,e,i){let o=e.mapToLocalMultiple(t);if(o.length===1){const c=o[0];o=[g(c.x-48,c.y+48),g(c.x+48,c.y-48),g(c.x+48,c.y-48),g(c.x-48,c.y+48)]}const n=[],r={x:o[0].x,y:o[0].y},s={x:o[1].x,y:o[1].y};if(i){const p=Math.round(s.x-r.x),c=Math.round(s.y-r.y);n.push(g(r.x-p,r.y-c),g(s.x,r.y-c),g(s.x,s.y),g(r.x-p,s.y))}else n.push(g(r.x,r.y),g(s.x,r.y),g(s.x,s.y),g(r.x,s.y));return Wt(X([n.map(p=>e.localToMap(p)).filter(ft)],e.spatialReference,e.doUnnormalization,!0),n,e)}function Wt(t,e,i){const o=it(e[3],e[2],i),n=it(e[1],e[2],i),r=it(e[0],e[1],i),s=it(e[0],e[3],i);return{geometry:t,midpoints:o!=null&&n!=null&&r!=null&&s!=null?{top:o,right:n,bottom:r,left:s}:null}}function it(t,e,i){A[0]=t.x,A[1]=t.y,A[2]=0,z[0]=e.x,z[1]=e.y,z[2]=0,we(A,A,z,.5),ot.x=A[0],ot.y=z[1],ot.z=z[2];const o=i.localToMap(ot);return o!=null?S(o,i.spatialReference):null}const ot=g(0,0,0),A=mt(),z=mt();function St(t,e,i,o){const n=e.mapToLocalMultiple(t);let r=null,s=null;if(i)r=n[0],s=n[1];else{const f=n[0],O=n[1],$=Math.round(O.x-f.x),w=Math.round(O.y-f.y),x=Math.max(Math.abs($),Math.abs(w));r=g($>0?f.x+x/2:f.x-x/2,w>0?f.y+x/2:f.y-x/2),s=g(Math.abs($)>Math.abs(w)?r.x-x/2:r.x,Math.abs($)>Math.abs(w)?r.y:r.y-x/2)}const p=e.localToMap(r),c=e.localToMap(s);if(p==null||c==null)return null;e.doUnnormalization&&he([[p,c]],e.spatialReference);const d=S(p,e.spatialReference),h=S(c,e.spatialReference),m=ut(e.spatialReference);let v=0;if(Ft(e.spatialReference))v=m*Ye(d,h,null);else{const f=r.x-s.x,O=r.y-s.y;v=m*Math.sqrt(f*f+O*O)*1}const u=new di({center:d,radius:v,radiusUnit:"meters",spatialReference:e.spatialReference});return{geometry:X(u.rings,u.spatialReference,!1),center:d,edge:h}}function yi(t,e,i){const o=e.mapToLocalMultiple(t),n=o[0],r=o[1],s=Math.round(r.x-n.x),p=Math.round(r.y-n.y),c=g(i?n.x:n.x+s/2,i?n.y:n.y+p/2),d=i?s:s/2,h=i?p:p/2,m=60,v=[],u=2*Math.PI/m;function f(M){const te=Math.cos(M),ee=Math.sin(M);return g(d*te+c.x,h*ee+c.y)}for(let M=0;M<m;M++)v.push(f(M*u));v.push(v[0]);const{spatialReference:O,doUnnormalization:$}=e,w=X([v.map(M=>e.localToMap(M)).filter(ft)],O,$,!1),x=e.localToMap(f(Math.PI/2)),P=e.localToMap(f(0)),Z=e.localToMap(f(-Math.PI/2)),B=e.localToMap(f(Math.PI));return{geometry:w,midpoints:x!=null&&P!=null&&Z!=null&&B!=null?{top:S(x,O),right:S(P,O),bottom:S(Z,O),left:S(B,O)}:null}}function L(t,e,i){if(t==null)return"noTool";switch(t){case"point":return gi();case"multipoint":return"multipoint";case"polyline":return fi(e,i);case"polygon":return mi(e,i);case"rectangle":case"circle":return vi(e,i);default:return}}function gi(t){return"point"}function fi(t,e){const i=t!=null&&t.type==="polyline"&&t.paths.length?t.paths[0].length:0;return e==="freehand"?i<2?"freehandStart":"freehandEnd":i<2?"polylineZeroVertices":"polylineOneVertex"}function mi(t,e){const i=t!=null&&t.type==="polygon"&&t.rings.length?t.rings[0].length:0;if(i<3)switch(e){case"freehand":return"freehandStart";case"hybrid":return"polygonZeroVerticesHybrid";default:return"polygonZeroVertices"}else if(i<4)return e==="freehand"?"freehandEnd":"polygonOneVertex";return"polygonTwoVertices"}function vi(t,e){if((t!=null&&t.type==="polygon"&&t.rings.length?t.rings[0].length:0)<3)switch(e){case"freehand":return"freehandStart";case"click":return"shapeStartClick";default:return"shapeStartHybrid"}switch(e){case"freehand":return"freehandEnd";case"click":return"shapeEndClick";default:return"shapeEndHybrid"}}function wi(t,e){const i=t==null?void 0:t.geometry;if(!t||(i==null?void 0:i.type)!=="mesh"||!e)return;const{renderCoordsHelper:o,elevationProvider:n}=e,{camera:r}=e.state,{extent:s}=i,{center:p,spatialReference:c}=s,d=ut(c),h=vt(c),m=ut(o.spatialReference),v=s.width*d,u=s.height*h,f=(s.zmax??0)*h,O=f-(s.zmin??0)*h,$=Math.max(v,u,O)/m,{x:w,y:x}=p,P=p.z??0;Lt(nt,w,x,P),o.toRenderCoords(nt,c,nt);const Z=$/r.computeScreenPixelSizeAt(nt);if(Z>r.width*Oi)return"meshTooClose";if(Z<xi)return"meshTooFar";const B=xe(t),{absoluteZ:M}=Oe(w,x,f,c,e,B);return M<(n.getElevation(w,x,P,c,"ground")??0)*h+O*ki?"meshUnderground":"mesh"}const xi=20,Oi=1,ki=.1,nt=mt();let T=class extends G{constructor(e){super(e),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=K}get allFields(){return[]}};a([l()],T.prototype,"type",void 0),a([l()],T.prototype,"radius",void 0),a([l()],T.prototype,"xSize",void 0),a([l()],T.prototype,"ySize",void 0),a([l()],T.prototype,"area",void 0),a([l()],T.prototype,"helpMessage",void 0),a([l()],T.prototype,"allFields",null),T=a([b("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],T);let Y=class extends Q(G){constructor(e){super(e),this.type="draw-mesh",this.orientation=Qe({lockable:!1}),this.scale=Xe({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};a([l()],Y.prototype,"helpMessage",void 0),a([l()],Y.prototype,"allFields",null),Y=a([b("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],Y);let q=class extends Q(G){constructor(e){super(e),this.type="draw-multipoint"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};a([l()],q.prototype,"helpMessage",void 0),a([l()],q.prototype,"allFields",null),q=a([b("esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo")],q);let J=class extends Q(G){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};a([l()],J.prototype,"helpMessage",void 0),a([l()],J.prototype,"allFields",null),J=a([b("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],J);let F=class extends Q(G){constructor(e){super(e),this.type="draw-polygon",this.direction=Zt(),this.distance=jt(),this.area=Be(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};a([l()],F.prototype,"xyMode",void 0),a([l()],F.prototype,"helpMessage",void 0),a([l()],F.prototype,"allFields",null),F=a([b("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],F);let H=class extends Q(G){constructor(t){super(t),this.type="draw-polyline",this.direction=Zt(),this.distance=jt(),this.totalLength=ti(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};a([l()],H.prototype,"helpMessage",void 0),a([l()],H.prototype,"xyMode",void 0),a([l()],H.prototype,"allFields",null),H=a([b("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],H);let I=class extends G{constructor(t){super(t),this.type="draw-rectangle",this.xSize=E,this.ySize=E,this.area=K}get allFields(){return[]}};a([l()],I.prototype,"type",void 0),a([l()],I.prototype,"xSize",void 0),a([l()],I.prototype,"ySize",void 0),a([l()],I.prototype,"area",void 0),a([l()],I.prototype,"helpMessage",void 0),a([l()],I.prototype,"allFields",null),I=a([b("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],I);function _i(t,e){return{point:new J({sketchOptions:e,viewType:t}),multipoint:new q({sketchOptions:e,viewType:t}),polyline:new H({sketchOptions:e,viewType:t}),polygon:new F({sketchOptions:e,viewType:t}),mesh:new Y({sketchOptions:e,viewType:t}),rectangle:new I({sketchOptions:e}),circle:new T({sketchOptions:e})}}function Et(t){const{directionOptions:e,geometryType:i,sketchOptions:o,tooltipInfos:n}=t,r=p=>{const c=ct(t).mode,d=n[p].elevation;c==="relative-to-ground"||c==="relative-to-scene"||c==="on-the-ground"?d.lock(Ot(t)):d.unlock()},s=p=>{if(e){const c=n[p].direction;c.committed=e.angle,c.unlockOnVertexPlacement=!1,o.values.directionMode=e.mode}};switch(i){case"polygon":case"polyline":r(i),s(i);break;case"point":case"mesh":r(i)}}function $i(t,e){const{drawOperation:i,view:o}=e,n=wt(e),r=ct(e);if(o.type==="2d"||!t||r.mode!=="absolute-height"||(i==null?void 0:i.numCommittedVertices)!==1||!n||n.type!=="draw-polyline"&&n.type!=="draw-polygon"||n.elevation.locked)return;const[s,p,c]=t,d=Ai(s,p,c,r,e);d!=null&&n.elevation.lock(d)}function Gt(t){var e;(e=wt(t))==null||e.allFields.forEach(i=>{i.unlockOnVertexPlacement&&i.unlock()})}function wt({geometryType:t,graphic:e,tooltipInfos:i}){var o;return((o=e==null?void 0:e.geometry)==null?void 0:o.type)!==bi[t]?t==="circle"||t==="rectangle"?i[t]:null:i[t]}const bi={point:"point",multipoint:"multipoint",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon",freehandPolygon:"polygon",freehandPolyline:"polyline"};function Mi(t,e){switch(t==null?void 0:t.type){case"draw-point":Ri(t,e);break;case"draw-multipoint":Ti(t,e);break;case"draw-polyline":Ii(t,e);break;case"draw-polygon":Vi(t,e);break;case"draw-rectangle":Ci(t,e);break;case"draw-circle":Si(t,e);break;case"draw-mesh":Ui(t,e)}}function Ri(t,e){var o;const i=(o=e.graphic)==null?void 0:o.geometry;(i==null?void 0:i.type)==="point"&&(xt(t,i,e),t.helpMessage=L("point",i,e.drawOperation.drawingMode))}function Ti(t,e){var o;const i=(o=e.graphic)==null?void 0:o.geometry;(i==null?void 0:i.type)==="multipoint"&&(xt(t,i,e),t.helpMessage=L("multipoint",i,e.drawOperation.drawingMode))}function Ui(t,e){const{graphic:i,view:o}=e,n=i==null?void 0:i.geometry;o.type!=="3d"||n&&n.type!=="mesh"||(xt(t,n==null?void 0:n.origin,e),n&&Le(t,n),t.helpMessage=wi(i,o))}function xt(t,e,i){const{drawOperation:o,view:n,sketchOptions:r}=i,{cursorVertex:s}=o;t.sketchOptions=r,t.viewType=n.type;const p=(e==null?void 0:e.type)==="multipoint"?e.getPoint(e.points.length-1):e;if(t.setLocationFromPoint(p,N(i)),qt(t.elevation,i),!s)return void(o.constraints=void 0);const c=s;o.constraints={context:Xt(c,i),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:null,direction:null}}function Ii(t,e){const{createOperationGeometry:i,drawOperation:o}=e,n=i!=null?i.full:null;n&&n.type!=="polyline"||(Yt(t,e),t.totalLength.actual=o.lastVertex?(n?ei(n):null)??E:null,t.helpMessage=L("polyline",n,e.drawOperation.drawingMode))}function Vi(t,e){const{createOperationGeometry:i,drawOperation:o}=e,n=i!=null?i.full:null;n&&n.type!=="polygon"||(Yt(t,e),t.area.actual=o.lastVertex?(n?Dt(n):null)??K:null,t.helpMessage=L("polygon",n,e.drawOperation.drawingMode))}function Yt(t,e){const{drawOperation:i,sketchOptions:o,view:n}=e,{cursorVertex:r,lastVertex:s,secondToLastVertex:p}=i,c=o.values.effectiveDirectionMode;t.sketchOptions=o,t.viewType=n.type;const d=s&&r?at(s,r)??E:null;if(t.distance.actual=d,t.distance.readOnly=s==null,t.direction.actual=null,t.direction.readOnly=!0,s&&r&&(c==="absolute"||p)){const v=Me(p,s,r,c);t.direction.actual=v??Re,t.direction.readOnly=!1}t.setLocationFromPoint(r,N(e)),qt(t.elevation,e);const h=Pi(s,e);t.xyMode=h,t.direction.visible=h==="direction-distance",t.distance.visible=h==="direction-distance",t.effectiveX.visible=h==="coordinates",t.effectiveY.visible=h==="coordinates";const m=r??s;i.constraints=m?{context:Xt(m,e),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:t.distance.committed,direction:t.direction.committed}:void 0}function Pi(t,{sketchOptions:e}){const i=e.tooltips.xyMode;return i==="auto"?t?"direction-distance":"coordinates":i}function Ci(t,e){var i;t.sketchOptions=e.sketchOptions,t.xSize=Kt(e),t.ySize=Qt(e),t.area=Jt(e),t.helpMessage=L("rectangle",(i=e.graphic)==null?void 0:i.geometry,e.drawOperation.drawingMode)}function Si(t,e){var n;const{forceUniformSize:i,sketchOptions:o}=e;t.sketchOptions=o,t.radius=i?Ei(e):null,t.xSize=i?null:Kt(e),t.ySize=i?null:Qt(e),t.area=Jt(e),t.helpMessage=L("circle",(n=e.graphic)==null?void 0:n.geometry,e.drawOperation.drawingMode)}function qt(t,e){const{drawOperation:i}=e,o=(i==null?void 0:i.cursorVertex)??(i==null?void 0:i.lastVertex);t.actual=oi(o)??Ot(e),t.visible=i.hasZ,t.readOnly=!1,t.showAsZ=!0}function Jt(t){var i;const e=(i=t.createOperationGeometry)==null?void 0:i.full;return(e==null?void 0:e.type)!=="polygon"?K:Dt(e)??K}function Kt(t){var i,o;const e=(o=(i=t.createOperationGeometry)==null?void 0:i.rectangle)==null?void 0:o.midpoints;return(e!=null?at(e.left,e.right):null)??E}function Qt(t){var i,o;const e=(o=(i=t.createOperationGeometry)==null?void 0:i.rectangle)==null?void 0:o.midpoints;return(e!=null?at(e.top,e.bottom):null)??E}function Ei({createOperationGeometry:t}){var e;return(((e=t==null?void 0:t.circle)==null?void 0:e.center)!=null&&t.circle.edge!=null?at(t.circle.center,t.circle.edge):null)??E}function Gi(t){const{geometryType:e,tooltipInfos:i}=t;switch(e){case"point":case"multipoint":case"mesh":case"polyline":case"polygon":{const o=i[e].elevation.committed;return o?ke(o,"meters")/vt(N(t)):void 0}default:return}}function Ai(t,e,i,o,n){const{view:r,drawOperation:s}=n;if(r.type!=="3d"||!s)return;i??(i=0);const p=N(n),c=ct(n),d=$e(r,t,e,i,p,c,o);return ii(d,p)??Ot(n)}function ct(t){return t.drawOperation.elevationInfo??_e}function N(t){return t.drawOperation.coordinateHelper.spatialReference}function Ot(t){const e=vt(N(t));return be(t.defaultZ*e,"meters")}function Xt(t,e){return Je(t,e.view,N(e),ct(e),e.drawOperation.coordinateHelper.hasZ(),e.sketchOptions.values.effectiveDirectionMode)}let y=class extends Te.EventedMixin(ni){constructor(t){super(t),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new Nt}initialize(){const{view:t}=this;this.internalGraphicsLayer=new Ue({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const e=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=_i(t.type,this.sketchOptions);const i=Ne(()=>({view:t,options:this.sketchOptions.tooltips}));this.tooltip=i,Et(this._tooltipsContext),this._coordinateFormatterLoadTask=Ie(()=>Ze()),this.addHandles([e.on("vertex-add",o=>this.onVertexAdd(o)),e.on("vertex-remove",o=>this.onVertexRemove(o)),e.on("vertex-update",o=>this.onVertexUpdate(o)),e.on("cursor-update",o=>this.onCursorUpdate(o)),e.on("cursor-remove",()=>this._updateGraphic()),e.on("complete",o=>this.onComplete(o)),this._coordinateFormatterLoadTask,i.on("paste",o=>je(o,this.activeTooltipInfo)),Ve(()=>this.cursor,o=>{e.cursor=o},Pe),$t(()=>{const{activeTooltipInfo:o,sketchOptions:n}=this;Mi(o,this._tooltipsContext),i.info=n.tooltips.effectiveEnabled?o:null}),$t(()=>{e.constraintZ=Gi(this._tooltipsContext)},Ce)]),this.finishToolCreation()}destroy(){this.drawOperation=pt(this.drawOperation),this.tooltip=pt(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=pt(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),this._graphic!=null&&(this._graphic.symbol=t)}set mode(t){const e=this.drawOperation;e&&(e.drawingMode=t),this._set("mode",t)}get updating(){var t;return((t=this.drawOperation)==null?void 0:t.updating)??!1}get undoRedo(){const{view:{type:t,map:e}}=this;return t==="2d"&&e&&"undoRedo"in e&&e.undoRedo instanceof R?e.undoRedo:null}set undoRedo(t){this._override("undoRedo",t)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){this.destroyed||De(t,this.tooltip)||this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&Et(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(_.outline),this.removeHandles(_.regularVertices),this.removeHandles(_.activeVertex),this.removeHandles(_.activeEdge),this.removeHandles(dt)}_createOrUpdateGraphic(t){if(this._graphic!=null)return this.updateGraphicGeometry(t),this._graphic;const e=new Se({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=e,this.updateGraphicGeometry(t),this.internalGraphicsLayer.add(e),this.addHandles(this.initializeGraphic(e)),this.notifyChange("graphic"),this.addHandles(tt(()=>{this.internalGraphicsLayer.remove(e),this._graphic===e&&(this._graphic=null)}),dt),e}updateGraphicGeometry(t){this._graphic.geometry=t}_getCreateOperationGeometry(t={operationComplete:!1}){var O,$;if(this.drawOperation==null)return;const{coordinateHelper:e,view:i,visualizationCursorVertex:o,lastVertex:n,committedVertices:r,geometryIncludingUncommittedVertices:s,numCommittedVertices:p}=this.drawOperation;if(!(p>0||o!=null))return;const c=t.operationComplete?r:s,d=c.length,h=o!=null?e.pointToArray(o):null,m=this._drawSpatialReference,v=i.type==="3d"&&i.viewingMode==="global",u=new pi;u.committedVertices=r,u.cursorVertex=h;const{geometryType:f}=this;switch(f){case"point":case"mesh":u.full=e.arrayToPoint(c[0]);break;case"multipoint":u.full=d>0?ui(c,m):null;break;case"polyline":case"polygon":d>0&&(u.full=f==="polygon"?X([c],m,v,!0):Pt([c],m,v),u.cursorEdge=h!=null&&n&&!We(o,n)?Pt([[h,e.pointToArray(n)]],m,v):null,u.outline=d>1?u.full:null);break;case"circle":case"rectangle":{if(u.committedVertices=u.cursorVertex=null,!d)break;const w=Ke(i,c[0]),x=c[0],P=w.makeMapPoint(x[0]+zi*i.resolution,x[1]);f==="circle"?d===1&&t.operationComplete?u.circle=St([x,P],w,!0):d===2&&(this.forceUniformSize?u.circle=St(c,w,this.centered):u.rectangle=yi(c,w,this.centered)):d===1&&t.operationComplete?u.rectangle=Ct([x,P],w,!0):d===2&&(u.rectangle=this.forceUniformSize?Ct(c,w,this.centered):hi(c,w,this.centered)),u.full=u.circle!=null?u.circle.geometry:(O=u.rectangle)==null?void 0:O.geometry,u.outline=(($=u.full)==null?void 0:$.type)==="polygon"?u.full:null;break}default:return null}return u}initializeGraphic(t){return tt()}onComplete(t){if(!this.drawOperation)return;this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){const i=this._getCreateOperationGeometry({operationComplete:!0});i!=null&&(e=this._createOrUpdateGraphic(i.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:e,...t})}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){const{drawOperation:t}=this;t&&(t.isCompleted||t.cancel())}onOutlineChanged(t){return tt()}onCursorEdgeChanged(t){return tt()}onVertexAdd(t){var e;Gt(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||$i((e=t.vertices.at(0))==null?void 0:e.coordinates,this._tooltipsContext),this.emit("vertex-add",t)}onVertexRemove(t){Gt(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){const t=this._getCreateOperationGeometry();this._createOperationGeometry=t,t!=null?(t.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(t.cursorEdge),_.activeEdge):this.removeHandles(_.activeEdge),t.outline!=null?this.addHandles(this.onOutlineChanged(t.outline),_.outline):this.removeHandles(_.outline),t.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(t.committedVertices),_.regularVertices):this.removeHandles(_.regularVertices),t.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(t.cursorVertex),_.activeVertex):this.removeHandles(_.activeVertex),t.full!=null?this._createOrUpdateGraphic(t.full):this.removeHandles(dt)):this._destroyAllVisualizations()}get activeTooltipInfo(){var t;return(t=this._coordinateFormatterLoadTask)!=null&&t.finished?wt(this._tooltipsContext):null}};a([l()],y.prototype,"_coordinateFormatterLoadTask",void 0),a([l()],y.prototype,"_createOperationGeometry",void 0),a([l()],y.prototype,"_tooltipsContext",null),a([l({value:!0})],y.prototype,"centered",null),a([l()],y.prototype,"cursor",null),a([l({nonNullable:!0})],y.prototype,"defaultZ",void 0),a([l({constructOnly:!0})],y.prototype,"directionOptions",void 0),a([l()],y.prototype,"drawOperation",void 0),a([l()],y.prototype,"elevationLockOnVertexAddDisabled",void 0),a([l({value:!0})],y.prototype,"enabled",null),a([l({value:!0})],y.prototype,"forceUniformSize",null),a([l({constructOnly:!0})],y.prototype,"geometryType",void 0),a([l()],y.prototype,"graphic",null),a([l({constructOnly:!0})],y.prototype,"graphicProperties",void 0),a([l()],y.prototype,"graphicSymbol",null),a([l({constructOnly:!0})],y.prototype,"hasZ",void 0),a([l({constructOnly:!0})],y.prototype,"geometryToPlace",void 0),a([l()],y.prototype,"mode",null),a([l()],y.prototype,"snappingManager",void 0),a([l()],y.prototype,"snapToScene",void 0),a([l()],y.prototype,"tooltip",void 0),a([l()],y.prototype,"tooltipInfos",void 0),a([l({constructOnly:!0,type:Nt})],y.prototype,"sketchOptions",void 0),a([l()],y.prototype,"updating",null),a([l({constructOnly:!0,nonNullable:!0})],y.prototype,"view",void 0),a([l({constructOnly:!0})],y.prototype,"undoRedo",null),a([l()],y.prototype,"activeTooltipInfo",null),y=a([b("esri.views.draw.DrawGraphicTool")],y);const dt=Symbol("create-operation-graphic"),_={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function lo(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const zi=48;function co(t,e){return Bt(t,e,!1)}function po(t,e){return Bt(t,e,!0)}function Bt(t,e,i){if(t instanceof ri){if(t.operation instanceof si)return Fi(t.operation,e,i),!0;if(t.operation instanceof ai)return Hi(t.operation,e,i),!0;if(t.operation instanceof li)return Li(t.operation,e,i),!0}return!1}function Fi(t,e,i=!1){const o=i?-1:1,n=He(o*t.dx,o*t.dy,o*t.dz);ht(e.origin,e.origin,n),st(e)}function Hi(t,e,i=!1){const o=i?-t.angle:t.angle;Rt(e.basis1,e.basis1,Tt,o),Rt(e.basis2,e.basis2,Tt,o),st(e)}function Li(t,e,i=!1){const o=i?1/t.factor1:t.factor1,n=i?1/t.factor2:t.factor2;Ut(e.basis1,e.basis1,o),Ut(e.basis2,e.basis2,n),It(e.origin,e.origin,t.origin,t.axis1,o),It(e.origin,e.origin,t.origin,t.axis2,n),st(e)}function uo(t,e,i,o,n=!1){o||(o=Ee());const r=j(D.get(),t[1],-t[0]),s=j(D.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),p=j(D.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),c=D.get(),d=e.allVertices;d.forEach(({pos:u})=>{j(c,bt(t,u),bt(r,u)),Ge(s,s,c),Ae(p,p,c)});const h=1e-6,m=j(D.get(),p[0]-s[0]<h?i/2:0,p[1]-s[1]<h?i/2:0);ze(s,s,m),Fe(p,p,m);const v=n?d.reduce((u,f)=>u+(f.pos[2]??0),0)/d.length:0;return Mt(o.basis1,t,(p[0]-s[0])/2),Mt(o.basis2,r,(p[1]-s[1])/2),Lt(o.origin,s[0]*t[0]+s[1]*r[0],s[0]*t[1]+s[1]*r[1],v),ht(o.origin,o.origin,o.basis1),ht(o.origin,o.origin,o.basis2),st(o),o}export{y as I,lo as M,uo as S,po as T,co as V};
