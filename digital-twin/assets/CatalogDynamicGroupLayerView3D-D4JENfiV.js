import{e as r,y as s,a as $,V as v,gi as U,cH as x,a6 as I,he as O,C as _,cs as g,cl as C}from"./index-5d_Oj-E1.js";import{l as N}from"./LayerView3D-BNNsJf8u.js";import{y as T}from"./LayerView-BFWRnFoC.js";const u=Symbol(),D=F=>{let a=class extends F{constructor(){super(...arguments),this.layerViews=new v,this._debouncedUpdate=U(async()=>{const{layer:e,parent:t}=this,n=t==null?void 0:t.footprintLayerView;let d=[];const o=this._createQuery();if(o&&n){const{features:h}=await n.queryFeatures(o);this.suspended||(d=h.map(c=>e.acquireLayer(c)))}this.removeHandles(u),this.addHandles(d,u)})}get creatingLayerViews(){var e;return((e=this.view)==null?void 0:e.layerViewManager.isCreatingLayerViewsForLayer(this.layer))??!1}isUpdating(){return this.creatingLayerViews||this.layer.updating||this.layerViews.some(e=>e.updating)}enableLayerUpdates(){return x([this._updatingHandles.addWhen(()=>{var e,t;return((t=(e=this.parent)==null?void 0:e.footprintLayerView)==null?void 0:t.dataUpdating)===!1},()=>this.updateLayers()),this._updatingHandles.add(()=>{var e,t,n,d,o;return[this.layer.maximumVisibleSublayers,(e=this.layer.parent)==null?void 0:e.orderBy,(n=(t=this.parent)==null?void 0:t.footprintLayerView)==null?void 0:n.filter,(o=(d=this.parent)==null?void 0:d.footprintLayerView)==null?void 0:o.timeExtent,this.suspended]},()=>this.updateLayers()),I(()=>this.removeHandles(u))])}updateLayers(){this.suspended?this.removeHandles(u):this._updatingHandles.addPromise(O(this._debouncedUpdate()).catch(e=>{_.getLogger(this).error(e)}))}_createQuery(){var f,V;const e=(f=this.parent)==null?void 0:f.footprintLayerView,t=(V=this.layer)==null?void 0:V.parent;if(!e||!t||t.destroyed)return null;const{layer:{maximumVisibleSublayers:n},view:{scale:d}}=this;if(!n)return null;const{itemTypeField:o,itemSourceField:h,itemNameField:c,minScaleField:m,maxScaleField:L,objectIdField:b,orderBy:w}=t,S=g(`${m} IS NULL OR ${d} <= ${m} OR ${m} = 0`,`${L} IS NULL OR ${d} >= ${L}`),l=w==null?void 0:w.find(y=>y.field&&!y.valueExpression),i=e.createQuery();if(i.returnGeometry=!1,i.num=n,i.outFields=[b,h,c],i.where=g(i.where,S),this.unsupportedItemTypes!=null){const y=`${o} NOT IN (${this.unsupportedItemTypes.map(H=>`'${H}'`)})`;i.where=g(i.where,y)}return l!=null&&l.field&&(i.orderByFields=[`${l.field} ${l.order==="descending"?"DESC":"ASC"}`],i.outFields.push(l.field)),i}};return r([s({readOnly:!0})],a.prototype,"creatingLayerViews",null),r([s()],a.prototype,"layer",void 0),r([s()],a.prototype,"layerViews",void 0),r([s({readOnly:!0})],a.prototype,"unsupportedItemTypes",void 0),r([s()],a.prototype,"parent",void 0),r([s({readOnly:!0})],a.prototype,"isUpdating",null),a=r([$("esri.views.layers.CatalogDynamicGroupLayerView")],a),a};let p=class extends D(N(T)){constructor(){super(...arguments),this.type="catalog-dynamic-group-3d",this.layerViews=new v}initialize(){this.addHandles([this.enableLayerUpdates(),C(()=>this.view.stationary,()=>this.updateLayers())])}};r([s()],p.prototype,"layerViews",void 0),r([s()],p.prototype,"parent",void 0),r([s()],p.prototype,"view",void 0),p=r([$("esri.views.3d.layers.CatalogDynamicGroupLayerView3D")],p);const q=p;export{q as default};
