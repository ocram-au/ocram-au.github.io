import{ay as A,ag as Z,bV as yt,aV as k,aU as nt,aZ as z,bg as st,aY as lt,aX as ut,qF as $t,qG as It,eh as ft,aW as Nt,qH as X,qI as At,fO as gt,cO as dt,bF as q,qJ as xt}from"./index-QRcEofMq.js";import{RegularEdgeInstancesLayout as G,SilhouetteEdgeInstancesLayout as J,EdgeInputBufferLayout as St}from"./bufferLayouts-vUgb3lv4.js";class vt{constructor(){this.position0=A(),this.position1=A(),this.faceNormal0=A(),this.faceNormal1=A(),this.componentIndex=0,this.cosAngle=0}}const j=-1;function bt(t,n,s){const a=t.vertices.position,c=t.vertices.componentIndex,u=m.position0,d=m.position1,p=m.faceNormal0,$=m.faceNormal1,{edges:r,normals:f}=Et(t),w=r.length/4,I=n.allocate(w);let V=0;const F=w,x=s==null?void 0:s.allocate(F);let U=0,e=0,o=0;T.length=0;for(let g=0;g<w;++g){const v=4*g;a.getVec(r.data[v],u),a.getVec(r.data[v+1],d);const _=T.pushNew();_.index=4*g,_.length=yt(u,d)}T.sort((g,v)=>v.length-g.length);const l=new Array,i=new Array;T.forAll(({length:g,index:v})=>{const _=r.data[v],wt=r.data[v+1],Q=r.data[v+2],tt=r.data[v+3],et=tt===j;if(a.getVec(_,u),a.getVec(wt,d),et){const N=3*Q;k(p,f.data[N],f.data[N+1],f.data[N+2]),nt($,p),m.componentIndex=c.get(_),m.cosAngle=z(p,$)}else{let N=3*Q;if(k(p,f.data[N],f.data[N+1],f.data[N+2]),N=3*tt,k($,f.data[N],f.data[N+1],f.data[N+2]),m.componentIndex=c.get(_),m.cosAngle=z(p,$),Ot(m,Mt))return;m.cosAngle<-.9999&&nt($,p)}e+=g,o++,et||Lt(m,Ft)?(n.write(I,V++,m),l.push(g)):Vt(m,pt)&&(x&&s&&s.write(x,U++,m),i.push(g))});const y=new Float32Array(l.reverse()),S=new Float32Array(i.reverse()),b=x&&s?{instancesData:x.slice(0,U),lodInfo:{lengths:S}}:void 0;return{regular:{instancesData:I.slice(0,V),lodInfo:{lengths:y}},silhouette:b,averageEdgeLength:e/o}}function Lt(t,n){return t.cosAngle<n}function Ot(t,n){return t.cosAngle>n}function Vt(t,n){const s=$t(t.cosAngle);return It(ot,t.position1,t.position0),s*(z(lt(Bt,t.faceNormal0,t.faceNormal1),ot)>0?-1:1)>n}function Et(t){const n=t.faces.length/3,s=t.faces,a=t.neighbors,c=t.vertices.position;h.length=H.length=0;for(let u=0;u<n;u++){const d=3*u,p=a[d],$=a[d+1],r=a[d+2],f=s[d],w=s[d+1],I=s[d+2];c.getVec(f,E),c.getVec(w,W),c.getVec(I,C),st(W,W,E),st(C,C,E),lt(E,W,C),ut(E,E),H.pushArray(E),(p===j||f<w)&&(h.push(f),h.push(w),h.push(u),h.push(p)),($===j||w<I)&&(h.push(w),h.push(I),h.push(u),h.push($)),(r===j||I<f)&&(h.push(I),h.push(f),h.push(u),h.push(r))}return{edges:h,normals:H}}class _t{constructor(){this.index=0,this.length=0}}const T=new Z({allocator:t=>t||new _t,deallocator:null}),h=new Z({deallocator:null}),H=new Z({deallocator:null}),m=new vt,Bt=A(),ot=A(),E=A(),W=A(),C=A(),pt=ft(4),Mt=Math.cos(pt),Pt=ft(35),Ft=Math.cos(Pt);function at(t,n,s){const a=n/3,c=new Uint32Array(s+1),u=new Uint32Array(s+1),d=(e,o)=>{e<o?c[e+1]++:u[o+1]++};for(let e=0;e<a;e++){const o=t[3*e],l=t[3*e+1],i=t[3*e+2];d(o,l),d(l,i),d(i,o)}let p=0,$=0;for(let e=0;e<s;e++){const o=c[e+1],l=u[e+1];c[e+1]=p,u[e+1]=$,p+=o,$+=l}const r=new Uint32Array(6*a),f=c[s],w=(e,o,l)=>{if(e<o){const i=c[e+1]++;r[2*i]=o,r[2*i+1]=l}else{const i=u[o+1]++;r[2*f+2*i]=e,r[2*f+2*i+1]=l}};for(let e=0;e<a;e++){const o=t[3*e],l=t[3*e+1],i=t[3*e+2];w(o,l,e),w(l,i,e),w(i,o,e)}const I=(e,o)=>{const l=2*e,i=o-e;for(let y=1;y<i;y++){const S=r[l+2*y],b=r[l+2*y+1];let g=y-1;for(;g>=0&&r[l+2*g]>S;g--)r[l+2*g+2]=r[l+2*g],r[l+2*g+3]=r[l+2*g+1];r[l+2*g+2]=S,r[l+2*g+3]=b}};for(let e=0;e<s;e++)I(c[e],c[e+1]),I(f+u[e],f+u[e+1]);const V=new Int32Array(3*a),F=(e,o)=>e===t[3*o]?0:e===t[3*o+1]?1:e===t[3*o+2]?2:-1,x=(e,o)=>{const l=F(e,o);V[3*o+l]=-1},U=(e,o,l,i)=>{const y=F(e,o);V[3*o+y]=i;const S=F(l,i);V[3*i+S]=o};for(let e=0;e<s;e++){let o=c[e];const l=c[e+1];let i=u[e];const y=u[e+1];for(;o<l&&i<y;){const S=r[2*o],b=r[2*f+2*i];S===b?(U(e,r[2*o+1],b,r[2*f+2*i+1]),o++,i++):S<b?(x(e,r[2*o+1]),o++):(x(b,r[2*f+2*i+1]),i++)}for(;o<l;)x(e,r[2*o+1]),o++;for(;i<y;)x(r[2*f+2*i],r[2*f+2*i+1]),i++}return V}const R=.7;let ht=class{updateSettings(n){this.settings=n,this._edgeHashFunction=n.reducedPrecision?Ut:qt}write(n,s,a){D.seed=this._edgeHashFunction(a);const c=D.getIntRange(0,255),u=D.getIntRange(0,this.settings.variants-1),d=D.getFloat(),p=255*(.5*Tt(-(1-Math.min(d/R,1))+Math.max(0,d-R)/(1-R),1.2)+.5);n.position0.setVec(s,a.position0),n.position1.setVec(s,a.position1),n.componentIndex.set(s,a.componentIndex),n.variantOffset.set(s,c),n.variantStroke.set(s,u),n.variantExtension.set(s,p)}};const L=new Float32Array(6),O=new Uint32Array(L.buffer),P=new Uint32Array(1);function qt(t){return L[0]=t.position0[0],L[1]=t.position0[1],L[2]=t.position0[2],L[3]=t.position1[0],L[4]=t.position1[1],L[5]=t.position1[2],P[0]=31*(31*(31*(31*(31*(166811+O[0])+O[1])+O[2])+O[3])+O[4])+O[5],P[0]}function Ut(t){const n=L;n[0]=B(t.position0[0]),n[1]=B(t.position0[1]),n[2]=B(t.position0[2]),n[3]=B(t.position1[0]),n[4]=B(t.position1[1]),n[5]=B(t.position1[2]),P[0]=5381;for(let s=0;s<O.length;s++)P[0]=31*P[0]+O[s];return P[0]}const rt=1e4;function B(t){return Math.round(t*rt)/rt}function Tt(t,n){return Math.abs(t)**n*Math.sign(t)}class K{constructor(){this._commonWriter=new ht}updateSettings(n){this._commonWriter.updateSettings(n)}allocate(n){return G.createBuffer(n)}write(n,s,a){this._commonWriter.write(n,s,a),Nt(M,a.faceNormal0,a.faceNormal1),ut(M,M);const{typedBuffer:c,typedBufferStride:u}=n.normalCompressed;X(c,s,M[0],M[1],M[2],u)}}K.Layout=G,K.glLayout=gt(G,1);class Y{constructor(){this._commonWriter=new ht}updateSettings(n){this._commonWriter.updateSettings(n)}allocate(n){return J.createBuffer(n)}write(n,s,a){this._commonWriter.write(n,s,a);{const{typedBuffer:c,typedBufferStride:u}=n.normalCompressed;X(c,s,a.faceNormal0[0],a.faceNormal0[1],a.faceNormal0[2],u)}{const{typedBuffer:c,typedBufferStride:u}=n.normal2Compressed;X(c,s,a.faceNormal1[0],a.faceNormal1[1],a.faceNormal1[2],u)}}}Y.Layout=J,Y.glLayout=gt(J,1);const M=A(),D=new At;function Wt(t){const n=mt(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return ct.updateSettings(t.writerSettings),it.updateSettings(t.writerSettings),bt(n,ct,it)}function mt(t,n,s,a){if(n){const d=at(s,a,t.count);return new Ct(s,a,d,t)}const c=xt(t.buffer,t.stride/4,{originalIndices:s}),u=at(c.indices,a,c.uniqueCount);return{faces:c.indices,facesLength:c.indices.length,neighbors:u,vertices:St.createView(c.buffer)}}class Ct{constructor(n,s,a,c){this.faces=n,this.facesLength=s,this.neighbors=a,this.vertices=c}}const ct=new K,it=new Y,Dt=dt().vec3f(q.POSITION0).vec3f(q.POSITION1),jt=dt().vec3f(q.POSITION0).vec3f(q.POSITION1).u16(q.COMPONENTINDEX),zt=Object.freeze(Object.defineProperty({__proto__:null,extract:Wt,extractComponentsEdgeLocationsLayout:jt,extractEdgeInformation:mt,extractEdgeLocationsLayout:Dt},Symbol.toStringTag,{value:"Module"}));export{Y as N,Dt as d,zt as e,Wt as f,jt as m,bt as p,mt as u,K as w};
