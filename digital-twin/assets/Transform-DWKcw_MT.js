import{nz as y,nA as A,nB as M,ju as a,aA as O,b3 as z,jx as C,nC as _,ci as H,S as j,nD as F,aU as G,aV as L,aG as B,al as R,n as P,cv as S,cw as W,dw as b,hX as T,bJ as q,d7 as I,hN as D,e as d,y as v,a as U}from"./index-BR4NftXd.js";import{a as Z}from"./RenderTexture-BDwAOQ7g.js";function k(e,n,t,i){if(n==null||i==null)return!1;const r=y(n,A),s=y(i,M);if(r===s&&r!==a.UNKNOWN||O(n,i))return t[0]=1,t[1]=1,t[2]=1,!0;if(r===a.SPHERICAL_ECEF){const u=z(e),c=u/Math.sqrt(e[0]*e[0]+e[1]*e[1]),h=u/C.radius;if(s===a.WEB_MERCATOR)return t[0]=c*h,t[1]=c*h,t[2]=1,!0;if(s===a.WGS84||s===a.CGCS2000){const o=_;return t[0]=o*c*h,t[1]=o*h,t[2]=1,!0}}else if(r===a.PLATE_CARREE){if(s===a.WGS84||s===a.CGCS2000)return t[0]=_,t[1]=_,t[2]=1,!0;if(s===a.WEB_MERCATOR){const u=e[1]/C.radius;return t[0]=1,t[1]=1/Math.cos(u),t[2]=1,!0}}return!1}let p=class extends H.EventedMixin(j){constructor(e){super(e),this._tmpEvent=new F,this._renderCoordsHelper=e.view.renderCoordsHelper,this._renderSR=this._renderCoordsHelper.spatialReference,this._layerElevationSource=e.layerElevationSource}initialize(){this._intersector=G(this.view.state.viewingMode),this._intersector.options.store=L.MIN,this._intersector.options.normalRequired=!1,this._tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"}get spatialReference(){var e,n;return(n=(e=this.view)==null?void 0:e.elevationProvider)==null?void 0:n.spatialReference}getElevation(e,n,t,i){const r=this._renderCoordsHelper,s=B(l,e,n,t);if(!r.toRenderCoords(s,i,s))return P.getLogger(this).error("could not project point to compute elevation"),null;const{layerElevationSource:u,_intersector:c,intersectionHandler:h}=this,o=u.fullExtent,f=o!=null&&Number.isFinite(o.xmin)&&Number.isFinite(o.xmax)&&Number.isFinite(o.ymin)&&Number.isFinite(o.ymax)&&Number.isFinite(o.zmin)&&Number.isFinite(o.zmax)?new S(o.zmin,o.zmax):u.elevationRange;if(f==null)return null;const x=u.elevationOffset,N=f.elevationRangeMin+x,w=f.elevationRangeMax+x,E=r.setAltitude(J,w,s),g=r.setAltitude(K,N,s);return c.reset(E,g,null),h.intersect(c,null,E,g,null,!0),c.results.min.getIntersectionPoint(s)?r.getAltitude(s):null}getSphereElevationBounds(e,n){return Z(e,n,$,this._renderSR),this._layerElevationSource.getElevationRange($)}getRootElevationBounds(){const e=this.layerElevationSource.fullExtent;return e!=null&&e.hasZ?new S(e.zmin,e.zmax):null}objectsChanged(e){this.spatialReference&&(this._computeLayerExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}objectChanged(e){this.spatialReference&&(this._computeObjectExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}_computeObjectExtent(e,n){b(n),this._expandExtent(e,n)}_computeLayerExtent(e,n){b(n);for(const t of e)this._expandExtent(t,n)}_expandExtent(e,n){const t=this.spatialReference;if(t==null||e==null)return;T(m,e.quaternion),m[12]=e.center[0],m[13]=e.center[1],m[14]=e.center[2];const i=e.halfSize;for(let r=0;r<8;++r)l[0]=1&r?i[0]:-i[0],l[1]=2&r?i[1]:-i[1],l[2]=4&r?i[2]:-i[2],I(l,l,m),this._renderCoordsHelper.fromRenderCoords(l,l,t),D(n,l,n)}};d([v({constructOnly:!0})],p.prototype,"layerElevationSource",void 0),d([v({constructOnly:!0})],p.prototype,"intersectionHandler",void 0),d([v({constructOnly:!0})],p.prototype,"view",void 0),d([v()],p.prototype,"spatialReference",null),p=d([U("esri.views.3d.layers.i3s.LayerElevationProvider")],p);const m=q(),$=W(0,0,0,0),l=R(),J=R(),K=R();class Q{constructor(n,t,i,r){this.toMapSpace=n,this.transform=t,this.obb=i,this.geometry=r}}class Y{constructor(n,t){this.position=n,this.rotationScale=t,this.origin=void 0}}export{k as f,Y as i,Q as t,p as x};
