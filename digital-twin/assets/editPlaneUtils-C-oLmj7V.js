import{e as a,y as l,a as T,S as Gt,V as xt,h as Qt,w as $t,j as it,di as te,pb as ee,vg as ie,i4 as oe,i5 as ne,vh as se,vi as re,j3 as ae,vj as le,c0 as ce,af as Et,ky as pe,ag as de,vk as St,cu as ue,cO as he,kx as ye,fV as zt,lO as ge,dr as yt,iJ as me,as as gt,vl as fe,e1 as dt,sE as ve,mo as mt,aE as we,mG as xe,r_ as $e,qs as W,gH as S,pn as _e,vm as Oe,at as ke,po as be,vn as Re,vo as Me,mN as Ue,pl as Te,ci as Ie,kz as At,hM as Pe,k as Ve,f as Ce,vp as _t,u as lt,E as Ge,Z as X,A as Ee,o$ as Se,iE as z,aR as j,v9 as Ot,vq as ze,vr as Ae,ah as Fe,iF as ct,iD as kt,vs as ot,bc as He,aF as Ne,vt as bt,bH as Rt,aG as Mt,ve as Ut}from"./index-KaRZ5U2_.js";import{r as L,h as Le,w as Ze}from"./Tooltip-7vodpFfC.js";import{a as je}from"./dehydratedFeatureComparison-DJjAvtcO.js";import{w as g,Z as De,b as Ye}from"./surfaceCoordinateSystems-B5IBO-Hi.js";import{h as nt,x as qe,F as We,b as Ft,I as Ht,M as Be,U as Je,R as Xe,u as Nt,B as Ke,G as Qe}from"./automaticAreaMeasurementUtils-DyzMkwjI.js";import{c as ti,m as st}from"./automaticLengthMeasurementUtils-BbkqFsLu.js";import{n as ei}from"./InteractiveToolBase-HIWPztoj.js";import{t as ii,c as oi,d as ni,f as si}from"./EditGeometryOperations-B-RmZWmj.js";var $;(function(t){t[t.NeverApplied=0]="NeverApplied",t[t.Applied=1]="Applied",t[t.Undone=2]="Undone"})($||($={}));var U;(function(t){t.UndoRedoUpdating="UndoRedoUpdating",t.UndoInvalidError="UndoInvalidError",t.RedoInvalidError="RedoInvalidError",t.ApplyInvalidError="ApplyInvalidError"})(U||(U={}));const rt={[U.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[U.UndoInvalidError]:"There are no items to Undo",[U.RedoInvalidError]:"There are no items to Redo",[U.ApplyInvalidError]:"Cannot apply an item that is already applied"};let D=class extends Error{constructor(){super(rt[U.UndoRedoUpdating]),this.type="undo-redo-updating-error"}},ut=class extends Error{constructor(){super(rt[U.UndoInvalidError]),this.type="undo-redo-undo-error"}},ri=class extends Error{constructor(){super(rt[U.RedoInvalidError]),this.type="undo-redo-redo-error"}},ai=class extends Error{constructor(){super(rt[U.ApplyInvalidError]),this.type="undo-redo-apply-error"}};var P;(function(t){t[t.Apply=0]="Apply",t[t.Undo=1]="Undo",t[t.Redo=2]="Redo"})(P||(P={}));let K=class extends Gt{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=$.NeverApplied}get canUndo(){return this.status===$.Applied}get canRedo(){return this.status===$.Undone}async executeUndoRedoOperation(e){switch(e){case P.Apply:if(this.status!==$.NeverApplied)throw new ai;return await this.apply(),void(this.status=$.Applied);case P.Undo:if(this.status!==$.Applied)throw new ut;return await this.undo(),void(this.status=$.Undone);case P.Redo:if(this.status!==$.Undone)throw new ut;return await this.redo(),void(this.status=$.Applied)}}};a([l()],K.prototype,"name",void 0),a([l()],K.prototype,"tag",void 0),K=a([T("esri.undoredo.UndoableOperation")],K);let M=class extends Gt{constructor(){super(...arguments),this._stack=new xt,this._stackPosition=-1,this._updatingHandles=new Qt}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(t=>t.destroy())}_drainStack(){this._stack.drain(t=>t.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new ut;if(this.updating)throw new D;const t=this._stack.getItemAt(this._stackPosition);await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(P.Undo),--this._stackPosition,t.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new ri;if(this.updating)throw new D;const t=this._stack.getItemAt(this._stackPosition+1);await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(P.Redo),++this._stackPosition})())}peekUndo(){return this.canUndo?this._stack.getItemAt(this._stackPosition):null}peekRedo(){return this.canRedo?this._stack.getItemAt(this._stackPosition+1):null}async inject(t){if(this.updating)throw new D;await this._updatingHandles.addPromise((async()=>{t.status===$.NeverApplied&&await t.executeUndoRedoOperation(P.Apply),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(e=>e.destroy()),this._stackPosition=-1)})())}async add(t){if(this.updating)throw new D;await this._updatingHandles.addPromise((async()=>{t.status===$.NeverApplied&&await t.executeUndoRedoOperation(P.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(t,e=!1){if(this.updating&&!e)return;await $t(()=>!this.updating);const i=new xt;for(let o=0;o<this._stack.length;o++){const n=this._stack.getItemAt(o);n.tag===t?(n.destroy(),o===this._stackPosition&&(this._stackPosition=i.length-1)):i.push(n)}this._stack=i,this._stackPosition>i.length-1&&(this._stackPosition=i.length-1)}async clear(t=!1){if(this.updating&&!t)throw new D;await $t(()=>!this.updating),this._drainStack()}};a([l()],M.prototype,"_stack",void 0),a([l()],M.prototype,"_stackPosition",void 0),a([l()],M.prototype,"updating",null),a([l({readOnly:!0})],M.prototype,"canUndo",null),a([l({readOnly:!0})],M.prototype,"hasUndo",null),a([l({readOnly:!0})],M.prototype,"canRedo",null),a([l({readOnly:!0})],M.prototype,"hasRedo",null),M=a([T("esri.UndoRedo")],M);class li{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}}var ht;let C=ht=class extends it{constructor(...t){super(...t),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}normalizeCtorArgs(t,e){let i;if(t!=null&&t.center)i=t;else{if(t!=null&&t.rings)return super.normalizeCtorArgs(t,e);i={center:t}}return{...super.normalizeCtorArgs(),...i,...e}}initialize(){const t=this.center,e=this.numberOfPoints;if(this.hasZ=(t==null?void 0:t.hasZ)??!1,this.rings.length!==0||!t)return;const i=te(this.radius,this.radiusUnit,"meters"),o=t.spatialReference;let n,s="geographic";if(o.isWebMercator?s="webMercator":((o.wkid&&ee[o.wkid])!=null||(o.wkt2||o.wkt)&&ie(o.wkt2||o.wkt))&&(s="projected"),this.geodesic){let r;switch(s){case"webMercator":r=oe(t);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":r=t}n=this._createGeodesicCircle(r,i,e),s==="webMercator"&&(n=ne(n))}else{let r;s==="webMercator"||s==="projected"?r=i/se(t.spatialReference):s==="geographic"&&(r=re(i,"meters",ae(t.spatialReference).radius)),n=this._createPlanarCircle(t,r,e)}this.spatialReference=n.spatialReference,this.addRing(n.rings[0])}clone(){const{center:t,numberOfPoints:e,radius:i,radiusUnit:o,geodesic:n}=this;return new ht({center:t==null?void 0:t.clone(),numberOfPoints:e,radius:i,radiusUnit:o,geodesic:n})}_createGeodesicCircle(t,e,i){let o=0;const n=[];for(;o<360;){const s=[0,0],r=[t.x,t.y];le(s,r,o,e,ce.WGS84),this.hasZ&&s.push(t.z),n.push(s),o+=360/i}return n.push(n[0]),new it(n)}_createPlanarCircle(t,e,i){const o=[],n=2*Math.PI/i;for(let s=0;s<i;++s){const r=n*s,p=[t.x+Math.cos(-r)*e,t.y+Math.sin(-r)*e];this.hasZ&&p.push(t.z),o.push(p)}return o.push(o[0]),new it({spatialReference:t.spatialReference,rings:[o]})}};a([l({type:Et})],C.prototype,"center",void 0),a([l()],C.prototype,"geodesic",void 0),a([l()],C.prototype,"numberOfPoints",void 0),a([l()],C.prototype,"radius",void 0),a([l()],C.prototype,"radiusUnit",void 0),C=ht=a([T("esri.geometry.Circle")],C);const ci=C;function E(t,e){const i=new Et({x:t[0],y:t[1],spatialReference:e});return t.length>2&&(i.z=t[2]),i}function pi(t,e){return new pe({points:t,spatialReference:e})}function Tt(t,e,i){const o=new de({paths:t,spatialReference:e});return i&&St(o),o}function B(t,e,i,o=!0){const n=ue(t);n.forEach(r=>{const p=r[0],c=r[r.length-1];he(p,c)&&r.length!==1||r.push(r[0])});let s=new it({rings:n,spatialReference:e});return s.rings.forEach(r=>{ye(r)||r.reverse()}),i&&St(s),o&&s.isSelfIntersecting&&zt(e)&&(s=ge(s)),s}function It(t,e,i){const o=e.mapToLocalMultiple(t),n=[],s={x:o[0].x,y:o[0].y},r={x:o[1].x,y:o[1].y},p=Math.round(r.x-s.x),c=Math.round(r.y-s.y),u=Math.max(Math.abs(p),Math.abs(c));if(i){const h={x:s.x+u,y:s.y+u},m={x:s.x-u,y:s.y-u};n.push(g(h.x,m.y),g(m.x,m.y),g(m.x,h.y),g(h.x,h.y))}else{const h={x:p>0?s.x+u:s.x-u,y:c>0?s.y+u:s.y-u};n.push(g(s.x,s.y),g(h.x,s.y),g(h.x,h.y),g(s.x,h.y))}return Lt(B([n.map(h=>e.localToMap(h)).filter(yt)],e.spatialReference,e.doUnnormalization,!0),n,e)}function di(t,e,i){let o=e.mapToLocalMultiple(t);if(o.length===1){const c=o[0];o=[g(c.x-48,c.y+48),g(c.x+48,c.y-48),g(c.x+48,c.y-48),g(c.x-48,c.y+48)]}const n=[],s={x:o[0].x,y:o[0].y},r={x:o[1].x,y:o[1].y};if(i){const p=Math.round(r.x-s.x),c=Math.round(r.y-s.y);n.push(g(s.x-p,s.y-c),g(r.x,s.y-c),g(r.x,r.y),g(s.x-p,r.y))}else n.push(g(s.x,s.y),g(r.x,s.y),g(r.x,r.y),g(s.x,r.y));return Lt(B([n.map(p=>e.localToMap(p)).filter(yt)],e.spatialReference,e.doUnnormalization,!0),n,e)}function Lt(t,e,i){const o=Q(e[3],e[2],i),n=Q(e[1],e[2],i),s=Q(e[0],e[1],i),r=Q(e[0],e[3],i);return{geometry:t,midpoints:o!=null&&n!=null&&s!=null&&r!=null?{top:o,right:n,bottom:s,left:r}:null}}function Q(t,e,i){A[0]=t.x,A[1]=t.y,A[2]=0,F[0]=e.x,F[1]=e.y,F[2]=0,me(A,A,F,.5),tt.x=A[0],tt.y=F[1],tt.z=F[2];const o=i.localToMap(tt);return o!=null?E(o,i.spatialReference):null}const tt=g(0,0,0),A=gt(),F=gt();function Pt(t,e,i,o){const n=e.mapToLocalMultiple(t);let s=null,r=null;if(i)s=n[0],r=n[1];else{const d=n[0],v=n[1],O=Math.round(v.x-d.x),x=Math.round(v.y-d.y),f=Math.max(Math.abs(O),Math.abs(x));s=g(O>0?d.x+f/2:d.x-f/2,x>0?d.y+f/2:d.y-f/2),r=g(Math.abs(O)>Math.abs(x)?s.x-f/2:s.x,Math.abs(O)>Math.abs(x)?s.y:s.y-f/2)}const p=e.localToMap(s),c=e.localToMap(r);if(p==null||c==null)return null;e.doUnnormalization&&fe([[p,c]],e.spatialReference);const u=E(p,e.spatialReference),h=E(c,e.spatialReference),m=dt(e.spatialReference);let w=0;if(zt(e.spatialReference))w=m*ve(u,h,null);else{const d=s.x-r.x,v=s.y-r.y;w=m*Math.sqrt(d*d+v*v)*1}const k=new ci({center:u,radius:w,radiusUnit:"meters",spatialReference:e.spatialReference});return{geometry:B(k.rings,k.spatialReference,!1),center:u,edge:h}}function ui(t,e,i){const o=e.mapToLocalMultiple(t),n=o[0],s=o[1],r=Math.round(s.x-n.x),p=Math.round(s.y-n.y),c=g(i?n.x:n.x+r/2,i?n.y:n.y+p/2),u=i?r:r/2,h=i?p:p/2,m=60,w=[],k=2*Math.PI/m;function d(R){const Xt=Math.cos(R),Kt=Math.sin(R);return g(u*Xt+c.x,h*Kt+c.y)}for(let R=0;R<m;R++)w.push(d(R*k));w.push(w[0]);const{spatialReference:v,doUnnormalization:O}=e,x=B([w.map(R=>e.localToMap(R)).filter(yt)],v,O,!1),f=e.localToMap(d(Math.PI/2)),b=e.localToMap(d(0)),V=e.localToMap(d(-Math.PI/2)),J=e.localToMap(d(Math.PI));return{geometry:x,midpoints:f!=null&&b!=null&&V!=null&&J!=null?{top:E(f,v),right:E(b,v),bottom:E(V,v),left:E(J,v)}:null}}function ft(t,e){switch(t){case"point":case"multipoint":return hi();case"polyline":return yi(e);case"polygon":return gi(e);default:return}}function hi(t){return"point"}function yi(t){return(t!=null&&t.type==="polyline"&&t.paths.length?t.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex"}function gi(t){const e=t!=null&&t.type==="polygon"&&t.rings.length?t.rings[0].length:0;return e<3?"polylineZeroVertices":e<4?"polygonOneVertex":"polygonTwoVertices"}function mi(t,e){const i=t==null?void 0:t.geometry;if(!t||(i==null?void 0:i.type)!=="mesh"||!e)return;const{renderCoordsHelper:o,elevationProvider:n}=e,{camera:s}=e.state,{extent:r}=i,{center:p,spatialReference:c}=r,u=dt(c),h=mt(c),m=dt(o.spatialReference),w=r.width*u,k=r.height*h,d=(r.zmax??0)*h,v=d-(r.zmin??0)*h,O=Math.max(w,k,v)/m,{x,y:f}=p,b=p.z??0;we(et,x,f,b),o.toRenderCoords(et,c,et);const V=O/s.computeScreenPixelSizeAt(et);if(V>s.width*vi)return"meshTooClose";if(V<fi)return"meshTooFar";const J=xe(t),{absoluteZ:R}=$e(x,f,d,c,e,J);return R<(n.getElevation(x,f,b,c,"ground")??0)*h+v*wi?"meshUnderground":"mesh"}const fi=20,vi=1,wi=.1,et=gt();let I=class extends L{constructor(e){super(e),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=W}get allFields(){return[]}};a([l()],I.prototype,"type",void 0),a([l()],I.prototype,"radius",void 0),a([l()],I.prototype,"xSize",void 0),a([l()],I.prototype,"ySize",void 0),a([l()],I.prototype,"area",void 0),a([l()],I.prototype,"allFields",null),I=a([T("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],I);let Y=class extends nt(L){constructor(e){super(e),this.type="draw-mesh",this.orientation=qe({lockable:!1}),this.scale=We({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};a([l()],Y.prototype,"helpMessage",void 0),a([l()],Y.prototype,"allFields",null),Y=a([T("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],Y);let q=class extends nt(L){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};a([l()],q.prototype,"helpMessage",void 0),a([l()],q.prototype,"allFields",null),q=a([T("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],q);let H=class extends nt(L){constructor(e){super(e),this.type="draw-polygon",this.direction=Ft(),this.distance=Ht({title:i=>i.messages.sketch.distance}),this.area=Be(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};a([l()],H.prototype,"xyMode",void 0),a([l()],H.prototype,"helpMessage",void 0),a([l()],H.prototype,"allFields",null),H=a([T("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],H);let N=class extends nt(L){constructor(t){super(t),this.type="draw-polyline",this.direction=Ft(),this.distance=Ht({title:e=>e.messages.sketch.distance}),this.totalLength=Je(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};a([l()],N.prototype,"helpMessage",void 0),a([l()],N.prototype,"xyMode",void 0),a([l()],N.prototype,"allFields",null),N=a([T("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],N);let G=class extends L{constructor(t){super(t),this.type="draw-rectangle",this.xSize=S,this.ySize=S,this.area=W}get allFields(){return[]}};a([l()],G.prototype,"type",void 0),a([l()],G.prototype,"xSize",void 0),a([l()],G.prototype,"ySize",void 0),a([l()],G.prototype,"area",void 0),a([l()],G.prototype,"allFields",null),G=a([T("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],G);function xi(t,e){return{point:new q({sketchOptions:e,viewType:t}),polyline:new N({sketchOptions:e,viewType:t}),polygon:new H({sketchOptions:e,viewType:t}),mesh:new Y({sketchOptions:e,viewType:t}),rectangle:new G({sketchOptions:e}),circle:new I({sketchOptions:e})}}function Vt(t){const{directionOptions:e,geometryType:i,sketchOptions:o,tooltipInfos:n}=t,s=p=>{const c=at(t).mode,u=n[p].elevation;c==="relative-to-ground"||c==="relative-to-scene"||c==="on-the-ground"?u.lock(wt(t)):u.unlock()},r=p=>{if(e){const c=n[p].direction;c.committed=e.angle,c.unlockOnVertexPlacement=!1,o.values.directionMode=e.mode}};switch(i){case"polygon":case"polyline":s(i),r(i);break;case"point":case"mesh":s(i)}}function $i(t,e){const{drawOperation:i,view:o}=e,n=vt(e),s=at(e);if(o.type==="2d"||!t||s.mode!=="absolute-height"||(i==null?void 0:i.numCommittedVertices)!==1||!n||n.type!=="draw-polyline"&&n.type!=="draw-polygon"||n.elevation.locked)return;const[r,p,c]=t,u=Ci(r,p,c,s,e);u!=null&&n.elevation.lock(u)}function Ct(t){var e;(e=vt(t))==null||e.allFields.forEach(i=>{i.unlockOnVertexPlacement&&i.unlock()})}function vt({geometryType:t,graphic:e,tooltipInfos:i}){var o;return t==="multipoint"||((o=e==null?void 0:e.geometry)==null?void 0:o.type)!==_i[t]?null:i[t]}const _i={point:"point",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon"};function Oi(t,e){switch(t==null?void 0:t.type){case"draw-point":ki(t,e);break;case"draw-polyline":Ri(t,e);break;case"draw-polygon":Mi(t,e);break;case"draw-rectangle":Ti(t,e);break;case"draw-circle":Ii(t,e);break;case"draw-mesh":bi(t,e)}}function ki(t,e){var o;const i=(o=e.graphic)==null?void 0:o.geometry;(i==null?void 0:i.type)==="point"&&(Zt(t,i,e),t.helpMessage=ft("point",i))}function bi(t,e){const{graphic:i,view:o}=e,n=i==null?void 0:i.geometry;o.type==="3d"&&(n==null?void 0:n.type)==="mesh"&&(Zt(t,n.origin,e),Xe(t,n),t.helpMessage=mi(i,o))}function Zt(t,e,i){const{drawOperation:o,view:n,sketchOptions:s}=i,{cursorVertex:r}=o;if(t.sketchOptions=s,t.viewType=n.type,t.setLocationFromPoint(e,Z(i)),Dt(t.elevation,i),!r)return void(o.constraints=void 0);const p=r;o.constraints={context:Bt(p,i),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:null,direction:null}}function Ri(t,e){const{createOperationGeometry:i,drawOperation:o}=e,n=i!=null?i.full:null;(n==null?void 0:n.type)==="polyline"&&(jt(t,e),t.totalLength.actual=o.lastVertex?ti(n)??S:null,t.helpMessage=ft("polyline",n))}function Mi(t,e){const{createOperationGeometry:i,drawOperation:o}=e,n=i!=null?i.full:null;(n==null?void 0:n.type)==="polygon"&&(jt(t,e),t.area.actual=o.lastVertex?Nt(n)??W:null,t.helpMessage=ft("polygon",n))}function jt(t,e){const{drawOperation:i,sketchOptions:o,view:n}=e,{cursorVertex:s,lastVertex:r,secondToLastVertex:p}=i,c=o.values.effectiveDirectionMode;t.sketchOptions=o,t.viewType=n.type;const u=r&&s?st(r,s)??S:null;if(t.distance.actual=u,t.distance.readOnly=r==null,t.direction.actual=null,t.direction.readOnly=!0,r&&s&&(c==="absolute"||p)){const w=Re(p,r,s,c);t.direction.actual=w??Me,t.direction.readOnly=!1}t.setLocationFromPoint(s,Z(e)),Dt(t.elevation,e);const h=Ui(r,e);t.xyMode=h,t.direction.visible=h==="direction-distance",t.distance.visible=h==="direction-distance",t.effectiveX.visible=h==="coordinates",t.effectiveY.visible=h==="coordinates";const m=s??r;i.constraints=m?{context:Bt(m,e),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:t.distance.committed,direction:t.direction.committed}:void 0}function Ui(t,{sketchOptions:e}){const i=e.tooltips.xyMode;return i==="auto"?t?"direction-distance":"coordinates":i}function Ti(t,e){t.sketchOptions=e.sketchOptions,t.xSize=qt(e),t.ySize=Wt(e),t.area=Yt(e)}function Ii(t,e){const{forceUniformSize:i,sketchOptions:o}=e;t.sketchOptions=o,t.radius=i?Pi(e):null,t.xSize=i?null:qt(e),t.ySize=i?null:Wt(e),t.area=Yt(e)}function Dt(t,e){const{drawOperation:i}=e,o=(i==null?void 0:i.cursorVertex)??(i==null?void 0:i.lastVertex);t.actual=Ue(o)??wt(e),t.visible=i.hasZ,t.readOnly=!1,t.showAsZ=!0}function Yt(t){var i;const e=(i=t.createOperationGeometry)==null?void 0:i.full;return(e==null?void 0:e.type)!=="polygon"?W:Nt(e)??W}function qt(t){var i,o;const e=(o=(i=t.createOperationGeometry)==null?void 0:i.rectangle)==null?void 0:o.midpoints;return(e!=null?st(e.left,e.right):null)??S}function Wt(t){var i,o;const e=(o=(i=t.createOperationGeometry)==null?void 0:i.rectangle)==null?void 0:o.midpoints;return(e!=null?st(e.top,e.bottom):null)??S}function Pi({createOperationGeometry:t}){var e;return(((e=t==null?void 0:t.circle)==null?void 0:e.center)!=null&&t.circle.edge!=null?st(t.circle.center,t.circle.edge):null)??S}function Vi(t){const{geometryType:e,tooltipInfos:i}=t;switch(e){case"point":case"mesh":case"polyline":case"polygon":{const o=i[e].elevation.committed;return o?Te(o,"meters")/mt(Z(t)):void 0}default:return}}function Ci(t,e,i,o,n){const{view:s,drawOperation:r}=n;if(s.type!=="3d"||!r)return;i??(i=0);const p=Z(n),c=at(n),u=_e(s,t,e,i,p,c,o);return Oe(u,p)??wt(n)}function at(t){return t.drawOperation.elevationInfo??ke}function Z(t){return t.drawOperation.coordinateHelper.spatialReference}function wt(t){const e=mt(Z(t));return be(t.defaultZ*e,"meters")}function Bt(t,e){return De(t,e.view,Z(e),at(e),e.drawOperation.coordinateHelper.hasZ(),e.sketchOptions.values.effectiveDirectionMode)}let y=class extends Ie.EventedMixin(ei){constructor(e){super(e),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new At}initialize(){const{view:e}=this;this.internalGraphicsLayer=new Pe({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const i=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=xi(e.type,this.sketchOptions);const o=this.tooltip=new Le({view:e});Vt(this._tooltipsContext),this._coordinateFormatterLoadTask=Ve(()=>Ze()),this.addHandles([i.on("vertex-add",n=>this.onVertexAdd(n)),i.on("vertex-remove",n=>this.onVertexRemove(n)),i.on("vertex-update",n=>this.onVertexUpdate(n)),i.on("cursor-update",n=>this.onCursorUpdate(n)),i.on("cursor-remove",()=>this._updateGraphic()),i.on("complete",n=>this.onComplete(n)),this._coordinateFormatterLoadTask,o.on("paste",n=>Ke(n,this.activeTooltipInfo)),Ce(()=>this.cursor,n=>{i.cursor=n},Ee),_t(()=>{const{activeTooltipInfo:n,sketchOptions:s}=this;Oi(n,this._tooltipsContext),o.info=s.tooltips.effectiveEnabled?n:null}),_t(()=>{i.constraintZ=Vi(this._tooltipsContext)})]),this.finishToolCreation()}destroy(){this.drawOperation=lt(this.drawOperation),this.tooltip=lt(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=lt(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(e){this._set("cursor",e)}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),this._graphic!=null&&(this._graphic.symbol=e)}set mode(e){const i=this.drawOperation;i&&(i.drawingMode=e),this._set("mode",e)}get updating(){var e;return((e=this.drawOperation)==null?void 0:e.updating)??!1}get undoRedo(){const{view:{type:e,map:i}}=this;return e==="2d"&&i&&"undoRedo"in i&&i.undoRedo instanceof M?i.undoRedo:null}set undoRedo(e){this._override("undoRedo",e)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.destroyed||Qe(e,this.tooltip)||this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&Vt(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(_.outline),this.removeHandles(_.regularVertices),this.removeHandles(_.activeVertex),this.removeHandles(_.activeEdge),this.removeHandles(pt)}_createOrUpdateGraphic(e){if(this._graphic!=null)return this.updateGraphicGeometry(e),this._graphic;const i=new Ge({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=i,this.updateGraphicGeometry(e),this.internalGraphicsLayer.add(i),this.addHandles(this.initializeGraphic(i)),this.notifyChange("graphic"),this.addHandles(X(()=>{this.internalGraphicsLayer.remove(i),this._graphic===i&&(this._graphic=null)}),pt),i}updateGraphicGeometry(e){this._graphic.geometry=e}_getCreateOperationGeometry(e={operationComplete:!1}){var O,x;if(this.drawOperation==null)return;const{coordinateHelper:i,view:o,visualizationCursorVertex:n,lastVertex:s,committedVertices:r,geometryIncludingUncommittedVertices:p,numCommittedVertices:c}=this.drawOperation;if(!(c>0||n!=null))return;const u=e.operationComplete?r:p,h=u.length,m=n!=null?i.pointToArray(n):null,w=this._drawSpatialReference,k=o.type==="3d"&&o.viewingMode==="global",d=new li;d.committedVertices=r,d.cursorVertex=m;const{geometryType:v}=this;switch(v){case"point":case"mesh":d.full=i.arrayToPoint(u[0]);break;case"multipoint":d.full=h>0?pi(u,w):null;break;case"polyline":case"polygon":h>0&&(d.full=v==="polygon"?B([u],w,k,!0):Tt([u],w,k),d.cursorEdge=m!=null&&s&&!je(n,s)?Tt([[m,i.pointToArray(s)]],w,k):null,d.outline=h>1?d.full:null);break;case"circle":case"rectangle":{if(d.committedVertices=d.cursorVertex=null,!h)break;const f=Ye(o,u[0]),b=u[0],V=f.makeMapPoint(b[0]+Gi*o.resolution,b[1]);v==="circle"?h===1&&e.operationComplete?d.circle=Pt([b,V],f,!0):h===2&&(this.forceUniformSize?d.circle=Pt(u,f,this.centered):d.rectangle=ui(u,f,this.centered)):h===1&&e.operationComplete?d.rectangle=It([b,V],f,!0):h===2&&(d.rectangle=this.forceUniformSize?It(u,f,this.centered):di(u,f,this.centered)),d.full=d.circle!=null?d.circle.geometry:(O=d.rectangle)==null?void 0:O.geometry,d.outline=((x=d.full)==null?void 0:x.type)==="polygon"?d.full:null;break}default:return null}return d}initializeGraphic(e){return X()}onComplete(e){if(!this.drawOperation)return;this._updateGraphic();let i=null;if(this.drawOperation.isCompleted){const o=this._getCreateOperationGeometry({operationComplete:!0});o!=null&&(i=this._createOrUpdateGraphic(o.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:i,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){const{drawOperation:e}=this;e&&(e.isCompleted||e.cancel())}onOutlineChanged(e){return X()}onCursorEdgeChanged(e){return X()}onVertexAdd(e){var i;Ct(this._tooltipsContext),this._updateGraphic(),$i((i=e.vertices.at(0))==null?void 0:i.coordinates,this._tooltipsContext),this.emit("vertex-add",e)}onVertexRemove(e){Ct(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();this._createOperationGeometry=e,e!=null?(e.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(e.cursorEdge),_.activeEdge):this.removeHandles(_.activeEdge),e.outline!=null?this.addHandles(this.onOutlineChanged(e.outline),_.outline):this.removeHandles(_.outline),e.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(e.committedVertices),_.regularVertices):this.removeHandles(_.regularVertices),e.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(e.cursorVertex),_.activeVertex):this.removeHandles(_.activeVertex),e.full!=null?this._createOrUpdateGraphic(e.full):this.removeHandles(pt)):this._destroyAllVisualizations()}get activeTooltipInfo(){var e;return(e=this._coordinateFormatterLoadTask)!=null&&e.finished?vt(this._tooltipsContext):null}};a([l()],y.prototype,"_coordinateFormatterLoadTask",void 0),a([l()],y.prototype,"_createOperationGeometry",void 0),a([l()],y.prototype,"_tooltipsContext",null),a([l({value:!0})],y.prototype,"centered",null),a([l()],y.prototype,"cursor",null),a([l({nonNullable:!0})],y.prototype,"defaultZ",void 0),a([l({constructOnly:!0})],y.prototype,"directionOptions",void 0),a([l()],y.prototype,"drawOperation",void 0),a([l({value:!0})],y.prototype,"enabled",null),a([l({value:!0})],y.prototype,"forceUniformSize",null),a([l({constructOnly:!0})],y.prototype,"geometryType",void 0),a([l()],y.prototype,"graphic",null),a([l({constructOnly:!0})],y.prototype,"graphicProperties",void 0),a([l()],y.prototype,"graphicSymbol",null),a([l({constructOnly:!0})],y.prototype,"hasZ",void 0),a([l({constructOnly:!0})],y.prototype,"geometryToPlace",void 0),a([l()],y.prototype,"mode",null),a([l()],y.prototype,"snappingManager",void 0),a([l()],y.prototype,"snapToScene",void 0),a([l()],y.prototype,"tooltip",void 0),a([l()],y.prototype,"tooltipInfos",void 0),a([l({constructOnly:!0,type:At})],y.prototype,"sketchOptions",void 0),a([l()],y.prototype,"updating",null),a([l({constructOnly:!0,nonNullable:!0})],y.prototype,"view",void 0),a([l({constructOnly:!0})],y.prototype,"undoRedo",null),a([l()],y.prototype,"activeTooltipInfo",null),y=a([T("esri.views.draw.DrawGraphicTool")],y);const pt=Symbol("create-operation-graphic"),_={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function eo(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const Gi=48;function io(t,e){return Jt(t,e,!1)}function oo(t,e){return Jt(t,e,!0)}function Jt(t,e,i){if(t instanceof ii){if(t.operation instanceof oi)return Ei(t.operation,e,i),!0;if(t.operation instanceof ni)return Si(t.operation,e,i),!0;if(t.operation instanceof si)return zi(t.operation,e,i),!0}return!1}function Ei(t,e,i=!1){const o=i?-1:1,n=He(o*t.dx,o*t.dy,o*t.dz);Ne(e.origin,e.origin,n),ot(e)}function Si(t,e,i=!1){const o=i?-t.angle:t.angle;bt(e.basis1,e.basis1,Rt,o),bt(e.basis2,e.basis2,Rt,o),ot(e)}function zi(t,e,i=!1){const o=i?1/t.factor1:t.factor1,n=i?1/t.factor2:t.factor2;Mt(e.basis1,e.basis1,o),Mt(e.basis2,e.basis2,n),Ut(e.origin,e.origin,t.origin,t.axis1,o),Ut(e.origin,e.origin,t.origin,t.axis2,n),ot(e)}function no(t,e,i,o){o||(o=Se());const n=z(j.get(),t[1],-t[0]),s=z(j.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=z(j.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),p=j.get();e.components.forEach(h=>h.vertices.forEach(({pos:m})=>{z(p,Ot(t,m),Ot(n,m)),ze(s,s,p),Ae(r,r,p)}));const c=1e-6,u=z(j.get(),r[0]-s[0]<c?i/2:0,r[1]-s[1]<c?i/2:0);return Fe(s,s,u),ct(r,r,u),kt(o.basis1,t,(r[0]-s[0])/2),kt(o.basis2,n,(r[1]-s[1])/2),z(o.origin,s[0]*t[0]+s[1]*n[0],s[0]*t[1]+s[1]*n[1]),ct(o.origin,o.origin,o.basis1),ct(o.origin,o.origin,o.basis2),ot(o),o}export{y as E,eo as F,no as a,oo as b,io as d};
