const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ElevationLayer-CJxiYMuw.js","assets/ArcGISCachedService-DLyJpX_x.js","assets/TileInfoTilemapCache-omGAis0l.js","assets/TilemapCache-DTRuHBpi.js","assets/LercDecoder-CixZDznO.js","assets/WorkerHandle-LNDG8TCa.js","assets/layersCreator-q6m_1vHJ.js","assets/portalLayers-B-nhgqp-.js","assets/associatedFeatureServiceUtils-DOLzJHoh.js","assets/fetchService-bKOSpJHk.js","assets/arcgisLayers-DqPtCNBY.js","assets/statsWorker-CjocTzNn.js","assets/utils-Ck0dj1Jz.js","assets/utils-CMnMOOCn.js","assets/ClassBreaksDefinition-BSKDKZdW.js","assets/geometryEngineWorker-CKk-C6o_.js","assets/geometryEngineJSON-By290Mb8.js","assets/geometryEngineBase-CmuGBSMm.js","assets/json-Wa8cmqdu.js","assets/CSVSourceWorker-CuplZY0G.js","assets/date-M6n_RqpC.js","assets/FeatureStore-EY6PR9GJ.js","assets/BoundsStore-DfkGIFiI.js","assets/PooledRBush-Dn3b87_K.js","assets/quickselect-DhOsQPh9.js","assets/QueryEngine-BBgxB_iM.js","assets/WhereClause-B8aijA-r.js","assets/TimeOnly-Ddv6u_N4.js","assets/QueryEngineCapabilities-CTDe3LlQ.js","assets/optimizedFeatureQueryEngineAdapter-Od-BNW3V.js","assets/number-BWWsAnKw.js","assets/clientSideDefaults-zTxZ94AS.js","assets/EdgeProcessingWorker-BGJkcMEJ.js","assets/workerHelper-D9ItlDOd.js","assets/ElevationSamplerWorker-Bf0vSF0t.js","assets/vertexSpaceConversion-jBHkkWcX.js","assets/FeatureServiceSnappingSourceWorker-BcjG1k-W.js","assets/symbologySnappingCandidates-Bw0a6tuS.js","assets/GeoJSONSourceWorker-D-1ebYWY.js","assets/geojson-BnQ-6_wR.js","assets/sourceUtils-ZGXWuGNy.js","assets/MemorySourceWorker-B4kn_uXo.js","assets/objectIdUtils-4dd1rf9p.js","assets/FeaturePipelineWorker-DVtJw8cq.js","assets/TurboLine-Cd2oS43W.js","assets/constants-D5zmR9t2.js","assets/Rect-BAnET0xx.js","assets/ogcFeatureUtils-GK6h-jiu.js","assets/StreamFeatureManager-viKEfd3z.js","assets/createConnection-C-iwSK3h.js","assets/PointCloudWorker-CPdZzLBS.js","assets/PointCloudWorkerUtil-TljjoYFx.js","assets/PointCloudUniqueValueRenderer-C-_wG_-a.js","assets/I3SBinaryReader-tiMeNU0D.js","assets/RasterWorker-DQbFZiH8.js","assets/dataUtils-CrQYqKBD.js","assets/PolynomialTransform-BjDLaXBm.js","assets/rasterProjectionHelper-4beC2Mrg.js","assets/SceneLayerWorker-DF2boA8b.js","assets/I3SNode-Cqnd-nB0.js","assets/I3SUtil-CtrK0PQU.js","assets/WFSSourceWorker-FB0LPC9c.js","assets/wfsUtils-HsfsOh8L.js","assets/xmlUtils-CtUoQO7q.js","assets/WorkerTileHandler-C3oZ5teP.js","assets/StyleRepository-CTlG8rr6.js","assets/Lyr3DWorker-BWYoxj9q.js","assets/ILyr3DWasmPerSceneView-vPx4somd.js","assets/Lyr3DModule-jvJfo4I2.js","assets/arcadeUtils-Bc-3MxKe.js","assets/ImmutableArray-BPVd6ESQ.js","assets/hash-CcEbRgUF.js","assets/TileLayerView3D-pMjJkxjH.js","assets/LayerView3D-8LQTIagT.js","assets/TiledLayerView3D-BpnISg4m.js","assets/fetchTile-B6MZkfCK.js","assets/LayerView-CFJQIBjD.js","assets/RefreshableLayerView-B9CnG6Vx.js","assets/MapServiceLayerViewHelper-EjmBFkIg.js","assets/floorFilterUtils-DZ5C6FQv.js","assets/drapedUtils-CUCnXbgs.js","assets/sublayerUtils-BmgLgM09.js","assets/popupUtils-BGR3Rcn4.js","assets/ElevationLayerView3D-B4YKrBKx.js","assets/BaseDynamicLayerView3D-DD93pbuC.js","assets/DynamicLayerView3D-CksyKBdi.js","assets/projectExtentUtils-C-qA16Wx.js","assets/ImageMaterial.glsl-Bpi58Hz5.js","assets/BuildingSceneLayerView3D-DLIRevVf.js","assets/BuildingGroupSublayer-CXk2Tc0M.js","assets/BuildingComponentSublayer-B-77bs4T.js","assets/capabilities-CAweHQni.js","assets/I3SIndexInfo-C8_-GBcm.js","assets/I3SLayerDefinitions-DFutfL7h.js","assets/I3SMeshView3D-BdV2cu6u.js","assets/Transform-DmUfAnje.js","assets/RenderTexture-DrYeNN0z.js","assets/I3SOverrides-BB5mVeuB.js","assets/meshFeatureSet-DHh3LX1a.js","assets/Mesh-FrDBfYL7.js","assets/MeshTransform-CbKQlVoA.js","assets/External-esM4hmaq.js","assets/infoFor3D-DsOdlPuA.js","assets/FeatureLayerView3D-CNl96p5-.js","assets/FeatureLayerViewBase3D-BpQSUfop.js","assets/HeatmapDensity.glsl-BemhSKdV.js","assets/timeSupport-BaLHvX7k.js","assets/dehydratedFeatureComparison-CQkGq3TN.js","assets/queryForSymbologySnapping-Dr7FoDfR.js","assets/Graphics3DObjectStates-CVoDSWhf.js","assets/EventedSet-CKMF0xH2.js","assets/SceneModification-CSeWoLuL.js","assets/persistable-D08NJeWT.js","assets/resourceExtension-ixyJeGT7.js","assets/makeScheduleFunction-CggzEh3c.js","assets/I3SQueryFeatureStore-DfA8ucQt.js","assets/TemporalSceneLayerView-BHuuJugk.js","assets/CatalogLayerView3D-D5DnG4ui.js","assets/CatalogDynamicGroupLayerView3D-hPv6GtPT.js","assets/CatalogFootprintLayerView3D-DS9j1GnD.js","assets/CSVLayerView3D-nueneZFV.js","assets/DimensionLayerView3D-BDYRk0D4.js","assets/GeoJSONLayerView3D-Dcu9rJ4b.js","assets/GraphicsLayerView3D-iLVyyKj8.js","assets/GraphicsProcessor-w49lQBY4.js","assets/GroupLayerView-BaEhI0y_.js","assets/ImageryLayerView3D-CeP1BeDz.js","assets/IntegratedMeshLayerView3D-DAgpGKlX.js","assets/IntegratedMesh3DTilesLayerView3D-DcQIw5Tb.js","assets/LineOfSightLayerView3D-CBHd9VhA.js","assets/MapImageLayerView3D-B7xZUjwW.js","assets/ExportImageParameters-yMfa9VWC.js","assets/MediaLayerView3D-DdgjB4Wu.js","assets/MediaElementView-BI7_RJKW.js","assets/normalizeUtilsSync-Dpfb_shh.js","assets/keybindings-CZ3DrQxb.js","assets/SnappingManagerPool-DkOnch55.js","assets/geodesicLengthMeasurementUtils-CLkoLR89.js","assets/geometryEngine-BhPwz75N.js","assets/hydrated-CM4mjwQo.js","assets/geometry2dUtils-b4aosn-j.js","assets/OGCFeatureLayerView3D-DVH01F8K.js","assets/PointCloudLayerView3D-f2bUINtg.js","assets/PopupSceneLayerView-Dxx2lc9U.js","assets/VoxelLayerView3D-CHhsqn1u.js","assets/RouteLayerView3D-Kc4DFEjk.js","assets/Stop-Bw2kngLX.js","assets/SceneLayerView3D-T7SFetfC.js","assets/SceneLayerView-D-WGbQYN.js","assets/SceneLayerGraphicsView3D-lMjfTlEh.js","assets/StreamLayerView3D-BiBX9Ipk.js","assets/ImageryTileLayerView3D-gayF0haa.js","assets/VectorTileLayerView3D-aQ_biIKM.js","assets/vec4f32-CjrfB-0a.js","assets/WFSLayerView3D-jN7AQBby.js","assets/WMSLayerView3D-CGuJWJjP.js","assets/ExportWMSImageParameters-D0T71Obr.js","assets/WMTSLayerView3D-BVtSRO2a.js","assets/AreaMeasurementAnalysisView3D-7KWvdQRE.js","assets/interfaces-Bh_NlK9D.js","assets/TextOverlayItem-BBak6Et0.js","assets/AnalysisView3D-Ig1ATTtK.js","assets/euclideanAreaMeasurementUtils-BpYwh7en.js","assets/projectionUtils-WZzJHoDs.js","assets/EditGeometryOperations-CuOJ1eXV.js","assets/Segment-DJaTFspw.js","assets/LineVisualElement-Djf5b5N4.js","assets/DimensionAnalysisView3D-Dvc2S5LA.js","assets/LengthDimension-DbwQlDBD.js","assets/SnappingOperation-DtUYWkKr.js","assets/ExtendedLineVisualElement-EFBVjMeo.js","assets/EngineVisualElement-D8MbRS5Q.js","assets/Laserlines.glsl-CN47fSpN.js","assets/PointVisualElement-6D-0yl0L.js","assets/RightAngleQuadVisualElement-BXN9ub3U.js","assets/PointSnappingHint-CHTKX0yQ.js","assets/ShadedColorMaterial.glsl-C1Be8O3K.js","assets/dragEventPipeline3D-CmKKtsSU.js","assets/memoize-DsJmrG76.js","assets/Factory-BXwgzTlJ.js","assets/analysisViewUtils-DipEVTTJ.js","assets/ToolIntersector-Ydsz8TMg.js","assets/DirectLineMeasurementAnalysisView3D-DwGE5ufu.js","assets/LineOfSightAnalysisView3D-B0PGHP37.js","assets/LineOfSightAnalysisTarget-BDgD1jD0.js","assets/manipulatorUtils-9doTCo0z.js","assets/SliceAnalysisView3D-83jKf31w.js","assets/SlicePlaneMaterial.glsl-izSB26Cc.js","assets/sliceToolConfig-B_udZTb4.js","assets/ViewshedAnalysisView3D-DHNBQf1x.js","assets/MoveManipulation-DtzNdyzY.js","assets/TerrainTileTree3DDebugger-UkvEnp_U.js","assets/TileTreeDebugger-BiEt0jZl.js","assets/EdgeView-DPtQilcw.js","assets/EdgeWorkerHandle-C5BkInL7.js","assets/Lyr3DWasmPerSceneView-BESd06Vc.js","assets/calcite-button-DQc9b2O5.js","assets/form-B8f_AgJk.js","assets/dom-DIyluZpC.js","assets/guid-DP-7rFCR.js","assets/interactive-Ca6oY6He.js","assets/label-Cdwp0nRu.js","assets/component-thCpPSLC.js","assets/loadable-Difl-4Vd.js","assets/t9n-B6thwzRL.js","assets/key-Dalt3dqL.js","assets/observers-B9Y-DnDl.js","assets/icon-DFkYPoLW.js","assets/loader-BsISDXjP.js","assets/calcite-icon-BwrxrAiO.js","assets/FeatureTileTree3DDebugger-DZAWs9O0.js","assets/GraphicsView3D-BWz-Rbfu.js","assets/calcite-tooltip-DzQ_U6v0.js","assets/floating-ui-BMxx4K9i.js","assets/debounce-BXUnv6U0.js","assets/openCloseComponent-IZzhcSyp.js","assets/FloatingArrow-C_PRUKoL.js","assets/chartUtilsAm5-BODKBiY4.js","assets/Theme-DIAAI1x5.js","assets/Tooltip-rs2yKFSM.js","assets/DefaultTheme-Bha5dVVa.js","assets/chartCommon-BGALUHy4.js","assets/Button-DM6z0iy3.js","assets/ColorSet-C7Yyf-x-.js","assets/pieChart-Tq5fevzR.js","assets/Tick-C-LGqe2V.js","assets/xyChart-C20g54gE.js","assets/editingSupport-DUOeuD9Y.js","assets/layersLoader-B_gQ_-88.js","assets/featureLayerUtils-gPde6IrT.js","assets/utils-Ct4535uZ.js","assets/FeatureLayerSource-Bxx-OAnq.js","assets/QueryTask-DBA_cXHI.js","assets/executeForIds-CTf2ebyW.js","assets/executeQueryPBF-VHGwyB2V.js","assets/arcade-x8KfXeCd.js","assets/calcite-loader-DVZXO4Kd.js","assets/calcite-list-6jVkAsuQ.js","assets/resources4-Bma3eAHE.js","assets/utils3-zIpAkeld.js","assets/input2-BrelHOyV.js","assets/scrim-CpT6l1oo.js","assets/calcite-list-item-EMXjDwnQ.js","assets/action-CIWRtT9o.js","assets/calcite-notice-sm0XPbpv.js","assets/conditionalSlot-BD8LxOGM.js","assets/calcite-action-CfqxQbq3.js","assets/calcite-flow-item-CD1QPnN4.js","assets/action-menu-DQirKFrF.js","assets/focusTrapComponent-ErYLDTQO.js","assets/calcite-action-bar-Bm77Hsqq.js","assets/action-group-C7vu4vEO.js","assets/calcite-action-group-Dvynrxpt.js","assets/calcite-flow-BAi_Y6qR.js","assets/calcite-list-item-group-C17IpNSY.js"])))=>i.map(i=>d[i]);
var PBe=Object.defineProperty;var OBe=(t,e,i)=>e in t?PBe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var mw=(t,e,i)=>OBe(t,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();/**
* @vue/shared v3.4.38
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Vte(t,e){const i=new Set(t.split(","));return r=>i.has(r)}const _n={},FM=[],zd=()=>{},RBe=()=>!1,gj=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),zte=t=>t.startsWith("onUpdate:"),zc=Object.assign,Bte=(t,e)=>{const i=t.indexOf(e);i>-1&&t.splice(i,1)},$Be=Object.prototype.hasOwnProperty,Ur=(t,e)=>$Be.call(t,e),Yi=Array.isArray,FI=t=>yj(t)==="[object Map]",IBe=t=>yj(t)==="[object Set]",ir=t=>typeof t=="function",ul=t=>typeof t=="string",$P=t=>typeof t=="symbol",ko=t=>t!==null&&typeof t=="object",jwe=t=>(ko(t)||ir(t))&&ir(t.then)&&ir(t.catch),LBe=Object.prototype.toString,yj=t=>LBe.call(t),DBe=t=>yj(t).slice(8,-1),NBe=t=>yj(t)==="[object Object]",jte=t=>ul(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,kI=Vte(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),_j=t=>{const e=Object.create(null);return i=>e[i]||(e[i]=t(i))},FBe=/-(\w)/g,TS=_j(t=>t.replace(FBe,(e,i)=>i?i.toUpperCase():"")),kBe=/\B([A-Z])/g,u2=_j(t=>t.replace(kBe,"-$1").toLowerCase()),Gwe=_j(t=>t.charAt(0).toUpperCase()+t.slice(1)),dH=_j(t=>t?`on${Gwe(t)}`:""),SS=(t,e)=>!Object.is(t,e),pH=(t,...e)=>{for(let i=0;i<t.length;i++)t[i](...e)},Hwe=(t,e,i,r=!1)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:r,value:i})},UBe=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let Ale;const qwe=()=>Ale||(Ale=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Gte(t){if(Yi(t)){const e={};for(let i=0;i<t.length;i++){const r=t[i],s=ul(r)?jBe(r):Gte(r);if(s)for(const n in s)e[n]=s[n]}return e}else if(ul(t)||ko(t))return t}const VBe=/;(?![^(]*\))/g,zBe=/:([^]+)/,BBe=/\/\*[^]*?\*\//g;function jBe(t){const e={};return t.replace(BBe,"").split(VBe).forEach(i=>{if(i){const r=i.split(zBe);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function vj(t){let e="";if(ul(t))e=t;else if(Yi(t))for(let i=0;i<t.length;i++){const r=vj(t[i]);r&&(e+=r+" ")}else if(ko(t))for(const i in t)t[i]&&(e+=i+" ");return e.trim()}const GBe="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",HBe=Vte(GBe);function Wwe(t){return!!t||t===""}/**
* @vue/reactivity v3.4.38
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Qp;class qBe{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Qp,!e&&Qp&&(this.index=(Qp.scopes||(Qp.scopes=[])).push(this)-1)}get active(){return this._active}run(e){if(this._active){const i=Qp;try{return Qp=this,e()}finally{Qp=i}}}on(){Qp=this}off(){Qp=this.parent}stop(e){if(this._active){let i,r;for(i=0,r=this.effects.length;i<r;i++)this.effects[i].stop();for(i=0,r=this.cleanups.length;i<r;i++)this.cleanups[i]();if(this.scopes)for(i=0,r=this.scopes.length;i<r;i++)this.scopes[i].stop(!0);if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0,this._active=!1}}}function WBe(t,e=Qp){e&&e.active&&e.effects.push(t)}function ZBe(){return Qp}let ZT;class Hte{constructor(e,i,r,s){this.fn=e,this.trigger=i,this.scheduler=r,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,WBe(this,s)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,Bb();for(let e=0;e<this._depsLength;e++){const i=this.deps[e];if(i.computed&&(YBe(i.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),jb()}return this._dirtyLevel>=4}set dirty(e){this._dirtyLevel=e?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let e=W1,i=ZT;try{return W1=!0,ZT=this,this._runnings++,Ple(this),this.fn()}finally{Ole(this),this._runnings--,ZT=i,W1=e}}stop(){this.active&&(Ple(this),Ole(this),this.onStop&&this.onStop(),this.active=!1)}}function YBe(t){return t.value}function Ple(t){t._trackId++,t._depsLength=0}function Ole(t){if(t.deps.length>t._depsLength){for(let e=t._depsLength;e<t.deps.length;e++)Zwe(t.deps[e],t);t.deps.length=t._depsLength}}function Zwe(t,e){const i=t.get(e);i!==void 0&&e._trackId!==i&&(t.delete(e),t.size===0&&t.cleanup())}let W1=!0,cW=0;const Ywe=[];function Bb(){Ywe.push(W1),W1=!1}function jb(){const t=Ywe.pop();W1=t===void 0?!0:t}function qte(){cW++}function Wte(){for(cW--;!cW&&uW.length;)uW.shift()()}function Xwe(t,e,i){if(e.get(t)!==t._trackId){e.set(t,t._trackId);const r=t.deps[t._depsLength];r!==e?(r&&Zwe(r,t),t.deps[t._depsLength++]=e):t._depsLength++}}const uW=[];function Jwe(t,e,i){qte();for(const r of t.keys()){let s;r._dirtyLevel<e&&(s??(s=t.get(r)===r._trackId))&&(r._shouldSchedule||(r._shouldSchedule=r._dirtyLevel===0),r._dirtyLevel=e),r._shouldSchedule&&(s??(s=t.get(r)===r._trackId))&&(r.trigger(),(!r._runnings||r.allowRecurse)&&r._dirtyLevel!==2&&(r._shouldSchedule=!1,r.scheduler&&uW.push(r.scheduler)))}Wte()}const Qwe=(t,e)=>{const i=new Map;return i.cleanup=t,i.computed=e,i},hW=new WeakMap,YT=Symbol(""),dW=Symbol("");function Iu(t,e,i){if(W1&&ZT){let r=hW.get(t);r||hW.set(t,r=new Map);let s=r.get(i);s||r.set(i,s=Qwe(()=>r.delete(i))),Xwe(ZT,s)}}function G0(t,e,i,r,s,n){const o=hW.get(t);if(!o)return;let a=[];if(e==="clear")a=[...o.values()];else if(i==="length"&&Yi(t)){const l=Number(r);o.forEach((c,u)=>{(u==="length"||!$P(u)&&u>=l)&&a.push(c)})}else switch(i!==void 0&&a.push(o.get(i)),e){case"add":Yi(t)?jte(i)&&a.push(o.get("length")):(a.push(o.get(YT)),FI(t)&&a.push(o.get(dW)));break;case"delete":Yi(t)||(a.push(o.get(YT)),FI(t)&&a.push(o.get(dW)));break;case"set":FI(t)&&a.push(o.get(YT));break}qte();for(const l of a)l&&Jwe(l,4);Wte()}const XBe=Vte("__proto__,__v_isRef,__isVue"),Kwe=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter($P)),Rle=JBe();function JBe(){const t={};return["includes","indexOf","lastIndexOf"].forEach(e=>{t[e]=function(...i){const r=Ms(this);for(let n=0,o=this.length;n<o;n++)Iu(r,"get",n+"");const s=r[e](...i);return s===-1||s===!1?r[e](...i.map(Ms)):s}}),["push","pop","shift","unshift","splice"].forEach(e=>{t[e]=function(...i){Bb(),qte();const r=Ms(this)[e].apply(this,i);return Wte(),jb(),r}}),t}function QBe(t){$P(t)||(t=String(t));const e=Ms(this);return Iu(e,"has",t),e.hasOwnProperty(t)}class exe{constructor(e=!1,i=!1){this._isReadonly=e,this._isShallow=i}get(e,i,r){const s=this._isReadonly,n=this._isShallow;if(i==="__v_isReactive")return!s;if(i==="__v_isReadonly")return s;if(i==="__v_isShallow")return n;if(i==="__v_raw")return r===(s?n?hje:sxe:n?rxe:ixe).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=Yi(e);if(!s){if(o&&Ur(Rle,i))return Reflect.get(Rle,i,r);if(i==="hasOwnProperty")return QBe}const a=Reflect.get(e,i,r);return($P(i)?Kwe.has(i):XBe(i))||(s||Iu(e,"get",i),n)?a:Nh(a)?o&&jte(i)?a:a.value:ko(a)?s?nxe(a):Xte(a):a}}class txe extends exe{constructor(e=!1){super(!1,e)}set(e,i,r,s){let n=e[i];if(!this._isShallow){const l=xA(n);if(!V3(r)&&!xA(r)&&(n=Ms(n),r=Ms(r)),!Yi(e)&&Nh(n)&&!Nh(r))return l?!1:(n.value=r,!0)}const o=Yi(e)&&jte(i)?Number(i)<e.length:Ur(e,i),a=Reflect.set(e,i,r,s);return e===Ms(s)&&(o?SS(r,n)&&G0(e,"set",i,r):G0(e,"add",i,r)),a}deleteProperty(e,i){const r=Ur(e,i);e[i];const s=Reflect.deleteProperty(e,i);return s&&r&&G0(e,"delete",i,void 0),s}has(e,i){const r=Reflect.has(e,i);return(!$P(i)||!Kwe.has(i))&&Iu(e,"has",i),r}ownKeys(e){return Iu(e,"iterate",Yi(e)?"length":YT),Reflect.ownKeys(e)}}class KBe extends exe{constructor(e=!1){super(!0,e)}set(e,i){return!0}deleteProperty(e,i){return!0}}const eje=new txe,tje=new KBe,ije=new txe(!0);const Zte=t=>t,bj=t=>Reflect.getPrototypeOf(t);function _N(t,e,i=!1,r=!1){t=t.__v_raw;const s=Ms(t),n=Ms(e);i||(SS(e,n)&&Iu(s,"get",e),Iu(s,"get",n));const{has:o}=bj(s),a=r?Zte:i?Kte:Qte;if(o.call(s,e))return a(t.get(e));if(o.call(s,n))return a(t.get(n));t!==s&&t.get(e)}function vN(t,e=!1){const i=this.__v_raw,r=Ms(i),s=Ms(t);return e||(SS(t,s)&&Iu(r,"has",t),Iu(r,"has",s)),t===s?i.has(t):i.has(t)||i.has(s)}function bN(t,e=!1){return t=t.__v_raw,!e&&Iu(Ms(t),"iterate",YT),Reflect.get(t,"size",t)}function $le(t,e=!1){!e&&!V3(t)&&!xA(t)&&(t=Ms(t));const i=Ms(this);return bj(i).has.call(i,t)||(i.add(t),G0(i,"add",t,t)),this}function Ile(t,e,i=!1){!i&&!V3(e)&&!xA(e)&&(e=Ms(e));const r=Ms(this),{has:s,get:n}=bj(r);let o=s.call(r,t);o||(t=Ms(t),o=s.call(r,t));const a=n.call(r,t);return r.set(t,e),o?SS(e,a)&&G0(r,"set",t,e):G0(r,"add",t,e),this}function Lle(t){const e=Ms(this),{has:i,get:r}=bj(e);let s=i.call(e,t);s||(t=Ms(t),s=i.call(e,t)),r&&r.call(e,t);const n=e.delete(t);return s&&G0(e,"delete",t,void 0),n}function Dle(){const t=Ms(this),e=t.size!==0,i=t.clear();return e&&G0(t,"clear",void 0,void 0),i}function wN(t,e){return function(r,s){const n=this,o=n.__v_raw,a=Ms(o),l=e?Zte:t?Kte:Qte;return!t&&Iu(a,"iterate",YT),o.forEach((c,u)=>r.call(s,l(c),l(u),n))}}function xN(t,e,i){return function(...r){const s=this.__v_raw,n=Ms(s),o=FI(n),a=t==="entries"||t===Symbol.iterator&&o,l=t==="keys"&&o,c=s[t](...r),u=i?Zte:e?Kte:Qte;return!e&&Iu(n,"iterate",l?dW:YT),{next(){const{value:d,done:f}=c.next();return f?{value:d,done:f}:{value:a?[u(d[0]),u(d[1])]:u(d),done:f}},[Symbol.iterator](){return this}}}}function z_(t){return function(...e){return t==="delete"?!1:t==="clear"?void 0:this}}function rje(){const t={get(n){return _N(this,n)},get size(){return bN(this)},has:vN,add:$le,set:Ile,delete:Lle,clear:Dle,forEach:wN(!1,!1)},e={get(n){return _N(this,n,!1,!0)},get size(){return bN(this)},has:vN,add(n){return $le.call(this,n,!0)},set(n,o){return Ile.call(this,n,o,!0)},delete:Lle,clear:Dle,forEach:wN(!1,!0)},i={get(n){return _N(this,n,!0)},get size(){return bN(this,!0)},has(n){return vN.call(this,n,!0)},add:z_("add"),set:z_("set"),delete:z_("delete"),clear:z_("clear"),forEach:wN(!0,!1)},r={get(n){return _N(this,n,!0,!0)},get size(){return bN(this,!0)},has(n){return vN.call(this,n,!0)},add:z_("add"),set:z_("set"),delete:z_("delete"),clear:z_("clear"),forEach:wN(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(n=>{t[n]=xN(n,!1,!1),i[n]=xN(n,!0,!1),e[n]=xN(n,!1,!0),r[n]=xN(n,!0,!0)}),[t,i,e,r]}const[sje,nje,oje,aje]=rje();function Yte(t,e){const i=e?t?aje:oje:t?nje:sje;return(r,s,n)=>s==="__v_isReactive"?!t:s==="__v_isReadonly"?t:s==="__v_raw"?r:Reflect.get(Ur(i,s)&&s in r?i:r,s,n)}const lje={get:Yte(!1,!1)},cje={get:Yte(!1,!0)},uje={get:Yte(!0,!1)};const ixe=new WeakMap,rxe=new WeakMap,sxe=new WeakMap,hje=new WeakMap;function dje(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function pje(t){return t.__v_skip||!Object.isExtensible(t)?0:dje(DBe(t))}function Xte(t){return xA(t)?t:Jte(t,!1,eje,lje,ixe)}function fje(t){return Jte(t,!1,ije,cje,rxe)}function nxe(t){return Jte(t,!0,tje,uje,sxe)}function Jte(t,e,i,r,s){if(!ko(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const n=s.get(t);if(n)return n;const o=pje(t);if(o===0)return t;const a=new Proxy(t,o===2?r:i);return s.set(t,a),a}function UI(t){return xA(t)?UI(t.__v_raw):!!(t&&t.__v_isReactive)}function xA(t){return!!(t&&t.__v_isReadonly)}function V3(t){return!!(t&&t.__v_isShallow)}function oxe(t){return t?!!t.__v_raw:!1}function Ms(t){const e=t&&t.__v_raw;return e?Ms(e):t}function mje(t){return Object.isExtensible(t)&&Hwe(t,"__v_skip",!0),t}const Qte=t=>ko(t)?Xte(t):t,Kte=t=>ko(t)?nxe(t):t;class axe{constructor(e,i,r,s){this.getter=e,this._setter=i,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new Hte(()=>e(this._value),()=>fH(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!s,this.__v_isReadonly=r}get value(){const e=Ms(this);return(!e._cacheable||e.effect.dirty)&&SS(e._value,e._value=e.effect.run())&&fH(e,4),yje(e),e.effect._dirtyLevel>=2&&fH(e,2),e._value}set value(e){this._setter(e)}get _dirty(){return this.effect.dirty}set _dirty(e){this.effect.dirty=e}}function gje(t,e,i=!1){let r,s;const n=ir(t);return n?(r=t,s=zd):(r=t.get,s=t.set),new axe(r,s,n||!s,i)}function yje(t){var e;W1&&ZT&&(t=Ms(t),Xwe(ZT,(e=t.dep)!=null?e:t.dep=Qwe(()=>t.dep=void 0,t instanceof axe?t:void 0)))}function fH(t,e=4,i,r){t=Ms(t);const s=t.dep;s&&Jwe(s,e)}function Nh(t){return!!(t&&t.__v_isRef===!0)}function _je(t){return Nh(t)?t.value:t}const vje={get:(t,e,i)=>_je(Reflect.get(t,e,i)),set:(t,e,i,r)=>{const s=t[e];return Nh(s)&&!Nh(i)?(s.value=i,!0):Reflect.set(t,e,i,r)}};function lxe(t){return UI(t)?t:new Proxy(t,vje)}/**
* @vue/runtime-core v3.4.38
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Z1(t,e,i,r){try{return r?t(...r):t()}catch(s){wj(s,e,i)}}function Lf(t,e,i,r){if(ir(t)){const s=Z1(t,e,i,r);return s&&jwe(s)&&s.catch(n=>{wj(n,e,i)}),s}if(Yi(t)){const s=[];for(let n=0;n<t.length;n++)s.push(Lf(t[n],e,i,r));return s}}function wj(t,e,i,r=!0){const s=e?e.vnode:null;if(e){let n=e.parent;const o=e.proxy,a=`https://vuejs.org/error-reference/#runtime-${i}`;for(;n;){const c=n.ec;if(c){for(let u=0;u<c.length;u++)if(c[u](t,o,a)===!1)return}n=n.parent}const l=e.appContext.config.errorHandler;if(l){Bb(),Z1(l,null,10,[t,o,a]),jb();return}}bje(t,i,s,r)}function bje(t,e,i,r=!0){console.error(t)}let z3=!1,pW=!1;const Hl=[];let mg=0;const kM=[];let c1=null,fT=0;const cxe=Promise.resolve();let eie=null;function wje(t){const e=eie||cxe;return t?e.then(this?t.bind(this):t):e}function xje(t){let e=mg+1,i=Hl.length;for(;e<i;){const r=e+i>>>1,s=Hl[r],n=B3(s);n<t||n===t&&s.pre?e=r+1:i=r}return e}function tie(t){(!Hl.length||!Hl.includes(t,z3&&t.allowRecurse?mg+1:mg))&&(t.id==null?Hl.push(t):Hl.splice(xje(t.id),0,t),uxe())}function uxe(){!z3&&!pW&&(pW=!0,eie=cxe.then(dxe))}function Tje(t){const e=Hl.indexOf(t);e>mg&&Hl.splice(e,1)}function Sje(t){Yi(t)?kM.push(...t):(!c1||!c1.includes(t,t.allowRecurse?fT+1:fT))&&kM.push(t),uxe()}function Nle(t,e,i=z3?mg+1:0){for(;i<Hl.length;i++){const r=Hl[i];if(r&&r.pre){if(t&&r.id!==t.uid)continue;Hl.splice(i,1),i--,r()}}}function hxe(t){if(kM.length){const e=[...new Set(kM)].sort((i,r)=>B3(i)-B3(r));if(kM.length=0,c1){c1.push(...e);return}for(c1=e,fT=0;fT<c1.length;fT++){const i=c1[fT];i.active!==!1&&i()}c1=null,fT=0}}const B3=t=>t.id==null?1/0:t.id,Eje=(t,e)=>{const i=B3(t)-B3(e);if(i===0){if(t.pre&&!e.pre)return-1;if(e.pre&&!t.pre)return 1}return i};function dxe(t){pW=!1,z3=!0,Hl.sort(Eje);try{for(mg=0;mg<Hl.length;mg++){const e=Hl[mg];e&&e.active!==!1&&Z1(e,e.i,e.i?15:14)}}finally{mg=0,Hl.length=0,hxe(),z3=!1,eie=null,(Hl.length||kM.length)&&dxe()}}let Bd=null,xj=null;function MV(t){const e=Bd;return Bd=t,xj=t&&t.type.__scopeId||null,e}function Cje(t){xj=t}function Mje(){xj=null}function Aje(t,e=Bd,i){if(!e||t._n)return t;const r=(...s)=>{r._d&&Gle(-1);const n=MV(e);let o;try{o=t(...s)}finally{MV(n),r._d&&Gle(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function Pje(t,e){if(Bd===null)return t;const i=Mj(Bd),r=t.dirs||(t.dirs=[]);for(let s=0;s<e.length;s++){let[n,o,a,l=_n]=e[s];n&&(ir(n)&&(n={mounted:n,updated:n}),n.deep&&S1(o),r.push({dir:n,instance:i,value:o,oldValue:void 0,arg:a,modifiers:l}))}return t}function gw(t,e,i,r){const s=t.dirs,n=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];n&&(a.oldValue=n[o].value);let l=a.dir[r];l&&(Bb(),Lf(l,i,8,[t.el,a,t,e]),jb())}}function pxe(t,e){t.shapeFlag&6&&t.component?pxe(t.component.subTree,e):t.shapeFlag&128?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}const G5=t=>!!t.type.__asyncLoader,fxe=t=>t.type.__isKeepAlive;function Oje(t,e){mxe(t,"a",e)}function Rje(t,e){mxe(t,"da",e)}function mxe(t,e,i=Ic){const r=t.__wdc||(t.__wdc=()=>{let s=i;for(;s;){if(s.isDeactivated)return;s=s.parent}return t()});if(Tj(e,r,i),i){let s=i.parent;for(;s&&s.parent;)fxe(s.parent.vnode)&&$je(r,e,i,s),s=s.parent}}function $je(t,e,i,r){const s=Tj(e,t,r,!0);gxe(()=>{Bte(r[e],s)},i)}function Tj(t,e,i=Ic,r=!1){if(i){const s=i[t]||(i[t]=[]),n=e.__weh||(e.__weh=(...o)=>{Bb();const a=QL(i),l=Lf(e,i,t,o);return a(),jb(),l});return r?s.unshift(n):s.push(n),n}}const __=t=>(e,i=Ic)=>{(!Cj||t==="sp")&&Tj(t,(...r)=>e(...r),i)},Ije=__("bm"),Lje=__("m"),Dje=__("bu"),Nje=__("u"),Fje=__("bum"),gxe=__("um"),kje=__("sp"),Uje=__("rtg"),Vje=__("rtc");function zje(t,e=Ic){Tj("ec",t,e)}const Bje=Symbol.for("v-ndc"),fW=t=>t?Lxe(t)?Mj(t):fW(t.parent):null,VI=zc(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>fW(t.parent),$root:t=>fW(t.root),$emit:t=>t.emit,$options:t=>iie(t),$forceUpdate:t=>t.f||(t.f=()=>{t.effect.dirty=!0,tie(t.update)}),$nextTick:t=>t.n||(t.n=wje.bind(t.proxy)),$watch:t=>dGe.bind(t)}),mH=(t,e)=>t!==_n&&!t.__isScriptSetup&&Ur(t,e),jje={get({_:t},e){if(e==="__v_skip")return!0;const{ctx:i,setupState:r,data:s,props:n,accessCache:o,type:a,appContext:l}=t;let c;if(e[0]!=="$"){const m=o[e];if(m!==void 0)switch(m){case 1:return r[e];case 2:return s[e];case 4:return i[e];case 3:return n[e]}else{if(mH(r,e))return o[e]=1,r[e];if(s!==_n&&Ur(s,e))return o[e]=2,s[e];if((c=t.propsOptions[0])&&Ur(c,e))return o[e]=3,n[e];if(i!==_n&&Ur(i,e))return o[e]=4,i[e];mW&&(o[e]=0)}}const u=VI[e];let d,f;if(u)return e==="$attrs"&&Iu(t.attrs,"get",""),u(t);if((d=a.__cssModules)&&(d=d[e]))return d;if(i!==_n&&Ur(i,e))return o[e]=4,i[e];if(f=l.config.globalProperties,Ur(f,e))return f[e]},set({_:t},e,i){const{data:r,setupState:s,ctx:n}=t;return mH(s,e)?(s[e]=i,!0):r!==_n&&Ur(r,e)?(r[e]=i,!0):Ur(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(n[e]=i,!0)},has({_:{data:t,setupState:e,accessCache:i,ctx:r,appContext:s,propsOptions:n}},o){let a;return!!i[o]||t!==_n&&Ur(t,o)||mH(e,o)||(a=n[0])&&Ur(a,o)||Ur(r,o)||Ur(VI,o)||Ur(s.config.globalProperties,o)},defineProperty(t,e,i){return i.get!=null?t._.accessCache[e]=0:Ur(i,"value")&&this.set(t,e,i.value,null),Reflect.defineProperty(t,e,i)}};function Fle(t){return Yi(t)?t.reduce((e,i)=>(e[i]=null,e),{}):t}let mW=!0;function Gje(t){const e=iie(t),i=t.proxy,r=t.ctx;mW=!1,e.beforeCreate&&kle(e.beforeCreate,t,"bc");const{data:s,computed:n,methods:o,watch:a,provide:l,inject:c,created:u,beforeMount:d,mounted:f,beforeUpdate:m,updated:g,activated:y,deactivated:v,beforeDestroy:b,beforeUnmount:w,destroyed:x,unmounted:S,render:C,renderTracked:M,renderTriggered:O,errorCaptured:D,serverPrefetch:U,expose:k,inheritAttrs:H,components:V,directives:X,filters:q}=e;if(c&&Hje(c,r,null),o)for(const L in o){const N=o[L];ir(N)&&(r[L]=N.bind(i))}if(s){const L=s.call(i,i);ko(L)&&(t.data=Xte(L))}if(mW=!0,n)for(const L in n){const N=n[L],z=ir(N)?N.bind(i,i):ir(N.get)?N.get.bind(i,i):zd,W=!ir(N)&&ir(N.set)?N.set.bind(i):zd,J=kGe({get:z,set:W});Object.defineProperty(r,L,{enumerable:!0,configurable:!0,get:()=>J.value,set:K=>J.value=K})}if(a)for(const L in a)yxe(a[L],r,i,L);if(l){const L=ir(l)?l.call(i):l;Reflect.ownKeys(L).forEach(N=>{Jje(N,L[N])})}u&&kle(u,t,"c");function ye(L,N){Yi(N)?N.forEach(z=>L(z.bind(i))):N&&L(N.bind(i))}if(ye(Ije,d),ye(Lje,f),ye(Dje,m),ye(Nje,g),ye(Oje,y),ye(Rje,v),ye(zje,D),ye(Vje,M),ye(Uje,O),ye(Fje,w),ye(gxe,S),ye(kje,U),Yi(k))if(k.length){const L=t.exposed||(t.exposed={});k.forEach(N=>{Object.defineProperty(L,N,{get:()=>i[N],set:z=>i[N]=z})})}else t.exposed||(t.exposed={});C&&t.render===zd&&(t.render=C),H!=null&&(t.inheritAttrs=H),V&&(t.components=V),X&&(t.directives=X)}function Hje(t,e,i=zd){Yi(t)&&(t=gW(t));for(const r in t){const s=t[r];let n;ko(s)?"default"in s?n=H5(s.from||r,s.default,!0):n=H5(s.from||r):n=H5(s),Nh(n)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>n.value,set:o=>n.value=o}):e[r]=n}}function kle(t,e,i){Lf(Yi(t)?t.map(r=>r.bind(e.proxy)):t.bind(e.proxy),e,i)}function yxe(t,e,i,r){const s=r.includes(".")?Rxe(i,r):()=>i[r];if(ul(t)){const n=e[t];ir(n)&&yH(s,n)}else if(ir(t))yH(s,t.bind(i));else if(ko(t))if(Yi(t))t.forEach(n=>yxe(n,e,i,r));else{const n=ir(t.handler)?t.handler.bind(i):e[t.handler];ir(n)&&yH(s,n,t)}}function iie(t){const e=t.type,{mixins:i,extends:r}=e,{mixins:s,optionsCache:n,config:{optionMergeStrategies:o}}=t.appContext,a=n.get(e);let l;return a?l=a:!s.length&&!i&&!r?l=e:(l={},s.length&&s.forEach(c=>AV(l,c,o,!0)),AV(l,e,o)),ko(e)&&n.set(e,l),l}function AV(t,e,i,r=!1){const{mixins:s,extends:n}=e;n&&AV(t,n,i,!0),s&&s.forEach(o=>AV(t,o,i,!0));for(const o in e)if(!(r&&o==="expose")){const a=qje[o]||i&&i[o];t[o]=a?a(t[o],e[o]):e[o]}return t}const qje={data:Ule,props:Vle,emits:Vle,methods:RR,computed:RR,beforeCreate:mc,created:mc,beforeMount:mc,mounted:mc,beforeUpdate:mc,updated:mc,beforeDestroy:mc,beforeUnmount:mc,destroyed:mc,unmounted:mc,activated:mc,deactivated:mc,errorCaptured:mc,serverPrefetch:mc,components:RR,directives:RR,watch:Zje,provide:Ule,inject:Wje};function Ule(t,e){return e?t?function(){return zc(ir(t)?t.call(this,this):t,ir(e)?e.call(this,this):e)}:e:t}function Wje(t,e){return RR(gW(t),gW(e))}function gW(t){if(Yi(t)){const e={};for(let i=0;i<t.length;i++)e[t[i]]=t[i];return e}return t}function mc(t,e){return t?[...new Set([].concat(t,e))]:e}function RR(t,e){return t?zc(Object.create(null),t,e):e}function Vle(t,e){return t?Yi(t)&&Yi(e)?[...new Set([...t,...e])]:zc(Object.create(null),Fle(t),Fle(e??{})):e}function Zje(t,e){if(!t)return e;if(!e)return t;const i=zc(Object.create(null),t);for(const r in e)i[r]=mc(t[r],e[r]);return i}function _xe(){return{app:null,config:{isNativeTag:RBe,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Yje=0;function Xje(t,e){return function(r,s=null){ir(r)||(r=zc({},r)),s!=null&&!ko(s)&&(s=null);const n=_xe(),o=new WeakSet;let a=!1;const l=n.app={_uid:Yje++,_component:r,_props:s,_container:null,_context:n,_instance:null,version:UGe,get config(){return n.config},set config(c){},use(c,...u){return o.has(c)||(c&&ir(c.install)?(o.add(c),c.install(l,...u)):ir(c)&&(o.add(c),c(l,...u))),l},mixin(c){return n.mixins.includes(c)||n.mixins.push(c),l},component(c,u){return u?(n.components[c]=u,l):n.components[c]},directive(c,u){return u?(n.directives[c]=u,l):n.directives[c]},mount(c,u,d){if(!a){const f=XT(r,s);return f.appContext=n,d===!0?d="svg":d===!1&&(d=void 0),u&&e?e(f,c):t(f,c,d),a=!0,l._container=c,c.__vue_app__=l,Mj(f.component)}},unmount(){a&&(t(null,l._container),delete l._container.__vue_app__)},provide(c,u){return n.provides[c]=u,l},runWithContext(c){const u=UM;UM=l;try{return c()}finally{UM=u}}};return l}}let UM=null;function Jje(t,e){if(Ic){let i=Ic.provides;const r=Ic.parent&&Ic.parent.provides;r===i&&(i=Ic.provides=Object.create(r)),i[t]=e}}function H5(t,e,i=!1){const r=Ic||Bd;if(r||UM){const s=UM?UM._context.provides:r?r.parent==null?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&t in s)return s[t];if(arguments.length>1)return i&&ir(e)?e.call(r&&r.proxy):e}}const vxe={},bxe=()=>Object.create(vxe),wxe=t=>Object.getPrototypeOf(t)===vxe;function Qje(t,e,i,r=!1){const s={},n=bxe();t.propsDefaults=Object.create(null),xxe(t,e,s,n);for(const o in t.propsOptions[0])o in s||(s[o]=void 0);i?t.props=r?s:fje(s):t.type.props?t.props=s:t.props=n,t.attrs=n}function Kje(t,e,i,r){const{props:s,attrs:n,vnode:{patchFlag:o}}=t,a=Ms(s),[l]=t.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const u=t.vnode.dynamicProps;for(let d=0;d<u.length;d++){let f=u[d];if(Sj(t.emitsOptions,f))continue;const m=e[f];if(l)if(Ur(n,f))m!==n[f]&&(n[f]=m,c=!0);else{const g=TS(f);s[g]=yW(l,a,g,m,t,!1)}else m!==n[f]&&(n[f]=m,c=!0)}}}else{xxe(t,e,s,n)&&(c=!0);let u;for(const d in a)(!e||!Ur(e,d)&&((u=u2(d))===d||!Ur(e,u)))&&(l?i&&(i[d]!==void 0||i[u]!==void 0)&&(s[d]=yW(l,a,d,void 0,t,!0)):delete s[d]);if(n!==a)for(const d in n)(!e||!Ur(e,d))&&(delete n[d],c=!0)}c&&G0(t.attrs,"set","")}function xxe(t,e,i,r){const[s,n]=t.propsOptions;let o=!1,a;if(e)for(let l in e){if(kI(l))continue;const c=e[l];let u;s&&Ur(s,u=TS(l))?!n||!n.includes(u)?i[u]=c:(a||(a={}))[u]=c:Sj(t.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(n){const l=Ms(i),c=a||_n;for(let u=0;u<n.length;u++){const d=n[u];i[d]=yW(s,l,d,c[d],t,!Ur(c,d))}}return o}function yW(t,e,i,r,s,n){const o=t[i];if(o!=null){const a=Ur(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&ir(l)){const{propsDefaults:c}=s;if(i in c)r=c[i];else{const u=QL(s);r=c[i]=l.call(null,e),u()}}else r=l}o[0]&&(n&&!a?r=!1:o[1]&&(r===""||r===u2(i))&&(r=!0))}return r}const eGe=new WeakMap;function Txe(t,e,i=!1){const r=i?eGe:e.propsCache,s=r.get(t);if(s)return s;const n=t.props,o={},a=[];let l=!1;if(!ir(t)){const u=d=>{l=!0;const[f,m]=Txe(d,e,!0);zc(o,f),m&&a.push(...m)};!i&&e.mixins.length&&e.mixins.forEach(u),t.extends&&u(t.extends),t.mixins&&t.mixins.forEach(u)}if(!n&&!l)return ko(t)&&r.set(t,FM),FM;if(Yi(n))for(let u=0;u<n.length;u++){const d=TS(n[u]);zle(d)&&(o[d]=_n)}else if(n)for(const u in n){const d=TS(u);if(zle(d)){const f=n[u],m=o[d]=Yi(f)||ir(f)?{type:f}:zc({},f),g=m.type;let y=!1,v=!0;if(Yi(g))for(let b=0;b<g.length;++b){const w=g[b],x=ir(w)&&w.name;if(x==="Boolean"){y=!0;break}else x==="String"&&(v=!1)}else y=ir(g)&&g.name==="Boolean";m[0]=y,m[1]=v,(y||Ur(m,"default"))&&a.push(d)}}const c=[o,a];return ko(t)&&r.set(t,c),c}function zle(t){return t[0]!=="$"&&!kI(t)}const Sxe=t=>t[0]==="_"||t==="$stable",rie=t=>Yi(t)?t.map(hg):[hg(t)],tGe=(t,e,i)=>{if(e._n)return e;const r=Aje((...s)=>rie(e(...s)),i);return r._c=!1,r},Exe=(t,e,i)=>{const r=t._ctx;for(const s in t){if(Sxe(s))continue;const n=t[s];if(ir(n))e[s]=tGe(s,n,r);else if(n!=null){const o=rie(n);e[s]=()=>o}}},Cxe=(t,e)=>{const i=rie(e);t.slots.default=()=>i},Mxe=(t,e,i)=>{for(const r in e)(i||r!=="_")&&(t[r]=e[r])},iGe=(t,e,i)=>{const r=t.slots=bxe();if(t.vnode.shapeFlag&32){const s=e._;s?(Mxe(r,e,i),i&&Hwe(r,"_",s,!0)):Exe(e,r)}else e&&Cxe(t,e)},rGe=(t,e,i)=>{const{vnode:r,slots:s}=t;let n=!0,o=_n;if(r.shapeFlag&32){const a=e._;a?i&&a===1?n=!1:Mxe(s,e,i):(n=!e.$stable,Exe(e,s)),o=e}else e&&(Cxe(t,e),o={default:1});if(n)for(const a in s)!Sxe(a)&&o[a]==null&&delete s[a]};function _W(t,e,i,r,s=!1){if(Yi(t)){t.forEach((f,m)=>_W(f,e&&(Yi(e)?e[m]:e),i,r,s));return}if(G5(r)&&!s)return;const n=r.shapeFlag&4?Mj(r.component):r.el,o=s?null:n,{i:a,r:l}=t,c=e&&e.r,u=a.refs===_n?a.refs={}:a.refs,d=a.setupState;if(c!=null&&c!==l&&(ul(c)?(u[c]=null,Ur(d,c)&&(d[c]=null)):Nh(c)&&(c.value=null)),ir(l))Z1(l,a,12,[o,u]);else{const f=ul(l),m=Nh(l);if(f||m){const g=()=>{if(t.f){const y=f?Ur(d,l)?d[l]:u[l]:l.value;s?Yi(y)&&Bte(y,n):Yi(y)?y.includes(n)||y.push(n):f?(u[l]=[n],Ur(d,l)&&(d[l]=u[l])):(l.value=[n],t.k&&(u[t.k]=l.value))}else f?(u[l]=o,Ur(d,l)&&(d[l]=o)):m&&(l.value=o,t.k&&(u[t.k]=o))};o?(g.id=-1,cu(g,i)):g()}}}const sGe=Symbol("_vte"),nGe=t=>t.__isTeleport,cu=bGe;function oGe(t){return aGe(t)}function aGe(t,e){const i=qwe();i.__VUE__=!0;const{insert:r,remove:s,patchProp:n,createElement:o,createText:a,createComment:l,setText:c,setElementText:u,parentNode:d,nextSibling:f,setScopeId:m=zd,insertStaticContent:g}=t,y=(Y,ee,re,Ae=null,ae=null,fe=null,Me=void 0,Oe=null,be=!!ee.dynamicChildren)=>{if(Y===ee)return;Y&&!vO(Y,ee)&&(Ae=ut(Y),K(Y,ae,fe,!0),Y=null),ee.patchFlag===-2&&(be=!1,ee.dynamicChildren=null);const{type:xe,ref:_e,shapeFlag:Le}=ee;switch(xe){case Ej:v(Y,ee,re,Ae);break;case j3:b(Y,ee,re,Ae);break;case vH:Y==null&&w(ee,re,Ae,Me);break;case ug:V(Y,ee,re,Ae,ae,fe,Me,Oe,be);break;default:Le&1?C(Y,ee,re,Ae,ae,fe,Me,Oe,be):Le&6?X(Y,ee,re,Ae,ae,fe,Me,Oe,be):(Le&64||Le&128)&&xe.process(Y,ee,re,Ae,ae,fe,Me,Oe,be,tt)}_e!=null&&ae&&_W(_e,Y&&Y.ref,fe,ee||Y,!ee)},v=(Y,ee,re,Ae)=>{if(Y==null)r(ee.el=a(ee.children),re,Ae);else{const ae=ee.el=Y.el;ee.children!==Y.children&&c(ae,ee.children)}},b=(Y,ee,re,Ae)=>{Y==null?r(ee.el=l(ee.children||""),re,Ae):ee.el=Y.el},w=(Y,ee,re,Ae)=>{[Y.el,Y.anchor]=g(Y.children,ee,re,Ae,Y.el,Y.anchor)},x=({el:Y,anchor:ee},re,Ae)=>{let ae;for(;Y&&Y!==ee;)ae=f(Y),r(Y,re,Ae),Y=ae;r(ee,re,Ae)},S=({el:Y,anchor:ee})=>{let re;for(;Y&&Y!==ee;)re=f(Y),s(Y),Y=re;s(ee)},C=(Y,ee,re,Ae,ae,fe,Me,Oe,be)=>{ee.type==="svg"?Me="svg":ee.type==="math"&&(Me="mathml"),Y==null?M(ee,re,Ae,ae,fe,Me,Oe,be):U(Y,ee,ae,fe,Me,Oe,be)},M=(Y,ee,re,Ae,ae,fe,Me,Oe)=>{let be,xe;const{props:_e,shapeFlag:Le,transition:Fe,dirs:lt}=Y;if(be=Y.el=o(Y.type,fe,_e&&_e.is,_e),Le&8?u(be,Y.children):Le&16&&D(Y.children,be,null,Ae,ae,gH(Y,fe),Me,Oe),lt&&gw(Y,null,Ae,"created"),O(be,Y,Y.scopeId,Me,Ae),_e){for(const Vt in _e)Vt!=="value"&&!kI(Vt)&&n(be,Vt,null,_e[Vt],fe,Ae);"value"in _e&&n(be,"value",null,_e.value,fe),(xe=_e.onVnodeBeforeMount)&&om(xe,Ae,Y)}lt&&gw(Y,null,Ae,"beforeMount");const ct=lGe(ae,Fe);ct&&Fe.beforeEnter(be),r(be,ee,re),((xe=_e&&_e.onVnodeMounted)||ct||lt)&&cu(()=>{xe&&om(xe,Ae,Y),ct&&Fe.enter(be),lt&&gw(Y,null,Ae,"mounted")},ae)},O=(Y,ee,re,Ae,ae)=>{if(re&&m(Y,re),Ae)for(let fe=0;fe<Ae.length;fe++)m(Y,Ae[fe]);if(ae){let fe=ae.subTree;if(ee===fe){const Me=ae.vnode;O(Y,Me,Me.scopeId,Me.slotScopeIds,ae.parent)}}},D=(Y,ee,re,Ae,ae,fe,Me,Oe,be=0)=>{for(let xe=be;xe<Y.length;xe++){const _e=Y[xe]=Oe?u1(Y[xe]):hg(Y[xe]);y(null,_e,ee,re,Ae,ae,fe,Me,Oe)}},U=(Y,ee,re,Ae,ae,fe,Me)=>{const Oe=ee.el=Y.el;let{patchFlag:be,dynamicChildren:xe,dirs:_e}=ee;be|=Y.patchFlag&16;const Le=Y.props||_n,Fe=ee.props||_n;let lt;if(re&&yw(re,!1),(lt=Fe.onVnodeBeforeUpdate)&&om(lt,re,ee,Y),_e&&gw(ee,Y,re,"beforeUpdate"),re&&yw(re,!0),(Le.innerHTML&&Fe.innerHTML==null||Le.textContent&&Fe.textContent==null)&&u(Oe,""),xe?k(Y.dynamicChildren,xe,Oe,re,Ae,gH(ee,ae),fe):Me||N(Y,ee,Oe,null,re,Ae,gH(ee,ae),fe,!1),be>0){if(be&16)H(Oe,Le,Fe,re,ae);else if(be&2&&Le.class!==Fe.class&&n(Oe,"class",null,Fe.class,ae),be&4&&n(Oe,"style",Le.style,Fe.style,ae),be&8){const ct=ee.dynamicProps;for(let Vt=0;Vt<ct.length;Vt++){const Ct=ct[Vt],Zt=Le[Ct],Xt=Fe[Ct];(Xt!==Zt||Ct==="value")&&n(Oe,Ct,Zt,Xt,ae,re)}}be&1&&Y.children!==ee.children&&u(Oe,ee.children)}else!Me&&xe==null&&H(Oe,Le,Fe,re,ae);((lt=Fe.onVnodeUpdated)||_e)&&cu(()=>{lt&&om(lt,re,ee,Y),_e&&gw(ee,Y,re,"updated")},Ae)},k=(Y,ee,re,Ae,ae,fe,Me)=>{for(let Oe=0;Oe<ee.length;Oe++){const be=Y[Oe],xe=ee[Oe],_e=be.el&&(be.type===ug||!vO(be,xe)||be.shapeFlag&70)?d(be.el):re;y(be,xe,_e,null,Ae,ae,fe,Me,!0)}},H=(Y,ee,re,Ae,ae)=>{if(ee!==re){if(ee!==_n)for(const fe in ee)!kI(fe)&&!(fe in re)&&n(Y,fe,ee[fe],null,ae,Ae);for(const fe in re){if(kI(fe))continue;const Me=re[fe],Oe=ee[fe];Me!==Oe&&fe!=="value"&&n(Y,fe,Oe,Me,ae,Ae)}"value"in re&&n(Y,"value",ee.value,re.value,ae)}},V=(Y,ee,re,Ae,ae,fe,Me,Oe,be)=>{const xe=ee.el=Y?Y.el:a(""),_e=ee.anchor=Y?Y.anchor:a("");let{patchFlag:Le,dynamicChildren:Fe,slotScopeIds:lt}=ee;lt&&(Oe=Oe?Oe.concat(lt):lt),Y==null?(r(xe,re,Ae),r(_e,re,Ae),D(ee.children||[],re,_e,ae,fe,Me,Oe,be)):Le>0&&Le&64&&Fe&&Y.dynamicChildren?(k(Y.dynamicChildren,Fe,re,ae,fe,Me,Oe),(ee.key!=null||ae&&ee===ae.subTree)&&Axe(Y,ee,!0)):N(Y,ee,re,_e,ae,fe,Me,Oe,be)},X=(Y,ee,re,Ae,ae,fe,Me,Oe,be)=>{ee.slotScopeIds=Oe,Y==null?ee.shapeFlag&512?ae.ctx.activate(ee,re,Ae,Me,be):q(ee,re,Ae,ae,fe,Me,be):Z(Y,ee,be)},q=(Y,ee,re,Ae,ae,fe,Me)=>{const Oe=Y.component=$Ge(Y,Ae,ae);if(fxe(Y)&&(Oe.ctx.renderer=tt),IGe(Oe,!1,Me),Oe.asyncDep){if(ae&&ae.registerDep(Oe,ye,Me),!Y.el){const be=Oe.subTree=XT(j3);b(null,be,ee,re)}}else ye(Oe,Y,ee,re,ae,fe,Me)},Z=(Y,ee,re)=>{const Ae=ee.component=Y.component;if(yGe(Y,ee,re))if(Ae.asyncDep&&!Ae.asyncResolved){L(Ae,ee,re);return}else Ae.next=ee,Tje(Ae.update),Ae.effect.dirty=!0,Ae.update();else ee.el=Y.el,Ae.vnode=ee},ye=(Y,ee,re,Ae,ae,fe,Me)=>{const Oe=()=>{if(Y.isMounted){let{next:_e,bu:Le,u:Fe,parent:lt,vnode:ct}=Y;{const vi=Pxe(Y);if(vi){_e&&(_e.el=ct.el,L(Y,_e,Me)),vi.asyncDep.then(()=>{Y.isUnmounted||Oe()});return}}let Vt=_e,Ct;yw(Y,!1),_e?(_e.el=ct.el,L(Y,_e,Me)):_e=ct,Le&&pH(Le),(Ct=_e.props&&_e.props.onVnodeBeforeUpdate)&&om(Ct,lt,_e,ct),yw(Y,!0);const Zt=_H(Y),Xt=Y.subTree;Y.subTree=Zt,y(Xt,Zt,d(Xt.el),ut(Xt),Y,ae,fe),_e.el=Zt.el,Vt===null&&_Ge(Y,Zt.el),Fe&&cu(Fe,ae),(Ct=_e.props&&_e.props.onVnodeUpdated)&&cu(()=>om(Ct,lt,_e,ct),ae)}else{let _e;const{el:Le,props:Fe}=ee,{bm:lt,m:ct,parent:Vt}=Y,Ct=G5(ee);if(yw(Y,!1),lt&&pH(lt),!Ct&&(_e=Fe&&Fe.onVnodeBeforeMount)&&om(_e,Vt,ee),yw(Y,!0),Le&&li){const Zt=()=>{Y.subTree=_H(Y),li(Le,Y.subTree,Y,ae,null)};Ct?ee.type.__asyncLoader().then(()=>!Y.isUnmounted&&Zt()):Zt()}else{const Zt=Y.subTree=_H(Y);y(null,Zt,re,Ae,Y,ae,fe),ee.el=Zt.el}if(ct&&cu(ct,ae),!Ct&&(_e=Fe&&Fe.onVnodeMounted)){const Zt=ee;cu(()=>om(_e,Vt,Zt),ae)}(ee.shapeFlag&256||Vt&&G5(Vt.vnode)&&Vt.vnode.shapeFlag&256)&&Y.a&&cu(Y.a,ae),Y.isMounted=!0,ee=re=Ae=null}},be=Y.effect=new Hte(Oe,zd,()=>tie(xe),Y.scope),xe=Y.update=()=>{be.dirty&&be.run()};xe.i=Y,xe.id=Y.uid,yw(Y,!0),xe()},L=(Y,ee,re)=>{ee.component=Y;const Ae=Y.vnode.props;Y.vnode=ee,Y.next=null,Kje(Y,ee.props,Ae,re),rGe(Y,ee.children,re),Bb(),Nle(Y),jb()},N=(Y,ee,re,Ae,ae,fe,Me,Oe,be=!1)=>{const xe=Y&&Y.children,_e=Y?Y.shapeFlag:0,Le=ee.children,{patchFlag:Fe,shapeFlag:lt}=ee;if(Fe>0){if(Fe&128){W(xe,Le,re,Ae,ae,fe,Me,Oe,be);return}else if(Fe&256){z(xe,Le,re,Ae,ae,fe,Me,Oe,be);return}}lt&8?(_e&16&&je(xe,ae,fe),Le!==xe&&u(re,Le)):_e&16?lt&16?W(xe,Le,re,Ae,ae,fe,Me,Oe,be):je(xe,ae,fe,!0):(_e&8&&u(re,""),lt&16&&D(Le,re,Ae,ae,fe,Me,Oe,be))},z=(Y,ee,re,Ae,ae,fe,Me,Oe,be)=>{Y=Y||FM,ee=ee||FM;const xe=Y.length,_e=ee.length,Le=Math.min(xe,_e);let Fe;for(Fe=0;Fe<Le;Fe++){const lt=ee[Fe]=be?u1(ee[Fe]):hg(ee[Fe]);y(Y[Fe],lt,re,null,ae,fe,Me,Oe,be)}xe>_e?je(Y,ae,fe,!0,!1,Le):D(ee,re,Ae,ae,fe,Me,Oe,be,Le)},W=(Y,ee,re,Ae,ae,fe,Me,Oe,be)=>{let xe=0;const _e=ee.length;let Le=Y.length-1,Fe=_e-1;for(;xe<=Le&&xe<=Fe;){const lt=Y[xe],ct=ee[xe]=be?u1(ee[xe]):hg(ee[xe]);if(vO(lt,ct))y(lt,ct,re,null,ae,fe,Me,Oe,be);else break;xe++}for(;xe<=Le&&xe<=Fe;){const lt=Y[Le],ct=ee[Fe]=be?u1(ee[Fe]):hg(ee[Fe]);if(vO(lt,ct))y(lt,ct,re,null,ae,fe,Me,Oe,be);else break;Le--,Fe--}if(xe>Le){if(xe<=Fe){const lt=Fe+1,ct=lt<_e?ee[lt].el:Ae;for(;xe<=Fe;)y(null,ee[xe]=be?u1(ee[xe]):hg(ee[xe]),re,ct,ae,fe,Me,Oe,be),xe++}}else if(xe>Fe)for(;xe<=Le;)K(Y[xe],ae,fe,!0),xe++;else{const lt=xe,ct=xe,Vt=new Map;for(xe=ct;xe<=Fe;xe++){const jt=ee[xe]=be?u1(ee[xe]):hg(ee[xe]);jt.key!=null&&Vt.set(jt.key,xe)}let Ct,Zt=0;const Xt=Fe-ct+1;let vi=!1,xi=0;const Di=new Array(Xt);for(xe=0;xe<Xt;xe++)Di[xe]=0;for(xe=lt;xe<=Le;xe++){const jt=Y[xe];if(Zt>=Xt){K(jt,ae,fe,!0);continue}let ei;if(jt.key!=null)ei=Vt.get(jt.key);else for(Ct=ct;Ct<=Fe;Ct++)if(Di[Ct-ct]===0&&vO(jt,ee[Ct])){ei=Ct;break}ei===void 0?K(jt,ae,fe,!0):(Di[ei-ct]=xe+1,ei>=xi?xi=ei:vi=!0,y(jt,ee[ei],re,null,ae,fe,Me,Oe,be),Zt++)}const Nt=vi?cGe(Di):FM;for(Ct=Nt.length-1,xe=Xt-1;xe>=0;xe--){const jt=ct+xe,ei=ee[jt],dr=jt+1<_e?ee[jt+1].el:Ae;Di[xe]===0?y(null,ei,re,dr,ae,fe,Me,Oe,be):vi&&(Ct<0||xe!==Nt[Ct]?J(ei,re,dr,2):Ct--)}}},J=(Y,ee,re,Ae,ae=null)=>{const{el:fe,type:Me,transition:Oe,children:be,shapeFlag:xe}=Y;if(xe&6){J(Y.component.subTree,ee,re,Ae);return}if(xe&128){Y.suspense.move(ee,re,Ae);return}if(xe&64){Me.move(Y,ee,re,tt);return}if(Me===ug){r(fe,ee,re);for(let Le=0;Le<be.length;Le++)J(be[Le],ee,re,Ae);r(Y.anchor,ee,re);return}if(Me===vH){x(Y,ee,re);return}if(Ae!==2&&xe&1&&Oe)if(Ae===0)Oe.beforeEnter(fe),r(fe,ee,re),cu(()=>Oe.enter(fe),ae);else{const{leave:Le,delayLeave:Fe,afterLeave:lt}=Oe,ct=()=>r(fe,ee,re),Vt=()=>{Le(fe,()=>{ct(),lt&&lt()})};Fe?Fe(fe,ct,Vt):Vt()}else r(fe,ee,re)},K=(Y,ee,re,Ae=!1,ae=!1)=>{const{type:fe,props:Me,ref:Oe,children:be,dynamicChildren:xe,shapeFlag:_e,patchFlag:Le,dirs:Fe,cacheIndex:lt}=Y;if(Le===-2&&(ae=!1),Oe!=null&&_W(Oe,null,re,Y,!0),lt!=null&&(ee.renderCache[lt]=void 0),_e&256){ee.ctx.deactivate(Y);return}const ct=_e&1&&Fe,Vt=!G5(Y);let Ct;if(Vt&&(Ct=Me&&Me.onVnodeBeforeUnmount)&&om(Ct,ee,Y),_e&6)Ie(Y.component,re,Ae);else{if(_e&128){Y.suspense.unmount(re,Ae);return}ct&&gw(Y,null,ee,"beforeUnmount"),_e&64?Y.type.remove(Y,ee,re,tt,Ae):xe&&!xe.hasOnce&&(fe!==ug||Le>0&&Le&64)?je(xe,ee,re,!1,!0):(fe===ug&&Le&384||!ae&&_e&16)&&je(be,ee,re),Ae&&ne(Y)}(Vt&&(Ct=Me&&Me.onVnodeUnmounted)||ct)&&cu(()=>{Ct&&om(Ct,ee,Y),ct&&gw(Y,null,ee,"unmounted")},re)},ne=Y=>{const{type:ee,el:re,anchor:Ae,transition:ae}=Y;if(ee===ug){we(re,Ae);return}if(ee===vH){S(Y);return}const fe=()=>{s(re),ae&&!ae.persisted&&ae.afterLeave&&ae.afterLeave()};if(Y.shapeFlag&1&&ae&&!ae.persisted){const{leave:Me,delayLeave:Oe}=ae,be=()=>Me(re,fe);Oe?Oe(Y.el,fe,be):be()}else fe()},we=(Y,ee)=>{let re;for(;Y!==ee;)re=f(Y),s(Y),Y=re;s(ee)},Ie=(Y,ee,re)=>{const{bum:Ae,scope:ae,update:fe,subTree:Me,um:Oe,m:be,a:xe}=Y;Ble(be),Ble(xe),Ae&&pH(Ae),ae.stop(),fe&&(fe.active=!1,K(Me,Y,ee,re)),Oe&&cu(Oe,ee),cu(()=>{Y.isUnmounted=!0},ee),ee&&ee.pendingBranch&&!ee.isUnmounted&&Y.asyncDep&&!Y.asyncResolved&&Y.suspenseId===ee.pendingId&&(ee.deps--,ee.deps===0&&ee.resolve())},je=(Y,ee,re,Ae=!1,ae=!1,fe=0)=>{for(let Me=fe;Me<Y.length;Me++)K(Y[Me],ee,re,Ae,ae)},ut=Y=>{if(Y.shapeFlag&6)return ut(Y.component.subTree);if(Y.shapeFlag&128)return Y.suspense.next();const ee=f(Y.anchor||Y.el),re=ee&&ee[sGe];return re?f(re):ee};let ot=!1;const at=(Y,ee,re)=>{Y==null?ee._vnode&&K(ee._vnode,null,null,!0):y(ee._vnode||null,Y,ee,null,null,null,re),ee._vnode=Y,ot||(ot=!0,Nle(),hxe(),ot=!1)},tt={p:y,um:K,m:J,r:ne,mt:q,mc:D,pc:N,pbc:k,n:ut,o:t};let rt,li;return{render:at,hydrate:rt,createApp:Xje(at,rt)}}function gH({type:t,props:e},i){return i==="svg"&&t==="foreignObject"||i==="mathml"&&t==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:i}function yw({effect:t,update:e},i){t.allowRecurse=e.allowRecurse=i}function lGe(t,e){return(!t||t&&!t.pendingBranch)&&e&&!e.persisted}function Axe(t,e,i=!1){const r=t.children,s=e.children;if(Yi(r)&&Yi(s))for(let n=0;n<r.length;n++){const o=r[n];let a=s[n];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[n]=u1(s[n]),a.el=o.el),!i&&a.patchFlag!==-2&&Axe(o,a)),a.type===Ej&&(a.el=o.el)}}function cGe(t){const e=t.slice(),i=[0];let r,s,n,o,a;const l=t.length;for(r=0;r<l;r++){const c=t[r];if(c!==0){if(s=i[i.length-1],t[s]<c){e[r]=s,i.push(r);continue}for(n=0,o=i.length-1;n<o;)a=n+o>>1,t[i[a]]<c?n=a+1:o=a;c<t[i[n]]&&(n>0&&(e[r]=i[n-1]),i[n]=r)}}for(n=i.length,o=i[n-1];n-- >0;)i[n]=o,o=e[o];return i}function Pxe(t){const e=t.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Pxe(e)}function Ble(t){if(t)for(let e=0;e<t.length;e++)t[e].active=!1}const uGe=Symbol.for("v-scx"),hGe=()=>H5(uGe),TN={};function yH(t,e,i){return Oxe(t,e,i)}function Oxe(t,e,{immediate:i,deep:r,flush:s,once:n,onTrack:o,onTrigger:a}=_n){if(e&&n){const M=e;e=(...O)=>{M(...O),C()}}const l=Ic,c=M=>r===!0?M:S1(M,r===!1?1:void 0);let u,d=!1,f=!1;if(Nh(t)?(u=()=>t.value,d=V3(t)):UI(t)?(u=()=>c(t),d=!0):Yi(t)?(f=!0,d=t.some(M=>UI(M)||V3(M)),u=()=>t.map(M=>{if(Nh(M))return M.value;if(UI(M))return c(M);if(ir(M))return Z1(M,l,2)})):ir(t)?e?u=()=>Z1(t,l,2):u=()=>(m&&m(),Lf(t,l,3,[g])):u=zd,e&&r){const M=u;u=()=>S1(M())}let m,g=M=>{m=x.onStop=()=>{Z1(M,l,4),m=x.onStop=void 0}},y;if(Cj)if(g=zd,e?i&&Lf(e,l,3,[u(),f?[]:void 0,g]):u(),s==="sync"){const M=hGe();y=M.__watcherHandles||(M.__watcherHandles=[])}else return zd;let v=f?new Array(t.length).fill(TN):TN;const b=()=>{if(!(!x.active||!x.dirty))if(e){const M=x.run();(r||d||(f?M.some((O,D)=>SS(O,v[D])):SS(M,v)))&&(m&&m(),Lf(e,l,3,[M,v===TN?void 0:f&&v[0]===TN?[]:v,g]),v=M)}else x.run()};b.allowRecurse=!!e;let w;s==="sync"?w=b:s==="post"?w=()=>cu(b,l&&l.suspense):(b.pre=!0,l&&(b.id=l.uid),w=()=>tie(b));const x=new Hte(u,zd,w),S=ZBe(),C=()=>{x.stop(),S&&Bte(S.effects,x)};return e?i?b():v=x.run():s==="post"?cu(x.run.bind(x),l&&l.suspense):x.run(),y&&y.push(C),C}function dGe(t,e,i){const r=this.proxy,s=ul(t)?t.includes(".")?Rxe(r,t):()=>r[t]:t.bind(r,r);let n;ir(e)?n=e:(n=e.handler,i=e);const o=QL(this),a=Oxe(s,n.bind(r),i);return o(),a}function Rxe(t,e){const i=e.split(".");return()=>{let r=t;for(let s=0;s<i.length&&r;s++)r=r[i[s]];return r}}function S1(t,e=1/0,i){if(e<=0||!ko(t)||t.__v_skip||(i=i||new Set,i.has(t)))return t;if(i.add(t),e--,Nh(t))S1(t.value,e,i);else if(Yi(t))for(let r=0;r<t.length;r++)S1(t[r],e,i);else if(IBe(t)||FI(t))t.forEach(r=>{S1(r,e,i)});else if(NBe(t)){for(const r in t)S1(t[r],e,i);for(const r of Object.getOwnPropertySymbols(t))Object.prototype.propertyIsEnumerable.call(t,r)&&S1(t[r],e,i)}return t}const pGe=(t,e)=>e==="modelValue"||e==="model-value"?t.modelModifiers:t[`${e}Modifiers`]||t[`${TS(e)}Modifiers`]||t[`${u2(e)}Modifiers`];function fGe(t,e,...i){if(t.isUnmounted)return;const r=t.vnode.props||_n;let s=i;const n=e.startsWith("update:"),o=n&&pGe(r,e.slice(7));o&&(o.trim&&(s=i.map(u=>ul(u)?u.trim():u)),o.number&&(s=i.map(UBe)));let a,l=r[a=dH(e)]||r[a=dH(TS(e))];!l&&n&&(l=r[a=dH(u2(e))]),l&&Lf(l,t,6,s);const c=r[a+"Once"];if(c){if(!t.emitted)t.emitted={};else if(t.emitted[a])return;t.emitted[a]=!0,Lf(c,t,6,s)}}function $xe(t,e,i=!1){const r=e.emitsCache,s=r.get(t);if(s!==void 0)return s;const n=t.emits;let o={},a=!1;if(!ir(t)){const l=c=>{const u=$xe(c,e,!0);u&&(a=!0,zc(o,u))};!i&&e.mixins.length&&e.mixins.forEach(l),t.extends&&l(t.extends),t.mixins&&t.mixins.forEach(l)}return!n&&!a?(ko(t)&&r.set(t,null),null):(Yi(n)?n.forEach(l=>o[l]=null):zc(o,n),ko(t)&&r.set(t,o),o)}function Sj(t,e){return!t||!gj(e)?!1:(e=e.slice(2).replace(/Once$/,""),Ur(t,e[0].toLowerCase()+e.slice(1))||Ur(t,u2(e))||Ur(t,e))}function _H(t){const{type:e,vnode:i,proxy:r,withProxy:s,propsOptions:[n],slots:o,attrs:a,emit:l,render:c,renderCache:u,props:d,data:f,setupState:m,ctx:g,inheritAttrs:y}=t,v=MV(t);let b,w;try{if(i.shapeFlag&4){const S=s||r,C=S;b=hg(c.call(C,S,u,d,m,f,g)),w=a}else{const S=e;b=hg(S.length>1?S(d,{attrs:a,slots:o,emit:l}):S(d,null)),w=e.props?a:mGe(a)}}catch(S){zI.length=0,wj(S,t,1),b=XT(j3)}let x=b;if(w&&y!==!1){const S=Object.keys(w),{shapeFlag:C}=x;S.length&&C&7&&(n&&S.some(zte)&&(w=gGe(w,n)),x=TA(x,w,!1,!0))}return i.dirs&&(x=TA(x,null,!1,!0),x.dirs=x.dirs?x.dirs.concat(i.dirs):i.dirs),i.transition&&(x.transition=i.transition),b=x,MV(v),b}const mGe=t=>{let e;for(const i in t)(i==="class"||i==="style"||gj(i))&&((e||(e={}))[i]=t[i]);return e},gGe=(t,e)=>{const i={};for(const r in t)(!zte(r)||!(r.slice(9)in e))&&(i[r]=t[r]);return i};function yGe(t,e,i){const{props:r,children:s,component:n}=t,{props:o,children:a,patchFlag:l}=e,c=n.emitsOptions;if(e.dirs||e.transition)return!0;if(i&&l>=0){if(l&1024)return!0;if(l&16)return r?jle(r,o,c):!!o;if(l&8){const u=e.dynamicProps;for(let d=0;d<u.length;d++){const f=u[d];if(o[f]!==r[f]&&!Sj(c,f))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?jle(r,o,c):!0:!!o;return!1}function jle(t,e,i){const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!0;for(let s=0;s<r.length;s++){const n=r[s];if(e[n]!==t[n]&&!Sj(i,n))return!0}return!1}function _Ge({vnode:t,parent:e},i){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===t&&(r.el=t.el),r===t)(t=e.vnode).el=i,e=e.parent;else break}}const vGe=t=>t.__isSuspense;function bGe(t,e){e&&e.pendingBranch?Yi(t)?e.effects.push(...t):e.effects.push(t):Sje(t)}const ug=Symbol.for("v-fgt"),Ej=Symbol.for("v-txt"),j3=Symbol.for("v-cmt"),vH=Symbol.for("v-stc"),zI=[];let Sh=null;function wGe(t=!1){zI.push(Sh=t?null:[])}function xGe(){zI.pop(),Sh=zI[zI.length-1]||null}let G3=1;function Gle(t){G3+=t,t<0&&Sh&&(Sh.hasOnce=!0)}function TGe(t){return t.dynamicChildren=G3>0?Sh||FM:null,xGe(),G3>0&&Sh&&Sh.push(t),t}function SGe(t,e,i,r,s,n){return TGe(H3(t,e,i,r,s,n,!0))}function EGe(t){return t?t.__v_isVNode===!0:!1}function vO(t,e){return t.type===e.type&&t.key===e.key}const Ixe=({key:t})=>t??null,q5=({ref:t,ref_key:e,ref_for:i})=>(typeof t=="number"&&(t=""+t),t!=null?ul(t)||Nh(t)||ir(t)?{i:Bd,r:t,k:e,f:!!i}:t:null);function H3(t,e=null,i=null,r=0,s=null,n=t===ug?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&Ixe(e),ref:e&&q5(e),scopeId:xj,slotScopeIds:null,children:i,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:n,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Bd};return a?(sie(l,i),n&128&&t.normalize(l)):i&&(l.shapeFlag|=ul(i)?8:16),G3>0&&!o&&Sh&&(l.patchFlag>0||n&6)&&l.patchFlag!==32&&Sh.push(l),l}const XT=CGe;function CGe(t,e=null,i=null,r=0,s=null,n=!1){if((!t||t===Bje)&&(t=j3),EGe(t)){const a=TA(t,e,!0);return i&&sie(a,i),G3>0&&!n&&Sh&&(a.shapeFlag&6?Sh[Sh.indexOf(t)]=a:Sh.push(a)),a.patchFlag=-2,a}if(FGe(t)&&(t=t.__vccOpts),e){e=MGe(e);let{class:a,style:l}=e;a&&!ul(a)&&(e.class=vj(a)),ko(l)&&(oxe(l)&&!Yi(l)&&(l=zc({},l)),e.style=Gte(l))}const o=ul(t)?1:vGe(t)?128:nGe(t)?64:ko(t)?4:ir(t)?2:0;return H3(t,e,i,r,s,o,n,!0)}function MGe(t){return t?oxe(t)||wxe(t)?zc({},t):t:null}function TA(t,e,i=!1,r=!1){const{props:s,ref:n,patchFlag:o,children:a,transition:l}=t,c=e?PGe(s||{},e):s,u={__v_isVNode:!0,__v_skip:!0,type:t.type,props:c,key:c&&Ixe(c),ref:e&&e.ref?i&&n?Yi(n)?n.concat(q5(e)):[n,q5(e)]:q5(e):n,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:a,target:t.target,targetStart:t.targetStart,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==ug?o===-1?16:o|16:o,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:l,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&TA(t.ssContent),ssFallback:t.ssFallback&&TA(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce};return l&&r&&pxe(u,l.clone(u)),u}function AGe(t=" ",e=0){return XT(Ej,null,t,e)}function hg(t){return t==null||typeof t=="boolean"?XT(j3):Yi(t)?XT(ug,null,t.slice()):typeof t=="object"?u1(t):XT(Ej,null,String(t))}function u1(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:TA(t)}function sie(t,e){let i=0;const{shapeFlag:r}=t;if(e==null)e=null;else if(Yi(e))i=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),sie(t,s()),s._c&&(s._d=!0));return}else{i=32;const s=e._;!s&&!wxe(e)?e._ctx=Bd:s===3&&Bd&&(Bd.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else ir(e)?(e={default:e,_ctx:Bd},i=32):(e=String(e),r&64?(i=16,e=[AGe(e)]):i=8);t.children=e,t.shapeFlag|=i}function PGe(...t){const e={};for(let i=0;i<t.length;i++){const r=t[i];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=vj([e.class,r.class]));else if(s==="style")e.style=Gte([e.style,r.style]);else if(gj(s)){const n=e[s],o=r[s];o&&n!==o&&!(Yi(n)&&n.includes(o))&&(e[s]=n?[].concat(n,o):o)}else s!==""&&(e[s]=r[s])}return e}function om(t,e,i,r=null){Lf(t,e,7,[i,r])}const OGe=_xe();let RGe=0;function $Ge(t,e,i){const r=t.type,s=(e?e.appContext:t.appContext)||OGe,n={uid:RGe++,vnode:t,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,scope:new qBe(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Txe(r,s),emitsOptions:$xe(r,s),emit:null,emitted:null,propsDefaults:_n,inheritAttrs:r.inheritAttrs,ctx:_n,data:_n,props:_n,attrs:_n,slots:_n,refs:_n,setupState:_n,setupContext:null,suspense:i,suspenseId:i?i.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return n.ctx={_:n},n.root=e?e.root:n,n.emit=fGe.bind(null,n),t.ce&&t.ce(n),n}let Ic=null,PV,vW;{const t=qwe(),e=(i,r)=>{let s;return(s=t[i])||(s=t[i]=[]),s.push(r),n=>{s.length>1?s.forEach(o=>o(n)):s[0](n)}};PV=e("__VUE_INSTANCE_SETTERS__",i=>Ic=i),vW=e("__VUE_SSR_SETTERS__",i=>Cj=i)}const QL=t=>{const e=Ic;return PV(t),t.scope.on(),()=>{t.scope.off(),PV(e)}},Hle=()=>{Ic&&Ic.scope.off(),PV(null)};function Lxe(t){return t.vnode.shapeFlag&4}let Cj=!1;function IGe(t,e=!1,i=!1){e&&vW(e);const{props:r,children:s}=t.vnode,n=Lxe(t);Qje(t,r,n,e),iGe(t,s,i);const o=n?LGe(t,e):void 0;return e&&vW(!1),o}function LGe(t,e){const i=t.type;t.accessCache=Object.create(null),t.proxy=new Proxy(t.ctx,jje);const{setup:r}=i;if(r){const s=t.setupContext=r.length>1?NGe(t):null,n=QL(t);Bb();const o=Z1(r,t,0,[t.props,s]);if(jb(),n(),jwe(o)){if(o.then(Hle,Hle),e)return o.then(a=>{qle(t,a,e)}).catch(a=>{wj(a,t,0)});t.asyncDep=o}else qle(t,o,e)}else Dxe(t,e)}function qle(t,e,i){ir(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:ko(e)&&(t.setupState=lxe(e)),Dxe(t,i)}let Wle;function Dxe(t,e,i){const r=t.type;if(!t.render){if(!e&&Wle&&!r.render){const s=r.template||iie(t).template;if(s){const{isCustomElement:n,compilerOptions:o}=t.appContext.config,{delimiters:a,compilerOptions:l}=r,c=zc(zc({isCustomElement:n,delimiters:a},o),l);r.render=Wle(s,c)}}t.render=r.render||zd}{const s=QL(t);Bb();try{Gje(t)}finally{jb(),s()}}}const DGe={get(t,e){return Iu(t,"get",""),t[e]}};function NGe(t){const e=i=>{t.exposed=i||{}};return{attrs:new Proxy(t.attrs,DGe),slots:t.slots,emit:t.emit,expose:e}}function Mj(t){return t.exposed?t.exposeProxy||(t.exposeProxy=new Proxy(lxe(mje(t.exposed)),{get(e,i){if(i in e)return e[i];if(i in VI)return VI[i](t)},has(e,i){return i in e||i in VI}})):t.proxy}function FGe(t){return ir(t)&&"__vccOpts"in t}const kGe=(t,e)=>gje(t,e,Cj),UGe="3.4.38";/**
* @vue/runtime-dom v3.4.38
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const VGe="http://www.w3.org/2000/svg",zGe="http://www.w3.org/1998/Math/MathML",x0=typeof document<"u"?document:null,Zle=x0&&x0.createElement("template"),BGe={insert:(t,e,i)=>{e.insertBefore(t,i||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,i,r)=>{const s=e==="svg"?x0.createElementNS(VGe,t):e==="mathml"?x0.createElementNS(zGe,t):i?x0.createElement(t,{is:i}):x0.createElement(t);return t==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:t=>x0.createTextNode(t),createComment:t=>x0.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>x0.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,i,r,s,n){const o=i?i.previousSibling:e.lastChild;if(s&&(s===n||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),i),!(s===n||!(s=s.nextSibling)););else{Zle.innerHTML=r==="svg"?`<svg>${t}</svg>`:r==="mathml"?`<math>${t}</math>`:t;const a=Zle.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,i)}return[o?o.nextSibling:e.firstChild,i?i.previousSibling:e.lastChild]}},jGe=Symbol("_vtc");function GGe(t,e,i){const r=t[jGe];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?t.removeAttribute("class"):i?t.setAttribute("class",e):t.className=e}const OV=Symbol("_vod"),Nxe=Symbol("_vsh"),HGe={beforeMount(t,{value:e},{transition:i}){t[OV]=t.style.display==="none"?"":t.style.display,i&&e?i.beforeEnter(t):bO(t,e)},mounted(t,{value:e},{transition:i}){i&&e&&i.enter(t)},updated(t,{value:e,oldValue:i},{transition:r}){!e!=!i&&(r?e?(r.beforeEnter(t),bO(t,!0),r.enter(t)):r.leave(t,()=>{bO(t,!1)}):bO(t,e))},beforeUnmount(t,{value:e}){bO(t,e)}};function bO(t,e){t.style.display=e?t[OV]:"none",t[Nxe]=!e}const qGe=Symbol(""),WGe=/(^|;)\s*display\s*:/;function ZGe(t,e,i){const r=t.style,s=ul(i);let n=!1;if(i&&!s){if(e)if(ul(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();i[a]==null&&W5(r,a,"")}else for(const o in e)i[o]==null&&W5(r,o,"");for(const o in i)o==="display"&&(n=!0),W5(r,o,i[o])}else if(s){if(e!==i){const o=r[qGe];o&&(i+=";"+o),r.cssText=i,n=WGe.test(i)}}else e&&t.removeAttribute("style");OV in t&&(t[OV]=n?r.display:"",t[Nxe]&&(r.display="none"))}const Yle=/\s*!important$/;function W5(t,e,i){if(Yi(i))i.forEach(r=>W5(t,e,r));else if(i==null&&(i=""),e.startsWith("--"))t.setProperty(e,i);else{const r=YGe(t,e);Yle.test(i)?t.setProperty(u2(r),i.replace(Yle,""),"important"):t[r]=i}}const Xle=["Webkit","Moz","ms"],bH={};function YGe(t,e){const i=bH[e];if(i)return i;let r=TS(e);if(r!=="filter"&&r in t)return bH[e]=r;r=Gwe(r);for(let s=0;s<Xle.length;s++){const n=Xle[s]+r;if(n in t)return bH[e]=n}return e}const Jle="http://www.w3.org/1999/xlink";function Qle(t,e,i,r,s,n=HBe(e)){r&&e.startsWith("xlink:")?i==null?t.removeAttributeNS(Jle,e.slice(6,e.length)):t.setAttributeNS(Jle,e,i):i==null||n&&!Wwe(i)?t.removeAttribute(e):t.setAttribute(e,n?"":$P(i)?String(i):i)}function XGe(t,e,i,r){if(e==="innerHTML"||e==="textContent"){if(i==null)return;t[e]=i;return}const s=t.tagName;if(e==="value"&&s!=="PROGRESS"&&!s.includes("-")){const o=s==="OPTION"?t.getAttribute("value")||"":t.value,a=i==null?"":String(i);(o!==a||!("_value"in t))&&(t.value=a),i==null&&t.removeAttribute(e),t._value=i;return}let n=!1;if(i===""||i==null){const o=typeof t[e];o==="boolean"?i=Wwe(i):i==null&&o==="string"?(i="",n=!0):o==="number"&&(i=0,n=!0)}try{t[e]=i}catch{}n&&t.removeAttribute(e)}function JGe(t,e,i,r){t.addEventListener(e,i,r)}function QGe(t,e,i,r){t.removeEventListener(e,i,r)}const Kle=Symbol("_vei");function KGe(t,e,i,r,s=null){const n=t[Kle]||(t[Kle]={}),o=n[e];if(r&&o)o.value=r;else{const[a,l]=e6e(e);if(r){const c=n[e]=r6e(r,s);JGe(t,a,c,l)}else o&&(QGe(t,a,o,l),n[e]=void 0)}}const ece=/(?:Once|Passive|Capture)$/;function e6e(t){let e;if(ece.test(t)){e={};let r;for(;r=t.match(ece);)t=t.slice(0,t.length-r[0].length),e[r[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):u2(t.slice(2)),e]}let wH=0;const t6e=Promise.resolve(),i6e=()=>wH||(t6e.then(()=>wH=0),wH=Date.now());function r6e(t,e){const i=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=i.attached)return;Lf(s6e(r,i.value),e,5,[r])};return i.value=t,i.attached=i6e(),i}function s6e(t,e){if(Yi(e)){const i=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{i.call(t),t._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const tce=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123,n6e=(t,e,i,r,s,n)=>{const o=s==="svg";e==="class"?GGe(t,r,o):e==="style"?ZGe(t,i,r):gj(e)?zte(e)||KGe(t,e,i,r,n):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):o6e(t,e,r,o))?(XGe(t,e,r),!t.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Qle(t,e,r,o,n,e!=="value")):(e==="true-value"?t._trueValue=r:e==="false-value"&&(t._falseValue=r),Qle(t,e,r,o))};function o6e(t,e,i,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in t&&tce(e)&&ir(i));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=t.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return tce(e)&&ul(i)?!1:e in t}const a6e=zc({patchProp:n6e},BGe);let ice;function l6e(){return ice||(ice=oGe(a6e))}const c6e=(...t)=>{const e=l6e().createApp(...t),{mount:i}=e;return e.mount=r=>{const s=h6e(r);if(!s)return;const n=e._component;!ir(n)&&!n.render&&!n.template&&(n.template=s.innerHTML),s.innerHTML="";const o=i(s,!1,u6e(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function u6e(t){if(t instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&t instanceof MathMLElement)return"mathml"}function h6e(t){return ul(t)?document.querySelector(t):t}let JT=class ox{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*ox._m}getInt(){return this._seed=(ox._a*this._seed+ox._c)%ox._m,this._seed}getFloat(){return this.getInt()/(ox._m-1)}getIntRange(e,i){return Math.round(this.getFloatRange(e,i))}getFloatRange(e,i){const r=i-e;return e+this.getInt()/ox._m*r}};JT._m=2147483647,JT._a=48271,JT._c=0;const Aj=1.5,d6e=1/Aj,p6e=.5;function h2(t,e){return e?t.filter((i,r,s)=>s.findIndex(e.bind(null,i))===r):Array.from(new Set(t))}function db(t,e,i){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Fxe(t,e){let i=t.length!==e.length;i&&(t.length=e.length);for(let r=0;r<e.length;++r)t[r]!==e[r]&&(t[r]=e[r],i=!0);return i}function bW(t,e,i){let r,s;return i?(r=e.filter(n=>!t.some(o=>i(o,n))),s=t.filter(n=>!e.some(o=>i(o,n)))):(r=e.filter(n=>!t.includes(n)),s=t.filter(n=>!e.includes(n))),{added:r,removed:s}}function f6e(t){return t&&typeof t.length=="number"}function XHt(t,e){const i=t.length;if(i===0)return[];const r=[];for(let s=0;s<i;s+=e)r.push(t.slice(s,s+e));return r}function JHt(t,e,i){const r=t.length;let s=0,n=r-1;for(;s<n;){const a=s+Math.floor((n-s)/2);e>t[a]?s=a+1:n=a}const o=t[s];return i?e>=t[r-1]?-1:o===e?s:s-1:o===e?s:-1}let kxe=class{constructor(){this.last=0}};const Uxe=new kxe;function wW(t,e,i,r){r=r||Uxe;const s=Math.max(0,r.last-10);for(let o=s;o<i;++o)if(t[o]===e)return r.last=o,o;const n=Math.min(s,i);for(let o=0;o<n;++o)if(t[o]===e)return r.last=o,o;return-1}function q3(t,e,i,r){const s=t.length,n=wW(t,e,s,r);if(n!==-1)return t[n]=t[s-1],t.pop(),e}const mp=new Set;function m6e(t,e,i=t.length,r=e.length,s,n){if(r===0||i===0)return i;mp.clear();for(let a=0;a<r;++a)mp.add(e[a]);s=s||Uxe;const o=Math.max(0,s.last-10);for(let a=o;a<i;++a)if(mp.has(t[a])&&(n==null||n.push(t[a]),mp.delete(t[a]),t[a]=t[i-1],--i,--a,mp.size===0||i===0))return mp.clear(),i;for(let a=0;a<o;++a)if(mp.has(t[a])&&(n==null||n.push(t[a]),mp.delete(t[a]),t[a]=t[i-1],--i,--a,mp.size===0||i===0))return mp.clear(),i;return mp.clear(),i}function g6e(t,e){let i=0;for(let r=0;r<t.length;++r){const s=t[r];e(s,r)&&(t[i]=s,i++)}t.length=i}function y6e(t){return rce.seed=t,()=>rce.getFloat()}function KHt(t,e){const i=y6e(e);for(let r=t.length-1;r>0;r--){const s=Math.floor(i()*(r+1)),n=t[r];t[r]=t[s],t[s]=n}return t}const rce=new JT;function Vxe(t,e){const i=t.indexOf(e);return i!==-1?(t.splice(i,1),e):null}function e8t(t,e){const i=new Map,r=t.length;for(let s=0;s<r;s++){const n=t[s],o=e(n,s,t),a=i.get(o);a?a.push(n):i.set(o,[n])}return i}function op(t,e){return t!=null}const _6e=[];function zxe(t){return 32+t.length}function nie(){return 16}function Bxe(t){if(!t)return 0;let e=Hxe;for(const i in t)if(t.hasOwnProperty(i)){const r=t[i];switch(typeof r){case"string":e+=zxe(r);break;case"number":e+=nie();break;case"boolean":e+=4}}return e}function jxe(t){if(!t)return 0;if(Array.isArray(t))return v6e(t);let e=Hxe;for(const i in t)t.hasOwnProperty(i)&&(e+=Gxe(t[i]));return e}function v6e(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let i=qxe;for(let r=0;r<e;r++)i+=Gxe(t[r]);return i}function Gxe(t){switch(typeof t){case"object":return jxe(t);case"string":return zxe(t);case"number":return nie();case"boolean":return 4;default:return 8}}function b6e(t,e){return qxe+t.length*e}const Hxe=32,qxe=16;let D1;function le(t){return typeof D1[t]=="function"?D1[t]=D1[t](globalThis):D1[t]}var Dwe,Nwe,Fwe,kwe;D1=(Dwe=globalThis.dojoConfig)!=null&&Dwe.has||(Nwe=globalThis.esriConfig)!=null&&Nwe.has?{...(Fwe=globalThis.dojoConfig)==null?void 0:Fwe.has,...(kwe=globalThis.esriConfig)==null?void 0:kwe.has}:{},le.add=(t,e,i,r)=>((r||D1[t]===void 0)&&(D1[t]=e),i&&le(t)),le.cache=D1,le.add("big-integer-warning-enabled",!0),le.add("esri-deprecation-warnings",!0),le.add("esri-tests-disable-screenshots",!1),le.add("esri-tests-use-full-window",!1),le.add("esri-tests-post-to-influx",!0),(()=>{var e;le.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(le.add("host-browser",t),le.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),le.add("dom",t),le("host-browser")){const i=navigator,r=i.userAgent,s=i.appVersion,n=parseFloat(s);if(le.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),le.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),le.add("khtml",s.includes("Konqueror")?n:void 0),le.add("edge",parseFloat(r.split("Edge/")[1])||void 0),le.add("opr",parseFloat(r.split("OPR/")[1])||void 0),le.add("webkit",!le("wp")&&!le("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),le.add("chrome",!le("edge")&&!le("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),le.add("android",!le("wp")&&parseFloat(r.split("Android ")[1])||void 0),le.add("safari",!s.includes("Safari")||le("wp")||le("chrome")||le("android")||le("edge")||le("opr")?void 0:parseFloat(s.split("Version/")[1])),le.add("mac",s.includes("Macintosh")),!le("wp")&&/(iPhone|iPod|iPad)/.test(r)){const o=RegExp.$1.replace(/P/,"p"),a=/OS ([\d_]+)/.test(r)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replaceAll("_",""));le.add(o,l),le.add("ios",l)}le("webkit")||(!r.includes("Gecko")||le("wp")||le("khtml")||le("edge")||le.add("mozilla",n),le("mozilla")&&le.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),i=/iPhone/i.test(t);e&&le.add("esri-mobile",e),i&&le.add("esri-iPhone",i),le.add("esri-geolocation",!!navigator.geolocation)}le.add("esri-wasm","WebAssembly"in globalThis),le.add("esri-performance-mode-frames-between-render",20),le.add("esri-force-performance-mode",!1),le.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),le.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),le.add("esri-atomics","Atomics"in globalThis),le.add("esri-workers","Worker"in globalThis),le.add("web-feat:cache","caches"in globalThis),le.add("esri-workers-arraybuffer-transfer",!le("safari")||Number(le("safari"))>=12),le.add("workers-pool-size",8),le.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),le.add("featurelayer-simplify-payload-size-factors",[1,1,4]),le.add("featurelayer-fast-triangulation-enabled",!0),le.add("featurelayer-animation-enabled",!0),le.add("featurelayer-snapshot-enabled",!0),le.add("featurelayer-snapshot-point-min-threshold",8e4),le.add("featurelayer-snapshot-point-max-threshold",4e5),le.add("featurelayer-snapshot-point-coverage",.1),le.add("featurelayer-query-max-depth",4),le.add("featurelayer-query-pausing-enabled",!1),le.add("featurelayer-advanced-symbols",!1),le.add("featurelayer-pbf",!0),le.add("featurelayer-pbf-statistics",!1),le.add("feature-layers-workers",!0),le.add("feature-polyline-generalization-factor",1),le.add("mapview-transitions-duration",200),le.add("mapview-essential-goto-duration",200),le.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),le.add("mapserver-pbf-version-support",10.81),le.add("mapservice-popup-identify-max-tolerance",20),le("host-webworker")||le("host-browser")&&(le.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),le.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{le.add("esri-image-decode",!0,!0,!0)}).catch(()=>{le.add("esri-image-decode",!1,!0,!0)})}return!1}),le.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();function $R(t){return t instanceof ArrayBuffer}function oie(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int8Array"}function N1(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8Array"}function Wxe(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8ClampedArray"}function aie(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int16Array"}function Pj(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint16Array"}function lie(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int32Array"}function cie(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint32Array"}function KL(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float32Array"}function eD(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float64Array"}function Zg(t){return!("buffer"in t)}function pb(...t){return t.reduce((e,i)=>e+(i?Zg(i)?b6e(i,nie()):i.byteLength+Zxe:0),0)}const Zxe=145,Fh=1024;function w6e(t){return eD(t)||KL(t)||lie(t)||aie(t)||oie(t)}function x6e(t){return eD(t)||KL(t)}function T6e(t){return eD(t)?179769e303:KL(t)?3402823e32:cie(t)?4294967295:Pj(t)?65535:N1(t)||Wxe(t)?255:lie(t)?2147483647:aie(t)?32767:oie(t)?127:256}function S6e(t,e){let i;for(i in t)t.hasOwnProperty(i)&&t[i]===void 0&&delete t[i];return t}function ie(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=Jxe(t);if(e!=null)return e;if(RV(t))return t.clone();if(Yxe(t))return t.map(ie);if(Xxe(t))return t.clone();const i={};for(const r of Object.getOwnPropertyNames(t))i[r]=ie(t[r]);return i}function xW(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=Jxe(t);if(e!=null)return e;if(Yxe(t)){let i=!0;const r=t.map(s=>{const n=xW(s);return s!=null&&n==null&&(i=!1),n});return i?r:null}if(RV(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(!Xxe(t)){const i=new(Object.getPrototypeOf(t)).constructor;for(const r of Object.getOwnPropertyNames(t)){const s=t[r],n=xW(s);if(s!=null&&n==null)return null;i[r]=n}return i}return null}function RV(t){return typeof t.clone=="function"}function Yxe(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function Xxe(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function sce(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function Jxe(t){if(oie(t)||N1(t)||Wxe(t)||aie(t)||Pj(t)||lie(t)||cie(t)||KL(t)||eD(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[i,r]of t)e.set(i,ie(r));return e}if(t instanceof Set){const e=new Set;for(const i of t)e.add(ie(i));return e}return null}function uie(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t==null?void 0:t.getTime)=="function"&&typeof(e==null?void 0:e.getTime)=="function"&&t.getTime()===e.getTime()||!1}function Qxe(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&db(t,e):t instanceof Set?e instanceof Set&&C6e(t,e):t instanceof Map?e instanceof Map&&M6e(t,e):!!sce(t)&&sce(e)&&E6e(t,e))}function E6e(t,e){if(t===null||e===null)return!1;const i=Object.keys(t);if(e===null||Object.keys(e).length!==i.length)return!1;for(const r of i)if(t[r]!==e[r]||!Object.prototype.hasOwnProperty.call(e,r))return!1;return!0}function C6e(t,e){if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function M6e(t,e){if(t.size!==e.size)return!1;for(const[i,r]of t){const s=e.get(i);if(s!==r||s===void 0&&!e.has(i))return!1}return!0}function hie(t,e,i=!1){return eTe(t,e,i)}function tD(t,e){if(e!=null)return e[t]||Kxe(t.split("."),!1,e)}function ia(t,e,i){const r=t.split("."),s=r.pop(),n=Kxe(r,!0,i);n&&s&&(n[s]=e)}function nce(t,e){if(t==null&&e==null)return!1;if(t==null||e==null)return!0;if(typeof t=="object"){if(Array.isArray(t)){const i=e;if(t.length!==i.length)return!0;for(let r=0;r<t.length;r++)if(nce(t[r],i[r]))return!0;return!1}if(Object.keys(t).length!==Object.keys(e).length)return!0;for(const i in t)if(nce(t[i],e[i]))return!0;return!1}return t!==e}function Kxe(t,e,i){let r=i;for(const s of t){if(r==null)return;if(!(s in r)){if(!e)return;r[s]={}}r=r[s]}return r}function eTe(t,e,i){return e?Object.keys(e).reduce((r,s)=>{let n=r[s],o=e[s];return n===o?r:n===void 0?(r[s]=ie(o),r):(Array.isArray(o)||Array.isArray(r)?(n=n?Array.isArray(n)?r[s]=n.concat():r[s]=[n]:r[s]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach(a=>{n.includes(a)||n.push(a)}):r[s]=o.concat())):o&&typeof o=="object"?r[s]=eTe(n,o,i):r.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(r[s]=o),r)},t||{}):t}let Ji=class{constructor(e,i={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=i,this.apiValues=[],this.jsonValues=[],this._apiToJSON=A6e(e),this.apiValues=oce(this._apiToJSON),this.jsonValues=oce(this._jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,s,n)=>{const o=this.toJSON(r);o!==void 0&&ia(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const i=this._apiToJSON[e];return this._options.useNumericKeys?+i:i}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}};function A6e(t){const e={};for(const i in t)e[t[i]]=i;return e}function oce(t){const e=[];for(const i in t)e.push(i);return e.sort(),e}function Kl(){return function(t,e){return new Ji(t,{ignoreUnknown:!0,...e})}}const P6e={remove:()=>{}};function Gi(t){return t?{remove(){t&&(t(),t=void 0)}}:P6e}function O6e(t){t.forEach(e=>e==null?void 0:e.remove())}function ES(t){return Gi(()=>O6e(t))}function i8t(t){return Gi(()=>{var e;return(e=t())==null?void 0:e.remove()})}function tTe(t){return Gi(t!=null?()=>t.destroy():void 0)}let iTe,BI;var Uwe,Vwe;const R6e=((Uwe=globalThis.esriConfig)==null?void 0:Uwe.locale)??((Vwe=globalThis.dojoConfig)==null?void 0:Vwe.locale);function rTe(){var t;return R6e??((t=globalThis.navigator)==null?void 0:t.language)??"en"}function Ou(){return BI===void 0&&(BI=rTe()),BI}function $6e(t){iTe=t,nTe()}function I6e(t=Ou()){const e=/^([a-zA-Z]{2,3})(?:[_-]\w+)*$/.exec(t);return e==null?void 0:e[1].toLowerCase()}const Z5=[];function sTe(t){return Z5.push(t),Gi(()=>Z5.splice(Z5.indexOf(t),1))}const Y5=[];function die(t){return Y5.push(t),Gi(()=>Y5.splice(Y5.indexOf(t),1))}function nTe(){const t=iTe??rTe();BI!==t&&([...Y5].forEach(e=>e(t)),BI=t,[...Z5].forEach(e=>e(t)))}var zwe;(zwe=globalThis.addEventListener)==null||zwe.call(globalThis,"languagechange",nTe);const ace=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Bishkek"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class d2 extends Error{}class L6e extends d2{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class D6e extends d2{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class N6e extends d2{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class tM extends d2{}class oTe extends d2{constructor(e){super(`Invalid unit ${e}`)}}class yu extends d2{}class B_ extends d2{constructor(){super("Zone is an abstract class")}}const gt="numeric",Bf="short",Ah="long",$V={year:gt,month:gt,day:gt},aTe={year:gt,month:Bf,day:gt},F6e={year:gt,month:Bf,day:gt,weekday:Bf},lTe={year:gt,month:Ah,day:gt},cTe={year:gt,month:Ah,day:gt,weekday:Ah},uTe={hour:gt,minute:gt},hTe={hour:gt,minute:gt,second:gt},dTe={hour:gt,minute:gt,second:gt,timeZoneName:Bf},pTe={hour:gt,minute:gt,second:gt,timeZoneName:Ah},fTe={hour:gt,minute:gt,hourCycle:"h23"},mTe={hour:gt,minute:gt,second:gt,hourCycle:"h23"},gTe={hour:gt,minute:gt,second:gt,hourCycle:"h23",timeZoneName:Bf},yTe={hour:gt,minute:gt,second:gt,hourCycle:"h23",timeZoneName:Ah},_Te={year:gt,month:gt,day:gt,hour:gt,minute:gt},vTe={year:gt,month:gt,day:gt,hour:gt,minute:gt,second:gt},bTe={year:gt,month:Bf,day:gt,hour:gt,minute:gt},wTe={year:gt,month:Bf,day:gt,hour:gt,minute:gt,second:gt},k6e={year:gt,month:Bf,day:gt,weekday:Bf,hour:gt,minute:gt},xTe={year:gt,month:Ah,day:gt,hour:gt,minute:gt,timeZoneName:Bf},TTe={year:gt,month:Ah,day:gt,hour:gt,minute:gt,second:gt,timeZoneName:Bf},STe={year:gt,month:Ah,day:gt,weekday:Ah,hour:gt,minute:gt,timeZoneName:Ah},ETe={year:gt,month:Ah,day:gt,weekday:Ah,hour:gt,minute:gt,second:gt,timeZoneName:Ah};class IP{get type(){throw new B_}get name(){throw new B_}get ianaName(){return this.name}get isUniversal(){throw new B_}offsetName(e,i){throw new B_}formatOffset(e,i){throw new B_}offset(e){throw new B_}equals(e){throw new B_}get isValid(){throw new B_}}let xH=null;class Oj extends IP{static get instance(){return xH===null&&(xH=new Oj),xH}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return LTe(e,i,r)}formatOffset(e,i){return jI(this.offset(e),i)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let X5={};function U6e(t){return X5[t]||(X5[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),X5[t]}const V6e={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function z6e(t,e){const i=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,s,n,o,a,l,c,u]=r;return[o,s,n,a,l,c,u]}function B6e(t,e){const i=t.formatToParts(e),r=[];for(let s=0;s<i.length;s++){const{type:n,value:o}=i[s],a=V6e[n];n==="era"?r[a]=o:Ri(a)||(r[a]=parseInt(o,10))}return r}let SN={};class kh extends IP{static create(e){return SN[e]||(SN[e]=new kh(e)),SN[e]}static resetCache(){SN={},X5={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=kh.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return LTe(e,i,r,this.name)}formatOffset(e,i){return jI(this.offset(e),i)}offset(e){const i=new Date(e);if(isNaN(i))return NaN;const r=U6e(this.name);let[s,n,o,a,l,c,u]=r.formatToParts?B6e(r,i):z6e(r,i);a==="BC"&&(s=-Math.abs(s)+1);const f=$j({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:u,millisecond:0});let m=+i;const g=m%1e3;return m-=g>=0?g:1e3+g,(f-m)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let lce={};function j6e(t,e={}){const i=JSON.stringify([t,e]);let r=lce[i];return r||(r=new Intl.ListFormat(t,e),lce[i]=r),r}let TW={};function SW(t,e={}){const i=JSON.stringify([t,e]);let r=TW[i];return r||(r=new Intl.DateTimeFormat(t,e),TW[i]=r),r}let EW={};function G6e(t,e={}){const i=JSON.stringify([t,e]);let r=EW[i];return r||(r=new Intl.NumberFormat(t,e),EW[i]=r),r}let CW={};function H6e(t,e={}){const{base:i,...r}=e,s=JSON.stringify([t,r]);let n=CW[s];return n||(n=new Intl.RelativeTimeFormat(t,e),CW[s]=n),n}let IR=null;function q6e(){return IR||(IR=new Intl.DateTimeFormat().resolvedOptions().locale,IR)}let cce={};function W6e(t){let e=cce[t];if(!e){const i=new Intl.Locale(t);e="getWeekInfo"in i?i.getWeekInfo():i.weekInfo,cce[t]=e}return e}function Z6e(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const i=t.indexOf("-u-");if(i===-1)return[t];{let r,s;try{r=SW(t).resolvedOptions(),s=t}catch{const l=t.substring(0,i);r=SW(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:o}=r;return[s,n,o]}}function Y6e(t,e,i){return(i||e)&&(t.includes("-u-")||(t+="-u"),i&&(t+=`-ca-${i}`),e&&(t+=`-nu-${e}`)),t}function X6e(t){const e=[];for(let i=1;i<=12;i++){const r=yi.utc(2009,i,1);e.push(t(r))}return e}function J6e(t){const e=[];for(let i=1;i<=7;i++){const r=yi.utc(2016,11,13+i);e.push(t(r))}return e}function EN(t,e,i,r){const s=t.listingMode();return s==="error"?null:s==="en"?i(e):r(e)}function Q6e(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class K6e{constructor(e,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:s,floor:n,...o}=r;if(!i||Object.keys(o).length>0){const a={useGrouping:!1,...r};r.padTo>0&&(a.minimumIntegerDigits=r.padTo),this.inf=G6e(e,a)}}format(e){if(this.inf){const i=this.floor?Math.floor(e):e;return this.inf.format(i)}else{const i=this.floor?Math.floor(e):gie(e,3);return Po(i,this.padTo)}}}class eHe{constructor(e,i,r){this.opts=r,this.originalZone=void 0;let s;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&kh.create(a).valid?(s=a,this.dt=e):(s="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,s=e.zone.name):(s="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=SW(i,n)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(i=>{if(i.type==="timeZoneName"){const r=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...i,value:r}}else return i}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class tHe{constructor(e,i,r){this.opts={style:"long",...r},!i&&$Te()&&(this.rtf=H6e(e,r))}format(e,i){return this.rtf?this.rtf.format(e,i):wHe(i,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,i){return this.rtf?this.rtf.formatToParts(e,i):[]}}const iHe={firstDay:1,minimalDays:4,weekend:[6,7]};class xs{static fromOpts(e){return xs.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,i,r,s,n=!1){const o=e||ro.defaultLocale,a=o||(n?"en-US":q6e()),l=i||ro.defaultNumberingSystem,c=r||ro.defaultOutputCalendar,u=MW(s)||ro.defaultWeekSettings;return new xs(a,l,c,u,o)}static resetCache(){IR=null,TW={},EW={},CW={}}static fromObject({locale:e,numberingSystem:i,outputCalendar:r,weekSettings:s}={}){return xs.create(e,i,r,s)}constructor(e,i,r,s,n){const[o,a,l]=Z6e(e);this.locale=o,this.numberingSystem=i||a||null,this.outputCalendar=r||l||null,this.weekSettings=s,this.intl=Y6e(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=Q6e(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&i?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:xs.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,MW(e.weekSettings)||this.weekSettings,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,i=!1){return EN(this,e,FTe,()=>{const r=i?{month:e,day:"numeric"}:{month:e},s=i?"format":"standalone";return this.monthsCache[s][e]||(this.monthsCache[s][e]=X6e(n=>this.extract(n,r,"month"))),this.monthsCache[s][e]})}weekdays(e,i=!1){return EN(this,e,VTe,()=>{const r=i?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},s=i?"format":"standalone";return this.weekdaysCache[s][e]||(this.weekdaysCache[s][e]=J6e(n=>this.extract(n,r,"weekday"))),this.weekdaysCache[s][e]})}meridiems(){return EN(this,void 0,()=>zTe,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[yi.utc(2016,11,13,9),yi.utc(2016,11,13,19)].map(i=>this.extract(i,e,"dayperiod"))}return this.meridiemCache})}eras(e){return EN(this,e,BTe,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[yi.utc(-40,1,1),yi.utc(2017,1,1)].map(r=>this.extract(r,i,"era"))),this.eraCache[e]})}extract(e,i,r){const s=this.dtFormatter(e,i),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===r);return o?o.value:null}numberFormatter(e={}){return new K6e(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,i={}){return new eHe(e,this.intl,i)}relFormatter(e={}){return new tHe(this.intl,this.isEnglish(),e)}listFormatter(e={}){return j6e(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:ITe()?W6e(this.locale):iHe}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let TH=null;class ll extends IP{static get utcInstance(){return TH===null&&(TH=new ll(0)),TH}static instance(e){return e===0?ll.utcInstance:new ll(e)}static parseSpecifier(e){if(e){const i=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new ll(Ij(i[1],i[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${jI(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${jI(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,i){return jI(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class rHe extends IP{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function E1(t,e){if(Ri(t)||t===null)return e;if(t instanceof IP)return t;if(oHe(t)){const i=t.toLowerCase();return i==="default"?e:i==="local"||i==="system"?Oj.instance:i==="utc"||i==="gmt"?ll.utcInstance:ll.parseSpecifier(i)||kh.create(t)}else return QT(t)?ll.instance(t):typeof t=="object"&&"offset"in t&&typeof t.offset=="function"?t:new rHe(t)}let uce=()=>Date.now(),hce="system",dce=null,pce=null,fce=null,mce=60,gce,yce=null;class ro{static get now(){return uce}static set now(e){uce=e}static set defaultZone(e){hce=e}static get defaultZone(){return E1(hce,Oj.instance)}static get defaultLocale(){return dce}static set defaultLocale(e){dce=e}static get defaultNumberingSystem(){return pce}static set defaultNumberingSystem(e){pce=e}static get defaultOutputCalendar(){return fce}static set defaultOutputCalendar(e){fce=e}static get defaultWeekSettings(){return yce}static set defaultWeekSettings(e){yce=MW(e)}static get twoDigitCutoffYear(){return mce}static set twoDigitCutoffYear(e){mce=e%100}static get throwOnInvalid(){return gce}static set throwOnInvalid(e){gce=e}static resetCaches(){xs.resetCache(),kh.resetCache()}}class Tf{constructor(e,i){this.reason=e,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const CTe=[0,31,59,90,120,151,181,212,243,273,304,334],MTe=[0,31,60,91,121,152,182,213,244,274,305,335];function jd(t,e){return new Tf("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function pie(t,e,i){const r=new Date(Date.UTC(t,e-1,i));t<100&&t>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const s=r.getUTCDay();return s===0?7:s}function ATe(t,e,i){return i+(iD(t)?MTe:CTe)[e-1]}function PTe(t,e){const i=iD(t)?MTe:CTe,r=i.findIndex(n=>n<e),s=e-i[r];return{month:r+1,day:s}}function fie(t,e){return(t-e+7)%7+1}function IV(t,e=4,i=1){const{year:r,month:s,day:n}=t,o=ATe(r,s,n),a=fie(pie(r,s,n),i);let l=Math.floor((o-a+14-e)/7),c;return l<1?(c=r-1,l=W3(c,e,i)):l>W3(r,e,i)?(c=r+1,l=1):c=r,{weekYear:c,weekNumber:l,weekday:a,...Lj(t)}}function _ce(t,e=4,i=1){const{weekYear:r,weekNumber:s,weekday:n}=t,o=fie(pie(r,1,e),i),a=VM(r);let l=s*7+n-o-7+e,c;l<1?(c=r-1,l+=VM(c)):l>a?(c=r+1,l-=VM(r)):c=r;const{month:u,day:d}=PTe(c,l);return{year:c,month:u,day:d,...Lj(t)}}function SH(t){const{year:e,month:i,day:r}=t,s=ATe(e,i,r);return{year:e,ordinal:s,...Lj(t)}}function vce(t){const{year:e,ordinal:i}=t,{month:r,day:s}=PTe(e,i);return{year:e,month:r,day:s,...Lj(t)}}function bce(t,e){if(!Ri(t.localWeekday)||!Ri(t.localWeekNumber)||!Ri(t.localWeekYear)){if(!Ri(t.weekday)||!Ri(t.weekNumber)||!Ri(t.weekYear))throw new tM("Cannot mix locale-based week fields with ISO-based week fields");return Ri(t.localWeekday)||(t.weekday=t.localWeekday),Ri(t.localWeekNumber)||(t.weekNumber=t.localWeekNumber),Ri(t.localWeekYear)||(t.weekYear=t.localWeekYear),delete t.localWeekday,delete t.localWeekNumber,delete t.localWeekYear,{minDaysInFirstWeek:e.getMinDaysInFirstWeek(),startOfWeek:e.getStartOfWeek()}}else return{minDaysInFirstWeek:4,startOfWeek:1}}function sHe(t,e=4,i=1){const r=Rj(t.weekYear),s=Gd(t.weekNumber,1,W3(t.weekYear,e,i)),n=Gd(t.weekday,1,7);return r?s?n?!1:jd("weekday",t.weekday):jd("week",t.weekNumber):jd("weekYear",t.weekYear)}function nHe(t){const e=Rj(t.year),i=Gd(t.ordinal,1,VM(t.year));return e?i?!1:jd("ordinal",t.ordinal):jd("year",t.year)}function OTe(t){const e=Rj(t.year),i=Gd(t.month,1,12),r=Gd(t.day,1,LV(t.year,t.month));return e?i?r?!1:jd("day",t.day):jd("month",t.month):jd("year",t.year)}function RTe(t){const{hour:e,minute:i,second:r,millisecond:s}=t,n=Gd(e,0,23)||e===24&&i===0&&r===0&&s===0,o=Gd(i,0,59),a=Gd(r,0,59),l=Gd(s,0,999);return n?o?a?l?!1:jd("millisecond",s):jd("second",r):jd("minute",i):jd("hour",e)}function Ri(t){return typeof t>"u"}function QT(t){return typeof t=="number"}function Rj(t){return typeof t=="number"&&t%1===0}function oHe(t){return typeof t=="string"}function aHe(t){return Object.prototype.toString.call(t)==="[object Date]"}function $Te(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function ITe(){try{return typeof Intl<"u"&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch{return!1}}function lHe(t){return Array.isArray(t)?t:[t]}function wce(t,e,i){if(t.length!==0)return t.reduce((r,s)=>{const n=[e(s),s];return r&&i(r[0],n[0])===r[0]?r:n},null)[1]}function cHe(t,e){return e.reduce((i,r)=>(i[r]=t[r],i),{})}function SA(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function MW(t){if(t==null)return null;if(typeof t!="object")throw new yu("Week settings must be an object");if(!Gd(t.firstDay,1,7)||!Gd(t.minimalDays,1,7)||!Array.isArray(t.weekend)||t.weekend.some(e=>!Gd(e,1,7)))throw new yu("Invalid week settings");return{firstDay:t.firstDay,minimalDays:t.minimalDays,weekend:Array.from(t.weekend)}}function Gd(t,e,i){return Rj(t)&&t>=e&&t<=i}function uHe(t,e){return t-e*Math.floor(t/e)}function Po(t,e=2){const i=t<0;let r;return i?r="-"+(""+-t).padStart(e,"0"):r=(""+t).padStart(e,"0"),r}function h1(t){if(!(Ri(t)||t===null||t===""))return parseInt(t,10)}function _w(t){if(!(Ri(t)||t===null||t===""))return parseFloat(t)}function mie(t){if(!(Ri(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function gie(t,e,i=!1){const r=10**e;return(i?Math.trunc:Math.round)(t*r)/r}function iD(t){return t%4===0&&(t%100!==0||t%400===0)}function VM(t){return iD(t)?366:365}function LV(t,e){const i=uHe(e-1,12)+1,r=t+(e-i)/12;return i===2?iD(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function $j(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function xce(t,e,i){return-fie(pie(t,1,e),i)+e-1}function W3(t,e=4,i=1){const r=xce(t,e,i),s=xce(t+1,e,i);return(VM(t)-r+s)/7}function AW(t){return t>99?t:t>ro.twoDigitCutoffYear?1900+t:2e3+t}function LTe(t,e,i,r=null){const s=new Date(t),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(n.timeZone=r);const o={timeZoneName:e,...n},a=new Intl.DateTimeFormat(i,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function Ij(t,e){let i=parseInt(t,10);Number.isNaN(i)&&(i=0);const r=parseInt(e,10)||0,s=i<0||Object.is(i,-0)?-r:r;return i*60+s}function DTe(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new yu(`Invalid unit value ${t}`);return e}function DV(t,e){const i={};for(const r in t)if(SA(t,r)){const s=t[r];if(s==null)continue;i[e(r)]=DTe(s)}return i}function jI(t,e){const i=Math.trunc(Math.abs(t/60)),r=Math.trunc(Math.abs(t%60)),s=t>=0?"+":"-";switch(e){case"short":return`${s}${Po(i,2)}:${Po(r,2)}`;case"narrow":return`${s}${i}${r>0?`:${r}`:""}`;case"techie":return`${s}${Po(i,2)}${Po(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function Lj(t){return cHe(t,["hour","minute","second","millisecond"])}const hHe=["January","February","March","April","May","June","July","August","September","October","November","December"],NTe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dHe=["J","F","M","A","M","J","J","A","S","O","N","D"];function FTe(t){switch(t){case"narrow":return[...dHe];case"short":return[...NTe];case"long":return[...hHe];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const kTe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],UTe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],pHe=["M","T","W","T","F","S","S"];function VTe(t){switch(t){case"narrow":return[...pHe];case"short":return[...UTe];case"long":return[...kTe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const zTe=["AM","PM"],fHe=["Before Christ","Anno Domini"],mHe=["BC","AD"],gHe=["B","A"];function BTe(t){switch(t){case"narrow":return[...gHe];case"short":return[...mHe];case"long":return[...fHe];default:return null}}function yHe(t){return zTe[t.hour<12?0:1]}function _He(t,e){return VTe(e)[t.weekday-1]}function vHe(t,e){return FTe(e)[t.month-1]}function bHe(t,e){return BTe(e)[t.year<0?0:1]}function wHe(t,e,i="always",r=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(t)===-1;if(i==="auto"&&n){const d=t==="days";switch(e){case 1:return d?"tomorrow":`next ${s[t][0]}`;case-1:return d?"yesterday":`last ${s[t][0]}`;case 0:return d?"today":`this ${s[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=s[t],u=r?l?c[1]:c[2]||c[1]:l?s[t][0]:t;return o?`${a} ${u} ago`:`in ${a} ${u}`}function Tce(t,e){let i="";for(const r of t)r.literal?i+=r.val:i+=e(r.val);return i}const xHe={D:$V,DD:aTe,DDD:lTe,DDDD:cTe,t:uTe,tt:hTe,ttt:dTe,tttt:pTe,T:fTe,TT:mTe,TTT:gTe,TTTT:yTe,f:_Te,ff:bTe,fff:xTe,ffff:STe,F:vTe,FF:wTe,FFF:TTe,FFFF:ETe};class ql{static create(e,i={}){return new ql(e,i)}static parseFormat(e){let i=null,r="",s=!1;const n=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(r.length>0&&n.push({literal:s||/^\s+$/.test(r),val:r}),i=null,r="",s=!s):s||a===i?r+=a:(r.length>0&&n.push({literal:/^\s+$/.test(r),val:r}),r=a,i=a)}return r.length>0&&n.push({literal:s||/^\s+$/.test(r),val:r}),n}static macroTokenToFormatOpts(e){return xHe[e]}constructor(e,i){this.opts=i,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...i}).format()}dtFormatter(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i})}formatDateTime(e,i){return this.dtFormatter(e,i).format()}formatDateTimeParts(e,i){return this.dtFormatter(e,i).formatToParts()}formatInterval(e,i){return this.dtFormatter(e.start,i).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,i){return this.dtFormatter(e,i).resolvedOptions()}num(e,i=0){if(this.opts.forceSimple)return Po(e,i);const r={...this.opts};return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,i){const r=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(m,g)=>this.loc.extract(e,m,g),o=m=>e.isOffsetFixed&&e.offset===0&&m.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,m.format):"",a=()=>r?yHe(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,g)=>r?vHe(e,m):n(g?{month:m}:{month:m,day:"numeric"},"month"),c=(m,g)=>r?_He(e,m):n(g?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),u=m=>{const g=ql.macroTokenToFormatOpts(m);return g?this.formatWithSystemDefault(e,g):m},d=m=>r?bHe(e,m):n({era:m},"era"),f=m=>{switch(m){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(e.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(e.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(e.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return d("short");case"GG":return d("long");case"GGGGG":return d("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return u(m)}};return Tce(ql.parseFormat(i),f)}formatDurationFromString(e,i){const r=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const u=r(c);return u?this.num(l.get(u),c.length):c},n=ql.parseFormat(i),o=n.reduce((l,{literal:c,val:u})=>c?l:l.concat(u),[]),a=e.shiftTo(...o.map(r).filter(l=>l));return Tce(n,s(a))}}const jTe=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function LP(...t){const e=t.reduce((i,r)=>i+r.source,"");return RegExp(`^${e}$`)}function DP(...t){return e=>t.reduce(([i,r,s],n)=>{const[o,a,l]=n(e,s);return[{...i,...o},a||r,l]},[{},null,1]).slice(0,2)}function NP(t,...e){if(t==null)return[null,null];for(const[i,r]of e){const s=i.exec(t);if(s)return r(s)}return[null,null]}function GTe(...t){return(e,i)=>{const r={};let s;for(s=0;s<t.length;s++)r[t[s]]=h1(e[i+s]);return[r,null,i+s]}}const HTe=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,THe=`(?:${HTe.source}?(?:\\[(${jTe.source})\\])?)?`,yie=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,qTe=RegExp(`${yie.source}${THe}`),_ie=RegExp(`(?:T${qTe.source})?`),SHe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,EHe=/(\d{4})-?W(\d\d)(?:-?(\d))?/,CHe=/(\d{4})-?(\d{3})/,MHe=GTe("weekYear","weekNumber","weekDay"),AHe=GTe("year","ordinal"),PHe=/(\d{4})-(\d\d)-(\d\d)/,WTe=RegExp(`${yie.source} ?(?:${HTe.source}|(${jTe.source}))?`),OHe=RegExp(`(?: ${WTe.source})?`);function zM(t,e,i){const r=t[e];return Ri(r)?i:h1(r)}function RHe(t,e){return[{year:zM(t,e),month:zM(t,e+1,1),day:zM(t,e+2,1)},null,e+3]}function FP(t,e){return[{hours:zM(t,e,0),minutes:zM(t,e+1,0),seconds:zM(t,e+2,0),milliseconds:mie(t[e+3])},null,e+4]}function rD(t,e){const i=!t[e]&&!t[e+1],r=Ij(t[e+1],t[e+2]),s=i?null:ll.instance(r);return[{},s,e+3]}function sD(t,e){const i=t[e]?kh.create(t[e]):null;return[{},i,e+1]}const $He=RegExp(`^T?${yie.source}$`),IHe=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function LHe(t){const[e,i,r,s,n,o,a,l,c]=t,u=e[0]==="-",d=l&&l[0]==="-",f=(m,g=!1)=>m!==void 0&&(g||m&&u)?-m:m;return[{years:f(_w(i)),months:f(_w(r)),weeks:f(_w(s)),days:f(_w(n)),hours:f(_w(o)),minutes:f(_w(a)),seconds:f(_w(l),l==="-0"),milliseconds:f(mie(c),d)}]}const DHe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function vie(t,e,i,r,s,n,o){const a={year:e.length===2?AW(h1(e)):h1(e),month:NTe.indexOf(i)+1,day:h1(r),hour:h1(s),minute:h1(n)};return o&&(a.second=h1(o)),t&&(a.weekday=t.length>3?kTe.indexOf(t)+1:UTe.indexOf(t)+1),a}const NHe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function FHe(t){const[,e,i,r,s,n,o,a,l,c,u,d]=t,f=vie(e,s,r,i,n,o,a);let m;return l?m=DHe[l]:c?m=0:m=Ij(u,d),[f,new ll(m)]}function kHe(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const UHe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,VHe=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,zHe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Sce(t){const[,e,i,r,s,n,o,a]=t;return[vie(e,s,r,i,n,o,a),ll.utcInstance]}function BHe(t){const[,e,i,r,s,n,o,a]=t;return[vie(e,a,i,r,s,n,o),ll.utcInstance]}const jHe=LP(SHe,_ie),GHe=LP(EHe,_ie),HHe=LP(CHe,_ie),qHe=LP(qTe),ZTe=DP(RHe,FP,rD,sD),WHe=DP(MHe,FP,rD,sD),ZHe=DP(AHe,FP,rD,sD),YHe=DP(FP,rD,sD);function XHe(t){return NP(t,[jHe,ZTe],[GHe,WHe],[HHe,ZHe],[qHe,YHe])}function JHe(t){return NP(kHe(t),[NHe,FHe])}function QHe(t){return NP(t,[UHe,Sce],[VHe,Sce],[zHe,BHe])}function KHe(t){return NP(t,[IHe,LHe])}const e8e=DP(FP);function t8e(t){return NP(t,[$He,e8e])}const i8e=LP(PHe,OHe),r8e=LP(WTe),s8e=DP(FP,rD,sD);function n8e(t){return NP(t,[i8e,ZTe],[r8e,s8e])}const Ece="Invalid Duration",YTe={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},o8e={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...YTe},Zh=146097/400,k2=146097/4800,a8e={years:{quarters:4,months:12,weeks:Zh/7,days:Zh,hours:Zh*24,minutes:Zh*24*60,seconds:Zh*24*60*60,milliseconds:Zh*24*60*60*1e3},quarters:{months:3,weeks:Zh/28,days:Zh/4,hours:Zh*24/4,minutes:Zh*24*60/4,seconds:Zh*24*60*60/4,milliseconds:Zh*24*60*60*1e3/4},months:{weeks:k2/7,days:k2,hours:k2*24,minutes:k2*24*60,seconds:k2*24*60*60,milliseconds:k2*24*60*60*1e3},...YTe},$T=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],l8e=$T.slice(0).reverse();function j_(t,e,i=!1){const r={values:i?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new kr(r)}function XTe(t,e){let i=e.milliseconds??0;for(const r of l8e.slice(1))e[r]&&(i+=e[r]*t[r].milliseconds);return i}function Cce(t,e){const i=XTe(t,e)<0?-1:1;$T.reduceRight((r,s)=>{if(Ri(e[s]))return r;if(r){const n=e[r]*i,o=t[s][r],a=Math.floor(n/o);e[s]+=a*i,e[r]-=a*o*i}return s},null),$T.reduce((r,s)=>{if(Ri(e[s]))return r;if(r){const n=e[r]%1;e[r]-=n,e[s]+=n*t[r][s]}return s},null)}function c8e(t){const e={};for(const[i,r]of Object.entries(t))r!==0&&(e[i]=r);return e}class kr{constructor(e){const i=e.conversionAccuracy==="longterm"||!1;let r=i?a8e:o8e;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||xs.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,i){return kr.fromObject({milliseconds:e},i)}static fromObject(e,i={}){if(e==null||typeof e!="object")throw new yu(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new kr({values:DV(e,kr.normalizeUnit),loc:xs.fromObject(i),conversionAccuracy:i.conversionAccuracy,matrix:i.matrix})}static fromDurationLike(e){if(QT(e))return kr.fromMillis(e);if(kr.isDuration(e))return e;if(typeof e=="object")return kr.fromObject(e);throw new yu(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,i){const[r]=KHe(e);return r?kr.fromObject(r,i):kr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,i){const[r]=t8e(e);return r?kr.fromObject(r,i):kr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,i=null){if(!e)throw new yu("need to specify a reason the Duration is invalid");const r=e instanceof Tf?e:new Tf(e,i);if(ro.throwOnInvalid)throw new N6e(r);return new kr({invalid:r})}static normalizeUnit(e){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!i)throw new oTe(e);return i}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,i={}){const r={...i,floor:i.round!==!1&&i.floor!==!1};return this.isValid?ql.create(this.loc,r).formatDurationFromString(this,e):Ece}toHuman(e={}){if(!this.isValid)return Ece;const i=$T.map(r=>{const s=this.values[r];return Ri(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:r.slice(0,-1)}).format(s)}).filter(r=>r);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(i)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=gie(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const i=this.toMillis();return i<0||i>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},yi.fromMillis(i,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?XTe(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const i=kr.fromDurationLike(e),r={};for(const s of $T)(SA(i.values,s)||SA(this.values,s))&&(r[s]=i.get(s)+this.get(s));return j_(this,{values:r},!0)}minus(e){if(!this.isValid)return this;const i=kr.fromDurationLike(e);return this.plus(i.negate())}mapUnits(e){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=DTe(e(this.values[r],r));return j_(this,{values:i},!0)}get(e){return this[kr.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const i={...this.values,...DV(e,kr.normalizeUnit)};return j_(this,{values:i})}reconfigure({locale:e,numberingSystem:i,conversionAccuracy:r,matrix:s}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:i}),matrix:s,conversionAccuracy:r};return j_(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return Cce(this.matrix,e),j_(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=c8e(this.normalize().shiftToAll().toObject());return j_(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>kr.normalizeUnit(o));const i={},r={},s=this.toObject();let n;for(const o of $T)if(e.indexOf(o)>=0){n=o;let a=0;for(const c in r)a+=this.matrix[c][o]*r[c],r[c]=0;QT(s[o])&&(a+=s[o]);const l=Math.trunc(a);i[o]=l,r[o]=(a*1e3-l*1e3)/1e3}else QT(s[o])&&(r[o]=s[o]);for(const o in r)r[o]!==0&&(i[n]+=o===n?r[o]:r[o]/this.matrix[n][o]);return Cce(this.matrix,i),j_(this,{values:i},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const i of Object.keys(this.values))e[i]=this.values[i]===0?0:-this.values[i];return j_(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function i(r,s){return r===void 0||r===0?s===void 0||s===0:r===s}for(const r of $T)if(!i(this.values[r],e.values[r]))return!1;return!0}}const U2="Invalid Interval";function u8e(t,e){return!t||!t.isValid?kn.invalid("missing or invalid start"):!e||!e.isValid?kn.invalid("missing or invalid end"):e<t?kn.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class kn{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,i=null){if(!e)throw new yu("need to specify a reason the Interval is invalid");const r=e instanceof Tf?e:new Tf(e,i);if(ro.throwOnInvalid)throw new D6e(r);return new kn({invalid:r})}static fromDateTimes(e,i){const r=xO(e),s=xO(i),n=u8e(r,s);return n??new kn({start:r,end:s})}static after(e,i){const r=kr.fromDurationLike(i),s=xO(e);return kn.fromDateTimes(s,s.plus(r))}static before(e,i){const r=kr.fromDurationLike(i),s=xO(e);return kn.fromDateTimes(s.minus(r),s)}static fromISO(e,i){const[r,s]=(e||"").split("/",2);if(r&&s){let n,o;try{n=yi.fromISO(r,i),o=n.isValid}catch{o=!1}let a,l;try{a=yi.fromISO(s,i),l=a.isValid}catch{l=!1}if(o&&l)return kn.fromDateTimes(n,a);if(o){const c=kr.fromISO(s,i);if(c.isValid)return kn.after(n,c)}else if(l){const c=kr.fromISO(r,i);if(c.isValid)return kn.before(a,c)}}return kn.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",i){if(!this.isValid)return NaN;const r=this.start.startOf(e,i);let s;return i!=null&&i.useLocaleWeeks?s=this.end.reconfigure({locale:r.locale}):s=this.end,s=s.startOf(e,i),Math.floor(s.diff(r,e).get(e))+(s.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:i}={}){return this.isValid?kn.fromDateTimes(e||this.s,i||this.e):this}splitAt(...e){if(!this.isValid)return[];const i=e.map(xO).filter(o=>this.contains(o)).sort((o,a)=>o.toMillis()-a.toMillis()),r=[];let{s}=this,n=0;for(;s<this.e;){const o=i[n]||this.e,a=+o>+this.e?this.e:o;r.push(kn.fromDateTimes(s,a)),s=a,n+=1}return r}splitBy(e){const i=kr.fromDurationLike(e);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,s=1,n;const o=[];for(;r<this.e;){const a=this.start.plus(i.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(kn.fromDateTimes(r,n)),r=n,s+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const i=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return i>=r?null:kn.fromDateTimes(i,r)}union(e){if(!this.isValid)return this;const i=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return kn.fromDateTimes(i,r)}static merge(e){const[i,r]=e.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return r&&i.push(r),i}static xor(e){let i=null,r=0;const s=[],n=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&s.push(kn.fromDateTimes(i,l.time)),i=null);return kn.merge(s)}difference(...e){return kn.xor([this].concat(e)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:U2}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=$V,i={}){return this.isValid?ql.create(this.s.loc.clone(i),e).formatInterval(this):U2}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:U2}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:U2}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:U2}toFormat(e,{separator:i=" – "}={}){return this.isValid?`${this.s.toFormat(e)}${i}${this.e.toFormat(e)}`:U2}toDuration(e,i){return this.isValid?this.e.diff(this.s,e,i):kr.invalid(this.invalidReason)}mapEndpoints(e){return kn.fromDateTimes(e(this.s),e(this.e))}}class CN{static hasDST(e=ro.defaultZone){const i=yi.now().setZone(e).set({month:12});return!e.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(e){return kh.isValidZone(e)}static normalizeZone(e){return E1(e,ro.defaultZone)}static getStartOfWeek({locale:e=null,locObj:i=null}={}){return(i||xs.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:i=null}={}){return(i||xs.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:i=null}={}){return(i||xs.create(e)).getWeekendDays().slice()}static months(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||xs.create(i,r,n)).months(e)}static monthsFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||xs.create(i,r,n)).months(e,!0)}static weekdays(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||xs.create(i,r,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||xs.create(i,r,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return xs.create(e).meridiems()}static eras(e="short",{locale:i=null}={}){return xs.create(i,null,"gregory").eras(e)}static features(){return{relative:$Te(),localeWeek:ITe()}}}function Mce(t,e){const i=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(e)-i(t);return Math.floor(kr.fromMillis(r).as("days"))}function h8e(t,e,i){const r=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const u=Mce(l,c);return(u-u%7)/7}],["days",Mce]],s={},n=t;let o,a;for(const[l,c]of r)i.indexOf(l)>=0&&(o=l,s[l]=c(t,e),a=n.plus(s),a>e?(s[l]--,t=n.plus(s),t>e&&(a=t,s[l]--,t=n.plus(s))):t=a);return[t,s,a,o]}function d8e(t,e,i,r){let[s,n,o,a]=h8e(t,e,i);const l=e-s,c=i.filter(d=>["hours","minutes","seconds","milliseconds"].indexOf(d)>=0);c.length===0&&(o<e&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const u=kr.fromObject(n,r);return c.length>0?kr.fromMillis(l,r).shiftTo(...c).plus(u):u}const bie={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},Ace={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},p8e=bie.hanidec.replace(/[\[|\]]/g,"").split("");function f8e(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);if(t[i].search(bie.hanidec)!==-1)e+=p8e.indexOf(t[i]);else for(const s in Ace){const[n,o]=Ace[s];r>=n&&r<=o&&(e+=r-n)}}return parseInt(e,10)}else return e}function gp({numberingSystem:t},e=""){return new RegExp(`${bie[t||"latn"]}${e}`)}const m8e="missing Intl.DateTimeFormat.formatToParts support";function Kr(t,e=i=>i){return{regex:t,deser:([i])=>e(f8e(i))}}const g8e=" ",JTe=`[ ${g8e}]`,QTe=new RegExp(JTe,"g");function y8e(t){return t.replace(/\./g,"\\.?").replace(QTe,JTe)}function Pce(t){return t.replace(/\./g,"").replace(QTe," ").toLowerCase()}function yp(t,e){return t===null?null:{regex:RegExp(t.map(y8e).join("|")),deser:([i])=>t.findIndex(r=>Pce(i)===Pce(r))+e}}function Oce(t,e){return{regex:t,deser:([,i,r])=>Ij(i,r),groups:e}}function MN(t){return{regex:t,deser:([e])=>e}}function _8e(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function v8e(t,e){const i=gp(e),r=gp(e,"{2}"),s=gp(e,"{3}"),n=gp(e,"{4}"),o=gp(e,"{6}"),a=gp(e,"{1,2}"),l=gp(e,"{1,3}"),c=gp(e,"{1,6}"),u=gp(e,"{1,9}"),d=gp(e,"{2,4}"),f=gp(e,"{4,6}"),m=v=>({regex:RegExp(_8e(v.val)),deser:([b])=>b,literal:!0}),y=(v=>{if(t.literal)return m(v);switch(v.val){case"G":return yp(e.eras("short"),0);case"GG":return yp(e.eras("long"),0);case"y":return Kr(c);case"yy":return Kr(d,AW);case"yyyy":return Kr(n);case"yyyyy":return Kr(f);case"yyyyyy":return Kr(o);case"M":return Kr(a);case"MM":return Kr(r);case"MMM":return yp(e.months("short",!0),1);case"MMMM":return yp(e.months("long",!0),1);case"L":return Kr(a);case"LL":return Kr(r);case"LLL":return yp(e.months("short",!1),1);case"LLLL":return yp(e.months("long",!1),1);case"d":return Kr(a);case"dd":return Kr(r);case"o":return Kr(l);case"ooo":return Kr(s);case"HH":return Kr(r);case"H":return Kr(a);case"hh":return Kr(r);case"h":return Kr(a);case"mm":return Kr(r);case"m":return Kr(a);case"q":return Kr(a);case"qq":return Kr(r);case"s":return Kr(a);case"ss":return Kr(r);case"S":return Kr(l);case"SSS":return Kr(s);case"u":return MN(u);case"uu":return MN(a);case"uuu":return Kr(i);case"a":return yp(e.meridiems(),0);case"kkkk":return Kr(n);case"kk":return Kr(d,AW);case"W":return Kr(a);case"WW":return Kr(r);case"E":case"c":return Kr(i);case"EEE":return yp(e.weekdays("short",!1),1);case"EEEE":return yp(e.weekdays("long",!1),1);case"ccc":return yp(e.weekdays("short",!0),1);case"cccc":return yp(e.weekdays("long",!0),1);case"Z":case"ZZ":return Oce(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return Oce(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return MN(/[a-z_+-/]{1,256}?/i);case" ":return MN(/[^\S\n\r]/);default:return m(v)}})(t)||{invalidReason:m8e};return y.token=t,y}const b8e={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function w8e(t,e,i){const{type:r,value:s}=t;if(r==="literal"){const l=/^\s+$/.test(s);return{literal:!l,val:l?" ":s}}const n=e[r];let o=r;r==="hour"&&(e.hour12!=null?o=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?o="hour12":o="hour24":o=i.hour12?"hour12":"hour24");let a=b8e[o];if(typeof a=="object"&&(a=a[n]),a)return{literal:!1,val:a}}function x8e(t){return[`^${t.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,t]}function T8e(t,e,i){const r=t.match(e);if(r){const s={};let n=1;for(const o in i)if(SA(i,o)){const a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(r.slice(n,n+l))),n+=l}return[r,s]}else return[r,{}]}function S8e(t){const e=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return Ri(t.z)||(i=kh.create(t.z)),Ri(t.Z)||(i||(i=new ll(t.Z)),r=t.Z),Ri(t.q)||(t.M=(t.q-1)*3+1),Ri(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),Ri(t.u)||(t.S=mie(t.u)),[Object.keys(t).reduce((n,o)=>{const a=e(o);return a&&(n[a]=t[o]),n},{}),i,r]}let EH=null;function E8e(){return EH||(EH=yi.fromMillis(1555555555555)),EH}function C8e(t,e){if(t.literal)return t;const i=ql.macroTokenToFormatOpts(t.val),r=tSe(i,e);return r==null||r.includes(void 0)?t:r}function KTe(t,e){return Array.prototype.concat(...t.map(i=>C8e(i,e)))}function eSe(t,e,i){const r=KTe(ql.parseFormat(i),t),s=r.map(o=>v8e(o,t)),n=s.find(o=>o.invalidReason);if(n)return{input:e,tokens:r,invalidReason:n.invalidReason};{const[o,a]=x8e(s),l=RegExp(o,"i"),[c,u]=T8e(e,l,a),[d,f,m]=u?S8e(u):[null,null,void 0];if(SA(u,"a")&&SA(u,"H"))throw new tM("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:r,regex:l,rawMatches:c,matches:u,result:d,zone:f,specificOffset:m}}}function M8e(t,e,i){const{result:r,zone:s,specificOffset:n,invalidReason:o}=eSe(t,e,i);return[r,s,n,o]}function tSe(t,e){if(!t)return null;const r=ql.create(e,t).dtFormatter(E8e()),s=r.formatToParts(),n=r.resolvedOptions();return s.map(o=>w8e(o,t,n))}const CH="Invalid DateTime",Rce=864e13;function AN(t){return new Tf("unsupported zone",`the zone "${t.name}" is not supported`)}function MH(t){return t.weekData===null&&(t.weekData=IV(t.c)),t.weekData}function AH(t){return t.localWeekData===null&&(t.localWeekData=IV(t.c,t.loc.getMinDaysInFirstWeek(),t.loc.getStartOfWeek())),t.localWeekData}function vw(t,e){const i={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new yi({...i,...e,old:i})}function iSe(t,e,i){let r=t-e*60*1e3;const s=i.offset(r);if(e===s)return[r,e];r-=(s-e)*60*1e3;const n=i.offset(r);return s===n?[r,s]:[t-Math.min(s,n)*60*1e3,Math.max(s,n)]}function PN(t,e){t+=e*60*1e3;const i=new Date(t);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function J5(t,e,i){return iSe($j(t),e,i)}function $ce(t,e){const i=t.o,r=t.c.year+Math.trunc(e.years),s=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,n={...t.c,year:r,month:s,day:Math.min(t.c.day,LV(r,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=kr.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=$j(n);let[l,c]=iSe(a,i,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function wO(t,e,i,r,s,n){const{setZone:o,zone:a}=i;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=yi.fromObject(t,{...i,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return yi.invalid(new Tf("unparsable",`the input "${s}" can't be parsed as ${r}`))}function ON(t,e,i=!0){return t.isValid?ql.create(xs.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(t,e):null}function PH(t,e){const i=t.c.year>9999||t.c.year<0;let r="";return i&&t.c.year>=0&&(r+="+"),r+=Po(t.c.year,i?6:4),e?(r+="-",r+=Po(t.c.month),r+="-",r+=Po(t.c.day)):(r+=Po(t.c.month),r+=Po(t.c.day)),r}function Ice(t,e,i,r,s,n){let o=Po(t.c.hour);return e?(o+=":",o+=Po(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!i)&&(o+=":")):o+=Po(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!i)&&(o+=Po(t.c.second),(t.c.millisecond!==0||!r)&&(o+=".",o+=Po(t.c.millisecond,3))),s&&(t.isOffsetFixed&&t.offset===0&&!n?o+="Z":t.o<0?(o+="-",o+=Po(Math.trunc(-t.o/60)),o+=":",o+=Po(Math.trunc(-t.o%60))):(o+="+",o+=Po(Math.trunc(t.o/60)),o+=":",o+=Po(Math.trunc(t.o%60)))),n&&(o+="["+t.zone.ianaName+"]"),o}const rSe={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},A8e={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},P8e={ordinal:1,hour:0,minute:0,second:0,millisecond:0},sSe=["year","month","day","hour","minute","second","millisecond"],O8e=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],R8e=["year","ordinal","hour","minute","second","millisecond"];function $8e(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new oTe(t);return e}function Lce(t){switch(t.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return $8e(t)}}function Dce(t,e){const i=E1(e.zone,ro.defaultZone),r=xs.fromObject(e),s=ro.now();let n,o;if(Ri(t.year))n=s;else{for(const c of sSe)Ri(t[c])&&(t[c]=rSe[c]);const a=OTe(t)||RTe(t);if(a)return yi.invalid(a);const l=i.offset(s);[n,o]=J5(t,l,i)}return new yi({ts:n,zone:i,loc:r,o})}function Nce(t,e,i){const r=Ri(i.round)?!0:i.round,s=(o,a)=>(o=gie(o,r||i.calendary?0:2,!0),e.loc.clone(i).relFormatter(i).format(o,a)),n=o=>i.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(i.unit)return s(n(i.unit),i.unit);for(const o of i.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(t>e?-0:0,i.units[i.units.length-1])}function Fce(t){let e={},i;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],i=Array.from(t).slice(0,t.length-1)):i=Array.from(t),[e,i]}class yi{constructor(e){const i=e.zone||ro.defaultZone;let r=e.invalid||(Number.isNaN(e.ts)?new Tf("invalid input"):null)||(i.isValid?null:AN(i));this.ts=Ri(e.ts)?ro.now():e.ts;let s=null,n=null;if(!r)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(i))[s,n]=[e.old.c,e.old.o];else{const a=i.offset(this.ts);s=PN(this.ts,a),r=Number.isNaN(s.year)?new Tf("invalid input"):null,s=r?null:s,n=r?null:a}this._zone=i,this.loc=e.loc||xs.create(),this.invalid=r,this.weekData=null,this.localWeekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new yi({})}static local(){const[e,i]=Fce(arguments),[r,s,n,o,a,l,c]=i;return Dce({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,i]=Fce(arguments),[r,s,n,o,a,l,c]=i;return e.zone=ll.utcInstance,Dce({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,i={}){const r=aHe(e)?e.valueOf():NaN;if(Number.isNaN(r))return yi.invalid("invalid input");const s=E1(i.zone,ro.defaultZone);return s.isValid?new yi({ts:r,zone:s,loc:xs.fromObject(i)}):yi.invalid(AN(s))}static fromMillis(e,i={}){if(QT(e))return e<-Rce||e>Rce?yi.invalid("Timestamp out of range"):new yi({ts:e,zone:E1(i.zone,ro.defaultZone),loc:xs.fromObject(i)});throw new yu(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,i={}){if(QT(e))return new yi({ts:e*1e3,zone:E1(i.zone,ro.defaultZone),loc:xs.fromObject(i)});throw new yu("fromSeconds requires a numerical input")}static fromObject(e,i={}){e=e||{};const r=E1(i.zone,ro.defaultZone);if(!r.isValid)return yi.invalid(AN(r));const s=xs.fromObject(i),n=DV(e,Lce),{minDaysInFirstWeek:o,startOfWeek:a}=bce(n,s),l=ro.now(),c=Ri(i.specificOffset)?r.offset(l):i.specificOffset,u=!Ri(n.ordinal),d=!Ri(n.year),f=!Ri(n.month)||!Ri(n.day),m=d||f,g=n.weekYear||n.weekNumber;if((m||u)&&g)throw new tM("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(f&&u)throw new tM("Can't mix ordinal dates with month/day");const y=g||n.weekday&&!m;let v,b,w=PN(l,c);y?(v=O8e,b=A8e,w=IV(w,o,a)):u?(v=R8e,b=P8e,w=SH(w)):(v=sSe,b=rSe);let x=!1;for(const k of v){const H=n[k];Ri(H)?x?n[k]=b[k]:n[k]=w[k]:x=!0}const S=y?sHe(n,o,a):u?nHe(n):OTe(n),C=S||RTe(n);if(C)return yi.invalid(C);const M=y?_ce(n,o,a):u?vce(n):n,[O,D]=J5(M,c,r),U=new yi({ts:O,zone:r,o:D,loc:s});return n.weekday&&m&&e.weekday!==U.weekday?yi.invalid("mismatched weekday",`you can't specify both a weekday of ${n.weekday} and a date of ${U.toISO()}`):U}static fromISO(e,i={}){const[r,s]=XHe(e);return wO(r,s,i,"ISO 8601",e)}static fromRFC2822(e,i={}){const[r,s]=JHe(e);return wO(r,s,i,"RFC 2822",e)}static fromHTTP(e,i={}){const[r,s]=QHe(e);return wO(r,s,i,"HTTP",i)}static fromFormat(e,i,r={}){if(Ri(e)||Ri(i))throw new yu("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=r,o=xs.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,u]=M8e(o,e,i);return u?yi.invalid(u):wO(a,l,r,`format ${i}`,e,c)}static fromString(e,i,r={}){return yi.fromFormat(e,i,r)}static fromSQL(e,i={}){const[r,s]=n8e(e);return wO(r,s,i,"SQL",e)}static invalid(e,i=null){if(!e)throw new yu("need to specify a reason the DateTime is invalid");const r=e instanceof Tf?e:new Tf(e,i);if(ro.throwOnInvalid)throw new L6e(r);return new yi({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,i={}){const r=tSe(e,xs.fromObject(i));return r?r.map(s=>s?s.val:null).join(""):null}static expandFormat(e,i={}){return KTe(ql.parseFormat(e),xs.fromObject(i)).map(s=>s.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?MH(this).weekYear:NaN}get weekNumber(){return this.isValid?MH(this).weekNumber:NaN}get weekday(){return this.isValid?MH(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?AH(this).weekday:NaN}get localWeekNumber(){return this.isValid?AH(this).weekNumber:NaN}get localWeekYear(){return this.isValid?AH(this).weekYear:NaN}get ordinal(){return this.isValid?SH(this.c).ordinal:NaN}get monthShort(){return this.isValid?CN.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?CN.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?CN.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?CN.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,i=6e4,r=$j(this.c),s=this.zone.offset(r-e),n=this.zone.offset(r+e),o=this.zone.offset(r-s*i),a=this.zone.offset(r-n*i);if(o===a)return[this];const l=r-o*i,c=r-a*i,u=PN(l,o),d=PN(c,a);return u.hour===d.hour&&u.minute===d.minute&&u.second===d.second&&u.millisecond===d.millisecond?[vw(this,{ts:l}),vw(this,{ts:c})]:[this]}get isInLeapYear(){return iD(this.year)}get daysInMonth(){return LV(this.year,this.month)}get daysInYear(){return this.isValid?VM(this.year):NaN}get weeksInWeekYear(){return this.isValid?W3(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?W3(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:i,numberingSystem:r,calendar:s}=ql.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:s}}toUTC(e=0,i={}){return this.setZone(ll.instance(e),i)}toLocal(){return this.setZone(ro.defaultZone)}setZone(e,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(e=E1(e,ro.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(i||r){const n=e.offset(this.ts),o=this.toObject();[s]=J5(o,n,e)}return vw(this,{ts:s,zone:e})}else return yi.invalid(AN(e))}reconfigure({locale:e,numberingSystem:i,outputCalendar:r}={}){const s=this.loc.clone({locale:e,numberingSystem:i,outputCalendar:r});return vw(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const i=DV(e,Lce),{minDaysInFirstWeek:r,startOfWeek:s}=bce(i,this.loc),n=!Ri(i.weekYear)||!Ri(i.weekNumber)||!Ri(i.weekday),o=!Ri(i.ordinal),a=!Ri(i.year),l=!Ri(i.month)||!Ri(i.day),c=a||l,u=i.weekYear||i.weekNumber;if((c||o)&&u)throw new tM("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&o)throw new tM("Can't mix ordinal dates with month/day");let d;n?d=_ce({...IV(this.c,r,s),...i},r,s):Ri(i.ordinal)?(d={...this.toObject(),...i},Ri(i.day)&&(d.day=Math.min(LV(d.year,d.month),d.day))):d=vce({...SH(this.c),...i});const[f,m]=J5(d,this.o,this.zone);return vw(this,{ts:f,o:m})}plus(e){if(!this.isValid)return this;const i=kr.fromDurationLike(e);return vw(this,$ce(this,i))}minus(e){if(!this.isValid)return this;const i=kr.fromDurationLike(e).negate();return vw(this,$ce(this,i))}startOf(e,{useLocaleWeeks:i=!1}={}){if(!this.isValid)return this;const r={},s=kr.normalizeUnit(e);switch(s){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(s==="weeks")if(i){const n=this.loc.getStartOfWeek(),{weekday:o}=this;o<n&&(r.weekNumber=this.weekNumber-1),r.weekday=n}else r.weekday=1;if(s==="quarters"){const n=Math.ceil(this.month/3);r.month=(n-1)*3+1}return this.set(r)}endOf(e,i){return this.isValid?this.plus({[e]:1}).startOf(e,i).minus(1):this}toFormat(e,i={}){return this.isValid?ql.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,e):CH}toLocaleString(e=$V,i={}){return this.isValid?ql.create(this.loc.clone(i),e).formatDateTime(this):CH}toLocaleParts(e={}){return this.isValid?ql.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=PH(this,o);return a+="T",a+=Ice(this,o,i,r,s,n),a}toISODate({format:e="extended"}={}){return this.isValid?PH(this,e==="extended"):null}toISOWeekDate(){return ON(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+Ice(this,o==="extended",i,e,r,n):null}toRFC2822(){return ON(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return ON(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?PH(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let s="HH:mm:ss.SSS";return(i||e)&&(r&&(s+=" "),i?s+="z":e&&(s+="ZZ")),ON(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():CH}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const i={...this.c};return e.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,i="milliseconds",r={}){if(!this.isValid||!e.isValid)return kr.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...r},n=lHe(i).map(kr.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=d8e(a,l,n,s);return o?c.negate():c}diffNow(e="milliseconds",i={}){return this.diff(yi.now(),e,i)}until(e){return this.isValid?kn.fromDateTimes(this,e):this}hasSame(e,i,r){if(!this.isValid)return!1;const s=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(i,r)<=s&&s<=n.endOf(i,r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const i=e.base||yi.fromObject({},{zone:this.zone}),r=e.padding?this<i?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(s=e.unit,n=void 0),Nce(i,this.plus(r),{...e,numeric:"always",units:s,unit:n})}toRelativeCalendar(e={}){return this.isValid?Nce(e.base||yi.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(yi.isDateTime))throw new yu("min requires all arguments be DateTimes");return wce(e,i=>i.valueOf(),Math.min)}static max(...e){if(!e.every(yi.isDateTime))throw new yu("max requires all arguments be DateTimes");return wce(e,i=>i.valueOf(),Math.max)}static fromFormatExplain(e,i,r={}){const{locale:s=null,numberingSystem:n=null}=r,o=xs.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return eSe(o,e,i)}static fromStringExplain(e,i,r={}){return yi.fromFormatExplain(e,i,r)}static get DATE_SHORT(){return $V}static get DATE_MED(){return aTe}static get DATE_MED_WITH_WEEKDAY(){return F6e}static get DATE_FULL(){return lTe}static get DATE_HUGE(){return cTe}static get TIME_SIMPLE(){return uTe}static get TIME_WITH_SECONDS(){return hTe}static get TIME_WITH_SHORT_OFFSET(){return dTe}static get TIME_WITH_LONG_OFFSET(){return pTe}static get TIME_24_SIMPLE(){return fTe}static get TIME_24_WITH_SECONDS(){return mTe}static get TIME_24_WITH_SHORT_OFFSET(){return gTe}static get TIME_24_WITH_LONG_OFFSET(){return yTe}static get DATETIME_SHORT(){return _Te}static get DATETIME_SHORT_WITH_SECONDS(){return vTe}static get DATETIME_MED(){return bTe}static get DATETIME_MED_WITH_SECONDS(){return wTe}static get DATETIME_MED_WITH_WEEKDAY(){return k6e}static get DATETIME_FULL(){return xTe}static get DATETIME_FULL_WITH_SECONDS(){return TTe}static get DATETIME_HUGE(){return STe}static get DATETIME_HUGE_WITH_SECONDS(){return ETe}}function xO(t){if(yi.isDateTime(t))return t;if(t&&t.valueOf&&QT(t.valueOf()))return yi.fromJSDate(t);if(t&&typeof t=="object")return yi.fromObject(t);throw new yu(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const Kd="system",CS="unknown",Yg="UTC",I8e=Intl.DateTimeFormat().resolvedOptions().timeZone,L8e="shortOffset";function D8e(t){return"timeZoneIANA"in t}function N8e(t){return t.startsWith("UTC")}function NV(t,e=!1){return{json:{read:{source:t,reader:(i,r)=>r[t]?Q5(r[t]):null},write:!!e&&{allowNull:!0,writer(i,r){r[t]=i?F8e(i):null}}}}}function Q5(t,e=Kd){return t?D8e(t)?t.timeZoneIANA:k8e(t,e):e}function F8e(t){return{timeZoneIANA:t}}function k8e(t,e=Kd){if(!t||!ace.has(t.timeZone))return e;const i=ace.get(t.timeZone);return N8e(t.timeZone)||t.respectsDaylightSaving?i:U8e(i)}function U8e(t){const e=yi.local().setZone(t),i=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return i===0?"Etc/UTC":`Etc/GMT${ll.instance(-i).formatOffset(0,"narrow")}`}function nSe(t,e,i,r,s){if(e&&s==="date")return{timeZone:Yg,timeZoneName:void 0};const n=r.timeStyle||r.hour,o=i===CS;return{timeZone:o?s==="timestamp-offset"?void 0:t??Yg:i,timeZoneName:o&&n?L8e:void 0}}const V8e={year:void 0,month:void 0,day:void 0,weekday:void 0},z8e={hour:void 0,minute:void 0,second:void 0},oSe={timeZone:Yg},am={year:"numeric",month:"numeric",day:"numeric"},TO={year:"numeric",month:"long",day:"numeric"},SO={year:"numeric",month:"short",day:"numeric"},EO={year:"numeric",month:"long",weekday:"long",day:"numeric"},d1={hour:"numeric",minute:"numeric"},ax={...d1,second:"numeric"},aSe={hourCycle:"h23"},CO={...d1,...aSe},MO={...ax,...aSe},lSe={"short-date":am,"short-date-short-time":{...am,...d1},"short-date-short-time-24":{...am,...CO},"short-date-long-time":{...am,...ax},"short-date-long-time-24":{...am,...MO},"short-date-le":am,"short-date-le-short-time":{...am,...d1},"short-date-le-short-time-24":{...am,...CO},"short-date-le-long-time":{...am,...ax},"short-date-le-long-time-24":{...am,...MO},"long-month-day-year":TO,"long-month-day-year-short-time":{...TO,...d1},"long-month-day-year-short-time-24":{...TO,...CO},"long-month-day-year-long-time":{...TO,...ax},"long-month-day-year-long-time-24":{...TO,...MO},"day-short-month-year":SO,"day-short-month-year-short-time":{...SO,...d1},"day-short-month-year-short-time-24":{...SO,...CO},"day-short-month-year-long-time":{...SO,...ax},"day-short-month-year-long-time-24":{...SO,...MO},"long-date":EO,"long-date-short-time":{...EO,...d1},"long-date-short-time-24":{...EO,...CO},"long-date-long-time":{...EO,...ax},"long-date-long-time-24":{...EO,...MO},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":d1,"long-time":ax},B8e=Kl()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),cSe={ar:"ar-u-nu-latn-ca-gregory"};let PW=new WeakMap;const Dj=lSe["short-date-short-time"];function j8e(t){let e=PW.get(t);if(!e){const i=Ou(),r=cSe[i]||i,s=wie(t.timeZone??Kd),n={...t,timeZone:s};e=new Intl.DateTimeFormat(r,n),PW.set(t,e)}return e}function C1(t){return lSe[t]}function Mu(t,e=Dj){return j8e(e).format(t)}function G8e(t,e=Dj){return Mu(new Date(t),{...e,...oSe,...z8e})}function H8e(t,e=Dj){return Mu(new Date(`1970-01-01T${t}Z`),{...e,...oSe,...V8e})}function q8e(t,e=Dj){if(e.timeZone)return Mu(new Date(t),e);const i=yi.fromISO(t,{setZone:!0}),r=Ou(),s=cSe[r]??r,n=i.offset===0?Yg:e.timeZone,o={...e,timeZone:n};return i.toLocaleString(o,{locale:s})}function wie(t){switch(t){case Kd:return I8e;case CS:return Yg;default:return t}}die(()=>{PW=new WeakMap});const W8e={ar:"ar-u-nu-latn"};let K5=new WeakMap,uSe={};function OW(t){const e=t||uSe;if(!K5.has(e)){const i=Ou(),r=W8e[Ou()]||i;K5.set(e,new Intl.NumberFormat(r,t))}return K5.get(e)}function FV(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function Xl(t,e){return Object.is(t,-0)&&(t=0),OW(e).format(t)}function r8t(t,e=Ou()){var r,s;if(!t)return null;let i=kce.get(e);if(!i){const n=OW().formatToParts(12345.6),o=[...OW({useGrouping:!1}).format(9876543210)].reverse(),a=new Map(o.map((m,g)=>[m,g])),l=new RegExp(`[${(r=n.find(m=>m.type==="group"))==null?void 0:r.value}]`,"g"),c=new RegExp(`[${(s=n.find(m=>m.type==="decimal"))==null?void 0:s.value}]`),u=new RegExp(`[${o.join("")}]`,"g"),d=/[\u200E\u200F\u202A\u202B\u202C\u202D\u202E\u2066\u2067\u2068\u2069\u061C]/g,f=/[-\u2212\u2013\u2014\u2015]/g;i=m=>{if((m=m.trim().replaceAll(l,"").replace(c,".").replace(u,y=>String(a.get(y))).replaceAll(d,"").replaceAll(f,"-"))==="")return null;const g=Number(m);return isNaN(g)?null:g},kce.set(e,i)}return i(t)}die(()=>{K5=new WeakMap,uSe={}});const kce=new Map;var Bwe;const rr={apiKey:void 0,applicationName:"",applicationUrl:(Bwe=globalThis.location)==null?void 0:Bwe.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!0,portalUrl:"https://www.arcgis.com",respectPrefersReducedMotion:!0,routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],internalInterceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(hie(rr,globalThis.esriConfig,!0),delete rr.has),!rr.assetsPath){{const t="4.30";rr.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}rr.defaultAssetsPath=rr.assetsPath}const Z8e=/\{([^}]+)\}/g;function Uce(t){return t??""}function Xg(t,e){return e?t.replaceAll(Z8e,typeof e=="object"?(i,r)=>Uce(tD(r,e)):(i,r)=>Uce(e(r))):t}function s8t(t,e){return t.replaceAll(/([.$?*|{}()[\]\\/+\-^])/g,i=>e!=null&&e.includes(i)?i:`\\${i}`)}function xie(t){let e=0;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}let Vce;function n8t(t){return Vce??(Vce=new DOMParser),Vce.parseFromString(t||"","text/html").body.innerText||""}function zce(t,e){return new RegExp(`{${e}}`,"ig").test(t)}function Y8e(t,...e){let i=t[0];for(let r=0;r<e.length;++r)i+=e[r]+t[r+1];return i}const Bce={info:0,warn:1,error:2,none:3};let se=class Yu{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,Yu._loggers.set(this.module,this);const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=Yu.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){}static get test(){}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,Yu._loggers.get(e)||new Yu({module:e})}_log(e,i,...r){if(this._matchLevel(e)){if(i!=="always"&&!Yu._throttlingDisabled){const s=J8e(r),n=this._loggedMessages[e].get(s);if(i==="once"&&n!=null||i==="oncePerTick"&&n&&n>=Yu._tickCounter)return;this._loggedMessages[e].set(s,Yu._tickCounter),Yu._scheduleTickCounterIncrement()}for(const s of rr.log.interceptors)if(s(e,this.module,...r))return;this._inheritedWriter()(e,this.module,...r)}}_parentWithMember(e,i){let r=this;for(;r!=null;){const s=r[e];if(s!=null)return s;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",X8e)}_matchLevel(e){const i=rr.log.level||"warn";return Bce[this._parentWithMember("level",i)]<=Bce[e]}static _scheduleTickCounterIncrement(){Yu._tickCounterScheduled||(Yu._tickCounterScheduled=!0,Promise.resolve().then(()=>{Yu._tickCounter++,Yu._tickCounterScheduled=!1}))}};function X8e(t,e,...i){console[t](`[${e}]`,...i)}function J8e(...t){return xie(JSON.stringify(t,(i,r)=>typeof r!="object"||Array.isArray(r)?r:"[Object]"))}se._loggers=new Map,se._tickCounter=0,se._tickCounterScheduled=!1,se._throttlingDisabled=!1;const hSe=()=>se.getLogger("esri.intl.substitute");function dg(t,e,i={}){const{format:r={}}=i;return Xg(t,s=>Q8e(s,e,r))}function Q8e(t,e,i){let r,s;const n=t.indexOf(":");if(n===-1?r=t.trim():(r=t.slice(0,n).trim(),s=t.slice(n+1).trim()),!r)return"";const o=tD(r,e);if(o==null)return"";const a=(s?i==null?void 0:i[s]:null)??(i==null?void 0:i[r]);return a?K8e(o,a):s?eqe(o,s):Tie(o)}function K8e(t,e){switch(e.type){case"date":return Mu(t,e.intlOptions);case"number":return Xl(t,e.intlOptions);default:return hSe().warn("missing format descriptor for key {key}"),Tie(t)}}function eqe(t,e){switch(e.toLowerCase()){case"dateformat":return Mu(t);case"numberformat":return Xl(t);default:return hSe().warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?Mu(t):/^numberformat/i.test(e)?Xl(t):Tie(t)}}function Tie(t){switch(typeof t){case"string":return t;case"number":return Xl(t);case"boolean":return""+t;default:return t instanceof Date?Mu(t):""}}function tqe(t,e){return t.replaceAll(/\$\{([^\s:}]*)(?::([^\s:}]+))?\}/g,(i,r)=>r===""?"$":(tD(r,e)??"").toString())}let dSe=class{constructor(e,i,r=void 0){this.name=e,this.details=r,this.message=(i&&tqe(i,r))??""}toString(){return"["+this.name+"]: "+this.message}},G=class pSe extends dSe{constructor(e,i,r){super(e,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return ie(i)}catch{return"[object]"}}))}}catch(e){throw se.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new pSe(e.name,e.message,e.details)}};G.prototype.type="error";function iqe(t){return{setTimeout:(e,i)=>{const r=t.setTimeout(e,i);return Gi(()=>t.clearTimeout(r))}}}const nD=iqe(globalThis);function Nj(t){return rqe(t)||fSe(t)}function rqe(t){return t!=null&&typeof t=="object"&&"on"in t&&typeof t.on=="function"}function fSe(t){return t!=null&&typeof t=="object"&&"addEventListener"in t&&typeof t.addEventListener=="function"}function kP(t,e,i){if(!Nj(t))throw new TypeError("target is not a Evented or EventTarget object");return fSe(t)?sqe(t,e,i):t.on(e,i)}function sqe(t,e,i,r){if(Array.isArray(e)){const s=e.slice();for(const n of s)t.addEventListener(n,i,r);return Gi(()=>{for(const n of s)t.removeEventListener(n,i,r)})}return t.addEventListener(e,i,r),Gi(()=>t.removeEventListener(e,i,r))}function mSe(t,e,i){if(!Nj(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,i);const r=kP(t,e,s=>{r.remove(),i.call(t,s)});return r}function Fj(t,e){if(t==null)throw new Error(e??"value is None")}function qe(t){return t==null||t.destroy(),null}function Ut(t){return t==null||t.dispose(),null}function $r(t){return t==null||t.remove(),null}function Jl(t){return t==null||t.abort(),null}function hi(t){return t==null||t.release(),null}function nqe(t,e,i){return t!=null&&e!=null?i!=null?i(t,e):t.equals(e):t===e}function jce(t,e){return t==null?void 0:t[e]}function oqe(t,e){let i;return t.some((r,s)=>(i=e(r,s),i!=null)),i??void 0}function ki(t="Aborted"){return new G("AbortError",t)}function Dt(t,e="Aborted"){if(ra(t))throw ki(e)}function kj(t){return t instanceof AbortSignal?t:t==null?void 0:t.signal}function ra(t){const e=kj(t);return e!=null&&e.aborted}function jl(t){if(os(t))throw t}function RW(t){if(!os(t))throw t}function Ra(t,e){const i=kj(t);if(i!=null){if(!i.aborted)return mSe(i,"abort",()=>e());e()}}function oD(t,e){const i=kj(t);if(i!=null)return Dt(i),mSe(i,"abort",()=>e(ki()))}function Sie(t,e){return kj(e)==null?t:new Promise((i,r)=>{let s=Ra(e,()=>r(ki()));const n=()=>{s=$r(s)};t.then(n,n),t.then(i,r)})}function os(t){return(t==null?void 0:t.name)==="AbortError"}async function H0(t){try{return await t}catch(e){if(!os(e))throw e;return}}async function a8t(t,e=se.getLogger("esri")){try{return await t}catch(i){os(i)||e.error(i)}}async function jf(t){if(!t)return;if(typeof t.forEach!="function"){const i=Object.keys(t),r=i.map(o=>t[o]),s=await jf(r),n={};return i.map((o,a)=>n[o]=s[a]),n}const e=t;return Promise.allSettled(e).then(i=>Array.from(e,(r,s)=>{const n=i[s];return n.status==="fulfilled"?{promise:r,value:n.value}:{promise:r,error:n.reason}}))}async function $W(t){return(await Promise.allSettled(t)).filter(e=>e.status==="fulfilled").map(e=>e.value)}async function aqe(t){return(await Promise.allSettled(t)).filter(e=>e.status==="rejected").map(e=>e.reason)}function MS(t,e=void 0,i){const r=new AbortController;return Ra(i,()=>r.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(e)},t);Ra(r,()=>{o&&(clearTimeout(o),n(ki()))})})}function lqe(t,e){const i=new AbortController,r=setTimeout(()=>i.abort(),e);return Ra(t,()=>{i.abort(),clearTimeout(r)}),{...t,signal:i.signal}}function Fu(t){return t&&typeof t.then=="function"}function IW(t){return Fu(t)?t:Promise.resolve(t)}function q0(t,e=-1){let i,r,s,n,o=null;const a=(...l)=>{if(i){r=l,n&&n.reject(ki()),n=aa();const f=n.promise;if(o){const m=o;o=null,m.abort()}return f}if(s=n||aa(),n=null,e>0){const f=new AbortController;i=IW(t(...l,f.signal));const m=i;MS(e).then(()=>{i===m&&(n?f.abort():o=f)})}else i=1,i=IW(t(...l));const c=()=>{const f=r;r=s=i=o=null,f!=null&&a(...f)},u=i,d=s;return u.then(c,c),u.then(d.resolve,d.reject),d.promise};return a}function aa(){let t,e;const i=new Promise((s,n)=>{t=s,e=n}),r=s=>{t(s)};return r.resolve=s=>t(s),r.reject=s=>e(s),r.timeout=(s,n)=>nD.setTimeout(()=>r.reject(n),s),r.promise=i,r}function l8t(t,e){return t.then(e,e)}async function Gce(t){await Promise.resolve(),Dt(t)}const Hce=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,cqe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function qce(t){return t in cqe}const LR=[],BM=new Map;function Wce(t){for(const e of BM.keys())ySe(t.pattern,e)&&BM.delete(e)}function uqe(t){return LR.includes(t)||(Wce(t),LR.unshift(t)),Gi(()=>{const e=LR.indexOf(t);e>-1&&(LR.splice(e,1),Wce(t))})}async function gSe(t){const e=Ou();BM.has(t)||BM.set(t,dqe(t,e));const i=BM.get(t);return i&&await pqe.add(i),i}function hqe(t){if(!Hce.test(t))return null;const e=Hce.exec(t);if(e===null)return null;const[,i,r]=e,s=i+(r?"-"+r.toUpperCase():"");return qce(s)?s:qce(i)?i:null}async function dqe(t,e){const i=[];for(const r of LR)if(ySe(r.pattern,t))try{return await r.fetchMessageBundle(t,e)}catch(s){i.push(s)}throw i.length?new G("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:i}):new G("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function ySe(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}die(()=>{BM.clear()});const pqe=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=aa())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}},fqe="modulepreload",mqe=function(t){return"/digital-twin/"+t},Zce={},ce=function(e,i,r){let s=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),o=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));s=Promise.all(i.map(a=>{if(a=mqe(a),a in Zce)return;Zce[a]=!0;const l=a.endsWith(".css"),c=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${c}`))return;const u=document.createElement("link");if(u.rel=l?"stylesheet":fqe,l||(u.as="script",u.crossOrigin=""),u.href=a,o&&u.setAttribute("nonce",o),document.head.appendChild(u),l)return new Promise((d,f)=>{u.addEventListener("load",d),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${a}`)))})}))}return s.then(()=>e()).catch(n=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n})};function h(t,e,i,r){var s,n=arguments.length,o=n<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(n<3?s(o):n>3?s(e,i,o):s(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o}function c8t(t,e){return function(i,r){e(i,r,t)}}function u8t(t,e,i,r){function s(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?n(u.value):s(u.value).then(a,l)}c((r=r.apply(t,[])).next())})}const Yce=new WeakMap;function gqe(t,e,i=!1){const r=`🛑 DEPRECATED - ${e}`;if(!i)return void t.warn(r);let s=Yce.get(t);s||(s=new Set,Yce.set(t,s)),s.has(e)||(s.add(e),t.warn(r))}function _Se(t,e,i={}){if(le("esri-deprecation-warnings")){const{moduleName:r}=i;fb(t,`Function: ${(r?r+"::":"")+e+"()"}`,i)}}function DR(t,e,i={}){if(le("esri-deprecation-warnings")){const{moduleName:r}=i;fb(t,`Property: ${(r?r+"::":"")+e}`,i)}}function yqe(t,e,i={}){le("esri-deprecation-warnings")&&fb(t,`Multiple argument constructor: ${e}`,{warnOnce:!0,replacement:`new ${e}({ <your properties here> })`,...i})}function fb(t,e,i={}){if(le("esri-deprecation-warnings")){const{replacement:r,version:s,see:n,warnOnce:o}=i;let a=e;r&&(a+=`
	🛠️ Replacement: ${r}`),s&&(a+=`
	⚙️ Version: ${s}`),n&&(a+=`
	🔗 See ${n} for more details.`),gqe(t,a,o)}}function h8t(t){const e=[];return function*(){yield*e;for(const i of t)e.push(i),yield i}}function _qe(t,e){for(const i of t)if(i!=null&&e(i))return i}function LW(t){return t!=null&&typeof t[Symbol.iterator]=="function"}let ly=class{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(i=>{e+=i.length}),e}add(e,i){if(LW(e)){const r=this._getOrCreateGroup(i);for(const s of e)Jce(s)&&r.push(s)}else Jce(e)&&this._getOrCreateGroup(i).push(e);return this}forEach(e,i){if(typeof e=="function")this._groups.forEach(r=>r.forEach(e));else{const r=this._getGroup(e);r&&i&&r.forEach(i)}}has(e){return this._groups.has(RN(e))}remove(e){if(typeof e!="string"&&LW(e)){for(const i of e)this.remove(i);return this}return this.has(e)?(Xce(this._getGroup(e)),this._groups.delete(RN(e)),this):this}removeAll(){return this._groups.forEach(Xce),this._groups.clear(),this}removeReference(e){return this._groups.delete(e),this}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const i=[];return this._groups.set(RN(e),i),i}_getGroup(e){return this._groups.get(RN(e))}};function RN(t){return t||"_default_"}function Xce(t){for(const e of t)e instanceof ly?e.removeAll():e.remove()}function Jce(t){return t!=null&&(!!t.remove||t instanceof ly)}const vSe=Symbol("Accessor-beforeDestroy");function hl(t){return t.__accessor__??null}function vqe(t,e){var i;return((i=t==null?void 0:t.metadata)==null?void 0:i[e])!=null}function ek(t,e,i){return i?kV(t,e,{policy:i,path:""}):kV(t,e,null)}function kV(t,e,i){return e?Object.keys(e).reduce((r,s)=>{const n=s;let o=null,a="merge";if(i&&(o=i.path?`${i.path}.${s}`:s,a=i.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(r[n]))return r[n]=e[n],r;if(r[n]===void 0)return r[n]=ie(e[n]),r;let l=r[n],c=e[n];if(l===c)return r;if(Array.isArray(c)||Array.isArray(r))l=l?Array.isArray(l)?r[n]=l.concat():r[n]=[l]:r[n]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(u=>{l.includes(u)||l.push(u)}));else if(c&&typeof c=="object")if(i){const u=i.path;i.path=o,r[n]=kV(l,c,i),i.path=u}else r[n]=kV(l,c,null);else r.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(r[n]=c);return r},t||{}):t}function bSe(t){return Array.isArray(t)?t:t.split(".")}function Qce(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function bqe(t){if(Array.isArray(t)){const e=[];for(const i of t)e.push(...Qce(i));return e}return Qce(t)}function wSe(t,e,i,r){const s=bqe(e);if(s.length!==1){const n=s.map(o=>r(t,o,i));return ES(n)}return r(t,s[0],i)}function xSe(t,e){const i=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(e)?e[s]:e.at(s)}const r=hl(e);return vqe(r,i)?r.get(i):e[i]}function TSe(t,e,i){if(t==null)return t;const r=xSe(e[i],t);return!r&&i<e.length-1?void 0:i===e.length-1?r:TSe(r,e,i+1)}function aD(t,e,i=0){return typeof e!="string"||e.includes(".")?TSe(t,bSe(e),i):xSe(e,t)}function Df(t,e){return aD(t,e)}function Kce(t,e){return aD(e,t)!==void 0}var _u;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED",t[t.DESTROYED=3]="DESTROYED"})(_u||(_u={}));function lD(t){let e=t.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!i){e=Object.create(e);for(const r in e)e[r]=ie(e[r]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function Uj(t,e){const i=lD(t);let r=i[e];return r||(r=i[e]={}),r}function wqe(t,e){return ek(t,e,Tqe)}const xqe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function Tqe(t){return xqe.test(t)?"replace":"merge"}function Sqe(t){return(t==null?void 0:t.release)&&typeof t.release=="function"}function Eqe(t){return(t==null?void 0:t.acquire)&&typeof t.acquire=="function"}let la=class DW{constructor(e,i,r,s=1,n=0){if(this._ctor=e,this._acquireFunction=i,this._releaseFunction=r,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this._ctor)for(let o=0;o<n;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...e){let i;if(DW.test.disabled)i=new this._ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let s=0;s<r;s++)this._pool[s]=new this._ctor}i=this._pool.pop()}return this._acquireFunction?this._acquireFunction(i,...e):Eqe(i)&&i.acquire(...e),i}release(e){e&&!DW.test.disabled&&(this._releaseFunction?this._releaseFunction(e):Sqe(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let i=e;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};la.test={disabled:!1};let Cqe=class{constructor(e,i){this._observers=e,this._observer=i}remove(){Vxe(this._observers,this._observer)}},SSe=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return Mqe;this._observers==null&&(this._observers=[]);const i=this._observers;let r=!1,s=!1;const n=i.length;for(let o=0;o<n;++o){const a=i[o];if(a.destroyed)s=!0;else if(a===e){r=!0;break}}return r||(i.push(e),s&&this._removeDestroyedObservers()),new Cqe(i,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const i=e.length;let r=0;for(let s=0;s<i;++s){for(;s+r<i&&e[s+r].destroyed;)++r;if(r>0){if(!(s+r<i))break;e[s]=e[s+r]}}e.length=i-r}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const i of e)i.onCommitted();this._observers=null}}};const Mqe=Gi();var Fi;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(Fi||(Fi={}));const NW=Fi.USER+1;function F1(t){switch(t){case"defaults":return Fi.DEFAULTS;case"service":return Fi.SERVICE;case"portal-item":return Fi.PORTAL_ITEM;case"web-scene":return Fi.WEB_SCENE;case"web-map":return Fi.WEB_MAP;case"link-chart":return Fi.LINK_CHART;case"user":return Fi.USER;default:return null}}function UV(t){switch(t){case Fi.DEFAULTS:return"defaults";case Fi.SERVICE:return"service";case Fi.PORTAL_ITEM:return"portal-item";case Fi.WEB_SCENE:return"web-scene";case Fi.WEB_MAP:return"web-map";case Fi.LINK_CHART:return"link-chart";case Fi.USER:return"user"}}function Aqe(t){return UV(t)}var cs;(function(t){t[t.Dirty=1]="Dirty",t[t.Overridden=2]="Overridden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(cs||(cs={}));const VV={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},NR=[];let GI=VV;function Ft(t){GI.onObservableAccessed(t)}let tk=!1,ik=!1;function s_(t,e,i){if(tk)return Eie(t,e,i);ESe(t);const r=e.call(i);return CSe(),r}function Pqe(t,e){return s_(VV,t,e)}function Eie(t,e,i){const r=tk;tk=!0,ESe(t);let s=null;try{s=e.call(i)}catch(n){ik&&se.getLogger("esri.core.accessorSupport.tracking").error(n)}return CSe(),tk=r,s}function ESe(t){GI=t,NR.push(t)}function CSe(){const t=NR.length;if(t>1){const e=NR.pop();GI=NR[t-2],e.onTrackingEnd()}else if(t===1){const e=NR.pop();GI=VV,e.onTrackingEnd()}else GI=VV}function MSe(t,e){if(e.flags&cs.DepTrackingInitialized)return;const i=ik;ik=!1,e.flags&cs.AutoTracked?Eie(e,e.metadata.get,t):ASe(t,e),ik=i}const Oqe=[];function ASe(t,e){e.flags&cs.ExplicitlyTracking||(e.flags|=cs.ExplicitlyTracking,Eie(e,()=>{const i=e.metadata.dependsOn||Oqe;for(const r of i)if(typeof r!="string"||r.includes(".")){const s=bSe(r);for(let n=0,o=t;n<s.length&&o!=null&&typeof o=="object";++n)o=eue(o,s[n],n!==s.length-1)}else eue(t,r,!1)}),e.flags&=~cs.ExplicitlyTracking)}function eue(t,e,i){const r=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const n=parseInt(r,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.at(n)}const s=hl(t);if(s){const n=s.propertiesByName.get(r);n&&(Ft(n),MSe(t,n))}return i?t[r]:void 0}let tue=class extends SSe{constructor(e,i){super(),this.propertyName=e,this.metadata=i,this._accessed=null,this._handles=null,this.flags=0,this.flags=cs.Dirty|(i.nonNullable?cs.NonNullable:0)|(i.hasOwnProperty("value")?cs.HasDefaultValue:0)|(i.get===void 0?cs.DepTrackingInitialized:0)|(i.dependsOn===void 0?cs.AutoTracked:0)}destroy(){this.flags&cs.Dirty&&this.onCommitted(),super.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(e){Ft(this);const i=e.store,r=this.propertyName,s=this.flags,n=i.get(r);if(s&cs.Computing||~s&cs.Dirty&&i.has(r))return n;this.flags|=cs.Computing;const o=e.host;let a;s&cs.AutoTracked?a=s_(this,this.metadata.get,o):(ASe(o,this),a=this.metadata.get.call(o)),i.set(r,a,Fi.COMPUTED);const l=i.get(r);return l===n?this.flags&=~cs.Dirty:Pqe(this.commit,this),this.flags&=~cs.Computing,l}onObservableAccessed(e){e!==this&&(this._accessed??(this._accessed=new Set),this._accessed.add(e))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=cs.DepTrackingInitialized,this._accessed!=null&&(this._handles??(this._handles=[]),this._accessed.forEach(e=>{this._handles.push(e.observe(this))}),this._accessed.clear())}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=~cs.Dirty,this.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let i=0;i<e.length;++i)e[i].remove();e.length=0}}onInvalidated(){~this.flags&cs.Overridden&&(this.flags|=cs.Dirty);const e=this._observers;if(e&&e.length>0)for(const i of e)i.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onCommitted()}}},Rqe=class PSe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new PSe;return this._values.forEach((r,s)=>{e&&e.has(s)||i.set(s,ie(r))}),i}get(e){return this._values.get(e)}originOf(){return Fi.USER}keys(){return[...this._values.keys()]}set(e,i){this._values.set(e,i)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function $N(t,e,i){return t!==void 0}function iue(t,e,i,r){return t!==void 0&&(!(i==null&&t.flags&cs.NonNullable)||(r.lifecycle,_u.INITIALIZING,!1))}let $qe=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.lifecycle=_u.INITIALIZING,this.store=new Rqe,this._origin=Fi.USER;const i=this.host.constructor.__accessorMetadata__;for(const r in i){const s=new tue(r,i[r]);this.propertiesByName.set(r,s)}this.metadata=i}initialize(){this.lifecycle=_u.CONSTRUCTING}constructed(){this.lifecycle=_u.CONSTRUCTED}destroy(){this.lifecycle=_u.DESTROYED,this.propertiesByName.forEach(e=>e.destroy())}get initialized(){return this.lifecycle!==_u.INITIALIZING}get(e){const i=this.propertiesByName.get(e);if(i.metadata.get)return i.getComputed(this);Ft(i);const r=this.store;return r.has(e)?r.get(e):i.metadata.value}originOf(e){const i=this.store.originOf(e);if(i===void 0){const r=this.propertiesByName.get(e);if(r!==void 0&&r.flags&cs.HasDefaultValue)return"defaults"}return UV(i)}has(e){return this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const i=this.propertiesByName.get(e);if($N(i))return this.store.has(e)?this.store.get(e):i.metadata.value}internalSet(e,i){const r=this.propertiesByName.get(e);$N(r)&&this._internalSet(r,i)}getDependsInfo(e,i,r){const s=this.propertiesByName.get(i);if(!$N(s))return"";const n=new Set,o=s_({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=s.metadata.get)==null?void 0:l.call(e)});let a=`${r}${e.declaredClass.split(".").pop()}.${i}: ${o}
`;if(n.size===0)return a;r+="  ";for(const l of n)l instanceof tue&&(a+=`${r}${l.propertyName}: undefined
`);return a}setAtOrigin(e,i,r){const s=this.propertiesByName.get(e);if($N(s))return this._setAtOrigin(s,i,r)}isOverridden(e){const i=this.propertiesByName.get(e);return i!==void 0&&!!(i.flags&cs.Overridden)}clearOverride(e){const i=this.propertiesByName.get(e);i&&i.flags&cs.Overridden&&(i.flags&=~cs.Overridden,i.notifyChange())}override(e,i){const r=this.propertiesByName.get(e);if(!iue(r,e,i,this))return;const s=r.metadata.cast;if(s){const n=this._cast(s,i),{valid:o,value:a}=n;if(OH.release(n),!o)return;i=a}r.flags|=cs.Overridden,this._internalSet(r,i)}set(e,i){const r=this.propertiesByName.get(e);if(!iue(r,e,i,this))return;const s=r.metadata.cast;if(s){const o=this._cast(s,i),{valid:a,value:l}=o;if(OH.release(o),!a)return;i=l}const n=r.metadata.set;n?n.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(e){this._origin=F1(e)}getDefaultOrigin(){return UV(this._origin)}notifyChange(e){const i=this.propertiesByName.get(e);i!==void 0&&i.notifyChange()}invalidate(e){const i=this.propertiesByName.get(e);i!==void 0&&i.invalidate()}commit(e){const i=this.propertiesByName.get(e);i!==void 0&&i.commit()}_internalSet(e,i){const r=this.lifecycle!==_u.INITIALIZING?this._origin:Fi.DEFAULTS;this._setAtOrigin(e,i,r)}_setAtOrigin(e,i,r){const s=this.store,n=e.propertyName;s.has(n,r)&&uie(i,s.get(n))&&~e.flags&cs.Overridden&&r===s.originOf(n)||(e.invalidate(),s.set(n,i,r),e.commit(),MSe(this.host,e))}_cast(e,i){const r=OH.acquire();return r.valid=!0,r.value=i,e&&(r.value=e.call(this.host,i,r)),r}},Iqe=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const OH=new la(Iqe);function zV(t,e,i){if(t&&e)if(typeof e=="object")for(const r of Object.getOwnPropertyNames(e))zV(t,r,e[r]);else{if(e.includes(".")){const s=e.split("."),n=s.splice(-1,1)[0];return void zV(Df(t,s),n,i)}const r=t.__accessor__;r!=null&&Lqe(e,r),t[e]=i}}function Lqe(t,e){if(le("esri-unknown-property-errors")&&!Dqe(t,e))throw new G("set:unknown-property",Nqe(t,e))}function Dqe(t,e){return e.metadata[t]!=null}function Nqe(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let Fqe;function kqe(){return Fqe}var rue;(function(t){t[t.Ignore=0]="Ignore",t[t.Destroy=1]="Destroy",t[t.ThrowError=2]="ThrowError"})(rue||(rue={}));function Uqe(t){t.length=0}let vu=class{constructor(e=50,i=50){this._pool=new la(Array,void 0,Uqe,i,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return RH.acquire()}static release(e){return RH.release(e)}static prune(){RH.prune()}};const RH=new vu(100);let OSe=class extends la{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(...e){const i=super.acquire(...e);return this._set.delete(i),i}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const IN=[];function EA(t){IN.push(t),IN.length===1&&queueMicrotask(()=>{const e=IN.slice();IN.length=0;for(const i of e)i()})}let U0=class{constructor(e,i=30){this.name=e,this._counter=0,this._samples=new Array(i)}record(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,i)=>e-i)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,i)=>e+i,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var FW;(function(t){const e=(n,o,a,l)=>{let c=o,u=o;const d=a>>>1,f=n[c-1];for(;u<=d;){u=c<<1,u<a&&l(n[u-1],n[u])<0&&++u;const m=n[u-1];if(l(m,f)<=0)break;n[c-1]=m,c=u}n[c-1]=f},i=(n,o)=>n<o?-1:n>o?1:0;function r(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let u=a>>>1;u>o;u--)e(n,u,a,l);const c=o+1;for(let u=a-1;u>o;u--){const d=n[o];n[o]=n[u],n[u]=d,e(n,c,u,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let u=a>>>1;u>o;u--)e(n,u,a,l),yield;const c=o+1;for(let u=a-1;u>o;u--){const d=n[o];n[o]=n[u],n[u]=d,e(n,c,u,l),yield}}t.sort=r,t.iterableSort=s})(FW||(FW={}));const sue=FW,Vqe=1.5,zqe=1.1;let ai=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new kxe,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>nue(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const i=new Array;for(let r=0;r<this._length;r++){const s=this.data[r];e(s)&&i.push(s)}return i}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,i){const r=this.data.indexOf(e,i);return r!==-1&&r<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let i=e;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,i=e.length){for(let r=0;r<i;r++)this.data[this._length++]=e[r]}fill(e,i){for(let r=0;r<i;r++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,nue(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const i=wW(this.data,e,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(wW(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,i=e.length,r){this.length=m6e(this.data,e,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,i){if(e>=this.length||i>=this.length||e===i)return;const r=this.data[e];this.data[e]=this.data[i],this.data[i]=r}sort(e){sue.sort(this.data,0,this.length,e)}iterableSort(e){return sue.iterableSort(this.data,0,this.length,e)}some(e,i){for(let r=0;r<this.length;++r)if(e.call(i,this.data[r],r,this.data))return!0;return!1}find(e,i){for(let r=0;r<this.length;++r){const s=this.data[r];if(e.call(i,s,r))return s}}filterInPlace(e,i){let r=0;for(let s=0;s<this._length;++s){const n=this.data[s];e.call(i,n,s,this.data)&&(this.data[s]=this.data[r],this.data[r]=n,r++)}if(this._deallocator)for(let s=r;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=r,this._shrink(),this}forAll(e,i){const{data:r,length:s}=this;for(let n=0;n<s;++n)e.call(i,r[n],n,r)}forEach(e,i){this.data.slice(0,this.length).forEach(e,i)}map(e,i){const r=new Array(this.length);for(let s=0;s<this.length;++s)r[s]=e.call(i,this.data[s],s,this.data);return r}reduce(e,i){let r=i;for(let s=0;s<this.length;++s)r=e(r,this.data[s],s,this.data);return r}has(e){const i=this.length,r=this.data;for(let s=0;s<i;++s)if(r[s]===e)return!0;return!1}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.data[e]}};function nue(t){t.data.length>Vqe*t.length&&(t.data.length=Math.floor(t.length*zqe))}function x8t(t){return t}function RSe(t){return 1e3*t}function T8t(t){return t}function Cie(t){return .001*t}let Bqe=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},jqe=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},kW=0,UW=0;const AO={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},VW=["prepare","preRender","render","postRender","update","finish"],zW=[],AS=new ai;let Gqe=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};function Hqe(){KT!=null&&(cancelAnimationFrame(KT),KT=requestAnimationFrame(Mie))}const BV={frameTasks:AS,willDispatch:!1,clearFrameTasks:qqe,dispatch:ISe,executeFrameTasks:Zqe,reschedule:Hqe};function p2(t){const e=new jqe(t);return zW.push(e),BV.willDispatch||(BV.willDispatch=!0,EA(ISe)),e}function PS(t){const e=new Bqe(t);return AS.push(e),KT==null&&(kW=performance.now(),KT=requestAnimationFrame(Mie)),new Gqe(e)}let KT=null;function qqe(t=!1){AS.forAll(e=>{e.removed=!0}),t&&$Se()}function Wqe(t){UW=Math.max(0,t)}function Mie(){const t=performance.now();KT=null,KT=AS.length>0?requestAnimationFrame(Mie):null,BV.executeFrameTasks(t)}function Zqe(t){const e=t-kW;kW=t;const i=UW>0?UW:1e3/60,r=Math.max(0,e-i);AO.time=t,AO.frameDuration=i-r;for(let s=0;s<VW.length;s++){const n=performance.now(),o=VW[s];AS.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(AO.elapsedFrameTime=performance.now()-t,AO.deltaTime=a.ticks===0?0:e,(l=a.phases[o])==null||l.call(a,AO)))}),Jqe[s].record(performance.now()-n)}$Se(),Qqe.record(performance.now()-t)}const LN=new ai;function $Se(){AS.forAll(t=>{t.removed&&LN.push(t)}),AS.removeUnorderedMany(LN.data,LN.length),LN.clear()}function ISe(){for(;zW.length;){const t=zW.shift();t.isActive&&t.callback()}BV.willDispatch=!1}function Yqe(t=1,e){const i=aa(),r=()=>{ra(e)?i.reject(ki()):t===0?i():(--t,EA(()=>r()))};return r(),i.promise}function Xqe(t){return Yqe(1,t)}async function M8t(){await Xqe(),await new Promise(t=>requestAnimationFrame(t))}const Jqe=VW.map(t=>new U0(t)),Qqe=new U0("total");function rk(t,e){for(const i of t.entries())if(e(i[0]))return!0;return!1}function jV(t,e){if(!e)return t;for(const i of e)i!=null&&t.add(i);return t}function oue(t,e){return e!=null&&t.add(e),t}function LSe(t,e){const i=new Set;return jV(i,t),jV(i,e),i}function Kqe(t,e){const i=new Set;for(const r of e)t.has(r)&&i.add(r);return i}function A8t(t,e){if(!t||!e)return!1;if(t===e)return!0;for(const i of t)if(!e.has(i))return!1;return!0}function P8t(t,e){if(t==null&&e==null)return!0;if(t==null||e==null||t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function e9e(t,e){const i=new Set(t);for(const r of e)i.delete(r);return i}function t9e(t,e){return e9e(LSe(t,e),Kqe(t,e))}let i9e=0;const r9e=0;function Ph(){return++i9e}let Vj=class{constructor(e){this._accessed=new Set,this._handles=[],this._observerObject=new s9e(e),aue.register(this,new WeakRef(this._observerObject),this)}destroy(){var e;aue.unregister(this._observerObject),this._accessed.clear(),(e=this._observerObject)==null||e.destroy(),this.clear()}onObservableAccessed(e){this._accessed.add(e)}onTrackingEnd(){const e=this._handles,i=this._observerObject;this._accessed.forEach(r=>{e.push(r.observe(i))}),this._accessed.clear()}clear(){const e=this._handles;for(let i=0;i<e.length;++i)e[i].remove();e.length=0}},s9e=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=n9e}};const aue=new FinalizationRegistry(t=>{var e;(e=t.deref())==null||e.destroy()});function n9e(){}let jM=!1;const GV=[];function DSe(t,e){let i=new Vj(n),r=null,s=!1;function n(){if(!i||s)return;if(jM)return void kSe(n);const a=r;i.clear(),jM=!0,s=!0,r=s_(i,t),s=!1,jM=!1,e(r,a),USe()}function o(){i&&(i.destroy(),i=null,r=null)}return s=!0,r=s_(i,t),s=!1,Gi(o)}function NSe(t,e){let i=new Vj(s),r=null;function s(){e(r,o)}function n(){i&&(i.destroy(),i=null),r=null}function o(){return i?(i.clear(),r=s_(i,t),r):null}return o(),Gi(n)}function FSe(t){let e=new Vj(r),i=!1;function r(){e&&!i&&(jM?kSe(r):(e.clear(),jM=!0,i=!0,s_(e,t),i=!1,jM=!1,USe()))}function s(){e&&(e.destroy(),e=null)}return i=!0,s_(e,t),i=!1,Gi(s)}function kSe(t){GV.includes(t)||GV.unshift(t)}function USe(){for(;GV.length;)GV.pop()()}var HI;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(HI||(HI={}));let Z3=class{constructor(){this.uid=Ph(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,i,r,s,n){return this.pool.acquire(HI.Untracked,e,i,r,s,n,uie)}static acquireTracked(e,i,r,s){return this.pool.acquire(HI.Tracked,e,i,r,null,null,s)}notify(e,i){this.type===HI.Untracked?this.callback.call(this.target,e,i,this.path,this.target):this.callback.call(null,e,i,void 0,void 0)}acquire(e,i,r,s,n,o,a){this.uid=Ph(),this.removed=!1,this.type=e,this.oldValue=i,this.callback=r,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Ph(),this.removed=!0}};Z3.pool=new OSe(Z3);const sk=new vu,W0=new Set;let HV;function qV(t){W0.delete(t),W0.add(t),HV||(HV=p2(l9e))}function o9e(t){if(t.removed)return;const e=t.oldValue,i=t.getValue();t.equals(e,i)||(t.oldValue=i,t.notify(i,e))}function a9e(t){for(const e of W0.values())e.target===t&&(e.removed=!0)}function l9e(){let t=10;for(;HV&&t--;){HV=null;const e=c9e(),i=sk.acquire();for(const r of e){const s=r.uid;o9e(r),s===r.uid&&r.removed&&i.push(r)}for(const r of W0)r.removed&&(i.push(r),W0.delete(r));for(const r of i)Z3.pool.release(r);sk.release(i),sk.release(e),BW.forEach(r=>r())}}function c9e(){const t=sk.acquire();t.length=W0.size;let e=0;for(const i of W0)t[e]=i,++e;return W0.clear(),t}const BW=new Set;function VSe(t){return BW.add(t),Gi(()=>BW.delete(t))}function u9e(t,e,i){let r=wSe(t,e,i,(s,n,o)=>{let a,l,c=NSe(()=>aD(s,n),(u,d)=>{var f;((f=s.__accessor__)==null?void 0:f.lifecycle)===_u.DESTROYED||a&&a.uid!==l?r.remove():(a||(a=Z3.acquireUntracked(u,o,d,s,n),l=a.uid),qV(a))});return Gi(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,qV(a)),a=null),r=c=null})});return r}function h9e(t,e,i){const r=wSe(t,e,i,(s,n,o)=>{let a=!1;return DSe(()=>aD(s,n),(l,c)=>{s.__accessor__.lifecycle!==_u.DESTROYED?a||(a=!0,uie(c,l)||o.call(s,l,c,n,s),a=!1):r.remove()})});return r}function d9e(t,e,i,r=!1){return t.__accessor__&&t.__accessor__.lifecycle!==_u.DESTROYED?r?h9e(t,e,i):u9e(t,e,i):Gi()}function p9e(t,e,i){let r,s,n=NSe(t,(o,a)=>{r&&r.uid!==s?n.remove():(r||(r=Z3.acquireTracked(o,e,a,i),s=r.uid),qV(r))});return Gi(()=>{n.remove(),r&&(r.uid!==s||r.removed||(r.removed=!0,qV(r)),r=null),n=null})}function f9e(t,e,i){let r=!1;return DSe(t,(s,n)=>{r||(r=!0,i(n,s)||e(s,n),r=!1)})}function m9e(t,e,i=!1,r=Qxe){return i?f9e(t,e,r):p9e(t,e,r)}function lue(t){return rk(W0,e=>e.oldValue===t)}function Eh(t,e){for(const[i,r]of t)if(e(r,i))return!0;return!1}function I8t(t,e){for(const[i,r]of t)if(e(r,i))return r;return null}function cD(t,e,i){const r=t.get(e);if(r!==void 0)return r;const s=i();return t.set(e,s),s}function L8t(t){const e=new Map;return i=>(e.has(i)||e.set(i,t(i)),e.get(i))}const GM=()=>se.getLogger("esri.core.accessorSupport.ensureTypes");function g9e(t){return t==null?t:new Date(t)}function y9e(t){return t==null?t:!!t}function uD(t){return t==null?t:t.toString()}function Id(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function Aie(t){return t==null?t:Math.round(parseFloat(t))}function _9e(t){return null}function zSe(t){return(t==null?void 0:t.constructor)&&t.constructor.__accessorMetadata__!==void 0}function WV(t,e){return e!=null&&t&&!(e instanceof t)}function BSe(t){return t&&"isCollection"in t}function cue(t){return t!=null&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function v9e(t,e){if(!(e!=null&&e.constructor)||!BSe(e.constructor))return jW(t,e)?e:new t(e);const i=cue(t.prototype.itemType),r=cue(e.constructor.prototype.itemType);return i?r?i===r?e:i.prototype.isPrototypeOf(r.prototype)?new t(e):(jW(t,e),e):new t(e):e}function jW(t,e){return!!zSe(e)&&(GM().error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+zj(t)+"'"),!0)}function OS(t,e){return e==null?e:BSe(t)?v9e(t,e):WV(t,e)?jW(t,e)?e:new t(e):e}function zj(t){var e;return((e=t==null?void 0:t.prototype)==null?void 0:e.declaredClass)||"unknown"}const b9e=new WeakMap;function w9e(t){switch(t){case Number:return Id;case Xi:return Aie;case Boolean:return y9e;case String:return uD;case Date:return g9e;case UP:return _9e;default:return cD(b9e,t,()=>OS.bind(null,t))}}function Qs(t,e){const i=w9e(t);return arguments.length===1?i:i(e)}function Y3(t,e,i){return arguments.length===1?Y3.bind(null,t):e&&(Array.isArray(e)?e.map(r=>t(r,i)):[t(e,i)])}function x9e(t,e){return arguments.length===1?Y3(i=>Qs(t,i)):Y3(i=>Qs(t,i),e)}function jSe(t,e,i){return e!==0&&Array.isArray(i)?i.map(r=>jSe(t,e-1,r)):t(i)}function ZV(t,e,i){if(arguments.length===2)return n=>ZV(t,e,n);if(!i)return i;i=jSe(t,e,i);let r=e,s=i;for(;r>0&&Array.isArray(s);)r--,s=s[0];if(s!==void 0)for(let n=0;n<r;n++)i=[i];return i}function T9e(t,e,i){return arguments.length===2?ZV(r=>Qs(t,r),e):ZV(r=>Qs(t,r),e,i)}function GSe(t){return!!Array.isArray(t)&&!t.some(e=>{const i=typeof e;return!(i==="string"||i==="number"||i==="function"&&t.length>1)})}function GW(t,e){if(arguments.length===2)return GW(t).call(null,e);const i=new Set,r=t.filter(a=>typeof a!="function"),s=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||i.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,u=c==="string"||c==="number";return u&&(i.has(a)||s.some(d=>c==="string"&&d===String||c==="number"&&d===Number))||c==="object"&&s.some(d=>!WV(a,d))?a:(u&&r.length?(n||(n=r.map(d=>typeof d=="string"?`'${d}'`:`${d}`).join(", ")),GM().error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(d=>zj(d)).join(", ")),GM().error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):GM().error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function Gf(t,e){if(arguments.length===2)return Gf(t).call(null,e);const i={},r=[],s=[];for(const l in t.typeMap){const c=t.typeMap[l];i[l]=Qs(c),r.push(zj(c)),s.push(l)}const n=()=>`'${r.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!WV(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,u=i[c];if(!u)return GM().error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!WV(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!zSe(l)){const d={};for(const f in l)f!==t.key&&(d[f]=l[f]);return u(d)}return u(l)}}let Xi=class{},UP=class{};const F8t={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function S9e(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function HSe(t){switch(t.type){case"native":return Qs(t.value);case"array":return Y3(HSe(t.value));case"one-of":return E9e(t);default:return null}}function E9e(t){let e=null;return(i,r)=>qW(i,t)?i:(e==null&&(e=HW(t)),GM().error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),r&&(r.valid=!1),null)}function HW(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Xi:return"integer";case Date:return"date";case UP:return"null";default:return zj(t.value)}case"array":return`array of ${HW(t.value)}`;case"one-of":{const e=t.values.map(i=>HW(i));return`one of ${e.slice(0,-1)} or ${e[e.length-1]}`}}return"unknown"}function qW(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case Xi:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string";case UP:return t===null}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(i=>!qW(i,e.value));case"one-of":return e.values.some(i=>qW(t,i))}}function p(t={}){return(e,i)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(e,i),s=Uj(e,i);r&&(r.get||r.set?(s.get=r.get||s.get,s.set=r.set||s.set):"value"in r&&("value"in t&&se.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${e.constructor.name}" already defined in the metadata`,t),s.value=t.value=r.value)),t.readOnly!=null&&(s.readOnly=t.readOnly);const n=t.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let u;s.dependsOn=[l],s.get=function(){let d=Df(this,l);if(typeof d=="function"){u||(u=l.split(".").slice(0,-1).join("."));const f=Df(this,u);f&&(d=d.bind(f))}return d},s.readOnly||(s.set=c?function(d){this._override(i,d)}:function(d){zV(this,l,d)})}const o=t.type,a=t.types;s.cast||(o?s.cast=C9e(o):a&&(Array.isArray(a)?s.cast=Y3(Gf(a[0])):s.cast=Gf(a))),wqe(s,t),t.range&&(s.cast=M9e(s.cast,t.range))}}function qSe(t,e,i){const r=Uj(t,i);r.json||(r.json={});let s=r.json;return e!==void 0&&(s.origins||(s.origins={}),s.origins[e]||(s.origins[e]={}),s=s.origins[e]),s}function C9e(t){let e=0,i=t;if(S9e(t))return HSe(t);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],e++;const r=i;if(GSe(r))return e===0?GW(r):ZV(GW(r),e);if(e===1)return x9e(r);if(e>1)return T9e(r,e);const s=t;return s.from?s.from:Qs(s)}function M9e(t,e){return i=>{let r=+t(i);return e.step!=null&&(r=Math.round(r/e.step)*e.step),e.min!=null&&(r=Math.max(e.min,r)),e.max!=null&&(r=Math.min(e.max,r)),r}}function A9e(t){if(t.json&&t.json.origins){const e=t.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(e[r]){const s=e[r];i[r].forEach(n=>{e[n]=s}),delete e[r]}}}let Jg=class extends dSe{constructor(e,i,r){super(e,i,r)}};Jg.prototype.type="warning";function WSe(t){var e;return!!t&&((e=t.prototype)==null?void 0:e.declaredClass)&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const WW=()=>se.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function uue(t,e,i){var r,s;t&&(!i&&!e.read||(r=e.read)!=null&&r.reader||((s=e.read)==null?void 0:s.enabled)===!1||R9e(t)&&ia("read.reader",VP(t),e))}function VP(t){var i,r;const e=t.ndimArray??0;if(e>1)return O9e(t);if(e===1)return hue(t);if("type"in t&&YSe(t.type)){const s=(r=(i=t.type.prototype)==null?void 0:i.itemType)==null?void 0:r.Type,n=hue(typeof s=="function"?{type:s}:{types:s});return(o,a,l)=>{const c=n(o,a,l);return c&&new t.type(c)}}return Pie(t)}function Pie(t){return"type"in t?P9e(t.type):$9e(t.types)}function P9e(t){return t.prototype.read?(e,i,r)=>{if(e==null)return e;const s=typeof e;if(s!=="object")return void WW().error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${s}'`);const n=new t;return n.read(e,r),n}:t.fromJSON}function ZSe(t,e,i,r){return r!==0&&Array.isArray(e)?e.map(s=>ZSe(t,s,i,r-1)):t(e,void 0,i)}function O9e(t){const e=Pie(t),i=ZSe.bind(null,e),r=t.ndimArray??0;return(s,n,o)=>{if(s==null)return s;s=i(s,o,r);let a=r,l=s;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)s=[s];return s}}function hue(t){const e=Pie(t);return(i,r,s)=>{if(i==null)return i;if(Array.isArray(i)){const o=[];for(const a of i){const l=e(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=e(i,void 0,s);return n!==void 0?[n]:void 0}}function YSe(t){if(!WSe(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?Oie(e.Type):XSe(e.Type))}function R9e(t){return"types"in t?XSe(t.types):Oie(t.type)}function Oie(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||YSe(t))}function XSe(t){for(const e in t.typeMap)if(!Oie(t.typeMap[e]))return!1;return!0}function $9e(t){let e=null;const i=t.errorContext??"type",r=t.validate;return(s,n,o)=>{if(s==null)return s;const a=typeof s;if(a!=="object")return void WW().error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);e||(e=I9e(t));const l=t.key;if(typeof l!="string")return;const c=s[l],u=c?e[c]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!u){const f=`Type '${c||"unknown"}' is not supported`;return o!=null&&o.messages&&s&&o.messages.push(new Jg(`${i}:unsupported`,f,{definition:s,context:o})),void WW().error(f)}const d=new u;return d.read(s,o),r?r(d):d}}function I9e(t){var i,r;const e={};for(const s in t.typeMap){const n=t.typeMap[s],o=lD(n.prototype);if(typeof t.key=="function")continue;const a=o[t.key];if(!a)continue;if((i=a.json)!=null&&i.type&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"){e[a.json.type[0]]=n;continue}const l=(r=a.json)==null?void 0:r.write;if(!(l!=null&&l.writer)){e[s]=n;continue}const c=l.target,u=typeof c=="string"?c:t.key,d={};l.writer(s,d,u),d[u]&&(e[d[u]]=n)}return e}function L9e(t){if(t.json||(t.json={}),pue(t.json),fue(t.json),due(t.json),t.json.origins)for(const e in t.json.origins)pue(t.json.origins[e]),fue(t.json.origins[e]),due(t.json.origins[e]);return!0}function due(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function pue(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function fue(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function mue(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const i=(t==null?void 0:t.ndimArray)??0;t&&(i===1||"type"in t&&WSe(t.type))?e.write.writer=F9e:i>1?e.write.writer=k9e(i):e.types?Array.isArray(e.types)?e.write.writer=N9e(e.types[0]):e.write.writer=D9e(e.types):e.write.writer=X3}function D9e(t){return(e,i,r,s)=>e?JSe(e,t,s)?X3(e,i,r,s):void 0:X3(e,i,r,s)}function JSe(t,e,i){for(const r in e.typeMap)if(t instanceof e.typeMap[r])return!0;if(i!=null&&i.messages){const r=e.errorContext??"type",s=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;i&&i.messages&&t&&i.messages.push(new G(`${r}:unsupported`,s,{definition:t,context:i})),se.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function N9e(t){return(e,i,r,s)=>!e||!Array.isArray(e)?X3(e,i,r,s):X3(e.filter(n=>JSe(n,t,s)),i,r,s)}function X3(t,e,i,r){ia(i,YV(t,r),e)}function YV(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?XV(t):t}function XV(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function F9e(t,e,i,r){let s;t===null?s=null:t&&typeof t.map=="function"?(s=t.map(n=>YV(n,r)),typeof s.toArray=="function"&&(s=s.toArray())):s=[YV(t,r)],ia(i,s,e)}function QSe(t,e,i){return i!==0&&Array.isArray(t)?t.map(r=>QSe(r,e,i-1)):YV(t,e)}function k9e(t){return(e,i,r,s)=>{let n;if(e===null)n=null;else{n=QSe(e,s,t);let o=t,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}ia(r,n,i)}}function U9e(t,e){return Rie(t,"any",e==null?void 0:e.origin)}function ZW(t,e){return Rie(t,"read",e==null?void 0:e.origin)}function KSe(t,e){return Rie(t,"write",e==null?void 0:e.origin)}function Rie(t,e,i){let r=t==null?void 0:t.json;if(r!=null&&r.origins&&i){let s;s=i==="link-chart"?r.origins[i]&&(e==="any"||e in r.origins[i])?r.origins[i]:r.origins["web-map"]:r.origins[i],s&&(e==="any"||e in s)&&(r=s)}return r}function V9e(t){var i;const e=z9e(t);if(t.json.origins)for(const r in t.json.origins){const s=t.json.origins[r],n=s.types?B9e(s):e;uue(n,s,!1),s.types&&!s.write&&((i=t.json.write)!=null&&i.enabled)&&(s.write={...t.json.write}),mue(n,s)}uue(e,t.json,!0),mue(e,t.json)}function z9e(t){return t.json.types?YW(t.json):t.type?e2e(t):YW(t)}function B9e(t){return t.type?e2e(t):YW(t)}function e2e(t){if(!t.type)return;let e=0,i=t.type;for(;Array.isArray(i)&&!GSe(i);)i=i[0],e++;return{type:i,ndimArray:e}}function YW(t){if(!t.types)return;let e=0,i=t.types;for(;Array.isArray(i);)i=i[0],e++;return{types:i,ndimArray:e}}function j9e(t){L9e(t)&&(A9e(t),V9e(t))}const $H=new Set,IH=new Set;function I(t){return e=>{t??(t="esri.core.Accessor"),e.prototype.declaredClass=t,H9e(e);const i=[],r=[];let s=e.prototype;for(;s;)s.hasOwnProperty("initialize")&&!$H.has(s.initialize)&&($H.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!IH.has(s.destroy)&&(IH.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);$H.clear(),IH.clear();const n=class extends e{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;const c=this[vSe];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let u=0;u<r.length;u++)r[u].call(this)}}})}Object.defineProperty(this,Symbol.dispose,{enumerable:!1,configurable:!0,value(){this.destroy()}}),this.postscript()}}};n.__accessorMetadata__=lD(e.prototype),n.prototype.declaredClass=t;const o=(t||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(n,"name",{value:o,configurable:!0}),n}}function G9e(t,e){return e.get==null?function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r===void 0)return;Ft(r);const s=i.store;return s.has(t)?s.get(t):r.metadata.value}:function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r!==void 0)return r.getComputed(i)}}function H9e(t){const e=t.prototype,i=lD(e),r={};for(const s of Object.getOwnPropertyNames(i)){const n=i[s];j9e(n),r[s]={enumerable:!0,configurable:!0,get:G9e(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this))return a.initialized&&n.readOnly?gue("read-only",s):a.lifecycle===_u.CONSTRUCTED&&n.constructOnly?gue("construct-only",s):void a.set(s,o)}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,r)}const gue=(t,e)=>{se.getLogger("esri.core.Accessor").error(`cannot assign to ${t} property '${e}'`)};var t2e,i2e;function q9e(t){var e;if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return(e=t.constructor)!=null&&e.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const Om=Symbol("Accessor-Handles"),XW=Symbol("Accessor-Initialized");let Ue=class r2e{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:s}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}lD(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const u=this.inherited;let d;this.inherited=function(...f){if(n.prototype[a])return n.prototype[a].apply(this,f)};try{d=l.apply(this,c)}catch(f){throw this.inherited=u,f}return this.inherited=u,d}:e[a]}for(const a in i){const l=q9e(i[a]);p(l)(o.prototype,a)}return I(r)(o)}constructor(...e){var r;if(this[t2e]=null,this[i2e]=!1,this.constructor===r2e)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const i=new $qe(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:i}),e.length>0&&(i.ctorArgs=((r=this.normalizeCtorArgs)==null?void 0:r.apply(this,e))??e[0])}postscript(){const e=this.__accessor__,i=e.ctorArgs;e.initialize(),i&&(this.set(i),e.ctorArgs=null),e.constructed(),this.initialize(),this[XW]=!0}initialize(){}[vSe](){this[Om]=qe(this[Om])}destroy(){var e;this.destroyed||(a9e(this),this.__accessor__.destroy(),(e=kqe())==null||e.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[XW]}get destroyed(){var e;return((e=this.__accessor__)==null?void 0:e.lifecycle)===_u.DESTROYED||!1}commitProperty(e){Df(this,e)}get(e){return _Se(se.getLogger(this),"`Accessor.get` is deprecated in favor of using optional chaining",{version:"4.28",see:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining"}),Df(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,i){return zV(this,e,i),this}watch(e,i,r){return d9e(this,e,i,r)}addHandles(e,i){if(this.destroyed){const r=Array.isArray(e)?e:[e];for(const s of r)s.remove();return}(this[Om]??(this[Om]=new ly)).add(e,i)}removeHandles(e){var i;(i=this[Om])==null||i.remove(e)}removeAllHandles(){var e;(e=this[Om])==null||e.removeAll()}removeHandlesReference(e){var i;(i=this[Om])==null||i.removeReference(e)}hasHandles(e){var i;return((i=this[Om])==null?void 0:i.has(e))===!0}_override(e,i){i===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,i){i==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,i){return this.__accessor__.internalSet(e,i),this}};t2e=Om,i2e=XW;let W9e=class s2e{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new s2e;return this._values.forEach((r,s)=>{e&&e.has(s)||i.set(s,ie(r.value),r.origin)}),i}get(e,i){i=this._normalizeOrigin(i);const r=this._values.get(e);return i==null||(r==null?void 0:r.origin)===i?r==null?void 0:r.value:void 0}originOf(e){var i;return((i=this._values.get(e))==null?void 0:i.origin)??Fi.USER}keys(e){e=this._normalizeOrigin(e);const i=[...this._values.keys()];return e==null?i:i.filter(r=>{var s;return((s=this._values.get(r))==null?void 0:s.origin)===e})}set(e,i,r){if((r=this._normalizeOrigin(r))===Fi.DEFAULTS){const s=this._values.get(e);if((s==null?void 0:s.origin)!=null&&s.origin>r)return}this._values.set(e,new Z9e(i,r))}delete(e,i){var r;(i=this._normalizeOrigin(i))!=null&&((r=this._values.get(e))==null?void 0:r.origin)!==i||this._values.delete(e)}has(e,i){var r;return(i=this._normalizeOrigin(i))!=null?((r=this._values.get(e))==null?void 0:r.origin)===i:this._values.has(e)}forEach(e){this._values.forEach(({value:i},r)=>e(i,r))}_normalizeOrigin(e){if(e!=null)return e===Fi.DEFAULTS?e:Fi.USER}},Z9e=class{constructor(e,i){this.value=e,this.origin=i}};function n2e(t,e,i){e.keys().forEach(s=>{i.set(s,e.get(s),Fi.DEFAULTS)});const r=t.metadata;Object.keys(r).forEach(s=>{t.internalGet(s)&&i.set(s,t.internalGet(s),Fi.DEFAULTS)})}function Y9e(t,e,i){if(!(t!=null&&t.read)||t.read.enabled===!1||!t.read.source)return!1;const r=t.read.source;if(typeof r=="string"){if(r===e||r.includes(".")&&r.indexOf(e)===0&&Kce(r,i))return!0}else for(const s of r)if(s===e||s.includes(".")&&s.indexOf(e)===0&&Kce(s,i))return!0;return!1}function X9e(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function J9e(t,e,i,r,s){let n=ZW(e[i],s);X9e(n)&&(t[i]=!0);for(const o of Object.getOwnPropertyNames(e))n=ZW(e[o],s),Y9e(n,i,r)&&(t[o]=!0)}function Q9e(t,e,i,r){const s=i.metadata,n=U9e(s[e],r),o=n==null?void 0:n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,r):o;a!==void 0&&i.set(e,a)}const o2e={origin:"service"};function a2e(t,e,i=o2e){if(!e||typeof e!="object")return;const r=hl(t),s=r.metadata,n={};for(const o of Object.getOwnPropertyNames(e))J9e(n,s,o,e,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(n)){const a=ZW(s[o],i).read,l=a==null?void 0:a.source;let c;c=l&&typeof l=="string"?aD(e,l):e[o],a!=null&&a.reader&&(c=a.reader.call(t,c,e,i)),c!==void 0&&r.set(o,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||Q9e(t,o,r,i)}r.setDefaultOrigin("user")}function l2e(t,e,i,r=o2e){var n;const s={...r,messages:[]};i(s),(n=s.messages)==null||n.forEach(o=>{o.type!=="warning"||t.loaded?r!=null&&r.messages&&r.messages.push(o):t.loadWarnings.push(o)})}function K9e(t,e,i,r,s){var o,a;const n={};return(a=(o=e.write)==null?void 0:o.writer)==null||a.call(t,r,n,i,s),n}function c2e(t,e,i,r,s,n){if(!(r!=null&&r.write))return!1;const o=Df(t,i);if(!s&&r.write.overridePolicy){const a=r.write.overridePolicy.call(t,o,i,n??void 0);a!==void 0&&(s=a)}if(s||(s=r.write),!s||s.enabled===!1||s.layerContainerTypes&&(n!=null&&n.layerContainerType)&&!s.layerContainerTypes.includes(n.layerContainerType))return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new G("web-document-write:property-required",`Missing value for required property '${i}' on '${t.declaredClass}'`,{propertyName:i,target:t});return a&&(n!=null&&n.messages)?n.messages.push(a):a&&!n&&se.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||!s.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(i)===Fi.DEFAULTS)&&e7e(t,i,n,r,o)||!s.ignoreOrigin&&(n!=null&&n.origin)&&e.store.multipleOriginsSupported&&e.store.originOf(i)<F1(n.origin))}function e7e(t,e,i,r,s){const n=r.default;if(n===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(t,e,i??void 0);return db(o,s)}return!1}return n===s}function t7e(t,e,i,r){const s=hl(t),n=s.metadata,o=KSe(n[e],r);return!!o&&c2e(t,s,e,o,i,r)}function u2e(t,e,i){var n,o;if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return ek(e,t.toJSON(i));const r=hl(t),s=r.metadata;for(const a in s){const l=KSe(s[a],i);if(!c2e(t,r,a,l,void 0,i))continue;const c=Df(t,a),u=K9e(t,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,i);Object.keys(u).length>0&&(e=ek(e,u),(o=(n=i==null?void 0:i.resources)==null?void 0:n.pendingOperations)!=null&&o.length&&i.resources.pendingOperations.push(Promise.all(i.resources.pendingOperations).then(()=>ek(e,u,()=>"replace-arrays"))),i!=null&&i.writtenProperties&&i.writtenProperties.push({target:t,propName:a,oldOrigin:Aqe(r.store.originOf(a)),newOrigin:i.origin}))}return e}const hD=t=>{let e=class extends t{constructor(...i){super(...i);const r=hl(this),s=r.store,n=new W9e;r.store=n,n2e(r,s,n)}read(i,r){a2e(this,i,r)}write(i,r){return u2e(this,i??{},r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return i7e.call(this,i,r)}};return e=h([I("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function i7e(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(t,e),i}function JV(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}let Se=class extends hD(Ue){};Se=h([I("esri.core.JSONSupport")],Se);const r7e=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,s7e={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function yue(t){const e=t==null?void 0:t.match(r7e);if(!e)return null;const[,i,r,s]=e;if(!i)return null;let n=null,o=null,a=null;const{devext:l,qaext:c,www:u}=s7e;if(r)if(n=i,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=u);else switch(i.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=u);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:n}}function n7e(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function h2e(t){const e=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,i=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,r=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return e.test(t)?t=t.replace(e,"https://www.arcgis.com"):i.test(t)?t=t.replace(i,"https://devext.arcgis.com"):r.test(t)&&(t=t.replace(r,"https://qaext.arcgis.com")),t}function d2e(t){const e=atob(t),i=new Uint8Array(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return i.buffer}function o7e(t){const e=new Uint8Array(t);let i="";for(let r=0;r<e.length;r++)i+=String.fromCharCode(e[r]);return btoa(i)}const a7e=()=>se.getLogger("esri.core.urlUtils"),zP=rr.request,_ue="esri/config: esriConfig.request.proxyUrl is not set.",p2e=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,f2e=/^\s*http:/i,l7e=/^\s*https:/i,c7e=/^\s*file:/i,u7e=/:\d+$/,h7e=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,d7e=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),p7e=new RegExp("^((([^[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^[:]*))(:([0-9]+))?$");let eS=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(d7e);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(p7e),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}};const DN={},f7e=new eS(rr.applicationUrl);let Wl=f7e;const m7e=g7e();let $ie=m7e;const Iie=()=>Wl,B8t=()=>$ie;function g7e(){const t=Wl.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${Wl.scheme}://${Wl.host}${Wl.port!=null?`:${Wl.port}`:""}`}${e}`}function un(t){if(!t)return null;const e={path:null,query:null},i=new eS(t),r=t.indexOf("?");return i.query===null?e.path=t:(e.path=t.substring(0,r),e.query=Lie(i.query)),i.fragment&&(e.hash=i.fragment,i.query===null&&(e.path=e.path.substring(0,e.path.length-(i.fragment.length+1)))),e}function Lie(t){const e=t.split("&"),i={};for(const r of e){if(!r)continue;const s=r.indexOf("=");let n,o;s<0?(n=decodeURIComponent(r),o=""):(n=decodeURIComponent(r.slice(0,s)),o=decodeURIComponent(r.slice(s+1)));let a=i[n];typeof a=="string"&&(a=i[n]=[a]),Array.isArray(a)?a.push(o):i[n]=o}return i}function J3(t,e){return t?Object.keys(t).map(i=>{const r=t[i];if(r==null)return"";const s=encodeURIComponent(i)+"=",n=e==null?void 0:e[i];return n?s+encodeURIComponent(n(r)):Array.isArray(r)?r.map(o=>JV(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):JV(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function y7e(t=!1){let e,i=zP.proxyUrl;if(typeof t=="string"){e=x7e(t);const r=Bj(t);r&&(i=r.proxyUrl)}else e=!!t;if(!i)throw a7e().warn(_ue),new G("urlUtils:proxy-not-set",_ue);return e&&QW()&&(i=Vie(i)),un(i)}function j8t(t){const e=Bj(t);let i,r;if(e){const s=Die(e.proxyUrl);i=s.path,r=s.query?Lie(s.query):null}if(i){const s=un(t);t=i+"?"+s.path;const n=J3({...r,...s.query});n&&(t=`${t}?${n}`)}return t}const PO={path:"",query:""};function Die(t){const e=t.indexOf("?");return e!==-1?(PO.path=t.slice(0,e),PO.query=t.slice(e+1)):(PO.path=t,PO.query=null),PO}function m2e(t){return t=(t=KV(t=M7e(t=Die(t).path),!0)).toLowerCase()}function _7e(t){const e={proxyUrl:t.proxyUrl,urlPrefix:m2e(t.urlPrefix)},i=zP.proxyRules,r=e.urlPrefix;let s=i.length;for(let n=0;n<i.length;n++){const o=i[n].urlPrefix;if(r.indexOf(o)===0){if(r.length===o.length)return-1;s=n;break}o.indexOf(r)===0&&(s=n+1)}return i.splice(s,0,e),s}function Bj(t){const e=zP.proxyRules,i=m2e(t);for(let r=0;r<e.length;r++)if(i.indexOf(e[r].urlPrefix)===0)return e[r]}function v7e(t,e){if(!t||!e)return!1;t=QV(t),e=QV(e);const i=yue(t),r=yue(e);return i!=null&&r!=null?i.portalHostname===r.portalHostname:i==null&&r==null&&CA(t,e,!0)}function g2e(t,e){return t=QV(t),e=QV(e),KV(t)===KV(e)}function QV(t){const e=(t=Zd(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function JW(t,e=zP.interceptors){const i=r=>r==null||r instanceof RegExp&&r.test(t)||typeof r=="string"&&t.startsWith(r);if(e){for(const r of e)if(Array.isArray(r.urls)){if(r.urls.some(i))return r}else if(i(r.urls))return r}return null}function CA(t,e,i=!1){if(!t||!e)return!1;const r=eZ(t),s=eZ(e);return!(!i&&r.scheme!==s.scheme)&&r.host!=null&&s.host!=null&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function Nie(t){if(typeof t=="string"){if(!Oh(t))return!0;t=eZ(t)}if(CA(t,Wl))return!0;const e=zP.trustedServers||[];for(let i=0;i<e.length;i++){const r=b7e(e[i]);for(let s=0;s<r.length;s++)if(CA(t,r[s]))return!0}return!1}function b7e(t){return DN[t]||(Uie(t)||Qg(t)?DN[t]=[new eS(Tu(t))]:DN[t]=[new eS(`http://${t}`),new eS(`https://${t}`)]),DN[t]}function Tu(t,e=$ie,i){return Qg(t)?i!=null&&i.preserveProtocolRelative?t:Wl.scheme==="http"&&Wl.authority===Yd(t).slice(2)?`http:${t}`:`https:${t}`:Uie(t)?t:Uh(t[0]==="/"?C7e(e):e,t)}function Fie(t,e=$ie,i){if(t==null||!Oh(t))return t;const r=Zd(t),s=r.toLowerCase(),n=Zd(e).toLowerCase().replace(/\/+$/,""),o=i?Zd(i).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return t;const a=(d,f,m)=>(m=d.indexOf(f,m))===-1?d.length:m;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return t;t=r.slice(c);const u=n.slice(c-1).replaceAll(/[^/]+/g,"").length;if(u>0)for(let d=0;d<u;d++)t=`../${t}`;else t=`./${t}`;return t}function Zd(t){return t=O7e(t=P7e(t=A7e(t=Tu(t=t.trim()))))}function Uh(...t){const e=t.filter(op);if(!(e!=null&&e.length))return;const i=[];if(Oh(e[0])){const s=e[0],n=s.indexOf("//");n!==-1&&(i.push(s.slice(0,n+1)),S7e(e[0])&&(i[0]+="/"),e[0]=s.slice(n+2))}else e[0][0]==="/"&&i.push("");const r=e.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<r.length;s++){const n=r[s];n===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!n&&s===r.length-1||n&&(n!=="."||i.length===0))&&i.push(n)}return i.join("/")}function Yd(t,e=!1){if(t==null||MA(t)||cy(t))return null;let i=t.indexOf("://");if(i===-1&&Qg(t))i=2;else{if(i===-1)return null;i+=3}const r=t.indexOf("/",i);return r!==-1&&(t=t.slice(0,r)),e&&(t=KV(t,!0)),t}function Oh(t){return Qg(t)||Uie(t)}function MA(t){return t!=null&&t.slice(0,5)==="blob:"}function cy(t){return t!=null&&t.slice(0,5)==="data:"}function kie(t){const e=mb(t);return e!=null&&e.isBase64?d2e(e.data):null}function G8t(t){return o7e(t).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const w7e=/^data:(.*?)(;base64)?,(.*)$/;function mb(t){const e=t.match(w7e);if(!e)return null;const[,i,r,s]=e;return{mediaType:i,isBase64:!!r,data:s}}function y2e(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}async function H8t(t){return(await fetch(t)).blob()}function q8t(t){const e=kie(t);if(!e)return null;const i=mb(t);return new Blob([e],{type:i.mediaType})}function Qg(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function Uie(t){return t!=null&&p2e.test(t)}function x7e(t){return t!=null&&l7e.test(t)||Wl.scheme==="https"&&Qg(t)}function T7e(t){return t!=null&&f2e.test(t)||Wl.scheme==="http"&&Qg(t)}function S7e(t){return t!=null&&c7e.test(t)}function Vie(t){return Qg(t)?`https:${t}`:t.replace(f2e,"https:")}function E7e(){return Wl.scheme==="http"}function QW(){return Wl.scheme==="https"}function KV(t,e=!1){return Qg(t)?t.slice(2):(t=t.replace(p2e,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function C7e(t){const e=t.indexOf("//"),i=t.indexOf("/",e+2);return i===-1?t:t.slice(0,i)}function zie(t){let e=0;if(Oh(t)){const r=t.indexOf("//");r!==-1&&(e=r+2)}const i=t.lastIndexOf("/");return i<e?t:t.slice(0,i+1)}function W8t(t,e){if(!t)return"";const i=un(t).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(!(e!=null&&e.length))return r;const s=new RegExp(`\\.(${e.join("|")})$`,"i");return r.replace(s,"")}function M7e(t){return t.endsWith("/")?t:`${t}/`}function _2e(t){return t.replace(/\/+$/,"")}function A7e(t){if(/^https?:\/\//i.test(t)){const e=Die(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function P7e(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function O7e(t){const e=zP.httpsDomains;if(!T7e(t))return t;const i=t.indexOf("/",7);let r;if(r=i===-1?t:t.slice(0,i),r=r.toLowerCase().slice(7),u7e.test(r)){if(!r.endsWith(":80"))return t;r=r.slice(0,-3),t=t.replace(":80","")}return E7e()&&r===Wl.authority&&!h7e.test(t)||(QW()&&r===Wl.authority||e&&e.some(s=>r===s||r.endsWith(`.${s}`))||QW()&&!Bj(t))&&(t=Vie(t)),t}function KW(t,e,i){if(!(e&&i&&t&&Oh(t)))return t;const r=t.indexOf("//"),s=t.indexOf("/",r+2),n=t.indexOf(":",r+2),o=Math.min(s<0?t.length:s,n<0?t.length:n);return t.slice(r+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,r+2)}${i}${t.slice(o)}`}function eZ(t){return typeof t=="string"?new eS(Tu(t)):(t.scheme||(t.scheme=Wl.scheme),t)}function v2e(t){return $7e.test(t)}function b2e(t,e){const i=un(t),r=Object.keys(i.query||{});return r.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function w2e(t,e,i){const r=un(t),s=r.query||{};return s[e]=String(i),`${r.path}?${J3(s)}`}function LH(t,e){if(!e)return t;const i=un(t),r=i.query||{};for(const[n,o]of Object.entries(e))o!=null&&(r[n]=o);const s=J3(r);return s?`${i.path}?${s}`:i.path}function R7e(t){if(t==null)return null;const e=t.match(x2e);return e?e[2]:null}function vue(t){if(t==null)return null;const e=t.match(x2e);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function Z8t(t){return typeof t=="string"?mb(t)??{data:t}:new Promise((e,i)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>e(mb(r.result)),r.onerror=s=>i(s)})}const x2e=/([^.]*)\.([^/]*)$/,$7e=/(^data:image\/svg|\.svg$)/i,T2e="20240724",S2e="ac51c09e1d17be02f839eb2e22bd05fd7a16c2d3";Symbol.dispose??(Symbol.dispose=Symbol("Symbol.dispose")),Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("Symbol.asyncDispose"));const E2e="4.30";let Bi,Bie=E2e;Bie="4.30.9";function Y8t(t){Bi=t}function X8t(t){const e=Bi==null?void 0:Bi.findCredential(t);return e!=null&&e.token?w2e(t,"token",e.token):t}le("host-webworker");const I7e=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function jie(t){const e=Yd(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!I7e.has(e)&&!t.endsWith("/sharing/rest/generateToken")}function C2e(t,e,i=!1,r){return new Promise((s,n)=>{if(ra(r))return void n(bue());let o=()=>{c(),n(new Error(`Unable to load ${e}`))},a=()=>{const u=t;c(),s(u)},l=()=>{if(!t)return;const u=t;c(),u.src="",n(bue())};const c=()=>{le("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,r!=null&&r.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(e)};r!=null&&r.addEventListener("abort",l),le("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function bue(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const M2e="Timeout exceeded";function L7e(){return new Error(M2e)}function J8t(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===M2e}function D7e(t){rr.request.crossOriginNoCorsDomains||(rr.request.crossOriginNoCorsDomains={});const e=rr.request.crossOriginNoCorsDomains;for(let i of t)i=i.toLowerCase(),/^https?:\/\//.test(i)?e[Yd(i)??""]=0:(e[Yd("http://"+i)??""]=0,e[Yd("https://"+i)??""]=0)}function N7e(t){const e=rr.request.crossOriginNoCorsDomains;if(e){let i=Yd(t);if(i)return i=i.toLowerCase(),!CA(i,Iie())&&e[i]<Date.now()-36e5}return!1}async function F7e(t){var s;const e=rr.request.crossOriginNoCorsDomains,i=Yd(t);e&&i&&(e[i.toLowerCase()]=Date.now());const r=un(t);t=r.path,((s=r.query)==null?void 0:s.f)==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function yr(t,e){var f;t instanceof URL&&(t=t.toString()),(e==null?void 0:e.query)instanceof URLSearchParams&&(e.query=Lie(e.query.toString().replaceAll("+"," ")));const i=cy(t),r=MA(t);r||i||(t=Zd(t));const s={url:t,requestOptions:{...e}},n=m=>({data:m,getAllHeaders:AA,getHeader:AA,httpStatus:200,requestOptions:s.requestOptions,url:s.url}),o=JW(t,Od.internalInterceptors);if(o){const m=await xue(o,s);if(m!=null)return n(m)}let a=JW(t);if(a){const m=await xue(a,s);if(m!=null)return n(m);a.after||a.error||(a=null)}if(t=s.url,(e=s.requestOptions).responseType==="image"&&(le("host-webworker")||le("host-node")))throw Ng("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if(e.method==="head"){if(e.body)throw Ng("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(i||r)throw Ng("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await B7e(),ez)return ez.execute(t,e);const l=new AbortController,c=Ra(e,()=>l.abort()),u={controller:l,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:a,params:s,redoRequest:!1,useIdentity:Od.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},d=await q7e(u).finally(()=>c==null?void 0:c.remove());return(f=a==null?void 0:a.after)==null||f.call(a,d),d}let ez;const Od=rr.request,A2e="FormData"in globalThis,k7e=new Set([499,498,403,401]),U7e=new Set(["COM_0056","COM_0057","SB_0008"]),V7e=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],AA=()=>null,tz=Symbol();function z7e(t){const e=Yd(t);e&&!yr._corsServers.includes(e)&&yr._corsServers.push(e)}function wue(t){const e=Yd(t);return!e||e.endsWith(".arcgis.com")||yr._corsServers.includes(e)||Nie(e)}function Ng(t,e,i,r){let s="Error";const n={url:i.url,requestOptions:i.requestOptions,getAllHeaders:AA,getHeader:AA,ssl:!1};if(e instanceof G)return e.details?(e.details=ie(e.details),e.details.url=i.url,e.details.requestOptions=i.requestOptions):e.details=n,e;if(e){const o=r&&(()=>Array.from(r.headers)),a=r&&(u=>r.headers.get(u)),l=r==null?void 0:r.status,c=e.message;c&&(s=c),o&&a&&(n.getAllHeaders=o,n.getHeader=a),n.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||l||0,n.subCode=e.subcode,n.messageCode=e.messageCode,typeof e.details=="string"?n.messages=[e.details]:n.messages=e.details,n.raw=tz in e?e[tz]:e}return os(e)?ki():new G(t,s,n)}async function B7e(){le("host-webworker")&&!ez&&(ez=await ce(()=>import("./request-I30pJUvR.js"),[]))}async function tZ(){Bi||await ce(()=>import("./IdentityManager-Q6aDRc2A.js"),[])}async function j7e(t){var a;const e=t.params.url,i=t.params.requestOptions,r=t.controller.signal,s=i.body;let n=null,o=null;if(A2e&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),t.fetchOptions={cache:i.cacheBust?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:Od.priority,redirect:"follow",signal:r},(n||o)&&(t.fetchOptions.body=n||o),i.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||(a=i.query)!=null&&a.token||n!=null&&n.get("token")),!t.hasToken&&rr.apiKey&&jie(e)&&(i.query||(i.query={}),i.query.token=rr.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!P2e(e)&&!ra(r)){let l;i.authMode==="immediate"?(await tZ(),l=await Bi.getCredential(e,{signal:r}),t.credential=l):i.authMode==="no-prompt"?(await tZ(),l=await Bi.getCredential(e,{prompt:!1,signal:r}).catch(()=>{}),t.credential=l):Bi&&(l=Bi.findCredential(e)),l&&(t.credentialToken=l.token,t.useSSL=!!l.ssl)}}function P2e(t){return V7e.some(e=>e.test(t))}async function G7e(t){let e=t.params.url;const i=t.params.requestOptions,r=t.fetchOptions??{},s=MA(e)||cy(e),n=i.responseType||"json",o=s?0:i.timeout!=null?i.timeout:Od.timeout;let a=!1;if(!s){t.useSSL&&(e=Vie(e));let f={...i.query};t.credentialToken&&(f.token=t.credentialToken);let m=J3(f);le("esri-url-encodes-apostrophe")&&(m=m.replaceAll("'","%27"));const g=e.length+1+m.length;let y;a=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||g>Od.maxUrlLength;const v=i.useProxy||!!Bj(e);if(v){const b=y7e(e);y=b.path,!a&&y.length+1+g>Od.maxUrlLength&&(a=!0),b.query&&(f={...b.query,...f})}if(r.method==="HEAD"&&(a||v)){if(a)throw g>Od.maxUrlLength?Ng("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):Ng("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(v)throw Ng("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}if(a?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?e=LH(e,f):(r.body=J3(f),r.headers||(r.headers={}),r.headers["Content-Type"]="application/x-www-form-urlencoded")):e=LH(e,f),v&&(t.useProxy=!0,e=`${y}?${e}`),f.token&&A2e&&r.body instanceof FormData&&!n7e(e)&&r.body.set("token",f.token),i.hasOwnProperty("withCredentials"))t.withCredentials=i.withCredentials;else if(!CA(e,Iie())){if(Nie(e))t.withCredentials=!0;else if(Bi){const b=Bi.findServerInfo(e);b!=null&&b.webTierAuth&&(t.withCredentials=!0)}}t.withCredentials&&(r.credentials="include",N7e(e)&&await F7e(a?LH(e,f):e))}let l,c,u=0,d=!1;o>0&&(u=setTimeout(()=>{d=!0,t.controller.abort()},o));try{if(i.responseType==="native-request-init")c=r,c.url=e;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||a||H7e(i.headers)||!s&&!t.useProxy&&Od.proxyUrl&&!wue(e)){if(yr._beforeFetch&&await yr._beforeFetch(e,r),l=await fetch(e,r),yr._afterFetch&&await yr._afterFetch(l),t.useProxy||z7e(e),i.responseType==="native")c=l;else if(r.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(u&&(clearTimeout(u),u=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=Tue(c,"application/xml");break;case"document":c=Tue(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const f=l.headers.get("Content-Type");if(f&&/application\/json|text\/plain/i.test(f)&&c[n==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}n==="image"&&c instanceof Blob&&(c=await Sue(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await Sue(e,t)}catch(f){if(f.name==="AbortError")throw d?L7e():ki("Request canceled");if(!(!l&&f instanceof TypeError&&Od.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||t.useProxy||wue(e))throw f;t.redoRequest=!0,_7e({proxyUrl:Od.proxyUrl,urlPrefix:Yd(e)??""})}finally{u&&clearTimeout(u)}return[l,c]}async function xue(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let i,r;try{r=await t.before(e)}catch(s){i=Ng("request:interceptor",s,e)}if((r instanceof Error||r instanceof G)&&(i=Ng("request:interceptor",r,e)),i)throw t.error&&t.error(i),i;return r}}function H7e(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function Tue(t,e){let i;try{i=new DOMParser().parseFromString(t,e)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function q7e(t){var n,o;let e,i;await j7e(t);try{do[e,i]=await G7e(t);while(!await W7e(t,e,i))}catch(a){const l=Ng("request:server",a,t.params,e);throw l.details.ssl=t.useSSL,(n=t.interceptor)!=null&&n.error&&t.interceptor.error(l),l}const r=t.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!t.hasToken&&!t.credentialToken&&((o=i.user)!=null&&o.username)&&!Nie(r)){const a=Yd(r,!0);a&&Od.trustedServers.push(a)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&D7e(i.authorizedCrossOriginNoCorsDomains)}const s=t.credential;if(s&&Bi){const a=Bi.findServerInfo(s.server);let l=a==null?void 0:a.owningSystemUrl;if(l){l=l.replace(/\/?$/,"/sharing");const c=Bi.findCredential(l,s.userId);c&&Bi._getIdenticalSvcIdx(l,c)===-1&&c.resources.unshift(l)}}return{data:i,getAllHeaders:e?()=>Array.from(e.headers):AA,getHeader:e?a=>e.headers.get(a):AA,httpStatus:(e==null?void 0:e.status)??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function W7e(t,e,i){var c;if(t.redoRequest)return t.redoRequest=!1,!1;const r=t.params.requestOptions;if(!e||r.responseType==="native"||r.responseType==="native-request-init")return!0;let s,n;if(i&&(i.error&&typeof i.error=="object"?s=i.error:i.status==="error"&&Array.isArray(i.messages)&&(s={...i},s[tz]=i,s.details=i.messages)),!s&&!e.ok)throw s=new Error(`Unable to load ${e.url} status: ${e.status}`),s[tz]=i,s;let o,a=null;s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,o=s.messageCode,o=o==null?void 0:o.toUpperCase());const l=r.authMode;if(n===403&&(a===4||(c=s.message)!=null&&c.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&k7e.has(n)&&!P2e(t.params.url)&&(n!==403||(!o||!U7e.has(o))&&(a==null||a===2&&t.credentialToken))){await tZ();try{const u=await Bi.getCredential(t.params.url,{error:Ng("request:server",s,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=u,t.credentialToken=u.token,t.useSSL=t.useSSL||u.ssl,!1}catch(u){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;s=u}}if(s)throw s;return!0}function Sue(t,e,i=!1){const r=e.controller.signal,s=new Image;return e.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=Od.priority,s.src=t,C2e(s,t,i,r)}yr._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],yr._beforeFetch=void 0,yr._afterFetch=void 0;async function Z7e(t,e,i,r){const s=e.exec(i);if(!s)throw new G("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${e}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=hqe(r),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let u;try{u=await Eue(t(c))}catch(d){if(c===l)throw new G("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:d});try{u=await Eue(t(l))}catch(f){throw new G("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:f})}}return u}async function Eue(t){if(Cue.fetchBundleAsset!=null)return Cue.fetchBundleAsset(t);const e=await yr(t,{responseType:"text"});return JSON.parse(e.data)}let Y7e=class{constructor({base:e="",pattern:i,location:r=new URL(window.location.href)}){let s;s=typeof r=="string"?n=>new URL(n,new URL(r,window.location.href)).href:r instanceof URL?n=>new URL(n,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=s,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)\\/)?(.*)$`)}fetchMessageBundle(e,i){return Z7e(this.getAssetUrl,this.matcher,e,i)}};function X7e(t){return new Y7e(t)}const Cue={};function J7e(t,e){return yr(mr(t),e)}function mr(t){if(!rr.assetsPath)throw se.getLogger("esri.assets").errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new G("assets:path-not-set","config.assetsPath is not set");return Uh(rr.assetsPath,t)}uqe(X7e({pattern:"esri/",location:mr}));let nk=class O2e{constructor(){this._emitter=new O2e.EventEmitter(this)}emit(e,i){return this._emitter.emit(e,i)}on(e,i){return this._emitter.on(e,i)}once(e,i){return this._emitter.once(e,i)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(s=null){this._target=s,this._listenersMap=null}clear(){var s;(s=this._listenersMap)==null||s.clear(),this._listenersMap=null}destroy(){this.clear()}emit(s,n){var c;let o=(c=this._listenersMap)==null?void 0:c.get(s);if(!o)return!1;const a=this._target||this;let l=!1;for(const u of o.slice()){const d="deref"in u?u.deref():u;d?d==null||d.call(a,n):l=!0}return l&&(o=o.filter(u=>!("deref"in u)||u.deref()!=null),this._listenersMap.set(s,o)),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return ES(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),Gi(()=>{var c;const a=(c=this._listenersMap)==null?void 0:c.get(s),l=(a==null?void 0:a.indexOf(n))??-1;l>=0&&a.splice(l,1)})}once(s,n){const o=this.on(s,a=>{o.remove();const l="deref"in n?n.deref():n;l==null||l.call(null,a)});return o}hasEventListener(s){var o;const n=(o=this._listenersMap)==null?void 0:o.get(s);return n!=null&&n.length>0}}t.EventEmitter=e,t.EventedMixin=r=>{let s=class extends r{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=h([I("esri.core.Evented")],s),s};let i=class extends Ue{constructor(){super(...arguments),this._emitter=new nk.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,s){return this._emitter.emit(r,s)}on(r,s){return this._emitter.on(r,s)}once(r,s){return this._emitter.once(r,s)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=h([I("esri.core.Evented.EventedAccessor")],i),t.EventedAccessor=i})(nk||(nk={}));const Us=nk;var Lr;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(Lr||(Lr={}));function Gie(t){return(e,i)=>{e[i]=t}}let BP=class extends SSe{notify(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onInvalidated(),r.onCommitted()}}};var O0;let Q7e=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},K7e=class{constructor(e,i,r,s,n){this.target=e,this.added=i,this.removed=r,this.start=s,this.deleteCount=n}};const Yh=new la(Q7e,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1});function Mue(t){t&&typeof t=="object"&&"destroy"in t&&typeof t.destroy=="function"&&t.destroy()}function DH(t){return t?t instanceof T0?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function NH(t){if(t!=null&&t.length)return t[0]}function eWe(t,e,i,r){const s=Math.min(t.length-i,e.length-r);let n=0;for(;n<s&&t[i+n]===e[r+n];)n++;return n}function R2e(t,e,i,r){e&&e.forEach((s,n,o)=>{t.push(s),R2e(t,i.call(r,s,n,o),i,r)})}const G_=new Set,H_=new Set,q_=new Set,FH=new Map;let tWe=0,T0=O0=class extends Us.EventedAccessor{static isCollection(t){return t!=null&&t instanceof O0}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new BP,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:tWe++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof O0?{items:t}:t:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),this._emitter.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return Ft(this._observable),this._items}set items(t){this._emitBeforeChanges(Lr.ADD)||(this._splice(0,this.length,DH(t)),this._emitAfterChanges(Lr.ADD))}hasEventListener(t){return!this.destroyed&&(t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t))}on(t,e){if(this.destroyed)return Gi();if(t==="change"){const i=this._chgListeners,r={removed:!1,callback:e};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),Gi(()=>{r.removed=!0,i.splice(i.indexOf(r),1)})}return this._emitter.on(t,e)}once(t,e){const i="deref"in e?()=>e.deref():()=>e,r=this.on(t,s=>{var n;(n=i())==null||n.call(null,s),r.remove()});return r}add(t,e){if(Ft(this._observable),this._emitBeforeChanges(Lr.ADD))return this;const i=this.getNextIndex(e??null);return this._splice(i,0,[t]),this._emitAfterChanges(Lr.ADD),this}addMany(t,e=this._items.length){if(Ft(this._observable),!(t!=null&&t.length))return this;if(this._emitBeforeChanges(Lr.ADD))return this;const i=this.getNextIndex(e);return this._splice(i,0,DH(t)),this._emitAfterChanges(Lr.ADD),this}at(t){if(Ft(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(Ft(this._observable),!this.length||this._emitBeforeChanges(Lr.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(Lr.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return Ft(this._observable),this._createNewInstance({items:this._items.map(ie)})}concat(...t){Ft(this._observable);const e=t.map(DH);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(Ft(this._observable),!this.length||this._emitBeforeChanges(Lr.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let s=0;s<r;s++)t.call(e,i[s],s,i);this._emitAfterChanges(Lr.REMOVE)}destroyAll(){this.drain(Mue)}destroyMany(t){const e=this.removeMany(t);return e.forEach(Mue),e}every(t,e){return Ft(this._observable),this._items.every(t,e)}filter(t,e){let i;return Ft(this._observable),i=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:i})}find(t,e){return Ft(this._observable),this._items.find(t,e)}findIndex(t,e){return Ft(this._observable),this._items.findIndex(t,e)}flatten(t,e){Ft(this._observable);const i=[];return R2e(i,this,t,e),new O0(i)}forEach(t,e){return Ft(this._observable),this._items.forEach(t,e)}getItemAt(t){return Ft(this._observable),this._items[t]}getNextIndex(t){Ft(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return Ft(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return Ft(this._observable),this._items.indexOf(t,e)}join(t=","){return Ft(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return Ft(this._observable),this._items.lastIndexOf(t,e)}map(t,e){Ft(this._observable);const i=this._items.map(t,e);return new O0({items:i})}reorder(t,e=this.length-1){Ft(this._observable);const i=this.indexOf(t);if(i!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),i!==e){if(this._emitBeforeChanges(Lr.MOVE))return t;this._splice(i,1),this._splice(e,0,[t]),this._emitAfterChanges(Lr.MOVE)}return t}}pop(){if(Ft(this._observable),!this.length||this._emitBeforeChanges(Lr.REMOVE))return;const t=NH(this._splice(this.length-1,1));return this._emitAfterChanges(Lr.REMOVE),t}push(...t){return Ft(this._observable),this._emitBeforeChanges(Lr.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(Lr.ADD)),this.length}reduce(t,e){Ft(this._observable);const i=this._items;return arguments.length===2?i.reduce(t,e):i.reduce(t)}reduceRight(t,e){Ft(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(t,e):i.reduceRight(t)}remove(t){return Ft(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(Ft(this._observable),t<0||t>=this.length||this._emitBeforeChanges(Lr.REMOVE))return;const e=NH(this._splice(t,1));return this._emitAfterChanges(Lr.REMOVE),e}removeMany(t){if(Ft(this._observable),!(t!=null&&t.length)||this._emitBeforeChanges(Lr.REMOVE))return[];const e=t instanceof O0?t.toArray():t,i=this._items,r=[],s=e.length;for(let n=0;n<s;n++){const o=e[n],a=i.indexOf(o);if(a>-1){const l=1+eWe(e,i,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&r.push.apply(r,c),n+=l-1}}return this._emitAfterChanges(Lr.REMOVE),r}reverse(){if(Ft(this._observable),this._emitBeforeChanges(Lr.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(Lr.MOVE),this}shift(){if(Ft(this._observable),!this.length||this._emitBeforeChanges(Lr.REMOVE))return;const t=NH(this._splice(0,1));return this._emitAfterChanges(Lr.REMOVE),t}slice(t=0,e=this.length){return Ft(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return Ft(this._observable),this._items.some(t,e)}sort(t){if(Ft(this._observable),!this.length||this._emitBeforeChanges(Lr.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(Lr.MOVE),this}splice(t,e,...i){Ft(this._observable);const r=(e?Lr.REMOVE:0)|(i.length?Lr.ADD:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(t,e,i)||[];return this._emitAfterChanges(r),s}toArray(){return Ft(this._observable),this._items.slice()}toJSON(){return Ft(this._observable),this.toArray()}toLocaleString(){return Ft(this._observable),this._items.toLocaleString()}toString(){return Ft(this._observable),this._items.toString()}unshift(...t){return Ft(this._observable),!t.length||this._emitBeforeChanges(Lr.ADD)||(this._splice(0,0,t),this._emitAfterChanges(Lr.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,i){const r=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=p2(()=>this._dispatchChange())),t<0&&(t+=this.length),e){if(o=r.splice(t,e),this.hasEventListener("before-remove")){const a=Yh.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),r.splice(t,0,n),t+=1,l-=1,c-=1);Yh.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=Yh.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);Yh.release(a)}}if(i!=null&&i.length){if(s){const u=[];for(const d of i){const f=s.ensureType(d);f==null&&d!=null||u.push(f)}i=u}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const u=Yh.acquire();u.target=this,u.cancellable=!0;const d=Yh.acquire();d.target=this,d.cancellable=!1;for(const f of i)a?(u.reset(f),this.emit("before-add",u),u.defaultPrevented||(c?r.push(f):r.splice(t++,0,f),this._set("length",r.length),l&&(d.reset(f),this.emit("after-add",d)))):(c?r.push(f):r.splice(t++,0,f),this._set("length",r.length),d.reset(f),this.emit("after-add",d));Yh.release(d),Yh.release(u)}else{if(c)for(const u of i)r.push(u);else r.splice(t,0,...i);this._set("length",r.length)}}if((i!=null&&i.length||o!=null&&o.length)&&this._notifyChangeEvent(i,o),this.hasEventListener("after-splice")){const a=new K7e(this,i,o,t,e);this.emit("after-splice",a)}return o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const i=Yh.acquire();i.target=this,i.cancellable=!0,i.type=t,this.emit("before-changes",i),e=i.defaultPrevented,Yh.release(i)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=Yh.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),Yh.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const i=e.changes;G_.clear(),H_.clear(),q_.clear();for(const{added:l,removed:c}of i){if(l)if(q_.size===0&&H_.size===0)for(const u of l)G_.add(u);else for(const u of l)H_.has(u)?(q_.add(u),H_.delete(u)):q_.has(u)||G_.add(u);if(c)if(q_.size===0&&G_.size===0)for(const u of c)H_.add(u);else for(const u of c)G_.has(u)?G_.delete(u):(q_.delete(u),H_.add(u))}const r=vu.acquire();G_.forEach(l=>{r.push(l)});const s=vu.acquire();H_.forEach(l=>{s.push(l)});const n=this._items,o=e.items,a=vu.acquire();if(q_.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),e.listeners&&(r.length||s.length||a.length)){const l={target:this,added:r,removed:s,moved:a},c=e.listeners.length;for(let u=0;u<c;u++){const d=e.listeners[u];d.removed||d.callback.call(this,l)}}vu.release(r),vu.release(s),vu.release(a)}G_.clear(),H_.clear(),q_.clear()}};T0.ofType=t=>{if(!t)return O0;if(FH.has(t))return FH.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const r in t.typeMap){const s=t.typeMap[r].prototype.declaredClass;e?e+=` | ${s}`:e=s}let i=class extends O0{};return h([Gie({Type:t,ensureType:typeof t=="function"?Qs(t):Gf(t)})],i.prototype,"itemType",void 0),i=h([I(`esri.core.Collection<${e}>`)],i),FH.set(t,i),i},h([p()],T0.prototype,"_updating",void 0),h([p()],T0.prototype,"length",void 0),h([p()],T0.prototype,"items",null),h([p({readOnly:!0})],T0.prototype,"updating",null),T0=O0=h([I("esri.core.Collection")],T0);const st=T0;function Kg(t,e,i=st){return e||(e=new i),e===t||(e.removeAll(),iWe(t)?e.addMany(t):t&&e.add(t)),e}function Hie(t){return t}function iWe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}var p1;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(p1||(p1={}));let rWe=class{constructor(){this._resolver=aa(),this._status=p1.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=p1.RESOLVED,this._cleanUp()},()=>{this._status=p1.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===p1.RESOLVED}isRejected(){return this._status===p1.REJECTED}isFulfilled(){return this._status!==p1.PENDING}abort(){this._resolver.reject(ki())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=aa(),i=[...this._resolvingPromises,e.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve()},s=>{this.isFulfilled()||this._allPromise!==r||os(s)||this._resolver.reject(s)}),e.resolve()}};const dD=t=>{let e=class extends t{constructor(...i){super(...i),this._promiseProps=new rWe,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return this._promiseProps.promise.then(()=>this).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return e=h([I("esri.core.Promise")],e),e};let iz=class extends dD(Ue){};iz=h([I("esri.core.Promise")],iz);const sWe="not-loaded",nWe="loading",oWe="failed",Aue="loaded",$2e=t=>{let e=class extends t{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=oD(n,l);this.destroyed&&l(new G("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===sWe){this._set("loadStatus",nWe);const a=this._loadController=new AbortController;s({signal:a.signal})}return r(),o}})),this.when(()=>{this._set("loadStatus",Aue),this._loadController=null},r=>{this._set("loadStatus",oWe),this._set("loadError",r),this._loadController=null})}destroy(){this._loadController&&(this._loadController=Jl(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===Aue}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var i;return this.isFulfilled()||(this._set("loadError",new G("load:cancelled","Cancelled")),(i=this._loadController)==null||i.abort(),this._promiseProps.abort()),this}};return h([p({readOnly:!0})],e.prototype,"loaded",null),h([p({readOnly:!0})],e.prototype,"loadError",void 0),h([p({clonable:!1})],e.prototype,"loadStatus",void 0),h([p({type:[Jg],readOnly:!0})],e.prototype,"loadWarnings",null),e=h([I("esri.core.Loadable")],e),e};let FR=class extends $2e(iz){};FR=h([I("esri.core.Loadable")],FR),function(t){function e(i){return!(!i||!i.load)}t.LoadableMixin=$2e,t.isLoadable=e}(FR||(FR={}));const ey=FR;function jj(t,e,i){return jf(t.map((r,s)=>e.apply(i,[r,s])))}async function aWe(t,e,i){return(await jf(t.map((r,s)=>e.apply(i,[r,s])))).map(r=>r.value)}function qie(t){return{ok:!0,value:t}}function Wie(t){return{ok:!1,error:t}}function lWe(t){return t!=null&&t.ok===!0?t.value:null}function cWe(t){return t!=null&&t.ok===!1?t.error:null}async function Vh(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return qie(await t)}catch(e){return Wie(e)}}async function uWe(t){try{return qie(await t)}catch(e){return jl(e),Wie(e)}}function nqt(t){if(t.ok===!0)return t.value;throw t.error}function uy(t,e){return new Cv(t,e)}let Cv=class extends Ue{get value(){return lWe(this._result)}get error(){return cWe(this._result)}get finished(){return this._result!=null}constructor(e,i){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=Jl(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(s=>{this._result=qie(s),this._cleanup()},s=>{this._result=Wie(s),this._cleanup()}),this._abortHandle=Ra(i,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=$r(this._abortHandle),this._abortController=null}};h([p()],Cv.prototype,"value",null),h([p()],Cv.prototype,"error",null),h([p()],Cv.prototype,"finished",null),h([p()],Cv.prototype,"promise",void 0),h([p()],Cv.prototype,"_result",void 0),Cv=h([I("esri.core.asyncUtils.ReactiveTask")],Cv);async function Zie(t,e){return await t.load(),hWe(t,e)}async function hWe(t,e){const i=[],r=(...n)=>{for(const o of n)o!=null&&(Array.isArray(o)?r(...o):st.isCollection(o)?o.forEach(a=>r(a)):ey.isLoadable(o)&&i.push(o))};e(r);let s=null;if(await aWe(i,async n=>{const o=await Vh(dWe(n)?n.loadAll():n.load());o.ok!==!1||s||(s=o)}),s)throw s.error;return t}function dWe(t){return"loadAll"in t&&typeof t.loadAll=="function"}function We(t,e,i){let r,s;return e===void 0?(s=t,r=[void 0]):typeof e!="string"?(s=t,r=[void 0],i=e):(s=e,r=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;for(const l of r){const c=qSe(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=a[o]}}}let Yie=class{constructor(e,i,r,s){this.semiMajorAxis=e,this.flattening=i,this.outerAtmosphereRimWidth=r;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const lr=new Yie(6378137,1/298.257223563,3e5,.006694379990137799),Nf=new Yie(3396190,1/169.8944472236118,23e4),n_=new Yie(1737400,0,0);let kH,pe=null;function I2e(){return!!pe}function pWe(){return!!le("esri-wasm")}function L2e(){return kH||(kH=ce(()=>import("./pe-wasm-DmmvuX_Q.js"),[]).then(t=>t.p).then(({default:t})=>t({locateFile:e=>mr(`esri/geometry/support/${e}`)})).then(t=>{N2e(t)}),kH)}var iZ,on,rZ;(function(t){function e(n,o,a){pe.ensureCache.prepare();const l=mT(a),c=a===l,u=pe.ensureFloat64(l),d=pe._pe_geog_to_proj(pe.getPointer(n),o,u);return d&&M1(a,o,u,c),d}function i(n,o,a,l){switch(l){case on.PE_TRANSFORM_P_TO_G:return r(n,o,a);case on.PE_TRANSFORM_G_TO_P:return e(n,o,a)}return 0}function r(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){pe.ensureCache.prepare();const c=mT(a),u=a===c,d=pe.ensureFloat64(c),f=pe._pe_proj_to_geog_center(pe.getPointer(n),o,d,l);return f&&M1(a,o,d,u),f}t.geogToProj=e,t.projGeog=i,t.projToGeog=r,t.projToGeogCenter=s})(iZ||(iZ={})),function(t){function e(){t.PE_BUFFER_MAX=pe.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=pe.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=pe.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=pe.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=pe.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=pe.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=pe.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=pe.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=pe.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=pe.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=pe.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=pe.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=pe.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=pe.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=pe.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=pe.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=pe.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=pe.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=pe.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=pe.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_STR_FMT_WKT=pe.PeDefs.prototype.PE_STR_FMT_WKT,t.PE_STR_FMT_WKT2=pe.PeDefs.prototype.PE_STR_FMT_WKT2,t.PE_PARM_X0=pe.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=pe.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=pe.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=pe.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=pe.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=pe.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(on||(on={})),function(t){const e={},i={},r=m=>{if(m){const g=m.getType();switch(g){case on.PE_TYPE_GEOGCS:m=pe.castObject(m,pe.PeGeogcs);break;case on.PE_TYPE_PROJCS:m=pe.castObject(m,pe.PeProjcs);break;case on.PE_TYPE_GEOGTRAN:m=pe.castObject(m,pe.PeGeogtran);break;default:g&on.PE_TYPE_UNIT&&(m=pe.castObject(m,pe.PeUnit))}}return m};function s(){pe.PeFactory.prototype.initialize(null)}function n(m){return o(on.PE_TYPE_COORDSYS,m)}function o(m,g){let y=null,v=e[m];if(v||(v={},e[m]=v),v.hasOwnProperty(String(g)))y=v[g];else{const b=pe.PeFactory.prototype.factoryByType(m,g);pe.compare(b,pe.NULL)||(y=b,v[g]=y)}return y=r(y),y}function a(m,g){let y=null,v=i[m];if(v||(v={},i[m]=v),v.hasOwnProperty(g))y=v[g];else{const b=pe.PeFactory.prototype.fromString(m,g);pe.compare(b,pe.NULL)||(y=b,v[g]=y)}return y=r(y),y}function l(m){return o(on.PE_TYPE_GEOGCS,m)}function c(m){return o(on.PE_TYPE_GEOGTRAN,m)}function u(m){return pe.PeFactory.prototype.getCode(m)}function d(m){return o(on.PE_TYPE_PROJCS,m)}function f(m){return o(on.PE_TYPE_UNIT,m)}t.initialize=s,t.coordsys=n,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=u,t.projcs=d,t.unit=f}(rZ||(rZ={}));let D2e=null;var rz,sZ,nZ,oZ,sz,aZ,nz,oz,lZ;function N2e(t){function e(n,o,a){n[o]=a(n[o])}pe=t,on.init(),rz.init(),sz.init(),nz.init(),oz.init(),D2e=class extends pe.PeGCSExtent{destroy(){pe.destroy(this)}};const i=[pe.PeDatum,pe.PeGeogcs,pe.PeGeogtran,pe.PeObject,pe.PeParameter,pe.PePrimem,pe.PeProjcs,pe.PeSpheroid,pe.PeUnit];for(const n of i)e(n.prototype,"getName",o=>function(){return o.call(this,new Array(on.PE_NAME_MAX))});for(const n of[pe.PeGeogtran,pe.PeProjcs])e(n.prototype,"getParameters",o=>function(){const a=new Array(on.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const u=pe.getValue(l,"*");a[c]=u?pe.wrapPointer(u,pe.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(pe.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return M1(a,o,n.call(this)),a}),e(pe.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=pe._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!pe.compare(l,pe.NULL)){a=[l];const c=this.getSteps();if(c>1){const u=pe.getPointer(l);for(let d=1;d<c;d++)a.push(pe.wrapPointer(u+o*d,pe.PeGTlistExtendedGTs))}}return a}});const r=pe._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!pe.compare(l,pe.NULL)){a=[l];const c=l.getNump();if(c>1){const u=pe.getPointer(l);for(let d=1;d<c;d++)a.push(pe.wrapPointer(u+r*d,pe.PeHorizon))}}return o.set(n,a),a};e(pe.PeProjcs.prototype,"horizonGcsGenerate",s),e(pe.PeProjcs.prototype,"horizonPcsGenerate",s),pe.PeObject.prototype.toString=function(n=on.PE_STR_OPTS_NONE){pe.ensureCache.prepare();const o=pe.getPointer(this),a=pe.ensureInt8(new Array(on.PE_BUFFER_MAX));return pe.UTF8ToString(pe._pe_object_to_string_ext(o,n,a))}}function My(t){if(!t)return;const e=pe.getClass(t);if(!e)return;const i=pe.getCache(e);if(!i)return;const r=pe.getPointer(t);r&&delete i[r]}function NN(t,e){const i=[],r=new Array(e);for(let s=0;s<t;s++)i.push(pe.ensureInt8(r));return i}function mT(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(i=>{e.push(i[0],i[1])})):e=t,e}function M1(t,e,i,r=!1){if(r)for(let s=0;s<2*e;s++)t[s]=pe.getValue(i+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=t.length===0;for(let n=0;n<e;n++)s&&(t[n]=new Array(2)),t[n][0]=pe.getValue(i,"double"),t[n][1]=pe.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function i(){t.PE_GTLIST_OPTS_COMMON=pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=pe._pe_getPeGTlistExtendedEntrySize()}function r(s,n,o,a,l,c){let u=null;const d=new pe.PeInteger(c);try{const f=pe.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,d);if((c=d.val)&&(u=[f],c>1)){const m=pe.getPointer(f);for(let g=1;g<c;g++)u.push(pe.wrapPointer(m+e*g,pe.PeGTlistExtendedEntry))}}finally{pe.destroy(d)}return u}t.init=i,t.getGTlist=r})(rz||(rz={})),function(t){function e(i){if(i!=null&&i.length){for(const r of i)My(r),r.getEntries().forEach(s=>{My(s);const n=s.getGeogtran();My(n),n.getParameters().forEach(My),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{My(o);const a=o.getDatum();My(a),My(a.getSpheroid()),My(o.getPrimem()),My(o.getUnit())})});pe.PeGTlistExtendedEntry.prototype.Delete(i[0])}}t.destroy=e}(sZ||(sZ={})),function(t){function e(i,r,s,n,o){pe.ensureCache.prepare();const a=mT(s),l=s===a,c=pe.ensureFloat64(a);let u=0;n&&(u=pe.ensureFloat64(n));const d=pe._pe_geog_to_geog(pe.getPointer(i),r,c,u,o);return d&&M1(s,r,c,l),d}t.geogToGeog=e}(nZ||(nZ={})),function(t){const e=(c,u,d,f,m,g)=>{let y,v;switch(pe.ensureCache.prepare(),c){case"dd":y=pe._pe_geog_to_dd,v=on.PE_DD_MAX;break;case"ddm":y=pe._pe_geog_to_ddm,v=on.PE_DDM_MAX;break;case"dms":y=pe._pe_geog_to_dms,v=on.PE_DMS_MAX}let b=0;u&&(b=pe.getPointer(u));const w=mT(f),x=pe.ensureFloat64(w),S=NN(d,v),C=y(b,d,x,m,pe.ensureInt32(S));if(C)for(let M=0;M<d;M++)g[M]=pe.UTF8ToString(S[M]);return C},i=(c,u,d,f,m)=>{let g;switch(pe.ensureCache.prepare(),c){case"dd":g=pe._pe_dd_to_geog;break;case"ddm":g=pe._pe_ddm_to_geog;break;case"dms":g=pe._pe_dms_to_geog}let y=0;u&&(y=pe.getPointer(u));const v=f.map(S=>pe.ensureString(S)),b=pe.ensureInt32(v),w=pe.ensureFloat64(new Array(2*d)),x=g(y,d,b,w);return x&&M1(m,d,w),x};function r(c,u,d,f,m){return e("dms",c,u,d,f,m)}function s(c,u,d,f){return i("dms",c,u,d,f)}function n(c,u,d,f,m){return e("ddm",c,u,d,f,m)}function o(c,u,d,f){return i("ddm",c,u,d,f)}function a(c,u,d,f,m){return e("dd",c,u,d,f,m)}function l(c,u,d,f){return i("dd",c,u,d,f)}t.geogToDms=r,t.dmsToGeog=s,t.geogToDdm=n,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(oZ||(oZ={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(s,n,o,a,l,c,u){pe.ensureCache.prepare();let d=0;s&&(d=pe.getPointer(s));const f=mT(o),m=pe.ensureFloat64(f),g=NN(n,on.PE_MGRS_MAX),y=pe.ensureInt32(g),v=pe._pe_geog_to_mgrs_extended(d,n,m,a,l,c,y);if(v)for(let b=0;b<n;b++)u[b]=pe.UTF8ToString(g[b]);return v}function r(s,n,o,a,l){pe.ensureCache.prepare();let c=0;s&&(c=pe.getPointer(s));const u=o.map(g=>pe.ensureString(g)),d=pe.ensureInt32(u),f=pe.ensureFloat64(new Array(2*n)),m=pe._pe_mgrs_to_geog_extended(c,n,d,a,f);return m&&M1(l,n,f),m}t.init=e,t.geogToMgrsExtended=i,t.mgrsToGeogExtended=r}(sz||(sz={})),function(t){function e(r,s,n,o,a,l,c){pe.ensureCache.prepare();let u=0;r&&(u=pe.getPointer(r));const d=mT(n),f=pe.ensureFloat64(d),m=NN(s,on.PE_MGRS_MAX),g=pe.ensureInt32(m),y=pe._pe_geog_to_usng(u,s,f,o,a,l,g);if(y)for(let v=0;v<s;v++)c[v]=pe.UTF8ToString(m[v]);return y}function i(r,s,n,o){pe.ensureCache.prepare();let a=0;r&&(a=pe.getPointer(r));const l=n.map(f=>pe.ensureString(f)),c=pe.ensureInt32(l),u=pe.ensureFloat64(new Array(2*s)),d=pe._pe_usng_to_geog(a,s,c,u);return d&&M1(o,s,u),d}t.geogToUsng=e,t.usngToGeog=i}(aZ||(aZ={})),function(t){function e(){t.PE_UTM_OPTS_NONE=pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(s,n,o,a,l){pe.ensureCache.prepare();let c=0;s&&(c=pe.getPointer(s));const u=mT(o),d=pe.ensureFloat64(u),f=NN(n,on.PE_UTM_MAX),m=pe.ensureInt32(f),g=pe._pe_geog_to_utm(c,n,d,a,m);if(g)for(let y=0;y<n;y++)l[y]=pe.UTF8ToString(f[y]);return g}function r(s,n,o,a,l){pe.ensureCache.prepare();let c=0;s&&(c=pe.getPointer(s));const u=o.map(g=>pe.ensureString(g)),d=pe.ensureInt32(u),f=pe.ensureFloat64(new Array(2*n)),m=pe._pe_utm_to_geog(c,n,d,a,f);return m&&M1(l,n,f),m}t.init=e,t.geogToUtm=i,t.utmToGeog=r}(nz||(nz={})),function(t){const e=new Map;function i(){t.PE_PCSINFO_OPTION_NONE=pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=pe.PePCSInfo.prototype.PE_POLE_POINT}function r(s,n=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(s)&&(a=e.get(s),a[n]&&(o=a[n])),o||(o=pe.PePCSInfo.prototype.generate(s,n),a||(a=[],e.set(s,a)),a[n]=o),o}t.init=i,t.generate=r}(oz||(oz={})),function(t){function e(){return pe.PeVersion.prototype.version_string()}t.versionString=e}(lZ||(lZ={}));const fWe=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return iZ},get PeDefs(){return on},get PeFactory(){return rZ},get PeGCSExtent(){return D2e},get PeGTTransformations(){return nZ},get PeGTlistExtended(){return rz},get PeGTlistExtendedEntry(){return sZ},get PeNotationDms(){return oZ},get PeNotationMgrs(){return sz},get PeNotationUsng(){return aZ},get PeNotationUtm(){return nz},get PePCSInfo(){return oz},get PeVersion(){return lZ},_init:N2e,get _pe(){return pe},isLoaded:I2e,isSupported:pWe,load:L2e},Symbol.toStringTag,{value:"Module"}));var Su;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(Su||(Su={}));let _;const F={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9895:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,10160:0,10183:0,10188:0,10194:0,10199:0,10207:0,10212:0,10217:0,10222:0,10227:0,10235:0,10240:0,10250:0,10254:0,10270:0,10275:0,10280:0,10306:0,10329:0,10471:0,10477:0,10481:2,10516:2,20002:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2,103897:1};for(_=2e3;_<=2045;_++)F[_]=0;for(_=2056;_<=2065;_++)F[_]=0;for(_=2067;_<=2135;_++)F[_]=0;for(_=2137;_<=2154;_++)F[_]=0;for(_=2161;_<=2170;_++)F[_]=0;for(_=2172;_<=2193;_++)F[_]=0;for(_=2195;_<=2198;_++)F[_]=0;for(_=2200;_<=2203;_++)F[_]=0;for(_=2205;_<=2217;_++)F[_]=0;for(_=2222;_<=2224;_++)F[_]=1;for(_=2225;_<=2250;_++)F[_]=2;for(_=2251;_<=2253;_++)F[_]=1;for(_=2257;_<=2264;_++)F[_]=2;for(_=2274;_<=2279;_++)F[_]=2;for(_=2280;_<=2282;_++)F[_]=1;for(_=2283;_<=2289;_++)F[_]=2;for(_=2290;_<=2292;_++)F[_]=0;for(_=2308;_<=2313;_++)F[_]=0;for(_=2315;_<=2491;_++)F[_]=0;for(_=2494;_<=2866;_++)F[_]=0;for(_=2867;_<=2869;_++)F[_]=1;for(_=2870;_<=2888;_++)F[_]=2;for(_=2891;_<=2895;_++)F[_]=2;for(_=2896;_<=2898;_++)F[_]=1;for(_=2902;_<=2908;_++)F[_]=2;for(_=2915;_<=2920;_++)F[_]=2;for(_=2921;_<=2923;_++)F[_]=1;for(_=2924;_<=2930;_++)F[_]=2;for(_=2931;_<=2962;_++)F[_]=0;for(_=2964;_<=2968;_++)F[_]=2;for(_=2969;_<=2973;_++)F[_]=0;for(_=2975;_<=2991;_++)F[_]=0;for(_=2995;_<=3051;_++)F[_]=0;for(_=3054;_<=3079;_++)F[_]=0;for(_=3081;_<=3088;_++)F[_]=0;for(_=3092;_<=3101;_++)F[_]=0;for(_=3106;_<=3138;_++)F[_]=0;for(_=3146;_<=3151;_++)F[_]=0;for(_=3153;_<=3166;_++)F[_]=0;for(_=3168;_<=3172;_++)F[_]=0;for(_=3174;_<=3203;_++)F[_]=0;for(_=3294;_<=3358;_++)F[_]=0;for(_=3367;_<=3403;_++)F[_]=0;for(_=3408;_<=3416;_++)F[_]=0;for(_=3417;_<=3438;_++)F[_]=2;for(_=3441;_<=3446;_++)F[_]=2;for(_=3447;_<=3450;_++)F[_]=0;for(_=3451;_<=3459;_++)F[_]=2;for(_=3460;_<=3478;_++)F[_]=0;for(_=3554;_<=3559;_++)F[_]=0;for(_=3560;_<=3570;_++)F[_]=2;for(_=3571;_<=3581;_++)F[_]=0;for(_=3594;_<=3597;_++)F[_]=0;for(_=3601;_<=3604;_++)F[_]=0;for(_=3637;_<=3639;_++)F[_]=0;for(_=3665;_<=3667;_++)F[_]=0;for(_=3693;_<=3695;_++)F[_]=0;for(_=3701;_<=3727;_++)F[_]=0;for(_=3728;_<=3739;_++)F[_]=2;for(_=3740;_<=3751;_++)F[_]=0;for(_=3753;_<=3760;_++)F[_]=2;for(_=3761;_<=3773;_++)F[_]=0;for(_=3775;_<=3777;_++)F[_]=0;for(_=3779;_<=3781;_++)F[_]=0;for(_=3783;_<=3785;_++)F[_]=0;for(_=3788;_<=3791;_++)F[_]=0;for(_=3797;_<=3802;_++)F[_]=0;for(_=3814;_<=3816;_++)F[_]=0;for(_=3825;_<=3829;_++)F[_]=0;for(_=3832;_<=3841;_++)F[_]=0;for(_=3844;_<=3852;_++)F[_]=0;for(_=3873;_<=3885;_++)F[_]=0;for(_=3890;_<=3893;_++)F[_]=0;for(_=3907;_<=3912;_++)F[_]=0;for(_=3942;_<=3950;_++)F[_]=0;for(_=3968;_<=3970;_++)F[_]=0;for(_=3973;_<=3976;_++)F[_]=0;for(_=3986;_<=3989;_++)F[_]=0;for(_=3994;_<=3997;_++)F[_]=0;for(_=4048;_<=4051;_++)F[_]=0;for(_=4056;_<=4063;_++)F[_]=0;for(_=4093;_<=4096;_++)F[_]=0;for(_=4390;_<=4398;_++)F[_]=0;for(_=4399;_<=4413;_++)F[_]=2;for(_=4418;_<=4433;_++)F[_]=2;for(_=4455;_<=4457;_++)F[_]=2;for(_=4484;_<=4489;_++)F[_]=0;for(_=4491;_<=4554;_++)F[_]=0;for(_=4568;_<=4589;_++)F[_]=0;for(_=4652;_<=4656;_++)F[_]=0;for(_=4766;_<=4800;_++)F[_]=0;for(_=5014;_<=5016;_++)F[_]=0;for(_=5069;_<=5072;_++)F[_]=0;for(_=5105;_<=5130;_++)F[_]=0;for(_=5167;_<=5188;_++)F[_]=0;for(_=5253;_<=5259;_++)F[_]=0;for(_=5269;_<=5275;_++)F[_]=0;for(_=5292;_<=5311;_++)F[_]=0;for(_=5329;_<=5331;_++)F[_]=0;for(_=5343;_<=5349;_++)F[_]=0;for(_=5355;_<=5357;_++)F[_]=0;for(_=5387;_<=5389;_++)F[_]=0;for(_=5459;_<=5463;_++)F[_]=0;for(_=5479;_<=5482;_++)F[_]=0;for(_=5518;_<=5520;_++)F[_]=0;for(_=5530;_<=5539;_++)F[_]=0;for(_=5550;_<=5552;_++)F[_]=0;for(_=5562;_<=5583;_++)F[_]=0;for(_=5623;_<=5625;_++)F[_]=2;for(_=5631;_<=5639;_++)F[_]=0;for(_=5649;_<=5653;_++)F[_]=0;for(_=5663;_<=5680;_++)F[_]=0;for(_=5682;_<=5685;_++)F[_]=0;for(_=5875;_<=5877;_++)F[_]=0;for(_=5896;_<=5899;_++)F[_]=0;for(_=5921;_<=5940;_++)F[_]=0;for(_=6050;_<=6125;_++)F[_]=0;for(_=6244;_<=6275;_++)F[_]=0;for(_=6328;_<=6348;_++)F[_]=0;for(_=6350;_<=6356;_++)F[_]=0;for(_=6366;_<=6372;_++)F[_]=0;for(_=6381;_<=6387;_++)F[_]=0;for(_=6393;_<=6404;_++)F[_]=0;for(_=6480;_<=6483;_++)F[_]=0;for(_=6511;_<=6514;_++)F[_]=0;for(_=6579;_<=6581;_++)F[_]=0;for(_=6619;_<=6624;_++)F[_]=0;for(_=6625;_<=6627;_++)F[_]=2;for(_=6628;_<=6632;_++)F[_]=0;for(_=6634;_<=6637;_++)F[_]=0;for(_=6669;_<=6692;_++)F[_]=0;for(_=6707;_<=6709;_++)F[_]=0;for(_=6720;_<=6723;_++)F[_]=0;for(_=6732;_<=6738;_++)F[_]=0;for(_=6931;_<=6933;_++)F[_]=0;for(_=6956;_<=6959;_++)F[_]=0;for(_=7005;_<=7007;_++)F[_]=0;for(_=7057;_<=7070;_++)F[_]=2;for(_=7074;_<=7082;_++)F[_]=0;for(_=7109;_<=7118;_++)F[_]=0;for(_=7119;_<=7127;_++)F[_]=1;for(_=7374;_<=7376;_++)F[_]=0;for(_=7528;_<=7586;_++)F[_]=0;for(_=7587;_<=7645;_++)F[_]=2;for(_=7692;_<=7696;_++)F[_]=0;for(_=7755;_<=7787;_++)F[_]=0;for(_=7791;_<=7795;_++)F[_]=0;for(_=7799;_<=7801;_++)F[_]=0;for(_=7803;_<=7805;_++)F[_]=0;for(_=7825;_<=7831;_++)F[_]=0;for(_=7845;_<=7859;_++)F[_]=0;for(_=8013;_<=8032;_++)F[_]=0;for(_=8065;_<=8068;_++)F[_]=1;for(_=8518;_<=8529;_++)F[_]=2;for(_=8533;_<=8536;_++)F[_]=2;for(_=8538;_<=8540;_++)F[_]=2;for(_=8677;_<=8679;_++)F[_]=0;for(_=8836;_<=8840;_++)F[_]=0;for(_=8857;_<=8859;_++)F[_]=0;for(_=8908;_<=8910;_++)F[_]=0;for(_=9154;_<=9159;_++)F[_]=0;for(_=9205;_<=9218;_++)F[_]=0;for(_=9271;_<=9273;_++)F[_]=0;for(_=9295;_<=9297;_++)F[_]=0;for(_=9356;_<=9360;_++)F[_]=0;for(_=9404;_<=9407;_++)F[_]=0;for(_=9476;_<=9482;_++)F[_]=0;for(_=9487;_<=9494;_++)F[_]=0;for(_=9697;_<=9699;_++)F[_]=0;for(_=9821;_<=9865;_++)F[_]=0;for(_=10285;_<=10291;_++)F[_]=0;for(_=10314;_<=10317;_++)F[_]=0;for(_=10448;_<=10465;_++)F[_]=0;for(_=10731;_<=10733;_++)F[_]=0;for(_=11114;_<=11118;_++)F[_]=0;for(_=20004;_<=20032;_++)F[_]=0;for(_=20047;_<=20049;_++)F[_]=0;for(_=20062;_<=20092;_++)F[_]=0;for(_=20135;_<=20138;_++)F[_]=0;for(_=20248;_<=20258;_++)F[_]=0;for(_=20348;_<=20358;_++)F[_]=0;for(_=20436;_<=20440;_++)F[_]=0;for(_=20822;_<=20824;_++)F[_]=0;for(_=20904;_<=20932;_++)F[_]=0;for(_=20934;_<=20936;_++)F[_]=0;for(_=21004;_<=21032;_++)F[_]=0;for(_=21035;_<=21037;_++)F[_]=0;for(_=21095;_<=21097;_++)F[_]=0;for(_=21148;_<=21150;_++)F[_]=0;for(_=21207;_<=21264;_++)F[_]=0;for(_=21307;_<=21364;_++)F[_]=0;for(_=21413;_<=21423;_++)F[_]=0;for(_=21453;_<=21463;_++)F[_]=0;for(_=21473;_<=21483;_++)F[_]=0;for(_=21780;_<=21782;_++)F[_]=0;for(_=21891;_<=21894;_++)F[_]=0;for(_=21896;_<=21899;_++)F[_]=0;for(_=22171;_<=22177;_++)F[_]=0;for(_=22181;_<=22187;_++)F[_]=0;for(_=22191;_<=22197;_++)F[_]=0;for(_=22207;_<=22222;_++)F[_]=0;for(_=22229;_<=22232;_++)F[_]=0;for(_=22234;_<=22236;_++)F[_]=0;for(_=22243;_<=22250;_++)F[_]=0;for(_=22262;_<=22265;_++)F[_]=0;for(_=22307;_<=22322;_++)F[_]=0;for(_=22348;_<=22357;_++)F[_]=0;for(_=22407;_<=22422;_++)F[_]=0;for(_=22462;_<=22465;_++)F[_]=0;for(_=22521;_<=22525;_++)F[_]=0;for(_=22607;_<=22622;_++)F[_]=0;for(_=22641;_<=22646;_++)F[_]=0;for(_=22648;_<=22657;_++)F[_]=0;for(_=22707;_<=22722;_++)F[_]=0;for(_=22762;_<=22765;_++)F[_]=0;for(_=22807;_<=22822;_++)F[_]=0;for(_=22991;_<=22994;_++)F[_]=0;for(_=23028;_<=23038;_++)F[_]=0;for(_=23301;_<=23333;_++)F[_]=2;for(_=23830;_<=23853;_++)F[_]=0;for(_=23866;_<=23872;_++)F[_]=0;for(_=23877;_<=23884;_++)F[_]=0;for(_=23886;_<=23894;_++)F[_]=0;for(_=23946;_<=23948;_++)F[_]=0;for(_=24311;_<=24313;_++)F[_]=0;for(_=24342;_<=24347;_++)F[_]=0;for(_=24370;_<=24374;_++)F[_]=10;for(_=24375;_<=24381;_++)F[_]=0;for(_=24718;_<=24721;_++)F[_]=0;for(_=24817;_<=24821;_++)F[_]=0;for(_=24877;_<=24882;_++)F[_]=0;for(_=24891;_<=24893;_++)F[_]=0;for(_=25391;_<=25395;_++)F[_]=0;for(_=25828;_<=25838;_++)F[_]=0;for(_=26191;_<=26195;_++)F[_]=0;for(_=26391;_<=26393;_++)F[_]=0;for(_=26701;_<=26722;_++)F[_]=0;for(_=26729;_<=26799;_++)F[_]=2;for(_=26801;_<=26803;_++)F[_]=2;for(_=26811;_<=26813;_++)F[_]=2;for(_=26847;_<=26870;_++)F[_]=2;for(_=26891;_<=26899;_++)F[_]=0;for(_=26901;_<=26923;_++)F[_]=0;for(_=26929;_<=26946;_++)F[_]=0;for(_=26948;_<=26998;_++)F[_]=0;for(_=27037;_<=27040;_++)F[_]=0;for(_=27205;_<=27232;_++)F[_]=0;for(_=27258;_<=27260;_++)F[_]=0;for(_=27391;_<=27398;_++)F[_]=0;for(_=27561;_<=27564;_++)F[_]=0;for(_=27571;_<=27574;_++)F[_]=0;for(_=27581;_<=27584;_++)F[_]=0;for(_=27591;_<=27594;_++)F[_]=0;for(_=27700;_<=27707;_++)F[_]=0;for(_=28191;_<=28193;_++)F[_]=0;for(_=28348;_<=28358;_++)F[_]=0;for(_=28402;_<=28432;_++)F[_]=0;for(_=28462;_<=28492;_++)F[_]=0;for(_=29118;_<=29122;_++)F[_]=0;for(_=29168;_<=29172;_++)F[_]=0;for(_=29177;_<=29185;_++)F[_]=0;for(_=29187;_<=29195;_++)F[_]=0;for(_=29900;_<=29903;_++)F[_]=0;for(_=30161;_<=30179;_++)F[_]=0;for(_=30491;_<=30494;_++)F[_]=0;for(_=30729;_<=30732;_++)F[_]=0;for(_=31251;_<=31259;_++)F[_]=0;for(_=31265;_<=31268;_++)F[_]=0;for(_=31275;_<=31279;_++)F[_]=0;for(_=31281;_<=31297;_++)F[_]=0;for(_=31461;_<=31469;_++)F[_]=0;for(_=31491;_<=31495;_++)F[_]=0;for(_=31917;_<=31922;_++)F[_]=0;for(_=31965;_<=32e3;_++)F[_]=0;for(_=32001;_<=32003;_++)F[_]=2;for(_=32005;_<=32031;_++)F[_]=2;for(_=32033;_<=32060;_++)F[_]=2;for(_=32064;_<=32067;_++)F[_]=2;for(_=32074;_<=32077;_++)F[_]=2;for(_=32081;_<=32086;_++)F[_]=0;for(_=32107;_<=32130;_++)F[_]=0;for(_=32133;_<=32159;_++)F[_]=0;for(_=32164;_<=32167;_++)F[_]=2;for(_=32180;_<=32199;_++)F[_]=0;for(_=32201;_<=32260;_++)F[_]=0;for(_=32301;_<=32360;_++)F[_]=0;for(_=32401;_<=32460;_++)F[_]=0;for(_=32501;_<=32560;_++)F[_]=0;for(_=32601;_<=32662;_++)F[_]=0;for(_=32664;_<=32667;_++)F[_]=2;for(_=32701;_<=32761;_++)F[_]=0;for(_=53001;_<=53004;_++)F[_]=0;for(_=53008;_<=53019;_++)F[_]=0;for(_=53021;_<=53032;_++)F[_]=0;for(_=53034;_<=53037;_++)F[_]=0;for(_=53042;_<=53046;_++)F[_]=0;for(_=53074;_<=53080;_++)F[_]=0;for(_=54001;_<=54004;_++)F[_]=0;for(_=54008;_<=54019;_++)F[_]=0;for(_=54021;_<=54032;_++)F[_]=0;for(_=54034;_<=54037;_++)F[_]=0;for(_=54042;_<=54046;_++)F[_]=0;for(_=54048;_<=54053;_++)F[_]=0;for(_=54074;_<=54080;_++)F[_]=0;for(_=54098;_<=54101;_++)F[_]=0;for(_=102001;_<=102040;_++)F[_]=0;for(_=102042;_<=102063;_++)F[_]=0;for(_=102065;_<=102067;_++)F[_]=0;for(_=102070;_<=102117;_++)F[_]=0;for(_=102122;_<=102216;_++)F[_]=0;for(_=102221;_<=102377;_++)F[_]=0;for(_=102382;_<=102388;_++)F[_]=0;for(_=102389;_<=102398;_++)F[_]=2;for(_=102399;_<=102444;_++)F[_]=0;for(_=102445;_<=102447;_++)F[_]=2;for(_=102448;_<=102458;_++)F[_]=0;for(_=102459;_<=102468;_++)F[_]=2;for(_=102469;_<=102499;_++)F[_]=0;for(_=102500;_<=102519;_++)F[_]=1;for(_=102520;_<=102524;_++)F[_]=0;for(_=102525;_<=102529;_++)F[_]=2;for(_=102530;_<=102588;_++)F[_]=0;for(_=102590;_<=102598;_++)F[_]=0;for(_=102601;_<=102603;_++)F[_]=0;for(_=102605;_<=102628;_++)F[_]=0;for(_=102629;_<=102646;_++)F[_]=2;for(_=102648;_<=102700;_++)F[_]=2;for(_=102701;_<=102703;_++)F[_]=0;for(_=102707;_<=102730;_++)F[_]=2;for(_=102733;_<=102758;_++)F[_]=2;for(_=102767;_<=102900;_++)F[_]=0;for(_=102901;_<=102933;_++)F[_]=2;for(_=102934;_<=102950;_++)F[_]=13;for(_=102951;_<=102963;_++)F[_]=0;for(_=102965;_<=102969;_++)F[_]=0;for(_=102971;_<=102973;_++)F[_]=0;for(_=102975;_<=102989;_++)F[_]=0;for(_=102990;_<=102992;_++)F[_]=1;for(_=102997;_<=103002;_++)F[_]=0;for(_=103003;_<=103008;_++)F[_]=2;for(_=103009;_<=103011;_++)F[_]=0;for(_=103012;_<=103014;_++)F[_]=2;for(_=103019;_<=103021;_++)F[_]=0;for(_=103022;_<=103024;_++)F[_]=2;for(_=103029;_<=103031;_++)F[_]=0;for(_=103032;_<=103034;_++)F[_]=2;for(_=103065;_<=103068;_++)F[_]=0;for(_=103074;_<=103076;_++)F[_]=0;for(_=103077;_<=103079;_++)F[_]=1;for(_=103080;_<=103082;_++)F[_]=0;for(_=103083;_<=103085;_++)F[_]=2;for(_=103090;_<=103093;_++)F[_]=0;for(_=103097;_<=103099;_++)F[_]=0;for(_=103100;_<=103102;_++)F[_]=2;for(_=103107;_<=103109;_++)F[_]=0;for(_=103110;_<=103112;_++)F[_]=2;for(_=103113;_<=103116;_++)F[_]=0;for(_=103117;_<=103120;_++)F[_]=2;for(_=103153;_<=103157;_++)F[_]=0;for(_=103158;_<=103162;_++)F[_]=2;for(_=103163;_<=103165;_++)F[_]=0;for(_=103166;_<=103168;_++)F[_]=1;for(_=103169;_<=103171;_++)F[_]=2;for(_=103186;_<=103188;_++)F[_]=0;for(_=103189;_<=103191;_++)F[_]=2;for(_=103192;_<=103195;_++)F[_]=0;for(_=103196;_<=103199;_++)F[_]=2;for(_=103200;_<=103224;_++)F[_]=0;for(_=103225;_<=103227;_++)F[_]=1;for(_=103232;_<=103237;_++)F[_]=0;for(_=103238;_<=103243;_++)F[_]=2;for(_=103244;_<=103246;_++)F[_]=0;for(_=103247;_<=103249;_++)F[_]=2;for(_=103254;_<=103256;_++)F[_]=0;for(_=103257;_<=103259;_++)F[_]=2;for(_=103264;_<=103266;_++)F[_]=0;for(_=103267;_<=103269;_++)F[_]=2;for(_=103300;_<=103375;_++)F[_]=0;for(_=103381;_<=103383;_++)F[_]=0;for(_=103384;_<=103386;_++)F[_]=1;for(_=103387;_<=103389;_++)F[_]=0;for(_=103390;_<=103392;_++)F[_]=2;for(_=103397;_<=103399;_++)F[_]=0;for(_=103400;_<=103471;_++)F[_]=2;for(_=103476;_<=103478;_++)F[_]=0;for(_=103479;_<=103481;_++)F[_]=2;for(_=103486;_<=103488;_++)F[_]=0;for(_=103489;_<=103491;_++)F[_]=2;for(_=103492;_<=103495;_++)F[_]=0;for(_=103496;_<=103499;_++)F[_]=2;for(_=103528;_<=103543;_++)F[_]=0;for(_=103544;_<=103548;_++)F[_]=2;for(_=103549;_<=103551;_++)F[_]=0;for(_=103552;_<=103554;_++)F[_]=1;for(_=103555;_<=103557;_++)F[_]=2;for(_=103558;_<=103560;_++)F[_]=0;for(_=103571;_<=103573;_++)F[_]=0;for(_=103574;_<=103576;_++)F[_]=2;for(_=103577;_<=103580;_++)F[_]=0;for(_=103581;_<=103583;_++)F[_]=2;for(_=103595;_<=103694;_++)F[_]=0;for(_=103696;_<=103699;_++)F[_]=0;for(_=103700;_<=103793;_++)F[_]=2;for(_=103794;_<=103890;_++)F[_]=0;for(_=103891;_<=103896;_++)F[_]=2;for(_=103900;_<=103971;_++)F[_]=2;for(_=103972;_<=103977;_++)F[_]=0;for(_=112e3;_<=112101;_++)F[_]=0;const F2e=[102100,102113,3857,3785],mWe=[104905,104971],gWe=[4326,...F2e,...mWe],Pue='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',FN=[-20037508342788905e-9,20037508342788905e-9],kN=[-20037508342787e-6,20037508342787e-6],k2e={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:FN,origin:kN,dx:1e-5},102100:{wkTemplate:Pue,valid:FN,origin:kN,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:FN,origin:kN,dx:1e-5},3857:{wkTemplate:Pue,valid:FN,origin:kN,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function hs(t,e){if(t===e)return!0;if(t==null||e==null)return!1;const i=t.wkid,r=e.wkid;if(i!=null||r!=null){if(i===r||Hf(t)&&Hf(e))return!0;const o=t.latestWkid;if(o!=null&&r===o)return!0;const a=e.latestWkid;return a!=null&&i===a}let s,n;return t.wkt2&&e.wkt2?(s=t.wkt2,n=e.wkt2):t.wkt&&e.wkt&&(s=t.wkt,n=e.wkt),!(!s||!n)&&s.toUpperCase()===n.toUpperCase()}function Fg(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&k2e[e]||null}function PA(t){if(!t)return;const{wkid:e,vcsWkid:i}=t;if(e)return i?JSON.stringify({wkid:e,vcsWkid:i}):String(e);const r=t.wkt||t.wkt2;return JSON.stringify(r?i?{wkt:r,vcsWkid:i}:{wkt:r}:{})}function pD(t){if(!Sf(t))return!1;const{wkid:e}=t;if(e)return F[e]==null;const i=t.wkt2||t.wkt;return!!i&&/^\s*(?:GEOGCS|GEOGCRS|GEOGRAPHICCRS)/i.test(i)}function RS(t){return!(f2(t)||m2(t))}function o_(t){return(t==null?void 0:t.wkid)===4326}function lqt(t){return/^\s*(?:GEOD|GEODETIC|GEOG|GEOGRAPHIC|PROJ|PROJECTED|VERT|VERTICAL|ENG|ENGINEERING|PARAMETRIC|TIME|DERIVEDPROJ|COMPOUND|BOUND)CRS/i.test(t)}function OA(t){return(t==null?void 0:t.wkid)===Su.CGCS2000}function Hf(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&F2e.includes(e)}function $S(t){return(t==null?void 0:t.wkid)===32662}function RA(t){return t===Su.GCSMARS2000||t===Su.GCSMARS2000_SPHERE}function f2(t){return RA(t==null?void 0:t.wkid)}function $A(t){return t===Su.GCSMOON2000}function m2(t){return $A(t==null?void 0:t.wkid)}function yWe(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&gWe.includes(e)}function Sf(t){if(t==null)return!1;const e=t.wkid;return e!=null&&e>=2e3||t.wkt2!=null||t.wkt!=null}const U2e={wkid:4326,wkt:Xg(k2e[4326].wkTemplate,{Central_Meridian:"0.0"})},V2e={wkid:102100,latestWkid:3857},_We={wkid:32662};function Xie(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const z2e=Xie(lr),Gj=Xie(Nf),Hj=Xie(n_),B2e={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${lr.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`},vWe=Gj.wkt.toUpperCase(),bWe=Hj.wkt.toUpperCase();function _r(t){if(t!=null&&Sf(t)){const e=t.wkid,i=t.wkt2??t.wkt;if(RA(e))return Nf;const r=i==null?void 0:i.toUpperCase();if(i&&r===vWe)return Nf;if($A(e)||r&&r===bWe)return n_}return lr}function cqt(t){return RA(t)?Nf:$A(t)?n_:lr}function Q3(t){return hs(t,z2e)}function gb(t){return Q3(t)||hs(t,Gj)||hs(t,Hj)}const Jie=39.37,wWe=lr.radius*Math.PI/200,j2e=/(?:LENGTH)?UNIT\[([^\]]+)]]$/i,tS=F,G2e=/UNIT\[([^\]]+)]/i,xWe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),TWe=Kl()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),lm=t=>t*t,W_=t=>t*t*t,K3={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:lm(.001)},"square-centimeters":{inBaseUnits:lm(.01)},"square-decimeters":{inBaseUnits:lm(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:lm(1e3)},"square-inches":{inBaseUnits:lm(.0254)},"square-feet":{inBaseUnits:lm(.3048)},"square-yards":{inBaseUnits:lm(.9144)},"square-miles":{inBaseUnits:lm(1609.344)},"square-us-feet":{inBaseUnits:lm(1200/3937)},acres:{inBaseUnits:.0015625*lm(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*W_(.001)},"cubic-centimeters":{inBaseUnits:1e3*W_(.01)},"cubic-decimeters":{inBaseUnits:1e3*W_(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*W_(1e3)},"cubic-inches":{inBaseUnits:1e3*W_(.0254)},"cubic-feet":{inBaseUnits:1e3*W_(.3048)},"cubic-yards":{inBaseUnits:1e3*W_(.9144)},"cubic-miles":{inBaseUnits:1e3*W_(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},SWe=(()=>{const t={};for(const e in K3)for(const i in K3[e].units)t[i]=e;return t})();function EWe(t,e,i){return t*K3[i].units[e].inBaseUnits}function CWe(t,e,i){return t/K3[i].units[e].inBaseUnits}const H2e=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"],MWe=new Map([["meters","square-meters"],["feet","square-feet"],["us-feet","square-us-feet"]]);function IS(t){const e=SWe[t];if(!e)throw new Error("unknown type");return e}function Oue(t,e=null){return e=e||IS(t),K3[e].baseUnit===t}function Vr(t,e,i){if(e===i)return t;const r=IS(e);if(r!==IS(i))throw new Error("incompatible units");const s=Oue(e,r)?t:EWe(t,e,r);return Oue(i,r)?s:CWe(s,i,r)}function AWe(t){switch(t){case"metric":return"meters";case"imperial":return"feet";default:return t}}function uqt(t){return AWe(t)}function hqt(t){switch(t){case"metric":return"square-meters";case"imperial":return"square-feet";default:return t}}function dqt(t,e,i){switch(i){case"metric":return Qie(t,e);case"imperial":return ere(t,e);default:return i}}function pqt(t,e,i){switch(i){case"metric":return Kie(t,e);case"imperial":return tre(t,e);default:return i}}function Qie(t,e){const i=Vr(t,e,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function Kie(t,e){const i=Vr(t,e,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function ere(t,e){const i=Vr(t,e,"feet");return Math.abs(i)<1e3?"feet":"miles"}function tre(t,e){const i=Vr(t,e,"feet");return Math.abs(i)<1e5?"feet":"miles"}function PWe(t,e){const i=Vr(t,e,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function OWe(t,e){const i=Vr(t,e,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function RWe(t,e,i){return Vr(t,e,"meters")/(i*Math.PI/180)}function q2e(t){return TWe.fromJSON(t.toLowerCase())||null}function a_(t){if(t!=null&&!RS(t))return 1;const e=ec(t);return e>1e5?1:e}function W2e(t){return ec(t)>=_r(t).metersPerDegree?"meters":fD(t)}function ec(t,e=lr.metersPerDegree){return $We(t,!0)??e}function $We(t,e=!1){const i=(t==null?void 0:t.wkid)??null,r=(t==null?void 0:t.wkt2)??(t==null?void 0:t.wkt)??null;let s=null;if(i){if(RA(i))return Nf.metersPerDegree;if($A(i))return n_.metersPerDegree;s=tS.values[tS[i]],!s&&e&&xWe.has(i)&&(s=wWe)}else r&&(Q2e(r)?s=$ue(j2e.exec(r),s):J2e(r)&&(s=$ue(G2e.exec(r),s)));return s}function Rue(t){return pD(t)?1:ec(t)}function $ue(t,e){return t!=null&&t[1]?Z2e(t[1]):e}function Z2e(t){return parseFloat(t.split(",")[1])}function fD(t){const e=(t==null?void 0:t.wkid)??null,i=(t==null?void 0:t.wkt2)??(t==null?void 0:t.wkt)??null;let r=null;if(e)r=tS.units[tS[e]];else if(i){const s=Q2e(i)?j2e:J2e(i)?G2e:null;if(s){const n=s.exec(i);n!=null&&n[1]&&(r=LWe(n[1]))}}return r!=null?q2e(r):null}function Y2e(t){const e=fD(t);return e!=null&&H2e.includes(e)?e:null}function X2e(t){const e=W2e(t);return e!=null&&H2e.includes(e)?e:null}function fqt(t){const e=fD(t);return e==null?null:MWe.get(e)}function J2e(t){return/^GEOCCS/i.test(t)}function Q2e(t){return/^\s*(?:PROJCS|PROJCRS|PROJECTEDCRS)/i.test(t)}const IWe=1e-7;function LWe(t){const e=/[\\"']{1}([^\\"']+)/.exec(t);let i=e==null?void 0:e[1];if(!i||!tS.units.includes(i)){const r=Z2e(t);i=null;const s=tS.values;for(let n=0;n<s.length;++n)if(Math.abs(r-s[n])<IWe){i=tS.units[n];break}}return i}function mqt(t){const e=fD(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const DWe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},NWe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},FWe={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},kWe=Kl()(DWe),UWe=Kl()(NWe),gqt=Kl()(FWe);var Rm;let Ir=Rm=class extends Se{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return Rm.WebMercator;if(t.wkid===4326)return Rm.WGS84}const e=new Rm;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.wkt2=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return o_(this)}get isWebMercator(){return Hf(this)}get isGeographic(){return pD(this)}get isWrappable(){return yWe(this)}get metersPerUnit(){return ec(this)}get unit(){return fD(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===Rm.WGS84)return new Rm(U2e);if(this===Rm.WebMercator)return new Rm(V2e);const t=new Rm;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):(this.wkt!=null&&(t.wkt=this.wkt),this.wkt2!=null&&(t.wkt2=this.wkt2)),this.imageCoordinateSystem&&(t.imageCoordinateSystem=ie(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:i}=t.imageCoordinateSystem,{geodataXform:r}=t.imageCoordinateSystem,s=this.imageCoordinateSystem;return e==null||r?JSON.stringify(s)===JSON.stringify(t.imageCoordinateSystem):i?s.id===e&&s.referenceServiceName===i:s.id===e}return hs(this,t)}toJSON(t){return this.write(void 0,t)}};Ir.GCS_NAD_1927=null,Ir.WGS84=null,Ir.WebMercator=null,Ir.PlateCarree=null,h([p({readOnly:!0})],Ir.prototype,"isWGS84",null),h([p({readOnly:!0})],Ir.prototype,"isWebMercator",null),h([p({readOnly:!0})],Ir.prototype,"isGeographic",null),h([p({readOnly:!0})],Ir.prototype,"isWrappable",null),h([p({type:Xi,json:{write:!0}})],Ir.prototype,"latestWkid",void 0),h([p({readOnly:!0})],Ir.prototype,"metersPerUnit",null),h([p({readOnly:!0})],Ir.prototype,"unit",null),h([p({type:Xi,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],Ir.prototype,"wkid",void 0),h([p({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],Ir.prototype,"wkt",void 0),h([We("wkt"),We("web-scene","wkt")],Ir.prototype,"writeWkt",null),h([p({type:String,json:{write:!1}})],Ir.prototype,"wkt2",void 0),h([p({type:Xi,json:{write:!0}})],Ir.prototype,"vcsWkid",void 0),h([p({type:Xi,json:{write:!0}})],Ir.prototype,"latestVcsWkid",void 0),h([p()],Ir.prototype,"imageCoordinateSystem",void 0),Ir=Rm=h([I("esri.geometry.SpatialReference")],Ir),Ir.prototype.toJSON.isDefaultToJSON=!0,Ir.GCS_NAD_1927=new Ir({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Ir.WGS84=new Ir(U2e),Ir.WebMercator=new Ir(V2e),Ir.PlateCarree=new Ir(_We),Object.freeze&&(Object.freeze(Ir.GCS_NAD_1927),Object.freeze(Ir.WGS84),Object.freeze(Ir.WebMercator),Object.freeze(Ir.PlateCarree));const Ze=Ir;function ze(t,e,i){let r,s;return e===void 0||Array.isArray(e)?(s=t,i=e,r=[void 0]):(s=e,r=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;r.forEach(l=>{const c=qSe(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],i&&(c.read.source=(c.read.source||[]).concat(i))})}}let $m=class extends Se{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Ze.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,i){if(e instanceof Ze)return e;if(e!=null){const r=new Ze;return r.read(e,i),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,i){this.cache[e]=i}};h([p()],$m.prototype,"type",void 0),h([p({readOnly:!0})],$m.prototype,"cache",null),h([p({readOnly:!0})],$m.prototype,"extent",null),h([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],$m.prototype,"hasM",void 0),h([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],$m.prototype,"hasZ",void 0),h([p({type:Ze,json:{write:!0},value:Ze.WGS84})],$m.prototype,"spatialReference",void 0),h([ze("spatialReference")],$m.prototype,"readSpatialReference",null),$m=h([I("esri.geometry.Geometry")],$m);const Gb=$m,VWe=Object.prototype.toString;function zWe(t){const e="__accessorMetadata__"in t?Qs(t):t;return function(...i){if(i.push(e),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return BWe.apply(this,i)}}function BWe(t,e,i,r){Uj(t,e).cast=r}function jWe(t){return(e,i)=>{Uj(e,t).cast=e[i]}}function Kt(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&VWe.call(t[0])==="[object Function]"?zWe(t[0]):t.length===1&&typeof t[0]=="string"?jWe(t[0]):void 0}const GWe=57.29577951308232,HWe=.017453292519943;function Iue(t){return t*GWe}function Lue(t){return t*HWe}function Due(t){return t/lr.radius}function az(t){return Math.PI/2-2*Math.atan(Math.exp(-t/lr.radius))}function cZ(t){return t.wkid!=null||t.wkt!=null}const UH=[0,0];function lz(t,e,i,r,s){const n=t,o=s;if(o.spatialReference=i,"x"in n&&"x"in o)[o.x,o.y]=e(n.x,n.y,UH,r);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=e(n.xmin,n.ymin,UH,r),[o.xmax,o.ymax]=e(n.xmax,n.ymax,UH,r);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let u=0;u<a.length;u++){const d=a[u];c=[],l.push(c);for(let f=0;f<d.length;f++)c.push(e(d[f][0],d[f][1],[0,0],r)),d[f].length>2&&c[f].push(d[f][2]),d[f].length>3&&c[f].push(d[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],r),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function ok(t,e){const i=t&&(cZ(t)?t:t.spatialReference),r=e&&(cZ(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!i||!r)&&(!!hs(r,i)||Hf(r)&&o_(i)||Hf(i)&&o_(r))}function mD(t,e){if(t==null)return null;const i=t.spatialReference,r=e&&(cZ(e)?e:e.spatialReference);return ok(i,r)?hs(i,r)?ie(t):Hf(r)?lz(t,iM,Ze.WebMercator,!1,ie(t)):o_(r)?lz(t,qj,Ze.WGS84,!1,ie(t)):null:null}function iM(t,e,i=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const r=Lue(e);return i[0]=Lue(t)*lr.radius,i[1]=lr.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function qj(t,e,i=[0,0],r=!1){const s=Iue(t/lr.radius);return i[0]=r?s:s-360*Math.floor((s+180)/360),i[1]=Iue(Math.PI/2-2*Math.atan(Math.exp(-e/lr.radius))),i}function kg(t,e=!1,i=ie(t)){return lz(t,iM,Ze.WebMercator,e,i)}function rM(t,e=!1,i=ie(t)){return lz(t,qj,Ze.WGS84,e,i)}function qWe(t,e){const i=t.x-e.x,r=t.y-e.y,s=t.z!=null&&e.z!=null?t.z-e.z:0;return Math.sqrt(i*i+r*r+s*s)}function WWe(t){var e;return((e=K2e(t,eEe))==null?void 0:e[0])??null}function ZWe(t){var e;return((e=K2e(t,eEe))==null?void 0:e[1])??null}function K2e({x:t,y:e,spatialReference:i},r=[0,0]){if(i){if(Hf(i))return qj(t,e,r);if(pD(i))return r[0]=t,r[1]=e,r}return null}const eEe=[0,0];var ak;const VH=[0,0];function Nue(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let gc=ak=class extends Gb{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const i=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(i)?i:i.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,i,r,s){let n;if(Array.isArray(t))n=t,s=e,t=n[0],e=n[1],i=n[2],r=n[3];else if(t&&typeof t=="object"){if(n=t,t=n.x!=null?n.x:n.longitude,e=n.y!=null?n.y:n.latitude,i=n.z,r=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new Ze(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)se.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)se.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&(s!=null&&s.isWebMercator)){const a=iM(n.longitude,n.latitude,VH);t=a[0],e=a[1]}}}else Nue(i)?(s=i,i=null):Nue(r)&&(s=r,r=null);const o={x:t,y:e};return o.x==null&&o.y!=null?se.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&se.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),i!=null&&(o.z=i),r!=null&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){return ZWe(this)}set latitude(t){const{spatialReference:e,x:i}=this;t!=null&&e&&(e.isWebMercator?this._set("y",iM(i,t,VH)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){return WWe(this)}set longitude(t){const{y:e,spatialReference:i}=this;t!=null&&i&&(i.isWebMercator?this._set("x",iM(t,e,VH)[0]):i.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,i){e[i]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new ak;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return ak.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:i,z:r,m:s,spatialReference:n}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:u}=t;if(!n.equals(u))if(n.isWebMercator&&u.isWGS84)[l,c]=iM(l,c),u=n;else{if(!n.isWGS84||!u.isWebMercator)return!1;[l,c]=qj(l,c),u=n}return e===l&&i===c&&r===o&&s===a&&n.wkid===u.wkid}offset(t,e,i){return this.x+=t,this.y+=e,i!=null&&(this.z=(this.z??0)+i),this}normalize(){if(!this.spatialReference)return this;const t=Fg(this.spatialReference);if(!t)return this;let e=this.x;const[i,r]=t.valid,s=2*r;let n;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s),this._set("x",e),this}distance(t){return qWe(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};h([p({readOnly:!0})],gc.prototype,"cache",null),h([p({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],gc.prototype,"hasM",null),h([p({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],gc.prototype,"hasZ",null),h([p({type:Number})],gc.prototype,"latitude",null),h([p({type:Number})],gc.prototype,"longitude",null),h([p({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),Kt(t=>isNaN(t)?t:Id(t))],gc.prototype,"x",void 0),h([We("x")],gc.prototype,"writeX",null),h([ze("x")],gc.prototype,"readX",null),h([p({type:Number,json:{write:!0}})],gc.prototype,"y",void 0),h([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],gc.prototype,"z",void 0),h([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],gc.prototype,"m",void 0),gc=ak=h([I("esri.geometry.Point")],gc),gc.prototype.toJSON.isDefaultToJSON=!0;const bt=gc,zH=[0,0];function ire(t,e){return e!=null&&Fl(t,e.x,e.y,e.z)}function _qt(t,e){if(!e.points||e.points.length)return!1;for(const i of e.points)if(!IA(t,i))return!1;return!0}function YWe(t,e){const{xmin:i,ymin:r,zmin:s,xmax:n,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?Fl(t,i,r,s)&&Fl(t,i,o,s)&&Fl(t,n,o,s)&&Fl(t,n,r,s)&&Fl(t,i,r,a)&&Fl(t,i,o,a)&&Fl(t,n,o,a)&&Fl(t,n,r,a):Fl(t,i,r)&&Fl(t,i,o)&&Fl(t,n,o)&&Fl(t,n,r)}function IA(t,e){return Fl(t,e[0],e[1])}function XWe(t,e){return Fl(t,e[0],e[1],e[2])}function Fl(t,e,i,r){return e>=t.xmin&&e<=t.xmax&&i>=t.ymin&&i<=t.ymax&&(r==null||!t.hasZ||r>=t.zmin&&r<=t.zmax)}function JWe(t,e){return zH[1]=e.y,zH[0]=e.x,QWe(t,zH)}function QWe(t,e){return tEe(t.rings,e)}function tEe(t,e){if(!t)return!1;if(KWe(t))return Fue(!1,t,e);let i=!1;for(let r=0,s=t.length;r<s;r++)i=Fue(i,t[r],e);return i}function KWe(t){return!Array.isArray(t[0][0])}function Fue(t,e,i){const[r,s]=i;let n=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,u]=e[a],[d,f]=e[o];(u<s&&f>=s||f<s&&u>=s)&&c+(s-u)/(f-u)*(d-c)<r&&(n=!n)}return n}function eZe(t,e){return ire(t,e)}function tZe(t,e){const i=t.hasZ&&e.hasZ;let r,s,n;if(t.xmin<=e.xmin){if(r=e.xmin,t.xmax<r)return!1}else if(r=t.xmin,e.xmax<r)return!1;if(t.ymin<=e.ymin){if(s=e.ymin,t.ymax<s)return!1}else if(s=t.ymin,e.ymax<s)return!1;if(i&&e.hasZ){if(t.zmin<=e.zmin){if(n=e.zmin,t.zmax<n)return!1}else if(n=t.zmin,e.zmax<n)return!1}return!0}function iZe(t,e){const{points:i,hasZ:r}=e,s=r?XWe:IA;for(const n of i)if(s(t,n))return!0;return!1}const LS=[0,0],DS=[0,0],NS=[0,0],FS=[0,0],rZe=[LS,DS,NS,FS],iEe=[[NS,LS],[LS,DS],[DS,FS],[FS,NS]];function sZe(t,e){return nZe(t,e.rings)}function nZe(t,e){LS[0]=t.xmin,LS[1]=t.ymax,DS[0]=t.xmax,DS[1]=t.ymax,NS[0]=t.xmin,NS[1]=t.ymin,FS[0]=t.xmax,FS[1]=t.ymin;for(const i of rZe)if(tEe(e,i))return!0;for(const i of e){if(!i.length)continue;let r=i[0];if(IA(t,r))return!0;for(let s=1;s<i.length;s++){const n=i[s];if(IA(t,n)||rEe(r,n,iEe))return!0;r=n}}return!1}function oZe(t,e){LS[0]=t.xmin,LS[1]=t.ymax,DS[0]=t.xmax,DS[1]=t.ymax,NS[0]=t.xmin,NS[1]=t.ymin,FS[0]=t.xmax,FS[1]=t.ymin;const i=e.paths;for(const r of i){if(!i.length)continue;let s=r[0];if(IA(t,s))return!0;for(let n=1;n<r.length;n++){const o=r[n];if(IA(t,o)||rEe(s,o,iEe))return!0;s=o}}return!1}const da=[0,0];function aZe(t){for(let e=0;e<t.length;e++){const i=t[e];for(let s=0;s<i.length-1;s++){const n=i[s],o=i[s+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],u=t[a][l+1];if(cz(n,o,c,u,da)&&!(da[0]===n[0]&&da[1]===n[1]||da[0]===c[0]&&da[1]===c[1]||da[0]===o[0]&&da[1]===o[1]||da[0]===u[0]&&da[1]===u[1]))return!0}}const r=i.length;if(!(r<=4))for(let s=0;s<r-3;s++){let n=r-1;s===0&&(n=r-2);const o=i[s],a=i[s+1];for(let l=s+2;l<n;l++){const c=i[l],u=i[l+1];if(cz(o,a,c,u,da)&&!(da[0]===o[0]&&da[1]===o[1]||da[0]===c[0]&&da[1]===c[1]||da[0]===a[0]&&da[1]===a[1]||da[0]===u[0]&&da[1]===u[1]))return!0}}}return!1}function rEe(t,e,i){for(let r=0;r<i.length;r++)if(cz(t,e,i[r][0],i[r][1]))return!0;return!1}function cz(t,e,i,r,s){const[n,o]=t,[a,l]=e,[c,u]=i,[d,f]=r,m=d-c,g=n-c,y=a-n,v=f-u,b=o-u,w=l-o,x=v*y-m*w;if(x===0)return!1;const S=(m*b-v*g)/x,C=(y*b-w*g)/x;return S>=0&&S<=1&&C>=0&&C<=1&&(s&&(s[0]=n+S*(a-n),s[1]=o+S*(l-o)),!0)}function lZe(t){switch(t){case"esriGeometryEnvelope":case"extent":return tZe;case"esriGeometryMultipoint":case"multipoint":return iZe;case"esriGeometryPoint":case"point":return eZe;case"esriGeometryPolygon":case"polygon":return sZe;case"esriGeometryPolyline":case"polyline":return oZe}}var od;function cZe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function Z_(t,e,i){return e==null?i:i==null?e:t(e,i)}let Go=od=class extends Gb{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,i,r,s){return cZe(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?Ze.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:i,ymax:r,spatialReference:s??Ze.WGS84}}static fromBounds(t,e){return new od({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new od({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new bt({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new od;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&ok(e,i)&&(t=e.isWebMercator?kg(t):rM(t,!0)),t.type==="point"?ire(this,t):t.type==="extent"&&YWe(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&ok(e,i)&&(t=e.isWebMercator?kg(t):rM(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),i=this.width*e,r=this.height*e;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const s=(this.zmax-this.zmin)*e;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*e;this.mmin+=s,this.mmax-=s}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,i=t.spatialReference;return e&&i&&!hs(e,i)&&ok(e,i)&&(t=e.isWebMercator?kg(t):rM(t,!0)),lZe(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,i){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=Z_(Math.min,this.zmin,t.zmin),this.zmax=Z_(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=Z_(Math.min,this.mmin,t.mmin),this.mmax=Z_(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=Z_(Math.max,this.zmin,t.zmin),this.zmax=Z_(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=Z_(Math.max,this.mmin,t.mmin),this.mmax=Z_(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=Fg(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,i=this._getCM(t);if(i){const r=e.isWebMercator?rM(i):i;this.xmin-=i.x,this.xmax-=i.x,e.isWebMercator||(r.x=BH(r.x,t).x),this.spatialReference=new Ze(Xg((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(t){let e=null;const[i,r]=t.valid,s=this.xmin,n=this.xmax;return s>=i&&s<=r&&n>=i&&n<=r||(e=this.center),e}_normalize(t,e,i){const r=this.spatialReference;if(!r)return this;const s=i??Fg(r);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return t?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(t)return this._shiftCM(s);if(e)return n;let o=!0,a=!0;return n.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const u=(l.zmax-l.zmin)/2;for(let d=0;d<c.length;d++)c[d].push(u)}if(a){const u=(l.mmax-l.mmin)/2;for(let d=0;d<c.length;d++)c[d].push(u)}return c}),hasZ:o,hasM:a,spatialReference:r}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let u;t=t||Fg(o);const[d,f]=t.valid;u=BH(this.xmin,t);const m=u.x,g=u.frameId;u=BH(this.xmax,t);const y=u.x,v=u.frameId,b=m===y&&a>0;if(a>2*f){const w=new od(l<c?m:y,s,f,n,o),x=new od(d,s,l<c?y:m,n,o),S=new od(0,s,f,n,o),C=new od(d,s,0,n,o),M=[],O=[];w.contains(S)&&M.push(g),w.contains(C)&&O.push(g),x.contains(S)&&M.push(v),x.contains(C)&&O.push(v);for(let D=g+1;D<v;D++)M.push(D),O.push(D);e.push({extent:w,frameIds:[g]},{extent:x,frameIds:[v]},{extent:S,frameIds:M},{extent:C,frameIds:O})}else m>y||b?e.push({extent:new od(m,s,f,n,o),frameIds:[g]},{extent:new od(d,s,y,n,o),frameIds:[v]}):e.push({extent:new od(m,s,y,n,o),frameIds:[g]});this.cache._parts=e}const i=this.hasZ,r=this.hasM;if(i||r){const s={};i&&(s.zmin=this.zmin,s.zmax=this.zmax),r&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<e.length;n++)e[n].extent.set(s)}return e}};function BH(t,e){const[i,r]=e.valid,s=2*r;let n,o=0;return t>r?(n=Math.ceil(Math.abs(t-r)/s),t-=n*s,o=n):t<i&&(n=Math.ceil(Math.abs(t-i)/s),t+=n*s,o=-n),{x:t,frameId:o}}h([p({readOnly:!0})],Go.prototype,"cache",null),h([p({readOnly:!0})],Go.prototype,"center",null),h([p({readOnly:!0})],Go.prototype,"extent",null),h([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Go.prototype,"hasM",null),h([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Go.prototype,"hasZ",null),h([p({readOnly:!0})],Go.prototype,"height",null),h([p({readOnly:!0})],Go.prototype,"width",null),h([p({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Go.prototype,"xmin",void 0),h([p({type:Number,json:{write:!0}})],Go.prototype,"ymin",void 0),h([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Go.prototype,"mmin",void 0),h([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Go.prototype,"zmin",void 0),h([p({type:Number,json:{write:!0}})],Go.prototype,"xmax",void 0),h([p({type:Number,json:{write:!0}})],Go.prototype,"ymax",void 0),h([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Go.prototype,"mmax",void 0),h([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Go.prototype,"zmax",void 0),Go=od=h([I("esri.geometry.Extent")],Go),Go.prototype.toJSON.isDefaultToJSON=!0;const ur=Go;let UN;function uZe(t){return UN&&!UN.destroyed||(UN=t()),UN}var uZ;const hZe=new Ji({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let ad=uZ=class extends Ue{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new uZ({categories:this.categories?ie(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let i=[];this.categories&&(i=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let r="";if(this.extent){const o=mD(this.extent,Ze.WGS84);o!=null&&(r=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&t.extraQuery&&(s="("+s+")"+t.extraQuery);const n={categories:i,bbox:r,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>hZe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...e,...n}}}};h([p()],ad.prototype,"categories",void 0),h([p()],ad.prototype,"disableExtraQuery",void 0),h([p({type:ur})],ad.prototype,"extent",void 0),h([p()],ad.prototype,"filter",void 0),h([p()],ad.prototype,"num",void 0),h([p()],ad.prototype,"query",void 0),h([p()],ad.prototype,"sortField",void 0),h([p()],ad.prototype,"sortOrder",null),h([p()],ad.prototype,"start",void 0),ad=uZ=h([I("esri.portal.PortalQueryParams")],ad);const gg=ad;var hZ;let vo=hZ=class extends Se{constructor(t){super(t),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){var i;const t=this.url,e=this.thumbnail;return t&&e&&this.portal?(i=this.portal)==null?void 0:i.normalizeUrl(`${t}/info/${e}?f=json`):null}get url(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?t+"/community/groups/"+this.id:null}fetchCategorySchema(t){return this.portal.request(this.url+"/categorySchema",t).then(e=>{const i=e.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",t):i})}fetchMembers(t){return this.portal.request(this.url+"/users",t)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}toJSON(){throw new G("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new hZ({sourceJSON:t});return e.read(t),e}queryItems(t,e){let i=Qs(gg,t);const r=this.portal;return parseFloat(r.currentVersion)>5?(i=i||new gg,r.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",e)):(i=i?i.clone():new gg,i.query="group:"+this.id+(i.query?" "+i.query:""),r.queryItems(i,e))}_fetchCategorySchemaSet(t,e){const i=this.portal;return i.fetchSelf(i.authMode,!0,e).then(r=>{const s=r.contentCategorySetsGroupQuery;if(s){const n=new gg({disableExtraQuery:!0,num:1,query:s});return i.queryGroups(n,e)}throw new G("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(r=>{if(r.total){const s=r.results[0],n=new gg({num:1,query:`typekeywords:"${t}"`});return s.queryItems(n,e)}throw new G("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(r=>r.total?r.results[0].fetchData("json",e).then(s=>{const n=s==null?void 0:s.categorySchema;return n!=null&&n.length?n:[]}):[])}};h([p()],vo.prototype,"access",void 0),h([p({type:Date})],vo.prototype,"created",void 0),h([p()],vo.prototype,"description",void 0),h([p()],vo.prototype,"id",void 0),h([p()],vo.prototype,"isInvitationOnly",void 0),h([p({type:Date})],vo.prototype,"modified",void 0),h([p()],vo.prototype,"owner",void 0),h([p()],vo.prototype,"portal",void 0),h([p()],vo.prototype,"snippet",void 0),h([p()],vo.prototype,"sortField",void 0),h([p()],vo.prototype,"sortOrder",void 0),h([p()],vo.prototype,"sourceJSON",void 0),h([p()],vo.prototype,"tags",void 0),h([p()],vo.prototype,"thumbnail",void 0),h([p({readOnly:!0})],vo.prototype,"thumbnailUrl",null),h([p()],vo.prototype,"title",void 0),h([p({readOnly:!0})],vo.prototype,"url",null),vo=hZ=h([I("esri.portal.PortalGroup")],vo);const dZ=vo;let lx=class extends Ue{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};h([p()],lx.prototype,"nextQueryParams",void 0),h([p()],lx.prototype,"queryParams",void 0),h([p()],lx.prototype,"results",void 0),h([p()],lx.prototype,"total",void 0),lx=h([I("esri.portal.PortalQueryResult")],lx);const dZe=lx;let Zy=class extends Se{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){var i;const e=(i=this.portal)==null?void 0:i.restUrl;return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new G("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};h([p({type:Date})],Zy.prototype,"created",void 0),h([p()],Zy.prototype,"id",void 0),h([p()],Zy.prototype,"portal",void 0),h([p()],Zy.prototype,"title",void 0),h([p({readOnly:!0})],Zy.prototype,"url",null),h([p()],Zy.prototype,"username",void 0),Zy=h([I("esri.portal.PortalFolder")],Zy);const pZe=Zy;var pZ;let Os=pZ=class extends Se{constructor(t){super(t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userLicenseTypeId=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?`${t}/content/users/${this.username}`:null}get url(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,i=t==null?void 0:t.data,r=t==null?void 0:t.folder,s={method:"post"};e&&(s.query=e.createPostQuery(),i!=null&&(typeof i=="string"?s.query.text=i:typeof i=="object"&&(s.query.text=JSON.stringify(i))));let n=this.userContentUrl;return r&&(n+="/"+(typeof r=="string"?r:r.id)),this.portal.request(n+"/addItem",s).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}async deleteItem(t,e=!1){let i=this.userContentUrl;t.ownerFolder&&(i+="/"+t.ownerFolder);const r=e?{permanentDelete:!0}:{};await this.portal.request(i+`/items/${t.id}/delete`,{method:"post",query:r}),t.id=null,t.portal=null}async deleteItems(t,e=!1){t=t.concat();const i=this.userContentUrl+"/deleteItems",r=[],s=t.map(n=>n.id);if(s.length){const n={method:"post",query:{items:s.join(","),permanentDelete:e}},o=await this.portal.request(i,n);for(const a of o.results){const l=t.find(d=>a.itemId===d.id),c=a.success;let u=null;c?(l.id=null,l.portal=null):a.error&&(u=new G("portal:delete-item-failed",a.error.message,a.error)),r.push({item:l,success:c,error:u})}}return r}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let i;return i=e&&e.folders?e.folders.map(r=>{const s=pZe.fromJSON(r);return s.portal=this.portal,s}):[],i})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(i=>{const r=dZ.fromJSON(i);return r.portal=this.portal,r}):[],e})}async fetchItems(t){t??(t={});let e=this.userContentUrl??"";t.folder&&(e+="/"+t.folder.id);const{default:i}=await ce(()=>Promise.resolve().then(()=>oEe),void 0),r={folders:!1,inRecycleBin:!!t.inRecycleBin||null,foldersContent:!(t.folder||!t.includeSubfolderItems)||null,num:t.num||10,start:t.start||1,sortField:t.sortField||"created",sortOrder:t.sortOrder||"asc"},s=await this.portal.request(e,{query:r});let n;return s!=null&&s.items?(n=s.items.map(o=>{const a=i.fromJSON(o);return a.portal=this.portal,a}),await Promise.all(n.map(o=>o.load())),{items:n,nextStart:s.nextStart,total:s.total}):{items:[],nextStart:-1,total:0}}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new dZ({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new G("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}async restoreItem(t,e){const i=this.userContentUrl,r=e?{folderID:typeof e=="string"?e:e.id}:null;await this.portal.request(i+`/items/${t.id}/restore`,{method:"post",query:r})}toJSON(){throw new G("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new pZ({sourceJSON:t});return e.read(t),e}};h([p()],Os.prototype,"access",void 0),h([p({type:Date})],Os.prototype,"created",void 0),h([p()],Os.prototype,"culture",void 0),h([p()],Os.prototype,"description",void 0),h([p()],Os.prototype,"email",void 0),h([p()],Os.prototype,"favGroupId",void 0),h([p()],Os.prototype,"fullName",void 0),h([p({type:Date})],Os.prototype,"modified",void 0),h([p()],Os.prototype,"orgId",void 0),h([p()],Os.prototype,"portal",void 0),h([p()],Os.prototype,"preferredView",void 0),h([p()],Os.prototype,"privileges",void 0),h([p()],Os.prototype,"region",void 0),h([p()],Os.prototype,"role",void 0),h([p()],Os.prototype,"roleId",void 0),h([p()],Os.prototype,"sourceJSON",void 0),h([p()],Os.prototype,"thumbnail",void 0),h([p({readOnly:!0})],Os.prototype,"thumbnailUrl",null),h([p()],Os.prototype,"units",void 0),h([p({readOnly:!0})],Os.prototype,"userContentUrl",null),h([p({readOnly:!0})],Os.prototype,"url",null),h([p()],Os.prototype,"username",void 0),h([p()],Os.prototype,"userLicenseTypeId",void 0),h([p()],Os.prototype,"userType",void 0),Os=pZ=h([I("esri.portal.PortalUser")],Os);const rre=Os;var Xu;let VN;const kue={PortalGroup:()=>Promise.resolve({default:dZ}),PortalItem:()=>ce(()=>Promise.resolve().then(()=>oEe),void 0),PortalUser:()=>Promise.resolve({default:rre})};let Ke=Xu=class extends hD(ey){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.layoutGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.recycleBinEnabled=!1,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=rr.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){Uue.unregister(this),this.defaultBasemap=qe(this.defaultBasemap),this.defaultDevBasemap=qe(this.defaultDevBasemap),this.defaultVectorBasemap=qe(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=$r(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)rr.request.trustedServers.includes(e)||rr.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){var i;const t=(i=this.user)==null?void 0:i.orgId,e=!t||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=rre.fromJSON(t),e.portal=this),e}load(t){const e=ce(()=>Promise.resolve().then(()=>UZe),void 0).then(({default:i})=>{Dt(t),VN=i}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(i=>{var r;if(Bi){const s=Bi;this.credential=s.findCredential(this.restUrl),this.credential||this.authMode!==Xu.AUTH_MODE_AUTO&&this.authMode!==Xu.AUTH_MODE_NO_PROMPT||((r=this._esriIdCredentialCreateHandle)==null||r.remove(),this._esriIdCredentialCreateHandle=s.on("credential-create",fZe(new WeakRef(this))),Uue.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await ce(async()=>{const{default:i}=await import("./ElevationLayer-CJxiYMuw.js");return{default:i}},__vite__mapDeps([0,1,2,3,4,5]))).default;return t?t.map(i=>new e({id:i.id,url:i.url})):[]}async fetchBasemaps(t,e){const i=await this._fetchBasemaps(t,e);if((e==null?void 0:e.include3d)===!0&&this.use3dBasemaps!==!1){const r=await this._fetchBasemaps3D(t,e);i.unshift(...r)}return i}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):ra(t)?Promise.reject(ki()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,i=new gg({num:100,sortField:"title"});if(e!=null&&e.length){const r=[];for(const s of e)r.push(`(title:"${s.title}" AND owner:${s.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,t).then(s=>s.results)}return ra(t)?Promise.reject(ki()):Promise.resolve([])}fetchRegions(t){var i;const e=((i=this.user)==null?void 0:i.culture)||this.culture||Ou();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){var i;const e=((i=this.user)==null?void 0:i.culture)||this.culture||Ou();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return uZe(()=>new Xu)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,i){const r=this.restUrl+"/portals/self",s={authMode:t,query:{culture:Ou().toLowerCase()},withCredentials:!0,...i};return s.authMode==="auto"&&(s.authMode="no-prompt"),e&&(s.query.default=!0),this.request(r,s)}queryPortal(t,e,i,r){const s=Qs(gg,e),n=o=>this.request(this.restUrl+t,{...s.toRequestOptions(this),...r}).then(a=>{const l=s.clone();return l.start=a.nextStart,new dZe({nextQueryParams:l,queryParams:s,total:a.total,results:Xu._resultsToTypedArray(o,{portal:this},a,r)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(jl(l),a)));return i&&kue[i]?kue[i]().then(({default:o})=>(Dt(r),n(o))):n()}signIn(){if(this.authMode===Xu.AUTH_MODE_ANONYMOUS||this.authMode===Xu.AUTH_MODE_NO_PROMPT&&!Bi)return Promise.reject(new G("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return Bi?Bi.getCredential(this.restUrl,{prompt:this.authMode!==Xu.AUTH_MODE_NO_PROMPT}).then(e=>t(e)):t(this.credential)}normalizeUrl(t){var i;const e=(i=this.credential)==null?void 0:i.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,i){return this.request(t,e).then(r=>{const s=Xu._resultsToTypedArray(i,{portal:this},r);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():r)).then(()=>s,()=>s)})}request(t,e={}){const i={f:"json",...e.query},{authMode:r=this.authMode===Xu.AUTH_MODE_ANONYMOUS||this.authMode===Xu.AUTH_MODE_NO_PROMPT?this.authMode:"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:r,body:s,cacheBust:n,method:o,query:i,responseType:a,timeout:0,signal:l};return e.withCredentials&&(c.withCredentials=!0),yr(this._normalizeSSL(t),c).then(u=>u.data)}toJSON(){throw new G("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Xu({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new G("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const i=new gg;i.query=t||(rr.apiKey&&jie(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0;const r=await this.queryGroups(i,e);if(!r.total)return[];const s=r.results[0];i.num=100,i.query='type:"Web Map" -type:"Web Application"',i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc";const n=await s.queryItems(i,e);return n.total?n.results.filter(o=>o.type==="Web Map").map(o=>new VN({portalItem:o})):[]}async _fetchBasemaps3D(t,e){const i=t||this.basemapGalleryGroupQuery3D;if(!i)return[];const r=new gg({query:i,disableExtraQuery:!0}),s=await this.queryGroups(r,e);if(!s.total)return[];const n=s.results[0];r.num=100,r.query='type:"Web Scene"',r.sortField=n.sortField||"name",r.sortOrder=n.sortOrder||"desc";const o=await n.queryItems(r,e);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new VN({portalItem:a})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=VN.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,i,r){let s;if(i){const n=r!=null?r.signal:null;s=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(t||e)&&(s=s.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};Ke.AUTH_MODE_ANONYMOUS="anonymous",Ke.AUTH_MODE_AUTO="auto",Ke.AUTH_MODE_IMMEDIATE="immediate",Ke.AUTH_MODE_NO_PROMPT="no-prompt",h([p()],Ke.prototype,"access",void 0),h([p()],Ke.prototype,"allSSL",void 0),h([p()],Ke.prototype,"authMode",void 0),h([p()],Ke.prototype,"authorizedCrossOriginDomains",void 0),h([ze("authorizedCrossOriginDomains")],Ke.prototype,"readAuthorizedCrossOriginDomains",null),h([p()],Ke.prototype,"basemapGalleryGroupQuery",void 0),h([p({json:{name:"3DBasemapGalleryGroupQuery"}})],Ke.prototype,"basemapGalleryGroupQuery3D",void 0),h([p()],Ke.prototype,"bingKey",void 0),h([p()],Ke.prototype,"canListApps",void 0),h([p()],Ke.prototype,"canListData",void 0),h([p()],Ke.prototype,"canListPreProvisionedItems",void 0),h([p()],Ke.prototype,"canProvisionDirectPurchase",void 0),h([p()],Ke.prototype,"canSearchPublic",void 0),h([p()],Ke.prototype,"canShareBingPublic",void 0),h([p()],Ke.prototype,"canSharePublic",void 0),h([p()],Ke.prototype,"canSignInArcGIS",void 0),h([p()],Ke.prototype,"canSignInIDP",void 0),h([p()],Ke.prototype,"colorSetsGroupQuery",void 0),h([p()],Ke.prototype,"commentsEnabled",void 0),h([p({type:Date})],Ke.prototype,"created",void 0),h([p()],Ke.prototype,"credential",void 0),h([p()],Ke.prototype,"culture",void 0),h([p()],Ke.prototype,"currentVersion",void 0),h([p()],Ke.prototype,"customBaseUrl",void 0),h([p()],Ke.prototype,"defaultBasemap",void 0),h([ze("defaultBasemap")],Ke.prototype,"readDefaultBasemap",null),h([p()],Ke.prototype,"defaultDevBasemap",void 0),h([ze("defaultDevBasemap")],Ke.prototype,"readDefaultDevBasemap",null),h([p({type:ur})],Ke.prototype,"defaultExtent",void 0),h([p()],Ke.prototype,"defaultVectorBasemap",void 0),h([ze("defaultVectorBasemap")],Ke.prototype,"readDefaultVectorBasemap",null),h([p()],Ke.prototype,"description",void 0),h([p()],Ke.prototype,"devBasemapGalleryGroupQuery",void 0),h([p()],Ke.prototype,"eueiEnabled",void 0),h([p({readOnly:!0})],Ke.prototype,"extraQuery",null),h([p()],Ke.prototype,"featuredGroups",void 0),h([p()],Ke.prototype,"featuredItemsGroupQuery",void 0),h([p()],Ke.prototype,"galleryTemplatesGroupQuery",void 0),h([p()],Ke.prototype,"layoutGroupQuery",void 0),h([p()],Ke.prototype,"livingAtlasGroupQuery",void 0),h([p()],Ke.prototype,"hasCategorySchema",void 0),h([p()],Ke.prototype,"helpBase",void 0),h([p()],Ke.prototype,"helperServices",void 0),h([p()],Ke.prototype,"helpMap",void 0),h([p()],Ke.prototype,"homePageFeaturedContent",void 0),h([p()],Ke.prototype,"homePageFeaturedContentCount",void 0),h([p()],Ke.prototype,"httpPort",void 0),h([p()],Ke.prototype,"httpsPort",void 0),h([p()],Ke.prototype,"id",void 0),h([p()],Ke.prototype,"ipCntryCode",void 0),h([p({readOnly:!0})],Ke.prototype,"isOrganization",null),h([p()],Ke.prototype,"isPortal",void 0),h([p()],Ke.prototype,"isReadOnly",void 0),h([p({readOnly:!0})],Ke.prototype,"itemPageUrl",null),h([p()],Ke.prototype,"layerTemplatesGroupQuery",void 0),h([p()],Ke.prototype,"maxTokenExpirationMinutes",void 0),h([p({type:Date})],Ke.prototype,"modified",void 0),h([p()],Ke.prototype,"name",void 0),h([p()],Ke.prototype,"portalHostname",void 0),h([p()],Ke.prototype,"portalMode",void 0),h([p()],Ke.prototype,"portalProperties",void 0),h([p()],Ke.prototype,"region",void 0),h([p()],Ke.prototype,"recycleBinEnabled",void 0),h([p({readOnly:!0})],Ke.prototype,"restUrl",null),h([p()],Ke.prototype,"rotatorPanels",void 0),h([p()],Ke.prototype,"showHomePageDescription",void 0),h([p()],Ke.prototype,"sourceJSON",void 0),h([p()],Ke.prototype,"staticImagesUrl",void 0),h([p({json:{name:"2DStylesGroupQuery"}})],Ke.prototype,"stylesGroupQuery2d",void 0),h([p({json:{name:"stylesGroupQuery"}})],Ke.prototype,"stylesGroupQuery3d",void 0),h([p()],Ke.prototype,"supportsHostedServices",void 0),h([p()],Ke.prototype,"symbolSetsGroupQuery",void 0),h([p()],Ke.prototype,"templatesGroupQuery",void 0),h([p()],Ke.prototype,"thumbnail",void 0),h([p({readOnly:!0})],Ke.prototype,"thumbnailUrl",null),h([p()],Ke.prototype,"units",void 0),h([p()],Ke.prototype,"url",void 0),h([p()],Ke.prototype,"urlKey",void 0),h([ze("urlKey")],Ke.prototype,"readUrlKey",null),h([p()],Ke.prototype,"user",void 0),h([ze("user")],Ke.prototype,"readUser",null),h([p()],Ke.prototype,"use3dBasemaps",void 0),h([p()],Ke.prototype,"useStandardizedQuery",void 0),h([p()],Ke.prototype,"useVectorBasemaps",void 0),h([p()],Ke.prototype,"vectorBasemapGalleryGroupQuery",void 0),Ke=Xu=h([I("esri.portal.Portal")],Ke);const Wn=Ke,Uue=new FinalizationRegistry(t=>{t.remove()});function fZe(t){const e=Bi;return()=>{const i=t.deref();i&&e.findCredential(i.restUrl)&&i.signIn().catch(()=>{})}}let Yy=class extends Ue{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e!=null&&e.portalItem&&e.path?{...e,path:Vue(e.path,e.portalItem)}:e}set path(e){e!=null&&Oh(e)?se.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return Vue(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",i){const r=this.cdnUrl;if(r==null)throw new G("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey},signal:i==null?void 0:i.signal})}async update(e,i){const{addOrUpdateResources:r}=await ce(()=>Promise.resolve().then(()=>sM),void 0);return await r(this.portalItem,[{resource:this,content:e,compress:i==null?void 0:i.compress,access:i==null?void 0:i.access}],"update",i),this}hasPath(){return this.path!=null}};function Vue(t,e){return t==null?t:(t=t.replace(/^\/+/,""),e!=null&&Oh(t)&&(t=Fie(t,e.itemUrl)),t==null?void 0:t.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}h([p()],Yy.prototype,"portalItem",void 0),h([p({type:String,value:null})],Yy.prototype,"path",null),h([Kt("path")],Yy.prototype,"_castPath",null),h([p({type:String,readOnly:!0})],Yy.prototype,"url",null),h([p({type:String,readOnly:!0})],Yy.prototype,"cdnUrl",null),h([p({type:String,readOnly:!0})],Yy.prototype,"itemRelativeUrl",null),Yy=h([I("esri.portal.PortalItemResource")],Yy);const mZe=Yy;let kR=class extends Ue{constructor(e){super(e),this.created=null,this.rating=null}};h([p()],kR.prototype,"created",void 0),h([p()],kR.prototype,"rating",void 0),kR=h([I("esri.portal.PortalRating")],kR);const jH=kR;function yb(t,e){var r;const i=(r=e==null?void 0:e.url)==null?void 0:r.path;if(t&&i&&(t=Tu(t,i,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const s=Fie(t,e.portalItem.itemUrl);s!=null&&gZe.test(s)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(s).path)}return(t=fZ(t,e==null?void 0:e.portal))&&Wj.test(t)?nre(t):t}function kS(t,e,i=eL.YES){var s,n;if((t=t&&Wj.test(t)?nEe(t):t)==null)return t;!Oh(t)&&(e!=null&&e.blockedRelativeUrls)&&e.blockedRelativeUrls.push(t);let r=Tu(t);if(e){const o=((s=e.verifyItemRelativeUrls)==null?void 0:s.rootPath)||((n=e.url)==null?void 0:n.path);if(o){const a=fZ(o,e.portal),l=fZ(r,e.portal);r=Fie(l,a,a),r!=null&&r!==l&&r!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=sEe(r,e==null?void 0:e.portal),Oh(r)&&(r=Zd(r)),e!=null&&e.resources&&(e!=null&&e.portalItem)&&!Oh(r)&&!cy(r)&&i===eL.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(r),compress:!1}),r}function sre(t,e,i){return yb(t,i)}function _b(t,e,i,r){const s=kS(t,r);s!==void 0&&(e[i]=s)}const Wj=/\/items\/([^/]+)\/resources\/(.*)/,gZe=/^\.\/resources\//;function yZe(t){const e=(t==null?void 0:t.match(Wj))??null;return(e==null?void 0:e[1])??null}function _Ze(t){const e=(t==null?void 0:t.match(Wj))??null;if(e==null)return null;const i=e[2],r=i.lastIndexOf("/");if(r===-1){const{path:o,extension:a}=vue(i);return{prefix:null,filename:o,extension:a}}const{path:s,extension:n}=vue(i.slice(r+1));return{prefix:i.slice(0,r),filename:s,extension:n}}function sEe(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?KW(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function fZ(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const i=`${e.urlKey}.${e.customBaseUrl}`,r=Iie();return CA(r,`${r.scheme}://${i}`)?KW(t,e.portalHostname,i):KW(t,i,e.portalHostname)}function nre(t){if(!t)return t||null;let e=t;return e&&Bi&&!Bi.findCredential(e)&&(e=h2e(e),e=e.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),e=e.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),e=e.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),e}function nEe(t){if(!t)return t||null;let e=t;return e=e.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com"),e=e.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com"),e=e.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"),e&&Bi&&!Bi.findCredential(e)&&(e=h2e(e)),e}var eL;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(eL||(eL={}));const Tqt=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return eL},ensureMainOnlineDomain:sEe,fromCDNUrl:nEe,fromJSON:yb,itemIdFromResourceUrl:yZe,prefixAndFilenameFromResourceUrl:_Ze,read:sre,toCDNUrl:nre,toJSON:kS,write:_b},Symbol.toStringTag,{value:"Module"}));var cx;const vZe=new Set(["3DTiles Service","CSV","Feature Collection","Feature Service","Feed","GeoJson","Group Layer","Image Service","KML","Map Service","Media Layer","Scene Service","Stream Service","Vector Tile Service","WFS","WMS","WMTS"]),bZe=new Set(["KML","GeoJson","CSV"]);let Ti=cx=class extends hD(ey){static from(t){return OS(cx,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let i=t;return t==="Feature Service"||t==="Feature Collection"?i=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?i=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?i="Scene Layer":t==="Video Service"?i="Video Layer":t==="Scene Package"?i="Scene Layer Package":t==="Stream Service"?i="Feature Layer":t==="Geoprocessing Service"?i=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geoenrichment Service"?i="GeoEnrichment Service":t==="Geocoding Service"?i="Locator":t==="Microsoft Powerpoint"?i="Microsoft PowerPoint":t==="GeoJson"?i="GeoJSON":t==="Globe Service"?i="Globe Layer":t==="Vector Tile Service"?i="Tile Layer":t==="netCDF"?i="NetCDF":t==="Map Service"?i=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t!=null&&t.toLowerCase().includes("add in")?i=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?i="Big Data File Share":t==="Compact Tile Package"?i="Tile Package (tpkx)":t==="Raster function template"?i="Raster Function Template":t==="OGCFeatureServer"?i="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?i="Instant App":t==="Insights Page"?i="Insights Report":t==="Excalibur Imagery Project"?i="Excalibur Project":t==="3DTiles Service"?i="3D tiles layer":t==="3DTiles Package"&&(i="3D tiles package"),i}readExtent(t){return t&&t.length?new ur(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){var m;const t=((m=this.type)==null?void 0:m.toLowerCase())||"",e=this.typeKeywords||[],i="esri/images/portal/",r="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,u=!1,d=!1,f=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(n=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),u=e.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":u?"utilitynetwork":n?"featureshosted":"features"):t==="map service"||t==="wms"||t==="wmts"?(c=e.includes("Spatiotemporal"),d=e.includes("Relational"),s=c||d?"mapimages":n||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages"):s=t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":t==="3dtiles service"?e.includes("3DObject")?"3dobjecttileslayer":e.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):t==="web map"||t==="cityengine web scene"?s="maps":t==="web scene"?s=e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?s="instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?s="apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?s="mapsgray":t==="service definition"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?s="datafiles":t==="360 vr experience"?s="360vr":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?s="appsgray":t==="arcgis pro add in"||t==="arcgis pro configuration"?s="addindesktop":t==="pdf"?s="pdf":t==="microsoft word"?s="word":t==="microsoft excel"?s="excel":t==="microsoft powerpoint"?s="ppt":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?s="datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?s="toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?s="layersgray":t==="analysis model"?s="analysismodel":t==="scene package"?s="scenepackage":t==="3dtiles package"?s="3dtileslayerpackage":t==="3dtiles service"?s="3dtileslayer":t==="mobile scene package"?s="mobilescenepackage":t==="tile package"||t==="compact tile package"?s="tilepackage":t==="task file"?s="taskfile":t==="report template"?s="report-template":t==="statistical data collection"?s="statisticaldatacollection":t==="insights workbook"?s="workbook":t==="insights model"?s="insightsmodel":t==="insights page"?s="insightspage":t==="insights theme"?s="insightstheme":t==="hub initiative"?s="hubinitiative":t==="hub page"?s="hubpage":t==="hub site application"?s="hubsite":t==="hub event"?s="hubevent":t==="hub project"?s="hubproject":t==="relational database connection"?s="relationaldatabaseconnection":t==="big data file share"?s="datastorecollection":t==="image collection"?s="imagecollection":t==="desktop style"?s="desktopstyle":t==="style"?s=e.includes("Dictionary")?"dictionarystyle":"style":t==="dashboard"?s="dashboard":t==="raster function template"?s="rasterprocessingtemplate":t==="vector tile package"?s="vectortilepackage":t==="ortho mapping project"?s="orthomappingproject":t==="ortho mapping template"?s="orthomappingtemplate":t==="solution"?s="solutions":t==="geopackage"?s="geopackage":t==="deep learning package"?s="deeplearningpackage":t==="real time analytic"?s="realtimeanalytics":t==="big data analytic"?s="bigdataanalytics":t==="feed"?s="feed":t==="excalibur imagery project"?s="excaliburimageryproject":t==="notebook"?s="notebook":t==="storymap"?s="storymap":t==="survey123 add in"?s="survey123addin":t==="mission"?s="mission":t==="mission report"?s="missionreport":t==="mission template"?s="missiontemplate":t==="quickcapture project"?s="quickcaptureproject":t==="pro report"?s="proreport":t==="pro report template"?s="proreporttemplate":t==="urban model"?s="urbanmodel":t==="web experience"?s="experiencebuilder":t==="web experience template"?s="webexperiencetemplate":t==="experience builder widget"?s="experiencebuilderwidget":t==="experience builder widget package"?s="experiencebuilderwidgetpackage":t==="workflow"?s="workflow":t==="kernel gateway connection"?s="kernelgatewayconnection":t==="insights script"?s="insightsscript":t==="hub initiative template"?s="hubinitiativetemplate":t==="storymap theme"?s="storymaptheme":t==="knowledge graph"?s="knowledgegraph":t==="knowledge graph layer"?s="knowledgegraphlayer":t==="knowledge studio project"?s="knowledgestudio":t==="native application"?s="nativeapp":t==="native application installer"?s="nativeappinstaller":t==="web link chart"?s="linkchart":t==="knowledge graph web investigation"?s="investigation":t==="ogcfeatureserver"?s="features":t==="pro project"?s="proproject":t==="insights workbook package"?s="insightsworkbookpackage":t==="apache parquet"?s="apacheparquet":t==="notebook code snippet library"?s="notebookcodesnippets":t==="suitability model"?s="suitabilitymodel":t==="esri classifier definition"?s="classifierdefinition":t==="esri classification schema"?s="classificationschema":t==="insights data engineering workbook"?s="dataengineeringworkbook":t==="insights data engineering model"?s="dataengineeringmodel":t==="deep learning studio project"?s="deeplearningproject":t==="discussion"?s="discussion":t==="allsource project"?s="allsourceproject":t==="api key"?s="apikey":t==="data pipeline"?s="datapipelines":t==="group layer"?(f=e.includes("Map"),s=f?"layergroup2d":"layergroup"):s=t==="media layer"?"onlinemedialayer":t==="form"?e.includes("Survey123")?"survey":"datafilesgray":t==="csv"?"csv":t==="image"?"image":"maps",s?mr(i+s+r+".png"):null}get isLayer(){return this.type!=null&&vZe.has(this.type)}get itemCdnUrl(){return nre(this.itemUrl)}get itemPageUrl(){var e;const t=(e=this.portal)==null?void 0:e.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){var i;const t=this.itemUrl,e=this.thumbnail;return t&&e?((i=this.portal)==null?void 0:i.normalizeUrl(`${t}/info/${e}?f=json`))??null:null}get userItemUrl(){var i,r,s;const t=(i=this.portal)==null?void 0:i.restUrl;if(!t)return null;const e=this.owner||((s=(r=this.portal)==null?void 0:r.user)==null?void 0:s.username);return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=Wn.getDefault()),i=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(r=>{this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(i),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof jH&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new jH({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:ie(this.applicationProxies),avgRating:this.avgRating,categories:ie(this.categories),created:ie(this.created),culture:this.culture,description:this.description,extent:ie(this.extent),groupCategories:ie(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:ie(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:ie(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ie(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ie(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new cx({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){var i;const t=this.toJSON();for(const r of["tags","typeKeywords","categories"])t[r]=(i=t[r])==null?void 0:i.join(", ");const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return this.portal.request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new jH(e)):null}fetchRelatedItems(t,e){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},cx)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t==null?void 0:t.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?i.query.text=e:typeof e=="object"&&(i.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new G("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new G("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:i}=this;await e.signIn();const{copyResources:r,folder:s,tags:n,title:o}=t||{},a={method:"post",query:{copyPrivateResources:r==="all",folder:typeof s=="string"?s:s==null?void 0:s.id,includeResources:!!r,tags:n==null?void 0:n.join(","),title:o}},{itemId:l}=await e.request(`${i}/copy`,a);return new cx({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,i=t.filename,r={method:"post"};if(typeof e=="string")cy(e)?r.query={data:e}:r.query={url:Tu(e)},i!=null&&(r.query.filename=i);else{const s=new FormData;i!=null?s.append("file",e,i):s.append("file",e),r.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new G("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:i}=await ce(()=>Promise.resolve().then(()=>sM),void 0);return i(this,t,e)}async addResource(t,e,i){const{addOrUpdateResources:r}=await ce(()=>Promise.resolve().then(()=>sM),void 0);return t.portalItem=this,await r(this,[{resource:t,content:e,compress:i==null?void 0:i.compress,access:i==null?void 0:i.access}],"add",i),t}async removeResource(t,e){const{removeResource:i}=await ce(()=>Promise.resolve().then(()=>sM),void 0);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new G("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await ce(()=>Promise.resolve().then(()=>sM),void 0);return e(this,t)}resourceFromPath(t){return new mZe({portalItem:this,path:t})}toJSON(){var i,r;const t=this.extent,e={accessInformation:this.accessInformation,categories:ie(this.categories),created:(i=this.created)==null?void 0:i.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:(r=this.modified)==null?void 0:r.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ie(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ie(this.typeKeywords),url:this.url};return S6e(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new cx({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};h([p({type:["private","shared","org","public"]})],Ti.prototype,"access",void 0),h([p()],Ti.prototype,"accessInformation",void 0),h([p({type:String})],Ti.prototype,"apiKey",void 0),h([p({json:{read:{source:"appProxies"}}})],Ti.prototype,"applicationProxies",void 0),h([p()],Ti.prototype,"avgRating",void 0),h([p()],Ti.prototype,"categories",void 0),h([p({type:Date})],Ti.prototype,"created",void 0),h([p()],Ti.prototype,"culture",void 0),h([p()],Ti.prototype,"description",void 0),h([p({readOnly:!0})],Ti.prototype,"displayName",null),h([p({type:ur})],Ti.prototype,"extent",void 0),h([ze("extent")],Ti.prototype,"readExtent",null),h([p()],Ti.prototype,"groupCategories",void 0),h([p({readOnly:!0})],Ti.prototype,"iconUrl",null),h([p()],Ti.prototype,"id",void 0),h([p({readOnly:!0})],Ti.prototype,"isLayer",null),h([p({type:Boolean,readOnly:!0})],Ti.prototype,"isOrgItem",void 0),h([p()],Ti.prototype,"itemControl",void 0),h([p({readOnly:!0})],Ti.prototype,"itemPageUrl",null),h([p({readOnly:!0})],Ti.prototype,"itemUrl",null),h([p()],Ti.prototype,"licenseInfo",void 0),h([p({type:Date})],Ti.prototype,"modified",void 0),h([p()],Ti.prototype,"name",void 0),h([p()],Ti.prototype,"numComments",void 0),h([p()],Ti.prototype,"numRatings",void 0),h([p()],Ti.prototype,"numViews",void 0),h([p()],Ti.prototype,"owner",void 0),h([p()],Ti.prototype,"ownerFolder",void 0),h([p({type:Wn})],Ti.prototype,"portal",void 0),h([p()],Ti.prototype,"screenshots",void 0),h([p()],Ti.prototype,"size",void 0),h([p()],Ti.prototype,"snippet",void 0),h([p()],Ti.prototype,"sourceJSON",void 0),h([p({type:String})],Ti.prototype,"sourceUrl",void 0),h([p({type:String})],Ti.prototype,"spatialReference",void 0),h([p()],Ti.prototype,"tags",void 0),h([p()],Ti.prototype,"thumbnail",void 0),h([p({readOnly:!0})],Ti.prototype,"thumbnailUrl",null),h([p()],Ti.prototype,"title",void 0),h([p()],Ti.prototype,"type",void 0),h([p()],Ti.prototype,"typeKeywords",void 0),h([p({type:String,json:{read(t,e){var i;if(bZe.has(e.type)){const r=(i=this.portal)==null?void 0:i.restUrl;t||(t=r&&this.id?`${r}/content/items/${this.id}/data`:null)}return t}}})],Ti.prototype,"url",void 0),h([p({readOnly:!0})],Ti.prototype,"userItemUrl",null),Ti=cx=h([I("esri.portal.PortalItem")],Ti);const iS=Ti,oEe=Object.freeze(Object.defineProperty({__proto__:null,default:iS},Symbol.toStringTag,{value:"Module"}));async function wZe(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t.includes("-3d")?t.slice(0,t.indexOf("-3d")):t,i=await gSe("esri/t9n/basemaps");return i[t]||i[e]}const mZ={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return mr("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return mr("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return mr("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return mr("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return mr("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return mr("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return mr("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return mr("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return mr("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return mr("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return mr("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return mr("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return mr("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return mr("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return mr("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return mr("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}},xZe=new Set(["ar","bs","ca","hr","cs","da","nl","en","et","fi","fr","de","el","he","hu","id","it","ja","ko","lv","lt","nb","pl","ro","ru","sr","es","sv","th","tr","uk","vi"]);let Mv=class extends Ue{constructor(e){super(e),this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps",this.worldview=null}getLanguageParamValue(){if(this.language)return this.language;const e=Ou().toLowerCase();switch(e){case"pt-br":return"pt-BR";case"pt-pt":return"pt-PT";case"zh-cn":return"zh-CN";case"zh-hk":return"zh-HK";case"zh-tw":return"zh-TW"}const i=I6e(e);return i==="pt"?"pt-BR":i&&xZe.has(i)?i:"global"}};h([p()],Mv.prototype,"id",void 0),h([p()],Mv.prototype,"language",void 0),h([p()],Mv.prototype,"places",void 0),h([p()],Mv.prototype,"serviceUrl",void 0),h([p()],Mv.prototype,"worldview",void 0),Mv=h([I("esri.support.BasemapStyle")],Mv);const TZe=Mv;function Eqt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function SZe(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="subtype-group"&&"sublayers"in t}function ux(t){return(t==null?void 0:t.type)==="subtype-sublayer"}function qI(t){const e=t==null?void 0:t.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function LA(t){return t!=null&&"type"in t&&t.type==="group"}const Cqt={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function aEe(t){const e=t==null?void 0:t.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function EZe(t){return t==="IntegratedMeshLayer"||t==="IntegratedMesh3DTilesLayer"}function tL(t){return t==="integrated-mesh"||t==="integrated-mesh-3dtiles"}function zue(t){return(t==null?void 0:t.type)==="voxel"}function Bue(t){return(t==null?void 0:t.type)==="imagery-tile"}function lk(t){return(t==null?void 0:t.parent)!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function Zj(t){var e;return(t==null?void 0:t.type)==="feature"&&!t.url&&((e=t.source)==null?void 0:e.type)==="memory"}function Mqt(t){var e;return((t==null?void 0:t.type)==="feature"||(t==null?void 0:t.type)==="subtype-group")&&((e=t.source)==null?void 0:e.type)==="feature-layer"}function CZe(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const i=t.activeLayer.tileMatrixSets;if(i)return i}return null}async function lEe(t,e){const i=Bi==null?void 0:Bi.findServerInfo(t);if((i==null?void 0:i.currentVersion)!=null)return i.owningSystemUrl||null;const r=t.toLowerCase().indexOf("/rest/services");if(r===-1)return null;const s=`${t.substring(0,r)}/rest/info`,n=e!=null?e.signal:null,{data:o}=await yr(s,{query:{f:"json"},responseType:"json",signal:n});return(o==null?void 0:o.owningSystemUrl)||null}function MZe(t){if(!("capabilities"in t))return!1;switch(t.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"sublayer":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function cEe(t){return MZe(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function AZe(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function PZe(t){return!!AZe(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const OZe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),RZe=new Set(["catalog","csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","knowledge-graph","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function $Ze(t){return t.layerContainerType==="basemap"?OZe:t.layerContainerType==="operational-layers"?RZe:null}function IZe(t,e){if(e.restrictedWebMapWriting){const i=$Ze(e);return i==null||i.has(t.type)&&!Zj(t)}return!0}function LZe(t,e){var i;if(e)if(Zj(t)){const r=tD("featureCollection.layers",e),s=(i=r==null?void 0:r[0])==null?void 0:i.layerDefinition;s&&jue(t,s)}else t.type!=="group"&&jue(t,e)}function jue(t,e){"maxScale"in t&&(e.maxScale=XV(t.maxScale)??void 0),"minScale"in t&&(e.minScale=XV(t.minScale)??void 0)}function DZe(t,e){if(LZe(t,e),e&&(e.id=t.id,"blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=XV(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(Zj(t)){const i=e.featureCollection;i&&(i.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function Gue(t,e,i){if(!t.persistenceEnabled)return null;if(!("write"in t)||!t.write)return i!=null&&i.messages&&i.messages.push(new G("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(Zj(t)&&!t.isTable)e=t.resourceInfo;else if(IZe(t,i)){const r={};return t.write(r,i)?r:null}return e!=null&&DZe(t,e=ie(e)),e}var UR;let NZe=0,Ju=UR=class extends hD(ey){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+NZe++,this.baseLayers=new st,this.referenceLayers=new st;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&se.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.addHandles([this.baseLayers.on("after-add",r=>e(r.item)),this.referenceLayers.on("after-add",r=>e(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{se.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.baseLayers.toArray();for(const i of t)i.destroy();const e=this.referenceLayers.toArray();for(const i of e)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=qe(this.portalItem)}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",Kg(t,this._get("baseLayers")))}_writeBaseLayers(t,e,i){const r=[];t&&(i={...i,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=Gue(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);n!=null&&r.push(n)}),this.referenceLayers.forEach(s=>{const n=Gue(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);n!=null&&(s.type!=="scene"&&(n.isReference=!0),r.push(n))})),e.baseMapLayers=r}set referenceLayers(t){this._set("referenceLayers",Kg(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return Zie(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>RV(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>RV(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new UR({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){var i;return t=t||{},e!=null&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&((i=this.resourceInfo)!=null&&i.data.baseMapLayers)&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const s=ie(r);return s.url&&Qg(s.url)&&(s.url=`https:${s.url}`),s.templateUrl&&Qg(s.templateUrl)&&(s.templateUrl=`https:${s.templateUrl}`),s})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:i,style:r}=this;Dt(t);const s=[];if(e){const n=e.context?e.context.url:null;if(s.push(this._loadLayersFromJSON(e.data,n,t)),e.data.id&&!e.data.title){const o=e.data.id;s.push(wZe(o).then(a=>{a&&this.read({title:a},e.context)}))}}else i?s.push(this._loadFromItem(i,t)):r&&s.push(this._loadFromStylesService(r,t));await Promise.all(s)}async _loadLayersFromJSON(t,e,i){var l,c;const r=(l=this.resourceInfo)==null?void 0:l.context,s=((c=this.portalItem)==null?void 0:c.portal)||(r==null?void 0:r.portal)||null,n=kZe[(r==null?void 0:r.origin)||""]??"web-map",{populateOperationalLayers:o}=await ce(async()=>{const{populateOperationalLayers:u}=await import("./layersCreator-q6m_1vHJ.js");return{populateOperationalLayers:u}},__vite__mapDeps([6,7,8,9])),a=[];if(Dt(i),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const u={context:{...r,origin:n,url:e,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},d=g=>n==="web-scene"&&g.layerType==="ArcGISSceneServiceLayer"||g.isReference,f=o(this.baseLayers,t.baseMapLayers.filter(g=>!d(g)),u);a.push(f);const m=o(this.referenceLayers,t.baseMapLayers.filter(d),u);a.push(m)}await Promise.allSettled(a)}async _loadFromItem(t,e){const i=await t.load(e),r=await i.fetchData("json",e),s=un(t.itemUrl??"");return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:FZe[t.type||""]??"web-map",portal:t.portal||Wn.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||Wn.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}async _loadFromStylesService(t,e){const i=`${t.serviceUrl}/${t.id}`,r=(await yr(i,{query:{language:t.getLanguageParamValue(),places:t.places,worldview:t.worldview},signal:e==null?void 0:e.signal})).data,s=un(i);return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:"web-map",url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}static fromId(t){const e=mZ[t];return e?e.itemId?new UR({portalItem:{id:e.itemId,portal:{url:"https://www.arcgis.com"}}}):UR.fromJSON(e,{origin:e.is3d?"web-scene":"web-map"}):null}};h([p({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,i,r){this._writeBaseLayers(t,e,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:st}},writer(t,e,i,r){this._writeBaseLayers(t,e,r)}}}}}})],Ju.prototype,"baseLayers",null),h([p({type:String,json:{origins:{"web-scene":{write:!0}}}})],Ju.prototype,"id",void 0),h([p({type:iS})],Ju.prototype,"portalItem",void 0),h([p()],Ju.prototype,"referenceLayers",null),h([p({readOnly:!0})],Ju.prototype,"resourceInfo",void 0),h([p({type:Ze})],Ju.prototype,"spatialReference",void 0),h([p({type:TZe})],Ju.prototype,"style",void 0),h([p()],Ju.prototype,"thumbnailUrl",void 0),h([p({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],Ju.prototype,"title",void 0),h([We("title")],Ju.prototype,"writeTitle",null),Ju=UR=h([I("esri.Basemap")],Ju);const FZe={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},kZe={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},HM=Ju,UZe=Object.freeze(Object.defineProperty({__proto__:null,default:HM},Symbol.toStringTag,{value:"Module"})),uz={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function uEe(t){return!!uz[t]||!!uz[t.toLowerCase()]}function ore(t){return uz[t]??uz[t.toLowerCase()]}function VZe(t){return[...ore(t)]}function GH(t,e,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?t+(e-t)*r:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}function hEe(t,e,i,r=1){const s=(t%360+360)%360/360,n=i<=.5?i*(e+1):i+e-i*e,o=2*i-n;return[Math.round(255*GH(o,n,s+1/3)),Math.round(255*GH(o,n,s)),Math.round(255*GH(o,n,s-1/3)),r]}function zZe(t){const e=t.length>5,i=e?8:4,r=(1<<i)-1,s=e?1:17,n=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&r,o>>=i,a[3]=s*l/255),l=o&r,o>>=i,a[2]=s*l,l=o&r,o>>=i,a[1]=s*l,l=o&r,o>>=i,a[0]=s*l,a}function E(){return[0,0,0]}function hn(t){return[t[0],t[1],t[2]]}function Ge(t,e,i){return[t,e,i]}function zl(t,e=E()){const i=Math.min(3,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function BZe(t,e){return new Float64Array(t,e,3)}function are(){return E()}function dEe(){return Ge(1,1,1)}function pEe(){return Ge(1,0,0)}function fEe(){return Ge(0,1,0)}function lre(){return Ge(0,0,1)}const On=are(),V0=dEe(),cre=pEe(),ure=fEe(),DA=lre();Object.freeze(Object.defineProperty({__proto__:null,ONES:V0,UNIT_X:cre,UNIT_Y:ure,UNIT_Z:DA,ZEROS:On,clone:hn,create:E,createView:BZe,fromArray:zl,fromValues:Ge,ones:dEe,unitX:pEe,unitY:fEe,unitZ:lre,zeros:are},Symbol.toStringTag,{value:"Module"}));let hre=1e-6;function Do(){return hre}function jZe(t){hre=t}const gD=Math.random,GZe=Math.PI/180,HZe=180/Math.PI;function Yj(t){return t*GZe}function qZe(t){return t*HZe}function WZe(t,e){return Math.abs(t-e)<=hre*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:gD,equals:WZe,getEpsilon:Do,setEpsilon:jZe,toDegree:qZe,toRadian:Yj},Symbol.toStringTag,{value:"Module"}));function Ve(t){const e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function ve(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function de(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}function Ee(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function Re(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Xj(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function hz(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function ZZe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function mEe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function NA(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function gEe(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function yEe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function _Ee(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function YZe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function he(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Pn(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function Cr(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}function uo(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}function sl(t){const e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function sa(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function XZe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Ce(t,e){const i=e[0],r=e[1],s=e[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t}function Te(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ft(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2];return t[0]=s*l-n*a,t[1]=n*o-r*l,t[2]=r*a-s*o,t}function xr(t,e,i,r){const s=e[0],n=e[1],o=e[2];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=o+r*(i[2]-o),t}function JZe(t,e,i,r,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),u=o*(3-2*n);return t[0]=e[0]*a+i[0]*l+r[0]*c+s[0]*u,t[1]=e[1]*a+i[1]*l+r[1]*c+s[1]*u,t[2]=e[2]*a+i[2]*l+r[2]*c+s[2]*u,t}function QZe(t,e,i,r,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,u=3*n*a,d=3*l*o,f=l*n;return t[0]=e[0]*c+i[0]*u+r[0]*d+s[0]*f,t[1]=e[1]*c+i[1]*u+r[1]*d+s[1]*f,t[2]=e[2]*c+i[2]*u+r[2]*d+s[2]*f,t}function KZe(t,e){e=e||1;const i=gD,r=2*i()*Math.PI,s=2*i()-1,n=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=s*e,t}function nt(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12],t[1]=i[1]*r+i[5]*s+i[9]*n+i[13],t[2]=i[2]*r+i[6]*s+i[10]*n+i[14],t}function ta(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=r*i[0]+s*i[3]+n*i[6],t[1]=r*i[1]+s*i[4]+n*i[7],t[2]=r*i[2]+s*i[5]+n*i[8],t}function fu(t,e,i){const r=i[0],s=i[1],n=i[2],o=i[3],a=e[0],l=e[1],c=e[2],u=s*c-n*l,d=n*a-r*c,f=r*l-s*a,m=s*f-n*d,g=n*u-r*f,y=r*d-s*u,v=2*o;return t[0]=a+u*v+2*m,t[1]=l+d*v+2*g,t[2]=c+f*v+2*y,t}function eYe(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function tYe(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function iYe(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function vEe(t,e){Ce(Hue,t),Ce(que,e);const i=Te(Hue,que);return i>1?0:i<-1?Math.PI:Math.acos(i)}const Hue=E(),que=E();function rYe(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function $o(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function US(t,e){if(t===e)return!0;const i=t[0],r=t[1],s=t[2],n=e[0],o=e[1],a=e[2],l=Do();return Math.abs(i-n)<=l*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=l*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-a)<=l*Math.max(1,Math.abs(s),Math.abs(a))}function v_(t,e,i){const r=i[0]-e[0],s=i[1]-e[1],n=i[2]-e[2];let o=r*r+s*s+n*n;return o>0?(o=1/Math.sqrt(o),t[0]=r*o,t[1]=s*o,t[2]=n*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const Ii=Re,sYe=Xj,nYe=hz,Y1=Cr,iL=uo,kl=Ve,dz=sl,Wue=Object.freeze(Object.defineProperty({__proto__:null,abs:NA,add:Ee,angle:vEe,bezier:QZe,ceil:ZZe,copy:ve,cross:ft,direction:v_,dist:Y1,distance:Cr,div:nYe,divide:hz,dot:Te,equals:US,exactEquals:$o,floor:mEe,hermite:JZe,inverse:XZe,len:kl,length:Ve,lerp:xr,max:_Ee,min:yEe,mul:sYe,multiply:Xj,negate:sa,normalize:Ce,random:KZe,rotateX:eYe,rotateY:tYe,rotateZ:iYe,round:YZe,scale:he,scaleAndAdd:Pn,set:de,sign:gEe,sqrDist:iL,sqrLen:dz,squaredDistance:uo,squaredLength:sl,str:rYe,sub:Ii,subtract:Re,transformMat3:ta,transformMat4:nt,transformQuat:fu},Symbol.toStringTag,{value:"Module"})),Zue=new Float32Array(1);function bEe(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function Ne(t,e,i){return Math.min(Math.max(t,e),i)}function rL(t){return!(t&t-1)}function Aqt(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function Pqt(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function Bt(t,e,i){return t+(e-t)*i}function Oqt(t,e,i,r,s){return Bt(r,s,(t-e)/(i-e))}function kt(t){return t*Math.PI/180}function La(t){return 180*t/Math.PI}function gZ(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function po(t){return Math.acos(Ne(t,-1,1))}function qf(t){return Math.asin(Ne(t,-1,1))}function X1(t,e,i=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=i}const pz=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function yZ(t){return pz.setFloat64(0,t),pz.getBigInt64(0)}function oYe(t){return pz.setBigInt64(0,t),pz.getFloat64(0)}const ck=BigInt("1000000"),aYe=wEe(1);function wEe(t){const e=yZ(t=Math.abs(t)),i=oYe(e<=ck?ck:e-ck);return Math.abs(t-i)}function Rqt(t,e,i=aYe){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(i!=null&&wEe(Math.min(Math.abs(t),Math.abs(e)))<i)return Math.abs(t-e)<=i;const r=yZ(t),s=yZ(e);return r<0!=s<0?!1:!((r<s?s-r:r-s)>ck)}function lYe(t,e,i=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const r=Math.abs(t-e),s=Math.abs(t),n=Math.abs(e);if(t===0||e===0||s<1e-12&&n<1e-12){if(r>.01*i)return!1}else if(r/(s+n)>i)return!1;return!0}function cYe(t){return xEe(Math.max(-_Z,Math.min(t,_Z)))}function xEe(t){return Zue[0]=t,Zue[0]}function sL(t,e,i){const r=Ne((i-t)/(e-t),0,1);return r*r*(3-2*r)}function Yue(t,e){const i=Ve(t),r=qf(t[2]/i),s=Math.atan2(t[1]/i,t[0]/i);return de(e,i,r,s),e}function fz(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],r=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(X1(e,1)&&X1(i,1)&&X1(r,1))}function uYe(t,e){return(t%e+e)%e}const _Z=xEe(34028234663852886e22);function zN(t){return Ne(Aie(t),0,255)}function BN(t,e,i){return t=Number(t),isNaN(t)?i:t<e?e:t>i?i:t}function jN(t,e){const i=t.toString(16).padStart(2,"0");return e?i.substring(0,1):i}let uk=class Ho{static blendColors(e,i,r,s=new Ho){return s.r=Math.round(e.r+(i.r-e.r)*r),s.g=Math.round(e.g+(i.g-e.g)*r),s.b=Math.round(e.b+(i.b-e.b)*r),s.a=e.a+(i.a-e.a)*r,s._sanitize()}static fromRgb(e,i){const r=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s.\-,%0-9]+)\)/);if(r){const s=r[2].split(/\s*,\s*/),n=r[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),Ho.fromArray(a,i)}return Ho.fromArray(s.map(a=>parseFloat(a)),i)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return Ho.fromArray(hEe(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),i)}return null}static fromHex(e,i=new Ho){if(e[0]!=="#"||isNaN(+`0x${e.substring(1)}`))return null;switch(e.length){case 4:case 5:{const r=parseInt(e.substring(1,2),16),s=parseInt(e.substring(2,3),16),n=parseInt(e.substring(3,4),16),o=e.length===5?15:parseInt(e.substring(4),16);return Ho.fromArray([r+16*r,s+16*s,n+16*n,(o+16*o)/255],i)}case 7:case 9:{const r=parseInt(e.substring(1,3),16),s=parseInt(e.substring(3,5),16),n=parseInt(e.substring(5,7),16),o=e.length===7?255:parseInt(e.substring(7),16);return Ho.fromArray([r,s,n,o/255],i)}default:return null}}static fromArray(e,i=new Ho){return i._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(e,i){const r=uEe(e)?ore(e):null;return r&&Ho.fromArray(r,i)||Ho.fromRgb(e,i)||Ho.fromHex(e,i)}static fromJSON(e){return e!=null?new Ho([e[0],e[1],e[2],(e[3]??255)/255]):void 0}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?Ho.fromString(e,this):Array.isArray(e)?Ho.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof Ho||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(e){const i=(e==null?void 0:e.capitalize)??!1,r=(e==null?void 0:e.digits)??6,s=r===3||r===4,n=r===4||r===8,o=`#${jN(this.r,s)}${jN(this.g,s)}${jN(this.b,s)}${n?jN(Math.round(255*this.a),s):""}`;return i?o.toUpperCase():o}toCss(e=!1){const i=this.r+", "+this.g+", "+this.b;return e?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=Ho.AlphaMode.ALWAYS){const i=zN(this.r),r=zN(this.g),s=zN(this.b);return e===Ho.AlphaMode.ALWAYS||this.a!==1?[i,r,s,zN(255*this.a)]:[i,r,s]}clone(){return new Ho(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(BN(this.r,0,255)),this.g=Math.round(BN(this.g,0,255)),this.b=Math.round(BN(this.b,0,255)),this.a=BN(this.a,0,1),this}_set(e,i,r,s){this.r=e,this.g=i,this.b=r,this.a=s}};uk.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(uk||(uk={}));const Qe=uk;function $qt(t){}function hYe(t){return()=>t}function Ot(t,e={}){const i=t instanceof Ji?t:new Ji(t,e),r={type:(e==null?void 0:e.ignoreUnknown)??1?i.apiValues:String,json:{type:i.jsonValues,read:!(e!=null&&e.readOnly)&&{reader:i.read},write:{writer:i.write}}};return(e==null?void 0:e.readOnly)!==void 0&&(r.readOnly=!!e.readOnly),(e==null?void 0:e.default)!==void 0&&(r.json.default=e.default),(e==null?void 0:e.name)!==void 0&&(r.json.name=e.name),(e==null?void 0:e.nonNullable)!==void 0&&(r.nonNullable=e.nonNullable),p(r)}var vZ;let hk=vZ=class extends Se{constructor(t){super(t),this.type="none"}clone(){return new vZ({type:this.type})}};h([Ot({none:"none",stayAbove:"stay-above"})],hk.prototype,"type",void 0),hk=vZ=h([I("esri.ground.NavigationConstraint")],hk);function yD(t){const e=Aie(100*(1-t));return Math.max(0,Math.min(e,100))}function FA(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var bZ;let Xy=bZ=class extends hD(ey){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new st;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&se.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>e(r.item)),this.layers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{os(t)||se.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)qe(e);this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",Kg(t,this._get("layers")))}writeLayers(t,e,i,r){const s=[];t&&(r={...r,layerContainerType:"ground"},t.forEach(n=>{if("write"in n){const o={};hYe(n)().write(o,r)&&s.push(o)}else r!=null&&r.messages&&r.messages.push(new G("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),e.layers=s}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return Zie(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:i}=await ce(()=>import("./ElevationQuery-D4cc1dXR.js"),[]);Dt(e);const r=new i,s=this.layers.filter(Xue).toArray();return r.queryAll(s,t,e)}async createElevationSampler(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:i}=await ce(()=>import("./ElevationQuery-D4cc1dXR.js"),[]);Dt(e);const r=new i,s=this.layers.filter(Xue).toArray();return r.createSamplerAll(s,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:ie(this.surfaceColor),navigationConstraint:ie(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new bZ({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}async _loadLayersFromJSON(t,e,i){const r=(e==null?void 0:e.origin)||"web-scene",s=(e==null?void 0:e.portal)||null,n=(e==null?void 0:e.url)||null,{populateOperationalLayers:o}=await ce(async()=>{const{populateOperationalLayers:l}=await import("./layersCreator-q6m_1vHJ.js");return{populateOperationalLayers:l}},__vite__mapDeps([6,7,8,9]));Dt(i);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}await Promise.allSettled(a)}};function dYe(t){return t&&"createElevationSampler"in t}function Xue(t){return t.type==="elevation"||dYe(t)}h([p({json:{read:!1}})],Xy.prototype,"layers",null),h([We("layers")],Xy.prototype,"writeLayers",null),h([p({readOnly:!0})],Xy.prototype,"resourceInfo",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Xi,read:{reader:FA,source:"transparency"},write:{writer:(t,e)=>{e.transparency=yD(t)},target:"transparency"}}})],Xy.prototype,"opacity",void 0),h([p({type:Qe,json:{type:[Xi],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],Xy.prototype,"surfaceColor",void 0),h([p({type:hk,json:{write:!0}})],Xy.prototype,"navigationConstraint",void 0),Xy=bZ=h([I("esri.Ground")],Xy);const nL=Xy;let YE=class extends st{constructor(e){super(e),this.getCollections=null}initialize(){this.addHandles(FSe(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let i=0;for(const r of e)r!=null&&(i=this._processCollection(i,r));this.splice(i,this.length)}_createNewInstance(e){return new st(e)}_processCollection(e,i){if(!i)return e;const r=this.itemFilterFunction??(s=>!!s);for(const s of i)if(s){if(r(s)){const n=this.indexOf(s,e);n>=0?n!==e&&this.reorder(s,e):this.add(s,e),++e}if(this.getChildrenFunction){const n=this.getChildrenFunction(s);if(Array.isArray(n))for(const o of n)e=this._processCollection(e,o);else e=this._processCollection(e,n)}}return e}};h([p()],YE.prototype,"getCollections",void 0),h([p()],YE.prototype,"getChildrenFunction",void 0),h([p()],YE.prototype,"itemFilterFunction",void 0),YE=h([I("esri.core.CollectionFlattener")],YE);const oL=YE;function te(t,e,i={}){return dre(t,e,i,TEe)}function No(t,e,i={}){return dre(t,e,i,SEe)}function dre(t,e,i={},r){let s=null;const n=i.once?(o,a)=>{r(o)&&($r(s),e(o,a))}:(o,a)=>{r(o)&&e(o,a)};if(s=m9e(t,n,i.sync,i.equals),i.initial){const o=t();n(o,o)}return s}function Ks(t,e,i,r={}){let s=null,n=null,o=null;function a(){var u;s&&n&&(n.remove(),(u=r.onListenerRemove)==null||u.call(r,s),s=null,n=null)}function l(u){r.once&&r.once&&$r(o),i(u)}const c=te(t,(u,d)=>{var f;a(),Nj(u)&&(s=u,n=kP(u,e,l),(f=r.onListenerAdd)==null||f.call(r,u))},{sync:r.sync,initial:!0});return o=Gi(()=>{c.remove(),a()}),o}function VS(t,e){return pYe(t,SEe,e)}function pYe(t,e,i){if(ra(i))return Promise.reject(ki());const r=t();if(e!=null&&e(r))return Promise.resolve(r);let s=null;function n(){s=$r(s)}return new Promise((o,a)=>{s=ES([Ra(i,()=>{n(),a(ki())}),dre(t,l=>{n(),o(l)},{sync:!1,once:!0},e??TEe)])})}function TEe(t){return!0}function SEe(t){return!!t}function fYe(t,e){const i=new st,r=Ks(t,"after-splice",({added:s,start:n,deleteCount:o})=>{const a=i.splice(n,o);for(const l of a)l.remove();if(s!=null&&s.length){const l=s.map(e);i.addMany(l,n)}},{sync:!0,onListenerRemove:()=>i.drain(s=>s.remove()),onListenerAdd:s=>i.addMany(s.items.map(e))});return i.addHandles(r),i}function Lqt(t,e){const i=new st,r=fYe(t,a=>uy(async l=>{const c=await e(a,l);if(ra(l))throw c.remove(),ki();return c})),s=()=>null,n=async a=>{const l=await a.promise,c=r.indexOf(a);c<0||i.splice(c,1,l)};i.addMany(r.items.map(s));for(const a of r)H0(n(a));const o=r.on("after-splice",({added:a,start:l,deleteCount:c})=>{const u=i.splice(l,c);for(const d of u)d==null||d.remove();if(a!=null&&a.length){i.addMany(a.map(s),l);for(const d of a)H0(n(d))}});return i.addHandles([tTe(r),o]),i}const or={sync:!0},$t={initial:!0},hr={sync:!0,initial:!0},GN=new WeakMap;function EEe(t){return!t.destroyed&&(GN.has(t)||t.addHandles([te(()=>{const e=t.parent;return!(!e||!("type"in e))&&(e.type==="catalog-dynamic-group"||EEe(e))},e=>GN.set(t,e),hr),Gi(()=>GN.delete(t))]),GN.get(t))}function mYe(t){return typeof t=="object"&&t!=null&&"loaded"in t&&t.loaded===!0&&"type"in t}function gYe(t){var e,i;return!(!mYe(t)||!((i=(e=cEe(t))==null?void 0:e.operations)!=null&&i.supportsEditing)||"editingEnabled"in t&&!PZe(t)||EEe(t))}const yYe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,_Ye="screenUtils.toPt: input not recognized!",CEe=96;function wn(t){return t?t/72*CEe:0}function Uo(t){return t?72*t/CEe:0}function vr(t){if(typeof t=="string"){const e=t.match(yYe);if(e){const i=Number(e[1]),r=e[3]&&e[3].toLowerCase(),s=t.charAt(0)==="-",n=r==="px"?Uo(i):i;return s?-n:n}return console.warn(_Ye),null}return t}function ep(t=0,e=0){return{x:t,y:e}}function Ss(t=0,e=0){return[t,e]}function MEe(t=0,e=0){return[t,e]}function Pa(t=0,e=0,i=0){return[t,e,i]}function Dqt(t){return t}function Nqt(t){return t}function Fqt(t){return t}function yf(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function Jj(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function vYe(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function bYe(t,e,i,r,s,n,o,a,l,c,u,d,f,m,g,y){const v=new Float32Array(16);return v[0]=t,v[1]=e,v[2]=i,v[3]=r,v[4]=s,v[5]=n,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=u,v[11]=d,v[12]=f,v[13]=m,v[14]=g,v[15]=y,v}function wYe(t,e){return new Float32Array(t,e,16)}const xYe=Jj();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:xYe,clone:vYe,create:Jj,createView:wYe,fromValues:bYe},Symbol.toStringTag,{value:"Module"}));function xn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function hy(t,e,i,r,s,n,o,a,l,c,u,d,f,m,g,y,v){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=u,t[10]=d,t[11]=f,t[12]=m,t[13]=g,t[14]=y,t[15]=v,t}function tp(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Lu(t,e){if(t===e){const i=e[1],r=e[2],s=e[3],n=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=n,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Hb(t,e){return Zn(t,e)||tp(t),t}function Zn(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],f=e[10],m=e[11],g=e[12],y=e[13],v=e[14],b=e[15],w=i*a-r*o,x=i*l-s*o,S=i*c-n*o,C=r*l-s*a,M=r*c-n*a,O=s*c-n*l,D=u*y-d*g,U=u*v-f*g,k=u*b-m*g,H=d*v-f*y,V=d*b-m*y,X=f*b-m*v;let q=w*X-x*V+S*H+C*k-M*U+O*D;return q?(q=1/q,t[0]=(a*X-l*V+c*H)*q,t[1]=(s*V-r*X-n*H)*q,t[2]=(y*O-v*M+b*C)*q,t[3]=(f*M-d*O-m*C)*q,t[4]=(l*k-o*X-c*U)*q,t[5]=(i*X-s*k+n*U)*q,t[6]=(v*S-g*O-b*x)*q,t[7]=(u*O-f*S+m*x)*q,t[8]=(o*V-a*k+c*D)*q,t[9]=(r*k-i*V-n*D)*q,t[10]=(g*M-y*S+b*w)*q,t[11]=(d*S-u*M-m*w)*q,t[12]=(a*U-o*H-l*D)*q,t[13]=(i*H-r*U+s*D)*q,t[14]=(y*x-g*C-v*w)*q,t[15]=(u*C-d*x+f*w)*q,t):null}function TYe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],f=e[10],m=e[11],g=e[12],y=e[13],v=e[14],b=e[15];return t[0]=a*(f*b-m*v)-d*(l*b-c*v)+y*(l*m-c*f),t[1]=-(r*(f*b-m*v)-d*(s*b-n*v)+y*(s*m-n*f)),t[2]=r*(l*b-c*v)-a*(s*b-n*v)+y*(s*c-n*l),t[3]=-(r*(l*m-c*f)-a*(s*m-n*f)+d*(s*c-n*l)),t[4]=-(o*(f*b-m*v)-u*(l*b-c*v)+g*(l*m-c*f)),t[5]=i*(f*b-m*v)-u*(s*b-n*v)+g*(s*m-n*f),t[6]=-(i*(l*b-c*v)-o*(s*b-n*v)+g*(s*c-n*l)),t[7]=i*(l*m-c*f)-o*(s*m-n*f)+u*(s*c-n*l),t[8]=o*(d*b-m*y)-u*(a*b-c*y)+g*(a*m-c*d),t[9]=-(i*(d*b-m*y)-u*(r*b-n*y)+g*(r*m-n*d)),t[10]=i*(a*b-c*y)-o*(r*b-n*y)+g*(r*c-n*a),t[11]=-(i*(a*m-c*d)-o*(r*m-n*d)+u*(r*c-n*a)),t[12]=-(o*(d*v-f*y)-u*(a*v-l*y)+g*(a*f-l*d)),t[13]=i*(d*v-f*y)-u*(r*v-s*y)+g*(r*f-s*d),t[14]=-(i*(a*v-l*y)-o*(r*v-s*y)+g*(r*l-s*a)),t[15]=i*(a*f-l*d)-o*(r*f-s*d)+u*(r*l-s*a),t}function SYe(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],d=t[10],f=t[11],m=t[12],g=t[13],y=t[14],v=t[15];return(e*o-i*n)*(d*v-f*y)-(e*a-r*n)*(u*v-f*g)+(e*l-s*n)*(u*y-d*g)+(i*a-r*o)*(c*v-f*m)-(i*l-s*o)*(c*y-d*m)+(r*l-s*a)*(c*g-u*m)}function gr(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],f=e[9],m=e[10],g=e[11],y=e[12],v=e[13],b=e[14],w=e[15];let x=i[0],S=i[1],C=i[2],M=i[3];return t[0]=x*r+S*a+C*d+M*y,t[1]=x*s+S*l+C*f+M*v,t[2]=x*n+S*c+C*m+M*b,t[3]=x*o+S*u+C*g+M*w,x=i[4],S=i[5],C=i[6],M=i[7],t[4]=x*r+S*a+C*d+M*y,t[5]=x*s+S*l+C*f+M*v,t[6]=x*n+S*c+C*m+M*b,t[7]=x*o+S*u+C*g+M*w,x=i[8],S=i[9],C=i[10],M=i[11],t[8]=x*r+S*a+C*d+M*y,t[9]=x*s+S*l+C*f+M*v,t[10]=x*n+S*c+C*m+M*b,t[11]=x*o+S*u+C*g+M*w,x=i[12],S=i[13],C=i[14],M=i[15],t[12]=x*r+S*a+C*d+M*y,t[13]=x*s+S*l+C*f+M*v,t[14]=x*n+S*c+C*m+M*b,t[15]=x*o+S*u+C*g+M*w,t}function dl(t,e,i){const r=i[0],s=i[1],n=i[2];if(e===t)t[12]=e[0]*r+e[4]*s+e[8]*n+e[12],t[13]=e[1]*r+e[5]*s+e[9]*n+e[13],t[14]=e[2]*r+e[6]*s+e[10]*n+e[14],t[15]=e[3]*r+e[7]*s+e[11]*n+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],d=e[5],f=e[6],m=e[7],g=e[8],y=e[9],v=e[10],b=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=d,t[6]=f,t[7]=m,t[8]=g,t[9]=y,t[10]=v,t[11]=b,t[12]=o*r+u*s+g*n+e[12],t[13]=a*r+d*s+y*n+e[13],t[14]=l*r+f*s+v*n+e[14],t[15]=c*r+m*s+b*n+e[15]}return t}function _D(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Au(t,e,i,r){let s,n,o,a,l,c,u,d,f,m,g,y,v,b,w,x,S,C,M,O,D,U,k,H,V=r[0],X=r[1],q=r[2],Z=Math.sqrt(V*V+X*X+q*q);return Z<Do()?null:(Z=1/Z,V*=Z,X*=Z,q*=Z,s=Math.sin(i),n=Math.cos(i),o=1-n,a=e[0],l=e[1],c=e[2],u=e[3],d=e[4],f=e[5],m=e[6],g=e[7],y=e[8],v=e[9],b=e[10],w=e[11],x=V*V*o+n,S=X*V*o+q*s,C=q*V*o-X*s,M=V*X*o-q*s,O=X*X*o+n,D=q*X*o+V*s,U=V*q*o+X*s,k=X*q*o-V*s,H=q*q*o+n,t[0]=a*x+d*S+y*C,t[1]=l*x+f*S+v*C,t[2]=c*x+m*S+b*C,t[3]=u*x+g*S+w*C,t[4]=a*M+d*O+y*D,t[5]=l*M+f*O+v*D,t[6]=c*M+m*O+b*D,t[7]=u*M+g*O+w*D,t[8]=a*U+d*k+y*H,t[9]=l*U+f*k+v*H,t[10]=c*U+m*k+b*H,t[11]=u*U+g*k+w*H,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function kA(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],d=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+c*r,t[5]=o*s+u*r,t[6]=a*s+d*r,t[7]=l*s+f*r,t[8]=c*s-n*r,t[9]=u*s-o*r,t[10]=d*s-a*r,t[11]=f*s-l*r,t}function Qj(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],d=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-c*r,t[1]=o*s-u*r,t[2]=a*s-d*r,t[3]=l*s-f*r,t[8]=n*r+c*s,t[9]=o*r+u*s,t[10]=a*r+d*s,t[11]=l*r+f*s,t}function UA(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],d=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+c*r,t[1]=o*s+u*r,t[2]=a*s+d*r,t[3]=l*s+f*r,t[4]=c*s-n*r,t[5]=u*s-o*r,t[6]=d*s-a*r,t[7]=f*s-l*r,t}function g2(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function AEe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Du(t,e,i){if(e===0)return tp(t);let r,s,n,o=i[0],a=i[1],l=i[2],c=Math.sqrt(o*o+a*a+l*l);return c<Do()?null:(c=1/c,o*=c,a*=c,l*=c,r=Math.sin(e),s=Math.cos(e),n=1-s,t[0]=o*o*n+s,t[1]=a*o*n+l*r,t[2]=l*o*n-a*r,t[3]=0,t[4]=o*a*n-l*r,t[5]=a*a*n+s,t[6]=l*a*n+o*r,t[7]=0,t[8]=o*l*n+a*r,t[9]=a*l*n-o*r,t[10]=l*l*n+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function PEe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function EYe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function OEe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function REe(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=r+r,l=s+s,c=n+n,u=r*a,d=r*l,f=r*c,m=s*l,g=s*c,y=n*c,v=o*a,b=o*l,w=o*c;return t[0]=1-(m+y),t[1]=d+w,t[2]=f-b,t[3]=0,t[4]=d-w,t[5]=1-(u+y),t[6]=g+v,t[7]=0,t[8]=f+b,t[9]=g-v,t[10]=1-(u+m),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function CYe(t,e){const i=MYe,r=-e[0],s=-e[1],n=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=r*r+s*s+n*n+o*o;return d>0?(i[0]=2*(a*o+u*r+l*n-c*s)/d,i[1]=2*(l*o+u*s+c*r-a*n)/d,i[2]=2*(c*o+u*n+a*s-l*r)/d):(i[0]=2*(a*o+u*r+l*n-c*s),i[1]=2*(l*o+u*s+c*r-a*n),i[2]=2*(c*o+u*n+a*s-l*r)),REe(t,e,i),t}const MYe=E();function mz(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function $Ee(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.sqrt(i*i+r*r+s*s),t[1]=Math.sqrt(n*n+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+u*u),t}function IEe(t,e){const i=e[0]+e[5]+e[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t}function AYe(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3],l=s+s,c=n+n,u=o+o,d=s*l,f=s*c,m=s*u,g=n*c,y=n*u,v=o*u,b=a*l,w=a*c,x=a*u,S=r[0],C=r[1],M=r[2];return t[0]=(1-(g+v))*S,t[1]=(f+x)*S,t[2]=(m-w)*S,t[3]=0,t[4]=(f-x)*C,t[5]=(1-(d+v))*C,t[6]=(y+b)*C,t[7]=0,t[8]=(m+w)*M,t[9]=(y-b)*M,t[10]=(1-(d+g))*M,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function PYe(t,e,i,r,s){const n=e[0],o=e[1],a=e[2],l=e[3],c=n+n,u=o+o,d=a+a,f=n*c,m=n*u,g=n*d,y=o*u,v=o*d,b=a*d,w=l*c,x=l*u,S=l*d,C=r[0],M=r[1],O=r[2],D=s[0],U=s[1],k=s[2],H=(1-(y+b))*C,V=(m+S)*C,X=(g-x)*C,q=(m-S)*M,Z=(1-(f+b))*M,ye=(v+w)*M,L=(g+x)*O,N=(v-w)*O,z=(1-(f+y))*O;return t[0]=H,t[1]=V,t[2]=X,t[3]=0,t[4]=q,t[5]=Z,t[6]=ye,t[7]=0,t[8]=L,t[9]=N,t[10]=z,t[11]=0,t[12]=i[0]+D-(H*D+q*U+L*k),t[13]=i[1]+U-(V*D+Z*U+N*k),t[14]=i[2]+k-(X*D+ye*U+z*k),t[15]=1,t}function OYe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i+i,a=r+r,l=s+s,c=i*o,u=r*o,d=r*a,f=s*o,m=s*a,g=s*l,y=n*o,v=n*a,b=n*l;return t[0]=1-d-g,t[1]=u+b,t[2]=f-v,t[3]=0,t[4]=u-b,t[5]=1-c-g,t[6]=m+y,t[7]=0,t[8]=f+v,t[9]=m-y,t[10]=1-c-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function LEe(t,e,i,r,s,n,o){const a=1/(i-e),l=1/(s-r),c=1/(n-o);return t[0]=2*n*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*l,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(s+r)*l,t[10]=(o+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n*2*c,t[15]=0,t}function RYe(t,e,i,r,s){const n=1/Math.tan(e/2);let o;return t[0]=n/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(o=1/(r-s),t[10]=(s+r)*o,t[14]=2*s*r*o):(t[10]=-1,t[14]=-2*r),t}function $Ye(t,e,i,r){const s=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(s-n)*c*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t}function DEe(t,e,i,r,s,n,o){const a=1/(e-i),l=1/(r-s),c=1/(n-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(s+r)*l,t[14]=(o+n)*c,t[15]=1,t}function Kj(t,e,i,r){const s=e[0],n=e[1],o=e[2];let a=s-i[0],l=n-i[1],c=o-i[2];const u=Do();if(Math.abs(a)<u&&Math.abs(l)<u&&Math.abs(c)<u)return void tp(t);let d=1/Math.sqrt(a*a+l*l+c*c);a*=d,l*=d,c*=d;const f=r[0],m=r[1],g=r[2];let y=m*c-g*l,v=g*a-f*c,b=f*l-m*a;d=Math.sqrt(y*y+v*v+b*b),d?(d=1/d,y*=d,v*=d,b*=d):(y=0,v=0,b=0);let w=l*b-c*v,x=c*y-a*b,S=a*v-l*y;d=Math.sqrt(w*w+x*x+S*S),d?(d=1/d,w*=d,x*=d,S*=d):(w=0,x=0,S=0),t[0]=y,t[1]=w,t[2]=a,t[3]=0,t[4]=v,t[5]=x,t[6]=l,t[7]=0,t[8]=b,t[9]=S,t[10]=c,t[11]=0,t[12]=-(y*s+v*n+b*o),t[13]=-(w*s+x*n+S*o),t[14]=-(a*s+l*n+c*o),t[15]=1}function NEe(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=r[0],l=r[1],c=r[2];let u=s-i[0],d=n-i[1],f=o-i[2],m=u*u+d*d+f*f;m>0&&(m=1/Math.sqrt(m),u*=m,d*=m,f*=m);let g=l*f-c*d,y=c*u-a*f,v=a*d-l*u;return m=g*g+y*y+v*v,m>0&&(m=1/Math.sqrt(m),g*=m,y*=m,v*=m),t[0]=g,t[1]=y,t[2]=v,t[3]=0,t[4]=d*v-f*y,t[5]=f*g-u*v,t[6]=u*y-d*g,t[7]=0,t[8]=u,t[9]=d,t[10]=f,t[11]=0,t[12]=s,t[13]=n,t[14]=o,t[15]=1,t}function IYe(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function LYe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function DYe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t}function FEe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}function NYe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t}function FYe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t}function kEe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function eG(t,e){if(t===e)return!0;const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],f=t[10],m=t[11],g=t[12],y=t[13],v=t[14],b=t[15],w=e[0],x=e[1],S=e[2],C=e[3],M=e[4],O=e[5],D=e[6],U=e[7],k=e[8],H=e[9],V=e[10],X=e[11],q=e[12],Z=e[13],ye=e[14],L=e[15],N=Do();return Math.abs(i-w)<=N*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(r-x)<=N*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(s-S)<=N*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(n-C)<=N*Math.max(1,Math.abs(n),Math.abs(C))&&Math.abs(o-M)<=N*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(a-O)<=N*Math.max(1,Math.abs(a),Math.abs(O))&&Math.abs(l-D)<=N*Math.max(1,Math.abs(l),Math.abs(D))&&Math.abs(c-U)<=N*Math.max(1,Math.abs(c),Math.abs(U))&&Math.abs(u-k)<=N*Math.max(1,Math.abs(u),Math.abs(k))&&Math.abs(d-H)<=N*Math.max(1,Math.abs(d),Math.abs(H))&&Math.abs(f-V)<=N*Math.max(1,Math.abs(f),Math.abs(V))&&Math.abs(m-X)<=N*Math.max(1,Math.abs(m),Math.abs(X))&&Math.abs(g-q)<=N*Math.max(1,Math.abs(g),Math.abs(q))&&Math.abs(y-Z)<=N*Math.max(1,Math.abs(y),Math.abs(Z))&&Math.abs(v-ye)<=N*Math.max(1,Math.abs(v),Math.abs(ye))&&Math.abs(b-L)<=N*Math.max(1,Math.abs(b),Math.abs(L))}function pre(t){const e=Do(),i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return Math.abs(1-(i*i+n*n+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+u*u))<=e}function tG(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const aL=gr,kYe=FEe;Object.freeze(Object.defineProperty({__proto__:null,add:DYe,adjoint:TYe,copy:xn,determinant:SYe,equals:eG,exactEquals:kEe,frob:LYe,fromQuat:OYe,fromQuat2:CYe,fromRotation:Du,fromRotationTranslation:REe,fromRotationTranslationScale:AYe,fromRotationTranslationScaleOrigin:PYe,fromScaling:AEe,fromTranslation:g2,fromXRotation:PEe,fromYRotation:EYe,fromZRotation:OEe,frustum:LEe,getRotation:IEe,getScaling:$Ee,getTranslation:mz,hasIdentityRotation:tG,identity:tp,invert:Zn,invertOrIdentity:Hb,isOrthoNormal:pre,lookAt:Kj,mul:aL,multiply:gr,multiplyScalar:NYe,multiplyScalarAndAdd:FYe,ortho:DEe,perspective:RYe,perspectiveFromFieldOfView:$Ye,rotate:Au,rotateX:kA,rotateY:Qj,rotateZ:UA,scale:_D,set:hy,str:IYe,sub:kYe,subtract:FEe,targetTo:NEe,translate:dl,transpose:Lu},Symbol.toStringTag,{value:"Module"}));const UYe=(t,e)=>{const i=hy(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return Lu(i,i)},VYe=(t,e)=>{const i=hy(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return Lu(i,i)},zYe=(t,e)=>{const i=1-e,r=hy(t,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return Lu(r,r)},BYe=(t,e)=>{const i=Math.sin(e*Math.PI/180),r=Math.cos(e*Math.PI/180),s=hy(t,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return Lu(s,s)},jYe=(t,e)=>{const i=1-2*e,r=hy(t,i,0,0,e,0,i,0,e,0,0,i,e,0,0,0,1);return Lu(r,r)},GYe=(t,e)=>{const i=hy(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return Lu(i,i)},HYe=(t,e)=>{const i=1-e,r=hy(t,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return Lu(r,r)};let UEe=class VEe{constructor(e,i,r){this.strength=e,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(e,i,r){this.strength=mu(e.strength,i.strength,r),this.radius=mu(e.radius,i.radius,r),this.threshold=mu(e.threshold,i.threshold,r)}clone(){return new VEe(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:WI(this.radius),strength:this.strength,threshold:this.threshold}}},zEe=class BEe{constructor(e){this.radius=e,this.type="blur"}interpolate(e,i,r){this.radius=Math.round(mu(e.radius,i.radius,r))}clone(){return new BEe(this.radius)}toJSON(){return{type:"blur",radius:WI(this.radius)}}},wZ=class jEe{constructor(e,i){this.type=e,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.amount=mu(e.amount,i.amount,r),this._updateMatrix()}clone(){return new jEe(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||Jj();switch(this.type){case"brightness":this._colorMatrix=UYe(e,this.amount);break;case"contrast":this._colorMatrix=VYe(e,this.amount);break;case"grayscale":this._colorMatrix=zYe(e,this.amount);break;case"invert":this._colorMatrix=jYe(e,this.amount);break;case"saturate":this._colorMatrix=GYe(e,this.amount);break;case"sepia":this._colorMatrix=HYe(e,this.amount)}}},GEe=class HEe{constructor(e,i,r,s){this.offsetX=e,this.offsetY=i,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(e,i,r){this.offsetX=mu(e.offsetX,i.offsetX,r),this.offsetY=mu(e.offsetY,i.offsetY,r),this.blurRadius=mu(e.blurRadius,i.blurRadius,r),this.color[0]=Math.round(mu(e.color[0],i.color[0],r)),this.color[1]=Math.round(mu(e.color[1],i.color[1],r)),this.color[2]=Math.round(mu(e.color[2],i.color[2],r)),this.color[3]=mu(e.color[3],i.color[3],r)}clone(){return new HEe(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:WI(this.offsetX),yoffset:WI(this.offsetY),blurRadius:WI(this.blurRadius),color:e}}},qEe=class WEe{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.angle=mu(e.angle,i.angle,r),this._updateMatrix()}clone(){return new WEe(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||Jj();this._colorMatrix=BYe(e,this.angle)}},ZEe=class YEe{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,i,r){this.amount=mu(e.amount,i.amount,r)}clone(){return new YEe(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function mu(t,e,i){return t+(e-t)*i}function WI(t){return Math.round(1e3*Uo(t))/1e3}function qYe(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new wZ(t.type,0);case"saturate":case"brightness":case"contrast":return new wZ(t.type,1);case"opacity":return new ZEe(1);case"hue-rotate":return new qEe(0);case"blur":return new zEe(0);case"drop-shadow":return new GEe(0,0,0,[...ore("transparent")]);case"bloom":return new UEe(0,0,1)}}function WYe(t,e){const i=t.length>e.length?t:e;return(t.length>e.length?e:t).every((r,s)=>r.type===i[s].type)}function ZYe(t,e){const i=t.length>e.length?t:e,r=t.length>e.length?e:t;for(let s=r.length;s<i.length;s++)r.push(qYe(i[s]))}function YYe(t){const e=t[0];return!!e&&"type"in e}function XYe(t,e){return JSON.stringify(t??null)===JSON.stringify(e??null)}const Jue=()=>se.getLogger("esri.support.basemapUtils");function JYe(){return{}}function QYe(t){for(const e in t){const i=t[e];qe(i),delete t[e]}}function fre(t,e){let i;if(typeof t=="string"){const r=t in mZ,s=!r&&t.includes("/");if(!r&&!s){const n=Object.entries(mZ).filter(([o,a])=>rr.apiKey&&!a.classic||!rr.apiKey&&(a.classic||a.is3d)).map(([o])=>`"${o}"`).sort().join(", ");return Jue().warn(`Unable to find basemap definition for: ${t}. Try one of these: ${n}`),null}e&&(i=e[t]),i||(i=r?HM.fromId(t):new HM({style:{id:t}}),e&&(e[t]=i))}else i=Qs(HM,t);return i!=null&&i.destroyed&&(Jue().warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function kqt(t,e){var i,r,s,n;return((r=(i=t.basemap)==null?void 0:i.referenceLayers)==null?void 0:r.some(o=>o.uid===e))||((n=(s=t.basemap)==null?void 0:s.baseLayers)==null?void 0:n.some(o=>o.uid===e))}function KYe(t,e=null){const i=fre(t);if(!i)return null;const r=i.clone();return e&&(r.baseLayers=Que(r.baseLayers,e.baseLayers),r.referenceLayers=Que(r.referenceLayers,e.referenceLayers)),r}function Que(t,e){const i=new st;return t.forEach(r=>{const s=e.find(n=>n.type!=="scene"&&iXe(the(r),the(n)))||r;i.includes(s)?i.push(r):i.push(s)}),i}function Kue(t){return!!(t!=null&&t.baseLayers.concat(t.referenceLayers).some(eXe))}function eXe(t){if(ehe(t.url))return!0;if(t.type==="vector-tile")for(const e in t.sourceNameToSource){const i=t.sourceNameToSource[e];if(ehe(i==null?void 0:i.sourceUrl))return!0}return!1}const tXe=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function ehe(t){if(!t)return!1;const e=new eS(Tu(t));return!!e.authority&&tXe.test(e.authority)}function the(t){var e,i;return{type:t.type,effect:"effect"in t?t.effect:void 0,url:rXe("urlTemplate"in t&&t.urlTemplate||t.url||"styleUrl"in t&&t.styleUrl||""),minScale:"minScale"in t&&t.minScale!=null?t.minScale:0,maxScale:"maxScale"in t&&t.maxScale!=null?t.maxScale:0,opacity:t.opacity!=null?t.opacity:1,visible:t.visible==null||!!t.visible,sublayers:t.type!=="map-image"&&t.type!=="wms"||t.sublayers==null||(e=t.sublayers)==null?void 0:e.map(r=>({id:r.id,visible:r.visible})),activeLayerId:t.type==="wmts"?(i=t.activeLayer)==null?void 0:i.id:void 0}}function iXe(t,e){if(t.type!==e.type||t.url!==e.url||t.minScale!==e.minScale||t.maxScale!==e.maxScale||t.visible!==e.visible||t.opacity!==e.opacity||!XYe(t.effect,e.effect))return!1;if(t.activeLayerId!=null||e.activeLayerId!=null)return t.activeLayerId===e.activeLayerId;if(t.sublayers!=null||e.sublayers!=null){if(t.sublayers==null||e.sublayers==null||t.sublayers.length!==e.sublayers.length)return!1;for(let i=0;i<t.sublayers.length;i++){const r=t.sublayers.at(i),s=e.sublayers.at(i);if((r==null?void 0:r.id)!==(s==null?void 0:s.id)||(r==null?void 0:r.visible)!==(s==null?void 0:s.visible))return!1}}return!0}function rXe(t){return t?Zd(t).replace(/^\s*https?:/i,"").toLowerCase():""}function sXe(t){return new oL({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const i=[];return"tables"in e&&i.push(e.tables),"layers"in e&&i.push(e.layers),i},itemFilterFunction:e=>{const i=e.parent;return!!i&&"tables"in i&&i.tables.includes(e)}})}function HH(t){for(const e of t.values())e==null||e.destroy();t.clear()}const ihe={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function nXe(t){let e=null;if(typeof t=="string")if(t in ihe){const i=ihe[t];e=new nL({resourceInfo:{data:{layers:[i]}}})}else se.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=Qs(nL,t);return e}function VA(t,e,i=!1){let{hasM:r,hasZ:s}=t;Array.isArray(e)?e.length!==4||r||s?e.length===3&&i&&!r?(s=!0,r=!1):e.length===3&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&e.hasZ&&(!r||e.hasM),r=!r&&e.hasM&&(!s||e.hasZ)),t.hasZ=s,t.hasM=r}var xZ;function rhe(t){return(e,i)=>e==null?i:i==null?e:t(e,i)}function oXe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Av=xZ=class extends Gb{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){var s;if(!t&&!e)return{};const i={};Array.isArray(t)?(i.points=t,i.spatialReference=e):oXe(t)?i.spatialReference=t:(t.points&&(i.points=t.points),t.spatialReference&&(i.spatialReference=t.spatialReference),t.hasZ&&(i.hasZ=t.hasZ),t.hasM&&(i.hasM=t.hasM));const r=(s=i.points)==null?void 0:s[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new ur,i=this.hasZ,r=this.hasM,s=i?3:2,n=t[0],o=rhe(Math.min),a=rhe(Math.max);let l,c,u,d,[f,m]=n,[g,y]=n;for(let v=0,b=t.length;v<b;v++){const w=t[v],[x,S]=w;if(f=o(f,x),m=o(m,S),g=a(g,x),y=a(y,S),i&&w.length>2){const C=w[2];l=o(l,C),u=a(u,C)}if(r&&w.length>s){const C=w[s];c=o(c,C),d=a(d,C)}}return e.xmin=f,e.ymin=m,e.xmax=g,e.ymax=y,e.spatialReference=this.spatialReference,i?(e.zmin=l,e.zmax=u):(e.zmin=void 0,e.zmax=void 0),r?(e.mmin=c,e.mmax=d):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=ie(this.points)}addPoint(t){return VA(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:ie(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new xZ(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],i={x:e[0],y:e[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=e[2],r=3),this.hasM&&(i.m=e[r]),new bt(i)}removePoint(t){if(!this._validateInputs(t))return null;const e=new bt(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(VA(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};h([p({readOnly:!0})],Av.prototype,"cache",null),h([p()],Av.prototype,"extent",null),h([p({type:[[Number]],json:{write:{isRequired:!0}}})],Av.prototype,"points",void 0),h([We("points")],Av.prototype,"writePoints",null),Av=xZ=h([I("esri.geometry.Multipoint")],Av),Av.prototype.toJSON.isDefaultToJSON=!0;const jP=Av;function vD(t){const e=[];for(t.reset();t.nextPath();){const i=[];for(;t.nextPoint();)i.push([t.x,t.y]);e.push(i)}return t.reset(),e}function J1(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}var ys;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(ys||(ys={}));function iG(t,e){const i=e[0]-t[0],r=e[1]-t[1];if(t.length>2&&e.length>2){const s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function XEe(t,e,i){const r=t[0]+i*(e[0]-t[0]),s=t[1]+i*(e[1]-t[1]);return t.length>2&&e.length>2?[r,s,t[2]+i*(e[2]-t[2])]:[r,s]}function aXe(t,e,i,r){const[s,n]=e,[o,a]=i,[l,c]=r,u=l-o,d=c-a,f=u*u+d*d,m=(s-o)*u+(n-a)*d,g=Math.min(1,Math.max(0,m/f));return t[0]=o+u*g,t[1]=a+d*g,t}function lXe(t,e,i,r,s,n){let o=i,a=r,l=s-o,c=n-a;if(l!==0||c!==0){const u=((t-o)*l+(e-a)*c)/(l*l+c*c);u>1?(o=s,a=n):u>0&&(o+=l*u,a+=c*u)}return l=t-o,c=e-a,l*l+c*c}function JEe(t,e){return XEe(t,e,.5)}function mre(t){const e=t.length;let i=0;for(let r=0;r<e-1;++r)i+=iG(t[r],t[r+1]);return i}function QEe(t,e){if(e<=0)return t[0];const i=t.length;let r=0;for(let s=0;s<i-1;++s){const n=iG(t[s],t[s+1]);if(e-r<n){const o=(e-r)/n;return XEe(t[s],t[s+1],o)}r+=n}return t[i-1]}function VR(t,e=ys.X,i=ys.Y){let r=0;const s=t.length;let n=t[0];for(let o=1;o<s;o++){const a=t[o];r+=(a[e]-n[e])*(a[i]+n[i]),n=a}if(!KEe(t)){const o=t[0];r+=(o[e]-n[e])*(o[i]+n[i])}return r>=0}function KEe(t){const e=t.length;return e<3||db(t[0],t[e-1])}function cXe(t){if(!("rings"in t))return!1;let e=!1;for(const i of t.rings)KEe(i)||(i.push(i[0].slice()),e=!0);return e}function Uqt(t){return t.type!=="polygon"&&t.type!=="polyline"||uXe(t.type==="polygon"?t.rings:t.paths,t.spatialReference),t}function uXe(t,e){const i=Fg(e);if(!i)return;const r=i.valid[0],s=i.valid[1],n=s-r;for(const o of t){let a=1/0,l=-1/0;for(const u of o){const d=hXe(u[0],r,s);a=Math.min(a,d),l=Math.max(l,d),u[0]=d}const c=l-a;n-c<c&&o.forEach(u=>{u[0]<0&&(u[0]+=n)})}}function hXe(t,e,i){const r=i-e;return t<e?i-(e-t)%r:t>i?e+(t-e)%r:t}function Vqt(t,e){if(t===e)return!0;if(t.type!==e.type)return!1;if(t.type==="point"||t.type==="mesh"||t.type==="extent")return!0;if(t.type==="multipoint")return t.points.length===e.points.length;const[i,r]=t.type==="polyline"?[t.paths,e.paths]:[t.rings,e.rings];return i.length===r.length&&i.every((s,n)=>s.length===r[n].length)}function zqt(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function eCe(t){return t?tCe(t.rings,t.hasZ??!1):null}function tCe(t,e){if(!(t!=null&&t.length))return null;const i=[],r=[],s=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=t.length;n<o;n++){const a=iCe(t[n],e,s);a&&r.push(a)}if(r.sort((n,o)=>{let a=n[2]-o[2];return a===0&&e&&(a=n[4]-o[4]),a}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],e&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||e&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const n=t[0]&&t[0].length?pXe(t[0],e):null;if(!n)return null;i[0]=n[0],i[1]=n[1],e&&n.length>2&&(i[2]=n[2])}return i}function iCe(t,e,i){let r=0,s=0,n=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,u=t.length&&e?t[0][2]:0;for(let f=0;f<t.length;f++){const m=t[f],g=t[(f+1)%t.length],[y,v,b]=m,w=y-l,x=v-c,[S,C,M]=g,O=S-l,D=C-c,U=w*D-O*x;if(o+=U,r+=(w+O)*U,s+=(x+D)*U,e&&m.length>2&&g.length>2){const k=b-u,H=M-u,V=w*H-O*k;n+=(k+H)*V,a+=V}y<i[0]&&(i[0]=y),y>i[1]&&(i[1]=y),v<i[2]&&(i[2]=v),v>i[3]&&(i[3]=v),e&&(b<i[4]&&(i[4]=b),b>i[5]&&(i[5]=b))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const d=[r/(6*o)+l,s/(6*o)+c,o];return e&&(i[4]===i[5]||a===0?(d[3]=(i[4]+i[5])/2,d[4]=0):(d[3]=n/(6*a)+u,d[4]=a)),d}function dXe(t,e){let i=0,r=0,s=0;t.nextPoint();const n=t.pathSize?t.x:0,o=t.pathSize?t.y:0;for(let a=0;a<t.pathSize;a++){t.seekInPath(a);const l=[t.x,t.y];t.seekInPath((a+1)%t.pathSize);const c=[t.x,t.y],[u,d]=l,f=u-n,m=d-o,[g,y]=c,v=g-n,b=y-o,w=f*b-v*m;s+=w,i+=(f+v)*w,r+=(m+b)*w,u<e[0]&&(e[0]=u),u>e[1]&&(e[1]=u),d<e[2]&&(e[2]=d),d>e[3]&&(e[3]=d)}return s>0&&(s*=-1),s?(s*=.5,[i/(6*s)+n,r/(6*s)+o,s]):null}function pXe(t,e){const i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const u=t[l],d=t[l+1];if(u&&d){i[0]=u[0],i[1]=u[1],r[0]=d[0],r[1]=d[1],e&&u.length>2&&d.length>2&&(i[2]=u[2],r[2]=d[2]);const f=iG(i,r);if(f){s+=f;const m=JEe(u,d);n+=f*m[0],o+=f*m[1],e&&m.length>2&&(a+=f*m[2])}}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.length?t[0]:null}function fXe(t){const{hasZ:e,totalSize:i}=t;if(i===0)return null;const r=[],s=[],n=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=iCe(J1(t),t.hasZ,n);o&&s.push(o)}if(s.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),s.length&&(r[0]=s[0][0],r[1]=s[0][1],e&&(r[2]=s[0][3]),(r[0]<n[0]||r[0]>n[1]||r[1]<n[2]||r[1]>n[3]||e&&(r[2]<n[4]||r[2]>n[5]))&&(r.length=0)),!r.length){t.reset(),t.nextPath();const o=t.pathSize?mXe(t):null;if(!o)return null;r[0]=o[0],r[1]=o[1],e&&o.length>2&&(r[2]=o[2])}return r}function mXe(t){const{hasZ:e}=t,i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,u=t.z;for(;t.nextPoint();){const d=t.x,f=t.y,m=t.z;i[0]=l,i[1]=c,r[0]=d,r[1]=f,e&&(i[2]=u,r[2]=m);const g=iG(i,r);if(g){s+=g;const y=JEe(i,r);n+=g*y[0],o+=g*y[1],e&&y.length>2&&(a+=g*y[2])}l=d,c=f,u=m}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.pathSize?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const gXe=1e-6;function yXe(t){let e=0;for(t.reset();t.nextPath();)e+=t.getCurrentRingArea();if(e<gXe){const s=fXe(t);return s?[s[0],s[1]]:null}const i=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const r=[t.x,t.y];for(t.reset();t.nextPath();)vXe(i,r,t);return i[0]*=1/e,i[1]*=1/e,i[0]+=r[0],i[1]+=r[1],i}const _Xe=1/3;function vXe(t,e,i){if(!t||!i||i.pathSize<3)return null;i.nextPoint();const r=i.x,s=i.y;i.nextPoint();let n,o=i.x-r,a=i.y-s,l=0,c=0;for(;i.nextPoint();)l=i.x-r,c=i.y-s,n=.5*_Xe*(l*a-c*o),t[0]+=n*(o+l),t[1]+=n*(a+c),o=l,a=c;const u=i.getCurrentRingArea(),d=[r,s];return d[0]-=e[0],d[1]-=e[1],d[0]*=u,d[1]*=u,t[0]+=d[0],t[1]+=d[1],t}function oi(t=TXe){return[t[0],t[1],t[2],t[3]]}function Bqt(t){return[t[0],t[1],t[2],t[3]]}function l_(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function rG(t,e,i,r,s=oi()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function rCe(t,e=oi()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function sG(t,e){return new ur({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function gre(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function Q1(t,e,i){if(e!=null)if("length"in e)EZ(e)?(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[2]),i[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[0]),i[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":i[0]=Math.min(t[0],e.xmin),i[1]=Math.min(t[1],e.ymin),i[2]=Math.max(t[2],e.xmax),i[3]=Math.max(t[3],e.ymax);break;case"point":i[0]=Math.min(t[0],e.x),i[1]=Math.min(t[1],e.y),i[2]=Math.max(t[2],e.x),i[3]=Math.max(t[3],e.y)}else l_(i,t)}function qH(t,e,i=t){const r=e.length;let s=t[0],n=t[1],o=t[2],a=t[3];for(let l=0;l<r;l++){const c=e[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return i[0]=s,i[1]=n,i[2]=o,i[3]=a,i}function TZ(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function nl(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function Lc(t){return t==null||t[1]>=t[3]?0:t[3]-t[1]}function jqt(t){return nl(t)*Lc(t)}function gz(t){return nl(t)>0&&Lc(t)>0}function yre(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function sCe(t,e){return nG(t,e[0],e[1])}function she(t,e){const i=e[3],r=.5*(t[0]+t[2]),s=Math.abs(e[0]-r),n=.5*(t[2]-t[0]);if(s>i+n)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>i+a)return!1;if(s<n||l<a)return!0;const c=s-n,u=l-a;return c*c+u*u<=i*i}function Gqt(t,e,i){const r=t[0],s=t[1],n=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:u}=i,d=(v,b)=>(u-l)*v+(a-c)*b+(c*l-a*u)<0,f=d(r,o),m=d(n,o),g=d(n,s),y=d(r,s);return!(f===m&&m===g&&g===y&&y===f||a<r&&c<r||a>n&&c>n||l>o&&u>o||l<s&&u<s)}function Hqt(t,e){return nG(t,e.x,e.y)}function nG(t,e,i){return e>=t[0]&&i>=t[1]&&e<=t[2]&&i<=t[3]}function bXe(t,e,i){return e[0]>=t[0]-i&&e[1]>=t[1]-i&&e[0]<=t[2]+i&&e[1]<=t[3]+i}function oG(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function nhe(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function SZ(t,e,i){if(e==null)return l_(i,t);const r=e[0],s=e[1],n=e[2],o=e[3];return i[0]=Ne(t[0],r,n),i[1]=Ne(t[1],s,o),i[2]=Ne(t[2],r,n),i[3]=Ne(t[3],s,o),i}function wXe(t,e){const i=(t[0]+t[2])/2,r=(t[1]+t[3])/2,s=Math.max(Math.abs(e[0]-i)-nl(t)/2,0),n=Math.max(Math.abs(e[1]-r)-Lc(t)/2,0);return Math.sqrt(s*s+n*n)}function yz(t,e,i,r=t){return r[0]=t[0]+e,r[1]=t[1]+i,r[2]=t[2]+e,r[3]=t[3]+i,r}function zh(t){return t?l_(t,CZ):oi(CZ)}function EZ(t){return t!=null&&t.length===4}function xXe(t){return!(nl(t)!==0&&isFinite(t[0])||Lc(t)!==0&&isFinite(t[1]))}function rS(t,e){return EZ(t)&&EZ(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const qqt=[-1/0,-1/0,1/0,1/0],CZ=[1/0,1/0,-1/0,-1/0],TXe=[0,0,0,0];function nCe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function oCe(t){return t.points!==void 0}function aCe(t){return t.x!==void 0&&t.y!==void 0}function lCe(t){return t.paths!==void 0}function cCe(t){return t.rings!==void 0}function uCe(t){function e(i,r){return i==null?r:r==null?i:t(i,r)}return e}const k1=uCe(Math.min),U1=uCe(Math.max);function SXe(t,e){return lCe(e)?zA(t,e.paths,!1,!1):cCe(e)?zA(t,e.rings,!1,!1):oCe(e)?_re(t,e.points,!1,!1,!1,!1):nCe(e)?dCe(t,e):(aCe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function aG(t){let e,i,r,s;for(t.reset(),e=r=1/0,i=s=-1/0;t.nextPath();){const n=hCe(t);e=Math.min(n[0],e),r=Math.min(n[1],r),i=Math.max(n[2],i),s=Math.max(n[3],s)}return oi([e,r,i,s])}function hCe(t){let e,i,r,s;for(e=r=1/0,i=s=-1/0;t.nextPoint();)e=Math.min(t.x,e),r=Math.min(t.y,r),i=Math.max(t.x,i),s=Math.max(t.y,s);return oi([e,r,i,s])}function Wqt(t,e){return lCe(e)?zA(t,e.paths,!0,!1):cCe(e)?zA(t,e.rings,!0,!1):oCe(e)?_re(t,e.points,!0,!1,!0,!1):nCe(e)?dCe(t,e,!0,!1,!0,!1):(aCe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function zA(t,e,i,r){const s=i?3:2;if(!e.length||!e[0].length)return null;let n,o,a,l,[c,u]=e[0][0],[d,f]=e[0][0];for(let m=0;m<e.length;m++){const g=e[m];for(let y=0;y<g.length;y++){const v=g[y],[b,w]=v;if(c=k1(c,b),u=k1(u,w),d=U1(d,b),f=U1(f,w),i&&v.length>2){const x=v[2];n=k1(n,x),o=U1(o,x)}if(r&&v.length>s){const x=v[s];a=k1(n,x),l=U1(o,x)}}}return i?r?(t[0]=c,t[1]=u,t[2]=n,t[3]=a,t[4]=d,t[5]=f,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=u,t[2]=n,t[3]=d,t[4]=f,t[5]=o,t.length=6,t):r?(t[0]=c,t[1]=u,t[2]=a,t[3]=d,t[4]=f,t[5]=l,t.length=6,t):(t[0]=c,t[1]=u,t[2]=d,t[3]=f,t.length=4,t)}function dCe(t,e,i,r,s,n){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let u=e.zmin,d=e.zmax,f=e.mmin,m=e.mmax;return s?(u=u||0,d=d||0,n?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=u,t[3]=f,t[4]=a,t[5]=c,t[6]=d,t[7]=m,t):(t[0]=o,t[1]=l,t[2]=u,t[3]=a,t[4]=c,t[5]=d,t)):n?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=f,t[3]=a,t[4]=c,t[5]=m,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function _re(t,e,i,r,s,n){const o=i?3:2,a=r&&n,l=i&&s;if(!e.length||!e[0].length)return null;let c,u,d,f,[m,g]=e[0],[y,v]=e[0];for(let b=0;b<e.length;b++){const w=e[b],[x,S]=w;if(m=k1(m,x),g=k1(g,S),y=U1(y,x),v=U1(v,S),l&&w.length>2){const C=w[2];c=k1(c,C),u=U1(u,C)}if(a&&w.length>o){const C=w[o];d=k1(c,C),f=U1(u,C)}}return s?(c=c||0,u=u||0,n?(d=d||0,f=f||0,t[0]=m,t[1]=g,t[2]=c,t[3]=d,t[4]=y,t[5]=v,t[6]=u,t[7]=f,t):(t[0]=m,t[1]=g,t[2]=c,t[3]=y,t[4]=v,t[5]=u,t)):n?(d=d||0,f=f||0,t[0]=m,t[1]=g,t[2]=d,t[3]=y,t[4]=v,t[5]=f,t):(t[0]=m,t[1]=g,t[2]=y,t[3]=v,t)}function EXe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function CXe(t){return t.points!==void 0}function MXe(t){return t.x!==void 0&&t.y!==void 0}function AXe(t){return t.paths!==void 0}function PXe(t){return t.rings!==void 0}const vre=[];function pCe(t,e,i,r){return{xmin:t,ymin:e,xmax:i,ymax:r}}function fCe(t,e,i,r,s,n){return{xmin:t,ymin:e,zmin:i,xmax:r,ymax:s,zmax:n}}function mCe(t,e,i,r,s,n){return{xmin:t,ymin:e,mmin:i,xmax:r,ymax:s,mmax:n}}function gCe(t,e,i,r,s,n,o,a){return{xmin:t,ymin:e,zmin:i,mmin:r,xmax:s,ymax:n,zmax:o,mmax:a}}function bre(t,e=!1,i=!1){return e?i?gCe(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):fCe(t[0],t[1],t[2],t[3],t[4],t[5]):i?mCe(t[0],t[1],t[2],t[3],t[4],t[5]):pCe(t[0],t[1],t[2],t[3])}function Zqt(t){return t?EXe(t)?t:MXe(t)?RXe(t):PXe(t)?yCe(t):AXe(t)?_Ce(t):CXe(t)?OXe(t):null:null}function OXe(t){const{hasZ:e,hasM:i,points:r}=t;return bre(_re(vre,r,e??!1,i??!1),e,i)}function RXe(t){const{x:e,y:i,z:r,m:s}=t,n=s!=null;return r!=null?n?gCe(e,i,r,s,e,i,r,s):fCe(e,i,r,e,i,r):n?mCe(e,i,s,e,i,s):pCe(e,i,e,i)}function yCe(t){const{hasZ:e,hasM:i,rings:r}=t,s=zA(vre,r,e??!1,i??!1);return s?bre(s,e,i):null}function _Ce(t){const{hasZ:e,hasM:i,paths:r}=t,s=zA(vre,r,e??!1,i??!1);return s?bre(s,e,i):null}var dk;function ohe(t){return!Array.isArray(t[0])}let Im=dk=class extends Gb{static fromExtent(t){const e=t.clone().normalize(),i=t.spatialReference;let r=!1,s=!1;for(const o of e)o.hasZ&&(r=!0),o.hasM&&(s=!0);const n={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(r&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:i};return r&&(n.hasZ=!0),s&&(n.hasM=!0),new dk(n)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){var o,a;let i,r,s=null,n=null;return t&&!Array.isArray(t)?(s=t.rings??null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),i=t.hasZ,r=t.hasM):s=t,s=s||[],e=e||Ze.WGS84,s.length&&((o=s[0])==null?void 0:o[0])!=null&&typeof s[0][0]=="number"&&(s=[s]),n=(a=s[0])==null?void 0:a[0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=n.length>3):i===void 0?i=r?n.length>3:n.length>2:r===void 0&&(r=i?n.length>3:n.length>2)),{rings:s,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=eCe(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new bt;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=yCe(this);if(!e)return null;const i=new ur(e);return i.spatialReference=t,i}get isSelfIntersecting(){return aZe(this.rings)}writeRings(t,e){e.rings=ie(this.rings)}addRing(t){if(!t)return;const e=this.rings,i=e.length;if(ohe(t)){const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new dk;return t.spatialReference=this.spatialReference,t.rings=ie(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;if(e!=null!=(i!=null)||e!=null&&i!=null&&!e.equals(i)||this.rings.length!==t.rings.length)return!1;const r=([s,n,o,a],[l,c,u,d])=>s===l&&n===c&&(o==null&&u==null||o===u)&&(a==null&&d==null||a===d);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=t.rings[s];if(!db(n,o,r))return!1}return!0}contains(t){if(!t)return!1;const e=mD(t,this.spatialReference);return JWe(this,e??t)}isClockwise(t){const e=ohe(t)?t.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):t;return VR(e)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.rings[t][e],r=this.hasZ,s=this.hasM;return r&&!s?new bt(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new bt(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new bt(i[0],i[1],i[2],i[3],this.spatialReference):new bt(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(VA(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t].splice(e,0,i),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new bt(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],i=this.spatialReference,r=e.map(s=>new bt(s,i));return this.notifyChange("rings"),r}setPoint(t,e,i){return this._validateInputs(t,e)?(VA(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t][e]=i,this.notifyChange("rings"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const r=this.rings[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};h([p({readOnly:!0})],Im.prototype,"cache",null),h([p({readOnly:!0})],Im.prototype,"centroid",null),h([p({readOnly:!0})],Im.prototype,"extent",null),h([p({readOnly:!0})],Im.prototype,"isSelfIntersecting",null),h([p({type:[[[Number]]],json:{write:{isRequired:!0}}})],Im.prototype,"rings",void 0),h([We("rings")],Im.prototype,"writeRings",null),Im=dk=h([I("esri.geometry.Polygon")],Im),Im.prototype.toJSON.isDefaultToJSON=!0;const Wf=Im;var MZ;function $Xe(t){return!Array.isArray(t[0])}let Pv=MZ=class extends Gb{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){var o,a;let i,r,s=null,n=null;return t&&!Array.isArray(t)?(s=t.paths??null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),i=t.hasZ,r=t.hasM):s=t,s=s||[],e=e||Ze.WGS84,s.length&&((o=s[0])==null?void 0:o[0])!=null&&typeof s[0][0]=="number"&&(s=[s]),n=(a=s[0])==null?void 0:a[0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=!1):i===void 0?i=!r&&n.length>3:r===void 0&&(r=!i&&n.length>3)),{paths:s,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=_Ce(this);if(!e)return null;const i=new ur(e);return i.spatialReference=t,i}writePaths(t,e){e.paths=ie(this.paths)}addPath(t){if(!t)return;const e=this.paths,i=e.length;if($Xe(t)){const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new MZ;return t.spatialReference=this.spatialReference,t.paths=ie(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.paths[t][e],r=this.hasZ,s=this.hasM;return r&&!s?new bt(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new bt(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new bt(i[0],i[1],i[2],i[3],this.spatialReference):new bt(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(VA(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t].splice(e,0,i),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],i=this.spatialReference,r=e.map(s=>new bt(s,i));return this.notifyChange("paths"),r}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new bt(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(t,e,i){return this._validateInputs(t,e)?(VA(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t][e]=i,this.notifyChange("paths"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const r=this.paths[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};h([p({readOnly:!0})],Pv.prototype,"cache",null),h([p({readOnly:!0})],Pv.prototype,"extent",null),h([p({type:[[[Number]]],json:{write:{isRequired:!0}}})],Pv.prototype,"paths",void 0),h([We("paths")],Pv.prototype,"writePaths",null),Pv=MZ=h([I("esri.geometry.Polyline")],Pv),Pv.prototype.toJSON.isDefaultToJSON=!0;const Ef=Pv,vCe=Kl()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),ahe=Kl()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function _f(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function sS(t){return t.points!==void 0}function BA(t){return t.x!==void 0&&t.y!==void 0}function vf(t){return t.paths!==void 0}function ol(t){return t.rings!==void 0}function ty(t){return t==null?null:t instanceof Gb?t:BA(t)?bt.fromJSON(t):vf(t)?Ef.fromJSON(t):ol(t)?Wf.fromJSON(t):sS(t)?jP.fromJSON(t):_f(t)?ur.fromJSON(t):null}function GP(t){return t?BA(t)?"esriGeometryPoint":vf(t)?"esriGeometryPolyline":ol(t)?"esriGeometryPolygon":_f(t)?"esriGeometryEnvelope":sS(t)?"esriGeometryMultipoint":null:null}const IXe={esriGeometryPoint:bt,esriGeometryPolyline:Ef,esriGeometryPolygon:Wf,esriGeometryEnvelope:ur,esriGeometryMultipoint:jP};function LXe(t){return t&&IXe[t]||null}const y2={base:Gb,key:"type",typeMap:{extent:ur,multipoint:jP,point:bt,polyline:Ef,polygon:Wf}};Gf(y2);const lhe={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8};function WH(t,e,i,r=Kd){const s=new kh(wie(r)),n=yi.fromJSDate(t,{zone:s}),o=i==="decades"||i==="centuries"?"year":wCe(i);return i==="decades"&&(e*=10),i==="centuries"&&(e*=100),n.plus({[o]:e}).toJSDate()}function Yqt(t,e,i="milliseconds"){const r=t.getTime(),s=bCe(e,i,"milliseconds");return new Date(r+s)}function che(t,e,i=Kd){const r=new kh(wie(i)),s=yi.fromJSDate(t,{zone:r});if(e==="decades"||e==="centuries"){const o=s.startOf("year"),{year:a}=o,l=a-a%(e==="decades"?10:100);return o.set({year:l}).toJSDate()}const n=wCe(e);return s.startOf(n).toJSDate()}function bCe(t,e,i){return t===0?0:t*lhe[e]/lhe[i]}function Xqt(t,e){return t&&e?t.intersection(e):t||e}function wCe(t){switch(t){case"milliseconds":return"millisecond";case"seconds":return"second";case"minutes":return"minute";case"hours":return"hour";case"days":return"day";case"weeks":return"week";case"months":return"month";case"years":return"year"}}var ld;let uh=ld=class extends Se{static get allTime(){return uhe}static get empty(){return DXe}static fromArray(t){return new ld({start:t[0]!=null?new Date(t[0]):t[0],end:t[1]!=null?new Date(t[1]):t[1]})}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=(t==null?void 0:t.getTime())??null}get isAllTime(){return this.equals(ld.allTime)}get isEmpty(){return this.equals(ld.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=(t==null?void 0:t.getTime())??null}clone(){return new ld({end:this.end,start:this.start})}equals(t){var n,o,a,l;if(!t)return!1;const e=((n=this.start)==null?void 0:n.getTime())??this.start,i=((o=this.end)==null?void 0:o.getTime())??this.end,r=((a=t.start)==null?void 0:a.getTime())??t.start,s=((l=t.end)==null?void 0:l.getTime())??t.end;return e===r&&i===s}expandTo(t,e=Kd){if(this.isEmpty||this.isAllTime)return this.clone();let i=this.start;i&&(i=che(i,t,e));let r=this.end;if(r){const s=che(r,t,e);r=r.getTime()===s.getTime()?s:WH(s,1,t,e)}return new ld({start:i,end:r})}intersection(t){var a,l,c,u;if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return ld.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=((a=this.start)==null?void 0:a.getTime())??-1/0,i=((l=this.end)==null?void 0:l.getTime())??1/0,r=((c=t.start)==null?void 0:c.getTime())??-1/0,s=((u=t.end)==null?void 0:u.getTime())??1/0;let n,o;return r>=e&&r<=i?n=r:e>=r&&e<=s&&(n=e),i>=r&&i<=s?o=i:s>=e&&s<=i&&(o=s),n==null||o==null||isNaN(n)||isNaN(o)?ld.empty:new ld({start:n===-1/0?null:new Date(n),end:o===1/0?null:new Date(o)})}offset(t,e,i=Kd){if(this.isEmpty||this.isAllTime)return this.clone();const r=new ld,{start:s,end:n}=this;return s!=null&&(r.start=WH(s,t,e,i)),n!=null&&(r.end=WH(n,t,e,i)),r}toArray(){var t,e;return this.isEmpty?[void 0,void 0]:[((t=this.start)==null?void 0:t.getTime())??null,((e=this.end)==null?void 0:e.getTime())??null]}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return uhe.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,i=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new ld({start:e,end:i})}};h([p({type:Date,json:{write:{allowNull:!0}}})],uh.prototype,"end",void 0),h([ze("end")],uh.prototype,"readEnd",null),h([We("end")],uh.prototype,"writeEnd",null),h([p({readOnly:!0,json:{read:!1}})],uh.prototype,"isAllTime",null),h([p({readOnly:!0,json:{read:!1}})],uh.prototype,"isEmpty",null),h([p({type:Date,json:{write:{allowNull:!0}}})],uh.prototype,"start",void 0),h([ze("start")],uh.prototype,"readStart",null),h([We("start")],uh.prototype,"writeStart",null),uh=ld=h([I("esri.TimeExtent")],uh);const uhe=new uh,DXe=new uh({start:void 0,end:void 0}),$a=uh;let xCe=0;const bD=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+xCe++})}};return e=h([I("esri.core.Identifiable")],e),e},Jqt=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:xCe++})}};return e=h([I("esri.core.Identifiable.NumericIdentifiable")],e),e};let hhe=class extends bD(class{}){};hhe=h([I("esri.core.Identifiable")],hhe);async function NXe(t){var r;const e="portalItem"in t?t:{portalItem:t},{fromItem:i}=await ce(async()=>{const{fromItem:s}=await import("./portalLayers-B-nhgqp-.js").then(n=>n.p);return{fromItem:s}},__vite__mapDeps([7,8,9]));try{return await i(e)}catch(s){const n=e==null?void 0:e.portalItem,o=(n==null?void 0:n.id)||"unset",a=((r=n==null?void 0:n.portal)==null?void 0:r.url)||rr.portalUrl;throw se.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+a+"', id: '"+o+"')",s),s}}let FXe=0,Kn=class extends Us.EventedMixin(bD(ey)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new ur(-180,-90,180,90,Ze.WGS84),this.id=Date.now().toString(16)+"-layer-"+FXe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.persistenceEnabled=!1,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Ze.WGS84,this.title=null,this.type=null,this.url=null,this.visibilityTimeExtent=null,this.visible=!0}static async fromArcGISServerUrl(e){const i=typeof e=="string"?{url:e}:e;return(await ce(async()=>{const{fromUrl:r}=await import("./arcgisLayers-DqPtCNBY.js");return{fromUrl:r}},__vite__mapDeps([10,8,9]))).fromUrl(i)}static fromPortalItem(e){return NXe(e)}initialize(){this.when().catch(e=>{os(e)||se.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){const e=this.parent;if(e){const i=this;"layers"in e&&e.layers.includes(i)?e.layers.remove(i):"tables"in e&&e.tables.includes(i)?e.tables.remove(i):"baseLayers"in e&&e.baseLayers.includes(i)?e.baseLayers.remove(i):"referenceLayers"in e&&e.referenceLayers.includes(i)&&e.referenceLayers.remove(i),this._set("parent",null)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return un(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await yr(e,{query:{f:"json"},responseType:"json"})).data;throw new G("layer:no-attribution-data","Layer does not have attribution data")}};h([p({type:String})],Kn.prototype,"attributionDataUrl",void 0),h([p({type:ur})],Kn.prototype,"fullExtent",void 0),h([p({readOnly:!0})],Kn.prototype,"hasAttributionData",null),h([p({type:String,clonable:!1})],Kn.prototype,"id",void 0),h([p({type:Boolean,nonNullable:!0})],Kn.prototype,"legendEnabled",void 0),h([p({type:["show","hide","hide-children"]})],Kn.prototype,"listMode",void 0),h([p({type:Number,range:{min:0,max:1},nonNullable:!0})],Kn.prototype,"opacity",void 0),h([p({clonable:!1})],Kn.prototype,"parent",void 0),h([p({readOnly:!0})],Kn.prototype,"parsedUrl",null),h([p({type:Boolean,readOnly:!0})],Kn.prototype,"persistenceEnabled",void 0),h([p({type:Boolean})],Kn.prototype,"popupEnabled",void 0),h([p({type:Boolean})],Kn.prototype,"attributionVisible",void 0),h([p({type:Ze})],Kn.prototype,"spatialReference",void 0),h([p({type:String})],Kn.prototype,"title",void 0),h([p({readOnly:!0,json:{read:!1}})],Kn.prototype,"type",void 0),h([p()],Kn.prototype,"url",void 0),h([p({type:$a})],Kn.prototype,"visibilityTimeExtent",void 0),h([p({type:Boolean,nonNullable:!0})],Kn.prototype,"visible",void 0),Kn=h([I("esri.layers.Layer")],Kn);const lL=Kn;function AZ(t,e,i){let r,s;if(t)for(let n=0,o=t.length;n<o;n++){if(r=t.at(n),(r==null?void 0:r[e])===i)return r;if((r==null?void 0:r.type)==="group"&&(s=AZ(r.layers,e,i),s))return s}}const kXe=t=>{let e=class extends t{constructor(...i){super(...i),this.layers=new st;const r=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||se.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>{if(o.item===this)return o.preventDefault(),void se.getLogger(this).error("#add()","Cannot add layer to itself.");r(o.item)}),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))])}destroy(){const i=this.layers.toArray();for(const r of i)r.destroy();this.layers.destroy()}set layers(i){this._set("layers",Kg(i,this._get("layers")))}add(i,r){const s=this.layers;if(r=s.getNextIndex(r),i instanceof lL){const n=i;n.parent===this?this.reorder(n,r):s.add(n,r)}else Fu(i)?i.then(n=>{this.destroyed||this.add(n,r)}):se.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const s=this.layers;let n=s.getNextIndex(r);i.slice().forEach(o=>{o.parent!==this?(s.add(o,n),n+=1):this.reorder(o,n)})}findLayerById(i){return AZ(this.layers,"id",i)}findLayerByUid(i){return AZ(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return h([p()],e.prototype,"layers",null),e=h([I("esri.support.LayersMixin")],e),e};function PZ(t,e,i){if(t)for(let r=0,s=t.length;r<s;r++){const n=t.at(r);if(n[e]===i)return n;if((n==null?void 0:n.type)==="group"){const o=PZ(n.tables,e,i);if(o)return o}}}const UXe=t=>{let e=class extends t{constructor(...i){super(...i),this.tables=new st,this.addHandles([this.tables.on("after-add",r=>{const s=r.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&se.getLogger(this).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})])}destroy(){const i=this.tables.toArray();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",Kg(i,this._get("tables")))}findTableById(i){return PZ(this.tables,"id",i)}findTableByUid(i){return PZ(this.tables,"uid",i)}};return h([p()],e.prototype,"tables",null),e=h([I("esri.support.TablesMixin")],e),e};let Rp=class extends UXe(kXe(Us.EventedMixin(Ue))){constructor(e){super(e),this.allLayers=new oL({getCollections:()=>{var i,r,s;return[(i=this.basemap)==null?void 0:i.baseLayers,(r=this.ground)==null?void 0:r.layers,this.layers,(s=this.basemap)==null?void 0:s.referenceLayers]},getChildrenFunction:i=>"layers"in i?i.layers:null}),this.allTables=sXe(this),this.basemap=null,this.editableLayers=new oL({getCollections:()=>[this.allLayers],itemFilterFunction:gYe}),this.ground=new nL,this._basemapCache=JYe()}destroy(){QYe(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=qe(this.basemap),qe(this.ground),this._set("ground",null)}castBasemap(e){return fre(e,this._basemapCache)}castGround(e){return nXe(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(i=>i.id===e)}findTableById(e){return this.allTables.find(i=>i.id===e)}};h([p({readOnly:!0,dependsOn:[]})],Rp.prototype,"allLayers",void 0),h([p({readOnly:!0})],Rp.prototype,"allTables",void 0),h([p({type:HM,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Rp.prototype,"basemap",void 0),h([Kt("basemap")],Rp.prototype,"castBasemap",null),h([p({readOnly:!0})],Rp.prototype,"editableLayers",void 0),h([p({type:nL,nonNullable:!0})],Rp.prototype,"ground",void 0),h([Kt("ground")],Rp.prototype,"castGround",null),h([p()],Rp.prototype,"undoRedo",void 0),Rp=h([I("esri.Map")],Rp);const TCe=Rp,Jr=t=>{let e=class extends t{clone(){var l;const i=hl(this);Fj(i,"unable to clone instance of non-accessor class");const r=i.metadata,s=i.store,n={},o=new Map;for(const c in r){const u=r[c],d=s==null?void 0:s.originOf(c),f=u.clonable;if(u.readOnly||f===!1||d!==Fi.USER&&d!==Fi.DEFAULTS&&d!==Fi.WEB_MAP&&d!==Fi.WEB_SCENE)continue;const m=this[c];let g=null;g=typeof f=="function"?f(m):f==="reference"?m:xW(m),m!=null&&g==null||(d===Fi.DEFAULTS?o.set(c,g):n[c]=g)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const c=(l=hl(a))==null?void 0:l.store;if(c)for(const[u,d]of o)c.set(u,d,Fi.DEFAULTS)}return a}};return e=h([I("esri.core.Clonable")],e),e};let zS=class extends Jr(Ue){};zS=h([I("esri.core.Clonable")],zS);let hx=class extends zS{constructor(e){super(e),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(e){return e!=null&&this.row===e.row&&this.rows===e.rows&&this.column===e.column&&this.columns===e.columns}};h([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],hx.prototype,"row",void 0),h([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],hx.prototype,"column",void 0),h([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],hx.prototype,"rows",void 0),h([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],hx.prototype,"columns",void 0),hx=h([I("esri.CameraLayout")],hx);const SCe=hx;let vb=class{constructor(e,i){this.min=e,this.max=i,this.range=i-e}normalize(e,i=0,r=!1){return dhe(this.range,this.min,this.max,e,i,r)}clamp(e,i=0){return Ne(e-i,this.min,this.max)+i}monotonic(e,i,r){return e<i?i:i+OZ(this.range,e-i,r)}minimalMonotonic(e,i,r){return dhe(this.range,e,e+this.range,i,r)}center(e,i,r){return i=this.monotonic(e,i,r),this.normalize((e+i)/2,r)}diff(e,i,r){return this.monotonic(e,i,r)-e}shortestSignedDiff(e,i){e=this.normalize(e);const r=(i=this.normalize(i))-e,s=i<e?this.minimalMonotonic(e,i)-e:i-this.minimalMonotonic(i,e);return Math.abs(r)<Math.abs(s)?r:s}contains(e,i,r){return i=this.minimalMonotonic(e,i),(r=this.minimalMonotonic(e,r))>e&&r<i}};function dhe(t,e,i,r,s=0,n=!1){return(r-=s)<e?r+=OZ(t,e-r):r>i&&(r-=OZ(t,r-i)),n&&r===i&&(r=e),r+s}function OZ(t,e,i=0){return Math.ceil((e-i)/t)*t+i}const VXe=new vb(0,2*Math.PI),bb=new vb(-Math.PI,Math.PI),lG=new vb(0,360);let Lm=class extends Jr(Se){constructor(...e){super(...e),this.position=new bt([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new SCe}normalizeCtorArgs(e,i,r,s){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const n={position:e};return i!=null&&(n.heading=i),r!=null&&(n.tilt=r),s!=null&&(n.fov=s),n}return e}writePosition(e,i,r,s){const n=e.clone();n.x=Id(e.x||0),n.y=Id(e.y||0),n.z=e.hasZ?Id(e.z||0):e.z,i[r]=n.write({},s)}readPosition(e,i){const r=new bt;return r.read(e,i),r.x=Id(r.x||0),r.y=Id(r.y||0),r.z=r.hasZ?Id(r.z||0):r.z,r}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)&&this.layout.equals(e.layout)}};h([p({type:bt,json:{write:{isRequired:!0}}})],Lm.prototype,"position",void 0),h([We("position")],Lm.prototype,"writePosition",null),h([ze("position")],Lm.prototype,"readPosition",null),h([p({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Kt(t=>lG.normalize(Id(t)))],Lm.prototype,"heading",void 0),h([p({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Kt(t=>Ne(Id(t),-180,180))],Lm.prototype,"tilt",void 0),h([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Lm.prototype,"fov",void 0),h([p({type:SCe,nonNullable:!0,json:{read:!1,write:!1}})],Lm.prototype,"layout",void 0),Lm=h([I("esri.Camera")],Lm);const Bh=Lm;var RZ;let Ov=RZ=class extends Se{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new RZ({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};h([p({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:ZH}}}}})],Ov.prototype,"rotation",void 0),h([Kt("rotation")],Ov.prototype,"castRotation",null),h([p({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:ZH}}}}})],Ov.prototype,"scale",void 0),h([p({types:y2,json:{read:ty,write:!0,origins:{"web-scene":{read:ty,write:{overridePolicy:ZH}}}}})],Ov.prototype,"targetGeometry",void 0),h([p({type:Bh,json:{write:!0}})],Ov.prototype,"camera",void 0),Ov=RZ=h([I("esri.Viewpoint")],Ov);const Zf=Ov;function ZH(){return{enabled:!this.camera}}let zXe=class ECe{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(NW),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const i=new ECe,r=this._originStores[Fi.DEFAULTS];r&&r.forEach((s,n)=>{i.set(n,ie(s),Fi.DEFAULTS)});for(let s=Fi.SERVICE;s<NW;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{e&&e.has(a)||i.set(a,ie(o),s)})}return i}get(e,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(e):void 0}keys(e){const i=e==null?this._values:this._originStores[e];return i?[...i.keys()]:[]}set(e,i,r=Fi.USER){let s=this._originStores[r];if(s||(s=new Map,this._originStores[r]=s),s.set(e,i),!this._values.has(e)||this._propertyOriginMap.get(e)<=r){const n=this._values.get(e);return this._values.set(e,i),this._propertyOriginMap.set(e,r),n!==i}return!1}delete(e,i=Fi.USER){const r=this._originStores[i];if(!r)return;const s=r.get(e);if(r.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===i){this._values.delete(e);for(let n=i-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,n);break}}}return s}has(e,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(e)}revert(e,i){for(;i>0&&!this.has(e,i);)--i;const r=this._originStores[i],s=r==null?void 0:r.get(e),n=this._values.get(e);return this._values.set(e,s),this._propertyOriginMap.set(e,i),n!==s}originOf(e){return this._propertyOriginMap.get(e)||Fi.DEFAULTS}forEach(e){this._values.forEach(e)}};const CCe=t=>{let e=class extends t{constructor(...i){super(...i);const r=hl(this),s=r.store,n=new zXe;r.store=n,n2e(r,s,n)}read(i,r){a2e(this,i,r)}getAtOrigin(i,r){const s=YH(this),n=F1(r);if(typeof i=="string")return s.get(i,n);const o={};return i.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(i){return UV(this.originIdOf(i))}originIdOf(i){return YH(this).originOf(i)}revert(i,r){const s=YH(this),n=F1(r),o=hl(this);let a;a=typeof i=="string"?i==="*"?s.keys(n):[i]:i,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return e=h([I("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function YH(t){return hl(t).store}let phe=class extends CCe(Ue){};phe=h([I("esri.core.ReadOnlyMultiOriginJSONSupport")],phe);const BXe=t=>{let e=class extends t{constructor(...i){super(...i)}clear(i,r="user"){return XH(this).delete(i,F1(r))}write(i,r){return u2e(this,i=i||{},r),i}setAtOrigin(i,r,s){hl(this).setAtOrigin(i,r,F1(s))}removeOrigin(i){const r=XH(this),s=F1(i),n=r.keys(s);for(const o of n)r.originOf(o)===s&&r.set(o,r.get(o,s),Fi.USER)}updateOrigin(i,r){const s=XH(this),n=F1(r),o=Df(this,i);for(let a=n+1;a<NW;++a)s.delete(i,a);s.set(i,o,n)}toJSON(i){return this.write({},i)}};return e=h([I("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function XH(t){return hl(t).store}const wre=t=>{let e=class extends BXe(CCe(t)){constructor(...i){super(...i)}};return e=h([I("esri.core.MultiOriginJSONSupport")],e),e};let $Z=class extends wre(Ue){};$Z=h([I("esri.core.MultiOriginJSONSupport")],$Z);function jXe(t){return t&&"getAtOrigin"in t&&"originOf"in t}function fhe(t){t!=null&&t.writtenProperties&&t.writtenProperties.forEach(({target:e,propName:i,newOrigin:r})=>{jXe(e)&&r&&e.originOf(i)!==r&&e.updateOrigin(i,r)})}var zR;const _z=Kl()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),MCe=_z.jsonValues.slice();q3(MCe,"orthometric");const ZI=Kl()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let $p=zR=class extends Se{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,i){return _z.write(t,e,i)}readHeightModel(t,e,i){return _z.read(t)||(i!=null&&i.messages&&i.messages.push(GXe(t,{context:i})),null)}readHeightUnit(t,e,i){return ZI.read(t)||(i!=null&&i.messages&&i.messages.push(mhe(t,{context:i})),null)}readHeightUnitService(t,e,i){return q2e(t)||ZI.read(t)||(i!=null&&i.messages&&i.messages.push(mhe(t,{context:i})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new zR({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const i=W2e(e);return new zR({heightModel:t.heightModel,heightUnit:i??void 0,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new zR;return e.read(t,{origin:"web-scene"}),e}};function mhe(t,e){return new Jg("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function GXe(t,e){return new Jg("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}h([p({type:_z.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:MCe,default:"ellipsoidal"}}}})],$p.prototype,"heightModel",void 0),h([We("web-scene","heightModel")],$p.prototype,"writeHeightModel",null),h([ze(["web-scene","service"],"heightModel")],$p.prototype,"readHeightModel",null),h([p({type:ZI.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:ZI.jsonValues,write:ZI.write}}}})],$p.prototype,"heightUnit",void 0),h([ze("web-scene","heightUnit")],$p.prototype,"readHeightUnit",null),h([ze("service","heightUnit")],$p.prototype,"readHeightUnitService",null),h([p({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],$p.prototype,"vertCRS",void 0),h([ze("service","vertCRS",["vertCRS","ellipsoid","geoid"])],$p.prototype,"readVertCRS",null),$p=zR=h([I("esri.geometry.HeightModelInfo")],$p);const qb=$p,a9t=Math.PI/180,l9t=/(?:SPHEROID|ELLIPSOID)\[([^\]]+)]/i,Y_=lr.radius,_p=lr.eccentricitySquared,HXe={a1:Y_*_p,a2:Y_*_p*Y_*_p,a3:Y_*_p*_p/2,a4:Y_*_p*Y_*_p*2.5,a5:Y_*_p+Y_*_p*_p/2,a6:1-_p},c9t={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:lr.radius,f:lr.flattening},4490:{a:6378137,f:1/298.257222101},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:n_.radius,f:n_.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:Nf.radius,f:Nf.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:Nf.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};var ue;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.SPHERICAL_MARS_PCPF=6]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=7]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=8]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=9]="GCSMOON2000",t[t.LON_LAT=10]="LON_LAT",t[t.PLATE_CARREE=11]="PLATE_CARREE"})(ue||(ue={}));const BR={[ue.WGS84]:{[ue.CGCS2000]:Is,[ue.GCSMARS2000]:null,[ue.GCSMOON2000]:null,[ue.LON_LAT]:Is,[ue.SPHERICAL_ECEF]:ZM,[ue.SPHERICAL_MARS_PCPF]:null,[ue.SPHERICAL_MOON_PCPF]:null,[ue.UNKNOWN]:null,[ue.WEB_MERCATOR]:nS,[ue.PLATE_CARREE]:oS,[ue.WGS84]:Is,[ue.WGS84_ECEF]:lS},[ue.CGCS2000]:{[ue.CGCS2000]:Is,[ue.GCSMARS2000]:null,[ue.GCSMOON2000]:null,[ue.LON_LAT]:Is,[ue.SPHERICAL_ECEF]:ZM,[ue.SPHERICAL_MARS_PCPF]:null,[ue.SPHERICAL_MOON_PCPF]:null,[ue.UNKNOWN]:null,[ue.WEB_MERCATOR]:nS,[ue.PLATE_CARREE]:oS,[ue.WGS84]:Is,[ue.WGS84_ECEF]:lS},[ue.GCSMARS2000]:{[ue.CGCS2000]:null,[ue.GCSMARS2000]:Is,[ue.GCSMOON2000]:null,[ue.LON_LAT]:Is,[ue.SPHERICAL_ECEF]:null,[ue.SPHERICAL_MARS_PCPF]:LZ,[ue.SPHERICAL_MOON_PCPF]:null,[ue.UNKNOWN]:null,[ue.WEB_MERCATOR]:null,[ue.PLATE_CARREE]:null,[ue.WGS84]:null,[ue.WGS84_ECEF]:null},[ue.GCSMOON2000]:{[ue.CGCS2000]:null,[ue.GCSMARS2000]:null,[ue.GCSMOON2000]:Is,[ue.LON_LAT]:Is,[ue.SPHERICAL_ECEF]:null,[ue.SPHERICAL_MARS_PCPF]:null,[ue.SPHERICAL_MOON_PCPF]:IZ,[ue.UNKNOWN]:null,[ue.WEB_MERCATOR]:null,[ue.PLATE_CARREE]:null,[ue.WGS84]:null,[ue.WGS84_ECEF]:null},[ue.WEB_MERCATOR]:{[ue.CGCS2000]:qM,[ue.GCSMARS2000]:null,[ue.GCSMOON2000]:null,[ue.LON_LAT]:qM,[ue.SPHERICAL_ECEF]:ACe,[ue.SPHERICAL_MARS_PCPF]:null,[ue.SPHERICAL_MOON_PCPF]:null,[ue.UNKNOWN]:null,[ue.WEB_MERCATOR]:Is,[ue.PLATE_CARREE]:OCe,[ue.WGS84]:qM,[ue.WGS84_ECEF]:PCe},[ue.WGS84_ECEF]:{[ue.CGCS2000]:cS,[ue.GCSMARS2000]:null,[ue.GCSMOON2000]:null,[ue.LON_LAT]:cS,[ue.SPHERICAL_ECEF]:ICe,[ue.SPHERICAL_MARS_PCPF]:null,[ue.SPHERICAL_MOON_PCPF]:null,[ue.UNKNOWN]:null,[ue.WEB_MERCATOR]:LCe,[ue.PLATE_CARREE]:qXe,[ue.WGS84]:cS,[ue.WGS84_ECEF]:Is},[ue.SPHERICAL_ECEF]:{[ue.CGCS2000]:aS,[ue.GCSMARS2000]:null,[ue.GCSMOON2000]:null,[ue.LON_LAT]:aS,[ue.SPHERICAL_ECEF]:Is,[ue.SPHERICAL_MARS_PCPF]:null,[ue.SPHERICAL_MOON_PCPF]:null,[ue.UNKNOWN]:null,[ue.WEB_MERCATOR]:RCe,[ue.PLATE_CARREE]:WXe,[ue.WGS84]:aS,[ue.WGS84_ECEF]:$Ce},[ue.SPHERICAL_MARS_PCPF]:{[ue.CGCS2000]:null,[ue.GCSMARS2000]:NZ,[ue.GCSMOON2000]:null,[ue.LON_LAT]:NZ,[ue.SPHERICAL_ECEF]:null,[ue.SPHERICAL_MARS_PCPF]:Is,[ue.SPHERICAL_MOON_PCPF]:null,[ue.UNKNOWN]:null,[ue.WEB_MERCATOR]:null,[ue.PLATE_CARREE]:null,[ue.WGS84]:null,[ue.WGS84_ECEF]:null},[ue.SPHERICAL_MOON_PCPF]:{[ue.CGCS2000]:null,[ue.GCSMARS2000]:null,[ue.GCSMOON2000]:DZ,[ue.LON_LAT]:DZ,[ue.SPHERICAL_ECEF]:null,[ue.SPHERICAL_MARS_PCPF]:null,[ue.SPHERICAL_MOON_PCPF]:Is,[ue.UNKNOWN]:null,[ue.WEB_MERCATOR]:null,[ue.PLATE_CARREE]:null,[ue.WGS84]:null,[ue.WGS84_ECEF]:null},[ue.UNKNOWN]:{[ue.CGCS2000]:null,[ue.GCSMARS2000]:null,[ue.GCSMOON2000]:null,[ue.LON_LAT]:null,[ue.SPHERICAL_ECEF]:null,[ue.SPHERICAL_MARS_PCPF]:null,[ue.SPHERICAL_MOON_PCPF]:null,[ue.UNKNOWN]:Is,[ue.WEB_MERCATOR]:null,[ue.PLATE_CARREE]:null,[ue.WGS84]:null,[ue.WGS84_ECEF]:null},[ue.LON_LAT]:{[ue.CGCS2000]:Is,[ue.GCSMARS2000]:Is,[ue.GCSMOON2000]:Is,[ue.LON_LAT]:Is,[ue.SPHERICAL_ECEF]:ZM,[ue.SPHERICAL_MARS_PCPF]:LZ,[ue.SPHERICAL_MOON_PCPF]:IZ,[ue.UNKNOWN]:null,[ue.WEB_MERCATOR]:nS,[ue.PLATE_CARREE]:oS,[ue.WGS84]:Is,[ue.WGS84_ECEF]:lS},[ue.PLATE_CARREE]:{[ue.CGCS2000]:WM,[ue.GCSMARS2000]:null,[ue.GCSMOON2000]:null,[ue.LON_LAT]:WM,[ue.SPHERICAL_ECEF]:ZXe,[ue.SPHERICAL_MARS_PCPF]:null,[ue.SPHERICAL_MOON_PCPF]:null,[ue.UNKNOWN]:null,[ue.WEB_MERCATOR]:YXe,[ue.PLATE_CARREE]:Is,[ue.WGS84]:WM,[ue.WGS84_ECEF]:XXe}};function wb(t,e,i=Ere()){return t==null||e==null?null:QXe(t,e,i).projector}function u9t(t,e){switch(wb(t,e,cG)){case Is:return"copy3";case ZM:return"wgs84ToSphericalECEF";case nS:return"wgs84ToWebMercator";case oS:return"wgs84ToPlateCarree";case lS:return"wgs84ToWGS84ECEF";case qM:return"webMercatorToWGS84";case ACe:return"webMercatorToSphericalECEF";case PCe:return"webMercatorToWGS84ECEF";case OCe:return"webMercatorToPlateCarree";case cS:return"wgs84ECEFToWGS84";case ICe:return"wgs84ECEFToSphericalECEF";case LCe:return"wgs84ECEFToWebMercator";case aS:return"sphericalECEFToWGS84";case RCe:return"sphericalECEFToWebMercator";case NZ:return"sphericalMarsPCPFToMars2000";case DZ:return"sphericalMoonPCPFToMoon2000";case $Ce:return"sphericalECEFToWGS84ECEF";case LZ:return"mars2000ToSphericalPCPF";case IZ:return"moon2000ToSphericalPCPF";default:return null}}function vz(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=ec(t,1)),Q3(t)?e.spatialReferenceId=ue.SPHERICAL_ECEF:o_(t)?e.spatialReferenceId=ue.WGS84:Hf(t)?e.spatialReferenceId=ue.WEB_MERCATOR:$S(t)?e.spatialReferenceId=ue.PLATE_CARREE:t.wkt===B2e.wkt?e.spatialReferenceId=ue.WGS84_ECEF:t.wkid===Su.CGCS2000?e.spatialReferenceId=ue.CGCS2000:t.wkt===Gj.wkt?e.spatialReferenceId=ue.SPHERICAL_MARS_PCPF:t.wkt===Hj.wkt?e.spatialReferenceId=ue.SPHERICAL_MOON_PCPF:f2(t)?e.spatialReferenceId=ue.GCSMARS2000:m2(t)?e.spatialReferenceId=ue.GCSMOON2000:e.spatialReferenceId=ue.UNKNOWN):ue.UNKNOWN}function Is(t,e,i,r){t!==i&&(i[r++]=t[e++],i[r++]=t[e++],i[r]=t[e])}function qM(t,e,i,r){i[r]=GA*(t[e]/uS),i[r+1]=GA*(DCe-2*Math.atan(Math.exp(-t[e+1]/uS))),i[r+2]=t[e+2]}function ACe(t,e,i,r){const s=t[e]/uS,n=DCe-2*Math.atan(Math.exp(-t[e+1]/uS)),o=uS+t[e+2],a=Math.cos(n)*o;i[r]=Math.cos(s)*a,i[r+1]=Math.sin(s)*a,i[r+2]=Math.sin(n)*o}function PCe(t,e,i,r){qM(t,e,i,r),lS(i,r,i,r)}function xre(t,e,i,r,s){const n=.4999999*uG,o=Ne(jA*t[e+1],-n,n),a=Math.sin(o);i[r++]=jA*t[e]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=t[e+2]}function nS(t,e,i,r){xre(t,e,i,r,lr)}function oS(t,e,i,r){i[r]=t[e]*ghe,i[r+1]=t[e+1]*ghe,i[r+2]=t[e+2]}function WM(t,e,i,r){i[r]=t[e]*yhe,i[r+1]=t[e+1]*yhe,i[r+2]=t[e+2]}function OCe(t,e,i,r){qM(t,e,i,r),oS(i,r,i,r)}function qXe(t,e,i,r){cS(t,e,i,r),oS(i,r,i,r)}function WXe(t,e,i,r){aS(t,e,i,r),oS(i,r,i,r)}function ZXe(t,e,i,r){WM(t,e,i,r),ZM(i,r,i,r)}function YXe(t,e,i,r){WM(t,e,i,r),nS(i,r,i,r)}function XXe(t,e,i,r){WM(t,e,i,r),lS(i,r,i,r)}function Tre(t,e,i,r,s){const n=s+t[e+2],o=jA*t[e+1],a=jA*t[e],l=Math.cos(o)*n;i[r]=Math.cos(a)*l,i[r+1]=Math.sin(a)*l,i[r+2]=Math.sin(o)*n}function IZ(t,e,i,r){Tre(t,e,i,r,n_.radius)}function LZ(t,e,i,r){Tre(t,e,i,r,Nf.radius)}function ZM(t,e,i,r){Tre(t,e,i,r,lr.radius)}function Sre(t,e,i,r,s){const n=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(n*n+o*o+a*a),c=qf(a/(l===0?1:l)),u=Math.atan2(o,n);i[r++]=GA*u,i[r++]=GA*c,i[r]=l-s}function DZ(t,e,i,r){Sre(t,e,i,r,n_.radius)}function NZ(t,e,i,r){Sre(t,e,i,r,Nf.radius)}function aS(t,e,i,r){Sre(t,e,i,r,lr.radius)}function RCe(t,e,i,r){aS(t,e,i,r),nS(i,r,i,r)}function $Ce(t,e,i,r){aS(t,e,i,r),lS(i,r,i,r)}function JXe(t,e,i,r,s){const n=jA*t[e],o=jA*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),u=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);i[r++]=(u+a)*c*Math.cos(n),i[r++]=(u+a)*c*Math.sin(n),i[r++]=(u*(1-s.eccentricitySquared)+a)*l}function lS(t,e,i,r){JXe(t,e,i,r,lr)}function cS(t,e,i,r){const s=HXe,n=t[e],o=t[e+1],a=t[e+2];let l,c,u,d,f,m,g,y,v,b,w,x,S,C,M,O,D,U,k,H,V;l=Math.abs(a),c=n*n+o*o,u=Math.sqrt(c),d=c+a*a,f=Math.sqrt(d),H=Math.atan2(o,n),m=a*a/d,g=c/d,C=s.a2/f,M=s.a3-s.a4/f,g>.3?(y=l/f*(1+g*(s.a1+C+m*M)/f),k=Math.asin(y),b=y*y,v=Math.sqrt(1-b)):(v=u/f*(1-m*(s.a5-C-g*M)/f),k=Math.acos(v),b=1-v*v,y=Math.sqrt(b)),w=1-lr.eccentricitySquared*b,x=lr.radius/Math.sqrt(w),S=s.a6*x,C=u-x*v,M=l-S*y,D=v*C+y*M,O=v*M-y*C,U=O/(S/w+D),k+=U,V=D+O*U/2,a<0&&(k=-k),i[r++]=GA*H,i[r++]=GA*k,i[r]=V}function ICe(t,e,i,r){cS(t,e,i,r),ZM(i,r,i,r)}function LCe(t,e,i,r){cS(t,e,i,r),nS(i,r,i,r)}function QXe(t,e,i){if(t==null||e==null||i.source.spatialReference===t&&i.dest.spatialReference===e)return i;const r=vz(t,i.source),s=vz(e,i.dest);return r===ue.UNKNOWN&&s===ue.UNKNOWN?hs(t,e)?i.projector=Is:i.projector=null:i.projector=BR[r][s],i}function Ere(){return{source:{spatialReference:null,spatialReferenceId:ue.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:ue.UNKNOWN,metersPerUnit:1},projector:Is}}const KXe={spatialReference:null,spatialReferenceId:ue.UNKNOWN},eJe={spatialReference:null,spatialReferenceId:ue.UNKNOWN},cG=Ere(),jA=kt(1),GA=La(1),uG=Math.PI,DCe=.5*uG,uS=lr.radius,ghe=uS*uG/180,yhe=180/(uS*uG);function ds(t,e,i,r,s,n,o=1){const a=wb(e,s,cG);if(a==null)return!1;if(a===Is){if(t===r&&i===n)return!0;const c=i+3*o;for(let u=i,d=n;u<c;u++,d++)r[d]=t[u];return!0}const l=i+3*o;for(let c=i,u=n;c<l;c+=3,u+=3)a(t,c,r,u);return!0}const h9t=Object.freeze(Object.defineProperty({__proto__:null,projectBuffer:ds},Symbol.toStringTag,{value:"Module"}));function _he(t,e,i,r,s,n){return HN[0]=t,HN[1]=e,HN[2]=i,ds(HN,r,0,s,n,0,1)}const HN=E();let qN=0,JH=class FZ{static fromGE(e){const i=new FZ;return i._wkt=e.wkt,i._wkid=e.wkid,i._isInverse=e.isInverse,i}constructor(e){this.uid=qN++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=qN++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=qN++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=qN++}getInverse(){const e=new FZ;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},bz=class jR{static cacheKey(e,i){var r,s,n,o,a,l;return[((r=e.wkid)==null?void 0:r.toString())??"-1",((s=e.wkt)==null?void 0:s.toString())??"",((n=e.wkt2)==null?void 0:n.toString())??"",((o=i.wkid)==null?void 0:o.toString())??"-1",((a=i.wkt)==null?void 0:a.toString())??"",((l=i.wkt2)==null?void 0:l.toString())??""].join()}static fromGE(e){const i=new jR;let r="";for(const s of e.steps){const n=JH.fromGE(s);i.steps.push(n),r+=n.uid.toString()+","}return i._cachedProjection={},i._gtlistentry=null,i._chain=r,i}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e==null?void 0:e.steps)for(const i of e.steps)i instanceof JH?this.steps.push(i):this.steps.push(new JH({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}getInverse(){const e=new jR;e.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];e.steps.push(r.getInverse())}return e}getGTListEntry(){let e="";for(const i of this.steps)e+=i.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,i,r){this._cachedProjection[jR.cacheKey(e,i)]=r}getCachedGeTransformation(e,i){let r="";for(const n of this.steps)r+=n.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=r);const s=this._cachedProjection[jR.cacheKey(e,i)];return s===void 0?null:s}};function NCe(t,e,i){if(e==null||i==null||i.vcsWkid||hs(e,i)||gb(e)||gb(i))return null;const r=a_(e)/a_(i);if(r===1)return null;switch(t){case"point":case"esriGeometryPoint":return s=>tJe(s,r);case"polyline":case"esriGeometryPolyline":return s=>rJe(s,r);case"polygon":case"esriGeometryPolygon":return s=>iJe(s,r);case"multipoint":case"esriGeometryMultipoint":return s=>sJe(s,r);case"extent":case"esriGeometryEnvelope":return s=>nJe(s,r);default:return null}}function tJe(t,e){(t==null?void 0:t.z)!=null&&(t.z*=e)}function iJe(t,e){if(t)for(const i of t.rings)for(const r of i)r.length>2&&(r[2]*=e)}function rJe(t,e){if(t)for(const i of t.paths)for(const r of i)r.length>2&&(r[2]*=e)}function sJe(t,e){if(t)for(const i of t.points)i.length>2&&(i[2]*=e)}function nJe(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let Ff=null,xb=null,YI=null,pk={};const Cre=new BP;function HP(){return!!Ff&&I2e()}function FCe(){return!!HP()||(Ft(Cre),HA(),!1)}function XE(t,e){return!t||!e||Bc(t,e)||FCe()}function kCe(t,e){return!Bc(t,e)&&!HP()}function HA(t){return YI==null&&(YI=Promise.all([L2e(),ce(()=>import("./geometryEngineBase-CmuGBSMm.js"),[]).then(e=>e.g),ce(()=>import("./hydrated-CM4mjwQo.js"),[])])),YI.then(([,e,{hydratedAdapter:i}])=>{Dt(t),xb=i,Ff=e.default,Ff._enableProjection(fWe),Cre.notify()})}function b_(t,e,i=null,r=null){return Array.isArray(t)?t.length===0?[]:kZ(xb,t,t[0].spatialReference,e,i,r):kZ(xb,[t],t.spatialReference,e,i,r)[0]}function kZ(t,e,i,r,s=null,n=null){if(i==null||r==null)return e;if(Bc(i,r,s))return e.map(o=>XI(o,i,r));if(s==null&&Q3(i))return e.map(o=>XI(o,i,Ze.WGS84)).map(o=>Tb(o,r));if(s==null&&Q3(r))return e.map(o=>Tb(o,Ze.WGS84)).map(o=>XI(o,Ze.WGS84,r));if(s==null){const o=bz.cacheKey(i,r);pk[o]!==void 0?s=pk[o]:((s=zCe(i,r,void 0))==null&&(s=new bz),pk[o]=s)}if(Ff==null||t==null)throw new hG;return n!=null?Ff._project(t,e,i,r,s,n):Ff._project(t,e,i,r,s)}function UCe(t,e){const i=VCe([t],e);return i.pending!=null?{pending:i.pending,geometry:null}:i.geometries!=null?{pending:null,geometry:i.geometries[0]}:{pending:null,geometry:null}}function VCe(t,e){if(!HP()){for(const i of t)if(i!=null&&!hs(i.spatialReference,e)&&Sf(i.spatialReference)&&Sf(e)&&!Bc(i.spatialReference,e))return Ft(Cre),{pending:HA(),geometries:null}}return{pending:null,geometries:t.map(i=>i==null?null:hs(i.spatialReference,e)?i:Sf(i.spatialReference)&&Sf(e)?Tb(i,e):null)}}function zCe(t,e,i=null){if(t==null||e==null)return null;if(Ff==null||xb==null)throw new hG;const r=Ff._getTransformation(xb,t,e,i,i==null?void 0:i.spatialReference);return r!==null?bz.fromGE(r):null}function oJe(t,e,i=null){if(Ff==null||xb==null)throw new hG;const r=Ff._getTransformationBySuitability(xb,t,e,i,i==null?void 0:i.spatialReference);if(r!==null){const s=[];for(const n of r)s.push(bz.fromGE(n));return s}return[]}let hG=class extends G{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}};function aJe(){Ff=null,xb=null,YI=null,pk={}}const lJe={get loadPromise(){return YI}};function Tb(t,e){try{const i=b_(t,e);if(i==null)return null;"xmin"in t&&"xmin"in i&&(i.zmin=t.zmin,i.zmax=t.zmax);const r=NCe(i.type,t.spatialReference,e);return r!=null&&r(i),i}catch(i){if(!(i instanceof hG))throw i;return null}}async function Sb(t,e,i){const r=t.spatialReference;return r!=null&&e!=null&&await qP(r,e,null,i),Tb(t,e)}function Bc(t,e,i){return!i&&(!!hs(t,e)||Sf(t)&&Sf(e)&&!!wb(t,e,cG))}function cJe(t,e){if(hs(t,e))return!0;if(!Sf(t)||!Sf(e))return!1;const i=o_(t)||Hf(t)||OA(t),r=o_(e)||Hf(e)||OA(e);return i&&r}async function qP(t,e,i,r){if(HP())return Gce(r);if(Array.isArray(t)){for(const{source:s,dest:n,geographicTransformation:o}of t)if(s&&n&&!Bc(s,n,o))return HA(r)}else if(t&&e&&!Bc(t,e,i))return HA(r);return Gce(r)}function XI(t,e,i){return t?"x"in t?jCe(t,e,new bt,i,0):"xmin"in t?WCe(t,e,new ur,i,0):"rings"in t?qCe(t,e,new Wf,i,0):"paths"in t?HCe(t,e,new Ef,i,0):"points"in t?GCe(t,e,new jP,i,0):null:null}function BCe(t,e,i=e.spatialReference,r=0){return i!=null&&t.spatialReference!=null&&jCe(t,t.spatialReference,e,i,r)!=null}function jCe(t,e,i,r,s){Ul[0]=t.x,Ul[1]=t.y;const n=t.z;return Ul[2]=n!==void 0?n:s,ds(Ul,e,0,Ul,r,0,1)?(i.x=Ul[0],i.y=Ul[1],i.spatialReference=r,n!==void 0||gb(r)?(i.z=Ul[2],i.hasZ=!0):(i.z=void 0,i.hasZ=!1),t.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=t.m,i.hasM=!0),i):null}function uJe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&GCe(t,t.spatialReference,e,i,r)!=null}function GCe(t,e,i,r,s){const{points:n,hasZ:o,hasM:a}=t,l=[],c=n.length,u=[];for(const f of n)u.push(f[0],f[1],o?f[2]:s);if(!ds(u,e,0,u,r,0,c))return null;const d=o||gb(r);for(let f=0;f<c;++f){const m=3*f,g=u[m],y=u[m+1];d&&a?l.push([g,y,u[m+2],n[f][3]]):d?l.push([g,y,u[m+2]]):a?l.push([g,y,n[f][2]]):l.push([g,y])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function hJe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&HCe(t,t.spatialReference,e,i,r)!=null}function HCe(t,e,i,r,s){const{paths:n,hasZ:o,hasM:a}=t,l=[];if(!ZCe(n,o??!1,a??!1,e,l,r,s))return null;const c=o||gb(r);return i.paths=l,i.spatialReference=r,i.hasZ=c,i.hasM=a,i}function dJe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&qCe(t,t.spatialReference,e,i,r)!=null}function qCe(t,e,i,r,s){const{rings:n,hasZ:o,hasM:a}=t,l=[];if(!ZCe(n,o??!1,a??!1,e,l,r,s))return null;const c=o||gb(r);return i.rings=l,i.spatialReference=r,i.hasZ=c,i.hasM=a,i}function pJe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&WCe(t,t.spatialReference,e,i,r)!=null}function WCe(t,e,i,r,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:u}=t,d=c?t.zmin:s;if(!_he(n,o,d,e,Ul,r))return null;const f=c||gb(r);i.xmin=Ul[0],i.ymin=Ul[1],f&&(i.zmin=Ul[2]);const m=c?t.zmax:s;return _he(a,l,m,e,Ul,r)?(i.xmax=Ul[0],i.ymax=Ul[1],f&&(i.zmax=Ul[2]),u&&(i.mmin=t.mmin,i.mmax=t.mmax),i.spatialReference=r,i):null}function ZCe(t,e,i,r,s,n,o=0){const a=new Array;for(const u of t)for(const d of u)a.push(d[0],d[1],e?d[2]:o);if(!ds(a,r,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;const c=e||gb(n);for(const u of t){const d=new Array;for(const f of u)c&&i?d.push([a[l++],a[l++],a[l++],f[3]]):c?d.push([a[l++],a[l++],a[l++]]):i?(d.push([a[l++],a[l++],f[2]]),l++):(d.push([a[l++],a[l++]]),l++);s.push(d)}return!0}const Ul=E(),p9t=Object.freeze(Object.defineProperty({__proto__:null,canProjectWithoutEngine:Bc,getTransformation:zCe,getTransformations:oJe,initializeProjection:qP,isEqualBaseGCS:cJe,isLoaded:HP,isLoadedOrLoad:FCe,isLoadedOrLoadFor:XE,load:HA,project:b_,projectExtent:pJe,projectMany:kZ,projectMultipoint:uJe,projectOrLoad:UCe,projectOrLoadMany:VCe,projectPoint:BCe,projectPolygon:dJe,projectPolyline:hJe,projectWithZConversion:Sb,projectWithoutEngine:XI,requiresLoad:kCe,test:lJe,tryProjectWithZConversion:Tb,unload:aJe},Symbol.toStringTag,{value:"Module"})),YCe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",knowledgegraphserver:"KnowledgeGraphServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer",videoserver:"VideoServer"},XCe=Object.values(YCe),JCe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${XCe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),fJe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^/\\n]+)\\/(${XCe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),mJe=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function f9t(t){return JCe.test(t)}function WP(t){if(t==null)return null;const e=un(t),i=(e==null?void 0:e.path.match(JCe))||(e==null?void 0:e.path.match(fJe));if(!i)return null;const[,r,s,n,o]=i,a=s.indexOf("/");return{title:Mre(a!==-1?s.slice(a+1):s),serverType:YCe[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:r}}}function gJe(t){const e=un(t).path.match(mJe);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function Mre(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function yJe(t,e){const i=[];if(t){const r=WP(t);r!=null&&r.title&&i.push(r.title)}if(e){const r=Mre(e);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function QCe(t){let e=Yd(t,!0);return!!e&&(e=e.toLowerCase(),e.endsWith(".arcgis.com")&&(e.startsWith("services")||e.startsWith("tiles")||e.startsWith("features")))}function _Je(t,e){return t&&_2e(b2e(t,e))}function vJe(t){let{url:e}=t;if(!e)return{url:e};e=b2e(e,t.logger);const i=un(e),r=WP(i.path);let s;if(r!=null)r.sublayer!=null&&t.layer.layerId==null&&(s=r.sublayer),e=r.url.path;else if(t.nonStandardUrlAllowed){const n=gJe(i.path);n!=null&&(e=n.serviceUrl,s=n.sublayerId)}return{url:_2e(e),layerId:s}}function bJe(t,e,i,r,s){_b(e,r,"url",s),r.url&&t.layerId!=null&&(r.url=Uh(r.url,i,t.layerId.toString()))}function m9t(t){if(!t)return!1;const e=t.toLowerCase(),i=e.includes("/services/"),r=e.includes("/mapserver/wmsserver"),s=e.includes("/imageserver/wmsserver"),n=e.includes("/wmsserver");return i&&(r||s||n)}function wJe(t,e){if(!t)return null;if(!UZ(t))return new G("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:t});const i=t.heightUnit,r=qb.deriveUnitFromSR(t,e).heightUnit;return i!==r?new G("webscene:incompatible-height-unit",`The vertical units of the scene (${i}) must match the horizontal units of the scene (${r})`,{verticalUnit:i,horizontalUnit:r}):null}function g9t(t,e,i){const r=KCe(t),s=e,n=xJe(r,s,i);if(r){const o=qb.deriveUnitFromSR(r,t.spatialReference).heightUnit;if(!i&&o!==r.heightUnit){const a=new G("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new G("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:a})}}if(!TJe(t)||n===du.Unsupported)return new G("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(n){case du.Units:{const o=(r==null?void 0:r.heightUnit)||"unknown",a=(s==null?void 0:s.heightUnit)||"unknown",l=new G("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new G("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case du.HeightModel:{const o=(r==null?void 0:r.heightModel)||"unknown",a=(s==null?void 0:s.heightModel)||"unknown",l=new G("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new G("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case du.CRS:{const o=(r==null?void 0:r.vertCRS)||"unknown",a=(s==null?void 0:s.vertCRS)||"unknown",l=new G("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new G("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}}return null}function xJe(t,e,i){if(!UZ(t)||!UZ(e))return du.Unsupported;if(t==null||e==null)return du.Ok;if(!i&&t.heightUnit!==e.heightUnit)return du.Units;if(t.heightModel!==e.heightModel)return du.HeightModel;switch(t.heightModel){case"gravity-related-height":return du.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?du.Ok:du.CRS;default:return du.Unsupported}}var du;function UZ(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function TJe(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!iMe(t)}function KCe(t){var r;if(t.type==="integrated-mesh-3dtiles")return null;const e=t.url?WP(t.url):void 0;return!(((r=t.spatialReference)==null?void 0:r.vcsWkid)==null&&e!=null&&e.serverType==="ImageServer")&&eMe(t)&&t.heightModelInfo?t.heightModelInfo:iMe(t)?qb.deriveUnitFromSR(EJe,t.spatialReference):null}function eMe(t){return"heightModelInfo"in t}function tMe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function iMe(t){return tMe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):rMe(t)}function SJe(t){return t.layers!=null||rMe(t)||tMe(t)||eMe(t)}function rMe(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(du||(du={}));const EJe=new qb({heightModel:"gravity-related-height"});function y9t(t,e){return{...sMe(t,e),readResourcePaths:[]}}function vhe(t,e,i){const r=un(t.itemUrl);return{...sMe(t,e),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:r?{rootPath:r.path,writtenUrls:[]}:null,resources:i?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function sMe(t,e){return{origin:e,url:un(t.itemUrl),portal:t.portal||Wn.getDefault(),portalItem:t}}async function CJe(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return rM(t);const i=Ze.WGS84;return await qP(e,i),b_(t,i)}function MJe(t,e){if(!nMe(t,e)){const i=t.typeKeywords;i?i.push(e):t.typeKeywords=[e]}}function nMe(t,e){var i;return!!((i=t.typeKeywords)!=null&&i.includes(e))}function _9t(t){return nMe(t,VZ.HOSTED_SERVICE)}function AJe(t,e){const i=t.typeKeywords;if(i){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}function bhe(t,e,i){i?MJe(t,e):AJe(t,e)}async function v9t(t){const e=t.clone().normalize();let i;if(e.length>1)for(const r of e)i?r.width>i.width&&(i=r):i=r;else i=e[0];return CJe(i)}const VZ={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function whe(t){var l;const{portal:e,isOrgItem:i,itemControl:r}=t,s=(l=e.user)==null?void 0:l.privileges;let n=!s||s.includes("features:user:edit"),o=!!i&&!!(s!=null&&s.includes("features:user:fullEdit"));const a=r==="update"||r==="admin";return a?o=n=!0:o&&(n=!0),{features:{edit:n,fullEdit:o},content:{updateItem:a}}}let Rv=class extends Se{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};h([p({type:String,json:{write:!0}})],Rv.prototype,"facilityIdField",void 0),h([p({type:String,json:{write:!0}})],Rv.prototype,"layerId",void 0),h([p({type:String,json:{write:!0}})],Rv.prototype,"nameField",void 0),h([p({type:String,json:{write:!0}})],Rv.prototype,"siteIdField",void 0),h([p({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Rv.prototype,"sublayerId",void 0),Rv=h([I("esri.layers.support.FacilityLayerInfo")],Rv);const PJe=Rv;let Ip=class extends Se{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};h([p({type:String,json:{write:!0}})],Ip.prototype,"facilityIdField",void 0),h([p({type:String,json:{write:!0}})],Ip.prototype,"layerId",void 0),h([p({type:String,json:{write:!0}})],Ip.prototype,"levelIdField",void 0),h([p({type:String,json:{write:!0}})],Ip.prototype,"levelNumberField",void 0),h([p({type:String,json:{write:!0}})],Ip.prototype,"longNameField",void 0),h([p({type:String,json:{write:!0}})],Ip.prototype,"shortNameField",void 0),h([p({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Ip.prototype,"sublayerId",void 0),h([p({type:String,json:{write:!0}})],Ip.prototype,"verticalOrderField",void 0),Ip=h([I("esri.layers.support.LevelLayerInfo")],Ip);const OJe=Ip;let dx=class extends Se{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};h([p({type:String,json:{write:!0}})],dx.prototype,"layerId",void 0),h([p({type:String,json:{write:!0}})],dx.prototype,"nameField",void 0),h([p({type:String,json:{write:!0}})],dx.prototype,"siteIdField",void 0),h([p({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],dx.prototype,"sublayerId",void 0),dx=h([I("esri.layers.support.SiteLayerInfo")],dx);const RJe=dx;let JE=class extends Se{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};h([p({type:OJe,json:{write:!0}})],JE.prototype,"levelLayer",void 0),h([p({type:PJe,json:{write:!0}})],JE.prototype,"facilityLayer",void 0),h([p({type:RJe,json:{write:!0}})],JE.prototype,"siteLayer",void 0),JE=h([I("esri.support.MapFloorInfo")],JE);const $Je=JE,IJe=Symbol("WebScene"),LJe="webscene:failed-to-copy-embedded-resources",DJe="webscene:schema-validation";function NJe(){return new G(LJe,"Copying of embedded resources is currently not supported")}function FJe(t){return new G(DJe,"Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:t})}var Xe;function xhe(t){return t==="global"?Xe.Global:Xe.Local}function QH(t){return t===Xe.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(Xe||(Xe={}));function cL(t,e){return t!=null&&(e==null||(e===Xe.Local?!t.isGeographic||t.isWGS84||t.wkid===Su.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===Su.CGCS2000||t.wkid===Su.GCSMARS2000||t.wkid===Su.GCSMARS2000_SPHERE||t.wkid===Su.GCSMOON2000))}var Cg;(function(t){t[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"})(Cg||(Cg={}));var zZ;let Dm=zZ=class extends Se{constructor(t){super(t),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null}clone(){return new zZ(ie({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};h([p({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],Dm.prototype,"enabled",void 0),h([p({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],Dm.prototype,"longNames",void 0),h([p({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],Dm.prototype,"minimized",void 0),h([p({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],Dm.prototype,"pinnedLevels",void 0),h([p({type:String,json:{read:{source:"site"},write:{target:"site"}}})],Dm.prototype,"site",void 0),h([p({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],Dm.prototype,"facility",void 0),h([p({type:String,json:{read:{source:"level"},write:{target:"level"}}})],Dm.prototype,"level",void 0),Dm=zZ=h([I("esri.webdoc.widgets.FloorFilter")],Dm);const kJe=Dm;var BZ;const WN=new Ji({slider:"slider",picker:"picker"});let QE=BZ=class extends Se{constructor(t){super(t),this.interactionMode=null,this.numStops=null,this.stopInterval=null}clone(){return new BZ({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};h([p({type:WN.apiValues,nonNullable:!0,json:{type:WN.jsonValues,default:null,read:{reader:WN.read},write:{isRequired:!0,writer:WN.write}}})],QE.prototype,"interactionMode",void 0),h([p({type:Xi,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const t=this.stopInterval!=null;return{enabled:!t,isRequired:!t}}}}})],QE.prototype,"numStops",void 0),h([p({type:Number,json:{write:{overridePolicy(){return{isRequired:this.numStops==null}}}}})],QE.prototype,"stopInterval",void 0),QE=BZ=h([I("esri.webdoc.widgets.Range")],QE);const UJe=QE,Are=Kl()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let GR=class extends Jr(Se){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return bCe(this.value,this.unit,"milliseconds")}};h([Ot(Are,{nonNullable:!0})],GR.prototype,"unit",void 0),h([p({type:Number,json:{write:!0},nonNullable:!0})],GR.prototype,"value",void 0),GR=h([I("esri.TimeInterval")],GR);const qA=GR;var jZ;let qo=jZ=class extends Se{constructor(t){super(t),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null}readCurrentTimeExtent(t){if(!t)return;const e=t[0]!=null?new Date(t[0]):null,i=t[1]!=null?new Date(t[1]):null;return new $a({start:e,end:i})}writeCurrentTimeExtent(t,e,i){t&&ia(i,[t.start!=null?t.start.getTime():null,t.end!=null?t.end.getTime():null],e)}readFullTimeExtent(t,e){const i=e.properties;if(!i)return;const r=i.endTime!=null?new Date(i.endTime):null,s=i.startTime!=null?new Date(i.startTime):null;return new $a({start:s,end:r})}writeFullTimeExtent(t,e){if(!t)return;const i=e.properties=e.properties||{},r=t.end,s=t.start;r&&(i.endTime=r!=null?r.getTime():null),s&&(i.startTime=s!=null?s.getTime():null)}readStopInterval(t,e,i){return t?qA.fromJSON({value:t.interval,unit:t.units},i):null}writeStopInterval(t,e,i,r){if(!t)return;const s=t.toJSON(r);ia("properties.timeStopInterval",{interval:s.value,units:s.unit},e)}readStops(t){return t!=null&&t.length?t.map(e=>new Date(e)):null}writeStops(t,e,i){t!=null&&t.length&&ia(i,t.map(r=>r.getTime()),e)}clone(){return new jZ(ie({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};h([p({type:$a,json:{type:[[Xi,UP]],read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],qo.prototype,"currentTimeExtent",void 0),h([ze("currentTimeExtent")],qo.prototype,"readCurrentTimeExtent",null),h([We("currentTimeExtent")],qo.prototype,"writeCurrentTimeExtent",null),h([p({type:$a,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],qo.prototype,"fullTimeExtent",void 0),h([ze("fullTimeExtent")],qo.prototype,"readFullTimeExtent",null),h([We("fullTimeExtent")],qo.prototype,"writeFullTimeExtent",null),h([p({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],qo.prototype,"loop",void 0),h([p({type:Xi,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){var r;const t=!!this.stopInterval,e=!!((r=this.stops)!=null&&r.length),i=!(t||e);return{enabled:i,isRequired:i}}}}})],qo.prototype,"numStops",void 0),h([p({type:[1,2],nonNullable:!0,json:{type:Xi,read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],qo.prototype,"numThumbs",void 0),h([p({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],qo.prototype,"stopDelay",void 0),h([p({type:qA,json:{read:{source:"properties.timeStopInterval"},write:{target:{"properties.timeStopInterval.interval":{type:Number},"properties.timeStopInterval.units":{type:Are.jsonValues.filter(t=>t!=="esriTimeUnitsUnknown")}},overridePolicy(){var i;const t=this.numStops!=null,e=!!((i=this.stops)!=null&&i.length);return{enabled:!e,isRequired:!(t||e)}}}}})],qo.prototype,"stopInterval",void 0),h([ze("stopInterval")],qo.prototype,"readStopInterval",null),h([We("stopInterval")],qo.prototype,"writeStopInterval",null),h([p({type:[Date],json:{type:[Xi],read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return{isRequired:this.numStops==null&&!this.stopInterval}}}}})],qo.prototype,"stops",void 0),h([ze("stops")],qo.prototype,"readStops",null),h([We("stops")],qo.prototype,"writeStops",null),qo=jZ=h([I("esri.webdoc.widgets.TimeSlider")],qo);const VJe=qo;var GZ;let KE=GZ=class extends Se{constructor(t){super(t),this.range=null,this.timeSlider=null,this.floorFilter=null}clone(){return new GZ(ie({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};h([p({type:UJe,json:{write:!0}})],KE.prototype,"range",void 0),h([p({type:VJe,json:{write:!0}})],KE.prototype,"timeSlider",void 0),h([p({type:kJe,json:{write:!0}})],KE.prototype,"floorFilter",void 0),KE=GZ=h([I("esri.webdoc.Widgets")],KE);const zJe=KE,BJe="randomUUID"in crypto;function dG(){if(BJe)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=i=>t[i].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function E9t(){return`{${dG().toUpperCase()}}`}function jJe(){return`{${dG()}}`}async function GJe(t,e={},i){await t.load(i);const r=Uh(t.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:o="asc",sortField:a="resource"}=e,l={query:{start:s,num:n,sortOrder:o,sortField:a,token:t.apiKey},signal:i==null?void 0:i.signal},c=await t.portal.request(r,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:u,size:d,resource:f})=>({created:new Date(u),size:d,resource:t.resourceFromPath(f)}))}}async function HJe(t,e,i,r){const s=new Map;for(const{resource:o,content:a,compress:l,access:c}of e){if(!o.hasPath())throw new G(`portal-item-resource-${i}:invalid-path`,"Resource does not have a valid path");const[u,d]=oMe(o.path),f=`${u}/${l??""}/${c??""}`;s.has(f)||s.set(f,{prefix:u,compress:l,access:c,files:[]}),s.get(f).files.push({fileName:d,content:a})}await t.load(r);const n=Uh(t.userItemUrl,i==="add"?"addResources":"updateResources");for(const{prefix:o,compress:a,access:l,files:c}of s.values())for(let d=0;d<c.length;d+=25){const f=c.slice(d,d+25),m=new FormData;o&&o!=="."&&m.append("resourcesPrefix",o),a&&m.append("compress","true"),l&&m.append("access",l);let g=0;for(const{fileName:y,content:v}of f)m.append("file"+ ++g,v,y);m.append("f","json"),await t.portal.request(n,{method:"post",body:m,signal:r==null?void 0:r.signal})}}async function qJe(t,e,i){if(!e.hasPath())throw new G("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await t.load(i);const r=Uh(t.userItemUrl,"removeResources");await t.portal.request(r,{method:"post",query:{resource:e.path},signal:i==null?void 0:i.signal}),e.portalItem=null}async function WJe(t,e){await t.load(e);const i=Uh(t.userItemUrl,"removeResources");return t.portal.request(i,{method:"post",query:{deleteAll:!0},signal:e==null?void 0:e.signal})}function oMe(t){const e=t.lastIndexOf("/");return e===-1?[".",t]:[t.slice(0,e),t.slice(e+1)]}function Pre(t){const[e,i]=ZJe(t),[r,s]=oMe(e);return[r,s,i]}function ZJe(t){const e=R7e(t);return e==null?[t,""]:[t.slice(0,t.length-e.length-1),`.${e}`]}async function fk(t){return t.type==="blob"?t.blob:t.type==="json"?new Blob([t.jsonString],{type:"application/json"}):(await yr(t.url,{responseType:"blob"})).data}function YJe(t,e){if(!t.hasPath())return null;const[i,,r]=Pre(t.path);return t.portalItem.resourceFromPath(Uh(i,e+r))}function aMe(t,e){if(!t.hasPath())return null;const[i,,r]=Pre(t.path);return t.portalItem.resourceFromPath(Uh(i,e+r))}const sM=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResources:HJe,contentToBlob:fk,fetchResources:GJe,getSiblingOfSameType:YJe,getSiblingOfSameTypeI:aMe,removeAllResources:WJe,removeResource:qJe,splitPrefixFileNameAndExtension:Pre},Symbol.toStringTag,{value:"Module"}));async function XJe(t,e,i){const r=await lMe(t,e,i);await cMe(r,e,i)}async function JJe(t,e,i,r,s){const n=await lMe(i,r,s);await t.update({data:e}),await cMe(n,r,s)}async function lMe(t,e,i){if(!(e!=null&&e.resources))return;const r=e.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=e.portalItem;const s=new Set(e.resources.toKeep.map(d=>d.resource.path)),n=new Set,o=[];s.forEach(d=>{r.delete(d),t.paths.push(d)});const a=[],l=[],c=[];for(const d of e.resources.toUpdate)if(r.delete(d.resource.path),s.has(d.resource.path)||n.has(d.resource.path)){const{resource:f,content:m,finish:g}=d,y=aMe(f,dG());t.paths.push(y.path),a.push({resource:y,content:await fk(m),compress:d.compress}),g&&c.push(()=>g(y))}else{t.paths.push(d.resource.path),l.push({resource:d.resource,content:await fk(d.content),compress:d.compress});const f=d.finish;f&&c.push(()=>f(d.resource)),n.add(d.resource.path)}for(const d of e.resources.toAdd)if(t.paths.push(d.resource.path),r.has(d.resource.path))r.delete(d.resource.path);else{a.push({resource:d.resource,content:await fk(d.content),compress:d.compress});const f=d.finish;f&&c.push(()=>f(d.resource))}if(a.length||l.length){const{addOrUpdateResources:d}=await ce(()=>Promise.resolve().then(()=>sM),void 0);await d(e.portalItem,a,"add",i),await d(e.portalItem,l,"update",i)}if(c.forEach(d=>d()),o.length===0)return r;const u=await aqe(o);if(Dt(i),u.length>0)throw new G("save:resources","Failed to save one or more resources",{errors:u});return r}async function cMe(t,e,i){if(!t||!e.portalItem)return;const r=[];for(const s of t){const n=e.portalItem.resourceFromPath(s);r.push(n.portalItem.removeResource(n,i))}await jf(r)}function The(t){if(rr.apiKey&&jie(t.portal.url))throw new G("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${t.portal.url} when using an api key`)}async function C9t(t){const e=[];for(const i of t.allLayers)if("beforeSave"in i&&typeof i.beforeSave=="function"){const r=i.beforeSave();r&&e.push(r)}await Promise.allSettled(e)}const QJe=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function KJe(t,e,i){let r=(t.messages??[]).filter(({type:s})=>s==="error").map(({name:s,message:n,details:o})=>new G(s,n,o));if(t.blockedRelativeUrls&&(r=r.concat(t.blockedRelativeUrls.map(s=>new G("url:unsupported",`Relative url '${s}' is not supported`)))),i){const{ignoreUnsupported:s,supplementalUnsupportedErrors:n=[],requiredPropertyChecksDisabled:o}=i;s&&(r=r.filter(({name:a})=>!(QJe.has(a)||n.includes(a)))),o&&(r=r.filter(a=>a.name!=="web-document-write:property-required"))}if(r.length>0)throw new G(e.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:r})}const eQe={width:600,height:400},ZN=1.5;function tQe(t,e){e=e||eQe;let{width:i,height:r}=e;const s=i/r;return s<ZN?r=i/ZN:s>ZN&&(i=r*ZN),i>t.width&&(r*=t.width/i,i=t.width),r>t.height&&(i*=t.height/r,r=t.height),{width:Math.round(i),height:Math.round(r)}}function She(t){return{enabled:!!(t!=null&&t.length)}}const Ore=new Ji({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var HZ;let eC=HZ=class extends Se{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new HZ({exactMatch:this.exactMatch,type:this.type,name:this.name})}};h([p({type:Boolean,json:{write:!0}})],eC.prototype,"exactMatch",void 0),h([p({type:String,json:{write:!0}})],eC.prototype,"name",void 0),h([Ot(Ore)],eC.prototype,"type",void 0),eC=HZ=h([I("esri.webdoc.applicationProperties.SearchLayerField")],eC);const iQe=eC;var qZ;let tC=qZ=class extends Se{constructor(t){super(t),this.field=null,this.id=null,this.subLayer=null}clone(){return new qZ(ie({field:this.field,id:this.id,subLayer:this.subLayer}))}};h([p({type:iQe,json:{write:{isRequired:!0}}})],tC.prototype,"field",void 0),h([p({type:String,json:{write:{isRequired:!0}}})],tC.prototype,"id",void 0),h([p({type:Xi,json:{write:!0}})],tC.prototype,"subLayer",void 0),tC=qZ=h([I("esri.webdoc.applicationProperties.SearchLayer")],tC);const rQe=tC;var WZ;let iC=WZ=class extends Se{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new WZ({exactMatch:this.exactMatch,type:this.type,name:this.name})}};h([p({type:Boolean,json:{write:!0}})],iC.prototype,"exactMatch",void 0),h([p({type:String,json:{write:!0}})],iC.prototype,"name",void 0),h([Ot(Ore)],iC.prototype,"type",void 0),iC=WZ=h([I("esri.webdoc.applicationProperties.SearchTableField")],iC);const sQe=iC;var ZZ;let HR=ZZ=class extends Se{constructor(t){super(t),this.field=null,this.id=null}clone(){return new ZZ(ie({field:this.field,id:this.id}))}};h([p({type:sQe,json:{write:{isRequired:!0}}})],HR.prototype,"field",void 0),h([p({type:String,json:{write:{isRequired:!0}}})],HR.prototype,"id",void 0),HR=ZZ=h([I("esri.webdoc.applicationProperties.SearchTable")],HR);const nQe=HR;var YZ;const uMe=st.ofType(rQe),hMe=st.ofType(nQe);let Nm=YZ=class extends Se{constructor(t){super(t),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new uMe,this.tables=new hMe}readAddressSearchEnabled(t){return!t}writeAddressSearchEnabled(t,e,i){e[i]=!t}clone(){return new YZ(ie({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};h([p({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],Nm.prototype,"addressSearchEnabled",void 0),h([ze("addressSearchEnabled")],Nm.prototype,"readAddressSearchEnabled",null),h([We("addressSearchEnabled")],Nm.prototype,"writeAddressSearchEnabled",null),h([p({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],Nm.prototype,"enabled",void 0),h([p({type:String,json:{write:!0}})],Nm.prototype,"hintText",void 0),h([p({type:uMe,json:{write:{overridePolicy:She},origins:{"web-scene":{write:{isRequired:!0}}}}})],Nm.prototype,"layers",void 0),h([p({type:hMe,json:{read:!0,write:{overridePolicy:She}}})],Nm.prototype,"tables",void 0),Nm=YZ=h([I("esri.webdoc.applicationProperties.Search")],Nm);const oQe=Nm;var XZ;let mk=XZ=class extends Se{constructor(t){super(t),this.search=null}clone(){return new XZ(ie({search:this.search}))}};h([p({type:oQe,json:{write:!0}})],mk.prototype,"search",void 0),mk=XZ=h([I("esri.webdoc.applicationProperties.Viewing")],mk);const aQe=mk;var JZ;let gk=JZ=class extends Se{constructor(t){super(t),this.viewing=null}clone(){var t;return new JZ({viewing:((t=this.viewing)==null?void 0:t.clone())??null})}};h([p({type:aQe,json:{write:!0}})],gk.prototype,"viewing",void 0),gk=JZ=h([I("esri.webscene.ApplicationProperties")],gk);const lQe=gk;var QZ;let qR=QZ=class extends Se{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new QZ({cloudCover:this.cloudCover})}};h([Ot({sunny:"sunny"})],qR.prototype,"type",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],qR.prototype,"cloudCover",void 0),qR=QZ=h([I("esri.views.3d.environment.SunnyWeather")],qR);const wz=qR;var KZ;let WR=KZ=class extends Se{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new KZ({cloudCover:this.cloudCover})}};h([Ot({cloudy:"cloudy"})],WR.prototype,"type",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],WR.prototype,"cloudCover",void 0),WR=KZ=h([I("esri.views.3d.environment.CloudyWeather")],WR);const cQe=WR;var eY;let ZR=eY=class extends Se{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new eY({fogStrength:this.fogStrength})}};h([Ot({foggy:"foggy"})],ZR.prototype,"type",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],ZR.prototype,"fogStrength",void 0),ZR=eY=h([I("esri.views.3d.environment.FoggyWeather")],ZR);const uQe=ZR;var tY;let rC=tY=class extends Se{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new tY({cloudCover:this.cloudCover,precipitation:this.precipitation})}};h([Ot({rainy:"rainy"})],rC.prototype,"type",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],rC.prototype,"cloudCover",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],rC.prototype,"precipitation",void 0),rC=tY=h([I("esri.views.3d.environment.RainyWeather")],rC);const hQe=rC;var iY;let px=iY=class extends Se{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new iY({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};h([Ot({snowy:"snowy"})],px.prototype,"type",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],px.prototype,"cloudCover",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],px.prototype,"precipitation",void 0),h([p({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],px.prototype,"snowCover",void 0),px=iY=h([I("esri.views.3d.environment.SnowyWeather")],px);const dQe=px,Rre={key:"type",base:wz,typeMap:{sunny:wz,cloudy:cQe,rainy:hQe,snowy:dQe,foggy:uQe}},pQe=Object.keys(Rre.typeMap);function fQe(t,e){return!!pQe.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const R0=1e4,mQe=1e5;var rY;let cd=rY=class extends Se{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,i){e[i]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,i){t&&(e[i]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new rY(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};h([p({readOnly:!0,type:["sun"],json:{write:!0}})],cd.prototype,"type",void 0),h([p({type:Date,json:{type:Number,write:{target:"datetime"}}})],cd.prototype,"date",void 0),h([ze("date",["datetime"])],cd.prototype,"readDate",null),h([We("date")],cd.prototype,"writeDate",null),h([p({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],cd.prototype,"directShadowsEnabled",void 0),h([ze("directShadowsEnabled",["directShadows"])],cd.prototype,"readDirectShadowsEnabled",null),h([We("directShadowsEnabled")],cd.prototype,"writedirectShadowsEnabled",null),h([p({type:Number,json:{write:!0}})],cd.prototype,"displayUTCOffset",void 0),h([We("displayUTCOffset")],cd.prototype,"writeDisplayUTCOffset",null),cd=rY=h([I("esri.webscene.SunLighting")],cd);const BS=cd;var sY;let YR=sY=class extends Se{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new sY(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};h([p({readOnly:!0,type:["virtual"],json:{write:!0}})],YR.prototype,"type",void 0),h([p({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],YR.prototype,"directShadowsEnabled",void 0),YR=sY=h([I("esri.webscene.VirtualLighting")],YR);const wD=YR,dMe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:BS,virtual:wD}};let yk=class extends Se{constructor(e){super(e)}clone(){throw new Error("Subclasses of Background should implement their own clone method.")}};h([p({readOnly:!0,json:{read:!1}})],yk.prototype,"type",void 0),yk=h([I("esri.webscene.background.Background")],yk);const pMe=yk;function gQe(t,e){const i=e.transparency!=null?FA(e.transparency):1,r=e.color;return r&&Array.isArray(r)?new Qe([r[0]||0,r[1]||0,r[2]||0,i]):null}function yQe(t,e){e.color=t.toJSON().slice(0,3);const i=yD(t.a);i!==0&&(e.transparency=i)}const w_={type:Qe,json:{type:[Xi],default:null,read:{source:["color","transparency"],reader:gQe},write:{target:{color:{type:[Xi]},transparency:{type:Xi}},writer:yQe}}},iy={type:Number,cast:vr,json:{write:!0}};var nY;const _Qe={...w_,nonNullable:!0};let XR=nY=class extends pMe{constructor(t){super(t),this.type="color",this.color=new Qe([0,0,0,1])}clone(){return new nY(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};h([Ot({color:"color"},{readOnly:!0})],XR.prototype,"type",void 0),h([p(_Qe)],XR.prototype,"color",void 0),XR=nY=h([I("esri.webscene.background.ColorBackground")],XR);const fMe=XR,Ehe={base:pMe,key:"type",typeMap:{color:fMe}};function vQe(t){return(e,i,r)=>{if(!e)return e;for(const s in t.typeMap)if(e.type===s){const n=new t.typeMap[s];return n.read(e,r),n}}}const bQe={types:Ehe,json:{read:vQe(Ehe),write:{overridePolicy:(t,e,i)=>({enabled:!(i!=null&&i.isPresentation)})}}};var oY;const Che=(t,e,i)=>({enabled:!(i!=null&&i.isPresentation)});let $v=oY=class extends Se{constructor(t){super(t),this.lighting=new BS,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){fQe(t==null?void 0:t.type,se.getLogger(this))&&this._set("weather",t)}clone(){return new oY(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?wD.prototype.clone.call(this.lighting):BS.prototype.clone.call(this.lighting),background:ie(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};h([p({types:dMe,nonNullable:!0,json:{write:!0}})],$v.prototype,"lighting",void 0),h([p(bQe)],$v.prototype,"background",void 0),h([p({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Che}}})],$v.prototype,"atmosphereEnabled",void 0),h([p({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Che}}})],$v.prototype,"starsEnabled",void 0),h([p({types:Rre,nonNullable:!0,json:{write:!0},value:new wz})],$v.prototype,"weather",null),$v=oY=h([I("esri.webscene.Environment")],$v);const WA=$v,mMe={type:$a,json:{read:{source:"timeExtent",reader:t=>t?Array.isArray(t)?$a.fromArray(t):$a.fromJSON(t):null},write:{writer:(t,e,i,r)=>{t&&(t.isEmpty?r!=null&&r.messages&&r.messages.push(new G("invalid-timeExtent","TimeExtent cannot be empty")):e[i]=t.toArray())},target:{timeExtent:{type:[[Xi,UP]]}}}}};var aY;let Iv=aY=class extends Se{constructor(t){super(t),this.environment=new WA,this.spatialReference=null,this.viewpoint=null,this.timeExtent=null}set viewingMode(t){this._set("viewingMode",t)}clone(){var t,e,i;return new aY({environment:this.environment.clone(),spatialReference:((t=this.spatialReference)==null?void 0:t.clone())??null,viewingMode:this.viewingMode,viewpoint:((e=this.viewpoint)==null?void 0:e.clone())??null,timeExtent:((i=this.timeExtent)==null?void 0:i.clone())??null})}};h([p({type:WA,json:{write:{isRequired:!0}}})],Iv.prototype,"environment",void 0),h([p({type:Ze})],Iv.prototype,"spatialReference",void 0),h([p({type:["local","global"]})],Iv.prototype,"viewingMode",null),h([p({type:Zf,json:{write:{isRequired:!0}}})],Iv.prototype,"viewpoint",void 0),h([p(mMe)],Iv.prototype,"timeExtent",void 0),Iv=aY=h([I("esri.webscene.InitialViewProperties")],Iv);const xz=Iv;let wQe=class{constructor(e,i){this._observable=new BP,this._value=e,this._equalityFunction=i}get value(){return Ft(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function Ug(t,e=Qxe){return new wQe(t,e)}const na=Symbol("Yield");let xQe=class{constructor(){this._tasks=new Array,this._runningTasks=Ug(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(this.length===0)return na;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,i,r){return++this._runningTasks.value,new Promise((s,n)=>this._tasks.push(new Mhe(s,n,e,i,r))).finally(()=>--this._runningTasks.value)}unshift(e,i,r){return++this._runningTasks.value,new Promise((s,n)=>this._tasks.unshift(new Mhe(s,n,e,i,r))).finally(()=>--this._runningTasks.value)}_process(e){var r;if(this._tasks.length===0)return!1;const i=this._tasks.shift();try{const s=ra(i.signal);if(s&&!i.abortCallback)i.reject(ki());else{const n=s?(r=i.abortCallback)==null?void 0:r.call(i,ki()):i.callback(e);Fu(n)?n.then(i.resolve,i.reject):i.resolve(n)}}catch(s){i.reject(s)}return!0}cancelAll(){const e=ki();for(const i of this._tasks)if(i.abortCallback){const r=i.abortCallback(e);i.resolve(r)}else i.reject(e);this._tasks.length=0}},Mhe=class{constructor(e,i,r,s=void 0,n=void 0){this.resolve=e,this.reject=i,this.callback=r,this.signal=s,this.abortCallback=n}},JR=class extends Ue{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};h([p()],JR.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),h([p()],JR.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),JR=h([I("esri.views.support.debugFlags")],JR);const TQe=new JR;var $i;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})($i||($i={}));function SQe(){return new Tz.Scheduler}var It;(function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"})(It||(It={}));const lg=0,Ahe=new Map([[It.RESOURCE_CONTROLLER_IMMEDIATE,lg],[It.RESOURCE_CONTROLLER,4],[It.SLIDE,lg],[It.STREAM_DATA_LOADER,lg],[It.ELEVATION_QUERY,lg],[It.TERRAIN_SURFACE,1],[It.SURFACE_GEOMETRY_UPDATES,1],[It.LOD_RENDERER,2],[It.GRAPHICS_CORE,2],[It.I3S_CONTROLLER,2],[It.POINT_CLOUD_LAYER,2],[It.FEATURE_TILE_FETCHER,2],[It.OVERLAY,4],[It.STAGE,4],[It.GRAPHICS_DECONFLICTOR,4],[It.FILTER_VISIBILITY,4],[It.SCALE_VISIBILITY,4],[It.FRUSTUM_VISIBILITY,4],[It.CLOUDS_GENERATOR,4],[It.POINT_OF_INTEREST_FREQUENT,6],[It.POINT_OF_INTEREST_INFREQUENT,30],[It.LABELER,8],[It.FEATURE_QUERY_ENGINE,8],[It.FEATURE_TILE_TREE,16],[It.FEATURE_TILE_TREE_ACTIVE,lg],[It.ELEVATION_ALIGNMENT,12],[It.ELEVATION_ALIGNMENT_SCENE,14],[It.TEXT_TEXTURE_ATLAS,12],[It.TEXTURE_UNLOAD,12],[It.LINE_OF_SIGHT_TOOL,16],[It.LINE_OF_SIGHT_TOOL_INTERACTIVE,lg],[It.SNAPPING,lg],[It.SHADOW_ACCUMULATOR,30]]);function Phe(t){return Ahe.has(t)?Ahe.get(t):typeof t=="number"?t:1}const EQe=6.5,Ohe=1,CQe=30,MQe=1e3/30,AQe=100,Rhe=.9;var Tz,bw;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(n=>n.needsUpdate)}constructor(){this._updating=Ug(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new U0("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=$i.INTERACTING,this._tasks=new ai,this._runQueue=new ai,this._load=0,this._idleStateCallbacks=new ai,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=te(()=>TQe.SCHEDULER_LOG_SLOW_TASKS,n=>this._debug=n,$t);for(const n of Object.keys(It))this.performanceInfo.tasks.set(It[n],new U0(It[n]))}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),$r(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(n,o){const a=new i(this,n,o);return this._tasks.push(a),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new U0(n)),a}registerIdleStateCallbacks(n,o){const a={idleBegin:n,idleEnd:o};this._idleStateCallbacks.push(a),this.state===$i.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===$i.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==$i.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(n){++this._frameNumber;let o=EQe,a=n.frameDuration,l=Ohe;switch(this.state){case $i.IDLE:o=0,a=Math.max(AQe,n.frameDuration),l=CQe;break;case $i.INTERACTING:a=Math.max(MQe,n.frameDuration);case $i.ANIMATING:}return a=a-n.elapsedFrameTime-o,this.state!==$i.IDLE&&a<Ohe&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case $i.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case $i.INTERACTING:this._runInteracting();break;default:this._runAnimating()}}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(o=>{o.name===n&&o.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return bw.SCHEDULED;let o=bw.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?o=bw.READY:o!==bw.READY&&(o=bw.WAITING))}),o}_getRuntime(n){let o=0;return this._tasks.forAll(a=>{a.name===n&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let o="";return n.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*Rhe+n*(1-Rhe)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===lg&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==lg&&a.blockFrame!==this._frameNumber&&(n=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===na&&(a.blockFrame=this._frameNumber)}catch(c){se.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c),a.blockFrame=this._frameNumber}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,It.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-n)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(It))this._frameTaskTimes.set(It[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(n)}get test(){}}t.Scheduler=e;class i{get task(){return this._task.value}get updating(){return this._queue.running}constructor(n,o,a){this._scheduler=n,this.name=o,this.blockFrame=0,this.runtime=0,this._queue=new xQe,this._handles=new ly,this._basePriority=Phe(o),this.schedulePriority=this._basePriority,this._task=Ug(a??this._queue),this._handles.add(No(()=>this.task.running,l=>n.taskRunningChanged(l)))}remove(){this.processQueue(Eu),this._scheduler.removeTask(this),this.schedule=ZA.schedule,this.reschedule=ZA.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){if(this.name===n)return;this.name=n;const o=Phe(n);this._basePriority!==lg&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,o,a){return this._queue.push(n,o,a)}reschedule(n,o,a){return this._queue.unshift(n,o,a)}processQueue(n){return this._queue.runTask(n)}}class r{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=$i.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=r})(Tz||(Tz={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(bw||(bw={}));const Eu=(()=>{const t=new Tz.Budget;return t.enabled=!1,t})();let PQe=class{remove(){}processQueue(){}schedule(e,i,r){try{if(ra(i)){const s=ki();return r?Promise.resolve(r(s)):Promise.reject(s)}return IW(e(Eu))}catch(s){return Promise.reject(s)}}reschedule(e,i,r){return this.schedule(e,i,r)}};const ZA=new PQe;function OQe(t){return!!t&&/^https:\/\/.*/i.test(t)}function RQe(t){return!!t&&/data:([-\w]+\/[-+\w.]+)?(;?\w+=[-\w]+)*(;base64)?,.*/gu.test(t)}var lY;let bf=lY=class extends Se{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}get isSecureUrl(){return OQe(this.url)}get isDataURI(){return RQe(this.url)}clone(){return new lY({url:this.url})}};h([p({type:String,json:{write:{isRequired:!0}}})],bf.prototype,"url",void 0),h([p()],bf.prototype,"isSecureUrl",null),h([p()],bf.prototype,"isDataURI",null),bf=lY=h([I("esri.webdoc.support.SlideThumbnail")],bf);var cY;let _k=cY=class extends Se{constructor(){super(...arguments),this.text=""}clone(){return new cY({text:this.text})}};h([p({type:String,json:{write:!0}})],_k.prototype,"text",void 0),_k=cY=h([I("esri.webscene.support.Description")],_k);const vk=_k;var uY;let nM=uY=class extends Se{constructor(){super(...arguments),this.lighting=new BS,this.weather=new wz}clone(){return new uY({lighting:ie(this.lighting),weather:ie(this.weather)})}};h([p({types:dMe,json:{write:!0}})],nM.prototype,"lighting",void 0),h([p({types:Rre,json:{write:!0}})],nM.prototype,"weather",void 0),nM=uY=h([I("esri.webscene.Environment")],nM);var bk;let wk=bk=class extends Se{constructor(){super(...arguments),this.opacity=null}clone(){return new bk({opacity:this.opacity})}cloneAndApplyTo(t){return this.opacity==null||((t=(t==null?void 0:t.clone())??new nL).opacity=this.opacity),t}static fromGround(t){return new bk({opacity:t.opacity})}};h([p({type:Number,json:{type:Xi,read:{reader:FA,source:"transparency"},write:{writer:(t,e)=>{e.transparency=yD(t)},target:"transparency"}}})],wk.prototype,"opacity",void 0),wk=bk=h([I("esri.webscene.support.SlideGround")],wk);const gMe=wk;var hY;let oM=hY=class extends Se{constructor(t){super(t),this.id="",this.sublayerIds=null}clone(){return new hY({id:this.id,sublayerIds:ie(this.sublayerIds)})}};h([p({type:String,json:{write:!0}})],oM.prototype,"id",void 0),h([p({type:[Xi],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],oM.prototype,"sublayerIds",void 0),oM=hY=h([I("esri.webscene.support.SlideVisibleLayer")],oM);var dY;let xk=dY=class extends Se{constructor(){super(...arguments),this.text=""}clone(){return new dY({text:this.text})}};h([p({type:String,json:{write:{isRequired:!0}}})],xk.prototype,"text",void 0),xk=dY=h([I("esri.webscene.support.Title")],xk);const JI=xk;let $Qe=0;const pY=st.ofType(oM);let Wo=class extends Se{constructor(e){super(e),this.id=Date.now().toString(16)+"-slide-"+$Qe++,this.title=new JI,this.description=new vk,this.hidden=!1,this.thumbnail=new bf,this.viewpoint=null,this.basemap=null,this.ground=null,this.environment=new nM,this.timeExtent=null,this.visibleLayers=new pY}destroy(){this.visibleLayers.removeAll(),this.basemap=null,this.thumbnail=qe(this.thumbnail),this.description=null,this.title=null,this.thumbnail=null}castTitle(e){return typeof e=="string"?new JI({text:e}):Qs(JI,e)}castDescription(e){return typeof e=="string"?new vk({text:e}):Qs(vk,e)}castThumbnail(e){return typeof e=="string"?new bf({url:e}):Qs(bf,e)}castBasemap(e){return fre(e)}set visibleLayers(e){this._set("visibleLayers",Kg(e,this._get("visibleLayers"),pY))}castVisibleLayers(e){return e&&typeof e.map=="function"?e.map(i=>{if(typeof i=="string")return{id:i};if(i instanceof lL){const r=$he(i);return{id:i.id,sublayerIds:r}}return i.id?{id:i.id,sublayerIds:"sublayerIds"in i?i.sublayerIds:void 0}:(se.getLogger(this).warn('Invalid visible layer, expected { id }, Layer or "id"'),i)}):null}clone(){var e,i,r;return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:((e=this.basemap)==null?void 0:e.clone())||null,ground:((i=this.ground)==null?void 0:i.clone())||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null,hidden:this.hidden,timeExtent:((r=this.timeExtent)==null?void 0:r.clone())??null})}async _updateVisibleLayersFrom(e){const i=[];await Promise.allSettled(this._getLayers(e.map).map(r=>e.whenLayerView(r).then(s=>{if(s.visible){const n=$he(r);i.push(new oM({id:s.layer.id,sublayerIds:n}))}})).toArray()),this.visibleLayers.removeAll(),this.visibleLayers.addMany(i)}updateFrom(e,i){const r={format:"png",quality:80,width:120,height:75,disableDecorations:!0,...i==null?void 0:i.screenshot};return e.when(()=>{var s;return this.viewpoint=e.viewpoint.clone(),this.environment.lighting=e.environment.lighting.type==="virtual"?wD.prototype.clone.apply(e.environment.lighting):BS.prototype.clone.apply(e.environment.lighting),this.environment.weather=e.environment.weather.clone(),this.basemap=e.map.basemap&&e.map.basemap.clone()||null,this.ground=e.map.ground?gMe.fromGround(e.map.ground):null,this.timeExtent=((s=e.timeExtent)==null?void 0:s.clone())??null,this._updateVisibleLayersFrom(e)}).then(()=>e.takeScreenshot(r)).then(s=>(this.thumbnail=new bf({url:s.dataUrl}),this))}async applyTo(e,i){this._applyToController!=null&&this._applyToController.abort();let r=new AbortController;this._applyToController=r;const s=oD(i,()=>r==null?void 0:r.abort()),n=()=>{this._applyToController===r&&(this._applyToController=null),r=null,s==null||s.remove()};try{await VS(()=>e.ready,r.signal)}catch(d){throw n(),d}if(r.signal.aborted)throw n(),ki();const o=e.resourceController.scheduler.registerTask(It.SLIDE);let a=!1;const l={animate:!0,...i,signal:this._applyToController.signal},c=async()=>{await Promise.all([o.schedule(async()=>a=await this._setViewpointOfInterest(e,l)),o.schedule(()=>this._applyBasemap(e,l),l.signal)]),await this._loadLayersWithSublayerVisibility(e),await Promise.all([o.schedule(()=>this._applyLayerVisibility(e),l.signal),o.schedule(()=>this._applyGround(e),l.signal),o.schedule(()=>this._applyViewpoint(e,l),l.signal),o.schedule(()=>{var d;return e.timeExtent=((d=this.timeExtent)==null?void 0:d.clone())??null},l.signal)]),await o.schedule(()=>e.environment.weather=this.environment.weather.clone())},u=await Vh(e.addUpdatingPromise(c()));if(a&&(e.contentCamera=null),o.remove(),n(),u.ok===!1)throw u.error;return this}async _applyBasemap(e,i){if(this.basemap){try{await this.basemap.load(i)}catch(r){if(os(r))throw r}e.map.basemap=KYe(this.basemap,e.map.basemap)}}_applyGround(e){this.ground&&(e.map.ground=this.ground.cloneAndApplyTo(e.map.ground))}_getLayers(e){const i=new st;return this._collectLayers(e,i),this._collectLayers(e.ground,i),i}_collectLayers(e,i){e.layers.forEach(r=>{r.persistenceEnabled&&(i.add(r),"layers"in r&&this._collectLayers(r,i))})}async _loadLayersWithSublayerVisibility(e){this.visibleLayers&&await Promise.allSettled(this._getLayers(e.map).items.map(i=>{var s;return((s=this.visibleLayers.find(n=>n.id===i.id))==null?void 0:s.sublayerIds)?i.load():null}))}_applyLayerVisibility(e){this.visibleLayers&&this._getLayers(e.map).forEach(i=>{const r=this.visibleLayers.find(o=>o.id===i.id);i.visible=r!=null;const s=r==null?void 0:r.sublayerIds,n=yMe(i);s&&n&&n.forEach(o=>o.visible=s.includes(o.id))})}async _setViewpointOfInterest(e,i){if(e.state.fixedContentCamera||!this.viewpoint||i!=null&&i.ignoreViewpoint||!(i!=null&&i.useDestinationCamera))return!1;const{toCameraAsync:r}=await ce(()=>Promise.resolve().then(()=>hmt),void 0),s=await r(e,this.viewpoint);return e.contentCamera=s,s!=null}async _applyViewpoint(e,i){if(this._applyCachedCameraTrackingEnabled(e),this.viewpoint&&!i.ignoreViewpoint){this.viewpoint.camera!=null&&(this.viewpoint.camera.fov=e.camera.fov);const r=this.environment.lighting;if(i.animate&&r.type==="sun"&&r.date)return this._animateToLighting(e,i);i.animate&&(e.environment.applyLighting(r.clone()),await e.goTo(this.viewpoint,i)),e.viewpoint=this.viewpoint}e.environment.applyLighting(this.environment.lighting.clone())}async _animateToLighting(e,i){let r=null;return e.environment.lighting.type!=="virtual"&&this.environment.lighting.type!=="virtual"&&(e.viewingMode==="global"&&(r=this._animateLightingWithCamera(e,e.environment.lighting,this.environment.lighting)),e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1),e.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled,this.environment.lighting.type==="virtual"||e.environment.lighting.type==="virtual"?(e.environment.applyLighting(this.environment.lighting.clone()),e.environment.lighting.type!=="virtual"&&(e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1)):this.environment.lighting.displayUTCOffset!=null&&(e.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset),e.goTo(this.viewpoint,i).then(()=>{this._applyCachedCameraTrackingEnabled(e),e.environment.applyLighting(this.environment.lighting.clone())}).catch(s=>{throw e.animation==null&&this._applyCachedCameraTrackingEnabled(e),s}).finally(()=>{$r(r)})}_applyCachedCameraTrackingEnabled(e){e.environment.cachedCameraTrackingEnabled!=null&&(e.environment.lighting.cameraTrackingEnabled=e.environment.cachedCameraTrackingEnabled,e.environment.cachedCameraTrackingEnabled=null)}_getTime(e){return[e.getTime(),3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds()]}_setTime(e,i,r){return e.setTime(i),e.setUTCHours(r/3600),e.setUTCMinutes(r%3600/60),e.setUTCSeconds(r%3600%60),e}_animateLightingWithCamera(e,i,r){const s=new Date(i.date.toString()),[n,o]=this._getTime(s),[a,l]=this._getTime(r.date),c=LQe(o,l),u=e.renderCoordsHelper,d=E();u.toRenderCoords(e.camera.position,d);const f=E(),m=E();this.viewpoint.camera!=null&&u.toRenderCoords(this.viewpoint.camera.position,f);const g=new Date;return No(()=>e.camera,y=>{u.toRenderCoords(y.position,m);const v=uo(d,m),b=uo(f,m);let w=0;v+b!==0&&(w=v/(v+b));const x=n+(a-n)*w,S=DQe(o,c*w);i.date=this._setTime(g,x,S)})}static createFrom(e,i){return new this().updateFrom(e,i)}};h([p({type:String,json:{write:{isRequired:!0}}})],Wo.prototype,"id",void 0),h([p({type:JI,json:{default:()=>new JI({text:""}),write:{isRequired:!0}}})],Wo.prototype,"title",void 0),h([Kt("title")],Wo.prototype,"castTitle",null),h([p({type:vk,json:{write:{overridePolicy:t=>({enabled:!(!t||!t.text)})}}})],Wo.prototype,"description",void 0),h([Kt("description")],Wo.prototype,"castDescription",null),h([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!1}})],Wo.prototype,"hidden",void 0),h([p({type:bf,json:{default:()=>new bf({url:""}),write:{isRequired:!0}}})],Wo.prototype,"thumbnail",void 0),h([Kt("thumbnail")],Wo.prototype,"castThumbnail",null),h([p({type:Zf,nonNullable:!0,json:{write:{isRequired:!0}}})],Wo.prototype,"viewpoint",void 0),h([p({type:HM,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Wo.prototype,"basemap",void 0),h([Kt("basemap")],Wo.prototype,"castBasemap",null),h([p({type:gMe,json:{write:!0}})],Wo.prototype,"ground",void 0),h([p({type:pY,json:{write:{isRequired:!0}}})],Wo.prototype,"visibleLayers",null),h([Kt("visibleLayers")],Wo.prototype,"castVisibleLayers",null),h([p({type:nM,json:{write:!0}})],Wo.prototype,"environment",void 0),h([p(mMe)],Wo.prototype,"timeExtent",void 0),Wo=h([I("esri.webscene.Slide")],Wo);const IQe=Wo;function yMe(t){if(t.type==="building-scene"||t.type==="map-image")return t.allSublayers.toArray()}function $he(t){const e=yMe(t);if(e)return e.filter(i=>i.visible).map(i=>i.id)}const fY=86400,Ihe=43200;function LQe(t,e){let i=e-t;return i>Ihe&&(i-=fY),i<-Ihe&&(i+=fY),i}function DQe(t,e){return uYe(t+e,fY)}const mY=st.ofType(IQe);let Tk=class extends Se{constructor(e){super(e),this.slides=new mY}destroy(){this.slides.forEach(e=>e.destroy()),this.slides.removeAll()}set slides(e){e&&(e=e.filter(i=>!!i.viewpoint)),this._set("slides",Kg(e,this._get("slides"),mY))}clone(){return new this.constructor({slides:this.slides.clone()})}};h([p({type:mY,nonNullable:!0,json:{write:!0}}),Kt(Hie)],Tk.prototype,"slides",null),Tk=h([I("esri.webscene.Presentation")],Tk);const _Me=Tk;var gY;let sC=gY=class extends Se{constructor(t){super(t)}clone(){return new gY({name:this.name,path:this.path,title:this.title})}};h([p({type:String,json:{write:!0}})],sC.prototype,"name",void 0),h([p({type:String,json:{write:!0}})],sC.prototype,"path",void 0),h([p({type:String,json:{write:!0}})],sC.prototype,"title",void 0),sC=gY=h([I("esri.webscene.TransportationNetwork")],sC);const NQe=sC;let ZP=class yY{constructor(e,i,r=""){this.major=e,this.minor=i,this._context=r}lessThan(e,i){return this.major<e||e===this.major&&this.minor<i}since(e,i){return!this.lessThan(e,i)}validate(e){if(this.major!==e.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new G(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new yY(this.major,this.minor,this._context)}static parse(e,i=""){const[r,s]=e.split("."),n=/^\s*\d+\s*$/;if(!(r!=null&&r.match)||!n.test(r))throw new G((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!(s!=null&&s.match)||!n.test(s))throw new G((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(r,10),a=parseInt(s,10);return new yY(o,a,i)}},Sz=class extends ZP{constructor(e,i){super(e,i,"webscene")}get supportsGround(){return this.since(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}},FQe=null;function kQe(){return FQe}var vMe;const hS=new Sz(1,34),UQe=()=>{const e=[],i=hS.major;for(let r=8;r<=hS.minor;r++)e.push(`${i}.${r}`);return e},KH="Web Scene";let Ar=class extends ey.LoadableMixin(dD(wre(TCe))){constructor(e){super(e),this[vMe]=!0,this._layersIdGCTimeoutId=void 0,this._updateFromPromise=null,this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.floorInfo=null,this.heightModelInfo=void 0,this.sourceVersion=null,this.transportationNetworks=null,this.presentation=new _Me,this.initialViewProperties=new xz,this.portalItem=null,this.resourceInfo=null,this.widgets=null,this._debouncedSaveOperations=q0(async(i,r,s)=>{switch(i){case Cg.SAVE:return this._saveImpl(r);case Cg.SAVE_AS:return this._saveAsImpl(s,r)}}),this._resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch(e=>{se.getLogger(this).error("#load()","Failed to load web scene",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(i){return void this.addResolvingPromise(Promise.reject(i))}this.read(e),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this.addHandles(Ks(()=>this.allLayers,"change",()=>this._scheduleLayersIdGC()))}destroy(){this._unscheduleLayersIdGC(),this.presentation&&this.presentation.destroy(),this.portalItem=qe(this.portalItem)}writeClippingArea(e,i){i.clippingArea||(i.clippingArea={}),i.clippingArea.geometry=e.toJSON()}readClippingEnabled(e,i){return!!i.clippingArea&&!!i.clippingArea.clip}writeClippingEnabled(e,i){this.clippingArea&&(i.clippingArea||(i.clippingArea={}),i.clippingArea.clip=e)}writeLayers(e,i,r,s){i[r]=this._layersToJSON(e,"operational-layers",s)}readSourceVersion(e,i){const[r,s]=i.version.split(".");return new Sz(parseInt(r,10),parseInt(s,10))}writeSourceVersion(e,i,r){i[r]=`${hS.major}.${hS.minor}`}writeTables(e,i,r,s){const n=this._layersToJSON(e,"tables",s);n.length&&(i[r]=n)}get thumbnailUrl(){var e;return((e=this.portalItem)==null?void 0:e.thumbnailUrl)??null}set thumbnailUrl(e){e?this._override("thumbnailUrl",e):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,i){e&&this._isAuthoringAppSetByUser?i.authoringApp=e:i.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,i){e&&this._isAuthoringAppVersionSetByUser?i.authoringAppVersion=e:i.authoringAppVersion=E2e}writeGround(e,i,r,s){i[r]=e?e.write({},s):{transparency:0,layers:[]}}readInitialViewProperties(e,i){var n,o,a;const r={};(n=i.initialState)!=null&&n.environment&&(r.environment=WA.fromJSON(i.initialState.environment)),r.spatialReference=i.spatialReference?Ze.fromJSON(i.spatialReference):Ze.WebMercator,r.viewingMode=i.viewingMode??"global",(o=i.initialState)!=null&&o.viewpoint&&(r.viewpoint=Zf.fromJSON(i.initialState.viewpoint));const s=(a=i.initialState)==null?void 0:a.timeExtent;return s!=null&&(r.timeExtent=$a.fromArray(s)),new xz(r)}get spatialReference(){var e;return((e=this.initialViewProperties)==null?void 0:e.spatialReference)??Ze.WebMercator}get viewingMode(){var e;return((e=this.initialViewProperties)==null?void 0:e.viewingMode)??"global"}load(e){const i=this.ground;return this.addResolvingPromise(this._loadFromSource().then(()=>{i&&i!==this.ground&&i.destroy()})),Promise.resolve(this)}loadAll(){return Zie(this,e=>{const i=this.presentation&&this.presentation.slides;e(this.ground,this.basemap,this.layers,i&&i.map(r=>r.basemap),this.tables)})}read(e,i){var n;i={...i,origin:"web-scene"};const r=this._isAuthoringAppVersionSetByUser,s=this._isAuthoringAppSetByUser;if(l2e(this,e,o=>super.read(e,o),i),s||(this._isAuthoringAppSetByUser=!1),r||(this._isAuthoringAppVersionSetByUser=!1),e.baseMap&&Array.isArray(e.baseMap.elevationLayers)&&((n=this.sourceVersion)==null?void 0:n.supportsVisibleElevationLayersInSlides)){const o=e.baseMap.elevationLayers.map(u=>({id:u.id})),a=this.presentation.slides,l=(u,d)=>u.visibleLayers.some(f=>f.id===d),c=o.filter(u=>!a.some(d=>l(d,u.id)));a.forEach(u=>{u.visibleLayers.addMany(c)})}}_writeBasemapElevationLayers(e){var r;const i=(r=e.ground)==null?void 0:r.layers;!e.baseMap&&(i!=null&&i.length)&&(e.baseMap={title:"Basemap",baseMapLayers:[]}),e.baseMap&&(e.baseMap.elevationLayers=ie(i))}_layersToJSON(e,i,r){const s={...r,layerContainerType:i};return e.map(n=>this._verifyWritableLayer(n,r)?n.write({},s):null).filter(n=>!!n).toArray()}_verifyWritableLayer(e,i){return!!e.persistenceEnabled&&("write"in e||(i!=null&&i.messages&&i.messages.push(new G("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in web scenes`,{layer:e})),!1))}write(e,i){var n;if(this.loadStatus!=="loaded"){const o=new G("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw se.getLogger(this).error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),o}this._runLayersIdGC();const r=!(i!=null&&i.messages);i={messages:[],...i,origin:"web-scene"};const s=super.write(e,i);if(r){const o=((n=i.messages)==null?void 0:n.filter(a=>a.name==="web-document-write:property-required"))??[];if(o.length){const a=new G("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:o});throw se.getLogger(this).error("#toJSON()","One or more properties that are required in the webscene JSON are missing",o),a}}return this._writeBasemapElevationLayers(s),s}async save(e){return this._debouncedSaveOperations(Cg.SAVE,e)}async _saveImpl(e){var n;if(!this.portalItem)throw new G("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene");if(The(this.portalItem),((n=this.portalItem)==null?void 0:n.type)!==KH)throw new G("webscene:portal-item-wrong-type",`Portal item needs to have type "${KH}"`);const i=this._updateFromPromise;await this._ensureLoadBeforeSave();const r=this._enableVerifyItemRelativeUrls(vhe(this.portalItem,"web-scene",!0)),s=this.write({},r);return await Promise.all(r.resources.pendingOperations),await this._verifySave(s,r,e),this._updateTypeKeywords(this.portalItem),await JJe(this.portalItem,s,this._resourceReferences,r),fhe(r),i&&await i,await this._saveThumbnail(),this.portalItem}async saveAs(e,i){return this._debouncedSaveOperations(Cg.SAVE_AS,i,e)}async _saveAsImpl(e,i){let r=iS.from(e);if(!r)throw new G("webscene:portal-item-required","saveAs requires a portal item to save to");The(r),r.id&&(r=r.clone(),r.id=null);const s=r.portal||Wn.getDefault();await this._ensureLoadBeforeSave(),r.type=KH,r.portal=s;const n=this._enableVerifyItemRelativeUrls(vhe(r,"web-scene",!0)),o=this.write({},n);await Promise.all(n.resources.pendingOperations),await this._verifySaveAs(o,n,i);const a=this.thumbnailUrl,l=!this._isOverridden("thumbnailUrl");if(this._updateTypeKeywords(r),await s.signIn(),!s.user)throw new G("webscene:user-not-signed-in","saveAs requires a user to be signed in to the portal");return await s.user.addItem({item:r,folder:i==null?void 0:i.folder,data:o}),await XJe(this._resourceReferences,n),this.portalItem=r,$Z.prototype.read.call(this,{version:o.version,authoringApp:o.authoringApp,authoringAppVersion:o.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:r.itemUrl?un(r.itemUrl):void 0}),fhe(n),a&&(this.thumbnailUrl=l?w2e(a,"w","8192"):a),n.portalItem=r,await this._saveThumbnail(),r}async _saveThumbnail(){var e;this._isOverridden("thumbnailUrl")&&(await((e=this.portalItem)==null?void 0:e.updateThumbnail({thumbnail:this.thumbnailUrl})),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}async _verifySave(e,i,r,s=!1){if(!RS(this.spatialReference))throw new G("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently.");const{ignoreUnsupported:n,requiredPropertyChecksDisabled:o,strictSchemaValidationEnabled:a}=r||{};KJe(i,{errorName:"webscene:save"},{ignoreUnsupported:n,supplementalUnsupportedErrors:["scenemodification:unsupported"],requiredPropertyChecksDisabled:o});const l=kQe();if(a&&l){const c=(await l()).validate(e);if(!c.length)return;const u=`webscene did not validate:
${c.join(`
`)}`;se.getLogger(this).error(`${s?"saveAs":"save"}(): ${u}`);const d=c.map(f=>new G("webscene:schema-validation",f));throw FJe(d)}}_verifySaveAs(e,i,r){return this.canNotSaveAs(i)?Promise.reject(NJe()):this._verifySave(e,i,r,!0)}verifySaveAs(e){const i=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),r=this.write({},i);return this._verifySaveAs(r,i,e)}canNotSaveAs(e){var i,r;return e||(e=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write({},e)),(((r=(i=e.verifyItemRelativeUrls)==null?void 0:i.writtenUrls)==null?void 0:r.length)??0)>0}async updateFrom(e,i={}){const r=this._updateFrom(e,i);this._updateFromPromise=r,await r,this._updateFromPromise===r&&(this._updateFromPromise=null)}async _updateFrom(e,i={}){var r;if(await e.whenReady(),!i.environmentExcluded&&e.environment&&(this.initialViewProperties.environment=WA.prototype.clone.apply(e.environment)),!i.viewpointExcluded&&e.viewpoint&&(this.initialViewProperties.viewpoint=e.viewpoint.clone()),this.initialViewProperties.spatialReference=e.spatialReference.clone(),this.initialViewProperties.viewingMode=e.viewingMode,this.initialViewProperties.timeExtent=((r=e.timeExtent)==null?void 0:r.clone())??null,e.clippingArea!=null?e.clippingArea!==this.clippingArea&&(this.clippingArea=e.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,e.heightModelInfo&&(this.heightModelInfo=e.heightModelInfo.clone()),e.map===this)for(const s of e.allLayerViews){const n="visible";n in s&&n in s.layer&&s._isOverridden(n)&&(s.layer[n]=s[n])}if(!i.widgetsExcluded)for(const s of e.persistableViewModels)s.updateWebDocument(this);(i.thumbnailExcluded===!1||i.thumbnailExcluded==null&&!i.viewpointExcluded)&&await this._updateFromThumbnail(e,i.thumbnailSize??void 0)}async _updateFromThumbnail(e,i){const r=tQe(e,i),s=await e.takeScreenshot({format:"jpg",width:r.width,height:r.height,disableDecorations:!0});this.thumbnailUrl=s.dataUrl}_loadFromSource(){var e;return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):(e=this.portalItem)!=null&&e.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()}_readAndLoadFromJSON(e,i){const r=this._validateJSON(e);return this.read(r,i),this._loadFromJSON(r,i)}_extractOperationalLayers(e){var n;const i=[];if(!((n=this.sourceVersion)!=null&&n.supportsGround)&&e.baseMap&&Array.isArray(e.baseMap.elevationLayers))for(const o of e.baseMap.elevationLayers)i.push(o);const r=[],s=o=>{var a;return o.layers&&(o.layers=o.layers.filter(s)),o.layerType!=="ArcGISTiledElevationServiceLayer"||((a=this.sourceVersion)!=null&&a.supportsGround||r.push(o),!1)};return{operationalLayers:e.operationalLayers?e.operationalLayers.filter(s):[],operationalElevationLayers:r,basemapElevationLayers:i}}async _loadFromJSON(e,i){var u;const r=new st;await this._validateSpatialReference(),await this._validateHeightModelInfo();const{populateOperationalLayers:s}=await ce(()=>import("./layersCreator-q6m_1vHJ.js"),__vite__mapDeps([6,7,8,9])),{operationalLayers:n,operationalElevationLayers:o,basemapElevationLayers:a}=this._extractOperationalLayers(e),l=[],c={context:{...i,layerContainerType:"operational-layers"}};if(this.portalItem&&(c.context.portal=this.portalItem.portal||Wn.getDefault()),a.length>0){const d={...c,context:{...c.context,layerContainerType:"ground"}};d.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(s(this.ground.layers,a,d))}if(o.length>0){const d={...c,context:{...c.context,layerContainerType:"ground"}};d.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(s(r,o,d))}n&&n.length>0&&l.push(s(this.layers,n,c)),(u=e.tables)!=null&&u.length&&l.push(s(this.tables,e.tables,{...c,context:{...c.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"})),await Promise.allSettled(l),await this._loadObjectsWithLayers(),this.ground.layers.addMany(r.filter(d=>d.type==="base-elevation"||d.type==="elevation"))}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const e=[],i=[...this.allLayers.items];for(const{basemap:r}of this.presentation.slides.items)r&&(i.push(...r.baseLayers.items),i.push(...r.referenceLayers.items));for(const r of i)if("beforeSave"in r&&typeof r.beforeSave=="function"){const s=r.beforeSave();s&&e.push(s)}await Promise.allSettled(e)}async _loadObjectsWithLayers(){const e=[];this.ground&&e.push(this.ground.load()),this.basemap&&e.push(this.basemap.load()),this.presentation.slides.forEach(i=>{i.basemap&&e.push(i.basemap.load())}),await Promise.allSettled(e)}async _loadFromItem(e){if(await e.load().catch(s=>{throw new G("webscene:load-portal-item","Failed to load portal item",{error:s})}),e.type!=="Web Scene")throw new G("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:e.type});const i=await e.fetchData();this.resourceInfo=i;const r={origin:"web-scene",url:un(e.itemUrl),portal:e.portal||Wn.getDefault(),portalItem:e,readResourcePaths:[]};await this._readAndLoadFromJSON(i,r),this._resourceReferences={portalItem:e,paths:r.readResourcePaths??[]}}_validateSpatialReference(){const e=this.initialViewProperties,i=this._sceneSpatialReference;let r;if(e.viewingMode!=="local"){if(!cL(i,Xe.Global))return Promise.reject(new G("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:i,viewingMode:e.viewingMode}));r=l=>!l||Bc(l,i)}else{if(!cL(i,Xe.Local))return Promise.reject(new G("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:i,viewingMode:e.viewingMode}));r=l=>!l||l.equals(i)}const s=l=>{var c,u;return((c=l==null?void 0:l.camera)==null?void 0:c.position.spatialReference)??((u=l==null?void 0:l.targetGeometry)==null?void 0:u.spatialReference)},n=e.viewpoint,o=s(n);if(o&&!r(o))return Promise.reject(new G("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:o,sceneSpatialReference:i,viewingMode:e.viewingMode}));const a=this.presentation.slides.find(l=>!r(s(l.viewpoint)));if(a){const l=s(a.viewpoint);return Promise.reject(new G("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:l,sceneSpatialReference:i,viewingMode:e.viewingMode}))}return Promise.resolve()}_validateHeightModelInfo(){const e=this._sceneSpatialReference,i=wJe(this.heightModelInfo,e);return i?Promise.reject(i):Promise.resolve()}_validateJSON(e){const i=Sz.parse(e.version||"","webscene");return hS.validate(i),e.version=`${i.major}.${i.minor}`,i.major===1&&i.minor<=2&&(e.spatialReference=Ze.WebMercator.toJSON()),e}_updateTypeKeywords(e){bhe(e,VZ.LOCAL_SCENE,this.initialViewProperties.viewingMode==="local"),bhe(e,VZ.DEVELOPER_BASEMAP,Kue(this.basemap)||this.presentation.slides.some(({basemap:i})=>!!i&&Kue(i))),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((i,r,s)=>s.indexOf(i)===r))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||Ze.WebMercator}get _verifyItemRelativeRootPath(){var e;return(e=this.portalItem)!=null&&e.itemUrl?un(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(e){const i=this._verifyItemRelativeRootPath;return i&&(e.verifyItemRelativeUrls={rootPath:i,writtenUrls:[]}),e}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout(()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()},3e3)}_runLayersIdGC(){var s,n;this._unscheduleLayersIdGC();const e=(n=(s=this.applicationProperties)==null?void 0:s.viewing)==null?void 0:n.search,i=o=>this.allLayers.some(a=>a.id===o&&a.persistenceEnabled);e!=null&&e.layers&&(e.layers=e.layers.filter(o=>i(o.id)));const r=this.presentation&&this.presentation.slides;r&&r.forEach(o=>{o.visibleLayers&&(o.visibleLayers=o.visibleLayers.filter(a=>i(a.id)))})}static fromJSON(e){if(!e)throw new G("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}};vMe=IJe,Ar.version=`${hS.major}.${hS.minor}`,h([p({type:lQe,json:{write:!0}})],Ar.prototype,"applicationProperties",void 0),h([p({type:ur,json:{read:{source:"clippingArea.geometry",reader:ty},write:{target:"clippingArea.geometry"}}})],Ar.prototype,"clippingArea",void 0),h([We("clippingArea")],Ar.prototype,"writeClippingArea",null),h([p({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],Ar.prototype,"clippingEnabled",void 0),h([ze("clippingEnabled",["clippingArea"])],Ar.prototype,"readClippingEnabled",null),h([We("clippingEnabled")],Ar.prototype,"writeClippingEnabled",null),h([p({type:$Je,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],Ar.prototype,"floorInfo",void 0),h([p({type:qb,json:{write:!0}})],Ar.prototype,"heightModelInfo",void 0),h([p({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],Ar.prototype,"layers",void 0),h([We("layers")],Ar.prototype,"writeLayers",null),h([p({readOnly:!0,type:Sz,json:{type:UQe(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],Ar.prototype,"sourceVersion",void 0),h([ze("sourceVersion",["version"])],Ar.prototype,"readSourceVersion",null),h([We("sourceVersion")],Ar.prototype,"writeSourceVersion",null),h([p({json:{read:!1,write:{enabled:!0,ignoreOrigin:!0}}})],Ar.prototype,"tables",void 0),h([We("tables")],Ar.prototype,"writeTables",null),h([p()],Ar.prototype,"thumbnailUrl",null),h([p({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],Ar.prototype,"authoringApp",null),h([We("authoringApp")],Ar.prototype,"writeAuthoringApp",null),h([p({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],Ar.prototype,"authoringAppVersion",null),h([We("authoringAppVersion")],Ar.prototype,"writeAuthoringAppVersion",null),h([p({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],Ar.prototype,"ground",void 0),h([We("ground")],Ar.prototype,"writeGround",null),h([p({type:st.ofType(NQe),json:{write:!0}})],Ar.prototype,"transportationNetworks",void 0),h([p({type:_Me,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(t,e,i,r)=>{if(t.slides&&t.slides.length>0){const s={...r,isPresentation:!0};e.presentation=t.write({},s)}}}}})],Ar.prototype,"presentation",void 0),h([p({type:xz,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new xz({viewingMode:"global",spatialReference:Ze.WebMercator})}})],Ar.prototype,"initialViewProperties",void 0),h([ze("initialViewProperties",["initialState.timeExtent","initialState.environment","initialState.viewpoint","spatialReference","viewingMode"])],Ar.prototype,"readInitialViewProperties",null),h([p({type:Ze,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],Ar.prototype,"spatialReference",null),h([p({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],Ar.prototype,"viewingMode",null),h([p({type:iS})],Ar.prototype,"portalItem",void 0),h([p()],Ar.prototype,"resourceInfo",void 0),h([p({type:zJe,json:{write:!0}})],Ar.prototype,"widgets",void 0),Ar=h([I("esri.WebScene")],Ar);const Lhe=Ar;function pG(t){return typeof t=="string"?document.getElementById(t):t??null}function bMe(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function Dhe(t,e){const i=e.parentNode;i&&i.insertBefore(t,e)}function Nhe(t,e){for(;;){const i=t.firstChild;if(!i)break;e.appendChild(i)}}let Ez=class{constructor(e=i=>i.values().next().value){this._peeker=e,this._observable=new BP,this._items=new Set}get length(){return Ft(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return Ft(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const i=this.length;return this._items.forEach(r=>{e(r)||this._items.delete(r)}),i!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){Ft(this._observable),yield*this._items}};const wMe=new FinalizationRegistry(t=>{t.close()});function VQe(t,e){wMe.register(t,e,e)}function zQe(t){wMe.unregister(t)}function xMe(t,e){return new Proxy({},{get:(i,r,s)=>(...n)=>{let o,a;const l=n[n.length-1];return BQe(l)&&(o=l.signal,a=l.transferList,n.pop()),t.apply(e?`${e}.${r.toString()}`:r.toString(),n,{transferList:a,signal:o})}})}function BQe(t){return typeof t=="object"&&!Array.isArray(t)&&t!=null&&("signal"in t||"transferList"in t||Object.keys(t).length===0)}const jQe={statsWorker:()=>ce(()=>import("./statsWorker-CjocTzNn.js"),__vite__mapDeps([11,12,13,14])),geometryEngineWorker:()=>ce(()=>import("./geometryEngineWorker-CKk-C6o_.js"),__vite__mapDeps([15,16,17,18])),CSVSourceWorker:()=>ce(()=>import("./CSVSourceWorker-CuplZY0G.js"),__vite__mapDeps([19,20,18,21,22,23,24,25,26,27,28,12,13,14,29,30,31])),EdgeProcessingWorker:()=>ce(()=>import("./EdgeProcessingWorker-BGJkcMEJ.js"),__vite__mapDeps([32,33])),ElevationSamplerWorker:()=>ce(()=>import("./ElevationSamplerWorker-Bf0vSF0t.js"),__vite__mapDeps([34,23,24,35])),FeatureServiceSnappingSourceWorker:()=>ce(()=>import("./FeatureServiceSnappingSourceWorker-BcjG1k-W.js"),__vite__mapDeps([36,21,22,23,24,25,26,27,18,28,12,13,14,29,37])),GeoJSONSourceWorker:()=>ce(()=>import("./GeoJSONSourceWorker-D-1ebYWY.js"),__vite__mapDeps([38,21,22,23,24,25,26,27,18,28,12,13,14,29,39,20,31,40])),LercWorker:()=>ce(()=>import("./LercWorker-CmUwmQB0.js"),[]),MemorySourceWorker:()=>ce(()=>import("./MemorySourceWorker-B4kn_uXo.js"),__vite__mapDeps([41,42,21,22,23,24,25,26,27,18,28,12,13,14,29,31,40,20])),PBFDecoderWorker:()=>ce(()=>import("./PBFDecoderWorker-GMMLcwvx.js"),[]),FeaturePipelineWorker:()=>ce(()=>import("./FeaturePipelineWorker-DVtJw8cq.js"),__vite__mapDeps([43,44,45,46,25,26,27,18,28,12,13,14,29,24,47,39,20,31,40,48,49])),PointCloudWorker:()=>ce(()=>import("./PointCloudWorker-CPdZzLBS.js"),__vite__mapDeps([50,51,52,53])),RasterWorker:()=>ce(()=>import("./RasterWorker-DQbFZiH8.js"),__vite__mapDeps([54,55,56,57])),SceneLayerSnappingSourceWorker:()=>ce(()=>import("./SceneLayerSnappingSourceWorker-BAjmsOw2.js"),[]),SceneLayerWorker:()=>ce(()=>import("./SceneLayerWorker-DF2boA8b.js").then(t=>t.S),__vite__mapDeps([58,59,60,53])),WFSSourceWorker:()=>ce(()=>import("./WFSSourceWorker-FB0LPC9c.js"),__vite__mapDeps([61,21,22,23,24,25,26,27,18,28,12,13,14,29,39,20,40,62,63])),WorkerTileHandler:()=>ce(()=>import("./WorkerTileHandler-C3oZ5teP.js"),__vite__mapDeps([64,46,44,65])),Lyr3DWorker:()=>ce(()=>import("./Lyr3DWorker-BWYoxj9q.js"),__vite__mapDeps([66,67,68]))},TMe="worker:port-closed";var Ca;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(Ca||(Ca={}));let GQe=0;function SMe(){return GQe++}function HQe(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function uL(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function $re(t,e,i,r){if(e.type===Ca.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==Ca.INVOKE&&e.type!==Ca.RESPONSE)return void t.postMessage(e);let s;if(HQe(i)?(s=Fhe(i.transferList),e.data=i.result):(s=Fhe(r),e.data=i),s){if(le("ff")){for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case Ca.INVOKE:throw o;case Ca.RESPONSE:return void $re(t,{type:Ca.RESPONSE,jobId:e.jobId,error:uL(o)})}}}t.postMessage(e,s)}else t.postMessage(e)}function hL(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function Fhe(t){if(!(t!=null&&t.length))return null;if(le("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(i=>!qQe(i));return e.length?e:null}function qQe(t){var e;return t instanceof ArrayBuffer||((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="ArrayBuffer"}async function k9t(t){try{return await t}catch(e){const i=(e==null?void 0:e.name)===TMe;if(!(os(e)||i))throw e;return}}const{CLOSE:khe,ABORT:Uhe,INVOKE:Vhe,RESPONSE:OO,OPEN_PORT:zhe,ON:WQe}=Ca,ZQe=2;let YQe=class{constructor(e){this._invoke=e,this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._timer=null,this._process=this._process.bind(this)}push(e){e.type===Ca.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},Eb=class nC{static connect(e,i){const r=new MessageChannel;let s;s=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const n=new nC(r.port1,{channel:r,client:s,schedule:i});return typeof s=="object"&&"remoteClient"in s&&(s.remoteClient=n),nC.clients.set(n,s),r.port2}static loadWorker(e){const i=jQe[e];return i?i():Promise.resolve(null)}constructor(e,i,r){this._port=e,this._jobQueue=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new YQe(s=>this._onInvokeMessage(s)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:khe}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,i,r){return this.apply(e,[i],r)}apply(e,i,r){const s=r==null?void 0:r.signal,n=r==null?void 0:r.transferList;if(!this._port)return Promise.reject(new G(TMe,`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:i}));const o=SMe();return new Promise((a,l)=>{if(ra(s))return this._processWork(),void l(ki());const c=Ra(s,()=>{const d=this._outJobs.get(o);d&&(this._outJobs.delete(o),this._processWork(),$r(d.abortHandle),this._post({type:Uhe,jobId:o}),l(ki()))}),u={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,u),this._post({type:Vhe,jobId:o,methodName:e,abortable:s!=null},i,n)})}createInvokeProxy(e){return xMe(this,e)}on(e,i){const r=new MessageChannel;function s(n){i(n.data)}return this._port.postMessage({type:Ca.ON,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",s),r.port1.start(),Gi(()=>{r.port1.postMessage({type:Ca.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",s)})}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:zhe,port:e.port2}),e.port1}_processWork(){var o;if(this._outJobs.size>=ZQe)return;const e=(o=this._jobQueue)==null?void 0:o.pop();if(!e)return;const{methodName:i,data:r,invokeOptions:s,resolver:n}=e;this.apply(i,r,s).then(a=>n.resolve(a)).catch(a=>n.reject(a))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{$r(e.abortHandle),e.reject(ki(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e,!0)):this._processMessage(e,!1)}_processMessage(e,i){const r=hL(e);if(r)switch(r.type){case OO:this._onResponseMessage(r);break;case Vhe:i?this._onInvokeMessage(r):this._invokeQueue.push(r);break;case Uhe:this._onAbortMessage(r);break;case khe:this._onCloseMessage();break;case zhe:this._onOpenPortMessage(r);break;case WQe:this._onOnMessage(r)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,s=i.get(r);this._invokeQueue.push(e),s&&(s.controller&&s.controller.abort(),i.delete(r))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&nC.clients.get(this)===e&&e.destroy(),nC.clients.delete(this),e!=null&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:i,jobId:r,data:s=[],abortable:n}=e,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,u=c[i];try{if(!u&&i&&i.includes(".")){const d=i.split(".");for(let f=0;f<d.length-1;f++)c=c[d[f]],u=c[d[f+1]]}if(typeof u!="function")throw new TypeError(`${i} is not a function`);s.push({client:this,signal:o?o.signal:null}),l=u.apply(c,s)}catch(d){return void this._post({type:OO,jobId:r,error:uL(d)})}Fu(l)?(a.set(r,{controller:o,promise:l}),l.then(d=>{a.has(r)&&(a.delete(r),this._post({type:OO,jobId:r},d))},d=>{a.has(r)&&(a.delete(r),os(d)||this._post({type:OO,jobId:r,error:uL(d||{message:`Error encountered at method ${i}`})}))})):this._post({type:OO,jobId:r},l)}_onOpenPortMessage(e){new nC(e.port,{client:this._client})}_onOnMessage(e){const{port:i}=e,r=this._client.on(e.eventType,n=>{i.postMessage(n)}),s=kP(e.port,"message",n=>{const o=hL(n);(o==null?void 0:o.type)===Ca.CLOSE&&(s.remove(),r.remove(),i.close())})}_onResponseMessage(e){const{jobId:i,error:r,data:s}=e,n=this._outJobs;if(!n.has(i))return;const o=n.get(i);n.delete(i),this._processWork(),$r(o.abortHandle),r?o.reject(G.fromJSON(JSON.parse(r))):o.resolve(s)}_post(e,i,r){return $re(this._port,e,i,r)}};Eb.kernelInfo={buildDate:T2e,fullVersion:Bie,revision:S2e},Eb.clients=new Map;let XQe=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new Ez}destroy(){this.close()}get closed(){var e;return!((e=this._clients)!=null&&e.length)}open(e,i){return new Promise((r,s)=>{let n=!0;const o=a=>{Dt(i.signal),n&&(n=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];Fu(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new Eb(c,i,this._ongoingJobsQueue),o(r),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new Eb(l,i,this._ongoingJobsQueue),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}})}broadcast(e,i,r){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a==null?void 0:a.invoke(e,i,r))}return s}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(ki(`Worker closing, aborting job calling '${e.methodName}'`));for(const i of this._clientPromises)i.then(r=>r==null?void 0:r.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,zQe(this)}invoke(e,i,r){return this.apply(e,[i],r)}apply(e,i,r){const s=aa();this._ongoingJobsQueue.push({methodName:e,data:i,invokeOptions:r,resolver:s});for(let n=0;n<this._clientPromises.length;n++){const o=this._clients[n];o?o.jobAdded():this._clientPromises[n].then(a=>a==null?void 0:a.jobAdded())}return s.promise}createInvokeProxy(e){return xMe(this,e)}on(e,i){return Promise.all(this._clientPromises).then(()=>ES(this._clients.map(r=>r.on(e,i))))}openPorts(){return new Promise(e=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(i[s]=n.openPort()),--r==0&&e(i)})})}get test(){}};const JQe={async request(t,e){var o,a;const i=t.options,r=i.responseType;i.signal=e==null?void 0:e.signal,i.responseType=r==="native"||r==="native-request-init"?"native-request-init":r&&["blob","json","text"].includes(r)&&((o=JW(t.url))!=null&&o.after)?r:"array-buffer";const s=await yr(t.url,i),n={data:s.data,httpStatus:s.httpStatus,ssl:s.ssl};switch((a=s.requestOptions)==null?void 0:a.responseType){case"native-request-init":return delete n.data.signal,n;case"blob":n.data=await n.data.arrayBuffer();break;case"json":n.data=new TextEncoder().encode(JSON.stringify(n.data)).buffer;break;case"text":n.data=new TextEncoder().encode(n.data).buffer}return{result:n,transferList:[n.data]}}},Bhe={};function QQe(t){var i;const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:((i=t.packages)==null?void 0:i.concat())||[],paths:{...Bhe.paths,...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=Bhe.baseUrl),e}let KQe=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>e[i](...r)})}},Sk=class{constructor(){this._dispatcher=new KQe,this._workerPostMessage({type:Ca.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){EA(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,i,r){this._dispatcher.addEventListener(e,i,r)}removeEventListener(e,i,r){this._dispatcher.removeEventListener(e,i,r)}_workerPostMessage(e){EA(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const i=hL(e);if(i&&i.type===Ca.OPEN){const{modulePath:r,jobId:s}=i;let n=await Eb.loadWorker(r);n||(n=await import(r));const o=Eb.connect(n);this._workerPostMessage({type:Ca.OPENED,jobId:s,data:o})}}};const _Y=()=>se.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:eKe}=Ca,tKe='let globalId=0;const outgoing=new Map,configuration={CONFIGURATION};self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;let s=null;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());s=()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))},t.addEventListener("abort",s)}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})})).finally((()=>{t&&t.removeEventListener("abort",s)}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\nModules version: ${r}\nAssets version: ${n??s}\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let YN,XN;const jhe="Failed to create Worker. Fallback to execute module in main thread";async function iKe(){if(!le("esri-workers"))return Ghe(new Sk);if(!YN&&!XN)try{const e=tKe.split("{CONFIGURATION}").join(rKe());YN=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){XN=e||{}}let t;if(YN)try{t=new Worker(YN,{name:"esri-worker-"+sKe++})}catch{_Y().warn(jhe,XN),t=new Sk}else _Y().warn(jhe,XN),t=new Sk;return Ghe(t)}async function Ghe(t){return new Promise(e=>{function i(s){const n=hL(s);n&&n.type===eKe&&(t.removeEventListener("message",i),t.removeEventListener("error",r),e(t))}function r(s){s.preventDefault(),t.removeEventListener("message",i),t.removeEventListener("error",r),_Y().warn("Failed to create Worker. Fallback to execute module in main thread",s),(t=new Sk).addEventListener("message",i),t.addEventListener("error",r)}t.addEventListener("message",i),t.addEventListener("error",r)})}function rKe(){let t;if(rr.default!=null){const s={...rr};delete s.default,t=JSON.parse(JSON.stringify(s))}else t=JSON.parse(JSON.stringify(rr));t.assetsPath=Tu(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?Tu(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=Ou(),t.has={"esri-csp-restrictions":le("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":le("esri-2d-update-debug"),"esri-2d-log-updating":le("esri-2d-log-updating"),"featurelayer-pbf":le("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":le("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":le("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":le("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":le("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":le("featurelayer-query-max-depth"),"featurelayer-query-pausing-enabled":le("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-enabled":le("featurelayer-snapshot-enabled"),"esri-atomics":le("esri-atomics"),"esri-shared-array-buffer":le("esri-shared-array-buffer"),"esri-tiles-debug":le("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":le("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":le("feature-polyline-generalization-factor"),"host-webworker":1},t.workers.loaderUrl&&(t.workers.loaderUrl=Tu(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=Tu(t.workers.workerPath):t.workers.workerPath=Tu(mr("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=rr.workers.loaderConfig,i=QQe({baseUrl:e==null?void 0:e.baseUrl,locale:Ou(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:t,loaderConfig:i,kernelInfo:{buildDate:T2e,fullVersion:Bie,revision:S2e}})}let sKe=0;const{ABORT:Hhe,INVOKE:nKe,OPEN:oKe,OPENED:aKe,RESPONSE:RO}=Ca;let lKe=class EMe{static async create(e){const i=await iKe();return new EMe(i,e)}constructor(e,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=i,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",r=>{r.preventDefault(),se.getLogger("esri.core.workers.WorkerOwner").error(r)})}terminate(){this.worker.terminate()}async open(e,i={}){const{signal:r}=i,s=SMe();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:oD(r,()=>{this._outJobs.delete(s),this._post({type:Hhe,jobId:s})})};this._outJobs.set(s,a),this._post({type:oKe,jobId:s,modulePath:e})})}_onMessage(e){const i=hL(e);if(i)switch(i.type){case aKe:this._onOpenedMessage(i);break;case RO:this._onResponseMessage(i);break;case Hhe:this._onAbortMessage(i);break;case nKe:this._onInvokeMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,s=i.get(r);s&&(s.controller&&s.controller.abort(),i.delete(r))}_onInvokeMessage(e){const{methodName:i,jobId:r,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs,l=JQe[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(u){return void this._post({type:RO,jobId:r,error:uL(u)})}Fu(c)?(a.set(r,{controller:o,promise:c}),c.then(u=>{a.has(r)&&(a.delete(r),this._post({type:RO,jobId:r},u))},u=>{a.has(r)&&(a.delete(r),u||(u={message:"Error encountered at method"+i}),os(u)||this._post({type:RO,jobId:r,error:uL(u||{message:`Error encountered at method ${i}`})}))})):this._post({type:RO,jobId:r},c)}_onOpenedMessage(e){const{jobId:i,data:r}=e,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),$r(s.abortHandle),s.resolve(r))}_onResponseMessage(e){const{jobId:i,error:r,data:s}=e,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),$r(n.abortHandle),r?n.reject(G.fromJSON(JSON.parse(r))):n.resolve(s))}_post(e,i,r){return $re(this.worker,e,i,r)}};const qhe=le("host-browser")?Math.min(navigator.hardwareConcurrency-1,le("workers-pool-size")):0;let IT=le("esri-mobile")?Math.min(qhe,3):qhe;IT||(IT=le("safari")&&le("mac")?7:2);let Whe=0;const Ek=[];function cKe(){CMe()}async function JN(t,e){const i=new XQe,{registryTarget:r,...s}=e;return await i.open(t,s),r&&VQe(r,i),i}async function uKe(t,e={}){if(typeof t!="string")throw new G("workers:undefined-module","modulePath is missing");let i=e.strategy||"distributed";if(le("host-webworker")&&!le("esri-workers")&&(i="local"),i==="local"){let r=await Eb.loadWorker(t);r||(r=await import(t)),Dt(e.signal);const s=e.client||r;return JN([Eb.connect(r,e.schedule)],{...e,client:s})}if(await CMe(),Dt(e.signal),i==="dedicated"){const r=Whe++%IT;return JN([await Ek[r].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const r=Math.min(e.maxNumWorkers,IT);if(r<IT){const s=new Array(r);for(let n=0;n<r;++n){const o=Whe++%IT;s[n]=Ek[o].open(t,e)}return JN(s,e)}}return JN(Ek.map(r=>r.open(t,e)),e)}let QN=null;async function CMe(){if(QN)return QN;new AbortController;const t=[];for(let e=0;e<IT;e++){const i=lKe.create(e).then(r=>(Ek[e]=r,r));t.push(i)}return QN=Promise.all(t),QN}function MMe(t,e){const i=hl(t),r=hl(e),s=i.store,n=r.store,o=r.metadata;for(const a in o){const l=o[a],c=s.originOf(a),u=n.originOf(a);if(!l.readOnly&&u!==Fi.DEFAULTS)if(c===Fi.DEFAULTS)t.set(a,n.get(a));else{const d=s.get(a),f=n.get(a);d&&f&&f instanceof Ue&&d instanceof Ue&&d instanceof f.constructor&&MMe(d,f)}}}let QI=class extends st{constructor(e){super(e),this.addHandles([this.on("before-add",i=>{i.item==null&&i.preventDefault()}),this.on("after-add",i=>this._own(i.item)),this.on("after-remove",i=>this._release(i.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(st.ofType(this.itemType.Type))(e):new st(e)}};function vY(t,e){return{type:t,cast:Hie,set(i){const r=Kg(i,this._get(e),t);r.owner=this,this._set(e,r)}}}h([p()],QI.prototype,"owner",null),QI=h([I("esri.core.support.OwningCollection")],QI);function fG(t,e,i,r){return t!=null&&(hs(e,r)?(l_(i,t),!0):(Hc[0]=t[0],Hc[1]=t[1],Hc[2]=0,!!ds(Hc,e,0,Hc,r,0,1)&&(i[0]=Hc[0],i[1]=Hc[1],Hc[0]=t[2],Hc[1]=t[3],Hc[2]=0,!!ds(Hc,e,0,Hc,r,0,1)&&(i[2]=Hc[0],i[3]=Hc[1],!0))))}const Hc=E();function pl(t,e,i,r){if(Bc(t.spatialReference,i)){KN[0]=t.x,KN[1]=t.y;const n=t.z;return KN[2]=n??r??0,ds(KN,t.spatialReference,0,e,i,0,1)}const s=Tb(t,i);return!!s&&(e[0]=s==null?void 0:s.x,e[1]=s==null?void 0:s.y,e[2]=(s==null?void 0:s.z)??r??0,!0)}async function Cz(t,e,i,r,s){return await qP(t.spatialReference,i,null,s),pl(t,e,i,r)}const KN=E();let x_=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&EA(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*Zhe);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,Zhe));e++)this._items.push(this._allocator())}};const Zhe=1024;function ke(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function YA(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function Ire(t,e,i,r,s,n,o,a,l,c,u,d,f,m,g,y){return[t,e,i,r,s,n,o,a,l,c,u,d,f,m,g,y]}function hKe(t,e){return new Float64Array(t,e,16)}const Wr=ke();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Wr,clone:YA,create:ke,createView:hKe,fromValues:Ire},Symbol.toStringTag,{value:"Module"}));function Yr(){return[1,0,0,0,1,0,0,0,1]}function AMe(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function KI(t,e,i,r,s,n,o,a,l){return[t,e,i,r,s,n,o,a,l]}function dKe(t,e){return new Float64Array(t,e,9)}const _2=Yr();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:_2,clone:AMe,create:Yr,createView:dKe,fromValues:KI},Symbol.toStringTag,{value:"Module"}));function qh(){return[0,0,0,1]}function pKe(t){return[t[0],t[1],t[2],t[3]]}function fKe(t,e,i,r){return[t,e,i,r]}function mKe(t,e){return new Float64Array(t,e,4)}const Lre=qh();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Lre,clone:pKe,create:qh,createView:mKe,fromValues:fKe},Symbol.toStringTag,{value:"Module"}));function mt(){return[0,0]}function QR(t){return[t[0],t[1]]}function Ei(t,e){return[t,e]}function PMe(t,e=mt()){const i=Math.min(2,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function gKe(t,e){return new Float64Array(t,e,2)}function OMe(){return mt()}function RMe(){return Ei(1,1)}function $Me(){return Ei(1,0)}function IMe(){return Ei(0,1)}const jS=OMe(),mG=RMe(),LMe=$Me(),yKe=IMe();Object.freeze(Object.defineProperty({__proto__:null,ONES:mG,UNIT_X:LMe,UNIT_Y:yKe,ZEROS:jS,clone:QR,create:mt,createView:gKe,fromArray:PMe,fromValues:Ei,ones:RMe,unitX:$Me,unitY:IMe,zeros:OMe},Symbol.toStringTag,{value:"Module"}));function ci(){return[0,0,0,0]}function xD(t){return[t[0],t[1],t[2],t[3]]}function ii(t,e,i,r){return[t,e,i,r]}function dL(t,e=ci()){const i=Math.min(4,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function _Ke(t,e){return new Float64Array(t,e,4)}function DMe(){return ci()}function NMe(){return ii(1,1,1,1)}function FMe(){return ii(1,0,0,0)}function kMe(){return ii(0,1,0,0)}function UMe(){return ii(0,0,1,0)}function VMe(){return ii(0,0,0,1)}const Rh=DMe(),Ud=NMe(),vKe=FMe(),bKe=kMe(),wKe=UMe(),xKe=VMe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Ud,UNIT_W:xKe,UNIT_X:vKe,UNIT_Y:bKe,UNIT_Z:wKe,ZEROS:Rh,clone:xD,create:ci,createView:_Ke,fromArray:dL,fromValues:ii,ones:NMe,unitW:VMe,unitX:FMe,unitY:kMe,unitZ:UMe,zeros:DMe},Symbol.toStringTag,{value:"Module"}));let YP=class fx{constructor(e){this._create=e,this._items=new Array,this._itemsPtr=0}get(){return this._itemsPtr===0&&EA(()=>this._reset()),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const e=2*this._itemsPtr;this._items.length>e&&(this._items.length=e),this._itemsPtr=0}static createVec2f64(){return new fx(mt)}static createVec3f64(){return new fx(E)}static createVec4f64(){return new fx(ci)}static createMat3f64(){return new fx(Yr)}static createMat4f64(){return new fx(ke)}static createQuatf64(){return new fx(qh)}get test(){}};const H9t=YP.createVec2f64(),it=YP.createVec3f64(),Dre=YP.createVec4f64();YP.createMat3f64();const Nre=YP.createMat4f64(),TKe=YP.createQuatf64();function im(t){return t?{origin:hn(t.origin),vector:hn(t.vector)}:{origin:E(),vector:E()}}function SKe(t,e){const i=CKe.get();return i.origin=t,i.vector=e,i}function q9t(t,e=im()){return EKe(t.origin,t.vector,e)}function EKe(t,e,i=im()){return ve(i.origin,t),ve(i.vector,e),i}function dS(t,e,i=im()){return ve(i.origin,t),Re(i.vector,e,t),i}function Fre(t,e){const i=Re(it.get(),e,t.origin),r=Te(t.vector,i),s=Te(t.vector,t.vector),n=Ne(r/s,0,1),o=Re(it.get(),he(it.get(),t.vector,n),i);return Te(o,o)}function W9t(t,e,i){return bY(t,e,0,1,i)}function Z9t(t,e,i){return Ee(i,t.origin,he(i,t.vector,e))}function bY(t,e,i,r,s){const{vector:n,origin:o}=t,a=Re(it.get(),e,o),l=Te(n,a)/sl(n);return he(s,n,Ne(l,i,r)),Ee(s,s,t.origin)}function Y9t(t,e){if(BMe(t,SKe(e.origin,e.direction),!1,Mz)){const{tA:i,pB:r,distance2:s}=Mz;if(i>=0&&i<=1)return s;if(i<0)return uo(t.origin,r);if(i>1)return uo(Ee(it.get(),t.origin,t.vector),r)}return null}function zMe(t,e,i){return!!BMe(t,e,!0,Mz)&&(ve(i,Mz.pA),!0)}function BMe(t,e,i,r){const n=t.origin,o=Ee(it.get(),n,t.vector),a=e.origin,l=Ee(it.get(),a,e.vector),c=it.get(),u=it.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],u[0]=l[0]-a[0],u[1]=l[1]-a[1],u[2]=l[2]-a[2],Math.abs(u[0])<1e-6&&Math.abs(u[1])<1e-6&&Math.abs(u[2])<1e-6)return!1;const d=it.get();if(d[0]=o[0]-n[0],d[1]=o[1]-n[1],d[2]=o[2]-n[2],Math.abs(d[0])<1e-6&&Math.abs(d[1])<1e-6&&Math.abs(d[2])<1e-6)return!1;const f=c[0]*u[0]+c[1]*u[1]+c[2]*u[2],m=u[0]*d[0]+u[1]*d[1]+u[2]*d[2],g=c[0]*d[0]+c[1]*d[1]+c[2]*d[2],y=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],v=(d[0]*d[0]+d[1]*d[1]+d[2]*d[2])*y-m*m;if(Math.abs(v)<1e-6)return!1;let b=(f*m-g*y)/v,w=(f+m*b)/y;i&&(b=Ne(b,0,1),w=Ne(w,0,1));const x=it.get(),S=it.get();return x[0]=n[0]+b*d[0],x[1]=n[1]+b*d[1],x[2]=n[2]+b*d[2],S[0]=a[0]+w*u[0],S[1]=a[1]+w*u[1],S[2]=a[2]+w*u[2],r.tA=b,r.tB=w,r.pA=x,r.pB=S,r.distance2=uo(x,S),!0}const Mz={tA:0,tB:0,pA:E(),pB:E(),distance2:0},CKe=new x_(()=>im());function Hd(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function MKe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function _s(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function kre(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function jMe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function GMe(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function HMe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function AKe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function PKe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function OKe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t}function RKe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t}function $Ke(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function GS(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function IKe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}function qMe(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(i*i+r*r+s*s+n*n)}function Az(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return i*i+r*r+s*s+n*n}function Ure(t){const e=t[0],i=t[1],r=t[2],s=t[3];return Math.sqrt(e*e+i*i+r*r+s*s)}function Vre(t){const e=t[0],i=t[1],r=t[2],s=t[3];return e*e+i*i+r*r+s*s}function LKe(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function DKe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function WMe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3];let o=i*i+r*r+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=i*o,t[1]=r*o,t[2]=s*o,t[3]=n*o),t}function ZMe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function gG(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=o+r*(i[2]-o),t[3]=a+r*(i[3]-a),t}function NKe(t,e){const i=gD;let r,s,n,o,a,l;e=e||1;do r=2*i()-1,s=2*i()-1,a=r*r+s*s;while(a>=1);do n=2*i()-1,o=2*i()-1,l=n*n+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*r,t[1]=e*s,t[2]=e*n*c,t[3]=e*o*c,t}function Pu(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*o,t[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*o,t[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*o,t[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*o,t}function FKe(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2],c=i[3],u=c*r+a*n-l*s,d=c*s+l*r-o*n,f=c*n+o*s-a*r,m=-o*r-a*s-l*n;return t[0]=u*c+m*-o+d*-l-f*-a,t[1]=d*c+m*-a+f*-o-u*-l,t[2]=f*c+m*-l+u*-a-d*-o,t[3]=e[3],t}function kKe(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function YM(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function HS(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=Do();return Math.abs(i-o)<=u*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=u*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=u*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=u*Math.max(1,Math.abs(n),Math.abs(c))}const UKe=jMe,VKe=GMe,zKe=HMe,BKe=qMe,jKe=Az,GKe=Ure,HKe=Vre,YMe=Object.freeze(Object.defineProperty({__proto__:null,add:kre,ceil:AKe,copy:Hd,copyVec3:MKe,dist:BKe,distance:qMe,div:zKe,divide:HMe,dot:ZMe,equals:HS,exactEquals:YM,floor:PKe,inverse:DKe,len:GKe,length:Ure,lerp:gG,max:RKe,min:OKe,mul:VKe,multiply:GMe,negate:LKe,normalize:WMe,random:NKe,round:$Ke,scale:GS,scaleAndAdd:IKe,set:_s,sqrDist:jKe,sqrLen:HKe,squaredDistance:Az,squaredLength:Vre,str:kKe,sub:UKe,subtract:jMe,transformMat4:Pu,transformQuat:FKe},Symbol.toStringTag,{value:"Module"}));function X9t(t,e,i){const r=Te(t,e)/Te(t,t);return he(i,t,r)}function K1(t,e){return Te(t,e)/Ve(t)}function zre(t,e){const i=Te(t,e)/(Ve(t)*Ve(e));return-po(i)}function XMe(t,e,i){Ce(eF,t),Ce(e8,e);const r=Te(eF,e8),s=po(r),n=ft(eF,eF,e8);return Te(n,i)<0?2*Math.PI-s:s}const eF=E(),e8=E();function XA(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],i=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],r=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}function qKe(t,e){const i=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),r=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),s=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return de(t,i,r,s),t}function J9t(t,e,i){i=i||t;const r=Te(t,e);de(i,t[0]-r*e[0],t[1]-r*e[1],t[2]-r*e[2]),Ce(i,i)}function WKe(t,e,i){Math.abs(t[0])>Math.abs(t[1])?de(e,0,1,0):de(e,1,0,0),ft(i,t,e),ft(e,i,t),Ce(i,i),Ce(e,e)}function tF(t,e,i,r,s,n){const o=t+(e-t)*s;return o+(i+(r-i)*s-o)*n}function ZKe(t,e,i,r=E()){const s=Ve(t),n=Ve(e),o=Te(t,e)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*s+i*n)/Math.sin(a),c=l/s*Math.sin((1-i)*a),u=l/n*Math.sin(i*a);return he(LT,t,c),he(DT,e,u),Ee(r,LT,DT)}return xr(r,t,e,i)}function Q9t(t,e,i,r=E(),s=E()){const n=Ve(t),o=Ve(e),a=Te(t,e)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),u=Math.sin(i*l),d=Math.sin((1-i)*l),f=(1-i)*n+i*o;{const m=f/c,g=m/o*u;he(LT,t,m/n*d),he(DT,e,g),Ee(r,LT,DT)}{const m=1/n*(-Math.cos((1-i)*l)*l*f+d*(-n+o));he(LT,t,m);const g=1/o*(Math.cos(i*l)*l*f+u*(-n+o));he(DT,e,g),Ee(s,LT,DT),he(s,s,1/c)}return s}return xr(r,t,e,i),Re(s,e,t),Ce(s,s),s}function Pz(t,e,i){t=Ce(LT,t),e=Ce(DT,e);const r=po(Te(t,e));if(i){const s=ft(YKe,t,e);if(Te(s,i)<0)return-r}return r}function Ck(t){const e=t.length;return i=>{if(i<=t[0][0])return t[0][1];if(i>=t[e-1][0])return t[e-1][1];let r=1;for(;i>t[r][0];)r++;const s=t[r-1][0],n=t[r][0],o=(n-i)/(n-s);return o*t[r-1][1]+(1-o)*t[r][1]}}function K9t(t,e,i,r){Re(Yhe,e,t),Re(Xhe,i,t),ft(r,Yhe,Xhe),Ce(r,r),r[3]=-Te(t,r)}function e7t(t,e){if(de(e,0,0,0),t.length>0){for(let i=0;i<t.length;++i)Ee(e,e,t[i]);he(e,e,1/t.length)}}const Yhe=E(),Xhe=E(),YKe=E(),LT=E(),DT=E();function tr(t=KR){return[t[0],t[1],t[2],t[3]]}function XKe(t=KR[0],e=KR[1],i=KR[2],r=KR[3]){return Bre(t,e,i,r,Dre.get())}function yG(t,e){return Bre(e[0],e[1],e[2],e[3],t)}function t7t(t){return t}function Bre(t,e,i,r,s=tr()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function JMe(t,e,i){return ve(i,t),i[3]=e,i}function TD(t,e,i){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function il(t,e,i,r=tr()){const s=i[0]-e[0],n=i[1]-e[1],o=i[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],u=n*c-o*l,d=o*a-s*c,f=s*l-n*a,m=u*u+d*d+f*f,g=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return r[0]=u*g,r[1]=d*g,r[2]=f*g,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function jre(t,e,i,r=0,s=Math.floor(i*(1/3)),n=Math.floor(i*(2/3))){if(i<3)return!1;e($O,r);let o=s,a=!1;for(;o<i-1&&!a;)e(V2,o),o++,a=!$o($O,V2);if(!a)return!1;for(o=Math.max(o,n),a=!1;o<i&&!a;)e(gT,o),o++,Re(iF,$O,V2),Ce(iF,iF),Re(rF,V2,gT),Ce(rF,rF),a=!$o($O,gT)&&!$o(V2,gT)&&Math.abs(Te(iF,rF))<QKe;return a?(il($O,V2,gT,t),!0):(r!==0||s!==1||n!==2)&&jre(t,e,i,0,1,2)}function JKe(t,e,i=!0){const r=e.length/3;return jre(t,(s,n)=>de(s,e[3*n+0],e[3*n+1],e[3*n+2]),i?r-1:r)}const QKe=.99619469809,$O=E(),V2=E(),gT=E(),iF=E(),rF=E();function wY(t,e,i){return e!==t&&yG(t,e),t[3]=-Te(t,i),t}function xY(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function pL(t,e,i,r){return ft(gT,e,t),TD(i,gT,r)}function i7t(t,e,i,r){return _G(t,e,Re(it.get(),i,e),set,r)}function v2(t,e,i){return e!=null&&_G(t,e.origin,e.direction,net,i)}function KKe(t,e,i){return _G(t,e.origin,e.vector,Vg.NONE,i)}function eet(t,e,i){return _G(t,e.origin,e.vector,Vg.CLAMP,i)}function QMe(t,e){return Or(t,e)>=0}function tet(t,e){const i=Te(t,e.ray.direction),r=-Or(t,e.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const s=r/i;return i>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function iet(t,e){const i=Te(t,e.ray.direction),r=-Or(t,e.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const s=r/i;return i>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function ret(t,e,i){const r=he(it.get(),t,-t[3]),s=TY(t,Re(it.get(),e,r),it.get());return Ee(i,s,r),i}function r7t(t,e,i,r){const s=t,n=it.get(),o=it.get();WKe(s,n,o);const a=Re(it.get(),i,e),l=K1(n,a),c=K1(o,a),u=K1(s,a);return de(r,l,c,u)}function TY(t,e,i){const r=he(it.get(),t,Te(t,e));return Re(i,e,r),i}function s7t(t,e){return Math.abs(Or(t,e))}function Or(t,e){return Te(t,e)+t[3]}function _G(t,e,i,r,s){const n=Te(t,i);if(n===0)return!1;let o=-(Te(t,e)+t[3])/n;return r&Vg.CLAMP&&(o=Ne(o,0,1)),!(!(r&Vg.INFINITE_MIN)&&o<0||!(r&Vg.INFINITE_MAX)&&o>1)&&(Ee(s,e,he(s,i,o)),!0)}const KR=[0,0,1,0];var Vg;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(Vg||(Vg={}));const set=Vg.INFINITE_MIN|Vg.INFINITE_MAX,net=Vg.INFINITE_MAX;function lo(t){return t?Jhe(hn(t.origin),hn(t.direction)):Jhe(E(),E())}function Jhe(t,e){return{origin:t,direction:e}}function n7t(t,e){return db(t.origin,e.origin)&&db(t.direction,e.direction)}function jh(t,e){const i=cet.get();return i.origin=t,i.direction=e,i}function Oz(t,e=lo()){return eAe(t.origin,t.direction,e)}function KMe(t,e,i=lo()){return ve(i.origin,t),Re(i.direction,e,t),i}function eAe(t,e,i=lo()){return ve(i.origin,t),ve(i.direction,e),i}function oet(t,e){const i=ft(it.get(),Ce(it.get(),t.direction),Re(it.get(),e,t.origin));return Te(i,i)}function aet(t,e,i){const r=Te(t.direction,Re(i,e,t.origin));return Ee(i,t.origin,he(i,t.direction,r)),i}function o7t(t,e,i,r){const s=t.direction,n=e.direction,o=Ii(t8,e.origin,t.origin),a=Te(s,n),l=Te(n,o),c=Te(s,o),u=Te(s,s),d=Te(n,n),f=(a*l+c*d)/(u*d-a*a),m=(a*c-l*u)/(u*d-a*a);return Ee(i,t.origin,he(t8,s,f)),Ee(r,e.origin,he(t8,n,m)),[i,r]}const cet=new x_(()=>lo()),t8=E(),i8=()=>se.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let uet=class{constructor(){this.plane=tr(),this.origin=E(),this.basis1=E(),this.basis2=E()}};const tAe=uet;function T_(t=dAe){return{plane:tr(t.plane),origin:hn(t.origin),basis1:hn(t.basis1),basis2:hn(t.basis2)}}function het(t,e,i){const r=Tet.get();return r.origin=t,r.basis1=e,r.basis2=i,r.plane=XKe(0,0,0,0),vG(r),r}function b2(t,e=T_()){return Gre(t.origin,t.basis1,t.basis2,e)}function det(t,e){ve(e.origin,t.origin),ve(e.basis1,t.basis1),ve(e.basis2,t.basis2),yG(e.plane,t.plane)}function Gre(t,e,i,r=T_()){return ve(r.origin,t),ve(r.basis1,e),ve(r.basis2,i),vG(r),wet(r,"fromValues()"),r}function vG(t){pL(t.basis2,t.basis1,t.origin,t.plane)}function iAe(t,e,i){t!==i&&b2(t,i);const r=he(it.get(),c_(t),e);return Ee(i.origin,i.origin,r),i.plane[3]-=e,i}function pet(t,e,i){return rAe(e,i),iAe(i,Zre(t,t.origin),i),i}function rAe(t,e=T_()){const i=(t[2]-t[0])/2,r=(t[3]-t[1])/2;return de(e.origin,t[0]+i,t[1]+r,0),de(e.basis1,i,0,0),de(e.basis2,0,r,0),Bre(0,0,1,0,e.plane),e}function Hre(t,e,i){return!!v2(t.plane,e,i)&&uAe(t,i)}function fet(t,e,i){if(Hre(t,e,i))return i;const r=sAe(t,e,it.get());return Ee(i,e.origin,he(it.get(),e.direction,Cr(e.origin,r)/Ve(e.direction))),i}function sAe(t,e,i){const r=Rz.get();hAe(t,e,r,Rz.get());let s=Number.POSITIVE_INFINITY;for(const n of Xre){const o=Yre(t,n,bG.get()),a=it.get();if(KKe(r,o,a)){const l=v_(it.get(),e.origin,a),c=Math.abs(po(Te(e.direction,l)));c<s&&(s=c,ve(i,a))}}return s===Number.POSITIVE_INFINITY?nAe(t,e,i):i}function nAe(t,e,i){if(Hre(t,e,i))return i;const r=Rz.get(),s=Rz.get();hAe(t,e,r,s);let n=Number.POSITIVE_INFINITY;for(const o of Xre){const a=Yre(t,o,bG.get()),l=it.get();if(eet(r,a,l)){const c=oet(e,l);if(!QMe(s,l))continue;c<n&&(n=c,ve(i,l))}}return qre(t,e.origin)<n&&oAe(t,e.origin,i),i}function oAe(t,e,i){const r=ret(t.plane,e,it.get()),s=bY(Qhe(t,t.basis1),r,-1,1,it.get()),n=bY(Qhe(t,t.basis2),r,-1,1,it.get());return Re(i,Ee(it.get(),s,n),t.origin),i}function aAe(t,e,i){const{origin:r,basis1:s,basis2:n}=t,o=Re(it.get(),e,r),a=K1(s,o),l=K1(n,o),c=K1(c_(t),o);return de(i,a,l,c)}function qre(t,e){const i=aAe(t,e,it.get()),{basis1:r,basis2:s}=t,n=Ve(r),o=Ve(s),a=Math.max(Math.abs(i[0])-n,0),l=Math.max(Math.abs(i[1])-o,0),c=i[2];return a*a+l*l+c*c}function met(t,e){return Math.sqrt(qre(t,e))}function get(t,e){let i=Number.NEGATIVE_INFINITY;for(const r of Xre){const s=Yre(t,r,bG.get()),n=Fre(s,e);n>i&&(i=n)}return Math.sqrt(i)}function Wre(t,e){return QMe(t.plane,e)&&uAe(t,e)}function yet(t,e,i,r){return bet(t,i,r)}function Zre(t,e){const i=-t.plane[3];return K1(c_(t),e)-i}function _et(t,e,i,r){const s=Zre(t,e),n=he(xet,c_(t),i-s);return Ee(r,e,n),r}function lAe(t,e){return $o(t.basis1,e.basis1)&&$o(t.basis2,e.basis2)&&$o(t.origin,e.origin)}function cAe(t,e,i){return t!==i&&b2(t,i),Zn(z2,e),Lu(z2,z2),nt(i.basis1,t.basis1,z2),nt(i.basis2,t.basis2,z2),nt(i.plane,t.plane,z2),nt(i.origin,t.origin,e),wY(i.plane,i.plane,i.origin),i}function vet(t,e,i,r){return t!==r&&b2(t,r),Du(r8,e,i),nt(r.basis1,t.basis1,r8),nt(r.basis2,t.basis2,r8),vG(r),r}function c_(t){return t.plane}function bet(t,e,i){switch(e){case ys.X:ve(i,t.basis1),Ce(i,i);break;case ys.Y:ve(i,t.basis2),Ce(i,i);break;case ys.Z:ve(i,c_(t))}return i}function uAe(t,e){const i=Re(it.get(),e,t.origin),r=sl(t.basis1),s=sl(t.basis2),n=Te(t.basis1,i),o=Te(t.basis2,i);return-n-r<0&&n-r<0&&-o-s<0&&o-s<0}function Qhe(t,e){const i=bG.get();return ve(i.origin,t.origin),ve(i.vector,e),i}function Yre(t,e,i){const{basis1:r,basis2:s,origin:n}=t,o=he(it.get(),r,e.origin[0]),a=he(it.get(),s,e.origin[1]);Ee(i.origin,o,a),Ee(i.origin,i.origin,n);const l=he(it.get(),r,e.direction[0]),c=he(it.get(),s,e.direction[1]);return he(i.vector,Ee(l,l,c),2),i}function wet(t,e){Math.abs(Te(t.basis1,t.basis2)/(Ve(t.basis1)*Ve(t.basis2)))>1e-6&&i8().warn(e,"Provided basis vectors are not perpendicular"),Math.abs(Te(t.basis1,c_(t)))>1e-6&&i8().warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Te(c_(t),t.origin)-t.plane[3])>1e-6&&i8().warn(e,"Plane offset is not consistent with plane origin")}function hAe(t,e,i,r){const s=c_(t);pL(s,e.direction,e.origin,i),pL(i,s,e.origin,r)}const dAe={plane:tr(),origin:Ge(0,0,0),basis1:Ge(1,0,0),basis2:Ge(0,1,0)},Rz=new x_(tr),bG=new x_(im),xet=E(),Tet=new x_(()=>T_()),Xre=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],z2=ke(),r8=ke(),Eet=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:tAe,altitudeAt:Zre,axisAt:yet,closestPoint:nAe,closestPointOnSilhouette:sAe,copy:b2,copyWithoutVerify:det,create:T_,distance:met,distance2:qre,distanceToSilhouette:get,elevate:iAe,equals:lAe,extrusionContainsPoint:Wre,fromAABoundingRect:rAe,fromValues:Gre,intersectRay:Hre,intersectRayClosestSilhouette:fet,normal:c_,projectPoint:oAe,projectPointLocal:aAe,rotate:vet,setAltitudeAt:_et,setExtent:pet,transform:cAe,up:dAe,updateUnboundedPlane:vG,wrap:het},Symbol.toStringTag,{value:"Module"})),Cet=new Ze(z2e),aM=new Ze(Gj),lM=new Ze(Hj),Met=new Ze(B2e);function Gh(t){const e=Khe.get(t);if(e)return e;let i=Cet;if(t)if(t===aM)i=aM;else if(t===lM)i=lM;else{const r=t.wkid,s=t.latestWkid;if(r!=null||s!=null)RA(r)||RA(s)?i=aM:($A(r)||$A(s))&&(i=lM);else{const n=t.wkt2??t.wkt;if(n){const o=n.toUpperCase();o===Aet?i=aM:o===Pet&&(i=lM)}}}return Khe.set(t,i),i}const Khe=new Map,Aet=aM.wkt.toUpperCase(),Pet=lM.wkt.toUpperCase(),pAe=dn();function dn(){return ci()}const Oet=HS,Ret=HS;function qS(t,e){return Hd(e,t)}function fAe(t,e){return ii(t[0],t[1],t[2],e)}function $et(t){return t}function Iet(t){t[0]=t[1]=t[2]=t[3]=0}function wG(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function eb(t){return t[3]}function Let(t){return t}function mAe(t,e,i,r){return ii(t,e,i,r)}function Det(t,e,i){return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),i[3]=t[3]+e,i}function Net(t,e,i){return t!==i&&qS(t,i),i}function Wb(t,e,i){if(e==null||!gAe(t,e,$z))return!1;let{t0:r,t1:s}=$z;if((r<0||s<r&&s>0)&&(r=s),r<0)return!1;if(i){const{origin:n,direction:o}=e;i[0]=n[0]+o[0]*r,i[1]=n[1]+o[1]*r,i[2]=n[2]+o[2]*r}return!0}function Fet(t,e,i){const r=KMe(e,i);if(!gAe(t,r,$z))return[];const{origin:s,direction:n}=r,{t0:o,t1:a}=$z,l=c=>{const u=E();return Pn(u,s,n,c),Jre(t,u,u)};return Math.abs(o-a)<Do()?[l(o)]:[l(o),l(a)]}const $z={t0:0,t1:0};function gAe(t,e,i){const{origin:r,direction:s}=e,n=ket;n[0]=r[0]-t[0],n[1]=r[1]-t[1],n[2]=r[2]-t[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(o===0)return!1;const a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);return i.t0=(-a-c)/(2*o),i.t1=(-a+c)/(2*o),!0}const ket=E();function SY(t,e){return Wb(t,e,null)}function Uet(t,e,i){if(Wb(t,e,i))return i;const r=XP(t,e,it.get());return Ee(i,e.origin,he(it.get(),e.direction,Cr(e.origin,r)/Ve(e.direction))),i}function XP(t,e,i){const r=it.get(),s=Nre.get();ft(r,e.origin,e.direction);const n=eb(t);ft(i,r,e.origin),he(i,i,1/Ve(i)*n);const o=_Ae(t,e.origin),a=zre(e.origin,i);return Du(s,a+o,r),nt(i,i,s),i}function Vet(t,e,i){return Wb(t,e,i)?i:(aet(e,t,i),Jre(t,i,i))}function Jre(t,e,i){const r=Re(it.get(),e,t),s=he(it.get(),r,t[3]/Ve(r));return Ee(i,s,t)}function yAe(t,e){const i=Re(it.get(),e,t),r=sl(i),s=t[3]*t[3];return Math.sqrt(Math.abs(r-s))}function _Ae(t,e){const i=Re(it.get(),e,t),r=Ve(i),s=eb(t),n=s+Math.abs(s-r);return po(s/n)}const s8=E();function vAe(t,e,i,r){const s=Re(s8,e,t);switch(i){case ys.X:{const n=Yue(s,s8)[2];return de(r,-Math.sin(n),Math.cos(n),0)}case ys.Y:{const n=Yue(s,s8),o=n[1],a=n[2],l=Math.sin(o);return de(r,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case ys.Z:return Ce(r,s);default:return}}function bAe(t,e){const i=Re(EY,e,t);return Ve(i)-t[3]}function zet(t,e,i,r){const s=bAe(t,e),n=vAe(t,e,ys.Z,EY),o=he(EY,n,i-s);return Ee(r,e,o)}function Bet(t,e){const i=uo(t,e),r=eb(t);return i<=r*r}function jet(t,e,i=ci()){const r=Cr(t,e),s=t[3],n=e[3];return r+n<s?(Hd(i,t),i):r+s<n?(Hd(i,e),i):(xr(i,t,e,(r+n-s)/(2*r)),i[3]=(r+s+n)/2,i)}const EY=E(),xG=dn(),Get=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:pAe,altitudeAt:bAe,angleToSilhouette:_Ae,axisAt:vAe,clear:Iet,closestPoint:Vet,closestPointOnSilhouette:XP,containsPoint:Bet,copy:qS,create:dn,distanceToSilhouette:yAe,elevate:Det,equals:Ret,exactEquals:Oet,fromCenterAndRadius:fAe,fromRadius:wG,fromValues:mAe,getCenter:Let,getRadius:eb,intersectLine:Fet,intersectRay:Wb,intersectRayClosestSilhouette:Uet,intersectsRay:SY,projectPoint:Jre,setAltitudeAt:zet,setExtent:Net,tmpSphere:xG,union:jet,wrap:$et},Symbol.toStringTag,{value:"Module"}));function Het(t){const{value:e,operations:i}=t;return{operations:i,value:i.create(e)}}function qet(t,e,i){return t.operations.setExtent(t.value,e,i.value),i}function Wet(t){return{operations:t,value:t.create()}}function wAe(t,e,i=Wet(t)){return i.operations=t,t.copy(e,i.value),i}function Zet(t){return wAe(Get,mAe(0,0,0,_r(t).radius))}const ede=2**50;function Yet(){return wAe(Eet,Gre([0,0,0],[ede,0,0],[0,ede,0]))}function Xet(t,e,i){return t.operations.axisAt(t.value,e,ys.Z,i)}function Jet(t,e,i,r){return t.operations.axisAt(t.value,e,i,r)}function Qet(t,e,i){return t.operations.intersectRay(t.value,e,i)}function Ket(t,e,i){return t.operations.intersectRayClosestSilhouette(t.value,e,i)}function ett(t,e){return t.operations.altitudeAt(t.value,e)}function xAe(t,e,i,r){return t.operations.setAltitudeAt(t.value,e,i,r)}function ttt(t,e,i,r){return e!==r&&xn(r,e),de(B2,r[12],r[13],r[14]),xAe(t,B2,i,B2),r[12]=B2[0],r[13]=B2[1],r[14]=B2[2],r}function n8(t,e,i){return t.operations.elevate(t.value,e,i.value)}const B2=E();function tde(t,e,i,r,s){return s[0]=Te(t,e),s[1]=Te(t,i),s[2]=Te(t,r),s}function CY(t,e,i,r,s){ve(i,t),ve(sF,e),Ce(sF,sF),ft(r,sF,i),ft(s,r,i)}function itt(t,e){return t?Gh(e):e.isGeographic?Ze.PlateCarree:e}const sF=E(),Qre=96;function l7t(t,e){const i=t.extent,r=t.width,s=ec(i==null?void 0:i.spatialReference);return i&&r?i.width/r*s*Jie*Qre:0}function rtt(t,e){return t/(ec(e)*Jie*Qre)}function stt(t){return t/(Jie*Qre)}function c7t(t,e,i){return ntt(t,e)&&ott(t,i)}function ntt(t,e){return e===0||X1(t,e)||t<e}function ott(t,e){return e===0||X1(t,e)||t>e}let JA=class extends QI{constructor(e){super(e),this.addHandles(this.on("before-add",i=>{i.item!=null&&i.item.parent===this.owner&&(se.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),i.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};JA=h([I("esri.support.AnalysesCollection")],JA);const Mk={widthBreakpoint:{getValue(t){const e=t.viewSize[0],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,i=e[0],r=e[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},o8={xsmall:544,small:768,medium:992,large:1200};function att(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function a8(t,e){return e?Mk[t].valueToClassName[e].split(" "):[]}const ltt=t=>{let e=class extends t{constructor(...i){super(...i),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=o8}initialize(){this.addHandles(te(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),$t))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(i){if(i!==this._get("breakpoints")){if(!att(i)){const r=JSON.stringify(o8,null,2);console.warn("provided breakpoints are not valid, using defaults:"+r),i=o8}this._set("breakpoints",{...i})}}_updateClassNames(){if(!this.container)return;const i=vu.acquire(),r=vu.acquire();let s,n=!1;for(s in Mk){const o=this[s],a=Mk[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,a8(s,o).forEach(l=>r.push(l)),a8(s,a).forEach(l=>i.push(l)))}n&&(this._applyClassNameChanges(i,r),vu.release(i),vu.release(r))}_applyClassNameChanges(i,r){const s=this.container;s&&(r.forEach(n=>s.classList.remove(n)),i.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in Mk)a8(r,this[r]).forEach(s=>i.classList.remove(s))}};return h([p()],e.prototype,"breakpoints",null),h([p()],e.prototype,"orientation",void 0),h([p()],e.prototype,"widthBreakpoint",void 0),h([p()],e.prototype,"heightBreakpoint",void 0),e=h([I("esri.views.BreakpointsOwner")],e),e};let Z0=class extends Ue{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,i,r={}){return this._installWatch(e,i,r,te)}addWhen(e,i,r={}){return this._installWatch(e,i,r,No)}addOnCollectionChange(e,i,{initial:r=!1,final:s=!1}={}){const n=++this._handleId;return this.addHandles([Ks(e,"after-changes",this._createSyncUpdatingCallback(),or),Ks(e,"change",i,{onListenerAdd:r?o=>i({added:o.toArray(),removed:[]}):void 0,onListenerRemove:s?o=>i({added:[],removed:o.toArray()}):void 0})],n),Gi(()=>this.removeHandles(n))}addPromise(e){if(e==null)return e;const i=++this._handleId;this.addHandles(Gi(()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this.hasHandles(nF)||this._set("updating",!1))}),i),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this.removeHandles(i);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,i,r={},s){const n=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,n);const o=s(e,i,r);return this.addHandles(o,n),Gi(()=>this.removeHandles(n))}_installSyncUpdatingWatch(e,i){const r=this._createSyncUpdatingCallback(),s=te(e,r,{sync:!0,equals:()=>!1});return this.addHandles(s,i),s}_createSyncUpdatingCallback(){return()=>{this.removeHandles(nF),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles(p2(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(nF))}),nF)}}};h([p({readOnly:!0})],Z0.prototype,"updating",void 0),Z0=h([I("esri.core.support.UpdatingHandles")],Z0);const nF=-42;/*!
 * @esri/arcgis-html-sanitizer - v4.0.3 - Wed Jul 03 2024 17:50:35 GMT-0400 (Eastern Daylight Time)
 * Copyright (c) 2024 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Iz=function(){return Iz=Object.assign||function(e){for(var i,r=1,s=arguments.length;r<s;r++){i=arguments[r];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},Iz.apply(this,arguments)},MY={exports:{}},Rn={},AY={exports:{}},w2={};function TAe(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function ctt(t,e,i){}function utt(t,e,i){}var htt=/javascript\s*\:/img;function dtt(t,e){return htt.test(e)?"":e}w2.whiteList=TAe();w2.getDefaultWhiteList=TAe;w2.onAttr=ctt;w2.onIgnoreAttr=utt;w2.safeAttrValue=dtt;var ptt={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},IO=ptt;function ftt(t,e){t=IO.trimRight(t),t[t.length-1]!==";"&&(t+=";");var i=t.length,r=!1,s=0,n=0,o="";function a(){if(!r){var u=IO.trim(t.slice(s,n)),d=u.indexOf(":");if(d!==-1){var f=IO.trim(u.slice(0,d)),m=IO.trim(u.slice(d+1));if(f){var g=e(s,o.length,f,m,u);g&&(o+=g+"; ")}}}s=n+1}for(;n<i;n++){var l=t[n];if(l==="/"&&t[n+1]==="*"){var c=t.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return IO.trim(o)}var mtt=ftt,oF=w2,gtt=mtt;function ide(t){return t==null}function ytt(t){var e={};for(var i in t)e[i]=t[i];return e}function SAe(t){t=ytt(t||{}),t.whiteList=t.whiteList||oF.whiteList,t.onAttr=t.onAttr||oF.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||oF.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||oF.safeAttrValue,this.options=t}SAe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,s=i.onAttr,n=i.onIgnoreAttr,o=i.safeAttrValue,a=gtt(t,function(l,c,u,d,f){var m=r[u],g=!1;if(m===!0?g=m:typeof m=="function"?g=m(d):m instanceof RegExp&&(g=m.test(d)),g!==!0&&(g=!1),d=o(u,d),!!d){var y={position:c,sourcePosition:l,source:f,isWhite:g};if(g){var v=s(u,d,y);return ide(v)?u+":"+d:v}else{var v=n(u,d,y);if(!ide(v))return v}}});return a};var _tt=SAe;(function(t,e){var i=w2,r=_tt;function s(o,a){var l=new r(a);return l.process(o)}e=t.exports=s,e.FilterCSS=r;for(var n in i)e[n]=i[n]})(AY,AY.exports);var Kre=AY.exports,ese={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,i=e.exec(t);return i?i.index:-1}},vtt=Kre.FilterCSS,btt=Kre.getDefaultWhiteList,Lz=ese;function EAe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var CAe=new vtt;function wtt(t,e,i){}function xtt(t,e,i){}function Ttt(t,e,i){}function Stt(t,e,i){}function MAe(t){return t.replace(Ctt,"&lt;").replace(Mtt,"&gt;")}function Ett(t,e,i,r){if(i=IAe(i),e==="href"||e==="src"){if(i=Lz.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(e==="background"){if(aF.lastIndex=0,aF.test(i))return""}else if(e==="style"){if(rde.lastIndex=0,rde.test(i)||(sde.lastIndex=0,sde.test(i)&&(aF.lastIndex=0,aF.test(i))))return"";r!==!1&&(r=r||CAe,i=r.process(i))}return i=LAe(i),i}var Ctt=/</g,Mtt=/>/g,Att=/"/g,Ptt=/&quot;/g,Ott=/&#([a-zA-Z0-9]*);?/gim,Rtt=/&colon;?/gim,$tt=/&newline;?/gim,aF=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,rde=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,sde=/u\s*r\s*l\s*\(.*/gi;function AAe(t){return t.replace(Att,"&quot;")}function PAe(t){return t.replace(Ptt,'"')}function OAe(t){return t.replace(Ott,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function RAe(t){return t.replace(Rtt,":").replace($tt," ")}function $Ae(t){for(var e="",i=0,r=t.length;i<r;i++)e+=t.charCodeAt(i)<32?" ":t.charAt(i);return Lz.trim(e)}function IAe(t){return t=PAe(t),t=OAe(t),t=RAe(t),t=$Ae(t),t}function LAe(t){return t=AAe(t),t=MAe(t),t}function Itt(){return""}function Ltt(t,e){typeof e!="function"&&(e=function(){});var i=!Array.isArray(t);function r(o){return i?!0:Lz.indexOf(t,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(r(o))if(l.isClosing){var c="[/removed]",u=l.position+c.length;return s.push([n!==!1?n:l.position,u]),n=!1,c}else return n||(n=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return Lz.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function Dtt(t){for(var e="",i=0;i<t.length;){var r=t.indexOf("<!--",i);if(r===-1){e+=t.slice(i);break}e+=t.slice(i,r);var s=t.indexOf("-->",r);if(s===-1)break;i=s+3}return e}function Ntt(t){var e=t.split("");return e=e.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),e.join("")}Rn.whiteList=EAe();Rn.getDefaultWhiteList=EAe;Rn.onTag=wtt;Rn.onIgnoreTag=xtt;Rn.onTagAttr=Ttt;Rn.onIgnoreTagAttr=Stt;Rn.safeAttrValue=Ett;Rn.escapeHtml=MAe;Rn.escapeQuote=AAe;Rn.unescapeQuote=PAe;Rn.escapeHtmlEntities=OAe;Rn.escapeDangerHtml5Entities=RAe;Rn.clearNonPrintableCharacter=$Ae;Rn.friendlyAttrValue=IAe;Rn.escapeAttrValue=LAe;Rn.onIgnoreTagStripAll=Itt;Rn.StripTagBody=Ltt;Rn.stripCommentTag=Dtt;Rn.stripBlankChar=Ntt;Rn.cssFilter=CAe;Rn.getDefaultCSSWhiteList=btt;var TG={},f1=ese;function Ftt(t){var e=f1.spaceIndex(t),i;return e===-1?i=t.slice(1,-1):i=t.slice(1,e+1),i=f1.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function ktt(t){return t.slice(0,2)==="</"}function Utt(t,e,i){var r="",s=0,n=!1,o=!1,a=0,l=t.length,c="",u="";e:for(a=0;a<l;a++){var d=t.charAt(a);if(n===!1){if(d==="<"){n=a;continue}}else if(o===!1){if(d==="<"){r+=i(t.slice(s,a)),n=a,s=a;continue}if(d===">"){r+=i(t.slice(s,n)),u=t.slice(n,a+1),c=Ftt(u),r+=e(n,r.length,c,u,ktt(u)),s=a+1,n=!1;continue}if(d==='"'||d==="'")for(var f=1,m=t.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=d;continue e}m=t.charAt(a-++f)}}else if(d===o){o=!1;continue}}return s<t.length&&(r+=i(t.substr(s))),r}var Vtt=/[^a-zA-Z0-9\\_:.-]/gim;function ztt(t,e){var i=0,r=0,s=[],n=!1,o=t.length;function a(f,m){if(f=f1.trim(f),f=f.replace(Vtt,"").toLowerCase(),!(f.length<1)){var g=e(f,m||"");g&&s.push(g)}}for(var l=0;l<o;l++){var c=t.charAt(l),u,d;if(n===!1&&c==="="){n=t.slice(i,l),i=l+1,r=t.charAt(i)==='"'||t.charAt(i)==="'"?i:jtt(t,l+1);continue}if(n!==!1&&l===r){if(d=t.indexOf(c,l+1),d===-1)break;u=f1.trim(t.slice(r+1,d)),a(n,u),n=!1,l=d,i=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),n===!1)if(d=Btt(t,l),d===-1){u=f1.trim(t.slice(i,l)),a(u),n=!1,i=l+1;continue}else{l=d-1;continue}else if(d=Gtt(t,l-1),d===-1){u=f1.trim(t.slice(i,l)),u=nde(u),a(n,u),n=!1,i=l+1;continue}else continue}return i<t.length&&(n===!1?a(t.slice(i)):a(n,nde(f1.trim(t.slice(i))))),f1.trim(s.join(" "))}function Btt(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="="?e:-1}}function jtt(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="'"||i==='"'?e:-1}}function Gtt(t,e){for(;e>0;e--){var i=t[e];if(i!==" ")return i==="="?e:-1}}function Htt(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function nde(t){return Htt(t)?t.substr(1,t.length-2):t}TG.parseTag=Utt;TG.parseAttr=ztt;var qtt=Kre.FilterCSS,tf=Rn,DAe=TG,Wtt=DAe.parseTag,Ztt=DAe.parseAttr,Ak=ese;function lF(t){return t==null}function Ytt(t){var e=Ak.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=Ak.trim(t.slice(e+1,-1));var i=t[t.length-1]==="/";return i&&(t=Ak.trim(t.slice(0,-1))),{html:t,closing:i}}function Xtt(t){var e={};for(var i in t)e[i]=t[i];return e}function Jtt(t){var e={};for(var i in t)Array.isArray(t[i])?e[i.toLowerCase()]=t[i].map(function(r){return r.toLowerCase()}):e[i.toLowerCase()]=t[i];return e}function NAe(t){t=Xtt(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=tf.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=Jtt(t.whiteList||t.allowList):t.whiteList=tf.whiteList,t.onTag=t.onTag||tf.onTag,t.onTagAttr=t.onTagAttr||tf.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||tf.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||tf.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||tf.safeAttrValue,t.escapeHtml=t.escapeHtml||tf.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new qtt(t.css))}NAe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,s=i.onTag,n=i.onIgnoreTag,o=i.onTagAttr,a=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,u=e.cssFilter;i.stripBlankChar&&(t=tf.stripBlankChar(t)),i.allowCommentTag||(t=tf.stripCommentTag(t));var d=!1;i.stripIgnoreTagBody&&(d=tf.StripTagBody(i.stripIgnoreTagBody,n),n=d.onIgnoreTag);var f=Wtt(t,function(m,g,y,v,b){var w={sourcePosition:m,position:g,isClosing:b,isWhite:Object.prototype.hasOwnProperty.call(r,y)},x=s(y,v,w);if(!lF(x))return x;if(w.isWhite){if(w.isClosing)return"</"+y+">";var S=Ytt(v),C=r[y],M=Ztt(S.html,function(O,D){var U=Ak.indexOf(C,O)!==-1,k=o(y,O,D,U);return lF(k)?U?(D=l(y,O,D,u),D?O+'="'+D+'"':O):(k=a(y,O,D,U),lF(k)?void 0:k):k});return v="<"+y,M&&(v+=" "+M),S.closing&&(v+=" /"),v+=">",v}else return x=n(y,v,w),lF(x)?c(v):x},c);return d&&(f=d.remove(f)),f};var Qtt=NAe;(function(t,e){var i=Rn,r=TG,s=Qtt;function n(a,l){var c=new s(l);return c.process(a)}e=t.exports=n,e.filterXSS=n,e.FilterXSS=s,function(){for(var a in i)e[a]=i[a];for(var l in r)e[l]=r[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(MY,MY.exports);var j2=MY.exports,Ktt=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},eit=function(){function t(e,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],article:["style"],aside:["style"],audio:["autoplay","controls","loop","muted","preload"],b:[],blockquote:["style"],br:[],code:["style"],dd:["style"],details:["style"],div:["align","style","aria-label","aria-hidden"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],footer:["style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],header:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],main:["style"],mark:["style"],nav:["style"],ol:[],p:["style"],pre:["style"],section:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],summary:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],time:["style"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.arcgisCSSWhiteList=Iz(Iz({},j2.getDefaultCSSWhiteList()),{flex:!0,"flex-basis":!0,"flex-direction":!0,"flex-flow":!0,"flex-grow":!0,"flex-shrink":!0,"flex-wrap":!0,"line-height":!0,"justify-content":!0,overflow:!0}),this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?r.sanitizeUrl(a):j2.safeAttrValue(n,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;e&&!i?s=e:e&&i?(s=Object.create(this.arcgisFilterOptions),s.css={whiteList:this.arcgisCSSWhiteList},Object.keys(e).forEach(function(n){if(n==="whiteList")s.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,e.whiteList||{}]);else if(n==="css"){var o=e.css.whiteList;o!=null&&e.css instanceof Object&&Object.keys(o).forEach(function(a){return s.css.whiteList[a]=o[a]})}else s[n]=e[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList,s.css={whiteList:this.arcgisCSSWhiteList}),this.xssFilterOptions=s,this._xssFilter=new j2.FilterXSS(s)}return t.prototype.sanitize=function(e,i){switch(i===void 0&&(i={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,i);default:return i.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,i){var r=(i??{}).isProtocolRequired,s=r===void 0?!0:r,n=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?j2.escapeAttrValue(e):!n&&!s?j2.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,i,r,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,i,r,s):j2.safeAttrValue(e,i,r,s)},t.prototype.validate=function(e,i){i===void 0&&(i={});var r=this.sanitize(e,i);return{isValid:e===r,sanitized:r}},t.prototype.encodeHTML=function(e){var i=this;return String(e).replace(/[&<>"'\/]/g,function(r){return i._entityMap[r]})},t.prototype.encodeAttrValue=function(e){var i=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(r,s){return i.test(r)?r:"&#x".concat(Number(e.charCodeAt(s)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var i={};return e.forEach(function(r){Object.keys(r).forEach(function(s){Array.isArray(r[s])&&Array.isArray(i[s])?i[s]=i[s].concat(r[s]):i[s]=r[s]})}),i},t.prototype._iterateOverObject=function(e,i){var r=this;i===void 0&&(i={});try{var s=!1,n=void 0;if(Array.isArray(e))n=e.reduce(function(a,l){var c=r.validate(l,i);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(Ktt(e)){var o=Object.keys(e);n=o.reduce(function(a,l){var c=e[l],u=r.validate(c,i);return u.isValid?a[l]=c:(s=!0,a[l]=u.sanitized),a},{})}else return i.allowUndefined&&typeof e>"u"?void 0:null;return s?n:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const SG=new Map;function FAe(){SG.clear()}function tit(t){return SG.get(t)}function iit(t,e){SG.set(t,e)}function l8(t){SG.delete(t)}function kAe(...t){const e=vu.acquire();for(let r=0;r<t.length;r++){const s=t[r],n=typeof s;if(n==="string")e.push(s);else if(Array.isArray(s))e.push.apply(e,s);else if(n==="object")for(const o in s)s[o]&&e.push(o)}const i=e.join(" ");return vu.release(e),i}(()=>{const t=new Map,e=new ResizeObserver(r=>{var s;FAe();for(const n of r)(s=t.get(n.target))==null||s(n)}),i=(r,s,n)=>(t.set(r,s),e.observe(r,n),Gi(()=>{e.unobserve(r),t.delete(r)}));return(r,s,n)=>{let o=null;return ES([te(()=>typeof r=="function"?r():r,a=>{o==null||o.remove(),a&&(o=i(a,s,n))},hr),Gi(()=>o==null?void 0:o.remove())])}})();function Cb(t){const e=t==null?void 0:t.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function ode(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function ade(t){const e="data-node-ref";this[t.getAttribute(e)]=t}const rit=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],sit=rit.reduce((t,e)=>(t[e]=[],t),{}),nit=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],UAe=new eit({whiteList:sit,onTagAttr:(t,e,i)=>{const r=`${e}="${i}"`;if(nit.includes(e))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function oit(t){return t==="Enter"||t===" "}const VAe="http://www.w3.org/",EG=`${VAe}2000/svg`,zAe=`${VAe}1999/xlink`;let lde=[],tse=(t,e)=>{let i={};return Object.keys(t).forEach(r=>{i[r]=t[r]}),e&&Object.keys(e).forEach(r=>{i[r]=e[r]}),i},ise=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),BAe=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},ait=(t,e,i)=>{if(e.vnodeSelector!==""){for(let r=i;r<t.length;r++)if(ise(t[r],e))return r}return-1},c8=(t,e,i,r)=>{let s=t[e];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(ise(a,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},lit=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},PY=[],OY=!1,jAe=t=>{(t.children||[]).forEach(jAe),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},cde=()=>{OY=!1,PY.forEach(jAe),PY.length=0},ude=t=>{PY.push(t),OY||(OY=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(cde,{timeout:16}):setTimeout(cde,16))},hde=t=>{let e=t.domNode;if(t.properties){let i=t.properties.exitAnimation;if(i)return e.style.pointerEvents="none",void i(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),ude(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),ude(t))},cit=(t,e,i)=>{if(!e)return;let r=i.eventHandlerInterceptor,s=Object.keys(e),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")$Y(t,l,!0);else if(a==="classes"){let c=Object.keys(l),u=c.length;for(let d=0;d<u;d++){let f=c[d];l[f]&&t.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),u=c.length;for(let d=0;d<u;d++){let f=c[d],m=l[f];m&&(BAe(m),i.styleApplyer(t,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(r&&(l=r(a,l,t,e)),a==="oninput"&&function(){let u=l;l=function(d){u.apply(this,[d]),d.target["oninput-value"]=d.target.value}}()),t[a]=l):i.namespace===EG?a==="href"?t.setAttributeNS(zAe,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=UAe.sanitize(l):RY(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function RY(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let Dz,uit=(t,e,i)=>{if(e)for(let r of e)cM(r,t,void 0,i)},GAe=(t,e,i)=>{uit(t,e.children,i),e.text&&(t.textContent=e.text),cit(t,e.properties,i),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,i,e.vnodeSelector,e.properties,e.children])},cM=(t,e,i,r)=>{let s,n=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")s=t.domNode=a.createTextNode(t.text),i!==void 0?e.insertBefore(s,i):e.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let u=o.charAt(n-1),d=o.slice(n,l);u==="."?s.classList.add(d):u==="#"?s.id=d:(d==="svg"&&(r=tse(r,{namespace:EG})),r.namespace!==void 0?s=t.domNode=a.createElementNS(r.namespace,d):(s=t.domNode=t.domNode||a.createElement(d),d==="input"&&t.properties&&t.properties.type!==void 0&&s.setAttribute("type",t.properties.type)),i!==void 0?e.insertBefore(s,i):s.parentNode!==e&&e.appendChild(s)),n=l+1}}GAe(s,t,r)}},$Y=(t,e,i)=>{e&&e.split(" ").forEach(r=>{r&&t.classList.toggle(r,i)})},hit=(t,e,i,r)=>{if(!i)return;let s=!1,n=Object.keys(i),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=i[l],u=e[l];if(l==="class")u!==c&&($Y(t,u,!1),$Y(t,c,!0));else if(l==="classes"){let d=t.classList,f=Object.keys(c),m=f.length;for(let g=0;g<m;g++){let y=f[g],v=!!c[y];v!==!!u[y]&&(s=!0,v?d.add(y):d.remove(y))}}else if(l==="styles"){let d=Object.keys(c),f=d.length;for(let m=0;m<f;m++){let g=d[m],y=c[g];y!==u[g]&&(s=!0,y?(BAe(y),r.styleApplyer(t,g,y)):r.styleApplyer(t,g,""))}}else if(c||typeof u!="string"||(c=""),l!=="value"||RY(t)){if(c!==u){let d=typeof c;d==="function"&&r.eventHandlerInterceptor||(r.namespace===EG?l==="href"?t.setAttributeNS(zAe,l,c):t.setAttribute(l,c):d==="string"?l==="innerHTML"?t[l]=UAe.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):RY(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),s=!0)}}else{let d=t[l];d!==c&&(t["oninput-value"]?d===t["oninput-value"]:c!==u)&&(t[l]=c,t["oninput-value"]=void 0),c!==u&&(s=!0)}}return s},dit=(t,e,i,r,s)=>{if(i===r)return!1;r=r||lde;let n,o=(i=i||lde).length,a=r.length,l=0,c=0,u=!1;for(;c<a;){let d=l<o?i[l]:void 0,f=r[c];if(d!==void 0&&ise(d,f))u=Dz(d,f,s)||u,l++;else{let m=ait(i,f,l+1);if(m>=0){for(n=l;n<m;n++)hde(i[n]),c8(i,n,t,"removed");u=Dz(i[m],f,s)||u,l=m+1}else cM(f,e,l<o?i[l].domNode:void 0,s),lit(f),c8(r,c,t,"added")}c++}if(o>l)for(n=l;n<o;n++)hde(i[n]),c8(i,n,t,"removed");return u};Dz=(t,e,i)=>{let r=t.domNode,s=!1;if(t===e)return!1;let n=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=r.ownerDocument.createTextNode(e.text);return r.parentNode.replaceChild(o,r),e.domNode=o,s=!0,s}e.domNode=r}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(i=tse(i,{namespace:EG})),t.text!==e.text&&(n=!0,e.text===void 0?r.removeChild(r.firstChild):r.textContent=e.text),e.domNode=r,n=dit(e,r,t.children,e.children,i)||n,n=hit(r,t.properties,e.properties,i)||n,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[r,i,e.vnodeSelector,e.properties,e.children]);return n&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(r,e.properties,t.properties),s};let LO=(t,e)=>({getLastRender:()=>t,update:i=>{if(t.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=t;t=i,Dz(r,i,e)},domNode:t.domNode});const pit={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}};let oC=t=>tse(pit,t),V1={create:(t,e)=>(e=oC(e),cM(t,document.createElement("div"),void 0,e),LO(t,e)),append:(t,e,i)=>(i=oC(i),cM(e,t,void 0,i),LO(e,i)),insertBefore:(t,e,i)=>(i=oC(i),cM(e,t.parentNode,t,i),LO(e,i)),merge:(t,e,i)=>(i=oC(i),e.domNode=t,GAe(t,e,i),LO(e,i)),replace:(t,e,i)=>(i=oC(i),cM(e,t.parentNode,t,i),t.parentNode.removeChild(t),LO(e,i))},HAe,fit=(t,e)=>{let i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i};HAe=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let mit=(t,e)=>{let i=t;return e.forEach(r=>{i=i&&i.children?HAe(i.children,s=>s.domNode===r):void 0}),i},git=(t,e,i)=>{let r=function(s){i("domEvent",s);let n=e(),o=fit(s.currentTarget,n.domNode);o.reverse();let a,l=mit(n.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",s),a};return(s,n,o,a)=>r},IY=t=>{let e,i,r=oC(t),s=r.performanceLogger,n=!0,o=!1,a=[],l=[],c=(d,f,m)=>{let g,y=()=>g;r.eventHandlerInterceptor=git(e,y,s),g=d(f,m(),r),a.push(g),l.push(m)},u=()=>{if(i=void 0,n){n=!1,s("renderStart",void 0);for(let d=0;d<a.length;d++){let f=l[d]();s("rendered",void 0),a[d].update(f),s("patched",void 0)}s("renderDone",void 0),n=!0}};return e={renderNow:u,scheduleRender:()=>{i||o||(i=requestAnimationFrame(u))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,n=!0,e.scheduleRender()},append:(d,f)=>{c(V1.append,d,f)},insertBefore:(d,f)=>{c(V1.insertBefore,d,f)},merge:(d,f)=>{c(V1.merge,d,f)},replace:(d,f)=>{c(V1.replace,d,f)},detach:d=>{for(let f=0;f<l.length;f++)if(l[f]===d)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},e},Lv=class extends Ue{constructor(){super(...arguments),this.items=new st,this._watchUpdatingTracking=new Z0,this._callbacks=new Map,this._projector=IY(),this._hiddenProjector=IY()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,i=>{for(const r of i.added){const s=()=>r.render();this._callbacks.set(r,s),this._projector.append(this.surface,s)}for(const r of i.removed){const s=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(s.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const i=this._hiddenSurface,r=this._hiddenProjector;let s;const n=()=>(s=e.render(),s);r.append(i,n),r.renderNow();const o={left:0,top:0,right:0,bottom:0};if(s!=null&&s.domNode){const a=s.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(r.detach(n);i.firstChild;)i.removeChild(i.firstChild);return o}overlaps(e,i){const r=this.computeBoundingRect(e),s=this.computeBoundingRect(i);return Math.max(r.left,s.left)<=Math.min(r.right,s.right)&&Math.max(r.top,s.top)<=Math.min(r.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,i){const r=!!(i!=null&&i.disableDecorations);if(!this.items.some(n=>n.visible&&!(r&&n.isDecoration)))return;const s=e.getContext("2d");s.save(),s.font=this._fontString(),this.items.forEach(n=>{r&&n.isDecoration||(s.save(),n.renderCanvas(s),s.restore())}),s.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};h([p({readOnly:!0})],Lv.prototype,"surface",void 0),h([p({readOnly:!0})],Lv.prototype,"items",void 0),h([p({readOnly:!0})],Lv.prototype,"needsRender",null),h([p({readOnly:!0})],Lv.prototype,"_watchUpdatingTracking",void 0),h([p({readOnly:!0})],Lv.prototype,"updating",null),Lv=h([I("esri.views.overlay.ViewOverlay")],Lv);const dde=Lv,u8=[0,0];function yit(t){const e=(t.ownerDocument||window.document).defaultView,i=t.getBoundingClientRect();return u8[0]=i.left+((e==null?void 0:e.pageXOffset)??0),u8[1]=i.top+((e==null?void 0:e.pageYOffset)??0),u8}function pde(t){t&&(bMe(t),t.parentNode&&t.parentNode.removeChild(t))}function _it(t){const e=document.createElement("div");return t.appendChild(e),e}const DO=16,cF=750,vit=512,bit=2,wit=t=>{let e=class extends t{constructor(...i){super(...i),this._freqInfo={freq:DO,time:cF},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([te(()=>this.cursor,r=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",r)}),te(()=>this.navigating,r=>{const{surface:s}=this;s&&s.setAttribute("data-navigating",r.toString())})])}initialize(){this.addHandles([te(()=>this.ui,(i,r)=>this._handleUIChange(i,r),$t),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=qe(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(i){const r=this._get("container"),s=pG(i);if(s||typeof i!="string"||se.getLogger(this).error("#container",`element with id '${i}' not found`),r===s)return;if(this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(pde(this.root),this._set("root",null)),this.userContent&&(Nhe(this.userContent,r),pde(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",Nhe(s,n),s.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",s.insertBefore(o,s.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new dde;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(te(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=PS({render:()=>{var u;return(u=this.overlay)==null?void 0:u.render()}}):this._overlayRenderTaskHandle=$r(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",s),this._startMeasuring()}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get size(){return[this.width,this.height]}blur(){var i;(i=this.surface)==null||i.blur()}focus(){var i;(i=this.surface)==null||i.focus()}pageToContainer(i,r,s){const n=this.position;return i-=n?n[0]:0,r-=n?n[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}containerToPage(i,r,s){const n=this.position;return i+=n?n[0]:0,r+=n?n[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}_handleUIChange(i,r){this.removeHandles("ui"),r&&r!==i&&r.destroy(),i&&(i.view=this,this.addHandles(te(()=>this.root,s=>{i.container=s?_it(s):null},$t),"ui")),this._set("ui",i)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=DO,i.time=cF,this.addHandles([kP(window,"resize",()=>{i.freq=DO,i.time=cF}),PS({prepare:r=>{const s=this._measure(),n=this._freqInfo;if(n.time+=r.deltaTime,s&&(n.freq=DO,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?DO:Math.min(cF,n.freq*bit),!s&&n.freq>=vit&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,s=i?i.clientHeight:0;if(r===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return r===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:r,height:s}),!0)}_position(){const i=this.container,r=this.position,s=i&&yit(i);return!!s&&(!r||s[0]!==r[0]||s[1]!==r[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return h([p()],e.prototype,"container",null),h([p({readOnly:!0})],e.prototype,"focused",null),h([p({readOnly:!0})],e.prototype,"height",void 0),h([p()],e.prototype,"messagesCommon",void 0),h([p({type:dde})],e.prototype,"overlay",void 0),h([p({readOnly:!0})],e.prototype,"position",void 0),h([p({readOnly:!0})],e.prototype,"resizing",void 0),h([p({readOnly:!0})],e.prototype,"root",void 0),h([p({value:null,readOnly:!0})],e.prototype,"size",null),h([p({readOnly:!0})],e.prototype,"surface",void 0),h([p({readOnly:!0})],e.prototype,"suspended",void 0),h([p()],e.prototype,"ui",void 0),h([p({readOnly:!0})],e.prototype,"userContent",void 0),h([p({readOnly:!0})],e.prototype,"width",void 0),h([p()],e.prototype,"widthBreakpoint",void 0),e=h([I("esri.views.DOMContainer")],e),e};function Zb(t,e,i,r){return{x:t,y:e,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function p7t(t,e,i,r,s){t.x=e,t.y=i,t.z=r,t.hasZ=r!=null,t.spatialReference=s}function Fo(t,e,i,r,s){return!(e==null||r==null||t.length<2)&&(NO.x=t[0],NO.y=t[1],NO.z=t[2],NO.spatialReference=e,pl(NO,i,r,s))}const NO=Zb(0,0,0,Ze.WGS84);function Yb(t,e,i){return!!Fo(t,e,uF,i.spatialReference)&&(i.x=uF[0],i.y=uF[1],i.z=uF[2],!0)}async function qAe(t,e,i,r){return await qP(e,i.spatialReference,null,r),Yb(t,e,i)}const uF=E();function xit(t){return hs(t,aM)||f2(t)?{wkid:Su.GCSMARS2000}:hs(t,lM)||m2(t)?{wkid:Su.GCSMOON2000}:Ze.WGS84}var rs,oa;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL",t[t.TILES3D=8]="TILES3D"})(rs||(rs={}));let Tit=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=oa.ALL,this.normalRequired=!0}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(oa||(oa={}));let Sit=class{constructor(e,i,r){this.object=e,this.geometryId=i,this.triangleNr=r}},Eit=class extends Sit{constructor(e,i,r,s){super(e,i,r),this.center=s!=null?hn(s):null}},WAe=class{constructor(e){this.layerUid=e}},SD=class extends WAe{constructor(e,i){super(e),this.graphicUid=i}};function ap(t){return(t==null?void 0:t.dist)!=null}function fde(t){return(e,i,r)=>(xr(mde,e,i,r),!Wre(t,mde))}function CG(t){return ap(t)&&t.intersector===rs.OBJECT&&!!t.target}function MG(t){return ap(t)&&t.intersector===rs.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const mde=E();function lp(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Cit(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function rse(t,e,i,r,s,n,o,a,l,c){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function AG(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function x2(t,e){if(t===e){const i=e[1],r=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function ED(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=u*o-a*c,f=-u*n+a*l,m=c*n-o*l;let g=i*d+r*f+s*m;return g?(g=1/g,t[0]=d*g,t[1]=(-u*r+s*c)*g,t[2]=(a*r-s*o)*g,t[3]=f*g,t[4]=(u*i-s*l)*g,t[5]=(-a*i+s*n)*g,t[6]=m*g,t[7]=(-c*i+r*l)*g,t[8]=(o*i-r*n)*g,t):null}function Mit(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t[0]=o*u-a*c,t[1]=s*c-r*u,t[2]=r*a-s*o,t[3]=a*l-n*u,t[4]=i*u-s*l,t[5]=s*n-i*a,t[6]=n*c-o*l,t[7]=r*l-i*c,t[8]=i*o-r*n,t}function Ait(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*n-o*l)+i*(-c*s+o*a)+r*(l*s-n*a)}function QA(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],f=i[0],m=i[1],g=i[2],y=i[3],v=i[4],b=i[5],w=i[6],x=i[7],S=i[8];return t[0]=f*r+m*o+g*c,t[1]=f*s+m*a+g*u,t[2]=f*n+m*l+g*d,t[3]=y*r+v*o+b*c,t[4]=y*s+v*a+b*u,t[5]=y*n+v*l+b*d,t[6]=w*r+x*o+S*c,t[7]=w*s+x*a+S*u,t[8]=w*n+x*l+S*d,t}function KA(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],f=i[0],m=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=o,t[4]=a,t[5]=l,t[6]=f*r+m*o+c,t[7]=f*s+m*a+u,t[8]=f*n+m*l+d,t}function PG(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],f=Math.sin(i),m=Math.cos(i);return t[0]=m*r+f*o,t[1]=m*s+f*a,t[2]=m*n+f*l,t[3]=m*o-f*r,t[4]=m*a-f*s,t[5]=m*l-f*n,t[6]=c,t[7]=u,t[8]=d,t}function CD(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=n*e[6],t[7]=n*e[7],t[8]=n*e[8],t}function Pit(t,e,i){const r=i[0],s=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t}function Oit(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function Rit(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function $it(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Iit(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function fL(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i+i,a=r+r,l=s+s,c=i*o,u=r*o,d=r*a,f=s*o,m=s*a,g=s*l,y=n*o,v=n*a,b=n*l;return t[0]=1-d-g,t[3]=u-b,t[6]=f+v,t[1]=u+b,t[4]=1-c-g,t[7]=m-y,t[2]=f-v,t[5]=m+y,t[8]=1-c-d,t}function ZAe(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10],d=u*o-a*c,f=-u*n+a*l,m=c*n-o*l,g=i*d+r*f+s*m;if(!g)return null;const y=1/g;return t[0]=d*y,t[1]=(-u*r+s*c)*y,t[2]=(a*r-s*o)*y,t[3]=f*y,t[4]=(u*i-s*l)*y,t[5]=(-a*i+s*n)*y,t[6]=m*y,t[7]=(-c*i+r*l)*y,t[8]=(o*i-r*n)*y,t}function Mb(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],f=e[10],m=e[11],g=e[12],y=e[13],v=e[14],b=e[15],w=i*a-r*o,x=i*l-s*o,S=i*c-n*o,C=r*l-s*a,M=r*c-n*a,O=s*c-n*l,D=u*y-d*g,U=u*v-f*g,k=u*b-m*g,H=d*v-f*y,V=d*b-m*y,X=f*b-m*v;let q=w*X-x*V+S*H+C*k-M*U+O*D;return q?(q=1/q,t[0]=(a*X-l*V+c*H)*q,t[1]=(l*k-o*X-c*U)*q,t[2]=(o*V-a*k+c*D)*q,t[3]=(s*V-r*X-n*H)*q,t[4]=(i*X-s*k+n*U)*q,t[5]=(r*k-i*V-n*D)*q,t[6]=(y*O-v*M+b*C)*q,t[7]=(v*S-g*O-b*x)*q,t[8]=(g*M-y*S+b*w)*q,t):null}function Lit(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function Dit(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Nit(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function Fit(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t}function YAe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}function kit(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t}function Uit(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t}function Vit(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function zit(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=e[0],f=e[1],m=e[2],g=e[3],y=e[4],v=e[5],b=e[6],w=e[7],x=e[8],S=Do();return Math.abs(i-d)<=S*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(r-f)<=S*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-m)<=S*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(n-g)<=S*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(o-y)<=S*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(a-v)<=S*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-b)<=S*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-w)<=S*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(u-x)<=S*Math.max(1,Math.abs(u),Math.abs(x))}function Bit(t){const e=Do(),i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return Math.abs(1-(i*i+n*n+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+u*u))<=e}const jit=QA,Git=YAe;Object.freeze(Object.defineProperty({__proto__:null,add:Fit,adjoint:Mit,copy:Cit,determinant:Ait,equals:zit,exactEquals:Vit,frob:Nit,fromMat2d:Iit,fromMat4:lp,fromQuat:fL,fromRotation:Rit,fromScaling:$it,fromTranslation:Oit,identity:AG,invert:ED,isOrthoNormal:Bit,mul:jit,multiply:QA,multiplyScalar:kit,multiplyScalarAndAdd:Uit,normalFromMat4:Mb,normalFromMat4Legacy:ZAe,projection:Lit,rotate:PG,scale:CD,scaleByVec2:Pit,set:rse,str:Dit,sub:Git,subtract:YAe,translate:KA,transpose:x2},Symbol.toStringTag,{value:"Module"}));function Hit(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Nz(t,e,i){i*=.5;const r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function OG(t,e){const i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>Do()?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i}function RG(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=r*u+o*a+s*c-n*l,t[1]=s*u+o*l+n*a-r*c,t[2]=n*u+o*c+r*l-s*a,t[3]=o*u-r*a-s*l-n*c,t}function qit(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+o*a,t[1]=s*l+n*a,t[2]=n*l-s*a,t[3]=o*l-r*a,t}function Wit(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l-n*a,t[1]=s*l+o*a,t[2]=n*l+r*a,t[3]=o*l-s*a,t}function Zit(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+s*a,t[1]=s*l-r*a,t[2]=n*l+o*a,t[3]=o*l-n*a,t}function Yit(t,e){const i=e[0],r=e[1],s=e[2];return t[0]=i,t[1]=r,t[2]=s,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),t}function Pk(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3];let l,c,u,d,f,m=i[0],g=i[1],y=i[2],v=i[3];return c=s*m+n*g+o*y+a*v,c<0&&(c=-c,m=-m,g=-g,y=-y,v=-v),1-c>Do()?(l=Math.acos(c),u=Math.sin(l),d=Math.sin((1-r)*l)/u,f=Math.sin(r*l)/u):(d=1-r,f=r),t[0]=d*s+f*m,t[1]=d*n+f*g,t[2]=d*o+f*y,t[3]=d*a+f*v,t}function Xit(t){const e=gD,i=e(),r=e(),s=e(),n=Math.sqrt(1-i),o=Math.sqrt(i);return t[0]=n*Math.sin(2*Math.PI*r),t[1]=n*Math.cos(2*Math.PI*r),t[2]=o*Math.sin(2*Math.PI*s),t[3]=o*Math.cos(2*Math.PI*s),t}function Jit(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i*i+r*r+s*s+n*n,a=o?1/o:0;return t[0]=-i*a,t[1]=-r*a,t[2]=-s*a,t[3]=n*a,t}function tb(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function XAe(t,e){const i=e[0]+e[4]+e[8];let r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;r=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*o+o]+1),t[s]=.5*r,r=.5/r,t[3]=(e[3*n+o]-e[3*o+n])*r,t[n]=(e[3*n+s]+e[3*s+n])*r,t[o]=(e[3*o+s]+e[3*s+o])*r}return t}function Qit(t,e,i,r){const s=.5*Math.PI/180;e*=s,i*=s,r*=s;const n=Math.sin(e),o=Math.cos(e),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),u=Math.cos(r);return t[0]=n*l*u-o*a*c,t[1]=o*a*u+n*l*c,t[2]=o*l*c-n*a*u,t[3]=o*l*u+n*a*c,t}function Kit(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const ert=Hd,JAe=_s,trt=kre,irt=RG,rrt=GS,srt=ZMe,nrt=gG,QAe=Ure,ort=QAe,KAe=Vre,art=KAe,sse=WMe,lrt=YM,crt=HS;function urt(t,e,i){const r=Te(e,i);return r<-.999999?(ft(cm,hrt,e),kl(cm)<1e-6&&ft(cm,drt,e),Ce(cm,cm),Nz(t,cm,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(ft(cm,e,i),t[0]=cm[0],t[1]=cm[1],t[2]=cm[2],t[3]=1+r,sse(t,t))}const cm=E(),hrt=Ge(1,0,0),drt=Ge(0,1,0);function prt(t,e,i,r,s,n){return Pk(gde,e,s,n),Pk(yde,i,r,n),Pk(t,gde,yde,2*n*(1-n)),t}const gde=qh(),yde=qh();function frt(t,e,i,r){const s=mrt;return s[0]=i[0],s[3]=i[1],s[6]=i[2],s[1]=r[0],s[4]=r[1],s[7]=r[2],s[2]=-e[0],s[5]=-e[1],s[8]=-e[2],sse(t,XAe(t,s))}const mrt=Yr();Object.freeze(Object.defineProperty({__proto__:null,add:trt,calculateW:Yit,conjugate:tb,copy:ert,dot:srt,equals:crt,exactEquals:lrt,fromEuler:Qit,fromMat3:XAe,getAxisAngle:OG,identity:Hit,invert:Jit,len:ort,length:QAe,lerp:nrt,mul:irt,multiply:RG,normalize:sse,random:Xit,rotateX:qit,rotateY:Wit,rotateZ:Zit,rotationTo:urt,scale:rrt,set:JAe,setAxes:frt,setAxisAngle:Nz,slerp:Pk,sqlerp:prt,sqrLen:art,squaredLength:KAe,str:Kit},Symbol.toStringTag,{value:"Module"}));function ePe(t,e,i){const r=Math.sin(t),s=Math.cos(t),n=Math.sin(e),o=Math.cos(e),a=i;return a[0]=-r,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function grt(t,e,i){return ePe(t,e,i),Lu(i,i),i}function $h(t,e,i,r){if(t==null||r==null)return!1;const s=vz(t,KXe),n=vz(r,eJe);if(s===n&&!_de(n)&&(s!==ue.UNKNOWN||hs(t,r)))return g2(i,e),!0;if(_de(n)){const o=BR[s][ue.LON_LAT],a=BR[ue.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,X_,0),a(X_,0,J_,0),ePe(hF*X_[0],hF*X_[1],i),i[12]=J_[0],i[13]=J_[1],i[14]=J_[2],!0)}if(!(n!==ue.WEB_MERCATOR&&n!==ue.PLATE_CARREE&&n!==ue.WGS84&&n!==ue.CGCS2000||s!==ue.WGS84&&s!==ue.SPHERICAL_ECEF&&s!==ue.WEB_MERCATOR&&s!==ue.CGCS2000)){const o=BR[s][ue.LON_LAT],a=BR[ue.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,X_,0),a(X_,0,J_,0),s===ue.SPHERICAL_ECEF?grt(hF*X_[0],hF*X_[1],i):tp(i),i[12]=J_[0],i[13]=J_[1],i[14]=J_[2],!0)}return!1}function _de(t){return t===ue.SPHERICAL_ECEF||t===ue.SPHERICAL_MARS_PCPF||t===ue.SPHERICAL_MOON_PCPF}const hF=kt(1),X_=E(),J_=E();let MD=class{constructor(e,i,r=i){this.data=e,this.size=i,this.stride=r}},ht=class extends MD{constructor(e,i,r,s=!1,n=r){super(e,r,n),this.indices=i,this.exclusive=s}};const eP=1e-6,FO=E(),dF=E();function yrt(t,e){const{data:i,size:r}=t,s=i.length/r;if(s<=0)return;const n=new Mrt(t);DY(FO,n.minProj,n.maxProj),e$(FO,FO,.5),Ld(dF,n.maxProj,n.minProj);const o=LY(dF),a=new Art;a.quality=o,s<14&&(t=new MD(new Float64Array(n.buffer,112,42),3));const l=E(),c=E(),u=E(),d=E(),f=E(),m=E(),g=E();switch(_rt(n,t,g,l,c,u,d,f,m,a)){case 1:return void xde(FO,dF,e);case 2:return void Ert(t,d,e)}vrt(t,g,l,c,u,d,f,m,a),tPe(t,a.b0,a.b1,a.b2,JM,QM);const y=E();Ld(y,QM,JM),a.quality=LY(y),a.quality<o?iPe(a.b0,a.b1,a.b2,JM,QM,y,e):xde(FO,dF,e)}function _rt(t,e,i,r,s,n,o,a,l,c){return brt(t,r,s),NY(r,s)<eP?1:(Ld(o,r,s),Ta(o,o),wrt(e,r,o,n)<eP?2:(Ld(a,s,n),Ta(a,a),Ld(l,n,r),Ta(l,l),Dd(i,a,o),Ta(i,i),mx(e,i,o,a,l,c),0))}const kO=E(),UO=E(),Xh=E(),Jh=E(),Qh=E(),Q_=E(),K_=E(),ev=E();function vrt(t,e,i,r,s,n,o,a,l){xrt(t,e,i,kO,UO),kO[0]!==void 0&&(Ld(Xh,kO,i),Ta(Xh,Xh),Ld(Jh,kO,r),Ta(Jh,Jh),Ld(Qh,kO,s),Ta(Qh,Qh),Dd(Q_,Jh,n),Ta(Q_,Q_),Dd(K_,Qh,o),Ta(K_,K_),Dd(ev,Xh,a),Ta(ev,ev),mx(t,Q_,n,Jh,Xh,l),mx(t,K_,o,Qh,Jh,l),mx(t,ev,a,Xh,Qh,l)),UO[0]!==void 0&&(Ld(Xh,UO,i),Ta(Xh,Xh),Ld(Jh,UO,r),Ta(Jh,Jh),Ld(Qh,UO,s),Ta(Qh,Qh),Dd(Q_,Jh,n),Ta(Q_,Q_),Dd(K_,Qh,o),Ta(K_,K_),Dd(ev,Xh,a),Ta(ev,ev),mx(t,Q_,n,Jh,Xh,l),mx(t,K_,o,Qh,Jh,l),mx(t,ev,a,Xh,Qh,l))}function brt(t,e,i){let r=NY(t.maxVert[0],t.minVert[0]),s=0;for(let n=1;n<7;++n){const o=NY(t.maxVert[n],t.minVert[n]);o>r&&(r=o,s=n)}Ch(e,t.minVert[s]),Ch(i,t.maxVert[s])}const Kh=[0,0,0];function wrt(t,e,i,r){const{data:s,size:n}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){Kh[0]=s[l]-e[0],Kh[1]=s[l+1]-e[1],Kh[2]=s[l+2]-e[2];const c=i[0]*Kh[0]+i[1]*Kh[1]+i[2]*Kh[2],u=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],d=Kh[0]*Kh[0]+Kh[1]*Kh[1]+Kh[2]*Kh[2]-c*c/u;d>o&&(o=d,a=l)}return Ch(r,s,a),o}const so=mt();function xrt(t,e,i,r,s){Srt(t,e,so,s,r);const n=sPe(i,e);so[1]-eP<=n&&(r[0]=void 0),so[0]+eP>=n&&(s[0]=void 0)}const vde=E(),bde=E(),wde=E(),G2=E(),H2=E(),pF=E();function mx(t,e,i,r,s,n){if(rPe(e)<eP)return;Dd(vde,i,e),Dd(bde,r,e),Dd(wde,s,e),XM(t,e,so),H2[1]=so[0],G2[1]=so[1],pF[1]=G2[1]-H2[1];const o=[i,r,s],a=[vde,bde,wde];for(let l=0;l<3;++l){XM(t,o[l],so),H2[0]=so[0],G2[0]=so[1],XM(t,a[l],so),H2[2]=so[0],G2[2]=so[1],pF[0]=G2[0]-H2[0],pF[2]=G2[2]-H2[2];const c=LY(pF);c<n.quality&&(Ch(n.b0,o[l]),Ch(n.b1,e),Ch(n.b2,a[l]),n.quality=c)}}const Trt=E();function XM(t,e,i){const{data:r,size:s}=t;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<r.length;n+=s){const o=r[n]*e[0]+r[n+1]*e[1]+r[n+2]*e[2];i[0]=Math.min(i[0],o),i[1]=Math.max(i[1],o)}}function Srt(t,e,i,r,s){const{data:n,size:o}=t;Ch(r,n),Ch(s,r),i[0]=sPe(Trt,e),i[1]=i[0];for(let a=o;a<n.length;a+=o){const l=n[a]*e[0]+n[a+1]*e[1]+n[a+2]*e[2];l<i[0]&&(i[0]=l,Ch(r,n,a)),l>i[1]&&(i[1]=l,Ch(s,n,a))}}function xde(t,e,i){i.center=t,i.halfSize=he(e,e,.5),i.quaternion=Lre}const Ay=E(),q2=E(),VO=E(),JM=E(),QM=E(),Tde=E();function Ert(t,e,i){Ch(Ay,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?Ay[0]=0:Math.abs(e[1])>Math.abs(e[2])?Ay[1]=0:Ay[2]=0,rPe(Ay)<eP&&(Ay[0]=Ay[1]=Ay[2]=1),Dd(q2,e,Ay),Ta(q2,q2),Dd(VO,e,q2),Ta(VO,VO),tPe(t,e,q2,VO,JM,QM),Ld(Tde,QM,JM),iPe(e,q2,VO,JM,QM,Tde,i)}function tPe(t,e,i,r,s,n){XM(t,e,so),s[0]=so[0],n[0]=so[1],XM(t,i,so),s[1]=so[0],n[1]=so[1],XM(t,r,so),s[2]=so[0],n[2]=so[1]}const ww=E(),zO=E(),fF=E(),um=KI(1,0,0,0,1,0,0,0,1),Crt=qh();function iPe(t,e,i,r,s,n,o){um[0]=t[0],um[1]=t[1],um[2]=t[2],um[3]=e[0],um[4]=e[1],um[5]=e[2],um[6]=i[0],um[7]=i[1],um[8]=i[2],o.quaternion=Prt(Crt,um),DY(ww,r,s),e$(ww,ww,.5),e$(zO,t,ww[0]),e$(fF,e,ww[1]),DY(zO,zO,fF),e$(fF,i,ww[2]),o.center=Ee(zO,zO,fF),o.halfSize=he(ww,n,.5)}const Uu=7;let Mrt=class{constructor(e){this.minVert=new Array(Uu),this.maxVert=new Array(Uu);const i=64*Uu;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,Uu),r+=8*Uu,this.maxProj=new Float64Array(this.buffer,r,Uu),r+=8*Uu;for(let l=0;l<Uu;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Uu;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Uu;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(Uu),n=new Array(Uu),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<Uu;++l){let c=s[l];Ch(this.minVert[l],o,c),c=n[l],Ch(this.maxVert[l],o,c)}}},Art=class{constructor(){this.b0=Ge(1,0,0),this.b1=Ge(0,1,0),this.b2=Ge(0,0,1),this.quality=0}};function LY(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function DY(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}function Ld(t,e,i){t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2]}function e$(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}function Ch(t,e,i=0){t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2]}function Dd(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2];t[0]=s*l-n*a,t[1]=n*o-r*l,t[2]=r*a-s*o}function Ta(t,e){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(i>0){const r=1/Math.sqrt(i);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}}function rPe(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function NY(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}function sPe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Prt(t,e){const i=e[0]+e[4]+e[8];if(i>0){let r=Math.sqrt(i+1);t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r}else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);const s=(r+1)%3,n=(r+2)%3;let o=Math.sqrt(e[3*r+r]-e[3*s+s]-e[3*n+n]+1);t[r]=.5*o,o=.5/o,t[3]=(e[3*s+n]-e[3*n+s])*o,t[s]=(e[3*s+r]+e[3*r+s])*o,t[n]=(e[3*n+r]+e[3*r+n])*o}return t}let nPe=class Ok{constructor(e=On,i=Urt,r=Lre){this._data=[e[0],e[1],e[2],i[0],i[1],i[2],r[0],r[1],r[2],r[3]]}clone(){const e=new Ok;return e._data=this._data.slice(),e}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const i=new Ok;return i._data=e.slice(),i}static fromJSON(e){return new Ok(e.center,e.halfSize,e.quaternion)}copy(e){this._data=e.data.slice()}get center(){return de(it.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,i,r){this._data[0]=e,this._data[1]=i,this._data[2]=r}get halfSize(){return de(it.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return JAe(TKe.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const i=ms,r=this._data;i[0]=r[6],i[1]=r[7],i[2]=r[8],i[3]=r[9];for(let s=0;s<8;++s){const n=e[s];n[0]=(1&s?-1:1)*r[3],n[1]=(2&s?-1:1)*r[4],n[2]=(4&s?-1:1)*r[5],fu(n,n,i),n[0]+=r[0],n[1]+=r[1],n[2]+=r[2]}}doesIntersectFrustumConservativeApproximation(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],i=this._data[4],r=this._data[5];return Math.sqrt(e*e+i*i+r*r)}intersectSphere(e){bi[0]=this._data[0]-e[0],bi[1]=this._data[1]-e[1],bi[2]=this._data[2]-e[2];const i=this.getQuaternion(L0);return tb(ms,i),fu(bi,bi,ms),NA(bi,bi),Py[0]=Math.min(bi[0],this._data[3]),Py[1]=Math.min(bi[1],this._data[4]),Py[2]=Math.min(bi[2],this._data[5]),iL(Py,bi)<e[3]*e[3]}intersectSphereWithMBS(e,i=this.radius){const r=this._data;bi[0]=r[0]-e[0],bi[1]=r[1]-e[1],bi[2]=r[2]-e[2];const s=e[3],n=s+i;return!(dz(bi)>n*n)&&(ms[0]=-r[6],ms[1]=-r[7],ms[2]=-r[8],ms[3]=r[9],fu(bi,bi,ms),NA(bi,bi),Py[0]=Math.min(bi[0],r[3]),Py[1]=Math.min(bi[1],r[4]),Py[2]=Math.min(bi[2],r[5]),iL(Py,bi)<s*s)}intersectPlane(e){const i=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],r=this.projectedRadius(e);return i>r?1:i<-r?-1:0}intersectRay(e,i,r=0){const s=this._data,n=ms;n[0]=-s[6],n[1]=-s[7],n[2]=-s[8],n[3]=s[9],bi[0]=e[0]-s[0],bi[1]=e[1]-s[1],bi[2]=e[2]-s[2];const o=fu(bi,bi,ms),a=fu(Py,i,ms);let l=-1/0,c=1/0;const u=this.getHalfSize(KM);for(let d=0;d<3;d++){const f=o[d],m=a[d],g=u[d]+r;if(Math.abs(m)>1e-6){const y=(g-f)/m,v=(-g-f)/m;l=Math.max(l,Math.min(y,v)),c=Math.min(c,Math.max(y,v))}else if(f>g||f<-g)return!1}return l<=c}projectedArea(e,i,r,s){const n=this.getQuaternion(L0);tb(ms,n),bi[0]=e[0]-this._data[0],bi[1]=e[1]-this._data[1],bi[2]=e[2]-this._data[2],fu(bi,bi,ms);const o=this.getHalfSize(KM),a=bi[0]<-o[0]?-1:bi[0]>o[0]?1:0,l=bi[1]<-o[1]?-1:bi[1]>o[1]?1:0,c=bi[2]<-o[2]?-1:bi[2]>o[2]?1:0,u=Math.abs(a)+Math.abs(l)+Math.abs(c);if(u===0)return 1/0;const d=u===1?4:6,f=6*(a+3*l+9*c+13);fL(aC,n),CD(aC,aC,o);const m=this.getCenter(wf);for(let v=0;v<d;v++){const b=$rt[f+v];de(bi,((1&b)<<1)-1,(2&b)-1,((4&b)>>1)-1),ta(bi,bi,aC),Ee(xw,m,bi),xw[3]=1,Pu(xw,xw,i);const w=1/Math.max(1e-6,xw[3]);vp[2*v]=xw[0]*w,vp[2*v+1]=xw[1]*w}const g=2*d-2;let y=vp[0]*(vp[3]-vp[g+1])+vp[g]*(vp[1]-vp[g-1]);for(let v=2;v<g;v+=2)y+=vp[v]*(vp[v+3]-vp[v-1]);return Math.abs(y)*r*s*.125}projectedRadius(e){const i=this.getQuaternion(L0);return tb(ms,i),fu(bi,e,ms),Math.abs(bi[0]*this._data[3])+Math.abs(bi[1]*this._data[4])+Math.abs(bi[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius(e)}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius(e)}toAaBoundingBox(e){const i=this.getQuaternion(L0),r=fL(aC,i),s=this._data[3]*Math.abs(r[0])+this._data[4]*Math.abs(r[3])+this._data[5]*Math.abs(r[6]),n=this._data[3]*Math.abs(r[1])+this._data[4]*Math.abs(r[4])+this._data[5]*Math.abs(r[7]),o=this._data[3]*Math.abs(r[2])+this._data[4]*Math.abs(r[5])+this._data[5]*Math.abs(r[8]);e[0]=this._data[0]-s,e[1]=this._data[1]-n,e[2]=this._data[2]-o,e[3]=this._data[0]+s,e[4]=this._data[1]+n,e[5]=this._data[2]+o}transform(e,i,r,s=0,n=Gh(r),o=Gh(i),a=wb(i,o)){if(r===n)i.isGeographic?Nrt(this,e,i,s,o):Drt(this,e,i,s,o,a);else if(i.isWGS84&&(r.isWebMercator||$S(r)))Irt(i,this,r,e,s);else if(i.isWebMercator&&$S(r))Lrt(i,this,r,e,s);else{const l=this.getCenter(wf);l[2]+=s,ds(l,i,0,l,r,0,1),e.center=l,this!==e&&(e.quaternion=this.getQuaternion(L0),e.halfSize=this.getHalfSize(KM))}}};const ms=qh(),L0=qh(),Ort=qh(),bi=E(),Py=E(),xw=ci();function Rrt(t,e=new nPe){return yrt(t,e),e}const vp=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],$rt=(()=>{const t=new Int8Array(162);let e=0;const i=r=>{for(let s=0;s<r.length;s++)t[e+s]=r[s];e+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),t})();function oPe(t,e,i,r,s){const n=t.getQuaternion(L0);s.quaternion=n,tb(ms,n);const o=t.getCenter(wf),a=t.getHalfSize(KM);if(r===Xe.Global){fu(qr,o,ms),NA(sf,qr),yEe(zu,sf,a),Ii(zu,sf,zu);const l=Ve(zu);Ee(zu,sf,a);const c=Ve(zu);if(l<i)s.center=o,de(qr,i,i,i),s.halfSize=Ee(qr,a,qr);else{const u=c>0?1+e/c:1,d=l>0?1+i/l:1,f=(d+u)/2,m=(d-u)/2;he(zu,sf,m),s.halfSize=Pn(zu,zu,a,f),he(zu,sf,f),Pn(zu,zu,a,m),gEe(qr,qr),Xj(qr,zu,qr);const g=t.getQuaternion(Ort);s.center=fu(qr,qr,g)}}else{s.center=Pn(qr,o,DA,(i+e)/2);const l=fu(qr,DA,ms);NA(l,l),s.halfSize=Pn(sf,a,l,(i-e)/2)}return s}function Irt(t,e,i,r,s){e.getCenter(wf),wf[2]+=s;const n=Gh(i);ds(wf,t,0,wf,n,0,1),aPe(n,e,wf,i,r)}function Lrt(t,e,i,r,s){e.getCenter(wf),wf[2]+=s,aPe(t,e,wf,i,r)}function aPe(t,e,i,r,s){const n=e.getQuaternion(L0),o=fL(aC,n),a=e.getHalfSize(KM);for(let l=0;l<8;++l){for(let c=0;c<3;++c)yg[c]=a[c]*(l&1<<c?-1:1);for(let c=0;c<3;++c){let u=i[c];for(let d=0;d<3;++d)u+=yg[d]*o[3*d+c];Rk[3*l+c]=u}}ds(Rk,t,0,Rk,r,0,8),Rrt(Frt,s)}function Drt(t,e,i,r,s=Gh(i),n=wb(i,s)){t.getCorners(Sde),t.getCenter(yg),yg[2]+=r,$h(i,yg,Vu,s),e.setCenter(Vu[12],Vu[13],Vu[14]);const o=2*Math.sqrt(1+Vu[0]+Vu[5]+Vu[10]);ms[0]=(Vu[6]-Vu[9])/o,ms[1]=(Vu[8]-Vu[2])/o,ms[2]=(Vu[1]-Vu[4])/o,ms[3]=.25*o;const a=t.getQuaternion(L0);e.quaternion=RG(ms,ms,a),tb(ms,ms),de(sf,0,0,0);const l=e.getCenter(krt);for(const c of Sde)c[2]+=r,n(c,0,c,0),Ii(qr,c,l),fu(qr,qr,ms),NA(qr,qr),_Ee(sf,sf,qr);e.halfSize=sf}function Nrt(t,e,i,r,s=Gh(i)){const n=_r(i),o=1+Math.max(0,r)/(n.radius+t.centerZ);t.getCenter(yg),yg[2]+=r,ds(yg,i,0,yg,s,0,1),e.center=yg;const a=t.getQuaternion(L0);e.quaternion=a,tb(ms,a),de(qr,0,0,1),fu(qr,qr,ms);const l=t.getHalfSize(KM);de(qr,l[0]*Math.abs(qr[0]),l[1]*Math.abs(qr[1]),l[2]*Math.abs(qr[2])),he(qr,qr,n.inverseFlattening),Ee(qr,l,qr),e.halfSize=he(qr,qr,o)}const Rk=new Array(24),Frt=new MD(Rk,3),yg=E(),wf=E(),krt=E(),KM=E(),aC=Yr(),Vu=ke(),Sde=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],qr=E(),sf=E(),zu=E(),Urt=Ge(-1,-1,-1);let Vrt=class{constructor(){this._transform=ke(),this._transformInverse=new mF({value:this._transform},Zn,ke),this._transformInverseTranspose=new mF(this._transformInverse,Lu,ke),this._transformTranspose=new mF({value:this._transform},Lu,ke),this._transformInverseRotation=new mF({value:this._transform},ZAe,Yr)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){xn(this._transform,e)}multiplyTransform(e){gr(this._transform,this._transform,e)}set(e){xn(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,i){this.setTransformMatrix(e),this.multiplyTransform(i),this._invalidateLazyTransforms()}},mF=class{constructor(e,i,r){this._original=e,this._update=i,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},zrt=class{constructor(e=0){this.offset=e,this.tmpVertex=E()}applyToVertex(e,i,r){const s=de(nse,e,i,r),n=Ee(lPe,s,this.localOrigin),o=this.offset/Ve(n);return Pn(this.tmpVertex,s,n,o),this.tmpVertex}applyToAabb(e){const i=Hrt,r=qrt,s=Wrt;for(let l=0;l<3;++l)i[l]=e[0+l]+this.localOrigin[l],r[l]=e[3+l]+this.localOrigin[l],s[l]=i[l];const n=this.applyToVertex(i[0],i[1],i[2]);for(let l=0;l<3;++l)e[l]=n[l],e[l+3]=n[l];const o=l=>{const c=this.applyToVertex(l[0],l[1],l[2]);for(let u=0;u<3;++u)e[u]=Math.min(e[u],c[u]),e[u+3]=Math.max(e[u+3],c[u])};for(let l=1;l<8;++l){for(let c=0;c<3;++c)s[c]=l&1<<c?r[c]:i[c];o(s)}let a=0;for(let l=0;l<3;++l)i[l]*r[l]<0&&(a|=1<<l);if(a!==0&&a!==7){for(let l=0;l<8;++l)if(!(a&l)){for(let c=0;c<3;++c)s[c]=a&1<<c?0:l&1<<c?i[c]:r[c];o(s)}}for(let l=0;l<3;++l)e[l]-=this.localOrigin[l],e[l+3]-=this.localOrigin[l];return e}},Brt=class{constructor(e=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=E(),this._tmpMbs=dn(),this._tmpObb=new nPe,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Ve(e)}applyToVertex(e,i,r){const s=de(nse,e,i,r),n=de(lPe,e,i,r+this.componentLocalOriginLength),o=this._totalOffset/Ve(n);return Pn(this._tmpVertex,s,n,o),this._tmpVertex}applyToAabb(e){const i=this.componentLocalOriginLength,r=e[0],s=e[1],n=e[2]+i,o=e[3],a=e[4],l=e[5]+i,c=Math.abs(r),u=Math.abs(s),d=Math.abs(n),f=Math.abs(o),m=Math.abs(a),g=Math.abs(l),y=.5*(1+Math.sign(r*o))*Math.min(c,f),v=.5*(1+Math.sign(s*a))*Math.min(u,m),b=.5*(1+Math.sign(n*l))*Math.min(d,g),w=Math.max(c,f),x=Math.max(u,m),S=Math.max(d,g),C=Math.sqrt(y*y+v*v+b*b),M=Math.sign(c+r),O=Math.sign(u+s),D=Math.sign(d+n),U=Math.sign(f+o),k=Math.sign(m+a),H=Math.sign(g+l),V=this._totalOffset;if(C<V)return e[0]-=(1-M)*V,e[1]-=(1-O)*V,e[2]-=(1-D)*V,e[3]+=U*V,e[4]+=k*V,e[5]+=H*V,e;const X=V/Math.sqrt(w*w+x*x+S*S),q=V/C,Z=q-X,ye=-Z;return e[0]+=r*(M*ye+q),e[1]+=s*(O*ye+q),e[2]+=n*(D*ye+q),e[3]+=o*(U*Z+X),e[4]+=a*(k*Z+X),e[5]+=l*(H*Z+X),e}applyToMbs(e){const i=Ve(e),r=this._totalOffset/i;return Pn(this._tmpMbs,e,e,r),this._tmpMbs[3]=e[3]+e[3]*this._totalOffset/i,this._tmpMbs}applyToObb(e){return oPe(e,this._totalOffset,this._totalOffset,Xe.Global,this._tmpObb),this._tmpObb}},jrt=class{constructor(e=0){this.offset=e,this.sphere=dn(),this.tmpVertex=E()}applyToVertex(e,i,r){const s=this.objectTransform.transform,n=de(nse,e,i,r),o=nt(n,n,s),a=this.offset/Ve(o);Pn(o,o,o,a);const l=this.objectTransform.inverse;return nt(this.tmpVertex,o,l),this.tmpVertex}applyToMinMax(e,i){const r=this.offset/Ve(e);Pn(e,e,e,r);const s=this.offset/Ve(i);Pn(i,i,i,s)}applyToAabb(e){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const i=Ve(e),r=this.offset/i;return Pn(this.sphere,e,e,r),this.sphere[3]=e[3]+e[3]*this.offset/i,this.sphere}};const Ede=new jrt;function FY(t){return t!=null?(Ede.offset=t,Ede):null}const Cde=new Brt;function Mde(t){return t!=null?(Cde.offset=t,Cde):null}const Ade=new zrt;function Grt(t){return t!=null?(Ade.offset=t,Ade):null}const Ab="terrain",nse=E(),lPe=E(),Hrt=E(),qrt=E(),Wrt=E(),tP=1e-5;let Zrt=class{constructor(e){this.options=new Tit,this._results=new Yrt,this.transform=new Vrt,this.tolerance=tP,this.verticalOffset=null,this._ray=lo(),this._rayEnd=E(),this._rayBeginTransformed=E(),this._rayEndTransformed=E(),this.viewingMode=e??Xe.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,i,r){this.resetWithRay(KMe(e,i,this._ray),r)}resetWithRay(e,i){this.camera=i,e!==this._ray&&Oz(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===Xe.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,Ee(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,i,r,s,n){var a;this.point=i,this.filterPredicate=s,this.tolerance=r??tP;const o=FY(this.verticalOffset);if(e&&e.length>0){const l=n?c=>{n(c)&&this.intersectObject(c)}:c=>{this.intersectObject(c)};for(const c of e){const u=(a=c.getSpatialQueryAccelerator)==null?void 0:a.call(c);u!=null?(o!=null?u.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,l,o):u.forEachAlongRay(this._ray.origin,this._ray.direction,l),this.options.selectionMode&&this.options.hud&&u.forEachDegenerateObject(l)):c.objects.forAll(d=>l(d))}}this.sortResults()}intersectObject(e){const i=e.geometries;if(!i)return;const r=e.effectiveTransformation,s=FY(this.verticalOffset);for(const n of i){if(!n.visible)continue;const{material:o,id:a}=n;this.transform.setAndInvalidateLazyTransforms(r,n.transformation),nt(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),nt(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;s!=null&&(s.objectTransform=this.transform),o.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,u,d,f,m,g)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const y=f?this._results.hud:this._results,v=f?b=>{const w=new Eit(e,a,d,g);b.set(rs.HUD,w,c,u,Wr,m)}:b=>b.set(rs.OBJECT,{object:e,geometryId:a,triangleNr:d},c,u,l,m);if((y.min.drapedLayerOrder==null||m>=y.min.drapedLayerOrder)&&(y.min.dist==null||c<y.min.dist)&&v(y.min),this.options.store!==oa.MIN&&(y.max.drapedLayerOrder==null||m<y.max.drapedLayerOrder)&&(y.max.dist==null||c>y.max.dist)&&v(y.max),this.options.store===oa.ALL)if(f){const b=new kY(this._ray);v(b),this._results.hud.all.push(b)}else{const b=new eA(this._ray);v(b),this._results.all.push(b)}}})}}sortResults(e=this._results.all){e.sort((i,r)=>i.dist!==r.dist?(i.dist??0)-(r.dist??0):i.drapedLayerOrder!==r.drapedLayerOrder?Pde(i.drapedLayerOrder,r.drapedLayerOrder):Pde(i.drapedLayerGraphicOrder,r.drapedLayerGraphicOrder))}};function Pde(t,e){return(e??-Number.MAX_VALUE)-(t??-Number.MAX_VALUE)}function ip(t){return new Zrt(t)}let Yrt=class{constructor(){this.min=new eA(lo()),this.max=new eA(lo()),this.hud={min:new kY(lo()),max:new kY(lo()),all:new Array},this.ground=new eA(lo()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},eA=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(he(gF,this.ray.direction,this.dist),Ve(gF)):null}getIntersectionPoint(e){return!!ap(this)&&(he(gF,this.ray.direction,this.dist),Ee(e,this.ray.origin,gF),!0)}getTransformedNormal(e){return ve(BO,this.normal),BO[3]=0,Pu(BO,BO,this.transformation),ve(e,BO),Ce(e,e)}constructor(e){this.intersector=rs.OBJECT,this.normal=E(),this.transformation=ke(),this._ray=lo(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=rs.OBJECT,Oz(e,this._ray)}set(e,i,r,s,n,o,a){this.intersector=e,this.dist=r,ve(this.normal,s??DA),xn(this.transformation,n??Wr),this.target=i,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){Oz(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,ve(this.normal,e.normal),xn(this.transformation,e.transformation)}},kY=class extends eA{constructor(){super(...arguments),this.intersector=rs.HUD}};function ose(t){return new eA(t)}const gF=E(),BO=ci();function cPe(t,e,i,r){return t.renderCoordsHelper.fromRenderCoords(e.eye,Fz,r)!=null&&sCe(i,Fz)}function $G(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function T2(t,e,i,r){const s=t.state.camera.clone();e&&i&&r&&(s.eye=e,s.center=i,s.up=r),Xrt(t,s.ray,tv)||ve(tv,s.center);const n=t.state.constraints,o=n.minimumPoiDistance;if(uo(s.eye,tv)<o){const a=n.collision.enabled;ve(Tw,s.viewForward),he(Tw,Tw,o),a?s.eye=Re(Fz,tv,Tw):Ee(tv,s.eye,Tw);const l=t.renderCoordsHelper,c=l.getAltitude(s.eye),u=n.collision.elevationMargin;a&&c<u&&(Re(Tw,tv,s.eye),s.eye=l.setAltitude(Fz,u,s.eye),Ee(tv,s.eye,Tw))}return s.center=tv,s}function Ode(t,e,i){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const r=$G(t,e),s=t.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(e,i,t.renderDataExtent,r,Qrt),o=n*n;return uo(e,i)>o}function Xrt(t,e,i){let r=Rde[t.viewingMode];r||(r=ip(t.state.viewingMode),r.options.backfacesTerrain=!t.state.isGlobal,r.options.invisibleTerrain=!0,Rde[t.viewingMode]=r);const{isGlobal:s}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,r,i)||Ode(t,e.origin,i))||!(!t.renderCoordsHelper.intersectManifold(e,0,i)||Ode(t,e.origin,i))||!!s&&Jrt(e,i,_r(t.spatialReference).radius)}function Jrt(t,e,i){const r=Te(t.origin,t.origin)-i*i,s=r>0?Math.sqrt(r)/3:1;return he(e,t.direction,s/Ve(t.direction)),Ee(e,e,t.origin),!0}const Rde={},Fz=E(),tv=E(),Tw=E(),Qrt={near:0,far:0},Krt=E(),yF=E();function ase(){return{direction:E(),up:E()}}function uPe(t,e,i,r,s){let n=Ce(Krt,t),o=Te(n,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(Te(e,r)),o<.99?(ve(n,e),a&&he(n,n,-1)):n=null);let l=0;if(n){he(yF,r,Te(r,n)),Re(n,n,yF);const u=Te(n,s)/(Ve(n)*Ve(s));ft(yF,n,s),l=(Te(yF,r)>0?1:-1)*La(po(u))}const c=La(po(-Te(r,t)/Ve(t)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}const hPe=Ge(0,1,0),dPe=Ge(0,0,1),jO=ke(),Oy=E(),Ry=E();function pPe(t,e,i,r=ase()){const{direction:s,up:n}=r;return OEe(jO,-kt(e)),kA(jO,jO,kt(i)),nt(s,dPe,jO),he(s,s,-1),nt(n,hPe,jO),r}function est(t,e,i,r){return uPe(e,i,r,dPe,hPe)}function tst(t,e,i,r){const s=pPe(t,i,r),n=E();return he(n,s.direction,-e),Ee(n,n,t),{up:s.up,eye:n,heading:i,tilt:r}}function ist(t){return La(t)}function rst(t){return kt(t)}function fPe(t,e,i,r,s){const n=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return pl(e,Oy,n),pl(e,Ry,n),Oy[0]-=i/2,Ry[0]+=i/2,Oy[1]-=r/2,Ry[1]+=r/2,Fo(Oy,n,Oy,o),Fo(Ry,n,Ry,o),s?(s.xmin=Oy[0],s.ymin=Oy[1],s.xmax=Ry[0],s.ymax=Ry[1],s.spatialReference=o):s=new ur(Oy[0],Oy[1],Ry[0],Ry[1],o),s}const sst=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:est,eyeForCenterWithHeadingTilt:tst,eyeTiltToLookAtTilt:rst,headingTiltToDirectionUp:pPe,lookAtTiltToEyeTilt:ist,toExtent:fPe},Symbol.toStringTag,{value:"Module"}));function $de(t,e,i){if(e.longitude==null||e.latitude==null||i.longitude==null||i.latitude==null)throw new Error("Invalid points: no lon/lat");return nst(t,e.longitude,e.latitude,i.longitude,i.latitude)}function nst(t,e,i,r,s){const n=kt(i),o=kt(s),a=n-o,l=kt(e)-kt(r),c=Math.sin(a/2),u=Math.sin(l/2),d=2*qf(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*u*u))*t;return Math.round(1e4*d)/1e4}function ost(t,e,i){const r=e.spatialReference,s=_r(r),n=new bt(e.x,t.y,r),o=new bt(i.x,t.y,r),a=new bt(t.x,e.y,r),l=new bt(t.x,i.y,r);return{lon:$de(s.radius,n,o),lat:$de(s.radius,a,l)}}function ast(t,e,i){const r=e/i,s=kt(t),n=Math.sin(r/2),o=Math.cos(s),a=2*qf(Math.sqrt(n*n/(o*o)));return La(a)}function lst(t,e){return t/15}function Ide(t,e){const i=t==null?void 0:t[0];if(i==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=lst(i);const r=e.hours%1;e.hours-=r,e.minutes=60*r;const s=e.minutes%1;return e.minutes-=s,e.seconds=Math.round(60*s),e}const mPe=Ge(0,0,1),gPe=Ce(E(),Ge(1,1,1)),cst=new vb(-180,180),GO=ke(),m1=E(),W2=E();function yPe(t,e,i,r=ase()){ft(m1,t,mPe),Te(m1,m1)===0&&ft(m1,t,gPe),Du(GO,-kt(e),t),Au(GO,GO,-kt(i),m1);const{up:s,direction:n}=r;return ft(s,m1,t),Ce(s,s),nt(s,s,GO),Ce(n,t),sa(n,n),nt(n,n,GO),r}function ust(t,e,i,r){const s=m1,n=W2;return Ce(s,t),ft(W2,s,mPe),Te(W2,W2)===0&&ft(W2,s,gPe),ft(n,W2,s),uPe(e,i,r,s,n)}function hst(t,e,i,r){const s={eye:E(),up:null,tilt:r,heading:i},n=m1;n[0]=t[0],n[1]=t[2],n[2]=-t[1];const o=e,a=kt(i),l=kt(r),c=Math.sin(a),u=Math.cos(a),d=Math.sin(l),f=Math.cos(l),m=Ve(n);let g;if(Math.abs(l)<1e-8)g=o+m;else{const ye=m/d,L=qf(o/ye),N=Math.PI-l-L;g=ye*Math.sin(N)}const y=f*o,v=o*o*(d*d),b=u*u*v,w=g-y,x=w*w,S=b*(b+x-n[1]*n[1]);if(S<0)return he(s.eye,n,g/m),s.tilt=0,_F(s,t);const C=Math.sqrt(S),M=n[1]*w,O=b+x;let D;if(D=u>0?-C+M:C+M,Math.abs(O)<1e-8)return m<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):he(s.eye,n,g/m),s.tilt=0,h8(s.eye),_F(s,t);s.eye[1]=D/O;const U=c*c*v,k=d*o,H=u*k*s.eye[1],V=s.eye[1]*s.eye[1],X=1-V,q=Math.sqrt(X),Z=b*V+U-2*H*q*w+X*x;return Math.abs(Z)<1e-8?(he(s.eye,n,g/m),s.tilt=0,h8(s.eye),_F(s,t)):(s.eye[0]=(X*(g*n[0]-y*n[0])-k*q*(n[0]*s.eye[1]*u+n[2]*c))/Z,s.eye[2]=(X*(g*n[2]-y*n[2])-k*q*(n[2]*s.eye[1]*u-n[0]*c))/Z,he(s.eye,s.eye,g),h8(s.eye),_F(s,t))}function h8(t){const e=t[1];t[1]=-t[2],t[2]=e}function _F(t,e){const i=yPe(e,t.heading,t.tilt);return t.up=i.up,t}function dst(t,e,i){const r=Ve(e),s=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-t)),n=qf(i/(s/Math.sin(t)));return La(t-n)}function pst(t,e,i){const r=kt(t),s=Ve(e);return qf(i/(s/Math.sin(r)))+r}function _Pe(t,e,i,r,s){let n,o,a,l;const c=e.latitude,u=_r(t.spatialReference).radius,d=e.longitude,f=ast(c,i,u)/2;n=d-f,o=d+f;const m=kt(c),g=(1+Math.sin(m))/(1-Math.sin(m)),y=(g+1)*Math.tan(r/u/2),v=y*y;function b(x){const S=Math.PI/2;return(x=VXe.normalize(x,-S))>S&&(x=Math.PI-x),x}if(a=1.5*Math.PI-2*Math.atan(.5*(y+Math.sqrt(4*g+v))),l=a+r/u,a=b(a),l=b(l),l<a){const x=l;l=a,a=x}if(a=Math.max(La(a),-90),l=Math.min(La(l),90),o=cst.monotonic(n,o),o-n>180){const x=(o-n-180)/2;n+=x,o-=x}const w=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:Ze.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=w):s=new ur(n,a,o,l,w),t.spatialReference&&t.spatialReference.isWebMercator&&kg(s,!1,s),s}const fst=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:ust,eyeForCenterWithHeadingTilt:hst,eyeTiltToLookAtTilt:pst,headingTiltToDirectionUp:yPe,lookAtTiltToEyeTilt:dst,toExtent:_Pe},Symbol.toStringTag,{value:"Module"}));function kz(t){return t.type==="point"}let lse=class{constructor(e,i=null,r=0){this.array=e,this.spatialReference=i,this.offset=r}};function vPe(t){return"array"in t}function Mg(t,e,i="ground"){if(kz(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,i);if(vPe(e)){let r=e.offset;return t.getElevation(e.array[r++],e.array[r++],e.array[r]||0,e.spatialReference??t.spatialReference,i)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,i)}const bPe=()=>se.getLogger("esri.views.3d.support.cameraUtils"),wPe=39.37,xPe=96,UY=1,mst=8,gst=5,TPe=1,Lde=E(),yst={heading:0,tilt:0},e3=E(),_st=new vb(-20037508342788905e-9,20037508342788905e-9),vst=new vb(-180,180);var Oa;function Xb(t){return t.spatialReference??Ze.WGS84}function JP(t){return t.viewingMode==="global"?fst:sst}function bst(t,e,i,r,s){return JP(t).headingTiltToDirectionUp(e,i,r,s)}function S0(t,e){if(e==null)return null;const i=t.renderSpatialReference,r=JP(t).headingTiltToDirectionUp,s=E();if(!pl(e.position,s,i))return null;const n=r(s,e.heading,e.tilt);he(n.direction,n.direction,t.state.camera.distance),Ee(n.direction,n.direction,s);const o=T2(t,s,n.direction,n.up);return o.fov=kt(e.fov),o.row=e.layout.row,o.rows=e.layout.rows,o.column=e.layout.column,o.columns=e.layout.columns,o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(Oa||(Oa={}));const Z2=E();function iP(t,e,i){const r=t.renderSpatialReference,s=LG(t,e.eye,e.viewForward,e.up,yst);let n=Xb(t);return Fo(e.eye,r,Z2,n)||(n=Ze.WGS84,Fo(e.eye,r,Z2,n)),i==null?i=new Bh(new bt(Z2,n),s.heading,s.tilt,La(e.fov)):(i.position.x=Z2[0],i.position.y=Z2[1],i.position.z=Z2[2],i.position.spatialReference=n,i.heading=s.heading,i.tilt=s.tilt,i.fov=La(e.fov)),i.layout.row=e.row,i.layout.rows=e.rows,i.layout.column=e.column,i.layout.columns=e.columns,i}function IG(t,e,i){const r=t.state.camera,s=r.width/2/r.pixelRatio;return t.renderCoordsHelper.viewingMode===Xe.Global&&i!=null&&(e*=Math.cos(kt(i))),e/=t.renderCoordsHelper.unitInMeters,s/(xPe*wPe/e)/Math.tan(r.fovX/2)}function Pb(t,e,i){const r=t.state.camera,s=e*Math.tan(r.fovX/2),n=r.width/2/r.pixelRatio;let o=xPe*wPe/(n/s);return t.renderCoordsHelper.viewingMode===Xe.Global&&i!=null&&(o/=Math.cos(kt(i))),o*t.renderCoordsHelper.unitInMeters}async function SPe(t,e,i,r,s,n){return EPe(t,e,IG(t,i,e.latitude),r,s,n)}function wst(t,e,i,r,s,n){return UPe(t,cse(t,r.heading,r.tilt,e,i,s),r.fov,n)}async function EPe(t,e,i,r,s,n){const o=await MPe(t,r.heading,r.tilt,e,i,s,n);return Dt(n),VPe(t,o,r.fov,n)}function LG(t,e,i,r,s){return JP(t).directionToHeadingTilt(e,i,r,s)}function CPe(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,e3,t.spatialReference)&&t.elevationProvider&&(Mg(t.elevationProvider,e3)??0)>e3[2]-TPe)}async function xst(t,e,i){if(CPe(t,e))return!0;const{elevationProvider:r,spatialReference:s,renderCoordsHelper:n}=t;if(r==null||!n.fromRenderCoords(e,e3,s))return!1;const[o,a,l]=e3,c=await r.queryElevation(o,a,l,s,"ground",i)??0;return Dt(i),c>l-TPe}async function Tst(t,e,i){const r=E();if(e==null)return ve(r,t.state.camera.center);if(e instanceof bt){const{renderSpatialReference:s,basemapTerrain:n,elevationProvider:o}=t,a=e.spatialReference;if(await Cz(e,r,s,0,{signal:i}),Dt(i),e.z==null&&n!=null&&o!=null){const l=await o.queryElevation(e.x,e.y,e.z??0,a,"ground",i);Dt(i),l!=null&&t.renderCoordsHelper.setAltitude(r,l)}return r}return ve(r,e)}function Sst(t,e){const i=E();if(e==null)return ve(i,t.state.camera.center);if(e instanceof bt){if(!pl(e,i,t.renderSpatialReference))return null;const{basemapTerrain:r,elevationProvider:s}=t;if(e.z==null&&r!=null&&s!=null){const n=Mg(s,e);n!=null&&t.renderCoordsHelper.setAltitude(i,n)}return i}return ve(i,e)}function cse(t,e,i,r,s,n){return APe(t,e,i,r instanceof bt?r:null,Sst(t,r),s,n)}async function MPe(t,e,i,r,s,n,o){const a=r instanceof bt?r:null,l=await Tst(t,r,o);return Dt(o),PPe(t,e,i,a,l,s,n,o)}function APe(t,e,i,r,s,n,o){if(s==null||!r&&(r=new bt({spatialReference:Xb(t)}),!Yb(s,t.renderSpatialReference,r)))return null;const a=OPe(t,e,i,s,n,o);if(RPe(t,i,o)&&CPe(t,a.eye)){const{tilt:l,mode:c}=$Pe(t,i,s,n);return APe(t,e,l,r,s,n,c)}return IPe(a,s)}async function PPe(t,e,i,r,s,n,o,a){r||(r=new bt({spatialReference:Xb(t)}),await qAe(s,t.renderSpatialReference,r,{signal:a})||(r=null)),Dt(a);const l=OPe(t,e,i,s,n,o);if(RPe(t,i,o)&&await xst(t,l.eye,a)){Dt(a);const{tilt:c,mode:u}=$Pe(t,i,s,n);return PPe(t,e,c,r,s,n,u,a)}return IPe(l,s)}function OPe(t,e,i,r,s,n){const o=Cst(t,e,i,r,s=Math.max(s,t.state.constraints.minimumPoiDistance),n);return(0,JP(t).eyeForCenterWithHeadingTilt)(r,s,o.heading,o.tilt)}function RPe(t,e,i){const r=t.map.ground.navigationConstraint;return i===Oa.ADJUST&&t.viewingMode==="global"&&e>0&&(r==null||r.type==="stay-above")}function $Pe(t,e,i,r){const s=kPe(t,i,r,Ast(t,r,e,i));return{tilt:s,mode:e-s<1?Oa.LOCKED:Oa.ADJUST}}function IPe(t,e){return{...t,center:hn(e)}}function LPe(t,e){const{state:i,spatialReference:r}=t,s=e.spatialReference;return i.isGlobal&&cL(s,Xe.Global)||i.isLocal&&r.equals(s)}function DPe(t,e){let i,r,s;if(t.state.isGlobal){const u=new bt(e.xmin,e.ymin,e.spatialReference),d=new bt(e.xmax,e.ymax,e.spatialReference),f=e.spatialReference.isGeographic?vst:_st;i=new bt({x:f.center(u.x,d.x),y:(d.y+u.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const m=_r(e.spatialReference),g=ost(i,u,d);r=g.lon,s=g.lat,f.diff(u.x,d.x)>f.range/2&&(r+=m.halfCircumference),r=Math.min(r,m.halfCircumference),s=Math.min(s,m.halfCircumference)}else{const u=t.renderSpatialReference??e.spatialReference;u.equals(e.spatialReference)||(e=b_(e,u)),r=e.xmax-e.xmin,s=e.ymax-e.ymin;const d=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;i=new bt({x:e.xmin+.5*r,y:e.ymin+.5*s,z:d,spatialReference:u})}const n=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,o=t.state.camera,a=1/Math.tan(o.fovX/2),l=1/Math.tan(o.fovY/2),c=1/Math.tan(o.fov/2);return{center:i,distance:Math.max(.5*r*a,.5*s*l,.5*n*c)/UY}}async function NPe(t,e,i,r,s,n){const o=LPe(t,e)?e:await Sb(e,t.spatialReference,{signal:n});Dt(n);const{center:a,distance:l}=DPe(t,o),c=await MPe(t,i,r,a,l,s,n);return Dt(n),VPe(t,c,t.camera.fov,n)}function $k(t,e,i,r,s,n){let o;try{o=LPe(t,e)?e:b_(e,t.spatialReference)}catch{return null}const{center:a,distance:l}=DPe(t,o),c=cse(t,i,r,a,l,s);return c==null?null:UPe(t,c,t.camera.fov,n)}function FPe(t,e,i){const r=t.renderSpatialReference,s=new bt({spatialReference:Xb(t)});if(!Yb(i,r,s))return null;const n=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=Y1(e.eye,i),l=2*a*n*UY,c=2*a*o*UY;return t.viewingMode==="global"?_Pe(t,s,l,c):fPe(t,s,l,c)}function Est(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>mst)return!0;const s=e,n=t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;return Cr(s,n)/(Math.tan(.5*t.state.camera.fov)*r)>gst}function Cst(t,e,i,r,s,n){let o=0;return n===Oa.ADJUST&&Est(t,r,s)?(e=0,o=Mst(t,s,i,r)):o=use(t,r,s,i),o=t.state.constraints.clampTilt(s,o),{heading:e,tilt:i=kPe(t,r,s,o)}}const Uz=.7;function Mst(t,e,i,r){const s=use(t,r,e,i);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);n.max=Math.min(n.max,.5*Math.PI);const o=n.min*(1-Uz)+n.max*Uz;return Math.min(s,o)}function Ast(t,e,i,r){let s=use(t,r,e,i);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);return s=Math.min(s,.5*Math.PI),n.min*(1-Uz)+s*Uz}function kPe(t,e,i,r){return JP(t).lookAtTiltToEyeTilt(r,e,i)}function use(t,e,i,r){return JP(t).eyeTiltToLookAtTilt(r,e,i)}function UPe(t,e,i,r){if(e==null)return null;const s=t.renderSpatialReference,n=new bt({spatialReference:Xb(t)});return Yb(e.eye,s,n)?(r??(r=new Bh),r.position=n,r.heading=e.heading,r.tilt=e.tilt,r.fov=i,r):null}async function VPe(t,e,i,r){const s=t.renderSpatialReference,n=new bt({spatialReference:Xb(t)});return await qAe(e.eye,s,n,{signal:r}),Dt(r),new Bh(n,e.heading,e.tilt,i)}function Pst(t,e){var r;const i=(r=t.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.levelAtScale(e);bPe().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function zPe(t,e){var r;const i=(r=t.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.scaleAtLevel(e);bPe().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function BPe(t,e){const{renderSpatialReference:i}=t,r=xit(i);let s=null;try{Fo(e.center,i,Lde,r)&&(s=Lde[1])}catch{}return Pb(t,e.distance,s)}const hse=()=>se.getLogger("esri.layers.support.ElevationSampler");let jPe=class{queryElevation(e){return GPe(e.clone(),this)}on(){return Gi()}projectIfRequired(e,i){return HPe(e,i)}},Ost=class extends jPe{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){super(),this.tile=e,this.noDataValue=r;const s=e.tile.extent;this.extent=sG(s,i.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=s;const n=ec(i.spatialReference),o=i.lodAt(e.tile.level).resolution*n;this.demResolution={min:o,max:o}}contains(e){const i=this.projectIfRequired(e,this.spatialReference);return i!=null&&this.containsAt(i.x,i.y)}containsAt(e,i){return nG(this._aaExtent,e,i)}elevationAt(e,i){if(!this.containsAt(e,i)){const r=this.extent,s=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return hse().warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return this.tile.sample(e,i)??this.noDataValue}},D7t=class extends jPe{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){let s;super(),typeof i=="number"?(this.noDataValue=i,s=null):(s=i,this.noDataValue=r),this.samplers=s?e.map(o=>new Ost(o,s,this.noDataValue)):e;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=sG(oi(),s.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,i){let r,s=!1;for(const n of this.samplers)if(n.containsAt(e,i)&&(s=!0,r=n.elevationAt(e,i),r!==n.noDataValue))return r;return r??(s||hse().warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler`),this.noDataValue)}};function GPe(t,e){const i=HPe(t,e.spatialReference);if(!i)return null;switch(t.type){case"point":Rst(t,i,e);break;case"polyline":$st(t,i,e);break;case"multipoint":Ist(t,i,e)}return t}function HPe(t,e){if(t==null)return null;const i=t.spatialReference;if(i.equals(e))return t;const r=mD(t,e);return r||hse().error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),r}function Rst(t,e,i){t.z=i.elevationAt(e.x,e.y)}function $st(t,e,i){_g.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s],o=e.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];_g.x=c[0],_g.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(_g.x,_g.y)}}t.hasZ=!0}function Ist(t,e,i){_g.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let s=0;s<t.points.length;s++){const n=t.points[s],o=e.points[s];_g.x=o[0],_g.y=o[1],r&&(n[3]=n[2]),n[2]=i.elevationAt(_g.x,_g.y)}t.hasZ=!0}const _g=new bt;var VY;let Fm=VY=class extends Se{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new VY({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};h([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Fm.prototype,"cols",void 0),h([p({type:Xi,json:{write:!0}})],Fm.prototype,"level",void 0),h([p({type:String,json:{write:!0}})],Fm.prototype,"levelValue",void 0),h([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Fm.prototype,"origin",void 0),h([p({type:Number,json:{write:!0}})],Fm.prototype,"resolution",void 0),h([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Fm.prototype,"rows",void 0),h([p({type:Number,json:{write:!0}})],Fm.prototype,"scale",void 0),Fm=VY=h([I("esri.layers.support.LOD")],Fm);const df=Fm;let Lst=class{constructor(e,i,r,s,n=void 0){this.id=e,this.level=i,this.row=r,this.col=s,this.extent=n}};var Dv;const Dde=new Ji({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Ha=Dv=class extends Se{static create(t={}){const{resolutionFactor:e=1,scales:i,size:r=256,spatialReference:s=Ze.WebMercator,numLODs:n=24}=t;if(!Sf(s)){const d=[];if(i)for(let f=0;f<i.length;f++){const m=i[f];d.push(new df({level:f,scale:m,resolution:m}))}else{let f=5e-4;for(let m=n-1;m>=0;m--)d.unshift(new df({level:m,scale:f,resolution:f})),f*=2}return new Dv({dpi:96,lods:d,origin:new bt(0,0,s),size:[r,r],spatialReference:s})}const o=Fg(s),a=t.origin?new bt({x:t.origin.x,y:t.origin.y,spatialReference:s}):new bt(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(ec(s)*39.37*l),u=[];if(i)for(let d=0;d<i.length;d++){const f=i[d],m=f*c;u.push(new df({level:d,scale:f,resolution:m}))}else{let d=pD(s)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const f=Math.ceil(n/e);u.push(new df({level:0,scale:d,resolution:d*c}));for(let m=1;m<f;m++){const g=d/2**e,y=g*c;u.push(new df({level:m,scale:g,resolution:y})),d=g}}return new Dv({dpi:l,lods:u,origin:a,size:[r,r],spatialReference:s})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const i=Fg(t);return t.isWrappable&&!!i&&Math.abs(i.origin[0]-e.x)<=i.dx}return!1}readOrigin(t,e){return bt.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,i=0;const r=[],s=this._levelToLOD={};t&&(e=-1/0,i=1/0,t.forEach(n=>{r.push(n.scale),e=n.scale>e?n.scale:e,i=n.scale<i?n.scale:i,s[n.level]=n})),this._set("scales",r),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const i=Math.floor(t),r=i+1;return e[i]/(e[i]/e[r])**(t-i)}scaleToZoom(t){const e=this.scales,i=e.length-1;let r=0;for(;r<i;r++){const s=e[r],n=e[r+1];if(s<=t)return r;if(n===t)return r+1;if(s>t&&n<t)return r+Math.log(s/t)/Math.log(s/n)}return r}tileAt(t,e,i,r){const s=this.lodAt(t);if(!s)return null;let n,o;if(typeof e=="number")n=e,o=i;else if(hs(e.spatialReference,this.spatialReference))n=e.x,o=e.y,r=i;else{const c=mD(e,this.spatialReference);if(c==null)return null;n=c.x,o=c.y,r=i}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return r||(r=new Lst(null,0,0,0,oi())),r.level=t,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(t,e=Dv.ExtrapolateOptions.NONE){let i=this.lodAt(t.level);if(!i&&e===Dv.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(i=o)}if(!i)return;const r=t.level-i.level,s=i.resolution*this.size[0]/2**r,n=i.resolution*this.size[1]/2**r;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=oi()),t.extent[0]=this.origin.x+t.col*s,t.extent[1]=this.origin.y-(t.row+1)*n,t.extent[2]=t.extent[0]+s,t.extent[3]=t.extent[1]+n}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const i=this.lodAt(e.level);if(i==null)return null;const{resolution:r}=i,s=r*this.size[0],n=r*this.size[1];return t[0]=this.origin.x+e.col*s,t[1]=this.origin.y-(e.row+1)*n,t[2]=t[0]+s,t[3]=t[1]+n,t}lodAt(t){var e;return((e=this._levelToLOD)==null?void 0:e[t])??null}clone(){return Dv.fromJSON(this.write({}))}getCompatibleForVTL(t){if(this.size[0]!==this.size[1]||this.size[0]===256&&t===512)return null;const e=(this.size[0]===512&&t===256?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===t&&e===0)return this;const i=[],r=this.lods.length-e;for(let s=0;s<r;s++){const n=s+e,{scale:o,resolution:a}=n>=0?this.lods[n]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};i.push(new df({level:s,scale:o,resolution:a}))}return new Dv({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let i=0;i<t.length;i++){const r=t[i];this._upsampleLevels[r.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/r.resolution:0},e=r}}};h([p({type:Number,json:{write:!0}})],Ha.prototype,"compressionQuality",void 0),h([p({type:Number,json:{write:!0}})],Ha.prototype,"dpi",void 0),h([p({type:String,json:{read:Dde.read,write:Dde.write,origins:{"web-scene":{read:!1,write:!1}}}})],Ha.prototype,"format",void 0),h([p({readOnly:!0})],Ha.prototype,"isWrappable",null),h([p({type:bt,json:{write:!0}})],Ha.prototype,"origin",void 0),h([ze("origin")],Ha.prototype,"readOrigin",null),h([p({type:[df],value:null,json:{write:!0}})],Ha.prototype,"lods",null),h([p({readOnly:!0})],Ha.prototype,"scales",void 0),h([p({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],Ha.prototype,"size",void 0),h([ze("size",["rows","cols"])],Ha.prototype,"readSize",null),h([We("size",{cols:{type:Xi},rows:{type:Xi}})],Ha.prototype,"writeSize",null),h([p({type:Ze,json:{write:!0}})],Ha.prototype,"spatialReference",void 0),Ha=Dv=h([I("esri.layers.support.TileInfo")],Ha),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(Ha||(Ha={}));const Ik=Ha,Dst=12;let bu=class Kc{constructor(e){const i=Kc.checkUnsupported(e);if(i!=null)throw i;const r=e;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=pD(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const s=r.lods.reduce((c,u)=>(u.level<c.minLod.level&&(c.minLod=u),c.max=Math.max(c.max,u.level),c),{minLod:r.lods[0],max:-1/0}),n=s.minLod,o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,l/=2}clone(){return new Kc(this.toTileInfo())}toTileInfo(){return new Ik({dpi:this.dpi,origin:new bt({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,i)=>new df({level:i,scale:e.scale,resolution:e.resolution}))})}getExtent(e,i,r,s){const n=this.levels[e],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+r*o,s[2]=this.origin[0]+(r+1)*o,s[3]=this.origin[1]-i*a,s[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(e,i){this._isWebMercator?(i[0]=Due(e[0]),i[1]=az(e[1]),i[2]=Due(e[2]),i[3]=az(e[3])):this._isGCS&&(i[0]=kt(e[0]),i[1]=kt(e[1]),i[2]=kt(e[2]),i[3]=kt(e[3]))}getExtentGeometry(e,i,r,s=new ur){return this.getExtent(e,i,r,hm),s.spatialReference=this.spatialReference,s.xmin=hm[0],s.ymin=hm[1],s.xmax=hm[2],s.ymax=hm[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(e==null)return!1;let i=!1;for(;this.levels.length<=e;){const{resolution:r,scale:s}=this.levels[this.levels.length-1],n=r/2*this.pixelSize;this.levels.push({resolution:r/2,scale:s/2,tileSize:[n,n]}),i=!0}return i}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const i=this.levels[0].scale;return e>=i?0:Math.log(i/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e,i=1/0){if(Kc.checkUnsupported(e))return!1;const r=new Kc(e);if(!r.spatialReference.equals(this.spatialReference)||r.pixelSize!==this.pixelSize)return!1;const s=Math.min(this.levels.length-1,r.levels.length-1,i),n=this.levels[s].resolution;let o=.5*n;return!X1(r.origin[0],this.origin[0],o)||!X1(r.origin[1],this.origin[1],o)?!1:(o=.5*n/2**s/this.pixelSize*Dst,X1(n,r.levels[s].resolution,o))}rootTilesInExtent(e,i=null,r=1/0){const s=new Array,n=this.levels[0].tileSize;if(e==null||n[0]===0||n[1]===0)return s;Kc.computeRowColExtent(e,n,this.origin,hm);let o=hm[1],a=hm[3],l=hm[0],c=hm[2];const u=c-l,d=a-o;if(u*d>r){const f=Math.floor(Math.sqrt(r));d>f&&(o=o+Math.floor(.5*d)-Math.floor(.5*f),a=o+f),u>f&&(l=l+Math.floor(.5*u)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)s.push([0,f,m]);return i!=null&&(i[0]=this.origin[0]+l*n[0],i[1]=this.origin[1]-a*n[1],i[2]=this.origin[0]+c*n[0],i[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(e,i,r,s){const n=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+n-r[0])/i[0])),s[2]=Math.max(0,Math.ceil((e[2]-n-r[0])/i[0])),s[1]=Math.max(0,Math.floor((r[1]-e[3]+n)/i[1])),s[3]=Math.max(0,Math.ceil((r[1]-e[1]-n)/i[1]))}static isPowerOfTwo(e){const i=e.lods,r=i[0].resolution*2**i[0].level;return!i.some(s=>!lYe(s.resolution,r/2**s.level))}static hasGapInLevels(e){const i=e.lods.map(r=>r.level);i.sort((r,s)=>r-s);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(e){const i=e.size[1];return i===e.size[0]&&!(i&i-1)&&i>=128&&i<=512}static hasOriginPerLODs(e){const i=e.origin;return e.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new G("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?dse():e.lods.length<1?new G("tilingscheme:generic","Tiling scheme must have at least one level"):Kc.isPowerOfTwo(e)?Kc.hasGapInLevels(e)?new G("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):Kc.tileSizeSupported(e)?Kc.hasOriginPerLODs(e)?new G("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new G("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new G("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,i){const r=e[2]-e[0],s=e[3]-e[1],n=ec(i),o=1.2*Math.max(r,s),a=256,l=o/a,c=l*n*(96/.0254),u=new Kc(new Ik({size:[a,a],origin:new bt({x:e[0]-.5*(o-r),y:e[3]+.5*(o-s)}),lods:[new df({level:0,resolution:l,scale:c})],spatialReference:i}));return u.ensureMaxLod(20),u}static makeWebMercatorAuxiliarySphere(e){const i=new Kc(Kc.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(e),i}static makeGCSWithTileSize(e,i=256,r=16){const s=256/i,n=new Kc(new Ik({size:[i,i],origin:new bt({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new df({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(r),n}get test(){}};function dse(){return new G("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}bu.WebMercatorAuxiliarySphereTileInfo=new Ik({size:[256,256],origin:new bt({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Ze.WebMercator}),spatialReference:Ze.WebMercator,lods:[new df({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),bu.WebMercatorAuxiliarySphere=bu.makeWebMercatorAuxiliarySphere(19);const hm=oi(),uM=64,t$=512,Nst=2.5,pse=cYe(_Z/10),qPe=2,WPe=oi();bu.WebMercatorAuxiliarySphere.getExtent(0,0,0,WPe);const Fst=oi([-180,-90,180,90]),kst="Cannot extend surface to encompass all layers because it would result in too many root tiles.",Ust="Surface extent is too large for tile resolution at level 0.",Vn=4;let Nv=class extends Us.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=pse}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if((e==null?void 0:e.extent)==null||e.spatialReference==null)return null;const i=sG(e.extent,e.spatialReference);return i.zmin=e.visibleElevationBounds.min,i.zmax=e.visibleElevationBounds.max,i}get spatialReference(){var e;return((e=this.view.basemapTerrain)==null?void 0:e.spatialReference)??Ze.WGS84}elevationAt(e,i){var r;if(this.extent==null||!Fl(this.extent,e,i)){const s=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return se.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return((r=this.view.elevationProvider)==null?void 0:r.getElevation(e,i,0,this.spatialReference,"ground"))??this.noDataValue}queryElevation(e){return GPe(e.clone(),this)}};h([p({readOnly:!0})],Nv.prototype,"demResolution",void 0),h([p({readOnly:!0})],Nv.prototype,"extent",null),h([p({readOnly:!0})],Nv.prototype,"noDataValue",void 0),h([p()],Nv.prototype,"spatialReference",null),h([p({constructOnly:!0})],Nv.prototype,"view",void 0),Nv=h([I("esri.views.support.GroundViewElevationSampler")],Nv);const Vst=Nv;let Jy=class extends Ue{constructor(e){super(e),this.view=null,this.layerViews=new st}initialize(){this.addHandles(No(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.ground},e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new Vst({view:this.view}):null:null}get extent(){const e=this.view;return e&&e.type!=="2d"&&e.ready?FPe(e,e.state.camera,e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>te(()=>e.updating,()=>this._updateUpdating(),or)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};h([p({readOnly:!0})],Jy.prototype,"elevationSampler",null),h([p({readOnly:!0})],Jy.prototype,"extent",null),h([p({type:Boolean,readOnly:!0})],Jy.prototype,"updating",null),h([p({constructOnly:!0})],Jy.prototype,"view",void 0),h([p({type:st,readOnly:!0})],Jy.prototype,"layerViews",void 0),h([p({readOnly:!0})],Jy.prototype,"suspended",null),Jy=h([I("esri.views.GroundView")],Jy);const zst=Jy;let u_=class{constructor(e,i){this._owner=i,this._properties={},this._afterDispatchHandle=null;for(const r in e){const s=e[r],n=new OSe(s,void 0,void 0,2,2);this._properties[r]={pool:n,acquired:[]}}this._afterDispatchHandle=VSe(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const i=this._properties[e];for(const r of i.acquired)lue(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this._properties=null,this._owner=null}get(e){const i=this._owner._get(e),r=this._properties[e];let s=r.pool.acquire();for(r.acquired.push(s);s===i;)r.acquired.push(s),s=r.pool.acquire();return s}_release(){for(const e in this._properties){const i=this._properties[e];let r=0;for(const s of i.acquired)lue(s)?i.acquired[r++]=s:i.pool.release(s);i.acquired.length=r}}};const Bst=le("mac")?"Meta":"Control",jst=new Set(["Alt","Control","Meta","Shift","Ctrl","Primary"]),Gst=t=>jst.has(t);let Hst=class{constructor(e,i=[]){this.eventType=e,this.keyModifiers=i}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=e.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}},ha=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const i=this._incoming[e];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager||(e.setEventCallback(i=>this._handleEvent(i)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,i,r){let s;typeof i=="function"?(r=i,s=[]):s=i||[];const n=typeof e=="string"?new Hst(e,s):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=u=>{const d=this._incoming[u.match.eventType];if(d){const f=d.indexOf(u);d.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new qst(n,r,{onPause:a,onRemove:a,onResume:u=>{const d=this._incoming[u.match.eventType];d&&!d.includes(u)&&(d.push(u),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const i=new Wst(e,{onEmit:(r,s,n,o)=>{var a;(a=this._manager)==null||a.emit(r.eventType,s,n,o)},onRemove:r=>{var s;delete this._outgoing[r.eventType],(s=this._manager)==null||s.updateDependencies()}});return this._outgoing[e]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(e){var i;(i=this._manager)==null||i.setPointerCapture(e,!0)}stopCapturingPointer(e){var i;(i=this._manager)==null||i.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager&&(this.onUninstall(),this._manager=null)}_handleEvent(e){var r;const i=this._incoming[e.type];if(i){for(const s of i)if(s.match.matches(e)&&((r=s.callback)==null||r.call(s,e),e.shouldStopPropagation()))break}}},qst=class{constructor(e,i,r){this.match=e,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},Wst=class{constructor(e,i){this.eventType=e,this._removed=!1,this._handler=i}emit(e,i,r){this._removed||this._handler.onEmit(this,e,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}},Zst=class extends ha{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>{this._update(i.data)})}_update(e){const i=e.native.pointerType==="touch"?"touch":"mouse",{x:r,y:s}=e;i===this._value&&this._x===r&&this._y===s||(this._value=i,this._x=r,this._y=s,this._onChange(i,r,s))}},Yst=class extends ha{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=Ug(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},ud=class extends Ue{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=Bst,this._latestPointerType="mouse",this._propertiesPool=new u_({latestPointerLocation:Qst},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const i of e)this.uninstallHandlers(i);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,i,r=ib.INTERNAL){if(this._nameToGroup[e]||i.length===0)return;const s={name:e,handlers:i.map(n=>({handler:n,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=s;for(let n=s.handlers.length-1;n>=0;n--){const o=s.handlers[n];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,u,d)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,d,u)},setPointerCapture:(a,l)=>{this._setPointerCapture(s,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const i=this._nameToGroup[e];i?(i.handlers.forEach(r=>{var s;r.removed=!0,(s=r.uninstallCallback)==null||s.call(r)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):se.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}isModifierKeyDown(e){return this._activeKeyModifiers&&this._activeKeyModifiers.has(e)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,i=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const s=this._handlers[r];s.priorityIndex=r,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const s=this._handlersPriority[r];s.priorityIndex=r;let n=s.handler.hasSideEffects;if(!n){for(const o of s.handler.outgoingEventTypes)if(e.has(o)){n=!0;break}}if(n)for(const o of s.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)Gst(a)||i.add(a)}s.active=n}this._sourceEvents=e,this._keyModifiers=i,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,i,r){this._latestPointerType=e;const s=this._get("latestPointerLocation");if(s==null||s.x!==i||s.y!==r){const n=this._propertiesPool.get("latestPointerLocation");n.x=i,n.y=r,this._set("latestPointerLocation",n)}}_onEventReceived(e,i){if(e==="pointer-capture-lost"){const n=i;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,i);const r=this.test.timestamp!=null?this.test.timestamp:i.native?i.native.timestamp:void 0,s=i.native?i.native.cancelable:void 0;this._emitInputEventFromSource(e,i,r,s)}_updateKeyModifiers(e,i){if(!i)return;let r=!1;const s=()=>{if(!r){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,r=!0}},n=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(s(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(s(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=i.key;this._keyModifiers.has(a)&&n(a,e==="key-down")}const o=i.native;n("Alt",!(!o||!o.altKey)),n("Control",!(!o||!o.ctrlKey)),n("Ctrl",!(!o||!o.ctrlKey)),n("Shift",!(!o||!o.shiftKey)),n("Meta",!(!o||!o.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new Zst((e,i,r)=>this._setLatestPointer(e,i,r)),this._multiTouchHandler=new Yst,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],ib.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,ib.INTERNAL)}_setPointerCapture(e,i,r,s){const n=e.name+"-"+i.priorityIndex,o=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,o),s?(o.add(n),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):o.has(n)&&(o.delete(n),o.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,i,r,s){this._emitInputEvent(0,e,i,r,s)}_emitInputEvent(e,i,r,s,n,o){const a=s!==void 0?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=n!==void 0&&n,c={event:new Xst(i,r,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new Ez,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var i,r,s;this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:n,priorityIndex:o}=e.events.pop(),a=(i=n.data)==null?void 0:i.eventId;if(!(a!=null&&this._stoppedPropagationEventIds.has(a)))for(e.currentHandler=this._handlersPriority[o];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!n.shouldStopPropagation()&&((s=(r=e.currentHandler).eventCallback)==null||s.call(r,n)),n.shouldStopPropagation()){a!=null&&this._stoppedPropagationEventIds.add(a);break}if(n.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:n,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const i=new Ez;i.push(e);const r=this._currentPropagation;if(r){for(;r.events.length;)i.push(r.events.pop());r.events=i,r.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,i){if(e.handler.hasSideEffects!==i.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==i.groupPriority)return e.groupPriority>i.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const s of i.handler.incomingEventMatches){if(r.eventType!==s.eventType)continue;const n=r.keyModifiers.filter(o=>s.keyModifiers.includes(o));if(n.length===r.keyModifiers.length!=(n.length===s.keyModifiers.length))return r.keyModifiers.length>s.keyModifiers.length?-1:1}return e.priorityIndex>i.priorityIndex?-1:1}_sortHandlersPriority(e){const i=[];for(const r of e){let s=0;for(;s<i.length&&this._compareHandlerPriority(r,i[s])>=0;)s++;i.splice(s,0,r)}return i}get debug(){const e=i=>{const r=this._setPointerCapture;this._setPointerCapture=()=>{},i(),this._setPointerCapture=r};return{injectEvent:(i,r)=>{e(()=>{this._onEventReceived(i,r)})},disablePointerCapture:e}}};h([p({readOnly:!0})],ud.prototype,"hasPendingInputs",null),h([p({constructOnly:!0})],ud.prototype,"eventSource",void 0),h([p({constructOnly:!0})],ud.prototype,"recognizers",void 0),h([p()],ud.prototype,"_latestPointerType",void 0),h([p()],ud.prototype,"latestPointerType",null),h([p()],ud.prototype,"multiTouchActive",null),h([p({readOnly:!0})],ud.prototype,"latestPointerLocation",void 0),h([p()],ud.prototype,"_paused",void 0),h([p({readOnly:!0})],ud.prototype,"updating",null),ud=h([I("esri.views.input.InputManager")],ud);let Xst=class{constructor(e,i,r,s,n){this.type=e,this.data=i,this.timestamp=r,this.modifiers=s,this.cancelable=n,this._propagationState=g1.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=g1.STOPPED}shouldStopPropagation(){return!!(this._propagationState&g1.STOPPED)}async(e){this._propagationState|=g1.PAUSED;const i=(r,s)=>{this._propagationState&=~g1.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw r;return r};return(typeof e=="function"?e():e).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(e){return!!(this._propagationState&g1.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var g1;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(g1||(g1={}));const ib={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let Jst=class{};const Qst=Jst;function $y(t){return t!=null&&"open"in t&&"declaredClass"in t}function Nde(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const Kst=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([te(()=>[this.ui,this.popup],([i,r],s)=>{const n="popup",o="manual";if(s){const[a,l]=s;a&&$y(l)&&(l.view=null,Nde(l)&&a.remove(l,n))}i&&$y(r)&&(r.view=this,Nde(r)&&i.add(r,{key:n,position:o,internal:!0}))},$t),this.on("click",i=>{this.popup&&this.popupEnabled&&(i.pointerType!=="mouse"||i.button===0)&&($y(this.popup)?this.popup.viewModel.handleViewClick(i):i.async(async()=>{await this.setupPopup(),$y(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(i)}))},ib.WIDGET)]),VS(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{ce(()=>Promise.resolve().then(()=>Lwe),[])})}destroy(){this.destroyed||this.closePopup()}async openPopup(i){if($y(this.popup))return this.popup.open(i);try{if(await this.setupPopup(),!this.popup)return void se.getLogger(this).error(new G("view:null-popup","Popup is null and can't be opened"));this.popup.open(i)}catch{}}closePopup(){var i;(i=this._popupSetupTask)==null||i.abort(),$y(this.popup)&&this.popup.close()}async fetchPopupFeatures(i,r){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(i,r),r)}async setupPopup(){var i;if((i=this._popupSetupTask)==null||i.abort(),this.popup&&!$y(this.popup))return this._popupSetupTask=uy(async r=>{const{default:s}=await ce(()=>Promise.resolve().then(()=>Lwe),void 0);if(Dt(r),!this.popup||$y(this.popup))return;const n=this.popup;delete n.open,delete n.close,this.popup=new s(n)}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:i,hits:r},s){const n=[],o=[];let a=!1;const l=lqe(s,le("popup-view-fetch-timeout")??tnt),c=f=>{const m=new ent(f);return o.push(m),n.push(m.promise),m},u=f=>{const m=o.at(-1);return m&&m.layerView===f&&!a?m:c(f)};for(const f of r)"graphic"in f?(u(f.layerView).graphics.push(f.graphic),a=!1):(n.push(f.layerView.fetchPopupFeaturesAtLocation(f.mapPoint,l)),a=!0);o.map(f=>f.resolve(l));const d=$W(n).then(f=>f.filter(m=>!!m).flat());return{pendingFeatures:n,allGraphicsPromise:d,location:i}}async _getPopupHits(i,r){const{hits:s,location:n}=await this.popupHitTest(i);Dt(r);const o=[];for(const a of s)if("graphic"in a){if(this._isValidPopupGraphic(a.graphic,r)){const l=this._isValidPopupGraphicsLayerView(a.layerView)?a.layerView:void 0;o.push({graphic:a.graphic,layerView:l})}}else this._isValidPopupLocationLayerView(a.layerView)&&o.push({mapPoint:a.mapPoint,layerView:a.layerView});return{hits:o,location:n}}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(r==null?void 0:r.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(i){return!i||(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesFromGraphics"in i}_isValidPopupLocationLayerView(i){return(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesAtLocation"in i}};return h([p({cast(i){return!i||$y(i)||typeof i=="object"&&(i.open=r=>(fb(se.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(r)),i.close=()=>(fb(se.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),i}})],e.prototype,"popup",void 0),h([p()],e.prototype,"popupEnabled",void 0),e=h([I("esri.views.PopupView")],e),e};let ent=class{constructor(e){this.layerView=e,this._resolver=aa(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(e){const{layerView:i,graphics:r,_resolver:s}=this;if(!i)return s.resolve(r),s.promise;let n;return i.fetchPopupFeaturesFromGraphics(r,e).catch(o=>(n=o,null)).then(o=>{o?s.resolve(o):s.reject(n)}),s.promise}};const tnt=5e3;async function fse(t,e){const{WhereClause:i}=await ce(()=>import("./WhereClause-B8aijA-r.js").then(r=>r.W),__vite__mapDeps([26,27]));return i.create(t,e)}function int(t,e){return t==="1=1"?e??t:e==="1=1"?t??e:t!=null&&t!==""?e!=null&&e!==""?`(${t}) AND (${e})`:t:e}function J7t(t){return typeof t=="number"}function mse(t){return typeof t=="string"||t instanceof String}const rnt="yyyy-MM-dd",snt="TT";var t3;(function(t){t.HM="HH:mm",t.HMS="HH:mm:ss",t.HMS_MS="HH:mm:ss.SSS"})(t3||(t3={}));const nnt=[t3.HMS_MS,t3.HMS,t3.HM,snt];function Fde(t){if(!t||!mse(t))return null;const e=yi.fromFormat(t,rnt);return e.isValid?e:null}function kde(t){return t&&mse(t)?oqe(nnt,e=>{const i=yi.fromFormat(t,e);return i.isValid?i:null})??null:null}function Ude(t){if(!t||!mse(t))return null;const e=yi.fromISO(t);return e.isValid?e:null}var rP;(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(rP||(rP={}));const ont=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function ant(t){return t!=null&&ont.has(t.type)}function ZPe(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function YPe(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function XPe(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function lnt(t,e,i){const r=t==null?void 0:t.domain;if(!r)return null;switch(r.type){case"range":{const{min:s,max:n}=JPe(t);if(s!=null&&+e<s||n!=null&&+e>n)return rP.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(r.codedValues==null||r.codedValues.every(s=>s==null||s.code!==e))return rP.INVALID_CODED_VALUE}return null}function JPe(t,e){const i=t==null?void 0:t.domain;if(!i||i.type!=="range")return;const r="range"in i?i.range[0]:i.minValue,s="range"in i?i.range[1]:i.maxValue,n=ant(t);return ZPe(t)||XPe(t)||YPe(t)?{...cnt(t,s,r),isInteger:n}:{min:r!=null&&typeof r=="number"?r:null,max:s!=null&&typeof s=="number"?s:null,rawMin:r,rawMax:s,isInteger:n}}function cnt(t,e,i){var r,s,n,o,a,l;return ZPe(t)?{min:(r=Fde(i))==null?void 0:r.toMillis(),max:(s=Fde(e))==null?void 0:s.toMillis(),rawMin:i,rawMax:e}:XPe(t)?{min:(n=kde(i))==null?void 0:n.toMillis(),max:(o=kde(e))==null?void 0:o.toMillis(),rawMin:i,rawMax:e}:YPe(t)?{min:(a=Ude(i))==null?void 0:a.toMillis(),max:(l=Ude(e))==null?void 0:l.toMillis(),rawMin:i,rawMax:e}:{max:null,min:null}}const unt=()=>se.getLogger("esri.support.arcadeOnDemand");let d8;function ry(){return d8||(d8=(async()=>{const t=await ce(()=>import("./arcadeUtils-Bc-3MxKe.js").then(e=>e.aN),__vite__mapDeps([69,27,70,30,71]));return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),d8}const hnt=(t,e,i)=>gse.create(t,e,i,null,["$feature","$view"],[]),QPe=(t,e,i)=>gse.create(t,e,i,null,["$feature","$view"],[]),dnt=(t,e,i,r)=>gse.create(t,e,i,r,["$feature","$view"],[]);let gse=class KPe{constructor(e,i,r,s,n,o,a){this.services=null,this.script=e,this.evaluate=s;const l=Array.isArray(o)?o:o==null?void 0:o.fields;this.fields=l??[],this._syntaxTree=r,this._arcade=i,this._arcadeFeature=n,this._spatialReference=a,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,i,r,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await ry(),u=Ze.fromJSON(i);let d;try{d=a.parseScript(e,o)}catch(D){return unt().error(new G("arcade-bad-expression","Failed to parse arcade script",{script:e,error:D})),null}const f=n.reduce((D,U)=>({...D,[U]:null}),{});let m=null;s!=null&&(m=new c(s),m.immutable=!0,f.$config=null);const g=a.scriptUsesGeometryEngine(d),y=g&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(d)&&a.enableFeatureSetSupport(),b=a.scriptIsAsync(d),w=b&&a.enableAsyncSupport(),x={vars:f,spatialReference:u,useAsync:!!w};await Promise.all([y,v,w]);const S=new Set;await a.loadDependentModules(S,d,null,b,g);const C=new c;C.immutable=!1,C.setField("scale",0);const M=a.compileScript(d,x),O=(D,U)=>{var H;const k=(H=D.$view)==null?void 0:H.timeZone;return"$view"in D&&D.$view&&(C.setField("scale",typeof D.$view=="object"&&"scale"in D.$view?D.$view.scale:void 0),D.$view=C),m&&(D.$config=m),M({vars:D,spatialReference:u,services:U,timeZone:k})};return new KPe(e,a,d,O,new l,r,u)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const pnt=/^([0-9_])/,fnt=/[^a-z0-9_\u0080-\uffff]+/gi;function mnt(t){return t==null?null:t.trim().replaceAll(fnt,"_").replace(pnt,"F$1")||null}const gnt=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],ynt=["field","normalizationField"];function Vde(t,e){if(t!=null&&e!=null){for(const i of Array.isArray(t)?t:[t])if(zde(gnt,i,e),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)zde(ynt,r,e)}}function zde(t,e,i){if(t)for(const r of t){const s=tD(r,e),n=s&&typeof s!="function"&&i.get(s);n&&ia(r,n.name,e)}}function eOe(t,e){var i;if(t!=null&&((i=e==null?void 0:e.fields)!=null&&i.length))if("startField"in t){const r=e.get(t.startField),s=e.get(t.endField);t.startField=(r==null?void 0:r.name)??null,t.endField=(s==null?void 0:s.name)??null}else{const r=e.get(t.startTimeField),s=e.get(t.endTimeField);t.startTimeField=(r==null?void 0:r.name)??null,t.endTimeField=(s==null?void 0:s.name)??null}}const p8=new Set;function yse(t,e){return t&&e?(p8.clear(),WS(p8,t,e),Array.from(p8).sort()):[]}function WS(t,e,i){var r;if(i)if((r=e==null?void 0:e.fields)!=null&&r.length)if(i.includes("*"))for(const{name:s}of e.fields)t.add(s);else for(const s of i)Fc(t,e,s);else{if(i.includes("*"))return t.clear(),void t.add("*");for(const s of i)s!=null&&t.add(s)}}function Fc(t,e,i){if(typeof i=="string")if(e){const r=e.get(i);r&&t.add(r.name)}else t.add(i)}function Q7t(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(i=>i.name):e}async function Ql(t,e,i){var n;if(!i)return;const{arcadeUtils:r}=await ry(),s=r.extractFieldNames(i,(n=e==null?void 0:e.fields)==null?void 0:n.map(o=>o.name));for(const o of s)Fc(t,e,o)}async function tOe(t,e,i){if(i&&i!=="1=1"){const r=await fse(i,e);if(!r.isStandardized)throw new G("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});WS(t,e,r.fieldNames)}}function _nt({displayField:t,fields:e}){return t||(e!=null&&e.length?f8(e,"name-or-title")||f8(e,"unique-identifier")||f8(e,"type-or-category")||vnt(e):null)}function vnt(t){for(const e of t){if(!(e!=null&&e.name))continue;const i=e.name.toLowerCase();if(i.includes("name")||i.includes("title"))return e.name}return null}function f8(t,e){for(const i of t)if(i!=null&&i.valueType&&i.valueType===e)return i.name;return null}async function K7t(t,e){var r;if(!e)return;const i=(r=e.elevationInfo)==null?void 0:r.featureExpressionInfo;return i?i.collectRequiredFields(t,e.fieldsIndex):void 0}function bnt(t,e,i){i.onStatisticExpression?Ql(t,e,i.onStatisticExpression.expression):t.add(i.onStatisticField)}async function eWt(t,e,i){if(!e||!i||!("fields"in i))return;const r=[],s=i.popupTemplate;r.push(wnt(t,e,s)),i.fields&&r.push(...i.fields.map(async n=>bnt(t,e.fieldsIndex,n))),await Promise.all(r)}async function wnt(t,e,i){const r=[];i!=null&&i.expressionInfos&&r.push(...i.expressionInfos.map(n=>Ql(t,e.fieldsIndex,n.expression)));const s=i==null?void 0:i.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&r.push(Ql(t,e.fieldsIndex,n.expressionInfo.expression));await Promise.all(r)}async function tWt(t,e,i){e&&(e.timeInfo&&(i!=null&&i.timeExtent)&&WS(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&WS(t,e.fieldsIndex,[e.floorInfo.floorField]),(i==null?void 0:i.where)!=null&&await tOe(t,e.fieldsIndex,i.where))}async function iWt(t,e,i){e&&i&&await Promise.all(i.map(r=>xnt(t,e,r)))}async function xnt(t,e,i){e&&i&&(i.valueExpression?await Ql(t,e.fieldsIndex,i.valueExpression):i.field&&Fc(t,e.fieldsIndex,i.field))}function rWt(t){return t?yse(t.fieldsIndex,iOe(t)):[]}function Tnt(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?yse(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}const Snt=new Set(["oid","global-id","guid"]),Ent=new Set(["oid","global-id"]),Cnt=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/perimeter/i,/objectid/i,/_i$/i];function Mnt(t){const e=new Set;rOe(t).forEach(r=>e.add(r)),Tnt(t).forEach(r=>e.add(r.toLowerCase()));const i=t&&"infoFor3D"in t?t.infoFor3D:void 0;return i&&(Object.values(i.assetMapFieldRoles).forEach(r=>e.add(r.toLowerCase())),Object.values(i.transformFieldRoles).forEach(r=>e.add(r.toLowerCase()))),Array.from(e)}function iOe(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:i,creatorField:r,editDateField:s,editorField:n}=e;return[i,r,s,n].filter(Boolean)}function rOe(t){return iOe(t).map(e=>e.toLowerCase())}function Ant(t,e){var i;return t.editable&&!Snt.has(t.type)&&!rOe(e).includes(((i=t.name)==null?void 0:i.toLowerCase())??"")}function Pnt(t,e){var r;const i=((r=t.name)==null?void 0:r.toLowerCase())??"";return!((e==null?void 0:e.objectIdField)!=null&&i===e.objectIdField.toLowerCase()||(e==null?void 0:e.globalIdField)!=null&&i===e.globalIdField.toLowerCase()||Mnt(e).includes(i)||Ent.has(t.type)||Cnt.some(s=>s.test(i)))}async function sWt(t,e){const{labelingInfo:i,fieldsIndex:r}=e;i!=null&&i.length&&await Promise.all(i.map(s=>Ont(t,r,s)))}async function Ont(t,e,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if(r.type==="arcade")await Ql(t,e,r.expression);else{const n=r.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{Fc(t,e,o.slice(1,-1))})}await tOe(t,e,s)}function Rnt(t){const e=t.defaultValue;return e!==void 0&&oOe(t,e)?e:t.nullable?null:void 0}function nWt(t){const e=typeof t=="string"?{type:t}:t;return jnt(e)?255:e.type==="esriFieldTypeDate"||e.type==="date"?8:void 0}function sOe(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function $nt(t){return t===null||sOe(t)}function Int(t){return t===null||Number.isInteger(t)}function nOe(t){return t!=null&&typeof t=="string"}function Lnt(t){return t===null||nOe(t)}function Dnt(){return!0}function oOe(t,e){let i;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":i=t.nullable?Int:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=t.nullable?$nt:sOe;break;case"string":case"esriFieldTypeString":i=t.nullable?Lnt:nOe;break;default:i=Dnt}return arguments.length===1?i:i(e)}const Nnt=["integer","small-integer","big-integer"],Fnt=["single","double"],knt=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],Unt=["esriFieldTypeSingle","esriFieldTypeDouble"],Vnt=new Set([...Nnt,...knt]),znt=new Set([...Fnt,...Unt]),Bnt=LSe(Vnt,znt);function DG(t){return t!=null&&Bnt.has(t.type)}function jnt(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function _se(t){return t!=null&&(t.type==="date"||t.type==="esriFieldTypeDate")}function Gnt(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function Hnt(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function aOe(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function Bde(t){return t!=null&&(t.type==="oid"||t.type==="esriFieldTypeOID")}function jde(t){return t!=null&&(t.type==="global-id"||t.type==="esriFieldTypeGlobalID")}function oWt(t,e){return qnt(t,e)===null}var Vz,zz;function aWt(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function qnt(t,e){return t==null||t.nullable&&e===null?null:DG(t)&&!Wnt(t.type,Number(e))?Vz.OUT_OF_RANGE:oOe(t,e)?t.domain?lnt(t,e):null:zz.INVALID_TYPE}function Wnt(t,e){const i=typeof t=="string"?lOe(t):t;if(!i)return!1;const r=i.min,s=i.max;return i.isInteger?Number.isInteger(e)&&e>=r&&e<=s:e>=r&&e<=s}function lOe(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return Znt;case"esriFieldTypeInteger":case"integer":return Ynt;case"esriFieldTypeBigInteger":case"big-integer":return Xnt;case"esriFieldTypeSingle":case"single":return Jnt;case"esriFieldTypeDouble":case"double":return Qnt}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(Vz||(Vz={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(zz||(zz={}));const Znt={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},Ynt={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},Xnt={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},Jnt={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},Qnt={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function lWt(t,e,i){switch(t){case rP.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case rP.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case zz.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case Vz.OUT_OF_RANGE:{const{min:r,max:s}=lOe(e.type);return`Value ${i} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${r} to ${s}`}}}function Knt(t,e){return!eot(t,e,null)}function eot(t,e,i){if(!(e!=null&&e.attributes)||!t){if(i!=null)for(const n of t??[])i.add(n);return!0}const r=new Set(Object.keys(e.attributes));let s=!1;for(const n of t)if(!r.has(n)){if(s=!0,i==null)break;i.add(n)}return s}function zY(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}function cOe(t){const e=t==null?void 0:t.match(/{[^}]+}/g);return e?e.map(i=>i.slice(1,-1).split(":")[0].trim()):[]}let Lk=class extends Se{constructor(e){super(e),this.type=null}};h([p({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],Lk.prototype,"type",void 0),Lk=h([I("esri.popup.content.Content")],Lk);const Jb=Lk;var BY;let gx=BY=class extends Jb{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new BY({description:this.description,displayType:this.displayType,title:this.title})}};h([p({type:String,json:{write:!0}})],gx.prototype,"description",void 0),h([p({type:["auto","preview","list"],json:{write:!0}})],gx.prototype,"displayType",void 0),h([p({type:String,json:{write:!0}})],gx.prototype,"title",void 0),h([p({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],gx.prototype,"type",void 0),gx=BY=h([I("esri.popup.content.AttachmentsContent")],gx);const mL=gx;var jY;let yx=jY=class extends Jb{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new jY({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?ie(this.outFields):null})}};h([p()],yx.prototype,"creator",void 0),h([p()],yx.prototype,"destroyer",void 0),h([p()],yx.prototype,"outFields",void 0),h([p({type:["custom"],readOnly:!0})],yx.prototype,"type",void 0),yx=jY=h([I("esri.popup.content.CustomContent")],yx);const tot=yx;var GY;let lC=GY=class extends Se{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new GY({title:this.title,expression:this.expression})}};h([p({type:String,json:{write:!0}})],lC.prototype,"title",void 0),h([p({type:String,json:{write:!0}})],lC.prototype,"expression",void 0),h([p({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],lC.prototype,"returnType",void 0),lC=GY=h([I("esri.popup.ElementExpressionInfo")],lC);const uOe=lC;var HY;let i$=HY=class extends Jb{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new HY({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};h([p({type:uOe,json:{write:!0}})],i$.prototype,"expressionInfo",void 0),h([p({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],i$.prototype,"type",void 0),i$=HY=h([I("esri.popup.content.ExpressionContent")],i$);const vse=i$;let cC=class extends Jr(Se){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};h([Ot(B8e)],cC.prototype,"dateFormat",void 0),h([p({type:Boolean,json:{write:!0}})],cC.prototype,"digitSeparator",void 0),h([p({type:Xi,json:{write:!0}})],cC.prototype,"places",void 0),cC=h([I("esri.popup.support.FieldInfoFormat")],cC);const Dk=cC;var qY;let Lp=qY=class extends Se{constructor(t){super(t),this.fieldName=null,this.format=void 0,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){var t;return new qY({fieldName:this.fieldName,format:(t=this.format)==null?void 0:t.clone(),isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};h([p({type:String,json:{write:!0}})],Lp.prototype,"fieldName",void 0),h([p({type:Dk,json:{write:!0}})],Lp.prototype,"format",void 0),h([p({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],Lp.prototype,"isEditable",void 0),h([p({type:String,json:{write:!0}})],Lp.prototype,"label",void 0),h([Ot(new Ji({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],Lp.prototype,"stringFieldOption",void 0),h([p({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],Lp.prototype,"statisticType",void 0),h([p({type:String,json:{write:!0}})],Lp.prototype,"tooltip",void 0),h([p({type:Boolean,json:{write:!0}})],Lp.prototype,"visible",void 0),Lp=qY=h([I("esri.popup.FieldInfo")],Lp);const AD=Lp;var WY;let Qy=WY=class extends Jb{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(i=>i.toJSON())}clone(){return new WY(ie({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};h([p({type:Object,json:{write:!0}})],Qy.prototype,"attributes",void 0),h([p({type:String,json:{write:!0}})],Qy.prototype,"description",void 0),h([p({type:[AD]})],Qy.prototype,"fieldInfos",void 0),h([We("fieldInfos")],Qy.prototype,"writeFieldInfos",null),h([p({type:String,json:{write:!0}})],Qy.prototype,"title",void 0),h([p({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],Qy.prototype,"type",void 0),Qy=WY=h([I("esri.popup.content.FieldsContent")],Qy);const sP=Qy;let _x=class extends Se{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};h([p({type:String,json:{write:!0}})],_x.prototype,"altText",void 0),h([p({type:String,json:{write:!0}})],_x.prototype,"caption",void 0),h([p({type:String,json:{write:!0}})],_x.prototype,"title",void 0),h([p({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],_x.prototype,"type",void 0),_x=h([I("esri.popup.content.mixins.MediaInfo")],_x);const bse=_x;var ZY;let vx=ZY=class extends Ue{constructor(t){super(t),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){var t;return new ZY({color:(t=this.color)==null?void 0:t.clone(),fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};h([p()],vx.prototype,"color",void 0),h([p()],vx.prototype,"fieldName",void 0),h([p()],vx.prototype,"tooltip",void 0),h([p()],vx.prototype,"value",void 0),vx=ZY=h([I("esri.popup.content.support.ChartMediaInfoValueSeries")],vx);const hOe=vx;var YY;let Fv=YY=class extends Se{constructor(t){super(t),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new YY({colors:ie(this.colors),fields:ie(this.fields),normalizeField:this.normalizeField,series:ie(this.series),tooltipField:this.tooltipField})}};h([p({type:[Qe],json:{type:[[Xi]],write:!0}})],Fv.prototype,"colors",void 0),h([p({type:[String],json:{write:!0}})],Fv.prototype,"fields",void 0),h([p({type:String,json:{write:!0}})],Fv.prototype,"normalizeField",void 0),h([p({type:[hOe],json:{read:!1}})],Fv.prototype,"series",void 0),h([p({type:String,json:{write:!0}})],Fv.prototype,"tooltipField",void 0),Fv=YY=h([I("esri.popup.content.support.ChartMediaInfoValue")],Fv);const iot=Fv;let r$=class extends bse{constructor(e){super(e),this.type=null,this.value=void 0}};h([p({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],r$.prototype,"type",void 0),h([p({type:iot,json:{write:!0}})],r$.prototype,"value",void 0),r$=h([I("esri.popup.content.mixins.ChartMediaInfo")],r$);const NG=r$,FG=Kl()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var XY;let Nk=XY=class extends NG{constructor(t){super(t),this.type="bar-chart"}clone(){var t;return new XY({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};h([p({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:FG.write}})],Nk.prototype,"type",void 0),Nk=XY=h([I("esri.popup.content.BarChartMediaInfo")],Nk);const dOe=Nk;var JY;let Fk=JY=class extends NG{constructor(t){super(t),this.type="column-chart"}clone(){var t;return new JY({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};h([p({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:FG.write}})],Fk.prototype,"type",void 0),Fk=JY=h([I("esri.popup.content.ColumnChartMediaInfo")],Fk);const pOe=Fk;var QY;let s$=QY=class extends Se{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new QY({linkURL:this.linkURL,sourceURL:this.sourceURL})}};h([p({type:String,json:{write:!0}})],s$.prototype,"linkURL",void 0),h([p({type:String,json:{write:!0}})],s$.prototype,"sourceURL",void 0),s$=QY=h([I("esri.popup.content.support.ImageMediaInfoValue")],s$);const rot=s$;var KY;let uC=KY=class extends bse{constructor(t){super(t),this.refreshInterval=0,this.type="image",this.value=void 0}clone(){var t;return new KY({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:(t=this.value)==null?void 0:t.clone()})}};h([p({type:Number,json:{write:!0}})],uC.prototype,"refreshInterval",void 0),h([p({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],uC.prototype,"type",void 0),h([p({type:rot,json:{write:!0}})],uC.prototype,"value",void 0),uC=KY=h([I("esri.popup.content.ImageMediaInfo")],uC);const fOe=uC;var eX;let kk=eX=class extends NG{constructor(t){super(t),this.type="line-chart"}clone(){var t;return new eX({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};h([p({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:FG.write}})],kk.prototype,"type",void 0),kk=eX=h([I("esri.popup.content.LineChartMediaInfo")],kk);const mOe=kk;var tX;let Uk=tX=class extends NG{constructor(t){super(t),this.type="pie-chart"}clone(){var t;return new tX({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};h([p({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:FG.write}})],Uk.prototype,"type",void 0),Uk=tX=h([I("esri.popup.content.PieChartMediaInfo")],Uk);const gOe=Uk,yOe={base:bse,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":dOe,"column-chart":pOe,"line-chart":mOe,"pie-chart":gOe,image:fOe}};var iX;let Dp=iX=class extends Jb{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?fOe.fromJSON(e):e.type==="barchart"?dOe.fromJSON(e):e.type==="columnchart"?pOe.fromJSON(e):e.type==="linechart"?mOe.fromJSON(e):e.type==="piechart"?gOe.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(i=>i.toJSON())}clone(){return new iX(ie({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};h([p()],Dp.prototype,"activeMediaInfoIndex",void 0),h([p({type:Object,json:{write:!0}})],Dp.prototype,"attributes",void 0),h([p({type:String,json:{write:!0}})],Dp.prototype,"description",void 0),h([p({types:[yOe]})],Dp.prototype,"mediaInfos",void 0),h([ze("mediaInfos")],Dp.prototype,"readMediaInfos",null),h([We("mediaInfos")],Dp.prototype,"writeMediaInfos",null),h([p({type:String,json:{write:!0}})],Dp.prototype,"title",void 0),h([p({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Dp.prototype,"type",void 0),Dp=iX=h([I("esri.popup.content.MediaContent")],Dp);const gL=Dp;var rX;let n$=rX=class extends Se{constructor(t){super(t),this.field=null,this.order=null}clone(){return new rX({field:this.field,order:this.order})}};h([p({type:String,json:{write:!0}})],n$.prototype,"field",void 0),h([p({type:["asc","desc"],json:{write:!0}})],n$.prototype,"order",void 0),n$=rX=h([I("esri.popup.support.RelatedRecordsInfoFieldOrder")],n$);const wse=n$;let km=class extends Jr(Jb){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};h([p({type:String,json:{write:!0}})],km.prototype,"description",void 0),h([p({type:Number,json:{type:Xi,write:!0}})],km.prototype,"displayCount",void 0),h([p({type:["list"],json:{write:!0}})],km.prototype,"displayType",void 0),h([p({type:[wse],json:{write:!0}})],km.prototype,"orderByFields",void 0),h([p({type:Number,json:{type:Xi,write:!0}})],km.prototype,"relationshipId",void 0),h([p({type:String,json:{write:!0}})],km.prototype,"title",void 0),h([p({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],km.prototype,"type",void 0),km=h([I("esri.popup.content.RelationshipContent")],km);const Bz=km;var sX;let o$=sX=class extends Jb{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new sX({text:this.text})}};h([p({type:String,json:{write:!0}})],o$.prototype,"text",void 0),h([p({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],o$.prototype,"type",void 0),o$=sX=h([I("esri.popup.content.TextContent")],o$);const nP=o$,sot={base:null,key:"type",typeMap:{attachment:mL,media:gL,text:nP,expression:vse,field:sP,relationship:Bz}};var nX;let bx=nX=class extends Se{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new nX({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};h([p({type:String,json:{write:!0}})],bx.prototype,"name",void 0),h([p({type:String,json:{write:!0}})],bx.prototype,"title",void 0),h([p({type:String,json:{write:!0}})],bx.prototype,"expression",void 0),h([p({type:["string","number"],json:{write:!0}})],bx.prototype,"returnType",void 0),bx=nX=h([I("esri.popup.ExpressionInfo")],bx);const _Oe=bx;var oX;let a$=oX=class extends Se{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new oX({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};h([p({type:Boolean,json:{write:!0}})],a$.prototype,"returnTopmostRaster",void 0),h([p({type:Boolean,json:{write:!0}})],a$.prototype,"showNoDataRecords",void 0),a$=oX=h([I("esri.popup.LayerOptions")],a$);const not=a$;var aX;let l$=aX=class extends Se{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new aX({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?ie(this.orderByFields):null})}};h([p({type:Boolean,json:{write:!0}})],l$.prototype,"showRelatedRecords",void 0),h([p({type:[wse],json:{write:!0}})],l$.prototype,"orderByFields",void 0),l$=aX=h([I("esri.popup.RelatedRecordsInfo")],l$);const oot=l$;var lX;let hd=lX=class extends bD(Ue){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new lX({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};h([p()],hd.prototype,"active",void 0),h([p()],hd.prototype,"className",void 0),h([p()],hd.prototype,"disabled",void 0),h([p()],hd.prototype,"icon",void 0),h([p()],hd.prototype,"id",void 0),h([p()],hd.prototype,"indicator",void 0),h([p()],hd.prototype,"title",void 0),h([p()],hd.prototype,"type",void 0),h([p()],hd.prototype,"visible",void 0),hd=lX=h([I("esri.support.actions.ActionBase")],hd);const kG=hd;var cX;let Vk=cX=class extends kG{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new cX({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};h([p()],Vk.prototype,"image",void 0),Vk=cX=h([I("esri.support.actions.ActionButton")],Vk);const QP=Vk;var uX;let c$=uX=class extends kG{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new uX({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};h([p()],c$.prototype,"image",void 0),h([p()],c$.prototype,"value",void 0),c$=uX=h([I("esri.support.actions.ActionToggle")],c$);const xse=c$,HO="relationships/",Gde="expression/",aot=st.ofType({key:"type",defaultKeyValue:"button",base:kG,typeMap:{button:QP,toggle:xse}}),lot={base:Jb,key:"type",typeMap:{media:gL,custom:tot,text:nP,attachments:mL,fields:sP,expression:vse,relationship:Bz}},cot=new Set(["attachments","fields","media","text","expression","relationship"]);let Zo=class extends Jr(Se){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(i=>Gf(lot,i)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Fu(e)?e:(se.getLogger(this).error("content error","unsupported content value",{value:e}),null)}readContent(e,i){const{popupElements:r}=i;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(i.description,i.mediaInfos,r):this._readPopupInfo(i)}writeContent(e,i,r,s){typeof e!="string"?Array.isArray(e)&&(i.popupElements=e.filter(n=>cot.has(n.type)).map(n=>n==null?void 0:n.toJSON(s)),i.popupElements.forEach(n=>{n.type==="attachments"?this._writeAttachmentContent(i):n.type==="media"?this._writeMediaContent(n,i):n.type==="text"?this._writeTextContent(n,i):n.type==="relationship"&&this._writeRelationshipContent(n,i)})):i.description=e}writeFieldInfos(e,i,r,s){const{content:n}=this,o=Array.isArray(n)?n:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>{var u;return(u=c.fieldInfos)==null?void 0:u.length});i.fieldInfos=e.filter(Boolean).map(c=>{const u=c.toJSON(s);return l&&(u.visible=!1),u})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,i)}writeLayerOptions(e,i,r,s){i[r]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(s)}writeTitle(e,i){i.title=e||""}async collectRequiredFields(e,i){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,i,[...r,...this._getContentExpressionInfos(this.content,r)]),WS(e,i,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const i=new Set;return await this.collectRequiredFields(i,e),[...i].sort()}_writeFieldsContent(e,i){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=ie(e.fieldInfos);Array.isArray(i.fieldInfos)?r.forEach(s=>{const n=i.fieldInfos.find(o=>{var a,l;return((a=o.fieldName)==null?void 0:a.toLowerCase())===((l=s.fieldName)==null?void 0:l.toLowerCase())});n?n.visible=!0:i.fieldInfos.push(s)}):i.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,i){var n,o;const r=((n=e.orderByFields)==null?void 0:n.map(a=>this._toFieldOrderJSON(a,e.relationshipId)))||[],s=[...((o=i.relatedRecordsInfo)==null?void 0:o.orderByFields)||[],...r];i.relatedRecordsInfo={showRelatedRecords:!0,...(s==null?void 0:s.length)&&{orderByFields:s}}}_writeTextContent(e,i){!i.description&&e.text&&(i.description=e.text)}_writeMediaContent(e,i){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=ie(e.mediaInfos);Array.isArray(i.mediaInfos)?i.mediaInfos=[...i.mediaInfos,...r]:i.mediaInfos=r}_readPopupInfoElements(e,i,r){const s={description:!1,mediaInfos:!1};return r.map(n=>n.type==="media"?(n.mediaInfos||!i||s.mediaInfos||(n.mediaInfos=i,s.mediaInfos=!0),gL.fromJSON(n)):n.type==="text"?(n.text||!e||s.description||(n.text=e,s.description=!0),nP.fromJSON(n)):n.type==="attachments"?mL.fromJSON(n):n.type==="fields"?sP.fromJSON(n):n.type==="expression"?vse.fromJSON(n):n.type==="relationship"?Bz.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:i,order:r}=e;if(!(i!=null&&i.startsWith(HO)))return null;const s=i.replace(HO,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),o=s[1];return typeof n=="number"&&o?Bz.fromJSON({relationshipId:n,orderByFields:[{field:o,order:r}]}):null}_toFieldOrderJSON(e,i){const{order:r,field:s}=e;return{field:`${HO}${i}/${s}`,order:r}}_readPopupInfo({description:e,mediaInfos:i,showAttachments:r,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];e?n.push(new nP({text:e})):n.push(new sP),Array.isArray(i)&&i.length&&n.push(gL.fromJSON({mediaInfos:i})),r&&n.push(mL.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=s;return o&&(a!=null&&a.length)&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&n.push(c)}),n.length?n:e}_getContentElementFields(e){const i=e==null?void 0:e.type;if(i==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(i==="custom")return e.outFields||[];if(i==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(i==="media"){const r=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...r.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return i==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:i,title:r,value:s}=e,n=s||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:u}=n,d=[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(c),...this._extractFieldNames(u),...o??[]];return a&&d.push(a),l&&d.push(l),d}_getContentExpressionInfos(e,i){return Array.isArray(e)?e.reduce((r,s)=>[...r,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],i):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((i,r)=>[...i,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(e,i,r){r&&await Promise.all(r.map(s=>Ql(e,i,s.expression)))}_getFieldInfoFields(e){return e?e.filter(({fieldName:i,visible:r})=>!(r!==void 0&&!r||!i||i.startsWith(HO)||i.startsWith(Gde))).map(i=>i.fieldName):[]}_getActionsFields(e){return e?e.toArray().reduce((i,r)=>[...i,...this._getActionFields(r)],[]):[]}_getActionFields(e){const{className:i,title:r,type:s}=e,n=s==="button"||s==="toggle"?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){return cOe(e).filter(i=>!(i.indexOf(HO)===0||i.indexOf(Gde)===0))}};h([p({type:aot})],Zo.prototype,"actions",void 0),h([p()],Zo.prototype,"content",void 0),h([Kt("content")],Zo.prototype,"castContent",null),h([ze("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],Zo.prototype,"readContent",null),h([We("content",{popupElements:{type:st.ofType(sot)},showAttachments:{type:Boolean},mediaInfos:{type:st.ofType(yOe)},description:{type:String},relatedRecordsInfo:{type:oot}})],Zo.prototype,"writeContent",null),h([p({type:[_Oe],json:{write:!0}})],Zo.prototype,"expressionInfos",void 0),h([p({type:[AD]})],Zo.prototype,"fieldInfos",void 0),h([We("fieldInfos")],Zo.prototype,"writeFieldInfos",null),h([p({type:not})],Zo.prototype,"layerOptions",void 0),h([We("layerOptions")],Zo.prototype,"writeLayerOptions",null),h([p({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],Zo.prototype,"lastEditInfoEnabled",void 0),h([p()],Zo.prototype,"outFields",void 0),h([p()],Zo.prototype,"overwriteActions",void 0),h([p()],Zo.prototype,"returnGeometry",void 0),h([p({json:{type:String}})],Zo.prototype,"title",void 0),h([We("title")],Zo.prototype,"writeTitle",null),Zo=h([I("esri.PopupTemplate")],Zo);const PD=Zo,Hde=new Ji({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let uot=0,hC=class extends Se{constructor(e){super(e),this.id="sym"+uot++,this.type=null,this.color=new Qe([0,0,0,1])}readColor(e){return(e==null?void 0:e[0])!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,i){}hash(){return JSON.stringify(this.toJSON())}clone(){}};h([p({type:Hde.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:Hde.write}}})],hC.prototype,"type",void 0),h([p({type:Qe,json:{write:{allowNull:!0}}})],hC.prototype,"color",void 0),h([ze("color")],hC.prototype,"readColor",null),hC=h([I("esri.symbols.Symbol")],hC);const _l=hC;var hX;let kv=hX=class extends _l{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){var i;if(((i=this.data)==null?void 0:i.type)==="CIMSymbolReference"){const r=this.data.primitiveOverrides;if(r){const s=r.map(n=>{const o=n.valueExpressionInfo;return o?Ql(t,e,o.expression):null});await Promise.all(s)}}}clone(){return new hX({data:ie(this.data)})}hash(){return xie(JSON.stringify(this.data)).toString()}};h([p({json:{write:!1}})],kv.prototype,"color",void 0),h([p({json:{write:!0}})],kv.prototype,"data",void 0),h([ze("data",["symbol"])],kv.prototype,"readData",null),h([We("data",{})],kv.prototype,"writeData",null),h([Ot({CIMSymbolReference:"cim"},{readOnly:!0})],kv.prototype,"type",void 0),kv=hX=h([I("esri.symbols.CIMSymbol")],kv);const S_=kv;let dC=class extends Se{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,i,r){e||(i[r]=e)}};h([p({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],dC.prototype,"enabled",void 0),h([We("enabled")],dC.prototype,"writeEnabled",null),h([p({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],dC.prototype,"type",void 0),dC=h([I("esri.symbols.Symbol3DLayer")],dC);const dy=dC;let wx=class extends Se{constructor(e){super(e),this.color=new Qe([0,0,0,1]),this.extensionLength=0,this.size=Uo(1)}clone(){}cloneProperties(){return{color:ie(this.color),size:this.size,extensionLength:this.extensionLength}}};h([p({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],wx.prototype,"type",void 0),h([p(w_)],wx.prototype,"color",void 0),h([p({...iy,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],wx.prototype,"extensionLength",void 0),h([p(iy)],wx.prototype,"size",void 0),wx=h([I("esri.symbols.edges.Edges3D")],wx);const Tse=wx;var dX;let zk=dX=class extends Tse{constructor(t){super(t),this.type="sketch"}clone(){return new dX(this.cloneProperties())}};h([Ot({sketch:"sketch"},{readOnly:!0})],zk.prototype,"type",void 0),zk=dX=h([I("esri.symbols.edges.SketchEdges3D")],zk);const hot=zk;var pX;let Bk=pX=class extends Tse{constructor(t){super(t),this.type="solid"}clone(){return new pX(this.cloneProperties())}};h([Ot({solid:"solid"},{readOnly:!0})],Bk.prototype,"type",void 0),Bk=pX=h([I("esri.symbols.edges.SolidEdges3D")],Bk);const vOe=Bk,bOe={types:{key:"type",base:Tse,typeMap:{solid:vOe,sketch:hot}},json:{write:!0}};var fX;let Ih=fX=class extends Se{constructor(t){super(t),this.color=null}clone(){const t={color:this.color!=null?this.color.clone():null};return new fX(t)}};h([p(w_)],Ih.prototype,"color",void 0),Ih=fX=h([I("esri.symbols.support.Symbol3DMaterial")],Ih);var mX;let Uv=mX=class extends dy{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){var t,e;return new mX({edges:(t=this.edges)==null?void 0:t.clone(),enabled:this.enabled,material:(e=this.material)==null?void 0:e.clone(),castShadows:this.castShadows,size:this.size})}};h([Ot({Extrude:"extrude"},{readOnly:!0})],Uv.prototype,"type",void 0),h([p({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],Uv.prototype,"size",void 0),h([p({type:Ih,json:{write:!0}})],Uv.prototype,"material",void 0),h([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Uv.prototype,"castShadows",void 0),h([p(bOe)],Uv.prototype,"edges",void 0),Uv=mX=h([I("esri.symbols.ExtrudeSymbol3DLayer")],Uv);const wOe=Uv;let u$=class extends _l{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};h([Ot({esriSLS:"simple-line"},{readOnly:!0})],u$.prototype,"type",void 0),h([p({type:Number,cast:vr,json:{write:!0}})],u$.prototype,"width",void 0),u$=h([I("esri.symbols.LineSymbol")],u$);const dot=u$,pot=["begin","end","begin-end"],xOe=["arrow","circle","square","diamond","cross","x"];var gX;let Um=gX=class extends Se{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,i,r){e[i]=(r==null?void 0:r.origin)==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return(t==null?void 0:t[0])!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,i,r){(r==null?void 0:r.origin)==="web-map"||(e[i]=t)}clone(){return new gX({color:ie(this.color),placement:this.placement,style:this.style})}hash(){var t;return`${this.placement}.${(t=this.color)==null?void 0:t.hash()}.${this.style}`}};h([p({type:["begin","end","begin-end"],json:{write:!0}})],Um.prototype,"placement",void 0),h([Ot({"line-marker":"line-marker"},{readOnly:!0}),p({json:{origins:{"web-map":{write:!1}}}})],Um.prototype,"type",void 0),h([p({type:xOe})],Um.prototype,"style",void 0),h([We("style")],Um.prototype,"writeStyle",null),h([p({type:Qe,value:null,json:{write:{allowNull:!0}}})],Um.prototype,"color",null),h([ze("color")],Um.prototype,"readColor",null),h([We("color")],Um.prototype,"writeColor",null),Um=gX=h([I("esri.symbols.LineSymbolMarker")],Um);const fot=Um;var yX;const m8=new Ji({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let Ky=yX=class extends dot{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,i,r,s,n){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),i!=null&&(o.width=vr(i)),r!=null&&(o.cap=r),s!=null&&(o.join=s),n!=null&&(o.miterLimit=vr(n)),o}clone(){var t;return new yX({color:ie(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(t=this.marker)==null?void 0:t.clone()})}hash(){var t,e;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(e=this.marker)==null?void 0:e.hash()}`}};h([Ot({esriSLS:"simple-line"},{readOnly:!0})],Ky.prototype,"type",void 0),h([p({type:m8.apiValues,json:{read:m8.read,write:m8.write}})],Ky.prototype,"style",void 0),h([p({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&(i==null?void 0:i.origin)==null})}}})],Ky.prototype,"cap",void 0),h([p({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&(i==null?void 0:i.origin)==null})}}})],Ky.prototype,"join",void 0),h([p({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":fot}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],Ky.prototype,"marker",void 0),h([p({type:Number,json:{read:!1,write:!1}})],Ky.prototype,"miterLimit",void 0),Ky=yX=h([I("esri.symbols.SimpleLineSymbol")],Ky);const Wh=Ky;let h$=class extends _l{constructor(e){super(e),this.outline=null,this.type=null}hash(){var e;return`${this.type}.${(e=this.outline)==null?void 0:e.hash()}`}};h([p({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Wh}},json:{default:null,write:!0}})],h$.prototype,"outline",void 0),h([p({type:["simple-fill","picture-fill"],readOnly:!0})],h$.prototype,"type",void 0),h$=h([I("esri.symbols.FillSymbol")],h$);const TOe=h$;let jk=class extends Se{constructor(e){super(e)}clone(){throw new Error("Subclasses of LinePattern3D should implement their own clone method.")}};h([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],jk.prototype,"type",void 0),jk=h([I("esri.symbols.patterns.LinePattern3D")],jk);const SOe=jk,mot=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var _X;const got=Kl()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let d$=_X=class extends SOe{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new _X(t)}};h([p({type:["style"]})],d$.prototype,"type",void 0),h([Ot(got),p({type:mot})],d$.prototype,"style",void 0),d$=_X=h([I("esri.symbols.patterns.LineStylePattern3D")],d$);const Sse=d$;let Gk=class extends Se{constructor(e){super(e),this.type="style"}clone(){throw new Error("Subclasses of Pattern3D should implement their own clone method.")}};h([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Gk.prototype,"type",void 0),Gk=h([I("esri.symbols.patterns.Pattern3D")],Gk);const EOe=Gk,yot=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var vX;let p$=vX=class extends EOe{constructor(t){super(t),this.type="style",this.style="solid"}clone(){return new vX({style:this.style})}};h([p({type:["style"]})],p$.prototype,"type",void 0),h([p({type:yot,json:{read:!0,write:!0}})],p$.prototype,"style",void 0),p$=vX=h([I("esri.symbols.patterns.StylePattern3D")],p$);const COe=p$,_ot={types:{key:"type",base:EOe,typeMap:{style:COe}},json:{write:!0}},MOe={types:{key:"type",base:SOe,typeMap:{style:Sse}},json:{write:!0}},i3=new Qe("white");new Qe("black");const vot=new Qe([255,255,255,0]);function bot(t){return t.r===0&&t.g===0&&t.b===0}var bX;let r3=bX=class extends Ih{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new bX(t)}};h([Ot({multiply:"multiply",replace:"replace",tint:"tint"})],r3.prototype,"colorMixMode",void 0),r3=bX=h([I("esri.symbols.support.Symbol3DFillMaterial")],r3);function Xn(t=$Oe){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function ZS(t,e,i,r,s,n,o=Xn()){return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function xWt(t,e){const i=isFinite(t[2])||isFinite(t[5]);return new ur(i?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function oP(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function wot(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function Yf(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function Mh(t,e,i=0,r=e.length/3){let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let u=0;u<r;u++)s=Math.min(s,e[i+3*u]),n=Math.min(n,e[i+3*u+1]),o=Math.min(o,e[i+3*u+2]),a=Math.max(a,e[i+3*u]),l=Math.max(l,e[i+3*u+1]),c=Math.max(c,e[i+3*u+2]);t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function g8(t,e,i){const r=e.length;let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(i)for(let u=0;u<r;u++){const d=e[u];s=Math.min(s,d[0]),n=Math.min(n,d[1]),o=Math.min(o,d[2]),a=Math.max(a,d[0]),l=Math.max(l,d[1]),c=Math.max(c,d[2])}else for(let u=0;u<r;u++){const d=e[u];s=Math.min(s,d[0]),n=Math.min(n,d[1]),a=Math.max(a,d[0]),l=Math.max(l,d[1])}t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function xot(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function S2(t){return t[0]>=t[3]?0:t[3]-t[0]}function E2(t){return t[1]>=t[4]?0:t[4]-t[1]}function Qb(t){return t[2]>=t[5]?0:t[5]-t[2]}function AOe(t){const e=S2(t),i=Qb(t),r=E2(t);return Math.sqrt(e*e+i*i+r*r)}function Cf(t,e=[0,0,0]){return e[0]=t[0]+S2(t)/2,e[1]=t[1]+E2(t)/2,e[2]=t[2]+Qb(t)/2,e}function Hk(t,e=[0,0,0]){return e[0]=S2(t),e[1]=E2(t),e[2]=Qb(t),e}function Ese(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function TWt(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function Tot(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function Mf(t,e){return e==null||Tot(t,e)}function POe(t,e,i,r,s=t){return s[0]=t[0]+e,s[1]=t[1]+i,s[2]=t[2]+r,s[3]=t[3]+e,s[4]=t[4]+i,s[5]=t[5]+r,s}function SWt(t,e,i=t){const r=t[0]+S2(t)/2,s=t[1]+E2(t)/2,n=t[2]+Qb(t)/2;return i[0]=r+(t[0]-r)*e,i[1]=s+(t[1]-s)*e,i[2]=n+(t[2]-n)*e,i[3]=r+(t[3]-r)*e,i[4]=s+(t[4]-s)*e,i[5]=n+(t[5]-n)*e,i}function EWt(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function OOe(t,e,i=t){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i!==t&&(i[3]=t[3],i[4]=t[4],i[5]=t[5]),i}function ROe(t,e,i=t){return i[3]=e[0],i[4]=e[1],i[5]=e[2],i!==t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),t}function UG(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Zr(t){return t?UG(t,qde):Xn(qde)}function Cse(t,e){return e||(e=oi()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function CWt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function Sot(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=Number.NEGATIVE_INFINITY,t[3]=r,t[4]=s,t[5]=Number.POSITIVE_INFINITY,t}function wX(t){return t.length===6}function Mse(t){return S2(t)===0&&E2(t)===0&&Qb(t)===0}function MWt(t,e,i){if(t==null||e==null)return t===e;if(!wX(t)||!wX(e))return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Eot(t,e,i,r,s,n){return ZS(t,e,i,r,s,n,Cot)}const AWt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],qde=[1/0,1/0,1/0,-1/0,-1/0,-1/0],$Oe=[0,0,0,0,0,0],Cot=Xn();function y8(t,{isPrimitive:e,width:i,depth:r,height:s}){const n=e?10:1;if(i==null&&s==null&&r==null)return[n*t[0],n*t[1],n*t[2]];const o=Ge(i,r,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const Mot=ZS(-.5,-.5,-.5,.5,.5,.5),Aot=ZS(-.5,-.5,0,.5,.5,1),Pot=ZS(-.5,-.5,0,.5,.5,.5);function Oot(t){switch(t){case"sphere":case"cube":case"diamond":return Mot;case"cylinder":case"cone":case"inverted-cone":return Aot;case"tetrahedron":return Pot;default:return}}const Ase=["butt","square","round"],Rot=[...Ase,"none"],IOe=["miter","bevel","round"];var xX;let xx=xX=class extends Se{constructor(t){super(t),this.color=new Qe([0,0,0,1]),this.size=Uo(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new xX(t)}};h([p(w_)],xx.prototype,"color",void 0),h([p(iy)],xx.prototype,"size",void 0),h([p(MOe)],xx.prototype,"pattern",void 0),h([p({type:Ase,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],xx.prototype,"patternCap",void 0),xx=xX=h([I("esri.symbols.support.Symbol3DOutline")],xx);var qk;let e0=qk=class extends dy{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new qk(t)}static fromSimpleFillSymbol(t){var r,s,n;const e=t.outline&&t.outline.style&&t.outline.style!=="solid"?new Sse({style:t.outline.style}):null,i={size:((r=t.outline)==null?void 0:r.width)??0,color:(((s=t.outline)==null?void 0:s.color)??i3).clone(),pattern:e};return e&&((n=t.outline)!=null&&n.cap)&&(i.patternCap=t.outline.cap),new qk({material:new r3({color:(t.color??vot).clone()}),pattern:t.style&&t.style!=="solid"?new COe({style:t.style}):null,outline:i})}};h([Ot({Fill:"fill"},{readOnly:!0})],e0.prototype,"type",void 0),h([p({type:r3,json:{write:!0}})],e0.prototype,"material",void 0),h([p(_ot)],e0.prototype,"pattern",void 0),h([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],e0.prototype,"castShadows",void 0),h([p({type:xx,json:{write:!0}})],e0.prototype,"outline",void 0),h([p(bOe)],e0.prototype,"edges",void 0),e0=qk=h([I("esri.symbols.FillSymbol3DLayer")],e0);const C2=e0,$ot=["none","underline","line-through"],Iot=["normal","italic","oblique"],Lot=["normal","lighter","bold","bolder"],LOe={type:Number,cast:t=>{const e=Id(t);return e===0?1:Ne(e,.1,4)},nonNullable:!0},Dot=["left","right","center"],Not=["baseline","top","middle","bottom"],DOe={type:Dot,nonNullable:!0},NOe={type:Not,nonNullable:!0},Fot=8;var TX;let t0=TX=class extends Se{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return vr(t)}clone(){return new TX({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};h([p({type:$ot,json:{default:"none",write:!0}})],t0.prototype,"decoration",void 0),h([p({type:String,json:{write:!0}})],t0.prototype,"family",void 0),h([p({type:Number,json:{write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.textSymbol3D})}}})],t0.prototype,"size",void 0),h([Kt("size")],t0.prototype,"castSize",null),h([p({type:Iot,json:{default:"normal",write:!0}})],t0.prototype,"style",void 0),h([p({type:Lot,json:{default:"normal",write:!0}})],t0.prototype,"weight",void 0),t0=TX=h([I("esri.symbols.Font")],t0);const OD=t0;var SX;const kot=Kl()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let Tx=SX=class extends Se{constructor(t){super(t)}readHref(t,e,i){return t?yb(t,i):e.dataURI}writeHref(t,e,i,r){t&&(cy(t)?e.dataURI=t:(e.href=kS(t,r),Oh(e.href)&&(e.href=Zd(e.href))))}clone(){return new SX({href:this.href,primitive:this.primitive})}};h([p({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],Tx.prototype,"href",void 0),h([ze("href")],Tx.prototype,"readHref",null),h([We("href",{href:{type:String},dataURI:{type:String}})],Tx.prototype,"writeHref",null),h([Ot(kot)],Tx.prototype,"primitive",void 0),Tx=SX=h([I("esri.symbols.support.IconSymbol3DLayerResource")],Tx);const Uot="circle";var EX;let NT=EX=class extends Ue{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new EX({x:this.x,y:this.y})}};h([p({type:Number})],NT.prototype,"x",void 0),h([p({type:Number})],NT.prototype,"y",void 0),NT=EX=h([I("esri.symbols.support.Symbol3DAnchorPosition2D")],NT);var CX;let f$=CX=class extends Se{constructor(t){super(t),this.color=new Qe([0,0,0,1]),this.size=Uo(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new CX(t)}};h([p(w_)],f$.prototype,"color",void 0),h([p(iy)],f$.prototype,"size",void 0),f$=CX=h([I("esri.symbols.support.Symbol3DIconOutline")],f$);var pC;const FOe="esri.symbols.IconSymbol3DLayer";let Vm=pC=class extends dy{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new pC({anchor:this.anchor,anchorPosition:ie(this.anchorPosition),enabled:this.enabled,material:ie(this.material),outline:ie(this.outline),resource:ie(this.resource),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||i3,i=Wde(t),r=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||i3).clone()}:null;return new pC({size:t.size,resource:{primitive:zot(t.style)},material:{color:e},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(t){const e=!t.color||bot(t.color)?i3:t.color,i=Wde(t);return new pC({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(t){return new pC({resource:{href:y2e({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};h([p({type:Ih,json:{write:!0}})],Vm.prototype,"material",void 0),h([p({type:Tx,json:{write:!0}})],Vm.prototype,"resource",void 0),h([Ot({Icon:"icon"},{readOnly:!0})],Vm.prototype,"type",void 0),h([p(iy)],Vm.prototype,"size",void 0),h([Ot({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),p({json:{default:"center"}})],Vm.prototype,"anchor",void 0),h([p({type:NT,json:{type:[Number],read:{reader:t=>new NT({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Vm.prototype,"anchorPosition",void 0),h([p({type:f$,json:{write:!0}})],Vm.prototype,"outline",void 0),Vm=pC=h([I(FOe)],Vm);const z1=Vm;function Wde(t){const e="width"in t?t.width:t.size,i="height"in t?t.height:t.size,r=Zde(t.xoffset),s=Zde(t.yoffset);return(r||s)&&e&&i?{x:-r/e,y:s/i}:null}function Zde(t){return isFinite(t)?t:0}const Vot={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function zot(t){return Vot[t]||(se.getLogger(FOe).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}let Sx=class extends Jr(Se){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};h([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Sx.prototype,"type",void 0),h([p({type:pot,json:{default:"begin-end",write:!0}})],Sx.prototype,"placement",void 0),h([p({type:xOe,json:{default:"arrow",write:!0}})],Sx.prototype,"style",void 0),h([p({type:Qe,json:{type:[Xi],default:null,write:!0}})],Sx.prototype,"color",void 0),Sx=h([I("esri.symbols.LineStyleMarker3D")],Sx);const MX=Sx;var Wk;let zm=Wk=class extends dy{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Uo(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new Wk(t)}static fromSimpleLineSymbol(t){var i;const e={enabled:!0,size:t.width??Uo(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style?new Sse({style:t.style}):null,material:new Ih({color:(t.color||i3).clone()}),marker:t.marker?new MX({placement:t.marker.placement,style:t.marker.style,color:((i=t.marker.color)==null?void 0:i.clone())??null}):null};return new Wk(e)}};h([p({type:Ih,json:{write:!0}})],zm.prototype,"material",void 0),h([Ot({Line:"line"},{readOnly:!0})],zm.prototype,"type",void 0),h([p({type:IOe,json:{write:!0,default:"miter"}})],zm.prototype,"join",void 0),h([p({type:Ase,json:{write:!0,default:"butt"}})],zm.prototype,"cap",void 0),h([p(iy)],zm.prototype,"size",void 0),h([p(MOe)],zm.prototype,"pattern",void 0),h([p({types:{key:"type",base:MX,typeMap:{style:MX}},json:{write:!0}})],zm.prototype,"marker",void 0),zm=Wk=h([I("esri.symbols.LineSymbol3DLayer")],zm);const KP=zm;var AX;const Bot=Kl()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let m$=AX=class extends Se{clone(){return new AX({href:this.href,primitive:this.primitive})}};h([p({type:String,json:{read:sre,write:_b}})],m$.prototype,"href",void 0),h([Ot(Bot)],m$.prototype,"primitive",void 0),m$=AX=h([I("esri.symbols.support.ObjectSymbol3DLayerResource")],m$);const kOe="sphere";var PX;let yT=PX=class extends Ue{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new PX({x:this.x,y:this.y,z:this.z})}};h([p({type:Number})],yT.prototype,"x",void 0),h([p({type:Number})],yT.prototype,"y",void 0),h([p({type:Number})],yT.prototype,"z",void 0),yT=PX=h([I("esri.symbols.support.Symbol3DAnchorPosition3D")],yT);var OX;let Ol=OX=class extends dy{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){var t,e,i;return new OX({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:(t=this.anchorPosition)==null?void 0:t.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:((e=this.material)==null?void 0:e.clone())??null,castShadows:this.castShadows,resource:(i=this.resource)==null?void 0:i.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};h([p({type:Ih,json:{write:!0}})],Ol.prototype,"material",void 0),h([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Ol.prototype,"castShadows",void 0),h([p({type:m$,json:{write:!0}})],Ol.prototype,"resource",void 0),h([Ot({Object:"object"},{readOnly:!0})],Ol.prototype,"type",void 0),h([p({type:Number,json:{write:!0}})],Ol.prototype,"width",void 0),h([p({type:Number,json:{write:!0}})],Ol.prototype,"height",void 0),h([p({type:Number,json:{write:!0}})],Ol.prototype,"depth",void 0),h([Ot({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),p({json:{default:"origin"}})],Ol.prototype,"anchor",void 0),h([p({type:yT,json:{type:[Number],read:{reader:t=>new yT({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Ol.prototype,"anchorPosition",void 0),h([p({type:Number,json:{write:!0}})],Ol.prototype,"heading",void 0),h([p({type:Number,json:{write:!0}})],Ol.prototype,"tilt",void 0),h([p({type:Number,json:{write:!0}})],Ol.prototype,"roll",void 0),h([p({readOnly:!0})],Ol.prototype,"isPrimitive",null),Ol=OX=h([I("esri.symbols.ObjectSymbol3DLayer")],Ol);const Pse=Ol;var RX;let yc=RX=class extends dy{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new RX({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};h([p({type:Ih,json:{write:!0}})],yc.prototype,"material",void 0),h([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],yc.prototype,"castShadows",void 0),h([Ot({Path:"path"},{readOnly:!0})],yc.prototype,"type",void 0),h([p({type:["circle","quad"],json:{write:!0,default:"circle"}})],yc.prototype,"profile",void 0),h([p({type:IOe,json:{write:!0,default:"miter"}})],yc.prototype,"join",void 0),h([p({type:Rot,json:{write:!0,default:"butt"}})],yc.prototype,"cap",void 0),h([p({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],yc.prototype,"width",void 0),h([ze("width",["width","size","height"])],yc.prototype,"readWidth",null),h([p({type:Number,json:{write:!0}})],yc.prototype,"height",void 0),h([ze("height",["height","size","width"])],yc.prototype,"readHeight",null),h([p({type:["center","bottom","top"],json:{write:!0,default:"center"}})],yc.prototype,"anchor",void 0),h([p({type:["heading","all"],json:{write:!0,default:"all"}})],yc.prototype,"profileRotation",void 0),yc=RX=h([I("esri.symbols.PathSymbol3DLayer")],yc);const Ose=yc;var $X;let hM=$X=class extends Se{constructor(){super(...arguments),this.color=new Qe([0,0,0,1]),this.size=0}clone(){const t={color:ie(this.color),size:this.size};return new $X(t)}};h([p(w_)],hM.prototype,"color",void 0),h([p(iy)],hM.prototype,"size",void 0),hM=$X=h([I("esri.symbols.support.Symbol3DHalo")],hM);let s3=class extends Jr(Se){constructor(e){super(e),this.color=null}};h([p(w_)],s3.prototype,"color",void 0),s3=h([I("esri.symbols.support.Symbol3DTextBackground")],s3);var Zk;let eu=Zk=class extends dy{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,i,r){const s={...r,textSymbol3D:!0};e.font=t.write({},s),delete e.font.size}get size(){var t;return this._userSize!=null?this._userSize:((t=this.font)==null?void 0:t.size)!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new Zk({enabled:this.enabled,font:this.font&&ie(this.font),halo:this.halo&&ie(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:ie(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new Zk({font:t.font!=null?t.font.clone():new OD,halo:jot(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new Ih({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new s3({color:t.backgroundColor.clone()}):null})}};function jot(t,e){return t&&e!=null&&e>0?new hM({color:ie(t),size:e}):null}h([p({type:OD,json:{write:!0}})],eu.prototype,"font",null),h([We("font")],eu.prototype,"writeFont",null),h([p({type:hM,json:{write:!0}})],eu.prototype,"halo",void 0),h([p({...DOe,json:{default:"center",write:!0}})],eu.prototype,"horizontalAlignment",void 0),h([p({...LOe,json:{default:1,write:!0}})],eu.prototype,"lineHeight",void 0),h([p({type:Ih,json:{write:!0}})],eu.prototype,"material",void 0),h([p({type:s3,json:{write:!0}})],eu.prototype,"background",void 0),h([p(iy)],eu.prototype,"size",null),h([p({type:String,json:{write:!0}})],eu.prototype,"text",void 0),h([Ot({Text:"text"},{readOnly:!0})],eu.prototype,"type",void 0),h([p({...NOe,json:{default:"baseline",write:!0}})],eu.prototype,"verticalAlignment",void 0),eu=Zk=h([I("esri.symbols.TextSymbol3DLayer")],eu);const M2=eu;var IX;let Vv=IX=class extends dy{constructor(t){super(t),this.color=LX.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new IX({color:ie(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};h([p({type:Qe,nonNullable:!0,json:{type:[Xi],write:(t,e,i)=>e[i]=t.toArray(Qe.AlphaMode.UNLESS_OPAQUE),default:()=>LX.clone(),defaultEquals:t=>t.toCss(!0)===LX.toCss(!0)}})],Vv.prototype,"color",void 0),h([Ot({Water:"water"},{readOnly:!0})],Vv.prototype,"type",void 0),h([p({type:["small","medium","large"],json:{write:!0,default:"medium"}})],Vv.prototype,"waterbodySize",void 0),h([p({type:Number,json:{write:!0,default:null}})],Vv.prototype,"waveDirection",void 0),h([p({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],Vv.prototype,"waveStrength",void 0),Vv=IX=h([I("esri.symbols.WaterSymbol3DLayer")],Vv);const UOe=Vv,LX=new Qe([0,119,190]);var DX;let Ex=DX=class extends Ue{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new DX({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};h([p({type:String})],Ex.prototype,"name",void 0),h([p({type:String})],Ex.prototype,"styleUrl",void 0),h([p({type:String})],Ex.prototype,"styleName",void 0),h([p({type:Wn})],Ex.prototype,"portal",void 0),Ex=DX=h([I("esri.symbols.support.StyleOrigin")],Ex);const yL=Ex;var NX;let pS=NX=class extends Ue{constructor(){super(...arguments),this.url=""}clone(){return new NX({url:this.url})}};h([p({type:String})],pS.prototype,"url",void 0),pS=NX=h([I("esri.symbols.support.Thumbnail")],pS);const VOe={icon:z1,object:Pse,line:KP,path:Ose,fill:C2,extrude:wOe,text:M2,water:UOe},Got=st.ofType({base:dy,key:"type",typeMap:VOe,errorContext:"symbol-layer"});let Bm=class extends _l{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const i=this.__accessor__&&this.__accessor__.metadata&&this.__accessor__.metadata.symbolLayers,r=i==null?void 0:i.type,s=r||st;this._set("symbolLayers",new s)}get color(){return null}set color(e){this.constructed&&se.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){Kg(e,this._get("symbolLayers"))}readStyleOrigin(e,i,r){if(e.styleUrl&&e.name){const s=yb(e.styleUrl,r);return new yL({styleUrl:s,name:e.name})}if(e.styleName&&e.name)return new yL({portal:(r==null?void 0:r.portal)||Wn.getDefault(),styleName:e.styleName,name:e.name});r!=null&&r.messages&&r.messages.push(new Jg("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,i,r,s){if(e.styleUrl&&e.name){let n=kS(e.styleUrl,s);Oh(n)&&(n=Zd(n)),i.styleOrigin={styleUrl:n,name:e.name}}else e.styleName&&e.name&&(e.portal&&(s!=null&&s.portal)&&!g2e(e.portal.restUrl,s.portal.restUrl)?s!=null&&s.messages&&s.messages.push(new Jg("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):i.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof dy||e&&VOe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};h([p({json:{read:!1,write:!1}})],Bm.prototype,"color",null),h([p({type:Got,nonNullable:!0,json:{write:!0}}),Kt(Hie)],Bm.prototype,"symbolLayers",null),h([p({type:yL})],Bm.prototype,"styleOrigin",void 0),h([ze("styleOrigin")],Bm.prototype,"readStyleOrigin",null),h([We("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],Bm.prototype,"writeStyleOrigin",null),h([p({type:pS,json:{read:!1}})],Bm.prototype,"thumbnail",void 0),h([p({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],Bm.prototype,"type",void 0),Bm=h([I("esri.symbols.Symbol3D")],Bm);const eO=Bm;let g$=class extends Se{constructor(e){super(e),this.visible=!0}clone(){throw new Error("Subclasses of Callout3D should implement their own clone method.")}};h([p({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],g$.prototype,"type",void 0),h([p({readOnly:!0})],g$.prototype,"visible",void 0),g$=h([I("esri.symbols.callouts.Callout3D")],g$);const zOe=g$;var FX;let Yk=FX=class extends Se{constructor(t){super(t),this.color=new Qe("white")}clone(){return new FX({color:ie(this.color)})}};h([p(w_)],Yk.prototype,"color",void 0),Yk=FX=h([I("esri.symbols.callouts.LineCallout3DBorder")],Yk);const Hot=Yk;var kX;let zv=kX=class extends zOe{constructor(t){super(t),this.type="line",this.color=new Qe([0,0,0,1]),this.size=Uo(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new kX({color:ie(this.color),size:this.size,border:ie(this.border)})}};h([Ot({line:"line"})],zv.prototype,"type",void 0),h([p(w_)],zv.prototype,"color",void 0),h([p(iy)],zv.prototype,"size",void 0),h([p({type:Hot,json:{write:!0}})],zv.prototype,"border",void 0),h([p({readOnly:!0})],zv.prototype,"visible",null),zv=kX=h([I("esri.symbols.callouts.LineCallout3D")],zv);const BOe=zv;function Rse(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function jOe(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!Rse(t)}function $se(t){return t.type==="point-3d"||t.type==="label-3d"}function GOe(t){return t.horizontalAlignment==="center"}const HOe={types:{key:"type",base:zOe,typeMap:{line:BOe}},json:{write:!0}};var UX;let fC=UX=class extends Se{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new UX({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};h([p(iy)],fC.prototype,"screenLength",void 0),h([p({type:Number,nonNullable:!0,json:{write:!0,default:0}})],fC.prototype,"minWorldLength",void 0),h([p({type:Number,json:{write:!0}})],fC.prototype,"maxWorldLength",void 0),fC=UX=h([I("esri.symbols.support.Symbol3DVerticalOffset")],fC);const Ise=fC;var Xk;const qOe=st.ofType({base:null,key:"type",typeMap:{text:M2}});let Bv=Xk=class extends eO{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new qOe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return jOe(this)}hasVisibleVerticalOffset(){return Rse(this)}clone(){return new Xk({styleOrigin:ie(this.styleOrigin),symbolLayers:ie(this.symbolLayers),thumbnail:ie(this.thumbnail),callout:ie(this.callout),verticalOffset:ie(this.verticalOffset)})}static fromTextSymbol(t){return new Xk({symbolLayers:new st([M2.fromTextSymbol(t)])})}};h([p({type:Ise,json:{write:!0}})],Bv.prototype,"verticalOffset",void 0),h([p(HOe)],Bv.prototype,"callout",void 0),h([p({json:{read:!1,write:!1}})],Bv.prototype,"styleOrigin",void 0),h([p({type:qOe})],Bv.prototype,"symbolLayers",void 0),h([Ot({LabelSymbol3D:"label-3d"},{readOnly:!0})],Bv.prototype,"type",void 0),Bv=Xk=h([I("esri.symbols.LabelSymbol3D")],Bv);const VG=Bv;var Jk;const WOe=st.ofType({base:null,key:"type",typeMap:{line:KP,path:Ose}}),qot=st.ofType({base:null,key:"type",typeMap:{line:KP,path:Ose}});let y$=Jk=class extends eO{constructor(t){super(t),this.symbolLayers=new WOe,this.type="line-3d"}clone(){return new Jk({styleOrigin:ie(this.styleOrigin),symbolLayers:ie(this.symbolLayers),thumbnail:ie(this.thumbnail)})}static fromSimpleLineSymbol(t){return new Jk({symbolLayers:new st([KP.fromSimpleLineSymbol(t)])})}};h([p({type:WOe,json:{type:qot}})],y$.prototype,"symbolLayers",void 0),h([Ot({LineSymbol3D:"line-3d"},{readOnly:!0})],y$.prototype,"type",void 0),y$=Jk=h([I("esri.symbols.LineSymbol3D")],y$);const A2=y$;let jv=class extends _l{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};h([p({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],jv.prototype,"angle",void 0),h([p({type:["simple-marker","picture-marker"],readOnly:!0})],jv.prototype,"type",void 0),h([p({type:Number,cast:vr,json:{write:!0}})],jv.prototype,"xoffset",void 0),h([p({type:Number,cast:vr,json:{write:!0}})],jv.prototype,"yoffset",void 0),h([p({type:Number,cast:t=>t==="auto"?t:vr(t),json:{write:!0}})],jv.prototype,"size",void 0),jv=h([I("esri.symbols.MarkerSymbol")],jv);const ZOe=jv;var Qk;const YOe=st.ofType({base:null,key:"type",typeMap:{fill:C2}});let _$=Qk=class extends eO{constructor(t){super(t),this.symbolLayers=new YOe,this.type="mesh-3d"}clone(){return new Qk({styleOrigin:ie(this.styleOrigin),symbolLayers:ie(this.symbolLayers),thumbnail:ie(this.thumbnail)})}static fromSimpleFillSymbol(t){return new Qk({symbolLayers:new st([C2.fromSimpleFillSymbol(t)])})}};h([p({type:YOe})],_$.prototype,"symbolLayers",void 0),h([Ot({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],_$.prototype,"type",void 0),_$=Qk=h([I("esri.symbols.MeshSymbol3D")],_$);const RD=_$;function Wot(t,e,i){return e.imageData?y2e({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):XOe(e.url,i)}function XOe(t,e){if(!Oh(t)){const i=Yot(e);if(i)return Uh(i,"images",t)}return yb(t,e)}function Zot(t,e,i,r){if(cy(t)){const s=mb(t);if(!s)return;e.contentType=s.mediaType,e.imageData=s.data,i&&i.imageData===e.imageData&&i.url&&_b(i.url,e,"url",r)}else _b(t,e,"url",r)}const JOe={json:{read:{source:["imageData","url"],reader:Wot},write:{writer(t,e,i,r){Zot(t,e,this.source,r)}}}},QOe={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,i){const r={};return e.imageData&&(r.imageData=e.imageData),e.contentType&&(r.contentType=e.contentType),e.url&&(r.url=XOe(e.url,i)),r}}}};function Yot(t){var s,n;if(!t)return null;const{origin:e,layer:i}=t;if(e!=="service"&&e!=="portal-item")return null;const r=i==null?void 0:i.type;return r==="feature"||r==="stream"?(s=i.parsedUrl)==null?void 0:s.path:r==="map-image"||r==="tile"?(n=t.url)==null?void 0:n.path:null}var VX;let dd=VX=class extends TOe{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const s={};return t&&(s.url=t),e&&(s.outline=e),i!=null&&(s.width=vr(i)),r!=null&&(s.height=vr(r)),s}clone(){const t=new VX({color:ie(this.color),height:this.height,outline:ie(this.outline),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",ie(this.source)),t}hash(){var t;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};h([Ot({esriPFS:"picture-fill"},{readOnly:!0})],dd.prototype,"type",void 0),h([p(JOe)],dd.prototype,"url",void 0),h([p({type:Number,json:{write:!0}})],dd.prototype,"xscale",void 0),h([p({type:Number,json:{write:!0}})],dd.prototype,"yscale",void 0),h([p({type:Number,cast:vr,json:{write:!0}})],dd.prototype,"width",void 0),h([p({type:Number,cast:vr,json:{write:!0}})],dd.prototype,"height",void 0),h([p({type:Number,cast:vr,json:{write:!0}})],dd.prototype,"xoffset",void 0),h([p({type:Number,cast:vr,json:{write:!0}})],dd.prototype,"yoffset",void 0),h([p(QOe)],dd.prototype,"source",void 0),dd=VX=h([I("esri.symbols.PictureFillSymbol")],dd);const Lse=dd;var zX;let Np=zX=class extends ZOe{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const r={};return t&&(r.url=t),e!=null&&(r.width=vr(e)),i!=null&&(r.height=vr(i)),r}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new zX({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",ie(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};h([p({json:{write:!1}})],Np.prototype,"color",void 0),h([Ot({esriPMS:"picture-marker"},{readOnly:!0})],Np.prototype,"type",void 0),h([p(JOe)],Np.prototype,"url",void 0),h([p(QOe)],Np.prototype,"source",void 0),h([p({type:Number,cast:vr,json:{write:!0}})],Np.prototype,"height",void 0),h([ze("height",["height","size"])],Np.prototype,"readHeight",null),h([p({type:Number,cast:vr,json:{write:!0}})],Np.prototype,"width",void 0),h([p({json:{write:!1}})],Np.prototype,"size",void 0),Np=zX=h([I("esri.symbols.PictureMarkerSymbol")],Np);const $D=Np;var Cx;const KOe=st.ofType({base:null,key:"type",typeMap:{icon:z1,object:Pse,text:M2}});let Mx=Cx=class extends eO{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new KOe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return jOe(this)}hasVisibleVerticalOffset(){return Rse(this)}clone(){return new Cx({verticalOffset:ie(this.verticalOffset),callout:ie(this.callout),styleOrigin:ie(this.styleOrigin),symbolLayers:ie(this.symbolLayers),thumbnail:ie(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new Cx({symbolLayers:new st([z1.fromSimpleMarkerSymbol(t)])})}static fromPictureMarkerSymbol(t){return new Cx({symbolLayers:new st([z1.fromPictureMarkerSymbol(t)])})}static fromCIMSymbol(t){var r,s;if(((s=(r=t.data)==null?void 0:r.symbol)==null?void 0:s.type)!=="CIMPointSymbol")return null;const i=t.data.symbol;return new Cx(i!=null&&i.callout?{symbolLayers:new st([z1.fromCIMSymbol(t)]),callout:new BOe({size:.5,color:new Qe([0,0,0])}),verticalOffset:new Ise({screenLength:40})}:{symbolLayers:new st([z1.fromCIMSymbol(t)])})}static fromTextSymbol(t){return new Cx({symbolLayers:new st([M2.fromTextSymbol(t)])})}};h([p({type:Ise,json:{write:!0}})],Mx.prototype,"verticalOffset",void 0),h([p(HOe)],Mx.prototype,"callout",void 0),h([p({type:KOe,json:{origins:{"web-scene":{write:!0}}}})],Mx.prototype,"symbolLayers",void 0),h([Ot({PointSymbol3D:"point-3d"},{readOnly:!0})],Mx.prototype,"type",void 0),Mx=Cx=h([I("esri.symbols.PointSymbol3D")],Mx);const Ag=Mx;var v$;const eRe=st.ofType({base:null,key:"type",typeMap:{extrude:wOe,fill:C2,icon:z1,line:KP,object:Pse,text:M2,water:UOe}});let b$=v$=class extends eO{constructor(t){super(t),this.symbolLayers=new eRe,this.type="polygon-3d"}initialize(){const t=e=>{e.type==="line"&&fb(se.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),e.type==="text"&&fb(se.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const e of this.symbolLayers)t(e);this.addHandles(Ks(()=>this.symbolLayers,"after-add",({item:e})=>t(e),or))}clone(){return new v$({styleOrigin:ie(this.styleOrigin),symbolLayers:ie(this.symbolLayers),thumbnail:ie(this.thumbnail)})}static fromJSON(t){var i;const e=new v$;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const r=e.symbolLayers.at(0),s=e.symbolLayers.at(1);!s.enabled||(i=t.symbolLayers)!=null&&i[1]&&t.symbolLayers[1].enable===!1||(r.outline={size:s.size,color:s.material!=null?s.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new v$({symbolLayers:new st([C2.fromSimpleFillSymbol(t)])})}};h([p({type:eRe,json:{write:!0}})],b$.prototype,"symbolLayers",void 0),h([Ot({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],b$.prototype,"type",void 0),b$=v$=h([I("esri.symbols.PolygonSymbol3D")],b$);const Kb=b$;var BX;const _8=new Ji({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let Ax=BX=class extends TOe{constructor(...t){super(...t),this.color=new Qe([0,0,0,.25]),this.outline=new Wh,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.style=t),e&&(r.outline=e),i&&(r.color=i),r}clone(){return new BX({color:ie(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};h([p()],Ax.prototype,"color",void 0),h([p()],Ax.prototype,"outline",void 0),h([Ot({esriSFS:"simple-fill"},{readOnly:!0})],Ax.prototype,"type",void 0),h([p({type:_8.apiValues,json:{read:_8.read,write:_8.write}})],Ax.prototype,"style",void 0),Ax=BX=h([I("esri.symbols.SimpleFillSymbol")],Ax);const E_=Ax;var jX;const v8=new Ji({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let jm=jX=class extends ZOe{constructor(...t){super(...t),this.color=new Qe([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Wh}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string")return t;const s={};return t&&(s.style=t),e!=null&&(s.size=vr(e)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new jX({angle:this.angle,color:ie(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(t=this.outline)==null?void 0:t.hash()}`}};h([p()],jm.prototype,"color",void 0),h([We("color")],jm.prototype,"writeColor",null),h([Ot({esriSMS:"simple-marker"},{readOnly:!0})],jm.prototype,"type",void 0),h([p()],jm.prototype,"size",void 0),h([p({type:v8.apiValues,json:{read:v8.read,write:v8.write}})],jm.prototype,"style",void 0),h([p({type:String,json:{write:!0}})],jm.prototype,"path",null),h([p({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Wh}},json:{default:null,write:!0}})],jm.prototype,"outline",void 0),jm=jX=h([I("esri.symbols.SimpleMarkerSymbol")],jm);const py=jm;var GX;let tn=GX=class extends _l{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new OD,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.text=t),e&&(r.font=e),i&&(r.color=i),r}writeLineWidth(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}castLineWidth(t){return vr(t)}writeLineHeight(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}clone(){return new GX({angle:this.angle,backgroundColor:ie(this.backgroundColor),borderLineColor:ie(this.borderLineColor),borderLineSize:this.borderLineSize,color:ie(this.color),font:this.font&&this.font.clone(),haloColor:ie(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t,e,i;return`${(t=this.backgroundColor)==null?void 0:t.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(e=this.color)==null?void 0:e.hash()}.${this.font&&this.font.hash()}.${(i=this.haloColor)==null?void 0:i.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};h([p({type:Qe,json:{write:!0}})],tn.prototype,"backgroundColor",void 0),h([p({type:Qe,json:{write:!0}})],tn.prototype,"borderLineColor",void 0),h([p({type:Number,json:{write:!0},cast:vr})],tn.prototype,"borderLineSize",void 0),h([p({type:OD,json:{write:!0}})],tn.prototype,"font",void 0),h([p({...DOe,json:{write:!0}})],tn.prototype,"horizontalAlignment",void 0),h([p({type:Boolean,json:{write:!0}})],tn.prototype,"kerning",void 0),h([p({type:Qe,json:{write:!0}})],tn.prototype,"haloColor",void 0),h([p({type:Number,cast:vr,json:{write:!0}})],tn.prototype,"haloSize",void 0),h([p({type:Boolean,json:{write:!0}})],tn.prototype,"rightToLeft",void 0),h([p({type:Boolean,json:{write:!0}})],tn.prototype,"rotated",void 0),h([p({type:String,json:{write:!0}})],tn.prototype,"text",void 0),h([Ot({esriTS:"text"},{readOnly:!0})],tn.prototype,"type",void 0),h([p({...NOe,json:{write:!0}})],tn.prototype,"verticalAlignment",void 0),h([p({type:Number,cast:vr,json:{write:!0}})],tn.prototype,"xoffset",void 0),h([p({type:Number,cast:vr,json:{write:!0}})],tn.prototype,"yoffset",void 0),h([p({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],tn.prototype,"angle",void 0),h([p({type:Number,json:{write:!0}})],tn.prototype,"width",void 0),h([p({type:Number})],tn.prototype,"lineWidth",void 0),h([We("lineWidth")],tn.prototype,"writeLineWidth",null),h([Kt("lineWidth")],tn.prototype,"castLineWidth",null),h([p(LOe)],tn.prototype,"lineHeight",void 0),h([We("lineHeight")],tn.prototype,"writeLineHeight",null),tn=GX=h([I("esri.symbols.TextSymbol")],tn);const tO=tn;var HX;let Fp=HX=class extends _l{constructor(t){super(t),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:Wn.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e==null?void 0:e.portal,super.read(t,e)}clone(){return new HX({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const i=e!=null?e.cache:null,r=i?this._fetchCacheKey:null;if(i!=null){const a=r&&i.get(r);if(a)return a.clone()}const{resolveWebStyleSymbol:s}=await ce(()=>Promise.resolve().then(()=>eAt),void 0);Dt(e);const n=s(this,{portal:this.portal},t,e);n.catch(a=>{se.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(i!=null&&i.set(r,o.clone()),o):null}};h([p({json:{write:!1}})],Fp.prototype,"color",void 0),h([p({type:String,json:{write:!0}})],Fp.prototype,"styleName",void 0),h([p({type:Wn,json:{write:!1}})],Fp.prototype,"portal",void 0),h([p({type:String,json:{read:sre,write:_b}})],Fp.prototype,"styleUrl",void 0),h([p({type:pS,json:{read:!1}})],Fp.prototype,"thumbnail",void 0),h([p({type:String,json:{write:!0}})],Fp.prototype,"name",void 0),h([Ot({styleSymbolReference:"web-style"},{readOnly:!0})],Fp.prototype,"type",void 0),h([p()],Fp.prototype,"_fetchCacheKey",null),Fp=HX=h([I("esri.symbols.WebStyleSymbol")],Fp);const P2=Fp;function zG(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function YS(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const fS={base:_l,key:"type",typeMap:{"simple-fill":E_,"picture-fill":Lse,"picture-marker":$D,"simple-line":Wh,"simple-marker":py,text:tO,"label-3d":VG,"line-3d":A2,"mesh-3d":RD,"point-3d":Ag,"polygon-3d":Kb,"web-style":P2,cim:S_},errorContext:"symbol"},LWt={base:_l,key:"type",typeMap:{"picture-marker":$D,"simple-marker":py,"point-3d":Ag,cim:S_},errorContext:"symbol"},DWt={base:_l,key:"type",typeMap:{"simple-line":Wh,"line-3d":A2,cim:S_},errorContext:"symbol"},NWt={base:_l,key:"type",typeMap:{"simple-fill":E_,"picture-fill":Lse,"polygon-3d":Kb,cim:S_},errorContext:"symbol"},Xot={base:_l,key:"type",typeMap:{"picture-marker":$D,"simple-marker":py,text:tO,"web-style":P2,cim:S_},errorContext:"symbol"},Jot=VP({types:fS}),tRe={base:_l,key:"type",typeMap:{"simple-fill":E_,"picture-fill":Lse,"picture-marker":$D,"simple-line":Wh,"simple-marker":py,text:tO,"line-3d":A2,"mesh-3d":RD,"point-3d":Ag,"polygon-3d":Kb,"web-style":P2,cim:S_},errorContext:"symbol"},Qot={base:_l,key:"type",typeMap:{text:tO,"label-3d":VG},errorContext:"symbol"},Yde={base:_l,key:"type",typeMap:{"line-3d":A2,"mesh-3d":RD,"point-3d":Ag,"polygon-3d":Kb,"web-style":P2,cim:S_},errorContext:"symbol"},Kot={base:_l,key:"type",typeMap:{"label-3d":VG},errorContext:"symbol"},iRe=Gf(fS);var qX;function eat(t){if(!t)return null;const e={};for(const i in t){const r=ty(t[i]);r&&(e[i]=r)}return Object.keys(e).length!==0?e:null}function tat(t){if(t==null)return null;const e={};for(const i in t){const r=t[i];r&&(e[i]=r.toJSON())}return Object.keys(e).length!==0?e:null}let _c=qX=class extends Jr(Se){constructor(t){super(t),this.isAggregate=!1,this.layer=null,this.origin=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Ph(),configurable:!0}),Object.defineProperty(this,"_lastMeshTransform",{value:{},configurable:!0,writable:!0,enumerable:!1}),arguments.length>1&&yqe(se.getLogger(this),"Graphic",{version:"4.30"})}initialize(){this._watchMeshGeometryChanges()}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),(t==null?void 0:t.type)!=="mesh"&&this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new qX({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible,origin:this.origin})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;const e=this.origin&&"layer"in this.origin?this.origin.layer:null;for(const i of[e,this.sourceLayer,this.layer])if(i){if("popupTemplate"in i&&i.popupTemplate)return i.popupTemplate;if(t&&"defaultPopupTemplate"in i&&i.defaultPopupTemplate!=null)return i.defaultPopupTemplate}return null}getAttribute(t){var e;return(e=this.attributes)==null?void 0:e[t]}setAttribute(t,e){if(this.attributes){const i=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",i,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){var t;return{aggregateGeometries:tat(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:JV(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:((t=this.popupTemplate)==null?void 0:t.toJSON())??null}}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if((e==null?void 0:e.type)==="mesh"){const i={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",i,i,t.action)}}_notifyLayer(t,e,i,r){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:t,oldValue:e,newValue:i};t==="origin-transform"&&(s.action=r),t==="attributes"&&(s.attributeName=r),this.layer.graphicChanged(s)}_watchMeshGeometryChanges(){this.addHandles([No(()=>{var t,e;return((t=this.geometry)==null?void 0:t.type)==="mesh"&&this.geometry.vertexSpace.origin?{localMatrix:(e=this.geometry.transform)==null?void 0:e.localMatrix,origin:this.geometry.vertexSpace.origin}:void 0},({localMatrix:t,origin:e})=>{this._lastMeshTransform.localMatrix===t&&this._lastMeshTransform.origin===e||(this._lastMeshTransform.localMatrix=t,this._lastMeshTransform.origin=e,this.notifyMeshTransformChanged())}),No(()=>{var t;return((t=this.geometry)==null?void 0:t.type)==="mesh"?{vertexAttributes:this.geometry.vertexAttributes}:void 0},()=>{var e;const t=this.geometry;(t==null?void 0:t.type)==="mesh"&&t.vertexSpace.origin?(this._lastMeshTransform.localMatrix=(e=t.transform)==null?void 0:e.localMatrix,this._lastMeshTransform.origin=t.vertexSpace.origin):(this._lastMeshTransform.localMatrix=void 0,this._lastMeshTransform.origin=void 0),this._notifyLayer("geometry",this.geometry,this.geometry)},{equals:(t,e)=>t===e,sync:!0})])}};h([p({value:null,json:{read:eat}})],_c.prototype,"aggregateGeometries",null),h([p({value:null})],_c.prototype,"attributes",null),h([p({value:null,types:y2,json:{read:ty}})],_c.prototype,"geometry",null),h([p({type:Boolean})],_c.prototype,"isAggregate",void 0),h([p({clonable:"reference"})],_c.prototype,"layer",void 0),h([p({clonable:"reference"})],_c.prototype,"origin",void 0),h([p({type:PD})],_c.prototype,"popupTemplate",void 0),h([p({clonable:"reference"})],_c.prototype,"sourceLayer",void 0),h([p({value:null,types:fS})],_c.prototype,"symbol",null),h([p({type:Boolean,value:!0})],_c.prototype,"visible",null),_c=qX=h([I("esri.Graphic")],_c),function(t){t.generateUID=Ph}(_c||(_c={}));const ca=_c;let n3=class extends QI{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};h([Gie({Type:ca,ensureType:Qs(ca)})],n3.prototype,"itemType",void 0),n3=h([I("esri.support.GraphicsCollection")],n3);let Gv=class extends Ue{constructor(e){super(e),this.view=null,this.baseLayerViews=new st,this.referenceLayerViews=new st,this._loadingHandle=te(()=>{var i,r;return(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.basemap},i=>{i&&i.load().catch(()=>{})},$t)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){var i,r,s;if((i=this.view)!=null&&i.suspended)return!1;const e=(s=(r=this.view)==null?void 0:r.map)==null?void 0:s.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(n=>n.updating)||this.referenceLayerViews.some(n=>n.updating))}};h([p({constructOnly:!0})],Gv.prototype,"view",void 0),h([p({readOnly:!0})],Gv.prototype,"baseLayerViews",void 0),h([p({readOnly:!0})],Gv.prototype,"referenceLayerViews",void 0),h([p({readOnly:!0})],Gv.prototype,"suspended",null),h([p({type:Boolean,readOnly:!0})],Gv.prototype,"updating",null),Gv=h([I("esri.views.BasemapView")],Gv);function iat(t){return"tryRecycleWith"in t}function rat(t){return t!=null&&typeof t=="object"&&"layerViews"in t}let sat=class{constructor(e,i,r){this.layer=e,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=aa(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,Ra(this._controller.signal,()=>{const s=new G("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!iat(this.layerView))return null;const i=this.layer.type,r=this._controller.signal;for(let s=0;s<e.length;s++){const n=e[s];if(n.type!==i)continue;const o=this.layerView.tryRecycleWith(n,{signal:r});if(o){e.splice(s,1),this.layer=n;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(Dt(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),n.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,u)=>Ra(this._controller.signal,()=>u(ki())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:e}),r.emit("layerview-destroy",{layer:i,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){var s,n;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:i,view:r}=this;this._map=r.map;try{let o,a;if(await i.load({signal:e}),i.prefetchResources&&await i.prefetchResources({signal:e}),oat(i))o=await i.createLayerView(r,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new G("layer:view-not-supported","No layerview implementation was found");const u=await this.layerViewImporter.importLayerView(i);Dt(e),o="default"in u?new u.default({layer:i,view:r}):new u({layer:i,view:r})}const l=()=>{a=$r(a),o.destroyed||o.destroy(),o.layer=null,o.parent=null,o.view=null,this.done=!0};a=Ra(e,l),Dt(e);try{await o.when()}catch(u){throw l(),u}if(!((n=(s=this._map)==null?void 0:s.allLayers)==null?void 0:n.includes(i)))return l(),void this._deferred.reject(new G("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=o,i.emit("layerview-create",{view:r,layerView:o}),r.emit("layerview-create",{layer:i,layerView:o}),this.done=!0,this._deferred.resolve(o)}catch(o){i.emit("layerview-create-error",{view:r,error:o}),r.emit("layerview-create-error",{layer:i,error:o}),this.done=!0,this._deferred.reject(new G("layerview:create-error","layerview creation failed",{layer:i,error:o}))}}},pd=class extends Ue{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Z0,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var r;const i=(r=this.view.map)==null?void 0:r.allLayers;if(i)for(const s of i)this.layerViewImporter.hasLayerViewModule(s)&&this.layerViewImporter.importLayerView(s)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=aa(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(p2(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var l,c,u;if(this.destroyed)return;const i=this.view.map;if(this._map!==i&&(this.clear(),this._map=i),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const r=new Set,s=[],n=this.view.ready,o=d=>{if(d!=null){for(const f of d)if(f){r.add(f);const m=this._layerLayerViewInfoMap.get(f);m&&n?m.start():m||this._recyclingInfoMap.has(f)||s.push(f),"layers"in f&&f.layers&&o(f.layers)}}};for(const d of this._rootCollectionNames)o(Df(this,d));for(const[d,f]of this._layerLayerViewInfoMap)if(!r.has(d)){this._layerLayerViewInfoMap.delete(f.layer);const m=f.tryRecycle(s);m?(this.notifyChange("updating"),this._recyclingInfoMap.set(f.layer,f),m.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(f.layer),this._layerLayerViewInfoMap.set(f.layer,f),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(f.layer),f.destroy(),this._reschedule()})):f.destroy()}for(const[d,f]of this._recyclingInfoMap)r.has(d)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(f.layer),f.destroy());for(const d of s)this._createLayerView(d);this._refreshCollections();const a=[(l=i==null?void 0:i.ground)==null?void 0:l.layers,(c=i==null?void 0:i.basemap)==null?void 0:c.baseLayers,(u=i==null?void 0:i.basemap)==null?void 0:u.referenceLayers,i==null?void 0:i.layers].filter(d=>!!d);r.forEach(d=>"layers"in d&&a.push(d.layers)),this.addHandles(a.map(d=>this._watchUpdatingTracking.addOnCollectionChange(()=>d,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([Ks(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),te(()=>{const e=this.view,i=e==null?void 0:e.map;return[i==null?void 0:i.basemap,i==null?void 0:i.ground,i==null?void 0:i.layers,e==null?void 0:e.ready]},()=>this._reschedule(),hr)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),HH(this._recyclingInfoMap),HH(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(ki()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||Eh(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const i of this._layerLayerViewInfoMap.values())i.done||++e;return e}clear(){this.destroyed||(HH(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new G("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}isCreatingLayerViewsForLayer(e,i){var n;this.commitProperty("updatingRemaining");const r=this._layerLayerViewInfoMap.get(e);if(!(r!=null&&r.done))return!0;const s=r.layerView;return!(!s||!i||s.parent===i)||!!(r.done&&s&&"layers"in e&&((n=e.layers)!=null&&n.length))&&e.layers.some(o=>this.isCreatingLayerViewsForLayer(o,s))}_refreshCollections(){for(const[e,i]of this._layersToLayerViews)this._populateLayerViewsOwners(Df(this,e),Df(this,i),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,i,r){if(!e||!i)return void(i&&i.removeAll());let s=0;for(const n of e){const o=this._layerLayerViewInfoMap.get(n);if(!(o!=null&&o.layerView))continue;const a=o.layerView;a.layer=n,a.parent=r,i.at(s)!==a&&i.splice(s,0,a),"layers"in n&&rat(a)&&this._populateLayerViewsOwners(n.layers,a.layerViews,a),s+=1}s<i.length&&i.splice(s,i.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const i=new sat(e,this.view,this.layerViewImporter);i.promise.then(()=>this._refreshCollections(),r=>{r&&(os(r)||r.name==="cancelled:layerview-create")||se.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,i),this.view.ready&&i.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};h([p()],pd.prototype,"_workPromise",void 0),h([p({readOnly:!0})],pd.prototype,"_watchUpdatingTracking",void 0),h([p({readOnly:!0})],pd.prototype,"_layersToLayerViews",null),h([p({readOnly:!0})],pd.prototype,"_rootCollectionNames",null),h([p()],pd.prototype,"layerViewImporter",void 0),h([p()],pd.prototype,"supportsGround",void 0),h([p({readOnly:!0})],pd.prototype,"updating",null),h([p({readOnly:!0})],pd.prototype,"updatingRemaining",null),h([p({constructOnly:!0})],pd.prototype,"view",void 0),pd=h([I("esri.views.LayerViewManager")],pd);const nat=pd;function oat(t){return"createLayerView"in t&&t.createLayerView!=null}let Qu=class extends Ue{constructor(e){super(e),this.factor=1.5,this.offset=ep(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};h([p({type:Number})],Qu.prototype,"factor",void 0),h([p({nonNullable:!0})],Qu.prototype,"offset",void 0),h([p()],Qu.prototype,"position",void 0),h([p({type:Number,range:{min:0}})],Qu.prototype,"size",void 0),h([p()],Qu.prototype,"maskUrl",void 0),h([p()],Qu.prototype,"maskEnabled",void 0),h([p()],Qu.prototype,"overlayUrl",void 0),h([p()],Qu.prototype,"overlayEnabled",void 0),h([p({readOnly:!0})],Qu.prototype,"version",null),h([p({type:Boolean})],Qu.prototype,"visible",void 0),Qu=h([I("esri.views.Magnifier")],Qu);const rRe=Qu;let Kk=class{constructor(e){this._observable=new BP,this._map=new Map(e)}get size(){return Ft(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const i=this._map.delete(e);return i&&this._observable.notify(),i}entries(){return Ft(this._observable),this._map.entries()}forEach(e,i){Ft(this._observable),this._map.forEach((r,s)=>e.call(i,r,s,this),i)}get(e){return Ft(this._observable),this._map.get(e)}has(e){return Ft(this._observable),this._map.has(e)}keys(){return Ft(this._observable),this._map.keys()}set(e,i){return this._map.set(e,i),this._observable.notify(),this}values(){return Ft(this._observable),this._map.values()}[Symbol.iterator](){return Ft(this._observable),this._map[Symbol.iterator]()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}};var WX;let w$=WX=class extends Se{constructor(t){super(t),this.name=null,this.code=null}clone(){return new WX({name:this.name,code:this.code})}};h([p({type:String,json:{write:!0}})],w$.prototype,"name",void 0),h([p({type:[String,Number],json:{write:!0}})],w$.prototype,"code",void 0),w$=WX=h([I("esri.layers.support.CodedValue")],w$);const aat=new Ji({inherited:"inherited",codedValue:"coded-value",range:"range"});let x$=class extends Se{constructor(e){super(e),this.name=null,this.type=null}};h([p({type:String,json:{write:!0}})],x$.prototype,"name",void 0),h([Ot(aat)],x$.prototype,"type",void 0),x$=h([I("esri.layers.support.Domain")],x$);const BG=x$;var ZX;let T$=ZX=class extends BG{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const i=String(t);this.codedValues.some(r=>(String(r.code)===i&&(e=r.name),!!e))}return e}clone(){return new ZX({codedValues:ie(this.codedValues),name:this.name})}};h([p({type:[w$],json:{write:!0}})],T$.prototype,"codedValues",void 0),h([Ot({codedValue:"coded-value"})],T$.prototype,"type",void 0),T$=ZX=h([I("esri.layers.support.CodedValueDomain")],T$);const sRe=T$;var YX;let eU=YX=class extends BG{constructor(t){super(t),this.type="inherited"}clone(){return new YX}};h([Ot({inherited:"inherited"})],eU.prototype,"type",void 0),eU=YX=h([I("esri.layers.support.InheritedDomain")],eU);const nRe=eU;var XX;let mC=XX=class extends BG{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new XX({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};h([p({json:{type:[Number],read:{source:"range",reader:(t,e)=>{var i;return(i=e.range)==null?void 0:i[1]}},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,i){e[i]=[this.minValue||0,t]}}}})],mC.prototype,"maxValue",void 0),h([p({json:{type:[Number],read:{source:"range",reader:(t,e)=>{var i;return(i=e.range)==null?void 0:i[0]}},write:{target:"range",writer(t,e,i){e[i]=[t,this.maxValue||0]}}}})],mC.prototype,"minValue",void 0),h([Ot({range:"range"})],mC.prototype,"type",void 0),mC=XX=h([I("esri.layers.support.RangeDomain")],mC);const oRe=mC,aRe={key:"type",base:BG,typeMap:{range:oRe,"coded-value":sRe,inherited:nRe}};function jG(t){if(!(t!=null&&t.type))return null;switch(t.type){case"range":return oRe.fromJSON(t);case"codedValue":return sRe.fromJSON(t);case"inherited":return nRe.fromJSON(t)}return null}var JX;const lat=new Ji({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Rl=JX=class extends Se{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return(i==null?void 0:i.value)??null}readValueType(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return i?lat.fromJSON(i.fieldValueType):null}clone(){var t;return new JX({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:((t=this.domain)==null?void 0:t.clone())??null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};h([p({type:String,json:{write:!0}})],Rl.prototype,"alias",void 0),h([p({type:[String,Number],json:{write:{allowNull:!0}}})],Rl.prototype,"defaultValue",void 0),h([p()],Rl.prototype,"description",void 0),h([ze("description")],Rl.prototype,"readDescription",null),h([p({types:aRe,json:{read:{reader:jG},write:!0}})],Rl.prototype,"domain",void 0),h([p({type:Boolean,json:{write:!0}})],Rl.prototype,"editable",void 0),h([p({type:Xi,json:{write:{overridePolicy:t=>({enabled:Number.isFinite(t)})}}})],Rl.prototype,"length",void 0),h([p({type:String,json:{write:!0}})],Rl.prototype,"name",void 0),h([p({type:Boolean,json:{write:!0}})],Rl.prototype,"nullable",void 0),h([Ot(Ore)],Rl.prototype,"type",void 0),h([p()],Rl.prototype,"valueType",void 0),h([ze("valueType",["description"])],Rl.prototype,"readValueType",null),h([p({type:Boolean,json:{read:!1}})],Rl.prototype,"visible",void 0),Rl=JX=h([I("esri.layers.support.Field")],Rl);const GG=Rl;var QX;let gC=QX=class extends Se{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new QX({mapLayerId:t,gdbVersion:e})}};h([Ot({mapLayer:"map-layer"})],gC.prototype,"type",void 0),h([p({type:Xi,json:{write:!0}})],gC.prototype,"mapLayerId",void 0),h([p({type:String,json:{write:!0}})],gC.prototype,"gdbVersion",void 0),gC=QX=h([I("esri.layers.support.source.MapLayerSource")],gC);var KX;let i0=KX=class extends Se{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:i,spatialReference:r,geometryType:s}=this,n={workspaceId:t,query:e,oidFields:i,spatialReference:(r==null?void 0:r.clone())??void 0,geometryType:s};return new KX(n)}};h([Ot({queryTable:"query-table"})],i0.prototype,"type",void 0),h([p({type:String,json:{write:!0}})],i0.prototype,"workspaceId",void 0),h([p({type:String,json:{write:!0}})],i0.prototype,"query",void 0),h([p({type:String,json:{write:!0}})],i0.prototype,"oidFields",void 0),h([p({type:Ze,json:{write:!0}})],i0.prototype,"spatialReference",void 0),h([Ot(vCe)],i0.prototype,"geometryType",void 0),i0=KX=h([I("esri.layers.support.source.QueryTableDataSource")],i0);var eJ;let yC=eJ=class extends Se{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new eJ({workspaceId:t,dataSourceName:e})}};h([Ot({raster:"raster"})],yC.prototype,"type",void 0),h([p({type:String,json:{write:!0}})],yC.prototype,"dataSourceName",void 0),h([p({type:String,json:{write:!0}})],yC.prototype,"workspaceId",void 0),yC=eJ=h([I("esri.layers.support.source.RasterDataSource")],yC);var tJ;let Px=tJ=class extends Se{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:i}=this;return new tJ({workspaceId:t,gdbVersion:e,dataSourceName:i})}};h([Ot({table:"table"})],Px.prototype,"type",void 0),h([p({type:String,json:{write:!0}})],Px.prototype,"workspaceId",void 0),h([p({type:String,json:{write:!0}})],Px.prototype,"gdbVersion",void 0),h([p({type:String,json:{write:!0}})],Px.prototype,"dataSourceName",void 0),Px=tJ=h([I("esri.layers.support.source.TableDataSource")],Px);var iJ,rJ;const cat=Kl()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let Ku=iJ=class extends Se{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,i){return Xde()(t,e,i)}castLeftTableSource(t){return Gf(sJ(),t)}readRightTableSource(t,e,i){return Xde()(t,e,i)}castRightTableSource(t){return Gf(sJ(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:i,rightTableSource:r,joinType:s}=this,n={leftTableKey:t,rightTableKey:e,leftTableSource:(i==null?void 0:i.clone())??void 0,rightTableSource:(r==null?void 0:r.clone())??void 0,joinType:s};return new iJ(n)}};h([Ot({joinTable:"join-table"})],Ku.prototype,"type",void 0),h([p({type:String,json:{write:!0}})],Ku.prototype,"leftTableKey",void 0),h([p({type:String,json:{write:!0}})],Ku.prototype,"rightTableKey",void 0),h([p({json:{write:!0}})],Ku.prototype,"leftTableSource",void 0),h([ze("leftTableSource")],Ku.prototype,"readLeftTableSource",null),h([Kt("leftTableSource")],Ku.prototype,"castLeftTableSource",null),h([p({json:{write:!0}})],Ku.prototype,"rightTableSource",void 0),h([ze("rightTableSource")],Ku.prototype,"readRightTableSource",null),h([Kt("rightTableSource")],Ku.prototype,"castRightTableSource",null),h([Ot(cat)],Ku.prototype,"joinType",void 0),Ku=iJ=h([I("esri.layers.support.source.JoinTableDataSource")],Ku);let b8=null;function Xde(){return b8||(b8=VP({types:sJ()})),b8}let w8=null;function sJ(){return w8||(w8={key:"type",base:null,typeMap:{"data-layer":nf,"map-layer":gC}}),w8}const uat={key:"type",base:null,typeMap:{"join-table":Ku,"query-table":i0,raster:yC,table:Px}};let nf=rJ=class extends Se{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new rJ({fields:t,dataSource:e})}};h([Ot({dataLayer:"data-layer"})],nf.prototype,"type",void 0),h([p({type:[GG],json:{write:!0}})],nf.prototype,"fields",void 0),h([p({types:uat,json:{write:!0}})],nf.prototype,"dataSource",void 0),nf=rJ=h([I("esri.layers.support.source.DataLayerSource")],nf),nf.from=Qs(nf);let Ox=class extends Jr(Se){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};h([p({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.onFields!=null&&this.onFields.length>0}}}}})],Ox.prototype,"onFields",void 0),h([p({type:String,json:{write:!0}})],Ox.prototype,"operator",void 0),h([p({type:String,json:{write:!0}})],Ox.prototype,"searchTerm",void 0),h([p({type:String,json:{write:!0}})],Ox.prototype,"searchType",void 0),Ox=h([I("esri.rest.support.FullTextSearch")],Ox);const hat=Ox;var nJ;const Jde=new Ji({upperLeft:"upper-left",lowerLeft:"lower-left"});let Rx=nJ=class extends Se{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new nJ(ie({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};h([p({type:ur,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Rx.prototype,"extent",void 0),h([p({type:["view","edit"],json:{write:!0}})],Rx.prototype,"mode",void 0),h([p({type:String,json:{read:Jde.read,write:Jde.write}})],Rx.prototype,"originPosition",void 0),h([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Rx.prototype,"tolerance",void 0),Rx=nJ=h([I("esri.rest.support.QuantizationParameters")],Rx);const dat=Rx,pat=new Ji({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});var oJ;const Qde=new Ji({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let kp=oJ=class extends Se{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=ie(t))}clone(){return new oJ({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:ie(this.statisticParameters)})}};h([p({type:Number,json:{write:!0}})],kp.prototype,"maxPointCount",void 0),h([p({type:Number,json:{write:!0}})],kp.prototype,"maxRecordCount",void 0),h([p({type:Number,json:{write:!0}})],kp.prototype,"maxVertexCount",void 0),h([p({type:String,json:{write:!0}})],kp.prototype,"onStatisticField",void 0),h([p({type:String,json:{write:!0}})],kp.prototype,"outStatisticFieldName",void 0),h([p({type:String,json:{read:{source:"statisticType",reader:Qde.read},write:{target:"statisticType",writer:Qde.write}}})],kp.prototype,"statisticType",void 0),h([p({type:Object})],kp.prototype,"statisticParameters",void 0),h([We("statisticParameters")],kp.prototype,"writeStatisticParameters",null),kp=oJ=h([I("esri.rest.support.StatisticDefinition")],kp);const lRe=kp;var tU;const fat=new Ji({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Yt=tU=class extends Se{static from(t){return OS(tU,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const i={};for(const r in t){const s=t[r];Array.isArray(s)?i[r]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?i[r]=s.getTime():i[r]=s}e.parameterValues=i}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new tU(ie({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment!=null?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};Yt.MAX_MAX_RECORD_COUNT_FACTOR=5,h([p({json:{write:!0}})],Yt.prototype,"aggregateIds",void 0),h([p({type:Boolean,json:{write:!0}})],Yt.prototype,"cacheHint",void 0),h([p({type:Boolean,json:{default:!1,write:!0}})],Yt.prototype,"compactGeometryEnabled",void 0),h([p({json:{write:!0}})],Yt.prototype,"datumTransformation",void 0),h([Kt("datumTransformation")],Yt.prototype,"castDatumTransformation",null),h([p({type:Boolean,json:{default:!1,write:!0}})],Yt.prototype,"defaultSpatialReferenceEnabled",void 0),h([p({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],Yt.prototype,"distance",void 0),h([p({type:nf,json:{write:!0}})],Yt.prototype,"dynamicDataSource",void 0),h([p({type:String,json:{write:!0}})],Yt.prototype,"formatOf3DObjects",void 0),h([p({type:[hat],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.fullText!=null&&this.fullText.length>0}}}}})],Yt.prototype,"fullText",void 0),h([p({type:String,json:{write:!0}})],Yt.prototype,"gdbVersion",void 0),h([p({types:y2,json:{read:ty,write:!0}})],Yt.prototype,"geometry",void 0),h([p({type:Number,json:{write:!0}})],Yt.prototype,"geometryPrecision",void 0),h([p({type:[String],json:{write:!0}})],Yt.prototype,"groupByFieldsForStatistics",void 0),h([p({type:String,json:{write:!0}})],Yt.prototype,"having",void 0),h([p({type:Date})],Yt.prototype,"historicMoment",void 0),h([We("historicMoment")],Yt.prototype,"writeHistoricMoment",null),h([p({type:Number,json:{write:!0}})],Yt.prototype,"maxAllowableOffset",void 0),h([p({type:Number,cast:t=>t<1?1:t>Yt.MAX_MAX_RECORD_COUNT_FACTOR?Yt.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],Yt.prototype,"maxRecordCountFactor",void 0),h([p({type:["xyFootprint"],json:{write:!0}})],Yt.prototype,"multipatchOption",void 0),h([p({type:Number,json:{read:{source:"resultRecordCount"}}})],Yt.prototype,"num",void 0),h([p({json:{write:!0}})],Yt.prototype,"objectIds",void 0),h([p({type:[String],json:{write:!0}})],Yt.prototype,"orderByFields",void 0),h([p({type:[String],json:{write:!0}})],Yt.prototype,"outFields",void 0),h([p({type:Ze,json:{name:"outSR",write:!0}})],Yt.prototype,"outSpatialReference",void 0),h([p({type:[lRe],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.outStatistics!=null&&this.outStatistics.length>0}}}}})],Yt.prototype,"outStatistics",void 0),h([p({json:{write:!0}})],Yt.prototype,"parameterValues",void 0),h([We("parameterValues")],Yt.prototype,"writeParameterValues",null),h([p({type:bt,json:{write:!0}})],Yt.prototype,"pixelSize",void 0),h([p({type:dat,json:{write:!0}})],Yt.prototype,"quantizationParameters",void 0),h([p({type:[Object],json:{write:!0}})],Yt.prototype,"rangeValues",void 0),h([p({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],Yt.prototype,"relationParameter",void 0),h([p({type:String,json:{write:!0}})],Yt.prototype,"resultType",void 0),h([p({type:Boolean,json:{default:!1,write:!0}})],Yt.prototype,"returnCentroid",void 0),h([p({type:Boolean,json:{default:!1,write:!0}})],Yt.prototype,"returnDistinctValues",void 0),h([p({type:Boolean,json:{default:!0,write:!0}})],Yt.prototype,"returnExceededLimitFeatures",void 0),h([p({type:Boolean,json:{write:!0}})],Yt.prototype,"returnGeometry",void 0),h([p({type:Boolean,json:{default:!1,write:!0}})],Yt.prototype,"returnQueryGeometry",void 0),h([p({type:Boolean,json:{default:!1,write:!0}})],Yt.prototype,"returnM",void 0),h([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Yt.prototype,"returnZ",void 0),h([p({type:Ze,json:{write:!0}})],Yt.prototype,"sourceSpatialReference",void 0),h([Ot(pat,{ignoreUnknown:!1,name:"spatialRel"})],Yt.prototype,"spatialRelationship",void 0),h([p({type:Number,json:{read:{source:"resultOffset"}}})],Yt.prototype,"start",void 0),h([We("start"),We("num")],Yt.prototype,"writeStart",null),h([p({type:String,json:{write:!0}})],Yt.prototype,"sqlFormat",void 0),h([p({type:String,json:{write:!0}})],Yt.prototype,"text",void 0),h([p({type:$a,json:{write:!0}})],Yt.prototype,"timeExtent",void 0),h([p({type:Boolean,json:{default:!1,write:!0}})],Yt.prototype,"timeReferenceUnknownClient",void 0),h([Ot(fat,{ignoreUnknown:!1}),p({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],Yt.prototype,"units",void 0),h([p({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],Yt.prototype,"where",void 0),h([We("where")],Yt.prototype,"writeWhere",null),Yt=tU=h([I("esri.rest.support.Query")],Yt);const Lh=Yt;function vF(t){return!!(t!=null&&typeof t=="object"&&"createQuery"in t&&t.createQuery&&"on"in t&&t.on)}let r0=class extends Us.EventedAccessor{constructor(e){super(e),this._selectionMap=new Kk,this._sources=new st,this._trashCan=[],this._layerEditHandles=new st,this._vizTaskId=0,this.showHighlight=!0}initialize(){this.addHandles([te(()=>[this.view,this.showHighlight],()=>this._refreshVisualization()),Ks(()=>this.sources,"change",i=>{const r=this._selectionMap;for(const s of i.removed)r.delete(s);this._refreshListeners(),this._refreshVisualization()},{onListenerAdd:()=>this._refreshListeners()})]);const e=new st;this.view.when().then(()=>{this.view.map&&(this.view.map.allLayers.flatten(i=>"sublayers"in i&&i.sublayers?i.sublayers:null).forEach(i=>{(vF(i)&&!SZe(i)||ux(i))&&e.add(i)}),this.sources=e)})}destroy(){this._layerEditHandles.drain($r)}get selections(){return Array.from(this._selectionMap.entries()).map(e=>{const[i,r]=e;return{layer:i,selection:[...r.selection]}})}get count(){let e=0;for(const i of this._selectionMap.values())e+=i.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._sources}set sources(e){Kg(e,this._sources)}async getSelectedFeatures(e,i={},r="layerView"){const{view:s,selections:n}=this,o=(e!==void 0?n.filter(a=>e.includes(a.layer)):n).filter(a=>a.selection.length>0).map(async a=>{const{layer:l,selection:c}=a,u=ux(l)?l.parent:l;if(u==null||!epe(u))return null;if(r==="layer")return tpe(u,c,i);if(Kde(u))return null;const d=await s.whenLayerView(u).catch(()=>null);return d?tpe(d,c,i):null});return(await Promise.all(o)).filter(a=>a!=null)}updateSelection(e){const i=new Map;for(const[n,o]of this._selectionMap)i.set(n,[...o.selection]);let r=!1;const s=e.current.concat(e.added);for(const n of s){const o=n.sourceLayer,a=n.getObjectId();if(this.sources.includes(o)&&(vF(o)||ux(o))&&a!==null){const l=cD(i,o,()=>[]);l.includes(a)||(l.push(a),r=!0)}}for(const n of e.removed){const o=n.sourceLayer,a=n.getObjectId();if(this.sources.includes(o)&&(vF(o)||ux(o))&&a!==null){const l=i.get(o),c=l==null?void 0:l.indexOf(a);c!==void 0&&c>=0&&(l==null||l.splice(c,1),r=!0)}}if(r){const{_selectionMap:n,_trashCan:o}=this,a=[];for(const[l,c]of i){const u=n.get(l);u!==void 0&&o.push(u),n.set(l,{selection:c}),a.push({layer:l,selection:c,...bW(u!==void 0?u.selection:[],c)})}this._onSelectionChange(a)}}setSelection(e,i){this._setSelection(e,i)}getSelection(e){const i=this._selectionMap.get(e);return i==null?void 0:i.selection}appendToSelection(e,i){const r=this._selectionMap.get(e),s=r!==void 0?[...r.selection]:[];for(const n of i)s.includes(n)||s.push(n);this._setSelection(e,s)}removeFromSelection(e,i){const r=this._selectionMap.get(e);if(!r)return;const s=[];for(const n of r.selection)i.includes(n)||s.push(n);this._setSelection(e,s)}toggleInSelection(e,i){const r=this._selectionMap.get(e);if(!r||r.selection.length===0)return void this._setSelection(e,i);const s=new Set(r.selection),n=new Set(i),o=t9e(s,n);this._setSelection(e,Array.from(o))}clear(){const e=this._selectionMap.values();this._trashCan.push(...e);const i=[];for(const[r,s]of this._selectionMap.entries())i.push({layer:r,added:[],removed:[...s.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(i)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){var o;if(this.view==null||this.sources==null)return;for(this._vizTaskId++;this._trashCan.length>0;){const a=this._trashCan.pop();(o=a==null?void 0:a.highlightHandle)==null||o.remove()}const{sources:e,view:i,_selectionMap:r,showHighlight:s}=this,n=this._vizTaskId;for(const a of e){const l=r.get(a),c=ux(a)?a.parent:a;if(c!=null&&epe(c)){if(Kde(c))continue;i.whenLayerView(c).then(u=>{var d;(d=l==null?void 0:l.highlightHandle)==null||d.remove(),l!=null&&s&&n===this._vizTaskId&&"highlight"in u&&typeof u.highlight=="function"&&l.selection.length>0&&(l.highlightHandle=u.highlight(l.selection,"selection"))}).catch(()=>{var u;(u=l==null?void 0:l.highlightHandle)==null||u.remove()})}}}_refreshListeners(){this._layerEditHandles.drain($r);for(const e of this.sources){const i=ux(e)?e.parent:e;if(i!=null&&vF(i)){const r=i.on("edits",s=>{this._handleEditChanges(s,e)});this._layerEditHandles.push(r)}}}_handleEditChanges(e,i){if(e.deletedFeatures!==void 0&&e.deletedFeatures.length>0&&this._selectionMap.has(i)){const r=e.deletedFeatures.filter(s=>s.error==null).map(s=>s.objectId).filter(op);this.removeFromSelection(i,r)}}_setSelection(e,i){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);const r=this._selectionMap.get(e);if(r===void 0||!gat(r,{selection:i})){r!==void 0&&this._trashCan.push(r),this._selectionMap.set(e,{selection:[...i]});const s={layer:e,selection:[...i],...bW(r!==void 0?r.selection:[],i)};this._onSelectionChange([s])}}};h([p({readOnly:!0,nonNullable:!0})],r0.prototype,"selections",null),h([p({readOnly:!0,nonNullable:!0})],r0.prototype,"count",null),h([p({constructOnly:!0,nonNullable:!0})],r0.prototype,"view",void 0),h([p({readOnly:!0,nonNullable:!0})],r0.prototype,"hasSelection",null),h([p()],r0.prototype,"showHighlight",void 0),h([p()],r0.prototype,"sources",null),r0=h([I("esri.views.SelectionManager")],r0);const Kde=t=>{var e;return ux(t)?((e=t.parent)==null?void 0:e.isTable)===!0:t.isTable},mat=t=>t.layer!==void 0,epe=t=>(t==null?void 0:t.when)!==void 0,gat=(t,e)=>{if(t==null&&e==null)return!0;if(t!=null&&e==null||t==null&&e!=null)return!1;if(t!=null&&e!=null&&t.selection!=null&&e.selection!=null){const i=[...t.selection],r=[...e.selection];if(i.length!==r.length)return!1;i.sort(),r.sort();for(let s=0;s<i.length;s++)if(i[s]!==r[s])return!1}return!0},tpe=async(t,e,i={})=>{let r;if(mat(t)){const s=t;r=s===void 0?null:await s.queryFeatures(new Lh({...i,objectIds:e})).then(n=>({data:n,layer:t.layer}))}else{const s=t;r=s===void 0?null:await s.queryFeatures(new Lh({...i,objectIds:e})).then(n=>({data:n,layer:s}))}return r},yat=r0;let S$=class extends Jr(Ue){constructor(e){super(e),this.accentColor=new Qe([255,127,0]),this.textColor=new Qe([255,255,255])}};h([p({type:Qe,nonNullable:!0})],S$.prototype,"accentColor",void 0),h([p({type:Qe,nonNullable:!0})],S$.prototype,"textColor",void 0),S$=h([I("esri.views.Theme")],S$);const aJ=S$;var ipe;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(ipe||(ipe={}));const cRe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],uRe={};function hRe(t){return!!uRe[t]}function _at(t){for(const e of t)if(!hRe(e))return!1;return!0}cRe.forEach(t=>{uRe[t]=!0});let vat=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:i,priority:r},s)=>{var n;return(n=this.inputManager)==null?void 0:n.installHandlers(s,[i],r)})}disconnect(){this.inputManager&&this._handlers.forEach((e,i)=>{var r;return(r=this.inputManager)==null?void 0:r.uninstallHandlers(i)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,i,r,s){const n=Array.isArray(e)?e:e.split(",");if(!_at(n))return n.some(hRe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(i)?a=i:(o=i,a=[]),typeof r=="function"?o=r:s=r,s=s??ib.DEFAULT;const l=this._createUniqueGroupName(),c=new bat(this.view,n,a,o);this._handlers.set(l,{handler:c,priority:s});for(const u of n){const d=this._handlerCounts.get(u)||0;this._handlerCounts.set(u,d+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),Gi(()=>this._removeHandler(l,n))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,i){if(this._handlers.has(e)){this._handlers.delete(e);for(const r of i){const s=this._handlerCounts.get(r);s===void 0||(s===1?this._handlerCounts.delete(r):this._handlerCounts.set(r,s-1))}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},bat=class extends ha{constructor(e,i,r,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of i)switch(n){case"click":this.registerIncoming("click",r,o=>s(Tat(e,o)));break;case"double-click":this.registerIncoming("double-click",r,o=>s(Sat(e,o)));break;case"immediate-click":this.registerIncoming("immediate-click",r,o=>s(Eat(e,o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,o=>s(Cat(e,o)));break;case"hold":this.registerIncoming("hold",r,o=>s(Mat(e,o)));break;case"drag":this.registerIncoming("drag",r,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",r,o=>s(Aat(o)));break;case"key-up":this.registerIncoming("key-up",r,o=>s(Pat(o)));break;case"pointer-down":this.registerIncoming("pointer-down",r,o=>s(qO(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,o=>s(qO(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,o=>s(qO(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,o=>s(Oat(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,o=>s(Rat(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,o=>s(qO(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,o=>s(qO(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,o=>{s($at(o))});break;case"focus":this.registerIncoming("focus",r,o=>{s(wat(o))});break;case"blur":this.registerIncoming("blur",r,o=>{s(xat(o))})}}_wrapDrag(e){const i=e.data,{x:r,y:s}=i.center,{action:n,pointerType:o,button:a}=i;if(n==="start"&&(this._latestDragStart=i),!this._latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:u,timestamp:d}=e,f={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:r,y:s,origin:f,pointerType:o,button:a,buttons:c,radius:i.radius,angle:La(i.angle),native:l,timestamp:d,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}};function wat(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function xat(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function Tat(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:u,screenPoint:ep(n,o),mapPoint:ID(t,n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}function Sat(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"double-click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:u,mapPoint:ID(t,n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}function Eat(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:d}=e;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:ID(t,n,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}function Cat(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:d}=e;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:ID(t,n,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}function Mat(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:ID(t,n,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}function ID(t,e,i){return t.toMap(ep(e,i),{exclude:[]})}function Aat(t){const{key:e,repeat:i,native:r}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-down",key:e,repeat:i,native:r,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}function Pat(t){const{key:e,native:i}=t.data,{cancelable:r,timestamp:s}=t;return{type:"key-up",key:e,native:i,timestamp:s,cancelable:r,stopPropagation:()=>t.stopPropagation(),async:n=>t.async(n),preventDefault:()=>t.preventDefault()}}function qO(t,e){const{x:i,y:r,button:s,buttons:n,native:o,eventId:a}=t.data,l=o.pointerId,c=o.pointerType,{cancelable:u,timestamp:d}=t;return{type:e,x:i,y:r,pointerId:l,pointerType:c,button:s,buttons:n,native:o,timestamp:d,eventId:a,cancelable:u,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}function Oat(t){const{x:e,y:i,buttons:r,native:s,eventId:n}=t.data.currentEvent,{button:o}=t.data.startEvent,a=t.data.startEvent.native.pointerId,l=t.data.startEvent.native.pointerType,c=t.data.action,u={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:d,timestamp:f}=t;return{type:"pointer-drag",x:e,y:i,pointerId:a,pointerType:l,button:o,buttons:r,action:c,origin:u,native:s,timestamp:f,eventId:n,cancelable:d,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}function Rat(t){const{cancelable:e,data:i,timestamp:r}=t,{x:s,y:n,deltaY:o,native:a}=i;return{type:"mouse-wheel",x:s,y:n,deltaY:o,native:a,timestamp:r,cancelable:e,stopPropagation:()=>t.stopPropagation(),async:l=>t.async(l),preventDefault:()=>t.preventDefault()}}function $at(t){const{action:e,state:i,device:r}=t.data,{cancelable:s,timestamp:n}=t,{buttons:o,axes:a}=i;return{type:"gamepad",device:r,timestamp:n,action:e,buttons:o,axes:a,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:l=>t.async(l),preventDefault:()=>t.preventDefault()}}var _L,rpe,spe;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(_L||(_L={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(rpe||(rpe={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(spe||(spe={}));function Iat(t){return[t.on("before-add",e=>{const i=e.item;if(i==null||t.includes(i))return se.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();i.onAdd()}),t.on("after-remove",e=>{const i=e.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function lJ(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(_L.USER)&&t.getEditableFlag(_L.MANAGER)}function Gm(t){return ep(t.x,t.y)}function YWt(t){return Ss(t.x,t.y)}function dRe(t,e){var r;const i=(r=t instanceof HTMLElement?t:t.surface)==null?void 0:r.getBoundingClientRect();return i?ep(e.clientX-i.left,e.clientY-i.top):ep(0,0)}function npe(t,e){return e instanceof Event?dRe(t,e):Gm(e)}function ope(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let Lat=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,i){const r=()=>e.stopPropagation();switch(e.type){case"pointer-move":lpe(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!cpe(e))break;const s=Gm(e),n=Y2(s,e.pointerType,i.forEachTool);if(n==null)break;const o=n.manipulator,a=n.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._releaseManipulatorBeforeDragging(o,e,i),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&i.activeTool==null&&(this._revertToNullActiveTool=!0,i.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),r());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,i);break;case"pointer-drag":{if(!cpe(e))break;const s=this._grabbedManipulators.get(e.pointerId),n=s==null?void 0:s.manipulator,o=s==null?void 0:s.tool;if(n==null||o==null)break;const a=Gm(e);a.x=Ne(a.x,0,i.view.width),a.y=Ne(a.y,0,i.view.height);const l=s.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,i)}r();break}case"immediate-click":{const s=Gm(e),n=Y2(s,e.pointerType,i.forEachTool);if(Dat(e)||i.forEachTool(c=>{if((n==null||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let u=!1;c.manipulators.forEach(({manipulator:d})=>{d.selected&&(d.selected=!1,u=!0)}),u&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),n==null)break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:r}),x8(o,r);break}case"click":{const s=Gm(e),n=Y2(s,e.pointerType,i.forEachTool),o=n==null?void 0:n.manipulator;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a}),r();break}case"double-click":{const s=Gm(e),n=Y2(s,e.pointerType,i.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r}),x8(o,r);break}case"immediate-double-click":{const s=Gm(e),n=Y2(s,e.pointerType,i.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r}),x8(o,r);break}}this._onFocusChange(i.forEachTool)}_releaseManipulatorBeforeDragging(e,i,r){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:Gm(i)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===e&&this._grabbedManipulators.delete(n)}),this._afterManipulatorRelease(r.setActiveTool)}_handlePointerEnd(e,i){var s;const r=(s=this._grabbedManipulators.get(e.pointerId))==null?void 0:s.manipulator;r!=null&&r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:Gm(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorRelease(i.setActiveTool))}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=ape(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=ape(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const i=new Set,r=new Set;this._grabbedManipulators.forEach(({tool:s})=>{i.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{r.add(s)}),e(s=>{s.hasGrabbedManipulators=i.has(s),s.hasHoveredManipulators=r.has(s);const n=this._grabbedManipulators.values(),o=_qe(n,({tool:a})=>a===s);s.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:i,setActiveTool:r},s=!0,n){const o=(a,l)=>a===e&&(n==null||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},u)=>{o(a,l)&&(this._grabbedManipulators.delete(u),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorRelease(r),this._onFocusChange(i)}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(ep(i.x,i.y),r,i.pointerType,e)})}handleHoverEvent(e,i){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!lpe(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(Gm(e),e.pointerId,e.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(e,i,r,s){var a;let n=Y2(e,r,s);const o=(a=this._hoveredManipulators.get(i))==null?void 0:a.manipulator;n==null||n.manipulator.interactive||(n=null),n!=null&&o===n.manipulator||(o!=null&&(o.hovering=!1),n!=null?(n.manipulator.hovering=!0,this._hoveredManipulators.set(i,n)):this._hoveredManipulators.delete(i),this._onFocusChange(s))}_afterManipulatorRelease(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function ape(t){let e=null;return Eh(t,({manipulator:i})=>!(i==null||!i.interactive)&&(i.grabbing&&i.grabCursor?(e=i.grabCursor,!0):!!i.cursor&&(e=i.cursor,!0))),e}function Y2(t,e,i){let r=null;return i(s=>{if(s.manipulators==null||!lJ(s))return!1;const n=s.manipulators.intersect(t,e);return n!=null&&(r={tool:s,manipulator:n},!0)}),r}function lpe(t){return t==="mouse"}function cpe(t){return t.pointerType!=="mouse"||t.button===0}function Dat(t){return!!t.native.shiftKey}function x8(t,e){t!=null&&t.consumesClicks&&e()}const upe="attached",T8="tools",Nat=1e3;let Hm=class extends Ue{constructor(e){super(e),this._updatingHandles=new Z0,this._clock=nD,this._manipulatorState=new Lat,this.tools=new st,this.cursor=null,this._interacting=!1,this._interactingTimeout=Nat,this._interactingTimeoutHandle=null,this._forEachTool=i=>{for(const r of this.tools.items)if(i(r))return}}initialize(){this.addHandles([this.view.on(cRe,e=>{this._handleInputEvent(e)},ib.TOOL),...Iat(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void se.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const i=this.activeTool;this._set("activeTool",e),i!=null&&i.deactivate(),e!=null&&e.activate(),this._removeIncompleteTools(e);for(const r of this.tools){this._updateToolEditableFlag(r);const s=lJ(r);this.activeTool!=null&&s||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=$r(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){var e;this.view.type==="3d"?this.addHandles([te(()=>{const{state:i}=this.view;return"camera"in i&&i.camera},()=>this._forEachManipulator(i=>i.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",i=>this._forEachManipulator(r=>r.onElevationChange(i)))],upe):this.addHandles(te(()=>this.view.extent,()=>this._forEachManipulator(i=>i.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(upe),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(i=>{i.manipulators&&i.manipulators.forEach(({manipulator:r})=>e(r,i))})}_handleInputEvent(e){let i=!1;const r={...e,stopPropagation:()=>{i=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool(s=>{!i&&s.visible&&s.handleInputEvent(r)}),!i&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),i||this.activeTool==null||this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(T8),this._forEachTool(e=>{if(e instanceof Ue){const i=te(()=>[e.cursor,e.visible,e.editable],()=>{lJ(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(i,T8)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",i=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,i.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],T8)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var i;(i=e.setEditableFlag)==null||i.call(e,_L.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(i=>!(i.cursor==null||!i.visible)&&(e=i.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(i=>(e==null||i!==e)&&!i.created&&i.removeIncompleteOnCancel).forEach(i=>{this.tools.remove(i)})}get test(){}};h([p({constructOnly:!0,nonNullable:!0})],Hm.prototype,"view",void 0),h([p({value:null})],Hm.prototype,"activeTool",null),h([p({readOnly:!0,type:st})],Hm.prototype,"tools",void 0),h([p({readOnly:!0})],Hm.prototype,"cursor",void 0),h([p({readOnly:!0})],Hm.prototype,"updating",null),h([p()],Hm.prototype,"_interacting",void 0),h([p({readOnly:!0})],Hm.prototype,"interacting",null),Hm=h([I("esri.views.ToolViewManager")],Hm);let _C=class extends Ue{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":Fat.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return kat[this.deviceType]}};h([p({nonNullable:!0,readOnly:!0})],_C.prototype,"nativeIndex",void 0),h([p({type:String,readOnly:!0})],_C.prototype,"deviceType",null),h([p({type:Number,readOnly:!0})],_C.prototype,"axisThreshold",null),_C=h([I("esri.views.input.gamepad.GamepadInputDevice")],_C);const Dse=_C,Fat=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),kat={standard:.15,spacemouse:.025,unknown:0};let E$=class extends Ue{constructor(...e){super(...e),this.devices=new st,this.enabledFocusMode="document"}};h([p({type:st.ofType(Dse),readOnly:!0})],E$.prototype,"devices",void 0),h([p({type:["document","view","none"]})],E$.prototype,"enabledFocusMode",void 0),E$=h([I("esri.views.input.gamepad.GamepadSettings")],E$);const Uat=E$;let iU=class extends Ue{constructor(){super(...arguments),this.gamepad=new Uat}};h([p({readOnly:!0})],iU.prototype,"gamepad",void 0),iU=h([I("esri.views.input.Input")],iU);const Vat=iU,pRe=()=>rr.respectPrefersReducedMotion&&window.matchMedia("(prefers-reduced-motion: reduce)").matches;let Hv=class extends Ue{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};h([p({type:Boolean,nonNullable:!0})],Hv.prototype,"enabled",void 0),h([p({type:Dse})],Hv.prototype,"device",void 0),h([p({type:["pan","zoom"],nonNullable:!0})],Hv.prototype,"mode",void 0),h([p({type:["forward-down","forward-up"],nonNullable:!0})],Hv.prototype,"tiltDirection",void 0),h([p({type:Number,nonNullable:!0})],Hv.prototype,"velocityFactor",void 0),Hv=h([I("esri.views.navigation.gamepad.GamepadSettings")],Hv);const fRe=Hv;let $x=class extends Ue{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new fRe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}get effectiveMomentumEnabled(){return this.momentumEnabled&&!pRe()}};h([p({type:Boolean})],$x.prototype,"browserTouchPanEnabled",void 0),h([p({type:fRe,nonNullable:!0})],$x.prototype,"gamepad",void 0),h([p({type:Boolean})],$x.prototype,"momentumEnabled",void 0),h([p({type:Boolean})],$x.prototype,"mouseWheelZoomEnabled",void 0),$x=h([I("esri.views.navigation.Navigation")],$x);const mRe=$x;let cJ,S8=null;async function zat(t){S8||(S8=ce(()=>Promise.resolve().then(()=>o$t),void 0).then(e=>cJ=e)),await S8,Dt(t)}async function gRe(t,e,i,r){if(!t)return null;const s=t.spatialReference;return HP()||Bc(s,e)?b_(t,e):cJ?cJ.projectGeometry(t,e,i,r):(await Promise.race([zat(r),HA(r)]),gRe(t,e,i,r))}let ps=class extends Ue{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Jl(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference??this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var r,s,n,o;const e=(r=this.map)==null?void 0:r.call(this),i=[];return this.priorityCollection!=null&&i.push(this.priorityCollection),i.push({parent:e==null?void 0:e.basemap,layers:(s=e==null?void 0:e.basemap)==null?void 0:s.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(n=e==null?void 0:e.ground)==null?void 0:n.layers},{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.referenceLayers}),i}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;let r=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(r,o);a!=null&&(r=a)}if(r!=null&&r.length===1)break}if(i&&(r==null||r.length!==1))return{updating:!0};const s=this._pickSpatialReferenceCandidate(r);return{spatialReference:(s==null?void 0:s.spatialReference)??null,viewingMode:(s==null?void 0:s.viewingMode)??null,updating:!1}}get _tileInfoTask(){var r,s,n,o,a,l,c;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:i}=this._collectLayers([{parent:(s=(r=this.map)==null?void 0:r.call(this))==null?void 0:s.basemap,layers:(a=(o=(n=this.map)==null?void 0:n.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const u=e[0].tileInfo;return{tileInfo:u!=null&&u.spatialReference.equals(this.spatialReference)?u:null,updating:!1}}return{updating:i}}get _heightModelInfoTask(){var r,s,n;if(!this.required.heightModelInfo||this.suspended&&((r=this._get("_heightModelInfoTask"))!=null&&r.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;for(const o of e)if(SJe(o)){const a=KCe(o);if(a)return{heightModelInfo:a,vcsWkid:(s=o.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=o.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:i}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,i=e.updating,r=[];for(const s of e.layers){const n="fullExtents"in s&&s.fullExtents||(s.fullExtent!=null?[s.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:n[0],a=n.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0)for(const l of n)r.push({extent:l,layer:s})}return{candidates:r,updating:i}}get _extentTask(){const{candidates:e,updating:i}=this._extentCandidatesTask;if(i)return{updating:i};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),s=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=Jl(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:s.clone(),task:uy(async n=>{try{const o=await gRe(r.extent,s,"portalItem"in r.layer?r.layer.portalItem:void 0,n);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(ra(n))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,i){if(e==null)return i;const r=new Array;for(const s of e)for(const n of i){if(!s.spatialReference.equals(n.spatialReference))continue;const o=jat(s.viewingMode,n.viewingMode);if(o!==!1){r.push({spatialReference:s.spatialReference,viewingMode:o});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const i=this.defaultSpatialReference;return e==null||e.length<1?i?{spatialReference:i,viewingMode:null}:null:(i!=null&&e.length>1&&e.some(({spatialReference:r})=>r.equals(i))&&(e=e.filter(({spatialReference:r})=>r.equals(i))),e.length>1&&e.some(({viewingMode:r})=>r!==Xe.Local)&&(e=e.filter(({viewingMode:r})=>r!==Xe.Local)),e[0])}_getSupportedSpatialReferences(e){const i="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(i.length===0)return[];const r=[];for(const s of i){const n=this.getSpatialReferenceSupport(s,e);if(n!=null){const o=n.constraints??[{spatialReference:s,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||r.push({spatialReference:a,viewingMode:l})}}return r}_pickExtentCandidate(e){const i=this.spatialReference;return e.find(({extent:r})=>i.equals(r.spatialReference))||e[0]}_collectLayers(e){var r;if(this._loadMaybe((r=this.map)==null?void 0:r.call(this))!=="loaded")return{layers:[],updating:!0};const i=new Bat;for(const s of e)if(this._collectCollection(s,i),i.preloading===this.sourcePreloadCount)break;return{layers:i.layers,updating:i.updating}}_collectCollection(e,i){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return i.updating=!0,void++i.preloading;case"failed":return}for(const r of e.layers){switch(this._loadMaybe(r)){case"failed":continue;case"loading":i.updating=!0,++i.preloading;break;case"loaded":i.updating||i.layers.push(r),"layers"in r&&this._collectCollection({layers:r.layers},i)}if(i.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(i=>{os(i)||console.log(i)}),"loading"):e.loadStatus:"loaded"}};h([p()],ps.prototype,"required",void 0),h([p({constructOnly:!0})],ps.prototype,"map",void 0),h([p({constructOnly:!0})],ps.prototype,"getSpatialReferenceSupport",void 0),h([p()],ps.prototype,"defaultSpatialReference",void 0),h([p()],ps.prototype,"userSpatialReference",void 0),h([p()],ps.prototype,"sourcePreloadCount",void 0),h([p()],ps.prototype,"priorityCollection",void 0),h([p()],ps.prototype,"requiresExtentInSpatialReference",void 0),h([p()],ps.prototype,"suspended",void 0),h([p({readOnly:!0})],ps.prototype,"ready",null),h([p({readOnly:!0})],ps.prototype,"heightModelInfoReady",null),h([p({readOnly:!0})],ps.prototype,"spatialReference",null),h([p({readOnly:!0})],ps.prototype,"extent",null),h([p({readOnly:!0})],ps.prototype,"heightModelInfo",null),h([p({readOnly:!0})],ps.prototype,"vcsWkid",null),h([p({readOnly:!0})],ps.prototype,"latestVcsWkid",null),h([p({readOnly:!0})],ps.prototype,"viewingMode",null),h([p({readOnly:!0})],ps.prototype,"tileInfo",null),h([p({readOnly:!0})],ps.prototype,"mapCollections",null),h([p({readOnly:!0})],ps.prototype,"_allLayers",null),h([p({readOnly:!0})],ps.prototype,"_spatialReferenceTask",null),h([p({readOnly:!0})],ps.prototype,"_tileInfoTask",null),h([p({readOnly:!0})],ps.prototype,"_heightModelInfoTask",null),h([p({readOnly:!0})],ps.prototype,"_extentCandidatesTask",null),h([p()],ps.prototype,"_extentTask",null),h([p()],ps.prototype,"_projectExtentTask",void 0),ps=h([I("esri.views.support.DefaultsFromMap")],ps);let Bat=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};function jat(t,e){return t!=null?e!=null?t===e&&t:t:e}var C$;let zt=C$=class extends Us.EventedMixin(dD(Ue)){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.handles=new ly,this.updatingHandles=new Z0,this.allLayerViews=new oL({getCollections:()=>{var e,i,r;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(i=this.groundView)==null?void 0:i.layerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:Hat}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new n3,this.analyses=new JA,this.typeSpecificPreconditionsReady=!0,this.layerViews=new st,this.magnifier=new rRe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Vat,this.navigation=new mRe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new vat(this),this.persistableViewModels=new st,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this.theme=null,this.handles.add(te(()=>this.preconditionsReady,e=>{var r,s;const i=this.ready;if(e?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,C$.views.add(this)):(this._lockedSpatialReference=null,C$.views.remove(this)),this.notifyChange("spatialReference"),!e&&i)(r=this.toolViewManager)==null||r.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),(s=this.layerViewManager)==null||s.clear(),this._teardown();else if(e&&!i){try{this._startup()}catch(n){return void queueMicrotask(()=>{this.fatalError=new G("startup-error",null,n)})}this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach()}},or))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,VS(()=>this.ready)))),this.basemapView=new Gv({view:this}),this.layerViewManager=new nat({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new Hm({view:this}),this._setupSpatialReferenceLogger(),this.selectionManager=new yat({view:this}),this.addHandles([te(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},hr),te(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},or),te(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},hr)])}_setupSpatialReferenceLogger(){let t=null;this.addHandles([te(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var r;const i=((r=this.map)==null?void 0:r.allLayers.length)>0;if(e&&!this.spatialReference&&i){if(t!=null)return;const s=Gi(()=>t=Jl(t));t=uy(async n=>{try{await MS(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{t=null}se.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.addHandles(s,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")},{sync:!0})])}destroy(){var t,e;this.destroyed||(C$.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=qe(this.graphics),this.analyses=qe(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),qe(this.analysisViewManager),this.toolViewManager=qe(this.toolViewManager),this.layerViewManager=qe(this.layerViewManager),this.selectionManager=qe(this.selectionManager),this.basemapView=qe(this.basemapView),(t=this.groundView)==null||t.destroy(),(e=this.layerViews)==null||e.forEach(i=>i.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=qe(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return se.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new ps({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:(t,e)=>this.getSpatialReferenceSupport(t,e),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||ey.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&(se.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),ey.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",t))}get spatialReference(){var e,i;const t=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(t&&((i=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&i.heightModelInfo)){const r=t.clone();return r.vcsWkid=this.defaultsFromMap.vcsWkid,r.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,r}return t}set spatialReference(t){const e=!hs(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??Kd}set timeZone(t){const e=new Set(["etc/utc","etc/gmt","gmt"]),i=new Set(Intl.supportedValuesOf("timeZone").map(r=>r.toLowerCase()));this._userTimeZone=t,t===Kd||t===CS||e.has(t.toLowerCase())||i.has(t.toLowerCase())||se.getLogger(this).warn("#timeZone",`the parsed value '${t}' may not be a valid IANA time zone`)}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){var t;return((t=this.toolViewManager)==null?void 0:t.cursor)??this._cursor??"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new aJ}whenLayerView(t){var e;return((e=this.layerViewManager)==null?void 0:e.whenLayerView(t))??Promise.reject()}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}getDefaultTimeZone(){return null}importLayerView(t){throw new G("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport(t)!=null}when(t,e){return this.isResolved()&&!this.ready&&se.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(No(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};zt.views=new st,h([p()],zt.prototype,"_userSpatialReference",void 0),h([p()],zt.prototype,"activeTool",null),h([p({readOnly:!0})],zt.prototype,"allLayerViews",void 0),h([p()],zt.prototype,"groundView",void 0),h([p()],zt.prototype,"animation",null),h([p()],zt.prototype,"basemapView",void 0),h([p()],zt.prototype,"center",null),h([p({readOnly:!0})],zt.prototype,"_defaultsFromMapSettings",null),h([p()],zt.prototype,"defaultsFromMap",null),h([p()],zt.prototype,"fatalError",void 0),h([p({type:ur})],zt.prototype,"extent",null),h([p(vY(n3,"graphics"))],zt.prototype,"graphics",void 0),h([p(vY(JA,"analyses"))],zt.prototype,"analyses",void 0),h([p({readOnly:!0,type:qb})],zt.prototype,"heightModelInfo",null),h([p({readOnly:!0})],zt.prototype,"interacting",null),h([p({readOnly:!0})],zt.prototype,"navigating",null),h([p({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],zt.prototype,"preconditionsReady",null),h([p({readOnly:!0})],zt.prototype,"typeSpecificPreconditionsReady",void 0),h([p({type:st,readOnly:!0})],zt.prototype,"layerViews",void 0),h([p()],zt.prototype,"resolution",null),h([p({type:rRe})],zt.prototype,"magnifier",void 0),h([p({value:null,type:TCe})],zt.prototype,"map",null),h([p()],zt.prototype,"padding",void 0),h([p({readOnly:!0})],zt.prototype,"ready",void 0),h([p({type:Ze})],zt.prototype,"spatialReference",null),h([p()],zt.prototype,"spatialReferenceWarningDelay",void 0),h([p()],zt.prototype,"stationary",null),h([p({readOnly:!0})],zt.prototype,"supportsGround",void 0),h([p({type:$a})],zt.prototype,"timeExtent",void 0),h([p({type:String,nonNullable:!0})],zt.prototype,"timeZone",null),h([p()],zt.prototype,"tools",null),h([p()],zt.prototype,"toolViewManager",void 0),h([p({readOnly:!0})],zt.prototype,"type",void 0),h([p({type:Number})],zt.prototype,"scale",void 0),h([p({readOnly:!0})],zt.prototype,"updating",void 0),h([p({readOnly:!0})],zt.prototype,"initialExtentRequired",void 0),h([p({readOnly:!0})],zt.prototype,"initialExtent",null),h([p()],zt.prototype,"cursor",null),h([p({readOnly:!0})],zt.prototype,"input",void 0),h([p({type:mRe,nonNullable:!0})],zt.prototype,"navigation",void 0),h([p()],zt.prototype,"layerViewManager",void 0),h([p()],zt.prototype,"analysisViewManager",void 0),h([p()],zt.prototype,"selectionManager",void 0),h([p()],zt.prototype,"width",void 0),h([p()],zt.prototype,"height",void 0),h([p({readOnly:!0})],zt.prototype,"resizing",void 0),h([p({value:null,readOnly:!0})],zt.prototype,"size",null),h([p({readOnly:!0})],zt.prototype,"suspended",void 0),h([p({readOnly:!0})],zt.prototype,"viewEvents",void 0),h([p({readOnly:!0})],zt.prototype,"persistableViewModels",void 0),h([p()],zt.prototype,"_isValid",void 0),h([p()],zt.prototype,"_readyCycleForced",void 0),h([p()],zt.prototype,"_lockedSpatialReference",void 0),h([p()],zt.prototype,"_userTimeZone",void 0),h([p()],zt.prototype,"_lockedTimeZone",void 0),h([p({type:aJ})],zt.prototype,"theme",void 0),h([p({readOnly:!0,type:aJ})],zt.prototype,"effectiveTheme",null),zt=C$=h([I("esri.views.View")],zt);const Gat=zt;function Hat(t){return t.layerViews}let qv=class extends iz{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=aa(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._resolver)==null||e.reject(new G("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._resolver)==null||e.resolve())}update(e,i){i||(i=Fu(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",i)}};h([p({readOnly:!0})],qv.prototype,"done",null),h([p({readOnly:!0,type:String})],qv.prototype,"state",void 0),h([p()],qv.prototype,"target",void 0),qv=h([I("esri.views.ViewAnimation")],qv),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(qv||(qv={}));const aP=qv,WO=()=>ce(()=>import("./TileLayerView3D-pMjJkxjH.js"),__vite__mapDeps([72,73,74,75,76,77,78,79,80,81,82])),hpe=()=>ce(()=>import("./ElevationLayerView3D-B4YKrBKx.js"),__vite__mapDeps([83,4,5,73,74,76])),dpe={"base-dynamic":()=>ce(()=>import("./BaseDynamicLayerView3D-DD93pbuC.js"),__vite__mapDeps([84,85,73,86,87,76,77])),"base-elevation":hpe,"base-tile":WO,"bing-maps":WO,"building-scene":()=>ce(()=>import("./BuildingSceneLayerView3D-DLIRevVf.js"),__vite__mapDeps([88,89,90,91,92,93,60,53,82,26,27,94,95,96,97,59,98,99,100,35,101,102,103,104,105,106,86,107,108,71,109,29,23,24,79,25,18,28,12,13,14,21,22,73,5,110,76,77,111,112,113,58,114,115,116])),catalog:()=>ce(()=>import("./CatalogLayerView3D-D5DnG4ui.js"),__vite__mapDeps([117,73,76])),"catalog-dynamic-group":()=>ce(()=>import("./CatalogDynamicGroupLayerView3D-hPv6GtPT.js"),__vite__mapDeps([118,73,76])),"catalog-footprint":()=>ce(()=>import("./CatalogFootprintLayerView3D-DS9j1GnD.js"),__vite__mapDeps([119,104,105,106,86,107,108,71,109,29,23,24,82,79,25,26,27,18,28,12,13,14,21,22,73,5,110,76,77])),csv:()=>ce(()=>import("./CSVLayerView3D-nueneZFV.js"),__vite__mapDeps([120,104,105,106,86,107,108,71,109,29,23,24,82,79,25,26,27,18,28,12,13,14,21,22,73,5,110,76,77])),dimension:()=>ce(()=>import("./DimensionLayerView3D-BDYRk0D4.js"),__vite__mapDeps([121,73,76])),elevation:hpe,feature:()=>ce(()=>import("./FeatureLayerView3D-CNl96p5-.js"),__vite__mapDeps([103,104,105,106,86,107,108,71,109,29,23,24,82,79,25,26,27,18,28,12,13,14,21,22,73,5,110,76,77])),geojson:()=>ce(()=>import("./GeoJSONLayerView3D-Dcu9rJ4b.js"),__vite__mapDeps([122,104,105,106,86,107,108,71,109,29,23,24,82,79,25,26,27,18,28,12,13,14,21,22,73,5,110,76,77])),graphics:()=>ce(()=>import("./GraphicsLayerView3D-iLVyyKj8.js"),__vite__mapDeps([123,73,108,124,109,29,23,24,82,86,76])),group:()=>ce(()=>import("./GroupLayerView-BaEhI0y_.js"),__vite__mapDeps([125,76])),imagery:()=>ce(()=>import("./ImageryLayerView3D-CeP1BeDz.js"),__vite__mapDeps([126,85,73,86,87,76,77,106,82])),"integrated-mesh":()=>ce(()=>import("./IntegratedMeshLayerView3D-DAgpGKlX.js"),__vite__mapDeps([127,94,95,96,97,59,60,53,98,99,100,35,101,102,103,104,105,106,86,107,108,71,109,29,23,24,82,79,25,26,27,18,28,12,13,14,21,22,73,5,110,76,77,111,112,113,58,114])),"integrated-mesh-3dtiles":()=>ce(()=>import("./IntegratedMesh3DTilesLayerView3D-DcQIw5Tb.js"),__vite__mapDeps([128,95,96,67,73,76])),"line-of-sight":()=>ce(()=>import("./LineOfSightLayerView3D-CBHd9VhA.js"),__vite__mapDeps([129,73,76])),"map-image":()=>ce(()=>import("./MapImageLayerView3D-B7xZUjwW.js"),__vite__mapDeps([130,85,73,86,87,76,77,131,79,81,106,78,80,82])),media:()=>ce(()=>import("./MediaLayerView3D-DdgjB4Wu.js").then(t=>t.M),__vite__mapDeps([132,133,134,73,135,136,137,138,17,139,140,79,87,76])),"ogc-feature":()=>ce(()=>import("./OGCFeatureLayerView3D-DVH01F8K.js"),__vite__mapDeps([141,104,105,106,86,107,108,71,109,29,23,24,82,79,25,26,27,18,28,12,13,14,21,22,73,5,110,76,77])),"open-street-map":WO,"oriented-imagery":()=>ce(()=>import("./FeatureLayerView3D-CNl96p5-.js"),__vite__mapDeps([103,104,105,106,86,107,108,71,109,29,23,24,82,79,25,26,27,18,28,12,13,14,21,22,73,5,110,76,77])),"point-cloud":()=>ce(()=>import("./PointCloudLayerView3D-f2bUINtg.js"),__vite__mapDeps([142,73,5,60,53,51,52,143,82,76])),voxel:()=>ce(()=>import("./VoxelLayerView3D-CHhsqn1u.js"),__vite__mapDeps([144,73,143,82,76])),route:()=>ce(()=>import("./RouteLayerView3D-Kc4DFEjk.js"),__vite__mapDeps([145,146,73,124,109,29,23,24,82,86,110,76])),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?ce(()=>import("./SceneLayerView3D-T7SFetfC.js"),__vite__mapDeps([147,26,27,79,94,95,96,97,59,60,53,98,99,100,35,101,102,103,104,105,106,86,107,108,71,109,29,23,24,82,25,18,28,12,13,14,21,22,73,5,110,76,77,111,112,113,58,114,148,116,115,143])):ce(()=>import("./SceneLayerGraphicsView3D-lMjfTlEh.js"),__vite__mapDeps([149,97,96,59,60,53,98,99,100,35,101,102,103,104,105,106,86,107,108,71,109,29,23,24,82,79,25,26,27,18,28,12,13,14,21,22,73,5,110,76,77,148,116,143])),stream:()=>ce(()=>import("./StreamLayerView3D-BiBX9Ipk.js"),__vite__mapDeps([150,48,49,110,105,106,86,107,108,71,109,29,23,24,82,79,25,26,27,18,28,12,13,14,21,22,73,76])),tile:WO,"imagery-tile":()=>ce(()=>import("./ImageryTileLayerView3D-gayF0haa.js"),__vite__mapDeps([151,57,73,74,106,82,76,77,80])),"vector-tile":()=>ce(()=>import("./VectorTileLayerView3D-aQ_biIKM.js"),__vite__mapDeps([152,46,45,153,65,73,74,76])),wcs:()=>ce(()=>import("./ImageryTileLayerView3D-gayF0haa.js"),__vite__mapDeps([151,57,73,74,106,82,76,77,80])),"web-tile":WO,wfs:()=>ce(()=>import("./WFSLayerView3D-jN7AQBby.js"),__vite__mapDeps([154,104,105,106,86,107,108,71,109,29,23,24,82,79,25,26,27,18,28,12,13,14,21,22,73,5,110,76,77])),wms:()=>ce(()=>import("./WMSLayerView3D-CGuJWJjP.js"),__vite__mapDeps([155,85,73,86,87,76,77,156,106])),wmts:()=>ce(()=>import("./WMTSLayerView3D-BVtSRO2a.js"),__vite__mapDeps([157,73,74,75,76,77])),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function qat(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new G(`${i}:view-not-supported`,`${e} is not supported in 3D`)}const ppe={hasLayerViewModule:t=>dpe[t.type]!=null,importLayerView:t=>{const e=dpe[t.type];if(e==null)throw qat(t);return e(t)}},fpe="analyses-owner-handles";var dM,_T;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(dM||(dM={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(_T||(_T={}));let Ix=class extends Ue{constructor(e){super(e),this._allAnalysisViews=new st,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=mpe(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null},viewshed:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(ki("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(ki()),this._attachedToViewResolver=mpe()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const i=this._items.get(e);if(i==null||i.state.list===_T.REMOVED)throw new G("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return i.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),fpe)}_disconnectOwners(){this.removeHandles(fpe),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const s of e)this._addAnalysis(s);const i=e.on("after-add",s=>this._addAnalysis(s.item)),r=e.on("after-remove",s=>this._removeAnalysis(s.item));return Gi(()=>{i.remove(),r.remove();for(const s of e)this._removeAnalysis(s)})}_addAnalysis(e){const i=this._items.get(e);if(i==null){const r={state:{view:dM.PENDING,list:_T.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=uy(s=>this._createAnalysisViewPromise(r,s))}else i.state.list=_T.ADDED}_removeAnalysis(e){const i=this._items.get(e);i!=null?(i.state.list=_T.REMOVED,this._scheduleUpdate()):se.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=p2(()=>this._update()))}_update(){this._scheduledUpdateHandle=$r(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===_T.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case dM.PENDING:e.createAnalysisViewTask=Jl(e.createAnalysisViewTask);break;case dM.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=qe(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,i){const r=e.analysis,s=r.type,n=this._analysisModules[s];if(this._creatingViewCount+=1,n.module==null)try{n.module=await this._loadAnalysisModule(s)}catch(a){throw this._creatingViewCount-=1,a}if(ra(i))throw this._creatingViewCount-=1,ki("AnalysisView creation aborted");const o=new n.module.default({analysis:r,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(ra(i))throw this._creatingViewCount-=1,o.destroy(),ki("AnalysisView creation aborted");return e.view=o,e.state.view=dM.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return ce(()=>import("./AreaMeasurementAnalysisView3D-7KWvdQRE.js"),__vite__mapDeps([158,159,160,161,162,138,17,139,137,163,164,140,165,166]));case"dimension":return ce(()=>import("./DimensionAnalysisView3D-Dvc2S5LA.js"),__vite__mapDeps([167,161,168,160,165,166,137,138,17,139,169,170,153,171,172,173,174,136,140,79,135,175,176,164,107,177,87,178,179,180,181,163]));case"direct-line-measurement":return ce(()=>import("./DirectLineMeasurementAnalysisView3D-DwGE5ufu.js"),__vite__mapDeps([182,159,160,161,163,137,138,17,139,165,166,174,171]));case"line-of-sight":return ce(()=>import("./LineOfSightAnalysisView3D-B0PGHP37.js"),__vite__mapDeps([183,161,184,112,113,163,176,164,140,185,172,166,180,173]));case"slice":return ce(()=>import("./SliceAnalysisView3D-83jKf31w.js"),__vite__mapDeps([186,161,187,188,176,164,140,87,112,113,163,166,90,91,92,93,60,53,82,179,177,180,181]));case"viewshed":return ce(()=>import("./ViewshedAnalysisView3D-DHNBQf1x.js"),__vite__mapDeps([189,161,138,17,139,176,164,140,177,166,188,190,170,153,171,172,180,135,181]))}}};function mpe(){const t=aa();return t.promise.catch(()=>{}),t}h([p()],Ix.prototype,"updating",null),h([p({constructOnly:!0})],Ix.prototype,"view",void 0),h([p()],Ix.prototype,"_allAnalysisViews",void 0),h([p()],Ix.prototype,"_creatingViewCount",void 0),Ix=h([I("esri.views.3d.analysis.AnalysisViewManager3D")],Ix);const Wat=Ix;let s0=class extends Ue{constructor(e){super(e),this.collision=new M$,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Xe.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Xe.Local?this._set("altitude",e):se.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?Ne(e,this.altitude.min,this.altitude.max):e}clampTilt(e,i){if(!this.tilt)return i;const r=this.tilt(e);return Ne(i,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Xe.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(i,r=E8)=>(r.min=Sa.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?Ck([[4e3,Sa.max],[1e4,kt(88)],[6e6,kt(88)]]):()=>Sa.max;return(i,r=E8)=>(r.min=Sa.min,r.max=e(i),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?Ck([[4e3,Sa.max],[5e4,kt(88)],[6e6,kt(88)],[2e7,Sa.min]]):Ck([[3e5,Sa.max],[3e6,kt(88)],[6e6,kt(88)],[2e7,Sa.min]]);return(i,r=E8)=>(r.min=Sa.min,r.max=e(i),r)}};function Zat(t){return{min:-2e5,max:4*t.radius}}h([p()],s0.prototype,"altitude",null),h([p({readOnly:!0})],s0.prototype,"collision",void 0),h([p()],s0.prototype,"distance",void 0),h([p({readOnly:!0})],s0.prototype,"minimumPoiDistance",void 0),h([p()],s0.prototype,"tilt",void 0),h([p({constructOnly:!0})],s0.prototype,"mode",void 0),s0=h([I("esri.views.3d.state.Constraints")],s0);const gpe=Zat(lr),Sa={min:kt(.5),max:kt(179.5)},E8={min:0,max:0};let M$=class extends Ue{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};h([p({type:Boolean})],M$.prototype,"enabled",void 0),h([p({type:Number})],M$.prototype,"elevationMargin",void 0),M$=h([I("esri.views.3d.state.Constraints.CollisionConstraint")],M$);let pM=class extends zS{constructor(){super(...arguments),this.min=gpe.min,this.max=gpe.max}};h([p({type:Number})],pM.prototype,"min",void 0),h([p({type:Number})],pM.prototype,"max",void 0),pM=h([I("esri.views.3d.constraints.AltitudeConstraint")],pM);let E0=class extends zS{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,i){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==i&&this._set("far",i))}};h([p({type:Number,value:1e-8})],E0.prototype,"near",null),h([Kt("near")],E0.prototype,"castNear",null),h([p({type:Number,value:1e-8})],E0.prototype,"far",null),h([Kt("far")],E0.prototype,"castFar",null),h([p({type:["auto","manual"]})],E0.prototype,"mode",void 0),E0=h([I("esri.views.3d.constraints.ClipDistanceConstraint")],E0);const uJ={min:La(Sa.min),max:La(Sa.max)};let vT=class extends zS{constructor(e){super(e),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return Ne(e,uJ.min,uJ.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};h([p({type:["auto","manual"]})],vT.prototype,"mode",void 0),h([p({type:Number,value:uJ.max})],vT.prototype,"max",null),h([Kt("max")],vT.prototype,"castMax",null),vT=h([I("esri.views.3d.constraints.TiltConstraint")],vT);let bT=class extends zS{constructor(){super(...arguments),this.tilt=new vT,this.altitude=new pM,this.clipDistance=new E0}};h([p({type:vT})],bT.prototype,"tilt",void 0),h([p({type:pM})],bT.prototype,"altitude",void 0),h([p({type:E0})],bT.prototype,"clipDistance",void 0),bT=h([I("esri.views.3d.constraints.Constraints")],bT);var vC;let Wv=vC=class extends Us.EventedMixin(BS){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),i=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new vC(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const i=vC.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let r=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const s=vC.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==s&&(bF.target=this,bF.timezoneOffset=s,this.emit("timezone-will-change",bF),bF.target=null),t!=null)return isNaN(t.getTime())||r!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new vC({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};h([p({type:Boolean})],Wv.prototype,"cameraTrackingEnabled",void 0),h([p({type:Date})],Wv.prototype,"defaultDate",null),h([p({type:Date})],Wv.prototype,"date",null),Wv=vC=h([I("esri.views.3d.environment.SunLighting")],Wv),function(t){function e({hours:i,minutes:r,seconds:s}){return Math.round(i+r/60+s/3600)}t.calculateTimezoneOffset=e}(Wv||(Wv={}));const bF={target:null,timezoneOffset:0},Lx=Wv;var rU;let sU=rU=class extends Us.EventedMixin(wD){constructor(t){super(t),this.cameraTrackingEnabled=!0}clone(){return new rU({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new rU(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};h([p({type:Boolean})],sU.prototype,"cameraTrackingEnabled",void 0),sU=rU=h([I("esri.views.3d.environment.VirtualLighting")],sU);const A$=sU,Yat={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Lx,virtual:A$}};var hJ;let o3=hJ=class extends Ue{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new hJ({quality:this.quality})}};h([p({type:["low","high"],value:"low"})],o3.prototype,"quality",null),o3=hJ=h([I("esri.views.3d.environment.SceneViewAtmosphere")],o3);var P$;let bC=P$=class extends WA{constructor(t){super(t),this.atmosphere=new o3,this.lighting=this.castLighting(),this.cachedCameraTrackingEnabled=null}destroy(){this.atmosphere.destroy()}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new P$({...e,lighting:e.lighting?e.lighting.type==="virtual"?A$.fromWebsceneLighting(e.lighting):Lx.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLightingWithDestroy(t)}applyLighting(t){this.lighting=this._convertLightingWithDestroy(t)}_convertLightingWithDestroy(t){const e=this._convertLighting(t);return e!==t&&this.addHandles(tTe(e)),e}_convertLighting(t){var e,i;return t?t instanceof Lx||t instanceof A$?t:t instanceof BS?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new Lx({...t.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):t instanceof wD?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new A$({...t.cloneConstructProperties(),...(i=this.lighting)==null?void 0:i.cloneNonPersistentConstructProperties()}):Gf(Yat,t):new Lx}clone(){return new P$({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ie(this.background)})}cloneWithWebsceneEnvironment(t){return new P$({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ie(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):Lx.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):A$.fromWebsceneLighting(t.lighting);default:return t.lighting,Lx.fromWebsceneLighting(t.lighting)}}};h([p({type:o3,json:{read:!1},nonNullable:!0})],bC.prototype,"atmosphere",void 0),h([p({nonNullable:!0})],bC.prototype,"lighting",void 0),h([Kt("lighting")],bC.prototype,"castLighting",null),bC=P$=h([I("esri.views.3d.environment.SceneViewEnvironment")],bC);const wC=bC;function Xat(t,e){return{type:IS(e),value:t,unit:e}}function pZt(t){return{value:t}}function Y0(t,e){return{type:IS(e),value:t,unit:e}}function Jat(t,e){return{type:IS(e),value:t,unit:e}}function HG(t,e,i="arithmetic"){return{type:IS(e),value:t,unit:e,rotationType:i}}function Qat(t,e){const i=Kat(t,e);return t.type==="angle"?HG(i,e,t.rotationType):Xat(i,e)}function Kat(t,e){return Vr(t.value,t.unit,e)}function fZt(t,e){return t==null?e:e==null||t.value>Vr(e.value,e.unit,t.unit)?t:e}function mZt(t,e){return t==null?null:{...t,value:t.value*e}}function elt(t,e,i){if(e===i)return t;switch(i){case"arithmetic":case"geographic":return 90-t}}const gZt=Y0(0,"meters"),yZt=Jat(0,"square-meters");HG(0,"radians");const _Zt=HG(0,"degrees"),vZt=HG(0,"degrees","geographic");var Ya;(function(t){t[t.Realistic=0]="Realistic",t[t.Local=1]="Local",t[t.Mars=2]="Mars",t[t.None=3]="None"})(Ya||(Ya={}));function yRe(t){return"r"in t&&"g"in t&&"b"in t}function _Re(t){return"h"in t&&"s"in t&&"v"in t}function vRe(t){return"l"in t&&"a"in t&&"b"in t}function bRe(t){return"l"in t&&"c"in t&&"h"in t}function tlt(t){return"x"in t&&"y"in t&&"z"in t}const ilt=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],rlt=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function wRe(t,e){const i=[];let r,s;if(t[0].length!==e.length)throw new Error("dimensions do not match");const n=t.length,o=t[0].length;let a=0;for(r=0;r<n;r++){for(a=0,s=0;s<o;s++)a+=t[r][s]*e[s];i.push(a)}return i}function xRe(t){const e=[t.r/255,t.g/255,t.b/255].map(r=>r<=.04045?r/12.92:((r+.055)/1.055)**2.4),i=wRe(ilt,e);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function Nse(t){const e=wRe(rlt,[t.x/100,t.y/100,t.z/100]).map(i=>{const r=i<=.0031308?12.92*i:1.055*i**.4166666666666667-.055;return Math.min(1,Math.max(r,0))});return{r:Math.round(255*e[0]),g:Math.round(255*e[1]),b:Math.round(255*e[2])}}function TRe(t){const e=[t.x/95.047,t.y/100,t.z/108.883].map(i=>i>.008856451679035631?i**.3333333333333333:7.787037037037035*i+.13793103448275862);return{l:116*e[1]-16,a:500*(e[0]-e[1]),b:200*(e[1]-e[2])}}function SRe(t){const e=t.l,i=[(e+16)/116+t.a/500,(e+16)/116,(e+16)/116-t.b/200].map(r=>r>6/29?r**3:3*(6/29)**2*(r-4/29));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function slt(t){const e=t.l,i=t.a,r=t.b,s=Math.sqrt(i*i+r*r);let n=Math.atan2(r,i);return n=n>0?n:n+2*Math.PI,{l:e,c:s,h:n}}function nlt(t){const e=t.l,i=t.c,r=t.h;return{l:e,a:i*Math.cos(r),b:i*Math.sin(r)}}function olt(t){return TRe(xRe(t))}function alt(t){return Nse(SRe(t))}function llt(t){return slt(TRe(xRe(t)))}function clt(t){return Nse(SRe(nlt(t)))}function ult(t){const e=t.r,i=t.g,r=t.b,s=Math.max(e,i,r),n=s-Math.min(e,i,r);let o=s,a=n===0?0:s===e?(i-r)/n%6:s===i?(r-e)/n+2:(e-i)/n+4,l=n===0?0:n/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}function hlt(t){const e=(t.h+360)%360/60,i=t.s/100,r=t.v/100*255,s=r*i,n=s*(1-Math.abs(e%2-1));let o;switch(Math.floor(e)){case 0:o={r:s,g:n,b:0};break;case 1:o={r:n,g:s,b:0};break;case 2:o={r:0,g:s,b:n};break;case 3:o={r:0,g:n,b:s};break;case 4:o={r:n,g:0,b:s};break;case 5:case 6:o={r:s,g:0,b:n};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+r-s),o.g=Math.round(o.g+r-s),o.b=Math.round(o.b+r-s),o}function LD(t){return yRe(t)?t:bRe(t)?clt(t):vRe(t)?alt(t):tlt(t)?Nse(t):_Re(t)?hlt(t):t}function dlt(t){return _Re(t)?t:ult(LD(t))}function plt(t){return vRe(t)?t:olt(LD(t))}function bZt(t){return bRe(t)?t:llt(LD(t))}function flt(t,e){const{r:i,g:r,b:s}=t;return .2126*i+.7152*r+.0722*s}var dJ;function wZt(t,e=dJ.High){return flt(t)>e?new Qe([0,0,0,t.a]):new Qe([255,255,255,t.a])}function xZt(t,e){const i=plt(t);i.l*=1-e;const r=LD(i),s=t.clone();return s.setColor(r),s.a=t.a,s}function TZt(t,e){const i=t.clone();return i.a*=e,i}function SZt(t,e){const i=dlt(t);i.s*=e;const r=LD(i),s=t.clone();return s.setColor(r),s.a=t.a,s}function vL(t){return Qe.toUnitRGBA(t)}function EZt(t,e){return t===e||t!=null&&e!=null&&HS(t,e)}function CZt(t){return ii(t[0],t[1],t[2],t.length>3?t[3]:1)}function MZt(t,e){const i=Qe.toUnitRGBA(t);return i[3]*=e,i}(function(t){t[t.Low=160]="Low",t[t.High=225]="High"})(dJ||(dJ={}));function Da(t,e){return t[0]=e[0],t[1]=e[1],t}function Li(t,e,i){return t[0]=e,t[1]=i,t}function of(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function vg(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function ERe(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function CRe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function mlt(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function glt(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function ylt(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t}function _lt(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t}function vlt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function bh(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function blt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t}function Ob(t,e){const i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)}function jz(t,e){const i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function Fse(t){const e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function MRe(t){const e=t[0],i=t[1];return e*e+i*i}function ARe(t,e){return t[0]=-e[0],t[1]=-e[1],t}function wlt(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function bL(t,e){const i=e[0],r=e[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t}function zn(t,e){return t[0]*e[0]+t[1]*e[1]}function xlt(t,e,i){const r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t}function Nd(t,e,i,r){const s=e[0],n=e[1];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t}function Tlt(t,e){e=e||1;const i=2*gD()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t}function PRe(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s,t[1]=i[1]*r+i[3]*s,t}function Slt(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s+i[4],t[1]=i[1]*r+i[3]*s+i[5],t}function Elt(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[3]*s+i[6],t[1]=i[1]*r+i[4]*s+i[7],t}function Clt(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[4]*s+i[12],t[1]=i[1]*r+i[5]*s+i[13],t}function Mlt(t,e,i,r){const s=e[0]-i[0],n=e[1]-i[1],o=Math.sin(r),a=Math.cos(r);return t[0]=s*a-n*o+i[0],t[1]=s*o+n*a+i[1],t}function Alt(t,e){const i=t[0],r=t[1],s=e[0],n=e[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(i*s+r*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function Plt(t){return"vec2("+t[0]+", "+t[1]+")"}function ORe(t,e){return t[0]===e[0]&&t[1]===e[1]}function RRe(t,e){const i=t[0],r=t[1],s=e[0],n=e[1],o=Do();return Math.abs(i-s)<=o*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-n)<=o*Math.max(1,Math.abs(r),Math.abs(n))}function Olt(t,e,i,r,s){let n=e[0]-i[0],o=e[1]-i[1];const a=(r[0]*n+r[1]*o)*(s-1);return n=r[0]*a,o=r[1]*a,t[0]=e[0]+n,t[1]=e[1]+o,t}const Rlt=Fse,$lt=vg,Ilt=ERe,Llt=CRe,$Re=Ob,Dlt=jz,Nlt=MRe;Object.freeze(Object.defineProperty({__proto__:null,add:of,angle:Alt,ceil:mlt,copy:Da,cross:xlt,dist:$Re,distance:Ob,div:Llt,divide:CRe,dot:zn,equals:RRe,exactEquals:ORe,floor:glt,inverse:wlt,len:Rlt,length:Fse,lerp:Nd,max:_lt,min:ylt,mul:Ilt,multiply:ERe,negate:ARe,normalize:bL,projectAndScale:Olt,random:Tlt,rotate:Mlt,round:vlt,scale:bh,scaleAndAdd:blt,set:Li,sqrDist:Dlt,sqrLen:Nlt,squaredDistance:jz,squaredLength:MRe,str:Plt,sub:$lt,subtract:vg,transformMat2:PRe,transformMat2d:Slt,transformMat3:Elt,transformMat4:Clt},Symbol.toStringTag,{value:"Module"}));function kse(t){return Ne((t-1e5)/9e5,0,1)}const pJ=1e4,Flt=.085,y1=1e5;let klt=class{};const Fr=klt;function T(t,...e){let i="";for(let r=0;r<e.length;r++)i+=t[r]+e[r];return i+=t[t.length-1],i}(function(t){function e(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}t.int=e,t.float=i})(T||(T={}));var R;function Ult(t){return t===R.POSITION}(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.PERSPECTIVEDIVIDE="perspectiveDivide",t.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance",t.LENGTH="length",t.PREVPOSITION="prevPosition",t.NEXTPOSITION="nextPosition",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.INSTANCEMODELORIGINHI="instanceModelOriginHi",t.INSTANCEMODELORIGINLO="instanceModelOriginLo",t.INSTANCEMODEL="instanceModel",t.INSTANCEMODELNORMAL="instanceModelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMAL2COMPRESSED="normal2Compressed",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(R||(R={}));var vs;function Af(t,e){switch(e.textureCoordinateType){case vs.Default:return t.attributes.add(R.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(T`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case vs.Compressed:return t.attributes.add(R.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(T`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case vs.Atlas:return t.attributes.add(R.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(R.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(T`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case vs.None:return void t.vertex.code.add(T`void forwardTextureCoordinates() {}`);case vs.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(vs||(vs={}));function rm(t){t.code.add(T`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}var Zi;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(Zi||(Zi={}));let Vs=class{constructor(e,i,r,s,n=null){if(this.name=e,this.type=i,this.arraySize=n,this.bind={[Zi.Pass]:null,[Zi.Draw]:null},s)switch(r){case Zi.Pass:this.bind[Zi.Pass]=s;break;case Zi.Draw:this.bind[Zi.Draw]=s}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},jr=class extends Vs{constructor(e,i){super(e,"vec2",Zi.Pass,(r,s,n)=>r.setUniform2fv(e,i(s,n)))}};function Use(t){t.include(rm),t.code.add(T`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromRGBA(vec4 depth, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(depth), nearFar);
}
float linearDepthFromTexture(sampler2D depthTexture, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
return linearDepthFromRGBA(texelFetch(depthTexture, iuv, 0), nearFar);
}`)}function fy(t){t.uniforms.add(new jr("zProjectionMap",(e,i)=>Vlt(i.camera))),t.code.add(T`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`),t.code.add(T`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`),t.code.add(T`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)}function Vlt(t){const e=t.projectionMatrix;return Li(zlt,e[14],e[10])}const zlt=mt();function qG(t){t.fragment.code.add(T`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}let Wt=class extends Vs{constructor(e,i){super(e,"vec3",Zi.Pass,(r,s,n)=>r.setUniform3fv(e,i(s,n)))}};function C_(t){t.uniforms.add(new Wt("mainLightDirection",(e,i)=>i.lighting.mainLight.direction))}function my(t){t.uniforms.add(new Wt("mainLightIntensity",(e,i)=>i.lighting.mainLight.intensity))}function Gz(t){C_(t.fragment),my(t.fragment),t.fragment.code.add(T`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let ji=class extends Vs{constructor(e,i){super(e,"vec4",Zi.Pass,(r,s,n)=>r.setUniform4fv(e,i(s,n)))}},et=class extends Vs{constructor(e,i){super(e,"float",Zi.Pass,(r,s,n)=>r.setUniform1f(e,i(s,n)))}},us=class extends Vs{constructor(e,i){super(e,"mat4",Zi.Pass,(r,s,n)=>r.setUniformMatrix4fv(e,i(s,n)))}};const Tl=ci();let Blt=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function vt(t,e){if(!t){e=e||"Assertion";const i=new Error(e).stack;throw new Blt(`${e} at ${i}`)}}function X2(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function IRe(t,e,i,r){let s,n=(i[0]-t[0])/e[0],o=(r[0]-t[0])/e[0];n>o&&(s=n,n=o,o=s);let a=(i[1]-t[1])/e[1],l=(r[1]-t[1])/e[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(i[2]-t[2])/e[2],u=(r[2]-t[2])/e[2];return c>u&&(s=c,c=u,u=s),!(n>u||c>o)&&(u<o&&(o=u),!(o<0))}function wF(t,e,i,r,s,n=mt()){const o=(r[s]-i[s])*(e[0]-t[0])-(r[0]-i[0])*(e[s]-t[s]),a=(r[0]-i[0])*(t[s]-i[s])-(r[s]-i[s])*(t[0]-i[0]);if(o===0)return!1;const l=a/o;return n[0]=t[0]+l*(e[0]-t[0]),n[1]=t[s]+l*(e[s]-t[s]),!0}function ype(t,e,i,r,s){Tl[0]=t[0],Tl[1]=t[1],Tl[2]=t[2],Tl[3]=1,Pu(Tl,Tl,e),s.length>2&&(s[2]=-Tl[2]),Pu(Tl,Tl,i),vt(Tl[3]!==0),s[0]=Tl[0]/Tl[3],s[1]=Tl[1]/Tl[3],s[2]=Tl[2]/Tl[3],s[0]=(.5*s[0]+.5)*r[2]+r[0],s[1]=(.5*s[1]+.5)*r[3]+r[1]}function jlt(t,e){return Math.log(t)/Math.log(e)}function Glt(t,e,i,r){t[12]=e,t[13]=i,t[14]=r}function LRe(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}const Hlt=()=>se.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let DRe=class{constructor(){this._includedModules=new Map}include(e,i){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,i),e(this.builder,i))}},Hi=class extends DRe{constructor(){super(...arguments),this.vertex=new _pe,this.fragment=new _pe,this.attributes=new Zlt,this.varyings=new Ylt,this.extensions=new fJ,this.constants=new NRe,this.outputs=new gJ}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const i=this.extensions.generateSource(e),r=this.attributes.generateSource(e),s=this.varyings.generateSource(e),n=e==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=e==="vertex"?Jlt:Xlt,c=this.constants.generateSource().concat(n.constants.generateSource()),u=this.outputs.generateSource(e);return`#version 300 es
${i.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${r.join(`
`)}

${s.join(`
`)}

${u.join(`
`)}

${a.join(`
`)}`}generateBindPass(e){const i=new Map;this.vertex.uniforms.entries.forEach(n=>{const o=n.bind[Zi.Pass];o&&i.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{const o=n.bind[Zi.Pass];o&&i.set(n.name,o)});const r=Array.from(i.values()),s=r.length;return(n,o)=>{for(let a=0;a<s;++a)r[a](e,n,o)}}generateBindDraw(e){const i=new Map;this.vertex.uniforms.entries.forEach(n=>{const o=n.bind[Zi.Draw];o&&i.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{const o=n.bind[Zi.Draw];o&&i.set(n.name,o)});const r=Array.from(i.values()),s=r.length;return(n,o,a)=>{for(let l=0;l<s;++l)r[l](e,n,o,a)}}},qlt=class{constructor(e){this._stage=e,this._entries=new Map}add(...e){for(const i of e)this._add(i);return this._stage}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new G(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else Hlt().error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},Wlt=class{constructor(e){this._stage=e,this._entries=new Array}add(e){return this._entries.push(e),this._stage}generateSource(){return this._entries}},_pe=class extends DRe{constructor(){super(...arguments),this.uniforms=new qlt(this),this.code=new Wlt(this),this.constants=new NRe}get builder(){return this}},Zlt=class{constructor(){this._entries=new Array}add(e,i){this._entries.push([e,i])}generateSource(e){return e==="fragment"?[]:this._entries.map(i=>`in ${i[1]} ${i[0]};`)}},Ylt=class{constructor(){this._entries=new Map}add(e,i){this._entries.has(e)&&vt(this._entries.get(e)===i),this._entries.set(e,i)}generateSource(e){const i=new Array;return this._entries.forEach((r,s)=>i.push(e==="vertex"?`out ${r} ${s};`:`in ${r} ${s};`)),i}},fJ=class mJ{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const i=e==="vertex"?mJ.ALLOWLIST_VERTEX:mJ.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}};fJ.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],fJ.ALLOWLIST_VERTEX=[];let gJ=class yJ{constructor(){this._entries=new Map}add(e,i,r=0){const s=this._entries.get(r);s?vt(s.name===e&&s.type===i,`Fragment shader output location ${r} occupied`):this._entries.set(r,{name:e,type:i})}generateSource(e){if(e==="vertex")return[];this._entries.size===0&&this._entries.set(0,{name:yJ.DEFAULT_NAME,type:yJ.DEFAULT_TYPE});const i=new Array;return this._entries.forEach((r,s)=>i.push(`layout(location = ${s}) out ${r.type} ${r.name};`)),i}};gJ.DEFAULT_TYPE="vec4",gJ.DEFAULT_NAME="fragColor";let NRe=class In{constructor(){this._entries=new Set}add(e,i,r){let s="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":s=In._numberToFloatStr(r);break;case"int":s=In._numberToIntStr(r);break;case"bool":s=r.toString();break;case"vec2":s=`vec2(${In._numberToFloatStr(r[0])},                            ${In._numberToFloatStr(r[1])})`;break;case"vec3":s=`vec3(${In._numberToFloatStr(r[0])},                            ${In._numberToFloatStr(r[1])},                            ${In._numberToFloatStr(r[2])})`;break;case"vec4":s=`vec4(${In._numberToFloatStr(r[0])},                            ${In._numberToFloatStr(r[1])},                            ${In._numberToFloatStr(r[2])},                            ${In._numberToFloatStr(r[3])})`;break;case"ivec2":s=`ivec2(${In._numberToIntStr(r[0])},                             ${In._numberToIntStr(r[1])})`;break;case"ivec3":s=`ivec3(${In._numberToIntStr(r[0])},                             ${In._numberToIntStr(r[1])},                             ${In._numberToIntStr(r[2])})`;break;case"ivec4":s=`ivec4(${In._numberToIntStr(r[0])},                             ${In._numberToIntStr(r[1])},                             ${In._numberToIntStr(r[2])},                             ${In._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${i}(${Array.prototype.map.call(r,n=>In._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${i} ${e} = ${s};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const Xlt=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,Jlt=`precision highp float;
precision highp sampler2D;`;let wt=class extends Vs{constructor(e,i){super(e,"sampler2D",Zi.Pass,(r,s,n)=>r.bindTexture(e,i(s,n)))}};const tA=Ge(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),C8=3,M8=Ge(C8*parseFloat(65e-8.toFixed(6)),C8*parseFloat(1881e-9.toFixed(6)),C8*parseFloat(85e-9.toFixed(6))),Qlt=3996e-9,Klt=Ge(parseFloat(Number(tA[0]+M8[0]).toFixed(6)),parseFloat(Number(tA[1]+M8[1]).toFixed(6)),parseFloat(Number(tA[2]+M8[2]).toFixed(6)));function FRe(t){const e=new Hi;e.attributes.add(R.POSITION,"vec2"),e.include(Af,{textureCoordinateType:vs.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=e;return i.uniforms.add(new us("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new us("inverseViewMatrix",(s,n)=>Hb(ect,n.camera.viewMatrix))),i.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Wt("backgroundColor",s=>s.backgroundColor),new jr("radii",s=>s.radii),new Wt("cameraPosition",(s,n)=>n.camera.eye),new ji("heightParameters",s=>s.heightParameters),new et("innerFadeDistance",s=>s.innerFadeDistance),new et("altitudeFade",s=>s.altitudeFade),new wt("depthTexture",s=>s.depthTexture),new et("hazeStrength",s=>s.hazeStrength)),r.constants.add("betaRayleigh","vec3",tA),r.constants.add("betaCombined","vec3",Klt),r.constants.add("betaMie","float",Qlt),r.constants.add("scaleHeight","float",Flt*y1),C_(r),e.include(qG),t.haze&&r.include(fy),r.code.add(T`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(T`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),r.code.add(T`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),r.code.add(T`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?T`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?"":T`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":T`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?T`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:T`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${t.haze?"":T`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${t.haze&&t.reduced?T`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?T`
          float depthSample = texture(depthTexture, vuv0).r;
          if (depthSample != 1.0) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${t.reduced?T`cameraSpaceRay *= -textureBilinear(vuv0);`:T`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:T`${t.reduced?"":T`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${t.haze?T`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != 1.0){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:T`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":T`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),e}const ect=ke(),tct=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:tA,build:FRe},Symbol.toStringTag,{value:"Module"}));let qi=class{constructor(e,i){this._module=e,this._loadModule=i}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var zr,Ci,Be,h_,Rt,Pf,lP,St,br,bs,di,Mi,Ns,Ht,xt,fl,Ea,cr,_h,Qa;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(zr||(zr={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Ci||(Ci={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Be||(Be={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(h_||(h_={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER"}(Rt||(Rt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(Pf||(Pf={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(lP||(lP={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=5131]="HALF_FLOAT"}(St||(St={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(br||(br={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(bs||(bs={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(di||(di={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Mi||(Mi={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(Ns||(Ns={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(Ht||(Ht={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(xt||(xt={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(fl||(fl={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(Ea||(Ea={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(cr||(cr={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(_h||(_h={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(Qa||(Qa={}));const A8=33984;var an,Gn,no;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.TransformFeedback=7]="TransformFeedback",t[t.Sync=8]="Sync",t[t.UNCOUNTED=9]="UNCOUNTED",t[t.LinesOfCode=9]="LinesOfCode",t[t.Uniform=10]="Uniform",t[t.COUNT=11]="COUNT"})(an||(an={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(Gn||(Gn={})),function(t){t[t.NONE=0]="NONE",t[t.BACK=1029]="BACK"}(no||(no={}));const cP=33306;var Zs,vpe,bpe,wpe,Hz,_J,xpe;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(Zs||(Zs={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(vpe||(vpe={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(bpe||(bpe={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(wpe||(wpe={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(Hz||(Hz={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(_J||(_J={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(xpe||(xpe={}));let Qi=class{constructor(e,i,r){this.release=r,this.initializeConfiguration(e,i),this._configuration=i.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}destroy(){this._program=Ut(this._program),this._pipeline=this._configuration=null}reload(e){Ut(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return Ci.TRIANGLES}getPipeline(e,i,r){return this._pipeline}initializeConfiguration(e,i){}};const Ai=new Map([[R.POSITION,0],[R.NORMAL,1],[R.NORMALCOMPRESSED,1],[R.UV0,2],[R.COLOR,3],[R.COLORFEATUREATTRIBUTE,3],[R.SIZE,4],[R.TANGENT,4],[R.CENTEROFFSETANDDISTANCE,5],[R.SYMBOLCOLOR,5],[R.FEATUREATTRIBUTE,6],[R.INSTANCEFEATUREATTRIBUTE,6],[R.INSTANCECOLOR,7],[R.OBJECTANDLAYERIDCOLOR,7],[R.INSTANCEOBJECTANDLAYERIDCOLOR,7],[R.INSTANCEMODEL,8],[R.INSTANCEMODELNORMAL,12],[R.INSTANCEMODELORIGINHI,11],[R.INSTANCEMODELORIGINLO,15]]),ict=()=>se.getLogger("esri.views.webgl.checkWebGLError");function rct(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const qz=!!le("enable-feature:webgl-debug");function af(){return qz}function vJ(){return qz}function bg(t){if(af()){const e=t.getError();if(e){const i=rct(t,e),r=new Error().stack;ict().error(new G("webgl-error","WebGL error occurred",{message:i,stack:r}))}}}let Ki=class{constructor(e,i,r){this._context=e,this._locations=r,this._textures=new Map,this._freeTextureUnits=new ai({deallocator:null}),this._glProgram=e.programCache.acquire(i.generate("vertex"),i.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=i.generateBindPass(this),this.bindDraw=i.generateBindDraw(this),this._fragmentUniforms=af()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,i){this._glProgram.setUniform1i(e,i?1:0)}setUniform1i(e,i){this._glProgram.setUniform1i(e,i)}setUniform1f(e,i){this._glProgram.setUniform1f(e,i)}setUniform2fv(e,i){this._glProgram.setUniform2fv(e,i)}setUniform3fv(e,i){this._glProgram.setUniform3fv(e,i)}setUniform4fv(e,i){this._glProgram.setUniform4fv(e,i)}setUniformMatrix3fv(e,i){this._glProgram.setUniformMatrix3fv(e,i)}setUniformMatrix4fv(e,i){this._glProgram.setUniformMatrix4fv(e,i)}setUniform1fv(e,i){this._glProgram.setUniform1fv(e,i)}setUniform1iv(e,i){this._glProgram.setUniform1iv(e,i)}setUniform2iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform3iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform4iv(e,i){this._glProgram.setUniform4iv(e,i)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,i){if((i==null?void 0:i.glName)==null){const s=this._textures.get(e);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(e)),null}let r=this._textures.get(e);return r==null?(r=this._allocTextureUnit(i),this._textures.set(e,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){var e;this._context.useProgram(this),this._textures.forEach((i,r)=>{this._context.bindTexture(i.texture,i.unit),this.setUniform1i(r,i.unit)}),(e=this._fragmentUniforms)==null||e.forEach(i=>{i.type!=="sampler2D"&&i.type!=="samplerCube"||this._textures.has(i.name)||console.error(`Texture sampler ${i.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var Br,XS,ar,Rb,kc,d_,Rr,Zl,X0;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(Br||(Br={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(XS||(XS={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(ar||(ar={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(Rb||(Rb={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(kc||(kc={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(d_||(d_={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(Rr||(Rr={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(Zl||(Zl={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(X0||(X0={}));function Hh(t,e,i=h_.ADD,r=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function ua(t,e,i,r,s=h_.ADD,n=h_.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:i,dstAlpha:r,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const Vse={face:Pf.BACK,mode:lP.CCW},kRe={face:Pf.FRONT,mode:lP.CCW},WG=t=>t===Br.Back?Vse:t===Br.Front?kRe:null,Nu={zNear:0,zFar:1},ui={r:!0,g:!0,b:!0,a:!0};function sct(t){return pct.intern(t)}function nct(t){return fct.intern(t)}function oct(t){return mct.intern(t)}function act(t){return gct.intern(t)}function lct(t){return yct.intern(t)}function cct(t){return _ct.intern(t)}function uct(t){return vct.intern(t)}function hct(t){return bct.intern(t)}function dct(t){return wct.intern(t)}function Jt(t){return xct.intern(t)}let gy=class{constructor(e,i){this._makeKey=e,this._makeRef=i,this._interns=new Map}intern(e){if(!e)return null;const i=this._makeKey(e),r=this._interns;return r.has(i)||r.set(i,this._makeRef(e)),r.get(i)??null}};function yy(t){return"["+t.join(",")+"]"}const pct=new gy(URe,t=>({__tag:"Blending",...t}));function URe(t){return t?yy([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const fct=new gy(VRe,t=>({__tag:"Culling",...t}));function VRe(t){return t?yy([t.face,t.mode]):null}const mct=new gy(zRe,t=>({__tag:"PolygonOffset",...t}));function zRe(t){return t?yy([t.factor,t.units]):null}const gct=new gy(BRe,t=>({__tag:"DepthTest",...t}));function BRe(t){return t?yy([t.func]):null}const yct=new gy(jRe,t=>({__tag:"StencilTest",...t}));function jRe(t){return t?yy([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const _ct=new gy(GRe,t=>({__tag:"DepthWrite",...t}));function GRe(t){return t?yy([t.zNear,t.zFar]):null}const vct=new gy(HRe,t=>({__tag:"ColorWrite",...t}));function HRe(t){return t?yy([t.r,t.g,t.b,t.a]):null}const bct=new gy(qRe,t=>({__tag:"StencilWrite",...t}));function qRe(t){return t?yy([t.mask]):null}const wct=new gy(WRe,t=>({__tag:"DrawBuffers",...t}));function WRe(t){return t?yy(t.buffers):null}const xct=new gy(Tct,t=>({blending:sct(t.blending),culling:nct(t.culling),polygonOffset:oct(t.polygonOffset),depthTest:act(t.depthTest),stencilTest:lct(t.stencilTest),depthWrite:cct(t.depthWrite),colorWrite:uct(t.colorWrite),stencilWrite:hct(t.stencilWrite),drawBuffers:dct(t.drawBuffers)}));function Tct(t){return t?yy([URe(t.blending),VRe(t.culling),zRe(t.polygonOffset),BRe(t.depthTest),jRe(t.stencilTest),GRe(t.depthWrite),HRe(t.colorWrite),qRe(t.stencilWrite),WRe(t.drawBuffers)]):null}let Sct=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,i,r,s){return(r||e!==i)&&(s(e),this._pipelineInvalid=!0),e}},Ect=class extends Fr{constructor(){super(...arguments),this.heightParameters=ci(),this.radii=mt(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=mt(),this.backgroundColor=E()}},O$=class ZRe extends Qi{initializeProgram(e){return new Ki(e.rctx,ZRe.shader.get().build(this.configuration),Ai)}initializePipeline(){return this.configuration.reduced?Jt({blending:Hh(Be.ONE,Be.ZERO),depthTest:{func:br.ALWAYS},colorWrite:ui}):this.configuration.haze?Jt({blending:ua(Be.ONE,Be.ZERO,Be.ONE_MINUS_SRC_COLOR,Be.ONE),colorWrite:ui}):Jt({blending:Hh(Be.SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),depthTest:{func:br.LEQUAL},colorWrite:ui})}};O$.shader=new qi(tct,()=>ce(()=>Promise.resolve().then(()=>aHt),void 0));let tc=class extends Fr{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,i={key:this.key};for(const r of e)i[r]=this[r];return i}};function B(t={}){return(e,i)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(i),t.constValue!=null)Object.defineProperty(e,i,{get:()=>t.constValue});else{const r=e._parameterNames.length-1,s=t.count||2,n=Math.ceil(Math.log2(s)),o=e._parameterBits??[0];let a=0;for(;o[a]+n>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<n)-1<<l;o[a]+=n,Object.defineProperty(e,i,{get(){return this[r]},set(u){if(this[r]!==u&&(this[r]=u,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+u<<l&c,typeof u!="number"&&typeof u!="boolean"))throw new Error("Configuration value for "+i+" must be boolean or number, got "+typeof u)}})}}}let YRe=class extends tc{constructor(){super(...arguments),this.haze=!1}};h([B()],YRe.prototype,"haze",void 0);let XRe=class extends YRe{constructor(){super(...arguments),this.reduced=!1}};h([B()],XRe.prototype,"reduced",void 0);var ss,Oo;(function(t){t[t.RED=0]="RED",t[t.RG=1]="RG",t[t.RGBA4=2]="RGBA4",t[t.RGBA=3]="RGBA",t[t.RGBA_MIPMAP=4]="RGBA_MIPMAP",t[t.R16F=5]="R16F",t[t.RGBA16F=6]="RGBA16F"})(ss||(ss={})),function(t){t[t.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",t[t.DEPTH16_BUFFER=1]="DEPTH16_BUFFER"}(Oo||(Oo={}));let Xf=class{constructor(e,i,r,s,n,o=!1,a=0){this.name=e,this.count=i,this.type=r,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}};new Xf(R.POSITION,3,St.FLOAT,0,12);const zse=[new Xf(R.POSITION,2,St.FLOAT,0,8)],DD=[new Xf(R.POSITION,2,St.FLOAT,0,16),new Xf(R.UV0,2,St.FLOAT,8,16)];function Cct(t){switch(t){case St.BYTE:case St.UNSIGNED_BYTE:return 1;case St.SHORT:case St.UNSIGNED_SHORT:case St.HALF_FLOAT:return 2;case St.FLOAT:case St.INT:case St.UNSIGNED_INT:return 4}}function JRe(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function J0(t,e){return t.vertexBuffers[e].usedMemory/Mct(t.layout[e])}function Mct(t){return t[0].stride}function Bse(t,e,i,r,s=0){var o;const n=t.gl;t.bindBuffer(i);for(const a of r){const l=e.get(a.name);if(l===void 0){console.warn(`There is no location for vertex attribute '${a.name}' defined.`);continue}const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&t.gl.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let u=0;u<3;u++)n.vertexAttribPointer(l+u,3,a.type,a.normalized,a.stride,a.offset+12*u+c),n.enableVertexAttribArray(l+u),a.divisor>0&&t.gl.vertexAttribDivisor(l+u,a.divisor);else if(a.count===16)for(let u=0;u<4;u++)n.vertexAttribPointer(l+u,4,a.type,a.normalized,a.stride,a.offset+16*u+c),n.enableVertexAttribArray(l+u),a.divisor>0&&((o=t.gl)==null||o.vertexAttribDivisor(l+u,a.divisor));else console.error("Unsupported vertex attribute element count: "+a.count);if(af()){const u=JRe(t),d=Cct(a.type),f=a.offset,m=Math.round(d/f)!==d/f?`. Offset not a multiple of stride. DataType requires ${d} bytes, but descriptor has an offset of ${f}`:"";u&&console.error(`Unable to bind vertex attribute "${a.name}" with baseInstanceOffset ${c}${m}:`,u,a)}}}function QRe(t,e,i,r){var n,o,a;const s=t.gl;t.bindBuffer(i);for(const l of r){const c=e.get(l.name);if(l.count<=4)s.disableVertexAttribArray(c),l.divisor&&l.divisor>0&&((n=t.gl)==null||n.vertexAttribDivisor(c,0));else if(l.count===9)for(let u=0;u<3;u++)s.disableVertexAttribArray(c+u),l.divisor&&l.divisor>0&&((o=t.gl)==null||o.vertexAttribDivisor(c+u,0));else if(l.count===16)for(let u=0;u<4;u++)s.disableVertexAttribArray(c+u),l.divisor&&l.divisor>0&&((a=t.gl)==null||a.vertexAttribDivisor(c+u,0));else console.error("Unsupported vertex attribute element count: "+l.count)}t.unbindBuffer(Rt.ARRAY_BUFFER)}function jse(t){switch(t){case Ht.ALPHA:case Ht.LUMINANCE:case Ht.RED:case Ht.RED_INTEGER:case xt.R8:case xt.R8I:case xt.R8UI:case xt.R8_SNORM:case Ea.STENCIL_INDEX8:return 1;case Ht.LUMINANCE_ALPHA:case Ht.RG:case Ht.RG_INTEGER:case xt.RGBA4:case xt.R16F:case xt.R16I:case xt.R16UI:case xt.RG8:case xt.RG8I:case xt.RG8UI:case xt.RG8_SNORM:case xt.RGB565:case xt.RGB5_A1:case Ea.DEPTH_COMPONENT16:return 2;case Ht.DEPTH_COMPONENT:case Ht.RGB:case Ht.RGB_INTEGER:case xt.RGB8:case xt.RGB8I:case xt.RGB8UI:case xt.RGB8_SNORM:case xt.SRGB8:case Ea.DEPTH_COMPONENT24:return 3;case Ht.DEPTH_STENCIL:case Ht.DEPTH24_STENCIL8:case Ht.RGBA:case Ht.RGBA_INTEGER:case xt.RGBA8:case xt.R32F:case xt.R11F_G11F_B10F:case xt.RG16F:case xt.R32I:case xt.R32UI:case xt.RG16I:case xt.RG16UI:case xt.RGBA8I:case xt.RGBA8UI:case xt.RGBA8_SNORM:case xt.SRGB8_ALPHA8:case xt.RGB9_E5:case xt.RGB10_A2UI:case xt.RGB10_A2:case Ea.DEPTH_STENCIL:case Ea.DEPTH_COMPONENT32F:case Ea.DEPTH24_STENCIL8:return 4;case Ea.DEPTH32F_STENCIL8:return 5;case xt.RGB16F:case xt.RGB16I:case xt.RGB16UI:return 6;case xt.RG32F:case xt.RG32I:case xt.RG32UI:case xt.RGBA16F:case xt.RGBA16I:case xt.RGBA16UI:return 8;case xt.RGB32F:case xt.RGB32I:case xt.RGB32UI:return 12;case xt.RGBA32F:case xt.RGBA32I:case xt.RGBA32UI:return 16;case Zs.COMPRESSED_RGB_S3TC_DXT1_EXT:case Zs.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case Zs.COMPRESSED_RGBA_S3TC_DXT3_EXT:case Zs.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case Zs.COMPRESSED_R11_EAC:case Zs.COMPRESSED_SIGNED_R11_EAC:case Zs.COMPRESSED_RGB8_ETC2:case Zs.COMPRESSED_SRGB8_ETC2:case Zs.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case Zs.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case Zs.COMPRESSED_RG11_EAC:case Zs.COMPRESSED_SIGNED_RG11_EAC:case Zs.COMPRESSED_RGBA8_ETC2_EAC:case Zs.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}const xF=()=>se.getLogger("esri.views.webgl.VertexArrayObject");let Jf=class{constructor(e,i,r,s,n=null){this._context=e,this._locations=i,this._layout=r,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,i)=>e+this._buffers[i].usedMemory,this._indexBuffer!=null?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*Zxe}dispose(){var e;if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const i in this._buffers)(e=this._buffers[i])==null||e.dispose(),delete this._buffers[i];this._indexBuffer=Ut(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&xF().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(an.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,i=e.createVertexArray();e.bindVertexArray(i),this._bindLayout(),e.bindVertexArray(null),this._glName=i,this._context.instanceCounter.increment(an.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:i,_indexBuffer:r}=this;e||xF().error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in e){const o=e[n];o||xF().error("Vertex buffer is uninitialized!");const a=i[n];a||xF().error("Vertex element descriptor is empty!"),Bse(this._context,this._locations,o,a)}r!=null&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}},_y=class extends Jf{};const Tpe=()=>se.getLogger("esri.views.webgl.BufferObject");let Sr=class Dx{static createIndex(e,i,r){return new Dx(e,Rt.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(e,i,r){return new Dx(e,Rt.ARRAY_BUFFER,i,r)}static createUniform(e,i,r){return new Dx(e,Rt.UNIFORM_BUFFER,i,r)}static createPixelPack(e,i=cr.STREAM_READ,r){const s=new Dx(e,Rt.PIXEL_PACK_BUFFER,i);return r&&s.setSize(r),s}static createPixelUnpack(e,i=cr.STREAM_DRAW,r){return new Dx(e,Rt.PIXEL_UNPACK_BUFFER,i,r)}static createTransformFeedback(e,i=cr.STATIC_DRAW,r){const s=new Dx(e,Rt.TRANSFORM_FEEDBACK_BUFFER,i);return s.setSize(r),s}constructor(e,i,r,s){this._context=e,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(an.BufferObject,this),this._glName=this._context.gl.createBuffer(),bg(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){return this.bufferType===Rt.ELEMENT_ARRAY_BUFFER?this._indexType===St.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===Rt.ELEMENT_ARRAY_BUFFER||this.bufferType===Rt.ARRAY_BUFFER}dispose(){var e;(e=this._context)!=null&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(an.BufferObject,this),this._context=null):this._glName&&Tpe().warn("Leaked WebGL buffer object")}setSize(e,i=null){if(this.bufferType===Rt.ELEMENT_ARRAY_BUFFER&&i!=null)switch(this._indexType=i,i){case St.UNSIGNED_SHORT:e*=2;break;case St.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let i=e.byteLength;this.bufferType===Rt.ELEMENT_ARRAY_BUFFER&&(Pj(e)&&(i/=2,this._indexType=St.UNSIGNED_SHORT),cie(e)&&(i/=4,this._indexType=St.UNSIGNED_INT)),this._setBufferData(i,e)}_setBufferData(e,i=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;i!=null?s.bufferData(this.bufferType,i,this.usage):s.bufferData(this.bufferType,e,this.usage),bg(s),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,i,r,s){if(!e)return;const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:o}=this._context;o.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,e,r,s-r),bg(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,i=0,r,s){if(r<0||s<0)return;const n=Act(e)?e.BYTES_PER_ELEMENT:1;if(n*((r??0)+(s??0))>e.byteLength)return;i+n*(s??0)>this.usedMemory&&Tpe().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===Rt.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,Rt.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(Rt.TRANSFORM_FEEDBACK_BUFFER,i,e,r,s),this._context.unbindBuffer(Rt.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,Rt.COPY_READ_BUFFER),o.getBufferSubData(Rt.COPY_READ_BUFFER,i,e,r,s),this._context.unbindBuffer(Rt.COPY_READ_BUFFER))}async getSubDataAsync(e,i=0,r,s){await this._context.clientWaitAsync(),this.getSubData(e,i,r,s)}};function Act(t){return f6e(t)}var p_;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(p_||(p_={}));let Xr=class{constructor(e=0,i=e){this.width=e,this.height=i,this.target=Ns.TEXTURE_2D,this.pixelFormat=Ht.RGBA,this.dataType=fl.UNSIGNED_BYTE,this.samplingMode=di.LINEAR,this.wrapMode=Mi.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}};function Pct(t){return t.width<=0||t.height<=0?0:Math.round(t.width*t.height*(t.hasMipmap?4/3:1)*(t.internalFormat==null?4:jse(t.internalFormat)))}let Oct=class KRe extends Xr{constructor(e,i){switch(super(),this.context=e,Object.assign(this,i),this.internalFormat){case xt.R16F:case xt.R16I:case xt.R16UI:case xt.R32F:case xt.R32I:case xt.R32UI:case xt.R8_SNORM:case xt.R8:case xt.R8I:case xt.R8UI:this.pixelFormat=Ht.RED}}static validate(e,i){return new KRe(e,i)}};const Spe=4;let Er=class fd{constructor(e,i=null,r=null){if(this.type=p_.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,r=i;else{const s=Oct.validate(e,i);if(!s)throw new G("Texture descriptor invalid");this._descriptor=s}this._descriptor.target===Ns.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return Pct(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(an.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,i){const r=this._descriptor;if(r.width!==e||r.height!==i){if(this._wasImmutablyAllocated)throw new G("Immutable textures can't be resized!");r.width=e,r.height=i,this._descriptor.target===Ns.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let i=Ns.TEXTURE_CUBE_MAP_POSITIVE_X;i<=Ns.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(e,i)}setData(e){this._setData(e)}_setData(e,i){var c;if(!((c=this._descriptor.context)!=null&&c.gl))return;const r=this._descriptor.context.gl;bg(r),this._glName||(this._glName=r.createTexture(),this._glName&&this._descriptor.context.instanceCounter.increment(an.Texture,this)),e===void 0&&(e=null);const s=this._descriptor,n=i??s.target,o=ZO(n);e===null&&(s.width=s.width||Spe,s.height=s.height||Spe,o&&(s.depth=s.depth??1));const a=this._descriptor.context.bindTexture(this,fd.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(fd.TEXTURE_UNIT_FOR_UPDATES),TF(s),this._configurePixelStorage(),bg(r);const l=this._deriveInternalFormat();if(Mpe(e)){let u="width"in e?e.width:e.codedWidth,d="height"in e?e.height:e.codedHeight;const f=1;e instanceof HTMLVideoElement&&(u=e.videoWidth,d=e.videoHeight),s.width&&s.height,o&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,u,d,f),this._texImage(n,0,l,u,d,f,e),bg(r),s.hasMipmap&&this.generateMipmap(),s.width||(s.width=u),s.height||(s.height=d),o&&!s.depth&&(s.depth=f)}else{const{width:u,height:d,depth:f}=s;if(u==null||d==null)throw new G("Width and height must be specified!");if(o&&f==null)throw new G("Depth must be specified!");if(s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,u,d,f),nU(e)){const m=e.levels,g=Ape(n,u,d,f),y=Math.min(g-1,m.length-1);r.texParameteri(s.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,y);const v=l;if(!Ict(v))throw new G("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((b,w,x,S)=>{const C=m[Math.min(b,m.length-1)];this._compressedTexImage(n,b,v,w,x,S,C)},y)}else this._texImage(n,0,l,u,d,f,e),bg(r),s.hasMipmap&&this.generateMipmap()}Epe(r,this._descriptor),Cpe(r,this._descriptor),Rct(this._descriptor.context,this._descriptor),bg(r),this._descriptor.context.bindTexture(a,fd.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,i,r,s,n,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._descriptor,c=this._deriveInternalFormat(),{context:u,pixelFormat:d,dataType:f,target:m,isImmutable:g}=l;if(g&&!this._wasImmutablyAllocated)throw new G("Cannot update immutable texture before allocation!");const y=u.bindTexture(this,fd.TEXTURE_UNIT_FOR_UPDATES,!0);(i<0||r<0||i+s>l.width||r+n>l.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:v}=u;a&&v.pixelStorei(v.UNPACK_SKIP_ROWS,a),Mpe(o)?v.texSubImage2D(m,e,i,r,s,n,d,f,o):nU(o)?v.compressedTexSubImage2D(m,e,i,r,s,n,c,o.levels[e]):v.texSubImage2D(m,e,i,r,s,n,d,f,o),a&&v.pixelStorei(v.UNPACK_SKIP_ROWS,0),u.bindTexture(y,fd.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,i,r,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor,u=this._deriveInternalFormat(),{context:d,pixelFormat:f,dataType:m,isImmutable:g,target:y}=c;if(g&&!this._wasImmutablyAllocated)throw new G("Cannot update immutable texture before allocation!");ZO(y)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=d.bindTexture(this,fd.TEXTURE_UNIT_FOR_UPDATES);d.setActiveTexture(fd.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||s<0||i+n>c.width||r+o>c.height||s+a>c.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:b}=d;if(nU(l))l=l.levels[e],b.compressedTexSubImage3D(y,e,i,r,s,n,o,a,u,l);else{const w=l;b.texSubImage3D(y,e,i,r,s,n,o,a,f,m,w)}d.bindTexture(v,fd.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new G("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,TF(e)}e.samplingMode===di.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=di.LINEAR_MIPMAP_NEAREST):e.samplingMode===di.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=di.NEAREST_MIPMAP_NEAREST);const i=this._descriptor.context.bindTexture(this,fd.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(fd.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(i,fd.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new G("Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,TF(e)}e.samplingMode===di.LINEAR_MIPMAP_NEAREST?(this._samplingModeDirty=!0,e.samplingMode=di.LINEAR):e.samplingMode===di.NEAREST_MIPMAP_NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=di.NEAREST)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,TF(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor,i=e.context.gl;this._samplingModeDirty&&(Epe(i,e),this._samplingModeDirty=!1),this._wrapModeDirty&&(Cpe(i,e),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(this._descriptor.internalFormat!=null)return this._descriptor.internalFormat===Ht.DEPTH_STENCIL&&(this._descriptor.internalFormat=Ht.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case fl.FLOAT:switch(this._descriptor.pixelFormat){case Ht.RGBA:return this._descriptor.internalFormat=xt.RGBA32F;case Ht.RGB:return this._descriptor.internalFormat=xt.RGB32F;default:throw new G("Unable to derive format")}case fl.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case Ht.RGBA:return this._descriptor.internalFormat=xt.RGBA8;case Ht.RGB:return this._descriptor.internalFormat=xt.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===Ht.DEPTH_STENCIL?Ht.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(e,i,r,s,n,o){const{gl:a}=this._descriptor.context;if(!$ct(i))throw new G("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?Ape(e,s,n,o):1;if(ZO(e)){if(o==null)throw new G("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,i,s,n,o)}else a.texStorage2D(e,l,i,s,n);this._wasImmutablyAllocated=!0}_texImage(e,i,r,s,n,o,a){const l=this._descriptor.context.gl,c=ZO(e),{isImmutable:u,pixelFormat:d,dataType:f}=this._descriptor;if(u){if(a!=null){const m=a;if(c){if(o==null)throw new G("Missing depth dimension for 3D texture upload");l.texSubImage3D(e,i,0,0,0,s,n,o,d,f,m)}else l.texSubImage2D(e,i,0,0,s,n,d,f,m)}}else{const m=a;if(c){if(o==null)throw new G("Missing depth dimension for 3D texture upload");l.texImage3D(e,i,r,s,n,o,0,d,f,m)}else l.texImage2D(e,i,r,s,n,0,d,f,m)}}_compressedTexImage(e,i,r,s,n,o,a){const l=this._descriptor.context.gl,c=ZO(e);if(this._descriptor.isImmutable){if(a!=null)if(c){if(o==null)throw new G("Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,i,0,0,0,s,n,o,r,a)}else l.compressedTexSubImage2D(e,i,0,0,s,n,r,a)}else if(c){if(o==null)throw new G("Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,i,r,s,n,o,0,a)}else l.compressedTexImage2D(e,i,r,s,n,0,a)}_forEachMipmapLevel(e,i=1/0){let{width:r,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===Ns.TEXTURE_3D;if(r==null||s==null||l&&n==null)throw new G("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,r,s,n),o&&(r!==1||s!==1||l&&n!==1)&&!(c>=i);++c)r=Math.max(1,r>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}};function TF(t){(t.width!=null&&t.width<0||t.height!=null&&t.height<0||t.depth!=null&&t.depth<0)&&console.error("Negative dimension parameters are not allowed!")}function Epe(t,e){let i=e.samplingMode,r=e.samplingMode;i===di.LINEAR_MIPMAP_NEAREST||i===di.LINEAR_MIPMAP_LINEAR?(i=di.LINEAR,e.hasMipmap||(r=di.LINEAR)):i!==di.NEAREST_MIPMAP_NEAREST&&i!==di.NEAREST_MIPMAP_LINEAR||(i=di.NEAREST,e.hasMipmap||(r=di.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,i),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,r)}function Cpe(t,e){typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function Rct(t,e){const i=t.capabilities.textureFilterAnisotropic;i&&t.gl.texParameterf(e.target,i.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}function $ct(t){return t in xt}function Ict(t){return t in Zs}function nU(t){return t!=null&&"type"in t&&t.type==="compressed"}function Lct(t){return t!=null&&"byteLength"in t}function Mpe(t){return t!=null&&!nU(t)&&!Lct(t)}function ZO(t){return t===Ns.TEXTURE_3D||t===Ns.TEXTURE_2D_ARRAY}function Ape(t,e,i,r=1){let s=Math.max(e,i);return t===Ns.TEXTURE_3D&&(s=Math.max(s,r)),Math.round(Math.log(s)/Math.LN2)+1}Er.TEXTURE_UNIT_FOR_UPDATES=0;function vy(t,e=zse,i=Ai,r=-1,s=1){let n=null;return e===DD?n=new Float32Array([r,r,0,0,s,r,1,0,r,s,0,1,s,s,1,1]):n=new Float32Array([r,r,s,r,r,s,s,s]),new _y(t,i,{geometry:e},{geometry:Sr.createVertex(t,cr.STATIC_DRAW,n)})}const Dct=4;function e$e(t){const e=new Xr(Dct);return e.samplingMode=di.NEAREST,new Er(t,e)}const Wz=16;function rb(t){return Math.ceil(t/Wz)*Wz}function t$e(t){return Math.floor(t/Wz)*Wz}function Nct(t,e){let n=t.width*t.height;if(n<4096)return t instanceof ImageData?i$e(t):t;let o=t.width,a=t.height;do o=Math.ceil(o/2),a=Math.ceil(a/2),n=o*a;while(n>1048576||e!=null&&(o>e||a>e));return Gse(t,o,a)}function Fct(t,e){const i=Math.max(t.width,t.height);if(i<=e)return t;const r=e/i;return Gse(t,Math.round(t.width*r),Math.round(t.height*r))}function Gse(t,e,i){if(t instanceof ImageData)return Gse(i$e(t),e,i);const r=document.createElement("canvas");return r.width=e,r.height=i,r.getContext("2d").drawImage(t,0,0,r.width,r.height),r}function i$e(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");if(i==null)throw new G("Failed to create 2d context from HTMLCanvasElement");return i.putImageData(t,0,0),e}function ka(t,e=!0){t.attributes.add(R.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(T`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?T`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let Hse=class extends Fr{};function r$e(t){const e=new Hi;e.include(ka),e.fragment.uniforms.add(new wt("colorTexture",r=>r.color),new wt("depthTexture",r=>r.depth));const i=t.haze;return e.fragment.code.add(T`
    void main() {
      float depthSample = texture(depthTexture, uv).r;
      if (depthSample ${i?T`== 1.0`:T`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(colorTexture, uv);
    }
    `),e}const kct=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:Hse,build:r$e},Symbol.toStringTag,{value:"Module"}));let bJ=class s$e extends Qi{initializeProgram(e){return new Ki(e.rctx,s$e.shader.get().build(this.configuration),Ai)}initializePipeline(){return this.configuration.haze?Jt({blending:ua(Be.ONE,Be.ZERO,Be.ONE_MINUS_SRC_COLOR,Be.ONE),depthTest:{func:br.ALWAYS},colorWrite:ui}):Jt({blending:Hh(Be.SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),depthTest:{func:br.ALWAYS},colorWrite:ui})}};bJ.shader=new qi(kct,()=>ce(()=>Promise.resolve().then(()=>lHt),void 0));let Uct=class{constructor(e,i){this._view=e,this._context=i,this.type=Ya.Realistic,this._handles=new ly,this._compositingPassParameters=new Hse,this._passParameters=new Ect,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=lr.radius,this._fadeHaze=0,this._updateRadius(lr.radius);const r=this._context.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([te(()=>{var n,o;return(o=(n=this._view)==null?void 0:n.basemapTerrain)==null?void 0:o.rootTileElevationBounds},()=>{var n;return(n=this._view)!=null&&n.basemapTerrain?this._updateRootTileElevationBounds():null}),te(()=>{var n,o;return(o=(n=this._view)==null?void 0:n.basemapTerrain)==null?void 0:o.visibleElevationBounds},()=>{var n;return(n=this._view)!=null&&n.basemapTerrain?this._updateVisibleElevationBounds():null}),te(()=>{var n;return(n=this._view)==null?void 0:n.environment.background},n=>{const o=n instanceof fMe?vL(n.color):Rh;de(this._passParameters.backgroundColor,o[0]*o[3],o[1]*o[3],o[2]*o[3])},hr)]);const s=new XRe;s.haze=!1,this._atmosphereTechnique=this._context.techniques.acquire(O$,s),this._compositingTechnique=this._context.techniques.acquire(bJ,s),s.haze=!0,this._atmosphereHazeTechnique=this._context.techniques.acquire(O$,s),this._compositingHazeTechnique=this._context.techniques.acquire(bJ,s),s.reduced=!0,s.haze=!1,this._atmosphereReducedTechnique=this._context.techniques.acquire(O$,s),s.haze=!0,this._atmosphereHazeReducedTechnique=this._context.techniques.acquire(O$,s),this._vao=vy(r,DD)}destroy(){this._handles.destroy(),this._compositingTechnique.release(),this._compositingHazeTechnique.release(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,i){this._render(e,i?this._atmosphereTechnique:this._atmosphereReducedTechnique,i,!1)}renderHaze(e,i,r){this._fadeHaze=i,this._render(e,r?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,r,!0)}_render(e,i,r,s){const n=e.bindParameters.mainDepth;if(!n)return;this._update(e.bindParameters.camera),this._passParameters.depthTexture=n;const o=e.rctx.bindTechnique(i,e.bindParameters,this._passParameters),a=e.offscreenRenderingHelper;if(r)a.renderDepthDetached(()=>this._renderCommon(o,e));else{const l=e.rctx.getViewport(),c=Ve(e.bindParameters.camera.eye)-lr.radius;let u;if(c<y1){const y=Math.min(1,Math.max(0,c/y1));u=s?Bt(.4,.5,y):Bt(.2,.3,y)}else{const y=Math.min(1,Math.max(0,(c-y1)/(15*y1)));u=s?Bt(.5,1,y):Bt(.3,.6,y)}const d=rb(Math.round(u*e.bindParameters.camera.fullViewport[2])),f=rb(Math.round(u*e.bindParameters.camera.fullViewport[3]));e.rctx.setViewport(0,0,d,f);const m=a.renderToCachedFBO(null,s?"chapman haze":"chapman",()=>this._renderCommon(o,e),[0,0,0,1],ss.RGBA,null,d,f);e.rctx.setViewport(l.x,l.y,l.width,l.height),this._compositingPassParameters.color=m.getTexture(),this._compositingPassParameters.depth=n;const g=s?this._compositingHazeTechnique:this._compositingTechnique;e.rctx.bindTechnique(g,e.bindParameters,this._compositingPassParameters),a.renderDepthDetached(()=>e.rctx.screen.draw()),m.release()}}_renderCommon(e,i){this._vao!=null&&(i.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.rctx.drawArrays(Ci.TRIANGLE_STRIP,0,4))}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=lr.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=Vct(lr.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,Li(this._passParameters.radii,e,e+y1),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-pJ)*pJ)}_update(e){if(!e)return;const i=sl(e.eye),r=Math.sqrt(i),s=i-this._passParameters.radii[1]*this._passParameters.radii[1],n=Ne((r-this._passParameters.radii[0])/y1,0,1);_s(this._passParameters.heightParameters,r,i,s,n),this._passParameters.altitudeFade=kse(r-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=Bt(Bt(.6,1,sL(9500,10500,r-lr.radius)),1,this._fadeHaze)}};function Vct(t){return t*Math.cos(Math.PI/16/16)}function qse(t){t.fragment.code.add(T`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function Wse(t,e){switch(t.include(Af,e),e.textureCoordinateType){case vs.Default:case vs.Compressed:return void t.fragment.code.add(T`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case vs.Atlas:return t.include(qse),void t.fragment.code.add(T`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:e.textureCoordinateType;case vs.None:case vs.COUNT:return}}let Dh=class extends Vs{constructor(e,i){super(e,"vec3",Zi.Draw,(r,s,n,o)=>r.setUniform3fv(e,i(s,n,o)))}},zg=class extends Vs{constructor(e,i){super(e,"sampler2D",Zi.Draw,(r,s,n)=>r.bindTexture(e,i(s,n)))}},ew=class{constructor(e){this._material=e.material,this._techniques=e.techniques,this._output=e.output}dispose(){this._techniques.release(this._technique)}get technique(){return this._technique}get _stippleTextures(){return this._techniques.constructionContext.stippleTextures}get _markerTextures(){return this._techniques.constructionContext.markerTextures}ensureTechnique(e,i){return this._technique=this._techniques.releaseAndAcquire(e,this._material.getConfiguration(this._output,i),this._technique),this._technique}ensureResources(e){return Rb.LOADED}},Zse=class extends ew{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textures=e.textures,this._textureId=e.textureId,this._acquire(e.textureId,i=>this._texture=i),this._acquire(e.normalTextureId,i=>this._textureNormal=i),this._acquire(e.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(e.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(e.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){this._texture=hi(this._texture),this._textureNormal=hi(this._textureNormal),this._textureEmissive=hi(this._textureEmissive),this._textureOcclusion=hi(this._textureOcclusion),this._textureMetallicRoughness=hi(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?Rb.LOADED:Rb.LOADING}get textureBindParameters(){return new n$e(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=hi(this._texture),this._textureId=e,this._acquire(this._textureId,i=>this._texture=i))}_acquire(e,i){if(e==null)return void i(null);const r=this._textures.acquire(e);if(Fu(r))return++this._numLoading,void r.then(s=>{if(this._disposed)return hi(s),void i(null);i(s)}).finally(()=>--this._numLoading);i(r)}},n$e=class extends Fr{constructor(e=null,i=null,r=null,s=null,n=null,o,a){super(),this.texture=e,this.textureNormal=i,this.textureEmissive=r,this.textureOcclusion=s,this.textureMetallicRoughness=n,this.scale=o,this.normalTextureTransformMatrix=a}};var At;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Simplified=5]="Simplified",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(At||(At={}));function Yse(t,e){const i=t.fragment,r=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===At.Normal&&r&&t.include(Wse,e),e.pbrMode!==At.Schematic)if(e.pbrMode!==At.Disabled){if(e.pbrMode===At.Normal){i.code.add(T`vec3 mrr;
vec3 emission;
float occlusion;`);const s=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(i.uniforms.add(s===Zi.Pass?new wt("texMetallicRoughness",n=>n.textureMetallicRoughness):new zg("texMetallicRoughness",n=>n.textureMetallicRoughness)),i.code.add(T`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(i.uniforms.add(s===Zi.Pass?new wt("texEmission",n=>n.textureEmissive):new zg("texEmission",n=>n.textureEmissive)),i.code.add(T`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),e.hasOcclusionTexture?(i.uniforms.add(s===Zi.Pass?new wt("texOcclusion",n=>n.textureOcclusion):new zg("texOcclusion",n=>n.textureOcclusion)),i.code.add(T`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(T`float getBakedOcclusion() { return 1.0; }`),s===Zi.Pass?i.uniforms.add(new Wt("emissionFactor",n=>n.emissiveFactor),new Wt("mrrFactors",n=>n.mrrFactors)):i.uniforms.add(new Dh("emissionFactor",n=>n.emissiveFactor),new Dh("mrrFactors",n=>n.mrrFactors)),i.code.add(T`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${e.hasMetallicRoughnessTexture?T`applyMetallnessAndRoughness(${e.hasMetallicRoughnessTextureTransform?T`metallicRoughnessUV`:"vuv0"});`:""}

      ${e.hasEmissionTexture?T`applyEmission(${e.hasEmissiveTextureTransform?T`emissiveUV`:"vuv0"});`:""}

      ${e.hasOcclusionTexture?T`applyOcclusion(${e.hasOcclusionTextureTransform?T`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else i.code.add(T`float getBakedOcclusion() { return 1.0; }`);else i.code.add(T`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function Xse(t,e){const i=t.fragment,r=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new Wt("lightingAmbientSH0",(s,n)=>de(Ppe,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),i.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add(new ji("lightingAmbientSH_R",(s,n)=>_s(Iy,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new ji("lightingAmbientSH_G",(s,n)=>_s(Iy,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new ji("lightingAmbientSH_B",(s,n)=>_s(Iy,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))),i.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add(new Wt("lightingAmbientSH0",(s,n)=>de(Ppe,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new ji("lightingAmbientSH_R1",(s,n)=>_s(Iy,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new ji("lightingAmbientSH_G1",(s,n)=>_s(Iy,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new ji("lightingAmbientSH_B1",(s,n)=>_s(Iy,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new ji("lightingAmbientSH_R2",(s,n)=>_s(Iy,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new ji("lightingAmbientSH_G2",(s,n)=>_s(Iy,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new ji("lightingAmbientSH_B2",(s,n)=>_s(Iy,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))),i.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==At.Normal&&e.pbrMode!==At.Schematic||i.code.add(T`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Ppe=E(),Iy=ci();function ND(t){t.vertex.code.add(T`const float PI = 3.141592653589793;`),t.fragment.code.add(T`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var Pg,JS;function zct(t){return(t==null?void 0:t.cubeMap)!=null}function Bct(t){return t!=null&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FADING=1]="FADING",t[t.FINISHED=2]="FINISHED"})(Pg||(Pg={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(JS||(JS={}));function M_(t=jct){return[t[0],t[1],t[2],t[3]]}function P8(t,e,i=M_()){return ve(i,t),i[3]=e,i}function Ope(t,e,i=ci()){return ft(i,t,e),Ce(i,i),i[3]=-vEe(t,e),i}function uYt(t,e=M_()){const i=IEe(R$,t);return o$e(e,La(OG(e,i))),e}function Rpe(t,e,i=M_()){return Nz(R$,t,$pe(t)),Nz(Ipe,e,$pe(e)),RG(R$,Ipe,R$),o$e(i,La(OG(i,R$)))}function hYt(t,e,i,r=M_()){return P8(cre,t,SF),P8(ure,e,Lpe),P8(DA,i,Dpe),Rpe(SF,Lpe,SF),Rpe(SF,Dpe,r),r}function dYt(t){return t}function pYt(t){return t[3]}function $pe(t){return kt(t[3])}function o$e(t,e){return t[3]=e,t}const jct=[0,0,1,0],R$=qh(),Ipe=qh();M_();const SF=M_(),Lpe=M_(),Dpe=M_();let Gct=class{constructor(){this.readChannels=JS.RG,this.renderingStage=Pg.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=E(),this.parallax=new Npe,this.parallaxNew=new Npe,this.pointOnGround=E(),this.fadeMode=Hr.HIDE,this.fadeFactor=0,this.opacity=0}updateParallax(e){const i=this.parallax,r=Ve(e.eye);if(i.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(r*r-lr.radius*lr.radius,0))/r,Ope(Fpe,i.anchorPointClouds,J2),Au(i.transform,Wr,J2[3],J2),this.fadeMode===Hr.CROSS_FADE){const s=this.parallaxNew;Ope(Fpe,s.anchorPointClouds,J2),Au(s.transform,Wr,J2[3],J2)}}updateFading(e,i,r,s){this.isFading&&this._advanceFading(r,s),this._evaluateFading(e,i,r)}_evaluateFading(e,i,r){const s=e.relativeElevation,n=this._calculateDistanceToAnchorPoint(e);if((s>1.7*R0||s<-R0||n>Yct)&&this.opacity>0)this._setFade(Hr.HIDE,r);else if(!this.isFading){if((s>R0||s<-.35*R0||n>Zct)&&this.opacity>0)this._setFade(Hr.FADE_OUT,r);else if(s<=R0&&s>=-.35*R0&&i===$i.IDLE&&Bct(this.data)){if(this.opacity===0)return void this._setFade(Hr.FADE_IN,r);(n>Wct||this.renderingStage===Pg.FADING)&&this._setFade(Hr.CROSS_FADE,r)}}}_advanceFading(e,i){this._switchReadChannels(),this._updateAnchorPoint(),this._advanceFadingFactorAndOpacity(e,i)}_advanceFadingFactorAndOpacity(e,i){if(this.fadeFactor<1)return this.fadeFactor=i?Ne((e-this.startTime)/(qct*i),0,1):1,this.fadeMode===Hr.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===Hr.FADE_IN&&(this.opacity=this.fadeFactor),void(this.fadeMode===Hr.CROSS_FADE&&(this.opacity=1));this.fadeFactor=0,this.fadeMode===Hr.FADE_OUT&&(this.opacity=0),this.fadeMode===Hr.FADE_IN&&(this.opacity=1),this.fadeMode===Hr.CROSS_FADE&&(this.opacity=1),this.fadeMode=Hr.NONE}_switchReadChannels(){const e=this.fadeMode===Hr.CROSS_FADE&&this.fadeFactor===1,i=this.fadeMode===Hr.FADE_IN&&this.fadeFactor===0;this.renderingStage===Pg.FADING&&(e||i)&&(this.readChannels=1-this.readChannels,this.renderingStage=Pg.FINISHED)}_calculateDistanceToAnchorPoint(e){return Ce(this.pointOnGround,e.eye),he(this.pointOnGround,this.pointOnGround,lr.radius),Ve(Re(Hct,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===Hr.CROSS_FADE&&(this.fadeFactor===0&&ve(this.parallaxNew.anchorPointClouds,this.pointOnGround),this.fadeFactor===1&&ve(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds)),this.fadeMode===Hr.FADE_IN&&this.fadeFactor===0&&ve(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(e,i){switch(e){case Hr.HIDE:this.opacity=0;break;case Hr.FADE_OUT:this.opacity=1;break;case Hr.FADE_IN:this.opacity=0;break;case Hr.CROSS_FADE:this.opacity=1}this.fadeMode=e,this.fadeFactor=0,this.startTime=i}get isFading(){return this.fadeMode===Hr.FADE_OUT||this.fadeMode===Hr.FADE_IN||this.fadeMode===Hr.CROSS_FADE}};var Hr;(function(t){t[t.NONE=0]="NONE",t[t.HIDE=1]="HIDE",t[t.FADE_OUT=2]="FADE_OUT",t[t.FADE_IN=3]="FADE_IN",t[t.CROSS_FADE=4]="CROSS_FADE"})(Hr||(Hr={}));let Npe=class{constructor(){this.anchorPointClouds=E(),this.radiusCurvatureCorrectionFactor=0,this.transform=ke()}};const Fpe=Ge(0,0,1),J2=M_(),Hct=E(),qct=1.25,Wct=34e3,Zct=64e3,Yct=2e5;let Bg=class extends Vs{constructor(e,i){super(e,"bool",Zi.Pass,(r,s,n)=>r.setUniform1b(e,i(s,n)))}},Xct=class extends Vs{constructor(e,i){super(e,"samplerCube",Zi.Pass,(r,s,n)=>r.bindTexture(e,i(s,n)))}};function a$e(t){const e=t.fragment;e.uniforms.add(new us("rotationMatrixClouds",(i,r)=>r.cloudsFade.parallax.transform),new us("rotationMatrixCloudsCrossFade",(i,r)=>r.cloudsFade.parallaxNew.transform),new Wt("anchorPosition",(i,r)=>r.cloudsFade.parallax.anchorPointClouds),new Wt("anchorPositionCrossFade",(i,r)=>r.cloudsFade.parallaxNew.anchorPointClouds),new et("cloudsHeight",()=>mQe),new et("radiusCurvatureCorrectionFactor",(i,r)=>r.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new et("totalFadeInOut",(i,r)=>1-r.cloudsFade.opacity),new et("crossFadeAnchorFactor",(i,r)=>Ne(r.cloudsFade.fadeFactor,0,1)),new Xct("cubeMap",(i,r)=>{var s,n;return((n=(s=r.cloudsFade.data)==null?void 0:s.cubeMap)==null?void 0:n.colorTexture)??null}),new Bg("crossFade",(i,r)=>r.cloudsFade.fadeMode===Hr.CROSS_FADE),new Bg("readChannelsRG",(i,r)=>r.cloudsFade.readChannels===JS.RG),new Bg("fadeTextureChannels",(i,r)=>r.cloudsFade.renderingStage===Pg.FADING)),e.constants.add("planetRadius","float",lr.radius),e.code.add(T`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(T`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(T`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),C_(e),my(e),e.code.add(T`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(T`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(T`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(T`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(T`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function by(t){t.code.add(T`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function l$e(){const t=new Hi,{attributes:e,varyings:i,vertex:r,fragment:s}=t;return e.add(R.POSITION,"vec2"),i.add("worldRay","vec3"),r.uniforms.add(new us("inverseProjectionMatrix",(n,o)=>o.camera.inverseProjectionMatrix),new us("inverseViewMatrix",(n,o)=>Hb(Jct,o.camera.viewMatrix))),r.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),s.include(by),s.include(rm),t.include(Xse,{pbrMode:At.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(ND),t.include(qG),t.include(Gz),t.include(a$e),s.uniforms.add(new Wt("cameraPosition",(n,o)=>o.camera.eye)),s.code.add(T`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const Jct=ke(),Qct=Object.freeze(Object.defineProperty({__proto__:null,build:l$e},Symbol.toStringTag,{value:"Module"}));let c$e=class u$e extends Qi{constructor(e){super(e,new tc,()=>this.destroy())}initializeProgram(e){return new Ki(e.rctx,u$e.shader.get().build(),Ai)}initializePipeline(){return Jt({blending:ua(Be.ONE,Be.ZERO,Be.SRC_ALPHA,Be.ONE),depthTest:{func:br.LEQUAL},colorWrite:ui})}};c$e.shader=new qi(Qct,()=>ce(()=>Promise.resolve().then(()=>cHt),void 0));let Nx=class extends Ue{constructor(e){super(e),this._technique=new c$e(e),this._vao=vy(e.rctx)}destroy(){this._technique=hi(this._technique),this._vao=Ut(this._vao)}render(e){if(!this._technique.compiled)return void this.requestRender();const i=e.bindParameters.cloudsFade;if(this._vao==null||i.data==null)return;const r=e.rctx.bindTechnique(this._technique,e.bindParameters,Kct);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Ci.TRIANGLE_STRIP,0,4)}};h([p({constructOnly:!0})],Nx.prototype,"rctx",void 0),h([p({constructOnly:!0})],Nx.prototype,"viewingMode",void 0),h([p({constructOnly:!0})],Nx.prototype,"planetRadius",void 0),h([p({constructOnly:!0})],Nx.prototype,"requestRender",void 0),Nx=h([I("esri.views.3d.environment.CloudsComposition")],Nx);const Kct=new Fr;function wu(){return new Float32Array(3)}function wJ(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Pr(t,e,i){const r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=i,r}function eut(t,e){return new Float32Array(t,e,3)}function Jse(){return wu()}function h$e(){return Pr(1,1,1)}function d$e(){return Pr(1,0,0)}function p$e(){return Pr(0,1,0)}function f$e(){return Pr(0,0,1)}const tut=Jse(),iut=h$e(),rut=d$e(),sut=p$e(),nut=f$e();Object.freeze(Object.defineProperty({__proto__:null,ONES:iut,UNIT_X:rut,UNIT_Y:sut,UNIT_Z:nut,ZEROS:tut,clone:wJ,create:wu,createView:eut,fromValues:Pr,ones:h$e,unitX:d$e,unitY:p$e,unitZ:f$e,zeros:Jse},Symbol.toStringTag,{value:"Module"}));var Dc;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(Dc||(Dc={}));let oU=class extends tc{constructor(){super(...arguments),this.steps=Dc.SIXTEEN,this.writeTextureChannels=JS.RG}};h([B({count:Dc.COUNT})],oU.prototype,"steps",void 0),h([B({constValue:le("esri-mobile")?1024:2048})],oU.prototype,"cubeMapSize",void 0),h([B()],oU.prototype,"writeTextureChannels",void 0);let $$=class{constructor(e,i,r,s,n,o,a,l,c=.5){this.coverage=e,this.density=i,this.absorption=r,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const kpe=new $$([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Dc.SIXTEEN),Za={sunny:kpe,cloudy:new $$([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Dc.TWOHUNDRED,.6),rainy:new $$([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Dc.TWOHUNDRED,.4),snowy:new $$([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Dc.HUNDRED,.65),foggy:new $$([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Dc.SIXTEEN),default:kpe},Rd=le("esri-mobile")?64:128,out=Rd/128,Kp=Math.ceil(Math.sqrt(Rd)),sb=(Rd+2)*Kp,aut=1e5,O8=128,lut=sb/1560;let cp=class extends Vs{constructor(e,i){super(e,"mat3",Zi.Pass,(r,s,n)=>r.setUniformMatrix3fv(e,i(s,n)))}},Qse=class extends Fr{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=Za.default.raymarchingSteps,this.weatherTile=mt(),this.viewMatrix=Yr()}};function m$e(t){const e=new Hi;e.include(ka,!1);const i=e.fragment;return i.uniforms.add(new et("cloudRadius",r=>r.cloudRadius),new et("power",r=>Bt(35,120,r.absorption)),new et("sigmaE",r=>1+r.absorption),new et("density",r=>Bt(0,.3,r.density)),new et("cloudSize",r=>Bt(0,.02,Math.max(.01,1-r.cloudSize))),new et("detailSize",r=>Bt(0,.2,Math.max(.01,1-r.detailSize))),new et("smoothness",r=>Bt(0,.5,1-r.smoothness)),new et("cloudHeight",r=>Bt(0,1500,r.cloudHeight)),new et("coverage",r=>r.coverage),new cp("view",r=>r.viewMatrix),new wt("cloudShapeTexture",r=>r.noiseTexture!=null?r.noiseTexture.textureAtlas:null),new jr("cloudVariables",r=>Li(cut,r.coverage,r.absorption))),i.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),i.code.add(T`
    const int STEPS = ${t.steps===Dc.SIXTEEN?T`16`:t.steps===Dc.HUNDRED?T`100`:T`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),i.code.add(T`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${T.float(sb)};
      const float dataWidth = ${T.float(sb)};
      const float tileRows = ${T.float(Kp)};
      const vec3 atlasDimensions = vec3(${T.float(Rd)}, ${T.float(Rd)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${T.float(out)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${T.float(lut)} * p) / ${T.float(sb)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),i.code.add(T`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),i.code.add(T`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),i.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),i.code.add(T`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),i.code.add(T`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),i.code.add(T`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const cut=mt(),uut=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:Qse,build:m$e},Symbol.toStringTag,{value:"Module"}));let g$e=class y$e extends Qi{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new Ki(e.rctx,y$e.shader.get().build(this.configuration),Ai)}initializePipeline(){return Jt({blending:Hh(Be.CONSTANT_COLOR,Be.ONE_MINUS_CONSTANT_COLOR,h_.ADD,this.configuration.writeTextureChannels===JS.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:br.LEQUAL},colorWrite:ui})}};g$e.shader=new qi(uut,()=>ce(()=>Promise.resolve().then(()=>uHt),void 0));var wh;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(wh||(wh={}));let xJ=class extends tc{constructor(){super(...arguments),this.mode=wh.Full}};h([B({count:wh.COUNT})],xJ.prototype,"mode",void 0);let Kse=class extends Fr{constructor(){super(...arguments),this.weatherTile=Ei(0,0)}};function _$e(t){const e=new Hi;return e.include(ka,!1),e.fragment.code.add(T`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===wh.Full&&e.fragment.code.add(T`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${T.float(Kp)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${T.float(8)});

      float worley0 = worley(p, ${T.float(2)} * 2.0);
      float worley1 = worley(p, ${T.float(2)} * 8.0);
      float worley2 = worley(p, ${T.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${T.float(2)});
      float worley1 = worley(p, ${T.float(2)} * 2.0);
      float worley2 = worley(p, ${T.float(2)} * 4.0);
      float worley3 = worley(p, ${T.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new jr("weatherTile",i=>i.weatherTile)),e.fragment.code.add(T`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${T.float(O8)});

      // Get global coordinates of p
      p += weatherTile * ${T.float(O8)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${T.float(aut)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(T`void main() {`),t.mode===wh.Full&&e.fragment.code.add(T`
        float padWidth = 1.0;
        float paddedSize = ${T.float(Rd)} + 2.0 * padWidth;
        float tileCount = ${T.float(Kp)} * ${T.float(Kp)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${T.float(Rd)};
          }

          if (startPadY) {
            pixel.y += ${T.float(Rd)};
          }

          if (endPadX) {
            pixel.x -= ${T.float(Rd)};
          }

          if (endPadY) {
            pixel.y -= ${T.float(Rd)};
          }

          uv = vec2(pixel.xy / ${T.float(Rd)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${T.float(Rd)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${T.float(Kp)} * ${T.float(Kp)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${T.float(Kp)} * ${T.float(Kp)});
        p = p_;
        p.z /= (${T.float(Kp)} * ${T.float(Kp)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(T`
      vec2 mapUV = ${T.float(O8)} * (gl_FragCoord.xy / ${T.float(sb)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===wh.Full?T`fragColor.ba = vec2(0.0, map);`:T`fragColor = vec4(map);`};
    }
  `),e}const hut=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:Kse,build:_$e},Symbol.toStringTag,{value:"Module"}));let TJ=class v$e extends Qi{initializeProgram(e){return new Ki(e.rctx,v$e.shader.get().build(this.configuration),Ai)}initializePipeline(){return Jt({blending:this.configuration.mode===wh.Full?Hh(Be.ONE,Be.ZERO):ua(Be.ZERO,Be.ONE,Be.ONE,Be.ZERO),depthTest:{func:br.ALWAYS},colorWrite:ui})}};TJ.shader=new qi(hut,()=>ce(()=>Promise.resolve().then(()=>hHt),void 0));let b$e=class{constructor(e,i,r=i){this.internalFormat=e,this.width=i,this.height=r,this.multisampled=!1,this.samples=1}};function dut(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*jse(t.internalFormat)}let w$e=class{constructor(e,i){this._context=e,this._descriptor=i,this.type=p_.RenderBuffer,this._context.instanceCounter.increment(an.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=i;a?r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,s,n):r.renderbufferStorage(r.RENDERBUFFER,o,s,n),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,i=this._context.parameters.maxSamples;return e?Math.min(e,i):i}get usedMemory(){return dut(this._descriptor)}resize(e,i){const r=this._descriptor;if(r.width===e&&r.height===i)return;r.width=e,r.height=i;const s=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):s.renderbufferStorage(s.RENDERBUFFER,r.internalFormat,r.width,r.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(an.Renderbuffer,this),this._context=null)}};const put=()=>se.getLogger("esri.views.webgl.FramebufferObject");let wy=class I${constructor(e,i,r=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(an.FramebufferObject,this);const s=aU(i)?i:new Er(this._context,i);if(this._colorAttachments.set(Gn.COLOR_ATTACHMENT0,s),this._validateTextureDescriptor(s.descriptor),this._validateColorAttachmentPoint(Gn.COLOR_ATTACHMENT0),r!=null)if(mut(r))this._depthStencilTexture=aU(r)?r:new Er(this._context,r),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const n=fut(r)?r:new w$e(this._context,r);this._depthStencilBuffer=n,this._validateRenderBufferDescriptor(n.descriptor)}}dispose(){var i,r;if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((s,n)=>{var o;return(o=this.detachColorTexture(n))==null?void 0:o.dispose()}),(i=this.detachDepthStencilBuffer())==null||i.dispose(),(r=this.detachDepthStencilTexture())==null||r.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(an.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(Gn.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){var i;const e=this._colorAttachments.get(Gn.COLOR_ATTACHMENT0);return((i=e==null?void 0:e.descriptor)==null?void 0:i.width)??0}get height(){var i;const e=this._colorAttachments.get(Gn.COLOR_ATTACHMENT0);return((i=e==null?void 0:e.descriptor)==null?void 0:i.height)??0}get usedMemory(){var e;return[...this._colorAttachments].reduce((i,[r,s])=>i+s.usedMemory,((e=this.depthStencil)==null?void 0:e.usedMemory)??0)}getColorTexture(e){const i=this._colorAttachments.get(e);return i&&aU(i)?i:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,i=Gn.COLOR_ATTACHMENT0){var s;if(!e)return;this._validateColorAttachmentPoint(i);const r=e.descriptor;this._validateTextureDescriptor(r),(s=this.detachColorTexture(i))==null||s.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,i)),this._colorAttachments.set(i,e)}detachColorTexture(e=Gn.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(e);if(i){if(this._initialized){const r=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e),this._context.bindFramebuffer(r)}return this._colorAttachments.delete(e),i}}setColorTextureTarget(e,i=Gn.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);r&&this._framebufferTexture2D(r.glName,i,e)}attachDepthStencil(e){if(e)switch(e.type){case p_.Texture:return this._attachDepthStencilTexture(e);case p_.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){var r;if(e==null)return;const i=e.descriptor;i.pixelFormat!==Ht.DEPTH_STENCIL&&i.pixelFormat!==Ht.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==fl.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._validateTextureDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,cP)),(r=this._depthStencilTexture)==null||r.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;if(e&&this._initialized){const i=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,cP),this._context.bindFramebuffer(i)}return this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(e==null)return;const i=e.descriptor;if(this._validateRenderBufferDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,s=this._getGLAttachmentPoint(i);r.framebufferRenderbuffer(Qa.FRAMEBUFFER,s,r.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){const i=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);const r=this._context.gl,s=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(Qa.FRAMEBUFFER,s,r.RENDERBUFFER,null),this._context.bindFramebuffer(i)}return this._depthStencilBuffer=null,e}copyToTexture(e,i,r,s,n,o,a){(e<0||i<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==Ns.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||e+r>this.width||i+s>this.height||n+r>l.width||o+s>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,u=c.bindTexture(a,Er.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(Er.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(Ns.TEXTURE_2D,0,n,o,e,i,r,s),c.bindTexture(u,Er.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,i,r,s,n,o,a){(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,i,r,s,n,o,a)}async readPixelsAsync(e,i,r,s,n,o,a){const{gl:l}=this._context,c=Sr.createPixelPack(this._context,cr.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,i,r,s,n,o,0),this._context.unbindBuffer(Rt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,i){var s,n;if(this.width===e&&this.height===i)return;const r={width:e,height:i};FT(r,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(o=>o.resize(r.width,r.height)),(s=this._depthStencilTexture)==null||s.resize(r.width,r.height),this._initialized&&(FT(r,this._context.parameters.maxRenderbufferSize),(n=this._depthStencilBuffer)==null||n.resize(r.width,r.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=Qa.FRAMEBUFFER){const i=this._context.gl;if(this._initialized)return void i.bindFramebuffer(e,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=i.createFramebuffer();if(i.bindFramebuffer(e,r),this._colorAttachments.forEach((s,n)=>this._framebufferTexture2D(s.glName,n,Upe(s),e)),this._depthStencilBuffer){const s=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);i.framebufferRenderbuffer(e,s,i.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,i.DEPTH_STENCIL_ATTACHMENT,Upe(this._depthStencilTexture),e);af()&&i.checkFramebufferStatus(e)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=r,this._initialized=!0}_framebufferTexture2D(e,i=Gn.COLOR_ATTACHMENT0,r=Ns.TEXTURE_2D,s=Qa.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,i,r,e,n)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const i=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(Qa.FRAMEBUFFER,i,e.RENDERBUFFER,null)}this._depthStencilBuffer=Ut(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=Ut(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==Ns.TEXTURE_2D&&e.target!==Ns.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),FT(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){FT(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case Ea.DEPTH_COMPONENT16:case Ea.DEPTH_COMPONENT24:case Ea.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case Ea.DEPTH24_STENCIL8:case Ea.DEPTH32F_STENCIL8:case Ea.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case Ea.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(I$._MAX_COLOR_ATTACHMENTS===-1){const{gl:r}=this._context;I$._MAX_COLOR_ATTACHMENTS=r.getParameter(r.MAX_COLOR_ATTACHMENTS)}const i=e-Gn.COLOR_ATTACHMENT0;i+1>I$._MAX_COLOR_ATTACHMENTS&&se.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${I$._MAX_COLOR_ATTACHMENTS} color attachments`)}};function aU(t){return t!=null&&"type"in t&&t.type===p_.Texture}function fut(t){return t!=null&&"type"in t&&t.type===p_.RenderBuffer}function mut(t){return aU(t)||t!=null&&"pixelFormat"in t}function FT(t,e){const i=Math.max(t.width,t.height);if(i>e){put().warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const r=e/i;return t.width=Math.round(t.width*r),t.height=Math.round(t.height*r),!1}return!0}function Upe(t){return t.descriptor.target===Ns.TEXTURE_CUBE_MAP?Ns.TEXTURE_CUBE_MAP_POSITIVE_X:Ns.TEXTURE_2D}wy._MAX_COLOR_ATTACHMENTS=-1;let L$=class extends Ue{constructor(e){super(e),this._needsRender=!0,this._passParameters=new Kse,this._fbo=new wy(e.context.renderContext.rctx,new Xr(sb)),this._vao=vy(e.context.renderContext.rctx)}get _techniques(){return this.context.techniques}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(wh.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render(wh.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(Da(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=hi(this._fullTechniqueCached),this._weatherMapTechniqueCached=hi(this._weatherMapTechniqueCached),this._fbo=Ut(this._fbo),this._vao=Ut(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new xJ;e.mode=wh.Full,this._fullTechniqueCached=this._techniques.acquire(TJ,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new xJ;e.mode=wh.WeatherMap,this._weatherMapTechniqueCached=this._techniques.acquire(TJ,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._fbo==null)return null;const i=e===wh.Full?this._fullTechnique:this._weatherMapTechnique,r=this.context.renderContext.rctx,s=r.getViewport();r.setViewport(0,0,sb,sb),r.bindFramebuffer(this._fbo);const n=r.bindTechnique(i,null,this._passParameters);return r.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._fbo.colorTexture}};h([p({constructOnly:!0})],L$.prototype,"context",void 0),h([p({readOnly:!0})],L$.prototype,"_techniques",null),L$=h([I("esri.views.3d.environment.NoiseTextureAtlas")],L$);function ZG(t){return t?{ray:lo(t.ray),c0:t.c0,c1:t.c1}:{ray:lo(),c0:0,c1:Number.MAX_VALUE}}function gut(t,e=ZG()){return Oz(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function yut(t,e,i=ZG()){const r=Ve(t.vector);return eAe(t.origin,e,i.ray),i.c0=0,i.c1=r,i}function AYt(t,e){return x$e(t,t.c0,e)}function PYt(t,e){return x$e(t,t.c1,e)}function x$e(t,e,i){return Ee(i,t.ray.origin,he(i,t.ray.direction,e))}new x_(()=>ZG());function wL(t){return t?[tr(t[0]),tr(t[1]),tr(t[2]),tr(t[3]),tr(t[4]),tr(t[5])]:[tr(),tr(),tr(),tr(),tr(),tr()]}function T$e(){return[E(),E(),E(),E(),E(),E(),E(),E()]}function Zz(t,e){for(let i=0;i<iO;i++)yG(t[i],e[i]);return t}function S$e(t,e,i,r=Tut){const s=gr(Nre.get(),e,t);Zn(s,s);for(let n=0;n<wut;++n){const o=Pu(Dre.get(),xut[n],s);de(r[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}E$e(i,r)}function E$e(t,e){il(e[_t.FAR_BOTTOM_LEFT],e[_t.NEAR_BOTTOM_LEFT],e[_t.NEAR_TOP_LEFT],t[Tr.LEFT]),il(e[_t.NEAR_BOTTOM_RIGHT],e[_t.FAR_BOTTOM_RIGHT],e[_t.FAR_TOP_RIGHT],t[Tr.RIGHT]),il(e[_t.FAR_BOTTOM_LEFT],e[_t.FAR_BOTTOM_RIGHT],e[_t.NEAR_BOTTOM_RIGHT],t[Tr.BOTTOM]),il(e[_t.NEAR_TOP_LEFT],e[_t.NEAR_TOP_RIGHT],e[_t.FAR_TOP_RIGHT],t[Tr.TOP]),il(e[_t.NEAR_BOTTOM_LEFT],e[_t.NEAR_BOTTOM_RIGHT],e[_t.NEAR_TOP_RIGHT],t[Tr.NEAR]),il(e[_t.FAR_BOTTOM_RIGHT],e[_t.FAR_BOTTOM_LEFT],e[_t.FAR_TOP_LEFT],t[Tr.FAR])}function B1(t,e){for(let i=0;i<iO;i++){const r=t[i];if(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=e[3])return!1}return!0}function _ut(t,e){return M$e(t,gut(e,A$e.get()))}function OYt(t,e){for(let i=0;i<iO;i++){const r=t[i];if(!iet(r,e))return!1}return!0}function vut(t,e,i){return M$e(t,yut(e,i,A$e.get()))}function C$e(t,e){for(let i=0;i<iO;i++)if(Or(t[i],e)>0)return!1;return!0}function M$e(t,e){for(let i=0;i<iO;i++)if(!tet(t[i],e))return!1;return!0}var Tr,_t;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(Tr||(Tr={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(_t||(_t={}));const but={bottom:[_t.FAR_BOTTOM_RIGHT,_t.NEAR_BOTTOM_RIGHT,_t.NEAR_BOTTOM_LEFT,_t.FAR_BOTTOM_LEFT],near:[_t.NEAR_BOTTOM_LEFT,_t.NEAR_BOTTOM_RIGHT,_t.NEAR_TOP_RIGHT,_t.NEAR_TOP_LEFT],far:[_t.FAR_BOTTOM_RIGHT,_t.FAR_BOTTOM_LEFT,_t.FAR_TOP_LEFT,_t.FAR_TOP_RIGHT],right:[_t.NEAR_BOTTOM_RIGHT,_t.FAR_BOTTOM_RIGHT,_t.FAR_TOP_RIGHT,_t.NEAR_TOP_RIGHT],left:[_t.FAR_BOTTOM_LEFT,_t.NEAR_BOTTOM_LEFT,_t.NEAR_TOP_LEFT,_t.FAR_TOP_LEFT],top:[_t.FAR_TOP_LEFT,_t.NEAR_TOP_LEFT,_t.NEAR_TOP_RIGHT,_t.FAR_TOP_RIGHT]},iO=6,wut=8,xut=[ii(-1,-1,-1,1),ii(1,-1,-1,1),ii(1,1,-1,1),ii(-1,1,-1,1),ii(-1,-1,1,1),ii(1,-1,1,1),ii(1,1,1,1),ii(-1,1,1,1)],A$e=new x_(ZG),Tut=T$e();function Sut(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}function Eut(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}function Cut(t,e,i){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}function Mut(t,e,i){return 2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}let SJ=class{constructor(){this.adds=new ai,this.removes=new ai,this.updates=new ai({allocator:e=>e||new Aut,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},Aut=class{},Put=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var pf,gi;function P$e(t){const e=new Map,i=r=>{let s=e.get(r);return s||(s=new Put,e.set(r,s)),s};return t.removes.forAll(r=>{R8(r)&&i(r.material).removes.push(r)}),t.adds.forAll(r=>{R8(r)&&i(r.material).adds.push(r)}),t.updates.forAll(r=>{R8(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),e}function R8(t){return t.geometry.indexCount>=1}(function(t){t[t.Default=0]="Default",t[t.Screenshot=1]="Screenshot",t[t.ObjectAndLayerID=2]="ObjectAndLayerID"})(pf||(pf={})),function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"}(gi||(gi={}));var EJ;let mi=EJ=class extends Ue{constructor(t){super(t),this._ray=lo(),this._viewport=ii(0,0,1,1),this._padding=ii(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Ei(1,1e3),this._viewDirty=!0,this._viewMatrix=ke(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=ke(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=ke(),this._frustumDirty=!0,this._frustum=wL(),this._fullViewport=ci(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=E(),this._up=E(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get rows(){return this._rows}set rows(t){this._rows=Math.max(1,t)}get columns(){return this._columns}set columns(t){this._columns=Math.max(1,t)}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return Re(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){xn(this._viewMatrix,t),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),de(E(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),de(E(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),de(E(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=GS(ci(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&HS(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=GS(ci(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&HS(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[gi.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[gi.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[gi.RIGHT]+this._padding[gi.LEFT]}set fullWidth(t){this.width=t-(this._padding[gi.RIGHT]+this._padding[gi.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[gi.TOP]+this._padding[gi.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[gi.TOP]+this._padding[gi.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[gi.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[gi.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){YM(this._padding,t)||(this._viewport[0]+=t[gi.LEFT]-this._padding[gi.LEFT],this._viewport[1]+=t[gi.BOTTOM]-this._padding[gi.BOTTOM],this._viewport[2]-=t[gi.RIGHT]+t[gi.LEFT]-(this._padding[gi.RIGHT]+this._padding[gi.LEFT]),this._viewport[3]-=t[gi.TOP]+t[gi.BOTTOM]-(this._padding[gi.TOP]+this._padding[gi.BOTTOM]),Hd(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(gr(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return Zn(ke(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||ke()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Cut(this._fov,this.width,this.height)}set fovX(t){this._fov=Sut(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Mut(this._fov,this.width,this.height)}set fovY(t){this._fov=Eut(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Cr(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Zn(this._viewInverseTransposeMatrix,this.viewMatrix),Lu(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}get _projectionMatrixInternal(){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2)*2,r=i*this._aspect,s=i/this.rows,n=r/this.columns,o=-r/2+this.column*n,a=o+n,l=-i/2+this.row*s,c=l+s,u=LEe(ke(),o*(1+2*this._padding[gi.LEFT]/t),a*(1+2*this._padding[gi.RIGHT]/t),l*(1+2*this._padding[gi.BOTTOM]/e),c*(1+2*this._padding[gi.TOP]/e),this.near,this.far),d=this._get("projectionMatrix");return d&&eG(d,u)?d:u}copyFrom(t){ve(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,Hd(this._viewport,t.viewport),this.notifyChange("_viewport"),Hd(this._padding,t.padding),this.notifyChange("_padding"),Da(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.row=t.row,this.column=t.column,this.rows=t.rows,this.columns=t.columns,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(xn(this._viewMatrix,t.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(Zz(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(xn(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Hd(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new EJ().copyFrom(this)}equals(t){return $o(this.eye,t.eye)&&$o(this.center,t.center)&&$o(this.up,t.up)&&YM(this._viewport,t.viewport)&&YM(this._padding,t.padding)&&ORe(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation&&this.row===t.row&&this.column===t.column&&this.rows===t.rows&&this.columns===t.columns}almostEquals(t){const e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||Az(t.screenPadding,this.screenPadding)>=e||Az(this.screenViewport,t.screenViewport)>=e||this.row!==t.row||this.column!==t.column||this.rows!==t.rows||this.columns!==t.columns)return!1;Ii(Va,t.eye,t.center),Ii($8,this.eye,this.center);const i=Te(Va,$8),r=dz(Va),s=dz($8),n=5e-4;return i*i>=(1-1e-10)*r*s&&iL(t.eye,this.eye)<Math.max(r,s)*n*n}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(K1(this.viewForward,Re(Va,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=Ss()){return t[0]=(this.padding[gi.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[gi.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t[0]=this.padding[gi.LEFT]+this.width*e,t[1]=this.padding[gi.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==Ui&&ve(Ui,t),Ui[3]=1,Pu(Ui,Ui,this.projectionMatrix);const i=Math.abs(Ui[3]);he(Ui,Ui,1/i);const r=this.fullViewport;e[0]=Bt(0,r[0]+r[2],.5+.5*Ui[0]),e[1]=Bt(0,r[1]+r[3],.5+.5*Ui[1]),e[2]=.5*(Ui[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;Ui[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],Ui[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],Ui[2]=(2*t[2]-1)*t[3],Ui[3]=t[3],this.inverseProjectionMatrix!=null&&(Pu(Ui,Ui,this.inverseProjectionMatrix),e[0]=Ui[0],e[1]=Ui[1],e[2]=Ui[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,I8),this.renderToScreen(I8,e),e}projectToRenderScreen(t,e){if(Ui[0]=t[0],Ui[1]=t[1],Ui[2]=t[2],Ui[3]=1,Pu(Ui,Ui,this.viewProjectionMatrix),Ui[3]===0)return null;const i=Ui;he(i,i,1/Math.abs(Ui[3]));const r=this.fullViewport,s=Bt(0,r[0]+r[2],.5+.5*i[0]),n=Bt(0,r[1]+r[3],.5+.5*i[1]);return"x"in e?(e.x=s,e.y=n):(e[0]=s,e[1]=n,e.length>2&&(e[2]=.5*(i[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,I8),e)}unprojectFromRenderScreen(t,e){if(gr(EF,this.projectionMatrix,this.viewMatrix),!Zn(EF,EF))return null;const i=this.fullViewport;return Ui[0]=2*(t[0]-i[0])/i[2]-1,Ui[1]=2*(t[1]-i[1])/i[3]-1,Ui[2]=2*t[2]-1,Ui[3]=1,Pu(Ui,Ui,EF),Ui[3]===0?null:(e[0]=Ui[0]/Ui[3],e[1]=Ui[1]/Ui[3],e[2]=Ui[2]/Ui[3],e)}constrainWindowSize(t,e,i,r){const s=t*this.pixelRatio,n=e*this.pixelRatio,o=Math.max(s-i/2,0),a=Math.max(this.fullHeight-n-r/2,0),l=-Math.min(s-i/2,0),c=-Math.min(this.fullHeight-n-r/2,0),u=i-l- -Math.min(this.fullWidth-s-i/2,0),d=r-c- -Math.min(n-r/2,0);return[Math.round(o),Math.round(a),Math.round(u),Math.round(d)]}computeUp(t){t===Xe.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=r}_computeUpGlobal(){Re(Va,this.center,this.eye);const t=Ve(this.center);t<1?(de(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(Te(Va,this.center))>.9999*Ve(Va)*t||(ft(this._up,Va,this.center),ft(this._up,this._up,Va),Ce(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){v_(Va,this.eye,this.center),Math.abs(Va[2])<=.9999&&(he(Va,Va,Va[2]),de(this._up,-Va[0],-Va[1],1-Va[2]),Ce(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,i=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?$o(t,e)||(ve(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):se.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(S$e(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(Kj(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};h([p()],mi.prototype,"_viewport",void 0),h([p()],mi.prototype,"_padding",void 0),h([p()],mi.prototype,"_fov",void 0),h([p()],mi.prototype,"_nearFar",void 0),h([p()],mi.prototype,"_viewDirty",void 0),h([p()],mi.prototype,"_viewMatrix",void 0),h([p()],mi.prototype,"_pixelRatio",void 0),h([p()],mi.prototype,"pixelRatio",null),h([p()],mi.prototype,"row",void 0),h([p()],mi.prototype,"column",void 0),h([p()],mi.prototype,"_rows",void 0),h([p()],mi.prototype,"rows",null),h([p()],mi.prototype,"_columns",void 0),h([p()],mi.prototype,"columns",null),h([p()],mi.prototype,"eye",null),h([p()],mi.prototype,"center",null),h([p()],mi.prototype,"_center",void 0),h([p()],mi.prototype,"up",null),h([p()],mi.prototype,"_up",void 0),h([p()],mi.prototype,"viewMatrix",null),h([p({readOnly:!0})],mi.prototype,"viewForward",null),h([p({readOnly:!0})],mi.prototype,"viewUp",null),h([p({readOnly:!0})],mi.prototype,"viewRight",null),h([p({readOnly:!0})],mi.prototype,"nearFar",null),h([p()],mi.prototype,"near",null),h([p()],mi.prototype,"far",null),h([p()],mi.prototype,"viewport",null),h([p({readOnly:!0})],mi.prototype,"screenViewport",null),h([p({readOnly:!0})],mi.prototype,"screenPadding",null),h([p()],mi.prototype,"x",null),h([p()],mi.prototype,"y",null),h([p()],mi.prototype,"width",null),h([p()],mi.prototype,"height",null),h([p()],mi.prototype,"fullWidth",null),h([p()],mi.prototype,"fullHeight",null),h([p({readOnly:!0})],mi.prototype,"_aspect",null),h([p()],mi.prototype,"padding",null),h([p({readOnly:!0})],mi.prototype,"projectionMatrix",null),h([p({readOnly:!0})],mi.prototype,"inverseProjectionMatrix",null),h([p()],mi.prototype,"fov",null),h([p()],mi.prototype,"fovX",null),h([p()],mi.prototype,"fovY",null),h([p()],mi.prototype,"viewInverseTransposeMatrix",null),h([p({readOnly:!0})],mi.prototype,"_projectionMatrixInternal",null),h([p()],mi.prototype,"relativeElevation",void 0),mi=EJ=h([I("esri.views.3d.webgl.RenderCamera")],mi);const Dr=mi,Ui=ci(),EF=ke(),Va=E(),$8=E(),I8=Pa();var Pc;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(Pc||(Pc={}));function Out(t){t.include(fy),t.uniforms.add(new wt("geometryDepthTexture",(e,i)=>{var r;return(r=i.multipassGeometry.depth)==null?void 0:r.attachment})),t.code.add(T`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);
return (elementDepth < (geometryDepth - 1.0));
}`)}let Rut=class{};function xy(t,e){if(!e.multipassEnabled)return;t.fragment.include(fy),t.fragment.uniforms.add(new wt("terrainDepthTexture",(r,s)=>{var n;return(n=s.multipassTerrain.depth)==null?void 0:n.attachment}));const i=e.occlusionPass;t.fragment.code.add(T`
   ${i?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${i?T`return fragmentDepth < linearDepth && depth < 1.0;`:T`
          if(fragmentDepth ${e.cullAboveGround?">":"<="} linearDepth){
            discard;
          }`}
    }`)}let $ut=class{constructor(){this.cullAboveGround=!1}};var Pe;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.OPAQUE_NO_SSAO_DEPTH=3]="OPAQUE_NO_SSAO_DEPTH",t[t.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_NO_SSAO_DEPTH=5]="TRANSPARENT_NO_SSAO_DEPTH",t[t.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=7]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",t[t.OPAQUE_ENVIRONMENT=12]="OPAQUE_ENVIRONMENT",t[t.TRANSPARENT_ENVIRONMENT=13]="TRANSPARENT_ENVIRONMENT",t[t.LASERLINES=14]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=15]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=16]="HUD_MATERIAL",t[t.LABEL_MATERIAL=17]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=18]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=19]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=20]="DRAPED_MATERIAL",t[t.DRAPED_WATER=21]="DRAPED_WATER",t[t.VIEWSHED=22]="VIEWSHED",t[t.VOXEL=23]="VOXEL",t[t.MAX_SLOTS=24]="MAX_SLOTS"})(Pe||(Pe={}));var pt;(function(t){t[t.ColorAlpha=0]="ColorAlpha",t[t.FrontFace=1]="FrontFace",t[t.NONE=2]="NONE",t[t.COUNT=3]="COUNT"})(pt||(pt={}));let ene=class{constructor(e=E()){this.intensity=e}},O$e=class{constructor(e=E(),i=Ge(.57735,.57735,.57735)){this.intensity=e,this.direction=i}},Yz=class{constructor(e=E(),i=Ge(.57735,.57735,.57735),r=!0,s=1,n=1){this.intensity=e,this.direction=i,this.castShadows=r,this.specularStrength=s,this.environmentStrength=n}},R$e=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function Iut(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e[r];return i}function L8(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e;return i}function iA(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]+e[r];return i}function $$e(t){return(t+1)*(t+1)}function Lut(t){return Ne(Math.floor(Math.sqrt(t)-1),0,2)}function I$e(t,e,i){const r=t[0],s=t[1],n=t[2],o=i||[];return o.length=$$e(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*n,o[3]=.4886025119*s),e>=2&&(o[4]=1.09254843059*r*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*r*n,o[8]=.54627421529*(r*r-s*s)),o}function Dut(t,e){const i=$$e(t),r=e||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let s=0;s<i;s++)r.r[s]=r.g[s]=r.b[s]=0;return r}function Nut(t,e){const i=Lut(e.r.length);for(const r of t)sa(CJ,r.direction),I$e(CJ,i,D0),Iut(D0,lU),L8(D0,r.intensity[0],Q2),iA(e.r,Q2),L8(D0,r.intensity[1],Q2),iA(e.g,Q2),L8(D0,r.intensity[2],Q2),iA(e.b,Q2);return e}function Fut(t,e){I$e(CJ,0,D0);for(const i of t)e.r[0]+=D0[0]*lU[0]*i.intensity[0]*4*Math.PI,e.g[0]+=D0[0]*lU[0]*i.intensity[1]*4*Math.PI,e.b[0]+=D0[0]*lU[0]*i.intensity[2]*4*Math.PI;return e}function kut(t,e,i,r){Dut(e,r),de(i.intensity,0,0,0);let s=!1;const n=Uut,o=Vut,a=zut;n.length=0,o.length=0,a.length=0;for(const l of t)l instanceof Yz&&!s?(ve(i.direction,l.direction),ve(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,s=!0):l instanceof Yz||l instanceof O$e?n.push(l):l instanceof ene?o.push(l):l instanceof R$e&&a.push(l);Nut(n,r),Fut(o,r);for(const l of a)iA(r.r,l.r),iA(r.g,l.g),iA(r.b,l.b)}const Uut=[],Vut=[],zut=[],D0=[0],Q2=[0],CJ=E(),lU=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let Vpe=class{constructor(){this.color=E(),this.intensity=1}},But=class{constructor(){this.direction=E(),this.ambient=new Vpe,this.diffuse=new Vpe}};const L$e=.4;let D8=class{constructor(){this._shOrder=2,this._legacy=new But,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new R$e,this._mainLight=new Yz(E(),Ge(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){kut(e,this._shOrder,this._mainLight,this._sphericalHarmonics),ve(this._legacy.direction,this._mainLight.direction);const i=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,he(this._legacy.diffuse.color,this._mainLight.intensity,i),ve(CF,this._legacy.diffuse.color),he(CF,CF,L$e*this.globalFactor),Ee(this._legacy.ambient.color,this._legacy.ambient.color,CF)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),ve(this._mainLight.direction,e.mainLight.direction),ve(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,i,r){if(xr(this._mainLight.intensity,e.mainLight.intensity,i.mainLight.intensity,r),this._mainLight.environmentStrength=Bt(e.mainLight.environmentStrength,i.mainLight.environmentStrength,r),this._mainLight.specularStrength=Bt(e.mainLight.specularStrength,i.mainLight.specularStrength,r),ve(this._mainLight.direction,i.mainLight.direction),this._mainLight.castShadows=i.mainLight.castShadows,this.globalFactor=Bt(e.globalFactor,i.globalFactor,r),this.noonFactor=Bt(e.noonFactor,i.noonFactor,r),e.sh.r.length===i.sh.r.length)for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=Bt(e.sh.r[s],i.sh.r[s],r),this._sphericalHarmonics.g[s]=Bt(e.sh.g[s],i.sh.g[s],r),this._sphericalHarmonics.b[s]=Bt(e.sh.b[s],i.sh.b[s],r);else for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=i.sh.r[s],this._sphericalHarmonics.g[s]=i.sh.g[s],this._sphericalHarmonics.b[s]=i.sh.b[s]}};const CF=E();let YG=class{constructor(e,i){this.shadowMap=e,this.slicePlane=i,this.slot=Pe.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=pt.NONE,this.alignPixelEnabled=!1,this.decorations=Zl.ON,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new Dr,this._inverseViewport=mt(),this.oldLighting=new D8,this.newLighting=new D8,this._fadedLighting=new D8,this._lighting=this.newLighting,this.ssr=new jut,this.multipassEnabled=!1,this.multipassTerrain=new $ut,this.multipassGeometry=new Rut,this.hudRenderStyle=Pc.Occluded,this.cloudsFade=new Gct,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:i,newLighting:r}=this;e>=1?this._lighting=r:(this._fadedLighting.lerpLighting(i,r,e),this._lighting=this._fadedLighting)}},jut=class{constructor(){this.fadeFactor=1,this.reprojectionMatrix=ke()}},vc=class extends Ue{constructor(e){super(e),this._techniques=new Array,this._techniqueConfiguration=new oU,this._bindParameters=new YG(null,null),this._passParameters=new Qse,this._weatherTile=mt(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=Bt(Za.default.coverage[0],Za.default.coverage[1],.5),this.density=Bt(Za.default.density[0],Za.default.density[1],.5),this.absorption=Bt(Za.default.absorption[0],Za.default.absorption[1],.5),this.cloudSize=Bt(Za.default.cloudSize[0],Za.default.cloudSize[1],.5),this.detailSize=Bt(Za.default.detailSize[0],Za.default.detailSize[1],.5),this.smoothness=Bt(Za.default.smoothness[0],Za.default.smoothness[1],.5),this.cloudHeight=Bt(Za.default.cloudHeight[0],Za.default.cloudHeight[1],.5),this.raymarchingSteps=Za.default.raymarchingSteps,this._viewMatrix=ke(),this._dirty=!1,this.running=!1,this._vao=vy(e.context.renderContext.rctx)}_getTechnique(e){const i=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,r=i===JS.RG?2*e:2*e+1;return this._techniques[r]||(this._techniqueConfiguration.writeTextureChannels=i,this._techniqueConfiguration.steps=e,this._techniques[r]=new g$e({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[r])}updateWeatherTile(){const e=this.view.camera.position.latitude,i=this.view.camera.position.longitude;if(e==null||i==null)return;Li(this._weatherTile,(e+90)/180,(i+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-r)*this._weatherTile[1]);let s=0,n=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+s)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+n%100)%(4*this._weatherTileCount),RRe(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=_r(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this.addHandles([this.view.resourceController.scheduler.registerTask(It.CLOUDS_GENERATOR,this),te(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),$t)])}destroy(){this._techniques.forEach(e=>hi(e)),this._frameBufferCube=Ut(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=qe(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case Dc.SIXTEEN:return 1;case Dc.HUNDRED:return 4;case Dc.COUNT:case Dc.TWOHUNDRED:return 8}}get usedMemory(){var e,i,r;return(((e=this._frameBufferCube)==null?void 0:e.usedMemory)??0)+(((r=(i=this._passParameters.noiseTexture)==null?void 0:i.textureAtlas)==null?void 0:r.usedMemory)??0)}_ensureNoiseTexture(){var e;return(e=this._passParameters).noiseTexture??(e.noiseTexture=new L$({context:this.context})),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile),this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const i=new Xr(e);i.target=Ns.TEXTURE_CUBE_MAP,i.wrapMode=Mi.CLAMP_TO_EDGE,this._frameBufferCube=new wy(this.context.renderContext.rctx,i)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=Ut(this._frameBufferCube)}applyPreset(e,i){const r=e.median,s=n=>{const o=Bt(n[0],n[1],r);return i<.5?Bt(n[0],o,2*i):Bt(o,n[1],2*(i-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),Da(this._passParameters.weatherTile,this._weatherTile));const i=this._getTechnique(this._passParameters.raymarchingSteps);if(!i.compiled||this.context.renderContext.bindParameters.cloudsFade.fadeMode===Hr.CROSS_FADE||!this._ensureNoiseTexture())return na;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Pg.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const r=Gut[this._faceIndex],s=Hut[this._faceIndex];NEe(this._viewMatrix,qut,r,s),lp(this._passParameters.viewMatrix,this._viewMatrix);const n=this.context.renderContext.rctx,o=n.bindTechnique(i,this._bindParameters,this._passParameters);n.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao);const a=n.getViewport(),l=i.configuration.cubeMapSize,c=l/this._tilesPerFace,u=this._tileIndex*c;n.setViewport(0,u,l,c);const d=this._ensureFrameBufferCube(l);n.bindFramebuffer(d);const f=Ns.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return d.setColorTextureTarget(f),n.gl.drawArrays(n.gl.TRIANGLE_STRIP,0,4),n.gl.flush(),n.setViewport(a.x,a.y,a.width,a.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.running||(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Pg.FADING)):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),na}};h([p({constructOnly:!0})],vc.prototype,"context",void 0),h([p({constructOnly:!0})],vc.prototype,"view",void 0),h([p({constructOnly:!0})],vc.prototype,"requestRender",void 0),h([p()],vc.prototype,"coverage",void 0),h([p()],vc.prototype,"density",void 0),h([p()],vc.prototype,"absorption",void 0),h([p()],vc.prototype,"cloudSize",void 0),h([p()],vc.prototype,"detailSize",void 0),h([p()],vc.prototype,"smoothness",void 0),h([p()],vc.prototype,"cloudHeight",void 0),h([p()],vc.prototype,"raymarchingSteps",void 0),h([p()],vc.prototype,"running",void 0),vc=h([I("esri.views.3d.environment.CloudsGenerator")],vc);const Gut=[Pr(1,0,0),Pr(-1,0,0),Pr(0,1,0),Pr(0,-1,0),Pr(0,0,1)],Hut=[Pr(0,1,0),Pr(0,1,0),Pr(0,0,-1),Pr(0,0,1),Pr(0,1,0)],qut=Jse();let tne=class extends Fr{constructor(){super(...arguments),this.fogColor=E(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function D$e(){const t=new Hi;t.attributes.add(R.POSITION,"vec2"),t.include(Af,{textureCoordinateType:vs.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:e,fragment:i}=t;return e.uniforms.add(new us("inverseProjectionMatrix",(r,s)=>s.camera.inverseProjectionMatrix),new us("inverseViewMatrix",(r,s)=>Hb(Wut,s.camera.viewMatrix))),e.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new et("atmosphereC",r=>r.atmosphereC),new Wt("cameraPosition",(r,s)=>s.camera.eye),new jr("nearFar",(r,s)=>s.camera.nearFar),new wt("depthTexture",r=>r.depthTexture),new et("fogStrength",r=>r.fogStrength),new et("fogAmount",r=>r.fogAmount),new Wt("fogColor",r=>r.fogColor)),t.include(qG),i.include(Use),i.code.add(T`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(T`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),i.code.add(T`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),t}const Wut=ke(),Zut=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:tne,build:D$e},Symbol.toStringTag,{value:"Module"}));let N$e=class F$e extends Qi{constructor(e){super(e,new tc,()=>this.destroy())}initializeProgram(e){return new Ki(e.rctx,F$e.shader.get().build(),Ai)}initializePipeline(){return Jt({blending:ua(Be.SRC_ALPHA,Be.ZERO,Be.ONE_MINUS_SRC_ALPHA,Be.ONE),colorWrite:ui})}};N$e.shader=new qi(Zut,()=>ce(()=>Promise.resolve().then(()=>dHt),void 0));const Yut=.95,Xut=1;let Fx=class extends Ue{constructor(e){super(e),this._passParameters=new tne;const i=e.context.renderContext.rctx;this._vao=vy(i,DD),this._technique=new N$e(e);const r=_r(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+y1}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,i){if(this._update(e,i),this._passParameters.fogAmount<=0)return;const r=this._technique;if(!r.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper;s.renderDepthDetached(()=>{this._passParameters.depthTexture=s.depthTexture;const n=e.rctx.bindTechnique(r,e.bindParameters,this._passParameters);this._renderFog(n,e)})}_renderFog(e,i){const r=i.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Ci.TRIANGLE_STRIP,0,4)}_update(e,i){const r=e.bindParameters.camera;Ce(zpe,r.eye);const s=Math.max(0,Te(zpe,e.bindParameters.lighting.mainLight.direction)),n=i.color;he(Bpe,n,.1),xr(this._passParameters.fogColor,Bpe,n,s);const o=Ve(r.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-sL(Yut*R0,Xut*R0,Math.abs(o-this._planetRadius)))*i.amount,this._passParameters.fogStrength=i.strength}};h([p({constructOnly:!0})],Fx.prototype,"context",void 0),h([p({constructOnly:!0})],Fx.prototype,"view",void 0),h([p({constructOnly:!0})],Fx.prototype,"rctx",void 0),h([p({constructOnly:!0})],Fx.prototype,"viewingMode",void 0),Fx=h([I("esri.views.3d.environment.Fog")],Fx);let Jut=class{constructor(){this.color=E(),this.strength=0,this.amount=0}};const zpe=E(),Bpe=E();var j;function Qut(t){return rA(t)||t===j.Depth||t===j.Normal||t===j.ObjectAndLayerIdColor}function rA(t){return t===j.Shadow||t===j.ShadowHighlight||t===j.ShadowExcludeHighlight||t===j.ViewshedShadow}function a3(t){return MJ(t)||t===j.Normal}function mS(t){return t===j.Highlight||t===j.ObjectAndLayerIdColor}function k$e(t){return t===j.Color||mS(t)}function Q0(t){return t===j.Color}function N8(t){return Q0(t)||t===j.ObjectAndLayerIdColor}function Kut(t){return Q0(t)||t===j.Highlight}function jpe(t){return Kut(t)||nb(t)}function cU(t){return Q0(t)||mS(t)}function MJ(t){return cU(t)||nb(t)}function nb(t){return t===j.Depth}(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.ViewshedShadow=6]="ViewshedShadow",t[t.Highlight=7]="Highlight",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.COUNT=9]="COUNT"})(j||(j={}));function ine({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(T`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(T`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let U$e=class extends Vs{constructor(e,i){super(e,"mat4",Zi.Draw,(r,s,n)=>r.setUniformMatrix4fv(e,i(s,n)))}};function Qf(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",On):t.uniforms.add(new Dh("cameraPosition",(i,r)=>de(V$e,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function Nc(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new us("proj",(r,s)=>s.camera.projectionMatrix),new U$e("view",(r,s)=>dl(Gpe,s.camera.viewMatrix,r.origin)),new Dh("localOrigin",r=>r.origin));const i=r=>de(V$e,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]);t.uniforms.add(new us("proj",(r,s)=>s.camera.projectionMatrix),new us("view",(r,s)=>dl(Gpe,s.camera.viewMatrix,i(s))),new Wt("localOrigin",(r,s)=>i(s)))}const Gpe=ke(),V$e=E();function uP(t){t.uniforms.add(new us("viewNormal",(e,i)=>i.camera.viewInverseTransposeMatrix))}function rO(t){t.uniforms.add(new et("pixelRatio",(e,i)=>i.camera.pixelRatio/i.overlayStretch))}function AJ(t,e,i){for(let r=0;r<i;++r)e[2*r]=t[r],e[2*r+1]=t[r]-e[2*r]}function eht(t,e){const i=t.length;for(let r=0;r<i;++r)fM[0]=t[r],e[r]=fM[0];return e}function tht(t,e){const i=t.length;for(let r=0;r<i;++r)fM[0]=t[r],fM[1]=t[r]-fM[0],e[r]=fM[1];return e}const fM=new Float32Array(2);let PJ=class extends tc{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}};h([B()],PJ.prototype,"instancedDoublePrecision",void 0),h([B()],PJ.prototype,"hasModelTransformation",void 0);const Hpe=Yr();function z$e(t,e){const i=e.hasModelTransformation,r=e.instancedDoublePrecision;i&&(t.vertex.uniforms.add(new us("model",n=>n.modelTransformation??Wr)),t.vertex.uniforms.add(new cp("normalLocalOriginFromModel",n=>(Mb(Hpe,n.modelTransformation??Wr),Hpe)))),e.instanced&&r&&(t.attributes.add(R.INSTANCEMODELORIGINHI,"vec3"),t.attributes.add(R.INSTANCEMODELORIGINLO,"vec3"),t.attributes.add(R.INSTANCEMODEL,"mat3"),t.attributes.add(R.INSTANCEMODELNORMAL,"mat3"));const s=t.vertex;r&&(s.include(ine,e),s.uniforms.add(new Dh("viewOriginHi",(n,o)=>eht(de(MF,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),MF)),new Dh("viewOriginLo",(n,o)=>tht(de(MF,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),MF)))),s.code.add(T`
    vec3 getVertexInLocalOriginSpace() {
      return ${i?r?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":r?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${r?T`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),s.code.add(T`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${i?r?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":r?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),e.output===j.Normal&&(uP(s),s.code.add(T`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${i?r?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":r?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),e.hasVertexTangents&&s.code.add(T`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${i?r?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":r?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const MF=E();let Uc=class extends PJ{};h([B({constValue:!0})],Uc.prototype,"hasSliceHighlight",void 0),h([B({constValue:!1})],Uc.prototype,"hasSliceInVertexProgram",void 0),h([B({constValue:Zi.Pass})],Uc.prototype,"pbrTextureBindType",void 0);var sy;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(sy||(sy={}));let rne=class extends Uc{constructor(){super(...arguments),this.geometry=sy.Cone}};h([B({count:sy.COUNT})],rne.prototype,"geometry",void 0);function FD(t){t.attributes.add(R.POSITION,"vec3"),t.vertex.code.add(T`vec3 positionModel() { return position; }`)}let Xz=class extends Vs{constructor(e,i){super(e,"mat3",Zi.Draw,(r,s,n)=>r.setUniformMatrix3fv(e,i(s,n)))}};function sA(t,e){t.include(FD);const i=t.vertex;i.include(ine,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),i.uniforms.add(new Wt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH),new Wt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new cp("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new us("transformProjFromView",r=>r.transformProjFromView),new Xz("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Dh("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Dh("transformWorldFromModelTL",r=>r.transformWorldFromModelTL)),i.code.add(T`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(T`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?T`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:T`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new Wt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL)),i.code.add(T`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(T`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let iht=class extends Fr{constructor(){super(...arguments),this.transformWorldFromViewTH=E(),this.transformWorldFromViewTL=E(),this.transformViewFromCameraRelativeRS=Yr(),this.transformProjFromView=ke()}},rht=class extends Fr{constructor(){super(...arguments),this.transformWorldFromModelRS=Yr(),this.transformWorldFromModelTH=E(),this.transformWorldFromModelTL=E()}};function OJ(t){t.varyings.add("linearDepth","float")}function XG(t){t.vertex.uniforms.add(new jr("nearFar",(e,i)=>i.camera.nearFar))}function B$e(t){t.vertex.code.add(T`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function sO(t,e){const{vertex:i}=t;switch(e.output){case j.Color:if(e.receiveShadows)return OJ(t),void i.code.add(T`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case j.Shadow:case j.ShadowHighlight:case j.ShadowExcludeHighlight:case j.ViewshedShadow:return t.include(sA,e),OJ(t),XG(t),B$e(t),void i.code.add(T`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}i.code.add(T`void forwardLinearDepth() {}`)}function al(t){B$e(t),t.vertex.code.add(T`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(T`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let JG=class extends Fr{constructor(){super(...arguments),this.texV=mt(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new sne}},sne=class{constructor(){this.center=E(),this.v1=E(),this.v2=E()}};function j$e(t){const e=new Hi,{vertex:i,fragment:r}=e;if(C_(i),t.geometry===sy.Underground)e.attributes.add(R.POSITION,"vec2"),e.varyings.add("color","vec4"),i.uniforms.add(new Wt("cameraPosition",(s,n)=>n.camera.eye),new et("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)),i.code.add(T`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),r.code.add(T`void main() {
fragColor = color;
}`);else{e.include(al,t),e.attributes.add(R.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const s=t.geometry===sy.Cylinder;i.uniforms.add(new us("proj",(a,l)=>l.camera.projectionMatrix),new us("view",(a,l)=>l.camera.viewMatrix)),s||(e.varyings.add("innerFactor","float"),i.uniforms.add(new Wt("silCircleCenter",a=>a.silhouette.center)),i.uniforms.add(new Wt("silCircleV1",a=>a.silhouette.v1)),i.uniforms.add(new Wt("silCircleV2",a=>a.silhouette.v2)),i.uniforms.add(new jr("texV",a=>a.texV)),i.uniforms.add(new et("innerScale",a=>a.innerScale)));const n=6.2831853,o=1/128;i.code.add(T`
		void main(void) {
      ${s?T`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:T`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${T.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${T.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),r.uniforms.add(new wt("tex",a=>a.texture)),s||r.uniforms.add(new et("altitudeFade",a=>a.altitudeFade)),r.code.add(T`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${s?T`fragColor = atmosphereColor;`:T`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const sht=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:sne,SimpleAtmospherePassParameters:JG,build:j$e},Symbol.toStringTag,{value:"Module"}));let Jz=class G$e extends Qi{initializeProgram(e){return new Ki(e.rctx,G$e.shader.get().build(this.configuration),Ai)}initializePipeline(){return this.configuration.geometry===sy.Cylinder?Jt({blending:ua(Be.SRC_ALPHA,Be.ONE,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),culling:Vse,depthTest:{func:br.LEQUAL},colorWrite:ui}):Jt({blending:ua(Be.SRC_ALPHA,Be.ONE,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),depthTest:{func:br.LEQUAL},colorWrite:ui})}};Jz.shader=new qi(sht,()=>ce(()=>Promise.resolve().then(()=>pHt),void 0));const nht=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function ku(t,e=0){const i=t.stride;return Array.from(t.fields.keys()).map(r=>{var c;const s=t.fields.get(r),n=s.constructor.ElementCount,o=oht(s.constructor.ElementType),a=s.offset,l=((c=s.optional)==null?void 0:c.glNormalized)??!1;return new Xf(r,n,o,a,i,l,e)})}function oht(t){const e=aht[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const aht={u8:St.UNSIGNED_BYTE,u16:St.UNSIGNED_SHORT,u32:St.UNSIGNED_INT,i8:St.BYTE,i16:St.SHORT,i32:St.INT,f32:St.FLOAT};let nne=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<9;s++)i[s]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[r++]=i[s]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};nne.ElementCount=9;let one=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<16;s++)i[s]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[r++]=i[s]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};one.ElementCount=16;let A_=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,i){this.typedBuffer[e*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}};A_.ElementCount=1;let P_=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,Li(i,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e]=i[1]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};P_.ElementCount=2;let O_=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,de(i,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e]=i[2]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,s){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=s}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};O_.ElementCount=3;let R_=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.start=r,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,_s(i,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e++]=i[2],this.typedBuffer[e]=i[3]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,s,n){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e++]=s,this.typedBuffer[e]=n}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};R_.ElementCount=4;let QG=class H$e extends A_{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}static fromTypedArray(e,i){return new H$e(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};QG.ElementType="f32";let O2=class RJ extends P_{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(RJ,e,i)}static fromTypedArray(e,i){return new RJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};O2.ElementType="f32";let ho=class $J extends O_{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer($J,e,i)}static fromTypedArray(e,i){return new $J(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ho.ElementType="f32";let Kf=class IJ extends R_{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(IJ,e,i)}static fromTypedArray(e,i){return new IJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Kf.ElementType="f32";let $b=class LJ extends nne{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(LJ,e,i)}static fromTypedArray(e,i){return new LJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};$b.ElementType="f32";let ane=class DJ extends nne{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(DJ,e,i)}static fromTypedArray(e,i){return new DJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ane.ElementType="f64";let lne=class NJ extends one{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(NJ,e,i)}static fromTypedArray(e,i){return new NJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};lne.ElementType="f32";let xL=class FJ extends one{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(FJ,e,i)}static fromTypedArray(e,i){return new FJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};xL.ElementType="f64";let cne=class kJ extends A_{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(kJ,e,i)}static fromTypedArray(e,i){return new kJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};cne.ElementType="f64";let une=class UJ extends P_{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(UJ,e,i)}static fromTypedArray(e,i){return new UJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};une.ElementType="f64";let rp=class VJ extends O_{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(VJ,e,i)}static fromTypedArray(e,i){return new VJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};rp.ElementType="f64";let KG=class zJ extends R_{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(zJ,e,i)}static fromTypedArray(e,i){return new zJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};KG.ElementType="f64";let hP=class BJ extends A_{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(BJ,e,i)}static fromTypedArray(e,i){return new BJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};hP.ElementType="u8";let e6=class jJ extends P_{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(jJ,e,i)}static fromTypedArray(e,i){return new jJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};e6.ElementType="u8";let t6=class GJ extends O_{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(GJ,e,i)}static fromTypedArray(e,i){return new GJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};t6.ElementType="u8";let ml=class HJ extends R_{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(HJ,e,i)}static fromTypedArray(e,i){return new HJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ml.ElementType="u8";let i6=class qJ extends A_{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(qJ,e,i)}static fromTypedArray(e,i){return new qJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};i6.ElementType="u16";let hne=class WJ extends P_{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(WJ,e,i)}static fromTypedArray(e,i){return new WJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};hne.ElementType="u16";let r6=class ZJ extends O_{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(ZJ,e,i)}static fromTypedArray(e,i){return new ZJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};r6.ElementType="u16";let kD=class YJ extends R_{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(YJ,e,i)}static fromTypedArray(e,i){return new YJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};kD.ElementType="u16";let s6=class XJ extends A_{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(XJ,e,i)}static fromTypedArray(e,i){return new XJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};s6.ElementType="u32";let dne=class JJ extends P_{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(JJ,e,i)}static fromTypedArray(e,i){return new JJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};dne.ElementType="u32";let q$e=class QJ extends O_{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(QJ,e,i)}static fromTypedArray(e,i){return new QJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};q$e.ElementType="u32";let W$e=class KJ extends R_{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(KJ,e,i)}static fromTypedArray(e,i){return new KJ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};W$e.ElementType="u32";let pne=class eQ extends A_{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(eQ,e,i)}static fromTypedArray(e,i){return new eQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};pne.ElementType="i8";let n6=class tQ extends P_{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(tQ,e,i)}static fromTypedArray(e,i){return new tQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};n6.ElementType="i8";let Z$e=class iQ extends O_{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(iQ,e,i)}static fromTypedArray(e,i){return new iQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Z$e.ElementType="i8";let Y$e=class rQ extends R_{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(rQ,e,i)}static fromTypedArray(e,i){return new rQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Y$e.ElementType="i8";let X$e=class sQ extends A_{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(sQ,e,i)}static fromTypedArray(e,i){return new sQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};X$e.ElementType="i16";let UD=class nQ extends P_{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(nQ,e,i)}static fromTypedArray(e,i){return new nQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};UD.ElementType="i16";let J$e=class oQ extends O_{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(oQ,e,i)}static fromTypedArray(e,i){return new oQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};J$e.ElementType="i16";let Q$e=class aQ extends R_{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(aQ,e,i)}static fromTypedArray(e,i){return new aQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Q$e.ElementType="i16";let K$e=class lQ extends A_{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(lQ,e,i)}static fromTypedArray(e,i){return new lQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};K$e.ElementType="i32";let eIe=class cQ extends P_{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(cQ,e,i)}static fromTypedArray(e,i){return new cQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};eIe.ElementType="i32";let tIe=class uQ extends O_{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(uQ,e,i)}static fromTypedArray(e,i){return new uQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};tIe.ElementType="i32";let iIe=class hQ extends R_{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(hQ,e,i)}static fromTypedArray(e,i){return new hQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};iIe.ElementType="i32";function qpe(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let Wpe=class rIe{constructor(e,i){this.layout=e,this.buffer=typeof i=="number"?new ArrayBuffer(i*e.stride):i;for(const r of e.fields.keys()){const s=e.fields.get(r);this[r]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,i){const r=this[e];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(e,i){return new rIe(this.layout,this.buffer.slice(e*this.stride,i*this.stride))}copyFrom(e,i=0,r=0,s=e.count){const n=this.stride;if(n%4==0){const o=new Uint32Array(e.buffer,i*n,s*n/4);new Uint32Array(this.buffer,r*n,s*n/4).set(o)}else{const o=new Uint8Array(e.buffer,i*n,s*n);new Uint8Array(this.buffer,r*n,s*n).set(o)}return this}get usedMemory(){return this.byteLength}dispose(){}},lht=class sIe{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(i=>this._fields.set(i[0],{...i[1],constructor:uht(i[1].constructor)})))}freeze(){return this}vec2f(e,i){return this._appendField(e,O2,i),this}vec2f64(e,i){return this._appendField(e,une,i),this}vec3f(e,i){return this._appendField(e,ho,i),this}vec3f64(e,i){return this._appendField(e,rp,i),this}vec4f(e,i){return this._appendField(e,Kf,i),this}vec4f64(e,i){return this._appendField(e,KG,i),this}mat3f(e,i){return this._appendField(e,$b,i),this}mat3f64(e,i){return this._appendField(e,ane,i),this}mat4f(e,i){return this._appendField(e,lne,i),this}mat4f64(e,i){return this._appendField(e,xL,i),this}vec4u8(e,i){return this._appendField(e,ml,i),this}f32(e,i){return this._appendField(e,QG,i),this}f64(e,i){return this._appendField(e,cne,i),this}u8(e,i){return this._appendField(e,hP,i),this}u16(e,i){return this._appendField(e,i6,i),this}i8(e,i){return this._appendField(e,pne,i),this}vec2i8(e,i){return this._appendField(e,n6,i),this}vec2i16(e,i){return this._appendField(e,UD,i),this}vec2u8(e,i){return this._appendField(e,e6,i),this}vec4u16(e,i){return this._appendField(e,kD,i),this}u32(e,i){return this._appendField(e,s6,i),this}_appendField(e,i,r){if(this._fields.has(e))return void vt(!1,`${e} already added to vertex buffer layout`);const s=i.ElementCount*qpe(i.ElementType),n=this._stride;this._stride+=s,this._fields.set(e,{size:s,constructor:i,offset:n,optional:r})}createBuffer(e){return new Wpe(this,e)}createView(e){return new Wpe(this,e)}clone(){const e=new sIe;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((i,r)=>e._fields.set(r,i)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(i=>e=Math.max(e,qpe(i.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function As(){return new lht}let uXt=class{constructor(e){this.fields=new Array,e.fields.forEach((i,r)=>{const s={...i,constructor:nIe(i.constructor)};this.fields.push([r,s])}),this.stride=e.stride}};const cht=[QG,O2,ho,Kf,$b,lne,cne,une,rp,KG,ane,xL,hP,e6,t6,ml,i6,hne,r6,kD,s6,dne,q$e,W$e,pne,n6,Z$e,Y$e,X$e,UD,J$e,Q$e,K$e,eIe,tIe,iIe];function nIe(t){return`${t.ElementType}_${t.ElementCount}`}function uht(t){return oIe.get(t)}const oIe=new Map;cht.forEach(t=>oIe.set(nIe(t),t));function co(t,e=!1){return t<=Fh?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function aIe(t){return(Zg(t)?t.length:t.byteLength/8)<=Fh?Array.from(t):new Float64Array(t)}function Xd(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function hht(t,e){for(let i=0;i<e.length;++i)t[i]=e[i];return t}function dXt(t){return Array.isArray(t)?new Float64Array(t):t}function Es(t,e=!1){return t<=Fh?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function pXt(t){return Zg(t)?t.length<Fh?t:new Float32Array(t):t.length<Fh?Array.from(t):t}function Zpe(t){return(Zg(t)?t.length:t.byteLength/8)<=Fh?Array.from(t):new Float32Array(t)}function Qz(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function jg(t){if(Zg(t)){if(t.length<Fh)return t}else if(t.length<Fh)return Array.from(t);let e=!0,i=!0;return t.some((r,s)=>(e=e&&r===0,i=i&&r===s,!e&&!i)),e?tw(t.length):i?R2(t.length):Zg(t)||t.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?dht(t):t}function dht(t){let e=!0;for(const i of t){if(i>=65536)return Zg(t)?new Uint32Array(t):t;i>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function Kz(t){return t<=Fh?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function pht(t){return t<=Fh?new Array(t):new Uint32Array(t)}let K2=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const lIe=[0],F8=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function R2(t){if(t===1)return lIe;if(t<Fh)return Array.from(new Uint16Array(F8.buffer,0,t));if(t<F8.length)return new Uint16Array(F8.buffer,0,t);if(t>K2.length){const e=Math.max(2*K2.length,t);K2=new Uint32Array(e);for(let i=0;i<K2.length;i++)K2[i]=i}return new Uint32Array(K2.buffer,0,t)}let AF=new Uint8Array(65536);function tw(t){if(t===1)return lIe;if(t<Fh)return new Array(t).fill(0);if(t>AF.length){const e=Math.max(2*AF.length,t);AF=new Uint8Array(e)}return new Uint8Array(AF.buffer,0,t)}var dQ;(function(t){function e(o,a){const l=o[a],c=o[a+1],u=o[a+2];return Math.sqrt(l*l+c*c+u*u)}function i(o,a){const l=o[a],c=o[a+1],u=o[a+2],d=1/Math.sqrt(l*l+c*c+u*u);o[a]*=d,o[a+1]*=d,o[a+2]*=d}function r(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,u,d=a){(u=u||o)[d]=o[a]+l[c],u[d+1]=o[a+1]+l[c+1],u[d+2]=o[a+2]+l[c+2]}function n(o,a,l,c,u,d=a){(u=u||o)[d]=o[a]-l[c],u[d+1]=o[a+1]-l[c+1],u[d+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=i,t.scale=r,t.add=s,t.subtract=n})(dQ||(dQ={}));var Fs;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(Fs||(Fs={}));function fht(t){if(t.length<Fh)return Array.from(t);if(Zg(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return Pj(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let cIe=class uIe{constructor(e,i,r){this.primitiveIndices=e,this._numIndexPerPrimitive=i,this.position=r,this._children=void 0,vt(e.length>=1),vt(r.size===3||r.size===4);const{data:s,size:n,indices:o}=r;vt(o.length%this._numIndexPerPrimitive==0),vt(o.length>=e.length*this._numIndexPerPrimitive);const a=e.length;let l=n*o[this._numIndexPerPrimitive*e[0]];Sw.clear(),Sw.push(l);const c=Ge(s[l],s[l+1],s[l+2]),u=hn(c);for(let m=0;m<a;++m){const g=this._numIndexPerPrimitive*e[m];for(let y=0;y<this._numIndexPerPrimitive;++y){l=n*o[g+y],Sw.push(l);let v=s[l];c[0]=Math.min(v,c[0]),u[0]=Math.max(v,u[0]),v=s[l+1],c[1]=Math.min(v,c[1]),u[1]=Math.max(v,u[1]),v=s[l+2],c[2]=Math.min(v,c[2]),u[2]=Math.max(v,u[2])}}this.bbMin=c,this.bbMax=u;const d=xr(E(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(u[0]-c[0],u[1]-c[1]),u[2]-c[2]);let f=this.radius*this.radius;for(let m=0;m<Sw.length;++m){l=Sw.at(m);const g=s[l]-d[0],y=s[l+1]-d[1],v=s[l+2]-d[2],b=g*g+y*y+v*v;if(b<=f)continue;const w=Math.sqrt(b),x=.5*(w-this.radius);this.radius=this.radius+x,f=this.radius*this.radius;const S=x/w;d[0]+=g*S,d[1]+=y*S,d[2]+=v*S}this.center=d,Sw.clear()}getChildren(){if(this._children||uo(this.bbMin,this.bbMax)<=1)return this._children;const e=xr(E(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),s=new Array(8);for(let u=0;u<8;++u)s[u]=0;const{data:n,size:o,indices:a}=this.position;for(let u=0;u<i;++u){let d=0;const f=this._numIndexPerPrimitive*this.primitiveIndices[u];let m=o*a[f],g=n[m],y=n[m+1],v=n[m+2];for(let b=1;b<this._numIndexPerPrimitive;++b){m=o*a[f+b];const w=n[m],x=n[m+1],S=n[m+2];w<g&&(g=w),x<y&&(y=x),S<v&&(v=S)}g<e[0]&&(d|=1),y<e[1]&&(d|=2),v<e[2]&&(d|=4),r[u]=d,++s[d]}let l=0;for(let u=0;u<8;++u)s[u]>0&&++l;if(l<2)return;const c=new Array(8);for(let u=0;u<8;++u)c[u]=s[u]>0?new Uint32Array(s[u]):void 0;for(let u=0;u<8;++u)s[u]=0;for(let u=0;u<i;++u){const d=r[u];c[d][s[d]++]=this.primitiveIndices[u]}this._children=new Array;for(let u=0;u<8;++u)c[u]!==void 0&&this._children.push(new uIe(c[u],this._numIndexPerPrimitive,this.position));return this._children}static prune(){Sw.prune()}};const Sw=new ai({deallocator:null});let VD=class{constructor(){this.id=Ph()}};function mht(t){return t?{p0:hn(t.p0),p1:hn(t.p1),p2:hn(t.p2)}:{p0:E(),p1:E(),p2:E()}}function ght(t,e,i){const r=e[0]-t[0],s=e[1]-t[1],n=i[0]-t[0],o=i[1]-t[1];return .5*Math.abs(r*o-s*n)}function yht(t,e,i){return Re(k8,e,t),Re(Ype,i,t),.5*Ve(ft(k8,k8,Ype))}new x_(im);new x_(()=>mht());const k8=E(),Ype=E();function _ht(t,e){if(!t)return!1;const{size:i,data:r,indices:s}=t;de(e,0,0,0),de(Cd,0,0,0);let n=0,o=0;for(let a=0;a<s.length-2;a+=3){const l=s[a]*i,c=s[a+1]*i,u=s[a+2]*i;de(Ao,r[l],r[l+1],r[l+2]),de(N0,r[c],r[c+1],r[c+2]),de(PF,r[u],r[u+1],r[u+2]);const d=yht(Ao,N0,PF);d?(Ee(Ao,Ao,N0),Ee(Ao,Ao,PF),he(Ao,Ao,1/3*d),Ee(e,e,Ao),n+=d):(Ee(Cd,Cd,Ao),Ee(Cd,Cd,N0),Ee(Cd,Cd,PF),o+=3)}return(o!==0||n!==0)&&(n!==0?(he(e,e,1/n),!0):o!==0&&(he(e,Cd,1/o),!0))}function vht(t,e){if(!t)return!1;const{size:i,data:r,indices:s}=t;de(e,0,0,0);let n=-1,o=0;for(let a=0;a<s.length;a++){const l=s[a]*i;n!==l&&(e[0]+=r[l],e[1]+=r[l+1],e[2]+=r[l+2],o++),n=l}return o>1&&he(e,e,1/o),o>0}function bht(t,e,i){if(!t)return!1;de(i,0,0,0),de(Cd,0,0,0);let r=0,s=0;const{size:n,data:o,indices:a}=t,l=a.length-1,c=l+(e?2:0);for(let u=0;u<c;u+=2){const d=u<l?u+1:0,f=a[u<l?u:l]*n,m=a[d]*n;Ao[0]=o[f],Ao[1]=o[f+1],Ao[2]=o[f+2],N0[0]=o[m],N0[1]=o[m+1],N0[2]=o[m+2],he(Ao,Ee(Ao,Ao,N0),.5);const g=Y1(Ao,N0);g>0?(Ee(i,i,he(Ao,Ao,g)),r+=g):r===0&&(Ee(Cd,Cd,Ao),s++)}return r!==0?(he(i,i,1/r),!0):s!==0&&(he(i,Cd,1/s),!0)}const Ao=E(),N0=E(),PF=E(),Cd=E();let eB=class{constructor(e){this.channel=e,this.id=Ph()}};function pQ(t,e){return t==null&&(t=[]),t.push(e),t}function fQ(t,e){if(t==null)return null;const i=t.filter(r=>r!==e);return i.length===0?null:i}function wht(t,e,i,r,s){OF[0]=t.get(e,0),OF[1]=t.get(e,1),OF[2]=t.get(e,2),AJ(OF,Ew,3),i.set(s,0,Ew[0]),r.set(s,0,Ew[1]),i.set(s,1,Ew[2]),r.set(s,1,Ew[3]),i.set(s,2,Ew[4]),r.set(s,2,Ew[5])}const OF=E(),Ew=new Float32Array(6);let Tn=class hIe extends VD{constructor(e,i,r=null,s=Fs.Mesh,n=null,o=-1){super(),this.material=e,this.mapPositions=r,this.type=s,this.objectAndLayerIdColor=n,this.edgeIndicesLength=o,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[a,l]of i)this._attributes.set(a,{...l,indices:jg(l.indices)}),a===R.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(a).indices.length:this.edgeIndicesLength)}instantiate(e={}){const i=new hIe(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((r,s)=>{r.exclusive=!1,i._attributes.set(s,r)}),i._boundingInfo=this._boundingInfo,i.transformation=e.transformation||this.transformation,i}get attributes(){return this._attributes}getMutableAttribute(e){let i=this._attributes.get(e);return i&&!i.exclusive&&(i={...i,exclusive:!0,data:fht(i.data)},this._attributes.set(e,i)),i}setAttributeData(e,i){const r=this._attributes.get(e);r&&this._attributes.set(e,{...r,exclusive:!0,data:i})}get indexCount(){const e=this._attributes.values().next().value.indices;return(e==null?void 0:e.length)??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===Fs.Mesh?this._computeAttachmentOriginTriangles(e):this.type===Fs.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&nt(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const i=this.attributes.get(R.POSITION);return _ht(i,e)}_computeAttachmentOriginLines(e){const i=this.attributes.get(R.POSITION);return bht(i,xht(this.material.parameters,i),e)}_computeAttachmentOriginPoints(e){const i=this.attributes.get(R.POSITION);return vht(i,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get(R.POSITION);if(!e||e.indices.length===0)return null;const i=this.type===Fs.Mesh?3:1;vt(e.indices.length%i==0,"Indexing error: "+e.indices.length+" not divisible by "+i);const r=R2(e.indices.length/i);return new cIe(r,i,e)}get transformation(){return this._transformation??Wr}set transformation(e){this._transformation=e&&e!==Wr?YA(e):null}addHighlight(){const e=new eB(d_.Highlight);return this.highlights=pQ(this.highlights,e),e}removeHighlight(e){this.highlights=fQ(this.highlights,e)}};function xht(t,e){return!(!("isClosed"in t)||!t.isClosed)&&e.indices.length>2}const eE=dQ,U8=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],Tht=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],Sht=[0,0,1,0,1,1,0,1],Eht=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],dIe=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)dIe[6*t+e]=t;const kx=new Array(36);for(let t=0;t<6;t++)kx[6*t]=0,kx[6*t+1]=1,kx[6*t+2]=2,kx[6*t+3]=2,kx[6*t+4]=3,kx[6*t+5]=0;function Cht(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(24);for(let r=0;r<8;r++)i[3*r]=U8[r][0]*e[0],i[3*r+1]=U8[r][1]*e[1],i[3*r+2]=U8[r][2]*e[2];return new Tn(t,[[R.POSITION,new ht(i,Eht,3,!0)],[R.NORMAL,new ht(Tht,dIe,3)],[R.UV0,new ht(Sht,kx,2)]])}const V8=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],Mht=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],Aht=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],Pht=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function Oht(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(18);for(let r=0;r<6;r++)i[3*r]=V8[r][0]*e[0],i[3*r+1]=V8[r][1]*e[1],i[3*r+2]=V8[r][2]*e[2];return new Tn(t,[[R.POSITION,new ht(i,Aht,3,!0)],[R.NORMAL,new ht(Mht,Pht,3)]])}const uU=Pr(-.5,0,-.5),hU=Pr(.5,0,-.5),dU=Pr(0,0,.5),pU=Pr(0,.5,0),tE=wu(),iE=wu(),nA=wu(),oA=wu(),aA=wu();Re(tE,uU,pU),Re(iE,uU,hU),ft(nA,tE,iE),Ce(nA,nA),Re(tE,hU,pU),Re(iE,hU,dU),ft(oA,tE,iE),Ce(oA,oA),Re(tE,dU,pU),Re(iE,dU,uU),ft(aA,tE,iE),Ce(aA,aA);const z8=[uU,hU,dU,pU],Rht=[0,-1,0,nA[0],nA[1],nA[2],oA[0],oA[1],oA[2],aA[0],aA[1],aA[2]],$ht=[0,1,2,3,1,0,3,2,1,3,0,2],Iht=[0,0,0,1,1,1,2,2,2,3,3,3];function Lht(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(12);for(let r=0;r<4;r++)i[3*r]=z8[r][0]*e[0],i[3*r+1]=z8[r][1]*e[1],i[3*r+2]=z8[r][2]*e[2];return new Tn(t,[[R.POSITION,new ht(i,$ht,3,!0)],[R.NORMAL,new ht(Rht,Iht,3)]])}function gXt(t,e,i,r,s={uv:!0}){const n=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(i)),u=Math.max(2,Math.floor(r)),d=(c+1)*(u+1),f=Es(3*d),m=Es(3*d),g=Es(2*d),y=[];let v=0;for(let x=0;x<=u;x++){const S=[],C=x/u,M=a+C*l,O=Math.cos(M);for(let D=0;D<=c;D++){const U=D/c,k=n+U*o,H=Math.cos(k)*O,V=Math.sin(M),X=-Math.sin(k)*O;f[3*v]=H*e,f[3*v+1]=V*e,f[3*v+2]=X*e,m[3*v]=H,m[3*v+1]=V,m[3*v+2]=X,g[2*v]=U,g[2*v+1]=C,S.push(v),++v}y.push(S)}const b=new Array;for(let x=0;x<u;x++)for(let S=0;S<c;S++){const C=y[x][S],M=y[x][S+1],O=y[x+1][S+1],D=y[x+1][S];x===0?(b.push(C),b.push(O),b.push(D)):x===u-1?(b.push(C),b.push(M),b.push(O)):(b.push(C),b.push(M),b.push(O),b.push(O),b.push(D),b.push(C))}const w=[[R.POSITION,new ht(f,b,3,!0)],[R.NORMAL,new ht(m,b,3,!0)]];return s.uv&&w.push([R.UV0,new ht(g,b,2,!0)]),s.offset&&(w[0][0]=R.OFFSET,w.push([R.POSITION,new ht(Float64Array.from(s.offset),tw(b.length),3,!0)])),new Tn(t,w)}function Dht(t,e,i,r){const s=pIe(e,i,r);return new Tn(t,s)}function pIe(t,e,i){const r=t;let s,n;if(i)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const c=r*(1+Math.sqrt(5))/2;s=[-r,c,0,r,c,0,-r,-c,0,r,-c,0,0,-r,c,0,r,c,0,-r,-c,0,r,-c,c,0,-r,c,0,r,-c,0,-r,-c,0,r],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let c=0;c<s.length;c+=3)eE.scale(s,c,t/eE.length(s,c));let o={};function a(c,u){c>u&&([c,u]=[u,c]);const d=c.toString()+"."+u.toString();if(o[d])return o[d];let f=s.length;return s.length+=3,eE.add(s,3*c,s,3*u,s,f),eE.scale(s,f,t/eE.length(s,f)),f/=3,o[d]=f,f}for(let c=0;c<e;c++){const u=n.length,d=new Array(4*u);for(let f=0;f<u;f+=3){const m=n[f],g=n[f+1],y=n[f+2],v=a(m,g),b=a(g,y),w=a(y,m),x=4*f;d[x]=m,d[x+1]=v,d[x+2]=w,d[x+3]=g,d[x+4]=b,d[x+5]=v,d[x+6]=y,d[x+7]=w,d[x+8]=b,d[x+9]=v,d[x+10]=b,d[x+11]=w}n=d,o={}}const l=Zpe(s);for(let c=0;c<l.length;c+=3)eE.normalize(l,c);return[[R.POSITION,new ht(Zpe(s),n,3,!0)],[R.NORMAL,new ht(l,n,3,!0)]]}function mQ(t,e,i,r,s,n,o,a,l=null){const c=i?hn(i):E(),u=e?hn(e):Ge(0,0,1);o??(o=mt());const d=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],f=s!=null&&s.length===2?s:[1,1],m=tw(1),g=[[R.POSITION,new ht(c,m,3,!0)],[R.NORMAL,new ht(u,m,3,!0)],[R.UV0,new ht(o,m,o.length)],[R.COLOR,new ht(d,m,4,!0)],[R.SIZE,new ht(f,m,2)]];if(n!=null&&(n=[n[0],n[1],n[2],n[3]],g.push([R.CENTEROFFSETANDDISTANCE,new ht(n,m,4)])),a){const y=[a[0],a[1],a[2],a[3]];g.push([R.FEATUREATTRIBUTE,new ht(y,m,4)])}return new Tn(t,g,null,Fs.Point,l)}const Nht=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function yXt(t,e=Nht){const i=new Array(12);for(let c=0;c<4;c++)for(let u=0;u<3;u++)i[3*c+u]=e[c][u];const r=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[R.POSITION,new ht(i,r,3,!0)],[R.NORMAL,new ht(s,n,3,!0)],[R.UV0,new ht(o,r,2,!0)],[R.COLOR,new ht(a,n,4,!0)]];return new Tn(t,l)}function Xpe(t,e,i,r,s,n=!0,o=!0){let a=0;const l=i,c=e;let u=Pr(0,a,0),d=Pr(0,a+c,0),f=Pr(0,-1,0),m=Pr(0,1,0);s&&(a=c,d=Pr(0,0,0),u=Pr(0,a,0),f=Pr(0,1,0),m=Pr(0,-1,0));const g=[d,u],y=[f,m],v=r+2,b=Math.sqrt(c*c+l*l);if(s)for(let O=r-1;O>=0;O--){const D=O*(2*Math.PI/r),U=Pr(Math.cos(D)*l,a,Math.sin(D)*l);g.push(U);const k=Pr(c*Math.cos(D)/b,-l/b,c*Math.sin(D)/b);y.push(k)}else for(let O=0;O<r;O++){const D=O*(2*Math.PI/r),U=Pr(Math.cos(D)*l,a,Math.sin(D)*l);g.push(U);const k=Pr(c*Math.cos(D)/b,l/b,c*Math.sin(D)/b);y.push(k)}const w=new Array,x=new Array;if(n){for(let O=3;O<g.length;O++)w.push(1),w.push(O-1),w.push(O),x.push(0),x.push(0),x.push(0);w.push(g.length-1),w.push(2),w.push(1),x.push(0),x.push(0),x.push(0)}if(o){for(let O=3;O<g.length;O++)w.push(O),w.push(O-1),w.push(0),x.push(O),x.push(O-1),x.push(1);w.push(0),w.push(2),w.push(g.length-1),x.push(1),x.push(2),x.push(y.length-1)}const S=Es(3*v);for(let O=0;O<v;O++)S[3*O]=g[O][0],S[3*O+1]=g[O][1],S[3*O+2]=g[O][2];const C=Es(3*v);for(let O=0;O<v;O++)C[3*O]=y[O][0],C[3*O+1]=y[O][1],C[3*O+2]=y[O][2];const M=[[R.POSITION,new ht(S,w,3,!0)],[R.NORMAL,new ht(C,x,3,!0)]];return new Tn(t,M)}function Fht(t,e,i,r,s,n,o){const a=s?wJ(s):Pr(1,0,0),l=n?wJ(n):Pr(0,0,0);o??(o=!0);const c=wu();Ce(c,a);const u=wu();he(u,c,Math.abs(e));const d=wu();he(d,u,-.5),Ee(d,d,l);const f=Pr(0,1,0);Math.abs(1-Te(c,f))<.2&&de(f,0,0,1);const m=wu();ft(m,c,f),Ce(m,m),ft(f,m,c);const g=2*r+(o?2:0),y=r+(o?2:0),v=Es(3*g),b=Es(3*y),w=Es(2*g),x=new Array(3*r*(o?4:2)),S=new Array(3*r*(o?4:2));o&&(v[3*(g-2)]=d[0],v[3*(g-2)+1]=d[1],v[3*(g-2)+2]=d[2],w[2*(g-2)]=0,w[2*(g-2)+1]=0,v[3*(g-1)]=v[3*(g-2)]+u[0],v[3*(g-1)+1]=v[3*(g-2)+1]+u[1],v[3*(g-1)+2]=v[3*(g-2)+2]+u[2],w[2*(g-1)]=1,w[2*(g-1)+1]=1,b[3*(y-2)]=-c[0],b[3*(y-2)+1]=-c[1],b[3*(y-2)+2]=-c[2],b[3*(y-1)]=c[0],b[3*(y-1)+1]=c[1],b[3*(y-1)+2]=c[2]);const C=(k,H,V)=>{x[k]=H,S[k]=V};let M=0;const O=wu(),D=wu();for(let k=0;k<r;k++){const H=k*(2*Math.PI/r);he(O,f,Math.sin(H)),he(D,m,Math.cos(H)),Ee(O,O,D),b[3*k]=O[0],b[3*k+1]=O[1],b[3*k+2]=O[2],he(O,O,i),Ee(O,O,d),v[3*k]=O[0],v[3*k+1]=O[1],v[3*k+2]=O[2],w[2*k]=k/r,w[2*k+1]=0,v[3*(k+r)]=v[3*k]+u[0],v[3*(k+r)+1]=v[3*k+1]+u[1],v[3*(k+r)+2]=v[3*k+2]+u[2],w[2*(k+r)]=k/r,w[2*k+1]=1;const V=(k+1)%r;C(M++,k,k),C(M++,k+r,k),C(M++,V,V),C(M++,V,V),C(M++,k+r,k),C(M++,V+r,V)}if(o){for(let k=0;k<r;k++){const H=(k+1)%r;C(M++,g-2,y-2),C(M++,k,y-2),C(M++,H,y-2)}for(let k=0;k<r;k++){const H=(k+1)%r;C(M++,k+r,y-1),C(M++,g-1,y-1),C(M++,H+r,y-1)}}const U=[[R.POSITION,new ht(v,x,3,!0)],[R.NORMAL,new ht(b,S,3,!0)],[R.UV0,new ht(w,x,2,!0)]];return new Tn(t,U)}function _Xt(t,e,i,r,s,n){r=r||10,s=s==null||s,vt(e.length>1);const o=[[0,0,0]],a=[],l=[];for(let c=0;c<r;c++){a.push([0,-c-1,-(c+1)%r-1]);const u=c/r*2*Math.PI;l.push([Math.cos(u)*i,Math.sin(u)*i])}return kht(t,l,e,o,a,s,n)}function kht(t,e,i,r,s,n,o=Pr(0,0,0)){const a=e.length,l=Es(i.length*a*3+(6*r.length||0)),c=Es(i.length*a*3+(r?6:0)),u=new Array,d=new Array;let f=0,m=0;const g=E(),y=E(),v=E(),b=E(),w=E(),x=E(),S=E(),C=E(),M=E(),O=E(),D=E(),U=E(),k=E(),H=tr();de(M,0,1,0),Re(y,i[1],i[0]),Ce(y,y),n?(Ee(C,i[0],o),Ce(v,C)):de(v,0,0,1),tB(y,v,M,M,w,v,Jpe),ve(b,v),ve(U,w);for(let N=0;N<r.length;N++)he(x,w,r[N][0]),he(C,v,r[N][2]),Ee(x,x,C),Ee(x,x,i[0]),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2];c[m++]=-y[0],c[m++]=-y[1],c[m++]=-y[2];for(let N=0;N<s.length;N++)u.push(s[N][0]>0?s[N][0]:-s[N][0]-1+r.length),u.push(s[N][1]>0?s[N][1]:-s[N][1]-1+r.length),u.push(s[N][2]>0?s[N][2]:-s[N][2]-1+r.length),d.push(0),d.push(0),d.push(0);let V=r.length;const X=r.length-1;for(let N=0;N<i.length;N++){let z=!1;N>0&&(ve(g,y),N<i.length-1?(Re(y,i[N+1],i[N]),Ce(y,y)):z=!0,Ee(O,g,y),Ce(O,O),Ee(D,i[N-1],b),TD(i[N],O,H),v2(H,jh(D,g),C)?(Re(C,C,i[N]),Ce(v,C),ft(w,O,v),Ce(w,w)):tB(O,b,U,M,w,v,Jpe),ve(b,v),ve(U,w)),n&&(Ee(C,i[N],o),Ce(k,C));for(let W=0;W<a;W++)if(he(x,w,e[W][0]),he(C,v,e[W][1]),Ee(x,x,C),Ce(S,x),c[m++]=S[0],c[m++]=S[1],c[m++]=S[2],Ee(x,x,i[N]),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2],!z){const J=(W+1)%a;u.push(V+W),u.push(V+a+W),u.push(V+J),u.push(V+J),u.push(V+a+W),u.push(V+a+J);for(let K=0;K<6;K++){const ne=u.length-6;d.push(u[ne+K]-X)}}V+=a}const q=i[i.length-1];for(let N=0;N<r.length;N++)he(x,w,r[N][0]),he(C,v,r[N][1]),Ee(x,x,C),Ee(x,x,q),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2];const Z=m/3;c[m++]=y[0],c[m++]=y[1],c[m++]=y[2];const ye=V-a;for(let N=0;N<s.length;N++)u.push(s[N][0]>=0?V+s[N][0]:-s[N][0]-1+ye),u.push(s[N][2]>=0?V+s[N][2]:-s[N][2]-1+ye),u.push(s[N][1]>=0?V+s[N][1]:-s[N][1]-1+ye),d.push(Z),d.push(Z),d.push(Z);const L=[[R.POSITION,new ht(l,u,3,!0)],[R.NORMAL,new ht(c,d,3,!0)]];return new Tn(t,L)}function vXt(t,e,i,r){vt(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),vt(e[0].length===3,"createPolylineGeometry(): malformed vertex"),vt(i==null||i.length===e.length,"createPolylineGeometry: need same number of points and normals"),vt(i==null||i[0].length===3,"createPolylineGeometry(): malformed normal");const s=co(3*e.length),n=new Array(2*(e.length-1));let o=0,a=0;for(let c=0;c<e.length;c++){for(let u=0;u<3;u++)s[o++]=e[c][u];c>0&&(n[a++]=c-1,n[a++]=c)}const l=[[R.POSITION,new ht(s,n,3,!0)]];if(i){const c=Es(3*i.length);let u=0;for(let d=0;d<e.length;d++)for(let f=0;f<3;f++)c[u++]=i[d][f];l.push([R.NORMAL,new ht(c,n,3,!0)])}return r&&l.push([R.COLOR,new ht(r,R2(r.length/4),4)]),new Tn(t,l,null,Fs.Line)}function bXt(t,e,i,r,s,n=0){const o=new Array(18),a=[[-i,n,s/2],[r,n,s/2],[0,e+n,s/2],[-i,n,-s/2],[r,n,-s/2],[0,e+n,-s/2]],l=[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5];for(let c=0;c<6;c++)o[3*c]=a[c][0],o[3*c+1]=a[c][1],o[3*c+2]=a[c][2];return new Tn(t,[[R.POSITION,new ht(o,l,3,!0)]])}function wXt(t,e){const i=t.getMutableAttribute(R.POSITION).data;for(let r=0;r<i.length;r+=3){const s=i[r],n=i[r+1],o=i[r+2];de(rE,s,n,o),nt(rE,rE,e),i[r]=rE[0],i[r+1]=rE[1],i[r+2]=rE[2]}}function Uht(t,e=t){const i=t.attributes,r=i.get(R.POSITION).data,s=i.get(R.NORMAL).data;if(s){const n=e.getMutableAttribute(R.NORMAL).data;for(let o=0;o<s.length;o+=3){const a=s[o+1];n[o+1]=-s[o+2],n[o+2]=a}}if(r){const n=e.getMutableAttribute(R.POSITION).data;for(let o=0;o<r.length;o+=3){const a=r[o+1];n[o+1]=-r[o+2],n[o+2]=a}}}function B8(t,e,i,r,s){return!(Math.abs(Te(e,t))>s)&&(ft(i,t,e),Ce(i,i),ft(r,i,t),Ce(r,r),!0)}function tB(t,e,i,r,s,n,o){return B8(t,e,s,n,o)||B8(t,i,s,n,o)||B8(t,r,s,n,o)}const Jpe=.99619469809,rE=E();let Vht=class{constructor(e,i){this.type=Ya.Local,this._configuration=new rne,this._passParameters=new JG,this._configuration.geometry=sy.Cylinder,this._technique=i.techniques.acquire(Jz,this._configuration);const r=i.renderContext.rctx;this._vao=zht(r),this._vaoCount=J0(this._vao,"geometry");const s=new Xr;s.wrapMode=Mi.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new Er(r,s,nht)}destroy(){this._passParameters.texture=Ut(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const i=e.rctx,r=i.bindTechnique(this._technique,e.bindParameters,this._passParameters);Bht(Qpe,e.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",Qpe),i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Ci.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}};function zht(t){const e=pIe(1,2,!1),{data:i,indices:r}=e[0][1],s=Kpe.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o%3==0?o+2:o%3==2?o-2:o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new _y(t,Ai,{geometry:ku(Kpe)},{geometry:Sr.createVertex(t,cr.STATIC_DRAW,s.buffer)})}function Bht(t,e){xn(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const Qpe=ke(),Kpe=As().vec3f(R.POSITION),jht=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),RF=128,efe=-pJ,tfe=0,j8=50,Ght=()=>1-511/512,Hht=Ck([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let qht=class{constructor(e,i){this.view=e,this.type=Ya.Mars,this._passParameters=new JG,this._vaoCount=0,this._texV1=1;const r=_r(e.spatialReference);this._planetRadius=r.radius,this._outerRimWidth=r.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+efe)/this._planetRadius,this._middleRimFactor=(this._planetRadius+tfe)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=tfe/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniques=i.techniques;const s=i.renderContext.rctx;this._cameraChangeHandle=te(()=>{var a;return(a=this.view.state)==null?void 0:a.camera},()=>i.requestRender(),hr),this._vao=this._createRibbon(s),this._vaoCount=J0(this._vao,"geometry"),this._fadeVao=vy(s),this._fadeVaoCount=J0(this._fadeVao,"geometry");const n=new Xr;n.wrapMode=Mi.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new Er(s,n,jht);const o=new rne;o.geometry=sy.Cone,this._coneTechnique=this._techniques.acquire(Jz,o),o.geometry=sy.Underground,this._undergroundTechnique=this._techniques.acquire(Jz,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=Ut(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const i=e.bindParameters.camera;this._update(i);const r=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(r.bindTechnique(this._coneTechnique,e.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(Ci.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(r.bindTechnique(this._undergroundTechnique,e.bindParameters,this._passParameters),r.bindVAO(this._fadeVao),r.drawArrays(Ci.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const i=E(),r=this._planetRadius,s=Ve(e.eye),n=s-r;if(n<0){const m=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=m}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(j8,n),a=r+efe;this._passParameters.innerScale=Wht(r+o,r,a)-1,this._passParameters.altitudeFade=kse(n),he(i,e.eye,(r+j8)/s),ife(i,e.center,e.up,r,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,i,e.up,this._passParameters.silhouette),c=Ght(),u=Hht(n);let d=this._texV0+c*this._texVScale,f=this._texV0+l*u*this._texVScale;if(n>j8){ife(e.eye,e.center,e.up,r,this._passParameters.silhouette);const m=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),g=Ne((m-1.5)/(l-1.5),0,1);d=this._texV0+g*c*this._texVScale,f=this._texV0+Bt(this._texV1,l*u,g)*this._texVScale}Li(this._passParameters.texV,d,f)}_createRibbon(e){const i=Es(3+3*RF*3),r=new Uint32Array(3*RF*5);i[0]=0,i[1]=0,i[2]=-1;for(let o=0;o<RF;o++){const a=9*o+3;i[a]=o,i[a+1]=this._innerRimFactor,i[a+2]=-1,i[a+3]=o,i[a+4]=this._middleRimFactor,i[a+5]=0,i[a+6]=o,i[a+7]=this._outerRimFactor,i[a+8]=1;const l=3*o+1,c=o===RF-1?1:l+3,u=15*o;r[u]=l,r[u+1]=l+1,r[u+2]=c+1,r[u+3]=c+1,r[u+4]=c,r[u+5]=l,r[u+6]=l+1,r[u+7]=l+2,r[u+8]=c+2,r[u+9]=c+2,r[u+10]=c+1,r[u+11]=l+1,r[u+12]=l,r[u+13]=c,r[u+14]=0}const s=rfe.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new _y(e,Ai,{geometry:ku(rfe)},{geometry:Sr.createVertex(e,cr.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(e,i,r,s){return Ee(sE,s.center,s.v2),he($F,sE,this._outerRimFactor),Kj(G8,i,sE,r),ype(sE,G8,e.projectionMatrix,e.viewport,sE),ype($F,G8,e.projectionMatrix,e.viewport,$F),Cr(sE,$F)/e.height}};function ife(t,e,i,r,s){const n=Ve(t),o=r*Math.sqrt(n*n-r*r)/n,a=Math.sqrt(r*r-o*o),l=s.v1,c=s.v2;return he(s.center,t,a/n),ft(l,t,e),sl(l)<1&&ft(l,t,i),he(l,l,o/Ve(l)),ft(c,l,t),he(c,c,o/Ve(c)),o}const G8=ke(),sE=E(),$F=E();function Wht(t,e,i){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-i*i)+e*i)}const rfe=As().vec3f(R.POSITION);var f_;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(f_||(f_={}));let gQ=class extends tc{constructor(){super(...arguments),this.type=f_.Rain}};h([B({count:f_.COUNT})],gQ.prototype,"type",void 0);function fIe(t){const e=new Hi;return e.attributes.add(R.POSITION,"vec3"),e.attributes.add(R.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new Wt("cameraPosition",(i,r)=>r.camera.eye)),e.vertex.uniforms.add(new Wt("offset",(i,r)=>Zht(i,r))),e.vertex.uniforms.add(new et("width",i=>i.width)),e.vertex.uniforms.add(new us("proj",(i,r)=>r.camera.projectionMatrix)),e.vertex.uniforms.add(new us("view",(i,r)=>r.camera.viewMatrix)),e.vertex.uniforms.add(new et("time",i=>i.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(T`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===f_.Rain?T`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:T`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add(new et("opacity",i=>i.opacity),new Wt("particleColor",(i,r)=>Yht(r,t))),e.fragment.code.add(T`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===f_.Rain?T`d = 0.35 * smoothstep(0.5, 0.0, d);`:T`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function Zht(t,e){const i=e.camera.eye,r=.5*t.width,s=1/t.width,n=mEe(yQ,de(yQ,(i[0]+r)*s,(i[1]+r)*s,(i[2]+r)*s));return Ii(n,i,he(n,n,t.width))}function Yht(t,e){const i=e.type===f_.Rain?Jht:Xht,r=he(yQ,i,Qht),s=t.camera.eye;Ce(sfe,s);const n=Math.max(0,Te(sfe,t.lighting.mainLight.direction));return xr(r,r,i,n)}const yQ=E(),sfe=E(),Xht=Ge(1,1,1),Jht=Ge(.85,.85,.85),Qht=.7,Kht=Object.freeze(Object.defineProperty({__proto__:null,build:fIe},Symbol.toStringTag,{value:"Module"}));let edt=class extends Fr{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},_Q=class mIe extends Qi{initializeProgram(e){return new Ki(e.rctx,mIe.shader.get().build(this.configuration),iB)}initializePipeline(){return Jt({blending:ua(Be.ONE,Be.ONE,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),depthTest:{func:br.LEQUAL},colorWrite:ui})}};_Q.shader=new qi(Kht,()=>ce(()=>Promise.resolve().then(()=>fHt),void 0));const iB=new Map([[R.POSITION,0],[R.INSTANCEFEATUREATTRIBUTE,1]]);let gIe=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:i}){return i!=null?this._time!==i&&(this._time=i,!0):(this._time=this._time+e,e!==0)}},tdt=class{constructor(e,i){this.deltaTime=e,this.fixedTime=i}},D$=class extends Ue{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new edt,this._animation=new gIe,this._passParameters.time=0,this._passParameters.radius=_r(e.view.spatialReference).radius,this._techniques=e.context.techniques}destroy(){this._numParticles=0,this._snowTechniqueCached=hi(this._snowTechniqueCached),this._rainTechniqueCached=hi(this._rainTechniqueCached),this._vao=Ut(this._vao),this._instanceIdBuffer=Ut(this._instanceIdBuffer)}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new gQ;e.type=f_.Rain,this._rainTechniqueCached=this._techniques.acquire(_Q,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new gQ;e.type=f_.Snow,this._snowTechniqueCached=this._techniques.acquire(_Q,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,i,r){const s=r==="rainy"?this._rainTechnique:this._snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),s==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=e.bindParameters.cloudsFade.opacity),this._passParameters.opacity<=0))return;const o=.35;i=i<.5?Bt(0,o,2*i):Bt(o,1,2*(i-.5)),this._passParameters.time=(r==="rainy"?this._rainSpeed:this._snowSpeed)*Cie(this._animation.time)%1e5;const a=n.bindTechnique(s,e.bindParameters,this._passParameters);n.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),Bse(n,iB,this._instanceIdBuffer,nfe,0),n.drawArraysInstanced(Ci.TRIANGLES,0,3,this._numParticles*i),QRe(n,iB,this._instanceIdBuffer,nfe)}_ensureResources(e){this._vao==null&&(this._vao=idt(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const i=[];for(let r=0;r<this._numParticles;r++)i.push(r);return Sr.createVertex(e,cr.STATIC_DRAW,new Float32Array(i))}};function idt(t){const e=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new _y(t,iB,{geometry:ku(rdt)},{geometry:Sr.createVertex(t,cr.STATIC_DRAW,e)})}h([p({constructOnly:!0})],D$.prototype,"context",void 0),h([p({constructOnly:!0})],D$.prototype,"view",void 0),D$=h([I("esri.views.3d.environment.Precipitation")],D$);const rdt=As().vec3f(R.POSITION),nfe=ku(As().f32(R.INSTANCEFEATUREATTRIBUTE),1);function yIe(){const t=new Hi;return t.attributes.add(R.POSITION,"vec3"),t.attributes.add(R.COLOR,"vec4"),t.attributes.add(R.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new us("transform",(e,i)=>sdt(e,i)),new ji("viewport",(e,i)=>i.camera.fullViewport),new et("pixelRatio",(e,i)=>i.camera.pixelRatio)),t.vertex.code.add(T`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(T`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),t}function sdt(t,e){return xn(iv,e.camera.projectionMatrix),iv[10]=24e-8-1,iv[11]=-1,iv[14]=(24e-8-2)*e.camera.near,gr(iv,iv,e.camera.viewMatrix),gr(iv,iv,t.modelMatrix)}const iv=ke(),ndt=Object.freeze(Object.defineProperty({__proto__:null,build:yIe},Symbol.toStringTag,{value:"Module"}));let odt=class extends Fr{constructor(){super(...arguments),this.modelMatrix=ke()}},_Ie=class vIe extends Qi{constructor(e){super(e,new tc,()=>this.destroy())}initializeProgram(e){return new Ki(e.rctx,vIe.shader.get().build(),Ai)}initializePipeline(){return Jt({blending:ua(Be.SRC_ALPHA,Be.ONE,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),depthTest:{func:br.LEQUAL},colorWrite:ui})}};_Ie.shader=new qi(ndt,()=>ce(()=>Promise.resolve().then(()=>mHt),void 0));let Zv=class extends Ue{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._passParameters=new odt,this._updatingTracking=new Z0}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=Jl(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=hi(this._technique),this._vao=Ut(this._vao),Cw=null}render(e){const{rctx:i}=e;if(this._ensureResources(i),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const r=i.bindTechnique(this._technique,e.bindParameters,this._passParameters);i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Ci.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||Cw==null)return;this._technique=new _Ie({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=Cw.byteLength/bIe;const i=new Float32Array(Cw,0,2*this._numPoints),r=new Uint8Array(Cw,2*this._numPoints*4,this._numPoints);this._vao=adt(e,i,r,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,s=>this._update(s),$t)}_update(e){if(!e)return;const i=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*ldt(e),s=xn(this._passParameters.modelMatrix,fdt);UA(s,s,-r*Math.PI),gr(s,pdt,s),UA(s,s,-i*Math.PI),this.requestRender()}_createLoadDataTask(){if(Cw!=null)return null;const e=uy(async i=>{const{data:r}=await J7e("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:i});cdt(r),Cw=r});return e.promise.catch(i=>{os(i)||se.getLogger(this).error(i)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}};function adt(t,e,i,r){const s=ofe.createBuffer(r),n=s.position,o=s.color,a=s.size;for(let l=0;l<r;l++){const c=e[2*l],u=e[2*l+1];n.set(l,0,-Math.cos(c)*Math.sin(u)),n.set(l,1,-Math.sin(c)*Math.sin(u)),n.set(l,2,-Math.cos(u));const d=hdt(i[l]),f=udt(ddt[d[1]]);o.set(l,0,255*f[0]),o.set(l,1,255*f[1]),o.set(l,2,255*f[2]),o.set(l,3,255),a.set(l,d[0])}return new _y(t,Ai,{geometry:ku(ofe)},{geometry:Sr.createVertex(t,cr.STATIC_DRAW,s.buffer)})}function ldt(t){const e=t,i=new Date(t.getFullYear(),0,1,11,58,56);return(+e-+i)/(+new Date(t.getFullYear()+1,0,1,11,58,55)-+i)}function cdt(t){if(!t)throw new G("stars:no-data-received","Failed to create stars because star catalogue is missing");const e=t.byteLength/bIe;if(e%1!=0||e>5e4||e<5e3)throw new G("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}function udt(t){return[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)]}function hdt(t){return t>=192?[2.9,t-192]:t>=160?[2.5,t-160]:t>=128?[2,t-128]:t>=96?[1.5,t-96]:t>=64?[1,t-64]:t>=32?[.7,t-32]:[.4,t]}h([p({constructOnly:!0})],Zv.prototype,"view",void 0),h([p({constructOnly:!0})],Zv.prototype,"requestRender",void 0),h([p({readOnly:!0})],Zv.prototype,"updating",null),h([p()],Zv.prototype,"_loadDataTask",void 0),h([p()],Zv.prototype,"_updatingTracking",void 0),Zv=h([I("esri.views.3d.environment.Stars")],Zv);const ddt=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],pdt=Ire(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),fdt=Ire(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),bIe=9,ofe=As().vec3f(R.POSITION).vec4u8(R.COLOR).f32(R.SIZE);let Cw=null;const o6={required:[]},fne={required:[j.Depth]};let a6=class extends Ue{consumes(){return o6}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}get materialReference(){return null}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}queryRenderOccludedState(e){return!1}},mne=class extends a6{},wIe=class extends a6{constructor(){super(...arguments),this.drapedPriority=0}},mdt=class extends a6{},gdt=class extends a6{};function vQ(t){return"prepareTechnique"in t}function afe(t){return"prepareTechniques"in t}var lA;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(lA||(lA={}));let fa=class extends mne{constructor(e){super(e),this.produces=new Map([[Pe.OPAQUE_ENVIRONMENT,()=>!(this._atmosphere===null&&this._stars===null)],[Pe.TRANSPARENT_ENVIRONMENT,()=>this._atmosphere!==null]]),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new H8,this._newWeatherParameters=new H8,this._fadedWeatherParameters=new H8,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){var e;this.removeHandles(),this.uninitializeRenderContext(),((e=this.view)==null?void 0:e._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:Ya.None}consumes(){return this._atmosphereType===Ya.Realistic?fne:o6}updateAnimation(e){return this._precipitation!=null&&this._precipitation.update(e)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return Ve(this.view.state.camera.eye)-_r(this.view.spatialReference).radius<=R0}get usedMemory(){var e;return((e=this._clouds)==null?void 0:e.usedMemory)??0}get _stars(){var s;const e=this.view,i=((s=e.environment)==null?void 0:s.starsEnabled)??!1,r=this._get("_stars");return i&&this._context!=null?r??new Zv({view:e,requestRender:()=>this._setNeedsRender()}):(qe(r),null)}get _precipitation(){const e=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return qe(e),null;const i=this.view,r=this._context;return e!=null&&e.context===r?e:(qe(e),new D$({context:r,view:i}))}get _clouds(){const e=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return qe(e),null;if(e!=null)return e;const i=this.view,r=this._context;return qe(e),new vc({context:r,view:i,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const e=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return qe(e),null;const i=this.view.state.viewingMode,r=this._context.renderContext.rctx,s=_r(this.view.spatialReference).radius;return e!=null&&e.viewingMode===i&&e.planetRadius===s?e:(qe(e),new Nx({rctx:r,viewingMode:i,planetRadius:s,requestRender:()=>this._setNeedsRender()}))}get _fog(){const e=this._get("_fog");if(!this.weatherEnabled||this._context==null)return qe(e),null;if(e!=null)return e;const i=this.view,r=this._context,s=this._context.renderContext.rctx,n=this.view.state.viewingMode;return new Fx({context:r,view:i,rctx:s,viewingMode:n})}get weatherEnabled(){var e,i;return!!((i=(e=this.view)==null?void 0:e.environmentManager)!=null&&i.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(e=null){this._context=e;const i=()=>this._setNeedsRender();this.addHandles([te(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),r=>this._updateAtmosphere(r),hr),te(()=>this._stars,i),te(()=>this._precipitation,i),te(()=>this._clouds,()=>this._updateWeather(),$t),te(()=>this._fog,()=>this._updateFogHaze(),$t),te(()=>this.view.state.mode,()=>this._setNeedsRender(),or),te(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},hr)])}uninitializeRenderContext(){this._context=null,this._atmosphere=qe(this._atmosphere),this._set("_stars",qe(this._stars)),this._set("_precipitation",qe(this._precipitation)),this._set("_clouds",qe(this._clouds)),this._set("_cloudsComposition",qe(this._cloudsComposition)),this._set("_fog",qe(this._fog))}prepareRender(e){var i;e.bindParameters.cloudsFade.data=zct(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&((i=e.bindParameters.cloudsFade.data)==null?void 0:i.cubeMap)!=null&&(this._updateWeatherFading(e.bindParameters,e.time),e.bindParameters.cloudsFade.renderingStage===Pg.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),e.bindParameters.cloudsFade.data=null))}renderNode(e){var i,r,s,n,o,a,l,c;switch(e.bindParameters.slot){case Pe.OPAQUE_ENVIRONMENT:(i=this._stars)==null||i.render(e),this.atmosphere!=null&&(this.atmosphere.render(e,(n=(s=(r=this.view)==null?void 0:r._stage)==null?void 0:s.renderer)==null?void 0:n.fullResolutionAtmosphere),this._cloudsComposition&&e.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(e)),e.bindParameters.cloudsFade.isFading&&this._context&&((o=e.bindParameters.cloudsFade.data)==null?void 0:o.cubeMap)!=null&&this._context.requestRender());break;case Pe.TRANSPARENT_ENVIRONMENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(e,this._weatherParameters.hazeAmount,(c=(l=(a=this.view)==null?void 0:a._stage)==null?void 0:l.renderer)==null?void 0:c.fullResolutionAtmosphere),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(e,this._weatherParameters.fog),this._precipitation)){const u=this.view.environment.weather;u.type!=="rainy"&&u.type!=="snowy"||this._precipitation.render(e,u.precipitation,u.type)}}}updateLightSources(e,i,r,s){if(this._context!=null){const n=this._context.renderContext;n.bindParameters.oldLighting.copyFrom(n.bindParameters.lighting),n.bindParameters.newLighting.noonFactor=i,n.bindParameters.newLighting.globalFactor=r,n.bindParameters.newLighting.set(e),s===lA.Faded||n.bindParameters.weatherFading?n.bindParameters.fadeLighting(0):n.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return e==null?null:e.type==="rainy"||e.type==="snowy"?{type:e.type,weatherAdjustment:e.cloudCover,effect:e.precipitation}:{type:e.type,weatherAdjustment:e.type==="foggy"?e.fogStrength:e.cloudCover}}_updateWeatherFading(e,i){e.cloudsFade.updateFading(e.camera,this.view.state.mode,i,this.view.qualitySettings.fadeDuration),e.cloudsFade.updateParallax(e.camera),e.weatherFading&&(ydt(e),this._updateFogAtmoshpere(e))}_updateFogAtmoshpere(e){e.cloudsFade.fadeMode!==Hr.CROSS_FADE&&e.cloudsFade.fadeMode!==Hr.FADE_IN?this._fadeWeather(0):this._fadeWeather(e.cloudsFade.fadeFactor)}_fadeWeather(e){const{_newWeatherParameters:i,_oldWeatherParameters:r}=this;e>=1?this._weatherParameters=i:(this._fadedWeatherParameters.lerp(r,i,e),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const e=this._weatherUpdateParameters;e!=null&&this._clouds!=null&&(this._clouds.applyPreset(Za[e.type],e.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const e=this._weatherUpdateParameters;if(this._fog==null||e==null||this._context==null)return;const i=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),e.type){case"foggy":this._newWeatherParameters.fog.strength=Bt(3e-5,.005,e.weatherAdjustment**3),ve(this._newWeatherParameters.fog.color,lfe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=Bt(4e-6,2e-4,(e.effect??0)**3),ve(this._newWeatherParameters.fog.color,_dt),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=Bt(4e-6,2e-4,(e.effect??0)**3),ve(this._newWeatherParameters.fog.color,lfe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}i.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(e){const i=this._selectAtmosphereType(e);if(i!==Ya.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==i){this._atmosphere=qe(this._atmosphere);const r=this._getAtmosphereClass(i);r&&(this._atmosphere=new r(this.view,this._context))}}else this._atmosphere=qe(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(e){switch(e){case Ya.Realistic:return Uct;case Ya.Local:return Vht;case Ya.Mars:return qht;default:case Ya.None:return null}}_selectAtmosphereType(e){const{enabled:i,viewingMode:r}=e;return!i||m2(this.view.spatialReference)?Ya.None:r===Xe.Local?Ya.Local:this._context!=null&&RS(this.view.spatialReference)?Ya.Realistic:f2(this.view.spatialReference)?Ya.Mars:Ya.None}get test(){}};h([p({constructOnly:!0})],fa.prototype,"view",void 0),h([p({readOnly:!0})],fa.prototype,"atmosphere",null),h([p({readOnly:!0})],fa.prototype,"_atmosphereType",null),h([p({type:Boolean,readOnly:!0})],fa.prototype,"updating",null),h([p({readOnly:!0})],fa.prototype,"weatherVisible",null),h([p()],fa.prototype,"_context",void 0),h([p()],fa.prototype,"_atmosphere",void 0),h([p({readOnly:!0})],fa.prototype,"_stars",null),h([p({readOnly:!0})],fa.prototype,"_precipitation",null),h([p({readOnly:!0})],fa.prototype,"_clouds",null),h([p({readOnly:!0})],fa.prototype,"_cloudsComposition",null),h([p({readOnly:!0})],fa.prototype,"_fog",null),h([p({readOnly:!0})],fa.prototype,"weatherEnabled",null),h([p({readOnly:!0})],fa.prototype,"_precipitationEnabled",null),h([p({readOnly:!0})],fa.prototype,"_weatherUpdateParameters",null),fa=h([I("esri.views.3d.environment.EnvironmentRenderer")],fa);let H8=class{constructor(){this.fog=new Jut,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,ve(this.fog.color,e.fog.color)}lerp(e,i,r){this.fog.amount=Bt(e.fog.amount,i.fog.amount,r),this.hazeAmount=Bt(e.hazeAmount,i.hazeAmount,r),this.fog.strength=Bt(e.fog.strength,i.fog.strength,r),xr(this.fog.color,e.fog.color,i.fog.color,r)}};function ydt(t){t.cloudsFade.fadeMode!==Hr.CROSS_FADE&&t.cloudsFade.fadeMode!==Hr.FADE_IN?t.fadeLighting(0):t.fadeLighting(t.cloudsFade.fadeFactor)}const _dt=Ge(.5,.5,.5),lfe=Ge(1.5,1.5,1.5);var kXt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zD(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var cfe,ufe,hfe,xIe={exports:{}};cfe=xIe,ufe=function(){var t=Math.PI,e=Math.sin,i=Math.cos,r=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,u=2451545,d={dec:0,ra:0};function f(L){return L.valueOf()/l-.5+c}function m(L){return new Date((L+.5-c)*l)}function g(L){return f(L)-u}var y=23.4397*a;function v(L,N){return n(e(L)*i(y)-r(N)*e(y),i(L))}function b(L,N){return s(e(N)*i(y)+i(N)*e(y)*e(L))}function w(L,N,z){return n(e(L),i(L)*e(N)-r(z)*i(N))}function x(L,N,z){return s(e(N)*e(z)+i(N)*i(z)*i(L))}function S(L,N){return a*(280.16+360.9856235*L)-N}function C(L){return a*(357.5291+.98560028*L)}function M(L){return a*(1.9148*e(L)+.02*e(2*L)+3e-4*e(3*L))}function O(L,N){return L+N+102.9372*a+t}function D(L,N){var z=C(L),W=O(z,M(z));return N||(N={dec:0,ra:0}),N.dec=b(W,0),N.ra=v(W,0),N}var U={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(L,N,z,W){var J=a*-z,K=a*N,ne=g(L),we=D(ne,d),Ie=S(ne,J)-we.ra;return W||(W={azimuth:0,altitude:0}),W.azimuth=w(Ie,K,we.dec),W.altitude=x(Ie,K,we.dec),W}},k=[[-.83,"sunrise","sunset"]];U.addTime=function(L,N,z){k.push([L,N,z])};var H=9e-4;function V(L,N){return Math.round(L-H-N/(2*t))}function X(L,N,z){return H+(L+N)/(2*t)+z}function q(L,N,z){return u+L+.0053*e(N)-.0069*e(2*z)}function Z(L,N,z){return o((e(L)-e(N)*e(z))/(i(N)*i(z)))}function ye(L){var N=a*(134.963+13.064993*L),z=a*(93.272+13.22935*L),W=a*(218.316+13.176396*L)+6.289*a*e(N),J=5.128*a*e(z),K=385001-20905*i(N);return{ra:v(W,J),dec:b(W,J),dist:K}}return U.getTimes=function(L,N,z){var W=a*-z,J=a*N,K=V(g(L),W),ne=X(0,W,K),we=C(ne),Ie=M(we),je=O(we,Ie),ut=b(je,0),ot=q(ne,we,je);function at(ae){return q(X(Z(ae,J,ut),W,K),we,je)}function tt(ae){var fe=(e(ae)-e(J)*e(ut))/(i(J)*i(ut));return fe<-1?U.PolarException.MIDNIGHT_SUN:fe>1?U.PolarException.POLAR_NIGHT:U.PolarException.NORMAL}var rt,li,Y,ee,re,Ae={solarNoon:m(ot),nadir:m(ot-.5),polarException:U.PolarException.NORMAL};for(rt=0,li=k.length;rt<li;rt+=1)re=ot-((ee=at((Y=k[rt])[0]*a))-ot),Ae[Y[1]]=m(re),Ae[Y[2]]=m(ee);return Ae.polarException=tt(k[0][0]*a),Ae},U.getMoonPosition=function(L,N,z){var W=a*-z,J=a*N,K=g(L),ne=ye(K),we=S(K,W)-ne.ra,Ie=x(we,J,ne.dec);return Ie+=.017*a/r(Ie+10.26*a/(Ie+5.1*a)),{azimuth:w(we,J,ne.dec),altitude:Ie,distance:ne.dist}},U.getMoonFraction=function(L){var N=g(L),z=D(N),W=ye(N),J=149598e3,K=o(e(z.dec)*e(W.dec)+i(z.dec)*i(W.dec)*i(z.ra-W.ra)),ne=n(J*e(K),W.dist-J*i(K));return(1+i(ne))/2},U},(hfe=ufe())!==void 0&&(cfe.exports=hfe);const QS=zD(xIe.exports),Bl={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let IF=class{constructor(e,i){this.direct=e,this.ambient=i}};function vdt(t,e,i,r,s,n){de(n.ambient.color,1,1,1),n.ambient.intensity=Bl.global.ambient,de(n.direct.color,1,1,1),n.direct.intensity=Bl.global.direct;const o=e[2],a=Ne((Math.abs(o)-Bl.local.altitude)/(Bl.global.altitude-Bl.local.altitude),0,1);let l;if(n.globalFactor=a,t!=null&&(l=QS.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=Cdt(t,l,r);else{const u=EIe(r);c={direct:{intensity:Bl.local.directAtNoon*u.direct,color:Ge(1,1,1)},ambient:{intensity:Bl.local.ambientAtNoon*u.ambient,color:Ge(1,1,1)},timeOfDay:"early afternoon"}}xr(n.ambient.color,c.ambient.color,n.ambient.color,a),n.ambient.intensity=Bt(c.ambient.intensity,n.ambient.intensity,a),xr(n.direct.color,c.direct.color,n.direct.color,a),n.direct.intensity=Bt(c.direct.intensity,n.direct.intensity,a),n.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,n.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}n.noonFactor=t!=null?Edt(t,l):1,t!=null?bdt(t,e,i,n.direct.directionToLightSource):TIe(s,i,n.direct.directionToLightSource)}function TIe(t,e,i){e===Xe.Global?Ce(Y8,t.eye):de(Y8,0,0,1),he(X8,t.viewForward,-1);const r=Pz(X8,Y8),s=Math.max(r-2*J8,0),n=.85*s/(s+1),o=Math.max(J8,r-J8-n);Du(xfe,-o,t.viewRight),nt(i,X8,xfe),Ee(i,i,he(Mdt,t.viewRight,Adt)),Ce(i,i)}function bdt(t,e,i,r){const s=Sdt,n=tp(Tdt);if(i===Xe.Global)QS.getPosition(t,0,0,s),de(r,0,0,-1),kA(n,n,-s.azimuth),Qj(n,n,-s.altitude),nt(r,r,n);else{const o=Bl.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=Ne(c,0,1),c<1?(QS.getPosition(t,e[1],e[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),de(r,0,-1,0),UA(n,n,-s.azimuth),kA(n,n,-s.altitude),nt(r,r,n)}}function wdt(t,e){if(e===Xe.Global)return!0;const i=Bl.planarDirection;return Math.abs(t)<i.localAltitude}const xdt=Ge(.5773502691896258,-.5773502691896258,.5773502691896258);let SIe=class{constructor(){this.ambient={color:Ge(1,1,1),intensity:.55},this.direct={color:Ge(1,1,1),intensity:.55,directionToLightSource:hn(xdt)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const Tdt=ke(),Sdt={azimuth:0,altitude:0};function Edt(t,e){const i=t.valueOf();let r,s;e.polarException===QS.PolarException.MIDNIGHT_SUN?(r=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=r+432e6):e.polarException===QS.PolarException.POLAR_NIGHT?(r=i-2,s=i-1):(r=e.sunrise.valueOf(),s=e.sunset.valueOf());const n=r+(s-r)/2;return 1-Ne(Math.abs(i-n)/432e5,0,1)}function EIe(t){switch(t){case"disabled":case"sunny":case"cloudy":return new IF(1,1);case"rainy":return new IF(.4,1.2);case"snowy":return new IF(.5,1.3);case"foggy":return new IF(.2,1.6)}}function dfe(t,e){const i=(t[0]+t[1]+t[2])/3;t[0]+=(i-t[0])*e,t[1]+=(i-t[1])*e,t[2]+=(i-t[2])*e}const q8=Ge(.01,.01,.01),bQ=Ge(1,.6,.5),wQ=Ge(1,.98,.98),pfe=Ge(1,1,1),W8=Ge(.8,.8,1),xQ=Ge(.8,.8,1),TQ=Ge(.98,.98,1),ffe=Ge(1,1,1),Z8=Ei(.01,Bl.local.ambientAtNight),SQ=Ei(Bl.local.directAtTwilight,Bl.local.ambientAtTwilight),EQ=Ei(.9*Bl.local.directAtNoon,Bl.local.ambientAtNoon),mfe=Ei(Bl.local.directAtNoon,Bl.local.ambientAtNoon),gfe=EQ,yfe=wQ,_fe=TQ,vfe=SQ,bfe=bQ,wfe=xQ;function Cdt(t,e,i){const r=t.valueOf();let s,n;e.polarException===QS.PolarException.MIDNIGHT_SUN?(s=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=s+432e6):e.polarException===QS.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=e.sunrise.valueOf(),n=e.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,u=a+l,d=.06*o,f=s-d/2,m=s+d/2,g=n-d/2,y=n+d/2,v=mt(),b=E(),w=E();let x="";if(r<f||r>y)Da(v,Z8),ve(b,q8),ve(w,W8),x="night";else if(r<m){const M=(r-f)/(m-f);Nd(v,Z8,SQ,M),xr(b,q8,bQ,M),xr(w,W8,xQ,M),x="sun rising"}else if(r<c){const M=(r-m)/(c-m);Nd(v,SQ,EQ,M),xr(b,bQ,wQ,M),xr(w,xQ,TQ,M),x="early morning"}else if(r<a){const M=(r-c)/(a-c);Nd(v,EQ,mfe,M),xr(b,wQ,pfe,M),xr(w,TQ,ffe,M),x="late morning"}else if(r<u){const M=(r-a)/(u-a);Nd(v,mfe,gfe,M),xr(b,pfe,yfe,M),xr(w,ffe,_fe,M),x="early afternoon"}else if(r<g){const M=(r-u)/(g-u);Nd(v,gfe,vfe,M),xr(b,yfe,bfe,M),xr(w,_fe,wfe,M),x="late afternoon"}else if(r<y){const M=(r-g)/(y-g);Nd(v,vfe,Z8,M),xr(b,bfe,q8,M),xr(w,wfe,W8,M),x="sun setting"}let S=0;switch(i){case"rainy":case"foggy":S=.8;break;case"snowy":S=.5}S>0&&(dfe(b,S),dfe(w,S));const C=EIe(i);return{direct:{intensity:v[0]*C.direct,color:b},ambient:{intensity:v[1]*C.ambient,color:w},timeOfDay:x}}const xfe=ke(),Y8=E(),X8=E(),Mdt=E(),J8=.25,Adt=.2;function CIe(t){return RS(t)?o_(t)||Hf(t)||OA(t)||Q3(t)?Met:t:Gh(t)}var Gg;function zXt(t){return Pdt(t,Gg.Horizontal)}function Pdt(t,e){const{hasZ:i,spatialReference:r}=t,s=CIe(r);let n=0;const o=Y2e(s);if(o==null)return null;const a=e===Gg.Direct?MIe:AIe;for(const l of t.paths){if(l.length<2)continue;const c=l.length-1;for(let u=0;u<c;++u){const d=l[u];Io[0]=d[0],Io[1]=d[1],Io[2]=i?d[2]:0;const f=l[u+1];Lo[0]=f[0],Lo[1]=f[1],Lo[2]=i?f[2]:0;const m=a(Io,Lo,r);if(m==null)return null;n+=m.value}}return Y0(n,o)}function BXt(t,e){const{spatialReference:i}=t;return hs(i,e.spatialReference)?(Io[0]=t.x,Io[1]=t.y,Io[2]=t.hasZ?t.z:0,Lo[0]=e.x,Lo[1]=e.y,Lo[2]=e.hasZ?e.z:0,$dt(Io,Lo,i)):null}function Odt(t,e){const{spatialReference:i}=t;return hs(i,e.spatialReference)?(Io[0]=t.x,Io[1]=t.y,Io[2]=t.hasZ?t.z:0,Lo[0]=e.x,Lo[1]=e.y,Lo[2]=e.hasZ?e.z:0,MIe(Io,Lo,i)):null}function jXt(t,e){const{spatialReference:i}=t;return hs(i,e.spatialReference)?(Io[0]=t.x,Io[1]=t.y,Io[2]=t.hasZ?t.z:0,Lo[0]=e.x,Lo[1]=e.y,Lo[2]=e.hasZ?e.z:0,AIe(Io,Lo,i)):null}function GXt(t,e){const{spatialReference:i}=t;return hs(i,e.spatialReference)?(Io[0]=t.x,Io[1]=t.y,Io[2]=t.hasZ?t.z:0,Lo[0]=e.x,Lo[1]=e.y,Lo[2]=e.hasZ?e.z:0,Idt(Io,Lo,i)):null}function HXt(t){return t!=null?Rdt(t.hasZ?t.z:0,t.spatialReference):null}function Rdt(t,e){const i=X2e(e);return i!=null?Y0(t??0,i):null}function $dt(t,e,i){const r=l6(t,e,i);return r!=null?{direct:Y0(r.direct,r.unit),horizontal:Y0(r.horizontal,r.unit),vertical:Y0(r.vertical,r.unit)}:null}function MIe(t,e,i){const r=l6(t,e,i,Gg.Direct);return r!=null?Y0(r.direct,r.unit):null}function AIe(t,e,i){const r=l6(t,e,i,Gg.Horizontal);return r!=null?Y0(r.horizontal,r.unit):null}function Idt(t,e,i){const r=l6(t,e,i,Gg.Vertical);return r!=null?Y0(r.verticalSigned,r.unit):null}function l6(t,e,i,r){const s=CIe(i),n=Y2e(s);if(n==null)return null;const o=e[2]-t[2];if(r===Gg.Vertical)return{verticalSigned:o,unit:n};if(!Fo(t,i,Q8,s)||!Fo(e,i,LF,s))return null;if(r===Gg.Direct)return{direct:Cr(LF,Q8),unit:n};if(de(DF,t[0],t[1],e[2]),!Fo(DF,i,DF,s))return null;const a=Cr(DF,LF);return r===Gg.Horizontal?{horizontal:a,unit:n}:{direct:Cr(LF,Q8),horizontal:a,vertical:Math.abs(o),unit:n}}(function(t){t[t.Direct=0]="Direct",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical"})(Gg||(Gg={}));const Io=E(),Lo=E(),Q8=E(),LF=E(),DF=E();let Up=class extends Us.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandlesKey="viewHandles",this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new Yz,this._ambientLight=new ene,this._moonLight=new O$e,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePositionGeographic=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,i,r;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((r=(i=this._view)==null?void 0:i.state)==null?void 0:r.viewingMode)===Xe.Global&&RS(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionGeographic(){return this._referencePositionGeographic}connectView(e){if(this._renderer)return;this._renderer=new fa({view:e});const i=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this.addHandles([te(()=>e.environment.lighting,s=>this._updateLightingHandler(s),or),te(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),or),te(()=>e.stationary,()=>this._interactingStationaryHandler()),te(()=>e.environment.lighting.directShadowsEnabled,i,or),te(()=>e.qualitySettings.ambientOcclusion,i,or),te(()=>e.qualitySettings.reflections,i,or),te(()=>e.spatialReference,()=>this._resetReferencePosition(!0),or),te(()=>e.environment.weather.type,()=>this._updateLighting(null,lA.Faded),or),te(()=>this.weatherEnabled,()=>this._updateLighting(null,lA.Faded),or),te(()=>e.viewingMode,()=>this._resetReferencePosition(!0),hr),te(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),hr),te(()=>e.state.camera,r,hr),te(()=>this.disableQueries,r)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=qe(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const i=this._view.environment.lighting;(i==null?void 0:i.type)!=="virtual"&&(i.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const i=this._view.environment.lighting;if((i==null?void 0:i.type)!=="virtual"){if(e){if(!i.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!Bc(r,Ze.WGS84)){const s=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(s))return void this._requestReferencePositionUpdate(s)}if(this._preupdateTracking(e),this._referencePositionGeographic!=null){const s=Ide(this._referencePositionGeographic,Tfe);s!=null&&(i.autoUpdate(null,s),this._trackingEnabled&&(i.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const i=this._view;if(!i.ready)return;const r=i.stateManager.camera;r&&(this._cameraHandlerClientSide(r,e)||this._cameraHandlerServerSide(r))}_cameraHandlerClientSide(e,i){const r=RS(this._view.spatialReference);if(r&&!Bc(this._view.spatialReference,Ze.WGS84))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const s=e.position;return this._referencePositionGeographic??(this._referencePositionGeographic=E()),r?pl(s,this._referencePositionGeographic,Ze.WGS84):de(this._referencePositionGeographic,s.longitude??0,s.latitude??0,s.z??0),this.notifyChange("referencePositionGeographic"),this._autoUpdateTimezone(this._referencePositionGeographic,i)||this._updateLighting(i),!0}_cameraHandlerServerSide(e){const i=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(i))&&this._requestReferencePositionUpdate(i,!0),this._view.mapCoordsHelper&&this._referencePositionGeographic&&(this._referencePositionGeographic[2]=(i.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,i=lA.Immediate){const r=this._view;e=e||(r.environment.lighting.type==="virtual"?null:r.environment.lighting.date);const s=this._referencePositionGeographic,n=s?Ldt:Ddt,o=this.weatherVisible?r.environment.weather.type:"disabled";s!=null?vdt(e,s,r.state.viewingMode,o,r.state.camera,n):r.environment.lighting.type==="virtual"&&TIe(r.state.camera,r.state.viewingMode,n.direct.directionToLightSource);const a=this._mainLight,l=n.direct;he(a.intensity,l.color,l.intensity*Math.PI),ve(a.direction,l.directionToLightSource),a.specularStrength=n.specularStrength,a.environmentStrength=n.environmentStrength;const c=this._ambientLight;he(c.intensity,n.ambient.color,n.ambient.intensity);const u=this._moonLight;xr(u.intensity,Fdt,kdt,n.globalFactor);const d=(1-.5*n.globalFactor)*(1-.4*n.noonFactor*(1-n.globalFactor));he(u.intensity,u.intensity,d),ve(u.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,u],n.noonFactor,n.globalFactor,i),this._updateRenderParameters()}_autoUpdateTimezone(e,i=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const r=Ndt;r.setTime((i||this._view.environment.lighting.date).getTime());const s=Ide(e,Tfe);if(s==null)return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===s.hours&&n.minutes===s.minutes&&n.seconds===s.seconds)return!1}else n=s;const o=r.getUTCHours()-(s.hours-n.hours),a=r.getUTCMinutes()-(s.minutes-n.minutes),l=r.getUTCSeconds()-(s.seconds-n.seconds);return r.setUTCHours(o),r.setUTCMinutes(a),r.setUTCSeconds(l),!i&&this._view.environment.lighting.autoUpdate(r,s)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const i=this._referencePositionGeographic==null||wdt(this._referencePositionGeographic[2],this._view.state.viewingMode);e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&i,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePositionGeographic=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,i=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!i,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const r=this._referencePosUpdateQuery=MS(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===r){const n=()=>this._referencePosUpdateQuery!==r;return this._doReferencePositionUpdateQuery(n)}}).catch(n=>{n.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===r&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),s=this._referencePosUpdateTimer=MS(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===s&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const i=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(i[0])&&!isNaN(i[1])){const r=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePositionGeographic?de(this._referencePositionGeographic,i[0],i[1],r):this._referencePositionGeographic=Ge(i[0],i[1],r),this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePositionGeographic)||this._updateLighting(),this.notifyChange("referencePositionGeographic")}_exceedsReferencePosDistThreshold(e){const i=this._referencePosMapCoords;if(i==null)return!0;const r=Odt(i,e);return r==null?!0:Qat(r,"meters").value>this._referencePointUpdateDistThreshold}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){}};h([p({type:Boolean,readOnly:!0})],Up.prototype,"updating",null),h([p()],Up.prototype,"disableQueries",void 0),h([p()],Up.prototype,"_disableWeather",void 0),h([p()],Up.prototype,"weatherEnabled",null),h([p()],Up.prototype,"weatherVisible",null),h([p()],Up.prototype,"referencePositionGeographic",null),h([p()],Up.prototype,"_renderer",void 0),h([p()],Up.prototype,"_referencePositionGeographic",void 0),Up=h([I("esri.views.3d.environment.SceneViewEnvironmentManager")],Up);const Ldt=new SIe,Ddt=new SIe,Ndt=new Date,Tfe={hours:0,minutes:0,seconds:0},Fdt=Ge(.22,.22,.33),kdt=Ge(.22,.22,.22);var ns;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(ns||(ns={}));var _i;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(_i||(_i={}));var ny;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(ny||(ny={}));let up=class{constructor(e=ns.ALL,i=_i.NONE,r=0,s=null,n=null,o=ny.TUMBLE){this.selection=e,this.interactionType=i,this.interactionFactor=r,this.interactionStartCamera=s,this.interactionDirection=n,this.tiltMode=o}};function TL(t,e){return!!(t&e)}function rB(t,e,i,r,s,n){t!==0&&(i?(n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)):r!=null?(n.min-=Math.max(0,(e-n.min)*(1-r)),n.max+=Math.max(0,(e-n.max)*(1-r))):s&&(n.min-=Math.max(0,e-n.min-s),n.max+=Math.max(0,e-n.max-s)))}const $2=new up(ns.NONE);function PIe(t,e,i,r){return e=e||t.viewForward,ve(r,e),he(r,r,Math.sign(Te(e,i))),r}function Udt(t,e,i,r){return Gdt(t,e,i,Bdt(r,e,i,!0))}function Vdt(t,e,i,r){const s=Te(i,Re(t,r,e));return Ee(t,e,he(t,i,s))}const zdt={dir:E(),len:0,clip:mt()};function Bdt(t,e,i,r){const s=zdt;return t?(i&&r&&(s.len=Cr(e,i)),ve(s.dir,t)):(s.len=Cr(e,i),Re(s.dir,i,e),he(s.dir,s.dir,1/s.len)),s}function jdt(t,e,i){const r=Te(t,i.dir),s=-Or(t,e);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const n=s/r;return r>0?n<i.clip[1]&&(i.clip[1]=n):n>i.clip[0]&&(i.clip[0]=n),i.clip[0]<=i.clip[1]}function Gdt(t,e,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let s=0;s<t.length;s++)if(!jdt(t[s],e,r))return!1;return!0}function Hdt(t,e,i=$2){const r=gne(t,e,i);if(r===0)return!1;const s=t.renderCoordsHelper,n=s.getAltitude(e.eye)+r,o=PIe(e,i.interactionDirection,Zdt(t,e,Math.sign(r),Qdt),Jdt),a=ve(Kdt,e.viewForward),l=s.intersectInfiniteManifold(jh(e.eye,o),n,K8);return e.eye=l??s.setAltitude(K8,n,e.eye),e.center=Vdt(K8,e.eye,a,e.center),!0}function gne(t,e,i=$2){if(!qdt(t,i)||!t.state.constraints.altitude)return 0;const r=Ydt(t.state.constraints.altitude,Xdt);Wdt(t,i,r);const s=t.renderCoordsHelper.getAltitude(e.eye),n=Ne(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}function qdt(t,e){const i=t.state.constraints.altitude;return!(!t.state.isGlobal||!i)&&(e.interactionType!==_i.TUMBLE||!TL(e.selection,ns.TILT))}function Wdt(t,e,i){const r=e.interactionType;if(r===_i.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===_i.TUMBLE||r===_i.ZOOM,c=gne(t,o),u=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);i.min=s,i.max=n,rB(c,u,l,a,.05*u,i)}function Zdt(t,e,i,r){return t.renderCoordsHelper.worldUpAtPosition(e.eye,r),he(r,r,i),r}function Ydt(t,e){return e.min=t.min,e.max=t.max,e}const Xdt={min:0,max:0},Jdt=E(),Qdt=E(),Kdt=E(),K8=E();function yne(t,e,i=$2){if(!t.state.isLocal)return 0;const r=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;NF.min=0,NF.max=r,tpt(t,i,NF);const s=_ne(t,e),n=NF.max-s;return n>=-1e-6?0:n}function ept(t,e,i=$2){const r=yne(t,e,i);if(r===0)return!1;const s=t.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=_ne(t,e)+r,o=ve(rpt,e.eye),a=PIe(e,i.interactionDirection,ipt(e,s.renderLocation,opt),npt);if(!Wb(fAe(s.renderLocation,n),jh(e.eye,a),FF))return!1;e.eye=FF;const l=Re(spt,e.eye,o);e.center=Ee(FF,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),u=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,FF);return u!=null&&(e.center=u),!0}function tpt(t,e,i){const r=e.interactionType;if(r===_i.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===_i.ZOOM||r===_i.PAN,c=yne(t,o),u=c===0?0:_ne(t,o);i.min=s,i.max=n,rB(c,u,l,a,.05*u,i)}function _ne(t,e){const i=t.pointsOfInterest.surfaceOrigin;return i.renderLocation?Cr(e.eye,i.renderLocation):0}function ipt(t,e,i){return v_(i,t.eye,e)}const NF={min:0,max:0},rpt=E(),spt=E(),npt=E(),opt=E(),FF=E();function nO(t,e,i=qd.EYE){const r=t.state.constraints;if(!r.collision.enabled)return!1;const s=$G(t,e.eye),n=t.renderCoordsHelper.getAltitude(e.eye),o=s+r.collision.elevationMargin;if(n>=o)return!1;const a=Ve(e.eye);if(Re(kF,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(apt,o,e.eye),i===qd.EYE_AND_CENTER)e.center=Ee(kF,e.eye,kF);else if(i===qd.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;e.center=he(kF,e.center,l)}return!0}var qd;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(qd||(qd={}));const kF=E(),apt=E();function Ib(t,e,i){t.worldUpAtPosition(e,Sfe),Re(eq,i,e);const r=Ve(eq);return r===0?0:po(Te(eq,Sfe)/r)}const Sfe=E(),eq=E();function OIe(t,e,i,r=!0){YO.eyeCenterDistance=0,YO.requiresTwoSteps=!1;const s=vne(t,e,i,$2,YO);if(s===0)return!1;switch(Du(UF,-s,e.viewRight),i.tiltMode){case ny.LOOK_AROUND:nt(rv,e.viewForward,UF),he(rv,rv,YO.eyeCenterDistance),e.center=Ee(A1,e.eye,rv);break;case ny.TUMBLE:Re(rv,e.center,e.eye),nt(rv,rv,UF),e.eye=Re(A1,e.center,rv);break;default:i.tiltMode}return e.up=nt(A1,e.up,UF),!YO.requiresTwoSteps||!r||OIe(t,e,i,!1)}function vne(t,e,i,r=$2,s){if(!t.state.constraints.tilt)return 0;const n=e.distance,o=t.state.constraints.tilt(n,ypt);return gpt(t,i,o),r.interactionType===_i.TUMBLE&&TL(r.selection,ns.ALTITUDE)&&RIe(t,r.interactionStartCamera,o),i.tiltMode===ny.LOOK_AROUND||r.tiltMode===ny.LOOK_AROUND?cpt(t,e,o,s):lpt(t,e,o)}function lpt(t,e,i){const r=Ib(t.renderCoordsHelper,e.center,e.eye),s=r-Ne(r,i.min,i.max);return SL(s)?s:0}function cpt(t,e,i,r){switch(r&&(r.requiresTwoSteps=!1),t.viewingMode){case"global":return hpt(t,e,i,r);case"local":return upt(t,e,i,r)}}function upt(t,e,i,r){const s=Ib(t.renderCoordsHelper,e.center,e.eye),n=Ne(s,i.min,i.max),o=s-n;if(!SL(o))return 0;if(r){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=e.distance}return o}function hpt(t,e,i,r){const s=dpt(t,e,_pt),n=Ne(s.tiltAtCenter,i.min,i.max);if(!SL(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=ppt(s),a=fpt(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=mpt(s,o)),r&&(r.eyeCenterDistance=CQ(s,o)),a}function dpt(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+_r(t.spatialReference).radius,n=t.renderCoordsHelper.intersectManifold(e.ray,r,A1);return i.eyeCenterDistance=e.distance,i.centerIsOnSurface=!1,n!=null?(i.eyeCenterDistance=Cr(e.eye,n),i.tiltAtCenter=Ib(t.renderCoordsHelper,n,e.eye),i.centerIsOnSurface=!0):t.state.isLocal?i.tiltAtCenter=Ib(t.renderCoordsHelper,e.center,e.eye):(XP(wG(xG,s),e.ray,A1),i.eyeCenterDistance=Cr(e.eye,A1),i.tiltAtCenter=po(-Te(e.viewForward,Ce(A1,A1)))),i.radius=s,i.eyeRadius=Ve(e.eye),i.constraints=t.state.constraints,i}function SL(t){return Math.abs(t)>1e-9}function ppt(t){const{constraints:e,eyeCenterDistance:i,tiltAtCenter:r}=t;let s=r,n=e.clampTilt(i,r);const o=CQ(t,n);if(e.clampTilt(o,r)===n)return n;let a=0;for(;a<10&&SL(n-s);){const l=(s+n)/2,c=CQ(t,l);SL(e.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function CQ(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const i=Math.PI-Ne(e,0,Math.PI),r=qf(t.radius/t.eyeRadius*Math.sin(i)),s=Math.PI-i-r,n=Math.sin(s)/Math.sin(i);if(t.eyeRadius<t.radius&&n>1){const o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*t.eyeRadius}return n*t.eyeRadius}function fpt(t,e){const i=qf(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),r=qf(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?i-r:r-i}function mpt(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function gpt(t,e,i){if(e.interactionType===_i.NONE)return;const{interactionStartCamera:r,interactionFactor:s}=e;if(!r)return;const{min:n,max:o}=i,a=vne(t,r,$2,e),l=a===0?0:Ib(t.renderCoordsHelper,r.center,r.eye);i.min=n,i.max=o,e.interactionType===_i.TUMBLE?(TL(e.selection,ns.ALTITUDE)&&RIe(t,r,i),rB(a,l,!0,s,Efe,i)):rB(a,l,!1,s,Efe,i)}function RIe(t,e,i){const r=t.state.constraints;if(t.state.isLocal||!r.altitude||!e)return;const s=sl(e.center),n=Math.sqrt(s),o=e.distance,a=_r(t.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,u=(l*l-o*o-s)/(-2*n*o),d=(c*c-o*o-s)/(-2*n*o);i.min=Math.max(i.min,Math.min(Math.PI-po(d),i.max)),i.max=Math.min(i.max,Math.PI-po(u))}const rv=E(),UF=ke(),A1=E(),Efe=kt(5),ypt={min:0,max:0},_pt={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},YO={eyeCenterDistance:0,requiresTwoSteps:!1},vpt=t=>t,c6=t=>t*t,bne=t=>1-c6(1-t),bpt=t=>t<.5?c6(2*t)/2:(bne(2*(t-.5))+1)/2,wne=t=>t*t*t,$Ie=t=>1-wne(1-t),IIe=t=>t<.5?wne(2*t)/2:($Ie(2*(t-.5))+1)/2,xne=t=>t*t*t*t,LIe=t=>1-xne(1-t),wpt=t=>t<.5?xne(2*t)/2:(LIe(2*(t-.5))+1)/2,Tne=t=>t*t*t*t*t,DIe=t=>1-Tne(1-t),xpt=t=>t<.5?Tne(2*t)/2:(DIe(2*(t-.5))+1)/2,Sne=t=>1-Math.cos(t*Math.PI/2),NIe=t=>1-Sne(1-t),Tpt=t=>t<.5?Sne(2*t)/2:(NIe(2*(t-.5))+1)/2,Ene=t=>2**(10*(t-1)),BD=t=>1-Ene(1-t),Spt=t=>t<.5?Ene(2*t)/2:(BD(2*(t-.5))+1)/2,Cne=t=>-(Math.sqrt(1-t*t)-1),FIe=t=>1-Cne(1-t),Ept=t=>t<.5?Cne(2*t)/2:(FIe(2*(t-.5))+1)/2;function hp(t){const e=2*(t-Math.sqrt((t-1)*t)),i=e/2/t;return r=>r<i?t*r*r:e*r-e+1}function dp(t,e){return(i,r)=>i<e?e*t(i/e,r):1-t((1-i)/(1-e),r)*(1-e)}const Cpt=dp(hp(1),1),Mpt=dp(hp(1),0),MQ=dp(hp(1),.5),Apt=dp(hp(2),1),Ppt=dp(hp(2),0),Opt=dp(hp(2),.5),Rpt=dp(hp(3),1),$pt=dp(hp(3),0),Ipt=dp(hp(3),.5),Lpt=dp(hp(4),1),Dpt=dp(hp(4),0),Npt=dp(hp(4),.5),Fpt={linear:vpt,"in-quad":c6,"out-quad":bne,"in-out-quad":bpt,"in-coast-quad":Cpt,"out-coast-quad":Mpt,"in-out-coast-quad":MQ,"in-cubic":wne,"out-cubic":$Ie,"in-out-cubic":IIe,"in-coast-cubic":Apt,"out-coast-cubic":Ppt,"in-out-coast-cubic":Opt,"in-quart":xne,"out-quart":LIe,"in-out-quart":wpt,"in-coast-quart":Rpt,"out-coast-quart":$pt,"in-out-coast-quart":Ipt,"in-quint":Tne,"out-quint":DIe,"in-out-quint":xpt,"in-coast-quint":Lpt,"out-coast-quint":Dpt,"in-out-coast-quint":Npt,"in-sine":Sne,"out-sine":NIe,"in-out-sine":Tpt,"in-expo":Ene,"out-expo":BD,"in-out-expo":Spt,"in-circ":Cne,"out-circ":FIe,"in-out-circ":Ept};function ln(t,e,i=zpt,r=e){r!==e&&r.copyFrom(e),r.computeUp(t.state.viewingMode);let s=!1;for(let a=0;a<Bpt;a++){let l=0;for(const c of Vpt)if(TL(i.selection,c.type)){const u=Math.abs(c.error(t,r,i));c.apply(t,r,i)&&(s=!0,l+=u)}if(l===0)break}const n=TL(i.selection,ns.COLLISION),o=kpt(i.interactionType,t);return n&&nO(t,r,o)&&(s=!0),s&&r.computeUp(t.state.viewingMode),s}function kpt(t,e){switch(t){case _i.PAN:return qd.EYE_AND_CENTER;case _i.ASCEND:return e.state.isGlobal?qd.EYE_AND_CENTER_SCALE:qd.EYE_AND_CENTER;default:return qd.EYE}}function ff(t){const e=Math.min(1,t/150);return IIe(e)}function Upt(t,e,i){return vne(t,e,i)*e.distance}const Vpt=[{type:ns.TILT,error:Upt,apply:OIe},{type:ns.ALTITUDE,error:gne,apply:Hdt},{type:ns.DISTANCE,error:yne,apply:ept}],zpt=new up,Bpt=5;let Cfe=class{get pitch(){return this._pitch}get yaw(){return this._yaw}get distance(){return this._distance}get fov(){return this._fov}get size(){return this._size}constructor(e){this.viewingMode=e,this.center=E(),this._pitch=0,this._yaw=0,this._distance=0,this.direction=hn(Mfe),this._fov=55,this._size=1}pixelsPerPanAtZoom(e){return this._size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this._size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this._pitch)),.5);return this._size/2/e}compareTo(e,i){if(this.viewingMode===Xe.Global){const n=(Ve(this.center)+Ve(e.center))/2;i.pan=Pz(this.center,e.center)*n}else i.pan=Cr(this.center,e.center);let r=Math.abs(e._yaw-this._yaw);r>=Math.PI&&(r=2*Math.PI-r);const s=Math.abs(e._pitch-this._pitch);i.rotate=Math.max(r,s),i.fov=e.fov-this.fov,i.sourceZoom=this._distance,i.targetZoom=e._distance}interpolate(e,i,r){this.viewingMode===Xe.Global?ZKe(e.center,i.center,r.pan,this.center):xr(this.center,e.center,i.center,r.pan),this._distance=isFinite(i.distance)?Bt(e.distance,i.distance+r.zoomOffset,r.zoom):e.distance,this._pitch=Bt(e.pitch,i.pitch,r.rotate);let s=e._yaw;const n=i._yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this._yaw=Bt(s,n,r.rotate),this._fov=Bt(e.fov,i.fov,r.fov)}copyFrom(e){ve(this.center,e.center),this._pitch=e.pitch,this._yaw=e.yaw,this._distance=e.distance,ve(this.direction,e.direction),this._size=e.size,this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const i=this._lookAtOrientation(e.center,Afe);ve(this.center,e.center),Re(pa,e.center,e.eye),ta(pa,pa,i),ta(nv,e.up,i),this._distance=Ve(pa),this._distance!==0&&(pa[0]/=this._distance,pa[1]/=this._distance,pa[2]/=this._distance),this._pitch=this._eyeUpToPitch(pa),this._yaw=jpt(pa,nv),this._size=Math.sqrt(e.width*e.width+e.height*e.height),this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov)}copyToRenderCamera(e){const i=this._lookAtOrientation(this.center,Afe);x2(i,i),this._axisAngleVec3(fU,this._pitch-Math.PI/2,Mfe,pa),this._axisAngleVec3(wT,this._yaw,pa,pa),this._axisAngleVec3(fU,this._pitch-Math.PI/2,wT,nv),this._axisAngleVec3(wT,this._yaw,nv,nv),he(pa,pa,this._distance),ta(pa,pa,i),ta(nv,nv,i),e.center=this.center,e.eye=Re(pa,this.center,pa),e.up=nv,e.fov=this._fov}_axisAngleVec3(e,i,r,s){const n=Math.cos(i),o=Math.sin(i);return he(Bu,r,n),ft(hu,e,r),he(hu,hu,o),he(sv,e,(1-n)*Te(e,r)),Ee(s,Ee(s,Bu,hu),sv)}_lookAtOrientation(e,i=Yr()){return this._upAtLookAt(e,sv),ft(Bu,this.direction,sv),Ce(Bu,Bu),Bu[0]===0&&Bu[1]===0&&Bu[2]===0&&ve(Bu,fU),ft(hu,sv,Bu),Ce(hu,hu),i[0]=Bu[0],i[1]=hu[0],i[2]=sv[0],i[3]=Bu[1],i[4]=hu[1],i[5]=sv[1],i[6]=Bu[2],i[7]=hu[2],i[8]=sv[2],i}_upAtLookAt(e,i){return this.viewingMode===Xe.Local?ve(i,wT):Ce(i,e)}_eyeUpToPitch(e){return Math.PI-Pz(wT,e)}};function jpt(t,e){const i=Gpt;return Math.abs(e[2])<.5?(ve(i,e),t[2]>0&&he(i,i,-1)):ve(i,t),ft(hu,i,wT),Ce(hu,hu),Pz(fU,hu,wT)}const Bu=E(),hu=E(),sv=E(),pa=E(),nv=E(),Gpt=E(),wT=DA,Mfe=ure,fU=cre,Afe=Yr();let Hpt=class{constructor(){this.pan=0,this.rotate=0,this.fov=0,this.sourceZoom=0,this.targetZoom=0}};const sB={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let qpt=class kIe{constructor(e){this._createCamera=e,this.compared=new Hpt,this.segmentStart=0,this.segmentEnd=1,this.settings={desiredScreenFlow:sB.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new kIe(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,i,r){this.source!==e&&this.source.copyFrom(e),this.target!==i&&this.target.copyFrom(i),this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:sB.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const i=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>Do()}get hasFov(){return Math.abs(this.compared.fov)>Do()}get hasRotate(){return this.compared.rotate>Do()}},Wpt=class{constructor(){this.pan=0,this.rotate=0,this.zoom=0,this.fov=0,this.zoomOffset=0}},Zpt=class{constructor(){this.segments=new Array}get time(){return this.segments.reduce((e,i)=>e+i.time,0)}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,s=0;const n=this.definition,o=this.segments.reduce((a,l)=>a||l.definition.hasZoom,!1);for(let a=0;a<this.segments.length;a++){const l=this.segments[a],c=l.definition;if(e<=l.time||a===this.segments.length-1){if(this.segmentInterpolateComponentsAt(l,l.time===0?0:e/l.time,i),n.hasPan&&!isNaN(i.pan)&&isFinite(n.compared.pan)?i.pan=(r+c.compared.pan*i.pan)/n.compared.pan:i.pan=1,n.hasRotate&&!isNaN(i.rotate)&&isFinite(n.compared.rotate)?i.rotate=(s+c.compared.rotate*i.rotate)/n.compared.rotate:i.rotate=1,o&&!isNaN(i.zoom)&&isFinite(c.compared.targetZoom)){const{sourceZoom:u,targetZoom:d}=c.compared,f=i.zoom*(d-u)+u,m=this.segments[0].definition.compared.sourceZoom,g=this.segments[this.segments.length-1].definition.compared.targetZoom,y=Math.abs(d-m)>Math.abs(u-m)?d:u;i.zoomOffset=y-g,i.zoom=(f-m)/(y-m)}else i.zoom=1;return i}e-=l.time,r+=c.compared.pan,s+=c.compared.rotate}}segmentInterpolateComponentsAt(e,i,r){e.interpolateComponentsAt(i,r)}},tq=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,i=e.compared,r=i.sourceZoom,s=i.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=i.pan*e.source.pixelsPerPanAtZoom(r);const n=(e.source.pixelsPerRotateAtZoom(r)+e.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=i.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;r&&(s&&(o=(i/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(e/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,u=1+c;this._panPixelFlow=c/u*l,this._rotatePixelFlow=1/u*l}else s?this._panPixelFlow=l:r?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=this.rotateTime??this.zoomTime??this.panTime??this.fovTime??0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:null}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:null}get fovTime(){return this.definition.hasFov?Math.abs(this.definition.compared.fov)/Ypt:null}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=e*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-e-i)/(r-i)}return e}_interpolateComponentsFov(e){if(e===0)return this.definition.segmentStart;if(e===1)return this.definition.segmentEnd;if(this.definition.hasFov){const{segmentStart:i,segmentEnd:r}=this.definition;return i+e*(r-i)}return this.definition.segmentStart}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*e*this._time)-1))/(i*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),i.zoom=this._interpolateComponentsZoom(e),i.pan=this._interpolateComponentsPan(e),i.rotate=this._interpolateComponentsRotate(e),i.zoomOffset=0,i.fov=this._interpolateComponentsFov(e)}};const Ypt=kt(90);function Xpt(t,e,i){const r=e-t.compared.sourceZoom,s=t.halfWindowPanAtZoom(r);return-t.halfWindowSize*(i.ascensionFactor*Math.LN2*t.compared.pan+s)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*s)}function Jpt(t,e,i){const r=1/e,s=Math.log(t.compared.sourceZoom*r),n=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*r*n*o*l*c-t.halfWindowSize*s*n*o*l+t.halfWindowSize*s*n*o*c/(a*a)}function Qpt(t,e,i){const r=e-t.compared.sourceZoom,s=1/r,n=1/e,o=Math.log(t.compared.sourceZoom*n),a=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(r))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function Kpt(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function eft(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function tft(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function ift(t,e,i){return-t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function rft(t,e,i){return t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function sft(t,e,i){return-2*t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function nft(t,e,i){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function oft(t,e,i){const r=Math.log(e/t.compared.targetZoom),s=1/t.desiredPixelFlow,n=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*r*s*n*a+t.halfWindowSize*r*s*n*l/(o*o)+t.halfWindowSize*s*n*a*l/e}function aft(t,e,i){const r=e-t.compared.targetZoom,s=1/r,n=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+i.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function lft(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function cft(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function uft(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function hft(t){const e=t.compared.sourceZoom-t.compared.targetZoom;if(e===0)return t.compared.pan*t.halfWindowSize/(t.desiredPixelFlow*t.halfWindowPanAtZoom(t.compared.sourceZoom));const i=Math.LN2*t.compared.pan,r=e,s=t.halfWindowPanAtZoom(r),n=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*s);return t.compared.sourceZoom<=t.compared.targetZoom?n*(i-s):n*(i+s)}function dft(t,e){let i=pft(t,e);const r={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=r.ascensionFactor===0,n=r.descensionFactor===0,o=s?Kpt:Xpt,a=s?eft:Jpt,l=s?tft:Qpt,c=n?lft:nft,u=n?cft:oft,d=n?uft:aft,f=S=>o(t,S,r)+ift(t,S,r)+c(t,S,r),m=S=>a(t,S,r)+rft(t,S,r)+u(t,S,r),g=S=>l(t,S,r)+sft(t,S,r)+d(t,S,r);let y=f(i);const v=hft(t);let b;const w=e.maximumIterations||20,x=e.maximumDistance!=null?e.maximumDistance:1/0;for(b=0;b<w;b++){const S=e.desiredSlope??1e-6;let C=m(i);Math.abs(C)>S&&(C+=S);const M=C/g(i);if(isNaN(M)||i>=x&&M<0){if(!isFinite(x))return null;i=x,y=f(i);break}if(i-=M,i<t.compared.sourceZoom||i<t.compared.targetZoom)return null;const O=f(i);if(Math.abs(O-y)/y<=.005)break;y=O}return y>v*(1-.3)||i<t.compared.sourceZoom||i<t.compared.targetZoom?null:i}function pft(t,e){const i=Math.max(t.compared.sourceZoom,t.compared.targetZoom),r=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return r<i?e.maximumDistance!=null?i+(e.maximumDistance-i)/2:1.5*i:e.maximumDistance?Math.min(e.maximumDistance,r):r}let fft=class extends Zpt{constructor(e,i){super(),this._preallocSegments=[new tq,new tq,new tq],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,i)}update(e,i){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();const r=i!=null&&i.apex?dft(e,i.apex):null;this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r?this._updateWithApex(r,i==null?void 0:i.apex):this._updateWithoutApex()}segmentInterpolateComponentsAt(e,i,r){e.interpolateComponentsAt(i,r),e===this._ascensionSegment?r.zoom=bne(r.zoom):e===this._descensionSegment&&(r.zoom=c6(r.zoom))}_updateWithApex(e,i){const[r,s,n]=this._preallocSegments,o=(i==null?void 0:i.ascensionFactor)??.5,a=Math.min(1-o,(i==null?void 0:i.ascensionFactor)!=null&&i.descensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.definition.segmentEnd=o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.definition.segmentStart=r.definition.segmentEnd,s.definition.segmentEnd=r.definition.segmentEnd+l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.definition.segmentStart=o+l,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const mft=new Wpt;let gft=class{get time(){return this._time}get isLinear(){return this.path.segments.length===1}constructor(e){this._time=0,this._easing=MQ,this.definition=new qpt(e),this.path=new fft}update(e,i,r){this.definition.update(e,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(RSe(isFinite(this.path.time)?this.path.time:0),r),this._easing=r.easing??(this._time>=1e3?MQ:BD)}cameraAt(e,i){e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,mft);i.interpolate(this.definition.source,this.definition.target,r)}_normalizedEasing(e){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-i)/(r-i)}_applyTimeSettings(e,i){const r=i.speedFactor!=null?i.speedFactor:1,s=i.minDuration??sB.minDuration/r,n=i.maxDuration??sB.maxDuration/r;return e=i.duration!=null?i.duration:Math.min(Math.max(e/r,s),n)}},yft=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new gft(()=>new Cfe(e)),this._current=new Cfe(e)}update(e,i,r){const{source:s,target:n}=this._animation.definition,o=Re(_ft,i.center,e.center),a=Ve(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),ve(s.direction,o),ve(n.direction,o),s.copyFromRenderCamera(e),n.copyFromRenderCamera(i),this._current.copyFrom(s),this._animation.update(s,n,r),this.currentTime=0,e.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(e,i){return this._animation.cameraAt(e,this._current),i=i||new Dr,this._current.copyToRenderCamera(i),i}step(e,i){return this.finished||(this.currentTime=this.currentTime+RSe(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}};const _ft=E();var gs;(function(t){t[t.Ready=0]="Ready",t[t.Rejected=1]="Rejected",t[t.Running=2]="Running",t[t.Stopped=3]="Stopped",t[t.Finished=4]="Finished"})(gs||(gs={}));let $0=class extends Ue{constructor(e){super(e),this.state=gs.Ready}get active(){return this.state===gs.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=gs.Stopped,!0)}finishController(){this.state=gs.Finished}get steppingFinished(){return!1}};h([p({constructOnly:!0})],$0.prototype,"view",void 0),h([p({readOnly:!0})],$0.prototype,"active",null),h([p()],$0.prototype,"state",void 0),h([p({readOnly:!0})],$0.prototype,"isInteractive",null),$0=h([I("esri.views.3d.state.controllers.CameraController")],$0);let EL=class extends $0{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(ki()),this._asyncResult=null),this.state===gs.Finished||this.state===gs.Stopped?(Fj(e),this.state===gs.Finished?e.resolve():e.reject(ki())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=gs.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==gs.Ready&&this.state!==gs.Running||(this.viewAnimation.state===aP.State.FINISHED?this.finish():this.viewAnimation.state===aP.State.STOPPED&&(this.state=gs.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===gs.Finished?this.viewAnimation.finish():this.state===gs.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===gs.Finished?this._asyncResult.resolve():this._asyncResult.reject(ki()))}finish(){this.finishController()}};EL=h([I("esri.views.3d.state.controllers.AnimationController")],EL);let z0=class extends EL{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new yft(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new aP}get isInteractive(){return this.mode==="interaction"}begin(e,i){this._hasTarget=!0;const r=this.animationSettings(i);VF.copyFrom(this.view.state.camera);const s=ip(this.view.state.viewingMode);this.intersectionHelper.intersectRay(VF.ray,s,Pfe)&&(VF.center=Pfe),this.animation.update(VF,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,i){this._hasTarget&&this.animation.step(e,i)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?Fpt[e.easing]:e.easing}}};h([p({constructOnly:!0})],z0.prototype,"mode",void 0),h([p({readOnly:!0})],z0.prototype,"isInteractive",null),z0=h([I("esri.views.3d.state.controllers.PointToPointAnimationController")],z0);const VF=new Dr,Pfe=E();function u6(t=bft){return[t[0],t[1],t[2],t[3]]}function CL(t,e){return vft(t[0],t[1],t[2],e,Dre.get())}function vft(t,e,i,r,s=u6()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function Mne(t,e,i){return ft(i,t,e),Ce(i,i),i[3]=zre(t,e),i}const bft=[0,0,1,0];function nJt(t,e,i=lo()){return Ane(t,yf(e),i),Ce(i.direction,i.direction),i}function Ane(t,e,i){return wft(t,t.screenToRender(e,it.get()),i)}function wft(t,e,i){const r=Da(it.get(),e);if(r[2]=0,!t.unprojectFromRenderScreen(r,i.origin))return null;const s=Da(it.get(),e);s[2]=1;const n=t.unprojectFromRenderScreen(s,it.get());return n==null?null:(Re(i.direction,n,i.origin),i)}function oO(t,e,i){return Pne(t,t.screenToRender(e,it.get()),i)}function Pne(t,e,i){ve(i.origin,t.eye);const r=de(it.get(),e[0],e[1],1),s=t.unprojectFromRenderScreen(r,it.get());return s==null?null:(Re(i.direction,s,i.origin),i)}function One(t,e,i,r){const s=oO(e,i,xft);return Wb(t,s,r)}const xft=lo();var dP;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(dP||(dP={}));const UIe=30,nB=[1,3e8],h6=80,VIe=8,zIe=200,BIe=1508e5,jIe=5,GIe=50,Tft=5,Sft=10,iq=90,I2={exclude:new Set([Ab])};function gS(t,e,i){return i[0]=e[0]/(t.fullWidth/t.pixelRatio),i[1]=e[1]/(t.fullHeight/t.pixelRatio),i}function AQ(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function Lb(t,e,i){const r=Du(Nre.get(),i[3],i);r==null||kEe(r,Wr)||(Re(wr,t.eye,e),nt(wr,wr,r),t.eye=Ee(wr,wr,e),Re(wr,t.center,e),nt(wr,wr,r),t.center=Ee(wr,wr,e),t.up=nt(wr,t.up,r))}function Eft(t,e,i,r){return v2(t,Ane(e,i,Ine),r)}function PQ(t,e,i,r){return v2(t,oO(e,i,Ine),r)}function Rne(t,e,i,r){const s=it.get();let n=1-i;Re(s,e,t.eye);const o=Ve(s);let a=o*(1-n);n>=0&&a<r&&(a=r,n=-(a-o)/o),Math.abs(o-a)<1e-6||(he(s,s,n),t.eye=Ee(wr,t.eye,s),t.center=xr(wr,t.center,e,n))}function HIe(t,e,i){e.getScreenCenter(Ofe),One(t,e,Ofe,wr)&&(e.center=wr);const r=e.distance,s=r*i;if(Math.abs(r-s)<1e-6)return;const n=he(it.get(),e.viewForward,s);e.eye=Re(wr,e.center,n)}const Ofe=Ss();function rq(t,e){de(e,0,0,0);for(const i of t)Ee(e,e,i);he(e,e,1/t.length)}function mU(t,e,i,r){return Math.sin(t/Ve(e))*(i+r.radius)}function Rfe(t,e,i,r){return mU(Math.PI/2,e,i,r)+(t-Math.PI/2)}var Ma;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(Ma||(Ma={}));const $fe={Elevation:3e4,Angle:kt(16)},zF={Pole:.95,Angle:kt(18),Tilt:45},qIe=kt(80);function WIe(t,e,i,r,s,n){const o=E(),a=dn();let l=!0,c=!0;return t.intersectScreen(i,o,n)?a[3]=Ve(o):(c=!1,e.aboveGround&&s!==dP.Ellipsoid?a[3]=Math.max(Ve(e.center),.9*r.radius):a[3]=Ve(e.eye)-e.relativeElevation,s===dP.Silhouette?ML(a,e,i,o):l=One(a,e,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function jD(t,e,i,r){const s=t.relativeElevation;if(s>$fe.Elevation&&r==="global")return Ma.Horizontal;oO(t,e,nq);const n=Math.sign(s),o=i.worldUpAtPosition(t.eye,wr);return-n*Te(o,nq.direction)<Math.sin($fe.Angle)*Ve(nq.direction)?Ma.Vertical:Ma.Horizontal}function ZIe(t,e,i){Re(sq,i,e),t.eye=Re(wr,t.eye,sq),t.center=Re(wr,t.center,sq)}const sq=E();function ML(t,e,i,r){const s=oO(e,i,Ine);return s!=null&&(XP(t,s,BF),Wb(t,s,r)?!(uo(BF,s.origin)<uo(r,s.origin))||(ve(r,BF),!1):(Re(nE,e.eye,e.center),Ce(nE,nE),JMe(nE,-Te(Ce(nE,nE),BF),Ife),v2(Ife,s,r),!1))}const BF=E(),nE=E(),Ife=tr();function YIe(t,e,i,r,s,n){let o=0;if(ft(lB,t,e),Re(qF,t,e),Ve(t)<=s||!r.aboveGround){ft(i,qF,r.eye);const a=Te(t,e)/(Ve(t)*Ve(e));if(a<.9999)o=po(a);else{const c=Ve(ft(E(),t,e))/(Ve(t)*Ve(e));o=qf(c)}const l=Math.cos(Ne(bb.normalize(kt(n)),0,qIe));o=-o-Math.max(0,Ve(e)-s)/(l*s)}else Re(Lfe,r.eye,r.center),ft(i,qF,Lfe),o=-Ve(qF)/s;return Ce(i,i),he(i,i,Ve(lB)),o}const Lfe=E();function Dfe(t,e,i,r){let s,n;const o=Math.cos(Ne(bb.normalize(kt(r)),0,qIe));return s=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):po(e/i),n=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):po(t/i),(n-s)*i}function Cft(t,e,i,r,s,n,o,a,l,c){const u=Dfe(t[2],e[2],n[3],a),d=l?Dfe(t[0],e[0],n[3],180):e[0]-t[0],f=Math.sin(o)*d-Math.cos(o)*u,m=Math.cos(o)*d+Math.sin(o)*u;Ce(wr,s);const g=l?f/Math.sqrt(Math.abs(n[3]**2-Te(i,wr)**2)):f/n[3],y=m/Math.sqrt(Math.abs(n[3]**2-Te(i,r)**2));Li(c,g,y)}function XIe(t,e,i,r,s,n,o,a,l,c){ft(lB,t,e),CY(n.up,n.eye,jF,GF,HF),CY([0,0,1],n.eye,K0,ob,e3e),ve(i,ob),ve(r,K0),Ce(i,i),he(i,i,Ve(lB)),tde(t,Ce(GF,GF),Ce(HF,HF),Ce(jF,jF),Nfe),tde(e,GF,HF,jF,Ffe),Cft(Nfe,Ffe,t,K0,ob,o,a,l,c,s)}function Mft(t,e,i,r,s,n,o){Du(oB,s,r),Du(aB,o,n),gr(mM,oB,aB),Re(e,t,i),nt(e,e,mM),Ee(e,e,i)}function JIe(t,e,i,r,s,n){Du(oB,r,i),Du(aB,n,s),gr(mM,oB,aB),Re(wr,t.eye,e),nt(wr,wr,mM),t.eye=Ee(wr,wr,e),Re(wr,t.center,e),nt(wr,wr,mM),t.center=Ee(wr,wr,e),Re(wr,t.up,e),nt(wr,wr,mM),t.up=Ee(wr,wr,e)}function $ne(t,e,i,r,s,n){return(Math.abs(r)>Math.PI-zF.Angle||Math.abs(r)<zF.Angle)&&(Math.abs(t[2])<i*zF.Pole||Math.abs(e)>i)&&n.aboveGround&&s<zF.Tilt}function QIe(t,e,i,r,s,n){if(n)Mne(i,r,kfe),Lb(e,t,kfe);else{const o=YIe(i,r,Ufe,e,t[3],s);Lb(e,t,CL(Ufe,o))}}function KIe(t,e,i,r,s,n,o){const a=o?20:1,l=1e-12;let c,u;ve(Mw,r),WF.copyFrom(e);for(let d=0;d<a&&uo(i,Mw)>l&&(c=uo(i,Mw),XIe(i,Mw,ob,K0,XO,WF,t,s,n,o),JIe(WF,t,K0,XO[1],ob,XO[0]),Mft(Mw,Mw,t,K0,XO[1],ob,XO[0]),u=uo(i,Mw),u<c||d===0);d++)e.copyFrom(WF)}function Aft(t,e,i,r,s,n,o){$ne(i,Te(e.up,i),t[3],-bb.normalize(kt(s)),n,e)?KIe(t,e,i,r,-bb.normalize(kt(s)),n,o):QIe(t,e,i,r,n,o)}function Pft(t,e,i,r,s,n){const{eye:o}=t;CY([0,0,1],o,K0,ob,e3e);const a=e.translation[0]*i.pan,l=s.mode==="zoom"?0:e.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-Te(t.center,K0)**2/Ve(t.center)**2)),.5),u=(Math.sin(n)*l+Math.cos(n)*a)/c,d=-Math.cos(n)*l+Math.sin(n)*a;switch(Au(r.pan.matrix,r.pan.matrix,u,K0),r.pan.enabled=!0,s.mode){case"pan":Au(r.pan.matrix,r.pan.matrix,d,ob),r.pan.enabled=!0;break;case"zoom":r.zoom=-e.translation[1]*i.zoom}}function Oft(t,e,i,r,s){const{eye:n,viewRight:o}=t,a=ft(it.get(),o,n),l=e.translation[0]*i.pan;switch(l!==0&&(Au(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),s.mode){case"pan":{const c=e.translation[1]*i.pan;c!==0&&(Au(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-e.translation[1]*i.zoom}}function Rft(t,e,i,r,s,n,o,a,l){$ne(t.center,Te(t.up,t.center),Ve(t.center),-bb.normalize(kt(n)),o,e)?Pft(e,i,r,a,l,-bb.normalize(kt(s))):Oft(e,i,r,a,l)}const K0=E(),ob=E(),e3e=E(),jF=E(),GF=E(),HF=E(),Nfe=E(),Ffe=E(),XO=mt(),kfe=u6(),oB=ke(),aB=ke(),mM=ke(),Mw=E(),wr=E(),qF=E(),WF=new Dr,lB=E(),Ufe=E(),Ine={origin:E(),direction:E()},nq={origin:E(),direction:E()},Vfe=.6,oq=4,$ft=60;let cB=class extends z0{constructor(){super(...arguments),this._zoomLocation=E(),this._tmpCamera=new Dr,this._tmpViewDir=E(),this._tmpRayDir={origin:E(),direction:E()},this._targetOnSphere=E(),this._tmpCenter=E(),this._beginCamera=new Dr,this._constraintOptions=new up(ns.ALL_EXCEPT_COLLISION,_i.ZOOM,null,this._beginCamera),this._sphere=dn()}initialize(){this._intersector=ip(this.view.state.viewingMode)}zoomStep(e,i){if(!this.active)return;const r=this.view.state;this.animation.finished?this._beginCamera.copyFrom(r.camera):this.animation.cameraAt(1,this._beginCamera);let s=!1,n=!1;this.intersectionHelper.intersectScreen(i,this._zoomLocation,this.view.map.ground.opacity===0?I2:{})&&(s=e>0,n=!0),this._tmpCamera.copyFrom(r.camera),s?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ve(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,i,n),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:BD}}_updateCamera(e,i,r,s,n){const o=jD(e,s,this.view.renderCoordsHelper,this.view.viewingMode),a=Math.abs(this.view.camera.position.z);Ce(YF,e.eye),he(YF,YF,-1),oO(e,s,this._tmpRayDir),Ce(this._tmpRayDir.direction,this._tmpRayDir.direction);const l=Ne(Math.min(VIe,1/Math.abs(Te(YF,this._tmpRayDir.direction)))*a,zIe,BIe);if(o===Ma.Horizontal){let c=Vfe**i;this._sphere[3]=Ve(r),Re(this._tmpViewDir,e.center,e.eye);const u=Math.min(Ve(this._tmpViewDir),l);let d=u*c;if(c<=1&&d<oq&&(d=oq,c=d/u),Math.abs(u-d)<1e-6)return;const f=Ve(e.center);if(this._sphere[3]!==f){const m=this._sphere[3]+c*(f-this._sphere[3]);e.center=he(ZF,e.center,m/f)}he(this._tmpViewDir,this._tmpViewDir,-c),e.eye=Ee(ZF,e.center,this._tmpViewDir),ln(this.view,e,this._constraintOptions),uo(r,e.center)>1e-12&&One(this._sphere,e,s,this._targetOnSphere)&&Aft(this._sphere,e,r,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let c=Vfe**Math.abs(i);const u=i>0?1:-1;Re(this._tmpViewDir,r,e.eye);const d=Ve(this._tmpViewDir),f=this.view._stage.renderView.getMinimalDepthForArea(null,s[0],s[1],this.view.state.camera,$ft);let m=f??l;m=n&&i>0?Math.min(m,d):m,he(this._tmpRayDir.direction,this._tmpRayDir.direction,m),Ee(r,this._tmpRayDir.origin,this._tmpRayDir.direction);let g=m*c;const y=Math.max(oq,1.01*e.nearFar[0]);if(i>0&&g<y&&(g=y,c=g/m),Math.abs(m-g)<1e-6)return;he(this._tmpRayDir.direction,this._tmpRayDir.direction,u*(1-c)),e.eye=Ee(ZF,e.eye,this._tmpRayDir.direction),e.center=Ee(ZF,e.center,this._tmpRayDir.direction)}nO(this.view,e)}};cB=h([I("esri.views.3d.state.controllers.ZoomStepControllerGlobal")],cB);const ZF=E(),YF=E();let gU,yU=null;const cA=new Map;async function aJt(t){yU==null&&(gU==null&&(gU=ce(()=>import("./VoxelWasmPerSceneView-G0jYwqE5.js"),[])),yU=await gU);const e=t.view;let i=cA.get(e);return i||(i=new yU.default({view:e}),cA.set(e,i)),i.addVoxelLayer(t)}function AL(t){return cA.get(t)}function lJt(t){const e=t.view,i=cA.get(e);i&&i.removeVoxelLayer(t)<1&&(cA.delete(e),cA.size===0&&(gU=null,yU=null))}const Ift=.6,Lft=4,Dft=60;let uB=class extends z0{constructor(){super(...arguments),this._zoomLocation=E(),this._tmpCamera=new Dr,this._tmpRayDir=E(),this._tmpCenter=E(),this._beginCamera=new Dr,this._constraintOptions=new up(ns.ALL,_i.ZOOM,null,this._beginCamera)}zoomStep(e,i){if(!this.active)return;const r=this.view.state;this.animation.finished?this._beginCamera.copyFrom(r.camera):this.animation.cameraAt(1,this._beginCamera),this._tmpCamera.copyFrom(r.camera);const s=ip(this.view.state.viewingMode);let n=!1;e>0?(n=this.intersectionHelper.intersectScreenFreePointFallback(i,this._zoomLocation,this.view.map.ground.opacity===0?I2:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ve(this._zoomLocation,this._tmpCamera.center);const o=Ift**e;let a=this.view._stage.renderView.getMinimalDepthForArea(AL(this.view),i[0],i[1],this.view.state.camera,Dft);Re(XF,this._tmpCamera.eye,this._zoomLocation),Ce(XF,XF);const l=Ne(Math.min(VIe,1/Math.abs(Te(Nft,XF)))*Math.abs(this.view.camera.position.z),zIe,BIe);if(a=a??l,a){const c=E();Re(c,this._zoomLocation,this._tmpCamera.eye),(a<Ve(c)||!n)&&(Ce(c,c),Ee(this._zoomLocation,this._tmpCamera.eye,he(c,c,a)))}this._updateCamera(this._tmpCamera,o,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:BD}}_updateCamera(e,i,r){Re(this._tmpRayDir,r,e.eye);const s=Ve(this._tmpRayDir);let n=s*i;const o=i<=1,a=Math.max(Lft,1.01*e.nearFar[0]);n!==0&&(o&&n<a&&(n=a,i=n/s),Math.abs(s-n)<1e-6||(he(this._tmpRayDir,this._tmpRayDir,i),e.eye=Re(zfe,r,this._tmpRayDir),e.center=xr(zfe,e.center,r,1-i),ln(this.view,e,this._constraintOptions)))}};uB=h([I("esri.views.3d.state.controllers.ZoomStepControllerLocal")],uB);const zfe=E(),Nft=Ge(0,0,1),XF=E();function Fft(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function Lne(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let kft=class extends ha{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(e){const i=e.data;if(Fft(i,"primary")){const r=this._view.state.isGlobal?new cB({view:this._view,mode:"animation"}):new uB({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),Ss(i.x,i.y)),e.stopPropagation()}}};function Uft(t,e,i){return t===Xe.Global?new zft(i):new Vft(e,i)}let Vft=class{constructor(e,i){this._elevationProvider=e,this._referenceEllipsoid=_r(i),this._unitInMeters=ec(i,this._referenceEllipsoid.metersPerDegree)}compute(e,i,r,s,n){var x;n||(n={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-s,c=(x=this._elevationProvider)==null?void 0:x.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const u={x:(r=r??new ur({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},d=Math.max(u.x,u.y,u.z);Re(Aw,i,e),oE[0]=Aw[0]>0?r.xmax:r.xmin,oE[1]=Aw[1]>0?r.ymax:r.ymin,oE[2]=Aw[2]>0?d/2:-d/2,Re(oE,oE,e),Ce(Aw,Aw);const f=1.1*Te(oE,Aw)*this._unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),g=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),y=g*Gft*this._unitInMeters,v=g*Hft*this._unitInMeters,b=Ne((o-v)/(y-v),0,1)**3,w=Math.min(Bt(m,f,b),m)*Math.max(Math.log(Math.abs(l)),1);return t3e(Math.min(w,Math.max(34064e4,d))/this._unitInMeters,Bft,this._unitInMeters,n)}},zft=class{constructor(e){this._referenceEllipsoid=_r(e)}compute(e,i,r,s,n){n||(n={near:0,far:0});const o=Ve(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(a-s),u=Math.max(c,Math.abs(a)),d=Math.sqrt(u*(u+2*l)),f=o+this._referenceEllipsoid.radius;return t3e(1.2*Bt(d,f,kse(u)),Ne(2e4-(Math.log(u)-7.983)/9.011*19900,100,2e4),1,n)}};function t3e(t,e,i,r){const s=jft/i;return t/e>s?(r.far=t,r.near=r.far/e):(r.near=s,r.far=r.near*e),r}const Bft=2e4,jft=2,Gft=.001,Hft=1e-4,oE=E(),Aw=E();let _U=class extends Ue{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const i=this.view.state.camera;e.spatialReference!=null&&cPe(this.view,i,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>nO(this.view,e,qd.EYE_AND_CENTER))}};h([p({constructOnly:!0})],_U.prototype,"view",void 0),_U=h([I("esri.views.3d.state.SurfaceCollisionConstraint")],_U);let N$=class extends Ue{constructor(e){super(e),this.nearFarHeuristic=Uft(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([te(()=>{var e,i,r,s;return[(i=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:i.near,(s=(r=this.view.constraints)==null?void 0:r.clipDistance)==null?void 0:s.far]},()=>this._clipDistanceNearFarChanged()),te(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:i.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),te(()=>this.view.renderDataExtent,()=>this._updateNearFar(),or),te(()=>{var e,i,r,s;return[(i=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:i.min,(s=(r=this.view.constraints)==null?void 0:r.altitude)==null?void 0:s.max]},()=>this._updateAltitude(),or),te(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:i.max},()=>this._updateTiltMax(),or),te(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:i.mode},()=>this._updateTilt(),or),te(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),or),te(()=>{var e,i,r,s,n,o;return[(r=(i=(e=this.view.map)==null?void 0:e.ground)==null?void 0:i.navigationConstraint)==null?void 0:r.type,(o=(n=(s=this.view.state)==null?void 0:s.constraints)==null?void 0:n.collision)==null?void 0:o.enabled]},()=>this._updateCollision(),or)]),this.view.state.isLocal&&this.addHandles(te(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),$t)),this._updateNearFar(),this.view.state.viewingMode!==Xe.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new _U({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var i;const e=(i=this.view.constraints)==null?void 0:i.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(r=>Bfe(r,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const i=this.view.constraints&&this.view.constraints.clipDistance;(i?i.mode:"auto")==="manual"?Bfe(e,i):this._updateCameraNearFarAuto(e,i)}_updateCameraNearFarAuto(e,i){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,$G(this.view,e.eye),e),i&&i.autoUpdate(e.near,e.far)}_updateCollision(){var s,n,o;const e=(o=(n=(s=this.view.map)==null?void 0:s.ground)==null?void 0:n.navigationConstraint)==null?void 0:o.type,i=!e||e==="stay-above",r=this.view.state.constraints.collision;if(i!==r.enabled){r.enabled=i,i&&this._reapplyConstraints(ns.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Xe.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const i=this.view.state.constraints;i.tilt=i.createConstantMaxTilt(kt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const i=this.view.state.constraints;if(i.tilt){const r=i.tilt(this.view.state.camera.distance).max;e.autoUpdate(La(r))}}_updateLocalSurfaceDistance(e){if(e==null)return;let i=Math.max(e.width,e.height);if(i<=0)return;e.zmax!=null&&e.zmin!=null&&(i=Math.max(i,e.zmax-e.zmin));const r=this.view.state,s=3*i/Math.atan(r.camera.fov/2);s!==r.constraints.distance&&(r.constraints.distance=s)}_reapplyConstraints(e=ns.ALL){this.view.state.updateCamera(i=>ln(this.view,i,new up(e,_i.NONE,null)))}};function Bfe(t,e){e&&(t.near=e.near,t.far=e.far)}h([p({constructOnly:!0})],N$.prototype,"view",void 0),h([p({readOnly:!0})],N$.prototype,"surfaceCollisionConstraint",void 0),N$=h([I("esri.views.3d.state.ConstraintsManager")],N$);let j1=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(e){this.renderCoordsHelper=e,this.frustum=wL(),this._points=T$e(),this.lines=new Array(12),this._origin=E(),this._direction=E(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:E(),endpoint:null}}update(e){S$e(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),ve(this._origin,e.eye),ve(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let i=0;i<this._points.length;i++)ve(this._points[i],e[i]);E$e(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return B1(this.frustum,e)}intersectsRay(e){return _ut(this.frustum,e)}intersectsLineSegment(e,i){return vut(this.frustum,e,i)}intersectsPoint(e){return C$e(this.frustum,e)}_updateLines(){const e=this._points;for(let i=0;i<4;i++){const r=i+4;aq(this.lines[i],e[i],e[r]),aq(this.lines[i+4],e[i],i===3?e[0]:e[i+1]),aq(this.lines[i+8],e[r],i===3?e[4]:e[r+1])}}};function aq(t,e,i){t.origin=e,t.endpoint=i,v_(t.direction,e,i)}j1.planePointIndices=but,j1.nearFarLineIndices=[[_t.NEAR_BOTTOM_LEFT,_t.FAR_BOTTOM_LEFT],[_t.NEAR_BOTTOM_RIGHT,_t.FAR_BOTTOM_RIGHT],[_t.NEAR_TOP_RIGHT,_t.FAR_TOP_RIGHT],[_t.NEAR_TOP_LEFT,_t.FAR_TOP_LEFT]];let l3=class extends $0{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=gs.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||cPe(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),nO(this.view,e,qd.EYE_AND_CENTER)||this.constraintEnabled||(this.state=gs.Stopped)})}};h([p({constructOnly:!0})],l3.prototype,"desiredCamera",null),l3=h([I("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],l3);const qft=.66;function i3e(t){return 360-lG.normalize(t)}function d6(t){return lG.normalize(360-t)}function r3e(t,e,i){const r=e.camera;if(r!=null)return Wft(r,Xb(t));const{targetGeometry:s}=e;if(s==null)return null;const{camera:n,mode:o}=n3e(t,e.rotation,i);if(s.type==="point")return Yft(t,e,s,n,o);const a=s.extent;return a==null?null:$k(t,a,n.heading,n.tilt,o)}async function s3e(t,e,i,r){const s=e.camera;if(s!=null)return Zft(s,Xb(t),r);const{targetGeometry:n}=e;if(n==null)throw new Error("Viewpoint has no targetGeometry!");const{camera:o,mode:a}=n3e(t,e.rotation,i);if(n.type==="point")return Xft(t,e,n,o,a,r);const l=n.extent;if(l==null)throw new Error("Target geometry has no extent!");return NPe(t,l,o.heading,o.tilt,a,r)}function Wft(t,e){const i=t.position;let r;try{r=Tb(i,e)}catch{return null}if(!r)return null;const s=t.clone();return s.position=r.clone(),s}async function Zft(t,e,i){const r=t.position,s=await Sb(r,e,{signal:i});Dt(i);const n=t.clone();return n.position=s.clone(),n}function n3e(t,e,i){const r=iP(t,t.state.camera);let s=Oa.ADJUST;return e!=null&&(r.heading=i3e(e),s=Oa.LOCKED),i!=null&&(r.tilt=i),{camera:r,mode:s}}function Yft(t,e,i,r,s){const n=t.spatialReference;let o;try{o=Tb(i.clone(),n)}catch{return null}if(!o)return null;const a=e.scale!=null?IG(t,e.scale,o.latitude):t.state.camera.distance;return wst(t,o,a,r,s)}async function Xft(t,e,i,r,s,n){const o=t.spatialReference,a=await Sb(i.clone(),o,{signal:n});Dt(n);const l=e.scale!=null?IG(t,e.scale,a.latitude):t.state.camera.distance;return EPe(t,a,l,r,s,n)}function o3e(t,e,i=null){return i==null&&(i=new Zf),Nne(t,null,e.clone(),i)}async function a3e(t,e,i){const r=omt(t,e);if(!r)throw new G("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new Bh({fov:t.camera.fov}),n=new Zf({camera:s});if(r.target instanceof Zf)return Pw(await Kft(t,r.target,r,i,n));if(r.target instanceof Bh)return Pw(await c3e(t,r.target,i,n));const o=r.scale!=null||r.zoom!=null;if(r.target instanceof ur){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return Pw(o||c?await OQ(t,r,r.target.center,s,i,n):await rmt(t,r,r.target,s,i,n))}const a=new lmt,l=o?Jft(t,r):void 0;if(await l3e(t,r.target,l,a,i),isFinite(a.boundingBox[0])){let c;if(Cf(a.boundingBox,Js),dh.x=Js[0],dh.y=Js[1],dh.z=Js[2],dh.spatialReference=t.spatialReference,isFinite(dh.z)&&a.hasZ?c=Mse(a.boundingBox):(dh.z=void 0,c=xXe(Cse(a.boundingBox,cmt))),o||c)return Pw(await OQ(t,r,dh,s,i,n));const u=amt(t,a.screenSpaceObjects);return Pw(await nmt(t,r,dh,a.boundingBox,u,s,i,n))}return r.position?Pw(await tmt(t,r,s,n,i)):Pw(await imt(t,r,s,i,n))}function Dne(t,e){return e.scale==null&&e.zoom!=null?zPe(t,e.zoom):e.scale}function Jft(t,e){const i=Dne(t,e);return i?stt(i):void 0}function p6(t,e){let i=!1;return e.heading!=null?(t.heading=e.heading,i=!0):e.rotation!=null&&(t.heading=i3e(e.rotation),i=!0),e.tilt!=null&&(t.tilt=e.tilt,i=!0),e.fov!=null&&(t.fov=e.fov),i}function Nne(t,e,i,r){const s=t.spatialReference||Ze.WGS84;if(e??(e=S0(t,i)),e==null)return r;const n=new bt({spatialReference:s});if(!Yb(e.center,t.renderSpatialReference,n))return r;r.targetGeometry=n;const{latitude:o}=n;return r.scale=o!=null?Pb(t,e.distance,o):BPe(t,e),r.rotation=d6(i.heading),r.camera=i,r}async function hB(t,e,i,r){var d;const s=()=>new G("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw s();e.type==="mesh"&&(e=e.extent);const n=t.basemapTerrain.spatialReference;if(!e.hasZ&&t.basemapTerrain){let f;switch(e.type){case"point":f=e;break;case"multipoint":case"polyline":f=(d=e.extent)==null?void 0:d.center;break;case"extent":f=e.center;break;case"polygon":f=e.centroid}f!=null&&n&&t.elevationProvider?(f=await Sb(f,n,{signal:r}),Js[2]=Mg(t.elevationProvider,f)??0):Js[2]=0}const o=umt[e.type],a=new Array;if(o(e,e.hasZ?f=>{a.push([f[0],f[1],f[2]])}:f=>{a.push([f[0],f[1]])},Js),a.length===0)throw s();const l=e.spatialReference,c=t.spatialReference,u=await Sb(new jP({spatialReference:l,hasZ:e.hasZ,hasM:!1,points:a}),c,{signal:r});if(e.hasZ&&(i.hasZ=!0),e.hasZ)for(const[f,m,g]of u.points)Js[0]=f,Js[1]=m,Js[2]=g,Yf(i.boundingBox,Js);else for(const[f,m]of u.points)Js[0]=f,Js[1]=m,Yf(i.boundingBox,Js)}async function Qft(t,e,i,r,s){const n=await Vh(t.whenViewForGraphic(e));if(n.ok===!1||n.value==null||!("whenGraphicBounds"in n.value))return void await hB(t,e.geometry,r,s);const o=n.value,a=await Vh(o.whenGraphicBounds(e,{minDemResolution:i}));if(a.ok===!1||!a.value)return void await hB(t,e.geometry,r,s);const{screenSpaceObjects:l,boundingBox:c}=a.value;oP(r.boundingBox,c),l&&l.forEach(u=>{r.screenSpaceObjects.push(u)}),isFinite(c[2])&&(r.hasZ=!0)}async function l3e(t,e,i,r,s){var n;if(Array.isArray(e)&&e.length===2){const o=e[0],a=e[1];if(typeof o=="number"&&typeof a=="number")return dh.x=o,dh.y=a,dh.z=void 0,dh.spatialReference=(n=t.spatialReference)!=null&&n.isGeographic?t.spatialReference:Ze.WGS84,void await hB(t,dh,r,s)}e&&"map"in e&&typeof e.map=="function"?await Promise.allSettled(e.map(o=>l3e(t,o,i,r,s))):e instanceof Gb?await hB(t,e,r,s):e instanceof ca&&await Qft(t,e,i,r,s)}async function Kft(t,e,i,r,s){if(e.camera)return c3e(t,e.camera,r,s);s.scale=e.scale,s.rotation=e.rotation,s.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,s.camera=null,i.heading!=null?s.rotation=d6(i.heading):i.rotation!=null&&(s.rotation=i.rotation);const n=Dne(t,i);return n!=null&&(s.scale=n),s.camera=await s3e(t,s,i.tilt,r),s}async function c3e(t,e,i,r){const s=t.spatialReference,n=await Sb(e.position,s,{signal:i}),o=e.clone();return o.position=n,Nne(t,null,o,r)}async function emt(t,e,i,r,s,n,o){const a=t.renderSpatialReference;return await Cz(e,lq,a,0,{signal:o}),await Cz(i,QF,a,0,{signal:o}),n.targetGeometry=new bt(e),s.position=new bt(i),Re(dB,lq,QF),LG(t,QF,dB,r.up,s),n.scale=Pb(t,Cr(QF,lq),n.targetGeometry.latitude),n.rotation=d6(s.heading),n.camera=s,n}async function OQ(t,e,i,r,s,n){n.targetGeometry=i.clone();const o=T2(t);if(e.position)return emt(t,n.targetGeometry,e.position,o,r,n,s);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=he(Js,o.viewForward,-l);o.eye=Ee(Js,o.center,c),n.scale=Pb(t,l,i.latitude)}iP(t,o,r);const a=p6(r,e)?Oa.LOCKED:Oa.ADJUST;if(!e.zoomFactor){const l=Dne(t,e);l==null?(await Cz(i,Js,t.renderSpatialReference,0,{signal:s}),C$e(o.frustum,Js)?n.scale=Pb(t,Cr(o.eye,Js),i.latitude):n.scale=BPe(t,o)):n.scale=l,n.camera=await SPe(t,n.targetGeometry,n.scale,r,a,s)}return n}async function tmt(t,e,i,r,s){const n=T2(t);ve(dB,n.viewForward),LG(t,n.eye,dB,n.up,cq);const o=t.spatialReference,{position:a}=e;if(a){const l=await Sb(a,o,{signal:s});i.position=l}else i.position=new bt;return i.heading=e.heading!=null?e.heading:cq.heading,i.tilt=e.tilt!=null?e.tilt:cq.tilt,Nne(t,null,i,r)}async function imt(t,e,i,r,s){if(e.heading!=null||e.rotation!=null||e.scale!=null||e.tilt!=null||e.zoom!=null||e.zoomFactor!=null){const n=T2(t),{spatialReference:o,renderSpatialReference:a}=t,l=new bt({spatialReference:o});return Yb(n.center,a,l)?OQ(t,e,l,i,r,s):s}return s.scale=t.scale,s.camera=t.camera.clone(),p6(s.camera,e),s}async function rmt(t,e,i,r,s,n){n.targetGeometry=i.clone();const o=T2(t);iP(t,o,r);const a=p6(r,e)?Oa.LOCKED:Oa.ADJUST;return n.camera=await NPe(t,i,r.heading,r.tilt,a,s),n}function smt(t,e,i,r,s){let n=0;i.z!=null?n=i.z:t.basemapTerrain&&t.elevationProvider&&(n=Mg(t.elevationProvider,i)),de(Js,i.x,i.y,n),$h(t.spatialReference,Js,jfe,t.renderSpatialReference),lp(JF,jfe),x2(JF,JF),Zr(JO);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let g=0;g<o.length;g++){const y=o[g];let v=r[y[2]];isFinite(v)||(v=n),de(Js,r[y[0]],r[y[1]],v),Fo(Js,t.spatialReference,Js,t.renderSpatialReference),Yf(JO,ta(Js,Js,JF))}const a=S2(JO),l=Qb(JO),c=E2(JO),u=1/Math.tan(e.fovX/2),d=1/Math.tan(e.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(d,u)+.5*l,m=.5*l*d+.5*Math.max(a,c);return Math.max(f,m)/s}async function nmt(t,e,i,r,s,n,o,a){a.targetGeometry=i.clone();const l=T2(t),c=smt(t,l,i,r,s);iP(t,l,n);const u=p6(n,e)?Oa.LOCKED:Oa.ADJUST;return a.scale=Pb(t,c,a.targetGeometry.latitude),a.camera=await SPe(t,a.targetGeometry,a.scale,n,u,o),a}function omt(t,e){if(!e||!t.spatialReference)return null;const i={target:void 0};return"declaredClass"in e||Array.isArray(e)?i.target=e:(Object.assign(i,e),!i.target&&"center"in e&&e.center&&(i.target=e.center)),i}function Pw(t){return(t==null?void 0:t.camera)!=null&&(t.rotation=d6(t.camera.heading)),t}function amt(t,e){const i=qft;if(!e.length)return i;let r=Number.NEGATIVE_INFINITY;for(let s=0;s<e.length;s++){const n=e[s].screenSpaceBoundingRect;r=Math.max(r,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return i-r/Math.min(t.width,t.height)*2}class lmt{constructor(){this.hasZ=!1,this.boundingBox=Zr(),this.screenSpaceObjects=new Array}}const Js=E(),jfe=ke(),JF=Yr(),JO=Xn(),cmt=oi(),dB=E(),QF=E(),lq=E(),cq={heading:0,tilt:0},dh=new bt,umt={point(t,e,i){i[0]=t.x,i[1]=t.y,t.z!=null&&(i[2]=t.z),e(i)},polygon(t,e,i){const r=t.hasZ;for(let s=0;s<t.rings.length;s++){const n=t.rings[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),e(i)}},polyline(t,e,i){const r=t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),e(i)}},multipoint(t,e,i){const r=t.points,s=t.hasZ;for(let n=0;n<r.length;n++)i[0]=r[n][0],i[1]=r[n][1],s&&(i[2]=r[n][2]),e(i)},extent(t,e,i){t.zmin!=null&&t.zmax!=null?(e(de(i,t.xmin,t.ymin,t.zmin)),e(de(i,t.xmax,t.ymin,t.zmin)),e(de(i,t.xmin,t.ymax,t.zmin)),e(de(i,t.xmax,t.ymax,t.zmin)),e(de(i,t.xmin,t.ymin,t.zmax)),e(de(i,t.xmax,t.ymin,t.zmax)),e(de(i,t.xmin,t.ymax,t.zmax)),e(de(i,t.xmax,t.ymax,t.zmax))):(e(de(i,t.xmin,t.ymin,i[2])),e(de(i,t.xmax,t.ymin,i[2])),e(de(i,t.xmin,t.ymax,i[2])),e(de(i,t.xmax,t.ymax,i[2])))}},hmt=Object.freeze(Object.defineProperty({__proto__:null,create:a3e,fromCamera:o3e,toCameraAsync:s3e,toCameraSync:r3e},Symbol.toStringTag,{value:"Module"}));let dmt=class{constructor(e,i,r){this._target=e,this._options=i,this.view=r,this.state="pending",this._animationController=null,this.promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const o=new AbortController;this._options.signal!=null&&Ra(this._options.signal,()=>{this.abort()}),this._abortController=o,this._waitForReady()})}_resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}_reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this._reject(ki())}async _waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await VS(()=>this.view.ready,this._abortController.signal)}catch(e){return this._reject(e)}this._createViewPoint()}async _createViewPoint(){if(this.state!=="finished"){this.state="wait-for-viewpoint",this._animationController=this._options.animate?this._getAnimationController():null;try{const e=await a3e(this.view,this._target,this._abortController.signal);if(this.state==="finished")return;const i=e?this._getCameraFromViewpoint(e):null;if(i==null)return;if(this._options.animate){if(this._animationController==null)return;this._startAnimation(i,this._animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this._resolve()}catch(e){this._reject(e)}}}_getCameraFromViewpoint(e){var n;const i=!!(this._target instanceof Zf&&this._target.camera||this._target instanceof Bh),r=e.camera;if(r==null)return null;if(!this.view.stateManager.isCompatible(r)){const o=r.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(n=this.view.spatialReference)==null?void 0:n.wkid;return this._reject(new G("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:r})),null}const s=S0(this.view,r);return s==null?(this._reject(new G("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:s,isFullySpecified:i}}_startAnimation(e,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(r==null)return void this._reject(new G("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(e.viewpoint,"running"),!i.active||i.viewAnimation==null||i.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==i)return this.abort();let s;e.isFullySpecified?(s=new l3({view:this.view,desiredCamera:e.camera}),nO(this.view,e.camera,qd.EYE_AND_CENTER)):ln(this.view,e.camera),i.begin(e.camera,this._options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof z0&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=s):i.viewAnimation!=null&&i.viewAnimation.target===e.viewpoint&&i.state===gs.Finished&&(this.view.state.cameraController=s))},o=a=>{if(this.view.state!=null)switch(i.state){case gs.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._resolve()}break;case gs.Ready:case gs.Rejected:case gs.Running:case gs.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._reject(a)}}};r.when(n,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,i=null;const r=this.view.state.cameraController;return r instanceof z0&&(r.updateStateFromViewAnimation(),r.active&&(e=r,i=e.viewAnimation)),e!=null||(e=new z0({view:this.view,mode:"animation"}),i=e.viewAnimation,this.view.state.switchCameraController(e))?e:(i!=null&&i.stop(),this._reject(new G("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},Db=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,i){var r;return(r=this._outer.get(e))==null?void 0:r.get(i)}set(e,i,r){const s=this._outer.get(e);s?s.set(i,r):this._outer.set(e,new Map([[i,r]]))}delete(e,i){const r=this._outer.get(e);r&&(r.delete(i),r.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((i,r)=>e(i,r))}};var Ys;function Gfe(t=!le("disable-feature:high-quality-idle"),e=null){const i=new Db;return t?(i.set($i.IDLE,Ys.Antialiasing,e!=="low"),i.set($i.IDLE,Ys.HighResolutionAtmosphere,e!=="low"),i.set($i.IDLE,Ys.HighQualityTransparency,!0),i.set($i.IDLE,Ys.SSAO,!0),i.set($i.IDLE,Ys.WaterReflection,!0),i.set($i.IDLE,Ys.PhysicalPixelRendering,!0)):(i.set($i.ANIMATING,Ys.HighResolutionShadows,!0),i.set($i.ANIMATING,Ys.HighResolutionViewshed,!0),i.set($i.INTERACTING,Ys.HighResolutionShadows,!0),i.set($i.INTERACTING,Ys.HighResolutionViewshed,!0)),i.set($i.IDLE,Ys.HighResolutionShadows,!0),i.set($i.IDLE,Ys.HighResolutionViewshed,!0),i.set($i.IDLE,Ys.HighResolutionVoxel,!0),i}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.HighResolutionViewshed=7]="HighResolutionViewshed",t[t.PhysicalPixelRendering=8]="PhysicalPixelRendering"})(Ys||(Ys={}));let rn=class extends Ue{constructor(e){super(e),this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=Hfe,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:i=>this._devicePixelRatioOverride=i,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return this.renderState!=null},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(i){this.viewStateManager._idleTimeout=i?Hfe:0}},this._propertiesPool=new u_({frustum:j1},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new pmt}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([Ks(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),te(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,i)=>this._cameraChangedHandler(e,i),or)]),No(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([PS({prepare:()=>this._prepareFrame()}),te(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(e4)}),Ks(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=qe(this._propertiesPool)}get camera(){const e=this._get("camera");if(!this.ready)return e;const i=iP(this.view,this.view.state.camera,uq);return i&&e&&i.equals(e)?e:i.clone()}set camera(e){var i,r;this._updatePropertyBeforeReady("camera",e)||((i=this.view.elevationProvider)==null||i.enableCache(!0),this.setStateCamera(S0(this.view,e),{applyConstraints:!1})||se.getLogger(this).error("#camera=","Invalid camera",e),(r=this.view.elevationProvider)==null||r.enableCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const i=iP(this.view,this.view.state.contentCamera,uq);return i&&e&&i.equals(e)?e:i.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const i=S0(this.view,e);i!=null?(this._updateElevation(i),this.view.state.contentCamera=i):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(hq),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const i=this.zoom,r=this.view.state.camera.distance**2,s=zl(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([te(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(hq),this.test.contentCameraResetState.clear())}),te(()=>this.zoom,o=>{o!==void 0&&i!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-i)/2),Math.abs(o-i)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))}),te(()=>this.view.state.camera,o=>{const a=uo(s,o.center);this.test.contentCameraResetState.set("camera.center",a/r),a>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],hq),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var i;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():se.getLogger(this).error("#center=","Invalid center",e):se.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e):se.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,i=FPe(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return i??this._get("extent")}set extent(e){var i;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||se.getLogger(this).error("#extent=","Invalid extent",e):se.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e):se.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get constraintsManager(){return this._constraintsManager}get _initialViewpoint(){var i;const e=this.view.map;return e&&"initialViewProperties"in e?(i=e.initialViewProperties)==null?void 0:i.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return Pb(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||se.getLogger(this).error("#scale=","Invalid scale",e)}get terrainScale(){if(!this.ready)return this._get("scale");const e=this.view,i=e.basemapTerrain.tilingScheme,r=e.pointsOfInterest.cameraOnSurface.scale;if(!i||!r)return this._get("scale");const s=e.state.contentCamera;let n=LG(e,s.eye,s.viewForward,s.up).tilt;n>90&&(n=180-n);const o=2*(n/90)**2,a=i.levelAtScale(r)-o;return a<0?this._get("scale"):i.scaleAtLevel(a)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,i=e.padding,r=e.pixelRatio,s=this._get("padding"),n=Math.round(i[gi.TOP]/r),o=Math.round(i[gi.RIGHT]/r),a=Math.round(i[gi.BOTTOM]/r),l=Math.round(i[gi.LEFT]/r);return s!=null&&s.top===n&&s.right===o&&s.bottom===a&&s.left===l?s:{top:n,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,KF),this.view.state.updateCamera(i=>i.padding=KF))}_paddingToArray(e,i,r){e?_s(r,e.top||0,e.right||0,e.bottom||0,e.left||0):_s(r,0,0,0,0);for(let s=0;s<4;s++)r[s]=Math.round(r[s]*i)}get screenCenter(){const e=this.padding;return ep((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?o3e(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var i;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||se.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const r=e.camera!=null?e.camera.position:e.targetGeometry,s=r!=null&&r.spatialReference;se.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(s?s.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e)}else se.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?Pst(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||se.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){var s;if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),i=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*i),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*i);const r=(s=this.view._stage.renderView.renderingContext)==null?void 0:s.parameters.maxTextureSize;return r&&FT(this._tmpCanvasSize,r),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:i,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,i;return((i=(e=this.view)==null?void 0:e._stage)==null?void 0:i.renderer.isFeatureEnabled(Ys.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var i,r;const e=(r=(i=this.view)==null?void 0:i._stage)==null?void 0:r.renderer;return e&&(e.isFeatureEnabled(Ys.PhysicalPixelRendering,$i.IDLE)||e.isFeatureEnabled(Ys.PhysicalPixelRendering,$i.INTERACTING)||e.isFeatureEnabled(Ys.PhysicalPixelRendering,$i.ANIMATING))}preinit(e){var i,r,s;return!(this._isOverridden("center")&&!XE(this.center.spatialReference,e))&&!(this._isOverridden("camera")&&!XE(this.camera.position.spatialReference,e))&&!(this._isOverridden("extent")&&!XE(this.extent.spatialReference,e))&&!!(!this._isOverridden("viewpoint")||XE((i=this.viewpoint.targetGeometry)==null?void 0:i.spatialReference,e)&&XE((s=(r=this.viewpoint.camera)==null?void 0:r.position)==null?void 0:s.spatialReference,e))}init(){this._constraintsManager=new N$({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const i of e)this.set(i.name,i.value);if(!this._cameraSetByUser){const i=this._initialViewpoint||this.view.initialExtent;i&&this.isCompatible(i)?this._setInitialView(i):this.view.state.viewingMode===Xe.Local&&this.addHandles(No(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(e4),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),e4)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(e4),this._constraintsManager=qe(this._constraintsManager))}async goTo(e,i){return i={animate:!0,...i},this._gotoOperation!=null&&this._gotoOperation.abort(i.animate),this._gotoOperation=new dmt(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(T2(this.view),{applyConstraints:!1})}step(e){const i=this.view.state,r=i==null?void 0:i.cameraController;r&&(i.updateCamera(s=>r.stepController(e,s)),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,i=[];for(const{propertyName:r,overrides:s}of mmt){const n=e.has(r),o=this._isOverridden(r);!n&&o&&i.push({name:r,value:this._get(r)}),this._clearOverride(r),(n||o)&&s.forEach(a=>e.add(a))}return i}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof Bh)return void this.setStateCamera(S0(this.view,e),{applyConstraints:!1});if(e instanceof Zf){if(e.targetGeometry instanceof ur){const n=$k(this.view,e.targetGeometry,0,.5,Oa.LOCKED);return void(n!=null&&this.setStateCamera(S0(this.view,n),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},s=this._viewpointToCamera(e);return void this.setStateCamera(s,r)}const i=$k(this.view,e,0,.5,Oa.LOCKED);i!=null&&this.setStateCamera(S0(this.view,i),{applyConstraints:!0})}_updatePropertyBeforeReady(e,i){return!this.ready&&(this._override(e,i),i&&fmt.has(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof Zf?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof Bh?this.isCompatible(e.position):e.spatialReference&&!kCe(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=gmt){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,i,r=ov){const{heading:s,tilt:n}=this._getPreservingHeadingTilt(),o=cse(this.view,s,n,e,i,Oa.ADJUST);return o==null?null:(r.copyFrom(this.view.state.camera),r.eye=o.eye,r.center=o.center,r.up=o.up,r)}_centerToCamera(e){const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.distance;return this._centerPointAtDistanceToCamera(e,r)}_extentToCamera(e){const{heading:i,tilt:r}=this._getPreservingHeadingTilt(),s=$k(this.view,e,i,r,Oa.ADJUST,uq);return s?S0(this.view,s):null}_scaleToCamera(e){if(e==null)return null;const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.renderLocation,s=i.location.latitude,n=IG(this.view,e,s);return this._centerPointAtDistanceToCamera(r,n)}_zoomToCamera(e){return this._scaleToCamera(zPe(this.view,e))}_viewpointToCamera(e){return S0(this.view,r3e(this.view,e))}setStateCamera(e,i){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,i.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{i.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up,r.fov=e.fov):r.copyFrom(e),i.applyConstraints&&ln(this.view,r)}),i.applyConstraints||(this.view.state.cameraController=new l3({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:i}=this.view;if(!e||!i)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._computeCanvasSize();if(r.width!==0&&r.height!==0&&(i.width===r.width&&i.height===r.height||(i.width=r.width,i.height=r.height),this.view.state)){const s=this.view.state.camera;s.fullWidth===r.width&&s.fullHeight===r.height&&s.pixelRatio===r.pixelRatio||(ov.copyFrom(s),ov.pixelRatio!==r.pixelRatio&&(this._paddingToArray(this.padding,r.pixelRatio,KF),ov.padding=KF),ov.fullWidth=r.width,ov.fullHeight=r.height,ov.pixelRatio=r.pixelRatio,this.view.state.camera=ov),this._updateViewState()}}_updateElevation(e){var n,o;const i=(n=this.view.basemapTerrain)==null?void 0:n.spatialReference,r=((o=this.view.renderCoordsHelper)==null?void 0:o.getAltitude(e.eye))??0,s=i?$G(this.view,e.eye):0;e.relativeElevation=r-s}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=$i.ANIMATING:this.view.interacting?this.view.state.mode=$i.INTERACTING:(this.view.state.mode===$i.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=$i.INTERACTING:this.view.state.mode=$i.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,i){e&&i&&e.almostEquals(i)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};h([p({type:Bh,dependsOn:["view.state.camera","ready"]})],rn.prototype,"camera",null),h([p({type:Bh,dependsOn:["view.state.contentCamera","ready"]})],rn.prototype,"contentCamera",null),h([p({type:bt})],rn.prototype,"center",null),h([p({type:ur})],rn.prototype,"extent",null),h([p({readOnly:!0})],rn.prototype,"frustum",null),h([p()],rn.prototype,"_constraintsManager",void 0),h([p({readOnly:!0})],rn.prototype,"constraintsManager",null),h([p()],rn.prototype,"_initialViewpoint",null),h([p({readOnly:!0})],rn.prototype,"hasInitialView",null),h([p({readOnly:!0,type:Boolean})],rn.prototype,"ready",void 0),h([p({type:Number})],rn.prototype,"scale",null),h([p({type:Number})],rn.prototype,"terrainScale",null),h([p()],rn.prototype,"padding",null),h([p({readOnly:!0})],rn.prototype,"screenCenter",null),h([p({constructOnly:!0})],rn.prototype,"view",void 0),h([p({type:Zf})],rn.prototype,"viewpoint",null),h([p({type:Number})],rn.prototype,"zoom",null),h([p({readOnly:!0})],rn.prototype,"_rasterPixelRatio",null),h([p({readOnly:!0})],rn.prototype,"_usePhysicalPixelRendering",null),h([p({readOnly:!0})],rn.prototype,"_usePhysicalPixelRenderingAny",null),h([p()],rn.prototype,"_windowDevicePixelRatio",void 0),h([p()],rn.prototype,"_devicePixelRatioOverride",void 0),rn=h([I("esri.views.3d.state.ViewStateManager")],rn);let pmt=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const fmt=new Set(["camera","viewpoint","extent","scale","center","zoom"]),mmt=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],gmt={heading:0,tilt:0},uq=new Bh,ov=new Dr,KF=ci(),e4="pending-initial-view",hq="content-camera-reset",Hfe=300,qfe=100;let Og=class extends $0{constructor(){super(...arguments),this.startCamera=new Dr,this.currentCamera=new Dr,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<qfe}stepController(e,i){i.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(i)}onControllerStart(e){this.state=gs.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),qfe),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};h([p({readOnly:!0})],Og.prototype,"isInteractive",null),h([p()],Og.prototype,"_lastInteraction",void 0),Og=h([I("esri.views.3d.state.controllers.InteractiveController")],Og);var pu;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(pu||(pu={}));let c3=class extends Og{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=pu.CENTER,this._rotScale=0,this._lastPoint=mt(),this._tmpWorldUp=E(),this._tmpViewDir=E(),this._tmpRotCurPoint=mt(),this._tmpTransf=ke(),this._tmpAxis=E(),this._tmpPivotPoint=E(),this._pivotPos=E(),this._constraintOptions=new up(ns.ALL,_i.TUMBLE,0,this.startCamera)}initialize(){this._rotScale=this.pivot===pu.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case pu.EYE:ve(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=_i.LOOK_AROUND,this._constraintOptions.tiltMode=ny.LOOK_AROUND,this._constraintOptions.selection=ns.NONE;break;case pu.CENTER:{const i=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?I2:{});i||ve(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,i),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=_i.TUMBLE,this._constraintOptions.tiltMode=ny.TUMBLE,this._constraintOptions.selection=ns.ALL&~ns.DISTANCE;break}}gS(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,i){const r=this.startCamera,s=E();Re(s,this._pivotPos,r.eye);const n=Ve(s),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(r.eye,Wfe);let a=Math.max(Math.min(Tft,1/Math.abs(Te(Wfe,r.viewForward)))*o,Sft);i&&(a=Math.min(n,a));const l=Ss(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),c=jD(this.startCamera,l,this.view.renderCoordsHelper,this.view.viewingMode);let u=this.view._stage.renderView.getMinimalDepthForArea(AL(this.view),r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*iq,iq),d=this.view._stage.renderView.getMinimalDepthForArea(AL(this.view),e[0],e[1],r,iq);u==null&&d==null||(u=u??d??0,d=d==null||c===Ma.Horizontal?u:d,a=u>d?d:u,a=i?Math.min(a,n):a),Ce(s,s),ve(this._pivotPos,Ee(this._tmpPivotPoint,r.eye,he(this._tmpPivotPoint,s,a)))}update(e){if(this.active){switch(this.pivot){case pu.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case pu.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}ln(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,i,r,s){this.view.renderCoordsHelper.worldUpAtPosition(s,this._tmpWorldUp),gS(e,i,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;Re(this._tmpViewDir,r,s);const a=Ve(this._tmpViewDir),l=po(Te(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===pu.EYE){n*=-.5;const c=.5*Math.PI-l,u=.5*Math.PI*.99;n=c-Math.max(-u,Math.min(u,c+n))}return n=Ne(n+l,Sa.min,Sa.max)-l,ft(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===pu.CENTER&&(o=-o),Du(this._tmpTransf,o,this._tmpWorldUp),Au(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),nt(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=nt(dq,e.up,this._tmpTransf),Ee(dq,s,this._tmpViewDir),Da(this._lastPoint,this._tmpRotCurPoint),dq}};h([p()],c3.prototype,"pivot",void 0),c3=h([I("esri.views.3d.state.controllers.RotateController")],c3);const dq=E(),Wfe=E();let pq=class extends ha{constructor(e,i,r,s){super(!0),this._view=e,this.pointerAction=i,this._pivot=r,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!Lne(e.data,this.pointerAction))return;const r=Ss(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new c3({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},RQ=class extends Og{constructor(){super(...arguments),this._pickPoint=E(),this._tmpP0=mt(),this._panAxisAngle=u6(),this._tmpRayDir=E(),this._tmpRayDirPick=E(),this._targetOnSphere=E(),this._navMode=Ma.Horizontal,this._tmpRay={origin:E(),direction:E()},this.dragBeginPoint=Ss(),this._normalizedAnchorPoint=mt(),this._constraintOptions=new up(ns.ALL_EXCEPT_COLLISION,_i.ZOOM,0,this.startCamera),this._sphere=dn(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Da(this.dragBeginPoint,e),gS(this.startCamera,e,this._normalizedAnchorPoint);const i=_r(this.view.spatialReference),r=WIe(this._intersectionHelper,this.startCamera,e,i,dP.Ellipsoid,this.view.map.ground.opacity===0?I2:{});if(this._navMode=jD(this.startCamera,e,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===Ma.Horizontal)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=r.scenePickPoint??this._pickPoint,this._sphere=r.sphere;else{let s;oO(this.startCamera,e,this._tmpRay),Ce(this._tmpRay.direction,this._tmpRay.direction),r.scenePickPoint!=null&&(Re(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),s=Ve(this._tmpRayDirPick));const n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,Zfe);let o=Ne(Math.min(UIe,1/Math.abs(Te(Zfe,this._tmpRay.direction)))*n,nB[0],nB[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,h6);o=a??o,o=s!=null?Math.min(o,s):o,this._hasPickPoint=!0,he(this._tmpRay.direction,this._tmpRay.direction,o),Ee(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===Ma.Horizontal){Re(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const i=Ve(this._tmpRayDir);gS(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=i*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(i-s)<1e-6)return;if(this._hasPickPoint&&s<i){const o=1-(1-s/i)*(1-this._sphere[3]/Ve(this.currentCamera.center));this.currentCamera.center=he(t4,this.currentCamera.center,o)}he(this._tmpRayDir,this._tmpRayDir,-s/i),this.currentCamera.eye=Ee(t4,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=ff(Ob(this.dragBeginPoint,e)),ln(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(ML(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),Mne(this._pickPoint,this._targetOnSphere,this._panAxisAngle),Lb(this.currentCamera,this._sphere,this._panAxisAngle))}else{const i=Ve(this._tmpRay.direction);gS(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=i*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(i-s)<1e-6)return;he(this._tmpRayDir,this._tmpRay.direction,1-s/i),this.currentCamera.eye=Ee(t4,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=Ee(t4,this.currentCamera.center,this._tmpRayDir)}nO(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};RQ=h([I("esri.views.3d.state.controllers.ZoomControllerGlobal")],RQ);const t4=E(),Zfe=E();let $Q=class extends Og{constructor(){super(...arguments),this._tmpP=E(),this._tmpDir=E(),this._tmpN=E(),this._tmpP0=mt(),this._tmpPoi=E(),this._tmpRayDir=E(),this.dragBeginPoint=Ss(),this._normalizedAnchorPoint=mt(),this._constraintOptions=new up(ns.ALL,_i.ZOOM,0,this.startCamera,E()),this._plane=tr()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Da(this.dragBeginPoint,e),gS(this.startCamera,e,this._normalizedAnchorPoint);const i=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?I2:{});Re(this._tmpDir,this._tmpP,this.startCamera.eye);const r=Ve(this._tmpDir);Ce(this._tmpDir,this._tmpDir);const s=Math.abs(this.view.camera.position.z);let n=Ne(Math.min(UIe,1/Math.abs(Te(ymt,this._tmpDir)))*s,nB[0],nB[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(AL(this.view),e[0],e[1],this.view.state.camera,h6);n=o??n,n=i?Math.min(n,r):n,he(this._tmpDir,this._tmpDir,n),Ee(this._tmpP,this.startCamera.eye,this._tmpDir),Re(this._tmpN,this.startCamera.eye,this.startCamera.center),Ce(this._tmpN,this._tmpN),this._tmpN[1]<0&&sa(this._tmpN,this._tmpN),TD(this._tmpP,this._tmpN,this._plane)}update(e){if(!this.active)return;Eft(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||ve(this._tmpPoi,this.currentCamera.center),gS(this.currentCamera,e,this._tmpP0);let i=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);Da(this._normalizedAnchorPoint,this._tmpP0),Re(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=Ve(this._tmpRayDir);let s=r*(1-i);this._constraintOptions.interactionDirection&&(ve(this._constraintOptions.interactionDirection,this._tmpRayDir),he(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(i)/r));const n=this.view.state.constraints.minimumPoiDistance;i>=0&&s<n&&(s=n,i=-(s-r)/r),Math.abs(r-s)<1e-6||(he(this._tmpRayDir,this._tmpRayDir,i),this.currentCamera.eye=Ee(Ow,this.currentCamera.eye,this._tmpRayDir),xr(Ow,this.currentCamera.center,this._tmpPoi,i),this._tmpPoi[2]>this.startCamera.center[2]?Ow[2]=Math.max(this.startCamera.center[2],Ow[2]):Ow[2]=Math.min(this.startCamera.center[2],Ow[2]),this.currentCamera.center=Ow,this._constraintOptions.interactionFactor=ff(Ob(this.dragBeginPoint,e)),ln(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};$Q=h([I("esri.views.3d.state.controllers.ZoomControllerLocal")],$Q);const Ow=E(),ymt=Ge(0,0,1);let _mt=class extends ha{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!Lne(e.data,this.pointerAction))return;const r=Ss(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new RQ({view:this._view}):this._cameraController=new $Q({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function bp(t){let e=t*t;return t<0&&(e*=-1),e}function Yfe(t,e,i){const r=i,s=t.state,n=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(r.translation[0]=bp(s.axes[0]),r.translation[1]=bp(s.axes[1]),r.translation[2]=bp(s.buttons[7])-bp(s.buttons[6]),r.heading=bp(s.axes[2]),r.tilt=bp(s.axes[3])):n.deviceType==="spacemouse"&&(r.translation[0]=1.2*bp(s.axes[0]),r.translation[1]=1.2*bp(s.axes[1]),r.translation[2]=2*-bp(s.axes[2]),r.heading=1.2*bp(s.axes[5]),r.tilt=1.2*bp(s.axes[3])),r.tilt*=o,he(r.translation,r.translation,a),r}function Xfe(t,e){const i=e;return i.translation[0]=t[1]-t[0],i.translation[1]=t[3]-t[2],i.translation[2]=t[4]-t[5],i.heading=t[7]-t[6],i.tilt=t[8]-t[9],i.zoom=t[10]-t[11],i}function fq(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let kT=class extends Og{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new Dr,this._headingStart=0,this._constraintOptions=new up(ns.ALL,_i.NONE,0,new Dr,null,ny.LOOK_AROUND)}handleEventGamepad(e){const i=Yfe(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||fq(i))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,Xfe(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const i=Xfe(this._keysButtonState,this._transformation);fq(i)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const i=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this._filteredSurfaceElevation+=r*(i-this._filteredSurfaceElevation)*e}stepController(e,i){var r;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(i),this._updateCameraCenter(),(r=this._constraintOptions.interactionStartCamera)==null||r.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,Rw),this._applyDisabledMovementTypes(Rw),this._applyPan(Rw.pan),this._applyRotate(Rw.rotate),this._applyZoom(Rw.zoom),this._applyAscend(Rw.ascend),this._constraintOptions.interactionType=_i.NONE,this._constraintOptions.selection=ns.COLLISION,ln(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,i)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const i=this.currentCamera;Re(sc,i.center,i.eye),nt(sc,sc,e.matrix),i.center=Ee(sc,sc,i.eye),i.up=nt(sc,i.up,e.matrix),this._constraintOptions.interactionType=_i.LOOK_AROUND,this._constraintOptions.selection=ns.ALL_EXCEPT_COLLISION,ln(this.view,i,this._constraintOptions)}_applyPan(e,i=this.currentCamera){e.enabled&&(i.eye=nt(sc,i.eye,e.matrix),i.center=nt(sc,i.center,e.matrix),this.view.state.isGlobal&&(i.up=nt(sc,i.up,e.matrix)),this._constraintOptions.interactionType=_i.PAN,this._constraintOptions.selection=ns.ALL,ln(this.view,i,this._constraintOptions))}_applyZoom(e){if(!e)return;const i=this.currentCamera.viewForward;this.currentCamera.eye=Ee(sc,this.currentCamera.eye,he(it.get(),i,e)),ve(QO,i),sa(QO,QO),this._constraintOptions.interactionDirection=QO,this._constraintOptions.interactionType=_i.ZOOM,this._constraintOptions.selection=ns.ALL_EXCEPT_COLLISION,ln(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const i=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,it.get());if(this._constraintOptions.interactionDirection=ve(QO,i),this.view.state.isGlobal){const r=Ve(this.currentCamera.eye),s=(r+e)/r;this.currentCamera.eye=he(sc,this.currentCamera.eye,s),this.currentCamera.center=he(sc,this.currentCamera.center,s)}else{const r=he(it.get(),i,e);this.currentCamera.eye=Ee(sc,this.currentCamera.eye,r),this.currentCamera.center=Ee(sc,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=_i.ASCEND,this._constraintOptions.selection=ns.COLLISION,ln(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=ns.ALL_EXCEPT_COLLISION,ln(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,i,r){Emt(r);const s=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(s,i,r):this._calculateControlTransformationGlobal(s,i,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,i=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=i.intersectManifoldClosestSilhouette(r,e,sc)}_calculateControlTransformationLocal(e,i,r){const{viewRight:s,viewForward:n}=i,o=this._transformation,a=this.view.navigation.gamepad,l=de(it.get(),n[0],n[1],0);Ce(l,l);const c=o.translation[0]*e.pan;if(c!==0){const y=he(it.get(),s,c);dl(r.pan.matrix,r.pan.matrix,y),r.pan.enabled=!0}switch(a.mode){case"pan":{const y=-o.translation[1]*e.pan;if(y!==0){const v=he(it.get(),l,y);dl(r.pan.matrix,r.pan.matrix,v),r.pan.enabled=!0}r.zoom=o.zoom*e.zoom;break}case"zoom":r.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const u=o.translation[2]*e.ascend;r.ascend=u;const d=-o.heading*e.rotate;d!==0&&(Au(r.rotate.matrix,r.rotate.matrix,d,this.view.renderCoordsHelper.worldUpAtPosition(i.eye,it.get())),r.rotate.enabled=!0);const f=o.tilt*e.rotate,m=Ib(this.view.renderCoordsHelper,i.center,i.eye),g=Ne(m+f,Sa.min,Sa.max)-m;g&&(Au(r.rotate.matrix,r.rotate.matrix,g,s),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,i,r){const{eye:s,viewRight:n}=i,o=this._transformation,a=this.view.navigation.gamepad,l=ft(it.get(),n,s);Ce(l,l),sa(l,l),Rft(this.startCamera,i,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(Rw.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,u=o.translation[2]*e.ascend;r.ascend=u;const d=-o.heading*e.rotate;d!==0&&(Au(r.rotate.matrix,r.rotate.matrix,d,this._tmpCamera.eye),r.rotate.enabled=!0);const f=o.tilt*e.rotate,m=this._clampTiltDeltaGlobalToValidRange(f,i.ray,c);m!==0&&(Au(r.rotate.matrix,r.rotate.matrix,m,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,i,r){const s=_r(this.view.spatialReference),n=mU(Sa.min,i.origin,r,s);let o=0,a=0;const l=it.get();if(this.view.renderCoordsHelper.intersectManifold(i,r,l)){const c=Ib(this.view.renderCoordsHelper,l,i.origin);o=mU(c,i.origin,r,s),a=mU(Sa.max,i.origin,r,s)}else{XP(wG(xG,r+s.radius),i,l);const c=Math.PI+zre(i.direction,l);o=Rfe(c,i.origin,r,s),a=Rfe(Sa.max,i.origin,r,s)}return Ne(o+e,n,a)-o}_getPointAbsoluteSurfaceElevation(e,i,r){const{renderCoordsHelper:s}=this.view,n=s.getAltitude(e),o=i+Math.abs(n-i);return s.setAltitude(r,o,e),o}_clampedDistanceToSurface(e,i){const{renderCoordsHelper:r}=this.view,{camera:s}=this.view.state,{direction:n}=bst(this.view,i,0,u3e,Smt),o=r.intersectManifoldClosestSilhouette(jh(i,n),e,it.get()),a=Cr(i,o),l=r.intersectManifoldClosestSilhouette(jh(i,v_(it.get(),i,s.center)),e,it.get()),c=Cr(i,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:i,state:r}=this.view,{camera:s,isGlobal:n}=r,o=i.intersectManifoldClosestSilhouette(s.ray,this._filteredSurfaceElevation,it.get());if(n){const a=Re(it.get(),e,o),l=Ve(a);he(a,a,1/l);const c=Ce(it.get(),e),u=po(Te(c,a));return l*Math.sin(Math.min(bmt,u))}{const a=ve(it.get(),e);return i.setAltitude(a,this._filteredSurfaceElevation),Cr(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:wmt}_computeVelocities(e){const i=this._filteredSurfaceElevation,r=i+_r(this.view.spatialReference).radius,{camera:s,isGlobal:n}=this.view.state,o=it.get(),a=this._getPointAbsoluteSurfaceElevation(s.eye,i,o),l=this._clampedDistanceToSurface(i,o),c=s.width/2,u=Jfe*s.width,d=Jfe*s.width,f=l*Math.tan(.5*s.fovX)/c,m=f/r,g=f/this._computeHeadingRotateRadius(o),y=a-i;return{pan:(n?m:f)*u*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(u*e/c)*y-y),zoom:2**(u*e/c)*l-l,rotate:Ne(g*d,xmt,Tmt)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&tp(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&tp(e.rotate.matrix))}static activatesFor(e,i){const r=Yfe(i,e.navigation.gamepad,vmt);return!(i.action==="end"||fq(r))}};h([p({constructOnly:!0})],kT.prototype,"gamepadDevice",void 0),h([p({constructOnly:!0})],kT.prototype,"disableMovements",void 0),kT=h([I("esri.views.3d.state.controllers.GamepadKeyboardController")],kT);const vmt={translation:[0,0,0],heading:0,tilt:0,zoom:0},u3e=80,bmt=kt(u3e),Jfe=.75,wmt=5,xmt=kt(30),Tmt=kt(80),Rw={zoom:0,ascend:0,pan:{enabled:!1,matrix:ke()},rotate:{enabled:!1,matrix:ke()}},sc=E(),QO=E(),Smt=ase();function Emt(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,tp(t.pan.matrix),t.rotate.enabled=!1,tp(t.rotate.matrix)}let Cmt=class extends ha{constructor(e){super(!0),this._view=e,this._watchHandles=new ly,this._handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([te(()=>this._view.navigation.gamepad.enabled,i=>{i?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},$t),te(()=>this._view.navigation.gamepad.device,i=>{this._cameraControllerGamepad&&i&&this._cameraControllerGamepad.gamepadDevice!==i&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){var s;const i=this._view.navigation.gamepad.device;if(i&&e.data.device!==i)return;const r=(s=this._cameraControllerGamepad)==null?void 0:s.active;if(r||kT.activatesFor(this._view,e.data)){if(!r){const n=new kT({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(n)&&(this._cameraControllerGamepad=n)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};function Mmt(t){const e=()=>t(document.visibilityState==="visible");return document.addEventListener("visibilitychange",e),Gi(()=>document.removeEventListener("visibilitychange",e))}var ou;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(ou||(ou={}));let Amt=class extends ha{constructor(e,i){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Xe.Local},this._keyToNumber={[i.left]:ou.LEFT,[i.right]:ou.RIGHT,[i.forward]:ou.FORWARD,[i.backward]:ou.BACKWARD,[i.up]:ou.UP,[i.down]:ou.DOWN,[i.headingLeft]:ou.HEADINGLEFT,[i.headingRight]:ou.HEADINGRIGHT,[i.tiltUp]:ou.TILTUP,[i.tiltDown]:ou.TILTDOWN,[i.zoomIn]:ou.ZOOMIN,[i.zoomOut]:ou.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleStop()),this._visibilityHandle=Mmt(r=>r?null:this._handleStop())}onUninstall(){var e;(e=this._visibilityHandle)==null||e.remove(),this._handleStop()}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new kT({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(i),e.stopPropagation()))}_handleStop(){var e;(e=this._cameraControllerKeyboard)!=null&&e.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){var r;if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&((r=this._cameraControllerKeyboard)!=null&&r.active)&&(this._cameraControllerKeyboard.deactivateDirection(i),e.stopPropagation())}},Pmt=class extends ha{constructor(e,i){super(!0),this._view=e,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const i=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new cB({view:this._view,mode:"interaction"}):new uB({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*i.deltaY,Ss(i.x,i.y)),e.preventDefault(),e.stopPropagation()}},pB=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},KS=class extends EL{constructor(){super(...arguments),this._beginCamera=new Dr,this._elapsedTimeSec=0,this.constraintOptions=new up(ns.ALL,_i.PAN,0,this._beginCamera)}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new aP}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),super.onControllerStart(e)}stepController(e,i){i.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,i),ln(this.view,i,this.constraintOptions)}};KS=h([I("esri.views.3d.state.controllers.momentum.MomentumController")],KS);let u3=class extends KS{constructor(e){super(e),this.interactionType=_i.PAN,this._tmpPan=E()}momentumStep(e,i){const r=this.momentum.value(e);he(this._tmpPan,this.momentum.direction,r),i.eye=Re(Qfe,i.eye,this._tmpPan),i.center=Re(Qfe,i.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};h([p({constructOnly:!0})],u3.prototype,"momentum",void 0),u3=h([I("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],u3);const Qfe=E(),Omt=E(),i4=E();let vU=class extends KS{constructor(e){super(e),this.interactionType=_i.PAN}momentumStep(e,i){const r=this.momentum.value1(e),s=this.momentum.value2(e);ve(i4,i.eye),Ce(i4,i4),ft(this.momentum.axis2,i4,this.momentum.axis1),JIe(i,Omt,this.momentum.axis1,r,this.momentum.axis2,s)}};h([p({constructOnly:!0})],vU.prototype,"momentum",void 0),vU=h([I("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],vU);let xT=class extends KS{set center(e){this._set("center",hn(e))}set axis(e){this._set("axis",hn(e))}constructor(e){super(e),this.interactionType=_i.TUMBLE}momentumStep(e,i){const r=this.momentum.value(e);Lb(i,this.center,CL(this.axis,r))}};h([p({constructOnly:!0})],xT.prototype,"momentum",void 0),h([p({constructOnly:!0})],xT.prototype,"center",null),h([p({constructOnly:!0})],xT.prototype,"axis",null),xT=h([I("esri.views.3d.state.controllers.momentum.RotationMomentumController")],xT);let gM=class extends KS{set zoomCenter(e){this._set("zoomCenter",hn(e))}constructor(e){super(e),this.interactionType=_i.ZOOM,this.constraintOptions.interactionDirection=E()}momentumStep(e,i){const{interactionDirection:r}=this.constraintOptions;if(!r)return;ve(r,i.eye);const s=this.momentum.valueDelta(0,e);Rne(i,this.zoomCenter,s,this.view.state.constraints.minimumPoiDistance),v_(r,i.eye,r)}};h([p({constructOnly:!0})],gM.prototype,"momentum",void 0),h([p({constructOnly:!0})],gM.prototype,"zoomCenter",null),gM=h([I("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],gM);let Ux=class extends KS{set screenCenter(e){this._set("screenCenter",Ss(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",hn(e))}constructor(e){super(e),this.interactionType=_i.ZOOM,this.radius=0,this._tmpSceneCenter=E(),this._tmpZoomAxisAngle=u6(),this._sphere=dn()}initialize(){this._sphere[3]=this.radius}momentumStep(e,i){const r=this.momentum.valueDelta(0,e);HIe(this._sphere,i,r),this.constraintOptions.interactionType=_i.ZOOM,ln(this.view,i,this.constraintOptions),ML(this._sphere,i,this.screenCenter,this._tmpSceneCenter),Mne(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),Lb(i,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=_i.PAN}};h([p({constructOnly:!0})],Ux.prototype,"momentum",void 0),h([p({constructOnly:!0})],Ux.prototype,"screenCenter",null),h([p({constructOnly:!0})],Ux.prototype,"sceneCenter",null),h([p({constructOnly:!0})],Ux.prototype,"radius",void 0),Ux=h([I("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],Ux);let mf=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const i=this.computeDelta(e);this._updateDelta(i)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},f6=class{constructor(e,i,r){this._initialVelocity=e,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,i){const r=this.value(e);return this.value(e+i)-r}valueFromInitialVelocity(e,i){i=Math.min(i,this.duration);const r=1-this.friction;return e*(r**i-1)/Math.log(r)}},Rmt=class extends f6{constructor(e,i,r,s,n){super(e,i,r),this._sceneVelocity=s,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},h3e=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._time=new mf(.6),this._screen=[new mf(.4),new mf(.4)],this._scene=[new mf(.6),new mf(.6),new mf(.6)],this._tmpDirection=E()}add(e,i,r){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(r)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(i[0]),this._scene[1].update(i[1]),this._scene[2].update(i[2]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?0:Math.sqrt(e*e+i*i),s=this._time.filteredDelta,n=s==null||r==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){de(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=Ve(this._tmpDirection);s>0&&he(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new Rmt(e,i,r,n==null?0:s/n,this._tmpDirection)}},Kfe=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const eme=1e-5;let $mt=class extends f6{constructor(e,i,r,s,n,o=0,a){super(e,i,r),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},Imt=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._tmpAxis1=E(),this._tmpAxis2=E(),this._tmpAngles=mt(),this._time=new mf(.3),this._screen=[new mf(.4),new mf(.4)],this._angle1=new Kfe(.6),this._angle2=new Kfe(.6),this._axis1=E(),this._axis2=E(),this._lastScene=E()}addMomentumDirectRotation(e,i,r,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let a=YIe(this._lastScene,i,this._tmpAxis2,s,n,o);this._angle2.update(0),sl(this._tmpAxis2)<eme?a=0:Ce(this._axis1,this._tmpAxis2),this._angle1.update(a),ve(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}addMomentumPreserveHeading(e,i,r,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;XIe(this._lastScene,i,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),sl(this._tmpAxis2)<eme?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),Ce(this._axis1,this._tmpAxis1),Ce(this._axis2,this._tmpAxis2)),ve(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?null:Math.sqrt(e*e+i*i),s=this._time.filteredDelta,n=r==null||s==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){const s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new $mt(e,i,r,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}},d3e=class{constructor(e=2.5,i=.01,r=.95,s=12){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this._maxVelocity=s,this.enabled=!0,this.value=new mf(.8),this.time=new mf(.3)}add(e,i){if(this.enabled&&i!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta()){const r=this.value.computeDelta(e);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=Ne(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,i,r){return new f6(e,i,r)}},p3e=class extends d3e{constructor(e=3,i=.01,r=.95,s=12){super(e,i,r,s)}add(e,i){const r=this.value.lastValue;if(r!=null){let s=e-r;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;e=r+s}super.add(e,i)}},Lmt=class extends f6{constructor(e,i,r){super(e,i,r)}value(e){const i=super.value(e);return Math.exp(i)}valueDelta(e,i){const r=super.value(e),s=super.value(e+i)-r;return Math.exp(s)}},f3e=class extends d3e{constructor(e=2.5,i=.01,r=.95,s=12){super(e,i,r,s)}add(e,i){super.add(Math.log(e),i)}createMomentum(e,i,r){return new Lmt(e,i,r)}},IQ=class extends Og{constructor(){super(...arguments),this._smoothRotation=new pB(.05),this._rotationAxis=E(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=tr(),this._beginRadius=0,this._smoothScaling=new pB(.05),this._zoomCenterScreen=Ss(),this._zoomMomentumEstimator=new f3e,this._rotationMomentumEstimator=new p3e,this._panSphericalMomentumEstimator=new Imt,this._panPlanarMomentumEstimator=new h3e,this._adjustedSphere=dn(),this._tmp3d=E(),this._tmpScreenPointArray=Ss(),this._beginScreenPoint=Ss(),this._beginScenePoint=E(),this._screenPickPoint=Ss(),this._scenePickPoint=E(),this._navMode=Ma.Horizontal,this._sphere=dn(),this._pointerCount=0,this._tmpInteractionDirection=E(),this._beginCamera=new Dr,this._constraintOptions=new up(ns.ALL,_i.NONE,0,this._beginCamera)}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;this._zoomMomentumEstimator.enabled=this._rotationMomentumEstimator.enabled=this._panPlanarMomentumEstimator.enabled=this._panSphericalMomentumEstimator.enabled=this.view.navigation.momentumEnabled,this._beginHeading=-bb.normalize(kt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),yf(e.center,this._screenPickPoint),Da(this._beginScreenPoint,this._screenPickPoint);const i=_r(this.view.spatialReference),r=WIe(this._intersectionHelper,this.startCamera,this._screenPickPoint,i,dP.Silhouette,this.view.map.ground.opacity===0?I2:{});r.scenePickPoint!=null&&(this._scenePickPoint=r.scenePickPoint,this._sphere=r.sphere,ve(this._beginScenePoint,this._scenePickPoint),this._navMode=jD(this.startCamera,this._screenPickPoint,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===Ma.Vertical&&this._preparePlanarPanMode(e,r.hasGeometryIntersection),this._beginCamera.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1;this._navMode===Ma.Horizontal?(i&&this._zoomSpherical(e),this._panningSpherical(e),i&&this._rotateSpherical(e)):(i&&this._zoomPlanar(e),this._panningPlanar(e),i&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return this._navMode===Ma.Horizontal?new Ux({view:this.view,momentum:i,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new gM({view:this.view,momentum:i,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new xT({view:this.view,momentum:r,center:this._sphere,axis:this._rotationAxis});if(this._navMode===Ma.Horizontal){const s=this._panSphericalMomentumEstimator.evaluateMomentum();if(s)return new vU({view:this.view,momentum:s})}else{const s=this._panPlanarMomentumEstimator.evaluateMomentum();if(s)return new u3({view:this.view,momentum:s})}return null}_preparePlanarPanMode(e,i){const r=sa(this._tmp3d,this.startCamera.viewForward);TD(this._scenePickPoint,r,this._panningPlane);const s=Ss(this._screenPickPoint[0],0),n=E(),o=Ve(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],ML(this._adjustedSphere,this.startCamera,s,n);const a=Pa();this.startCamera.projectToRenderScreen(n,a);const l=E(),c=E(),u=E();Re(l,this._scenePickPoint,this.currentCamera.eye);const d=Ve(l);Ce(l,l);const f=jIe*Math.max(Math.abs(this.view.camera.position.z),GIe),m=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,h6);let g=m??f;g=i?Math.min(g,d):g,ve(u,Ee(c,this.currentCamera.eye,he(c,l,g))),this._panningPlane[3]=-Te(this._panningPlane,u),this.startCamera.center=Ee(c,this.startCamera.eye,he(c,this.startCamera.viewForward,g));const y=yf(e.center,this._tmpScreenPointArray);PQ(this._panningPlane,this.startCamera,y,this._beginScenePoint)}_zoomSpherical(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),HIe(this._sphere,this.currentCamera,this._smoothScaling.value),yf(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=_i.ZOOM,this._constraintOptions.interactionFactor=ff(e.radius-this._beginRadius),ln(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const i=yf(e.center,this._tmpScreenPointArray);ML(this._sphere,this.currentCamera,i,this._tmp3d),$ne(this._beginScenePoint,Te(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(KIe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(QIe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=_i.PAN,this._constraintOptions.interactionFactor=ff(Ob(this._screenPickPoint,i)),ln(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){Ce(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||sa(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value,r=i+AQ(e.angle-i),s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(r);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),Lb(this.currentCamera,this._sphere,CL(this._rotationAxis,n)),this._constraintOptions.interactionType=_i.TUMBLE,this._constraintOptions.interactionFactor=ff(e.radius*r),ln(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const i=yf(e.center,this._tmpScreenPointArray);PQ(this._panningPlane,this.currentCamera,i,this._tmp3d)&&(ZIe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(i,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=_i.PAN,this._constraintOptions.interactionFactor=ff(Ob(this._beginScreenPoint,i)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),ln(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),Rne(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=_i.ZOOM,this._constraintOptions.interactionFactor=ff(e.radius-this._beginRadius),ln(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){ve(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||sa(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value;let r=e.angle-i;r=AQ(r);const s=i+r,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(s);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),Lb(this.currentCamera,this._sphere,CL(this._rotationAxis,o)),this._constraintOptions.interactionType=_i.TUMBLE,this._constraintOptions.interactionFactor=ff(e.radius*o),ln(this.view,this.currentCamera,this._constraintOptions)}};IQ=h([I("esri.views.3d.state.controllers.PinchAndPanControllerGlobal")],IQ);const tme=Ge(0,0,1);let LQ=class extends Og{constructor(){super(...arguments),this._rotationValueSmooth=new pB(.05),this._scalingValueSmooth=new pB(.05),this._planeHorizontal=tr(),this._planeVertical=tr(),this._rotationMomentumEstimator=new p3e,this._panMomentumEstimator=new h3e(300,12,.9),this._zoomMomentumEstimator=new f3e,this._beginRadius=0,this._beginCenter=E(),this._beginAngle=0,this._tmpPoints=[],this._navMode=Ma.Horizontal,this._beginCenterScreen=Ss(),this._tmpCentroid3d=E(),this._tmpCentroid2d=Ss(),this._tmp2d=Ss(),this._pointerCount=0,this._beginCamera=new Dr,this._constraintOptions=new up(ns.ALL,_i.NONE,0,this._beginCamera)}begin(e){if(!this.active)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panMomentumEstimator.enabled=i,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),yf(e.center,this._beginCenterScreen),JMe(tme,0,this._planeHorizontal);const r=E(),s=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r,this.view.map.ground.opacity===0?I2:{}),n=E();sa(n,this.startCamera.viewForward);const o=E();ve(o,tme);const a=Te(n,o);this._navMode=jD(this.startCamera,this._beginCenterScreen,this.view.renderCoordsHelper,this.view.viewingMode);const l=Math.min(jIe,1/Math.abs(Te(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),GIe);wY(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||xY(this._planeHorizontal,this._planeHorizontal);const c=E(),u=E(),d=E();Re(c,r,this.currentCamera.eye);const f=Ve(c);if(Ce(c,c),this._navMode===Ma.Vertical){he(o,o,a),Re(this._planeVertical,n,o),Ce(this._planeVertical,this._planeVertical),wY(this._planeVertical,this._planeVertical,r);const m=this.view._stage.renderView.getMinimalDepthForArea(AL(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,h6);let g=m??l;g=s?Math.min(g,f):g,ve(d,Ee(u,this.currentCamera.eye,he(u,c,g))),this._planeVertical[3]=-Te(this._planeVertical,d),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),rq(this._tmpPoints,this._beginCenter)}else{const m=s?f:l;ve(d,Ee(u,this.currentCamera.eye,he(u,c,m))),this._planeHorizontal[3]=-Te(this._planeHorizontal,d),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),rq(this._tmpPoints,this._beginCenter)}this._beginCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1,r=this._navMode===Ma.Horizontal?this._planeHorizontal:this._planeVertical,s=this._beginCenter;if(i){const n=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(n),Rne(this.currentCamera,s,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=_i.ZOOM,this._constraintOptions.interactionFactor=ff(Math.abs(e.radius-this._beginRadius)),ln(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),rq(this._tmpPoints,this._tmpCentroid3d),yf(e.center,this._tmpCentroid2d),ZIe(this.currentCamera,s,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=_i.PAN,this._constraintOptions.interactionFactor=ff(Ob(this._beginCenterScreen,this._tmpCentroid2d)),ln(this.view,this.currentCamera,this._constraintOptions),i){const n=s,o=this._rotationValueSmooth.value,a=o+AQ(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=l,this._rotationValueSmooth.update(a);const c=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(c,.001*e.timestamp);const u=this._planeHorizontal;Lb(this.currentCamera,n,CL(u,c)),this._constraintOptions.interactionType=_i.TUMBLE,this._constraintOptions.interactionFactor=ff(Math.abs(e.radius*c)),ln(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return new gM({view:this.view,momentum:i,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new xT({view:this.view,momentum:r,center:this._beginCenter,axis:this._planeHorizontal});const s=this._panMomentumEstimator.evaluateMomentum();return s?new u3({view:this.view,momentum:s}):null}_computePlanePoints(e,i,r,s){s.length=e.size;const n=this._tmp2d;let o=0;return e.forEach(a=>{n[0]=a.x,n[1]=a.y,s[o]===void 0&&(s[o]=E()),PQ(i,r,n,s[o]),o+=1}),s}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};LQ=h([I("esri.views.3d.state.controllers.PinchAndPanControllerLocal")],LQ);let ime=class extends ha{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!Lne(e.data,this.pointerAction))return;const i=e.timestamp-this._lastEndTimestamp,r=40,s=this._momentum&&this._momentum.active&&i<r;switch(e.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,i){var r;if((r=this._controller)!=null&&r.active){this._lastEndTimestamp=e.timestamp;const s=this._controller.end(e.data);i&&s&&(this._momentum=s,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new IQ({view:this._view}):new LQ({view:this._view})}},Dmt=class extends ha{constructor(e,i){super(!0),this.view=e,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}},m3e=class extends ha{constructor(e,i){super(!0),this.key=e,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},Nmt=class extends m3e{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},Fmt=class extends m3e{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},kmt=class extends ha{constructor(e,i=!1){super(!0),this._view=e,this._invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(e){var s,n,o;const i=this._invert?-1:1,r=Ss(0,e.data.delta*i);switch(e.data.action){case"begin":(s=this._cameraController)==null||s.end(),this._cameraController=new c3({view:this._view,pivot:pu.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":(n=this._cameraController)==null||n.update(r);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}};function rme(t){const e=t.native;return e?{buttons:e.buttons.map(i=>i.pressed?i.value||1:0),axes:e.axes.map(i=>zmt(i,t.axisThreshold))}:{buttons:[],axes:[]}}function Umt(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let i=0;i<t.axes.length;i++)if(t.axes[i]!==e.axes[i])return!1;for(let i=0;i<t.buttons.length;i++)if(t.buttons[i]!==e.buttons[i])return!1;return!0}function Vmt(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function zmt(t,e){const i=Math.abs(t);return i<e?0:Math.sign(t)*(i-e)/(1-e)}let Bmt=class{constructor(e,i){this._element=e,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,rme(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&(sme(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const i=new Dse(e);i.deviceType!=="unknown"&&(this._inputDevices[e.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=PS({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),i=this._element.contains(document.activeElement),r=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!i;sme(s=>{const n=this._inputDevices[s.index];if(!n)return;const o=this._latestUpdate[s.index],a=rme(n),l=r||Vmt(a);o&&(o.timestamp===s.timestamp||!o.active&&l||Umt(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_emitGamepadEvent(e,i,r){const s=this._latestUpdate[e.index],n=s&&s.active;if(!n&&!r)return;const o=!n&&r?"start":n&&r?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:i,active:r},this._callback&&this._callback({device:this._inputDevices[e.index],state:i,action:o})}};function jmt(t){if(!t||!t.connected)return!1;for(let e=0;e<t.axes.length;e++)if(isNaN(t.axes[e]))return!1;return!0}function sme(t){const e=window.navigator.getGamepads();for(let i=0;i<e.length;i++){const r=e[i];jmt(r)&&t(r)}}const nme=le("edge"),Gmt=le("chrome"),Hmt=le("ff"),qmt=le("safari"),ome="esri-view-surface",aE={touchNone:`${ome}--touch-none`,touchPan:`${ome}--touch-pan`};let g3e=class y3e{constructor(e,i){this._input=i,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new Bmt(e,this._input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=qe(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const i in this._active)if(!e||!e.has(i)){const r=this._active[i];this._element.removeEventListener(mq[i],r),delete this._active[i]}e&&e.forEach(i=>{if(!this._active[i]&&mq[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(mq[i],r),this._active[i]=r}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,i){i?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?aE.touchNone:aE.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?aE.touchPan:aE.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(aE.touchNone),this._element.classList.remove(aE.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,i){const r=dRe(this._element,e);return y3e.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(e,i){const{key:r}=i;r&&e==="key-up"&&this._keyDownState.delete(r);const s={native:i,key:r,repeat:!!r&&this._keyDownState.has(r)};r&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(e,r)}_handlePointerPreventDefault(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(e,r)}_handleMouseWheel(e,i){let r=i.deltaY;switch(i.deltaMode){case 0:nme&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}nme?r*=.7:Gmt||qmt?r*=.6:Hmt&&(r*=1.375);const s=100,n=Math.abs(r);n>s&&(r=r/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(e,o)}_handlePointerCaptureLost(e,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(e,i)}_handleDefault(e,i){const r={native:i};i.preventDefault(),this._callback(e,r)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};g3e.test={disableSubpixelCoordinates:!1};const mq={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let Wmt=class extends ha{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};const xh={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function DQ(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function Zmt(t,e){const i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}function Ymt(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:ep()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[x,S]=t,[C,M]=[S.x-x.x,S.y-x.y];return e.radius=Math.sqrt(C*C+M*M)/2,e.center.x=(x.x+S.x)/2,e.center.y=(x.y+S.y)/2,e}let i=0,r=0;for(let x=0;x<t.length;x++)i+=t[x].x,r+=t[x].y;i/=t.length,r/=t.length;const s=t.map(x=>x.x-i),n=t.map(x=>x.y-r);let o=0,a=0,l=0,c=0,u=0,d=0,f=0;for(let x=0;x<s.length;x++){const S=s[x],C=n[x],M=S*S,O=C*C;o+=M,a+=O,l+=S*C,c+=M*S,u+=O*C,d+=S*O,f+=C*M}const m=.5*(c+d),g=.5*(u+f),y=o*a-l*l,v=(m*a-g*l)/y,b=(o*g-l*m)/y,w=ep(v+i,b+r);return{radius:Math.sqrt(v*v+b*b+(o+a)/t.length),center:w}}function h3(t){const{native:e}=t,{pointerId:i,button:r,pointerType:s}=e;return s==="mouse"?`${i}:${r}`:`${s}`}let Xmt=class extends ha{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,i,r,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:s,pointers:Jmt(this._activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(e){const i=e.native.pointerId,r=r4(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,s);const n=bU(s,_3e(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const i=e.native.pointerId,r=this._activePointerMap.get(i);r?r.event=e:this._addPointer(e)}_removePointer(e){const i=r4(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(i)}_updatePointerAngles(e){const i=r4(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=bU(r,i)-e,r.lastAngle=bU(r,i)-e})}_emitEvent(e,i,r){const s=r4(this._activePointerMap);this._drag.emit(this._createPayload(e,i,s,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const i=e.data.native.pointerId,r=e.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const i=e.data,r=i.currentEvent,s=e.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function _3e(t){const e=[];return t.forEach(i=>{e.push(ep(i.event.x,i.event.y))}),Ymt(e)}function r4(t){const e=_3e(t);let i=0;return t.forEach(r=>{let s=bU(r,e),n=s-r.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=r.lastAngle+n,r.lastAngle=s;const o=s-r.initialAngle;i+=o}),i/=t.size||1,{angle:i,radius:e.radius,center:e.center}}function Jmt(t){const e=new Map;return t.forEach((i,r)=>e.set(r,i.event)),e}function bU(t,e){const i=t.event,r=i.x-e.center.x,s=i.y-e.center.y;return Math.atan2(s,r)}var ame;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(ame||(ame={}));let Qmt=class extends ha{constructor(e=xh.maximumDoubleClickDelay,i=xh.maximumDoubleClickDistance,r=xh.maximumDoubleTouchDelay,s=xh.maximumDoubleTouchDistance,n=nD){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=h3(i);if(!this._pointerState.has(r)){const s={downButton:i.native.button,x:i.x,y:i.y,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(i.native)}}_handlePointerUp(e){const i=e.data,r=h3(i),s=this._pointerState.get(r);if(s&&s.downButton===i.native.button){const n=s.immediateDoubleClick,o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;n?(n.timeoutHandle.remove(),DQ(n,e.data)>o?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,n.modifiers),this._removeState(i))):DQ(s,e.data)>o?this._removeState(i):this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,i){const r=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),r)}}_removeState(e){const i=h3(e);this._pointerState.delete(i),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},Kmt=class extends ha{constructor(e=xh.maximumClickDelay,i=xh.movementUntilMouseDrag,r=xh.movementUntilPenDrag,s=xh.movementUntilTouchDrag,n=xh.holdDelay,o=nD){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=r,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=$r(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=i.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(r);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const n={startEvent:i,previousEvent:i,startTimestamp:e.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_handlePointerMove(e){const i=e.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit(s4("update",s,i),void 0,s.modifiers):Zmt(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(e),s.previousEvent=i)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const i=e.data,r=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit(s4("start",s,i)):this._pointerDrag.emit(s4("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,i){const r=e.data,s=r.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(s4("end",n,i==="pointer-up"?r:n.previousEvent),void 0,n.modifiers):i==="pointer-up"&&n.downButton===r.native.button&&e.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}};function s4(t,e,i){return{action:t,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:i}}let egt=class extends ha{constructor(e=xh.maximumDoubleClickDelay,i=xh.maximumDoubleClickDistance,r=xh.maximumDoubleTouchDelay,s=xh.maximumDoubleTouchDistance,n=nD){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=$r(e.doubleClickTimer))}get hasPendingInputs(){return Eh(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,i){const r=this._pointerState.get(e);r&&(r.doubleClickTimer=$r(r.doubleClickTimer),i&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const i=this._pointerState.get(e);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_handleImmediateClick(e){const i=e.data,{pointerType:r}=i.native,s=tgt(i);if(!this._pointerState.has(s))return void this._startClick(e);const n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=r==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;DQ(o,i)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const i=h3(e.data),r=this._pointerState.get(i);r&&(r.pointerDownCount+=1)}_startClick(e){const{data:i}=e,{native:{pointerType:r}}=i,s=h3(i),n=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n);this._pointerState.set(s,{event:e,doubleClickTimer:o,pointerDownCount:1}),this.refreshHasPendingInputs()}};function tgt(t){const{pointerId:e,pointerType:i,button:r}=t.native;return i==="mouse"?`${e}:${r}`:`${i}`}let igt=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const i=e.data,r=i.pointers.size;switch(i.action){case"start":this._currentCount=r,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var i,r;this._startEvent=e,(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var i,r;(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var i,r;(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},rgt=class extends ha{constructor(e=20,i=40){super(!1),this._threshold=e,this._maxDelta=i,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new igt({start:(r,s)=>this._observeStart(r,s),update:(r,s,n)=>this._observeUpdate(r,s,n),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r))}get failed(){return this._state==="failed"}_observeStart(e,i){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,i,r){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,i){let r=-1/0,s=1/0,n=-1/0,o=1/0;for(const{x:y,y:v}of i.pointers.values())r=Math.max(r,y),s=Math.min(s,y),n=Math.max(n,v),o=Math.min(o,v);let a=-1/0,l=1/0,c=-1/0,u=1/0;for(const{x:y,y:v}of e.pointers.values())a=Math.max(a,y),l=Math.min(l,y),c=Math.max(c,v),u=Math.min(u,v);const d=r-s,f=n-o,m=a-l,g=c-u;return Math.abs(e.center.x-i.center.x)<this._threshold&&Math.abs(m-d)<=this._maxDelta&&Math.abs(g-f)<=this._maxDelta}_checkVerticalThresholdReached(e,i){let r=Math.abs(e.center.y-i.center.y);return e.pointers.forEach((s,n)=>{const o=i.pointers.get(n);r=Math.min(r,Math.abs(s.y-o.y))}),r>=this._threshold}},Vp=class extends Ue{destroy(){this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){var e;return!!((e=this._inputManager)!=null&&e.updating)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=qe(this._inputManager)}connect(){const e=this.view;this._source=new g3e(this.view.surface,e.input);const i=[new Qmt,new Kmt,new egt,new Xmt(this.view.navigation),new rgt],r=new ud({eventSource:this._source,recognizers:i});this._inputManager=r,r.installHandlers("prevent-context-menu",[new Wmt],ib.INTERNAL),this._modeDragPan=new ime(e,"primary"),this._modeDragRotate=new pq(e,"secondary",pu.CENTER),this._modeDragZoom=new _mt(e,"tertiary");const s={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};r.installHandlers("navigation",[new Dmt(e),new kft(e),new Cmt(e),new Amt(e,s.pan),new Pmt(e),new Fmt(e,s.resetTilt),new Nmt(e,s.resetHeading),new pq(e,"primary",pu.EYE,[s.lookAround]),new pq(e,"secondary",pu.CENTER,[s.lookAround]),new ime(e,"tertiary",[s.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new kmt(e)],ib.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),this.addHandles(te(()=>{var n;return(n=this.view.navigation)==null?void 0:n.browserTouchPanEnabled},n=>{this._source.browserTouchPanningEnabled=!n},$t))}isModifierKeyDown(e){var i;return((i=this._inputManager)==null?void 0:i.isModifierKeyDown(e))??!1}_updateMode(){var s;const e=this.mode,i=this.primaryDragAction,r=(s=NQ.get(e))==null?void 0:s.get(i);r&&(this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom))}get test(){}};h([p()],Vp.prototype,"view",void 0),h([p({value:"pan"})],Vp.prototype,"primaryDragAction",null),h([p({value:"default"})],Vp.prototype,"mode",null),h([p({readOnly:!0})],Vp.prototype,"updating",null),h([p()],Vp.prototype,"latestPointerType",null),h([p()],Vp.prototype,"latestPointerLocation",null),h([p()],Vp.prototype,"multiTouchActive",null),h([p()],Vp.prototype,"_inputManager",void 0),Vp=h([I("esri.views.3d.input.SceneInputManager")],Vp);const NQ=new Map,gq=new Map,yq=new Map;gq.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),gq.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),yq.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),yq.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),NQ.set("default",gq),NQ.set("pro",yq);const sgt=Vp;let sn=class extends Ue{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};h([p()],sn.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),h([p()],sn.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),h([p()],sn.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),h([p()],sn.prototype,"DECONFLICTOR_SHOW_GRID",void 0),h([p()],sn.prototype,"LABELS_SHOW_BORDER",void 0),h([p()],sn.prototype,"TEXT_SHOW_BASELINE",void 0),h([p()],sn.prototype,"TEXT_SHOW_BORDER",void 0),h([p()],sn.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),h([p()],sn.prototype,"OVERLAY_SHOW_CENTER",void 0),h([p()],sn.prototype,"SHOW_POI",void 0),h([p()],sn.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),h([p()],sn.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),h([p()],sn.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),h([p()],sn.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),h([p()],sn.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),h([p()],sn.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),h([p()],sn.prototype,"I3S_TREE_SHOW_TILES",void 0),h([p()],sn.prototype,"I3S_SHOW_MODIFICATIONS",void 0),h([p()],sn.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),h([p()],sn.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),h([p()],sn.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),h([p()],sn.prototype,"LINE_WIREFRAMES",void 0),sn=h([I("esri.views.3d.support.debugFlags")],sn);const Nr=new sn;let ph,uA,FQ=!1,kQ=!1,UQ=!1,VQ=!1,d3=null;function ngt(t,e){if(!kQ||!uA)return;v3e();const i=uA;let r=0;for(let s=0;s<t.accBinsNumX;s++)for(let n=0;n<t.accBinsNumY;n++){const o=t.accBins[s][t.accBinsNumY-1-n];r+=o.length;const a=s*t.accBinsSizeX,l=(s+1)*t.accBinsSizeX,c=n*t.accBinsSizeY,u=(n+1)*t.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),b3e(a,l,c,u,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+e.size,70,50),i.fillText("total numTests: "+t.accNumTests,70,30)}function ogt(t){UQ=Nr.DECONFLICTOR_SHOW_VISIBLE,VQ=Nr.DECONFLICTOR_SHOW_INVISIBLE,FQ=UQ||VQ,kQ=Nr.DECONFLICTOR_SHOW_GRID,d3=null,FQ||kQ?d3=()=>agt(t):ph&&(ph.parentElement.removeChild(ph),ph=null)}function v3e(){d3&&(d3(),d3=null)}function agt(t){ph==null&&(ph=document.createElement("canvas"),ph.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(ph));const{state:e}=t,{camera:i,pixelRatio:r}=e,{width:s,height:n}=i,o=s*r,a=n*r;ph.setAttribute("width",`${o}px`),ph.setAttribute("height",`${a}px`),ph.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),uA=ph.getContext("2d"),uA.clearRect(0,0,s,n),uA.font="12px Arial"}function b3e(t,e,i,r,s){v3e();const n=ph.height,o=uA;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(t,n-i),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.closePath()}function lgt(t,e){FQ&&(e&&UQ||!e&&VQ)&&b3e(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var Aa,Ro;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(Aa||(Aa={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(Ro||(Ro={}));function w3e(t,e){return new S3e(t,C3e,e)}function cgt(t,e){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:s}=C3e;return new S3e(t,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:_q.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:_q.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:s,minPixelSize:_q.minPixelSize},e)}function ugt(t){return Math.abs(t*t*t)}function x3e(t,e,i){const r=i.parameters;return vq.scale=Math.min(r.divisor/(e-r.offset),1),vq.factor=ugt(t),vq}function Fne(t,e){return Bt(t*Math.max(e.scale,e.minScaleFactor),t,e.factor)}function hgt(t,e,i){const r=x3e(t,e,i);return r.minScaleFactor=0,Fne(1,r)}function lme(t,e,i,r){r.scale=hgt(t,e,i),r.factor=0,r.minScaleFactor=i.minScaleFactor}function T3e(t,e,i=[0,0]){const r=Math.min(Math.max(e.scale,e.minScaleFactor),1);return i[0]=t[0]*r,i[1]=t[1]*r,i}function dgt(t,e,i,r){return Fne(t,x3e(e,i,r))}let S3e=class E3e{get minScaleFactor(){return this._fontHeight!=null?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,i,r,s=pgt(),n){this._viewingMode=e,this._description=i,this._ellipsoidRadius=r,this.parameters=s,this._fontHeight=n,this._viewingMode===Xe.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overrideFontHeight(e){return e!==this._fontHeight?new E3e(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,i,r){const{scaleStart:s,scaleFallOffRange:n}=this._description,{fovY:o,distance:a}=e,l=this._calculateCurvatureDependentParameters(e,i),c=this._coverageCompensation(e,i,l),{tiltAngle:u,scaleFallOffFactor:d}=l,f=Math.sin(u)*a,m=.5*Math.PI-u-o*(.5-s*c),g=f/Math.cos(m),y=m+o*n*c,v=(g-d*(f/Math.cos(y)))/(1-d);return r.camera.fovY=e.fovY,r.camera.distance=e.distance,r.offset=v,r.divisor=g-v,r}_calculateCurvatureDependentParametersLocal(e,i,r=cme){return r.tiltAngle=this._description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(e,i,r=cme){const s=this._description.curvatureDependent,n=1+e.distance/i,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=Ne((o-a)/(l-a),0,1),[u,d]=[s.min,s.max];return r.tiltAngle=Bt(u.tiltAngle,d.tiltAngle,c),r.scaleFallOffFactor=Bt(u.scaleFallOffFactor,d.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(e,i,r){return(e.fovY-r.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,i,r){const s=i*i,n=r.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+s-2*Math.cos(n)*a*i,c=Math.sqrt(l),u=Math.sqrt(l-s);return(Math.acos(u/c)-Math.asin(i/(c/Math.sin(n)))+.5*o)/o}};const C3e={curvatureDependent:{min:{curvature:kt(10),tiltAngle:kt(12),scaleFallOffFactor:.5},max:{curvature:kt(70),tiltAngle:kt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},_q={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function pgt(){return{camera:{distance:0,fovY:0},divisor:0,offset:0}}const vq={scale:0,factor:0,minScaleFactor:0},cme={tiltAngle:0,scaleFallOffFactor:0};function fgt(t){return t instanceof Float32Array&&t.length>=16}function mgt(t){return Array.isArray(t)&&t.length>=16}function ggt(t){return fgt(t)||mgt(t)}const pP={unknown:1,inches:Vr(1,"meters","inches"),feet:Vr(1,"meters","feet"),"us-feet":Vr(1,"meters","us-feet"),yards:Vr(1,"meters","yards"),miles:Vr(1,"meters","miles"),"nautical-miles":Vr(1,"meters","nautical-miles"),millimeters:Vr(1,"meters","millimeters"),centimeters:Vr(1,"meters","centimeters"),decimeters:Vr(1,"meters","decimeters"),meters:Vr(1,"meters","meters"),kilometers:Vr(1,"meters","kilometers"),"decimal-degrees":1/RWe(1,"meters",lr.radius)};var rl,ume;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(rl||(rl={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(ume||(ume={}));let kne=class{constructor(e){this.field=e}},ygt=class extends kne{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[rl.Undefined,rl.Undefined,rl.Undefined]}},_gt=class extends kne{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},vgt=class extends kne{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},bgt=class{};function KO(t){return t!=null}function lE(t){return typeof t=="number"}function m6(t){return typeof t=="string"}function wgt(t){return t==null||m6(t)}function xgt(t,e,i,r=ke()){const s=t||0,n=e||0,o=i||0;return s!==0&&UA(r,r,-s/180*Math.PI),n!==0&&kA(r,r,n/180*Math.PI),o!==0&&Qj(r,r,o/180*Math.PI),r}function av(t,e,i,r,s){var a;const n=t.minSize,o=t.maxSize;if(t.useSymbolValue){const l=r.symbolSize[i];return e.minSize[i]=l,e.maxSize[i]=l,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=rl.DefinedSize,!0}if(KO(t.field))return KO(t.stops)?t.stops.length===2&&lE(t.stops[0].size)&&lE(t.stops[1].size)?(hme(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,i),e.type[i]=rl.DefinedSize,!0):!1:lE(n)&&lE(o)&&KO(t.minDataValue)&&KO(t.maxDataValue)?(hme(n,o,t.minDataValue,t.maxDataValue,e,i),e.type[i]=rl.DefinedSize,!0):t.valueUnit==="unknown"?!1:pP[t.valueUnit]!=null?(e.minSize[i]=-1/0,e.maxSize[i]=1/0,e.offset[i]=0,e.factor[i]=1/pP[t.valueUnit],e.type[i]=rl.DefinedSize,!0):!1;if(!KO(t.field)){if((a=t.stops)!=null&&a[0]&&lE(t.stops[0].size))return e.minSize[i]=t.stops[0].size,e.maxSize[i]=t.stops[0].size,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=rl.DefinedSize,!0;if(lE(n))return e.minSize[i]=n,e.maxSize[i]=n,e.offset[i]=n,e.factor[i]=0,e.type[i]=rl.DefinedSize,!0}return!1}function hme(t,e,i,r,s,n){const o=Math.abs(r-i)>0?(e-t)/(r-i):0;s.minSize[n]=o>0?t:e,s.maxSize[n]=o>0?e:t,s.offset[n]=t-i*o,s.factor[n]=o}function Tgt(t,e,i,r){if(t.normalizationField||t.valueRepresentation||!wgt(t.field))return null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return null}else e.size.field=t.field}else e.size=new ygt(t.field);let s;switch(t.axis){case"width":return s=av(t,e.size,0,i),s?e:null;case"height":return s=av(t,e.size,2,i),s?e:null;case"depth":return s=av(t,e.size,1,i),s?e:null;case"width-and-depth":return s=av(t,e.size,0,i),s&&av(t,e.size,1,i),s?e:null;case null:case void 0:case"all":return s=av(t,e.size,0,i),s=s&&av(t,e.size,1,i),s=s&&av(t,e.size,2,i),s?e:null;default:return`${t.axis}`,null}}function Sgt(t,e,i){for(let s=0;s<3;++s){let n=e.unitInMeters;t.type[s]===rl.DefinedSize&&(n*=e.modelSize[s],t.type[s]=rl.DefinedScale),t.minSize[s]=t.minSize[s]/n,t.maxSize[s]=t.maxSize[s]/n,t.offset[s]=t.offset[s]/n,t.factor[s]=t.factor[s]/n}let r;if(t.type[0]!==rl.Undefined)r=0;else if(t.type[1]!==rl.Undefined)r=1;else{if(t.type[2]===rl.Undefined)return!1;r=2}for(let s=0;s<3;++s)t.type[s]===rl.Undefined&&(t.minSize[s]=t.minSize[r],t.maxSize[s]=t.maxSize[r],t.offset[s]=t.offset[r],t.factor[s]=t.factor[r],t.type[s]=t.type[r]);return!0}function dme(t,e,i){t[4*e]=i.r/255,t[4*e+1]=i.g/255,t[4*e+2]=i.b/255,t[4*e+3]=i.a}function Egt(t,e,i){if(t.normalizationField)return null;if(m6(t.field)){if(!t.stops)return null;{if(t.stops.length>8)return null;e.color=new _gt(t.field);const r=t.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];e.color.values[s]=n.value,dme(e.color.colors,s,n.color)}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const r=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.color.values[s]=1/0,dme(e.color.colors,s,r)}}return e}function Cgt(t,e,i){if(t.normalizationField)return null;if(m6(t.field)){if(!t.stops)return null;{if(t.stops.length>8)return null;e.opacity=new vgt(t.field);const r=t.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];e.opacity.values[s]=n.value,e.opacity.opacityValues[s]=n.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const r=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.opacity.values[s]=1/0,e.opacity.opacityValues[s]=r}}return e}function bq(t,e,i){const r=i===2&&t.rotationType==="arithmetic";e.offset[i]=r?90:0,e.factor[i]=r?-1:1,e.type[i]=1}function Mgt(t,e,i){if(!m6(t.field))return null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return bq(t,e.rotation,0),e;case"roll":return bq(t,e.rotation,1),e;case null:case void 0:case"heading":return bq(t,e.rotation,2),e;default:return`${t.axis}`,null}}let GD=class{constructor(e,i=[1,1,1],r=[1,1,1],s=1,n=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=i,this.symbolSize=r,this.unitInMeters=s,this.anchor=n,this.scale=o,this.rotation=a}};function M3e(t,e,i){if(!t)return null;const r=t.reduce((s,n)=>{if(!s)return s;if(n.valueExpression)return null;switch(n.type){case"size":return e.supports.size?Tgt(n,s,e,i):s;case"color":return e.supports.color?Egt(n,s):s;case"opacity":return e.supports.opacity?Cgt(n,s):null;case"rotation":return e.supports.rotation?Mgt(n,s,i):s;default:return null}},new bgt);return!(t.length>0&&r)||r.size||r.color||r.opacity||r.rotation?r!=null&&r.size&&!Sgt(r.size,e)?null:r:null}let Agt=class{constructor(e,i,r){this.visualVariables=e,this.materialParameters=i,this.requiresShaderTransformation=r}};function fP(t,e){if(!t||Nr.TESTS_DISABLE_FAST_UPDATES)return null;const i=M3e(t.visualVariables,e);return i?new Agt(i,P3e(i,e),!!i.size):null}function mP(t,e,i){if(!e||!t)return!1;const r=t.visualVariables,s=M3e(e.visualVariables,i);return!!s&&!!(n4(r.size,s.size,"size")&&n4(r.color,s.color,"color")&&n4(r.rotation,s.rotation,"rotation")&&n4(r.opacity,s.opacity,"opacity"))&&(t.visualVariables=s,t.materialParameters=P3e(s,i),t.requiresShaderTransformation=!!s.size,!0)}function n4(t,e,i){if(!!t!=!!e||t&&t.field!==(e==null?void 0:e.field))return!1;if(t&&i==="rotation"){const r=t,s=e;for(let n=0;n<3;n++)if(r.type[n]!==s.type[n]||r.offset[n]!==s.offset[n]||r.factor[n]!==s.factor[n])return!1}return!0}let A3e=class extends Fr{constructor(e){super(),this.vvSize=(e==null?void 0:e.size)??null,this.vvColor=(e==null?void 0:e.color)??null,this.vvOpacity=(e==null?void 0:e.opacity)??null}};function P3e(t,e){const i=new A3e(t);return i.vvSize&&(i.vvSymbolAnchor=e.anchor,tp(p3),xgt(e.rotation[2],e.rotation[0],e.rotation[1],p3),i.vvSymbolRotationMatrix=i.vvSymbolRotationMatrix||Yr(),lp(i.vvSymbolRotationMatrix,p3)),i}function Pgt(t,e,i){if(!t.vvSize)return i;xn(lv,i);const r=t.vvSymbolRotationMatrix;hy(p3,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),gr(lv,lv,p3);for(let s=0;s<3;++s){const n=t.vvSize.offset[s]+e[0]*t.vvSize.factor[s];pme[s]=Ne(n,t.vvSize.minSize[s],t.vvSize.maxSize[s])}return _D(lv,lv,pme),dl(lv,lv,t.vvSymbolAnchor),lv}function Une(t,e,i){if(!e.vvSize)return de(t,1,1,1),t;for(let r=0;r<3;++r){const s=e.vvSize.offset[r]+i[0]*e.vvSize.factor[r];t[r]=Ne(s,e.vvSize.minSize[r],e.vvSize.maxSize[r])}return t}function kf(t,e){const i=t==null?0:e.attributes[t];return typeof i=="number"&&isFinite(i)?i:0}const lv=ke(),pme=E(),p3=ke();function Vne(t){t.vertex.code.add(T`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(T`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),t.vertex.code.add(T`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(T`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(T`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(T`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function Ogt(t){t.uniforms.add(new Wt("screenSizePerspective",e=>O3e(e.screenSizePerspective)))}function g6(t){t.uniforms.add(new Wt("screenSizePerspectiveAlignment",e=>O3e(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function O3e(t){return de(Rgt,t.parameters.divisor,t.parameters.offset,t.minScaleFactor)}const Rgt=E();function R3e(t,e){const i=t.vertex;e.hasVerticalOffset?($3e(i),e.hasScreenSizePerspective&&(t.include(Vne),g6(i),Qf(t.vertex,e)),i.code.add(T`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?T`vec3 worldNormal = normalize(worldPos + localOrigin);`:T`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?T`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:T`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(T`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const $gt=ci();function $3e(t){t.uniforms.add(new ji("verticalOffset",(e,i)=>{const{minWorldLength:r,maxWorldLength:s,screenLength:n}=e.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return _s($gt,n*a,o,r,s)}))}const I3e=.5;function L3e(t,e){t.include(Vne),t.attributes.add(R.POSITION,"vec3"),t.attributes.add(R.NORMAL,"vec3"),t.attributes.add(R.CENTEROFFSETANDDISTANCE,"vec4");const i=t.vertex;Nc(i,e),Qf(i,e),i.uniforms.add(new ji("viewport",(r,s)=>s.camera.fullViewport),new et("polygonOffset",r=>r.shaderPolygonOffset),new et("cameraGroundRelative",(r,s)=>s.camera.aboveGround?1:-1)),e.hasVerticalOffset&&$3e(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(T`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(T`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${e.multipassEnabled?T.float(0):T`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),e.draped&&!e.hasVerticalOffset||uP(i),e.draped||(i.uniforms.add(new et("perDistancePixelRatio",(r,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),i.code.add(T`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${T.float(I3e)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),e.screenCenterOffsetUnitsEnabled&&rO(i),e.hasScreenSizePerspective&&g6(i),i.code.add(T`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?T`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled?"":T`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}function D3e(t,e,i,r,s){let n=(i.screenLength||0)*t.pixelRatio;s!=null&&(n=dgt(n,r,e,s));const o=n*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return Ne(o*e,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function N3e(t,e){const i=e?N3e(e):{};for(const r in t){let s=t[r];s!=null&&s.forEach&&(s=Lgt(s)),s==null&&r in i||(i[r]=s)}return i}function Igt(t,e){let i=!1;for(const r in e){const s=e[r];s!==void 0&&(Array.isArray(s)?t[r]===null?(t[r]=s.slice(),i=!0):Fxe(t[r],s)&&(i=!0):t[r]!==s&&(i=!0,t[r]=s))}return i}function Lgt(t){const e=[];return t.forEach(i=>e.push(i)),e}const F3e={multiply:1,ignore:2,replace:3,tint:4};let iw=class extends VD{constructor(e,i){super(),this.type=Fs.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._vertexAttributeLocations=Ai,this._pp0=Ge(0,0,1),this._pp1=Ge(0,0,0),this._parameters=N3e(e,i),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,i=!0){Igt(this._parameters,e)&&(this.validateParameters(this._parameters),i&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bindParameters.decorations===Zl.ON)&&!!(this.parameters.renderOccluded&e.renderOccludedMask)}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){var e;(e=this.repository)==null||e.materialChanged(this)}queryRenderOccludedState(e){return this.isVisible()&&this.parameters.renderOccluded===e}intersectDraped(e,i,r,s,n,o){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(e,i,r,this._pp0,this._pp1,n)}},k3e=class extends tdt{constructor(e,i,r){super(i,r),this.camera=e}};var er;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(er||(er={}));let zne=class extends Fr{constructor(){super(...arguments),this.renderOccluded=er.Occlude,this.isDecoration=!1}},U3e=class{constructor(){this.factor=new fme,this.factorAlignment=new fme}},fme=class{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}};function CQt(t,e,i,r=1){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r===1)for(let c=0;c<l;++c)o[i]=s[n[c]],i+=a;else for(let c=0;c<l;++c){const u=s[n[c]];for(let d=0;d<r;d++)o[i]=u,i+=a}}function mme(t,e,i){const{data:r,indices:s}=t,n=e.typedBuffer,o=e.typedBufferStride,a=s.length;i*=o;for(let l=0;l<a;++l){const c=2*s[l];n[i]=r[c],n[i+1]=r[c+1],i+=o}}function V3e(t,e,i,r){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r==null||r===1)for(let c=0;c<l;++c){const u=3*n[c];o[i]=s[u],o[i+1]=s[u+1],o[i+2]=s[u+2],i+=a}else for(let c=0;c<l;++c){const u=3*n[c];for(let d=0;d<r;++d)o[i]=s[u],o[i+1]=s[u+1],o[i+2]=s[u+2],i+=a}}function gP(t,e,i,r=1){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r===1)for(let c=0;c<l;++c){const u=4*n[c];o[i]=s[u],o[i+1]=s[u+1],o[i+2]=s[u+2],o[i+3]=s[u+3],i+=a}else for(let c=0;c<l;++c){const u=4*n[c];for(let d=0;d<r;++d)o[i]=s[u],o[i+1]=s[u+1],o[i+2]=s[u+2],o[i+3]=s[u+3],i+=a}}function gme(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride;e*=s;for(let n=0;n<i;++n)r[e]=0,r[e+1]=0,r[e+2]=0,r[e+3]=0,e+=s}function Bne(t,e,i,r,s=1){if(!e)return void V3e(t,i,r,s);const{data:n,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,c=o.length,u=e[0],d=e[1],f=e[2],m=e[4],g=e[5],y=e[6],v=e[8],b=e[9],w=e[10],x=e[12],S=e[13],C=e[14];r*=l;let M=0,O=0,D=0;const U=tG(e)?k=>{M=n[k]+x,O=n[k+1]+S,D=n[k+2]+C}:k=>{const H=n[k],V=n[k+1],X=n[k+2];M=u*H+m*V+v*X+x,O=d*H+g*V+b*X+S,D=f*H+y*V+w*X+C};if(s===1)for(let k=0;k<c;++k)U(3*o[k]),a[r]=M,a[r+1]=O,a[r+2]=D,r+=l;else for(let k=0;k<c;++k){U(3*o[k]);for(let H=0;H<s;++H)a[r]=M,a[r+1]=O,a[r+2]=D,r+=l}}function jne(t,e,i,r,s=1){if(!e)return void V3e(t,i,r,s);const{data:n,indices:o}=t,a=e,l=i.typedBuffer,c=i.typedBufferStride,u=o.length,d=a[0],f=a[1],m=a[2],g=a[4],y=a[5],v=a[6],b=a[8],w=a[9],x=a[10],S=!pre(a),C=1e-6,M=1-C;r*=c;let O=0,D=0,U=0;const k=tG(a)?H=>{O=n[H],D=n[H+1],U=n[H+2]}:H=>{const V=n[H],X=n[H+1],q=n[H+2];O=d*V+g*X+b*q,D=f*V+y*X+w*q,U=m*V+v*X+x*q};if(s===1)if(S)for(let H=0;H<u;++H){k(3*o[H]);const V=O*O+D*D+U*U;if(V<M&&V>C){const X=1/Math.sqrt(V);l[r]=O*X,l[r+1]=D*X,l[r+2]=U*X}else l[r]=O,l[r+1]=D,l[r+2]=U;r+=c}else for(let H=0;H<u;++H)k(3*o[H]),l[r]=O,l[r+1]=D,l[r+2]=U,r+=c;else for(let H=0;H<u;++H){if(k(3*o[H]),S){const V=O*O+D*D+U*U;if(V<M&&V>C){const X=1/Math.sqrt(V);O*=X,D*=X,U*=X}}for(let V=0;V<s;++V)l[r]=O,l[r+1]=D,l[r+2]=U,r+=c}}function Dgt(t,e,i,r,s=1){if(!e)return void gP(t,i,r,s);const{data:n,indices:o}=t,a=e,l=i.typedBuffer,c=i.typedBufferStride,u=o.length,d=a[0],f=a[1],m=a[2],g=a[4],y=a[5],v=a[6],b=a[8],w=a[9],x=a[10],S=!pre(a),C=1e-6,M=1-C;if(r*=c,s===1)for(let O=0;O<u;++O){const D=4*o[O],U=n[D],k=n[D+1],H=n[D+2],V=n[D+3];let X=d*U+g*k+b*H,q=f*U+y*k+w*H,Z=m*U+v*k+x*H;if(S){const ye=X*X+q*q+Z*Z;if(ye<M&&ye>C){const L=1/Math.sqrt(ye);X*=L,q*=L,Z*=L}}l[r]=X,l[r+1]=q,l[r+2]=Z,l[r+3]=V,r+=c}else for(let O=0;O<u;++O){const D=4*o[O],U=n[D],k=n[D+1],H=n[D+2],V=n[D+3];let X=d*U+g*k+b*H,q=f*U+y*k+w*H,Z=m*U+v*k+x*H;if(S){const ye=X*X+q*q+Z*Z;if(ye<M&&ye>C){const L=1/Math.sqrt(ye);X*=L,q*=L,Z*=L}}for(let ye=0;ye<s;++ye)l[r]=X,l[r+1]=q,l[r+2]=Z,l[r+3]=V,r+=c}}function z3e(t,e,i,r,s=1){const{data:n,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,c=o.length;if(r*=l,e!==n.length||e!==4)if(s!==1)if(e!==4)for(let u=0;u<c;++u){const d=3*o[u];for(let f=0;f<s;++f)a[r]=n[d],a[r+1]=n[d+1],a[r+2]=n[d+2],a[r+3]=255,r+=l}else for(let u=0;u<c;++u){const d=4*o[u];for(let f=0;f<s;++f)a[r]=n[d],a[r+1]=n[d+1],a[r+2]=n[d+2],a[r+3]=n[d+3],r+=l}else{if(e===4){for(let u=0;u<c;++u){const d=4*o[u];a[r]=n[d],a[r+1]=n[d+1],a[r+2]=n[d+2],a[r+3]=n[d+3],r+=l}return}for(let u=0;u<c;++u){const d=3*o[u];a[r]=n[d],a[r+1]=n[d+1],a[r+2]=n[d+2],a[r+3]=255,r+=l}}else{a[r]=n[0],a[r+1]=n[1],a[r+2]=n[2],a[r+3]=n[3];const u=new Uint32Array(i.typedBuffer.buffer,i.start),d=l/4,f=u[r/=4];r+=d;const m=c*s;for(let g=1;g<m;++g)u[r]=f,r+=d}}function Ngt(t,e,i){const{data:r,indices:s}=t,n=e.typedBuffer,o=e.typedBufferStride,a=s.length,l=r[0];i*=o;for(let c=0;c<a;++c)n[i]=l,i+=o}function B3e(t,e,i,r,s=1){const n=e.typedBuffer,o=e.typedBufferStride;if(r*=o,s===1)for(let a=0;a<i;++a)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=o;else for(let a=0;a<i;++a)for(let l=0;l<s;++l)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=o}function j3e(t,e,i,r,s,n){var o;for(const a of e.fields.keys()){const l=t.attributes.get(a),c=l==null?void 0:l.indices;if(l&&c)Fgt(a,l,i,r,s,n);else if(a===R.OBJECTANDLAYERIDCOLOR&&t.objectAndLayerIdColor!=null){const u=(o=t.attributes.get(R.POSITION))==null?void 0:o.indices;if(u){const d=u.length,f=s.getField(a,ml);B3e(t.objectAndLayerIdColor,f,d,n)}}}}function Fgt(t,e,i,r,s,n){switch(t){case R.POSITION:{vt(e.size===3);const o=s.getField(t,ho);vt(!!o,`No buffer view for ${t}`),o&&Bne(e,i,o,n);break}case R.NORMAL:{vt(e.size===3);const o=s.getField(t,ho);vt(!!o,`No buffer view for ${t}`),o&&jne(e,r,o,n);break}case R.NORMALCOMPRESSED:{vt(e.size===2);const o=s.getField(t,UD);vt(!!o,`No buffer view for ${t}`),o&&mme(e,o,n);break}case R.UV0:{vt(e.size===2);const o=s.getField(t,O2);vt(!!o,`No buffer view for ${t}`),o&&mme(e,o,n);break}case R.COLOR:case R.SYMBOLCOLOR:{const o=s.getField(t,ml);vt(!!o,`No buffer view for ${t}`),vt(e.size===3||e.size===4),!o||e.size!==3&&e.size!==4||z3e(e,e.size,o,n);break}case R.COLORFEATUREATTRIBUTE:{const o=s.getField(t,QG);vt(!!o,`No buffer view for ${t}`),vt(e.size===1),o&&e.size===1&&Ngt(e,o,n);break}case R.TANGENT:{vt(e.size===4);const o=s.getField(t,Kf);vt(!!o,`No buffer view for ${t}`),o&&Dgt(e,i,o,n);break}case R.PROFILERIGHT:case R.PROFILEUP:case R.PROFILEVERTEXANDNORMAL:case R.FEATUREVALUE:{vt(e.size===4);const o=s.getField(t,Kf);vt(!!o,`No buffer view for ${t}`),o&&gP(e,o,n)}}}let MQt=class extends Fr{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function kgt(t,e){G3e(t,e,new Wt("slicePlaneOrigin",(i,r)=>Z3e(e,i,r)),new Wt("slicePlaneBasis1",(i,r)=>{var s;return fB(e,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new Wt("slicePlaneBasis2",(i,r)=>{var s;return fB(e,i,r,(s=r.slicePlane)==null?void 0:s.basis2)}))}function bn(t,e){G3e(t,e,new Dh("slicePlaneOrigin",(i,r)=>Z3e(e,i,r)),new Dh("slicePlaneBasis1",(i,r)=>{var s;return fB(e,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new Dh("slicePlaneBasis2",(i,r)=>{var s;return fB(e,i,r,(s=r.slicePlane)==null?void 0:s.basis2)}))}function G3e(t,e,...i){if(!e.hasSlicePlane){const o=T`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}e.hasSliceInVertexProgram&&t.vertex.uniforms.add(...i),t.fragment.uniforms.add(...i);const r=T`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=T`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=e.hasSliceHighlight?T`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:T`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(r),t.fragment.code.add(r),t.fragment.code.add(n)}function H3e(t,e,i){return t.instancedDoublePrecision?de(Ugt,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function q3e(t,e){return t!=null?Re(mB,e.origin,t):e.origin}function W3e(t,e,i){return t.hasSliceTranslatedView?e!=null?dl(Vgt,i.camera.viewMatrix,e):i.camera.viewMatrix:null}function Z3e(t,e,i){if(i.slicePlane==null)return On;const r=H3e(t,e,i),s=q3e(r,i.slicePlane),n=W3e(t,r,i);return n!=null?nt(mB,s,n):s}function fB(t,e,i,r){if(r==null||i.slicePlane==null)return On;const s=H3e(t,e,i),n=q3e(s,i.slicePlane),o=W3e(t,s,i);return o!=null?(Ee(eR,r,n),nt(mB,n,o),nt(eR,eR,o),Re(eR,eR,mB)):r}const Ugt=E(),mB=E(),eR=E(),Vgt=ke();function L2(t,e){const i=e.output===j.ObjectAndLayerIdColor,r=e.objectAndLayerIdColorInstanced;i&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),r?t.attributes.add(R.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):t.attributes.add(R.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(T`
     void forwardObjectAndLayerIdColor() {
      ${i?r?T`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:T`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:T``} }`),t.fragment.code.add(T`
      void outputObjectAndLayerIdColor() {
        ${i?T`fragColor = objectAndLayerIdColorVarying;`:T``} }`)}function y6(t){t.uniforms.add(new Bg("alignPixelEnabled",(e,i)=>i.alignPixelEnabled)),t.code.add(T`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(T`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}function zgt(t,e){const{vertex:i,fragment:r}=t;i.include(y6),e.multipassEnabled&&t.varyings.add("depth","float"),i.code.add(T`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.multipassEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.include(xy,e),r.code.add(T`
  void main() {
    fragColor = vec4(1);
    ${e.multipassEnabled?T`
        if(terrainDepthTest(depth)) {
          fragColor.g = 0.5;
        }`:""}
  }
  `)}function Y3e(t){t.vertex.uniforms.add(new et("renderTransparentlyOccludedHUD",(e,i)=>i.hudRenderStyle===Pc.Occluded?1:i.hudRenderStyle===Pc.NotOccluded?0:.75),new ji("viewport",(e,i)=>i.camera.fullViewport),new wt("hudVisibilityTexture",(e,i)=>{var r;return(r=i.hudVisibility)==null?void 0:r.getTexture()})),t.vertex.include(y6),t.vertex.code.add(T`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}const X3e=ii(1,1,0,1),Gne=ii(1,0,1,1);function rw(t){t.fragment.uniforms.add(new wt("depthTexture",(e,i)=>i.mainDepth)),t.fragment.constants.add("occludedHighlightFlag","vec4",X3e).add("unoccludedHighlightFlag","vec4",Gne),t.fragment.code.add(T`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}let J3e=class extends Vs{constructor(e,i,r){super(e,"vec4",Zi.Pass,(s,n,o)=>s.setUniform4fv(e,i(n,o)),r)}},Yl=class extends Vs{constructor(e,i,r){super(e,"float",Zi.Pass,(s,n,o)=>s.setUniform1fv(e,i(n,o)),r)}},HD=class extends A3e{constructor(){super(...arguments),this.renderOccluded=er.Occlude,this.isDecoration=!1}};const hA=8;function e_(t,e){const{vertex:i,attributes:r}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&r.add(R.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(i.uniforms.add(new Wt("vvSizeMinSize",s=>s.vvSize.minSize)),i.uniforms.add(new Wt("vvSizeMaxSize",s=>s.vvSize.maxSize)),i.uniforms.add(new Wt("vvSizeOffset",s=>s.vvSize.offset)),i.uniforms.add(new Wt("vvSizeFactor",s=>s.vvSize.factor)),i.uniforms.add(new cp("vvSymbolRotationMatrix",s=>s.vvSymbolRotationMatrix)),i.uniforms.add(new Wt("vvSymbolAnchor",s=>s.vvSymbolAnchor)),i.code.add(T`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(T`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?T`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(T`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(i.constants.add("vvColorNumber","int",hA),i.uniforms.add(new Yl("vvColorValues",s=>s.vvColor.values,hA),new J3e("vvColorColors",s=>s.vvColor.colors,hA)),i.code.add(T`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?T`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):i.code.add(T`vec4 vvColor() { return vec4(1.0); }`)}const gB=.1,ea=.001;function Q3e(t){const e=new Hi,i=t.signedDistanceFieldEnabled;if(e.include(L3e,t),e.include(bn,t),t.occlusionPass)return e.include(zgt,t),e;const{vertex:r,fragment:s}=e;e.include(Vne),s.include(rm),s.include(by),e.include(e_,t),e.include(L2,t),e.include(Y3e),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),e.varyings.add("voccluded","float"),r.uniforms.add(new ji("viewport",(c,u)=>u.camera.fullViewport),new jr("screenOffset",(c,u)=>Li(K3e,2*c.screenOffset[0]*u.camera.pixelRatio,2*c.screenOffset[1]*u.camera.pixelRatio)),new jr("anchorPosition",c=>PL(c)),new ji("materialColor",c=>c.color)),rO(r),i&&(r.uniforms.add(new ji("outlineColor",c=>c.outlineColor)),s.uniforms.add(new ji("outlineColor",c=>yme(c)?c.outlineColor:Rh),new et("outlineSize",c=>yme(c)?c.outlineSize:0))),t.pixelSnappingEnabled&&r.include(y6),t.hasScreenSizePerspective&&(Ogt(r),g6(r)),t.debugDrawLabelBorder&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(R.UV0,"vec2"),e.attributes.add(R.COLOR,"vec4"),e.attributes.add(R.SIZE,"vec2"),e.attributes.add(R.FEATUREATTRIBUTE,"vec4"),r.code.add(T`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?T`
            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:T`
            inputSize = size;
            vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(featureAttribute).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const n=T`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=t.pixelSnappingEnabled?i?T`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:T`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:T`posProj += quadOffset;`;r.code.add(T`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${t.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===j.ObjectAndLayerIdColor?T`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${T.float(ea)};
    ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${T.float(ea)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?T`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new wt("tex",c=>c.texture));const a=t.debugDrawLabelBorder?T`(isBorder > 0.0 ? 0.0 : ${T.float(gB)})`:T.float(gB),l=T`
    ${t.debugDrawLabelBorder?T`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${t.sampleSignedDistanceFieldTexelCenter?T`
      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;
      `:T`
      vec2 samplePos = vtc;
      `}

    ${i?T`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${T.float(ea)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:T`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?T`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;switch(t.output){case j.Color:t.transparencyPassType===pt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),s.code.add(T`
        void main() {
          ${l}
          ${t.transparencyPassType===pt.FrontFace?"fragColor.rgb /= fragColor.a;":""}
          ${t.transparencyPassType===pt.ColorAlpha?"fragAlpha = fragColor.a;":""}
        }`);break;case j.ObjectAndLayerIdColor:s.code.add(T`
        void main() {
          ${l}
          outputObjectAndLayerIdColor();
        }`);break;case j.Highlight:s.constants.add("occludedHighlightFlag","vec4",X3e),s.constants.add("unoccludedHighlightFlag","vec4",Gne),s.code.add(T`
        void main() {
          ${l}
          if (voccluded == 1.0) {
            fragColor = occludedHighlightFlag;
          } else {
            fragColor = unoccludedHighlightFlag;
          }
        }`)}return e}function yme(t){return t.outlineColor[3]>0&&t.outlineSize>0}function PL(t,e=K3e){return t.textureIsSignedDistanceField?Bgt(t.anchorPosition,t.distanceFieldBoundingBox,e):Da(e,t.anchorPosition),e}function Bgt(t,e,i){e!=null?Li(i,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):Li(i,0,0)}const K3e=mt(),jgt=Object.freeze(Object.defineProperty({__proto__:null,build:Q3e,calculateAnchorPosForRendering:PL},Symbol.toStringTag,{value:"Module"})),Ru=ua(Be.SRC_ALPHA,Be.ONE,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),Ggt=ua(Be.ONE,Be.ZERO,Be.ONE,Be.ONE_MINUS_SRC_ALPHA);function $_(t){return t===pt.FrontFace?null:Ggt}function _6(t){return t===pt.FrontFace?Nu:null}const v6=5e5,b6={factor:-1,units:-2};function w6(t){return t?b6:null}function sw(t,e=br.LESS){return t===pt.NONE||t===pt.FrontFace?e:br.LEQUAL}function I_(t){return t===pt.ColorAlpha?{buffers:[Gn.COLOR_ATTACHMENT0,Gn.COLOR_ATTACHMENT1]}:null}let eLe=class tLe extends Qi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Xe.Global}initializeProgram(e){return new Ki(e.rctx,tLe.shader.get().build(this.configuration),Ai)}initializePipeline(){const e=this.configuration.transparencyPassType,i=this.configuration,r=e===pt.NONE,s=e===pt.FrontFace,n=this.configuration.hasPolygonOffset?Hgt:null,o=i.draped?null:(r||s)&&i.output!==j.Highlight&&(i.depthEnabled||i.occlusionPass)?Nu:null;return Jt({blending:i.output===j.Color||i.output===j.Highlight?r?qgt:$_(e):null,depthTest:i.draped?null:{func:br.LEQUAL},depthWrite:o,drawBuffers:I_(e),colorWrite:ui,polygonOffset:n})}get primitiveType(){return this.configuration.occlusionPass?Ci.POINTS:Ci.TRIANGLES}};eLe.shader=new qi(jgt,()=>ce(()=>Promise.resolve().then(()=>gHt),void 0));const Hgt={factor:0,units:-4},qgt=Hh(Be.ONE,Be.ONE_MINUS_SRC_ALPHA);let fn=class extends Uc{constructor(){super(...arguments),this.output=j.Color,this.transparencyPassType=pt.NONE,this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};h([B({count:j.COUNT})],fn.prototype,"output",void 0),h([B({count:pt.COUNT})],fn.prototype,"transparencyPassType",void 0),h([B()],fn.prototype,"screenCenterOffsetUnitsEnabled",void 0),h([B()],fn.prototype,"spherical",void 0),h([B()],fn.prototype,"occlusionTestEnabled",void 0),h([B()],fn.prototype,"signedDistanceFieldEnabled",void 0),h([B()],fn.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),h([B()],fn.prototype,"vvSize",void 0),h([B()],fn.prototype,"vvColor",void 0),h([B()],fn.prototype,"hasVerticalOffset",void 0),h([B()],fn.prototype,"hasScreenSizePerspective",void 0),h([B()],fn.prototype,"debugDrawLabelBorder",void 0),h([B()],fn.prototype,"hasSlicePlane",void 0),h([B()],fn.prototype,"hasPolygonOffset",void 0),h([B()],fn.prototype,"depthEnabled",void 0),h([B()],fn.prototype,"pixelSnappingEnabled",void 0),h([B()],fn.prototype,"draped",void 0),h([B()],fn.prototype,"multipassEnabled",void 0),h([B()],fn.prototype,"cullAboveGround",void 0),h([B()],fn.prototype,"occlusionPass",void 0),h([B()],fn.prototype,"objectAndLayerIdColorInstanced",void 0),h([B({constValue:!0})],fn.prototype,"hasSliceInVertexProgram",void 0),h([B({constValue:!1})],fn.prototype,"hasVvInstancing",void 0);let yP=class extends iw{constructor(e){super(e,new ryt),this._configuration=new fn,this.produces=new Map([[Pe.HUD_MATERIAL,i=>cU(i)&&!this.parameters.drawInSecondSlot],[Pe.LABEL_MATERIAL,i=>cU(i)&&this.parameters.drawInSecondSlot],[Pe.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[Pe.DRAPED_MATERIAL,i=>cU(i)]])}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=i.slot===Pe.OCCLUSION_PIXELS&&this.parameters.occlusionTest,e===j.Color&&(this._configuration.debugDrawLabelBorder=!!Nr.LABELS_SHOW_BORDER),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(e,i,r,s,n,o){if(!(r.options.selectionMode&&r.options.hud&&e.visible&&r.point))return;const a=this.parameters,l=r.point,c=r.camera;let{scaleX:u,scaleY:d}=this._getScreenScale(e);u*=c.pixelRatio,d*=c.pixelRatio,lp(xq,i),e.attributes.has(R.FEATUREATTRIBUTE)&&Ygt(xq);const f=e.attributes.get(R.POSITION),m=e.attributes.get(R.SIZE),g=e.attributes.get(R.NORMAL),y=e.attributes.get(R.CENTEROFFSETANDDISTANCE);vt(f.size>=3);const v=PL(a),b=this.parameters.centerOffsetUnits==="screen";for(let w=0;w<f.data.length/f.size;w++){const x=w*f.size;de(za,f.data[x],f.data[x+1],f.data[x+2]),nt(za,za,i);const S=w*m.size;cv[0]=m.data[S]*u,cv[1]=m.data[S+1]*d,nt(za,za,c.viewMatrix);const C=w*y.size;if(de(ju,y.data[C],y.data[C+1],y.data[C+2]),!b&&(za[0]+=ju[0],za[1]+=ju[1],ju[2]!==0)){const O=ju[2];Ce(ju,za),Re(za,za,he(ju,ju,O))}const M=w*g.size;if(de(tR,g.data[M],g.data[M+1],g.data[M+2]),_me(tR,xq,c,Tq),this._applyVerticalOffsetTransformationView(za,Tq,c,wq),c.applyProjection(za,Sl),Sl[0]>-1){b&&(ju[0]||ju[1])&&(Sl[0]+=ju[0]*c.pixelRatio,ju[1]!==0&&(Sl[1]+=Fne(ju[1],wq.factorAlignment)*c.pixelRatio),c.unapplyProjection(Sl,za)),Sl[0]+=this.parameters.screenOffset[0]*c.pixelRatio,Sl[1]+=this.parameters.screenOffset[1]*c.pixelRatio,Sl[0]=Math.floor(Sl[0]),Sl[1]=Math.floor(Sl[1]),T3e(cv,wq.factor,cv);const O=eyt*c.pixelRatio;let D=0;if(a.textureIsSignedDistanceField&&(D=a.outlineSize*c.pixelRatio/2),vme(l,Sl[0],Sl[1],cv,O,D,a,v)){const U=r.ray;if(nt(bme,za,Zn(Jgt,c.viewMatrix)),Sl[0]=l[0],Sl[1]=l[1],c.unprojectFromRenderScreen(Sl,za)){const k=E();ve(k,U.direction);const H=1/Ve(k);he(k,k,H),o(Cr(U.origin,za)*H,k,-1,!0,1,bme)}}}}}intersectDraped(e,i,r,s,n,o){const a=e.attributes.get(R.POSITION),l=e.attributes.get(R.SIZE),c=this.parameters,u=PL(c);let{scaleX:d,scaleY:f}=this._getScreenScale(e);d*=e.screenToWorldRatio,f*=e.screenToWorldRatio;const m=tyt*e.screenToWorldRatio;for(let g=0;g<a.data.length/a.size;g++){const y=g*a.size,v=a.data[y],b=a.data[y+1],w=g*l.size;cv[0]=l.data[w]*d,cv[1]=l.data[w+1]*f;let x=0;c.textureIsSignedDistanceField&&(x=c.outlineSize*e.screenToWorldRatio/2),vme(s,v,b,cv,m,x,c,u)&&n(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new nyt(this)}_updateScaleInfo(e,i,r){const s=this.parameters;s.screenSizePerspective!=null?lme(r,i,s.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),s.screenSizePerspectiveAlignment!=null?lme(r,i,s.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,i,r,s,n,o,a){const l=_me(i,r,n,Tq);return this._applyVerticalGroundOffsetView(e,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(e,i,r,s,n){return this._applyCenterOffsetNDC(e,i,r,s),n!=null&&ve(n,s),this._applyPolygonOffsetNDC(s,i,r,s),s}_applyPolygonOffsetView(e,i,r,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(r);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return ve(n,e);const c=Ne(Math.abs(i.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/s.viewport[2];return he(n,e,l>0?u:1/u),n}_applyVerticalGroundOffsetView(e,i,r,s){const n=Ve(e),o=r.aboveGround?1:-1,a=r.computeRenderPixelSizeAtDist(n)*I3e,l=he(za,i.normal,o*a);return Ee(s,e,l),s}_applyVerticalOffsetTransformationView(e,i,r,s){var c;const n=this.parameters;if(!((c=n.verticalOffset)!=null&&c.screenLength)){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const u=Ve(e);this._updateScaleInfo(s,u,i.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return e}const o=Ve(e),a=n.screenSizePerspectiveAlignment??n.screenSizePerspective,l=D3e(r,o,n.verticalOffset,i.cosAngle,a);return this._updateScaleInfo(s,o,i.cosAngle),he(i.normal,i.normal,l),Ee(e,e,i.normal)}_applyCenterOffsetView(e,i,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==e&&ve(r,e),s&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(Ce(tR,r),Ee(r,r,he(tR,tR,i[2])))),r}_applyCenterOffsetNDC(e,i,r,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==e&&ve(s,e),n||(s[0]+=i[0]/r.fullWidth*2,s[1]+=i[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(e,i,r,s){const n=this.parameters.shaderPolygonOffset;if(e!==s&&ve(s,e),n){const o=r.aboveGround?1:-1,a=o*Math.sign(i[3]);s[2]-=(a||o)*n}return s}createGLMaterial(e){return new Wgt(e)}calculateRelativeScreenBounds(e,i,r=oi()){return Zgt(this.parameters,e,i,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}_getScreenScale(e){const i=e.attributes.get(R.FEATUREATTRIBUTE);if(i==null)return{scaleX:1,scaleY:1};const r=dL(i.data,Kgt),[s,n]=Une(Qgt,this.parameters,r);return{scaleX:s,scaleY:n}}},Wgt=class extends Zse{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(eLe,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function Zgt(t,e,i,r){r[0]=t.anchorPosition[0]*-e[0]+t.screenOffset[0]*i,r[1]=t.anchorPosition[1]*-e[1]+t.screenOffset[1]*i}function _me(t,e,i,r){return ggt(e)&&(e=lp(Xgt,e)),ta(r.normal,t,e),nt(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=Te(iLe,iyt),r}function Ygt(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=1/Math.sqrt(e*e+i*i+r*r),d=1/Math.sqrt(s*s+n*n+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*u,t[1]=i*u,t[2]=r*u,t[3]=s*d,t[4]=n*d,t[5]=o*d,t[6]=a*f,t[7]=l*f,t[8]=c*f,t}function vme(t,e,i,r,s,n,o,a){let l=e-s-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*s,u=i-s-(a[1]>0?r[1]*a[1]:0),d=u+r[1]+2*s;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&f!=null&&(l+=r[0]*f[0],u+=r[1]*f[1],c-=r[0]*(1-f[2]),d-=r[1]*(1-f[3]),l-=n,c+=n,u-=n,d+=n),t[0]>l&&t[0]<c&&t[1]>u&&t[1]<d}const wq=new U3e,za=E(),tR=E(),Sl=ci(),iLe=E(),bme=E(),xq=Yr(),Xgt=Yr(),Jgt=ke(),ju=E(),Qgt=E(),Kgt=ci(),Tq={normal:iLe,cosAngle:0},eyt=1,tyt=2,cv=[0,0],iyt=Ge(0,0,1);class ryt extends n$e{constructor(){super(...arguments),this.renderOccluded=er.Occlude,this.isDecoration=!1,this.color=ii(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=Ei(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=ii(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.draped=!1}}const rLe=As().vec3f(R.POSITION).vec3f(R.NORMAL).vec2f(R.UV0).vec4u8(R.COLOR).vec2f(R.SIZE).vec4f(R.CENTEROFFSETANDDISTANCE).vec4f(R.FEATUREATTRIBUTE),syt=rLe.clone().vec4u8(R.OBJECTANDLAYERIDCOLOR);let nyt=class{constructor(e){this._material=e,this.vertexBufferLayout=le("enable-feature:objectAndLayerId-rendering")?syt:rLe}elementCount(e){return 6*e.attributes.get(R.POSITION).indices.length}write(e,i,r,s,n){var b;Bne(r.attributes.get(R.POSITION),e,s.position,n,6),jne(r.attributes.get(R.NORMAL),i,s.normal,n,6);const o=r.attributes.get(R.UV0).data;let a,l,c,u;if(o==null||o.length<4){const w=this._material.parameters;a=0,l=0,c=w.texCoordScale[0],u=w.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],u=o[3];c=Math.min(1.99999,c+1),u=Math.min(1.99999,u+1);let d=r.attributes.get(R.POSITION).indices.length,f=n;const m=s.uv0;for(let w=0;w<d;++w)m.set(f,0,a),m.set(f,1,l),f++,m.set(f,0,c),m.set(f,1,l),f++,m.set(f,0,c),m.set(f,1,u),f++,m.set(f,0,c),m.set(f,1,u),f++,m.set(f,0,a),m.set(f,1,u),f++,m.set(f,0,a),m.set(f,1,l),f++;z3e(r.attributes.get(R.COLOR),4,s.color,n,6);const{data:g,indices:y}=r.attributes.get(R.SIZE);d=y.length;const v=s.size;f=n;for(let w=0;w<d;++w){const x=g[2*y[w]],S=g[2*y[w]+1];for(let C=0;C<6;++C)v.set(f,0,x),v.set(f,1,S),f++}if(r.attributes.get(R.CENTEROFFSETANDDISTANCE)?gP(r.attributes.get(R.CENTEROFFSETANDDISTANCE),s.centerOffsetAndDistance,n,6):gme(s.centerOffsetAndDistance,n,6*d),r.attributes.get(R.FEATUREATTRIBUTE)?gP(r.attributes.get(R.FEATUREATTRIBUTE),s.featureAttribute,n,6):gme(s.featureAttribute,n,6*d),r.objectAndLayerIdColor!=null){const w=(b=r.attributes.get(R.POSITION))==null?void 0:b.indices;if(w){const x=w.length,S=s.getField(R.OBJECTANDLAYERIDCOLOR,ml);B3e(r.objectAndLayerIdColor,S,x,n,6)}}}};const dm=E(),cE=ci(),iR=ci(),Sq=E(),oyt=ke(),ayt=dn(),Eq=lo(),lyt=E(),cyt=oi();class uyt{constructor(){this.aabr=oi(),this.distance=0,this.culled=!1,this.visible=!1}}class hyt{constructor(e,i){this.graphics3DGraphic=e,this.slicePlaneEnabled=i,this.info={}}}var uu;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(uu||(uu={}));class dyt{constructor(){this.camera=new Dr,this.slicePlane=T_(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),b2(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let yM=class extends Ue{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._viewState=new dyt,this._state=uu.Idle,this._active=new Map,this._visible=new Map,this._iterators=new gyt,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==uu.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/uu.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case uu.Idle:this._startUpdate(),t.madeProgress();case uu.Process:if(this._state=uu.Process,!this._processActiveGraphics(t))return;case uu.Sort:if(this._state=uu.Sort,!this._sortVisibleGraphics(t))return;case uu.Deconflict:if(this._state=uu.Deconflict,!this._deconflictVisibleGraphics(t))return;default:ngt(this,this._visible),this._state=uu.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(i=>this.addToActiveGraphics(i)):t.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;if(((e==null?void 0:e.geometries.length)??0)!==1)return!1;const i=e==null?void 0:e.geometries[0];return(i==null?void 0:i.material)instanceof yP}_startUpdate(){ogt(this.view),this._dirty=!1,this._viewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._viewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new uyt,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),pyt(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),i=Hb(oyt,this._viewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._viewState.camera.relativeElevation>0?ayt:null;let s=0;for(r!=null&&(nt(r,On,this._viewState.camera.viewMatrix),r[3]=_r(this.view.spatialReference).radius,s=yAe(r,On));!t.done;){t.madeProgress();const n=e.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o==null?void 0:o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,i,r,s),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const i=e.next();if(t.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===Ro.LABEL;for(;!t.done;){t.madeProgress();const r=e.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=r.value,n=s.info[this.visibilityGroup];if(!n||n.culled){this._setGraphicVisibility(s,!1);continue}const o=s.graphics3DGraphic,a=!i||o.isVisible();n.visible=a&&!this._isConflicted(s),n.visible&&this._addToBins(s),this._setGraphicVisibility(s,n.visible),lgt(n,n.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=wme(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=wme(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=fyt(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,i,r){const s=t.graphics3DGraphic;if(s.destroyed)return;const n=t.info[this.visibilityGroup];if(!s.isVisible(Ro.GRAPHIC,Aa.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);zh(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(a==null&&(a=byt,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,dm)||i!=null&&vyt(a,i,r)))return void(n.culled=!0);this._expandBoundingRect(n,l,c,a)}a==null?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(t,e,i){const r=this._viewState.camera,s=t.stageObject,n=s.geometries[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;nt(dm,a,r.viewMatrix);const l=n.attributes,c=l.get(R.NORMAL).data,u=l.get(R.CENTEROFFSETANDDISTANCE).data;o.applyShaderOffsetsView(dm,c,s.transformation,u,r,i.scaleInfo,dm),_s(cE,dm[0],dm[1],dm[2],1),Pu(iR,cE,r.projectionMatrix),he(i.positionNDC,iR,1/iR[3]),o.applyShaderOffsetsNDC(i.positionNDC,u,r,i.positionNDC,Sq),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(Sq[2]),i.distance=Sq[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),_s(iR,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),Pu(cE,iR,e),GS(cE,cE,1/cE[3]),de(i.positionView,dm[0],dm[1],dm[2])}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._viewState.slicePlaneEnabled&&Wre(this._viewState.slicePlane,e)}_expandBoundingRect(t,e,i,{positionNDC:r,scaleInfo:s}){const n=this._viewState.camera,o=e.getScreenSize(yyt);T3e(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=yz(i.calculateRelativeScreenBounds(o,s.factorAlignment.scale,cyt),Bt(0,n.fullWidth,.5+.5*r[0]),Bt(0,n.fullHeight,.5+.5*r[1])),l=this.marginFactor;if(l!==0){const c=l*Math.min(nl(a),Lc(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}Q1(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,i=t.info[this.visibilityGroup];let r=!0;for(let s=Math.floor(i.aabr[0]/this._accBinsSizeX);s<=Math.floor(i.aabr[2]/this._accBinsSizeX);s++)if(!(s<0||s>=this._accBinsNumX))for(let n=Math.floor(i.aabr[1]/this._accBinsSizeY);n<=Math.floor(i.aabr[3]/this._accBinsSizeY);n++){if(n<0||n>=this._accBinsNumY)continue;r=!1;const o=this._accBins[s][n];for(let a=0;a<o.length;a++){const l=o.data[a],c=l.info[this.visibilityGroup];if(c&&c.visible&&l.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,oG(c.aabr,i.aabr)))return!0}}return r}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let i=0;i<this._accBinsNumX;i++){this._accBins.push([]);const r=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)r.push(new ai)}}else for(let i=0;i<this._accBinsNumX;i++)for(let r=0;r<this._accBinsNumY;r++)this._accBins[i][r].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],i=Math.floor(e.aabr[0]/this._accBinsSizeX),r=Math.floor(e.aabr[2]/this._accBinsSizeX),s=Math.floor(e.aabr[1]/this._accBinsSizeY),n=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const i=t.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(this.visibilityGroup,Aa.DECONFLICTION,e),this.visibilityGroup===Ro.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,e))}};function pyt(t,e){const i=t.graphics3DGraphic;i.destroyed||i.setVisibilityFlag(e,Aa.DECONFLICTION,!0)}function*wme(t){if(Map.prototype.entries){const e=t.entries();for(let i=e.next();!i.done;i=e.next())yield i.value[1]}else yield*t.values()}function*fyt(t,e,i){e.clear(),t.forEach((s,n)=>{var l;const o=e.pushNew();o.id=n,o.visible=s.graphics3DGraphic.getVisibilityFlag(i,Aa.DECONFLICTION);const a=(l=s.info)==null?void 0:l[i];o.prio=s.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE}),yield;const r=e.iterableSort((s,n)=>s.prio!==n.prio?n.prio-s.prio:s.distance!==n.distance?s.distance-n.distance:s.visible!==n.visible?s.visible?-1:1:s.id-n.id);for(let s=r.next();!s.done;s=r.next())yield;e.forAll(s=>{const n=t.get(s.id);n&&(t.delete(s.id),t.set(s.id,n))}),e.clear()}h([p({constructOnly:!0})],yM.prototype,"view",void 0),h([p({type:Boolean,readOnly:!0})],yM.prototype,"updating",null),yM=h([I("esri.views.3d.layers.graphics.Deconflictor")],yM);class myt{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class gyt{constructor(e=null,i=null,r=null){this.active=e,this.visible=i,this.sort=r,this.sortArray=new ai({allocator:s=>s||new myt})}}const yyt=mt();class _yt{constructor(){this.positionView=E(),this.positionNDC=E(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new U3e}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}function vyt(t,e,i){return ve(Eq.direction,t.positionView),de(Eq.origin,0,0,0),!!Wb(e,Eq,lyt)&&t.distanceWithoutPolygonOffset>i}const byt=new _yt,wyt=2e3;let wU=class extends yM{constructor(e){super(e),this.visibilityGroup=Ro.LABEL,this.marginFactor=.05,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return na;const i=performance.now();if(e.state!==$i.IDLE&&i-this._lastDeconfliction<wyt)return na;super.runTask(e),this.state===uu.Idle&&(this._lastDeconfliction=i)}enabledChanged(e,i){this.modifyGraphics(i,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};h([p({constructOnly:!0})],wU.prototype,"parent",void 0),wU=h([I("esri.views.3d.layers.graphics.LabelDeconflictor")],wU);let zQ=class extends yM{constructor(){super(...arguments),this._contexts=new Map,this.visibilityGroup=Ro.GRAPHIC,this._marginFactor=-.1,this.test={overrideMarginFactor:e=>{this._marginFactor=e,this.setDirty()}}}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this.addHandles([te(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.state)==null?void 0:i.camera},()=>{this._updateViewState(),this.setDirty()}),te(()=>{var e,i,r;return(r=(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.ground)==null?void 0:r.opacity},(e,i)=>{e!==1&&i!==1||this.setDirty()}),te(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},$t)]),this._frameTask=this.view.resourceController.scheduler.registerTask(It.GRAPHICS_DECONFLICTOR,this),this._labels=new wU({view:this.view,parent:this})}destroy(){this._labels=qe(this._labels),this._frameTask=$r(this._frameTask)}get marginFactor(){return this._marginFactor}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}_updateViewState(){var e;(e=this.view)!=null&&e.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&cAe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){Eh(this._contexts,(e,i)=>i.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const i=this._getGraphicsContext(e);return{addGraphic:r=>this._addGraphic(e,i,r),removeGraphic:r=>this._removeGraphic(i,r),labelingInfoChange:()=>this._labels.enabledChanged(e,i),featureReductionChange:()=>this.enabledChanged(e,i),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,i),clear:()=>i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const i=this._contexts.get(e);i&&(i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,i,r){const s=r.graphic.uid,n=new hyt(r,e.symbolCreationContext.slicePlaneEnabled);i.set(s,n),Cq(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n);const o=!this._graphicSupportsDeconfliction(r)||!Cq(e);r.setVisibilityFlag(Ro.GRAPHIC,Aa.DECONFLICTION,o)}_removeGraphic(e,i){const r=i.graphic.uid,s=e.get(r);s&&(this.removeFromActiveGraphics(s),this._labels.removeFromActiveGraphics(s),e.delete(r),this.setDirty())}enabledChanged(e,i){const r=Cq(e);r||xyt(e),this.modifyGraphics(i,r)}_slicePlaneEnabledChanged(e,i){const r=e.symbolCreationContext.slicePlaneEnabled;i.forEach(s=>s.slicePlaneEnabled=r),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const i=e.layers;if(!(i!=null&&i.length))return!1;for(const r of i)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(e){const i=this._contexts.get(e);if(i)return i;const r=new Map;return this._contexts.set(e,r),this.setDirty(),r}};function Cq(t){const e=t.layer;return!(!(e!=null&&e.featureReduction)||e.featureReduction.type!=="selection")}function xyt(t){const e=t.graphics3DGraphics;e&&e.forEach(i=>i.setVisibilityFlag(Ro.GRAPHIC,Aa.DECONFLICTION,!0))}zQ=h([I("esri.views.3d.layers.graphics.GraphicsDeconflictor")],zQ);function sLe(t){return"declaredClass"in t}function xme(t){return"declaredClass"in t}function Tyt(t){return"declaredClass"in t}function Syt(t,e){return t?Tyt(t)?t:new ca({layer:e,sourceLayer:e,visible:t.visible,symbol:ie(t.symbol),attributes:ie(t.attributes),geometry:nLe(t.geometry)}):null}function nLe(t){return t==null?null:sLe(t)?t:ty(Eyt(t))}function Eyt(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:s}=t.spatialReference,n={wkid:e,wkt:i,wkt2:r,latestWkid:s};switch(t.type){case"point":{const{x:o,y:a,z:l,m:c}=t;return{x:o,y:a,z:l,m:c,spatialReference:n}}case"polygon":{const{rings:o,hasZ:a,hasM:l}=t;return{rings:Tme(o),hasZ:a,hasM:l,spatialReference:n}}case"polyline":{const{paths:o,hasZ:a,hasM:l}=t;return{paths:Tme(o),hasZ:a,hasM:l,spatialReference:n}}case"extent":{const{xmin:o,xmax:a,ymin:l,ymax:c,zmin:u,zmax:d,mmin:f,mmax:m,hasZ:g,hasM:y}=t;return{xmin:o,xmax:a,ymin:l,ymax:c,zmin:u,zmax:d,mmin:f,mmax:m,hasZ:g,hasM:y,spatialReference:n}}case"multipoint":{const{points:o,hasZ:a,hasM:l}=t;return{points:aLe(o)?oLe(o):o,hasZ:a,hasM:l,spatialReference:n}}default:return}}function Tme(t){return Cyt(t)?t.map(e=>oLe(e)):t}function oLe(t){return t.map(e=>Array.from(e))}function Cyt(t){for(const e of t)if(e.length!==0)return aLe(e);return!1}function aLe(t){return t.length>0&&(KL(t[0])||eD(t[0]))}function Myt(t,e){if(!t)return null;let i;if(xme(t)){if(e==null)return t.clone();if(xme(e))return e.copy(t)}return e!=null?(i=e,i.x=t.x,i.y=t.y,i.spatialReference=t.spatialReference,t.hasZ?(i.z=t.z,i.hasZ=t.hasZ):(i.z=void 0,i.hasZ=!1),t.hasM?(i.m=t.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=Zb(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0)),i}function kQt(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:s}=t,n={wkid:e,wkt:i,wkt2:r,latestWkid:s};return Ze.fromJSON(n)}const Hne="__begin__",qne="__end__",Ayt=new RegExp(Hne,"ig"),Pyt=new RegExp(qne,"ig"),Sme=new RegExp("^"+Hne,"i"),Eme=new RegExp(qne+"$","i"),yB='"',Oyt=yB+" + ",Ryt=" + "+yB;function $yt(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function Iyt(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function x6(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=$yt(t.labelExpression),e.type="conventional"),e}function Lyt(t){const e=x6(t);if(!e)return null;switch(e.type){case"conventional":return BQ(e.expression);case"arcade":return e.expression}return null}function Dyt(t){const e=x6(t);if(!e)return null;switch(e.type){case"conventional":return Fyt(e.expression);case"arcade":return Wne(e.expression)}return null}function BQ(t){let e;return t?(e=Xg(t,i=>Hne+'$feature["'+i+'"]'+qne),e=Sme.test(e)?e.replace(Sme,""):yB+e,e=Eme.test(e)?e.replace(Eme,""):e+yB,e=e.replaceAll(Ayt,Oyt).replaceAll(Pyt,Ryt)):e='""',e}const Nyt=/^\s*\{([^}]+)\}\s*$/i;function Fyt(t){const e=t==null?void 0:t.match(Nyt);return(e==null?void 0:e[1].trim())||null}const kyt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,Uyt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,Vyt=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;function Wne(t){if(!t)return null;let e=kyt.exec(t)||Uyt.exec(t);return e?e[1]||e[3]:(e=Vyt.exec(t),e?e[2]:null)}const Mq=()=>se.getLogger("esri.layers.support.labelFormatUtils"),Aq={type:"simple",evaluate:()=>null},zyt={getAttribute:(t,e)=>t.field(e)};async function Byt(t,e,i){if(!t||!t.symbol||!e)return Aq;const r=t.where,s=x6(t);let n;if(s.type==="arcade"){const o=await hnt(s.expression,i,e);if(o==null)return Aq;n={type:"arcade",evaluate(a,l){try{const c="attributes"in a?o.repurposeFeature(a):a;c.contextTimeZone=l??null;const u=o.evaluate({$view:{timeZone:l},$feature:c},o.services);if(u!=null)return u.toString()}catch(c){Mq().error(new G("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:c,feature:a,expression:s}))}return null},needsHydrationToEvaluate:()=>Wne(s.expression)==null}}else n={type:"simple",evaluate:o=>s.expression.replaceAll(/{[^}]*}/g,a=>{const l=a.slice(1,-1),c=e.get(l);if(!c)return a;let u=null;return"attributes"in o?o&&o.attributes&&(u=o.attributes[c.name]):u=o.field(c.name),u==null?"":jyt(u,c)})};if(r){let o;try{o=await fse(r,e)}catch(l){return Mq().error(new G("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:l})),Aq}const a=n.evaluate;n.evaluate=(l,c)=>{const u="attributes"in l?void 0:zyt;try{if(o.testFeature(l,u))return a(l,c)}catch(d){Mq().error(new G("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:l,error:d}))}return null}}return n}function jyt(t,e){if(t==null)return"";const i=e.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const s=t;for(const n of i.codedValues)if(n.code===s)return n.name}else if(i.type==="range"){const{max:s,min:n}=JPe(e),o=+t;if(n!=null&&s!=null&&n<=o&&o<=s)return i.name}}let r=t;return _se(e)?r=Mu(r,C1("short-date")):DG(e)&&(r=Xl(+r)),r||""}function lLe(t,e,i,r,s,n,o,a,l,c,u){const d=Xyt[u.mode];let f,m,g=0;if(ds(t,e,i,r,l.spatialReference,s,a))return d.requiresAlignment(u)?(g=d.applyElevationAlignmentBuffer(r,s,n,o,a,l,c,u),f=n,m=o):(f=r,m=s),ds(f,l.spatialReference,m,n,c.spatialReference,o,a)?g:void 0}function Nb(t,e,i,r,s){const n=(kz(t)?t.z:vPe(t)?t.array[t.offset+2]:t[2])||0;switch(i.mode){case"on-the-ground":{const o=Mg(e,t,"ground")??0;return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=Mg(e,t,"ground")??0,a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=Mg(e,t,"scene")??0,a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(n,r),a=Mg(e,t,"ground")??0;return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return void(s.z=0)}}function Gyt(t,e,i,r){return Nb(t,e,i,r,_M),_M.z}function qD(t,e,i){return e==="on-the-ground"&&i==="on-the-ground"?t.staysOnTheGround:e===i||e!=="on-the-ground"&&i!=="on-the-ground"?e==null||i==null?t.definedChanged:ks.UPDATE:t.onTheGroundChanged}function sp(t){return t==="relative-to-ground"||t==="relative-to-scene"}function Fb(t){return t!=="absolute-height"}function cLe(t,e,i,r,s){Nb(e,i,s,r,_M),uLe(t,_M.verticalDistanceToGround);const n=_M.sampledElevation,o=xn(Jyt,t.transformation);return o4[0]=e.x,o4[1]=e.y,o4[2]=_M.z,$h(e.spatialReference,o4,o,r.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function uLe(t,e){for(let i=0;i<t.geometries.length;++i){const r=t.geometries[i].getMutableAttribute(R.CENTEROFFSETANDDISTANCE);r&&r.data[3]!==e&&(r.data[3]=e,t.geometryVertexAttributeUpdated(t.geometries[i],R.CENTEROFFSETANDDISTANCE))}}function Hyt(t,e,i,r,s,n){let o=0;const a=n.spatialReference;e*=3,r*=3;for(let l=0;l<s;++l){const c=t[e],u=t[e+1],d=t[e+2],f=n.getElevation(c,u,d,a,"ground")??0;o+=f,i[r]=c,i[r+1]=u,i[r+2]=f,e+=3,r+=3}return o/s}function qyt(t,e,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,d=n.spatialReference;e*=3,r*=3;for(let f=0;f<s;++f){const m=t[e],g=t[e+1],y=t[e+2],v=n.getElevation(m,g,y,d,"ground")??0;l+=v,i[r]=m,i[r+1]=g,i[r+2]=u==null?y+v+c:v+c,e+=3,r+=3}return l/s}function Wyt(t,e,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,d=n.spatialReference;e*=3,r*=3;for(let f=0;f<s;++f){const m=t[e],g=t[e+1],y=t[e+2],v=n.getElevation(m,g,y,d,"scene")??0;l+=v,i[r]=m,i[r+1]=g,i[r+2]=u==null?y+v+c:v+c,e+=3,r+=3}return l/s}function Zyt(t){const e=t.meterUnitOffset,i=t.featureExpressionInfoContext;return e!==0||i!=null}function Yyt(t,e,i,r,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,r*=3;for(let u=0;u<s;++u){const d=t[e],f=t[e+1],m=t[e+2];i[r]=d,i[r+1]=f,i[r+2]=c==null?m+l:l,e+=3,r+=3}return 0}let WD=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var ks;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(ks||(ks={}));const Xyt={"absolute-height":{applyElevationAlignmentBuffer:Yyt,requiresAlignment:Zyt},"on-the-ground":{applyElevationAlignmentBuffer:Hyt,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:qyt,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:Wyt,requiresAlignment:()=>!0}},Jyt=ke(),_M=new WD,o4=E();function Zne(t){return t.mapPositions!=null}function hLe(t,e,i,r,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!Zne(l))continue;const{update:c,averageGeometrySampledElevation:u}=pLe(l,e,i,r,s);a+=u,c&&n.geometryVertexAttributeUpdated(l,R.POSITION)}return a/o.length}function yS(t,e,i,r,s,n){const o=t.stageObject,a=e.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(r(a,$c),uLe(o,$c.verticalDistanceToGround),l=$c.sampledElevation):(r(a,$c),e.mode!=="absolute-height"&&(l=$c.sampledElevation));const c=xn(Qyt,n??o.transformation),u=de(dLe,c[12],c[13],c[14]);Nr.TESTS_DISABLE_OPTIMIZATIONS?(Rc[0]=a.x,Rc[1]=a.y,Rc[2]=$c.z,$h(a.spatialReference,Rc,c,s.spatialReference)&&(n?xn(n,c):o.transformation=c)):s.setAltitudeOfTransformation($c.z,c);const d=Yne/s.unitInMeters;return(Math.abs(c[12]-u[0])>=d||Math.abs(c[13]-u[1])>=d||Math.abs(c[14]-u[2])>=d)&&(n?xn(n,c):o.transformation=c),l}const Qyt=ke();function Kyt(t,e,i,r,s){const n=t.graphics3DSymbolLayer.lodRenderer;if(n==null)return 0;const o=e.centerPointInElevationSR;r(o,$c);const a=e.mode!=="absolute-height"?$c.sampledElevation:0,l=n.instanceData,c=t.instanceIndex,u=t0t;l.getGlobalTransform(c,u);const d=de(dLe,u[12],u[13],u[14]);Nr.TESTS_DISABLE_OPTIMIZATIONS?(Rc[0]=o.x,Rc[1]=o.y,Rc[2]=$c.z,$h(o.spatialReference,Rc,u,s.spatialReference)&&l.setGlobalTransform(c,u)):s.setAltitudeOfTransformation($c.z,u);const f=Yne/s.unitInMeters;return(Nr.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(u[12]-d[0])>=f||Math.abs(u[13]-d[1])>=f||Math.abs(u[14]-d[2])>=f)&&l.setGlobalTransform(c,u),a}function e0t(t,e,i,r,s){const n=t.stageObject,o=n.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,u=!1;for(const d of o){if(!Zne(d))continue;const f=d.attributes.get(R.POSITION);if(f!==l){const{update:m,averageGeometrySampledElevation:g}=pLe(d,e,i,r,s);c=g,l=f,u=m}u&&n.geometryVertexAttributeUpdated(d,R.POSITION),a+=c}return a/o.length}const Yne=.01,Rc=E(),ed=E(),uE=E(),t0t=ke(),dLe=E(),$c=new WD;function pLe(t,e,i,r,s){let n=!1;const o=t.transformation,a=e.requiresSampledElevationInfo;ed[0]=o[12],ed[1]=o[13],ed[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(R.POSITION),c=l.data,u=l.size,d=c.length/u,f=new lse(t.mapPositions,i);let m=0,g=0;for(let y=0;y<d;y++){if(uE[0]=c[m],uE[1]=c[m+1],uE[2]=c[m+2],r(f,$c),a&&(g+=$c.sampledElevation),Nr.TESTS_DISABLE_OPTIMIZATIONS)c[m]=f.array[f.offset],c[m+1]=f.array[f.offset+1],c[m+2]=$c.z,ds(c,i,m,c,s.spatialReference,m,1),c[m]-=ed[0],c[m+1]-=ed[1],c[m+2]-=ed[2],n=!0;else{Rc[0]=c[m]+ed[0],Rc[1]=c[m+1]+ed[1],Rc[2]=c[m+2]+ed[2],s.setAltitude(Rc,$c.z),c[m]=Rc[0]-ed[0],c[m+1]=Rc[1]-ed[1],c[m+2]=Rc[2]-ed[2];const v=Yne/s.unitInMeters;(Math.abs(uE[0]-c[m])>=v||Math.abs(uE[1]-c[m+1])>=v||Math.abs(uE[2]-c[m+2])>=v)&&(n=!0)}m+=u,f.offset+=3}return g/=d,{update:n,averageGeometrySampledElevation:g}}function i0t(t){return!!t&&pP[t]!=null}function fLe(t){return 1/(pP[t]||1)}function r0t(){const t=Object.keys(pP);return t.sort(),t}const s0t=r0t(),n0t=()=>se.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function o0t(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function VQt(t){const e=t==null?void 0:t.expression;if(typeof e=="string"){const i=yLe(e);if(i!=null)return{cachedResult:i}}return null}async function zQt(t,e,i,r){const s=t==null?void 0:t.expression;if(typeof s!="string")return null;const n=yLe(s);if(n!=null)return{cachedResult:n};const o=await ry();Dt(i);const a=o.arcadeUtils,l=a.createSyntaxTree(s);return a.dependsOnView(l)?(r!=null&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function mLe(t,e,i){return t.arcadeUtils.createFeature(e.attributes,e.geometry,i)}function T6(t,e){if(t!=null&&!gLe(t)){if(!e||!t.arcade)return void n0t().errorOncePerTick("Arcade support required but not provided");const i=e;i._geometry&&(i._geometry=nLe(i._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function a0t(t){if(t!=null){if(gLe(t))return t.cachedResult;const e=t.arcade;let i=e==null?void 0:e.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof i!="number"&&(t.cachedResult=0,i=0),i}return 0}function BQt(t,e=!1){let i=t==null?void 0:t.featureExpressionInfo;const r=i==null?void 0:i.expression;return e||r==="0"||(i=null),i??null}const l0t={cachedResult:0};function gLe(t){return t.cachedResult!=null}function yLe(t){return t==="0"?0:null}let _B=class _Le{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=fLe(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:e+r}calculateOffsetRenderUnits(e){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=a0t(r)*this._metersPerElevationInfoUnit),i/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=i0t(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,i,r){if(e==null)return void(this._featureExpressionInfoContext=null);const s=e==null?void 0:e.arcade;s&&i!=null&&r!=null?(this._featureExpressionInfoContext=o0t(e),T6(this._featureExpressionInfoContext,mLe(s.modules,i,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const i=new _Le;return e!=null&&i.setFromElevationInfo(e),i}},c0t=class{constructor(e,i,r){this.graphic=e,this.renderingInfo=i,this.layer=r}};function Xne(t,e){if(t.type==="point")return uv(t,e,!1);if(sLe(t))switch(t.type){case"extent":return uv(t.center,e,!1);case"polygon":return uv(t.centroid,e,!1);case"polyline":return uv(Cme(t),e,!0);case"mesh":return uv(t.origin,e,!1)}else switch(t.type){case"extent":return uv(u0t(t),e,!0);case"polygon":return uv(h0t(t),e,!0);case"polyline":return uv(Cme(t),e,!0)}}function Cme(t){const e=t.paths[0];if(!e||e.length===0)return null;const i=QEe(e,mre(e)/2);return Zb(i[0],i[1],i[2],t.spatialReference)}function u0t(t){return Zb(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function h0t(t){const e=t.rings[0];if(!e||e.length===0)return null;const i=tCe(t.rings,!!t.hasZ);return Zb(i[0],i[1],i[2],t.spatialReference)}function uv(t,e,i){const r=i?t:Myt(t);return e&&t?BCe(t,r,e)?r:null:r}function GQt(t,e,i,r=0){if(t){e||(e=oi());const s=t;let n=.5*s.width*(i-1),o=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),_s(e,s.xmin-n-r,s.ymin-o-r,s.xmax+n+r,s.ymax+o+r),e}return null}function f3(t,e,i=null){const r=xD(Ud);return t!=null&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),e!=null?r[3]=e:t!=null&&t.length>3&&(r[3]=t[3]),i&&(r[0]*=i,r[1]*=i,r[2]*=i,r[3]*=i),r}function HQt(t,e,i,r,s,n=[0,0,0,0]){for(let o=0;o<3;++o)n[o]=(t==null?void 0:t[o])!=null?t[o]:(i==null?void 0:i[o])!=null?i[o]:s[o];return n[3]=e??r??s[3],n}function Mme(t=V0,e,i,r=1){const s=new Array(3);if(e==null||i==null)s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const u=l!=null,d=a===0&&!n&&!u,f=i[a];l==="symbol-value"||d?c=f!==0?e[a]/f:1:u&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=r;return zl(s)}function d0t(t){return t.isPrimitive!=null}function S6(t){return jQ(d0t(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function jQ(t){const e=i=>i==null||i>=0;return Array.isArray(t)?t.every(e):e(t)}function p0t(t,e,i,r=ke()){return t&&UA(r,r,-t/180*Math.PI),e&&kA(r,r,e/180*Math.PI),i&&Qj(r,r,i/180*Math.PI),r}function Jne(t,e,i){if(i.minDemResolution!=null)return i.minDemResolution;const r=ec(e),s=S2(t)*r,n=E2(t)*r,o=Qb(t)*(e.isGeographic?1:r);return s===0&&n===0&&o===0?i.minDemResolutionForPoints:.01*Math.max(s,n,o)}var vh;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(vh||(vh={}));let f0t=class{constructor(e,i,r){this.baseMaterial=e,this.edgeMaterials=i,this.properties=r}},Ty=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,i,r,s,n,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const i=e.stage;i.addMany(this._uniqueMaterials),i.addMany(this._uniqueGeometries),i.add(this.stageObject)}destroy(){var i,r;if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),(i=e.renderer.edgeView)==null||i.removeObject(this.stageObject),this.stageObject.dispose(),(r=this._sharedResource)==null||r.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,i){const{stageObject:r,_edgeState:s,_stageLayer:n}=this;if(s==null)return;const o=Ame(s.baseMaterial);let a=!1;for(const l of s.edgeMaterials)l.objectTransparency!==o&&(l.objectTransparency=o,a=!0);a&&this.resetEdgeObject(i),n.stage.renderer.withEdgeView(l=>{l.updateAllComponentOpacities(r,[e])})}slicePlaneEnabledChanged(e,i){const{stageObject:r,_edgeState:s,_stageLayer:n}=this;s!=null&&n.stage.renderer.withEdgeView(o=>{o.updateAllComponentMaterials(r,s.edgeMaterials,{hasSlicePlane:e},!i),s.properties.hasSlicePlane=e})}setVisibility(e){const{_edgeState:i,stageObject:r,_stageLayer:s}=this;s!=null&&this.visible!==e&&(this._visible=e,r.visible=e,e&&!this._addedToStage&&(s.add(r),this._addedToStage=!0),i!=null&&s.stage.renderer.withEdgeView(n=>{n.hasObject(r)?n.updateObjectVisibility(r,e):e&&this._addOrUpdateEdgeObject(i,n,!1)}))}get visible(){return this._visible}alignWithElevation(e,i,r,s){if(this.elevationAligner==null)return;r!=null&&T6(this.elevationContext.featureExpressionInfoContext,r);const n=(o,a)=>Nb(o,e,this.elevationContext,i,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,i),this.resetEdgeObject(s)}alignWithAbsoluteElevation(e,i,r){const s=(n,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,i),this.resetEdgeObject(r)}getCenterObjectSpace(e=E()){return ve(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=Xn()){const i=this.stageObject.boundingVolumeObjectSpace;return OOe(e,i.min),ROe(e,i.max),e}computeAttachmentOrigin(e){const i=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=i[12],e.render.origin[1]+=i[13],e.render.origin[2]+=i[14],e.render.num++;else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(Ly)&&(nt(Ly,Ly,i),Ee(e.render.origin,e.render.origin,Ly),e.render.num++)}async getProjectedBoundingBox(e,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=m0t,l=Mse(o)?1:a.length;for(let u=0;u<l;u++){const d=a[u];hv[0]=o[d[0]],hv[1]=o[d[1]],hv[2]=o[d[2]],nt(hv,hv,this.stageObject.transformation),$w[3*u]=hv[0],$w[3*u+1]=hv[1],$w[3*u+2]=hv[2]}if(!e($w,0,l))return null;Zr(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],$w[u+d]),o[d+3]=Math.max(o[d+3],$w[u+d]);c&&r.push({location:$w.slice(u,u+3),screenSpaceBoundingRect:c})}if(i!=null&&i.service&&this.elevationContext.mode!=="absolute-height"){Cf(o,Ly);const u=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let d=0;if(i.useViewElevation)d=i.service.getElevation(Ly[0],Ly[1],u)??0;else try{const f=Jne(o,i.service.spatialReference,i);d=await i.service.queryElevation(Ly[0],Ly[1],s,f,u)??0}catch{}POe(o,0,0,-this.alignedSampledElevation+d)}return o}addObjectState(e,i){e===d_.Highlight&&i.addObject(this.stageObject,this.stageObject.highlight()),e===d_.MaskOccludee&&i.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){const{_edgeState:i,stageObject:r,_stageLayer:s,_visible:n}=this;i!=null&&s.stage.renderer.withEdgeView(o=>{n?this._addOrUpdateEdgeObject(i,o,e):o.removeObject(r)})}_addOrUpdateEdgeObject(e,i,r){const s=Ame(e.baseMaterial);for(const n of e.edgeMaterials)n.objectTransparency=s;i.addOrUpdateObject3D(this.stageObject,e.edgeMaterials,e.properties,!r).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}};function Ame(t){return t.isVisible()?t.parameters.transparent?vh.TRANSPARENT:vh.OPAQUE:vh.INVISIBLE}const $w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],hv=E(),Ly=E(),m0t=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let vLe=class{constructor(e,i=null){this.labelText=i,this.elevationOffset=e??0}};const bLe=3,GQ=3,wLe=10;let xLe=class{constructor(e,i=null){this.geometry=e,this.textures=i}},TLe=class{constructor(e,i,r){this.components=e,this.minScreenSpaceRadius=i,this.pivotOffset=r;const s=this.geometries;this.numVertices=s.reduce((n,o)=>n+o.attributes.get(R.POSITION).indices.length,0)}get geometries(){return h2(this.components.map(e=>e.geometry))}},SLe=class{constructor(e){this.levels=e,this.levels.sort((i,r)=>i.minScreenSpaceRadius===r.minScreenSpaceRadius?i.numVertices-r.numVertices:i.minScreenSpaceRadius-r.minScreenSpaceRadius)}};function a4(t){const e=[];return t.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry.material))),h2(e)}function Pme(t){const e=new Array;return t.levels.forEach(i=>i.components.forEach(r=>{r.textures!=null&&e.push(...r.textures)})),h2(e)}function Ome(t){const e=new Array;return t.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry))),h2(e)}function g0t(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function ELe(t,e){const i=(r,s,n=!1)=>new SLe(r.map(o=>{const a=s(o.tesselation);return n&&Uht(a),new TLe([new xLe(a)],o.minScreenSpaceRadius)}));switch(t){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>Dht(e,.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Cht(e,1));case"cone":return i(Pq,r=>Xpe(e,1,.5,r,!1),!0);case"inverted-cone":return i(Pq,r=>Xpe(e,1,.5,r,!0),!0);case"cylinder":return i(Pq,r=>Fht(e,1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Lht(e,1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Oht(e,1),!0);default:return}}const Pq=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let $d=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new CLe}},Qne=class extends $d{constructor(e){super(e),this.estimated=!0}},y0t=class extends $d{constructor(e,i){super(i),this.numComplexities=e}},_0t=class extends Qne{constructor(e,i){super(i),this.numComplexities=e}},CLe=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}};function v0t(t){return t.type==="fill"}function b0t(t){return t.type==="extrude"}function Kne(t,e,i=0){const r=Ne(t,0,T0t);for(let s=0;s<4;s++)e[i+s]=Math.floor(256*S0t(r*w0t[s]))}function eoe(t,e=0){let i=0;for(let r=0;r<4;r++)i+=t[e+r]*x0t[r];return i}const w0t=[1,256,65536,16777216],x0t=[1/256,1/65536,1/16777216,1/4294967296],T0t=eoe(new Uint8ClampedArray([255,255,255,255]));function S0t(t){return t-Math.floor(t)}var qn;function E0t(t){switch(t){case"multiply":default:return qn.Multiply;case"ignore":return qn.Ignore;case"replace":return qn.Replace;case"tint":return qn.Tint}}function MLe(t,e,i){if(t==null||e===qn.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=Ne(Math.round(t[3]*vB),0,vB),s=r===0||e===qn.Tint?0:e===qn.Replace?C0t:M0t;i[0]=Ne(Math.round(t[0]*hE),0,hE),i[1]=Ne(Math.round(t[1]*hE),0,hE),i[2]=Ne(Math.round(t[2]*hE),0,hE),i[3]=r+s}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(qn||(qn={}));const hE=255,vB=85,C0t=vB,M0t=2*vB;function ALe(t){t.vertex.code.add(T`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${T.int(qn.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${T.int(qn.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${T.int(qn.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${T.int(qn.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}let bB=class extends Vs{constructor(e,i){super(e,"vec4",Zi.Draw,(r,s,n)=>r.setUniform4fv(e,i(s,n)))}},A0t=class extends Vs{constructor(e,i){super(e,"int",Zi.Draw,(r,s,n)=>r.setUniform1i(e,i(s,n)))}};var Hg;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(Hg||(Hg={}));const toe=429496.7296;function P0t(t,e){Kne(t/toe*.5+.5,e)}function O0t(t,e){switch(e.componentData){case Hg.Varying:return R0t(t,e);case Hg.Uniform:return $0t(t,e);case Hg.COUNT:return;default:e.componentData}}function R0t(t,e){const{vertex:i,fragment:r}=t;i.include(rm),i.uniforms.add(new zg("componentColorTex",n=>n.componentParameters.texture.texture)),t.attributes.add(R.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const s=e.output===j.ObjectAndLayerIdColor;s&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(ALe),i.constants.add("elevationScale","float",2*toe),i.constants.add("stride","float",le("enable-feature:objectAndLayerId-rendering")?3:2),i.code.add(T`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),i.code.add(T`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${s?T`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:T`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),r.code.add(T`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?T`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function $0t(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new bB("externalColor",n=>n.componentParameters.externalColor)),r.uniforms.add(new A0t("externalColorMixMode",n=>n.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),i.code.add(T`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);const s=e.output===j.ObjectAndLayerIdColor;r.code.add(T`
  void readExternalColor(out vec4 color, out int colorMixMode) {
    color = vExternalColor;
    colorMixMode = externalColorMixMode;
  }

  void outputObjectAndLayerIdColor() {
    ${s?T`fragColor = vec4(0,0,0,0);`:""}
 }
`)}function aO(t,e){switch(e.normalType){case sr.Compressed:t.attributes.add(R.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(T`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case sr.Attribute:t.attributes.add(R.NORMAL,"vec3"),t.vertex.code.add(T`vec3 normalModel() {
return normal;
}`);break;case sr.ScreenDerivative:t.fragment.code.add(T`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case sr.COUNT:case sr.Ground:}}var sr;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(sr||(sr={}));function nKt(t,e){const i=t.vertex;i.include(rm),t.include(aO,e),i.uniforms.add(new et("distanceFalloffFactor",r=>r.distanceFalloffFactor)),i.code.add(T`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add(new zg("componentDataTex",r=>r.componentDataTexture)),t.attributes.add(R.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentVerticalOffsetFieldOffset","float",2),i.constants.add("componentFieldCount","float",3),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("verticalOffsetScale","float",2*toe),i.code.add(T`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
      float texSize = float(textureSize(componentDataTex, 0).x);
      float colIndex = mod(fieldIndex, texSize);
      float rowIndex = floor(fieldIndex / texSize);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      vec3 normal;
      vec3 normal2;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
      vec3 normal = normalModel();
      vec3 normal2 = ${e.silhouette?T`decompressNormal(normal2Compressed)`:T`normal`};

      vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
      vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
      float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        normal, normal2,
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),e.legacy?i.code.add(T`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new Xz("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),i.code.add(T`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(R.NORMAL2COMPRESSED,"vec2"),i.code.add(T`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(normalize(data.normal + data.normal2));
}`)):i.code.add(T`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(data.normal);
}`),e.legacy?i.code.add(T`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(ine,e),i.uniforms.add(new cp("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new Xz("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Dh("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new Dh("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Wt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new Wt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)),i.code.add(T`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?T`normalize(transformWorldFromModelTL + rotatedModelPosition);`:T`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new us("transformProjFromView",(r,s)=>s.camera.projectionMatrix)),i.code.add(T`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(T`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function oKt(t){return t===_P.Sketch||t===_P.Mixed}var _P,Rme;(function(t){t[t.Solid=0]="Solid",t[t.Sketch=1]="Sketch",t[t.Mixed=2]="Mixed",t[t.COUNT=3]="COUNT"})(_P||(_P={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(Rme||(Rme={}));function I0t(t){return t&&t.enabled&&(b0t(t)||v0t(t))&&t.edges!=null}function L0t(t){return t&&t.enabled&&t.edges||null}function PLe(t,e){return D0t(L0t(t),e)}function D0t(t,e){if(t==null)return null;const i=t.color!=null?dL(Qe.toUnitRGBA(t.color)):ii(0,0,0,0),r=wn(t.size),s=wn(t.extensionLength);switch(t.type){case"solid":return N0t({color:i,size:r,extensionLength:s,...e});case"sketch":return F0t({color:i,size:r,extensionLength:s,...e});default:return}}function N0t(t){return{...k0t,...t,type:_P.Solid}}function F0t(t){return{...U0t,...t,type:_P.Sketch}}const k0t={color:ii(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:vh.OPAQUE,hasSlicePlane:!1},U0t={color:ii(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:vh.OPAQUE,hasSlicePlane:!1};function OLe(t,e){const i=t.fragment;switch(i.code.add(T`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case Cs.None:i.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Cs.View:i.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Cs.WindingOrder:i.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case Cs.COUNT:}}var Cs;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(Cs||(Cs={}));let ZD=class{constructor(e=!1,i=!0){this.isVerticalRay=e,this.normalRequired=i}};const l4=Xn();function RLe(t,e,i,r,s,n){if(!t.visible)return;const o=Ii(NLe,r,i),a=(c,u,d)=>{n(c,d,u,!1)},l=new ZD(!1,e.options.normalRequired);if(t.boundingInfo){vt(t.type===Fs.Mesh);const c=e.tolerance;$Le(t.boundingInfo,i,o,c,s,l,a)}else{const c=t.attributes.get(R.POSITION),u=c.indices;DLe(i,o,0,u.length/3,u,c.data,c.stride,s,l,a)}}const V0t=E();function $Le(t,e,i,r,s,n,o){if(t==null)return;const a=Z0t(i,V0t);if(OOe(l4,t.bbMin),ROe(l4,t.bbMax),s!=null&&s.applyToAabb(l4),roe(l4,e,a,r)){const{primitiveIndices:l,position:c}=t,u=l?l.length:c.indices.length/3;if(u>Y0t){const d=t.getChildren();if(d!==void 0){for(const f of d)$Le(f,e,i,r,s,n,o);return}}B0t(e,i,0,u,c.indices,c.data,c.stride,l,s,n,o)}}const UT=E();function ILe(t,e,i,r,s,n,o,a,l){const{data:c,stride:u}=n;DLe(t,Ii(NLe,e,t),i,r,s,c,u,o,a,l)}function LLe(t,e,i,r,s,n,o,a,l,c=null,u=0){const d=t[0],f=t[1],m=t[2],g=e[0],y=e[1],v=e[2];for(let b=i;b<r;++b){const w=u+(c?c[b]:b),x=3*w,S=o*s[x],C=n[S],M=n[S+1],O=n[S+2],D=o*s[x+1],U=n[D],k=n[D+1],H=n[D+2],V=o*s[x+2],X=U-C,q=k-M,Z=H-O,ye=n[V]-C,L=n[V+1]-M,N=n[V+2]-O,z=y*N-L*v,W=v*ye-N*g,J=g*L-ye*y,K=X*z+q*W+Z*J;if(Math.abs(K)<=noe)continue;const ne=d-C,we=f-M,Ie=m-O,je=ne*z+we*W+Ie*J;if(K>0){if(je<0||je>K)continue}else if(je>0||je<K)continue;const ut=we*Z-q*Ie,ot=Ie*X-Z*ne,at=ne*q-X*we,tt=g*ut+y*ot+v*at;if(K>0){if(tt<0||je+tt>K)continue}else if(tt>0||je+tt<K)continue;const rt=(ye*ut+L*ot+N*at)/K;rt>=0&&l(rt,w,a?ioe(X,q,Z,ye,L,N,UT):null)}}function z0t(t,e,i,r,s,n,o,a,l,c,u,d=null,f=0){const m=t[0],g=t[1],y=t[2],v=e[0],b=e[1],w=e[2];for(let x=i;x<r;++x){const S=f+(d?d[x]:x),C=3*S,M=o*s[C],O=n[M],D=n[M+1],U=n[M+2],k=o*s[C+1],H=n[k],V=n[k+1],X=n[k+2],q=o*s[C+2],Z=n[q],ye=n[q+1],L=n[q+2],N=U-l,z=a/Math.sqrt(O*O+D*D+N*N),W=O+O*z,J=D+D*z,K=U+N*z,ne=X-l,we=a/Math.sqrt(H*H+V*V+ne*ne),Ie=H+H*we,je=V+V*we,ut=X+ne*we,ot=L-l,at=a/Math.sqrt(Z*Z+ye*ye+ot*ot),tt=Ie-W,rt=je-J,li=ut-K,Y=Z+Z*at-W,ee=ye+ye*at-J,re=L+ot*at-K,Ae=b*re-ee*w,ae=w*Y-re*v,fe=v*ee-Y*b,Me=tt*Ae+rt*ae+li*fe;if(Math.abs(Me)<=noe)continue;const Oe=m-W,be=g-J,xe=y-K,_e=Oe*Ae+be*ae+xe*fe;if(Me>0){if(_e<0||_e>Me)continue}else if(_e>0||_e<Me)continue;const Le=be*li-rt*xe,Fe=xe*tt-li*Oe,lt=Oe*rt-tt*be,ct=v*Le+b*Fe+w*lt;if(Me>0){if(ct<0||_e+ct>Me)continue}else if(ct>0||_e+ct<Me)continue;const Vt=(Y*Le+ee*Fe+re*lt)/Me;Vt>=0&&u(Vt,S,c?ioe(tt,rt,li,Y,ee,re,UT):null)}}function B0t(t,e,i,r,s,n,o,a,l,c,u){const d=t[0],f=t[1],m=t[2],g=e[0],y=e[1],v=e[2],{normalRequired:b}=c;for(let w=i;w<r;++w){const x=a[w],S=3*x,C=o*s[S];let M=n[C],O=n[C+1],D=n[C+2];const U=o*s[S+1];let k=n[U],H=n[U+1],V=n[U+2];const X=o*s[S+2];let q=n[X],Z=n[X+1],ye=n[X+2];l!=null&&([M,O,D]=l.applyToVertex(M,O,D,w),[k,H,V]=l.applyToVertex(k,H,V,w),[q,Z,ye]=l.applyToVertex(q,Z,ye,w));const L=k-M,N=H-O,z=V-D,W=q-M,J=Z-O,K=ye-D,ne=y*K-J*v,we=v*W-K*g,Ie=g*J-W*y,je=L*ne+N*we+z*Ie;if(Math.abs(je)<=noe)continue;const ut=d-M,ot=f-O,at=m-D,tt=ut*ne+ot*we+at*Ie;if(je>0){if(tt<0||tt>je)continue}else if(tt>0||tt<je)continue;const rt=ot*z-N*at,li=at*L-z*ut,Y=ut*N-L*ot,ee=g*rt+y*li+v*Y;if(je>0){if(ee<0||tt+ee>je)continue}else if(ee>0||tt+ee<je)continue;const re=(W*rt+J*li+K*Y)/je;re>=0&&u(re,x,b?ioe(L,N,z,W,J,K,UT):null)}}function DLe(t,e,i,r,s,n,o,a,l,c){const u=e,d=X0t,f=Math.abs(u[0]),m=Math.abs(u[1]),g=Math.abs(u[2]),y=f>=m?f>=g?0:2:m>=g?1:2,v=y,b=u[v]<0?2:1,w=(y+b)%3,x=(y+(3-b))%3,S=u[w]/u[v],C=u[x]/u[v],M=1/u[v],O=j0t,D=G0t,U=H0t,{normalRequired:k}=l;for(let H=i;H<r;++H){const V=3*H,X=o*s[V];de(d[0],n[X+0],n[X+1],n[X+2]);const q=o*s[V+1];de(d[1],n[q+0],n[q+1],n[q+2]);const Z=o*s[V+2];de(d[2],n[Z+0],n[Z+1],n[Z+2]),a&&(ve(d[0],a.applyToVertex(d[0][0],d[0][1],d[0][2],H)),ve(d[1],a.applyToVertex(d[1][0],d[1][1],d[1][2],H)),ve(d[2],a.applyToVertex(d[2][0],d[2][1],d[2][2],H))),Ii(O,d[0],t),Ii(D,d[1],t),Ii(U,d[2],t);const ye=O[w]-S*O[v],L=O[x]-C*O[v],N=D[w]-S*D[v],z=D[x]-C*D[v],W=U[w]-S*U[v],J=U[x]-C*U[v],K=W*z-J*N,ne=ye*J-L*W,we=N*L-z*ye;if((K<0||ne<0||we<0)&&(K>0||ne>0||we>0))continue;const Ie=K+ne+we;if(Ie===0)continue;const je=K*(M*O[v])+ne*(M*D[v])+we*(M*U[v]);if(je*Math.sign(Ie)<0)continue;const ut=je/Ie;ut>=0&&c(ut,H,k?q0t(d):null)}}const j0t=E(),G0t=E(),H0t=E();function ioe(t,e,i,r,s,n,o){return de(wB,t,e,i),de(xB,r,s,n),ft(o,wB,xB),Ce(o,o),o}function q0t(t){return Ii(wB,t[1],t[0]),Ii(xB,t[2],t[0]),ft(UT,wB,xB),Ce(UT,UT),UT}const wB=E(),xB=E();function W0t(t,e,i){return de(i,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function Z0t(t,e){return de(e,1/t[0],1/t[1],1/t[2])}function roe(t,e,i,r){return soe(t,e,i,r,1/0)}function soe(t,e,i,r,s){const n=(t[0]-r-e[0])*i[0],o=(t[3]+r-e[0])*i[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(t[1]-r-e[1])*i[1],u=(t[4]+r-e[1])*i[1];if(l=Math.min(l,Math.max(c,u)),l<0||(a=Math.max(a,Math.min(c,u)),a>l))return!1;const d=(t[2]-r-e[2])*i[2],f=(t[5]+r-e[2])*i[2];return l=Math.min(l,Math.max(d,f)),!(l<0)&&(a=Math.max(a,Math.min(d,f)),!(a>l)&&a<s)}const Y0t=1e3,noe=1e-7,NLe=E(),X0t=[E(),E(),E()];let lO=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.attributes.get(R.POSITION).indices.length}write(e,i,r,s,n){j3e(r,this.vertexBufferLayout,e,i,s,n)}};function E6(t,e){switch(e.normalType){case sr.Attribute:case sr.Compressed:t.include(aO,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new Xz("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new cp("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)),t.vertex.code.add(T`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case sr.Ground:t.include(sA,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(T`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?T`normalize(vPositionWorldCameraRelative);`:T`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case sr.ScreenDerivative:t.vertex.code.add(T`void forwardNormal() {}`);break;default:e.normalType;case sr.COUNT:}}let FLe=class extends iht{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Yr()}},kLe=class extends rht{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Yr(),this.toMapSpace=ci()}};const ooe={func:br.LESS},TB={func:br.ALWAYS},oy={mask:255},ULe={mask:0},J0t=t=>({function:{func:br.NOTEQUAL,ref:t,mask:t},operation:{fail:bs.KEEP,zFail:bs.KEEP,zPass:bs.KEEP}}),Q0t=t=>({function:{func:br.ALWAYS,ref:t,mask:t},operation:{fail:bs.KEEP,zFail:bs.KEEP,zPass:bs.REPLACE}}),nw={function:{func:br.ALWAYS,ref:kc.OutlineVisualElementMask,mask:kc.OutlineVisualElementMask},operation:{fail:bs.KEEP,zFail:bs.KEEP,zPass:bs.ZERO}},kb={function:{func:br.ALWAYS,ref:kc.OutlineVisualElementMask,mask:kc.OutlineVisualElementMask},operation:{fail:bs.KEEP,zFail:bs.KEEP,zPass:bs.REPLACE}},VLe={function:{func:br.EQUAL,ref:kc.OutlineVisualElementMask,mask:kc.OutlineVisualElementMask},operation:{fail:bs.KEEP,zFail:bs.KEEP,zPass:bs.KEEP}},zLe={function:{func:br.NOTEQUAL,ref:kc.OutlineVisualElementMask,mask:kc.OutlineVisualElementMask},operation:{fail:bs.KEEP,zFail:bs.KEEP,zPass:bs.KEEP}};function BLe({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return t==null&&e==null&&s==null&&(n==null||$o(n,On))&&o==null&&(r==null||r===1)&&(i==null||i===1)}function hKt({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return t==null&&e==null&&s==null&&(n==null||$o(n,On))&&o==null&&(r==null||r===1)&&(i==null||i===1||i===0)}const C6=[1,1,.5],aoe=[0,.6,.2],K0t=[0,1,.2];function jLe(t){t.vertex.code.add(T`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let cO=class extends Vs{constructor(e,i){super(e,"int",Zi.Pass,(r,s,n)=>r.setUniform1i(e,i(s,n)))}};function GLe(t,e){e.hasSymbolColors?(t.include(ALe),t.attributes.add(R.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(T`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new cO("colorMixMode",i=>F3e[i.colorMixMode])),t.vertex.code.add(T`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function D2(t,e){e.hasVertexColors?(t.attributes.add(R.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(T`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(T`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(T`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function loe(t){t.code.add(T`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)}function M6(t,e){switch(e.output){case j.Shadow:case j.ShadowHighlight:case j.ShadowExcludeHighlight:case j.ViewshedShadow:t.fragment.include(loe),t.fragment.code.add(T`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`)}}function e_t(t){t.fragment.code.add(T`
    #define discardOrAdjustAlpha(color) { if (color.a < ${T.float(ea)}) { discard; } }
  `)}let HLe=class extends Vs{constructor(e,i){super(e,"float",Zi.Draw,(r,s,n)=>r.setUniform1f(e,i(s,n)))}};function vM(t,e){qLe(t,e,new et("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function t_t(t,e){qLe(t,e,new HLe("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function qLe(t,e,i){const r=t.fragment;switch(e.alphaDiscardMode!==Rr.Mask&&e.alphaDiscardMode!==Rr.MaskBlend||r.uniforms.add(i),e.alphaDiscardMode){case Rr.Blend:return t.include(e_t);case Rr.Opaque:r.code.add(T`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Rr.Mask:r.code.add(T`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Rr.MaskBlend:t.fragment.code.add(T`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function WLe(t,e){const{vertex:i,fragment:r}=t,s=e.hasColorTexture&&e.alphaDiscardMode!==Rr.Opaque;switch(e.output){case j.Depth:Nc(i,e),t.include(al,e),t.include(bn,e),t.include(Af,e),s&&r.uniforms.add(new wt("tex",n=>n.texture)),i.code.add(T`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),t.include(vM,e),r.code.add(T`
          void main(void) {
            discardBySlice(vpos);
            ${s?T`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
          }
        `);break;case j.Shadow:case j.ShadowHighlight:case j.ShadowExcludeHighlight:case j.ViewshedShadow:case j.ObjectAndLayerIdColor:Nc(i,e),t.include(al,e),t.include(Af,e),t.include(e_,e),t.include(M6,e),t.include(bn,e),t.include(L2,e),XG(t),t.varyings.add("depth","float"),s&&r.uniforms.add(new wt("tex",n=>n.texture)),i.code.add(T`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();
}`),t.include(vM,e),r.code.add(T`
          void main(void) {
            discardBySlice(vpos);
            ${s?T`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===j.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:T`outputDepth(depth);`}
          }
        `);break;case j.Normal:{Nc(i,e),t.include(al,e),t.include(aO,e),t.include(E6,e),t.include(Af,e),t.include(e_,e),s&&r.uniforms.add(new wt("tex",o=>o.texture)),e.normalType===sr.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const n=e.normalType===sr.Attribute||e.normalType===sr.Compressed;i.code.add(T`
          void main(void) {
            vpos = getVertexInLocalOriginSpace();

            ${n?T`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:T`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(bn,e),t.include(vM,e),r.code.add(T`
          void main() {
            discardBySlice(vpos);
            ${s?T`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===sr.ScreenDerivative?T`vec3 normal = screenDerivativeNormal(vPositionView);`:T`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case j.Highlight:Nc(i,e),t.include(al,e),t.include(Af,e),t.include(e_,e),s&&r.uniforms.add(new wt("tex",n=>n.texture)),i.code.add(T`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),t.include(bn,e),t.include(vM,e),t.include(rw,e),r.code.add(T`
          void main() {
            discardBySlice(vpos);
            ${s?T`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function ZLe(t,e){const i=t.fragment;e.hasVertexTangents?(t.attributes.add(R.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===Cs.WindingOrder?i.code.add(T`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(T`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):i.code.add(T`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==vs.None&&(t.include(Wse,e),i.uniforms.add(e.pbrTextureBindType===Zi.Pass?new wt("normalTexture",r=>r.textureNormal):new zg("normalTexture",r=>r.textureNormal)),e.hasNormalTextureTransform&&(i.uniforms.add(new jr("scale",r=>r.scale??mG)),i.uniforms.add(new cp("normalTextureTransformMatrix",r=>r.normalTextureTransformMatrix??_2))),i.code.add(T`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;`),e.hasNormalTextureTransform&&i.code.add(T`mat3 normalTextureRotation = mat3(normalTextureTransformMatrix[0][0]/scale[0], normalTextureTransformMatrix[0][1]/scale[1], 0.0,
normalTextureTransformMatrix[1][0]/scale[0], normalTextureTransformMatrix[1][1]/scale[1], 0.0,
0.0, 0.0, 0.0 );
rawNormal.xy = (normalTextureRotation * vec3(rawNormal.x, rawNormal.y, 1.0)).xy;`),i.code.add(T`return tangentSpace * rawNormal;
}`))}let xC=class extends Ue{constructor(e){super(e),this.view=null,this.consumes={required:[]},this.produces="composite-color",this._context=null,this._dirty=!0}initialize(){this.addHandles([te(()=>this.view.ready,e=>{var i;e&&((i=this.view._stage)==null||i.renderer.addRenderNode(this))},$t)])}destroy(){var e,i;(i=(e=this.view._stage)==null?void 0:e.renderer)==null||i.removeRenderNode(this)}render(){throw new G("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view._stage.renderView.renderingContext.gl}acquireOutputFramebuffer(){var r,s,n;const e=(s=(r=this._frameBuffer)==null?void 0:r.getTexture())==null?void 0:s.descriptor,i=this.view._stage.renderer.fboCache.acquire((e==null?void 0:e.width)??640,(e==null?void 0:e.height)??480,this.produces);return(n=i.fbo)==null||n.initializeAndBind(),i}bindRenderTarget(){var e,i;return(i=(e=this._frameBuffer)==null?void 0:e.fbo)==null||i.initializeAndBind(),this._frameBuffer}requestRender(e){var i;e===ar.UPDATE&&((i=this.view._stage)==null||i.renderView.requestRender(e)),this._dirty=!0}resetWebGLState(){var e;this.renderingContext.resetState(),this.renderingContext.bindFramebuffer((e=this._frameBuffer)==null?void 0:e.fbo)}get fboCache(){return this.view._stage.renderer.fboCache}get bindParameters(){return this._context.bindParameters}get renderingContext(){return this.view._stage.renderView.renderingContext}updateAnimation(){return!!this._dirty&&(this._dirty=!1,!0)}doRender(e,i){this._context=i,this._frameBuffer=e.find(({name:r})=>r===this.produces);try{return this.render(e)}finally{this._frameBuffer=null}}};h([p({constructOnly:!0})],xC.prototype,"view",void 0),h([p({constructOnly:!0})],xC.prototype,"consumes",void 0),h([p()],xC.prototype,"produces",void 0),xC=h([I("esri.views.3d.webgl.RenderNode")],xC);const YD=xC,YLe=3e5,SB=5e5;let XLe=class extends Vs{constructor(e,i){super(e,"vec2",Zi.Draw,(r,s,n,o)=>r.setUniform2fv(e,i(s,n,o)))}};const Oq=4;function JLe(){const t=new Hi,e=t.fragment;t.include(ka);const i=(Oq+1)/2,r=1/(2*i*i);return e.include(fy),e.uniforms.add(new wt("depthMap",s=>s.depthTexture),new zg("tex",s=>s.colorTexture),new XLe("blurSize",s=>s.blurSize),new et("projScale",(s,n)=>{const o=Cr(n.camera.eye,n.camera.center);return o>5e4?Math.max(0,s.projScale-(o-5e4)):s.projScale})),e.code.add(T`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${T.float(r)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),t.outputs.add("fragBlur","float"),e.code.add(T`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${T.int(Oq)}; r <= ${T.int(Oq)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragBlur = b / w_total;
    }
  `),t}const i_t=Object.freeze(Object.defineProperty({__proto__:null,build:JLe},Symbol.toStringTag,{value:"Module"}));let QLe=class KLe extends Qi{initializeProgram(e){return new Ki(e.rctx,KLe.shader.get().build(),Ai)}initializePipeline(){return Jt({colorWrite:ui})}};QLe.shader=new qi(i_t,()=>ce(()=>Promise.resolve().then(()=>yHt),void 0));const r_t="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";let s_t=class extends Fr{constructor(){super(...arguments),this.projScale=1}},n_t=class extends s_t{constructor(){super(...arguments),this.intensity=1}},o_t=class extends Fr{},a_t=class extends o_t{constructor(){super(...arguments),this.blurSize=mt()}};function XD(t){t.fragment.uniforms.add(new ji("projInfo",(e,i)=>l_t(i.camera))),t.fragment.uniforms.add(new jr("zScale",(e,i)=>c_t(i.camera))),t.fragment.code.add(T`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function l_t(t){const e=t.projectionMatrix;return e[11]===0?_s($me,2/(t.fullWidth*e[0]),2/(t.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):_s($me,-2/(t.fullWidth*e[0]),-2/(t.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const $me=ci();function c_t(t){return t.projectionMatrix[11]===0?Li(Ime,0,1):Li(Ime,1,0)}const Ime=mt(),Lme=16;function eDe(){const t=new Hi,e=t.fragment;return t.include(ka),t.include(XD),e.include(fy),e.uniforms.add(new et("radius",(i,r)=>A6(r.camera))).code.add(T`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(T`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new wt("normalMap",i=>i.normalTexture),new wt("depthMap",i=>i.depthTexture),new et("projScale",i=>i.projScale),new wt("rnm",i=>i.noiseTexture),new jr("rnmScale",(i,r)=>Li(Dme,r.camera.fullWidth/i.noiseTexture.descriptor.width,r.camera.fullHeight/i.noiseTexture.descriptor.height)),new et("intensity",i=>i.intensity),new jr("screenSize",(i,r)=>Li(Dme,r.camera.fullWidth,r.camera.fullHeight))),t.outputs.add("fragOcclusion","float"),e.code.add(T`
    void main(void) {
      float depth = depthFromTexture(depthMap, uv);

      // Early out if depth is out of range, such as in the sky
      if (depth >= 1.0 || depth <= 0.0) {
        fragOcclusion = 1.0;
        return;
      }

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      if(norm4.a != 1.0) {
        fragOcclusion = 1.0;
        return;
      }
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;

      float currentPixelDepth = linearizeDepth(depth);
      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      float sum = 0.0;
      vec3 tapPixelPos;

      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${T.int(Lme)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        // don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap);

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${T.int(Lme)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

      fragOcclusion = A;
    }
  `),t}function A6(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const Dme=mt(),u_t=Object.freeze(Object.defineProperty({__proto__:null,build:eDe,getRadius:A6},Symbol.toStringTag,{value:"Module"}));let tDe=class iDe extends Qi{initializeProgram(e){return new Ki(e.rctx,iDe.shader.get().build(),Ai)}initializePipeline(){return Jt({colorWrite:ui})}};tDe.shader=new qi(u_t,()=>ce(()=>Promise.resolve().then(()=>_Ht),void 0));const F$=2;let Vx=class extends YD{constructor(e){super(e),this.consumes={required:["normals"]},this.produces="ssao",this.isEnabled=()=>!1,this._enableTime=0,this._passParameters=new n_t,this._drawParameters=new a_t}initialize(){const e=Uint8Array.from(atob(r_t),r=>r.charCodeAt(0)),i=new Xr;i.wrapMode=Mi.CLAMP_TO_EDGE,i.pixelFormat=Ht.RGB,i.wrapMode=Mi.REPEAT,i.hasMipmap=!0,i.width=32,i.height=32,this._passParameters.noiseTexture=new Er(this.renderingContext,i,e),this._ssaoTechnique=this.techniques.acquire(tDe),this._blurTechnique=this.techniques.acquire(QLe),this.addHandles(te(()=>this.isEnabled(),()=>this._enableTime=0))}destroy(){this._passParameters.noiseTexture=Ut(this._passParameters.noiseTexture),this._blurTechnique.release(),this._ssaoTechnique.release()}render(e){const i=this.bindParameters,r=e.find(({name:C})=>C==="normals"),s=r==null?void 0:r.getTexture(),n=r==null?void 0:r.getTexture(cP),o=this.fboCache,a=i.camera,l=a.fullViewport[2],c=a.fullViewport[3],u=Math.round(l/F$),d=Math.round(c/F$);if(!this._ssaoTechnique.compiled||!this._blurTechnique.compiled)return this._enableTime=performance.now(),this.requestRender(),o.acquire(u,d,"ssao",ss.RED);this._enableTime===0&&(this._enableTime=performance.now());const f=this.renderingContext,m=this.view.qualitySettings.fadeDuration,g=a.relativeElevation,y=Ne((SB-g)/(SB-YLe),0,1),v=m>0?Math.min(m,performance.now()-this._enableTime)/m:1,b=v*y;this._passParameters.normalTexture=s,this._passParameters.depthTexture=n,this._passParameters.projScale=1/a.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*h_t/A6(a)**6*b;const w=o.acquire(l,c,"ssao input",ss.RG);f.unbindTexture(w.fbo.colorTexture),f.bindFramebuffer(w.fbo),f.setViewport(0,0,l,c),f.bindTechnique(this._ssaoTechnique,i,this._passParameters,this._drawParameters),f.screen.draw();const x=o.acquire(u,d,"ssao blur",ss.RED);f.unbindTexture(x.fbo.colorTexture),f.bindFramebuffer(x.fbo),this._drawParameters.colorTexture=w.getTexture(),Li(this._drawParameters.blurSize,0,F$/c),f.bindTechnique(this._blurTechnique,i,this._passParameters,this._drawParameters),f.setViewport(0,0,u,d),f.screen.draw(),w.release();const S=o.acquire(u,d,"ssao",ss.RED);return f.unbindTexture(S.fbo.colorTexture),f.bindFramebuffer(S.fbo),f.setViewport(0,0,l,c),f.setClearColor(1,1,1,0),f.clear(zr.COLOR_BUFFER_BIT),this._drawParameters.colorTexture=x.getTexture(),Li(this._drawParameters.blurSize,F$/l,0),f.bindTechnique(this._blurTechnique,i,this._passParameters,this._drawParameters),f.setViewport(0,0,u,d),f.screen.draw(),f.setViewport4fv(a.fullViewport),x.release(),v<1&&this.requestRender(ar.UPDATE),S}};h([p()],Vx.prototype,"consumes",void 0),h([p()],Vx.prototype,"produces",void 0),h([p({constructOnly:!0})],Vx.prototype,"techniques",void 0),h([p({constructOnly:!0})],Vx.prototype,"isEnabled",void 0),Vx=h([I("esri.views.3d.webgl-engine.effects.ssao.SSAO")],Vx);const h_t=.5;function JD(t,e){const i=t.fragment;e.receiveAmbientOcclusion?(i.uniforms.add(new wt("ssaoTex",(r,s)=>{var n;return(n=s.ssao)==null?void 0:n.getTexture()})),i.constants.add("blurSizePixelsInverse","float",1/F$),i.code.add(T`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):i.code.add(T`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function d_t(t){const e=t.fragment.code;e.add(T`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(T`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(T`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function coe(t,e){const i=t.fragment.code;t.include(ND),e.pbrMode!==At.Normal&&e.pbrMode!==At.Schematic&&e.pbrMode!==At.Simplified&&e.pbrMode!==At.TerrainWithWater||(i.add(T`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(T`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==At.Normal&&e.pbrMode!==At.Schematic||(t.include(d_t),i.add(T`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(T`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(T`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(T`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function p_t(t,e){const i=t.fragment.code;t.include(ND),i.add(T`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),i.add(T`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(T`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(T`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(T`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function QD(t){t.constants.add("ambientBoostFactor","float",L$e)}function uO(t){t.uniforms.add(new et("lightingGlobalFactor",(e,i)=>i.lighting.globalFactor))}function e2(t,e){const i=t.fragment;switch(t.include(JD,e),e.pbrMode!==At.Disabled&&t.include(coe,e),t.include(Xse,e),t.include(ND),i.code.add(T`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===At.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),QD(i),uO(i),C_(i),i.code.add(T`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?T`normalize(vPosWorld)`:T`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),my(i),i.code.add(T`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case At.Disabled:case At.WaterOnIntegratedMesh:case At.Water:t.include(Gz),i.code.add(T`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case At.Normal:case At.Schematic:i.code.add(T`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(T`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?i.uniforms.add(new Bg("hasFillLights",(r,s)=>s.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(T`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add(new et("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new et("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)),i.code.add(T`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(T`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission == vec3(0.0) ? _emission : pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode!==At.Schematic||e.hasColorTexture?T`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:T`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case At.Simplified:case At.TerrainWithWater:t.include(Gz),i.code.add(T`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case At.COUNT:}}let f_t=class extends Vs{constructor(e,i,r){super(e,"mat4",Zi.Draw,(s,n,o,a)=>s.setUniformMatrix4fv(e,i(n,o,a)),r)}},HQ=class extends Vs{constructor(e,i,r){super(e,"mat4",Zi.Pass,(s,n,o)=>s.setUniformMatrix4fv(e,i(n,o)),r)}},m_t=class extends Fr{constructor(){super(...arguments),this.modelTransformation=Wr}},uoe=class extends m_t{constructor(){super(...arguments),this.origin=E()}};function KD(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new HQ("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),rDe(t))}function vP(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new f_t("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),rDe(t))}function rDe(t){const e=t.fragment;e.include(loe),e.uniforms.add(new wt("shadowMap",(i,r)=>r.shadowMap.depthTexture),new cO("numCascades",(i,r)=>r.shadowMap.numCascades),new ji("cascadeDistances",(i,r)=>r.shadowMap.cascadeDistances)),e.code.add(T`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMap, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMap);
}`)}function g_t(t,e){e.hasColorTextureTransform?(t.vertex.uniforms.add(new cp("colorTextureTransformMatrix",i=>i.colorTextureTransformMatrix??_2)),t.varyings.add("colorUV","vec2"),t.vertex.code.add(T`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(T`void forwardColorUV(){}`)}function y_t(t,e){e.hasNormalTextureTransform&&e.textureCoordinateType!==vs.None?(t.vertex.uniforms.add(new cp("normalTextureTransformMatrix",i=>i.normalTextureTransformMatrix??_2)),t.varyings.add("normalUV","vec2"),t.vertex.code.add(T`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(T`void forwardNormalUV(){}`)}function __t(t,e){e.hasEmissionTextureTransform&&e.textureCoordinateType!==vs.None?(t.vertex.uniforms.add(new cp("emissiveTextureTransformMatrix",i=>i.emissiveTextureTransformMatrix??_2)),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(T`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(T`void forwardEmissiveUV(){}`)}function v_t(t,e){e.hasOcclusionTextureTransform&&e.textureCoordinateType!==vs.None?(t.vertex.uniforms.add(new cp("occlusionTextureTransformMatrix",i=>i.occlusionTextureTransformMatrix??_2)),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(T`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(T`void forwardOcclusionUV(){}`)}function b_t(t,e){e.hasMetallicRoughnessTextureTransform&&e.textureCoordinateType!==vs.None?(t.vertex.uniforms.add(new cp("metallicRoughnessTextureTransformMatrix",i=>i.metallicRoughnessTextureTransformMatrix??_2)),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(T`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(T`void forwardMetallicRoughnessUV(){}`)}function hoe(t){t.include(by),t.code.add(T`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${T.int(qn.Multiply)}) {
        return allMixed;
      }
      if (mode == ${T.int(qn.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${T.int(qn.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${T.int(qn.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${T.int(qn.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function sDe(t){const e=new Hi,{vertex:i,fragment:r,varyings:s}=e;if(Nc(i,t),e.include(FD),s.add("vpos","vec3"),e.include(e_,t),e.include(z$e,t),e.include(R3e,t),e.include(g_t,t),t.output===j.Color){e.include(y_t,t),e.include(__t,t),e.include(v_t,t),e.include(b_t,t),Qf(i,t),e.include(aO,t),e.include(al,t);const n=t.normalType===sr.Attribute||t.normalType===sr.Compressed;n&&t.offsetBackfaces&&e.include(jLe),e.include(ZLe,t),e.include(E6,t),t.instancedColor&&e.attributes.add(R.INSTANCECOLOR,"vec4"),s.add("vPositionLocal","vec3"),e.include(Af,t),e.include(sO,t),e.include(GLe,t),e.include(D2,t),i.uniforms.add(new ji("externalColor",o=>o.externalColor)),s.add("vcolorExt","vec4"),t.multipassEnabled&&s.add("depth","float"),i.code.add(T`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${T.float(ea)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = getVertexInLocalOriginSpace();
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${n?T`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${n&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        forwardColorUV();
        forwardNormalUV();
        forwardEmissiveUV();
        forwardOcclusionUV();
        forwardMetallicRoughnessUV();
      }
    `),e.include(bn,t),e.include(e2,t),e.include(JD,t),e.include(vM,t),e.include(t.instancedDoublePrecision?KD:vP,t),e.include(xy,t),Qf(r,t),r.uniforms.add(i.uniforms.get("localOrigin"),new Wt("ambient",o=>o.ambient),new Wt("diffuse",o=>o.diffuse),new et("opacity",o=>o.opacity),new et("layerOpacity",o=>o.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new wt("tex",o=>o.texture)),e.include(Yse,t),e.include(coe,t),r.include(hoe),e.include(OLe,t),QD(r),uO(r),my(r),t.transparencyPassType===pt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),r.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===sr.ScreenDerivative?T`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:T`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===At.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?T`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?T`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${t.hasNormalTextureTransform?T`normalUV`:"vuv0"});`:T`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?T`normalize(posWorld);`:T`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?T`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===At.Normal||t.pbrMode===At.Schematic?T`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?T`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:T`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===pt.ColorAlpha?T`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}
      }
    `)}return e.include(WLe,t),e}const w_t=Object.freeze(Object.defineProperty({__proto__:null,build:sDe},Symbol.toStringTag,{value:"Module"}));let x_t=class extends FLe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=zl(C6),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=Br.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=Ge(0,0,0),this.instancedDoublePrecision=!1,this.normalType=sr.Attribute,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Ge(.2,.2,.2),this.diffuse=Ge(.8,.8,.8),this.externalColor=ii(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=E(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=XS.Less,this.textureAlphaMode=Rr.Blend,this.textureAlphaCutoff=gB,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=er.Occlude,this.isDecoration=!1}},T_t=class extends kLe{constructor(){super(...arguments),this.origin=E(),this.slicePlaneLocalOrigin=this.origin}},doe=class nDe extends Qi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Xe.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,i.textureCoordinateType=i.hasColorTexture||i.hasMetallicRoughnessTexture||i.hasEmissionTexture||i.hasOcclusionTexture||i.hasNormalTexture?vs.Default:vs.None,i.objectAndLayerIdColorInstanced=i.instanced}initializeProgram(e){return this._initializeProgram(e,nDe.shader)}_initializeProgram(e,i){return new Ki(e.rctx,i.get().build(this.configuration),Ai)}_makePipeline(e,i){const r=this.configuration,s=e===pt.NONE,n=e===pt.FrontFace;return Jt({blending:r.output===j.Color&&r.transparent?s?Ru:$_(e):null,culling:E_t(r)?WG(r.cullFace):null,depthTest:{func:sw(e,S_t(r.customDepthTest))},depthWrite:(s||n)&&r.writeDepth?Nu:null,drawBuffers:r.output===j.Depth?{buffers:[no.NONE]}:I_(e),colorWrite:ui,stencilWrite:r.hasOccludees?oy:null,stencilTest:r.hasOccludees?i?kb:nw:null,polygonOffset:s||n?null:w6(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};function S_t(t){return t===XS.Lequal?br.LEQUAL:br.LESS}function E_t(t){return t.cullFace!==Br.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}doe.shader=new qi(w_t,()=>ce(()=>Promise.resolve().then(()=>vHt),void 0));let ri=class extends Uc{constructor(){super(...arguments),this.output=j.Color,this.alphaDiscardMode=Rr.Opaque,this.doubleSidedMode=Cs.None,this.pbrMode=At.Disabled,this.cullFace=Br.None,this.transparencyPassType=pt.NONE,this.normalType=sr.Attribute,this.textureCoordinateType=vs.None,this.customDepthTest=XS.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};h([B({count:j.COUNT})],ri.prototype,"output",void 0),h([B({count:Rr.COUNT})],ri.prototype,"alphaDiscardMode",void 0),h([B({count:Cs.COUNT})],ri.prototype,"doubleSidedMode",void 0),h([B({count:At.COUNT})],ri.prototype,"pbrMode",void 0),h([B({count:Br.COUNT})],ri.prototype,"cullFace",void 0),h([B({count:pt.COUNT})],ri.prototype,"transparencyPassType",void 0),h([B({count:sr.COUNT})],ri.prototype,"normalType",void 0),h([B({count:vs.COUNT})],ri.prototype,"textureCoordinateType",void 0),h([B({count:XS.COUNT})],ri.prototype,"customDepthTest",void 0),h([B()],ri.prototype,"spherical",void 0),h([B()],ri.prototype,"hasVertexColors",void 0),h([B()],ri.prototype,"hasSymbolColors",void 0),h([B()],ri.prototype,"hasVerticalOffset",void 0),h([B()],ri.prototype,"hasSlicePlane",void 0),h([B()],ri.prototype,"hasSliceHighlight",void 0),h([B()],ri.prototype,"hasColorTexture",void 0),h([B()],ri.prototype,"hasMetallicRoughnessTexture",void 0),h([B()],ri.prototype,"hasEmissionTexture",void 0),h([B()],ri.prototype,"hasOcclusionTexture",void 0),h([B()],ri.prototype,"hasNormalTexture",void 0),h([B()],ri.prototype,"hasScreenSizePerspective",void 0),h([B()],ri.prototype,"hasVertexTangents",void 0),h([B()],ri.prototype,"hasOccludees",void 0),h([B()],ri.prototype,"multipassEnabled",void 0),h([B()],ri.prototype,"hasModelTransformation",void 0),h([B()],ri.prototype,"offsetBackfaces",void 0),h([B()],ri.prototype,"vvSize",void 0),h([B()],ri.prototype,"vvColor",void 0),h([B()],ri.prototype,"receiveShadows",void 0),h([B()],ri.prototype,"receiveAmbientOcclusion",void 0),h([B()],ri.prototype,"textureAlphaPremultiplied",void 0),h([B()],ri.prototype,"instanced",void 0),h([B()],ri.prototype,"instancedColor",void 0),h([B()],ri.prototype,"objectAndLayerIdColorInstanced",void 0),h([B()],ri.prototype,"instancedDoublePrecision",void 0),h([B()],ri.prototype,"doublePrecisionRequiresObfuscation",void 0),h([B()],ri.prototype,"writeDepth",void 0),h([B()],ri.prototype,"transparent",void 0),h([B()],ri.prototype,"enableOffset",void 0),h([B()],ri.prototype,"cullAboveGround",void 0),h([B()],ri.prototype,"snowCover",void 0),h([B()],ri.prototype,"hasColorTextureTransform",void 0),h([B()],ri.prototype,"hasEmissionTextureTransform",void 0),h([B()],ri.prototype,"hasNormalTextureTransform",void 0),h([B()],ri.prototype,"hasOcclusionTextureTransform",void 0),h([B()],ri.prototype,"hasMetallicRoughnessTextureTransform",void 0),h([B({constValue:!1})],ri.prototype,"occlusionPass",void 0),h([B({constValue:!0})],ri.prototype,"hasVvInstancing",void 0),h([B({constValue:!1})],ri.prototype,"useCustomDTRExponentForWater",void 0),h([B({constValue:!1})],ri.prototype,"supportsTextureAtlas",void 0),h([B({constValue:!0})],ri.prototype,"useFillLights",void 0);function oDe(t){const e=new Hi,{vertex:i,fragment:r,varyings:s}=e;return Nc(i,t),e.include(FD),s.add("vpos","vec3"),e.include(e_,t),e.include(z$e,t),e.include(R3e,t),t.output===j.Color&&(Qf(e.vertex,t),e.include(aO,t),e.include(al,t),t.offsetBackfaces&&e.include(jLe),t.instancedColor&&e.attributes.add(R.INSTANCECOLOR,"vec4"),s.add("vNormalWorld","vec3"),s.add("localvpos","vec3"),t.multipassEnabled&&s.add("depth","float"),e.include(Af,t),e.include(sO,t),e.include(GLe,t),e.include(D2,t),i.uniforms.add(new ji("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),i.code.add(T`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${T.float(ea)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = getVertexInLocalOriginSpace();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.multipassEnabled?T`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===j.Color&&(e.include(bn,t),e.include(e2,t),e.include(JD,t),e.include(vM,t),e.include(t.instancedDoublePrecision?KD:vP,t),e.include(xy,t),Qf(e.fragment,t),C_(r),QD(r),uO(r),r.uniforms.add(i.uniforms.get("localOrigin"),i.uniforms.get("view"),new Wt("ambient",n=>n.ambient),new Wt("diffuse",n=>n.diffuse),new et("opacity",n=>n.opacity),new et("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new wt("tex",n=>n.texture)),e.include(Yse,t),e.include(coe,t),r.include(hoe),t.transparencyPassType===pt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),my(r),r.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?T`terrainDepthTest(depth);`:""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===At.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?T`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?T`albedo = mix(albedo, vec3(1), 0.9);`:T``}
        ${T`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===At.Normal||t.pbrMode===At.Schematic?t.spherical?T`vec3 normalGround = normalize(vpos + localOrigin);`:T`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:T``}
        ${t.pbrMode===At.Normal||t.pbrMode===At.Schematic?T`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?T`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:T`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===pt.ColorAlpha?T`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `)),e.include(WLe,t),e}const C_t=Object.freeze(Object.defineProperty({__proto__:null,build:oDe},Symbol.toStringTag,{value:"Module"}));let aDe=class lDe extends doe{initializeConfiguration(e,i){super.initializeConfiguration(e,i),i.hasMetallicRoughnessTexture=!1,i.hasEmissionTexture=!1,i.hasOcclusionTexture=!1,i.hasNormalTexture=!1,i.hasModelTransformation=!1,i.normalType=sr.Attribute,i.doubleSidedMode=Cs.WindingOrder,i.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,lDe.shader)}};aDe.shader=new qi(C_t,()=>ce(()=>Promise.resolve().then(()=>bHt),void 0));let em=class extends iw{constructor(e){super(e,P_t),this.supportsEdges=!0,this.produces=new Map([[Pe.OPAQUE_MATERIAL,i=>(a3(i)||rA(i))&&!this.parameters.transparent],[Pe.TRANSPARENT_MATERIAL,i=>(a3(i)||rA(i))&&this.parameters.transparent&&this.parameters.writeDepth],[Pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>(a3(i)||rA(i))&&this.parameters.transparent&&!this.parameters.writeDepth]]),this._configuration=new ri,this._vertexBufferLayout=O_t(this.parameters)}isVisibleForOutput(e){return e!==j.Shadow&&e!==j.ShadowExcludeHighlight&&e!==j.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{hasInstancedColor:i,hasVertexColors:r,hasSymbolColors:s,vvColor:n}=e,o=e.colorMixMode==="replace",a=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0,c=i||n||s;return r&&c?o||a:r?o?l:a:c?o||a:o?l:a}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?Br.None:this.parameters.cullFace,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,e===j.Color&&(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=Cs.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Cs.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Cs.WindingOrder:Cs.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=this.parameters.receiveAmbientOcclusion&&i.ssao!=null,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?At.Schematic:At.Normal:At.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<v6,this._configuration.snowCover=this.hasSnowCover(i),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,i,r,s,n,o){if(this.parameters.verticalOffset!=null){const a=r.camera;de($q,i[12],i[13],i[14]);let l=null;switch(r.viewingMode){case Xe.Global:l=Ce(Nme,$q);break;case Xe.Local:l=ve(Nme,I_t)}let c=0;const u=Re(L_t,$q,a.eye),d=Ve(u),f=he(u,u,1/d);let m=null;this.parameters.screenSizePerspective&&(m=Te(l,f)),c+=D3e(a,d,this.parameters.verticalOffset,m??0,this.parameters.screenSizePerspective),he(l,l,c),ta(Rq,l,r.transform.inverseRotation),s=Re(R_t,s,Rq),n=Re($_t,n,Rq)}RLe(e,r,s,n,FY(r.verticalOffset),o)}createGLMaterial(e){return new M_t(e)}createBufferWriter(){return new lO(this._vertexBufferLayout)}},M_t=class extends Zse{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===j.Color&&(this._updateShadowState(e),this._updateOccludeeState(e));const i=this._material.parameters;this.updateTexture(i.textureId);const r=e.camera.viewInverseTransposeMatrix;return de(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(i.treeRendering?aDe:doe,e)}},A_t=class extends x_t{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const P_t=new A_t;function O_t(t){const e=As().vec3f(R.POSITION);return t.normalType===sr.Compressed?e.vec2i16(R.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(R.NORMAL),t.hasVertexTangents&&e.vec4f(R.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(R.UV0),t.hasVertexColors&&e.vec4u8(R.COLOR),t.hasSymbolColors&&e.vec4u8(R.SYMBOLCOLOR),le("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(R.OBJECTANDLAYERIDCOLOR),e}const R_t=E(),$_t=E(),I_t=Ge(0,0,1),Nme=E(),Rq=E(),$q=E(),L_t=E(),cDe=new Qne({});function RKt(t){return t.type==="web-style"?cDe:poe(t.symbolLayers.toArray().map(e=>uDe(t,e)))}function poe(t){let e=0,i=0,r=0,s=!1,n=0;const o=new CLe;for(const a of t)a!=null&&(e+=a.verticesPerFeature,i+=a.verticesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,s=s||a.estimated,++n);return s?new _0t(n,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:o}):new y0t(n,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:o})}function $Kt(t){const e=poe(t);return e.numComplexities>0&&(e.verticesPerFeature/=e.numComplexities,e.verticesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities),e}const Iq={};function uDe(t,e){var s,n;const i=hDe(t,e),r=I0t(e)?2:0;switch(e.type){case"extrude":return new $d({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:r,memory:i});case"fill":if(t.type==="mesh-3d")return new $d({drawCallsPerFeature:r,memory:i});if(e.outline!=null&&e.outline.size>0)return new $d({verticesPerFeature:-12,verticesPerCoordinate:9,memory:i});case"water":return new $d({verticesPerFeature:-6,verticesPerCoordinate:3,memory:i});case"line":return new $d({verticesPerFeature:-6,verticesPerCoordinate:6,memory:i});case"object":return(s=e.resource)!=null&&s.href?new Qne({verticesPerFeature:100,memory:i}):{...D_t(((n=e.resource)==null?void 0:n.primitive)??kOe),memory:i};case"path":{let o=0,a=0;switch(e.profile){case"circle":o=wLe;break;case"quad":o=4;break;default:return void(e.profile,void 0)}switch(e.join){case"round":a=bLe;break;case"miter":case"bevel":a=1;break;default:return}const l=2*o,c=o*a*2,u=c+l;let d=-2*c-l;switch(e.cap){case"none":break;case"butt":case"square":d+=2*(o-1);break;case"round":d+=2*(o*(GQ-1)*2+o);break;default:return}return new $d({verticesPerFeature:d,verticesPerCoordinate:u,memory:i})}case"text":case"icon":return new $d({verticesPerFeature:6,memory:i});default:return}}function hDe(t,e){const i=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?nc.EXTRUDE_EDGES:nc.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?nc.FILL_OUTLINE:nc.FILL;case"water":return nc.FILL;case"line":return e.join==="round"?nc.LINE_ROUND:nc.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return nc.PATH_ROUND_CIRCLE;case"quad":return nc.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return nc.PATH_MITER_CIRCLE;case"quad":return nc.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return i?nc.OBJECT_POINT:nc.OBJECT_POLYGON;case"icon":case"text":return i?nc.ICON_POINT:nc.ICON_POLYGON;default:return}}function D_t(t){const e=Iq[t];if(e)return e;const i=dDe(ELe(t,new em({})).levels);return Iq[t]=new $d({verticesPerFeature:i}),Iq[t]}function dDe(t){return t.reduce((e,i,r)=>e+i.numVertices*(1/10**r),0)/t.reduce((e,i,r)=>e+1/10**r,0)}const nc={ICON_POINT:{bytesPerFeature:2379.8272296852992,bytesPerFeatureLabel:852.246235,resourceBytes:0,draped:{bytesPerFeature:1868.2382921559424,bytesPerFeatureLabel:839.205415}},ICON_POLYGON:{bytesPerFeature:2957.8429876524656,bytesPerFeatureLabel:862.5307816666666,resourceBytes:0,draped:{bytesPerFeature:2579.7767085451133,bytesPerFeatureLabel:856.9298550000001}},OBJECT_POINT:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999,resourceBytes:0,draped:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999}},OBJECT_POLYGON:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998,resourceBytes:0,draped:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998}},LINE_MITER:{bytesPerFeature:3081.208408220661,bytesPerFeatureLabel:858.6749016666668,resourceBytes:0,draped:{bytesPerFeature:2682.57863388475,bytesPerFeatureLabel:844.6118016666666}},LINE_ROUND:{bytesPerFeature:3209.3236242927915,bytesPerFeatureLabel:858.1810416666667,resourceBytes:0,draped:{bytesPerFeature:2687.6256038096126,bytesPerFeatureLabel:849.578535}},PATH_MITER_CIRCLE:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415,resourceBytes:0,draped:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415}},PATH_ROUND_CIRCLE:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001,resourceBytes:0,draped:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001}},PATH_MITER_QUAD:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355,resourceBytes:0,draped:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355}},PATH_ROUND_QUAD:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955,resourceBytes:0,draped:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955}},FILL:{bytesPerFeature:3147.43349219103,bytesPerFeatureLabel:850.7598550000001,resourceBytes:0,draped:{bytesPerFeature:2673.7898488975106,bytesPerFeatureLabel:846.6459950000002}},FILL_OUTLINE:{bytesPerFeature:4565.099993465867,bytesPerFeatureLabel:855.334515,resourceBytes:0,draped:{bytesPerFeature:3904.46969705314,bytesPerFeatureLabel:844.7081016666667}},EXTRUDE:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333,resourceBytes:0,draped:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333}},EXTRUDE_EDGES:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335,resourceBytes:0,draped:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335}}};var cn;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(cn||(cn={}));let foe=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=yh.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,i){return this._loadStatus===yh.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===yh.FAILED?(i&&i(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=yh.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=yh.FAILED,!os(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(e,i).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=Jl(this._abortController):this._loadStatus===yh.LOADING&&(this._loadStatus=yh.FAILED),this._loader=null}};var yh;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(yh||(yh={}));const dv=()=>se.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let Sy=class extends foe{constructor(e,i,r,s){super(r.schedule),this.symbol=e,this.symbolLayer=i,this._context=r,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this._materials=[],this.usedMemory=0,this.logger=dv(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new _B,this.complexity=this.computeComplexity(),this.ignoreDrivers=s.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=Fme(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const i=this._drivenProperties,r=Fme(e);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,i,r,s){const n=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${s} geometry failed to be created`;n?!this._logGeometryValidationWarnings(i,r,s)&&o&&o.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&dv().warnOncePerTick(`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):dv().warnOncePerTick(`${a} (failed to project geometry to view spatial reference)`)}_logGeometryValidationWarnings(e,i,r){const s=`${r} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(dv().warnOncePerTick(`${s} (no ${i} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(dv().warnOncePerTick(`${s} (${i} should be defined as a 2D array)`),!0)}_validateGeometry(e,i=null,r=null){if(i!=null&&!i.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;switch(e.type){case"point":{const s=e;if(!isFinite(s.x)||!isFinite(s.y))return dv().warn("point coordinate is not a valid number, graphic skipped"),!1;break}case"polygon":cXe(e)&&dv().warnOncePerTick("Fixed a non-closed polygon ring.")}return!0}_defaultElevationInfoNoZ(){return N_t}_defaultElevationInfoZ(){return F_t}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,i=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,i=new _B){const r=e.geometry,s=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,i.mode=this.getGeometryElevationMode(r,s),i.offsetMeters=this._elevationContext.meterUnitOffset??s.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";n&&(i.mode="relative-to-ground",i.offsetMeters=0);const o=n?l0t:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(o,e,this._context.layer),i}prepareSymbolLayerPatch(e){}updateGeometry(e,i){return!1}updateTransform(e,i,r,s){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,i=kme){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(e!=null?r*=e.a:i.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(e,i=kme){const r=this._getCombinedOpacity(e,i);if(this._drivenProperties.color)return f3(null,r);const s=e!=null?Qe.toUnitRGB(e):V0;return f3(s,r)}_getVertexOpacityAndColor(e,i=null){const r=this._drivenProperties.color?e.color:null,s=this._drivenProperties.opacity?e.opacity:null,n=f3(r,s);return i&&(n[0]*=i,n[1]*=i,n[2]*=i,n[3]*=i),n}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return uDe(this.symbol,this.symbolLayer)}globalPropertyChanged(e,i,r){switch(e){case"opacity":return this.layerOpacityChanged(i,r),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,s)!==ks.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,i,r){let s=ks.UPDATE;return e.forEach(n=>{const o=i(n);if(o!=null){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else s=ks.RECREATE}),s}applyRendererDiff(e,i){return cn.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const i=this._fastUpdates.visualVariables,r=i.size?kf(i.size.field,e):0,s=i.color?kf(i.color.field,e):0,n=i.opacity?kf(i.opacity.field,e):0;return ii(r,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&dv().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var i,r,s,n,o,a,l,c;return{size:((r=(i=this._fastUpdates)==null?void 0:i.visualVariables.size)==null?void 0:r.field)??null,color:((n=(s=this._fastUpdates)==null?void 0:s.visualVariables.color)==null?void 0:n.field)??null,opacity:((a=(o=this._fastUpdates)==null?void 0:o.visualVariables.opacity)==null?void 0:a.field)??null,rotation:((c=(l=this._fastUpdates)==null?void 0:l.visualVariables.rotation)==null?void 0:c.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function Fme(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(i=>{switch(i.type){case"color":if(e.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const s=i.stops[r].color;s&&(e.opacity=!0,s.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const N_t={mode:"on-the-ground",offset:0,unit:"meters"},F_t={mode:"absolute-height",offset:0,unit:"meters"},kme={hasIntrinsicColor:!1};let ow=class extends VD{get geometries(){return this._geometries}get transformation(){return this._transformation??Wr}set transformation(e){this._transformation=xn(this._transformation??ke(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?xn(this._shaderTransformation??ke(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(e={}){super(),this.type=Fs.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new pDe),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){vt(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const i=this._geometries.splice(e,1)[0];i&&(this._emit("geometryRemoved",{object:this,geometry:i}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,i,r=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:i,sync:r}),Ult(i)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const i of this._geometries)i.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new eB(d_.MaskOccludee);for(const i of this._geometries)i.occludees=pQ(i.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const i of this._geometries)i.occludees=fQ(i.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new eB(d_.Highlight);for(const i of this._geometries)i.highlights=pQ(i.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const i of this._geometries)i.highlights=fQ(i.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,i){return gr(i,this.transformation,e.transformation)}getCombinedShaderTransformation(e,i=ke()){return gr(i,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new Ume,this._validateBoundingVolume(this._bvWorldSpace,m3.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new Ume,this._validateBoundingVolume(this._bvObjectSpace,m3.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,i){const r=i===m3.ObjectSpace;for(const s of this._geometries){const n=s.boundingInfo;n&&k_t(n,e,r?s.transformation:this.getCombinedShaderTransformation(s))}xr(e.bounds,e.min,e.max,.5);for(const s of this._geometries){const n=s.boundingInfo;if(n==null)continue;const o=r?s.transformation:this.getCombinedShaderTransformation(s),a=XA(o);nt(Vme,n.center,o);const l=Cr(Vme,e.bounds),c=n.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){var i;const e=(i=this._bvWorldSpace)==null?void 0:i.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,i){this._parentLayer&&this._parentLayer.events.emit(e,i)}get test(){}},pDe=class{constructor(){this.min=Ge(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Ge(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},Ume=class extends pDe{constructor(){super(...arguments),this.bounds=dn()}};function k_t(t,e,i){const r=t.bbMin,s=t.bbMax;if(tG(i)){const n=de(U_t,i[12],i[13],i[14]);Ee(Gu,r,n),Ee(wp,s,n);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Gu[o]),e.max[o]=Math.max(e.max[o],wp[o])}else if(nt(Gu,r,i),$o(r,s))for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],Gu[n]),e.max[n]=Math.max(e.max[n],Gu[n]);else{nt(wp,s,i);for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],Gu[n],wp[n]),e.max[n]=Math.max(e.max[n],Gu[n],wp[n]);for(let n=0;n<3;++n){ve(Gu,r),ve(wp,s),Gu[n]=s[n],wp[n]=r[n],nt(Gu,Gu,i),nt(wp,wp,i);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Gu[o],wp[o]),e.max[o]=Math.max(e.max[o],Gu[o],wp[o])}}}const U_t=E(),Gu=E(),wp=E(),Vme=E();var m3;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(m3||(m3={}));function moe(t,e,i,r,s){if(mDe(t,e))return null;i.localOrigin=goe(t,e);const n=new ow({geometries:[i],castShadow:!1,layerUid:t.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0});return{object:n,sampledElevation:cLe(n,e,t.elevationProvider,t.renderCoordsHelper,r)}}function fDe(t,e,i,r){return mDe(e,i)?null:cLe(t,i,e.elevationProvider,e.renderCoordsHelper,r)}function mDe(t,e){const i=t.clippingExtent;return!!i&&(pl(e,G1,t.elevationProvider.spatialReference),!Ese(i,G1))}function t2(t,e,i){const r=t.elevationContext,s=i.spatialReference;pl(e,G1,s),r.centerPointInElevationSR=Zb(G1[0],G1[1],e.hasZ?G1[2]:0,s??null)}function _S(t){switch(t.type){case"point":return t;case"polygon":case"extent":return Xne(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const i=QEe(e,mre(e)/2);return Zb(i[0],i[1],i[2],t.spatialReference)}case"mesh":return t.origin}return null}function goe(t,e){return pl(e,G1,t.renderCoordsHelper.spatialReference),t.localOriginFactory.getOrigin(G1)}const G1=E();function gDe(){return new Float32Array(2)}function V_t(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function pg(t,e){const i=new Float32Array(2);return i[0]=t,i[1]=e,i}function z_t(t,e){return new Float32Array(t,e,2)}function yDe(){return gDe()}function _De(){return pg(1,1)}function vDe(){return pg(1,0)}function bDe(){return pg(0,1)}const wDe=yDe(),xDe=_De(),B_t=vDe(),j_t=bDe();Object.freeze(Object.defineProperty({__proto__:null,ONES:xDe,UNIT_X:B_t,UNIT_Y:j_t,ZEROS:wDe,clone:V_t,create:gDe,createView:z_t,fromValues:pg,ones:_De,unitX:vDe,unitY:bDe,zeros:yDe},Symbol.toStringTag,{value:"Module"}));function TDe(t){const e=new Hi,{vertex:i,fragment:r}=e;return i.include(y6),e.include(L3e,t),e.include(bn,t),e.attributes.add(R.UV0,"vec2"),i.uniforms.add(new ji("viewport",(s,n)=>n.camera.fullViewport),new et("lineSize",(s,n)=>s.size>0?Math.max(1,s.size)*n.camera.pixelRatio:0),new jr("pixelToNDC",(s,n)=>Li(Bme,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new et("borderSize",(s,n)=>s.borderColor!=null?n.camera.pixelRatio:0),new jr("screenOffset",(s,n)=>Li(Bme,s.horizontalScreenOffset*n.camera.pixelRatio,0))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.multipassEnabled&&e.varyings.add("depth","float"),t.occlusionTestEnabled&&e.include(Y3e),t.hasScreenSizePerspective&&g6(i),i.code.add(T`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?T`
      if (!testHUDVisibility(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?T`
      vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:T`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.multipassEnabled?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?T`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:T`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?T`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:T`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),r.uniforms.add(new ji("uColor",s=>zme(s.color)),new ji("borderColor",s=>zme(s.borderColor))),t.multipassEnabled&&(r.include(Out,t),r.uniforms.add(new jr("inverseViewport",(s,n)=>n.inverseViewport))),r.code.add(T`
    void main() {
      ${t.multipassEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?T`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:T`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function zme(t){return t??Rh}const Bme=mt(),G_t=Object.freeze(Object.defineProperty({__proto__:null,build:TDe},Symbol.toStringTag,{value:"Module"}));let SDe=class EDe extends Qi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Xe.Global}initializeProgram(e){return new Ki(e.rctx,EDe.shader.get().build(this.configuration),Ai)}setPipelineState(e){const i=e?br.ALWAYS:br.LESS;return this.configuration.depthHudEnabled?Jt({depthTest:{func:i},depthWrite:Nu}):Jt({blending:ua(Be.ONE,Be.SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),depthTest:{func:i},colorWrite:ui})}initializePipeline(){return this.setPipelineState(this.configuration.multipassEnabled)}};SDe.shader=new qi(G_t,()=>ce(()=>Promise.resolve().then(()=>wHt),void 0));let md=class extends Uc{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.multipassEnabled=!1}};h([B()],md.prototype,"screenCenterOffsetUnitsEnabled",void 0),h([B()],md.prototype,"spherical",void 0),h([B()],md.prototype,"occlusionTestEnabled",void 0),h([B()],md.prototype,"hasVerticalOffset",void 0),h([B()],md.prototype,"hasScreenSizePerspective",void 0),h([B()],md.prototype,"depthHudEnabled",void 0),h([B()],md.prototype,"depthHudAlignStartEnabled",void 0),h([B()],md.prototype,"hasSlicePlane",void 0),h([B()],md.prototype,"multipassEnabled",void 0),h([B({constValue:!0})],md.prototype,"hasSliceInVertexProgram",void 0),h([B({constValue:!1})],md.prototype,"draped",void 0);let c4=class qQ extends iw{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new CDe),this.produces=new Map([[Pe.LINE_CALLOUTS,i=>i===j.Color],[Pe.LINE_CALLOUTS_HUD_DEPTH,i=>i===j.Color]]),this._configuration=new md,this._uniqueMaterialIdentifier=qQ.uniqueMaterialIdentifier(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,i){const r=(i==null?void 0:i.slot)!==Pe.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.depthHudEnabled=r,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration}intersect(){}createGLMaterial(e){return new H_t(e)}createBufferWriter(){return new W_t}validateParameters(e){const i=qQ.uniqueMaterialIdentifier(e);i!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=i)}static uniqueMaterialIdentifier({renderOccluded:e,isDecoration:i,horizontalScreenOffset:r,color:s,size:n,occlusionTest:o,shaderPolygonOffset:a,depthHUDAlignStart:l,centerOffsetUnits:c,hasSlicePlane:u,screenSizePerspective:d,verticalOffset:f,borderColor:m}){return Y8e`${e}:${i}:${r}:[${s}]:${n}:${o}:${a}:${l}:${c}:${u}:${d!=null}:{${f.screenLength}:${f.minWorldLength}:${f.maxWorldLength}}:[${m}]`}},H_t=class extends ew{beginSlot(e){return this.ensureTechnique(SDe,e)}},CDe=class extends zne{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const q_t=As().vec3f(R.POSITION).vec3f(R.NORMAL).vec2f(R.UV0).vec4f(R.CENTEROFFSETANDDISTANCE),jme=[pg(0,0),pg(1,0),pg(0,1),pg(1,0),pg(1,1),pg(0,1)];let W_t=class{constructor(){this.vertexBufferLayout=q_t}elementCount(e){return 6*e.attributes.get(R.POSITION).indices.length}write(e,i,r,s,n){Bne(r.attributes.get(R.POSITION),e,s.position,n,6),jne(r.attributes.get(R.NORMAL),i,s.normal,n,6),gP(r.attributes.get(R.CENTEROFFSETANDDISTANCE),s.centerOffsetAndDistance,n,6);for(let o=0;o<jme.length;++o)s.uv0.setVec(n+o,jme[o])}},MDe=class ADe extends Sy{constructor(e,i){super(e,null,i,X_t),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new c4(this._materialParameters),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){const i=this._materialParameters;return i.horizontalScreenOffset=e.horizontalScreenOffset??0,i.centerOffsetUnits=e.centerOffsetUnits||"world",i}get _materialParameters(){var o;const e=new CDe,i=this.symbol,r=i.callout;if(e.color=r.color!=null?Qe.toUnitRGBA(r.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=wn(r.size||0),i.verticalOffset){const{screenLength:a,minWorldLength:l,maxWorldLength:c}=i.verticalOffset;e.verticalOffset={screenLength:wn(a),minWorldLength:l||0,maxWorldLength:c??1/0}}e.borderColor=((o=r.border)==null?void 0:o.color)!=null?Qe.toUnitRGBA(r.border.color):null;const s=i.symbolLayers.at(0).type==="object",n=i.type==="label-3d";return e.occlusionTest=!s,e.shaderPolygonOffset=s?0:void 0,e.depthHUDAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return Y_t}createGraphics3DGraphic(e){const i=e.renderingInfo,r=e.graphic,s=this.setGraphicElevationContext(r,new _B,i.elevationOffset||0),n=i.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!GOe(l)))return null;const a=Xne(r.geometry);return a==null?null:this._createAs3DShape(a,s,i,r.uid)}layerOpacityChanged(){var e;(e=this._materials[0])==null||e.setParameters(this._materialParameters)}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=qD(ADe.elevationModeChangeTypes,r,s);return n!==ks.UPDATE||e.forEach(o=>{const a=i(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,i,r=0){return super.setGraphicElevationContext(e,i),i.addOffsetRenderUnits(r),i}updateGraphicElevationContext(e,i){this.setGraphicElevationContext(e,i.elevationContext,i.metadata!=null?i.metadata.elevationOffset:0),i.needsElevationUpdates=sp(i.elevationContext.mode)}computeComplexity(){return new $d({verticesPerFeature:6})}_getOrCreateMaterial(e){var s;const i=this._perInstanceMaterialParameters(e),r=c4.uniqueMaterialIdentifier(i);if(r===((s=this._materials[0])==null?void 0:s.uniqueMaterialIdentifier))return{material:this._materials[0],isUnique:!1};if(e.materialCollection!=null){let n=e.materialCollection.get(r);return n==null&&(n=new c4(i),e.materialCollection.add(r,n)),{material:n,isUnique:!1}}return{material:new c4(i),isUnique:!0}}_createAs3DShape(e,i,r,s){const n=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}),a=this._getOrCreateMaterial(r),l=new Tn(a.material,Z_t(r),null,Fs.Point,o),c=moe(this._context,e,l,i,s);if(c==null)return null;const u=new Ty(this,c.object,[l],a.isUnique?[a.material]:null,null,yS,i);return u.metadata=new vLe(r.elevationOffset),u.alignedSampledElevation=c.sampledElevation,u.needsElevationUpdates=sp(i.mode),t2(u,e,this._context.elevationProvider),u}};function Z_t(t){const{translation:e,centerOffset:i}=t,r=new ht(e?[e[0],e[1],e[2]]:[0,0,0],Lq,3,!0),s=new ht(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],Lq,4,!0);return[[R.POSITION,r],[R.NORMAL,new ht([0,0,1],Lq,3,!0)],[R.CENTEROFFSETANDDISTANCE,s]]}MDe.elevationModeChangeTypes={definedChanged:ks.UPDATE,staysOnTheGround:ks.UPDATE,onTheGroundChanged:ks.RECREATE};const Lq=[0],Y_t={mode:"relative-to-ground",offset:0},X_t={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let J_t=class{constructor(e,i,r=E(),s=ci(),n=0,o="world",a=0,l=null){this.renderer=e,this.symbol=i,this.translation=r,this.centerOffset=s,this.horizontalScreenOffset=n,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},Q_t=class extends c0t{};const Gme=()=>se.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function K_t(t,e){if(!$se(t))return Gme().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const i=evt[t.callout.type];return i?new i(t,e):(Gme().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const evt={line:MDe};function GKt(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance,1,1]:[1,1,1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax,t.extent.zmin??0,t.extent.mmin??0]:[0,0,0,0]}:null}function tvt(t){return t.originPosition==="lowerLeft"&&t.scale.length===4&&t.translate.length===4}function eN(t){if(tvt(t))return t;const{originPosition:e,scale:i,translate:r}=t,s=i[0]??1,n=i[1]??1;return{originPosition:"lowerLeft",scale:[s,e==="lowerLeft"?n:-n,i[2]??1,i[3]??1],translate:[r[0]??0,r[1]??0,r[2]??0,r[3]??0]}}function ivt({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function rvt({scale:t,translate:e},i){return Math.round((i-e[1])/t[1])}function svt({scale:t,translate:e},i){return Math.round(((i??0)-e[2])/t[2])}function nvt({scale:t,translate:e},i){return i?Math.round((i-e[3])/t[3]):0}function tN({scale:t,translate:e},i){return i*t[0]+e[0]}function iN({scale:t,translate:e},i){return i*t[1]+e[1]}function OL({scale:t,translate:e},i){return(i??0)*t[2]+e[2]}function RL({scale:t,translate:e},i){return i?i*t[3]+e[3]:0}function yoe(t,e){return t&&e?cvt:t&&!e?avt:!t&&e?lvt:ovt}const ovt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=tN(t,r[0]),n=iN(t,r[1]);i[0]=[s,n];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let u=1;u<e.length;u++){const[d,f]=e[u];s+=l*d,n+=c*f,i[u]=[s,n]}return i},avt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=tN(t,r[0]),n=iN(t,r[1]);i[0]=[s,n,OL(t,r[2])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let u=1;u<e.length;u++){const[d,f,m]=e[u];s+=l*d,n+=c*f,i[u]=[s,n,OL(t,m)]}return i},lvt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=tN(t,r[0]),n=iN(t,r[1]);i[0]=[s,n,RL(t,r[2])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let u=1;u<e.length;u++){const[d,f,m]=e[u];s+=l*d,n+=c*f,i[u]=[s,n,RL(t,m)]}return i},cvt=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=tN(t,r[0]),n=iN(t,r[1]);i[0]=[s,n,OL(t,r[2]),RL(t,r[3])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let u=1;u<e.length;u++){const[d,f,m,g]=e[u];s+=l*d,n+=c*f,i[u]=[s,n,OL(t,m),RL(t,g)]}return i};function PDe(t,e,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=e(t,i[s]);return r}function HKt(t,e,i){const r=eN(t);return e.x=ivt(r,i.x),e.y=rvt(r,i.y),i.z!=null&&(e.z=svt(r,i.z)),i.m!=null&&(e.m=nvt(r,i.m)),e}function ODe(t,e,i,r=(i==null?void 0:i.hasZ)??!1,s=(i==null?void 0:i.hasM)??!1){if(i!=null){const n=eN(t);e.points=yoe(r,s)(n,i.points),e.hasZ=r,e.hasM=s}return e}function RDe(t,e,i,r=(i==null?void 0:i.z)!=null,s=(i==null?void 0:i.m)!=null){if(i==null)return e;const n=eN(t);return e.x=tN(n,i.x),e.y=iN(n,i.y),r&&(e.z=OL(n,i.z)),s&&(e.m=RL(n,i.m)),e}function $De(t,e,i,r=(i==null?void 0:i.hasZ)??!1,s=(i==null?void 0:i.hasM)??!1){if(i!=null){const n=eN(t);e.rings=PDe(n,yoe(r,s),i.rings),e.hasZ=r,e.hasM=s}return e}function IDe(t,e,i,r=(i==null?void 0:i.hasZ)??!1,s=(i==null?void 0:i.hasM)??!1){if(i!=null){const n=eN(t);e.paths=PDe(n,yoe(r,s),i.paths),e.hasZ=r,e.hasM=s}return e}let qKt=class{constructor(e,i,r){this.uid=e,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}};function ZKt(t){return t.geometry!=null}let YKt=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function JKt(t,e){var u;const i=vCe.fromJSON(t.geometryType),r=Ze.fromJSON(t.spatialReference),s=t.transform,n=t.objectIdFieldName,o=e==null?void 0:e.maxStringAttributeLength,a=e==null?void 0:e.maxStringAttributeFields;let l;const c=t.features.map(d=>{const f=uvt(d,i,r,t.objectIdFieldName),m=f.geometry;if(mvt(f.attributes,a,o,g=>{l??(l=[]);const y=fvt(f,n);y!=null&&l.push({objectId:y,attribute:g})}),m!=null&&s)switch(m.type){case"point":f.geometry=RDe(s,m,m);break;case"multipoint":f.geometry=ODe(s,m,m);break;case"polygon":f.geometry=$De(s,m,m);break;case"polyline":f.geometry=IDe(s,m,m);break;case"extent":case"mesh":f.geometry=m}return f});return{geometryType:i,features:c,spatialReference:r,fields:((u=t.fields)==null?void 0:u.map(d=>GG.fromJSON(d)))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null,missingAttributes:l}}function uvt(t,e,i,r){return{uid:Ph(),objectId:r&&t.attributes?t.attributes[r]:null,attributes:t.attributes,geometry:hvt(t.geometry,e,i),visible:!0}}function hvt(t,e,i){if(t==null)return null;switch(e){case"point":{const r=t;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=t;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=t;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=t;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function dvt(t){if(t==null)return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(t.hasZ?1:0)+(t.hasM?1:0),s=t.type==="polyline"?t.paths:t.rings;for(const n of s)i+=n.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32*(s.length+1);break}case"multipoint":{const i=2+(t.hasZ?1:0)+(t.hasM?1:0),r=t.points.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=pb(t.vertexAttributes.position,t.vertexAttributes.normal,t.vertexAttributes.uv,t.vertexAttributes.tangent)}return e}function QKt(t){let e=32;return e+=Bxe(t.attributes),e+=3,e+=8+dvt(t.geometry),e}function KKt(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const i of t.paths)e+=i.length;return e}case"polygon":{let e=0;for(const i of t.rings)e+=i.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function eei(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function tei(t,e){switch(Zr(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let i=0;i<t.paths.length;i++)g8(e,t.paths[i],!!t.hasZ);break;case"polygon":for(let i=0;i<t.rings.length;i++)g8(e,t.rings[i],!!t.hasZ);break;case"multipoint":g8(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function pvt(t,e){switch(zh(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let i=0;i<t.paths.length;i++)qH(e,t.paths[i]);break;case"polygon":for(let i=0;i<t.rings.length;i++)qH(e,t.rings[i]);break;case"multipoint":qH(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function fvt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function mvt(t,e,i,r){if(e!=null&&e.size&&i!=null&&t)for(const s in t){if(!e.has(s))continue;const n=t[s];typeof n=="string"&&n.length>i&&(r(s),t[s]="")}}const Dq=2;let gl=class TC{constructor(e=[],i=[],r=!1){this.lengths=e??[],this.coords=i??[],this.hasIndeterminateRingOrder=r}static fromJSON(e){return new TC(e.lengths,e.coords,e.hasIndeterminateRingOrder)}static fromRect(e){const[i,r,s,n]=e,o=s-i,a=n-r;return new TC([5],[i,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,i)=>e+i)}forEachVertex(e){let i=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let n=0;n<s;n++)e(this.coords[Dq*(n+i)],this.coords[Dq*(n+i)+1]);i+=s}}deltaDecode(){const e=this.clone(),{coords:i,lengths:r}=e;let s=0;for(const n of r){for(let o=1;o<n;o++)i[2*(s+o)]+=i[2*(s+o)-2],i[2*(s+o)+1]+=i[2*(s+o)-1];s+=n}return e}clone(e){if(this.lengths.length===0)return new TC([],[this.coords[0],this.coords[1]]);const i=(this.lengths.length===0?1:this.lengths.reduce((s,n)=>s+n))*Dq,r=this.coords.slice(0,i);return e?(e.set(r),new TC(this.lengths,e,this.hasIndeterminateRingOrder)):new TC(Array.from(this.lengths),Array.from(r),this.hasIndeterminateRingOrder)}},i2=class xU{constructor(e=null,i={},r,s){this.geometry=e,this.attributes=i,this.centroid=r,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}static fromJSON(e,i){const r=e.geometry?gl.fromJSON(e.geometry):null,s=e.centroid?gl.fromJSON(e.centroid):null,n=e.attributes[i];return new xU(r,e.attributes,s,n)}weakClone(){const e=new xU(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}clone(){var r,s;const e=(r=this.geometry)==null?void 0:r.clone(),i=new xU(e,{...this.attributes},(s=this.centroid)==null?void 0:s.clone(),this.objectId);return i.displayId=this.displayId,i.geohashX=this.geohashX,i.geohashY=this.geohashY,i}};function gvt(t){var e,i;return!!((i=(e=t.geometry)==null?void 0:e.coords)!=null&&i.length)}let LDe=class DDe{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new DDe;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}};function yl(t,e){return t?e?4:3:e?3:2}const rN=()=>se.getLogger("esri.layers.graphics.featureConversionUtils"),NDe={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},yvt=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n},Hme=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+2]},_vt=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+3]},vvt=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+2],t[i+3]=e[r+3]};function _oe(t,e,i,r){if(t){if(i)return e&&r?vvt:Hme;if(e&&r)return _vt}else if(e&&r)return Hme;return yvt}function Nq({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function Fq({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function kq({scale:t,translate:e},i,r){return i*t[r]+e[r]}function iei(t,e,i){return t?e?i?woe(t):voe(t):i?boe(t):P6(t):null}function P6(t){const e=t.coords;return{x:e[0],y:e[1]}}function FDe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function voe(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function bvt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function boe(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function wvt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function woe(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function xvt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function Tvt(t,e,i,r){let s=P6;i&&r?s=woe:i?s=voe:r&&(s=boe);for(const n of e){const{geometry:o,attributes:a}=n,l=o!=null?s(o):null;t.push({attributes:a,geometry:l})}return t}function xoe(t,e){return t&&e?xvt:t?bvt:e?wvt:FDe}function Svt(t,e,i,r,s){const n=xoe(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?n(new gl,o):null;t.push(new i2(l,a,null,s?a[s]:void 0))}return t}function Evt(t,e,i=xoe(e.z!=null,e.m!=null)){return i(t,e)}function Cvt(t,e,i,r){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?kDe(s,i,r):null});return t}function kDe(t,e,i){if(t==null)return null;const r=yl(e,i),s=[];for(let n=0;n<t.coords.length;n+=r){const o=[];for(let a=0;a<r;a++)o.push(t.coords[n+a]);s.push(o)}return e?i?{points:s,hasZ:e,hasM:i}:{points:s,hasZ:e}:i?{points:s,hasM:i}:{points:s}}function Mvt(t,e,i,r,s){const n=yl(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?UDe(new gl,o,n):null;t.push(new i2(l,a,null,s?a[s]:void 0))}return t}function UDe(t,e,i=yl(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const r=t.coords;let s=0;for(const n of e.points)for(let o=0;o<i;o++)r[s++]=n[o];return t}function Avt(t,e,i,r){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?VDe(s,i,r):null});return t}function VDe(t,e,i){if(!t)return null;const r=yl(e,i),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let u=0;u<l;u++){const d=[];for(let f=0;f<r;f++)d.push(s[a++]);c.push(d)}o.push(c)}return e?i?{paths:o,hasZ:e,hasM:i}:{paths:o,hasZ:e}:i?{paths:o,hasM:i}:{paths:o}}function Pvt(t,e,i,r,s){const n=yl(i,r);for(const{geometry:o,attributes:a,centroid:l}of e){const c=o!=null?zDe(new gl,o,n):null,u=l!=null?Evt(new gl,l):null;t.push(new i2(c,a,u,s?a[s]:void 0))}return t}function zDe(t,e,i=yl(e.hasZ,e.hasM)){const{lengths:r,coords:s}=t;let n=0;for(const o of e.paths){for(const a of o)for(let l=0;l<i;l++)s[n++]=a[l];r.push(o.length)}return t}function Ovt(t,e,i,r){for(const{geometry:s,attributes:n,centroid:o}of e){const a=s!=null?BDe(s,i,r):null;if(o!=null){const l=P6(o);t.push({attributes:n,centroid:l,geometry:a})}else t.push({attributes:n,geometry:a})}return t}function BDe(t,e,i){if(!t)return null;const r=yl(e,i),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let u=0;u<l;u++){const d=[];for(let f=0;f<r;f++)d.push(s[a++]);c.push(d)}o.push(c)}return e?i?{rings:o,hasZ:e,hasM:i}:{rings:o,hasZ:e}:i?{rings:o,hasM:i}:{rings:o}}function Rvt(t,e,i,r,s){for(const{geometry:n,centroid:o,attributes:a}of e){const l=n!=null?jDe(new gl,n,i,r):null,c=s?a[s]:void 0;o!=null?t.push(new i2(l,a,FDe(new gl,o),c)):t.push(new i2(l,a,null,c))}return t}function jDe(t,e,i=e.hasZ,r=e.hasM){return $vt(t,e.rings,i,r)}function $vt(t,e,i,r){const s=yl(i,r),{lengths:n,coords:o}=t;let a=0;t_(t);for(const l of e){for(const c of l)for(let u=0;u<s;u++)o[a++]=c[u];n.push(l.length)}return t}const dA=[],g3=[];function rei(t,e,i,r,s){dA[0]=t;const[n]=GDe(g3,dA,e,i,r,s);return tm(dA),tm(g3),n}function GDe(t,e,i,r,s,n){if(tm(t),!i){for(const o of e){const a=n?o.attributes[n]:void 0;t.push(new i2(null,o.attributes,null,a))}return t}switch(i){case"esriGeometryPoint":return Svt(t,e,r,s,n);case"esriGeometryMultipoint":return Mvt(t,e,r,s,n);case"esriGeometryPolyline":return Pvt(t,e,r,s,n);case"esriGeometryPolygon":return Rvt(t,e,r,s,n);default:rN().error("convertToFeatureSet:unknown-geometry",new G(`Unable to parse unknown geometry type '${i}'`)),tm(t)}return t}function sei(t,e,i,r){g3[0]=t,HDe(dA,g3,e,i,r);const s=dA[0];return tm(dA),tm(g3),s}function Ivt(t,e,i){if(t==null)return null;const r=new gl;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&i==null&&(i=t.hasM),BA(t)?xoe(e??t.z!=null,i??t.m!=null)(r,t):ol(t)?jDe(r,t,e,i):vf(t)?zDe(r,t,yl(e,i)):sS(t)?UDe(r,t,yl(e,i)):void rN().error("convertFromGeometry:unknown-geometry",new G(`Unable to parse unknown geometry type '${t}'`))}function Lvt(t,e,i,r){const s=t&&("coords"in t?t:t.geometry);if(s==null)return null;switch(e){case"esriGeometryPoint":{let n=P6;return i&&r?n=woe:i?n=voe:r&&(n=boe),n(s)}case"esriGeometryMultipoint":return kDe(s,i,r);case"esriGeometryPolyline":return VDe(s,i,r);case"esriGeometryPolygon":return BDe(s,i,r);default:return rN().error("convertToGeometry:unknown-geometry",new G(`Unable to parse unknown geometry type '${e}'`)),null}}function Dvt(t,e){for(const i of e)t.push({attributes:i.attributes});return t}function HDe(t,e,i,r,s){if(tm(t),i==null)return Dvt(t,e);switch(i){case"esriGeometryPoint":return Tvt(t,e,r,s);case"esriGeometryMultipoint":return Cvt(t,e,r,s);case"esriGeometryPolyline":return Avt(t,e,r,s);case"esriGeometryPolygon":return Ovt(t,e,r,s);default:rN().error("convertToFeatureSet:unknown-geometry",new G(`Unable to parse unknown geometry type '${i}'`))}return t}function nei(t){const{objectIdFieldName:e,spatialReference:i,transform:r,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:d,queryGeometryType:f}=t,m={features:HDe([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:e,spatialReference:i,uniqueIdField:u,queryGeometry:Lvt(d,f,!1,!1)};return r&&(m.transform=r),c&&(m.exceededTransferLimit=c),n&&(m.hasM=n),o&&(m.hasZ=o),m}function oei(t,e){const i=new LDe,{hasM:r,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:u,fields:d}=t;return d&&(i.fields=d),i.geometryType=l??null,i.objectIdFieldName=o??e??null,i.spatialReference=a??null,i.objectIdFieldName?(n&&GDe(i.features,n,l,s,r,i.objectIdFieldName),c&&(i.exceededTransferLimit=c),r&&(i.hasM=r),s&&(i.hasZ=s),u&&(i.transform=u),i):(rN().error(new G("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function aei(t){const{transform:e,features:i,hasM:r,hasZ:s}=t;if(!e)return t;for(const n of i)n.geometry!=null&&Wme(n.geometry,n.geometry,r,s,e),n.centroid!=null&&Wme(n.centroid,n.centroid,r,s,e);return t.transform=null,t}function lei(t,e){const{geometryType:i,features:r,hasM:s,hasZ:n}=e;if(!t)return e;for(let o=0;o<r.length;o++){const a=r[o],l=a.weakClone();l.geometry=new gl,qme(l.geometry,a.geometry,s,n,i,t),a.centroid&&(l.centroid=new gl,qme(l.centroid,a.centroid,s,n,"esriGeometryPoint",t)),r[o]=l}return e.transform=t,e}function qme(t,e,i,r,s,n,o=i,a=r){if(t_(t),!(e!=null&&e.coords.length))return null;const l=NDe[s],{coords:c,lengths:u}=e,d=yl(i,r),f=yl(i&&o,r&&a),m=_oe(i,r,o,a);if(!u.length)return m(t.coords,c,0,0,Nq(n,c[0]),Fq(n,c[1])),t_(t,d,0),t;let g,y,v,b,w=0,x=0,S=x;for(const C of u){if(C<l)continue;let M=0;x=S,v=g=Nq(n,c[w]),b=y=Fq(n,c[w+1]),m(t.coords,c,x,w,v,b),M++,w+=d,x+=f;for(let O=1;O<C;O++,w+=d)v=Nq(n,c[w]),b=Fq(n,c[w+1]),v===g&&b===y||(m(t.coords,c,x,w,v-g,b-y),x+=f,M++,g=v,y=b);M>=l&&(t.lengths.push(M),S=x)}return tm(t.coords,S),t.coords.length?t:null}function cei(t,e,i,r,s,n,o=i,a=r){if(t_(t),!(e!=null&&e.coords.length))return null;const l=NDe[s],{coords:c,lengths:u}=e,d=yl(i,r),f=yl(i&&o,r&&a),m=_oe(i,r,o,a);if(!u.length)return m(t.coords,c,0,0,c[0],c[1]),t_(t,d,0),t;let g=0;const y=n*n;for(const v of u){if(v<l){g+=v*d;continue}const b=t.coords.length/f,w=g,x=g+(v-1)*d;m(t.coords,c,t.coords.length,w,c[w],c[w+1]),WQ(t.coords,c,d,y,m,w,x),m(t.coords,c,t.coords.length,x,c[x],c[x+1]);const S=t.coords.length/f-b;S>=l?t.lengths.push(S):tm(t.coords,b*f),g+=v*d}return t.coords.length?t:null}function Nvt(t,e,i,r){const s=t[e],n=t[e+1],o=t[i],a=t[i+1],l=t[r],c=t[r+1];let u=o,d=a,f=l-u,m=c-d;if(f!==0||m!==0){const g=((s-u)*f+(n-d)*m)/(f*f+m*m);g>1?(u=l,d=c):g>0&&(u+=f*g,d+=m*g)}return f=s-u,m=n-d,f*f+m*m}function WQ(t,e,i,r,s,n,o){let a,l=r,c=0;for(let u=n+i;u<o;u+=i)a=Nvt(e,u,n,o),a>l&&(c=u,l=a);l>r&&(c-n>i&&WQ(t,e,i,r,s,n,c),s(t,e,t.length,c,e[c],e[c+1]),o-c>i&&WQ(t,e,i,r,s,c,o))}function uei(t,e,i,r){var c;if(!((c=e==null?void 0:e.coords)!=null&&c.length))return null;const s=yl(i,r);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const u=e.coords;for(let d=0;d<u.length;d+=s){const f=u[d],m=u[d+1];n=Math.min(n,f),a=Math.max(a,f),o=Math.min(o,m),l=Math.max(l,m)}}return wX(t)?Sot(t,n,o,a,l):rG(n,o,a,l,t),t}function Wme(t,e,i,r,s){const{coords:n,lengths:o}=e,a=yl(i,r);if(!n.length)return t!==e&&t_(t),t;Fj(s);const{originPosition:l,scale:c,translate:u}=s,d=kvt;d.originPosition=l;const f=d.scale;f[0]=c[0]??1,f[1]=-(c[1]??1),f[2]=c[2]??1,f[3]=c[3]??1;const m=d.translate;if(m[0]=u[0]??0,m[1]=u[1]??0,m[2]=u[2]??0,m[3]=u[3]??0,!o.length){for(let y=0;y<a;++y)t.coords[y]=kq(d,n[y],y);return t!==e&&t_(t,a,0),t}let g=0;for(let y=0;y<o.length;y++){const v=o[y];t.lengths[y]=v;for(let x=0;x<a;++x)t.coords[g+x]=kq(d,n[g+x],x);let b=t.coords[g],w=t.coords[g+1];g+=a;for(let x=1;x<v;x++,g+=a){b+=n[g]*f[0],w+=n[g+1]*f[1],t.coords[g]=b,t.coords[g+1]=w;for(let S=2;S<a;++S)t.coords[g+S]=kq(d,n[g+S],S)}}return t!==e&&t_(t,n.length,o.length),t}function hei(t,e,i,r,s,n){if(t_(t),t.lengths.push(...e.lengths),i===s&&r===n)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=yl(i,r),a=_oe(i,r,s,n),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function Fvt(t,e,i,r){let s=0,n=t[r*e],o=t[r*(e+1)];for(let a=1;a<i;a++){const l=n+t[r*(e+a)],c=o+t[r*(e+a)+1],u=(l-n)*(c+o);n=l,o=c,s+=u}return .5*s}function dei(t,e){const{coords:i,lengths:r}=t;let s=0,n=0;for(let o=0;o<r.length;o++){const a=r[o];n+=Fvt(i,s,a,e),s+=a}return Math.abs(n)}function t_(t,e=0,i=0){tm(t.lengths,i),tm(t.coords,e)}function tm(t,e=0){t.length!==e&&(t.length=e)}const kvt={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},Zme=new la(Array,t=>UG(t,$Oe),null,10,5),Uvt=oi();let Vvt=class{get labelLayers(){return this._labelLayers||_6e}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e==null?void 0:e.isElevationSource)}constructor(e,i,r,s,n){this.graphic=e,this.graphics3DSymbol=i,this.layers=r,this._visibleFlags=Aa.ALL_LABEL,this.deconflictionPriority=0,++i.referenced,this._featureExpressionFeature=n?mLe(n,e,s):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(i=>{i.initialize(e),i.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,i){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(i),e.setVisibility(this.isVisible(Ro.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(e=!0)}),e}isVisible(e=Ro.GRAPHIC,i){const r=i?this._visibleFlags|i|Ro.LABEL*i:this._visibleFlags;return e===Ro.GRAPHIC?(r&Aa.ALL_GRAPHIC)===Aa.ALL_GRAPHIC:(r&Aa.ALL_LABEL)===Aa.ALL_LABEL}setVisibilityFlag(e,i,r){const s=this.isVisible(e);r?this._visibleFlags|=e*i:this._visibleFlags&=~(e*i);const n=this.isVisible(e);if(s===n)return!1;if(e===Ro.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(Ro.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,i){return!!(this._visibleFlags&e*i)}computeExtent(e){if(!this._extent){const i=this.graphic.geometry;if(i==null)return!1;this._extent=oi(),pvt(i,this._extent);const r=i.spatialReference;if(!hs(r,e)&&!fG(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,i){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,i)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,i,r){let s=e.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=Wf.fromExtent(s.type==="mesh"?s.extent:s)),Ivt(s,i,r)}get usedMemory(){let e=Bxe(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>e+=i.graphics3DSymbolLayer.usedMemory),e}computeAttachmentOrigin(){const e={render:{origin:E(),num:0},draped:{origin:mt(),num:0}};for(const i of this.layers)i!=null&&i.computeAttachmentOrigin(e);return e.render.num>1&&he(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&bh(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,i,r,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?Zr(n.boundingBox):n.boundingBox=Zr(),n.requiresDrapedElevation=!1,await jj(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?i:e,l=Zme.acquire(),c=await o.getProjectedBoundingBox(a,r,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&oP(n.boundingBox,l),Zme.release(l)}),xot(n.boundingBox)||TZ(Cse(n.boundingBox,Uvt))?n:null}needsElevationUpdates(){var e;for(const i of this.layers)if(i!=null&&(i.type==="object3d"||i.type==="lod-instance")&&i.needsElevationUpdates)return!0;return((e=this._labelLayers)==null?void 0:e.some(i=>(i==null?void 0:i.needsElevationUpdates)??!1))??!1}alignWithElevation(e,i,r){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(e,i,this._featureExpressionFeature,r)})}alignWithAbsoluteElevation(e,i,r){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(e,i,r)})}addObjectStateSet(e,i){this._forEachSymbolLayerGraphic(r=>r.addObjectState(e,i))}removeObjectState(e){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(e))}_forEachGraphicList(e,i){e==null||e.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){}},fei=class{constructor(e,i){this.scheduler=e,this.schedule=i,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}},zvt=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};var Yme,Xme,Jme,qDe={exports:{}};Yme=qDe,Xme=function(){function t(L,N,z){z=z||2;var W,J,K,ne,we,Ie,je,ut=N&&N.length,ot=ut?N[0]*z:L.length,at=e(L,0,ot,z,!0),tt=[];if(!at||at.next===at.prev)return tt;if(ut&&(at=l(L,N,at,z)),L.length>80*z){W=K=L[0],J=ne=L[1];for(var rt=z;rt<ot;rt+=z)(we=L[rt])<W&&(W=we),(Ie=L[rt+1])<J&&(J=Ie),we>K&&(K=we),Ie>ne&&(ne=Ie);je=(je=Math.max(K-W,ne-J))!==0?1/je:0}return r(at,tt,z,W,J,je),tt}function e(L,N,z,W,J){var K,ne;if(J===ye(L,N,z,W)>0)for(K=N;K<z;K+=W)ne=X(K,L[K],L[K+1],ne);else for(K=z-W;K>=N;K-=W)ne=X(K,L[K],L[K+1],ne);if(ne&&C(ne,ne.next)){var we=ne.next;q(ne),ne=we}return ne}function i(L,N){if(!L)return L;N||(N=L);var z,W=L;do if(z=!1,W.steiner||!C(W,W.next)&&S(W.prev,W,W.next)!==0)W=W.next;else{var J=W.prev;if(q(W),(W=N=J)===W.next)break;z=!0}while(z||W!==N);return N}function r(L,N,z,W,J,K,ne){if(L){!ne&&K&&g(L,W,J,K);for(var we,Ie,je=L;L.prev!==L.next;)if(we=L.prev,Ie=L.next,K?n(L,W,J,K):s(L))N.push(we.i/z),N.push(L.i/z),N.push(Ie.i/z),q(L),L=Ie.next,je=Ie.next;else if((L=Ie)===je){ne?ne===1?r(L=o(i(L),N,z),N,z,W,J,K,2):ne===2&&a(L,N,z,W,J,K):r(i(L),N,z,W,J,K,1);break}}}function s(L){var N=L.prev,z=L,W=L.next;if(S(N,z,W)>=0)return!1;for(var J=L.next.next;J!==L.prev;){if(w(N.x,N.y,z.x,z.y,W.x,W.y,J.x,J.y)&&S(J.prev,J,J.next)>=0)return!1;J=J.next}return!0}function n(L,N,z,W){var J=L.prev,K=L,ne=L.next;if(S(J,K,ne)>=0)return!1;for(var we=J.x<K.x?J.x<ne.x?J.x:ne.x:K.x<ne.x?K.x:ne.x,Ie=J.y<K.y?J.y<ne.y?J.y:ne.y:K.y<ne.y?K.y:ne.y,je=J.x>K.x?J.x>ne.x?J.x:ne.x:K.x>ne.x?K.x:ne.x,ut=J.y>K.y?J.y>ne.y?J.y:ne.y:K.y>ne.y?K.y:ne.y,ot=v(we,Ie,N,z,W),at=v(je,ut,N,z,W),tt=L.prevZ,rt=L.nextZ;tt&&tt.z>=ot&&rt&&rt.z<=at;){if(tt!==L.prev&&tt!==L.next&&w(J.x,J.y,K.x,K.y,ne.x,ne.y,tt.x,tt.y)&&S(tt.prev,tt,tt.next)>=0||(tt=tt.prevZ,rt!==L.prev&&rt!==L.next&&w(J.x,J.y,K.x,K.y,ne.x,ne.y,rt.x,rt.y)&&S(rt.prev,rt,rt.next)>=0))return!1;rt=rt.nextZ}for(;tt&&tt.z>=ot;){if(tt!==L.prev&&tt!==L.next&&w(J.x,J.y,K.x,K.y,ne.x,ne.y,tt.x,tt.y)&&S(tt.prev,tt,tt.next)>=0)return!1;tt=tt.prevZ}for(;rt&&rt.z<=at;){if(rt!==L.prev&&rt!==L.next&&w(J.x,J.y,K.x,K.y,ne.x,ne.y,rt.x,rt.y)&&S(rt.prev,rt,rt.next)>=0)return!1;rt=rt.nextZ}return!0}function o(L,N,z){var W=L;do{var J=W.prev,K=W.next.next;!C(J,K)&&M(J,W,W.next,K)&&k(J,K)&&k(K,J)&&(N.push(J.i/z),N.push(W.i/z),N.push(K.i/z),q(W),q(W.next),W=L=K),W=W.next}while(W!==L);return i(W)}function a(L,N,z,W,J,K){var ne=L;do{for(var we=ne.next.next;we!==ne.prev;){if(ne.i!==we.i&&x(ne,we)){var Ie=V(ne,we);return ne=i(ne,ne.next),Ie=i(Ie,Ie.next),r(ne,N,z,W,J,K),void r(Ie,N,z,W,J,K)}we=we.next}ne=ne.next}while(ne!==L)}function l(L,N,z,W){var J,K,ne,we=[];for(J=0,K=N.length;J<K;J++)(ne=e(L,N[J]*W,J<K-1?N[J+1]*W:L.length,W,!1))===ne.next&&(ne.steiner=!0),we.push(b(ne));for(we.sort(c),J=0;J<we.length;J++)z=i(z=d(we[J],z),z.next);return z}function c(L,N){return L.x-N.x}function u(L){if(L.next.prev===L)return L;let N=L;for(;;){const z=N.next;if(z.prev===N||z===N||z===L)break;N=z}return N}function d(L,N){var z=f(L,N);if(!z)return N;var W=V(z,L),J=i(z,z.next);let K=u(W);return i(K,K.next),J=u(J),u(N===z?J:N)}function f(L,N){var z,W=N,J=L.x,K=L.y,ne=-1/0;do{if(K<=W.y&&K>=W.next.y&&W.next.y!==W.y){var we=W.x+(K-W.y)*(W.next.x-W.x)/(W.next.y-W.y);if(we<=J&&we>ne){if(ne=we,we===J){if(K===W.y)return W;if(K===W.next.y)return W.next}z=W.x<W.next.x?W:W.next}}W=W.next}while(W!==N);if(!z)return null;if(J===ne)return z;var Ie,je=z,ut=z.x,ot=z.y,at=1/0;W=z;do J>=W.x&&W.x>=ut&&J!==W.x&&w(K<ot?J:ne,K,ut,ot,K<ot?ne:J,K,W.x,W.y)&&(Ie=Math.abs(K-W.y)/(J-W.x),k(W,L)&&(Ie<at||Ie===at&&(W.x>z.x||W.x===z.x&&m(z,W)))&&(z=W,at=Ie)),W=W.next;while(W!==je);return z}function m(L,N){return S(L.prev,L,N.prev)<0&&S(N.next,L,L.next)<0}function g(L,N,z,W){var J=L;do J.z===null&&(J.z=v(J.x,J.y,N,z,W)),J.prevZ=J.prev,J.nextZ=J.next,J=J.next;while(J!==L);J.prevZ.nextZ=null,J.prevZ=null,y(J)}function y(L){var N,z,W,J,K,ne,we,Ie,je=1;do{for(z=L,L=null,K=null,ne=0;z;){for(ne++,W=z,we=0,N=0;N<je&&(we++,W=W.nextZ);N++);for(Ie=je;we>0||Ie>0&&W;)we!==0&&(Ie===0||!W||z.z<=W.z)?(J=z,z=z.nextZ,we--):(J=W,W=W.nextZ,Ie--),K?K.nextZ=J:L=J,J.prevZ=K,K=J;z=W}K.nextZ=null,je*=2}while(ne>1);return L}function v(L,N,z,W,J){return(L=1431655765&((L=858993459&((L=252645135&((L=16711935&((L=32767*(L-z)*J)|L<<8))|L<<4))|L<<2))|L<<1))|(N=1431655765&((N=858993459&((N=252645135&((N=16711935&((N=32767*(N-W)*J)|N<<8))|N<<4))|N<<2))|N<<1))<<1}function b(L){var N=L,z=L;do(N.x<z.x||N.x===z.x&&N.y<z.y)&&(z=N),N=N.next;while(N!==L);return z}function w(L,N,z,W,J,K,ne,we){return(J-ne)*(N-we)-(L-ne)*(K-we)>=0&&(L-ne)*(W-we)-(z-ne)*(N-we)>=0&&(z-ne)*(K-we)-(J-ne)*(W-we)>=0}function x(L,N){return L.next.i!==N.i&&L.prev.i!==N.i&&!U(L,N)&&(k(L,N)&&k(N,L)&&H(L,N)&&(S(L.prev,L,N.prev)||S(L,N.prev,N))||C(L,N)&&S(L.prev,L,L.next)>0&&S(N.prev,N,N.next)>0)}function S(L,N,z){return(N.y-L.y)*(z.x-N.x)-(N.x-L.x)*(z.y-N.y)}function C(L,N){return L.x===N.x&&L.y===N.y}function M(L,N,z,W){var J=D(S(L,N,z)),K=D(S(L,N,W)),ne=D(S(z,W,L)),we=D(S(z,W,N));return J!==K&&ne!==we||!(J!==0||!O(L,z,N))||!(K!==0||!O(L,W,N))||!(ne!==0||!O(z,L,W))||!(we!==0||!O(z,N,W))}function O(L,N,z){return N.x<=Math.max(L.x,z.x)&&N.x>=Math.min(L.x,z.x)&&N.y<=Math.max(L.y,z.y)&&N.y>=Math.min(L.y,z.y)}function D(L){return L>0?1:L<0?-1:0}function U(L,N){var z=L;do{if(z.i!==L.i&&z.next.i!==L.i&&z.i!==N.i&&z.next.i!==N.i&&M(z,z.next,L,N))return!0;z=z.next}while(z!==L);return!1}function k(L,N){return S(L.prev,L,L.next)<0?S(L,N,L.next)>=0&&S(L,L.prev,N)>=0:S(L,N,L.prev)<0||S(L,L.next,N)<0}function H(L,N){var z=L,W=!1,J=(L.x+N.x)/2,K=(L.y+N.y)/2;do z.y>K!=z.next.y>K&&z.next.y!==z.y&&J<(z.next.x-z.x)*(K-z.y)/(z.next.y-z.y)+z.x&&(W=!W),z=z.next;while(z!==L);return W}function V(L,N){var z=new Z(L.i,L.x,L.y),W=new Z(N.i,N.x,N.y),J=L.next,K=N.prev;return L.next=N,N.prev=L,z.next=J,J.prev=z,W.next=z,z.prev=W,K.next=W,W.prev=K,W}function X(L,N,z,W){var J=new Z(L,N,z);return W?(J.next=W.next,J.prev=W,W.next.prev=J,W.next=J):(J.prev=J,J.next=J),J}function q(L){L.next.prev=L.prev,L.prev.next=L.next,L.prevZ&&(L.prevZ.nextZ=L.nextZ),L.nextZ&&(L.nextZ.prevZ=L.prevZ)}function Z(L,N,z){this.i=L,this.x=N,this.y=z,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ye(L,N,z,W){for(var J=0,K=N,ne=z-W;K<z;K+=W)J+=(L[ne]-L[K])*(L[K+1]+L[ne+1]),ne=K;return J}return t.deviation=function(L,N,z,W){var J=N&&N.length,K=J?N[0]*z:L.length,ne=Math.abs(ye(L,0,K,z));if(J)for(var we=0,Ie=N.length;we<Ie;we++){var je=N[we]*z,ut=we<Ie-1?N[we+1]*z:L.length;ne-=Math.abs(ye(L,je,ut,z))}var ot=0;for(we=0;we<W.length;we+=3){var at=W[we]*z,tt=W[we+1]*z,rt=W[we+2]*z;ot+=Math.abs((L[at]-L[rt])*(L[tt+1]-L[at+1])-(L[at]-L[tt])*(L[rt+1]-L[at+1]))}return ne===0&&ot===0?0:Math.abs((ot-ne)/ne)},t.flatten=function(L){for(var N=L[0][0].length,z={vertices:[],holes:[],dimensions:N},W=0,J=0;J<L.length;J++){for(var K=0;K<L[J].length;K++)for(var ne=0;ne<N;ne++)z.vertices.push(L[J][K][ne]);J>0&&(W+=L[J-1].length,z.holes.push(W))}return z},t},(Jme=Xme())!==void 0&&(Yme.exports=Jme);const bP=zD(qDe.exports);function Bvt(t,e,i){Ub(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function Ub(t,e,i,r=3,s=r){if(t.length/r!==Math.ceil(e.length/s))return t;const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[4],u=i[5],d=i[6],f=i[8],m=i[9],g=i[10],y=i[12],v=i[13],b=i[14];let w=0,x=0;for(let S=0;S<n;S++){const C=e[w],M=e[w+1],O=e[w+2];t[x]=o*C+c*M+f*O+y,t[x+1]=a*C+u*M+m*O+v,t[x+2]=l*C+d*M+g*O+b,w+=s,x+=r}return t}function WDe(t,e,i){O6(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function O6(t,e,i,r=3,s=r){if(t.length/r!==Math.ceil(e.length/s))return;const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],u=i[4],d=i[5],f=i[6],m=i[7],g=i[8];let y=0,v=0;for(let b=0;b<n;b++){const w=e[y],x=e[y+1],S=e[y+2];t[v]=o*w+c*x+f*S,t[v+1]=a*w+u*x+m*S,t[v+2]=l*w+d*x+g*S,y+=s,v+=r}}function jvt(t,e,i){EB(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function EB(t,e,i,r=3,s=r){const n=Math.min(t.length/r,e.length/s);let o=0,a=0;for(let l=0;l<n;l++)t[a]=i*e[o],t[a+1]=i*e[o+1],t[a+2]=i*e[o+2],o+=s,a+=r;return t}function Gvt(t,e,i,r=3,s=r){const n=t.length/r;if(n!==Math.ceil(e.length/s))return t;let o=0,a=0;for(let l=0;l<n;l++)t[a]=e[o]+i[0],t[a+1]=e[o+1]+i[1],t[a+2]=e[o+2]+i[2],o+=s,a+=r;return t}function Hvt(t,e){wP(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function wP(t,e,i=3,r=i){const s=Math.min(t.length/i,e.length/r);let n=0,o=0;for(let a=0;a<s;a++){const l=e[n],c=e[n+1],u=e[n+2],d=l*l+c*c+u*u;if(d>0){const f=1/Math.sqrt(d);t[o]=f*l,t[o+1]=f*c,t[o+2]=f*u}n+=r,o+=i}}function qvt(t,e,i){const r=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let u=0;u<r;u++)s[c]=o[l]>>i,s[c+1]=o[l+1]>>i,s[c+2]=o[l+2]>>i,l+=a,c+=n}Object.freeze(Object.defineProperty({__proto__:null,normalize:wP,normalizeView:Hvt,scale:EB,scaleView:jvt,shiftRight:qvt,transformMat3:O6,transformMat3View:WDe,transformMat4:Ub,transformMat4View:Bvt,translate:Gvt},Symbol.toStringTag,{value:"Module"}));function Wvt(t,e,i){return{objectId:t,target:e,distance:i,type:"vertex"}}function Qme(t,e,i,r,s,n=!1){return{objectId:t,target:e,distance:i,type:"edge",start:r,end:s,draped:n}}var i_,Qo;function bM(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function $L(t){return t!=null&&!isNaN(t)&&isFinite(t)}function ZDe(t){return t.valueExpression?i_.Expression:t.field&&typeof t.field=="string"?i_.Field:i_.Unknown}function Zvt(t,e){const i=e||ZDe(t),r=t.valueUnit||"unknown";return i===i_.Unknown?Qo.Constant:t.stops?Qo.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?Qo.ClampedLinear:r==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?Qo.Proportional:Qo.Additive:Qo.Identity:Qo.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(i_||(i_={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(Qo||(Qo={}));const YDe=()=>se.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),R6=t=>YDe().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${t}`),$6=()=>YDe().error("Use of arcade expressions requires an arcade context"),Kme=new ca,TU=Math.PI,XDe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function JDe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="color"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void R6("ColorVariable");const s=typeof e=="number",n=s?null:e,o=n==null?void 0:n.attributes;let a=s?e:null;const l=r.field,{ipData:c,hasExpression:u}=r.cache;let d=r.cache.compiledFunc;if(!l&&!u){const g=r.stops;return g&&g[0]&&g[0].color}if(typeof a!="number")if(u){if((i==null?void 0:i.arcade)==null)return void $6();const g={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},y=i.arcade.arcadeUtils,v=y.getViewInfo(g),b=y.createExecContext(n,v,i.timeZone);if(!d){const w=y.createSyntaxTree(r.valueExpression);d=y.createFunction(w),r.cache.compiledFunc=d}a=y.executeFunction(d,b)}else o&&(a=o[l]);const f=r.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const g=Soe(a,c);if(g){const y=g[0],v=g[1],b=y===v?r.stops[y].color:Qe.blendColors(r.stops[y].color,r.stops[v].color,g[2],i!=null?i.color:void 0);return new Qe(b)}}}function QDe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="opacity"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void R6("OpacityVariable");const s=typeof e=="number",n=s?null:e,o=n==null?void 0:n.attributes;let a=s?e:null;const l=r.field,{ipData:c,hasExpression:u}=r.cache;let d=r.cache.compiledFunc;if(!l&&!u){const g=r.stops;return g&&g[0]&&g[0].opacity}if(typeof a!="number")if(u){if((i==null?void 0:i.arcade)==null)return void $6();const g={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},y=i.arcade.arcadeUtils,v=y.getViewInfo(g),b=y.createExecContext(n,v,i.timeZone);if(!d){const w=y.createSyntaxTree(r.valueExpression);d=y.createFunction(w),r.cache.compiledFunc=d}a=y.executeFunction(d,b)}else o&&(a=o[l]);const f=r.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const g=Soe(a,c);if(g){const y=g[0],v=g[1];if(y===v)return r.stops[y].opacity;{const b=r.stops[y].opacity;return b+(r.stops[v].opacity-b)*g[2]}}}}function KDe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(m=>m.type==="rotation"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void R6("RotationVariable");const s=r.axis||"heading",n=s==="heading"&&r.rotationType==="arithmetic"?90:0,o=s==="heading"&&r.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a==null?void 0:a.attributes,c=r.field,{hasExpression:u}=r.cache;let d=r.cache.compiledFunc,f=0;if(!c&&!u)return f;if(u){if((i==null?void 0:i.arcade)==null)return void $6();const m={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},g=i.arcade.arcadeUtils,y=g.getViewInfo(m),v=g.createExecContext(a,y,i.timeZone);if(!d){const b=g.createSyntaxTree(r.valueExpression);d=g.createFunction(b),r.cache.compiledFunc=d}f=g.executeFunction(d,v)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:n+o*f,f}function Yvt(t,e,i){const r=typeof e=="number",s=r?null:e,n=s==null?void 0:s.attributes;let o=r?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const u=i!=null?i.scale:void 0,d=i!=null?i.view:void 0;o=u==null||d==="3d"?Xvt(t):u}else if(!r)switch(t.inputValueType){case i_.Expression:{if((i==null?void 0:i.arcade)==null)return void $6();const u={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},d=i.arcade.arcadeUtils,f=d.getViewInfo(u),m=d.createExecContext(s,f,i.timeZone);if(!l){const g=d.createSyntaxTree(t.valueExpression);l=d.createFunction(g),t.cache.compiledFunc=l}o=d.executeFunction(l,m);break}case i_.Field:n&&(o=n[t.field]);break;case i_.Unknown:o=null}if(!$L(o))return null;if(r||!t.normalizationField)return o;const c=n?parseFloat(n[t.normalizationField]):null;return $L(c)&&c!==0?o/c:null}function Xvt(t){let e=null,i=null;const r=t.stops;return r?(e=r[0].value,i=r[r.length-1].value):(e=t.minDataValue||0,i=t.maxDataValue||0),(e+i)/2}function I6(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(n=>n.type==="size"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void R6("SizeVariable");const s=tNe(Yvt(r,e,i),r,e,i,r.cache.ipData);return s==null||isNaN(s)?0:s}function $u(t,e,i){return t==null?null:bM(t)?I6(t,e,i):$L(t)?t:null}function eNe(t,e,i){return $L(i)&&t>i?i:$L(e)&&t<e?e:t}function Jvt(t,e,i,r){return t+(($u(e.minSize,i,r)||e.minDataValue)??0)}function Qvt(t,e,i){const r=t.stops;let s=(r==null?void 0:r.length)&&r[0].size;return s==null&&(s=t.minSize),$u(s,e,i)}function Kvt(t,e,i,r){const s=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),n=$u(e.minSize,i,r),o=$u(e.maxSize,i,r),a=r!=null?r.shape:void 0;if(t<=e.minDataValue)return n;if(t>=e.maxDataValue)return o;if(n==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?TU*(n/2)**2:n*n,u=c+s*((l?TU*(o/2)**2:o*o)-c);return l?2*Math.sqrt(u/TU):Math.sqrt(u)}return n+s*(o-n)}function e1t(t,e,i,r){const s=r!=null?r.shape:void 0,n=t/e.minDataValue,o=$u(e.minSize,i,r),a=$u(e.maxSize,i,r);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,eNe(l,o,a)}function t1t(t,e,i,r,s){var l,c,u;const[n,o,a]=Soe(t,s);if(n===o)return $u((l=e.stops)==null?void 0:l[n].size,i,r);{const d=$u((c=e.stops)==null?void 0:c[n].size,i,r);return d+($u((u=e.stops)==null?void 0:u[o].size,i,r)-d)*a}}function i1t(t,e,i,r){const s=((r==null?void 0:r.resolution)??1)*pP[e.valueUnit],n=$u(e.minSize,i,r),o=$u(e.maxSize,i,r),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/TU)/s:a==="radius"||a==="distance"?2*t/s:t/s,eNe(l,n,o)}function tNe(t,e,i,r,s){switch(e.transformationType){case Qo.Additive:return Jvt(t,e,i,r);case Qo.Constant:return Qvt(e,i,r);case Qo.ClampedLinear:return Kvt(t,e,i,r);case Qo.Proportional:return e1t(t,e,i,r);case Qo.Stops:return t1t(t,e,i,r,s);case Qo.RealWorldSize:return i1t(t,e,i,r);case Qo.Identity:return t;case Qo.Unknown:return null}}function r1t(t,e,i){const{isScaleDriven:r}=t.cache;if(!(r&&i==="3d"||e))return null;const s={scale:e,view:i};let n=$u(t.minSize,Kme,s),o=$u(t.maxSize,Kme,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function Toe(t,e,i){if(!t.visualVariables)return;const r=[],s=[],n=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=JDe(l,e,i);r.push({variable:l,value:c})}),n.forEach(l=>{const c=QDe(l,e,i);r.push({variable:l,value:c})}),a.forEach(l=>{const c=KDe(l,e,i);r.push({variable:l,value:c})}),o.forEach(l=>{const c=I6(l,e,i);r.push({variable:l,value:c})}),r.filter(l=>l.value!=null)}function Soe(t,e){if(!e)return;let i=0,r=e.length-1;return e.some((s,n)=>t<s?(r=n,!0):(i=n,!1)),[i,r,(t-e[i])/(e[r]-e[i])]}function s1t(t,e,i){const r=["proportional","proportional","proportional"];for(const s of t){const n=s.useSymbolValue?"symbol-value":I6(s,e,i);switch(s.axis){case"width":r[0]=n;break;case"depth":r[1]=n;break;case"height":r[2]=n;break;case"width-and-depth":r[0]=n,r[1]=n;break;case"all":case void 0:case null:r[0]=n,r[1]=n,r[2]=n;break;default:s.axis}}return r}const Eoe=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:s1t,getColor:JDe,getOpacity:QDe,getRotationAngle:KDe,getSize:I6,getSizeForValue:tNe,getSizeFromNumberOrVariable:$u,getSizeRangeAtScale:r1t,getVisualVariableValues:Toe,viewScaleRE:XDe},Symbol.toStringTag,{value:"Module"}));function L6(t,e){if(!t||t.symbol)return null;const i=e==null?void 0:e.renderer;return t&&i!=null&&i.getObservationRenderer?i.getObservationRenderer(t):i}function n1t(t,e){if(t.symbol!=null)return t.symbol;const i=L6(t,e);return i!=null&&i.type!=="dot-density"?i.getSymbol(t,e):null}function yei(t,e){const i=L6(t,e),r=n1t(t,e);if(r==null)return null;const s={renderer:i,symbol:r};if(i==null||!("visualVariables"in i)||!i.visualVariables)return s;const n=Toe(i,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=u;break;case"depth":o[1]=u;break;case"height":o[2]=u;break;case"width-and-depth":o[0]=o[1]=u;break;default:o[0]=o[1]=o[2]=u}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function o1t(t,e){if(t.symbol!=null)return t.symbol;const i=L6(t,e);return i!=null?i.getSymbolAsync(t,e):null}async function _ei(t,e){const i=L6(t,e),r=await o1t(t,e);if(!r)return null;const s={renderer:i,symbol:r};if(!i||!("visualVariables"in i)||!i.visualVariables)return s;const n=Toe(i,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=Qe.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=u:c==="depth"?o[1]=u:c==="height"?o[2]=u:o[0]=o[1]=c==="width-and-depth"?u:o[2]=u}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function a1t(t,e=0){const i=t[e];return typeof i=="number"&&isFinite(i)?i:null}function l1t(t){for(let e=0;e<3;e++){const i=t[e];if(typeof i=="number")return isFinite(i)?i:0}return 0}function iNe(t,e,i){const r=c1t(ege,t,e,i)?ege:[0,0,1];return Math.abs(r[2])>Math.cos(kt(80))?ys.Z:Math.abs(r[1])>Math.abs(r[0])?ys.Y:ys.X}function c1t(t,e,i,r){const s=(o=>!Array.isArray(o[0]))(e)?(o,a)=>e[3*o+a]:(o,a)=>e[o][a],n=r?ec(r)/a_(r):1;return jre(t,(o,a)=>de(o,s(a,0)*n,s(a,1)*n,s(a,2)),i)}const ege=tr();function u1t(t,e,i){const r=(e.length>0?e[0]:t.length/3)-1,s=iNe(t,r,i);if(s!==ys.Z){t=t.slice();for(let n=0;n<t.length;n+=3)t[n+s]=t[n+2]}return bP(t,e,3)}function tge(t){const e=[[R.POSITION,new ht(t.attributeData.position,t.indices,3,!0)]],i=tw(t.indices.length);return t.attributeData.colorFeature!=null?e.push([R.COLORFEATUREATTRIBUTE,new ht([t.attributeData.colorFeature],i,1,!0)]):t.attributeData.color&&e.push([R.COLOR,new ht(t.attributeData.color,i,4,!0)]),t.attributeData.uvMapSpace&&e.push([R.UVMAPSPACE,new ht(t.attributeData.uvMapSpace,t.indices,4,!0)]),t.attributeData.boundingRect&&e.push([R.BOUNDINGRECT,new ht(t.attributeData.boundingRect,t.indices,9,!0)]),new Tn(t.material,e,t.mapPositions,Fs.Mesh,t.attributeData.objectAndLayerIdColor)}function ige(t,e=null){const i=[[R.POSITION,new ht(t.attributeData.position,t.indices,3,!0)],[R.UV0,new ht(t.attributeData.uv0,t.indices,2,!0)]];return new Tn(t.material,i,t.mapPositions,Fs.Mesh,e)}function IL(t){switch(t.type){case"extent":if(t instanceof ur)return Wf.fromExtent(t);break;case"polygon":return t}return null}let D6=class{constructor(e,i,r){this.renderData=e,this.layerUid=i,this.graphicUid=r,this.outGeometries=new Array}};function ZQ(t,e,i){const r=Array.isArray(t),s=r?t.length/e:t.byteLength/(4*e),n=r?t:new Uint32Array(t,0,s*e),o=(i==null?void 0:i.minReduction)??0,a=(i==null?void 0:i.originalIndices)||null,l=a?a.length:0,c=(i==null?void 0:i.componentOffsets)||null;let u=0;if(c)for(let M=0;M<c.length-1;M++){const O=c[M+1]-c[M];O>u&&(u=O)}else u=s;const d=Math.floor(1.1*u)+1;(pm==null||pm.length<2*d)&&(pm=new Uint32Array(bEe(2*d)));for(let M=0;M<2*d;M++)pm[M]=0;let f=0;const m=!!c&&!!a,g=m?l:s;let y=Kz(s);const v=new Uint32Array(l),b=1.96;let w=o!==0?Math.ceil(4*b*b/(o*o)*o*(1-o)):g,x=1,S=c?c[1]:g;for(let M=0;M<g;M++){if(M===w){const V=1-f/M;if(V+b*Math.sqrt(V*(1-V)/M)<o)return null;w*=2}if(M===S){for(let V=0;V<2*d;V++)pm[V]=0;if(a)for(let V=c[x-1];V<c[x];V++)v[V]=y[a[V]];S=c[++x]}const O=m?a[M]:M,D=O*e,U=p1t(n,D,e);let k=U%d,H=f;for(;pm[2*k+1]!==0;){if(pm[2*k]===U){const V=pm[2*k+1]-1;if(h1t(n,D,V*e,e)){H=y[V];break}}k++,k>=d&&(k-=d)}H===f&&(pm[2*k]=U,pm[2*k+1]=O+1,f++),y[O]=H}if(o!==0&&1-f/s<o)return null;if(m){for(let M=c[x-1];M<v.length;M++)v[M]=y[a[M]];y=jg(v)}const C=r?new Array(f):new Uint32Array(f*e);f=0;for(let M=0;M<g;M++)y[M]===f&&(d1t(n,(m?a[M]:M)*e,C,f*e,e),f++);if(a&&!m){const M=new Uint32Array(l);for(let O=0;O<M.length;O++)M[O]=y[a[O]];y=jg(M)}return{buffer:Array.isArray(C)?C:C.buffer,indices:y,uniqueCount:f}}function h1t(t,e,i,r){for(let s=0;s<r;s++)if(t[e+s]!==t[i+s])return!1;return!0}function d1t(t,e,i,r,s){for(let n=0;n<s;n++)i[r+n]=t[e+n]}function p1t(t,e,i){let r=0;for(let s=0;s<i;s++)r=t[e+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let pm=null;function bei(t){const e=sN(t.rings,t.hasZ,ay.CCW_IS_HOLE,t.spatialReference),i=new Array;let r=0,s=0;for(const a of e.polygons){const l=a.count,c=a.index,u=Xd(e.position,3*c,3*l),d=a.holeIndices.map(m=>m-c),f=jg(bP(u,d,3));i.push({position:u,faces:f}),r+=u.length,s+=f.length}const n=f1t(i,r,s),o=Array.isArray(n.position)?ZQ(n.position,3,{originalIndices:n.faces}):ZQ(n.position.buffer,6,{originalIndices:n.faces});return n.position=aIe(new Float64Array(o.buffer)),n.faces=o.indices,n}function f1t(t,e,i){if(t.length===1)return t[0];const r=co(e),s=new Array(i);let n=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)r[n++]=l.position[c];for(const c of l.faces)s[o++]=c+a;a=n/3}return{position:r,faces:jg(s)}}function sN(t,e,i,r){const s=t.length,n=new Array(s),o=new Array(s),a=new Array(s);let l=0;for(let g=0;g<s;++g)l+=t[g].length;let c=0,u=0,d=0;const f=co(3*l);let m=0;for(let g=s-1;g>=0;g--){const y=t[g],v=i===ay.CCW_IS_HOLE&&m1t(y,e,r);if(v&&s!==1)n[c++]=y;else{let b=y.length;for(let x=0;x<c;++x)b+=n[x].length;const w={index:m,pathLengths:new Array(c+1),count:b,holeIndices:new Array(c)};w.pathLengths[0]=y.length,y.length>0&&(a[d++]={index:m,count:y.length}),m=v?u4(y,y.length-1,-1,f,m,y.length,e):u4(y,0,1,f,m,y.length,e);for(let x=0;x<c;++x){const S=n[x];w.holeIndices[x]=m,w.pathLengths[x+1]=S.length,S.length>0&&(a[d++]={index:m,count:S.length}),m=u4(S,0,1,f,m,S.length,e)}c=0,w.count>0&&(o[u++]=w)}}for(let g=0;g<c;++g){const y=n[g];y.length>0&&(a[d++]={index:m,count:y.length}),m=u4(y,0,1,f,m,y.length,e)}return o.length=u,a.length=d,{position:f,polygons:o,outlines:a}}function u4(t,e,i,r,s,n,o){s*=3;for(let a=0;a<n;++a){const l=t[e];r[s++]=l[0],r[s++]=l[1],r[s++]=o?l[2]:0,e+=i}return s/3}function m1t(t,e,i){if(!e)return!VR(t);const r=t.length-1;switch(iNe(t,r,i)){case ys.X:return!VR(t,ys.Y,ys.Z);case ys.Y:return!VR(t,ys.X,ys.Z);case ys.Z:return!VR(t,ys.X,ys.Y)}}var ay;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(ay||(ay={}));var y3,CB,YQ;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(y3||(y3={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(CB||(CB={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(YQ||(YQ={}));var Mn,Fd,_3,vn;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(Mn||(Mn={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(Fd||(Fd={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(_3||(_3={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(vn||(vn={}));let g1t=class{constructor(e,i){this.vec3=e,this.id=i}};function MB(t,e,i,r){return new g1t(Ge(t,e,i),r)}let rge=class{constructor(){this._extent=oi(),this.resolution=0,this.renderLocalOrigin=MB(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new y1t}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const i=.001*e.range;if(this._extent[0]-i<=e.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];yz(this._extent,e.range,0,r)}if(this._extent[2]+i>=e.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];yz(this._extent,-e.range,0,r)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,l_(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const i=this.canvasGeometries.extents[e];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}},y1t=class{constructor(){this.extents=[oi(),oi(),oi()],this.numViews=0}};var is;(function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.WaterNormal=3]="WaterNormal",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})(is||(is={}));let _1t=class{constructor(e,i,r){this._fbos=e,this._format=i,this._name=r}get valid(){var e;return((e=this._handle)==null?void 0:e.getTexture())!=null}dispose(){this._handle=hi(this._handle)}get texture(){var e;return(e=this._handle)==null?void 0:e.getTexture()}bind(e,i,r){var s,n,o,a,l,c;this._handle&&((s=this._handle.fbo)==null?void 0:s.width)===i&&((n=this._handle.fbo)==null?void 0:n.height)===r||((o=this._handle)==null||o.release(),this._handle=this._fbos.acquire(i,r,this._name,this._format)),e.unbindTexture((l=(a=this._handle)==null?void 0:a.fbo)==null?void 0:l.colorTexture),e.bindFramebuffer((c=this._handle)==null?void 0:c.fbo)}generateMipMap(){var e,i,r,s,n;(r=(i=(e=this._handle)==null?void 0:e.getTexture())==null?void 0:i.descriptor)!=null&&r.hasMipmap&&((n=(s=this._handle)==null?void 0:s.getTexture())==null||n.generateMipmap())}},dE=class{constructor(e,i,r,s,n=ss.RGBA_MIPMAP){this.output=r,this.content=s,this.fbo=new _1t(e,n,i)}get valid(){return this.fbo.valid}},v1t=class{constructor(e){this.targets=[new dE(e,"overlay color",j.Color,is.Color),new dE(e,"overlay IM color",j.Color,is.ColorNoRasterImage),new dE(e,"overlay highlight",j.Highlight,is.Highlight,ss.RGBA4),new dE(e,"overlay water",j.Normal,is.WaterNormal),new dE(e,"overlay occluded",j.Color,is.Occluded)],le("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new dE(e,"overlay oid",j.ObjectAndLayerIdColor,is.ObjectAndLayerIdColor))}getTexture(e){var i;return(i=this.targets[e])==null?void 0:i.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce((e,i,r)=>i.valid?e|=1<<r:e,0)}},N6=class extends FLe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=E(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var Gl;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight",t[t.ViewshedShadowMap=3]="ViewshedShadowMap"})(Gl||(Gl={}));let b1t=class extends N6{constructor(){super(...arguments),this.identifier=Gl.Material,this.output=j.Color,this.transparent=!1}},w1t=class extends N6{constructor(){super(...arguments),this.identifier=Gl.ShadowMap}},x1t=class extends N6{constructor(){super(...arguments),this.identifier=Gl.Highlight}},T1t=class extends N6{constructor(){super(...arguments),this.identifier=Gl.ViewshedShadowMap}};function S1t(t){t.fragment.code.add(T`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function E1t(t){t.fragment.code.add(T`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function C1t(t,e){const i=t.fragment;i.include(fy),i.uniforms.add(new jr("nearFar",(r,s)=>s.camera.nearFar)),i.uniforms.add(new wt("depthMap",(r,s)=>{var n;return(n=s.depth)==null?void 0:n.attachment})),i.uniforms.add(new us("proj",(r,s)=>s.camera.projectionMatrix)),i.uniforms.add(new et("invResolutionHeight",(r,s)=>1/s.camera.height)),i.uniforms.add(new us("reprojectionMatrix",(r,s)=>s.ssr.reprojectionMatrix)),i.code.add(T`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}function rNe(t,e){t.include(p_t,e),t.include(qG),t.include(E1t),e.hasCloudsReflections&&t.include(a$e,e),e.hasScreenSpaceReflections&&t.include(C1t,e);const i=t.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",YLe).add("ssrHeightFadeEnd","float",SB).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(T`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add(new et("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new et("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)),i.code.add(T`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&i.code.add(T`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(i.uniforms.add(new us("view",(r,s)=>s.camera.viewMatrix),new wt("lastFrameColorTexture",(r,s)=>{var n;return(n=s.ssr.lastFrameColor)==null?void 0:n.getTexture()}),new et("fadeFactorSSR",(r,s)=>s.ssr.fadeFactor)),i.code.add(T`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):i.code.add(T`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?i.code.add(T`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(T`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(T`return waterRenderedColor;
}`)}var Rg;function M1t(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new bB("overlayTexOffset",(s,n)=>A1t(s,n)),new bB("overlayTexScale",(s,n)=>P1t(s,n))),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new wt("ovColorTex",(s,n)=>nNe(s,n))),sNe(t,e)}function rR(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new sge("overlayTexOffset"),new sge("overlayTexScale")),r.uniforms.add(new et("overlayOpacity",s=>s.overlayOpacity),new wt("ovColorTex",(s,n)=>{var o;return(o=n.overlay)==null?void 0:o.getTexture(s.overlayContent)})),sNe(t,e)}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(Rg||(Rg={}));let sge=class extends Vs{constructor(e){super(e,"vec4")}};function sNe(t,e){e.pbrMode!==At.Water&&e.pbrMode!==At.WaterOnIntegratedMesh&&e.pbrMode!==At.TerrainWithWater||t.include(rNe,e);const{vertex:i,fragment:r}=t;t.varyings.add("vtcOverlay","vec4"),i.code.add(T`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),r.code.add(T`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),r.code.add(T`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),r.code.add(T`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.pbrMode!==At.Water&&e.pbrMode!==At.WaterOnIntegratedMesh&&e.pbrMode!==At.TerrainWithWater||(C_(r),my(r),r.code.add(T`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function nNe(t,e){var i,r,s;return t.identifier===Gl.Material&&t.output===j.Color?(i=e.overlay)==null?void 0:i.getTexture(is.ColorNoRasterImage):t.identifier===Gl.Material&&t.output===j.ObjectAndLayerIdColor?(r=e.overlay)==null?void 0:r.getTexture(is.ObjectAndLayerIdColor):t.identifier===Gl.Highlight?(s=e.overlay)==null?void 0:s.getTexture(is.Highlight):null}function A1t(t,e){var s,n,o,a;const i=(n=(s=e.overlay)==null?void 0:s.overlays[Mn.INNER])==null?void 0:n.extent;gz(i)&&(wg[0]=t.toMapSpace[0]/nl(i)-i[0]/nl(i),wg[1]=t.toMapSpace[1]/Lc(i)-i[1]/Lc(i));const r=(a=(o=e.overlay)==null?void 0:o.overlays[Mn.OUTER])==null?void 0:a.extent;return gz(r)&&(wg[2]=t.toMapSpace[0]/nl(r)-r[0]/nl(r),wg[3]=t.toMapSpace[1]/Lc(r)-r[1]/Lc(r)),wg}function P1t(t,e){var s,n,o,a;const i=(n=(s=e.overlay)==null?void 0:s.overlays[Mn.INNER])==null?void 0:n.extent;gz(i)&&(wg[0]=t.toMapSpace[2]/nl(i),wg[1]=t.toMapSpace[3]/Lc(i));const r=(a=(o=e.overlay)==null?void 0:o.overlays[Mn.OUTER])==null?void 0:a.extent;return gz(r)&&(wg[2]=t.toMapSpace[2]/nl(r),wg[3]=t.toMapSpace[3]/Lc(r)),wg}const wg=ci();let Coe=class extends Fr{constructor(){super(...arguments),this.color=Ge(1,1,1)}};function oNe(){const t=new Hi;return t.include(ka),t.fragment.uniforms.add(new wt("tex",e=>e.texture),new Wt("uColor",e=>e.color)),t.fragment.code.add(T`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);
}`),t}const O1t=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:Coe,build:oNe},Symbol.toStringTag,{value:"Module"}));let aNe=class{constructor(e){this._context=e,this._perConstructorInstances=new Db,this._frameCounter=0,this._keepAliveFrameCount=nge}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(i=>i.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,i=$1t){const r=i.key;let s=this._perConstructorInstances.get(e,r);if(s==null){const n=new e(this._context,i,()=>this.release(n));s=new R1t(n),this._perConstructorInstances.set(e,r,s)}return++s.refCount,s.technique}releaseAndAcquire(e,i,r){if(r!=null){if(i.key===r.key)return r;this.release(r)}return this.acquire(e,i)}release(e){if(e==null||this._perConstructorInstances.empty)return;const i=this._perConstructorInstances.get(e.constructor,e.key);i!=null&&(--i.refCount,i.refCount===0&&(i.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==nge&&this._perConstructorInstances.forEach((e,i)=>{e.forEach((r,s)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._perConstructorInstances.delete(i,s))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((i,r)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>l.technique.reload(this._context)))};e.push(s(i,r))}),await Promise.all(e)}},R1t=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const nge=-1,$1t=new tc;let lNe=class{constructor(e,i,r,s){this._textures=e,this._techniques=i,this.materialChanged=r,this.requestRender=s,this._id2glMaterialRef=new Db}dispose(){this._textures.destroy()}acquire(e,i,r){this._ownMaterial(e);const s=e.produces.get(i);if(!(s!=null&&s(r)))return null;let n=this._id2glMaterialRef.get(r,e.id);if(n==null){const o=e.createGLMaterial({material:e,techniques:this._techniques,textures:this._textures,output:r});n=new I1t(o),this._id2glMaterialRef.set(r,e.id,n)}return n.ref(),n.glMaterial}release(e,i){const r=this._id2glMaterialRef.get(i,e.id);r!=null&&(r.unref(),r.referenced||(Ut(r.glMaterial),this._id2glMaterialRef.delete(i,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&se.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},I1t=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,vt(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const L1t=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];let AB=class XQ{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,i){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new Mo,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}destroy(){this._degenerateObjects.clear(),Mo.clearPool(),JQ[0]=null,zx.prune(),Bx.prune()}add(e,i=e.length){this._objectCount+=i,this._grow(e,i);const r=Mo.acquire();for(let s=0;s<i;s++){const n=e[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(r.init(this._root),this._add(n,r))}Mo.release(r)}remove(e,i=null){this._objectCount-=e.length;const r=Mo.acquire();for(const s of e){const n=i??qS(this.objectToBoundingSphere(s),j1t);k$(n[3])?(r.init(this._root),D1t(s,n,r)):this._degenerateObjects.delete(s)}Mo.release(r),this._shrink()}update(e,i){if(!k$(i[3])&&this._isDegenerate(e))return;const r=B1t(e);this.remove(r,i),this.add(r)}forEachAlongRay(e,i,r){const s=jh(e,i);Iw(this._root,n=>{if(!F1t(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),!0})}forEachAlongRayWithVerticalOffset(e,i,r,s){const n=jh(e,i);Iw(this._root,o=>{if(!k1t(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),!0})}forEach(e){Iw(this._root,i=>{const r=i.node;return r.terminals.forAll(e),r.residents!==null&&r.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,i,r,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=Uq(e,i),u=d=>{if(--n,!s(d))return;const f=this.objectToBoundingSphere(d);if(!B1(r,f))return;const m=_1(e,i,f),g=m-f[3],y=m+f[3];g<o&&(o=g,a=y,l=d)};return oge(this._root,d=>{if(n<=0||!B1(r,d.bounds)||(he(td,c,d.halfSize),Ee(td,td,d.bounds),_1(e,i,td)>a))return!1;const f=d.node;return f.terminals.forAll(m=>u(m)),f.residents!==null&&f.residents.forAll(m=>u(m)),!0},e,i),l}forEachInDepthRange(e,i,r,s,n,o,a){let l=-1/0,c=1/0;const u={setRange:y=>{r===XQ.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,y.near),c=Math.min(c,y.far)):(l=Math.max(l,-y.far),c=Math.min(c,-y.near))}};u.setRange(s);const d=_1(i,r,e),f=Uq(i,r),m=Uq(i,-r),g=y=>{if(!a(y))return;const v=this.objectToBoundingSphere(y),b=v,w=_1(i,r,b)-d,x=w-v[3],S=w+v[3];x>c||S<l||!B1(o,v)||n(y,u)};oge(this._root,y=>{if(!B1(o,y.bounds)||(he(td,f,y.halfSize),Ee(td,td,y.bounds),_1(i,r,td)-d>c)||(he(td,m,y.halfSize),Ee(td,td,y.bounds),_1(i,r,td)-d<l))return!1;const v=y.node;return v.terminals.forAll(b=>g(b)),v.residents!==null&&v.residents.forAll(b=>g(b)),!0},i,r)}forEachNode(e){Iw(this._root,i=>e(i.node,i.bounds,i.halfSize,i.depth))}forEachNeighbor(e,i){const r=eb(i),s=i,n=l=>{const c=this.objectToBoundingSphere(l),u=eb(c),d=r+u;return!(uo(c,s)-d*d<=0)||e(l)};let o=!0;const a=l=>{o&&(o=n(l))};Iw(this._root,l=>{const c=eb(l.bounds),u=r+c;if(uo(l.bounds,s)-u*u>0)return!1;const d=l.node;return d.terminals.forAll(a),o&&d.residents!==null&&d.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsObject(e,i){const r=this.objectToBoundingSphere(i);return!(r[3]>0)||SY(r,e)}_intersectsObjectWithOffset(e,i,r){const s=this.objectToBoundingSphere(i);return!(s[3]>0)||SY(r.applyToBoundingSphere(s),e)}_add(e,i){i.advanceTo(this.objectToBoundingSphere(e))?i.node.terminals.push(e):(i.node.residents.push(e),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(e){const i=e.node.residents;e.node.residents=null;for(let r=0;r<i.length;r++){const s=Mo.acquire().init(e);this._add(i.at(r),s),Mo.release(s)}}_grow(e,i){if(i!==0&&(age(e,i,r=>this.objectToBoundingSphere(r),Dy),k$(Dy[3])&&!this._fitsInsideTree(Dy)))if(cNe(this._root.node))qS(Dy,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const r=this._rootBoundsForRootAsSubNode(Dy);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(Dy,r):this._growRootAsSubNode(r),Mo.release(r)}}_rebuildTree(e,i){ve(zq,i.bounds),zq[3]=i.halfSize,age([e,zq],2,s=>s,Bq);const r=Mo.acquire().init(this._root);this._root.initFrom(null,Bq,Bq[3]),this._root.increaseHalfSize(1.25),Iw(r,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),Mo.release(r)}_placingRootViolatesMaxDepth(e){const i=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return Iw(this._root,s=>(r=Math.max(r,s.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const i=e[3],r=e;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=n[l]-o-(r[l]-i),u=r[l]+i-(n[l]+o),d=Math.max(0,Math.ceil(c/(2*o))),f=Math.max(0,Math.ceil(u/(2*o)))+1,m=2**Math.ceil(Math.log(d+f)*Math.LOG2E);s=Math.max(s,m),h4[l].min=d,h4[l].max=f}for(let l=0;l<3;l++){let c=h4[l].min,u=h4[l].max;const d=(s-(c+u))/2;c+=Math.ceil(d),u+=Math.floor(d);const f=n[l]-o-c*o*2;Vq[l]=f+(u+c)*o}const a=s*o;return Vq[3]=a*hNe,Mo.acquire().initFrom(null,Vq,a,0)}_growRootAsSubNode(e){const i=this._root.node;ve(Dy,this._root.bounds),Dy[3]=this._root.halfSize,this._root.init(e),e.advanceTo(Dy,null,!0),e.node.children=i.children,e.node.residents=i.residents,e.node.terminals=i.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const i=this._root.node.children;let r=0,s=0;for(;s<i.length&&e==null;)r=s++,e=i[r];for(;s<i.length;)if(i[s++])return-1;return r}_isDegenerate(e){return!k$(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const i=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=i[0]-r&&e[0]<=i[0]+r&&e[1]>=i[1]-r&&e[1]<=i[1]+r&&e[2]>=i[2]-r&&e[2]<=i[2]+r}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:i,_objectCount:r}=this,s=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:i,objectCount:r,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:s}}}_nodeToJSON(e){var n,o;const i=e.children.map(a=>a?this._nodeToJSON(a):null),r=(n=e.residents)==null?void 0:n.map(a=>this.objectToBoundingSphere(a)),s=(o=e.terminals)==null?void 0:o.map(a=>this.objectToBoundingSphere(a));return{children:i,residents:r,terminals:s}}static fromJSON(e){const i=new XQ(r=>r,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return i._objectCount=e.objectCount,i._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),i}},Mo=class SC{constructor(){this.bounds=dn(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,i,r,s=this.depth){return this.node=e??SC.createEmptyNode(),i&&qS(i,this.bounds),this.halfSize=r,this.depth=s,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*hNe}advance(e){let i=this.node.children[e];i||(i=SC.createEmptyNode(),this.node.children[e]=i),this.node=i,this.halfSize/=2,this.depth++;const r=uNe[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,i,r=!1){for(;;){if(this.isTerminalFor(e))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const s=this._childIndex(e);i&&i(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const i=this.bounds;return(i[0]<e[0]?1:0)+(i[1]<e[1]?2:0)+(i[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new ai({shrink:!0}),residents:new ai({shrink:!0})}}static acquire(){return SC._pool.acquire()}static release(e){SC._pool.release(e)}static clearPool(){SC._pool.prune()}};function Iw(t,e){let i=Mo.acquire().init(t);const r=[i];for(;r.length!==0;){if(i=r.pop(),e(i)&&!i.isLeaf())for(let s=0;s<i.node.children.length;s++)i.node.children[s]&&r.push(Mo.acquire().init(i).advance(s));Mo.release(i)}}function oge(t,e,i,r=AB.DepthOrder.FRONT_TO_BACK){let s=Mo.acquire().init(t);const n=[s];for(z1t(i,r,cge);n.length!==0;){if(s=n.pop(),e(s)&&!s.isLeaf())for(let o=7;o>=0;--o){const a=cge[o];s.node.children[a]&&n.push(Mo.acquire().init(s).advance(a))}Mo.release(s)}}function D1t(t,e,i){zx.clear();const r=i.advanceTo(e,(s,n)=>{zx.push(s.node),zx.push(n)})?i.node.terminals:i.node.residents;if(r.removeUnordered(t),r.length===0)for(let s=zx.length-2;s>=0&&N1t(zx.data[s],zx.data[s+1]);s-=2);}function N1t(t,e){return e>=0&&(t.children[e]=null),!!cNe(t)&&(t.residents===null&&(t.residents=new ai({shrink:!0})),!0)}function F1t(t,e){return PB(e.bounds,2*-e.halfSize,fh),PB(e.bounds,2*e.halfSize,mh),IRe(t.origin,t.direction,fh,mh)}function k1t(t,e,i){return PB(e.bounds,2*-e.halfSize,fh),PB(e.bounds,2*e.halfSize,mh),i.applyToMinMax(fh,mh),IRe(t.origin,t.direction,fh,mh)}function cNe(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let e=0;e<t.children.length;e++)if(t.children[e])return!1;return!0}function U1t(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function V1t(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function PB(t,e,i){i[0]=t[0]+e,i[1]=t[1]+e,i[2]=t[2]+e}function age(t,e,i,r){if(e===1){const s=i(t[0]);qS(s,r)}else{fh[0]=1/0,fh[1]=1/0,fh[2]=1/0,mh[0]=-1/0,mh[1]=-1/0,mh[2]=-1/0;for(let s=0;s<e;s++){const n=i(t[s]);k$(n[3])&&(U1t(fh,n),V1t(mh,n))}xr(r,fh,mh,.5),r[3]=Math.max(mh[0]-fh[0],mh[1]-fh[1],mh[2]-fh[2])/2}}function z1t(t,e,i){if(!Bx.length)for(let r=0;r<8;++r)Bx.push({index:0,distance:0});for(let r=0;r<8;++r){const s=uNe[r];Bx.data[r].index=r,Bx.data[r].distance=_1(t,e,s)}Bx.sort((r,s)=>r.distance-s.distance);for(let r=0;r<8;++r)i[r]=Bx.data[r].index}function Uq(t,e){let i,r=1/0;for(let s=0;s<8;++s){const n=_1(t,e,lge[s]);n<r&&(r=n,i=lge[s])}return i}function _1(t,e,i){return e*(t[0]*i[0]+t[1]*i[1]+t[2]*i[2])}function k$(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}Mo._pool=new la(Mo),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(AB||(AB={}));const uNe=[Ge(-1,-1,-1),Ge(1,-1,-1),Ge(-1,1,-1),Ge(1,1,-1),Ge(-1,-1,1),Ge(1,-1,1),Ge(-1,1,1),Ge(1,1,1)],lge=[Ge(-1,-1,-1),Ge(-1,-1,1),Ge(-1,1,-1),Ge(-1,1,1),Ge(1,-1,-1),Ge(1,-1,1),Ge(1,1,-1),Ge(1,1,1)],hNe=Math.sqrt(3),JQ=[null];function B1t(t){return JQ[0]=t,JQ}const Vq=dn(),td=E(),fh=E(),mh=E(),zx=new ai,j1t=dn(),Dy=dn(),zq=dn(),Bq=dn(),h4=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],Bx=new ai,cge=[0,0,0,0,0,0,0,0],Of=AB;var ab;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(ab||(ab={}));let dNe=class extends VD{get objects(){return this._objects}constructor(e,i,r=""){super(),this.stage=e,this.apiLayerUid=r,this.type=Fs.Layer,this.events=new Us,this.visible=!0,this.pickable=!0,this.sliceable=!1,this._objects=new ai,this._objectsAdded=new ai,this._handles=new ly,this.apiLayerUid=r,this.visible=(i==null?void 0:i.visible)??!0,this.pickable=(i==null?void 0:i.pickable)??!0,this.updatePolicy=(i==null?void 0:i.updatePolicy)??ab.ASYNC,this._disableOctree=(i==null?void 0:i.disableOctree)??!1,e.add(this);for(const s of L1t)this._handles.add(this.events.on(s,n=>e.handleEvent(s,n)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const i of e)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const i=new Array;if(this._objects.removeUnorderedMany(e,e.length,i),i.length!==0){for(const r of i)r.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),this._octree!=null){for(let r=0;r<i.length;)this._objectsAdded.removeUnordered(i[r])?(i[r]=i[i.length-1],i.length-=1):++r;this._octree.remove(i)}}}sync(){this.updatePolicy!==ab.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,i){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,i)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new Of(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=qe(this._octree),this._objectsAdded.clear()}};function OB(t){return t!=null&&t.type===Fs.Layer}var Vc,r2;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(Vc||(Vc={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(r2||(r2={}));let bo=class extends Uc{constructor(){super(...arguments),this.output=j.Color,this.transparencyPassType=pt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=Vc.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=r2.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}get draped(){return this.space===Vc.Draped}};h([B({count:j.COUNT})],bo.prototype,"output",void 0),h([B({count:pt.COUNT})],bo.prototype,"transparencyPassType",void 0),h([B()],bo.prototype,"occluder",void 0),h([B()],bo.prototype,"hasSlicePlane",void 0),h([B()],bo.prototype,"writeDepth",void 0),h([B({count:Vc.COUNT})],bo.prototype,"space",void 0),h([B()],bo.prototype,"hideOnShortSegments",void 0),h([B()],bo.prototype,"hasCap",void 0),h([B({count:r2.COUNT})],bo.prototype,"anchor",void 0),h([B()],bo.prototype,"hasTip",void 0),h([B()],bo.prototype,"vvSize",void 0),h([B()],bo.prototype,"vvColor",void 0),h([B()],bo.prototype,"vvOpacity",void 0),h([B()],bo.prototype,"hasOccludees",void 0),h([B()],bo.prototype,"multipassEnabled",void 0),h([B()],bo.prototype,"cullAboveGround",void 0),h([B({constValue:!1})],bo.prototype,"occlusionPass",void 0),h([B({constValue:!0})],bo.prototype,"hasVvInstancing",void 0),h([B({constValue:!0})],bo.prototype,"hasSliceTranslatedView",void 0);const uge=8;function pNe(t,e){const i=t.vertex;i.uniforms.add(new et("intrinsicWidth",r=>r.width)),e.vvSize?(t.attributes.add(R.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new Wt("vvSizeMinSize",r=>r.vvSize.minSize),new Wt("vvSizeMaxSize",r=>r.vvSize.maxSize),new Wt("vvSizeOffset",r=>r.vvSize.offset),new Wt("vvSizeFactor",r=>r.vvSize.factor)),i.code.add(T`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(R.SIZE,"float"),i.code.add(T`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(R.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add(new Yl("vvOpacityValues",r=>r.vvOpacity.values,uge),new Yl("vvOpacityOpacities",r=>r.vvOpacity.opacityValues,uge)),i.code.add(T`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(T`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(e_,e),t.attributes.add(R.COLORFEATUREATTRIBUTE,"float"),i.code.add(T`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(R.COLOR,"vec4"),i.code.add(T`vec4 getColor(){
return applyOpacity(color);
}`))}let fNe=class{constructor(e,i,r){this._createTexture=e,this._parametersKey=i,this._repository=new Map,this._orphanCache=r.newCache(`procedural-texture-repository:${Ph()}`,s=>s.dispose())}destroy(){for(const[e,{texture:i}]of this._repository)i.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,i=null){const r=this._acquire(e);return this.release(i),r}release(e){if(e==null)return;const i=this._parametersKey(e),r=this._repository.get(i);if(r&&(r.refCount--,r.refCount===0)){this._repository.delete(i);const{texture:s}=r,n=s.usedMemory;this._orphanCache.put(i,s,n)}}_acquire(e){if(e==null)return null;const i=this._parametersKey(e),r=this._repository.get(i);if(r)return r.refCount++,r.texture;const s=this._orphanCache.pop(i)??this._createTexture(e),n=new G1t(s);return this._repository.set(i,n),s}},G1t=class{constructor(e){this.texture=e,this.refCount=1}};function H1t(t,e){return new fNe(i=>{const{encodedData:r,textureSize:s}=q1t(i),n=new Xr;return n.internalFormat=Ht.RGBA,n.width=s,n.height=1,n.wrapMode=Mi.REPEAT,new Er(t,n,r)},i=>`${i.pattern.join(",")}-r${i.pixelRatio}`,e)}function q1t(t){const e=Moe(t),i=1/t.pixelRatio,r=mNe(t),s=gNe(t),n=(Math.floor(.5*(s-1))+.5)*i,o=[];let a=1;for(const f of e){for(let m=0;m<f;m++){const g=a*(Math.min(m,f-1-m)+.5)*i/n*.5+.5;o.push(g)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],u=new Uint8Array(4*r);let d=0;for(const f of c)Kne(f,u,d),d+=4;return{encodedData:u,textureSize:r}}function Moe(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function mNe(t){if(t==null)return 1;const e=Moe(t);return Math.floor(e.reduce((i,r)=>i+r))}function gNe(t){return Moe(t).reduce((e,i)=>Math.max(e,i))}function W1t(t){return t==null?Rh:t.length===4?t:_s(Z1t,t[0],t[1],t[2],1)}const Z1t=ci();function Y1t(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?X1t(t,e):J1t(t)}function X1t(t,e){const i=!(e.draped&&e.stipplePreferContinuous),{vertex:r,fragment:s}=t;s.include(rm),e.draped||(Qf(r,e),r.uniforms.add(new et("worldToScreenPerDistanceRatio",(n,o)=>1/o.camera.perScreenPixelRatio)),r.code.add(T`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),t.varyings.add("vStippleDistanceLimits","vec2"),t.varyings.add("vStipplePatternStretch","float"),r.code.add(T`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${K1t};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(T`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(T`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),rO(r),r.code.add(T`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`),s.uniforms.add(new wt("stipplePatternTexture",n=>n.stippleTexture),new et("stipplePatternSDFNormalizer",n=>Q1t(n.stipplePattern)),new et("stipplePatternPixelSizeInv",n=>1/yNe(n))),s.code.add(T`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),e.stippleOffColorEnabled?(s.uniforms.add(new ji("stippleOffColor",n=>W1t(n.stippleOffColor))),s.code.add(T`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(T`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function J1t(t){t.fragment.code.add(T`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function Q1t(t){return t?(Math.floor(.5*(gNe(t)-1))+.5)/t.pixelRatio:1}function yNe(t){const e=t.stipplePattern;return e?mNe(t.stipplePattern)/e.pixelRatio:1}const K1t=T.float(.4);async function m_(t,e){const{data:i}=await yr(t,{responseType:"image",...e});return i}function ebt(){return hge??(hge=(async()=>{const t=await ce(()=>import("./basis_transcoder-B40h2JNH.js"),[]),e=await t.default({locateFile:i=>mr(`esri/libs/basisu/${i}`)});return e.initializeBasis(),e})()),hge}let hge;var TT;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(TT||(TT={}));let Uf=null,d4=null;async function _Ne(){return d4==null&&(d4=ebt(),Uf=await d4),d4}function tbt(t,e){if(Uf==null)return t.byteLength;const i=new Uf.BasisFile(new Uint8Array(t)),r=bNe(i)?vNe(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),e):0;return i.close(),i.delete(),r}function ibt(t,e){if(Uf==null)return t.byteLength;const i=new Uf.KTX2File(new Uint8Array(t)),r=wNe(i)?vNe(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),e):0;return i.close(),i.delete(),r}function vNe(t,e,i,r,s){const n=jse(e?Zs.COMPRESSED_RGBA8_ETC2_EAC:Zs.COMPRESSED_RGB8_ETC2),o=s&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(i*r*n*o)}function bNe(t){return t.getNumImages()>=1&&!t.isUASTC()}function wNe(t){return t.getFaces()>=1&&t.isETC1S()}async function rbt(t,e,i){Uf==null&&(Uf=await _Ne());const r=new Uf.BasisFile(new Uint8Array(i));if(!bNe(r))return null;r.startTranscoding();const s=xNe(t,e,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(n,o)=>r.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>r.transcodeImage(a,0,n,o,0,0));return r.close(),r.delete(),s}async function sbt(t,e,i){Uf==null&&(Uf=await _Ne());const r=new Uf.KTX2File(new Uint8Array(i));if(!wNe(r))return null;r.startTranscoding();const s=xNe(t,e,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(n,o)=>r.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>r.transcodeImage(a,n,0,0,o,0,-1,-1));return r.close(),r.delete(),s}function xNe(t,e,i,r,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[u,d]=l?r?[TT.ETC2_RGBA,Zs.COMPRESSED_RGBA8_ETC2_EAC]:[TT.ETC1_RGB,Zs.COMPRESSED_RGB8_ETC2]:c?r?[TT.BC3_RGBA,Zs.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[TT.BC1_RGB,Zs.COMPRESSED_RGB_S3TC_DXT1_EXT]:[TT.RGBA32,Ht.RGBA],f=e.hasMipmap?i:Math.min(1,i),m=[];for(let g=0;g<f;g++)m.push(new Uint8Array(o(g,u))),a(g,u,m[g]);return e.internalFormat=d,e.hasMipmap=m.length>1,e.samplingMode=e.hasMipmap?di.LINEAR_MIPMAP_LINEAR:di.LINEAR,e.width=s,e.height=n,new Er(t,e,{type:"compressed",levels:m})}const p4=()=>se.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),nbt=542327876,obt=131072,abt=4;function Aoe(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function lbt(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const cbt=Aoe("DXT1"),ubt=Aoe("DXT3"),hbt=Aoe("DXT5"),dbt=31,pbt=0,fbt=1,mbt=2,gbt=3,ybt=4,_bt=7,vbt=20,bbt=21;function wbt(t,e,i){const r=xbt(i,e.hasMipmap??!1);if(r==null)throw new Error("DDS texture data is null");const{textureData:s,internalFormat:n,width:o,height:a}=r;return e.samplingMode=s.levels.length>1?di.LINEAR_MIPMAP_LINEAR:di.LINEAR,e.hasMipmap=s.levels.length>1,e.internalFormat=n,e.width=o,e.height=a,new Er(t,e,s)}function xbt(t,e){const i=new Int32Array(t,0,dbt);if(i[pbt]!==nbt)return p4().error("Invalid magic number in DDS header"),null;if(!(i[vbt]&abt))return p4().error("Unsupported format, must contain a FourCC code"),null;const r=i[bbt];let s,n;switch(r){case cbt:s=8,n=Zs.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case ubt:s=16,n=Zs.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case hbt:s=16,n=Zs.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return p4().error("Unsupported FourCC code:",lbt(r)),null}let o=1,a=i[ybt],l=i[gbt];(3&a||3&l)&&(p4().warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let d,f;i[mbt]&obt&&e!==!1&&(o=Math.max(1,i[_bt]));let m=i[fbt]+4;const g=[];for(let y=0;y<o;++y)f=(a+3>>2)*(l+3>>2)*s,d=new Uint8Array(t,m,f),g.push(d),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:g},internalFormat:n,width:c,height:u}}let Vb=class extends VD{get parameters(){return this._parameters}constructor(e,i){super(),this._data=e,this.type=Fs.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new Us,this._parameters={...Sbt,...i},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?(this.frameUpdate=i=>this._frameUpdate(e,i),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(MA(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const i=!e.paused;if(e.src=e.src,i&&e.autoplay){const r=()=>{e.removeEventListener("canplay",r),e.play()};e.addEventListener("canplay",r)}}}_startPreloadImageElement(e){cy(e.src)||MA(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const i=new Xr;return i.wrapMode=this._parameters.wrap??Mi.REPEAT,i.flipped=!this._parameters.noUnpackFlip,i.samplingMode=this._parameters.mipmap?di.LINEAR_MIPMAP_LINEAR:di.LINEAR,i.hasMipmap=!!this._parameters.mipmap,i.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,i.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),i}get glTexture(){return this._glTexture}get memoryEstimate(){var e;return((e=this._glTexture)==null?void 0:e.usedMemory)||Tbt(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const i=this._data;return i==null?(this._glTexture=new Er(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),typeof i=="string"?this._loadFromURL(e,i):i instanceof Image?this._loadFromImageElement(e,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(e,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(e,i):($R(i)||N1(i))&&this._parameters.encoding===X0.DDS_ENCODING?this._loadFromDDSData(e,i):($R(i)||N1(i))&&this._parameters.encoding===X0.KTX2_ENCODING?this._loadFromKTX2(e,i):($R(i)||N1(i))&&this._parameters.encoding===X0.BASIS_ENCODING?this._loadFromBasis(e,i):N1(i)?this._loadFromPixelData(e,i):$R(i)?this._loadFromPixelData(e,new Uint8Array(i)):null)}_frameUpdate(e,i){return this._glTexture==null||e.readyState<v3.HAVE_CURRENT_DATA||i===e.currentTime?i:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,i){return this._glTexture=wbt(e,this._createDescriptor(e),i),this._glTexture}_loadFromKTX2(e,i){return this._loadAsync(()=>sbt(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(e,i){return this._loadAsync(()=>rbt(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(e,i){vt(this._parameters.width>0&&this._parameters.height>0);const r=this._createDescriptor(e);return r.pixelFormat=this._parameters.components===1?Ht.LUMINANCE:this._parameters.components===3?Ht.RGB:Ht.RGBA,r.width=this._parameters.width??0,r.height=this._parameters.height??0,this._glTexture=new Er(e,r,i),this._glTexture}_loadFromURL(e,i){return this._loadAsync(async r=>{const s=await m_(i,{signal:r});return Dt(r),this._loadFromImage(e,s)})}_loadFromImageElement(e,i){return i.complete?this._loadFromImage(e,i):this._loadAsync(async r=>{const s=await C2e(i,i.src,!1,r);return Dt(r),this._loadFromImage(e,s)})}_loadFromVideoElement(e,i){return i.readyState>=v3.HAVE_CURRENT_DATA?this._loadFromImage(e,i):this._loadFromVideoElementAsync(e,i)}_loadFromVideoElementAsync(e,i){return this._loadAsync(r=>new Promise((s,n)=>{const o=()=>{i.removeEventListener("loadeddata",a),i.removeEventListener("error",l),$r(c)},a=()=>{i.readyState>=v3.HAVE_CURRENT_DATA&&(o(),s(this._loadFromImage(e,i)))},l=u=>{o(),n(u||new G("Failed to load video"))};i.addEventListener("loadeddata",a),i.addEventListener("error",l);const c=Ra(r,()=>l(ki()))}))}_loadFromImage(e,i){let r=i;if(!(r instanceof HTMLVideoElement)){const{maxTextureSize:o}=e.parameters;r=this._parameters.downsampleUncompressed?Nct(r,o):Fct(r,o)}const s=TNe(r);this._parameters.width=s.width,this._parameters.height=s.height;const n=this._createDescriptor(e);return n.pixelFormat=this._parameters.components===3?Ht.RGB:Ht.RGBA,n.width=s.width,n.height=s.height,this._glTexture=new Er(e,n,r),this._glTexture}_loadAsync(e){const i=new AbortController;this._loadingController=i;const r=e(i.signal);this._loadingPromise=r;const s=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(s,s),r}unload(){if(this._glTexture=Ut(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};function Tbt(t,e){if(t==null)return 0;if($R(t)||N1(t))return e.encoding===X0.KTX2_ENCODING?ibt(t,!!e.mipmap):e.encoding===X0.BASIS_ENCODING?tbt(t,!!e.mipmap):t.byteLength;const{width:i,height:r}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?TNe(t):e;return(e.mipmap?4/3:1)*i*r*(e.components||4)||0}function TNe(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var v3;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(v3||(v3={}));const Sbt={wrap:{s:Mi.REPEAT,t:Mi.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1},RB=128,Poe=.5;function Ebt(t){return t==="cross"||t==="x"}function Cbt(t,e=RB,i=e*Poe,r=0){const s=SNe(t,e,i,r);return new Vb(s,{mipmap:!1,wrap:{s:Mi.CLAMP_TO_EDGE,t:Mi.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0,reloadable:!0})}function SNe(t,e=RB,i=e*Poe,r=0){switch(t){case"circle":default:return Mbt(e,i);case"square":return Abt(e,i);case"cross":return Obt(e,i,r);case"x":return Rbt(e,i,r);case"kite":return Pbt(e,i);case"triangle":return $bt(e,i);case"arrow":return Ibt(e,i)}}function Mbt(t,e){const i=t/2-.5;return nN(t,MNe(i,i,e/2))}function Abt(t,e){return ENe(t,e,!1)}function Pbt(t,e){return ENe(t,e,!0)}function Obt(t,e,i=0){return CNe(t,e,!1,i)}function Rbt(t,e,i=0){return CNe(t,e,!0,i)}function $bt(t,e){return nN(t,ANe(t/2,e,e/2))}function Ibt(t,e){const i=e,r=e/2,s=t/2,n=.8*i,o=MNe(s,(t-e)/2-n,Math.sqrt(n*n+r*r)),a=ANe(s,i,r);return nN(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function ENe(t,e,i){return i&&(e/=Math.SQRT2),nN(t,(r,s)=>{let n=r-.5*t+.25,o=.5*t-s-.75;if(i){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*e})}function CNe(t,e,i,r=0){e-=r,i&&(e*=Math.SQRT2);const s=.5*e;return nN(t,(n,o)=>{let a,l=n-.5*t,c=.5*t-o-1;if(i){const u=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=u}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=r/2,a})}function MNe(t,e,i){return(r,s)=>{const n=r-t,o=s-e;return Math.sqrt(n*n+o*o)-i}}function ANe(t,e,i){const r=Math.sqrt(e*e+i*i);return(s,n)=>{const o=Math.abs(s-t)-i,a=n-t+e/2+.75,l=(e*o+i*a)/r,c=-a;return Math.max(l,c)}}function nN(t,e){const i=new Uint8Array(4*t*t);for(let r=0;r<t;r++)for(let s=0;s<t;s++){const n=s+t*r;let o=e(s,r);o=o/t+.5,Kne(o,i,4*n)}return i}const vS=64,Ooe=vS/2,PNe=Ooe/5,Lbt=vS/PNe,Dbt=.25;function Nbt(t,e){const i=SNe(t,vS,Ooe,PNe),r=new Xr;return r.internalFormat=Ht.RGBA,r.width=vS,r.height=vS,r.wrapMode=Mi.CLAMP_TO_EDGE,new Er(e,r,i)}function ONe(t,e){const{vertex:i,constants:r}=t;r.add("markerSizePerLineWidth","float",Lbt),rO(i),i.uniforms.get("markerScale")==null&&i.constants.add("markerScale","float",1),i.code.add(T`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===Vc.World&&(i.constants.add("maxSegmentLengthFraction","float",.45),i.uniforms.add(new et("perRenderPixelRatio",(s,n)=>n.camera.perRenderPixelRatio)),i.code.add(T`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var Jd;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(Jd||(Jd={}));let Rs=class extends Uc{constructor(){super(...arguments),this.output=j.Color,this.capType=Jd.BUTT,this.transparencyPassType=pt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};h([B({count:j.COUNT})],Rs.prototype,"output",void 0),h([B({count:Jd.COUNT})],Rs.prototype,"capType",void 0),h([B({count:pt.COUNT})],Rs.prototype,"transparencyPassType",void 0),h([B()],Rs.prototype,"occluder",void 0),h([B()],Rs.prototype,"hasSlicePlane",void 0),h([B()],Rs.prototype,"hasPolygonOffset",void 0),h([B()],Rs.prototype,"writeDepth",void 0),h([B()],Rs.prototype,"draped",void 0),h([B()],Rs.prototype,"stippleEnabled",void 0),h([B()],Rs.prototype,"stippleOffColorEnabled",void 0),h([B()],Rs.prototype,"stipplePreferContinuous",void 0),h([B()],Rs.prototype,"roundJoins",void 0),h([B()],Rs.prototype,"applyMarkerOffset",void 0),h([B()],Rs.prototype,"vvSize",void 0),h([B()],Rs.prototype,"vvColor",void 0),h([B()],Rs.prototype,"vvOpacity",void 0),h([B()],Rs.prototype,"falloffEnabled",void 0),h([B()],Rs.prototype,"innerColorEnabled",void 0),h([B()],Rs.prototype,"hasOccludees",void 0),h([B()],Rs.prototype,"multipassEnabled",void 0),h([B()],Rs.prototype,"cullAboveGround",void 0),h([B()],Rs.prototype,"wireframe",void 0),h([B()],Rs.prototype,"objectAndLayerIdColorInstanced",void 0),h([B({constValue:!1})],Rs.prototype,"occlusionPass",void 0),h([B({constValue:!0})],Rs.prototype,"hasVvInstancing",void 0),h([B({constValue:!0})],Rs.prototype,"hasSliceTranslatedView",void 0);const LL=1;function RNe(t){const e=new Hi,{attributes:i,varyings:r,constants:s,vertex:n,fragment:o}=e;e.include(ND),e.include(pNe,t),e.include(Y1t,t);const a=t.applyMarkerOffset&&!t.draped;a&&(n.uniforms.add(new et("markerScale",g=>g.markerScale)),e.include(ONe,{space:Vc.World,draped:!1})),e.include(L2,t),Nc(n,t),n.uniforms.add(new us("inverseProjectionMatrix",(g,y)=>y.camera.inverseProjectionMatrix),new jr("nearFar",(g,y)=>y.camera.nearFar),new et("miterLimit",g=>g.join!=="miter"?0:g.miterLimit),new ji("viewport",(g,y)=>y.camera.fullViewport)),n.constants.add("LARGE_HALF_FLOAT","float",65500),i.add(R.POSITION,"vec3"),i.add(R.PREVPOSITION,"vec3"),i.add(R.NEXTPOSITION,"vec3"),i.add(R.SUBDIVISIONFACTOR,"float"),i.add(R.UV0,"vec2"),r.add("vColor","vec4"),r.add("vpos","vec3"),r.add("vLineDistance","float"),r.add("vLineWidth","float");const l=t.multipassEnabled&&t.output===j.Color;l&&r.add("depth","float");const c=t.stippleEnabled;c&&r.add("vLineSizeInv","float"),s.add("aaWidth","float",t.stippleEnabled?0:1);const u=t.capType===Jd.ROUND,d=t.stippleEnabled&&u,f=t.falloffEnabled||d;f&&r.add("vLineDistanceNorm","float"),u&&(r.add("vSegmentSDF","float"),r.add("vReverseSegmentSDF","float")),n.code.add(T`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),n.code.add(T`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),n.code.add(T`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${l?"depth = pos.z;":""}

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),rO(n),n.code.add(T`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;
      float lineSize = getSize();

      if (lineSize < 1.0) {
        coverage = lineSize; // convert sub-pixel coverage to alpha
        lineSize = 1.0;
      }
      lineSize += aaWidth;

      float lineWidth = lineSize * pixelRatio;
      vLineWidth = lineWidth;
      ${c?T`vLineSizeInv = 1.0 / lineSize;`:""}

      vec4 pos  = view * vec4(position, 1.0);
      vec4 prev = view * vec4(prevPosition, 1.0);
      vec4 next = view * vec4(nextPosition, 1.0);
  `),a&&n.code.add(T`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),n.code.add(T`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||u)&&n.code.add(T`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${u?T`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),n.code.add(T`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?n.code.add(T`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?T`min(1.0, subdivisionFactor * ${T.float((LL+2)/(LL+1))})`:T`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):n.code.add(T`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const m=t.capType!==Jd.BUTT;return n.code.add(T`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${m?T`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),n.code.add(T`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;
    float lineDistNorm = sign(uv0.y) * pos.w;

    vLineDistance =  lineWidth * lineDistNorm;
    ${f?T`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),u&&n.code.add(T`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?n.uniforms.add(new et("worldToScreenRatio",(g,y)=>1/y.screenToPCSRatio)):n.code.add(T`vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),n.code.add(T`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?n.code.add(T`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):n.code.add(T`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),n.uniforms.add(new et("stipplePatternPixelSize",g=>yNe(g))),n.code.add(T`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),n.code.add(T`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),l&&e.include(xy,t),e.include(bn,t),o.include(by),o.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${l?"terrainDepthTest(depth);":""}
  `),t.wireframe?o.code.add(T`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(u&&o.code.add(T`
        float sdf = min(vSegmentSDF, vReverseSegmentSDF);
        vec2 fragmentPosition = vec2(
          min(sdf, 0.0),
          vLineDistance
        ) * gl_FragCoord.w;

        float fragmentRadius = length(fragmentPosition);
        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

        if (capCoverage < ${T.float(ea)}) {
          discard;
        }
      `),d?o.code.add(T`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${T.float(ea)}, stippleCoverage);
      `):o.code.add(T`float stippleAlpha = getStippleAlpha();`),t.output!==j.ObjectAndLayerIdColor&&o.code.add(T`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),o.uniforms.add(new ji("intrinsicColor",g=>g.color)),o.code.add(T`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(o.uniforms.add(new ji("innerColor",g=>g.innerColor??g.color),new et("innerWidth",(g,y)=>g.innerWidth*y.camera.pixelRatio)),o.code.add(T`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),o.code.add(T`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(o.uniforms.add(new et("falloff",g=>g.falloff)),o.code.add(T`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)),t.stippleEnabled||o.code.add(T`float featherStartDistance = max(vLineWidth - 2.0, 0.0);
float value = abs(vLineDistance) * gl_FragCoord.w;
float feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);
finalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);`)),t.transparencyPassType===pt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),o.code.add(T`
    ${t.output===j.ObjectAndLayerIdColor?T`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${T.float(ea)}) {
      discard;
    }

    ${t.output===j.Color?T`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===j.Color&&t.transparencyPassType===pt.ColorAlpha?T`
            fragColor = premultiplyAlpha(fragColor);
            fragAlpha = fragColor.a;`:""}
    ${t.output===j.Highlight?T`fragColor = vec4(1.0);`:""}
    ${t.output===j.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const Fbt=Object.freeze(Object.defineProperty({__proto__:null,build:RNe,ribbonlineNumRoundJoinSubdivisions:LL},Symbol.toStringTag,{value:"Module"})),$Ne=new Map([[R.POSITION,0],[R.PREVPOSITION,1],[R.NEXTPOSITION,2],[R.SUBDIVISIONFACTOR,3],[R.UV0,4],[R.COLOR,5],[R.COLORFEATUREATTRIBUTE,5],[R.SIZE,6],[R.SIZEFEATUREATTRIBUTE,6],[R.OPACITYFEATUREATTRIBUTE,7],[R.OBJECTANDLAYERIDCOLOR,8]]);let INe=class LNe extends Qi{initializeProgram(e){return new Ki(e.rctx,LNe.shader.get().build(this.configuration),$Ne)}_makePipelineState(e,i){const r=this.configuration,s=e===pt.NONE,n=e===pt.FrontFace,o=Qut(r.output);return Jt({blending:r.output===j.Color?s?Ru:$_(e):null,depthTest:{func:sw(e)},depthWrite:s?r.writeDepth||o?Nu:null:_6(e),drawBuffers:r.output===j.Depth?{buffers:[no.NONE]}:I_(e),colorWrite:ui,stencilWrite:r.hasOccludees?oy:null,stencilTest:r.hasOccludees?i?kb:nw:null,polygonOffset:s||n?r.hasPolygonOffset?dge:null:b6})}initializePipeline(){const e=this.configuration;if(e.occluder){const i=e.hasPolygonOffset?dge:null;this._occluderPipelineTransparent=Jt({blending:Ru,polygonOffset:i,depthTest:TB,depthWrite:null,colorWrite:ui,stencilWrite:null,stencilTest:zLe,drawBuffers:e.output===j.Depth?{buffers:[no.NONE]}:null}),this._occluderPipelineOpaque=Jt({blending:Ru,polygonOffset:i,depthTest:TB,depthWrite:null,colorWrite:ui,stencilWrite:ULe,stencilTest:VLe,drawBuffers:e.output===j.Depth?{buffers:[no.NONE]}:null}),this._occluderPipelineMaskWrite=Jt({blending:null,polygonOffset:i,depthTest:ooe,depthWrite:null,colorWrite:null,stencilWrite:oy,stencilTest:kb,drawBuffers:e.output===j.Depth?{buffers:[no.NONE]}:null})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Ci.LINES:Ci.TRIANGLE_STRIP}getPipeline(e,i,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:i?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};INe.shader=new qi(Fbt,()=>ce(()=>Promise.resolve().then(()=>xHt),void 0));const dge={factor:0,units:-4};var au;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(au||(au={}));let wM=class extends iw{constructor(e){super(e,new Ubt),this._configuration=new Rs,this.produces=new Map([[Pe.OPAQUE_MATERIAL,i=>i===j.Highlight||i===j.ObjectAndLayerIdColor||i===j.Color&&this.parameters.renderOccluded===er.OccludeAndTransparentStencil],[Pe.OPAQUE_NO_SSAO_DEPTH,i=>nb(i)],[Pe.OCCLUDER_MATERIAL,i=>MJ(i)&&this.parameters.renderOccluded===er.OccludeAndTransparentStencil],[Pe.TRANSPARENT_OCCLUDER_MATERIAL,i=>MJ(i)&&this.parameters.renderOccluded===er.OccludeAndTransparentStencil],[Pe.TRANSPARENT_MATERIAL,i=>i===j.Color&&this.parameters.writeDepth&&this.parameters.renderOccluded!==er.OccludeAndTransparentStencil],[Pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>i===j.Color&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==er.OccludeAndTransparentStencil],[Pe.DRAPED_MATERIAL,i=>k$e(i)]]),this._vertexAttributeLocations=$Ne}getConfiguration(e,i){this._configuration.output=e,this._configuration.draped=i.slot===Pe.DRAPED_MATERIAL;const r=this.parameters.stipplePattern!=null&&e!==j.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&this.parameters.stippleOffColor!=null,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&zbt(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===er.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,i,r,s,n,o){if(!r.options.selectionMode)return;const a=e.attributes.get(R.POSITION).data,l=e.attributes.get(R.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const y=e.attributes.get(R.SIZEFEATUREATTRIBUTE).data[0];c*=Ne(this.parameters.vvSize.offset[0]+y*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const u=s[0],d=s[1],f=(c/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,g=0;for(let y=0;y<a.length-5;y+=3){const v=a[y],b=a[y+1],w=u-v,x=d-b,S=a[y+3]-v,C=a[y+4]-b,M=Ne((S*w+C*x)/(S*S+C*C),0,1),O=S*M-w,D=C*M-x,U=O*O+D*D;U<m&&(m=U,g=y/3)}m<f*f&&n(o.dist,o.normal,g,!1)}intersect(e,i,r,s,n,o){if(!r.options.selectionMode||!e.visible)return;if(!LRe(i))return void se.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes,l=a.get(R.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const w=a.get(R.SIZEFEATUREATTRIBUTE).data[0];c*=Ne(this.parameters.vvSize.offset[0]+w*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(R.SIZE)&&(c*=a.get(R.SIZE).data[0]);const u=r.camera,d=Bbt;Da(d,r.point);const f=c*u.pixelRatio/2+4*u.pixelRatio;de(sR[0],d[0]-f,d[1]+f,0),de(sR[1],d[0]+f,d[1]+f,0),de(sR[2],d[0]+f,d[1]-f,0),de(sR[3],d[0]-f,d[1]-f,0);for(let w=0;w<4;w++)if(!u.unprojectFromRenderScreen(sR[w],Ny[w]))return;il(u.eye,Ny[0],Ny[1],Gq),il(u.eye,Ny[1],Ny[2],Hq),il(u.eye,Ny[2],Ny[3],qq),il(u.eye,Ny[3],Ny[0],Wq);let m=Number.MAX_VALUE,g=0;const y=DNe(this.parameters,a)?l.length-2:l.length-5;for(let w=0;w<y;w+=3){oc[0]=l[w]+i[12],oc[1]=l[w+1]+i[13],oc[2]=l[w+2]+i[14];const x=(w+3)%l.length;if(ac[0]=l[x]+i[12],ac[1]=l[x+1]+i[13],ac[2]=l[x+2]+i[14],Or(Gq,oc)<0&&Or(Gq,ac)<0||Or(Hq,oc)<0&&Or(Hq,ac)<0||Or(qq,oc)<0&&Or(qq,ac)<0||Or(Wq,oc)<0&&Or(Wq,ac)<0)continue;if(u.projectToRenderScreen(oc,Dw),u.projectToRenderScreen(ac,Nw),Dw[2]<0&&Nw[2]>0){Re(fm,oc,ac);const C=u.frustum,M=-Or(C[Tr.NEAR],oc)/Te(fm,C[Tr.NEAR]);he(fm,fm,M),Ee(oc,oc,fm),u.projectToRenderScreen(oc,Dw)}else if(Dw[2]>0&&Nw[2]<0){Re(fm,ac,oc);const C=u.frustum,M=-Or(C[Tr.NEAR],ac)/Te(fm,C[Tr.NEAR]);he(fm,fm,M),Ee(ac,ac,fm),u.projectToRenderScreen(ac,Nw)}else if(Dw[2]<0&&Nw[2]<0)continue;Dw[2]=0,Nw[2]=0;const S=Fre(dS(Dw,Nw,mge),d);S<m&&(m=S,ve(pge,oc),ve(fge,ac),g=w/3)}const v=r.rayBegin,b=r.rayEnd;if(m<f*f){let w=Number.MAX_VALUE;if(zMe(dS(pge,fge,mge),dS(v,b,jbt),Lw)){Re(Lw,Lw,v);const x=Ve(Lw);he(Lw,Lw,1/x),w=x/Cr(v,b)}o(w,Lw,g,!1)}}get _layout(){const e=As().vec3f(R.POSITION).vec3f(R.PREVPOSITION).vec3f(R.NEXTPOSITION).f32(R.SUBDIVISIONFACTOR).vec2f(R.UV0);return this.parameters.vvSize?e.f32(R.SIZEFEATUREATTRIBUTE):e.f32(R.SIZE),this.parameters.vvColor?e.f32(R.COLORFEATUREATTRIBUTE):e.vec4f(R.COLOR),this.parameters.vvOpacity&&e.f32(R.OPACITYFEATUREATTRIBUTE),le("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(R.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new Vbt(this._layout,this.parameters)}createGLMaterial(e){return new kbt(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},kbt=class extends ew{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextures.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===j.Color&&this._updateOccludeeState(e);const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters({stippleTexture:this._stippleTextures.swap(i,this._stipplePattern)}),this._stipplePattern=i),this.ensureTechnique(INe,e)}},Ubt=class extends HD{constructor(){super(...arguments),this.width=0,this.color=Ud,this.join="miter",this.cap=Jd.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},Vbt=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i,this.numJoinSubdivisions=0;const r=i.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=LL+r}}_isClosed(e){return DNe(this._parameters,e.attributes)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const r=e.attributes.get(R.POSITION).indices.length/2+1,s=this._isClosed(e);let n=s?2:2*2;return n+=((s?r:r-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(e,i,r,s,n){var ye,L,N;const o=Gbt,a=Hbt,l=qbt,c=r.attributes.get(R.POSITION),u=c.indices,d=c.data.length/3,f=(ye=r.attributes.get(R.DISTANCETOSTART))==null?void 0:ye.data;u&&u.length!==2*(d-1)&&console.warn("RibbonLineMaterial does not support indices");const m=((L=r.attributes.get(R.SIZEFEATUREATTRIBUTE))==null?void 0:L.data[0])??((N=r.attributes.get(R.SIZE))==null?void 0:N.data[0])??1;let g=[1,1,1,1],y=0;const v=this.vertexBufferLayout.fields.has(R.COLORFEATUREATTRIBUTE);v?y=r.attributes.get(R.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has(R.COLOR)&&(g=r.attributes.get(R.COLOR).data);const b=le("enable-feature:objectAndLayerId-rendering")?r.objectAndLayerIdColor:null,w=this.vertexBufferLayout.fields.has(R.OPACITYFEATUREATTRIBUTE),x=w?r.attributes.get(R.OPACITYFEATUREATTRIBUTE).data[0]:0,S=new Float32Array(s.buffer),C=le("enable-feature:objectAndLayerId-rendering")?new Uint8Array(s.buffer):null,M=this.vertexBufferLayout.stride/4;let O=n*M;const D=O;let U=0;const k=f?(z,W,J)=>U=f[J]:(z,W,J)=>U+=Cr(z,W),H=le("enable-feature:objectAndLayerId-rendering"),V=(z,W,J,K,ne,we,Ie)=>{if(S[O++]=W[0],S[O++]=W[1],S[O++]=W[2],S[O++]=z[0],S[O++]=z[1],S[O++]=z[2],S[O++]=J[0],S[O++]=J[1],S[O++]=J[2],S[O++]=K,S[O++]=Ie,S[O++]=ne,S[O++]=m,v)S[O++]=y;else{const je=Math.min(4*we,g.length-4);S[O++]=g[je],S[O++]=g[je+1],S[O++]=g[je+2],S[O++]=g[je+3]}w&&(S[O++]=x),H&&(b!=null&&(C[4*O]=b[0],C[4*O+1]=b[1],C[4*O+2]=b[2],C[4*O+3]=b[3]),O++)};O+=M,de(a,c.data[0],c.data[1],c.data[2]),e&&nt(a,a,e);const X=this._isClosed(r);if(X){const z=c.data.length-3;de(o,c.data[z],c.data[z+1],c.data[z+2]),e&&nt(o,o,e)}else de(l,c.data[3],c.data[4],c.data[5]),e&&nt(l,l,e),V(a,a,l,1,au.LEFT_CAP_START,0,0),V(a,a,l,1,au.RIGHT_CAP_START,0,0),ve(o,a),ve(a,l);const q=X?0:1,Z=X?d:d-1;for(let z=q;z<Z;z++){const W=(z+1)%d*3;de(l,c.data[W],c.data[W+1],c.data[W+2]),e&&nt(l,l,e),k(o,a,z),V(o,a,l,0,au.LEFT_JOIN_END,z,U),V(o,a,l,0,au.RIGHT_JOIN_END,z,U);const J=this.numJoinSubdivisions;for(let K=0;K<J;++K){const ne=(K+1)/(J+1);V(o,a,l,ne,au.LEFT_JOIN_END,z,U),V(o,a,l,ne,au.RIGHT_JOIN_END,z,U)}V(o,a,l,1,au.LEFT_JOIN_START,z,U),V(o,a,l,1,au.RIGHT_JOIN_START,z,U),ve(o,a),ve(a,l)}X?(de(l,c.data[3],c.data[4],c.data[5]),e&&nt(l,l,e),U=k(o,a,Z),V(o,a,l,0,au.LEFT_JOIN_END,q,U),V(o,a,l,0,au.RIGHT_JOIN_END,q,U)):(U=k(o,a,Z),V(o,a,a,0,au.LEFT_CAP_END,Z,U),V(o,a,a,0,au.RIGHT_CAP_END,Z,U)),jq(S,D+M,S,D,M),O=jq(S,O-M,S,O,M),this._parameters.wireframe&&this._addWireframeVertices(s,D,O,M)}_addWireframeVertices(e,i,r,s){const n=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let a=0;const l=c=>a=jq(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}};function jq(t,e,i,r,s){for(let n=0;n<s;n++)i[r++]=t[e++];return r}function DNe(t,e){return t.isClosed?e.get(R.POSITION).indices.length>2:!1}function zbt(t){return t.anchor===r2.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const oc=E(),ac=E(),fm=E(),Lw=E(),Bbt=E(),Dw=Pa(),Nw=Pa(),pge=E(),fge=E(),mge=im(),jbt=im(),Gbt=E(),Hbt=E(),qbt=E(),sR=[Pa(),Pa(),Pa(),Pa()],Ny=[E(),E(),E(),E()],Gq=tr(),Hq=tr(),qq=tr(),Wq=tr();let NNe=class{constructor(e){this._originSR=e,this._rootOriginId="root/"+Ph(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const i=this._origins.get(this._rootOriginId);if(i==null){const u=MB(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,u),u}const r=this._gridSize,s=Math.round(e[0]/r),n=Math.round(e[1]/r),o=Math.round(e[2]/r),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*r;if(Re(Bo,e,i.vec3),Bo[0]=Math.abs(Bo[0]),Bo[1]=Math.abs(Bo[1]),Bo[2]=Math.abs(Bo[2]),Bo[0]<c&&Bo[1]<c&&Bo[2]<c){if(l){const u=Math.max(...Bo);if(Re(Bo,e,l.vec3),Bo[0]=Math.abs(Bo[0]),Bo[1]=Math.abs(Bo[1]),Bo[2]=Math.abs(Bo[2]),Math.max(...Bo)<u)return l}return i}return l||(l=MB(s*r,n*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(e,i=ii(1,1,0,1)){const r=window.view,s=r._stage,n=i.toString();if(!this._objects.has(n)){this._material=new wM({width:2,color:i}),s.add(this._material);const m=new dNe(s,{pickable:!1}),g=new ow({castShadow:!1});s.add(g),m.add(g),this._objects.set(n,g)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),u=new Array,d=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m]=e[0]+(1&a[m]?d:-d),c[3*m+1]=e[1]+(2&a[m]?d:-d),c[3*m+2]=e[2]+(4&a[m]?d:-d),m>0&&u.push(m-1,m);ds(c,this._originSR,0,c,r.renderSpatialReference,0,l);const f=new Tn(this._material,[[R.POSITION,new ht(c,u,3,!0)]],null,Fs.Line);s.add(f),o.addGeometry(f)}get test(){}};const Bo=E();let FNe=class{constructor(e,i,r=null){this.rctx=e,this.sliceHelper=r,this.lastFrameCamera=new Dr,this.output=j.Color,this.renderOccludedMask=$B,this.bindParameters=new YG(i,r!=null?r.plane:null),this.bindParameters.alignPixelEnabled=!0}},Wbt=class extends FNe{constructor(e,i,r,s){super(e,r,s),this.offscreenRenderingHelper=i,this.sliceHelper=s,this.time=0}};const $B=er.Occlude|er.OccludeAndTransparent|er.OccludeAndTransparentStencil;let U$=class extends Dr{constructor(){super(...arguments),this._projectionMatrix=ke()}get projectionMatrix(){return this._projectionMatrix}};h([p()],U$.prototype,"_projectionMatrix",void 0),h([p({readOnly:!0})],U$.prototype,"projectionMatrix",null),U$=h([I("esri.views.3d.webgl-engine.lib.CascadeCamera")],U$);var s2;(function(t){t[t.Highlight=0]="Highlight",t[t.ExcludeHighlight=1]="ExcludeHighlight"})(s2||(s2={}));let f4=class{constructor(){this.camera=new U$,this.lightMat=ke()}},Zbt=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},Roe=class{constructor(e,i){this._fbos=e,this._viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new Zbt,this._projectionView=ke(),this._projectionViewInverse=ke(),this._modelViewLight=ke(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=ci(),this._cascades=[new f4,new f4,new f4,new f4],this._lastOrigin=null,this._maxTextureWidth=Math.min(le("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){var e;return(e=this._handle)==null?void 0:e.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return _s(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=hi(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=Ne(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}get cascades(){for(let e=0;e<this._numCascades;++e)Yq[e]=this._cascades[e];return Yq.length=this._numCascades,Yq}start(e,i,r,s,n){vt(this.enabled);const{near:o,far:a}=ewt(r);this._computeCascadeDistances(o,a,s),this._textureHeight=this._computeTextureHeight(e,n,s),this._setupMatrices(e,i);const{viewMatrix:l,projectionMatrix:c}=e;for(let u=0;u<this._numCascades;++u)this._constructCascade(u,c,l,i);this._lastOrigin=null,this.clear()}finish(){var e;vt(this.enabled),(e=this._handle)==null||e.detachDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!$o(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||E(),ve(this._lastOrigin,e);for(let i=0;i<this._numCascades;++i){dl(wge,this._cascades[i].lightMat,e);for(let r=0;r<16;++r)xge[16*i+r]=wge[r]}}return xge}moveSnapshot(e){var i,r;vt(this.enabled),(i=this._handle)==null||i.detachDepth(),(r=this._snapshots[e])==null||r.release(),this._snapshots[e]=this._handle,this._handle=null,this.clear()}copySnapshot(e){var l,c,u,d;const i=(c=(l=this._handle)==null?void 0:l.getTexture())==null?void 0:c.descriptor;if(!this.enabled||!i)return;(u=this._snapshots[e])==null||u.release();const{width:r,height:s}=i,n=e===s2.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[e]=this._fbos.acquire(r,s,n,ss.RGBA4);const o=this._fbos.rctx;this._bindFbo();const a=o.bindTexture((d=this._snapshots[e])==null?void 0:d.getTexture(),Er.TEXTURE_UNIT_FOR_UPDATES);o.gl.copyTexSubImage2D(Ns.TEXTURE_2D,0,0,0,0,0,r,s),o.bindTexture(a,Er.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){var i;return this.enabled?(i=this._snapshots[e])==null?void 0:i.getTexture():null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clear(zr.COLOR_BUFFER_BIT|zr.DEPTH_BUFFER_BIT)}_computeTextureHeight(e,i,r){const s=Math.min(window.devicePixelRatio,i)/e.pixelRatio,n=r?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,o=rb(Math.floor(Math.max(e.fullWidth,e.fullHeight)*s*n)),a=Math.min(this._maxTextureWidth,this._numCascades*o);return t$e(a/this._numCascades)}_ensureFbo(){var e,i,r,s,n;((i=(e=this._handle)==null?void 0:e.fbo)==null?void 0:i.width)===this._textureWidth&&((r=this._handle)==null?void 0:r.fbo.height)===this._textureHeight||((s=this._handle)==null||s.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",ss.RGBA4)),(n=this._handle)==null||n.acquireDepth(Oo.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=hi(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){var i;const e=this._fbos.rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer((i=this._handle)==null?void 0:i.fbo)}_constructCascade(e,i,r,s){const n=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),c=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]);vt(l<c);for(let m=0;m<8;++m){_s(gge,m%4==0||m%4==3?-1:1,m%4==0||m%4==1?-1:1,m<4?l:c,1);const g=Md[m];Pu(g,gge,this._projectionViewInverse),g[0]/=g[3],g[1]/=g[3],g[2]/=g[3]}sa(Zq,Md[0]),n.camera.viewMatrix=dl(Ybt,this._modelViewLight,Zq);for(let m=0;m<8;++m)nt(Md[m],Md[m],n.camera.viewMatrix);let u=Md[0][2],d=Md[0][2];for(let m=1;m<8;++m)u=Math.min(u,Md[m][2]),d=Math.max(d,Md[m][2]);u-=200,d+=200,n.camera.near=-d,n.camera.far=-u,Kbt(r,s,u,d,n.camera),gr(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const f=this._textureHeight;n.camera.viewport=[e*f,0,f,f]}_setupMatrices(e,i){gr(this._projectionView,e.projectionMatrix,e.viewMatrix),Zn(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===Xe.Global?e.eye:de(Zq,0,0,1);Kj(this._modelViewLight,[0,0,0],[-i[0],-i[1],-i[2]],r)}_computeCascadeDistances(e,i,r){const s=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(jlt(i/e,4)),s);const n=(i-e)/this._numCascades,o=(i/e)**(1/this._numCascades);let a=e,l=e;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=Bt(a,l,this.settings.splitSchemeLambda),a*=o,l+=n}get test(){}};const Ybt=ke(),gge=ci(),Md=[];for(let t=0;t<8;++t)Md.push(ci());const yge=mt(),_ge=mt(),Xbt=mt(),vge=mt(),bge=mt(),Zq=E(),Yq=[],wge=ke(),xge=Wr.concat(Wr,Wr,Wr,Wr),Hu=mt(),pE=mt(),Fw=[mt(),mt(),mt(),mt()],Jn=mt(),Xq=mt(),pv=mt(),nR=mt(),fE=mt(),mE=mt(),m4=mt();function Jbt(t,e,i,r,s,n,o,a){Li(Hu,0,0);for(let C=0;C<4;++C)of(Hu,Hu,t[C]);bh(Hu,Hu,.25),Li(pE,0,0);for(let C=4;C<8;++C)of(pE,pE,t[C]);bh(pE,pE,.25),Nd(Fw[0],t[4],t[5],.5),Nd(Fw[1],t[5],t[6],.5),Nd(Fw[2],t[6],t[7],.5),Nd(Fw[3],t[7],t[4],.5);let l=0,c=jz(Fw[0],Hu);for(let C=1;C<4;++C){const M=jz(Fw[C],Hu);M<c&&(c=M,l=C)}vg(Jn,Fw[l],t[l+4]);const u=Jn[0];let d,f;Jn[0]=-Jn[1],Jn[1]=u,vg(Xq,pE,Hu),zn(Xq,Jn)<0&&ARe(Jn,Jn),Nd(Jn,Jn,Xq,i),bL(Jn,Jn),d=f=zn(vg(pv,t[0],Hu),Jn);for(let C=1;C<8;++C){const M=zn(vg(pv,t[C],Hu),Jn);M<d?d=M:M>f&&(f=M)}Da(r,Hu),bh(pv,Jn,d-e),of(r,r,pv);let m=-1,g=1,y=0,v=0;for(let C=0;C<8;++C){vg(nR,t[C],r),bL(nR,nR);const M=Jn[0]*nR[1]-Jn[1]*nR[0];M>0?M>m&&(m=M,y=C):M<g&&(g=M,v=C)}X2(m>0,"leftArea"),X2(g<0,"rightArea"),bh(fE,Jn,d),of(fE,fE,Hu),bh(mE,Jn,f),of(mE,mE,Hu),m4[0]=-Jn[1],m4[1]=Jn[0];const b=wF(r,t[v],mE,of(pv,mE,m4),1,s),w=wF(r,t[y],mE,pv,1,n),x=wF(r,t[y],fE,of(pv,fE,m4),1,o),S=wF(r,t[v],fE,pv,1,a);X2(b,"rayRay"),X2(w,"rayRay"),X2(x,"rayRay"),X2(S,"rayRay")}function Vi(t,e){return 3*e+t}const Tge=mt();function qc(t,e){return Li(Tge,t[e],t[e+3]),Tge}const lc=mt(),yt=Yr();function Qbt(t,e,i,r,s){vg(lc,i,r),bh(lc,lc,.5),yt[0]=lc[0],yt[1]=lc[1],yt[2]=0,yt[3]=lc[1],yt[4]=-lc[0],yt[5]=0,yt[6]=lc[0]*lc[0]+lc[1]*lc[1],yt[7]=lc[0]*lc[1]-lc[1]*lc[0],yt[8]=1,yt[Vi(0,2)]=-zn(qc(yt,0),t),yt[Vi(1,2)]=-zn(qc(yt,1),t);let n=zn(qc(yt,0),i)+yt[Vi(0,2)],o=zn(qc(yt,1),i)+yt[Vi(1,2)],a=zn(qc(yt,0),r)+yt[Vi(0,2)],l=zn(qc(yt,1),r)+yt[Vi(1,2)];n=-(n+a)/(o+l),yt[Vi(0,0)]+=yt[Vi(1,0)]*n,yt[Vi(0,1)]+=yt[Vi(1,1)]*n,yt[Vi(0,2)]+=yt[Vi(1,2)]*n,n=1/(zn(qc(yt,0),i)+yt[Vi(0,2)]),o=1/(zn(qc(yt,1),i)+yt[Vi(1,2)]),yt[Vi(0,0)]*=n,yt[Vi(0,1)]*=n,yt[Vi(0,2)]*=n,yt[Vi(1,0)]*=o,yt[Vi(1,1)]*=o,yt[Vi(1,2)]*=o,yt[Vi(2,0)]=yt[Vi(1,0)],yt[Vi(2,1)]=yt[Vi(1,1)],yt[Vi(2,2)]=yt[Vi(1,2)],yt[Vi(1,2)]+=1,n=zn(qc(yt,1),e)+yt[Vi(1,2)],o=zn(qc(yt,2),e)+yt[Vi(2,2)],a=zn(qc(yt,1),i)+yt[Vi(1,2)],l=zn(qc(yt,2),i)+yt[Vi(2,2)],n=-.5*(n/o+a/l),yt[Vi(1,0)]+=yt[Vi(2,0)]*n,yt[Vi(1,1)]+=yt[Vi(2,1)]*n,yt[Vi(1,2)]+=yt[Vi(2,2)]*n,n=zn(qc(yt,1),e)+yt[Vi(1,2)],o=zn(qc(yt,2),e)+yt[Vi(2,2)],a=-o/n,yt[Vi(1,0)]*=a,yt[Vi(1,1)]*=a,yt[Vi(1,2)]*=a,s[0]=yt[0],s[1]=yt[1],s[2]=0,s[3]=yt[2],s[4]=yt[3],s[5]=yt[4],s[6]=0,s[7]=yt[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=yt[6],s[13]=yt[7],s[14]=0,s[15]=yt[8]}function Kbt(t,e,i,r,s){const n=1/Md[0][3],o=1/Md[4][3];vt(n<o);let a=n+Math.sqrt(n*o);const l=Math.sin(po(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,Jbt(Md,a,l,yge,_ge,Xbt,vge,bge),Qbt(yge,_ge,vge,bge,s.projectionMatrix),s.projectionMatrix[10]=2/(i-r),s.projectionMatrix[14]=-(i+r)/(i-r)}function ewt(t){let{near:e,far:i}=t;return e<2&&(e=2),i<2&&(i=2),e>=i&&(e=2,i=4),{near:e,far:i}}function twt(t){return ap(t)&&t.intersector===rs.TERRAIN&&!!t.target}let iwt=class extends SD{constructor(e,i,r){super(e,i),this.triangleNr=r}};function kNe(t){return ap(t)&&t.intersector===rs.OVERLAY&&!!t.target}var fs,Hn;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(fs||(fs={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(Hn||(Hn={}));let UNe=class{constructor(e,i){this._material=e,this._repository=i,this._map=new Map}dispose(){this._map.forEach((e,i)=>{e!=null&&this._repository.release(this._material,i)})}load(e,i,r){const s=this._material.produces.get(i);if(!(s!=null&&s(r)))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,i,r));const n=this._map.get(r);if(n!=null){if(n.ensureResources(e)===Rb.LOADED)return n;this._repository.requestRender()}return null}},QQ=class extends kLe{constructor(e=E()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},$oe=class{constructor(e=0,i=0){this.from=e,this.to=i}get numElements(){return this.to-this.from}};function Sge(t){const e=new Map;t.forAll(r=>e.set(r.from,r));let i=!0;for(;i;){i=!1;for(let r=0;r<t.length;++r){const s=t.data[r],n=e.get(s.to);if(!n)return;s.to=n.to,e.delete(n.from),t.removeUnordered(n),i=!0}}}let Ege=class extends $oe{constructor(e,i,r){super(i,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.geometry.highlights!=null&&this.isVisible}get hasOccludees(){return this.geometry.occludees!=null}},rwt=class{constructor(){this.first=0,this.count=0}},swt=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new ai({allocator:e=>e||new $oe,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=g4(),this.drawCommandsHighlight=g4(),this.drawCommandsOccludees=g4(),this.drawCommandsShadowHighlightRest=g4()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,i){this.deleteInstance(e),this._instances.set(e,i),this._numElements+=i.numElements}deleteInstance(e){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,this._instances.delete(e))}updateInstance(e,i,r){const s=this._instances.get(e);s&&(this._numElements-=s.numElements,s.from=i,s.to=r,this._numElements+=s.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const r=this.drawCommandsDefault.pushNew(),s=this.holes.front();return this.vao!=null&&this.holes.length===1&&s.to===Math.floor(this.vao.byteSize/e)?(r.first=0,void(r.count=s.from)):(r.first=1/0,r.count=0,this._instances.forEach(n=>{r.first=Math.min(r.first,n.from),r.count=Math.max(r.count,n.to)}),void(r.count-=r.first))}const i=Array.from(this._instances.values()).sort((r,s)=>r.from===s.from?r.to-s.to:r.from-s.from);for(const r of i)r.isVisible&&(Cge(r.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,r),Cge(r.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,r))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function nwt(t){return t.vao!=null}function g4(){return new ai({allocator:t=>t||new rwt,deallocator:t=>t})}function Cge(t,e){const i=t.back();if(i==null){const r=t.pushNew();return r.first=e.from,void(r.count=e.numElements)}if(owt(i,e)){const r=e.from-i.first+e.numElements;i.count=r}else{const r=t.pushNew();r.first=e.from,r.count=e.numElements}}function owt(t,e){return t.first+t.count>=e.from}let awt=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(i=>i.instances.has(e))}};const KQ=-3,VNe=KQ-1;var lf;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(lf||(lf={}));let lwt=class{constructor(e,i,r){this.name=e,this._storage=i,this.id=cwt+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),r&&(this._storage.registerRemoveFunc(this.id,r),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,i,r,s=0){this._storage.put(this,e,i,r,s)}pop(e){const i=this._storage.pop(this,e);return i===void 0?++this._miss:++this._hit,i}get(e){const i=this._storage.get(this,e);return i===void 0?++this._miss:++this._hit,i}peek(e){return this._storage.peek(this,e)}updateSize(e,i,r){this._storage.updateSize(this,e,i,r)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},zNe=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new ai,this._users=new ai}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,i){this._removeFuncs.push([e,i])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(i=>i[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,i){const r=this._db.get(e.id+i);return(r==null?void 0:r.size)??0}put(e,i,r,s,n){i=e.id+i;const o=this._db.get(i);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(i),o.entry!==r&&this._notifyRemove(i,o.entry,o.size,lf.ALL)),s>this._maxSize)return void this._notifyRemove(i,r,s,lf.ALL);if(r===void 0)return void console.warn("Refusing to cache undefined entry ");if(!s||s<0)return console.warn(`Refusing to cache entry with size ${s} for key ${i}`),void this._notifyRemove(i,r,0,lf.ALL);const a=1+Math.max(n,VNe)-KQ;this._db.set(i,new uwt(r,s,a)),this._size+=s,e.size+=s,this._checkSize()}updateSize(e,i,r,s){i=e.id+i;const n=this._db.get(i);if(n&&n.entry===r){for(this._size-=n.size,e.size-=n.size;s>this._maxSize;){const o=this._notifyRemove(i,r,s,lf.SOME);if(!(o!=null&&o>0))return void this._db.delete(i);s=o}n.size=s,this._size+=s,e.size+=s,this._checkSize()}}pop(e,i){i=e.id+i;const r=this._db.get(i);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(i),++this._hit,r.entry;++this._miss}get(e,i){i=e.id+i;const r=this._db.get(i);if(r!==void 0)return this._db.delete(i),r.lives=r.lifetime,this._db.set(i,r),++this._hit,r.entry;++this._miss}peek(e,i){const r=this._db.get(e.id+i);return r?++this._hit:++this._miss,r==null?void 0:r.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;r[l]=(r[l]||0)+o.size,this._users.forAll(c=>{const{id:u,name:d}=c;if(a.startsWith(u)){const f=i[d]||0;i[d]=f+o.size}})});const s={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=i[a]||0;i[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(i);n.sort((o,a)=>i[a]-i[o]),n.forEach(o=>e[o]=Math.round(i[o]/2**20)+"MB / "+s[o]);for(let o=r.length-1;o>=0;--o){const a=r[o];a&&(e["Priority "+(o+KQ-1)]=Math.round(a/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const i=e.id;this._db.forEach((r,s)=>{s.startsWith(i)&&(this._size-=r.size,this._db.delete(s),this._notifyRemove(s,r.entry,r.size,lf.ALL))}),e.size=0}clearAll(){this._db.forEach((e,i)=>this._notifyRemove(i,e.entry,e.size,lf.ALL)),this._users.forAll(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,i,r,s){let n;return this._removeFuncs.some(o=>{if(e.startsWith(o[0])){const a=o[1](i,s,r);return typeof a=="number"&&(n=a),!0}return!1}),n}_checkSize(){this._users.forAll(e=>this._checkSizeLimits(e)),this._checkSizeLimits()}_checkSizeLimits(e){const i=e??this;if(i.maxSize<0||i.size<=i.maxSize)return;const r=e==null?void 0:e.id;let s=!0;for(;s;){s=!1;for(const[n,o]of this._db)if(o.lifetime===0&&(!r||n.startsWith(r))){if(this._purgeItem(n,o,e),i.size<=.9*i.maxSize)return;s||(s=this._db.has(n))}}for(const[n,o]of this._db)if((!r||n.startsWith(r))&&(this._purgeItem(n,o,e),i.size<=.9*i.maxSize))return}_purgeItem(e,i,r=this._users.find(s=>e.startsWith(s.id))){if(this._db.delete(e),i.lives<=1){this._size-=i.size,r&&(r.size-=i.size);const s=this._notifyRemove(e,i.entry,i.size,lf.SOME);s!=null&&s>0&&(this._size+=s,r&&(r.size+=s),i.lives=i.lifetime,i.size=s,this._db.set(e,i))}else--i.lives,this._db.set(e,i)}},cwt=0,uwt=class{constructor(e,i,r){this.entry=e,this.size=i,this.lifetime=r,this.lives=r}},oN=class{constructor(e,i){this._cache=e(i,(r,s,n)=>{switch(s){case lf.ALL:return r.forEach(o=>o.dispose()),0;case lf.SOME:{const o=r.shift();return o&&(n-=Math.round(o.usedMemory),o.dispose()),n}}})}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(e){return this._cache.getSize(e)}pop(e){const i=this._cache.peek(e);if(!i)return;const r=i.pop();if(i.length>0){if(r){const s=this._cache.getSize(e)-Math.round(r.usedMemory);this._cache.updateSize(e,i,s)}}else this._cache.pop(e);return r}put(e,i,r=VNe){const s=this._cache.peek(e);if(!s)return void this._cache.put(e,[i],i.usedMemory,r);s.push(i);const n=this._cache.getSize(e)+Math.round(i.usedMemory);this._cache.updateSize(e,s,n)}},hwt=class{constructor(e,i,r){this._rctx=e,this._locations=i,this._layout=r,this._cache=new oN(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const i=e.toString();let r=this._cache.pop(i);return r||(r=new _y(this._rctx,this._locations,{geometry:this._layout},{geometry:Sr.createVertex(this._rctx,cr.STATIC_DRAW)}),r.vertexBuffers.geometry.setSize(e),r)}deleteVao(e){if(e==null)return;const i=e.byteSize.toString();this._cache.put(i,e)}},b3=class extends wIe{constructor(e){super(e),this._vaoCache=null,this._glMaterials=null,this._bufferWriter=null,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._produces=new Map,this.drapedPriority=0}destroy(){this._glMaterials=Ut(this._glMaterials),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache=Ut(this._vaoCache)}initialize(){this.material.produces.forEach((e,i)=>{this._produces.set(i,r=>!(this._dataByOrigin.size===0||!(r!==j.Highlight&&r!==j.ShadowHighlight||this._hasHighlights))&&e(r))})}get produces(){return this._produces}initializeRenderContext(e,i){const{rctx:r}=e.renderContext;this._glMaterials=new UNe(this.material,i??e.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=new hwt(r,this.material.vertexAttributeLocations,ku(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get hasOccludees(){return this._hasOccludees}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get materialReference(){return this.material}get numGeometries(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,s)=>r+s.instances.size,0)),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,s)=>r+s.vao.usedMemory,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(i=>i.buffers.forEach(r=>r.instances.forEach(s=>e(s.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const i=this._bufferWriter;if(i===null)return;const r=i.vertexBufferLayout.stride/4;for(const s of e){const n=s.renderGeometry,o=this._dataByOrigin.get(n.localOrigin.id),a=o==null?void 0:o.findBuffer(n.id);if(a==null)return;const l=a.instances.get(n.id);if(s.updateType&(Hn.GEOMETRY|Hn.TRANSFORMATION)){const c=v4(i.elementCount(l.geometry.geometry)*r),u=i.vertexBufferLayout.createView(c.buffer);this._writeGeometry(n,u,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*r,0,l.numElements*r)}s.updateType&(Hn.HIGHLIGHT|Hn.OCCLUDEE|Hn.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,i){const r=new Db;for(const s of e){const n=s.localOrigin;if(n==null)continue;let o=r.get(n.id,null);o==null&&(o=new Mge(n.vec3),r.set(n.id,null,o)),o.changes.push(s)}for(const s of i){const n=s.localOrigin;if(n==null)continue;const o=this._dataByOrigin.get(n.id),a=o==null?void 0:o.findBuffer(s.id);if(a==null)continue;let l=r.get(n.id,a);l==null&&(l=new Mge(n.vec3),r.set(n.id,a,l)),l.changes.push(s)}return r}_addAndRemoveGeometries(e,i){if(this._bufferWriter===null||this._vaoCache===null)return;const{_bufferWriter:r,_dataByOrigin:s}=this,n=r.vertexBufferLayout.stride/4,o=this._computeDeltas(e,i);o.forEach((a,l)=>{const c=a.get(null),u=c!=null?c.changes:[];o.delete(l,null);let d=s.get(l);if(a.forEach((f,m)=>{if(o.delete(l,m),m==null)return void vt(!1,"No VAO for removed geometries");if(m.instances.size===f.changes.length)return this._vaoCache.deleteVao(m.vao),q3(d.buffers,m),void(d.buffers.length===0&&u.length===0&&s.delete(l));const g=m.numElements,y=m.vao.byteSize/4,v=u.reduce((S,C)=>S+r.elementCount(C.geometry),0),b=f.changes.reduce((S,C)=>S+r.elementCount(C.geometry),0),w=Math.min((g+v-b)*n,_4),x=w>y;w>IB&&w<y/2?(f.changes.forEach(({id:S})=>m.deleteInstance(S)),m.instances.forEach(({geometry:S})=>u.push(S)),this._vaoCache.deleteVao(m.vao),q3(d.buffers,m)):x?this._applyAndRebuild(m,u,f):this._applyRemoves(m,f)}),u.length>0)for(d==null&&(d=new awt(c.origin),s.set(l,d)),d.buffers.forEach(f=>this._applyAdds(f,u));u.length>0;)d.buffers.push(this._applyAndRebuild(new swt,u,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(i=>{i.drawCommandsDirty&&(i.hasHiddenInstances=!1,i.hasHighlights=!1,i.hasOccludees=!1,Eh(i.instances,r=>(i.updateDrawState(r),i.hasHiddenInstances&&i.hasHighlights&&i.hasOccludees)),i.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||i.hasHighlights,this._hasOccludees=this._hasOccludees||i.hasOccludees})})}_applyAndRebuild(e,i,r){if(r!=null)for(const g of r.changes)e.deleteInstance(g.id);const s=this._bufferWriter,n=s.vertexBufferLayout.stride,o=n/4,a=Math.floor(_4/o);let l=e.numElements;for(;i.length>0;){const g=i.pop(),y=s.elementCount(g.geometry);if(l+y>a&&l>0){i.push(g);break}l+=y;const v=new Ege(g,0,0);vt(e.instances.get(g.id)==null),e.addInstance(g.id,v)}const c=l*o,u=v4(c),d=s.vertexBufferLayout.createView(u.buffer);let f=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((g,y)=>{this._writeGeometry(g.geometry,d,f);const v=f;f+=s.elementCount(g.geometry.geometry),e.updateInstance(y,v,f),e.updateDrawState(g)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Oge(c)),e.vao.vertexBuffers.geometry.setSubData(u,0,0,f*o),e.holes.clear();const m=e.holes.pushNew();return m.from=f,m.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(n),e}_applyRemoves(e,i){if(i.changes.length===0||this._bufferWriter===null)return;for(const a of i.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const u=mm.back();if(u){if(u.to===c.from){u.to=c.to;continue}if(u.from===c.to){u.from=c.from;continue}}const d=mm.pushNew();d.from=c.from,d.to=c.to}Sge(mm);const r=this._bufferWriter.vertexBufferLayout.stride/4,s=mm.reduce((a,l)=>Math.max(a,l.numElements),0)*r,n=v4(s);n.fill(0,0,s);const o=e.vao.vertexBuffers.geometry;mm.forAll(a=>o.setSubData(n,a.from*r,0,a.numElements*r)),e.holes.pushArray(mm.data,mm.length),mm.forAll((a,l)=>mm.data[l]=null),mm.clear(),e.drawCommandsDirty=!0}_applyAdds(e,i){if(i.length===0||this._bufferWriter===null)return;if(!nwt(e))return void this._applyAndRebuild(e,i,null);const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,n=e.numElements,o=i.reduce((b,w)=>b+r.elementCount(w.geometry),0),a=Math.min((n+o)*s,_4),l=4*a;if(e.vao.byteSize<Oge(_4-IB)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,i,null);Sge(e.holes);const c=new Array;for(const b of i){const w=r.elementCount(b.geometry),x=dwt(e.holes,w);c.push(x)}const u=e.vao.vertexBuffers.geometry;let d=0,f=0,m=0;const g=v4(a),y=r.vertexBufferLayout.createView(g.buffer);i.forEach((b,w)=>{const x=c[w];if(x==null)return;if(m!==x){const M=m-f;M>0&&u.setSubData(g,f*s,0,M*s),f=x,d=0}const S=r.elementCount(b.geometry);this._writeGeometry(b,y,d),d+=S,m=x+S;const C=new Ege(b,x,x+S);vt(e.instances.get(b.id)==null),e.addInstance(b.id,C),e.drawCommandsDirty=!0});const v=m-f;v>0&&u.setSubData(g,f*s,0,v*s),g6e(i,(b,w)=>c[w]==null)}_writeGeometry(e,i,r){if(this._bufferWriter===null)return;const s=e.localOrigin.vec3;Glt(Age,-s[0],-s[1],-s[2]);const n=gr(pwt,Age,e.transformation);Zn(y4,n),Lu(y4,y4),this._bufferWriter.write(n,y4,e.geometry,i,r)}updateAnimation(e){return this.material.update(e)}prepareTechnique(e){if(!this.material.shouldRender(e))return null;const{output:i,bindParameters:r}=e,s=this.material.produces.get(r.slot);if(!(s!=null&&s(i)))return null;const n=i===j.Highlight||i===j.ShadowHighlight;if(n&&!this._hasHighlights)return null;const o=i===j.ShadowExcludeHighlight,a=!(n||o);for(const l of this._dataByOrigin.values())for(const c of l.buffers){if(n&&!c.hasHighlights)continue;const u=(n?c.drawCommandsHighlight:o&&c.needsMultipleCommands()?c.drawCommandsShadowHighlightRest:c.drawCommandsDefault)||null,d=a&&c.drawCommandsOccludees||null;if(u!=null&&u.length||d!=null&&d.length){const f=this._glMaterials.load(e.rctx,r.slot,i),m=f!=null?f.beginSlot(r):null;if(m!=null)return m}}return null}renderNode(e,i){const{output:r,bindParameters:s}=e,n=r===j.Highlight||r===j.ShadowHighlight,o=r===j.ShadowExcludeHighlight,a=!(n||o),l=s.slot===Pe.OCCLUDER_MATERIAL,c=s.slot===Pe.TRANSPARENT_OCCLUDER_MATERIAL,u=e.rctx;u.runAppleAmdDriverHelper(),u.bindTechnique(i,s,this.material.parameters);for(const d of this._dataByOrigin.values())for(const f of d.buffers){if(n&&!f.hasHighlights)continue;const m=(n?f.drawCommandsHighlight:o&&f.needsMultipleCommands()?f.drawCommandsShadowHighlightRest:f.drawCommandsDefault)||null,g=a&&f.drawCommandsOccludees||null;(m!=null&&m.length||g!=null&&g.length)&&(i.program.bindDraw(new QQ(d.origin),s,this.material.parameters),i.ensureAttributeLocations(f.vao),u.bindVAO(f.vao),m!=null&&m.length&&(u.setPipelineState(i.getPipeline(!1,l,c)),m.forAll(y=>u.drawArrays(i.primitiveType,y.first,y.count))),g!=null&&g.length&&(u.setPipelineState(i.getPipeline(!0,l,c)),g.forAll(y=>u.drawArrays(i.primitiveType,y.first,y.count))))}}get test(){}};h([p({constructOnly:!0})],b3.prototype,"material",void 0),b3=h([I("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],b3);let Mge=class{constructor(e){this.origin=e,this.changes=new Array}};function dwt(t,e){let i;if(!t.some(s=>!(s.numElements<e)&&(i=s,!0)))return null;const r=i.from;return i.from+=e,i.from>=i.to&&t.removeUnordered(i),r}const Age=ke(),pwt=ke(),y4=ke(),mm=new ai({allocator:t=>t||new $oe,deallocator:null}),IB=65536,Jq=4*IB,Pge=1024,BNe=16777216,_4=BNe/4;let Qq=new Float32Array(IB);function v4(t){return Qq.length<t&&(Qq=new Float32Array(t)),Qq}function Oge(t){const e=4*t;return e<=Pge?Pge:e<Jq?bEe(e):Math.max(Math.min(Math.ceil(1.5*e/Jq)*Jq,BNe),e)}let ah=class extends Ue{constructor(e){super(e),this._pending=new fwt,this._changes=new SJ,this._materialRenderers=new Map,this._sortedMaterialRenderers=new ai,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.destroy()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materials(){return this.rendererContext.materials}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){return Eh(this._materialRenderers,e=>e.numGeometries!==0&&!e.queryRenderOccludedState(er.Occlude))}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}getMaterialRenderer(e){return this._materialRenderers.get(e)}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=P$e(this._changes);let i=!1;return e.forEach((r,s)=>{let n=this.getMaterialRenderer(s);if(!n&&r.adds.length>0){const o=new b3({material:s});o.initializeRenderContext(this.rendererContext.pluginContext,this._materials),n=o,this._materialRenderers.set(s,n),i=!0}n&&(n.modify(r),n.numGeometries===0&&(this._materialRenderers.delete(s),n.destroy(),i=!0))}),this._changes.clear(),i&&this._updateSortedMaterialRenderers(),this._hasHighlights=Eh(this._materialRenderers,r=>{const s=r.produces.get(Pe.DRAPED_MATERIAL);return!!s&&s(j.Highlight)}),this._hasWater=Eh(this._materialRenderers,r=>{const s=r.produces.get(Pe.DRAPED_WATER);return!!s&&s(j.Normal)}),this.notifyChange("updating"),!0}addGeometries(e,i){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const n of r)this._geometries.set(n.id,n);const s=this._pending.empty;for(const n of r)this._pending.adds.add(n);s&&this.notifyChange("updating"),i===fs.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,i){const r=this._pending.empty,s=this._pending.adds;for(const n of e)s.has(n)?(this._pending.removed.add(n),s.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);r&&!this._pending.empty&&this.notifyChange("updating"),i===fs.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,i){const r=this._changes.updates.length===0;for(const s of e){const n=this._changes.updates.pushNew();n.renderGeometry=this._validateRenderGeometry(s),n.updateType=i}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),i){case Hn.TRANSFORMATION:case Hn.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case Hn.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let i=!1;return this._sortedMaterialRenderers.forAll(r=>i=!!r.updateAnimation&&r.updateAnimation(e)||i),i}shouldRender(e){return this._sortedMaterialRenderers.some(i=>i.prepareTechnique(e))}render(e){this._sortedMaterialRenderers.forAll(i=>{const r=i.prepareTechnique(e);r!=null&&i.renderNode(e,r)})}intersect(e,i,r,s,n){return this._geometries.forEach(o=>{if(s&&!s(o))return;this._intersectRenderGeometry(o,r,i,0,e,n);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,r,i,a.range,e,n),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,r,i,-a.range,e,n)),n++}),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;for(const i of this._materialRenderers.values())i.drapedPriority=e++,this._sortedMaterialRenderers.push(i);this._sortedMaterialRenderers.sort((i,r)=>{var s,n,o,a;return((s=r.materialReference)==null?void 0:s.renderPriority)===((n=i.materialReference)==null?void 0:n.renderPriority)?i.drapedPriority-r.drapedPriority:(((o=r.materialReference)==null?void 0:o.renderPriority)||0)-(((a=i.materialReference)==null?void 0:a.renderPriority)||0)})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const i=this._changes.updates.data[e];this._pending.has(i.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,i,r,s,n,o){if(!e.visible)return;let a=0;s+=e.transformation[12],a=e.transformation[13],Kq[0]=r[0]-s,Kq[1]=r[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,Kq,(l,c,u)=>{mwt(i,u,o,e.material.renderPriority,n,e.layerUid,e.graphicUid)},i)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let i;for(const r of e){const s=r.graphicUid;s!=null&&s!==i&&(this.drapeSource.notifyGraphicGeometryChanged(s),i=s)}}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let i;for(const r of e){const s=r.graphicUid;s!=null&&s!==i&&(this.drapeSource.notifyGraphicVisibilityChanged(s),i=s)}}_validateRenderGeometries(e){for(const i of e)this._validateRenderGeometry(i);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){}};h([p()],ah.prototype,"drapeSource",void 0),h([p()],ah.prototype,"updating",null),h([p()],ah.prototype,"rctx",null),h([p({constructOnly:!0})],ah.prototype,"rendererContext",void 0),h([p()],ah.prototype,"_materials",null),h([p()],ah.prototype,"_localOriginFactory",null),h([p({readOnly:!0})],ah.prototype,"isEmpty",null),h([p()],ah.prototype,"_materialRenderers",void 0),h([p()],ah.prototype,"_geometries",void 0),ah=h([I("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],ah);let fwt=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function mwt(t,e,i,r,s,n,o){const a=new iwt(n,o,e),l=c=>{c.set(rs.OVERLAY,a,t.dist,t.normal,t.transformation,i,r)};if((s.results.min.drapedLayerOrder==null||i>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==oa.MIN&&(s.results.max.drapedLayerOrder==null||i<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===oa.ALL){const c=ose(s.ray);l(c),s.results.all.push(c)}}const Kq=mt();let Ioe=class jNe extends Qi{initializeProgram(e){return new Ki(e.rctx,jNe.shader.get().build(),Ai)}initializePipeline(){return this.configuration.hasAlpha?Jt({blending:ua(Be.SRC_ALPHA,Be.ONE,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),colorWrite:ui}):Jt({colorWrite:ui})}};Ioe.shader=new qi(O1t,()=>ce(()=>Promise.resolve().then(()=>THt),void 0));let Loe=class extends tc{constructor(){super(...arguments),this.hasAlpha=!1}};h([B()],Loe.prototype,"hasAlpha",void 0);let Doe=class extends Fr{constructor(){super(...arguments),this.overlayIndex=Mn.INNER,this.opacity=1}};function GNe(){const t=new Hi;return t.include(ka),t.fragment.uniforms.add(new wt("tex",e=>e.texture)),t.fragment.uniforms.add(new cO("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new et("opacity",e=>e.opacity)),t.fragment.code.add(T`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),t}const gwt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:Doe,build:GNe},Symbol.toStringTag,{value:"Module"}));let HNe=class qNe extends Qi{initializeProgram(e){return new Ki(e.rctx,qNe.shader.get().build(),Ai)}initializePipeline(){return Jt({blending:Hh(Be.ONE,Be.ONE_MINUS_SRC_ALPHA),colorWrite:ui})}};HNe.shader=new qi(gwt,()=>ce(()=>Promise.resolve().then(()=>SHt),void 0));let gd=class extends mne{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new Doe,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new ai,this._passParameters=new Coe,this._materials=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new Dr,this.worldToPCSRatio=1,this.events=new Us,this.longitudeCyclical=null,this.produces=new Map([[Pe.DRAPED_MATERIAL,i=>i!==j.Highlight||this.hasHighlights],[Pe.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this.view._stage.renderer.fboCache,i=this.view._stage.renderView,{waterTextures:r,stippleTextures:s,markerTextures:n}=i;this._techniques=new aNe({rctx:this._rctx,viewingMode:Xe.Local,stippleTextures:s,markerTextures:n,waterTextures:r}),this._renderContext=new FNe(this._rctx,new Roe(e,this.view.state.viewingMode),null),this.addHandles([te(()=>r.updating,()=>this.events.emit("content-changed"),hr),te(()=>this.spatialReference,o=>this._localOriginFactory=new NNe(o),hr),Ks(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materials=new lNe(i.textures,this._techniques,()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=Pe.DRAPED_MATERIAL,this._bindParameters.mainDepth=null,this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=pt.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new ene(Ge(1,1,1))]),this.addHandles(this.view.resourceController.scheduler.registerTask(It.STAGE,this))}destroy(){this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=hi(this._debugTextureTechnique),this._passParameters.texture=Ut(this._passParameters.texture),this._techniques=qe(this._techniques),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initializeRenderContext(e){this.pluginContext=e}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||Eh(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._renderTargets!=null}getMaterialRenderer(e){for(const i of this._renderers.values()){const r=i.getMaterialRenderer(e);if(r)return r}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map(e=>e.drapeSource.layer).filter(e=>!!e)}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,ah)}createDrapeSourceRenderer(e,i,r){const s=this._renderers.get(e);s!=null&&s.destroy();const n=new i({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles(te(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),n}removeDrapeSourceRenderer(e){if(e==null)return;const i=this._renderers.get(e);i!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),i.destroy())}computeValidity(){var e;return((e=this._renderTargets)==null?void 0:e.computeValidity())??0}releaseRenderTargets(){var e;(e=this._renderTargets)==null||e.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&rk(e,i=>i.drapeTargetType===YQ.WithoutRasterImage)}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=rk(e,i=>i.drapeSourceType===y3.Features),this._hasDrapedRasterSource=rk(e,i=>i.drapeSourceType===y3.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,i,r=this._bindParameters.overlayStretch){this._overlays==null&&(this._renderTargets=new v1t(this.view._stage.renderer.fboCache),this._overlays=[new rge,new rge]),this.ensureDrapeTargets(e),this.ensureDrapeSources(i),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets=Ut(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){var i,r;if(e!=null)return e===is.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?(i=this._renderTargets)==null?void 0:i.getTexture(is.Color):(r=this._renderTargets)==null?void 0:r.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,i){let r=!1;for(const[s,n]of this._renderers){if(e.done)break;(s.destroyed||i(s))&&n.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=Eh(this._renderers,s=>s.hasHighlights),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(Eu,e=>e.updatePolicy===ab.SYNC)}get isEmpty(){return!Nr.OVERLAY_DRAW_DEBUG_TEXTURE&&!Eh(this._renderers,e=>!e.isEmpty)}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=LB;const i=this._sortedRenderers.some(({renderer:r})=>r.shouldRender(this._renderContext));return this._renderContext.renderOccludedMask=e,i}renders(e){return Nr.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==is.Occluded||this._sortedRenderers.some(({renderer:i})=>i.shouldRender(this._renderContext))}get mode(){var e,i;return this.isEmpty?Rg.Disabled:(e=this._renderTargets)!=null&&e.getTexture(is.WaterNormal)?Rg.EnabledWithWater:(i=this._renderTargets)!=null&&i.getTexture(is.Color)?Rg.Enabled:Rg.Disabled}updateAnimation(e){let i=!1;return this._renderers.forEach(r=>i=r.updateAnimation(e)||i),i}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const i of this._overlays)this.longitudeCyclical?i.setupGeometryViewsCyclical(this.longitudeCyclical):i.setupGeometryViewsDirect();for(const i of this._renderTargets.targets){if(i.content===is.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const r=this._drawTarget(Mn.INNER,i,e),s=this._drawTarget(Mn.OUTER,i,e);(r||s)&&i.fbo.generateMipMap()}}}_drawTarget(e,i,r){const s=this._overlays[e],n=s.canvasGeometries;if(n.numViews===0)return!1;const{alignPixelEnabled:o,contentPixelRatio:a}=r;this._screenToWorldRatio=a*s.mapUnitsPerPixel/this._bindParameters.overlayStretch;const l=i.output;if(this.isEmpty||l===j.Highlight&&!this.hasHighlights||l===j.Normal&&!this.hasWater||!s.hasSomeSizedView())return!1;const c=this._rctx;if(this._camera.pixelRatio=s.pixelRatio*a,this._renderContext.output=l,this._bindParameters.alignPixelEnabled=o,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=l===j.Normal?Pe.DRAPED_WATER:Pe.DRAPED_MATERIAL,i.content===is.Occluded&&(this._renderContext.renderOccludedMask=LB),!this.renders(i.content))return this._renderContext.renderOccludedMask=$B,!1;const u=s.resolution;this._rctx.setViewport(e===Mn.INNER?0:u,0,u,u);const d=2*s.resolution,f=s.resolution,m=i.fbo;if(m.bind(c,d,f),e===Mn.INNER&&(c.setClearColor(0,0,0,0),c.clear(zr.COLOR_BUFFER_BIT)),Nr.OVERLAY_DRAW_DEBUG_TEXTURE&&i.content!==is.Occluded)for(let g=0;g<n.numViews;g++)this._setViewParameters(n.extents[g],s),this._ensureDebugPatternResources(s.resolution,_wt[e]),this._rctx.bindTechnique(this._debugTextureTechnique,this._renderContext.bindParameters,this._passParameters),this._rctx.screen.draw();return this._sortedRenderers.forAll(({drapeSource:g,renderer:y})=>{if(i.content===is.ColorNoRasterImage&&g.drapeSourceType===y3.RasterImage)return;const{fullOpacity:v}=g,b=v!=null&&v<1&&l===j.Color?this.bindTemporaryFramebuffer(d,f):null;for(let w=0;w<n.numViews;w++)this._setViewParameters(n.extents[w],s),y.render(this._renderContext);if(b){m.bind(c,d,f),this._overlayParameters.texture=b.getTexture(),this._overlayParameters.opacity=v,this._overlayParameters.overlayIndex=e;const w=this.pluginContext.techniques.acquire(HNe);this._rctx.bindTechnique(w,this._renderContext.bindParameters,this._overlayParameters),this._rctx.screen.draw(),w.release(),b.release()}}),c.bindFramebuffer(null),this._renderContext.renderOccludedMask=$B,!0}bindTemporaryFramebuffer(e,i){var n;const r=this.view._stage.renderer.fboCache,s=r.acquire(e,i,"overlay tmp");return r.rctx.unbindTexture((n=s.fbo)==null?void 0:n.colorTexture),r.rctx.bindFramebuffer(s.fbo),r.rctx.clear(zr.COLOR_BUFFER_BIT),s}async reloadShaders(){await this._techniques.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,i,r,s){var o;this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let n=0;for(const{renderer:a}of this._sortedRenderers)n=((o=a.intersect)==null?void 0:o.call(a,e,i,r,s,n))??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers,i=e.length;this._renderers.forEach((r,s)=>{const n=e.indexOf(s.layer),o=n>=0,a=s.renderGroup??(o?CB.MapLayer:CB.ViewLayer),l=i*a+(o?n:0);this._sortedRenderers.push(new ywt(s,r,l))}),this._sortedRenderers.sort((r,s)=>r.index-s.index)}_setViewParameters(e,i){const r=this._camera;r.viewport=[0,0,i.resolution,i.resolution],DEe(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),g2(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=Eh(this._renderers,i=>i.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_ensureDebugPatternResources(e,i){if(de(this._passParameters.color,i[0],i[1],i[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let s=0;for(let a=0;a<e;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),u=Math.floor(a/10);c<2||u<2||10*c>e-20||10*u>e-20?(r[s++]=255,r[s++]=255,r[s++]=255,r[s++]=255):(r[s++]=255,r[s++]=255,r[s++]=255,r[s++]=1&c&&1&u?1&l^1&a?0:255:1&c^1&u?0:128)}const n=new Xr(e);n.samplingMode=di.NEAREST,this._passParameters.texture=new Er(this._rctx,n,r);const o=new Loe;o.hasAlpha=!0,this._debugTextureTechnique=this._techniques.acquire(Ioe,o)}get test(){}};h([p()],gd.prototype,"hasHighlights",void 0),h([p()],gd.prototype,"_sortedDrapeSourceRenderersDirty",void 0),h([p()],gd.prototype,"_techniques",void 0),h([p({constructOnly:!0})],gd.prototype,"view",void 0),h([p()],gd.prototype,"worldToPCSRatio",void 0),h([p()],gd.prototype,"spatialReference",void 0),h([p({type:Boolean,readOnly:!0})],gd.prototype,"updating",null),h([p()],gd.prototype,"isEmpty",null),h([p({readOnly:!0})],gd.prototype,"rendersOccludedDraped",null),gd=h([I("esri.views.3d.terrain.OverlayRenderer")],gd);let ywt=class{constructor(e,i,r){this.drapeSource=e,this.renderer=i,this.index=r}};const _wt=[[1,.5,.5],[.5,.5,1]],Noe=-2,LB=er.OccludeAndTransparent;function Foe(t,e,i,r){const s=sN(t.rings,!!t.hasZ&&r.mode!=="on-the-ground",ay.CCW_IS_HOLE,t.spatialReference),n=co(s.position.length),o=lLe(s.position,t.spatialReference,0,n,0,s.position,0,s.position.length/3,e,i,r),a=o!=null;return new wwt(s.position,n,YNe(s.polygons,s.position,n),ZNe(s.outlines,s.position,n),a,o)}function WNe(t,e){const i=sN(t.rings,!1,ay.CCW_IS_HOLE),r=ds(i.position,t.spatialReference,0,i.position,e,0,i.position.length/3);for(let s=2;s<i.position.length;s+=3)i.position[s]=Noe;return{position:i.position,polygons:YNe(i.polygons,i.position),outlines:ZNe(i.outlines,i.position),projectionSuccess:r}}function ZNe(t,e,i=null){return t.filter(({count:r})=>r>1).map(({index:r,count:s})=>{const n=3*r,o=3*s;return i!=null?new XNe(r,s,Xd(e,n,o),Xd(i,n,o)):new koe(r,s,Xd(e,n,o))})}function YNe(t,e,i=null){const r=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of t){if(n<=1)continue;const l=3*s,c=3*n,u=o.map(f=>f-s),d=i!=null?new vwt(s,n,Xd(e,3*s,3*n),Xd(i,l,c),u,a):new bwt(s,n,Xd(e,3*s,3*n),u,a);r.push(d)}return r}let koe=class{constructor(e,i,r){this.index=e,this.count=i,this.position=r}},XNe=class extends koe{constructor(e,i,r,s){super(e,i,r),this.mapPositions=s}},vwt=class extends XNe{constructor(e,i,r,s,n,o){super(e,i,r,s),this.holeIndices=n,this.pathLengths=o}},bwt=class extends koe{constructor(e,i,r,s,n){super(e,i,r),this.holeIndices=s,this.pathLengths=n}},wwt=class{constructor(e,i,r,s,n,o){this.position=e,this.mapPositions=i,this.polygons=r,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=o}};function np(t,e,i,r,s,n=2){const o=1/(Math.abs(i)+Math.abs(r)+Math.abs(s)),a=i*o,l=r*o,c=s<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,u=s<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,d=e*n;t[d]=Rge(c),t[d+1]=Rge(u)}function xwt(t){const e=t.length/3,i=new Int16Array(2*e);let r=0;for(let s=0;s<e;++s)np(i,s,t[r++],t[r++],t[r++]);return i}function Mti(t,e){const i=t.length/3,r=new Int16Array(2*i);let s=0;const n=E();for(let o=0;o<i;++o)n[0]=t[s++],n[1]=t[s++],n[2]=t[s++],ta(n,n,e),np(r,o,n[0],n[1],n[2]);return r}function Twt(t,e,i,r=2){const s=i*r,n=$ge(e[s]),o=$ge(e[s+1]),a=1-Math.abs(n)-Math.abs(o);t[2]=a,a<0?(t[0]=(n>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(n))):(t[0]=n,t[1]=o),Ce(t,t)}function Rge(t){return Ne(Math.round(32767*t),-32767,32767)}function $ge(t){return Ne(t/32767,-1,1)}const Swt=["polygon","extent"];let Ewt=class extends Sy{constructor(e,i,r,s){super(e,i,r,s),this.ensureDrapedStatus(!1)}async doLoad(){var a,l;if(!this._drivenProperties.size){const c=S6(this._getSymbolSize());if(c)throw new G("graphics3dextrudesymbollayer:invalid-size",c)}const e=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,i=this._getCombinedOpacityAndColor(e),r=zl(i),s=i[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:s,transparent:n,cullFace:n?Br.None:Br.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:sr.Compressed};this._materials[lh.Main]=new em(o),this._materials[lh.Bottom]=new em({...o,cullFace:Br.Back}),this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,Swt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(i);return this._createAs3DShape(i,e.renderingInfo,r,s,i.uid)}layerOpacityChanged(e,i){var a,l,c,u;const r=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,s=this._getCombinedOpacity(r),n=s<1||this.needsDrivenTransparentPass;(c=this._materials[lh.Main])==null||c.setParameters({opacity:s,transparent:n}),(u=this._materials[lh.Bottom])==null||u.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();e.forEach(d=>{const f=i(d);f!=null&&f.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Fb)}slicePlaneEnabledChanged(e,i){var r,s;return(r=this._materials[lh.Main])==null||r.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),(s=this._materials[lh.Bottom])==null||s.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(n=>{const o=i(n);o!=null&&o.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){var i,r;const e={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return(i=this._materials[lh.Main])==null||i.setParameters(e),(r=this._materials[lh.Bottom])==null||r.setParameters(e),!0}_getExtrusionSize(e){let i;return i=e.size&&this._drivenProperties.size?a1t(e.size,2)??0:this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(e,i){return this._drivenPropertiesChanged(i)?cn.RecreateSymbol:cn.RecreateGraphics}async queryForSnapping(e,i,r,s){const n=this._getExtrusionSize(r)*this._context.renderCoordsHelper.unitInMeters/a_(i),{objectId:o,target:a}=e,l=ie(a);switch(l.z=(l.z??0)+n,e.type){case"edge":{const{start:c,end:u}=e,d=ie(c),f=ie(u);return d.z=(d.z??0)+n,f.z=(f.z??0)+n,[Qme(o,l,1/0,d,f)]}case"vertex":return[Wvt(o,l,1/0),Qme(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,i,r,s,n){const o=IL(e.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some(k=>k.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=Foe(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=Xne(o);if(l==null)return null;const c=new Array,u=new Array,d=Xn(),f=ke(),m=E(),g=this._context.renderCoordsHelper.viewingMode===Xe.Global;g||this._context.renderCoordsHelper.worldUpAtPosition(null,m),$h(o.spatialReference,[l.x,l.y,0],f,this._context.renderCoordsHelper.spatialReference);const y=ke();Zn(y,f);const v=Yr();Mb(v,y);const{polygons:b,mapPositions:w,position:x}=a,S=new Map,C=this._materials[lh.Main];for(const k of b){const H=k.count;if(this._context.clippingExtent&&(Zr(d),Mh(d,k.mapPositions),!Mf(d,this._context.clippingExtent)))continue;const V=bP(k.mapPositions,k.holeIndices,3);if(V.length===0)continue;const X=V.length,q=6*H,Z=Kz(q+X),ye=Kz(X),L=co(3*q),N=co(3*q),z=co(3*q),W=co(q);Cwt(x,w,V,k,L,z,N,W,Z,ye,this._getExtrusionSize(i),m,g),Ub(L,L,y);const J=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),K=new Dwt(L,z,xwt(N),W),ne=Ige(C,Z,Z.length-ye.length,K,r,J),we=H,Ie=H,je=2*k.count,ut=new Nwt(we,Ie,je,X/3);JNe(ne,ut,f),S.set(ne,ut),c.push(ne,Ige(this._materials[lh.Bottom],ye,0,K,r,J)),u.push(K.heights)}if(c.length===0)return null;const M=new ow({geometries:c,layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0});M.transformation=f;const O=PLe(this.symbolLayer,{opacity:this._getLayerOpacity()}),D=O!=null?{baseMaterial:this._materials[lh.Main],edgeMaterials:[O],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,U=new Ty(this,M,c,null,null,(k,H,V,X,q)=>Pwt(k,H,V,X,q,u,S),s,D);return U.alignedSampledElevation=a.sampledElevation,U.needsElevationUpdates=Fb(s.mode),U}};function Ige(t,e,i,r,s,n){const o=tw(e.length),a=[[R.POSITION,new ht(r.positions,e,3,!0)],[R.NORMALCOMPRESSED,new ht(r.normals,e,2,!0)],[R.COLOR,new ht(s,o,4,!0)]];return new Tn(t,a,r.elevation,Fs.Mesh,n,i)}function Cwt(t,e,i,r,s,n,o,a,l,c,u,d,f){{const m=i.length/3,g=2*r.count;Mwt(t,e,r.index,r.count,i,0,m,s,n,o,a,l,c,g,u,d,f)}{let m=0,g=2*r.count,y=0;const v=r.pathLengths[0];Lge(s,n,a,o,m,v,r.count,g,l,y,u),g+=4*v,y+=2*v,m+=v;for(let b=1;b<r.pathLengths.length;++b){const w=r.pathLengths[b];Lge(s,n,a,o,m,w,r.count,g,l,y,u),g+=4*w,y+=2*w,m+=w}}}function Mwt(t,e,i,r,s,n,o,a,l,c,u,d,f,m,g,y,v){ve(eh,y);{const b=g>0?1:-1;let w=3*i,x=0,S=3*x,C=r,M=3*C;for(let O=0;O<r;++O){const D=t[w],U=t[w+1],k=t[w+2];v&&(eh[0]=D,eh[1]=U,eh[2]=k,Ce(eh,eh)),a[S+0]=D,a[S+1]=U,a[S+2]=k;const H=e[w+0],V=e[w+1],X=e[w+2];l[S+0]=H,l[S+1]=V,l[S+2]=X,c[S+0]=-b*eh[0],c[S+1]=-b*eh[1],c[S+2]=-b*eh[2],u[x]=0,a[M+0]=D+g*eh[0],a[M+1]=U+g*eh[1],a[M+2]=k+g*eh[2],l[M+0]=H,l[M+1]=V,l[M+2]=X,u[C]=g,S+=3,M+=3,w+=3,x+=1,C+=1}}{let b=3*n,w=0,x=3*m;const S=g<0?Vge:Uge,C=g<0?Uge:Vge;for(let M=0;M<o;++M)f[w]=s[b+S[0]],f[w+1]=s[b+S[1]],f[w+2]=s[b+S[2]],d[x]=s[b+C[0]]+r,d[x+1]=s[b+C[1]]+r,d[x+2]=s[b+C[2]]+r,w+=3,x+=3,b+=3}}function b4(t,e,i,r,s,n,o){r[n]=r[o],o*=3,t[n*=3]=t[o],t[n+1]=t[o+1],t[n+2]=t[o+2],e[n]=e[o],e[n+1]=e[o+1],e[n+2]=e[o+2],i[n]=s[0],i[n+1]=s[1],i[n+2]=s[2]}const oR=E();function Lge(t,e,i,r,s,n,o,a,l,c,u){let d=s,f=s+1,m=s+o,g=s+o+1,y=a,v=a+1,b=a+2*n,w=a+2*n+1;u<0&&(d=s+o+1,g=s);let x=3*c;for(let S=0;S<n;++S)S===n-1&&(f=s,u>0?g=s+o:d=s+o),Awt(t,d,f,m,oR),b4(t,e,r,i,oR,y,d),b4(t,e,r,i,oR,v,f),b4(t,e,r,i,oR,b,m),b4(t,e,r,i,oR,w,g),l[x]=y,l[x+1]=b,l[x+2]=w,l[x+3]=y,l[x+4]=w,l[x+5]=v,x+=6,d++,f++,m++,g++,y+=2,v+=2,b+=2,w+=2}const e9=E(),Dge=E(),Nge=E(),Fge=E(),kge=E();function Awt(t,e,i,r,s){e*=3,i*=3,r*=3,de(e9,t[e++],t[e++],t[e++]),de(Dge,t[i++],t[i++],t[i++]),de(Nge,t[r++],t[r++],t[r++]),Re(Fge,Dge,e9),Re(kge,Nge,e9),ft(s,kge,Fge),Ce(s,s)}const gE=E();function Pwt(t,e,i,r,s,n,o){const a=t.stageObject,l=a.geometries,c=l.length,u=e.mode!=="absolute-height";let d=0;const f=a.transformation,m=Hb(ke(),f);for(let g=0;g<c;g+=2){const y=l[g];if(!Zne(y))continue;const v=y.getMutableAttribute(R.POSITION).data,b=n[g/2],w=new lse(y.mapPositions),x=v.length/3;let S=!1,C=0;{let M=0;for(let O=0;O<x;O++){gE[0]=v[M],gE[1]=v[M+1],gE[2]=v[M+2],r(w,w4),u&&(C+=w4.sampledElevation),Nr.TESTS_DISABLE_OPTIMIZATIONS?(de(Dl,w.array[w.offset],w.array[w.offset+1],w4.z+b[M/3]),i!=null&&s.toRenderCoords(Dl,i,Dl),nt(Dl,Dl,m)):(de(Dl,v[M],v[M+1],v[M+2]),nt(Dl,Dl,f),s.setAltitude(Dl,w4.z+b[M/3]),nt(Dl,Dl,m)),v[M]=Dl[0],v[M+1]=Dl[1],v[M+2]=Dl[2];const D=Owt/s.unitInMeters;(Math.abs(gE[0]-v[M])>=D||Math.abs(gE[1]-v[M+1])>=D||Math.abs(gE[2]-v[M+2])>=D)&&(S=!0),w.offset+=3,M+=3}}if(S){const M=o.get(y);M&&JNe(y,M,f),a.geometryVertexAttributeUpdated(l[g],R.NORMALCOMPRESSED),y.invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[g],R.POSITION),l[g+1].invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[g+1],R.POSITION)}d+=C/x}return d/c}function JNe(t,e,i){const r=t.getMutableAttribute(R.POSITION),s=t.getMutableAttribute(R.NORMALCOMPRESSED).data,{topVertexStart:n,topVertexCount:o,topFaceStart:a,topFaceCount:l}=e,c=r.data,u=o,d=t.attributes.get(R.POSITION).indices,f=a+l,m=n+o,g=co(3*u);for(let S=0;S<u;++S){const C=3*S;g[C+0]=0,g[C+1]=0,g[C+2]=0}const y=Rwt,v=$wt,b=Iwt,w=Lwt,x=eh;for(let S=a;S<f;++S){const C=3*S;for(let M=0;M<3;++M){const O=d[C+M];w[M]=O;const D=3*O;de(Dl,c[D+0],c[D+1],c[D+2]),nt(y[M],Dl,i)}Ii(v,y[1],y[0]),Ii(b,y[2],y[0]),ft(x,v,b),Ce(x,x);for(let M=0;M<3;++M){const O=3*(w[M]-n);g[O+0]+=x[0],g[O+1]+=x[1],g[O+2]+=x[2]}}for(let S=n;S<m;++S){const C=3*(S-n),M=g[C+0],O=g[C+1],D=g[C+2],U=Math.sqrt(M*M+O*O+D*D);np(s,S,M/U,O/U,D/U)}}const Dl=E(),eh=E(),w4=new WD,Uge=[0,2,1],Vge=[0,1,2],Owt=.01,Rwt=[E(),E(),E()],$wt=E(),Iwt=E(),Lwt=[0,0,0];var lh;(function(t){t[t.Main=0]="Main",t[t.Bottom=1]="Bottom"})(lh||(lh={}));let Dwt=class{constructor(e,i,r,s){this.positions=e,this.elevation=i,this.normals=r,this.heights=s}},Nwt=class{constructor(e,i,r,s){this.topVertexStart=e,this.topVertexCount=i,this.topFaceStart=r,this.topFaceCount=s}};const x4=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["«","»"],["»","«"],["‹","›"],["›","‹"],["⁽","⁾"],["⁾","⁽"],["₍","₎"],["₎","₍"],["≤","≥"],["≥","≤"],["〈","〉"],["〉","〈"],["﹙","﹚"],["﹚","﹙"],["﹛","﹜"],["﹜","﹛"],["﹝","﹞"],["﹞","﹝"],["﹤","﹥"],["﹥","﹤"]],xP=["آ","أ","إ","ا"],Fwt=["ﻵ","ﻷ","ﻹ","ﻻ"],kwt=["ﻶ","ﻸ","ﻺ","ﻼ"],DB=["ا","ب","ت","ث","ج","ح","خ","د","ذ","ر","ز","س","ش","ص","ض","ط","ظ","ع","غ","ف","ق","ك","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ی","ئ","ؤ"],Uwt=["ﺍ","ﺏ","ﺕ","ﺙ","ﺝ","ﺡ","ﺥ","ﺩ","ﺫ","ﺭ","ﺯ","ﺱ","ﺵ","ﺹ","ﺽ","ﻁ","ﻅ","ﻉ","ﻍ","ﻑ","ﻕ","ﻙ","ﻝ","ﻡ","ﻥ","ﻩ","ﻭ","ﻱ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯼ","ﺉ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺉ","ﺅ"],Vwt=["ﺎ","ﺐ","ﺖ","ﺚ","ﺞ","ﺢ","ﺦ","ﺪ","ﺬ","ﺮ","ﺰ","ﺲ","ﺶ","ﺺ","ﺾ","ﻂ","ﻆ","ﻊ","ﻎ","ﻒ","ﻖ","ﻚ","ﻞ","ﻢ","ﻦ","ﻪ","ﻮ","ﻲ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯽ","ﺊ","ﺆ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺊ","ﺆ"],zwt=["ﺎ","ﺒ","ﺘ","ﺜ","ﺠ","ﺤ","ﺨ","ﺪ","ﺬ","ﺮ","ﺰ","ﺴ","ﺸ","ﺼ","ﻀ","ﻄ","ﻈ","ﻌ","ﻐ","ﻔ","ﻘ","ﻜ","ﻠ","ﻤ","ﻨ","ﻬ","ﻮ","ﻴ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯿ","ﺌ","ﺆ","ﹱ","ﹲ","ﹴ","ﹷ","ﹹ","ﹻ","ﹽ","ﹿ","ﺀ","ﺌ","ﺆ"],Bwt=["ﺍ","ﺑ","ﺗ","ﺛ","ﺟ","ﺣ","ﺧ","ﺩ","ﺫ","ﺭ","ﺯ","ﺳ","ﺷ","ﺻ","ﺿ","ﻃ","ﻇ","ﻋ","ﻏ","ﻓ","ﻗ","ﻛ","ﻟ","ﻣ","ﻧ","ﻫ","ﻭ","ﻳ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯾ","ﺋ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺋ","ﺅ"],zge=["ء","آ","أ","ؤ","إ","ا","ة","د","ذ","ر","ز","و","ى"],jwt=["ً","ً","ٌ","؟","ٍ","؟","َ","َ","ُ","ُ","ِ","ِ","ّ","ّ","ْ","ْ","ء","آ","آ","أ","أ","ؤ","ؤ","إ","إ","ئ","ئ","ئ","ئ","ا","ا","ب","ب","ب","ب","ة","ة","ت","ت","ت","ت","ث","ث","ث","ث","ج","ج","ج","ج","ح","ح","ح","ح","خ","خ","خ","خ","د","د","ذ","ذ","ر","ر","ز","ز","س","س","س","س","ش","ش","ش","ش","ص","ص","ص","ص","ض","ض","ض","ض","ط","ط","ط","ط","ظ","ظ","ظ","ظ","ع","ع","ع","ع","غ","غ","غ","غ","ف","ف","ف","ف","ق","ق","ق","ق","ك","ك","ك","ك","ل","ل","ل","ل","م","م","م","م","ن","ن","ن","ن","ه","ه","ه","ه","و","و","ى","ى","ي","ي","ي","ي","ﻵ","ﻶ","ﻷ","ﻸ","ﻹ","ﻺ","ﻻ","ﻼ","؟","؟","؟"],Bge=["ء","ف"],Gwt=["غ","ي"],Hwt=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],qwt=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],$=0,De=1,Gt=2,Un=3,A=4,cg=5,SU=6,P=7,$l=8,cc=9,xp=10,ti=11,oe=12,Wwt=13,Zwt=14,Ywt=15,Xwt=16,Jwt=17,Mt=18,Qwt=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],rg=100,Kwt=[rg+0,$,$,$,$,rg+1,rg+2,rg+3,De,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,rg+4,A,A,A,$,A,$,A,$,A,A,A,$,$,A,A,$,$,$,$,$,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,$,$,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,$,$,A,A,$,$,A,A,$,$,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,$,$,$,rg+5,P,P,rg+6,rg+7],ext=[[Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,SU,cg,SU,$l,cg,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,cg,cg,cg,SU,$l,A,A,ti,ti,ti,A,A,A,A,A,xp,cc,xp,cc,cc,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,cc,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,Mt,Mt,Mt,Mt,Mt,Mt,cg,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,Mt,cc,A,ti,ti,ti,ti,A,A,A,A,$,A,A,Mt,A,A,ti,ti,Gt,Gt,A,$,A,A,A,Gt,$,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,$,$,$,$,$,$,$,$],[$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,$,$,$,$,$,$,$,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,$,A,A,A,A,A,A,A,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,De,oe,De,oe,oe,De,oe,oe,De,oe,A,A,A,A,A,A,A,A,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,A,A,A,A,A,De,De,De,De,De,A,A,A,A,A,A,A,A,A,A,A],[Un,Un,Un,Un,A,A,A,A,P,ti,ti,P,cc,P,A,A,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,P,A,A,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,Un,Un,Un,Un,Un,Un,Un,Un,Un,Un,ti,Un,Un,P,P,P,oe,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,oe,oe,oe,oe,oe,oe,oe,Un,A,oe,oe,oe,oe,oe,oe,P,P,oe,oe,A,oe,oe,oe,oe,P,P,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,P,P,P,P,P,P],[P,P,P,P,P,P,P,P,P,P,P,P,P,P,A,P,P,oe,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,A,A,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,P,A,A,A,A,A,A,A,A,A,A,A,A,A,A,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,oe,oe,oe,oe,oe,oe,oe,oe,oe,De,De,A,A,A,A,De,A,A,A,A,A],[$l,$l,$l,$l,$l,$l,$l,$l,$l,$l,$l,Mt,Mt,Mt,$,De,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,$l,cg,Wwt,Zwt,Ywt,Xwt,Jwt,cc,ti,ti,ti,ti,ti,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,cc,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,$l,Mt,Mt,Mt,Mt,Mt,A,A,A,A,A,Mt,Mt,Mt,Mt,Mt,Mt,Gt,$,A,A,Gt,Gt,Gt,Gt,Gt,Gt,xp,xp,A,A,A,$,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,xp,xp,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,ti,ti,ti,ti,ti,ti,ti,ti,ti,ti,ti,ti,ti,ti,ti,ti,ti,ti,ti,ti,ti,ti,ti,ti,ti,ti,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A],[$,$,$,$,$,$,$,A,A,A,A,A,A,A,A,A,A,A,A,$,$,$,$,$,A,A,A,A,A,De,oe,De,De,De,De,De,De,De,De,De,De,xp,De,De,De,De,De,De,De,De,De,De,De,De,De,A,De,De,De,De,De,A,De,A,De,De,A,De,De,A,De,De,De,De,De,De,De,De,De,De,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P],[oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,oe,oe,oe,oe,oe,oe,oe,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,cc,A,cc,A,A,cc,A,A,A,A,A,A,A,A,A,ti,A,A,xp,xp,A,A,A,A,A,ti,ti,A,A,A,A,A,P,P,P,P,P,A,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,A,A,Mt],[A,A,A,ti,ti,ti,A,A,A,A,A,xp,cc,xp,cc,cc,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,cc,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,A,A,A,A,A,A,A,A,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,A,A,A,$,$,$,$,$,$,A,A,$,$,$,$,$,$,A,A,$,$,$,$,$,$,A,A,$,$,$,A,A,A,ti,ti,A,A,A,ti,ti,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A]];let txt=class{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(e,i,r){if(this.sourceToTarget=[],this.targetToSource=[],!e)return"";if(_xt(this.sourceToTarget,this.targetToSource,e.length),!this.checkParameters(i,r))return e;i=this.inputFormat,r=this.outputFormat;let s=e;const n=bxt,o=Hge(i.charAt(1)),a=Hge(r.charAt(1)),l=(i.charAt(0)==="I"?"L":i.charAt(0))+o,c=(r.charAt(0)==="I"?"L":r.charAt(0))+a,u=i.charAt(2)+r.charAt(2);n.defInFormat=l,n.defOutFormat=c,n.defSwap=u;const d=V$(e,l,c,u,n);let f=!1;return r.charAt(1)==="R"?f=!0:r.charAt(1)!=="C"&&r.charAt(1)!=="D"||(f=this.checkContextual(d)==="rtl"),this.sourceToTarget=Th,this.targetToSource=vxt(this.sourceToTarget),FB=this.targetToSource,s=i.charAt(3)===r.charAt(3)?d:r.charAt(3)==="S"?rxt(f,d):oxt(d,f,!0),this.sourceToTarget=Th,this.targetToSource=FB,this.levels=F6,s}_inputFormatSetter(e){if(!qge.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=e}_outputFormatSetter(e){if(!qge.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=e}checkParameters(e,i){return e?this._inputFormatSetter(e):e=this.inputFormat,i?this._outputFormatSetter(i):i=this.outputFormat,e!==i}checkContextual(e){let i=NB(e);if(i!=="ltr"&&i!=="rtl"){try{i=document.dir.toLowerCase()}catch{}i!=="ltr"&&i!=="rtl"&&(i="ltr")}return i}hasBidiChar(e){return Txt.test(e)}};function V$(t,e,i,r,s){const n=ixt(t,{inFormat:e,outFormat:i,swap:r},s);if(n.inFormat===n.outFormat)return t;e=n.inFormat,i=n.outFormat,r=n.swap;const o=e.substring(0,1),a=e.substring(1,4),l=i.substring(0,1),c=i.substring(1,4);if(s.inFormat=e,s.outFormat=i,s.swap=r,o==="L"&&i==="VLTR"){if(a==="LTR")return s.dir=yE,fv(t,s);if(a==="RTL")return s.dir=z$,fv(t,s)}if(o==="V"&&l==="V")return s.dir=a==="RTL"?z$:yE,t9(t,s);if(o==="L"&&i==="VRTL")return a==="LTR"?(s.dir=yE,t=fv(t,s)):(s.dir=z$,t=fv(t,s)),t9(t);if(e==="VLTR"&&i==="LLTR")return s.dir=yE,fv(t,s);if(o==="V"&&l==="L"&&a!==c)return t=t9(t),a==="RTL"?V$(t,"LLTR","VLTR",r,s):V$(t,"LRTL","VRTL",r,s);if(e==="VRTL"&&i==="LRTL")return V$(t,"LRTL","VRTL",r,s);if(o==="L"&&l==="L"){const u=s.swap;return s.swap=u.substr(0,1)+"N",a==="RTL"?(s.dir=z$,t=fv(t,s),s.swap="N"+u.substr(1,2),s.dir=yE,t=fv(t,s)):(s.dir=yE,t=fv(t,s),s.swap="N"+u.substr(1,2),t=V$(t,"VLTR","LRTL",s.swap,s)),t}return t}function ixt(t,e,i){if(e.inFormat===void 0&&(e.inFormat=i.defInFormat),e.outFormat===void 0&&(e.outFormat=i.defOutFormat),e.swap===void 0&&(e.swap=i.defSwap),e.inFormat===e.outFormat)return e;const r=e.inFormat.substring(0,1),s=e.outFormat.substring(0,1);let n,o=e.inFormat.substring(1,4),a=e.outFormat.substring(1,4);return o.charAt(0)==="C"&&(n=NB(t),o=n==="ltr"||n==="rtl"?n.toUpperCase():e.inFormat.charAt(2)==="L"?"LTR":"RTL",e.inFormat=r+o),a.charAt(0)==="C"&&(n=NB(t),n==="rtl"?a="RTL":n==="ltr"?(n=nxt(t),a=n.toUpperCase()):a=e.outFormat.charAt(2)==="L"?"LTR":"RTL",e.outFormat=s+a),e}function rxt(t,e,i){if(e.length===0)return"";t===void 0&&(t=!0);const r=(e=String(e)).split("");let s=0,n=1,o=r.length;t||(s=r.length-1,n=-1,o=1);const a=sxt(r,s,n,o);let l="";for(let c=0;c<r.length;c++)uxt(a,a.length,c)>-1?(eFe(FB,c,!t,-1),Th.splice(c,1)):l+=r[c];return l}function sxt(t,e,i,r,s){let n=0;const o=[];let a=0;for(let l=e;l*i<r;l+=i)if(KNe(t[l])||DL(t[l])){if(t[l]==="ل"&&hxt(t,l+i,i,r)){t[l]=yxt(t[l+i],n===0?Fwt:kwt),l+=i,gxt(t,l,i,r),o[a]=l,a++,n=0;continue}const c=t[l];n===1?t[l]=jge(t,l+i,i,r)?mxt(t[l]):i9(t[l],Vwt):jge(t,l+i,i,r)===!0?t[l]=i9(t[l],Bwt):t[l]=i9(t[l],Uwt),DL(c)||(n=1),fxt(c)===!0&&(n=0)}else n=0;return o}function NB(t){const e=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(t);return e?e[0]<="z"?"ltr":"rtl":""}function nxt(t){const e=t.split("");return e.reverse(),NB(e.join(""))}function oxt(t,e,i){if(t.length===0)return"";e===void 0&&(e=!0);let r="";const s=(t=String(t)).split("");for(let n=0;n<t.length;n++){let o=!1;if(s[n]>="ﹰ"&&s[n]<"\uFEFF"){const a=t.charCodeAt(n);s[n]>="ﻵ"&&s[n]<="ﻼ"?(e?(n>0&&i&&s[n-1]===" "?r=r.substring(0,r.length-1)+"ل":(r+="ل",o=!0),r+=xP[(a-65269)/2]):(r+=xP[(a-65269)/2],r+="ل",n+1<t.length&&i&&s[n+1]===" "?n++:o=!0),o&&(eFe(FB,n,!0,1),Th.splice(n,0,Th[n]))):r+=jwt[a-65136]}else r+=s[n]}return r}function fv(t,e){const i=t.split(""),r=[];return QNe(i,r,e),lxt(i,r,e),Gge(2,i,r,e),Gge(1,i,r,e),F6=r,i.join("")}function QNe(t,e,i){const r=t.length,s=i.dir?qwt:Hwt;let n=0,o=-1;const a=[],l=[];i.hiLevel=i.dir,i.lastArabic=!1,i.hasUbatAl=!1,i.hasUbatB=!1,i.hasUbatS=!1;for(let c=0;c<r;c++)a[c]=cxt(t[c]);for(let c=0;c<r;c++){const u=n,d=dxt(t,a,l,c,i);l[c]=d,n=s[u][d];const f=240&n;n&=15;const m=s[n][wxt];if(e[c]=m,f>0)if(f===16){for(let g=o;g<c;g++)e[g]=1;o=-1}else o=-1;if(s[n][xxt])o===-1&&(o=c);else if(o>-1){for(let g=o;g<c;g++)e[g]=m;o=-1}a[c]===cg&&(e[c]=0),i.hiLevel|=m}i.hasUbatS&&axt(a,e,r,i)}function axt(t,e,i,r){for(let s=0;s<i;s++)if(t[s]===SU){e[s]=r.dir;for(let n=s-1;n>=0&&t[n]===$l;n--)e[n]=r.dir}}function lxt(t,e,i){if(i.hiLevel!==0&&i.swap.substr(0,1)!==i.swap.substr(1,2))for(let r=0;r<t.length;r++)e[r]===1&&(t[r]=pxt(t[r]))}function cxt(t){const e=t.charCodeAt(0),i=Kwt[e>>8];return i<rg?i:ext[i-rg][255&e]}function t9(t,e){const i=t.split("");if(e){const r=[];QNe(i,r,e),F6=r}return i.reverse(),Th.reverse(),i.join("")}function uxt(t,e,i){for(let r=0;r<e;r++)if(t[r]===i)return r;return-1}function KNe(t){for(let e=0;e<Bge.length;e++)if(t>=Bge[e]&&t<=Gwt[e])return!0;return!1}function jge(t,e,i,r){for(;e*i<r&&DL(t[e]);)e+=i;return!!(e*i<r&&KNe(t[e]))}function hxt(t,e,i,r){for(;e*i<r&&DL(t[e]);)e+=i;let s=" ";if(!(e*i<r))return!1;s=t[e];for(let n=0;n<xP.length;n++)if(xP[n]===s)return!0;return!1}function Gge(t,e,i,r){if(r.hiLevel<t)return;if(t===1&&r.dir===z$&&!r.hasUbatB)return e.reverse(),void Th.reverse();const s=e.length;let n,o,a,l,c,u=0;for(;u<s;){if(i[u]>=t){for(n=u+1;n<s&&i[n]>=t;)n++;for(o=u,a=n-1;o<a;o++,a--)l=e[o],e[o]=e[a],e[a]=l,c=Th[o],Th[o]=Th[a],Th[a]=c;u=n}u++}}function dxt(t,e,i,r,s){const n=e[r];return{UBAT_L:()=>(s.lastArabic=!1,$),UBAT_R:()=>(s.lastArabic=!1,De),UBAT_ON:()=>A,UBAT_AN:()=>Un,UBAT_EN:()=>s.lastArabic?Un:Gt,UBAT_AL:()=>(s.lastArabic=!0,s.hasUbatAl=!0,De),UBAT_WS:()=>A,UBAT_CS:()=>{let o,a;return r<1||r+1>=e.length||(o=i[r-1])!==Gt&&o!==Un||(a=e[r+1])!==Gt&&a!==Un?A:(s.lastArabic&&(a=Un),a===o?a:A)},UBAT_ES:()=>(r>0?i[r-1]:cg)===Gt&&r+1<e.length&&e[r+1]===Gt?Gt:A,UBAT_ET:()=>{if(r>0&&i[r-1]===Gt)return Gt;if(s.lastArabic)return A;let o=r+1;const a=e.length;for(;o<a&&e[o]===ti;)o++;return o<a&&e[o]===Gt?Gt:A},UBAT_NSM:()=>{if(s.inFormat==="VLTR"){const o=e.length;let a=r+1;for(;a<o&&e[a]===oe;)a++;if(a<o){const l=t[r].charCodeAt(0),c=l>=1425&&l<=2303||l===64286,u=e[a];if(c&&(u===De||u===P))return De}}return r<1||e[r-1]===cg?A:i[r-1]},UBAT_B:()=>(s.lastArabic=!0,s.hasUbatB=!0,s.dir),UBAT_S:()=>(s.hasUbatS=!0,A),UBAT_LRE:()=>(s.lastArabic=!1,A),UBAT_RLE:()=>(s.lastArabic=!1,A),UBAT_LRO:()=>(s.lastArabic=!1,A),UBAT_RLO:()=>(s.lastArabic=!1,A),UBAT_PDF:()=>(s.lastArabic=!1,A),UBAT_BN:()=>A}[Qwt[n]]()}function pxt(t){let e,i=0,r=x4.length-1;for(;i<=r;)if(e=Math.floor((i+r)/2),t<x4[e][0])r=e-1;else{if(!(t>x4[e][0]))return x4[e][1];i=e+1}return t}function fxt(t){for(let e=0;e<zge.length;e++)if(zge[e]===t)return!0;return!1}function mxt(t){for(let e=0;e<DB.length;e++)if(t===DB[e])return zwt[e];return t}function i9(t,e){for(let i=0;i<DB.length;i++)if(t===DB[i])return e[i];return t}function DL(t){return t>="ً"&&t<="ٕ"}function Hge(t){return t==="L"?"LTR":t==="R"?"RTL":t==="C"?"CLR":t==="D"?"CRL":""}function gxt(t,e,i,r){for(;e*i<r&&DL(t[e]);)e+=i;return e*i<r&&(t[e]=" ",!0)}function yxt(t,e){for(let i=0;i<xP.length;i++)if(t===xP[i])return e[i];return t}function _xt(t,e,i){Th=[],F6=[];for(let r=0;r<i;r++)t[r]=r,e[r]=r,Th[r]=r}function vxt(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[t[i]]=i;return e}function eFe(t,e,i,r){for(let s=0;s<t.length;s++)(t[s]>e||!i&&t[s]===e)&&(t[s]+=r)}let Th=[],FB=[],F6=[];const bxt={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},wxt=5,xxt=6,yE=0,z$=1,qge=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,Txt=/[\u0591-\u06ff\ufb1d-\ufefc]/,r9=new txt;function Sxt(t){if(t==null)return["",!1];if(!r9.hasBidiChar(t))return[t,!1];let e;return e=r9.checkContextual(t)==="rtl"?"IDNNN":"ICNNN",[r9.bidiTransform(t,e,"VLYSN"),!0]}let hO=class{constructor(){this.setIdentity()}getAngle(){return(this.rz==null||this.rz===0&&this.rzCos!==1&&this.rzSin!==0)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(e,i){this.tx=e,this.ty=i}setTranslateZ(e){this.tz=e}setRotateCS(e,i){this.rz=void 0,this.rzCos=e,this.rzSin=i}setRotate(e){this.rz=e,this.rzCos=void 0,this.rzSin=void 0}setRotateY(e){this.ry=e}setScale(e){this.s=e}setMeasure(e){this.m=e}};const Uoe="arial-unicode-ms",Wge="woff2",Zge=new Map,tFe=new Set;let Ext=class{constructor(e,i){this.fontFace=e,this.promise=i}};async function Cxt(t){const e=Oxt(t),i=Pxt(t),r=Zge.get(e);if(r)return r.promise;const s=new FontFace(t.family,`url('${rr.fontsUrl}/woff2/${i}.${Wge}') format('${Wge}')`,{style:t.style,weight:t.weight}),n=document.fonts;if(n.has(s)&&s.status==="loading")return s.loaded;const o=s.load().then(()=>(n.add(s),s));return Zge.set(e,new Ext(s,o)),tFe.add(s),o}function Mxt(t){return tFe.has(t)}function Axt(t){if(!t)return Uoe;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function Pxt(t){const e=iFe(t)+rFe(t);return Axt(t.family)+(e.length>0?e:"-regular")}function Oxt(t){const e=iFe(t)+rFe(t);return(t.family||Uoe)+(e.length>0?e:"-regular")}function iFe(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function rFe(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let Yn=class{static fromOptimized(e,i,r=!1,s=!1,n=1){return new eK().initialize(e,i,r,s,n)}static fromJSON(e,i=!1,r=!1){const[s,n]=Yge(e);return new tK().initialize(s,n,i,r,1)}static fromOptimizedCIM(e,i,r=!1,s=!1,n=1){return new Xge().initialize(e,i,r,s,n)}static fromJSONCIM(e,i=!1,r=!1,s=1){const[n,o]=Yge(e);return new Jge().initialize(n,o,i,r,s)}static fromFeatureSetReader(e){const i=e.readGeometryForDisplay(),r=e.geometryType;return i&&r?this.fromOptimized(i,r):null}static fromFeatureSetReaderCIM(e){const i=e.readGeometryForDisplay(),r=e.geometryType;return i&&r?this.fromOptimizedCIM(i,r):null}static createEmptyOptimized(e,i=!1,r=!1,s=1){return new eK().initialize(new gl,e,i,r,s)}static createEmptyJSON(e,i=!1,r=!1){return new tK().initialize([],e,i,r,1)}static createEmptyOptimizedCIM(e,i=!1,r=!1,s=1){return new Xge().initialize(new gl,e,i,r,s)}static createEmptyJSONCIM(e,i=!1,r=!1,s=1){return new Jge().initialize([],e,i,r,s)}asJSON(){const e=vD(this);return this.geometryType==="esriGeometryEnvelope"?{xmin:e[0][0][0],ymin:e[0][0][1],xmax:e[0][2][0],ymax:e[0][2][1]}:this.geometryType==="esriGeometryMultipoint"?{points:e.flat()}:this.geometryType==="esriGeometryPoint"?{x:e[0][0][0],y:e[0][0][1]}:this.geometryType==="esriGeometryPolygon"?{rings:e}:{paths:e}}getCurrentRingArea(){if(this.pathSize<3)return 0;let e,i,r=0;if(this.seekPathStart(),!this.nextPoint())return 0;e=this.x,i=this.y;const s=e,n=i;for(;this.nextPoint();)r+=(e-this.x)*(i+this.y),e=this.x,i=this.y;return r+=(e-s)*(i+n),-.5*r}invertY(){this.yFactor*=-1}},eK=class sFe extends Yn{constructor(){super(...arguments),this._end=-1}initialize(e,i,r,s,n){return this.hasZ=r,this.hasM=s,this.geometryType=i,this._stride=2+Number(r)+Number(s),this._geometry=e,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=n,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(e){if(e>=0&&e<this.totalSize){if(this._pathIndex<e)for(;this._pathIndex<e&&this.nextPath(););else if(this._pathIndex>e)for(;this._pathIndex>e&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(e){const i=this._pathOffset+e*this._stride;return i>=0&&i<this._end&&(this._pointOffset=i,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1)&&(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,!0)}prevPath(){return!(this.pathIndex<=0)&&(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,!0)}pathLength(){const e=this._end,i=this._stride,r=this._geometry.coords;let s=0;for(let n=this._pathOffset+i;n<e;n+=i){const o=r[n-i],a=r[n-i+1],l=r[n]-o,c=r[n+1]-a;s+=Math.sqrt(l*l+c*c)}return s}startPath(){this._geometry.lengths.push(0)}pushPath(e){this.startPath(),this.pushPoints(e)}pushPoint(e){for(let i=0;i<this._stride;++i)this._geometry.coords.push(e[i]);this._geometry.lengths[this.totalSize-1]++}pushXY(e,i){this._geometry.coords.push(e,i),this._geometry.lengths[this.totalSize-1]++}pushPoints(e){for(const i of e)for(let r=0;r<this._stride;++r)this._geometry.coords.push(i[r]);this._geometry.lengths[this.totalSize-1]+=e.length}pushCursor(e){const i=e.asOptimized();this._geometry.coords.push(...i.coords),this._geometry.lengths.push(...i.lengths)}asOptimized(){const e=this._geometry.clone();if(this.yFactor!==1)for(let i=1;i<e.coords.length;i+=this._stride)e.coords[i]*=this.yFactor;return this.geometryType==="esriGeometryPoint"&&(e.lengths.length=0),e}isClosed(){const e=this._geometry.coords,i=this._pathOffset,r=this._end-this._stride;for(let s=0;s<this._stride;s++)if(e[i+s]!==e[r+s])return!1;return!0}clone(){return new sFe().initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce((e,i)=>e+i)}get pathSize(){const{lengths:e}=this._geometry;return this._geometry.isPoint?1:this._pathIndex<0||this._pathIndex>e.length-1?0:e[this._pathIndex]}get totalSize(){return this._geometry.isPoint?1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(e){this._geometry.coords[this._pointOffset]=e}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(e){this._geometry.coords[this._pointOffset+1]=this.yFactor*e}get z(){return this._geometry.coords[this._pointOffset+2]}set z(e){this._geometry.coords[this._pointOffset+2]=e}get m(){const e=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+e]}set m(e){this._geometry.coords[this._pointOffset+3]=e}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}};function Rxt(t){const e=[t.x,t.y];return t.z&&e.push(t.z),t.m&&e.push(t.m),e}function Yge(t){return ol(t)?[t.rings,"esriGeometryPolygon"]:vf(t)?[t.paths,"esriGeometryPolyline"]:sS(t)?[[t.points],"esriGeometryMultipoint"]:_f(t)?[[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]],"esriGeometryEnvelope"]:BA(t)?[[[Rxt(t)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}let tK=class nFe extends Yn{initialize(e,i,r,s,n){return this._paths=e,this.geometryType=i,this.hasZ=r,this.hasM=s,this._pathIndex=this._pointIndex=-1,this.yFactor=n,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(e){return this._pathIndex=e,this._pointIndex=-1,e>=0&&e<this.totalSize&&(this._currentPath=this._paths[e],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(e){return e>=0&&e<this._currentPath.length&&(this._pointIndex=e,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){const e=this._currentPath.length,i=this._currentPath;let r=0;for(let s=1;s<e;s++){const n=i[s-1],o=i[s],a=n[0],l=n[1],c=o[0]-a,u=o[1]-l;r+=Math.sqrt(c*c+u*u)}return r}startPath(){this._paths.push([])}pushPath(e){this._paths.push(e)}pushPoint(e){this._paths[this.totalSize-1].push(e)}pushXY(e,i){this._paths[this.totalSize-1].push([e,i])}pushPoints(e){this._paths[this.totalSize-1].push(...e)}pushCursor(e){const i=vD(e);for(const r of i)this.pushPath(r)}asOptimized(){const e=new gl;if(this.geometryType==="esriGeometryPoint")e.coords.push(...this._paths[0][0]),e.lengths.length=0;else for(const i of this._paths){for(const r of i)e.coords.push(r[0]),e.coords.push(r[1]*this.yFactor),this.hasZ&&e.coords.push(r[2]),this.hasM&&e.coords.push(r[this._mIndex]);e.lengths.push(i.length)}return e}isClosed(){const e=this._currentPath[0],i=this._currentPath[this._currentPath.length-1];for(let r=0;r<e.length;r++)if(e[r]!==i[r])return!1;return!0}clone(){return new nFe().initialize(ie(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map(e=>e.length).reduce((e,i)=>e+i)}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(e){this._currentPoint[0]=e}get y(){return this.yFactor*this._currentPoint[1]}set y(e){this._currentPoint[1]=this.yFactor*e}get z(){return this._currentPoint[2]}set z(e){this._currentPoint[2]=e}get m(){return this._currentPoint[this._mIndex]}set m(e){this._currentPoint[this._mIndex]=e}get pathIndex(){return this._pathIndex}};const T4=4,S4=1;let Xge=class oFe extends eK{initialize(e,i,r,s,n){return super.initialize(e,i,r,s,n),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.totalSize).fill(void 0).map(o=>new Set)),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){const e=new oFe().initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return e._controlPoints=this._controlPoints,e}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(e){this._controlPoints[this.pathIndex].add(e)}getControlPointAt(e){return this._controlPoints[this.pathIndex].has(e)}},Jge=class aFe extends tK{initialize(e,i,r,s,n){return super.initialize(e,i,r,s,n)}clone(){return new aFe().initialize(ie(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][T4]=S4}getControlPoint(){return this._paths[this.pathIndex][this._pointIndex][T4]===S4}setControlPointAt(e){this._paths[this.pathIndex][e][T4]=S4}getControlPointAt(e){return this._paths[this.pathIndex][e][T4]===S4}};const $xt=512;var cf,wa;(function(t){t[t.Unknown=0]="Unknown",t[t.Point=1]="Point",t[t.LineString=2]="LineString",t[t.Polygon=3]="Polygon"})(cf||(cf={}));let Ka=class EU{constructor(e,i){this.x=e,this.y=i}clone(){return new EU(this.x,this.y)}equals(e,i){return e===this.x&&i===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,i){return this.x=e,this.y=i,this}normalize(){const e=this.x,i=this.y,r=Math.sqrt(e*e+i*i);return this.x/=r,this.y/=r,this}rightPerpendicular(){const e=this.x;return this.x=this.y,this.y=-e,this}leftPerpendicular(){const e=this.x;return this.x=-this.y,this.y=e,this}move(e,i){return this.x+=e,this.y+=i,this}assign(e){return this.x=e.x,this.y=e.y,this}assignAdd(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}assignSub(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}rotate(e,i){const r=this.x,s=this.y;return this.x=r*e-s*i,this.y=r*i+s*e,this}scale(e){return this.x*=e,this.y*=e,this}length(){const e=this.x,i=this.y;return Math.sqrt(e*e+i*i)}sub(e){return this.x-=e.x,this.y-=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}static distance(e,i){const r=i.x-e.x,s=i.y-e.y;return Math.sqrt(r*r+s*s)}static add(e,i){return new EU(e.x+i.x,e.y+i.y)}static sub(e,i){return new EU(e.x-i.x,e.y-i.y)}},E4=class{constructor(e,i,r){this.ratio=e,this.x=i,this.y=r}},Ixt=class{constructor(e,i,r,s=8,n=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=s,this._pixelMargin=n,this._tileSize=$xt*s,this._dz=e,this._yPos=i,this._xPos=r}setPixelMargin(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);let i=this._pixelRatio*this._pixelMargin;i/=this._finalRatio;const r=e>>this._dz;i>r&&(i=r),this._margin=i,this._xmin=r*this._xPos-i,this._ymin=r*this._yPos-i,this._xmax=this._xmin+r+2*i,this._ymax=this._ymin+r+2*i}reset(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(e,i){this._pushLine(),this._prevIsIn=this._isIn(e,i),this._moveTo(e,i,this._prevIsIn),this._prevPt=new Ka(e,i),this._firstPt=new Ka(e,i),this._dist=0}lineTo(e,i){const r=this._isIn(e,i),s=new Ka(e,i),n=Ka.distance(this._prevPt,s);let o,a,l,c,u,d,f,m;if(r)this._prevIsIn?this._lineTo(e,i,!0):(o=this._prevPt,a=s,l=this._intersect(a,o),this._start=this._dist+n*(1-this._r),this._lineTo(l.x,l.y,!0),this._lineTo(a.x,a.y,!0));else if(this._prevIsIn)a=this._prevPt,o=s,l=this._intersect(a,o),this._lineTo(l.x,l.y,!0),this._lineTo(o.x,o.y,!1);else{const g=this._prevPt,y=s;if(g.x<=this._xmin&&y.x<=this._xmin||g.x>=this._xmax&&y.x>=this._xmax||g.y<=this._ymin&&y.y<=this._ymin||g.y>=this._ymax&&y.y>=this._ymax)this._lineTo(y.x,y.y,!1);else{const v=[];if((g.x<this._xmin&&y.x>this._xmin||g.x>this._xmin&&y.x<this._xmin)&&(c=(this._xmin-g.x)/(y.x-g.x),m=g.y+c*(y.y-g.y),m<=this._ymin?d=!1:m>=this._ymax?d=!0:v.push(new E4(c,this._xmin,m))),(g.x<this._xmax&&y.x>this._xmax||g.x>this._xmax&&y.x<this._xmax)&&(c=(this._xmax-g.x)/(y.x-g.x),m=g.y+c*(y.y-g.y),m<=this._ymin?d=!1:m>=this._ymax?d=!0:v.push(new E4(c,this._xmax,m))),(g.y<this._ymin&&y.y>this._ymin||g.y>this._ymin&&y.y<this._ymin)&&(c=(this._ymin-g.y)/(y.y-g.y),f=g.x+c*(y.x-g.x),f<=this._xmin?u=!1:f>=this._xmax?u=!0:v.push(new E4(c,f,this._ymin))),(g.y<this._ymax&&y.y>this._ymax||g.y>this._ymax&&y.y<this._ymax)&&(c=(this._ymax-g.y)/(y.y-g.y),f=g.x+c*(y.x-g.x),f<=this._xmin?u=!1:f>=this._xmax?u=!0:v.push(new E4(c,f,this._ymax))),v.length===0)u?d?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):d?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(v.length>1&&v[0].ratio>v[1].ratio)this._start=this._dist+n*v[1].ratio,this._lineTo(v[1].x,v[1].y,!0),this._lineTo(v[0].x,v[0].y,!0);else{this._start=this._dist+n*v[0].ratio;for(let b=0;b<v.length;b++)this._lineTo(v[b].x,v[b].y,!0)}this._lineTo(y.x,y.y,!1)}}this._dist+=n,this._prevIsIn=r,this._prevPt=s}close(){if(this._line.length>2){const e=this._firstPt,i=this._prevPt;e.x===i.x&&e.y===i.y||this.lineTo(e.x,e.y);const r=this._line;let s=r.length;for(;s>=4&&(r[0].x===r[1].x&&r[0].x===r[s-2].x||r[0].y===r[1].y&&r[0].y===r[s-2].y);)r.pop(),r[0].x=r[s-2].x,r[0].y=r[s-2].y,--s}}result(e=!0){return this._pushLine(),this._lines.length===0?null:(this._type===cf.Polygon&&e&&Lxt.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==cf.LineString)throw new Error("Only valid for lines");this._pushLine();const e=this._lines,i=e.length;if(i===0)return null;const r=[];for(let s=0;s<i;s++)r.push({line:e[s],start:this._starts[s]||0});return r}_isIn(e,i){return e>=this._xmin&&e<=this._xmax&&i>=this._ymin&&i<=this._ymax}_intersect(e,i){let r,s,n;if(i.x>=this._xmin&&i.x<=this._xmax)s=i.y<=this._ymin?this._ymin:this._ymax,n=(s-e.y)/(i.y-e.y),r=e.x+n*(i.x-e.x);else if(i.y>=this._ymin&&i.y<=this._ymax)r=i.x<=this._xmin?this._xmin:this._xmax,n=(r-e.x)/(i.x-e.x),s=e.y+n*(i.y-e.y);else{s=i.y<=this._ymin?this._ymin:this._ymax,r=i.x<=this._xmin?this._xmin:this._xmax;const o=(r-e.x)/(i.x-e.x),a=(s-e.y)/(i.y-e.y);o<a?(n=o,s=e.y+o*(i.y-e.y)):(n=a,r=e.x+a*(i.x-e.x))}return this._r=n,new Ka(r,s)}_pushLine(){this._line&&(this._type===cf.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===cf.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===cf.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(e,i,r){this._type!==cf.Polygon?r&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new Ka(e,i))):(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new Ka(e,i)),this._isH=!1,this._isV=!1)}_lineTo(e,i,r){let s,n;if(this._type!==cf.Polygon)if(r){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(s=this._line[this._line.length-1],s.equals(e,i)))return;this._line.push(new Ka(e,i))}else this._line&&this._line.length>0&&this._pushLine();else if(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){s=this._line[this._line.length-1];const o=s.x===e,a=s.y===i;if(o&&a)return;this._isH&&o||this._isV&&a?(s.x=e,s.y=i,n=this._line[this._line.length-2],n.x===e&&n.y===i?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(n=this._line[this._line.length-2],this._isH=n.x===e,this._isV=n.y===i)):(this._isH=n.x===e,this._isV=n.y===i)):(this._line.push(new Ka(e,i)),this._isH=o,this._isV=a)}else this._line.push(new Ka(e,i))}},Fti=class{setExtent(e){this._ratio=e===4096?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this._lines=[],this._line=null}moveTo(e,i){this._line&&this._lines.push(this._line),this._line=[];const r=this._ratio;this._line.push(new Ka(e*r,i*r))}lineTo(e,i){const r=this._ratio;this._line.push(new Ka(e*r,i*r))}close(){const e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this._line&&this._lines.push(this._line),this._lines.length===0?null:this._lines}};(function(t){t[t.sideLeft=0]="sideLeft",t[t.sideRight=1]="sideRight",t[t.sideTop=2]="sideTop",t[t.sideBottom=3]="sideBottom"})(wa||(wa={}));let Lxt=class Yv{static simplify(e,i,r){if(!r)return;const s=-i,n=e+i,o=-i,a=e+i,l=[],c=[],u=r.length;for(let f=0;f<u;++f){const m=r[f];if(!m||m.length<2)continue;let g,y=m[0];const v=m.length;for(let b=1;b<v;++b)g=m[b],y.x===g.x&&(y.x<=s&&(y.y>g.y?(l.push(f),l.push(b),l.push(wa.sideLeft),l.push(-1)):(c.push(f),c.push(b),c.push(wa.sideLeft),c.push(-1))),y.x>=n&&(y.y<g.y?(l.push(f),l.push(b),l.push(wa.sideRight),l.push(-1)):(c.push(f),c.push(b),c.push(wa.sideRight),c.push(-1)))),y.y===g.y&&(y.y<=o&&(y.x<g.x?(l.push(f),l.push(b),l.push(wa.sideTop),l.push(-1)):(c.push(f),c.push(b),c.push(wa.sideTop),c.push(-1))),y.y>=a&&(y.x>g.x?(l.push(f),l.push(b),l.push(wa.sideBottom),l.push(-1)):(c.push(f),c.push(b),c.push(wa.sideBottom),c.push(-1)))),y=g}if(l.length===0||c.length===0)return;Yv.fillParent(r,c,l),Yv.fillParent(r,l,c);const d=[];Yv.calcDeltas(d,c,l),Yv.calcDeltas(d,l,c),Yv.addDeltas(d,r)}static fillParent(e,i,r){const s=r.length,n=i.length;for(let o=0;o<n;o+=4){const a=i[o],l=i[o+1],c=i[o+2],u=e[a][l-1],d=e[a][l];let f=8092,m=-1;for(let g=0;g<s;g+=4){if(r[g+2]!==c)continue;const y=r[g],v=r[g+1],b=e[y][v-1],w=e[y][v];switch(c){case wa.sideLeft:case wa.sideRight:if(C4(u.y,b.y,w.y)&&C4(d.y,b.y,w.y)){const x=Math.abs(w.y-b.y);x<f&&(f=x,m=g)}break;case wa.sideTop:case wa.sideBottom:if(C4(u.x,b.x,w.x)&&C4(d.x,b.x,w.x)){const x=Math.abs(w.x-b.x);x<f&&(f=x,m=g)}}}i[o+3]=m}}static calcDeltas(e,i,r){const s=i.length;for(let n=0;n<s;n+=4){const o=[],a=Yv.calcDelta(n,i,r,o);e.push(i[n]),e.push(i[n+1]),e.push(i[n+2]),e.push(a)}}static calcDelta(e,i,r,s){const n=i[e+3];if(n===-1)return 0;const o=s.length;return o>1&&s[o-2]===n?0:(s.push(n),Yv.calcDelta(n,r,i,s)+1)}static addDeltas(e,i){const r=e.length;let s=0;for(let n=0;n<r;n+=4){const o=e[n+3];o>s&&(s=o)}for(let n=0;n<r;n+=4){const o=i[e[n]],a=e[n+1],l=s-e[n+3];switch(e[n+2]){case wa.sideLeft:o[a-1].x-=l,o[a].x-=l,a===1&&(o[o.length-1].x-=l),a===o.length-1&&(o[0].x-=l);break;case wa.sideRight:o[a-1].x+=l,o[a].x+=l,a===1&&(o[o.length-1].x+=l),a===o.length-1&&(o[0].x+=l);break;case wa.sideTop:o[a-1].y-=l,o[a].y-=l,a===1&&(o[o.length-1].y-=l),a===o.length-1&&(o[0].y-=l);break;case wa.sideBottom:o[a-1].y+=l,o[a].y+=l,a===1&&(o[o.length-1].y+=l),a===o.length-1&&(o[0].y+=l)}}}};const C4=(t,e,i)=>t>=e&&t<=i||t>=i&&t<=e,Dxt=512;let Fy,Nxt=class{constructor(e){this._geometry=e}next(){const e=this._geometry;return this._geometry=null,e}};function k6(t,e){Fy||(Fy=new Ixt(0,0,0,1));const i=t.geometryType==="esriGeometryPolygon",r=i?cf.Polygon:cf.LineString,s=i?3:2;let n,o;for(Fy.reset(r),Fy.setPixelMargin(e+1),Fy.setExtent(Dxt);t.nextPath();)if(!(t.pathSize<s)){for(t.nextPoint(),n=t.x,o=-t.y,Fy.moveTo(n,o);t.nextPoint();)n=t.x,o=-t.y,Fy.lineTo(n,o);i&&Fy.close()}const a=Fy.result(!1);if(a){const l=Yn.createEmptyOptimizedCIM(t.geometryType);for(const c of a){l.startPath();for(const u of c)l.pushXY(u.x,-u.y)}return l.reset(),l}return null}let Fxt=class{applyColorSubstituition(e,i){if(!i)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:r,height:s}=e,n=this._rasterizationCanvas,o=n.getContext("2d",{willReadFrequently:!0});e!==n&&(n.width=r,n.height=s,o.drawImage(e,0,0,r,s));const a=o.getImageData(0,0,r,s).data;if(i){for(const c of i)if(c&&c.oldColor&&c.oldColor.length===4&&c.newColor&&c.newColor.length===4){const[u,d,f,m]=c.oldColor,[g,y,v,b]=c.newColor;if(u===g&&d===y&&f===v&&m===b)continue;for(let w=0;w<a.length;w+=4)u===a[w]&&d===a[w+1]&&f===a[w+2]&&m===a[w+3]&&(a[w]=g,a[w+1]=y,a[w+2]=v,a[w+3]=b)}}const l=new ImageData(a,r,s);return o.putImageData(l,0,0),n}tintImageData(e,i){if(!i||i.length<4)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:r,height:s}=e,n=this._rasterizationCanvas,o=n.getContext("2d",{willReadFrequently:!0});e!==n&&(n.width=r,n.height=s,o.drawImage(e,0,0,r,s));const a=o.getImageData(0,0,r,s),l=new Uint8Array(a.data),c=[i[0]/255,i[1]/255,i[2]/255,i[3]/255];for(let d=0;d<l.length;d+=4)l[d]*=c[0],l[d+1]*=c[1],l[d+2]*=c[2],l[d+3]*=c[3];const u=new ImageData(new Uint8ClampedArray(l.buffer),r,s);return o.putImageData(u,0,0),n}},lFe=class B${static local(){return B$.instance===null&&(B$.instance=new B$),B$.instance}execute(e,i,r,s,n){return new kxt(e,i,r)}};lFe.instance=null;let kxt=class{constructor(e,i,r){this._inputGeometries=e,this._angleTolerance=i.angleTolerance!==void 0?i.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let e=this._inputGeometries.next();for(;e;){if(e.geometryType==="esriGeometryPolygon")this._isClosed=!0;else if(e.geometryType==="esriGeometryPolyline")this._isClosed=!1;else{if(e.geometryType!=="esriGeometryEnvelope"){e=this._inputGeometries.next();continue}if(this._maxCosAngle)return e;this._isClosed=!0}for(;e.nextPath();)this._processPath(e);return e.reset(),e}return null}_processPath(e){if(e.nextPoint()){const i=e.x,r=e.y;let s=i,n=r,o=e.pathSize,a=0,l=0,c=0,u=0,d=0,f=0;this._isClosed&&++o;for(let m=1;e.nextPoint()||m<o;++m){let g,y;this._isClosed&&m===o-1?(g=i,y=r):(g=e.x,y=e.y);const v=g-s,b=y-n,w=Math.sqrt(v*v+b*b);m>1&&w>0&&c>0&&(a*v+l*b)/w/c<=this._maxCosAngle&&e.setControlPointAt(m-1),m===1&&(u=v,d=b,f=w),w>0&&(s=g,n=y,a=v,l=b,c=w)}this._isClosed&&c>0&&f>0&&(a*u+l*d)/f/c<=this._maxCosAngle&&e.setControlPointAt(0)}}};function s9(t,e){t[4]=e}let aN=class{constructor(e,i=!0,r=!0,s=0){this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!i&&e.geometryType==="esriGeometryPolygon"||!r&&e.geometryType==="esriGeometryPolyline"?null:e,this.geomUnitsPerPoint=s,this.iterateMultiPath=!1,this.iteratePath=!1,this.internalPlacement=new hO}next(){if(!this.geometryCursor)return null;const e=this.processMultiPath(this.geometryCursor);return this.iterateMultiPath&&e||(this.geometryCursor=null),e}processMultiPath(e){for(;this.iteratePath||e.pathIndex<e.totalSize-1;){this.iteratePath||e.nextPath(),this.iterateMultiPath=!0;const i=this.processPath(e);if(i)return i}return this.iterateMultiPath=!1,null}},U6=class{constructor(e,i,r,s=0){this.isClosed=!1,this._tileKey=null,this.inputGeometries=e,this.acceptPolygon=i,this.acceptPolyline=r,this.geomUnitsPerPoint=s,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let e=this.inputGeometries.next();for(;e&&(this.isClosed=this.acceptPolygon&&e.geometryType==="esriGeometryPolygon"||e.geometryType==="esriGeometryEnvelope",this.multiPathCursor=e,!this.multiPathCursor);)e=this.inputGeometries.next();if(!this.multiPathCursor)return null;this._tileKey&&this.isClippingRequired(this.multiPathCursor)&&(this.multiPathCursor.reset(),this.multiPathCursor=k6(this.multiPathCursor,256))}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();const e=this.processPath(this.multiPathCursor);if(e)return e}this.multiPathCursor=null}}isClippingRequired(e){return!1}};var iK,rK,Qge,Kge,$g,eye,sK,nK,oK,tye,iye,rye,sye,nye,oye,aK,lK,aye,lye,pA,Wi,ST,cye,uye,B0,hye,dye,xM,cK,pye,fye,mye,gye,yye,_ye,Wd,Xa,vye,bye,Ig,wye,xye,Tye,Sye,ef,w3,ET,TM,Eye,Cye,Mye,Aye,Pye,Oye,Rye,kB,SM,$ye,uK,Iye,Lye;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(iK||(iK={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(rK||(rK={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(Qge||(Qge={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(Kge||(Kge={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}($g||($g={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(eye||(eye={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(sK||(sK={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(nK||(nK={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(oK||(oK={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(tye||(tye={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(iye||(iye={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(rye||(rye={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(sye||(sye={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(nye||(nye={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(oye||(oye={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(aK||(aK={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(lK||(lK={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(aye||(aye={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(lye||(lye={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(pA||(pA={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees",t.TipWithPerpendicularAndTicks="TipWithPerpendicularAndTicks"}(Wi||(Wi={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(ST||(ST={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(cye||(cye={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(uye||(uye={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(B0||(B0={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(hye||(hye={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(dye||(dye={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(xM||(xM={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(cK||(cK={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(pye||(pye={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(fye||(fye={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(mye||(mye={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AloneLine=1]="AloneLine"}(gye||(gye={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(yye||(yye={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(_ye||(_ye={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(Wd||(Wd={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(Xa||(Xa={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(vye||(vye={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(bye||(bye={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(Ig||(Ig={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(wye||(wye={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(xye||(xye={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(Tye||(Tye={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(Sye||(Sye={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(ef||(ef={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(w3||(w3={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(ET||(ET={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(TM||(TM={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(Eye||(Eye={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(Cye||(Cye={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(Mye||(Mye={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(Aye||(Aye={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(Pye||(Pye={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(Oye||(Oye={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(Rye||(Rye={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(kB||(kB={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(SM||(SM={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}($ye||($ye={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(uK||(uK={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(Iye||(Iye={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(Lye||(Lye={}));const NL=.03;let L_=class{constructor(e=0,i=!1){}isEmpty(e){if(!e.nextPoint())return!0;let i,r,s,n;for(i=e.x,r=e.y;e.nextPoint();i=r,r=n)if(s=e.x,n=e.y,s!==i||n!==r)return e.seekPathStart(),!1;return e.seekPathStart(),!0}normalize(e){const i=Math.sqrt(e[0]*e[0]+e[1]*e[1]);i!==0&&(e[0]/=i,e[1]/=i)}getLength(e,i,r,s){const n=r-e,o=s-i;return Math.sqrt(n*n+o*o)}getSegLength(e){const[[i,r],[s,n]]=e;return this.getLength(i,r,s,n)}getCoord2D(e,i,r,s,n){return[e+(r-e)*n,i+(s-i)*n]}getSegCoord2D(e,i){const[[r,s],[n,o]]=e;return this.getCoord2D(r,s,n,o,i)}getAngle(e,i,r,s,n){const o=r-e,a=s-i;return Math.atan2(a,o)}getAngleCS(e,i,r,s,n){const o=r-e,a=s-i,l=Math.sqrt(o*o+a*a);return l>0?[o/l,a/l]:[1,0]}getSegAngleCS(e,i){const[[r,s],[n,o]]=e;return this.getAngleCS(r,s,n,o,i)}cut(e,i,r,s,n,o){return[n<=0?[e,i]:this.getCoord2D(e,i,r,s,n),o>=1?[r,s]:this.getCoord2D(e,i,r,s,o)]}getSubCurve(e,i,r){const s=Yn.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(s,e,i,r)?s:null}appendSubCurve(e,i,r,s){e.startPath(),i.seekPathStart();let n=0,o=!0;if(!i.nextPoint())return!1;let a=i.x,l=i.y;for(;i.nextPoint();){const c=this.getLength(a,l,i.x,i.y);if(c!==0){if(o){if(n+c>r){const u=(r-n)/c;let d=1,f=!1;n+c>=s&&(d=(s-n)/c,f=!0);const m=this.cut(a,l,i.x,i.y,u,d);if(m&&e.pushPoints(m),f)break;o=!1}}else{if(n+c>s){const u=this.cut(a,l,i.x,i.y,0,(s-n)/c);u&&e.pushPoint(u[1]);break}e.pushXY(i.x,i.y)}n+=c,a=i.x,l=i.y}else a=i.x,l=i.y}return!0}getCIMPointAlong(e,i){if(!e.nextPoint())return null;let r,s,n,o,a=0;for(r=e.x,s=e.y;e.nextPoint();r=n,s=o){n=e.x,o=e.y;const l=this.getLength(r,s,n,o);if(l!==0){if(a+l>i){const c=(i-a)/l;return this.getCoord2D(r,s,n,o,c)}a+=l}}return null}offset(e,i,r,s,n){if(!e||e.length<2)return null;let o=0,a=e[o++],l=o;for(;o<e.length;){const f=e[o];f[0]===a[0]&&f[1]===a[1]||(o!==l&&(e[l]=e[o]),a=e[l++]),o++}const c=e[0][0]===e[l-1][0]&&e[0][1]===e[l-1][1];if(c&&--l,l<(c?3:2))return null;const u=[];a=c?e[l-1]:null;let d=e[0];for(let f=0;f<l;f++){const m=f===l-1?c?e[0]:null:e[f+1];if(a)if(m){const g=[m[0]-d[0],m[1]-d[1]];this.normalize(g);const y=[d[0]-a[0],d[1]-a[1]];this.normalize(y);const v=y[0]*g[1]-y[1]*g[0],b=y[0]*g[0]+y[1]*g[1];if(v===0&&b===1){d=m;continue}if(v>=0==i<=0){if(b<1){const w=[g[0]-y[0],g[1]-y[1]];this.normalize(w);const x=Math.sqrt((1+b)/2);if(x>1/s){const S=-Math.abs(i)/x;u.push([d[0]-w[0]*S,d[1]-w[1]*S])}}}else switch(r){case B0.Mitered:{const w=Math.sqrt((1+b)/2);if(w>0&&1/w<s){const x=[g[0]-y[0],g[1]-y[1]];this.normalize(x);const S=Math.abs(i)/w;u.push([d[0]-x[0]*S,d[1]-x[1]*S]);break}}case B0.Bevelled:u.push([d[0]+y[1]*i,d[1]-y[0]*i]),u.push([d[0]+g[1]*i,d[1]-g[0]*i]);break;case B0.Rounded:if(b<1){u.push([d[0]+y[1]*i,d[1]-y[0]*i]);const w=Math.floor(2.5*(1-b));if(w>0){const x=1/w;let S=x;for(let C=1;C<w;C++,S+=x){const M=[y[1]*(1-S)+g[1]*S,-y[0]*(1-S)-g[0]*S];this.normalize(M),u.push([d[0]+M[0]*i,d[1]+M[1]*i])}}u.push([d[0]+g[1]*i,d[1]-g[0]*i])}break;case B0.Square:default:if(v<0)u.push([d[0]+(y[1]+y[0])*i,d[1]+(y[1]-y[0])*i]),u.push([d[0]+(g[1]-g[0])*i,d[1]-(g[0]+g[1])*i]);else{const w=Math.sqrt((1+Math.abs(b))/2),x=[g[0]-y[0],g[1]-y[1]];this.normalize(x);const S=i/w;u.push([d[0]-x[0]*S,d[1]-x[1]*S])}}}else{const g=[d[0]-a[0],d[1]-a[1]];this.normalize(g),u.push([d[0]+g[1]*i,d[1]-g[0]*i])}else{const g=[m[0]-d[0],m[1]-d[1]];this.normalize(g),u.push([d[0]+g[1]*i,d[1]-g[0]*i])}a=d,d=m}return u.length<(c?3:2)?null:(c&&u.push([u[0][0],u[0][1]]),u)}};const n9=1.7320508075688772,Uxt=5,Vxt=pA.OpenEnded;let cFe=class j${static local(){return j$.instance===null&&(j$.instance=new j$),j$.instance}execute(e,i,r,s,n){return new zxt(e,i,r)}};cFe.instance=null;let zxt=class extends U6{constructor(e,i,r){super(e,!1,!0),this._curveHelper=new L_,this._width=(i.width!==void 0?i.width:Uxt)*r,this._arrowType=i.geometricEffectArrowType!==void 0?i.geometricEffectArrowType:i.arrowType!==void 0?i.arrowType:Vxt,this._offsetFlattenError=NL*r}processPath(e){const i=Yn.createEmptyOptimizedCIM(e.geometryType);switch(this._arrowType){case pA.OpenEnded:default:this._constructSimpleArrow(i,e,!0);break;case pA.Block:this._constructSimpleArrow(i,e,!1);break;case pA.Crossed:this._constructCrossedArrow(i,e)}return i}_constructSimpleArrow(e,i,r){const s=i.pathLength();let n=this._width;s<2*n&&(n=s/2);const o=this._curveHelper.getSubCurve(i,0,s-n);if(!o||!o.nextPath())return;o.seekPathStart();const a=n/2;if(this._curveHelper.isEmpty(o))return;const l=J1(o),c=this._constructOffset(l,-a);if(!c)return;const u=this._constructOffset(l,a);if(!u)return;const d=this._constructArrowBasePoint(c,-a/2);if(!d)return;const f=this._constructArrowBasePoint(u,a/2);if(!f)return;i.seekInPath(i.pathSize-1);const m=[i.x,i.y];e.pushPath(u),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(f),e.nextPoint(),e.setControlPoint(),e.pushPoint(m),e.nextPoint(),e.setControlPoint(),e.pushPoint(d),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.setControlPoint(),r||(e.setControlPointAt(0),e.setControlPointAt(e.pathSize-1),e.pushPoint(u[0])),e.reset()}_constructCrossedArrow(e,i){const r=i.pathLength();let s=this._width;r<s*(1+n9+1)&&(s=r/(1+n9+1)),i.seekPathStart();const n=this._curveHelper.getSubCurve(i,0,r-s*(1+n9));if(!n)return;n.nextPath();const o=s/2;if(this._curveHelper.isEmpty(n))return;const a=J1(n),l=this._constructOffset(a,o);if(!l)return;const c=this._constructOffset(a,-o);if(!c)return;const u=this._curveHelper.getSubCurve(i,0,r-s);if(!u||(u.nextPath(),this._curveHelper.isEmpty(u)))return;const d=J1(u),f=this._constructOffset(d,o);if(!f)return;const m=this._constructOffset(d,-o);if(!m)return;const g=f[f.length-1],y=this._constructArrowBasePoint(f,o/2);if(!y)return;const v=m[m.length-1],b=this._constructArrowBasePoint(m,-o/2);if(!b)return;i.seekInPath(i.pathSize-1);const w=[i.x,i.y];e.pushPath(l),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(v),e.nextPoint(),e.setControlPoint(),e.pushPoint(b),e.nextPoint(),e.setControlPoint(),e.pushPoint(w),e.nextPoint(),e.setControlPoint(),e.pushPoint(y),e.nextPoint(),e.setControlPoint(),e.pushPoint(g),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.nextPoint(),e.setControlPoint(),e.reset()}_constructOffset(e,i){return this._curveHelper.offset(e,i,B0.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(e,i){if(!e||e.length<2)return null;const r=e[e.length-2],s=e[e.length-1],n=[s[0]-r[0],s[1]-r[1]];return this._curveHelper.normalize(n),[s[0]+n[1]*i,s[1]-n[0]*i]}},uFe=class G${static local(){return G$.instance===null&&(G$.instance=new G$),G$.instance}execute(e,i,r,s,n,o){return new Bxt(e,i,r,s,n,o)}};uFe.instance=null;let Bxt=class{constructor(e,i,r,s,n,o){this._inputGeometries=e,this._tileKey=s,this._geometryEngine=n,this._curveHelper=new L_,this._size=(i.size!==void 0?i.size:1)*r,this._maxInflateSize=o*r,this._offsetFlattenError=NL*r}next(){let e;for(;e=this._inputGeometries.next();){if(this._size===0)return e;if(e.geometryType==="esriGeometryEnvelope"){if(this._size>0){const n=Yn.createEmptyOptimizedCIM(e.geometryType),o=vD(e)[0],a=this._curveHelper.offset(o,this._size,B0.Rounded,4,this._offsetFlattenError);if(a)return n.pushPath(a),n}else if(this._size<0){const n=e.asJSON();if(Math.min(n.xmax-n.xmin,n.ymax-n.ymin)+2*this._size>0)return Yn.fromJSONCIM({xmin:n.xmin-this._size,xmax:n.xmax+this._size,ymin:n.ymin-this._size,ymax:n.ymax+this._size})}}const i=this._geometryEngine;if(i==null)return null;const r=this._tileKey?k6(e,this._maxInflateSize):e;if(!r)continue;const s=i.buffer(Ze.WebMercator,r.asJSON(),this._size,1);return s?Yn.fromJSONCIM(s):null}return null}},hFe=class H${static local(){return H$.instance===null&&(H$.instance=new H$),H$.instance}execute(e,i,r,s,n){return new jxt(e,i,r)}};hFe.instance=null;let jxt=class{constructor(e,i,r){this._defaultPointSize=20,this._inputGeometries=e,this._geomUnitsPerPoint=r,this._rule=i.rule??Wi.FullGeometry,this._defaultSize=this._defaultPointSize*r}next(){let e;for(;e=this._inputGeometries.next();){const i=this._processGeom(vD(e));if(i!=null&&i.length)return Yn.fromJSONCIM({paths:i})}return null}_clone(e){return[e[0],e[1]]}_mid(e,i){return[(e[0]+i[0])/2,(e[1]+i[1])/2]}_mix(e,i,r,s){return[e[0]*i+r[0]*s,e[1]*i+r[1]*s]}_add(e,i){return[e[0]+i[0],e[1]+i[1]]}_add2(e,i,r){return[e[0]+i,e[1]+r]}_sub(e,i){return[e[0]-i[0],e[1]-i[1]]}_dist(e,i){return Math.sqrt((e[0]-i[0])*(e[0]-i[0])+(e[1]-i[1])*(e[1]-i[1]))}_norm(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}_normalize(e,i=1){const r=i/this._norm(e);e[0]*=r,e[1]*=r}_leftPerpendicular(e){const i=-e[1],r=e[0];e[0]=i,e[1]=r}_leftPerp(e){return[-e[1],e[0]]}_rightPerpendicular(e){const i=e[1],r=-e[0];e[0]=i,e[1]=r}_rightPerp(e){return[e[1],-e[0]]}_dotProduct(e,i){return e[0]*i[0]+e[1]*i[1]}_crossProduct(e,i){return e[0]*i[1]-e[1]*i[0]}_rotateDirect(e,i,r){const s=e[0]*i-e[1]*r,n=e[0]*r+e[1]*i;e[0]=s,e[1]=n}_makeCtrlPt(e){const i=[e[0],e[1]];return s9(i,1),i}_addAngledTicks(e,i,r,s){const n=this._sub(r,i);this._normalize(n);const o=this._crossProduct(n,this._sub(s,i));let a;a=o>0?this._rightPerp(n):this._leftPerp(n);const l=Math.abs(o)/2,c=[];c.push([i[0]+(a[0]-n[0])*l,i[1]+(a[1]-n[1])*l]),c.push(i),c.push(r),c.push([r[0]+(a[0]+n[0])*l,r[1]+(a[1]+n[1])*l]),e.push(c)}_addBezier2(e,i,r,s,n){if(n--==0)return void e.push(s);const o=this._mid(i,r),a=this._mid(r,s),l=this._mid(o,a);this._addBezier2(e,i,o,l,n),this._addBezier2(e,l,a,s,n)}_addBezier3(e,i,r,s,n,o){if(o--==0)return void e.push(n);const a=this._mid(i,r),l=this._mid(r,s),c=this._mid(s,n),u=this._mid(a,l),d=this._mid(l,c),f=this._mid(u,d);this._addBezier3(e,i,a,u,f,o),this._addBezier3(e,f,d,c,n,o)}_add90DegArc(e,i,r,s,n){const o=n??this._crossProduct(this._sub(r,i),this._sub(s,i))>0,a=this._mid(i,r),l=this._sub(a,i);o?this._leftPerpendicular(l):this._rightPerpendicular(l),a[0]+=l[0],a[1]+=l[1],this._addBezier3(e,i,this._mix(i,.33333,a,.66667),this._mix(r,.33333,a,.66667),r,4)}_addArrow(e,i,r){const s=i[0],n=i[1],o=i[i.length-1],a=this._sub(s,n),l=this._norm(a);this._normalize(a);const c=Math.abs(this._crossProduct(a,this._sub(o,n)));let u=this._dotProduct(a,this._sub(o,n));u<.05*l?u=.05*l:u>.95*l&&(u=.95*l);const d=.5*c,f=this._leftPerp(a),m=[n[0]+a[0]*u,n[1]+a[1]*u],g=i.length-1,y=[];y.push(r?[-f[0],-f[1]]:f);let v=[-a[0],-a[1]];for(let b=1;b<g-1;b++){const w=this._sub(i[b+1],i[b]);this._normalize(w);const x=this._dotProduct(w,v),S=this._crossProduct(w,v),C=Math.sqrt((1+x)/2),M=this._sub(w,v);this._normalize(M),M[0]/=C,M[1]/=C,y.push(S<0?[-M[0],-M[1]]:M),v=w}y.push(this._rightPerp(v));for(let b=y.length-1;b>0;b--)e.push([i[b][0]+y[b][0]*d,i[b][1]+y[b][1]*d]);e.push([m[0]+y[0][0]*d,m[1]+y[0][1]*d]),e.push([m[0]+y[0][0]*c,m[1]+y[0][1]*c]),e.push(s),e.push([m[0]-y[0][0]*c,m[1]-y[0][1]*c]),e.push([m[0]-y[0][0]*d,m[1]-y[0][1]*d]);for(let b=1;b<y.length;b++)e.push([i[b][0]-y[b][0]*d,i[b][1]-y[b][1]*d])}_cp2(e,i,r){return e.length>=2?e[1]:this._add2(e[0],i*this._defaultSize,r*this._defaultSize)}_cp3(e,i,r,s){if(e.length>=3)return e[2];const n=this._mix(e[0],1-r,i,r),o=this._sub(i,e[0]);return this._normalize(o),this._rightPerpendicular(o),[n[0]+o[0]*s*this._defaultSize,n[1]+o[1]*s*this._defaultSize]}_arrowPath(e){if(e.length>2)return e;const i=e[0],r=this._cp2(e,-4,0),s=this._sub(i,r);this._normalize(s);const n=this._rightPerp(s);return[i,r,[i[0]+(n[0]-s[0])*this._defaultSize,i[1]+(n[1]-s[1])*this._defaultSize]]}_arrowLastSeg(e){const i=e[0],r=this._cp2(e,-4,0);let s;if(e.length>=3)s=e[e.length-1];else{const n=this._sub(i,r);this._normalize(n);const o=this._rightPerp(n);s=[i[0]+(o[0]-n[0])*this._defaultSize,i[1]+(o[1]-n[1])*this._defaultSize]}return[r,s]}_processGeom(e){if(!e)return null;const i=[];for(const r of e){if(!r||r.length===0)continue;const s=r.length;let n=r[0];switch(this._rule){case Wi.PerpendicularFromFirstSegment:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,4),l=[];l.push(a),l.push(this._mid(n,o)),i.push(l);break}case Wi.ReversedFirstSegment:{const o=this._cp2(r,0,-1);i.push([o,n]);break}case Wi.PerpendicularToSecondSegment:{if(r.length<3)return[];const o=this._cp2(r,-4,1),a=this._cp3(r,o,.882353,-1.94),l=[];l.push(this._mid(o,a)),l.push(n),i.push(l);break}case Wi.SecondSegmentWithTicks:{if(r.length<3)return[];const o=this._cp2(r,-4,1),a=this._cp3(r,o,.882353,-1.94),l=this._sub(a,o);let c;c=this._crossProduct(l,this._sub(n,o))>0?this._rightPerp(l):this._leftPerp(l);const u=[];u.push([o[0]+(c[0]-l[0])/3,o[1]+(c[1]-l[1])/3]),u.push(o),u.push(a),u.push([a[0]+(c[0]+l[0])/3,a[1]+(c[1]+l[1])/3]),i.push(u);break}case Wi.DoublePerpendicular:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,3),l=this._mid(n,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(n,a));this._leftPerpendicular(c);const d=[];d.push(n),d.push([a[0]+c[0]*u,a[1]+c[1]*u]),i.push(d);const f=[];f.push([a[0]-c[0]*u,a[1]-c[1]*u]),f.push(o),i.push(f);break}case Wi.OppositeToFirstSegment:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,3),l=this._mid(n,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(n,a));this._leftPerpendicular(c);const d=[];d.push([a[0]+c[0]*u,a[1]+c[1]*u]),d.push([a[0]-c[0]*u,a[1]-c[1]*u]),i.push(d);break}case Wi.TriplePerpendicular:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,4),l=this._mid(n,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(n,a));this._leftPerpendicular(c);const d=[];d.push([a[0]+c[0]*u*.8,a[1]+c[1]*u*.8]),d.push([l[0]+.8*(n[0]-l[0]),l[1]+.8*(n[1]-l[1])]),i.push(d),i.push([a,l]);const f=[];f.push([a[0]-c[0]*u*.8,a[1]-c[1]*u*.8]),f.push([l[0]+.8*(o[0]-l[0]),l[1]+.8*(o[1]-l[1])]),i.push(f);break}case Wi.HalfCircleFirstSegment:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,4),l=this._mid(n,o);let c=this._sub(o,n);const u=Math.cos(Math.PI/18),d=Math.sin(Math.PI/18),f=Math.sqrt((1+u)/2),m=Math.sqrt((1-u)/2),g=[];let y;this._crossProduct(c,this._sub(a,n))>0?(g.push(n),c=this._sub(n,l),y=o):(g.push(o),c=this._sub(o,l),y=n),this._rotateDirect(c,f,m),c[0]/=f,c[1]/=f;for(let v=1;v<=18;v++)g.push(this._add(l,c)),this._rotateDirect(c,u,d);g.push(y),i.push(g);break}case Wi.HalfCircleSecondSegment:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,1,-1);let l=this._sub(n,o);this._normalize(l);const c=this._crossProduct(l,this._sub(a,o))/2;this._leftPerpendicular(l);const u=[o[0]+l[0]*c,o[1]+l[1]*c];l=this._sub(o,u);const d=Math.cos(Math.PI/18);let f=Math.sin(Math.PI/18);c>0&&(f=-f);const m=[o];for(let g=1;g<=18;g++)this._rotateDirect(l,d,f),m.push(this._add(u,l));i.push(m);break}case Wi.HalfCircleExtended:{const o=this._cp2(r,0,-2),a=this._cp3(r,o,1,-1);let l;if(s>=4)l=r[3];else{const g=this._sub(n,o);l=this._add(a,g)}const c=this._dist(o,a)/2/.75,u=this._sub(o,n);this._normalize(u,c);const d=this._sub(a,l);this._normalize(d,c);const f=[l,a];i.push(f);const m=[this._clone(a)];this._addBezier3(m,a,this._add(a,d),this._add(o,u),o,4),m.push(n),i.push(m);break}case Wi.OpenCircle:{const o=this._cp2(r,-2,0),a=this._sub(o,n),l=Math.cos(Math.PI/18),c=-Math.sin(Math.PI/18),u=[o];for(let d=1;d<=33;d++)this._rotateDirect(a,l,c),u.push(this._add(n,a));i.push(u);break}case Wi.CoverageEdgesWithTicks:{const o=this._cp2(r,0,-1);let a,l;if(s>=3)a=r[2];else{const f=this._sub(o,n),m=this._leftPerp(f);a=[n[0]+m[0]-.25*f[0],n[1]+m[1]-.25*f[1]]}if(s>=4)l=r[3];else{const f=this._mid(n,o),m=this._sub(n,o);this._normalize(m),this._leftPerpendicular(m);const g=this._crossProduct(m,this._sub(a,f));this._rightPerpendicular(m),l=[a[0]+m[0]*g*2,a[1]+m[1]*g*2]}const c=this._sub(o,n);let u,d;u=this._crossProduct(c,this._sub(a,n))>0?this._rightPerp(c):this._leftPerp(c),d=[],d.push(a),d.push(n),d.push([n[0]+(u[0]-c[0])/3,n[1]+(u[1]-c[1])/3]),i.push(d),u=this._crossProduct(c,this._sub(l,o))>0?this._rightPerp(c):this._leftPerp(c),d=[],d.push([o[0]+(u[0]+c[0])/3,o[1]+(u[1]+c[1])/3]),d.push(o),d.push(l),i.push(d);break}case Wi.GapExtentWithDoubleTicks:{const o=this._cp2(r,0,2),a=this._cp3(r,o,0,1);let l;if(s>=4)l=r[3];else{const c=this._sub(o,n);l=this._add(a,c)}this._addAngledTicks(i,n,o,this._mid(a,l)),this._addAngledTicks(i,a,l,this._mid(n,o));break}case Wi.GapExtentMidline:{const o=this._cp2(r,2,0),a=this._cp3(r,o,0,1);let l;if(s>=4)l=r[3];else{const u=this._sub(o,n);l=this._add(a,u)}const c=[];c.push(this._mid(n,a)),c.push(this._mid(o,l)),i.push(c);break}case Wi.Chevron:{const o=this._cp2(r,-1,-1);let a;if(s>=3)a=r[2];else{const l=this._sub(o,n);this._leftPerpendicular(l),a=this._add(n,l)}i.push([o,this._makeCtrlPt(n),a]);break}case Wi.PerpendicularWithArc:{const o=this._cp2(r,0,-2),a=this._cp3(r,o,.5,-1),l=this._sub(o,n),c=this._norm(l);l[0]/=c,l[1]/=c;const u=this._crossProduct(l,this._sub(a,n));let d=this._dotProduct(l,this._sub(a,n));d<.05*c?d=.05*c:d>.95*c&&(d=.95*c);const f=[n[0]+l[0]*d,n[1]+l[1]*d];let m=this._leftPerp(l),g=[];if(g.push([f[0]-m[0]*u,f[1]-m[1]*u]),g.push([f[0]+m[0]*u,f[1]+m[1]*u]),i.push(g),s>=4){const w=r[3];let x=this._dotProduct(l,this._sub(w,n));x<.1*c?x=.1*c:x>.9*c&&(x=.9*c);const S=[n[0]+l[0]*x,n[1]+l[1]*x],C=this._crossProduct(l,this._sub(w,n)),M=[];M.push([S[0]-m[0]*C,S[1]-m[1]*C]),M.push([S[0]+m[0]*C,S[1]+m[1]*C]),i.push(M)}const y=[o[0]+m[0]*u,o[1]+m[1]*u];m=this._sub(o,y);const v=Math.cos(Math.PI/18);let b=Math.sin(Math.PI/18);u<0&&(b=-b),g=[n,o];for(let w=1;w<=9;w++)this._rotateDirect(m,v,b),g.push(this._add(y,m));i.push(g);break}case Wi.ClosedHalfCircle:{const o=this._cp2(r,2,0),a=this._mid(n,o),l=this._sub(o,a),c=Math.cos(Math.PI/18),u=Math.sin(Math.PI/18),d=[n,o];for(let f=1;f<=18;f++)this._rotateDirect(l,c,u),d.push(this._add(a,l));i.push(d);break}case Wi.TripleParallelExtended:{const o=this._cp2(r,0,-2),a=this._cp3(r,o,1,-2),l=this._mid(n,o),c=this._sub(a,o);this._normalize(c);const u=Math.abs(this._crossProduct(c,this._sub(l,o)))/2,d=this._dist(o,a),f=[o,n];f.push([n[0]+c[0]*d*.5,n[1]+c[1]*d*.5]),i.push(f);const m=[];m.push([l[0]-c[0]*u,l[1]-c[1]*u]),m.push([l[0]+c[0]*d*.375,l[1]+c[1]*d*.375]),s9(m[m.length-1],1),m.push([l[0]+c[0]*d*.75,l[1]+c[1]*d*.75]),i.push(m);const g=[o,a];i.push(g);break}case Wi.ParallelWithTicks:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(a,o);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l),this._addAngledTicks(i,n,o,a),this._addAngledTicks(i,this._mix(n,1,l,c),this._mix(o,1,l,c),this._mid(n,o));break}case Wi.Parallel:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._leftPerp(l),u=this._crossProduct(l,this._sub(a,n));let d=[n,o];i.push(d),d=[],d.push([n[0]+c[0]*u,n[1]+c[1]*u]),d.push([o[0]+c[0]*u,o[1]+c[1]*u]),i.push(d);break}case Wi.PerpendicularToFirstSegment:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._mid(n,o),c=this._sub(o,n);this._normalize(c);const u=this._crossProduct(c,this._sub(a,n));this._leftPerpendicular(c);const d=[];d.push([l[0]-c[0]*u*.25,l[1]-c[1]*u*.25]),d.push([l[0]+c[0]*u*1.25,l[1]+c[1]*u*1.25]),i.push(d);break}case Wi.ParallelOffset:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l);const u=[];u.push([n[0]-l[0]*c,n[1]-l[1]*c]),u.push([o[0]-l[0]*c,o[1]-l[1]*c]),i.push(u);const d=[];d.push([n[0]+l[0]*c,n[1]+l[1]*c]),d.push([o[0]+l[0]*c,o[1]+l[1]*c]),i.push(d);break}case Wi.OffsetOpposite:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l);const u=[];u.push([n[0]-l[0]*c,n[1]-l[1]*c]),u.push([o[0]-l[0]*c,o[1]-l[1]*c]),i.push(u);break}case Wi.OffsetSame:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l);const u=[];u.push([n[0]+l[0]*c,n[1]+l[1]*c]),u.push([o[0]+l[0]*c,o[1]+l[1]*c]),i.push(u);break}case Wi.CircleWithArc:{let o=this._cp2(r,3,0);const a=this._cp3(r,o,.5,-1);let l,c;if(s>=4)l=r[3],c=this._crossProduct(this._sub(l,o),this._sub(a,o))>0;else{l=o,c=this._crossProduct(this._sub(l,n),this._sub(a,n))>0;const g=24*this._geomUnitsPerPoint,y=this._sub(l,n);this._normalize(y,g);const v=Math.sqrt(2)/2;this._rotateDirect(y,v,c?v:-v),o=this._add(n,y)}const u=this._sub(o,n),d=Math.cos(Math.PI/18),f=Math.sin(Math.PI/18),m=[o];for(let g=1;g<=36;g++)this._rotateDirect(u,d,f),m.push(this._add(n,u));this._add90DegArc(m,o,l,a,c),s9(m[m.length-8],1),i.push(m);break}case Wi.DoubleJog:{let o,a=this._cp2(r,-3,1),l=this._cp3(r,a,-1,-.5);if(s>=4)o=r[3];else{const b=n;n=a,o=l;const w=this._dist(n,b),x=this._dist(o,b);let S=30*this._geomUnitsPerPoint;.5*w<S&&(S=.5*w),.5*x<S&&(S=.5*x),a=this._mix(n,S/w,b,(w-S)/w),l=this._mix(o,S/x,b,(x-S)/x)}const c=this._mid(n,a),u=this._mid(o,l),d=this._dist(n,a),f=this._dist(l,o);let m=Math.min(d,f)/8;m=Math.min(m,24*this._geomUnitsPerPoint);const g=Math.cos(Math.PI/4);let y=this._sub(n,a);this._normalize(y,m),this._crossProduct(y,this._sub(o,a))>0?this._rotateDirect(y,g,-g):this._rotateDirect(y,g,g);let v=[];v.push(a),v.push(this._add(c,y)),v.push(this._sub(c,y)),v.push(n),i.push(v),y=this._sub(o,l),this._normalize(y,m),this._crossProduct(y,this._sub(n,l))<0?this._rotateDirect(y,g,g):this._rotateDirect(y,g,-g),v=[],v.push(l),v.push(this._add(u,y)),v.push(this._sub(u,y)),v.push(o),i.push(v);break}case Wi.PerpendicularOffset:{const o=this._cp2(r,-4,1),a=this._cp3(r,o,.882353,-1.94),l=this._sub(a,o);this._crossProduct(l,this._sub(n,o))>0?this._rightPerpendicular(l):this._leftPerpendicular(l);const c=[l[0]/8,l[1]/8],u=this._sub(this._mid(o,a),c);i.push([u,n]);break}case Wi.LineExcludingLastSegment:{const o=this._arrowPath(r),a=[];let l=o.length-2;for(;l--;)a.push(o[l]);i.push(a);break}case Wi.MultivertexArrow:{const o=this._arrowPath(r),a=[];this._addArrow(a,o,!1),i.push(a);break}case Wi.CrossedArrow:{const o=this._arrowPath(r),a=[];this._addArrow(a,o,!0),i.push(a);break}case Wi.ChevronArrow:{const[o,a]=this._arrowLastSeg(r),l=10*this._geomUnitsPerPoint,c=this._sub(n,o),u=this._norm(c);this._normalize(c);const d=this._crossProduct(c,this._sub(a,o));let f=this._dotProduct(c,this._sub(a,o));f<.05*u?f=.05*u:f>.95*u-l&&(f=.95*u-l);const m=[o[0]+c[0]*f,o[1]+c[1]*f],g=this._leftPerp(c),y=[];y.push([m[0]+g[0]*d+c[0]*l,m[1]+g[1]*d+c[1]*l]),y.push(n),y.push([m[0]-g[0]*d+c[0]*l,m[1]-g[1]*d+c[1]*l]),i.push(y);break}case Wi.ChevronArrowOffset:{const[o,a]=this._arrowLastSeg(r),l=this._sub(n,o),c=this._norm(l);this._normalize(l);const u=this._crossProduct(l,this._sub(a,o));let d=this._dotProduct(l,this._sub(a,o));d<.05*c?d=.05*c:d>.95*c&&(d=.95*c);const f=[o[0]+l[0]*d,o[1]+l[1]*d];this._leftPerpendicular(l);const m=[];m.push([f[0]+l[0]*u*.5,f[1]+l[1]*u*.5]),m.push(this._mid(f,n)),m.push([f[0]-l[0]*u*.5,f[1]-l[1]*u*.5]),i.push(m);break}case Wi.PartialFirstSegment:{const[o,a]=this._arrowLastSeg(r),l=this._sub(n,o),c=this._norm(l);this._normalize(l);let u=this._dotProduct(l,this._sub(a,o));u<.05*c?u=.05*c:u>.95*c&&(u=.95*c);const d=[o[0]+l[0]*u,o[1]+l[1]*u];i.push([o,d]);break}case Wi.Arch:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,1),l=this._sub(n,o),c=this._mix(a,1,l,.55),u=this._mix(a,1,l,-.55),d=[n];this._addBezier2(d,n,c,a,4),this._addBezier2(d,a,u,o,4),i.push(d);break}case Wi.CurvedParallelTicks:{const o=this._cp2(r,-4,1),a=this._cp3(r,o,.882353,-1.94),l=this._sub(a,o);this._crossProduct(l,this._sub(n,o))>0?this._rightPerpendicular(l):this._leftPerpendicular(l);const c=[l[0]/8,l[1]/8],u=this._sub(this._mid(o,a),c),d=this._sub(this._mix(o,.75,a,.25),c),f=this._sub(this._mix(o,.25,a,.75),c),m=[o];this._addBezier2(m,o,d,u,3),this._addBezier2(m,u,f,a,3),i.push(m);for(let g=0;g<8;g++){const y=m[2*g+1],v=[this._clone(y)];v.push(this._add(y,[l[0]/4,l[1]/4])),i.push(v)}break}case Wi.Arc90Degrees:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,1),l=[o];this._add90DegArc(l,o,n,a),i.push(l);break}case Wi.TipWithPerpendicularAndTicks:{const[o,a]=this._arrowLastSeg(r),l=10*this._geomUnitsPerPoint,c=this._sub(n,o),u=this._norm(c);this._normalize(c);let d=this._crossProduct(c,this._sub(a,o)),f=this._dotProduct(c,this._sub(a,o));f<.05*u?f=.05*u:f>.95*u-l&&(f=.95*u-l);const m=this._leftPerp(c),g=[n[0]-c[0]*l,n[1]-c[1]*l],y=.5*Math.max(u-f-l,l);d=Math.abs(d);const v=[];v.push([g[0]+m[0]*(d+y)-c[0]*y,g[1]+m[1]*(d+y)-c[1]*y]),v.push([g[0]+m[0]*d,g[1]+m[1]*d]),v.push([g[0]-m[0]*d,g[1]-m[1]*d]),v.push([g[0]-m[0]*(d+y)-c[0]*y,g[1]-m[1]*(d+y)-c[1]*y]),i.push(v),i.push([g,n]);break}case Wi.FullGeometry:default:i.push(r)}}return i}},dFe=class q${static local(){return q$.instance===null&&(q$.instance=new q$),q$.instance}execute(e,i,r,s,n){return new Gxt(e,i,r)}};dFe.instance=null;let Gxt=class extends U6{constructor(e,i,r){super(e,!0,!0),this._curveHelper=new L_,this._beginCut=(i.beginCut!==void 0?i.beginCut:1)*r,this._endCut=(i.endCut!==void 0?i.endCut:1)*r,this._middleCut=(i.middleCut!==void 0?i.middleCut:0)*r,this._invert=i.invert!==void 0&&i.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(e){const{_beginCut:i,_endCut:r,_middleCut:s}=this,n=e.pathLength(),o=Yn.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._invert){if(i!==0||r!==0||s!==0)if(i+r+s>=n)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else this._curveHelper.appendSubCurve(o,e,0,i),this._curveHelper.appendSubCurve(o,e,.5*(n-s),.5*(n+s)),this._curveHelper.appendSubCurve(o,e,n-r,r)}else if(i===0&&r===0&&s===0)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else i+r+s<n&&(s===0?this._curveHelper.appendSubCurve(o,e,i,n-r):(this._curveHelper.appendSubCurve(o,e,i,.5*(n-s)),this._curveHelper.appendSubCurve(o,e,.5*(n+s),n-r)));return o.totalSize===0?null:o}};const Dye=1e-7;let V6=class{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return this._values.length===0}size(){return this._values.length}init(e,i,r=!0){if(this._setEmpty(),!e||e.length===0)return!1;for(let s=0;s<e.length;s++){let n=Math.abs(e[s]);r&&n<Dye&&(n=Dye),this._values.push(n),this._length+=n}return i&&1&e.length&&(this._length*=2),this._length!==0&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(e){const i=this._values?this._values.length:0;for(let r=0;r<i;++r)this._values[r]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e}addValue(e){this._length+=e,this._values.push(e)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}},C0=class{constructor(){this.pt=null,this.ca=0,this.sa=0}};var P1;(function(t){t[t.FAIL=0]="FAIL",t[t.END=1]="END",t[t.CONTINUE=2]="CONTINUE"})(P1||(P1={}));let M4=class{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return this.segment!==null}copyTo(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd}},z6=class extends L_{constructor(e=0,i=!1){super(e,i),this._tolerance=NL,this._currentPosition=new M4}updateTolerance(e){this._tolerance=NL*e}init(e,i,r=!0){return r?(this._patternLength=i.length(),this._partExtPtGap=i.extPtGap,this._partCtrlPtGap=i.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=e,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(e,i=P1.FAIL){const r=new M4;return!!this._nextPosition(e,r,null,i)&&(r.copyTo(this._currentPosition),!0)}curPointAndAngle(e){e.pt=this._getPoint(this._currentPosition);const[i,r]=this._getAngleCS(this._currentPosition);e.ca=i,e.sa=r}nextPointAndAngle(e,i,r=P1.FAIL){const s=new M4;if(!this._nextPosition(e,s,null,r))return!1;s.copyTo(this._currentPosition),i.pt=this._getPoint(s);const[n,o]=this._getAngleCS(s);return i.ca=n,i.sa=o,!0}nextCurve(e){if(e===0)return null;const i=Yn.createEmptyOptimizedCIM("esriGeometryPolyline");i.startPath(),i.nextPath();const r=new M4;return this._nextPosition(e,r,i,P1.END)?(r.copyTo(this._currentPosition),i):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(e){return this._pathCursor.seekInPath(e),[this._pathCursor.x,this._pathCursor.y]}getSeg(e){return[this.getPt(e),this.getPt(e+1)]}_nextPosition(e,i,r,s){if(this._currentPosition.isPathEnd)return!1;let n=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(n/=this._currentPosition.segmentLength),this._currentPosition.copyTo(i);i.abscissa+e*this._partLengthRatio>i.segmentLength+this._tolerance;){if(r){if(r.pathSize===0)if(n===0){const a=i.segment[0];r.pushXY(a[0],a[1])}else r.pushPoint(this.getSegCoord2D(i.segment,n));const o=i.segment[1];r.pushXY(o[0],o[1])}if(n=0,e-=(i.segmentLength-i.abscissa)/this._partLengthRatio,this._partSegCount)i.segment=this._nextSegment(),i.segmentLength=this.getSegLength(i.segment),i.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return s!==P1.FAIL&&(i.segmentLength=this.getSegLength(i.segment),i.isPartEnd=!0,s===P1.END?(i.abscissa=i.segmentLength,i.isPathEnd=!0):i.abscissa=i.segmentLength+e,!0);this._currentPosition.copyTo(i)}}if(i.abscissa+=e*this._partLengthRatio,r){r.pathSize===0&&(n===0?r.pushPoint(i.segment[0]):r.pushPoint(this.getSegCoord2D(i.segment,n)));const o=i.abscissa/i.segmentLength;o===1?r.pushPoint(i.segment[1]):r.pushPoint(this.getSegCoord2D(i.segment,o))}return this._partSegCount||Math.abs(i.abscissa-i.segmentLength)<this._tolerance&&(i.isPathEnd=this._partIsLast,i.isPartEnd=!0),!0}_getPoint(e){const i=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,i)}_getAngleCS(e){const i=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegAngleCS(this._currentPosition.segment,i)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let e=this._partSegCount;for(;e;)this._previousSegment(),--e;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const i=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(i);let r=i+this._partSegCount+1;if(r>=this._pathCursor.pathSize&&(r=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(r),this._patternLength>0){const s=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,n=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let o=Math.round((this._partLength-(s+n))/this._patternLength);o<=0&&(o=s+n>0?0:1),this._partLengthRatio=this._partLength/(s+n+o*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}};const fA={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMSolidFill:{enable:!0,colorlocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:"Loop",repeatdelay:0}};function Hxt(t){return typeof t=="function"}function qxt(t,e,i,r){return Hxt(t)?t(e,i,r):t}const Wxt=` /-,
`;function Nye(t){let e=t.length;for(;e--;)if(!Wxt.includes(t.charAt(e)))return!1;return!0}function Zxt(t,e){const i=[];let r=0,s=-1;do if(s=t.indexOf("[",r),s>=r){if(s>r){const n=t.substr(r,s-r);i.push([n,null,Nye(n)])}if(r=s+1,s=t.indexOf("]",r),s>=r){if(s>r){const n=e[t.substr(r,s-r)];n&&i.push([null,n,!1])}r=s+1}}while(s!==-1);if(r<t.length-1){const n=t.substr(r);i.push([n,null,Nye(n)])}return i}function Yxt(t,e,i,r){let s="",n=null;for(const o of e){const[a,l,c]=o;if(a)c?n=a:(n&&(s+=n,n=null),s+=a);else{let u=l;i!=null&&(u=yFe(l,i));const d=t.attributes[u];d&&(n&&(s+=n,n=null),s+=d)}}return Xxt(s,r)}function Xxt(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function Jxt(t){return t?[t[0],t[1],t[2],t[3]/255]:[0,0,0,0]}function Qxt(t){var e;return((e=t.data)==null?void 0:e.symbol)??null}function Kxt(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function eTt(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function pFe(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const Ni=(t,e=0)=>t==null||isNaN(t)?e:t,tTt=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function iTt(){return ce(()=>import("./geometryEngineJSON-By290Mb8.js").then(t=>t.g),__vite__mapDeps([16,17,18]))}function rTt(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function sTt(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function fFe(t){let e="normal",i="normal";if(t){const r=t.toLowerCase();r.includes("italic")?e="italic":r.includes("oblique")&&(e="oblique"),r.includes("bold")?i="bold":r.includes("light")&&(i="lighter")}return{style:e,weight:i}}function mFe(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function x3(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=x3(e);if(i!=null)return i}break;case"CIMTextSymbol":return x3(t.symbol);case"CIMSolidFill":return t.color}return null}function hK(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const i of e){const r=hK(i);if(r!=null)return r}break}case"CIMTextSymbol":return hK(t.symbol);case"CIMSolidStroke":return t.color}}function dK(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=dK(e);if(i!==void 0)return i}break;case"CIMTextSymbol":return dK(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function nTt(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function oTt(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function aTt(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const _E=t=>t.includes("data:image/svg+xml");function Kti(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function Voe(t){return t&&t.charAt(0).toLowerCase()+t.substring(1)}function eii(t,e,i,r,s,n){const{infos:o}=n;let a=1,l=0,c=0,u=0;for(const{offsetX:m,offsetY:g,rotation:y,size:v,frameHeight:b,rotateClockWise:w}of o)c=Uye(m,g,l,a,c),u=kye(m,g,l,a,u),b&&(a*=v/b),l=Vye(y,w,l);const d=Uye(r,s,l,a,c),f=kye(r,s,l,a,u);return{size:t*a,rotation:Vye(e,i,l),offsetX:d,offsetY:f}}function gFe(t){return t!=null&&t.dashTemplate&&typeof t.dashTemplate=="string"&&(t.dashTemplate=t.dashTemplate.split(" ").map(Number)),t}function pK(t){if(t==null)return"Normal";switch(t.type){case"CIMTextSymbol":return t.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const e=t.symbolLayers;if(!e)return"Normal";for(const i of e)if(i.type==="CIMVectorMarker")return pK(i)}break;case"CIMVectorMarker":{const e=t.markerGraphics;if(!e)return"Normal";for(const i of e)if(i.symbol)return pK(i.symbol)}}return"Normal"}function yFe(t,e){if(e!==null){const i=e.get(t);return i?i.name:t}return t}function lTt(t){return t.map(e=>({...e,propertyName:Voe(e.propertyName)}))}function Fye(t){const e={};for(const i in t){const r=t[i];e[Voe(i)]=r}return e}function kye(t,e,i,r,s){const n=i*Math.PI/180;if(n){const o=Math.cos(n);return(Math.sin(n)*t+o*e)*r+s}return e*r+s}function Uye(t,e,i,r,s){const n=i*Math.PI/180;return n?(Math.cos(n)*t-Math.sin(n)*e)*r+s:t*r+s}function Vye(t,e,i){return e?i-t:i+t}const cTt=1e3,zye=1e-7;let _Fe=class W${static local(){return W$.instance===null&&(W$.instance=new W$),W$.instance}execute(e,i,r,s,n){return new uTt(e,i,r,s)}};_Fe.instance=null;let uTt=class extends U6{constructor(e,i,r,s){super(e,!0,!0),this._firstCurve=null,this._walker=new z6,this._walker.updateTolerance(r),this._endings=i.lineDashEnding,this._customDashPos=-(i.offsetAlongLine??0)*r,this._offsetAtEnd=(i.customEndingOffset??0)*r,this._tileKey=s;let n=gFe(i).dashTemplate;n==null&&(n=[]),n.length%2&&(n=[...n,...n]);let o=0;for(let a=0;a<n.length;a++){let l=Math.abs(n[a]);l<zye&&(l=zye),o+=l}this._patternLength=o,this._numOfDashesPerPattern=n.length/2,this._pattern=new V6,this._pattern.init(n,!0),this._pattern.scale(r)}processPath(e){if(this._pattern.length()===0){this.iteratePath=!1;const s=J1(e);return Yn.fromJSONCIM({paths:[s]})}if(!this.iteratePath){let s=!0;switch(this._endings){case Xa.HalfPattern:case Xa.HalfGap:default:this._pattern.extPtGap=0;break;case Xa.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case Xa.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case Xa.NoConstraint:this.isClosed||(s=!1);break;case Xa.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const n=e.pathLength();if(this._pattern.isEmpty()||n<.1*this._pattern.length()){const o=J1(e);return Yn.fromJSONCIM({paths:[o]})}if(!this._walker.init(e,this._pattern,s)){const o=J1(e);return Yn.fromJSONCIM({paths:[o]})}}let i;if(this.iteratePath)i=this._pattern.nextValue();else{let s;switch(this._endings){case Xa.HalfPattern:default:s=.5*this._pattern.firstValue();break;case Xa.HalfGap:s=.5*-this._pattern.lastValue();break;case Xa.FullGap:s=-this._pattern.lastValue();break;case Xa.FullPattern:s=0;break;case Xa.NoConstraint:case Xa.Custom:s=-this._customDashPos}let n=s/this._pattern.length();n-=Math.floor(n),s=n*this._pattern.length(),this._pattern.reset(),i=this._pattern.nextValue();let o=!1;for(;s>=i;)s-=i,i=this._pattern.nextValue(),o=!o;i-=s,o?(this._walker.nextPosition(i),i=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(i),i=this._pattern.nextValue(),this._walker.nextPosition(i),i=this._pattern.nextValue())}let r=this._walker.nextCurve(i);if(r)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)r.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else i=this._pattern.nextValue(),!this._walker.nextPosition(i)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(r.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,r=this._firstCurve,this._firstCurve=null;return r==null||r.reset(),r}isClippingRequired(e){const i=vD(e);let r=0;for(const s of i)r+=mre(s);return Math.round(this._numOfDashesPerPattern*(r/this._patternLength))>cTt}},vFe=class Z${static local(){return Z$.instance===null&&(Z$.instance=new Z$),Z$.instance}execute(e,i,r,s,n,o){return new hTt(e,i,r,s,n,o)}};vFe.instance=null;let hTt=class{constructor(e,i,r,s,n,o){switch(this._inputGeometries=e,this._tileKey=s,this._geometryEngine=n,this._maxInflateSize=o*r,this._width=(i.width!==void 0?i.width:2)*r,i.method){case ST.Mitered:case ST.Bevelled:case ST.Rounded:case ST.TrueBuffer:case ST.Square:}this._option=i.option}next(){let e;for(;e=this._inputGeometries.next();){if(e.geometryType==="esriGeometryEnvelope"&&this._width>0){const i=e.asJSON();return Math.min(i.xmax-i.xmin,i.ymax-i.ymin)-2*this._width<0?e:Yn.fromJSONCIM({paths:[[[i.xmin+this._width,i.ymin+this._width],[i.xmax-this._width,i.ymin+this._width],[i.xmax-this._width,i.ymax-this._width],[i.xmin+this._width,i.ymax-this._width],[i.xmin+this._width,i.ymin+this._width]],[[i.xmin,i.ymin],[i.xmin,i.ymax],[i.xmax,i.ymax],[i.xmax,i.ymin],[i.xmin,i.ymin]]]})}if(e.geometryType==="esriGeometryPolygon"){if(this._width===0)return e.clone();const i=this._geometryEngine;if(i==null)return null;const r=this._tileKey?k6(e,this._maxInflateSize):e.clone();if(!r)continue;const s=i.buffer(Ze.WebMercator,r.asJSON(),-this._width,1);if(s){for(const n of s.rings)if(n){r.startPath();for(const o of n.reverse())r.pushXY(o[0],r.yFactor*o[1])}}return r}}return null}},bFe=class Y${static local(){return Y$.instance===null&&(Y$.instance=new Y$),Y$.instance}execute(e,i,r,s,n){return new dTt(e,i,r)}};bFe.instance=null;let dTt=class extends U6{constructor(e,i,r){super(e,!1,!0),this._curveHelper=new L_,this._length=(i.length!==void 0?i.length:20)*r,this._angle=i.angle!==void 0?i.angle:225,this._position=i.position!==void 0?i.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(e){const i=Yn.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(e))return null;e.seekInPath(0);const r=e.x,s=e.y;e.seekInPath(e.pathSize-1);const n=e.x,o=e.y,a=[n-r,o-s];this._curveHelper.normalize(a);const l=r+(n-r)*this._position/100,c=s+(o-s)*this._position/100,u=Math.cos((90-this._angle)/180*Math.PI);let d=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(d=-d),this._mirror=!this._mirror;const f=[l-this._length/2*u,c-this._length/2*d],m=[l+this._length/2*u,c+this._length/2*d];return i.pushPath([[r,s],f,m,[n,o]]),i}},wFe=class X${static local(){return X$.instance===null&&(X$.instance=new X$),X$.instance}execute(e,i,r,s,n){return new pTt(e,i,r)}};wFe.instance=null;let pTt=class{constructor(e,i,r){this._inputGeometries=e,this._offsetX=i.offsetX!==void 0?i.offsetX*r:0,this._offsetY=i.offsetY!==void 0?i.offsetY*r:0}next(){let e=this._inputGeometries.next();for(;e;){if(e.totalSize>0)return this._move(e.clone(),this._offsetX,this._offsetY);e=this._inputGeometries.next()}return null}_move(e,i,r){for(;e.nextPath();)for(;e.nextPoint();)e.x=e.x+i,e.y=e.y+r;return e.reset(),e}};const fTt=10;let xFe=class J${static local(){return J$.instance===null&&(J$.instance=new J$),J$.instance}execute(e,i,r,s,n,o){return new mTt(e,i,r,s,n,o)}};xFe.instance=null;let mTt=class{constructor(e,i,r,s,n,o){this._inputGeometries=e,this._tileKey=s,this._geometryEngine=n,this._curveHelper=new L_,this._offset=(i.offset??1)*r,this._method=i.method,this._maxInflateSize=Math.max(Math.abs(o*r),fTt),this._option=i.option,this._offsetFlattenError=NL*r}next(){let e;for(;e=this._inputGeometries.next();){if(this._offset===0)return e.clone();if(e.geometryType==="esriGeometryEnvelope"){if(this._method===B0.Rounded&&this._offset>0){const o=J1(e),a=this._curveHelper.offset(o,-this._offset,this._method,4,this._offsetFlattenError);if(a){const l=Yn.createEmptyOptimizedCIM(e.geometryType);return l.pushPath(a),l}return null}const n=e.asJSON();if(_f(n)&&Math.min(n.xmax-n.xmin,n.ymax-n.ymin)+2*this._offset>0)return Yn.fromJSONCIM({xmin:n.xmin-this._offset,xmax:n.xmax+this._offset,ymin:n.ymin-this._offset,ymax:n.ymax+this._offset})}const i=this._geometryEngine;if(i==null)continue;const r=this._tileKey?k6(e,this._maxInflateSize):e.clone();if(!r)continue;const s=i.offset(Ze.WebMercator,r.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError);return s?Yn.fromJSONCIM(s):null}return null}},TFe=class Q${static local(){return Q$.instance===null&&(Q$.instance=new Q$),Q$.instance}execute(e,i,r,s,n){return new gTt(e,i,r)}};TFe.instance=null;let gTt=class{constructor(e,i,r){this._inputGeometries=e,this._reverse=i.reverse===void 0||i.reverse}next(){let e=this._inputGeometries.next();for(;e;){if(!this._reverse)return e;if(e.geometryType==="esriGeometryPolyline")return yTt(e.clone());e=this._inputGeometries.next()}return null}};function yTt(t){for(;t.nextPath();)for(let e=0;e<t.pathSize/2;e++){t.seekInPath(e);const i=t.x,r=t.y;t.seekInPath(t.pathSize-e-1);const s=t.x,n=t.y;t.x=i,t.y=r,t.seekInPath(e),t.x=s,t.y=n}return t.reset(),t}let SFe=class K${static local(){return K$.instance===null&&(K$.instance=new K$),K$.instance}execute(e,i,r,s,n){return new _Tt(e,i,r)}};SFe.instance=null;let _Tt=class{constructor(e,i,r){this._inputGeometries=e,this._rotateAngle=i.angle!==void 0?i.angle*Math.PI/180:0}next(){let e=this._inputGeometries.next();for(;e;){if(this._rotateAngle===0||e.geometryType==="esriGeometryPoint")return e;if(e.totalSize>0){const i=aG(e),r=(i[2]+i[0])/2,s=(i[3]+i[1])/2;return e.reset(),this._rotate(e.clone(),r,s)}e=this._inputGeometries.next()}return null}_rotate(e,i,r){const s=Math.cos(this._rotateAngle),n=Math.sin(this._rotateAngle);for(;e.nextPath();)for(;e.nextPoint();){const o=e.x-i,a=e.y-r;e.x=i+o*s-a*n,e.y=r+o*n+a*s}return e.reset(),e}},EFe=class eI{static local(){return eI.instance===null&&(eI.instance=new eI),eI.instance}execute(e,i,r,s,n){return new vTt(e,i,r)}};EFe.instance=null;let vTt=class{constructor(e,i,r){this._inputGeometries=e,this._xFactor=i.xScaleFactor!==void 0?i.xScaleFactor:1.15,this._yFactor=i.yScaleFactor!==void 0?i.yScaleFactor:1.15}next(){const e=this._inputGeometries.next();if(e){if(this._xFactor===1&&this._yFactor===1||e.geometryType==="esriGeometryPoint")return e;if(e.totalSize>0){const i=aG(e),r=(i[2]+i[0])/2,s=(i[3]+i[1])/2;return e.reset(),this._scaleCursor(e.clone(),r,s)}}return null}_scaleCursor(e,i,r){for(;e.nextPath();)for(;e.nextPoint();)e.x=i+(e.x-i)*this._xFactor,e.y=r+(e.y-r)*this._yFactor;return e.reset(),e}},CFe=class tI{static local(){return tI.instance===null&&(tI.instance=new tI),tI.instance}execute(e,i,r,s,n){return new bTt(e,i,r)}};CFe.instance=null;let bTt=class{constructor(e,i,r){this._inputGeometries=e,this._height=(i.amplitude!==void 0?i.amplitude:2)*r,this._period=(i.period!==void 0?i.period:3)*r,this._style=i.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new V6,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new z6,this._walker.updateTolerance(r)}next(){let e=this._inputGeometries.next();for(;e;){if(this._height===0||this._period===0)return e;const i=this._processGeom(e);if(i)return i;e=this._inputGeometries.next()}return null}_processGeom(e){const i=Yn.createEmptyOptimizedCIM(e.geometryType);for(;e.nextPath();){i.startPath();const r=e.pathLength();if(this._walker.init(e,this._pattern))switch(this._style){case xM.Sinus:default:this._constructCurve(i,r,!1);break;case xM.Square:this._constructSquare(i,r);break;case xM.Triangle:this._constructTriangle(i,r);break;case xM.Random:this._constructCurve(i,r,!0)}else for(;e.nextPoint();)i.pushXY(e.x,e.y)}return i}_constructCurve(e,i,r){let s=Math.round(i/this._period);s===0&&(s=1);const n=s*16+1,o=i/s,a=this._period/16,l=1/n,c=2*Math.PI*i/o,u=2*Math.PI*Math.random(),d=2*Math.PI*Math.random(),f=2*Math.PI*Math.random(),m=.75-Math.random()/2,g=.75-Math.random()/2,y=new C0;this._walker.curPointAndAngle(y),e.pushPoint(y.pt);let v=0;for(;;){if(!this._walker.nextPointAndAngle(a,y)){e.pushPoint(this._walker.getPathEnd());break}{const b=v;let w;if(v+=l,r){const x=this._height/2*(1+.3*Math.sin(m*c*b+u));w=x*Math.sin(c*b+d),w+=x*Math.sin(g*c*b+f),w/=2}else w=.5*this._height*Math.sin(.5*c*b);e.pushXY(y.pt[0]-w*y.sa,y.pt[1]+w*y.ca)}}}_constructSquare(e,i){Math.round(i/this._period);let r=!0;for(;;){let s=!1;if(this._walker.curPositionIsValid()){const n=new C0;this._walker.curPointAndAngle(n);const o=new C0;if(this._walker.nextPointAndAngle(this._period,o)){const a=new C0;this._walker.nextPointAndAngle(this._period,a)&&(r?(e.pushPoint(n.pt),r=!1):e.pushPoint(n.pt),e.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),e.pushXY(o.pt[0]-this._height/2*o.sa,o.pt[1]+this._height/2*o.ca),e.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca),e.pushXY(a.pt[0]+this._height/2*a.sa,a.pt[1]-this._height/2*a.ca),s=!0)}}if(!s){e.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(e,i){Math.round(i/this._period);let r=!0;for(;;){let s=!1;if(this._walker.curPositionIsValid()){const n=new C0;this._walker.curPointAndAngle(n);const o=new C0;if(this._walker.nextPointAndAngle(this._period/2,o)){const a=new C0;this._walker.nextPointAndAngle(this._period,a)&&(this._walker.nextPosition(this._period/2)&&(r?(e.pushPoint(n.pt),r=!1):e.pushPoint(n.pt),e.pushXY(o.pt[0]-this._height/2*o.sa,o.pt[1]+this._height/2*o.ca),e.pushXY(a.pt[0]+this._height/2*a.sa,a.pt[1]-this._height/2*a.ca)),s=!0)}}if(!s){e.pushPoint(this._walker.getPathEnd());break}}}},MFe=class iI{static local(){return iI.instance===null&&(iI.instance=new iI),iI.instance}execute(e,i,r,s,n){return new wTt(e,i,r)}};MFe.instance=null;let wTt=class extends aN{constructor(e,i,r){super(e),this._geometryWalker=new z6,this._geometryWalker.updateTolerance(r),this._angleToLine=i.angleToLine??!0,this._offset=(i.offset?i.offset:0)*r,this._originalEndings=i.endings,this._offsetAtEnd=(i.customEndingOffset?i.customEndingOffset:0)*r,this._position=-(i.offsetAlongLine?i.offsetAlongLine:0)*r,this._pattern=new V6,this._pattern.init(i.placementTemplate,!1),this._pattern.scale(r),this._endings=this._originalEndings}processPath(e){if(this._pattern.isEmpty())return null;let i;if(this.iteratePath)i=this._pattern.nextValue();else{this._originalEndings===ef.WithFullGap&&this.isClosed?this._endings=ef.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;let s,n=!0;switch(this._endings){case ef.NoConstraint:s=-this._position,s=this._adjustPosition(s),n=!1;break;case ef.WithHalfGap:default:s=-this._pattern.lastValue()/2;break;case ef.WithFullGap:s=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case ef.WithMarkers:s=0;break;case ef.Custom:s=-this._position,s=this._adjustPosition(s),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(e,this._pattern,n))return null;this._pattern.reset();let o=0;for(;s>o;)s-=o,o=this._pattern.nextValue();o-=s,i=o,this.iteratePath=!0}const r=new C0;return this._geometryWalker.nextPointAndAngle(i,r)?this._endings===ef.WithFullGap&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===ef.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(r.pt[0]-this._offset*r.sa,r.pt[1]+this._offset*r.ca),this._angleToLine&&this.internalPlacement.setRotateCS(r.ca,r.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(e){let i=e/this._pattern.length();return i-=Math.floor(i),i*this._pattern.length()}},AFe=class rI{static local(){return rI.instance===null&&(rI.instance=new rI),rI.instance}execute(e,i,r,s,n){return new xTt(e,i,r)}};AFe.instance=null;let xTt=class extends aN{constructor(e,i,r){super(e,!1,!0),this._curveHelper=new L_,this._placePerPart=i.placePerPart??!1,this._angleToLine=i.angleToLine===void 0||i.angleToLine,this._offset=i.offset!==void 0?i.offset*r:0,this._type=i.extremityPlacement,this._position=i.offsetAlongLine!==void 0?i.offsetAlongLine*r:0,this._beginProcessed=!1}processMultiPath(e){return this._placePerPart?super.processMultiPath(e):this.processPath(e)}processPath(e){let i;switch(this._type){case $g.Both:default:this._beginProcessed?(i=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iterateMultiPath=!1,this.iteratePath=!1):(i=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iterateMultiPath=!0,this.iteratePath=!0);break;case $g.JustBegin:i=this._atExtremities(e,this._position,!0);break;case $g.JustEnd:i=this._atExtremities(e,this._position,!1);case $g.None:}return i}_atExtremities(e,i,r){if(this._placePerPart||(r?e.seekPath(0):e.seekPath(e.totalSize-1)),r||e.seekPathEnd(),r?e.nextPoint():e.prevPoint()){let s=0,[n,o]=[0,0],[a,l]=[e.x,e.y];for(;r?e.nextPoint():e.prevPoint();){n=a,o=l,a=e.x,l=e.y;const c=this._curveHelper.getLength(n,o,a,l);if(s+c>i){const u=(i-s)/c,[d,f]=this._curveHelper.getAngleCS(n,o,a,l,u),m=this._curveHelper.getCoord2D(n,o,a,l,u);return this.internalPlacement.setTranslate(m[0]-this._offset*f,m[1]+this._offset*d),this._angleToLine&&this.internalPlacement.setRotateCS(-d,-f),this.internalPlacement}s+=c}}return null}},PFe=class sI{static local(){return sI.instance===null&&(sI.instance=new sI),sI.instance}execute(e,i,r,s,n){return new TTt(e,i,r)}};PFe.instance=null;let TTt=class extends aN{constructor(e,i,r){super(e),this._walker=new z6,this._walker.updateTolerance(r),this._angleToLine=i.angleToLine===void 0||i.angleToLine,this._offset=i.offset!==void 0?i.offset*r:0,this._beginGap=i.beginPosition!==void 0?i.beginPosition*r:0,this._endGap=i.endPosition!==void 0?i.endPosition*r:0,this._flipFirst=i.flipFirst===void 0||i.flipFirst,this._pattern=new V6,this._pattern.init(i.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(e){if(this._pattern.isEmpty())return null;let i;if(this.iteratePath){const a=this._pattern.nextValue()*this._subPathLen,l=this._beginGap+a;i=l-this._prevPos,this._prevPos=l}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=e.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();const a=this._pattern.nextValue()*this._subPathLen,l=this._beginGap+a;i=l-this._prevPos,this._prevPos=l,this.iteratePath=!0}const r=new C0;if(!this._walker.nextPointAndAngle(i,r,P1.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(r.pt[0]-this._offset*r.sa,r.pt[1]+this._offset*r.ca);const s=this._isFirst&&this._flipFirst;let n,o;return this._angleToLine?(n=r.ca,o=r.sa):(n=1,o=0),s&&(n=-n,o=-o),this.internalPlacement.setRotateCS(n,o),this._isFirst=!1,this._posCount--,this._posCount===0&&(this.iteratePath=!1),this.internalPlacement}};const mv=512,STt=10,gm=24,UB=1e-6;let OFe=class nI{static local(){return nI.instance===null&&(nI.instance=new nI),nI.instance}execute(e,i,r,s,n){return new ETt(e,i,r,s,n)}};OFe.instance=null;let ETt=class jx{constructor(e,i,r,s,n){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(i.stepX??16)*r,this._stepY=Math.abs(i.stepY??16)*r,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,this._stepX!==0&&this._stepY!==0){if(this._gridType=i.gridType??w3.Fixed,this._gridType===w3.Random){const o=i.seed??13,a=1;this._randomLCG=new JT(o*a),this._randomness=(i.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=i.gridAngle??0,this._shiftOddRows=i.shiftOddRows??!1,this._offsetX=(i.offsetX??0)*r,this._offsetY=(i.offsetY??0)*r,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,s!=null){const[o,a,l,c]=s.split("/"),u=parseFloat(o),d=parseFloat(a),f=parseFloat(l),m=parseFloat(c);this._graphicOriginX=-(m*2**u+f)*mv,this._graphicOriginY=d*mv,this._testInsidePolygon=!0}this._internalPlacement=new hO,this._calculateMinMax(e),this._geometryCursor=e}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!jx._randValues){jx._randValues=[];for(let e=0;e<gm;e++)for(let i=0;i<gm;i++)jx._randValues.push(this._randomLCG.getFloat()),jx._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(e){let i,r,s,n,o,a,l,c,u,d,f,m,g,y;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,l=c=g=f=Number.MAX_VALUE,u=d=y=m=-Number.MAX_VALUE;const v=this._cosAngle!==1;for(e.reset();e.nextPath();)for(;e.nextPoint();)a=e.x,o=e.y,i=a-this._graphicOriginX-this._offsetX,r=o-this._graphicOriginY-this._offsetY,v?(s=this._cosAngle*i-this._sinAngle*r,n=this._sinAngle*i+this._cosAngle*r):(s=i,n=r),l=Math.min(l,s),u=Math.max(u,s),c=Math.min(c,n),d=Math.max(d,n),f=Math.min(f,o),m=Math.max(m,o),g=Math.min(g,a),y=Math.max(y,a);f=f!==Number.MAX_VALUE?f:-mv-this._stepY,m=m!==-Number.MAX_VALUE?m:this._stepY,g=g!==Number.MAX_VALUE?g:-this._stepX,y=y!==-Number.MAX_VALUE?y:mv+this._stepX;const b=m-f,w=y-g;if(this._verticalSubdivision=b>=w,this._polygonMin=this._verticalSubdivision?f:g,this._testInsidePolygon){let x=0-this._graphicOriginX-this._offsetX-this._stepX,S=mv-this._graphicOriginX-this._offsetX+this._stepX,C=-mv-this._graphicOriginY-this._offsetY-this._stepY,M=0-this._graphicOriginY-this._offsetY+this._stepY;if(v){const O=[[x,C],[x,M],[S,C],[S,M]];x=C=Number.MAX_VALUE,S=M=-Number.MAX_VALUE;for(const D of O){const U=this._cosAngle*D[0]-this._sinAngle*D[1],k=this._sinAngle*D[0]+this._cosAngle*D[1];x=Math.min(x,U),S=Math.max(S,U),C=Math.min(C,k),M=Math.max(M,k)}}l=l!==Number.MAX_VALUE?Math.max(l,x):x,c=c!==Number.MAX_VALUE?Math.max(c,C):C,u=u!==-Number.MAX_VALUE?Math.min(u,S):S,d=d!==-Number.MAX_VALUE?Math.min(d,M):M}this._xMin=Math.round(l/this._stepX),this._xMax=Math.round(u/this._stepX),this._yMin=Math.round(c/this._stepY),this._yMax=Math.round(d/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(e,g,y,f,m)}_buildAccelerationMap(e,i,r,s,n){e.reset();const o=new Map,a=this._verticalSubdivision,l=a?n-s:r-i;let c=Math.ceil(l/STt);if(c<=1)return;const u=Math.floor(l/c);let d,f,m,g,y,v,b,w,x,S,C;for(c++,this._delta=u,a?(x=-mv-2*this._stepY,S=2*this._stepY,C=s):(x=-2*this._stepX,S=mv+2*this._stepX,C=i);e.nextPath();)if(!(e.pathSize<2)&&e.nextPoint())for(d=e.x,f=e.y;e.nextPoint();d=m,f=g){if(m=e.x,g=e.y,a){if(f===g||f<x&&g<x||f>S&&g>S)continue;y=Math.min(f,g),v=Math.max(f,g)}else{if(d===m||d<x&&m<x||d>S&&m>S)continue;y=Math.min(d,m),v=Math.max(d,m)}for(;y<v;)b=Math.floor((y-C)/u),Bye(b,d,f,m,g,o),y+=u;w=Math.floor((v-C)/u),w>b&&Bye(w,d,f,m,g,o)}this._accelerationMap=o}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let e=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(e+=.5*this._stepX);const i=this._currentY*this._stepY+this._offsetY;let r,s;if(this._currentX++,this._gridType===w3.Random){const n=(this._currentX%gm+gm)%gm,o=(this._currentY%gm+gm)%gm;r=this._graphicOriginX+e+this._stepX*this._randomness*(.5-jx._randValues[o*gm+n])*2/3,s=this._graphicOriginY+i+this._stepY*this._randomness*(.5-jx._randValues[o*gm+n+1])*2/3}else r=this._graphicOriginX+this._cosAngle*e+this._sinAngle*i,s=this._graphicOriginY-this._sinAngle*e+this._cosAngle*i;if(!this._testInsidePolygon||this._isInsidePolygon(r,s,this._geometryCursor))return this._internalPlacement.setTranslate(r,s),this._internalPlacement}}_isInsidePolygon(e,i,r){if(this._accelerationMap==null)return CTt(e,i,r);e+=UB,i+=UB;const s=this._verticalSubdivision,n=s?i:e,o=Math.floor((n-this._polygonMin)/this._delta),a=this._accelerationMap.get(o);if(!a)return!1;let l,c,u,d=0;for(const f of a){if(l=f[0],c=f[1],s){if(l[1]>i==c[1]>i)continue;u=(c[0]-l[0])*(i-l[1])-(c[1]-l[1])*(e-l[0])}else{if(l[0]>e==c[0]>e)continue;u=(c[1]-l[1])*(e-l[0])-(c[0]-l[0])*(i-l[1])}u>0?d++:d--}return d!==0}};function CTt(t,e,i){let r,s,n,o,a=0;for(t+=UB,e+=UB,i.reset();i.nextPath();)if(i.nextPoint())for(r=i.x,s=i.y;i.nextPoint();r=n,s=o)n=i.x,o=i.y,s>e!=o>e&&((n-r)*(e-s)-(o-s)*(t-r)>0?a++:a--);return a!==0}function Bye(t,e,i,r,s,n){let o=n.get(t);o||(o=[],n.set(t,o)),o.push([[e,i],[r,s]])}const MTt=.001;let RFe=class oI{static local(){return oI.instance===null&&(oI.instance=new oI),oI.instance}execute(e,i,r,s,n){return new ATt(e,i,r)}};RFe.instance=null;let ATt=class extends aN{constructor(e,i,r){super(e),this._curveHelper=new L_,this._angleToLine=i.angleToLine===void 0||i.angleToLine,this._offset=i.offset!==void 0?i.offset*r:0,this._relativeTo=i.relativeTo,this._position=i.startPointOffset!==void 0?i.startPointOffset*r:0,this._epsilon=MTt*r}processPath(e){const i=this._position;if(this._relativeTo===ET.SegmentMidpoint){if(this.iteratePath||(this.iteratePath=!0),e.nextPoint()){let[s,n]=[e.x,e.y],[o,a]=[0,0];for(;e.nextPoint();){o=e.x,a=e.y;const l=this._curveHelper.getLength(s,n,o,a);if(l<this._epsilon){s=o,n=a;continue}const c=.5+this._position/l,[u,d]=this._curveHelper.getAngleCS(s,n,o,a,c),f=this._curveHelper.getCoord2D(s,n,o,a,c);return this.internalPlacement.setTranslate(f[0]-this._offset*d,f[1]+this._offset*u),this._angleToLine&&this.internalPlacement.setRotateCS(u,d),this.internalPlacement}}return this.iteratePath=!1,null}const r=this._relativeTo===ET.LineEnd;return this.onLine(e,i,r)}onLine(e,i,r){let s,n=!1;switch(this._relativeTo){case ET.LineMiddle:default:e.seekPathStart(),s=e.pathLength()/2+i;break;case ET.LineBeginning:s=i;break;case ET.LineEnd:s=i,n=!0}r?e.seekPathEnd():e.seekPathStart();let o=0;if(r?e.prevPoint():e.nextPoint()){let[a,l]=[e.x,e.y],[c,u]=[0,0];for(;r?e.prevPoint():e.nextPoint();){c=e.x,u=e.y;const d=this._curveHelper.getLength(a,l,c,u);if(o+d>s){const f=(s-o)/d,[m,g]=this._curveHelper.getAngleCS(a,l,c,u,f),y=this._curveHelper.getCoord2D(a,l,c,u,f),v=n?-this._offset:this._offset;return this.internalPlacement.setTranslate(y[0]-v*g,y[1]+v*m),this._angleToLine&&(n?this.internalPlacement.setRotateCS(-m,-g):this.internalPlacement.setRotateCS(m,g)),this.internalPlacement}a=c,l=u,o+=d}}return null}};const PTt=1e-15;let $Fe=class aI{static local(){return aI.instance===null&&(aI.instance=new aI),aI.instance}execute(e,i,r,s,n){return new OTt(e,i,r)}};$Fe.instance=null;let OTt=class extends aN{constructor(e,i,r){super(e),this._curveHelper=new L_,this._angleToLine=i.angleToLine===void 0||i.angleToLine,this._offset=i.offset!==void 0?i.offset*r:0,this._endPoints=i.placeOnEndPoints===void 0||i.placeOnEndPoints,this._controlPoints=i.placeOnControlPoints===void 0||i.placeOnControlPoints,this._regularVertices=i.placeOnRegularVertices===void 0||i.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(e){if(this.iteratePath||(this._preparePath(e),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const i=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(i[2]);let r=i[0],s=i[1];if(this._offset!==0){const n=Math.cos(i[2]),o=Math.sin(i[2]);r-=this._offset*o,s+=this._offset*n}return this.internalPlacement.setTranslate(r,s),this._tagIterator++,this.internalPlacement}_preparePath(e){this._tags.length=0,this._tagIterator=0,e.seekPathStart();const i=e.isClosed();let r=0,s=!1,n=0,o=0;if(e.seekPathStart(),e.nextPoint()){let a=e.x,l=e.y,c=e.getControlPoint(),u=!0,d=e.nextPoint();for(;d;){const f=e.x,m=e.y,g=e.getControlPoint();(this._angleToLine||this._offset!==0)&&(n=this._curveHelper.getAngle(a,l,f,m,0)),u?(u=!1,i?(r=n,s=c):(this._endPoints||this._controlPoints&&c)&&this._tags.push([a,l,n])):c?this._controlPoints&&this._tags.push([a,l,A4(o,n)]):this._regularVertices&&this._tags.push([a,l,A4(o,n)]),(this._angleToLine||this._offset!==0)&&(o=this._curveHelper.getAngle(a,l,f,m,1)),d=e.nextPoint(),d||(i?g||s?this._controlPoints&&this._tags.push([f,m,A4(o,r)]):this._regularVertices&&this._tags.push([f,m,A4(o,r)]):(this._endPoints||this._controlPoints&&g)&&this._tags.push([f,m,o])),a=f,l=m,c=g}}this._tagIterator=0}};function A4(t,e){const i=Math.PI;for(;Math.abs(e-t)>i+2*PTt;)e-t>i?e-=2*i:e+=2*i;return(t+e)/2}const RTt=100*222045e-21;function $Tt(t){if(t.totalSize===0)return null;const e=aG(t);if(!e)return null;const i=4*(Math.abs(e[0])+Math.abs(e[2])+Math.abs(e[1])+Math.abs(e[3])+1)*RTt;let r=0,s=0;t.reset();for(let U=0;t.nextPath();U++){const k=t.getCurrentRingArea();k>s&&(s=k,r=U)}if(t.seekPath(r),t.pathSize===0)return null;t.seekPathStart();const n=hCe(t);if(Math.abs(s)<=2*i*i)return[(n[0]+n[2])/2,(n[1]+n[3])/2];t.seekPathStart();const o=dXe(t,oi());if(o===null)return null;if(t.totalPoints<4)return o;const a=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],l=[NaN,NaN,NaN,NaN],c=[NaN,NaN,NaN,NaN];let u=!1,d=aR(o,t,!0);d.distance===0&&(u=!0,a[0][0]=o[0],a[0][1]=o[1],d=aR(o,t,!1)),l[0]=d.distance,c[0]=0;const f=[NaN,NaN];let m=!1,g=.25,y=-1,v=NaN;do if(v=NaN,a[1]=o9(t,a9(n[0],n[2],g),i,e),isNaN(a[1][0])||isNaN(a[1][1])||(d=aR(a[1],t,!1),v=d.distance),!isNaN(v)&&v>i&&CU(a[1],t))m=!0,l[1]=v,c[1]=Gx(a[1],o);else if(!isNaN(v)&&v>y&&(y=v,f[0]=a[1][0],f[1]=a[1][1]),g-=.01,g<.1){if(!(y>=0))break;m=!0,l[1]=y,a[1][0]=f[0],a[1][1]=f[1],c[1]=Gx(a[1],o)}while(!m);m=!1,g=.5,y=-1;let b=.01,w=1;do if(v=NaN,a[2]=o9(t,a9(n[0],n[2],g),i,e),isNaN(a[2][0])||isNaN(a[2][1])||(d=aR(a[2],t,!1),v=d.distance),!isNaN(v)&&v>i&&CU(a[2],t))m=!0,l[2]=v,c[2]=Gx(a[2],o);else if(!isNaN(v)&&v>y)y=v,f[0]=a[2][0],f[1]=a[2][1];else if(v>y&&(y=v,f[0]=a[2][0],f[1]=a[2][1]),g=.5+b*w,b+=.01,w*=-1,g<.3||g>.7){if(!(y>=0))break;m=!0,l[2]=y,a[2][0]=f[0],a[2][1]=f[1],c[2]=Gx(a[2],o)}while(!m);m=!1,g=.75,y=-1;do if(v=NaN,a[3]=o9(t,a9(n[0],n[2],g),i,e),isNaN(a[3][0])||isNaN(a[3][1])||(d=aR(a[3],t,!1),v=d.distance),!isNaN(v)&&v>i&&CU(a[3],t))m=!0,l[3]=v,c[3]=Gx(a[3],o);else if(v>y&&(y=v,f[0]=a[3][0],f[1]=a[3][1]),g+=.01,g>.9){if(!(y>=0))break;m=!0,l[3]=y,a[3][0]=f[0],a[3][1]=f[1],c[3]=Gx(a[3],o)}while(!m);const x=[0,1,2,3],S=u?0:1;let C;for(let U=S;U<4;U++)for(let k=S;k<3;k++){const H=c[k],V=c[k+1];DTt(H,V)>0&&(C=x[k],x[k]=x[k+1],x[k+1]=C,c[k]=V,c[k+1]=H)}let M=S,O=0,D=0;for(let U=S;U<4;U++){switch(U){case 0:D=2*l[x[U]];break;case 1:D=1.66666666*l[x[U]];break;case 2:D=1.33333333*l[x[U]];break;case 3:D=l[x[U]]}D>O&&(O=D,M=x[U])}return a[M]}function CU(t,e){let i,r,s,n,o=0;for(e.reset();e.nextPath()&&e.nextPoint();)for(i=e.x,r=e.y;e.nextPoint();i=s,r=n)s=e.x,n=e.y,r>t[1]!=n>t[1]&&((s-i)*(t[1]-r)-(n-r)*(t[0]-i)>0?o++:o--);return o!==0}function aR(t,e,i){if(i&&CU(t,e))return{coord:t,distance:0};let r=1/0,s=0,n=0,o=[0,0],a=[0,0];const l=[0,0];for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(o[0]=e.x,o[1]=e.y;e.nextPoint();o=a){a=[e.x,e.y],aXe(l,t,o,a);const c=Gx(t,l);c<r&&(r=c,s=l[0],n=l[1])}return{coord:[s,n],distance:Math.sqrt(r)}}function o9(t,e,i,r){const s=[e,0];let n=1/0,o=1/0,a=!1,l=!1;const c=[[e,r[1]-1],[e,r[3]+1]],u=[0,0],d=[0,0],f=[0,0],m=[[0,0],[0,0]],g=oi();for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(m[0][0]=t.x,m[0][1]=t.y;t.nextPoint();m[0][0]=m[1][0],m[0][1]=m[1][1]){if(m[1][0]=t.x,m[1][1]=t.y,ITt(g,m)===null||(d[0]=c[0][0],d[1]=c[0][1],f[0]=c[1][0],f[1]=c[1][1],LTt(g,d,f)===0)||!cz(c[0],c[1],m[0],m[1],u))continue;const y=u[1];n>o?y<n&&(n=y,a=!0):y<o&&(o=y,l=!0)}return a&&l?s[1]=(n+o)/2:s[0]=s[1]=NaN,s}function ITt(t,e){if(e.length<2)return null;t||(t=oi());const[i,r]=e[0],[s,n]=e[1];return t[0]=Math.min(i,s),t[1]=Math.min(r,n),t[2]=Math.max(i,s),t[3]=Math.max(r,n),t}const P4=1,O4=4,jye=3,Gye=12;function LTt(t,e,i){let r=ym(e,t),s=ym(i,t);const n=t[0],o=t[1],a=t[2],l=t[3];if(r&s)return 0;if(!(r|s))return 4;const c=(r?1:0)|(s?2:0);do{const u=i[0]-e[0],d=i[1]-e[1];if(u>d)r&jye?(r&P4?(e[1]+=d*(n-e[0])/u,e[0]=n):(e[1]+=d*(a-e[0])/u,e[0]=a),r=ym(e,t)):s&jye?(s&P4?(i[1]+=d*(n-i[0])/u,i[0]=n):(i[1]+=d*(a-i[0])/u,i[0]=a),s=ym(i,t)):r?(r&O4?(e[0]+=u*(o-e[1])/d,e[1]=o):(e[0]+=u*(l-e[1])/d,e[1]=l),r=ym(e,t)):(s&O4?(i[0]+=u*(o-i[1])/d,i[1]=o):(i[0]+=u*(l-i[1])/d,i[1]=l),s=ym(i,t));else if(r&Gye?(r&O4?(e[0]+=u*(o-e[1])/d,e[1]=o):(e[0]+=u*(l-e[1])/d,e[1]=l),r=ym(e,t)):s&Gye?(s&O4?(i[0]+=u*(o-i[1])/d,i[1]=o):(i[0]+=u*(l-i[1])/d,i[1]=l),s=ym(i,t)):r?(r&P4?(e[1]+=d*(n-e[0])/u,e[0]=n):(e[1]+=d*(a-e[0])/u,e[0]=a),r=ym(e,t)):(s&P4?(i[1]+=d*(n-i[0])/u,i[0]=n):(i[1]+=d*(a-i[0])/u,i[0]=a),s=ym(i,t)),r&s)return 0}while(r|s);return c}function ym(t,e){return(t[0]<e[0]?1:0)|(t[0]>e[2]?1:0)<<1|(t[1]<e[1]?1:0)<<2|(t[1]>e[3]?1:0)<<3}function a9(t,e,i){return t+(e-t)*i}function Gx(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])}function DTt(t,e){if(t<e)return-1;if(t>e)return 1;if(t===e)return 0;const i=isNaN(t),r=isNaN(e);return i<r?-1:i>r?1:0}let IFe=class lI{static local(){return lI.instance===null&&(lI.instance=new lI),lI.instance}execute(e,i,r,s,n){return new NTt(e,i,r)}};IFe.instance=null;let NTt=class{constructor(e,i,r){this._geometryCursor=e,this._offsetX=i.offsetX!==void 0?i.offsetX*r:0,this._offsetY=i.offsetY!==void 0?i.offsetY*r:0,this._method=i.method!==void 0?i.method:TM.OnPolygon,this._internalPlacement=new hO}next(){const e=this._geometryCursor;return this._geometryCursor=null,e?this._polygonCenter(e):null}_polygonCenter(e){let i=!1;switch(this._method){case TM.CenterOfMass:{const r=yXe(e);r&&(this._internalPlacement.setTranslate(r[0]+this._offsetX,r[1]+this._offsetY),i=!0)}break;case TM.BoundingBoxCenter:{const r=aG(e);r&&(this._internalPlacement.setTranslate((r[2]+r[0])/2+this._offsetX,(r[3]+r[1])/2+this._offsetY),i=!0)}break;case TM.OnPolygon:default:{const r=$Tt(e);r!==null&&(this._internalPlacement.setTranslate(r[0]+this._offsetX,r[1]+this._offsetY),i=!0)}}return i?this._internalPlacement:null}};function FTt(t){if(!t)return null;switch(t.type){case"CIMGeometricEffectAddControlPoints":return lFe.local();case"CIMGeometricEffectArrow":return cFe.local();case"CIMGeometricEffectBuffer":return uFe.local();case"CIMGeometricEffectControlMeasureLine":return hFe.local();case"CIMGeometricEffectCut":return dFe.local();case"CIMGeometricEffectDashes":return _Fe.local();case"CIMGeometricEffectDonut":return vFe.local();case"CIMGeometricEffectJog":return bFe.local();case"CIMGeometricEffectMove":return wFe.local();case"CIMGeometricEffectOffset":return xFe.local();case"CIMGeometricEffectReverse":return TFe.local();case"CIMGeometricEffectRotate":return SFe.local();case"CIMGeometricEffectScale":return EFe.local();case"CIMGeometricEffectWave":return CFe.local()}return null}function kTt(t){if(!t)return null;switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":return MFe.local();case"CIMMarkerPlacementAtExtremities":return AFe.local();case"CIMMarkerPlacementAtRatioPositions":return PFe.local();case"CIMMarkerPlacementInsidePolygon":return OFe.local();case"CIMMarkerPlacementOnLine":return RFe.local();case"CIMMarkerPlacementOnVertices":return $Fe.local();case"CIMMarkerPlacementPolygonCenter":return IFe.local()}return null}function l9(t){const e=t.getFrame(0);if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement)return e;const i=document.createElement("canvas");i.width=t.width,i.height=t.height;const r=i.getContext("2d");return e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0),i}let UTt=class LFe{constructor(e=0,i=0,r=0,s=0){this.x=e,this.y=i,this.width=r,this.height=s}static fromExtent(e){return new LFe(e.xmin,-e.ymax,e.xmax-e.xmin,e.ymax-e.ymin)}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}};function VTt(t){return`rgb(${t.slice(0,3).toString()})`}function c9(t){return`rgba(${t.slice(0,3).toString()},${t[3]})`}let DFe=class{constructor(e){e&&(this._textRasterizationCanvas=e)}rasterizeText(e,i){var H,V;this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const r=this._textRasterizationCanvas,s=r.getContext("2d",{willReadFrequently:!0});R4(s,i),this._parameters=i,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const{decoration:n,weight:o}=i.font;this._lineThroughWidthOffset=n&&n==="line-through"?.1*this._lineHeight:0;const a=i.backgroundColor!=null||i.borderLine!=null,l=a?Fot:0,c=this._computeTextWidth(s,i)+2*l,u=this._lineHeight*this._textLines.length+2*l;if(r.width=c+2*this._lineThroughWidthOffset,r.height=u,r.width===0||r.height===0)return r.width=r.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:r};this._renderedLineHeight=Math.round(this._lineHeight*i.pixelRatio),this._renderedHaloSize=wn(i.halo.size)*i.pixelRatio,this._renderedWidth=c*i.pixelRatio,this._renderedHeight=u*i.pixelRatio,this._lineThroughWidthOffset*=i.pixelRatio;const d=i.color??[0,0,0,0],f=i.halo&&i.halo.color?i.halo.color:[0,0,0,0];this._fillStyle=c9(d),this._haloStyle=VTt(f);const m=this._renderedLineHeight,g=this._renderedHaloSize;s.save(),s.clearRect(0,0,r.width,r.height),R4(s,i);const y=l*i.pixelRatio,v=zTt(s.textAlign,this._renderedWidth-2*y)+g+y,b=g+y,w=g>0;let x=this._lineThroughWidthOffset,S=0;if(a){s.save();const X=i.backgroundColor??[0,0,0,0],q=((H=i.borderLine)==null?void 0:H.color)??[0,0,0,0],Z=2*wn(((V=i.borderLine)==null?void 0:V.size)??0);s.fillStyle=c9(X),s.strokeStyle=c9(q),s.lineWidth=Z,s.fillRect(0,0,r.width,r.height),s.strokeRect(0,0,r.width,r.height),s.restore()}w&&this._renderHalo(s,v,b,x,S,i),S+=b,x+=v;for(const X of this._textLines)w?(s.globalCompositeOperation="destination-out",s.fillStyle="rgb(0, 0, 0)",s.fillText(X,x,S),s.globalCompositeOperation="source-over",s.fillStyle=this._fillStyle,s.fillText(X,x,S)):(s.fillStyle=this._fillStyle,s.fillText(X,x,S)),n&&n!=="none"&&this._renderDecoration(s,x,S,n,o),S+=m;s.restore();const C=this._renderedWidth+2*this._lineThroughWidthOffset,M=this._renderedHeight,O=s.getImageData(0,0,C,M),D=new Uint8Array(O.data);if(i.premultiplyColors){let X;for(let q=0;q<D.length;q+=4)X=D[q+3]/255,D[q]=D[q]*X,D[q+1]=D[q+1]*X,D[q+2]=D[q+2]*X}let U,k;switch(i.horizontalAlignment){case"left":U=-.5;break;case"right":U=.5;break;default:U=0}switch(i.verticalAlignment){case"bottom":k=-.5;break;case"top":k=.5;break;case"baseline":k=-1/6;break;default:k=0}return{size:[C,M],image:new Uint32Array(D.buffer),sdf:!1,simplePattern:!1,anchorX:U,anchorY:k,canvas:r}}_renderHalo(e,i,r,s,n,o){const a=this._renderedWidth,l=this._renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas")),this._haloRasterizationCanvas.width=a,this._haloRasterizationCanvas.height=l;const c=this._haloRasterizationCanvas,u=c.getContext("2d");u.clearRect(0,0,a,l),R4(u,o);const{decoration:d,weight:f}=o.font;u.fillStyle=this._haloStyle,u.strokeStyle=this._haloStyle,u.lineJoin="round",this._renderHaloNative(u,i,r,d,f),e.globalAlpha=this._parameters.halo.color[3],e.drawImage(c,0,0,a,l,s,n,a,l),e.globalAlpha=1}_renderHaloNative(e,i,r,s,n){const o=this._renderedLineHeight,a=this._renderedHaloSize;for(const l of this._textLines){const c=2*a,u=5,d=.1;for(let f=0;f<u;f++){const m=(1-(u-1)*d+f*d)*c;e.lineWidth=m,e.strokeText(l,i,r),s&&s!=="none"&&this._renderDecoration(e,i,r,s,n,m)}r+=o}}computeTextSize(e,i){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const r=this._textRasterizationCanvas,s=r.getContext("2d");R4(s,i),this._parameters=i,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const n=this._computeTextWidth(s,i),o=this._lineHeight*this._textLines.length;return r.width=n,r.height=o,[n*i.pixelRatio,o*i.pixelRatio]}_computeTextWidth(e,i){let r=0;for(const n of this._textLines)r=Math.max(r,e.measureText(n).width);const s=i.font;return(s.style==="italic"||s.style==="oblique"||typeof s.weight=="string"&&(s.weight==="bold"||s.weight==="bolder")||typeof s.weight=="number"&&s.weight>600)&&(r+=.3*e.measureText("w").width),r+=2*wn(this._parameters.halo.size),Math.round(r)}_computeLineHeight(){let e=1.275*this._parameters.size;const i=this._parameters.font.decoration;return i&&i==="underline"&&(e*=1.3),Math.round(e+2*wn(this._parameters.halo.size))}_renderDecoration(e,i,r,s,n,o){const a=.9*this._lineHeight,l=n==="bold"?.06:n==="bolder"?.09:.04;switch(e.textAlign){case"center":i-=this._renderedWidth/2;break;case"right":i-=this._renderedWidth}const c=e.textBaseline;if(s==="underline")switch(c){case"top":r+=a;break;case"middle":r+=a/2}else if(s==="line-through")switch(c){case"top":r+=a/1.5;break;case"middle":r+=a/3}const u=o?1.5*o:Math.ceil(a*l);e.save(),e.beginPath(),e.strokeStyle=e.fillStyle,e.lineWidth=u,e.moveTo(i-this._lineThroughWidthOffset,r),e.lineTo(i+this._renderedWidth+2*this._lineThroughWidthOffset,r),e.stroke(),e.restore()}};function R4(t,e){const i=Math.max(e.size,.5),r=e.font,s=`${r.style} ${r.weight} ${wn(i*e.pixelRatio).toFixed(1)}px ${r.family}, sans-serif`;let n;switch(t.font=s,t.textBaseline="top",e.horizontalAlignment){case"left":default:n="left";break;case"right":n="right";break;case"center":n="center"}t.textAlign=n}function zTt(t,e){return t==="center"?.5*e:t==="right"?e:0}const yii=512,_ii=29,vii=24;var Hye;(function(t){t[t.FilterFlags=0]="FilterFlags",t[t.Animation=1]="Animation",t[t.GPGPU=2]="GPGPU",t[t.VV=3]="VV",t[t.DD0=4]="DD0",t[t.DD1=5]="DD1",t[t.DD2=6]="DD2"})(Hye||(Hye={}));const bii=1.05,wii=5,xii=6,Tii=1.15,Sii=2,Eii=10,BTt=1024,Cii=256,Mii=32,Aii=512;function jTt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function GTt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function HTt(t,e,i,r,s,n,o){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t}function qTt(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5];let l=i*n-r*s;return l?(l=1/l,t[0]=n*l,t[1]=-r*l,t[2]=-s*l,t[3]=i*l,t[4]=(s*a-n*o)*l,t[5]=(r*o-i*a)*l,t):null}function WTt(t){return t[0]*t[3]-t[1]*t[2]}function NFe(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],u=i[1],d=i[2],f=i[3],m=i[4],g=i[5];return t[0]=r*c+n*u,t[1]=s*c+o*u,t[2]=r*d+n*f,t[3]=s*d+o*f,t[4]=r*m+n*g+a,t[5]=s*m+o*g+l,t}function ZTt(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(i),u=Math.cos(i);return t[0]=r*u+n*c,t[1]=s*u+o*c,t[2]=r*-c+n*u,t[3]=s*-c+o*u,t[4]=a,t[5]=l,t}function YTt(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],u=i[1];return t[0]=r*c,t[1]=s*c,t[2]=n*u,t[3]=o*u,t[4]=a,t[5]=l,t}function XTt(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],u=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=o,t[4]=r*c+n*u+a,t[5]=s*c+o*u+l,t}function JTt(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t}function QTt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function KTt(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function eSt(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function tSt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function iSt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t}function FFe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}function rSt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t}function sSt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t}function nSt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function oSt(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=e[0],c=e[1],u=e[2],d=e[3],f=e[4],m=e[5],g=Do();return Math.abs(i-l)<=g*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=g*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-u)<=g*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(n-d)<=g*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-f)<=g*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=g*Math.max(1,Math.abs(a),Math.abs(m))}const aSt=NFe,lSt=FFe;Object.freeze(Object.defineProperty({__proto__:null,add:iSt,copy:jTt,determinant:WTt,equals:oSt,exactEquals:nSt,frob:tSt,fromRotation:JTt,fromScaling:QTt,fromTranslation:KTt,identity:GTt,invert:qTt,mul:aSt,multiply:NFe,multiplyScalar:rSt,multiplyScalarAndAdd:sSt,rotate:ZTt,scale:YTt,set:HTt,str:eSt,sub:lSt,subtract:FFe,translate:XTt},Symbol.toStringTag,{value:"Module"}));function cSt(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function uSt(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function hSt(t,e,i,r,s,n){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function dSt(t,e){return new Float32Array(t,e,6)}function kFe(t,e,i,r){const s=e[r],n=e[r+1];t[r]=i[0]*s+i[2]*n+i[4],t[r+1]=i[1]*s+i[3]*n+i[5]}function pSt(t,e,i,r=0,s=0,n=2){const o=s||e.length/n;for(let a=r;a<o;a++)kFe(t,e,i,a*n)}Object.freeze(Object.defineProperty({__proto__:null,clone:uSt,create:cSt,createView:dSt,fromValues:hSt,transform:kFe,transformMany:pSt},Symbol.toStringTag,{value:"Module"}));const fSt=()=>se.getLogger("esri.views.2d.engine.webgl.alignmentUtils");var xg,xf;function Pii(t){if(!t)return xg.Center;switch(t){case"Left":case"left":return xg.Left;case"Right":case"right":return xg.Right;case"Justify":return fSt().warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),xg.Center;case"Center":case"center":return xg.Center}}function Oii(t){if(!t)return xf.Center;switch(t){case"Top":case"top":return xf.Top;case"Center":case"middle":return xf.Center;case"Baseline":case"baseline":return xf.Baseline;case"Bottom":case"bottom":return xf.Bottom}}function Rii(t){switch(t){case xg.Right:case"right":return-1;case xg.Center:case"center":return 0;case xg.Left:case"left":return 1;default:return console.debug(`Found invalid horizontal alignment ${t}`),0}}function $ii(t){switch(t){case xf.Top:case"top":return 1;case xf.Center:case"middle":return 0;case xf.Bottom:case xf.Baseline:case"baseline":case"bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${t}`),0}}(function(t){t[t.Left=-1]="Left",t[t.Center=0]="Center",t[t.Right=1]="Right"})(xg||(xg={})),function(t){t[t.Top=1]="Top",t[t.Center=0]="Center",t[t.Bottom=-1]="Bottom",t[t.Baseline=2]="Baseline"}(xf||(xf={}));const CT=Math.PI/180,UFe=.5,mSt=()=>se.getLogger("esri.symbols.cim.CIMSymbolDrawHelper");let Hx=class qm{constructor(e){this._t=e}static createIdentity(){return new qm([1,0,0,0,1,0])}clone(){const e=this._t;return new qm(e.slice())}transform(e){const i=this._t;return[i[0]*e[0]+i[1]*e[1]+i[2],i[3]*e[0]+i[4]*e[1]+i[5]]}static createScale(e,i){return new qm([e,0,0,0,i,0])}scale(e,i){const r=this._t;return r[0]*=e,r[1]*=e,r[2]*=e,r[3]*=i,r[4]*=i,r[5]*=i,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(e,i){return new qm([0,0,e,0,0,i])}translate(e,i){const r=this._t;return r[2]+=e,r[5]+=i,this}static createRotate(e){const i=Math.cos(e),r=Math.sin(e);return new qm([i,-r,0,r,i,0])}rotate(e){return qm.multiply(this,qm.createRotate(e),this)}angle(){const e=this._t[0],i=this._t[3],r=Math.sqrt(e*e+i*i);return[e/r,i/r]}static multiply(e,i,r){const s=e._t,n=i._t,o=s[0]*n[0]+s[3]*n[1],a=s[1]*n[0]+s[4]*n[1],l=s[2]*n[0]+s[5]*n[1]+n[2],c=s[0]*n[3]+s[3]*n[4],u=s[1]*n[3]+s[4]*n[4],d=s[2]*n[3]+s[5]*n[4]+n[5],f=r._t;return f[0]=o,f[1]=a,f[2]=l,f[3]=c,f[4]=u,f[5]=d,r}invert(){const e=this._t;let i=e[0]*e[4]-e[1]*e[3];if(i===0)return new qm([0,0,0,0,0,0]);i=1/i;const r=(e[1]*e[5]-e[2]*e[4])*i,s=(e[2]*e[3]-e[0]*e[5])*i,n=e[4]*i,o=-e[1]*i,a=-e[3]*i,l=e[0]*i;return new qm([n,o,r,a,l,s])}},VFe=class{constructor(e,i){this._resourceManager=e,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new la(hO,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(i||Hx.createIdentity()),this._sizeTransfos.push(i?i.scaleRatio():1)}setTransform(e,i){this._transfos=[e||Hx.createIdentity()],this._sizeTransfos=[i||(e?e.scaleRatio():1)]}setGeomUnitsPerPoint(e){this._geomUnitsPerPoint=e}transformPt(e){return this._transfos[this._transfos.length-1].transform(e)}transformSize(e){return e*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(e){return this._transfos[this._transfos.length-1].invert().transform(e)}reverseTransformSize(e){return e/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(e){return e/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return this._transfos.length>2?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(e,i){const r=i?e.scaleRatio():1;Hx.multiply(e,this.back(),e),this._transfos.push(e),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*r)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(e,i,r){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(e,i);break;case"CIMTextSymbol":this.drawTextSymbol(e,i,r)}}drawMultiLayerSymbol(e,i){if(!e||!i)return;const r=e.symbolLayers;if(!r)return;const s=e.effects;if(s&&s.length>0){const n=this.executeEffects(s,i);if(n){let o=n.next();for(;o;)this.drawSymbolLayers(r,o.asJSON()),o=n.next()}}else this.drawSymbolLayers(r,i)}executeEffects(e,i){const r=this._resourceManager.geometryEngine;let s=new Nxt(Yn.fromJSONCIM(i));for(const n of e){const o=FTt(n);o&&(s=o.execute(s,n,this.geomUnitsPerPoint(),null,r))}return s}drawSymbolLayers(e,i){let r=e.length;for(;r--;){const s=e[r];if(!s||s.enable===!1)continue;const n=s.effects;if(n&&n.length>0){const o=this.executeEffects(n,i);if(o){let a=null;for(;(a=o.next())&&(this.drawSymbolLayer(s,a.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(s,i);if(this._earlyReturn)return}}drawSymbolLayer(e,i){switch(e.type){case"CIMSolidFill":this.drawSolidFill(i,e.color);break;case"CIMHatchFill":this.drawHatchFill(i,e);break;case"CIMPictureFill":this.drawPictureFill(i,e);break;case"CIMGradientFill":this.drawGradientFill(i,e);break;case"CIMSolidStroke":this.drawSolidStroke(i,e.color,e.width,e.capStyle,e.joinStyle,e.miterLimit);break;case"CIMPictureStroke":this.drawPictureStroke(i,e);break;case"CIMGradientStroke":this.drawGradientStroke(i,e);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(e,i)}}drawHatchFill(e,i){const r=_St(i,e,this.geomUnitsPerPoint());r&&(this.pushClipPath(e),this.drawMultiLayerSymbol(i.lineSymbol,r),this.popClipPath())}drawPictureFill(e,i){}drawGradientFill(e,i){}drawPictureStroke(e,i){}drawGradientStroke(e,i){}drawMarkerLayer(e,i){const r=e.markerPlacement;if(r){const s=kTt(r);if(s){const n=r.type==="CIMMarkerPlacementInsidePolygon"||r.type==="CIMMarkerPlacementPolygonCenter"&&r.clipAtBoundary;n&&this.pushClipPath(i);const o=s.execute(Yn.fromJSONCIM(i),r,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine);if(o){let a=null;for(;(a=o.next())&&(this.drawMarker(e,a),!this._earlyReturn););}n&&this.popClipPath()}}else{const s=this._placementPool.acquire();if(BA(i))s.tx=i.x,s.ty=i.y,this.drawMarker(e,s);else if(ol(i)){const n=eCe(i);n&&([s.tx,s.ty]=n,this.drawMarker(e,s))}else for(const n of i.points)if(s.tx=n[0],s.ty=n[1],this.drawMarker(e,s),this._earlyReturn)break;this._placementPool.release(s)}}drawMarker(e,i){switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(e,i);break;case"CIMVectorMarker":this.drawVectorMarker(e,i)}}drawPictureMarker(e,i){if(!e)return;const r=this._resourceManager.getResource(e.url),s=Ni(e.size,fA.CIMPictureMarker.size);if(r==null||s<=0)return;const n=r.width,o=r.height;if(!n||!o)return;const a=n/o,l=Ni(e.scaleX,1),c=Hx.createIdentity(),u=e.anchorPoint;if(u){let v=u.x,b=u.y;e.anchorPointUnits!=="Absolute"&&(v*=s*a*l,b*=s),c.translate(-v,-b)}let d=Ni(e.rotation);e.rotateClockwise&&(d=-d),this._mapRotation&&(d+=this._mapRotation),d&&c.rotate(d*CT);let f=Ni(e.offsetX),m=Ni(e.offsetY);if(f||m){if(this._mapRotation){const v=CT*this._mapRotation,b=Math.cos(v),w=Math.sin(v),x=f*w+m*b;f=f*b-m*w,m=x}c.translate(f,m)}const g=this.geomUnitsPerPoint();g!==1&&c.scale(g,g);const y=i.getAngle();y&&c.rotate(y),c.translate(i.tx,i.ty),this.push(c,!1),this.drawImage(e,s),this.pop()}drawVectorMarker(e,i){if(!e)return;const r=e.markerGraphics;if(!r)return;const s=Ni(e.size,fA.CIMVectorMarker.size),n=e.frame,o=n?n.ymax-n.ymin:0,a=s&&o?s/o:1,l=Hx.createIdentity();n&&l.translate(.5*-(n.xmax+n.xmin),.5*-(n.ymax+n.ymin));const c=e.anchorPoint;if(c){let y=c.x,v=c.y;e.anchorPointUnits!=="Absolute"?n&&(y*=n.xmax-n.xmin,v*=n.ymax-n.ymin):(y/=a,v/=a),l.translate(-y,-v)}a!==1&&l.scale(a,a);let u=Ni(e.rotation);e.rotateClockwise&&(u=-u),this._mapRotation&&(u+=this._mapRotation),u&&l.rotate(u*CT);let d=Ni(e.offsetX),f=Ni(e.offsetY);if(d||f){if(this._mapRotation){const y=CT*this._mapRotation,v=Math.cos(y),b=Math.sin(y),w=d*b+f*v;d=d*v-f*b,f=w}l.translate(d,f)}const m=this.geomUnitsPerPoint();m!==1&&l.scale(m,m);const g=i.getAngle();g&&l.rotate(g),l.translate(i.tx,i.ty),this.push(l,e.scaleSymbolsProportionally);for(const y of r){y!=null&&y.symbol&&y.geometry||mSt().error("Invalid marker graphic",y);let v=y.textString;if(typeof v=="number"&&(v=v.toString()),this.drawSymbol(y.symbol,y.geometry,v),this._earlyReturn)break}this.pop()}drawTextSymbol(e,i,r){if(!e||!BA(i)||Ni(e.height,fA.CIMTextSymbol.height)<=0)return;const s=Hx.createIdentity();let n=Ni(e.angle);n=-n,n&&s.rotate(n*CT);const o=Ni(e.offsetX),a=Ni(e.offsetY);(o||a)&&s.translate(o,a);const l=this.geomUnitsPerPoint();l!==1&&s.scale(l,l),s.translate(i.x,i.y),this.push(s,!1),this.drawText(e,r),this.pop()}},gSt=class extends VFe{constructor(e,i){super(e,i),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new UTt(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return rG(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(e){if(e&&!(this._clipCount>0))if(ol(e))this._processPath(e.rings,0);else if(vf(e))this._processPath(e.paths,0);else if(_f(e)){const i=MT(e);i&&this._processPath(i.rings,0)}else console.error("drawSolidFill Unexpected geometry type!")}drawSolidStroke(e,i,r){if(!e||this._clipCount>0||r==null||r<=0)return;const s=Math.max(.5*this.transformSize(Ni(r,fA.CIMSolidStroke.width)),.5*UFe);if(ol(e))this._processPath(e.rings,s);else if(vf(e))this._processPath(e.paths,s);else if(_f(e)){const n=MT(e);n&&this._processPath(n.rings,s)}else console.error("drawSolidStroke unexpected geometry type!")}drawMarkerLayer(e,i){ol(i)&&e.markerPlacement&&(e.markerPlacement.type==="CIMMarkerPlacementInsidePolygon"||e.markerPlacement.type==="CIMMarkerPlacementPolygonCenter"&&e.markerPlacement.clipAtBoundary)?this._processPath(i.rings,0):super.drawMarkerLayer(e,i)}drawHatchFill(e,i){this.drawSolidFill(e)}drawPictureFill(e,i){this.drawSolidFill(e)}drawGradientFill(e,i){this.drawSolidFill(e)}drawPictureStroke(e,i){this.drawSolidStroke(e,null,i.width)}drawGradientStroke(e,i){this.drawSolidStroke(e,null,i.width)}pushClipPath(e){this.drawSolidFill(e),this._clipCount++}popClipPath(){this._clipCount--}drawImage(e,i){const{url:r}=e,s=Ni(e.scaleX,1);let n=s*i,o=i;const a=this._resourceManager.getResource(r);if(a!=null){const l=a.height/a.width;n=s*(i?l>1?i:i/l:a.width),o=i?l>1?i*l:i:a.height}this._merge(this.transformPt([-n/2,-o/2]),0),this._merge(this.transformPt([-n/2,o/2]),0),this._merge(this.transformPt([n/2,-o/2]),0),this._merge(this.transformPt([n/2,o/2]),0)}drawText(e,i){if(!i||i.length===0)return;this._textRasterizer||(this._textRasterizer=new DFe);const r=zFe(e);let[s,n]=this._textRasterizer.computeTextSize(i,r);s=Uo(s),n=Uo(n);let o=0;switch(e.horizontalAlignment){case"Left":o=s/2;break;case"Right":o=-s/2}let a=0;switch(e.verticalAlignment){case"Bottom":a=n/2;break;case"Top":a=-n/2;break;case"Baseline":a=n/6}this._merge(this.transformPt([-s/2+o,-n/2+a]),0),this._merge(this.transformPt([-s/2+o,n/2+a]),0),this._merge(this.transformPt([s/2+o,-n/2+a]),0),this._merge(this.transformPt([s/2+o,n/2+a]),0)}_processPath(e,i){if(e)for(const r of e){const s=r?r.length:0;if(s>1){this._merge(this.transformPt(r[0]),i);for(let n=1;n<s;n++)this._merge(this.transformPt(r[n]),i)}}}_merge(e,i){e[0]-i<this._xmin&&(this._xmin=e[0]-i),e[0]+i>this._xmax&&(this._xmax=e[0]+i),e[1]-i<this._ymin&&(this._ymin=e[1]-i),e[1]+i>this._ymax&&(this._ymax=e[1]+i)}},ySt=class extends VFe{constructor(e,i,r,s){super(i,r),this._applyAdditionalRenderProps=s,this._colorSubstitutionHelper=new Fxt,this._ctx=e}drawSolidFill(e,i){if(!e)return;if(ol(e))this._buildPath(e.rings,!0);else if(vf(e))this._buildPath(e.paths,!0);else if(_f(e))this._buildPath(MT(e).rings,!0);else{if(!sS(e))return;console.log("CanvasDrawHelper.drawSolidFill - No implementation!")}const r=this._ctx;r.fillStyle=typeof i=="string"?i:"rgba("+Math.round(i[0])+","+Math.round(i[1])+","+Math.round(i[2])+","+(i[3]??255)/255+")",r.fill("evenodd")}drawSolidStroke(e,i,r,s,n,o){if(!e||!i||r===0)return;if(ol(e))this._buildPath(e.rings,!0);else if(vf(e))this._buildPath(e.paths,!1);else{if(!_f(e))return void console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");this._buildPath(MT(e).rings,!0)}const a=this._ctx;a.strokeStyle=typeof i=="string"?i:"rgba("+Math.round(i[0])+","+Math.round(i[1])+","+Math.round(i[2])+","+(i[3]??255)/255+")",a.lineWidth=Math.max(this.transformSize(r),UFe),this._setCapStyle(s),this._setJoinStyle(n),a.miterLimit=o,a.stroke()}pushClipPath(e){if(this._ctx.save(),ol(e))this._buildPath(e.rings,!0);else if(vf(e))this._buildPath(e.paths,!0);else{if(!_f(e))return;this._buildPath(MT(e).rings,!0)}this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(e,i){const{colorSubstitutions:r,url:s,tintColor:n}=e,o=Ni(e.scaleX,1),a=this._resourceManager.getResource(s);if(a==null)return;let l=i*(a.width/a.height),c=i;i||(l=a.width,c=a.height);const u=_E(s)||"src"in a&&_E(a.src);let d="getFrame"in a?l9(a):a;r&&(d=this._colorSubstitutionHelper.applyColorSubstituition(d,r)),this._applyAdditionalRenderProps&&!u&&n&&(d=this._colorSubstitutionHelper.tintImageData(d,n));const f=this.transformPt([0,0]),[m,g]=this.getTransformAngle(),y=this.transformSize(1),v=this._ctx;v.save(),v.setTransform({m11:o*y*m,m12:o*y*g,m21:-y*g,m22:y*m,m41:f[0],m42:f[1]}),v.drawImage(d,-l/2,-c/2,l,c),v.restore()}drawText(e,i){if(!i||i.length===0)return;this._textRasterizer||(this._textRasterizer=new DFe);const r=zFe(e);r.size*=this.transformSize(Uo(1));const s=this._textRasterizer.rasterizeText(i,r);if(!s)return;const{size:n,anchorX:o,anchorY:a,canvas:l}=s,c=n[0]*(o+.5),u=n[1]*(a-.5),d=this._ctx,f=this.transformPt([0,0]),[m,g]=this.getTransformAngle(),y=1;d.save(),d.setTransform({m11:y*m,m12:y*g,m21:-y*g,m22:y*m,m41:f[0]-y*c,m42:f[1]+y*u}),d.drawImage(l,0,0),d.restore()}drawPictureFill(e,i){if(!e)return;let{colorSubstitutions:r,height:s,offsetX:n,offsetY:o,rotation:a,scaleX:l,tintColor:c,url:u}=i;const d=this._resourceManager.getResource(u);if(d==null)return;if(ol(e))this._buildPath(e.rings,!0);else if(vf(e))this._buildPath(e.paths,!0);else if(_f(e))this._buildPath(MT(e).rings,!0);else{if(!sS(e))return;console.log("CanvasDrawHelper.drawPictureFill - No implementation!")}const f=this._ctx,m=_E(u)||"src"in d&&_E(d.src);let g,y="getFrame"in d?l9(d):d;if(r&&(y=this._colorSubstitutionHelper.applyColorSubstituition(y,r)),this._applyAdditionalRenderProps){m||c&&(y=this._colorSubstitutionHelper.tintImageData(y,c)),g=f.createPattern(y,"repeat");const v=this.transformSize(1);a||(a=0),n?n*=v:n=0,o?o*=v:o=0,s&&(s*=v);const b=s?s/d.height:1,w=l&&s?l*s/d.width:1;if(a!==0||b!==1||w!==1||n!==0||o!==0){const x=new DOMMatrix;x.rotateSelf(0,0,-a).translateSelf(n,o).scaleSelf(w,b,1),g.setTransform(x)}}else g=f.createPattern(y,"repeat");f.save(),f.fillStyle=g,f.fill("evenodd"),f.restore()}drawPictureStroke(e,i){if(!e)return;let{colorSubstitutions:r,capStyle:s,joinStyle:n,miterLimit:o,tintColor:a,url:l,width:c}=i;const u=this._resourceManager.getResource(l);if(u==null)return;let d;if(ol(e))d=e.rings;else if(vf(e))d=e.paths;else{if(!_f(e))return sS(e)?void console.log("CanvasDrawHelper.drawPictureStroke - No implementation!"):void 0;d=MT(e).rings}c||(c=u.width);const f=_E(l)||"src"in u&&_E(u.src);let m="getFrame"in u?l9(u):u;r&&(m=this._colorSubstitutionHelper.applyColorSubstituition(m,r)),this._applyAdditionalRenderProps&&(f||a&&(m=this._colorSubstitutionHelper.tintImageData(m,a)));const g=Math.max(this.transformSize(wn(c)),.5),y=g/m.width,v=this._ctx,b=v.createPattern(m,"repeat-y");let w,x;v.save(),this._setCapStyle(s),this._setJoinStyle(n),o!==void 0&&(v.miterLimit=o),v.lineWidth=g;for(let S of d)if(S=ie(S),wSt(S),S&&!(S.length<=1)){w=this.transformPt(S[0]);for(let C=1;C<S.length;C++){x=this.transformPt(S[C]);const M=vSt(w,x),O=new DOMMatrix;O.translateSelf(0,w[1]-g/2).scaleSelf(y,y,1).rotateSelf(0,0,90-M),b.setTransform(O),v.strokeStyle=b,v.beginPath(),v.moveTo(w[0],w[1]),v.lineTo(x[0],x[1]),v.stroke(),w=x}}v.restore()}_buildPath(e,i){const r=this._ctx;if(r.beginPath(),e)for(const s of e){const n=s?s.length:0;if(n>1){let o=this.transformPt(s[0]);r.moveTo(o[0],o[1]);for(let a=1;a<n;a++)o=this.transformPt(s[a]),r.lineTo(o[0],o[1]);i&&r.closePath()}}}_setCapStyle(e){switch(e){case Wd.Butt:this._ctx.lineCap="butt";break;case Wd.Round:this._ctx.lineCap="round";break;case Wd.Square:this._ctx.lineCap="square"}}_setJoinStyle(e){switch(e){case Ig.Bevel:this._ctx.lineJoin="bevel";break;case Ig.Round:this._ctx.lineJoin="round";break;case Ig.Miter:this._ctx.lineJoin="miter"}}};function _St(t,e,i){let r=Ni(t.separation,fA.CIMHatchFill.separation)*i,s=Ni(t.rotation);if(r===0)return null;r<0&&(r=-r);let n=0;const o=.5*r;for(;n>o;)n-=r;for(;n<-o;)n+=r;const a=oi();SXe(a,e),a[0]-=o,a[1]-=o,a[2]+=o,a[3]+=o;const l=[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]]];for(;s>180;)s-=180;for(;s<0;)s+=180;const c=Math.cos(s*CT),u=Math.sin(s*CT),d=-r*u,f=r*c;let m,g,y,v;n=Ni(t.offsetX)*i*u-Ni(t.offsetY)*i*c,m=y=Number.MAX_VALUE,g=v=-Number.MAX_VALUE;for(const O of l){const D=O[0],U=O[1],k=c*D+u*U,H=-u*D+c*U;m=Math.min(m,k),y=Math.min(y,H),g=Math.max(g,k),v=Math.max(v,H)}y=Math.floor(y/r)*r;let b=c*m-u*y-d*n/r,w=u*m+c*y-f*n/r,x=c*g-u*y-d*n/r,S=u*g+c*y-f*n/r;const C=1+Math.round((v-y)/r),M=[];for(let O=0;O<C;O++)b+=d,w+=f,x+=d,S+=f,M.push([[b,w],[x,S]]);return{paths:M}}function vSt(t,e){const i=e[0]-t[0],r=e[1]-t[1];return 180/Math.PI*Math.atan2(r,i)}const MT=t=>t?{spatialReference:t.spatialReference,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:null;function zFe(t,e=1){var b;const i=mFe(t),r=fFe(t.fontStyleName),s=t.fontFamilyName??Uoe,{weight:n,style:o}=r,a=e*(t.height||5),l=nTt(t.horizontalAlignment),c=oTt(t.verticalAlignment),u=x3(t),d=x3(t.haloSymbol),f=d!=null?e*(t.haloSize??0):0,m=((b=t.callout)==null?void 0:b.type)==="CIMBackgroundCallout"?t.callout.backgroundSymbol:null,g=x3(m),y=dK(m),v=hK(m);return{color:u,size:a,horizontalAlignment:l,verticalAlignment:c,font:{family:s,style:rTt(o),weight:sTt(n),decoration:i},halo:{size:f||0,color:d,style:o},backgroundColor:g,borderLine:y!=null&&v!=null?{size:y,color:v}:null,pixelRatio:1,premultiplyColors:!0}}const bSt=1e-4;function wSt(t){let e,i,r,s,n,o=t[0],a=1;for(;a<t.length;)e=t[a][0]-o[0],i=t[a][1]-o[1],s=e!==0?i/e:Math.PI/2,r!==void 0&&s-r<=bSt?(t.splice(a-1,1),o=n):(n=o,o=t[a],a++),r=s}const zoe=[252,146,31,255],xSt=[153,153,153,255],TSt={type:"esriSMS",style:"esriSMSCircle",size:6,color:zoe,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},SSt={type:"esriSLS",style:"esriSLSSolid",width:.75,color:zoe},ESt={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},CSt={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},MSt={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},ASt={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},PSt={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},BFe=py.fromJSON(TSt),Boe=Wh.fromJSON(SSt),jFe=E_.fromJSON(ESt),OSt=tO.fromJSON(CSt);function Nii(t){if(t==null)return null;switch(t.type){case"mesh":return null;case"point":case"multipoint":return BFe;case"polyline":return Boe;case"polygon":case"extent":return jFe}return null}py.fromJSON(MSt);Wh.fromJSON(ASt);E_.fromJSON(PSt);const Fii=Number.POSITIVE_INFINITY,joe=Math.PI,kii=2*joe,RSt=128/joe,$St=256/360,Uii=joe/180,ISt=1/Math.LN2;function GFe(t,e){return(t%=e)>=0?t:t+e}function Vii(t){return GFe(t*RSt,256)}function zii(t){return GFe(t*$St,256)}function Bii(t){return Math.log(t)*ISt}function jii(t,e,i){return t*(1-i)+e*i}const LSt=8,DSt=14,NSt=16;function Gii(t){return LSt+Math.max((t-DSt)*NSt,0)}function Hii(t,e,i){let r,s,n,o=0;for(const a of i){r=a.length;for(let l=1;l<r;++l)s=a[l-1],n=a[l],s.y>e!=n.y>e&&((n.x-s.x)*(e-s.y)-(n.y-s.y)*(t-s.x)>0?o++:o--)}return o!==0}function qii(t,e,i,r){let s,n,o,a;const l=r*r;for(const c of i){const u=c.length;if(!(u<2)){s=c[0].x,n=c[0].y;for(let d=1;d<u;++d){if(o=c[d].x,a=c[d].y,lXe(t,e,s,n,o,a)<l)return!0;s=o,n=a}}}return!1}function FSt(t,e,i,r,s,n,o){const a=Math.max(r,Math.min(e,n))-e,l=Math.max(s,Math.min(i,o))-i;return a*a+l*l<=t*t}function Wii(t,e){if(e===0||Number.isNaN(e))return t;const i=[],r=new Ka(0,0),s=new Ka(0,0),n=new Ka(0,0);for(let o=0;o<t.length;o++){const a=t[o],l=[];for(let c=0;c<a.length;c++){const u=a[c-1],d=a[c],f=a[c+1];c===0?r.setCoords(0,0):r.assignSub(d,u).normalize().rightPerpendicular(),c===a.length-1?s.setCoords(0,0):s.assignSub(f,d).normalize().rightPerpendicular(),n.assignAdd(r,s).normalize();const m=n.x*s.x+n.y*s.y;m!==0&&n.scale(1/m),l.push(Ka.add(d,n.scale(e)))}i.push(l)}return i}function Zii(t,e,i,r){const s=new Ka(t[0],t[1]);if(s.scale(r),e==="viewport"){const n=-i*(Math.PI/180),o=Math.cos(n),a=Math.sin(n);s.rotate(o,a)}return s}const HFe=Math.PI,kSt=HFe/2,_m=96/72,qye=4,VB=()=>se.getLogger("esri.symbols.cim.CIMSymbolHelper");function MU(t,e,i){switch(e.type){case"CIMSymbolReference":return MU(t,e.symbol,i);case"CIMPointSymbol":i==null&&(i={x:0,y:0}),t.drawSymbol(e,i);break;case"CIMLineSymbol":i==null&&(i={paths:[[[0,0],[10,0]]]}),t.drawSymbol(e,i);break;case"CIMPolygonSymbol":i==null&&(i={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]}),t.drawSymbol(e,i);break;case"CIMTextSymbol":{const r={x:0,y:0};t.drawSymbol(e,r);break}case"CIMVectorMarker":{const r=new hO;t.drawMarker(e,r);break}}return t.envelope()}function USt(t){if(!t)return 0;switch(t.type){case"CIMGeometricEffectArrow":return Math.abs(.5*t.width);case"CIMGeometricEffectBuffer":return Math.abs(t.size);case"CIMGeometricEffectControlMeasureLine":return 500;case"CIMGeometricEffectExtension":case"CIMGeometricEffectRadial":return Math.abs(t.length);case"CIMGeometricEffectJog":return Math.abs(.5*t.length);case"CIMGeometricEffectMove":return Math.max(Math.abs(Ni(t.offsetX)),Math.abs(Ni(t.offsetY)));case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":return Math.abs(t.offset);case"CIMGeometricEffectRegularPolygon":return Math.abs(t.radius);case"CIMGeometricEffectRotate":case"CIMGeometricEffectScale":default:return 0;case"CIMGeometricEffectTaperedPolygon":return .5*Math.max(Math.abs(t.fromWidth),Math.abs(t.toWidth));case"CIMGeometricEffectWave":return Math.abs(t.amplitude);case"CIMGeometricEffectDonut":return Math.abs(t.width)}}function Yii(t){if(!t)return 0;let e=0;for(const i of t)e+=USt(i);return e}let u9=class AU{static getEnvelope(e,i,r){if(!e)return null;const s=new gSt(r);if(Array.isArray(e)){let n;for(const o of e)n?n.union(MU(s,o,i)):n=MU(s,o,i);return n}return MU(s,e,i)}static getTextureAnchor(e,i){const r=this.getEnvelope(e,null,i);if(!r)return[0,0,0];const s=(r.x+.5*r.width)*_m,n=(r.y+.5*r.height)*_m,o=r.width*_m+2,a=r.height*_m+2;return[-s/o,-n/a,a]}static rasterize(e,i,r,s,n=!0){const o=r||this.getEnvelope(i,null,s);if(!o)return[null,0,0,0,0];const a=(o.x+.5*o.width)*_m,l=(o.y+.5*o.height)*_m;e.width=o.width*_m,e.height=o.height*_m,r||(e.width+=2,e.height+=2);const c=e.getContext("2d",{willReadFrequently:!0}),u=Hx.createScale(_m,-_m);u.translate(.5*e.width-a,.5*e.height+l);const d=new ySt(c,s,u);switch(i.type){case"CIMPointSymbol":{const g={type:"point",x:0,y:0};d.drawSymbol(i,g);break}case"CIMVectorMarker":{const g=new hO;d.drawMarker(i,g);break}}const f=c.getImageData(0,0,e.width,e.height),m=new Uint8Array(f.data);if(n){let g;for(let y=0;y<m.length;y+=4)g=m[y+3]/255,m[y]=m[y]*g,m[y+1]=m[y+1]*g,m[y+2]=m[y+2]*g}return[m,e.width,e.height,-a/e.width,-l/e.height]}static fromTextSymbol(e){const{text:i}=e;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:AU.createCIMTextSymbolfromTextSymbol(e),textString:i}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(e){const{height:i,outline:r,width:s,xoffset:n,xscale:o,yoffset:a,yscale:l}=e,c=[],u={type:"CIMPolygonSymbol",symbolLayers:c};if(r){const y=Wye(r);y&&c.push(y)}let d=e.url;e.type==="esriPFS"&&e.imageData&&(d=e.imageData);const f="angle"in e?e.angle??0:0,m=(s??0)*(o||1),g=(i??0)*(l||1);return c.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:SM.Picture,tintColor:null,url:d,height:g,width:m,offsetX:Ni(n),offsetY:Ni(a),rotation:Ni(-f),colorSubstitutions:null}),u}static fromSimpleFillSymbol(e){const{color:i,style:r,outline:s}=e,n=[],o={type:"CIMPolygonSymbol",symbolLayers:n};if(s){const a=Wye(s);a&&n.push(a)}if(r&&r!=="solid"&&r!=="none"&&r!=="esriSFSSolid"&&r!=="esriSFSNull"){const a={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:th(i),capStyle:Wd.Butt,joinStyle:Ig.Miter,width:.75}]};let l=0;const c=Uo(HSt(r)?8:10);switch(r){case"vertical":case"esriSFSVertical":l=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":l=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":l=45;break;case"cross":case"esriSFSCross":l=0}n.push({type:"CIMHatchFill",lineSymbol:a,offsetX:0,offsetY:0,rotation:l,separation:c}),r==="cross"||r==="esriSFSCross"?n.push({type:"CIMHatchFill",lineSymbol:ie(a),offsetX:0,offsetY:0,rotation:90,separation:c}):r!=="diagonal-cross"&&r!=="esriSFSDiagonalCross"||n.push({type:"CIMHatchFill",lineSymbol:ie(a),offsetX:0,offsetY:0,rotation:45,separation:c})}else!r||r!=="solid"&&r!=="esriSFSSolid"||n.push({type:"CIMSolidFill",enable:!0,color:th(i)});return o}static fromSimpleLineSymbol(e){const{cap:i,color:r,join:s,marker:n,miterLimit:o,style:a,width:l}=e;let c=null;a!=="solid"&&a!=="none"&&a!=="esriSLSSolid"&&a!=="esriSLSNull"&&(c=[{type:"CIMGeometricEffectDashes",dashTemplate:fK(a,i),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const u=[];if(n){let d;switch(n.placement){case"begin-end":d=$g.Both;break;case"begin":d=$g.JustBegin;break;case"end":d=$g.JustEnd;break;default:d=$g.None}const f=AU.fromSimpleMarker(n,l,r).symbolLayers[0];f.markerPlacement={type:"CIMMarkerPlacementAtExtremities",placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:d,offsetAlongLine:0},u.push(f)}return u.push({type:"CIMSolidStroke",color:a!=="none"&&a!=="esriSLSNull"?th(r):[0,0,0,0],capStyle:WFe(i),joinStyle:ZFe(s),miterLimit:o,width:l,effects:c}),{type:"CIMLineSymbol",symbolLayers:u}}static fromPictureMarker(e){const{angle:i,height:r,width:s,xoffset:n,yoffset:o}=e;let a=e.url;return e.type==="esriPMS"&&e.imageData&&(a=e.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:SM.Picture,tintColor:null,url:a,size:r,width:s,offsetX:Ni(n),offsetY:Ni(o),rotation:Ni(-i)}]}}static createCIMTextSymbolfromTextSymbol(e){const{angle:i,color:r,font:s,haloColor:n,haloSize:o,horizontalAlignment:a,kerning:l,lineWidth:c,text:u,verticalAlignment:d,xoffset:f,yoffset:m,backgroundColor:g,borderLineColor:y,borderLineSize:v}=e;let b,w,x,S,C,M;s&&(b=s.family,w=s.style,x=s.weight,S=s.size,C=s.decoration);let O=!1;return u&&(O=Sxt(u)[1]),(g||v)&&(M={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:th(g)},{type:"CIMSolidStroke",color:th(y),width:v}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:"CIMTextSymbol",angle:i,blockProgression:aK.BTT,depth3D:1,extrapolateBaselines:!0,fontEffects:sK.Normal,fontEncoding:nK.Unicode,fontFamilyName:b||"Arial",fontStyleName:BSt(w,x),fontType:oK.Unspecified,haloSize:o,height:S,hinting:cK.Default,horizontalAlignment:VSt(a??"center"),kerning:l,letterWidth:100,ligatures:!0,lineGapType:"Multiple",lineWidth:c,offsetX:Ni(f),offsetY:Ni(m),strikethrough:C==="line-through",underline:C==="underline",symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:th(r)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:th(n)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:O?kB.RTL:kB.LTR,verticalAlignment:zSt(d??"baseline"),verticalGlyphOrientation:uK.Right,wordSpacing:100,billboardMode3D:lK.FaceNearPlane,callout:M}}static createPictureMarkerRasterizationParam(e){var l,c;const{angle:i,height:r,width:s,xoffset:n,yoffset:o}=e,a=e.url??((l=e.source)==null?void 0:l.url)??((c=e.source)==null?void 0:c.imageData);return a?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:SM.Picture,tintColor:null,url:a,size:r,width:s,offsetX:Ni(n),offsetY:Ni(o),rotation:Ni(-i)}}:null}static createPictureFillRasterizationParam(e){const{width:i,height:r,xoffset:s,yoffset:n,url:o}=e;return o?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:SM.Picture,tintColor:null,url:o,width:i,height:r,offsetX:Ni(s),offsetY:Ni(n),rotation:0}}:null}static fromSimpleMarker(e,i,r){const{style:s}=e,n=e.color??r;if(s==="path"||s==="esriSMSPath"){const d=[];if("outline"in e&&e.outline){const g=e.outline;d.push({type:"CIMSolidStroke",enable:!0,width:g.width,color:th(g.color),path:e.path})}d.push({type:"CIMSolidFill",enable:!0,color:th(n),path:e.path});const[f,m]=lR("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-Ni(e.angle),size:Ni(e.size||6),offsetX:Ni(e.xoffset),offsetY:Ni(e.yoffset),scaleSymbolsProportionally:!1,frame:f,markerGraphics:[{type:"CIMMarkerGraphic",geometry:m,symbol:{type:"CIMPolygonSymbol",symbolLayers:d}}]}]}}const o=[];let a,l,c=e.size;if("outline"in e&&e.outline&&e.outline.style!=="none"&&e.outline.style!=="esriSLSNull"){const d=e.outline,f=d.style!=="solid"&&d.style!=="esriSLSSolid";[a,l]=f?lR(s,e.size):lR(s);const m=d.width??Boe.width;if(f){const v=m/e.size,b=(a.xmax-a.xmin)*v/2,w=(a.ymax-a.ymin)*v/2;a.xmin-=b,a.xmax+=b,a.ymin-=w,a.ymax+=w,c&&(c+=m)}const g=e.style!=="cross"&&e.style!=="x"||(e==null?void 0:e.outline.style)==="dot"||(e==null?void 0:e.outline.style)==="short-dot"?Xa.HalfGap:Xa.FullPattern,y=f?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:fK(d.style,null).map(v=>d.width&&d.width>0?v*d.width:v),lineDashEnding:g,controlPointEnding:Xa.FullPattern}]:void 0;o.push({type:"CIMSolidStroke",capStyle:f?Wd.Round:Wd.Butt,enable:!0,width:m,color:th(d.color),effects:y})}else!i||e.type!=="line-marker"||e.style!=="cross"&&e.style!=="x"?[a,l]=lR(s):([a,l]=lR(s),o.push({type:"CIMSolidStroke",enable:!0,width:i,color:th(n)}));o.push({type:"CIMSolidFill",enable:!0,color:th(n)});const u={type:"CIMPolygonSymbol",symbolLayers:o};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:Ni(-e.angle),size:Ni(c||6*i),offsetX:Ni(e.xoffset),offsetY:Ni(e.yoffset),scaleSymbolsProportionally:!1,frame:a,markerGraphics:[{type:"CIMMarkerGraphic",geometry:l,symbol:u}]}]}}static fromCIMHatchFill(e,i){var l;const r=i*(e.separation??fA.CIMHatchFill.separation),s=r/2,n=ie(e.lineSymbol);(l=n.symbolLayers)==null||l.forEach(c=>{var u;switch(c.type){case"CIMSolidStroke":c.width!=null&&(c.width*=i),(u=c.effects)==null||u.forEach(d=>{if(d.type==="CIMGeometricEffectDashes"){const f=d.dashTemplate;d.dashTemplate=f==null?void 0:f.map(m=>m*i)}});break;case"CIMVectorMarker":{c.size!=null&&(c.size*=i);const d=c.markerPlacement;d!=null&&"placementTemplate"in d&&(d.placementTemplate=d.placementTemplate.map(f=>f*i));break}}});let o=this._getLineSymbolPeriod(n)||qye;for(;o<qye;)o*=2;const a=o/2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-s,ymax:s},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:n}],size:r}}static fetchResources(e,i,r,s=null){return e&&i&&qFe(e,n=>{qSt(n,i,r),"url"in n&&n.url&&r.push(i.fetchResource(n.url,{signal:s}))}),r}static fetchFonts(e,i,r){if(e&&i){if("symbolLayers"in e&&e.symbolLayers){for(const s of e.symbolLayers)if(s.type==="CIMVectorMarker"&&s.markerGraphics)for(const n of s.markerGraphics)n!=null&&n.symbol&&AU.fetchFonts(n.symbol,i,r)}else if(e.type==="CIMTextSymbol"){const{fontFamilyName:s,fontStyleName:n}=e;if(!s||s.toLowerCase()==="calcitewebcoreicons")return;const{style:o,weight:a}=fFe(n),l=mFe(e),c=new OD({family:s,style:o,weight:a,decoration:l});r.push(i.loadFont(c).catch(()=>{VB().error(`Unsupported font ${s} in CIM symbol`)}))}}}static _getLineSymbolPeriod(e){if(e){const i=this._getEffectsRepeat(e.effects);if(i)return i;if(e.symbolLayers){for(const r of e.symbolLayers)if(r){const s=this._getEffectsRepeat(r.effects);if(s)return s;switch(r.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const n=this._getPlacementRepeat(r.markerPlacement);if(n)return n}}}}}return 0}static _getEffectsRepeat(e){if(e){for(const i of e)if(i)switch(i.type){case"CIMGeometricEffectDashes":{const r=i.dashTemplate;if(r&&r.length){let s=0;for(const n of r)s+=n;return 1&r.length&&(s*=2),s}break}case"CIMGeometricEffectWave":return i.period;default:VB().error(`unsupported geometric effect type ${i.type}`)}}return 0}static _getPlacementRepeat(e){if(e)switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const i=e.placementTemplate;if(i&&i.length){let r=0;for(const s of i)r+=+s;return 1&i.length&&(r*=2),r}break}}return 0}static fromCIMInsidePolygon(e){const i=e.markerPlacement,r={...e};r.markerPlacement=null,r.anchorPoint=null;const s=Math.abs(i.stepX),n=Math.abs(i.stepY),o=(i.randomness??100)/100;let a,l,c,u;if(i.gridType==="Random"){const d=Uo(BTt),f=Math.max(Math.floor(d/s),1),m=Math.max(Math.floor(d/n),1);a=f*s/2,l=m*n/2,c=2*l;const g=new JT(i.seed),y=o*s/1.5,v=o*n/1.5;u=[];for(let b=0;b<f;b++)for(let w=0;w<m;w++){const x=b*s-a+y*(.5-g.getFloat()),S=w*n-l+v*(.5-g.getFloat());u.push({x,y:S}),b===0&&u.push({x:x+2*a,y:S}),w===0&&u.push({x,y:S+2*l})}}else i.shiftOddRows===!0?(a=s/2,l=n,c=2*n,u=[{x:-a,y:0},{x:a,y:0},{x:0,y:l},{x:0,y:-l}]):(a=s/2,l=n/2,c=n,u=[{x:-s,y:0},{x:0,y:-n},{x:-s,y:-n},{x:0,y:0},{x:s,y:0},{x:0,y:n},{x:s,y:n},{x:-s,y:n},{x:s,y:-n}]);return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-l,ymax:l},markerGraphics:u.map(d=>({type:"CIMMarkerGraphic",geometry:d,symbol:{type:"CIMPointSymbol",symbolLayers:[r]}})),size:c}}};function qFe(t,e){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const i=t.symbolLayers;if(!i)return;for(const r of i)if(e(r),r.type==="CIMVectorMarker"){const s=r.markerGraphics;if(!s)continue;for(const n of s)if(n){const o=n.symbol;o&&qFe(o,e)}}break}}}const WFe=t=>{if(!t)return Wd.Butt;switch(t){case"butt":return Wd.Butt;case"square":return Wd.Square;case"round":return Wd.Round}},ZFe=t=>{if(!t)return Ig.Miter;switch(t){case"miter":return Ig.Miter;case"round":return Ig.Round;case"bevel":return Ig.Bevel}},VSt=t=>{if(t==null)return"Center";switch(t){case"left":return"Left";case"right":return"Right";case"center":return"Center"}},zSt=t=>{if(t==null)return"Center";switch(t){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},th=t=>{if(!t)return[0,0,0,0];const{r:e,g:i,b:r,a:s}=t;return[e,i,r,255*s]},BSt=(t,e)=>{const i=jSt(e),r=GSt(t);return i&&r?`${i}-${r}`:`${i}${r}`},jSt=t=>{if(!t)return"";switch(t.toLowerCase()){case"bold":case"bolder":return"bold"}return""},GSt=t=>{if(!t)return"";switch(t.toLowerCase()){case"italic":case"oblique":return"italic"}return""},fK=(t,e)=>{const i=le("safari")?.001:0,r=e==="butt";switch(t){case"dash":case"esriSLSDash":return r?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return r?[4,3,1,3]:[3,4,i,4];case"dot":case"esriSLSDot":return r?[1,3]:[i,4];case"long-dash":case"esriSLSLongDash":return r?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return r?[8,3,1,3]:[7,4,i,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return r?[8,3,1,3,1,3]:[7,4,i,4,i,4];case"short-dash":case"esriSLSShortDash":return r?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return r?[4,1,1,1]:[3,2,i,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return r?[4,1,1,1,1,1]:[3,2,i,2,i,2];case"short-dot":case"esriSLSShortDot":return r?[1,1]:[i,2];case"solid":case"esriSLSSolid":case"none":return VB().error("Unexpected: style does not require rasterization"),[0,0];default:return VB().error(`Tried to rasterize SLS, but found an unexpected style: ${t}!`),[0,0]}},lR=(t,e=100)=>{const i=e/2;let r,s;const n=t;if(n==="circle"||n==="esriSMSCircle"){let a=Math.acos(1-.25/i),l=Math.ceil(HFe/a/4);l===0&&(l=1),a=kSt/l,l*=4;const c=[];c.push([i,0]);for(let u=1;u<l;u++)c.push([i*Math.cos(u*a),-i*Math.sin(u*a)]);c.push([i,0]),r={rings:[c]},s={xmin:-i,ymin:-i,xmax:i,ymax:i}}else if(n==="cross"||n==="esriSMSCross")r={paths:[[[0,i],[0,-i]],[[i,0],[-i,0]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if(n==="diamond"||n==="esriSMSDiamond")r={rings:[[[-i,0],[0,i],[i,0],[0,-i],[-i,0]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if(n==="square"||n==="esriSMSSquare")r={rings:[[[-i,-i],[-i,i],[i,i],[i,-i],[-i,-i]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if(n==="x"||n==="esriSMSX")r={paths:[[[i,i],[-i,-i]],[[i,-i],[-i,i]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if(n==="triangle"||n==="esriSMSTriangle"){const o=e*.5773502691896257,a=-o,l=2/3*e,c=l-e;r={rings:[[[a,c],[0,l],[o,c],[a,c]]]},s={xmin:a,ymin:c,xmax:o,ymax:l}}else n==="arrow"&&(r={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i});return[s,r]},HSt=t=>t==="vertical"||t==="horizontal"||t==="cross"||t==="esriSFSCross"||t==="esriSFSVertical"||t==="esriSFSHorizontal";function qSt(t,e,i){if(!(!t.effects||e.geometryEngine!=null)){if(e.geometryEnginePromise)return void i.push(e.geometryEnginePromise);tTt(t.effects)&&(e.geometryEnginePromise=iTt(),i.push(e.geometryEnginePromise),e.geometryEnginePromise.then(r=>e.geometryEngine=r))}}function Wye(t){if(!t)return null;let e=null;const{cap:i,color:r,join:s,miterLimit:n,style:o,width:a}=t;return o!=="solid"&&o!=="none"&&o!=="esriSLSSolid"&&o!=="esriSLSNull"&&(e=[{type:"CIMGeometricEffectDashes",dashTemplate:fK(o,i),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),{type:"CIMSolidStroke",color:o!=="esriSLSNull"&&o!=="none"?th(r):[0,0,0,0],capStyle:WFe(i),joinStyle:ZFe(s),miterLimit:n,width:a,effects:e}}function YFe(t,e,i,r,s){if(t==null)return null;const n=t.referencesGeometry()&&s?WSt(e,r,s):e,o=t.repurposeFeature(n);try{return t.evaluate({...i,$feature:o},t.services)}catch(a){return se.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const h9=new Map;function WSt(t,e,i){const{transform:r,hasZ:s,hasM:n}=i;h9.has(e)||h9.set(e,ZSt(e));const o=h9.get(e)(t.geometry,r,s,n);return{...t,geometry:o}}function ZSt(t){const e={};switch(t){case"esriGeometryPoint":return(i,r,s,n)=>RDe(r,e,i,s,n);case"esriGeometryPolygon":return(i,r,s,n)=>$De(r,e,i,s,n);case"esriGeometryPolyline":return(i,r,s,n)=>IDe(r,e,i,s,n);case"esriGeometryMultipoint":return(i,r,s,n)=>ODe(r,e,i,s,n);default:return se.getLogger("esri.views.2d.support.arcadeOnDemand").error(new G("mapview-arcade",`Unable to handle geometryType: ${t}`)),i=>i}}const YSt=t=>{if(!t)return[0,0,0,0];const{r:e,g:i,b:r,a:s}=t;return[e,i,r,255*s]};let EM=class mn{static findApplicableOverrides(e,i,r){if(e&&i){if(e.primitiveName){let s=!1;for(const n of r)if(n.primitiveName===e.primitiveName){s=!0;break}if(!s)for(const n of i)n.primitiveName===e.primitiveName&&r.push(n)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const s of e.effects)mn.findApplicableOverrides(s,i,r);if(e.symbolLayers)for(const s of e.symbolLayers)mn.findApplicableOverrides(s,i,r);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const s of e.effects)mn.findApplicableOverrides(s,i,r);if(e.markerPlacement&&mn.findApplicableOverrides(e.markerPlacement,i,r),e.type==="CIMVectorMarker"){if(e.markerGraphics)for(const s of e.markerGraphics)mn.findApplicableOverrides(s,i,r),mn.findApplicableOverrides(s.symbol,i,r)}else e.type==="CIMCharacterMarker"?mn.findApplicableOverrides(e.symbol,i,r):e.type==="CIMHatchFill"?mn.findApplicableOverrides(e.lineSymbol,i,r):e.type==="CIMPictureMarker"&&mn.findApplicableOverrides(e.animatedSymbolProperties,i,r)}}}static findEffectOverrides(e,i){if(!e)return null;if(e.type==="CIMGeometricEffectDashes"&&gFe(e),!i||!e.primitiveName)return{type:"cim-effect-param",effect:e,overrides:[]};const r=Fye(e),s=e.primitiveName,n=[];for(const o of i)o.primitiveName===s&&n.push(Fye(o));return{type:"cim-effect-param",effect:r,overrides:lTt(n)}}static async resolveSymbolOverrides(e,i,r,s,n,o,a){if(!(e!=null&&e.symbol))return null;let{symbol:l,primitiveOverrides:c}=e;const u=!!c;if(!u&&!s)return l;l=ie(l),c=ie(c);let d=!0;if(i||(i={attributes:{}},d=!1),u){if(d||(c=c.filter(f=>{var m;return!((m=f.valueExpressionInfo)!=null&&m.expression.includes("$feature"))})),a||(c=c.filter(f=>{var m;return!((m=f.valueExpressionInfo)!=null&&m.expression.includes("$view"))})),c.length>0){const f={spatialReference:r,fields:aTt(i.attributes),geometryType:n};await mn.createRenderExpressions(c,f),mn.evaluateOverrides(c,i,n??"esriGeometryPoint",o,a)}mn.applyOverrides(l,c)}return s&&mn.applyDictionaryTextOverrides(l,i,s,null),l}static async createRenderExpressions(e,i){const r=[];for(const s of e){const n=s.valueExpressionInfo;if(!n||mn._expressionToRenderExpression.has(n.expression))continue;const o=QPe(n.expression,i.spatialReference,i.fields);r.push(o),o.then(a=>mn._expressionToRenderExpression.set(n.expression,a))}r.length>0&&await Promise.all(r)}static evaluateOverrides(e,i,r,s,n){const o={$view:{scale:n==null?void 0:n.scale}};for(const a of e){a.value&&typeof a.value=="object"&&yRe(a.value)&&(a.propertyName==="Color"||a.propertyName==="StrokeColor")&&(a.value=YSt(a.value));const l=a.valueExpressionInfo;if(!l)continue;const c=mn._expressionToRenderExpression.get(l.expression);c&&(a.value=YFe(c,i,o,r,s))}}static applyDictionaryTextOverrides(e,i,r,s,n="Normal"){if(e!=null&&e.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const o=e.symbolLayers;if(!o)return;for(const a of o)a&&a.type==="CIMVectorMarker"&&mn.applyDictionaryTextOverrides(a,i,r,s,e.type==="CIMTextSymbol"?e.textCase:n)}break;case"CIMVectorMarker":{const o=e.markerGraphics;if(!o)return;for(const a of o)a&&mn.applyDictionaryTextOverrides(a,i,r,s)}break;case"CIMMarkerGraphic":{const o=e.textString;if(o&&o.includes("[")){const a=Zxt(o,r);e.textString=Yxt(i,a,s,n)}}}}static applyOverrides(e,i,r,s){if(e.primitiveName){for(const n of i)if(n.primitiveName===e.primitiveName){const o=Voe(n.propertyName);if(s&&s.push({cim:e,nocapPropertyName:o,value:e[o]}),r){let a=!1;for(const l of r)l.primitiveName===e.primitiveName&&(a=!0);a||r.push(n)}n.value!=null&&(e[o]=n.value)}}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const n of e.effects)mn.applyOverrides(n,i,r,s);if(e.symbolLayers)for(const n of e.symbolLayers)mn.applyOverrides(n,i,r,s);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const n of e.effects)mn.applyOverrides(n,i,r,s);if(e.type==="CIMVectorMarker"&&e.markerGraphics)for(const n of e.markerGraphics)mn.applyOverrides(n,i,r,s),mn.applyOverrides(n.symbol,i,r,s)}}static restoreOverrides(e){for(const i of e)i.cim[i.nocapPropertyName]=i.value}static buildOverrideKey(e){let i="";for(const r of e)r.value!==void 0&&(i+=`${r.primitiveName}${r.propertyName}${JSON.stringify(r.value)}`);return i}static toValue(e,i){if(e==="DashTemplate")return i.split(" ").map(r=>Number(r));if(e==="Color"){const r=new Qe(i).toRgba();return r[3]*=255,r}return i}};EM._expressionToRenderExpression=new Map;function Goe(t,e,i,r){if(t)if(t.type!=="CIMTextSymbol"){if(t.effects)for(const s of t.effects)QSt(s,e);if(t.symbolLayers)for(const s of t.symbolLayers)switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":XSt(s,e,r);break;case"CIMPictureStroke":case"CIMSolidStroke":!(r!=null&&r.preserveOutlineWidth)&&s.width&&(s.width*=e);break;case"CIMPictureFill":s.height&&(s.height*=e),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e);break;case"CIMHatchFill":Goe(s.lineSymbol,e,!0,{...r,preserveOutlineWidth:!1}),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e),s.separation&&(s.separation*=e)}}else t.height!=null&&(t.height*=e)}function XSt(t,e,i){if(t&&(t.markerPlacement&&JSt(t.markerPlacement,e),t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.anchorPoint&&t.anchorPointUnits==="Absolute"&&(t.anchorPoint={x:t.anchorPoint.x*e,y:t.anchorPoint.y*e}),t.size=t.size!=null?t.size*e:0,t.type==="CIMVectorMarker"&&t.markerGraphics))for(const r of t.markerGraphics)t.scaleSymbolsProportionally||Goe(r.symbol,e,!0,i)}function JSt(t,e){switch(pFe(t)&&t.offset&&(t.offset*=e),t.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.placementTemplate&&t.placementTemplate.length){const i=t.placementTemplate.map(r=>r*e);t.placementTemplate=i}break;case"CIMMarkerPlacementAlongLineVariableSize":if(t.maxRandomOffset&&(t.maxRandomOffset*=e),t.placementTemplate&&t.placementTemplate.length){const i=t.placementTemplate.map(r=>r*e);t.placementTemplate=i}break;case"CIMMarkerPlacementOnLine":t.startPointOffset&&(t.startPointOffset*=e);break;case"CIMMarkerPlacementAtExtremities":t.offsetAlongLine&&(t.offsetAlongLine*=e);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":t.beginPosition&&(t.beginPosition*=e),t.endPosition&&(t.endPosition*=e);break;case"CIMMarkerPlacementPolygonCenter":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMMarkerPlacementInsidePolygon":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.stepX&&(t.stepX*=e),t.stepY&&(t.stepY*=e)}}function QSt(t,e){switch(t.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":t.width&&(t.width*=e);break;case"CIMGeometricEffectBuffer":t.size&&(t.size*=e);break;case"CIMGeometricEffectCut":t.beginCut&&(t.beginCut*=e),t.endCut&&(t.endCut*=e),t.middleCut&&(t.middleCut*=e);break;case"CIMGeometricEffectDashes":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.dashTemplate&&t.dashTemplate.length){const i=t.dashTemplate.map(r=>r*e);t.dashTemplate=i}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":t.length&&(t.length*=e);break;case"CIMGeometricEffectMove":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":t.offset&&(t.offset*=e);break;case"CIMGeometricEffectRegularPolygon":t.radius&&(t.radius*=e);break;case"CIMGeometricEffectTaperedPolygon":t.fromWidth&&(t.fromWidth*=e),t.length&&(t.length*=e),t.toWidth&&(t.toWidth*=e);break;case"CIMGeometricEffectWave":t.amplitude&&(t.amplitude*=e),t.period&&(t.period*=e)}}function KSt(t){const e=[];return mK(Qxt(t),e),e.length?new Qe(Jxt(e[0])):null}function mK(t,e){var s;if(!t)return;let i;i=t.type==="CIMTextSymbol"?t.symbol:t;const r=t.type==="CIMPolygonSymbol";if(i!=null&&i.symbolLayers){for(const n of i.symbolLayers)if(!(n.colorLocked||r&&(eTt(n)||Kxt(n)&&n.markerPlacement&&pFe(n.markerPlacement))))switch(n.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":n.tintColor&&Zye(e,n.tintColor);break;case"CIMVectorMarker":(s=n.markerGraphics)==null||s.forEach(o=>{mK(o.symbol,e)});break;case"CIMSolidStroke":case"CIMSolidFill":Zye(e,n.color);break;case"CIMHatchFill":mK(n.lineSymbol,e)}}}function Zye(t,e){for(const i of t)if(i.join(".")===e.join("."))return;t.push(e)}var Yye,Xye,XFe={exports:{}};Xye=function(){function t(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function e(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function i(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function r(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:Cy},u=Cy,d="none",f=")",m=",",g="(",y="%",v="px",b="cm",w="mm",x="in",S="pt",C="pc",M="deg",O="rad",D="grad",U="turn",k="#",H=".",V="e",X=/^[ \t\n\r]/,q=/^[a-z\-]/,Z=/^[0-9a-fA-F]/,ye=/^[+\-]/,L=/^[0-9]/,N=ic("none"),z=go("none",!1),W=go(")",!1),J=go(",",!1),K=ic("whitespace"),ne=lw([" ","	",`
`,"\r"],!1,!1),we=ic("function"),Ie=go("(",!1),je=ic("identifier"),ut=lw([["a","z"],"-"],!1,!1),ot=ic("percentage"),at=go("%",!1),tt=ic("length"),rt=go("px",!1),li=go("cm",!1),Y=go("mm",!1),ee=go("in",!1),re=go("pt",!1),Ae=go("pc",!1),ae=ic("angle"),fe=go("deg",!1),Me=go("rad",!1),Oe=go("grad",!1),be=go("turn",!1),xe=ic("number"),_e=ic("color"),Le=go("#",!1),Fe=lw([["0","9"],["a","f"],["A","F"]],!1,!1),lt=lw(["+","-"],!1,!1),ct=lw([["0","9"]],!1,!1),Vt=go(".",!1),Ct=go("e",!1),Zt=function(){return[]},Xt=function(Q,$e){return{type:"function",name:Q,parameters:$e||[]}},vi=function(Q,$e){return $e.length>0?_O(Q,$e,3):[Q]},xi=function(Q){return{type:"quantity",value:Q.value,unit:Q.unit}},Di=function(Q){return{type:"color",colorType:Q.type,value:Q.value}},Nt=function(Q){return Q},jt=function(){return jc()},ei=function(Q){return{value:Q,unit:"%"}},dr=function(Q){return{value:Q,unit:"px"}},pn=function(Q){return{value:Q,unit:"cm"}},Si=function(Q){return{value:Q,unit:"mm"}},Qr=function(Q){return{value:Q,unit:"in"}},zs=function(Q){return{value:Q,unit:"pt"}},Vo=function(Q){return{value:Q,unit:"pc"}},vl=function(Q){return{value:Q,unit:"deg"}},bl=function(Q){return{value:Q,unit:"rad"}},zo=function(Q){return{value:Q,unit:"grad"}},Sn=function(Q){return{value:Q,unit:"turn"}},Bs=function(Q){return{value:Q,unit:null}},Pi=function(){return{type:"hex",value:jc()}},as=function(Q){return{type:"function",value:Q}},$n=function(){return{type:"named",value:jc()}},fo=function(){return parseFloat(jc())},me=0,nr=0,pp=[{line:1,column:1}],mo=0,fp=[],Et=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');u=c[n.startRule]}function jc(){return s.substring(nr,me)}function go(Q,$e){return{type:"literal",text:Q,ignoreCase:$e}}function lw(Q,$e,He){return{type:"class",parts:Q,inverted:$e,ignoreCase:He}}function cw(){return{type:"end"}}function ic(Q){return{type:"other",description:Q}}function Ey(Q){var $e,He=pp[Q];if(He)return He;for($e=Q-1;!pp[$e];)$e--;for(He={line:(He=pp[$e]).line,column:He.column};$e<Q;)s.charCodeAt($e)===10?(He.line++,He.column=1):He.column++,$e++;return pp[Q]=He,He}function uw(Q,$e,He){var Oi=Ey(Q),En=Ey($e);return{source:l,start:{offset:Q,line:Oi.line,column:Oi.column},end:{offset:$e,line:En.line,column:En.column}}}function pi(Q){me<mo||(me>mo&&(mo=me,fp=[]),fp.push(Q))}function F_(Q,$e,He){return new e(e.buildMessage(Q,$e),Q,$e,He)}function Cy(){var Q;return(Q=k_())===a&&(Q=wl()),Q}function k_(){var Q,$e;return Et++,Q=me,Ps(),s.substr(me,4)===d?($e=d,me+=4):($e=a,Et===0&&pi(z)),$e!==a?(Ps(),nr=Q,Q=Zt()):(me=Q,Q=a),Et--,Q===a&&Et===0&&pi(N),Q}function wl(){var Q,$e;if(Q=[],($e=Gc())!==a)for(;$e!==a;)Q.push($e),$e=Gc();else Q=a;return Q}function Gc(){var Q,$e,He,Oi;return Q=me,Ps(),($e=U_())!==a?(Ps(),(He=nm())===a&&(He=null),Ps(),s.charCodeAt(me)===41?(Oi=f,me++):(Oi=a,Et===0&&pi(W)),Oi!==a?(Ps(),nr=Q,Q=Xt($e,He)):(me=Q,Q=a)):(me=Q,Q=a),Q}function nm(){var Q,$e,He,Oi,En,js,xl,fw;if(Q=me,($e=yo())!==a){for(He=[],Oi=me,En=Ps(),s.charCodeAt(me)===44?(js=m,me++):(js=a,Et===0&&pi(J)),js===a&&(js=null),xl=Ps(),(fw=yo())!==a?Oi=En=[En,js,xl,fw]:(me=Oi,Oi=a);Oi!==a;)He.push(Oi),Oi=me,En=Ps(),s.charCodeAt(me)===44?(js=m,me++):(js=a,Et===0&&pi(J)),js===a&&(js=null),xl=Ps(),(fw=yo())!==a?Oi=En=[En,js,xl,fw]:(me=Oi,Oi=a);nr=Q,Q=vi($e,He)}else me=Q,Q=a;return Q}function yo(){var Q,$e;return Q=me,($e=dw())===a&&($e=F2())===a&&($e=pw())===a&&($e=V_()),$e!==a&&(nr=Q,$e=xi($e)),(Q=$e)===a&&(Q=me,($e=yN())!==a&&(nr=Q,$e=Di($e)),Q=$e),Q}function Ps(){var Q,$e;for(Et++,Q=[],X.test(s.charAt(me))?($e=s.charAt(me),me++):($e=a,Et===0&&pi(ne));$e!==a;)Q.push($e),X.test(s.charAt(me))?($e=s.charAt(me),me++):($e=a,Et===0&&pi(ne));return Et--,$e=a,Et===0&&pi(K),Q}function U_(){var Q,$e,He;return Et++,Q=me,($e=hw())!==a?(s.charCodeAt(me)===40?(He=g,me++):(He=a,Et===0&&pi(Ie)),He!==a?(nr=Q,Q=Nt($e)):(me=Q,Q=a)):(me=Q,Q=a),Et--,Q===a&&($e=a,Et===0&&pi(we)),Q}function hw(){var Q,$e,He;if(Et++,Q=me,$e=[],q.test(s.charAt(me))?(He=s.charAt(me),me++):(He=a,Et===0&&pi(ut)),He!==a)for(;He!==a;)$e.push(He),q.test(s.charAt(me))?(He=s.charAt(me),me++):(He=a,Et===0&&pi(ut));else $e=a;return $e!==a&&(nr=Q,$e=jt()),Et--,(Q=$e)===a&&($e=a,Et===0&&pi(je)),Q}function dw(){var Q,$e,He;return Et++,Q=me,Ps(),($e=rc())!==a?(s.charCodeAt(me)===37?(He=y,me++):(He=a,Et===0&&pi(at)),He!==a?(nr=Q,Q=ei($e)):(me=Q,Q=a)):(me=Q,Q=a),Et--,Q===a&&Et===0&&pi(ot),Q}function F2(){var Q,$e,He;return Et++,Q=me,Ps(),($e=rc())!==a?(s.substr(me,2)===v?(He=v,me+=2):(He=a,Et===0&&pi(rt)),He!==a?(nr=Q,Q=dr($e)):(me=Q,Q=a)):(me=Q,Q=a),Q===a&&(Q=me,Ps(),($e=rc())!==a?(s.substr(me,2)===b?(He=b,me+=2):(He=a,Et===0&&pi(li)),He!==a?(nr=Q,Q=pn($e)):(me=Q,Q=a)):(me=Q,Q=a),Q===a&&(Q=me,Ps(),($e=rc())!==a?(s.substr(me,2)===w?(He=w,me+=2):(He=a,Et===0&&pi(Y)),He!==a?(nr=Q,Q=Si($e)):(me=Q,Q=a)):(me=Q,Q=a),Q===a&&(Q=me,Ps(),($e=rc())!==a?(s.substr(me,2)===x?(He=x,me+=2):(He=a,Et===0&&pi(ee)),He!==a?(nr=Q,Q=Qr($e)):(me=Q,Q=a)):(me=Q,Q=a),Q===a&&(Q=me,Ps(),($e=rc())!==a?(s.substr(me,2)===S?(He=S,me+=2):(He=a,Et===0&&pi(re)),He!==a?(nr=Q,Q=zs($e)):(me=Q,Q=a)):(me=Q,Q=a),Q===a&&(Q=me,Ps(),($e=rc())!==a?(s.substr(me,2)===C?(He=C,me+=2):(He=a,Et===0&&pi(Ae)),He!==a?(nr=Q,Q=Vo($e)):(me=Q,Q=a)):(me=Q,Q=a)))))),Et--,Q===a&&Et===0&&pi(tt),Q}function pw(){var Q,$e,He;return Et++,Q=me,($e=rc())!==a?(s.substr(me,3)===M?(He=M,me+=3):(He=a,Et===0&&pi(fe)),He!==a?(nr=Q,Q=vl($e)):(me=Q,Q=a)):(me=Q,Q=a),Q===a&&(Q=me,($e=rc())!==a?(s.substr(me,3)===O?(He=O,me+=3):(He=a,Et===0&&pi(Me)),He!==a?(nr=Q,Q=bl($e)):(me=Q,Q=a)):(me=Q,Q=a),Q===a&&(Q=me,($e=rc())!==a?(s.substr(me,4)===D?(He=D,me+=4):(He=a,Et===0&&pi(Oe)),He!==a?(nr=Q,Q=zo($e)):(me=Q,Q=a)):(me=Q,Q=a),Q===a&&(Q=me,($e=rc())!==a?(s.substr(me,4)===U?(He=U,me+=4):(He=a,Et===0&&pi(be)),He!==a?(nr=Q,Q=Sn($e)):(me=Q,Q=a)):(me=Q,Q=a)))),Et--,Q===a&&($e=a,Et===0&&pi(ae)),Q}function V_(){var Q,$e;return Et++,Q=me,Ps(),($e=rc())!==a?(nr=Q,Q=Bs($e)):(me=Q,Q=a),Et--,Q===a&&Et===0&&pi(xe),Q}function yN(){var Q,$e,He,Oi;if(Et++,Q=me,s.charCodeAt(me)===35?($e=k,me++):($e=a,Et===0&&pi(Le)),$e!==a){if(He=[],Z.test(s.charAt(me))?(Oi=s.charAt(me),me++):(Oi=a,Et===0&&pi(Fe)),Oi!==a)for(;Oi!==a;)He.push(Oi),Z.test(s.charAt(me))?(Oi=s.charAt(me),me++):(Oi=a,Et===0&&pi(Fe));else He=a;He!==a?(nr=Q,Q=Pi()):(me=Q,Q=a)}else me=Q,Q=a;return Q===a&&(Q=me,($e=Gc())!==a&&(nr=Q,$e=as($e)),(Q=$e)===a&&(Q=me,($e=hw())!==a&&(nr=Q,$e=$n()),Q=$e)),Et--,Q===a&&($e=a,Et===0&&pi(_e)),Q}function rc(){var Q,$e,He,Oi,En,js,xl;for(Q=me,ye.test(s.charAt(me))?(s.charAt(me),me++):Et===0&&pi(lt),$e=me,He=[],L.test(s.charAt(me))?(Oi=s.charAt(me),me++):(Oi=a,Et===0&&pi(ct));Oi!==a;)He.push(Oi),L.test(s.charAt(me))?(Oi=s.charAt(me),me++):(Oi=a,Et===0&&pi(ct));if(s.charCodeAt(me)===46?(Oi=H,me++):(Oi=a,Et===0&&pi(Vt)),Oi!==a){if(En=[],L.test(s.charAt(me))?(js=s.charAt(me),me++):(js=a,Et===0&&pi(ct)),js!==a)for(;js!==a;)En.push(js),L.test(s.charAt(me))?(js=s.charAt(me),me++):(js=a,Et===0&&pi(ct));else En=a;En!==a?$e=He=[He,Oi,En]:(me=$e,$e=a)}else me=$e,$e=a;if($e===a)if($e=[],L.test(s.charAt(me))?(He=s.charAt(me),me++):(He=a,Et===0&&pi(ct)),He!==a)for(;He!==a;)$e.push(He),L.test(s.charAt(me))?(He=s.charAt(me),me++):(He=a,Et===0&&pi(ct));else $e=a;if($e!==a){if(He=me,s.charCodeAt(me)===101?(Oi=V,me++):(Oi=a,Et===0&&pi(Ct)),Oi!==a){if(ye.test(s.charAt(me))?(En=s.charAt(me),me++):(En=a,Et===0&&pi(lt)),En===a&&(En=null),js=[],L.test(s.charAt(me))?(xl=s.charAt(me),me++):(xl=a,Et===0&&pi(ct)),xl!==a)for(;xl!==a;)js.push(xl),L.test(s.charAt(me))?(xl=s.charAt(me),me++):(xl=a,Et===0&&pi(ct));else js=a;js!==a?He=Oi=[Oi,En,js]:(me=He,He=a)}else me=He,He=a;He===a&&(He=null),nr=Q,Q=fo()}else me=Q,Q=a;return Q}function yO(Q,$e){return Q.map(function(He){return He[$e]})}function _O(Q,$e,He){return[Q].concat(yO($e,He))}if((o=u())!==a&&me===s.length)return o;throw o!==a&&me<s.length&&pi(cw()),F_(fp,mo<s.length?s.charAt(mo):null,mo<s.length?uw(mo,mo+1):uw(mo,mo))}return t(e,Error),e.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(l):l,u=this.location.source+":"+c.line+":"+c.column;if(a){var d=this.location.end,f=i("",c.line.toString().length," "),m=a[l.line-1],g=(l.line===d.line?d.column:m.length+1)-l.column||1;n+=`
 --> `+u+`
`+f+` |
`+c.line+" | "+m+`
`+f+" | "+i("",l.column-1," ")+i("",g,"^")}else n+=`
 at `+u}return n},e.buildMessage=function(s,n){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var g=m.parts.map(function(y){return Array.isArray(y)?c(y[0])+"-"+c(y[1]):c(y)});return"["+(m.inverted?"^":"")+g.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function u(m){return o[m.type](m)}function d(m){var g,y,v=m.map(u);if(v.sort(),v.length>0){for(g=1,y=1;g<v.length;g++)v[g-1]!==v[g]&&(v[y]=v[g],y++);v.length=y}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+d(s)+" but "+f(n)+" found."},{SyntaxError:e,parse:r}},(Yye=XFe).exports&&(Yye.exports=Xye());var e2t=XFe.exports;function JFe(t){if(!t||t.length===0)return null;if(typeof t=="string"){const i=Jye(t);return i&&i.length!==0?i:null}const e=t.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new G("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:Jye(i.value)}});e.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<e.length-1;i++){if(!WYe(e[i].effects,e[i+1].effects))throw new G("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[i].effects,b:e[i+1].effects});ZYe(e[i].effects,e[i+1].effects)}return e.sort((i,r)=>r.scale-i.scale),e}function Jye(t){let e;if(!t)return[];try{e=e2t.parse(t)}catch(i){throw new G("effect:invalid-syntax","Invalid effect syntax",{value:t,error:i})}return e.map(i=>t2t(i))}function t2t(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return i2t(t);case"opacity":return r2t(t);case"hue-rotate":return s2t(t);case"blur":return n2t(t);case"drop-shadow":return o2t(t);case"bloom":return a2t(t)}}catch(e){throw e.details.filter=t,e}throw new G("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function i2t(t){let e=1;return dO(t.parameters,1),t.parameters.length===1&&(e=uf(t.parameters[0])),new wZ(t.name,e)}function r2t(t){let e=1;return dO(t.parameters,1),t.parameters.length===1&&(e=uf(t.parameters[0])),new ZEe(e)}function s2t(t){let e=0;return dO(t.parameters,1),t.parameters.length===1&&(e=p2t(t.parameters[0])),new qEe(e)}function n2t(t){let e=0;return dO(t.parameters,1),t.parameters.length===1&&(e=Woe(t.parameters[0]),lN(e,t.parameters[0])),new zEe(e)}function o2t(t){const e=[];let i=null;for(const r of t.parameters)if(r.type==="color"){if(e.length&&Object.freeze(e),i)throw new G("effect:type-error","Accepts only one color",{});i=f2t(r)}else{const s=Woe(r);if(Object.isFrozen(e))throw new G("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(s),e.length===3&&lN(s,r)}if(e.length<2||e.length>3)throw new G("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new GEe(e[0],e[1],e[2]||0,i||QFe("black"))}function a2t(t){let e=1,i=0,r=0;return dO(t.parameters,3),t.parameters[0]&&(e=uf(t.parameters[0])),t.parameters[1]&&(i=Woe(t.parameters[1]),lN(i,t.parameters[1])),t.parameters[2]&&(r=uf(t.parameters[2])),new UEe(e,i,r)}function dO(t,e){if(t.length>e)throw new G("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function B6(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in qoe)return"<length>";if(t.unit in Hoe)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function lN(t,e){if(t<0)throw new G("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function l2t(t){if(t.type!=="quantity"||t.unit!==null)throw new G("effect:type-error",`Expected <double>, Actual: ${B6(t)}`,{term:t})}function c2t(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new G("effect:type-error",`Expected <double> or <percentage>, Actual: ${B6(t)}`,{term:t})}const Hoe={deg:1,grad:.9,rad:180/Math.PI,turn:360};function u2t(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Hoe[t.unit]!=null))throw new G("effect:type-error",`Expected <angle>, Actual: ${B6(t)}`,{term:t})}const qoe={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function h2t(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&qoe[t.unit]!=null))throw new G("effect:type-error",`Expected <length>, Actual: ${B6(t)}`,{term:t})}function uf(t){c2t(t);const e=t.value;return lN(e,t),t.unit==="%"?.01*e:e}function d2t(t){return l2t(t),lN(t.value,t),t.value}function p2t(t){return u2t(t),t.value*Hoe[t.unit]||0}function Woe(t){return h2t(t),t.value*qoe[t.unit]||0}function f2t(t){switch(t.colorType){case"hex":return zZe(t.value);case"named":return QFe(t.value);case"function":return y2t(t.value)}}function QFe(t){if(!uEe(t))throw new G("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return VZe(t)}const m2t=/^rgba?/i,g2t=/^hsla?/i;function y2t(t){if(dO(t.parameters,4),m2t.test(t.name))return[uf(t.parameters[0]),uf(t.parameters[1]),uf(t.parameters[2]),t.parameters[3]?uf(t.parameters[3]):1];if(g2t.test(t.name))return hEe(d2t(t.parameters[0]),uf(t.parameters[1]),uf(t.parameters[2]),t.parameters[3]?uf(t.parameters[3]):1);throw new G("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function FL(t,e,i){var r;try{return v2t(t)}catch(s){(r=i==null?void 0:i.messages)==null||r.push(s)}return null}function kL(t,e,i,r){try{const s=_2t(t);ia(i,s,e)}catch(s){r.messages&&r.messages.push(s)}}function _2t(t){const e=JFe(t);return e?YYe(e)?e.map(i=>i.toJSON()):e.map(({scale:i,effects:r})=>({scale:i,value:r.map(s=>s.toJSON())})):null}function v2t(t){if(!t||t.length===0)return null;if(b2t(t)){const e=[];for(const i of t)e.push({scale:i.scale,value:Qye(i.value)});return e}return Qye(t)}function b2t(t){const e=t[0];return!!e&&"scale"in e}function Qye(t){if(!(t!=null&&t.length))return"";const e=[];for(const i of t){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[ky(i,"amount")];break;case"blur":r=[ky(i,"radius","pt")];break;case"hue-rotate":r=[ky(i,"angle","deg")];break;case"drop-shadow":r=[ky(i,"xoffset","pt"),ky(i,"yoffset","pt"),ky(i,"blurRadius","pt"),w2t(i,"color")];break;case"bloom":r=[ky(i,"strength"),ky(i,"radius","pt"),ky(i,"threshold")]}const s=`${i.type}(${r.filter(Boolean).join(" ")})`;JFe(s),e.push(s)}return e.join(" ")}function ky(t,e,i){if(t[e]==null)throw new G("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return i?t[e]+i:""+t[e]}function w2t(t,e){if(t[e]==null)throw new G("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const i=t[e];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}let KFe=class{constructor(e,i){this._storage=new zNe,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),i&&this._storage.registerRemoveFunc("",i)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,i,r=1){this._storage.put(this,e,i,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}};new KFe(1e3);new Qe([128,128,128]);const x2t=new Qe("white");function Jii(t){if(t==null||!("symbolLayers"in t)||t.symbolLayers==null)return!1;switch(t.type){case"point-3d":return t.symbolLayers.some(e=>e.type==="object");case"line-3d":return t.symbolLayers.some(e=>e.type==="path");case"polygon-3d":return t.symbolLayers.some(e=>e.type==="object"||e.type==="extrude");default:return!1}}function T2t(t){var e;return((e=t.resource)==null?void 0:e.href)??""}function vE(t,e){if(!t)return null;let i=null;return YS(t)?i=S2t(t):zG(t)&&(i=t.type==="cim"?KSt(t):t.color?new Qe(t.color):null),i?UL(i,e):null}function S2t(t){const e=t.symbolLayers;if(!e)return null;let i=null;return e.forEach(r=>{var s;r.type==="object"&&((s=r.resource)!=null&&s.href)||(i=r.type==="water"?r.color:r.material?r.material.color:null)}),i?new Qe(i):null}function UL(t,e){if(e==null||t==null)return t;const i=t.toRgba();return i[3]=i[3]*e,new Qe(i)}function E2t(t,e,i){const r=t.symbolLayers;if(!r)return;const s=n=>UL(e=e??n??(i!=null?x2t:null),i);r.forEach(n=>{var o,a;if(n.type!=="object"||!((o=n.resource)!=null&&o.href)||e)if(n.type==="water")n.color=s(n.color);else{const l=n.material!=null?n.material.color:null,c=s(l);n.material==null?n.material=new Ih({color:c}):n.material.color=c,i!=null&&"outline"in n&&((a=n.outline)==null?void 0:a.color)!=null&&(n.outline.color=UL(n.outline.color,i))}})}function C2t(t,e,i){var r;(e=e??t.color)&&(t.color=UL(e,i)),i!=null&&"outline"in t&&((r=t.outline)!=null&&r.color)&&(t.outline.color=UL(t.outline.color,i))}function d9(t,e,i){t&&(e||i!=null)&&(e&&(e=new Qe(e)),YS(t)?E2t(t,e,i):zG(t)&&C2t(t,e,i))}async function M2t(t,e){const i=t.symbolLayers;i&&await jj(i,async r=>A2t(r,e))}async function A2t(t,e){switch(t.type){case"extrude":O2t(t,e);break;case"icon":case"line":case"text":P2t(t,e);break;case"path":$2t(t,e);break;case"object":await R2t(t,e)}}function P2t(t,e){const i=e4e(e);i!=null&&(t.size=i)}function e4e(t){for(const e of t)if(typeof e=="number")return e;return null}function O2t(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function R2t(t,e){const{resourceSize:i,symbolSize:r}=await I2t(t),s=t4e(e,i,r);t.width=T3(e[0],r[0],i[0],s),t.depth=T3(e[1],r[1],i[1],s),t.height=T3(e[2],r[2],i[2],s)}function $2t(t,e){const i=t4e(e,V0,[t.width,void 0,t.height]);t.width=T3(e[0],t.width,1,i),t.height=T3(e[2],t.height,1,i)}function t4e(t,e,i){for(let r=0;r<3;r++){const s=t[r];switch(s){case"symbol-value":{const n=i[r];return n!=null?n/e[r]:1}case"proportional":break;default:if(s&&e[r])return s/e[r]}}return 1}async function I2t(t){const{computeObjectLayerResourceSize:e}=await ce(()=>import("./symbolLayerUtils-C9_3XGb7.js"),[]),i=await e(t,10),{width:r,height:s,depth:n}=t,o=[r,n,s];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/i[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=i[l]*a);return{resourceSize:i,symbolSize:o}}function T3(t,e,i,r){switch(t){case"proportional":return i*r;case"symbol-value":return e??i;default:return t}}function L2t(t,e){const i=e4e(e);if(i!=null)switch(t.type){case"simple-marker":t.size=i;break;case"picture-marker":{const r=t.width/t.height;r>1?(t.width=i,t.height=i*r):(t.width=i*r,t.height=i);break}case"simple-line":t.width=i;break;case"text":t.font.size=i}}async function D2t(t,e){if(t&&e)return YS(t)?M2t(t,e):void(zG(t)&&L2t(t,e))}function N2t(t,e,i){if(t&&e!=null)if(YS(t)){const r=t.symbolLayers;r&&r.forEach(s=>{if(s&&s.type==="object")switch(i){case"tilt":s.tilt=(s.tilt??0)+e;break;case"roll":s.roll=(s.roll??0)+e;break;default:s.heading=(s.heading??0)+e}})}else zG(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle+=e))}function Qii(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function F2t(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}const Kii=1.2,k2t=Rh,U2t=4;let j6=class{constructor(e,i,r,s){this.graphics3DSymbolLayer=e,this.renderGeometries=i,this.boundingBox=r,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,fs.ADD);if(e||this._addedToStage){for(const i of this.renderGeometries)i.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Hn.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,fs.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=E()){return de(e,0,0,0)}getBoundingBoxObjectSpace(e=Xn()){return Zr(e)}addObjectState(e,i){e===d_.Highlight&&(this.renderGeometries.forEach(r=>{const s=r.geometry.addHighlight();i.addRenderGeometry(r,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Hn.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(i=>{e.removeRenderGeometry(i)})}removeRenderGeometryObjectState(e,i){e.geometry.removeHighlight(i),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Hn.HIGHLIGHT)}computeAttachmentOrigin(e){for(const i of this.renderGeometries)i.geometry.computeAttachmentOrigin(bE)&&(e.draped.origin[0]+=bE[0],e.draped.origin[1]+=bE[1],e.draped.num++)}async getProjectedBoundingBox(e,i,r,s,n){Zr(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,Kye,r),wot(n,Kye)}if(i){let o;Cf(n,bE);const a=Jne(n,i.service.spatialReference,i);try{o=await i.service.queryElevation(bE[0],bE[1],s,a,"ground")}catch{}o!=null&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(e,i,r,s){if(this.boundingBox)UG(vm,this.boundingBox);else{const n=e.boundingSphere,o=n[3];vm[0]=n[0]-o,vm[1]=n[1]-o,vm[2]=n[2]-o,vm[3]=n[0]+o,vm[4]=n[1]+o,vm[5]=n[2]+o}return i(vm,0,2),this.calculateRelativeScreenBounds&&s.push({location:Cf(vm),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),Cse(vm,r)}};const Kye=oi(),vm=Xn(),bE=E();function zB(t,e,i){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=i,t.canvas}function i4e(t){const{size:e}=t.definition,i=t.fontString(e);let r=e0e.get(i);if(!r){const s=zB(z2t,0,0).getContext("2d");t.setFontProperties(s,e);const n=s.measureText(B2t);r=new V2t(n.actualBoundingBoxAscent,n.actualBoundingBoxDescent),e0e.set(i,r)}return r}const e0e=new Map;let V2t=class{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,i){this.maxAscent=e,this.maxDescent=i}};const z2t={canvas:null},B2t=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})(),BB=1;let r4e=class{constructor(e,i,r,s){this.text=e,this._alignment=i,this._parameters=r,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.replaceAll(" "," ").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let i=0;i<this._lines.length-1;i++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=zB(t0e,$4,$4).getContext("2d"),i=this._parameters.definition.pixelRatio,r=this._fontSize*i;this._parameters.setFontProperties(e,r);let s=2*this._haloSize;const n=this._parameters.definition.font;n.style!=="italic"&&n.style!=="oblique"&&n.weight!=="bold"&&n.weight!=="bolder"||(s+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let o=0,a=0,l=0,c=0,u=0;this._lines.forEach((b,w)=>{const x=e.measureText(b),S=x.width/i,C=S+s;this._textWidths.push(S),this._lineWidths.push(C),o=Math.max(o,C),c=Math.max(c,x.actualBoundingBoxAscent/i),u=Math.max(u,x.actualBoundingBoxDescent/i),w===0&&(a=x.actualBoundingBoxAscent/i),w===this._lines.length-1&&(l=x.actualBoundingBoxDescent/i)});const d=i4e(this._parameters),f=Math.max(c,d.maxAscent),m=Math.max(u,d.maxDescent),g=a,y=this._parameters.definition.font.decoration==="underline"?m:l,v=o;this._metricsCached=new G2t(g,y,f,m,v)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*j2t}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,BB)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case lb.Left:return this._horizontalPadding;case lb.Center:return(this.displayWidth-this._lineWidths[e])/2;case lb.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,i,r){e.save();const s=i/=this.renderPixelRatio,n=r/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset+this._metrics.firstLineAscent;i+=o,r+=a;const l=this._haloSize>0;l&&this._renderHalo(e,s,n,o,a),this._parameters.setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const u=this._lines[c],d=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,u,i+d,r),this._renderLineDecoration(e,i+d,r,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,u,i+this._getLineXOffset(c),r),this._renderLineDecoration(e,i+d,r,this._textWidths[c]),r+=this._lineSpacing}if(Nr.TEXT_SHOW_BASELINE){e.strokeStyle=i0e,e.setLineDash([2,2]),e.lineWidth=1;let c=n+a;for(let u=0;u<this._lines.length;++u)this._drawLine(e,[s,c],[s+this.displayWidth,c]),c+=this._lineSpacing}if(Nr.TEXT_SHOW_BORDER&&(e.strokeStyle=i0e,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,s,n,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,i,r,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":r+=2*a;break;case"line-through":r-=.33*this._midLineAscent}const l=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(i+s+l),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,i,r,s){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=Ne(s,0,Math.floor(o/2)),e.beginPath(),e.moveTo(i,r+s),e.arcTo(i,r,i+s,r,s),e.lineTo(i+n-s,r),e.arcTo(i+n,r,i+n,r+s,s),e.lineTo(i+n,r+o-s),e.arcTo(i+n,r+o,i+n-s,r+o,s),e.lineTo(i+s,r+o),e.arcTo(i,r+o,i,r+o-s,s),e.closePath()):e.rect(i,r,n,o)}_renderHalo(e,i,r,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=zB(t0e,Math.max(o,$4),Math.max(a,$4)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._parameters.setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const u=this._renderedHaloSize<3;c.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let d=n;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,s+m,d,this._textWidths[f],!0),d+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(i),this._toRenderUnit(r),o,a),e.globalAlpha=1}_renderHaloEmulated(e,i,r){for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of s4e)this._fillText(e,n,i+o+this._haloSize*a,r+this._haloSize*l);r+=this._lineSpacing}}_renderHaloNative(e,i,r){const s=2*this._haloSize;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let u=0;u<l;u++){const d=1-(l-1)*c+u*c;e.lineWidth=this._toRenderUnit(d*s),this._strokeText(e,o,i+a,r)}r+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,i,r,s){e.fillText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_strokeText(e,i,r,s){e.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_drawLine(e,i,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,i,r){const s=this._toRenderUnit(i[0]),n=this._toRenderUnit(i[1]),o=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,u=Math.floor(n)+.5,d=Math.ceil(n+a)-.5;e.beginPath(),e.moveTo(l,u),e.lineTo(c,u),e.lineTo(c,d),e.lineTo(l,d),e.lineTo(l,u),e.stroke()}};const s4e=[];for(let e=0;e<360;e+=360/16)s4e.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var lb;(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(lb||(lb={}));const t0e={canvas:null},j2t=.2,$4=512,i0e="rgb(255, 0, 255, 0.5)";let G2t=class{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,i,r,s,n){this.firstLineAscent=e,this.lastLineDescent=i,this.maxLineAscent=r,this.maxLineDescent=s,this.displayWidth=n}};const H2t=Object.freeze({left:0,center:.5,right:1}),PU=Object.freeze({"bottom-left":Ei(0,0),bottom:Ei(.5,0),"bottom-right":Ei(1,0),left:Ei(0,.5),center:Ei(.5,.5),right:Ei(1,.5),"top-left":Ei(0,1),top:Ei(.5,1),"top-right":Ei(1,1)});function n4e(t){switch(t){case"left":return lb.Left;case"right":return lb.Right;default:return lb.Center}}function r0e(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function q2t(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function W2t(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function Z2t(t){return t==="middle"?"center":t}function Y2t(t,e){switch(t){case"top":return Li(e,0,BB);case"bottom":return Li(e,0,-BB);default:return Da(e,jS)}}let TP=class{constructor(e,i={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=ke(),this._shaderTransformation=null,this._boundingSphere=null,this.id=Ph(),this.layerUid=i.layerUid,this.graphicUid=i.graphicUid,this.castShadow=i.castShadow??!1,i.objectShaderTransformation!=null&&this.objectShaderTransformationChanged(i.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){xn(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){e==null?this._shaderTransformation=null:(this._shaderTransformation??(this._shaderTransformation=ke()),gr(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(this._boundingSphere==null&&(this._boundingSphere??(this._boundingSphere=dn()),nt(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*XA(this.shaderTransformation)),this._boundingSphere):pAe}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const s0e=Ge(0,0,1),X2t=16,J2t=1.5,VT=Poe,Q2t=[VT/2,VT/2,1-VT/2,1-VT/2],K2t=[RB*VT,RB*VT];let gK=class o4e extends Sy{getCachedSize(){return{size:this._getIconSize()}}constructor(e,i,r,s){super(e,i,r,s),this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._patchTask=null,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const i=this._prepareMaterialParameters(),r=this._getPrimitive();if(r!=null)this._prepareResourcesPrimitive(i,r);else{const s=T2t(this.symbolLayer),n=n0e(s);n!=null?await this._prepareResourcesCIM(i,JSON.parse(n),e):await this._prepareResourcesHref(i,s,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=S6(this._getIconSize());if(e)throw new G("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,i=Math.round(e.size!=null?wn(e.size):X2t);return this._drivenProperties.size?Math.max(i,64):i}_generateTextureCIM(e){let i=this._cimData;if(i&&i.symbol||this.logger.error("Can't create texture, CIM data is undefined"),i.primitiveOverrides){i=ie(i);const c=i.primitiveOverrides;EM.evaluateOverrides(c,e,this._arcadeInfo.geometryType,null,null),EM.applyOverrides(i.symbol,c)}const r=xie(JSON.stringify(i));let s=this._cimSymbolTextures.get(r);if(s)return s;const n=this._context.sharedResources.cimSymbolRasterizer,o=this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null;o&&EM.applyDictionaryTextOverrides(i.symbol,e,o,null);const a=this._cimScaleFactorOrFunction!=null?qxt(this._cimScaleFactorOrFunction,e):1;a!==1&&i.symbol&&Goe(i.symbol,a);const l=u9.getEnvelope(i,null,n.resourceManager);if(l!=null&&l.width&&l.height){const c=l.x+l.width/2,u=l.y+l.height/2,d=n.rasterize({type:"cim",data:i},l.width,l.height,c,u,1,"esriGeometryPoint"),f=new NT({x:-l.x/l.width-.5,y:(l.height+l.y)/l.height-.5});this._cimMaterialParametersInfo.anchorPosition=o0e("relative",f),s=new Vb(d,{width:(d==null?void 0:d.width)??1,height:(d==null?void 0:d.height)??1,reloadable:!0})}else s=new Vb(new ImageData(1,1),{width:1,height:1,reloadable:!0});return this._cimSymbolTextures.set(r,s),this._context.stage.add(s),s}_prepareMaterialParameters(){const e={anchorPosition:o0e(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},i=this.symbol;if(eEt(i)){const{screenLength:r,minWorldLength:s,maxWorldLength:n}=i.verticalOffset;e.verticalOffset={screenLength:wn(r),minWorldLength:s||0,maxWorldLength:n??1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!le("enable-feature:non-occluded-hud"),e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,i){const r=this._getOutlineSize();if(p9(i)&&r===0)throw new Error("Nothing to render");if(this._outlineSize=r,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,this._context.sharedResources.textures!=null){const n=this._context.sharedResources.textures.fromData(`${i}-icon`,()=>Cbt(i));this._textureHandle=n,e.textureId=n.texture.id}e.textureIsSignedDistanceField=!0,e.sampleSignedDistanceFieldTexelCenter=Ebt(i),e.distanceFieldBoundingBox=Q2t;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/VT,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,i,r){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(this._context.sharedResources.textures!=null){const o=await Vh(this._context.sharedResources.textures.fromUrl(i,n,{signal:r}));if(o.ok===!1)throw jl(o.error),new G("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${i})`);this._textureHandle=o.value;const a=o.value.texture;this._size=a0e(a,s),e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,i,r){if(this._cimData=i,!this._context.sharedResources.cimSymbolRasterizer){const u=(await ce(async()=>{const{CIMSymbolRasterizer:d}=await import("./CIMSymbolRasterizer-EPDzLGI9.js");return{CIMSymbolRasterizer:d}},[])).CIMSymbolRasterizer;Dt(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new u(this._context.renderCoordsHelper.spatialReference))}const s=this._context.sharedResources.cimSymbolRasterizer,n=[],o=i,a=o==null?void 0:o.symbol;u9.fetchResources(a,s.resourceManager,n,r),u9.fetchFonts(a,s.resourceManager,n);const l=this._context.layer.fields?this._context.layer.fields.map(u=>u.toJSON()):[],c=this._context.renderCoordsHelper.spatialReference;if(this._arcadeInfo={spatialReference:c,fields:l,geometryType:"esriGeometryPoint"},o!=null&&o.primitiveOverrides&&n.push(EM.createRenderExpressions(o.primitiveOverrides,this._arcadeInfo)),n.length>0&&(await Promise.all(n),Dt(r)),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const u=this._context.renderer;if(u.scaleExpression){const d=u.scaleExpression,f=await QPe(d,this._context.layer.spatialReference,l);this._cimScaleFactorOrFunction=(m,g,y)=>{const v=YFe(f,m,{$view:y},"esriGeometryPoint",g);return v!==null?v:1}}}Dt(r),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){var e,i;return(e=this.symbolLayer.resource)!=null&&e.href?null:((i=this.symbolLayer.resource)==null?void 0:i.primitive)??Uot}_getOutlineSize(){var r;let e=0;const i=this.symbolLayer;return((r=i.outline)==null?void 0:r.size)!=null?Math.max(wn(i.outline.size),0):(e=p9(this._getPrimitive())?J2t:0,Math.max(e,0))}_getOutlineColor(){var s;const e=this._getLayerOpacity(),i=this.symbolLayer,r=(s=i==null?void 0:i.outline)==null?void 0:s.color;if(r!=null){const n=Qe.toUnitRGB(r),o=r.a*e;return[n[0],n[1],n[2],o]}return[0,0,0,0]}_getFillColor(){var r,s;if(p9(this._getPrimitive()))return k2t;const e=this._getPrimitive()==null,i=(s=(r=this.symbolLayer)==null?void 0:r.material)==null?void 0:s.color;return this._getCombinedOpacityAndColor(i,{hasIntrinsicColor:e})}_createMaterialAndAddToStage(e,i){if(this._cimData){this._fastUpdates=null;let r=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return r||(r=new yP(e),this._cimSymbolMaterials.set(e.textureId??0,r),i.add(r)),r}return this._fastUpdates=fP(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._materials[0]=new yP(e),i.add(this._materials[0]),this._materials[0]}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,draped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._patchTask=Jl(this._patchTask),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._textureHandle=hi(this._textureHandle)}_getScaleFactor(e,i){if(this._drivenProperties.size&&e.size){for(let r=0;r<3;r++){const s=e.size[r];s&&s!=="symbol-value"&&s!=="proportional"&&(e.size[r]=wn(s))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/i;if(isFinite(+e.size[2]))return+e.size[2]/i}return 1}createGraphics3DGraphic(e){var d;const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;let r,s=[0,0];if(this._cimData){if(!this._cimData.symbol)return null;const f=this._generateTextureCIM(i),m={textureId:f.id,...this._cimMaterialParametersInfo};r=this._createMaterialAndAddToStage(m,this._context.stage);const g=window.devicePixelRatio||1;s=[f.parameters.width/g,f.parameters.height/g]}else s=this._size,r=this._materials[0];const n=_S(i.geometry);if(n==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!((d=this._fastUpdates)!=null&&d.visualVariables.size)){const f=s[0]>s[1]?s[0]:s[1];l=this._getScaleFactor(o,f)}l*=this._symbolTextureRatio;const c=Ei(s[0]*l,s[1]*l),u=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(u.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(i,n,r,a,c,e.layer.uid):this._createAs3DShape(i,n,r,a,c,u,i.uid)}layerOpacityChanged(){const e=this._getFillColor(),i=this._getOutlineColor();this._forEachMaterial(r=>{r.setParameters({color:e}),r.setParameters({outlineColor:i})})}updateGeometry(e,i){if(this.draped||!this._validateGeometry(i))return!1;const{elevationContext:r,stageObject:s}=e;if(r.mode!==this.getGeometryElevationMode(i))return!1;const n=_S(i);if(!n)return!1;const o=fDe(s,this._context,n,r);if(o==null)return!1;const a=goe(this._context,n);return s.geometries[0].localOrigin===a&&(e.alignedSampledElevation=o,t2(e,n,this._context.elevationProvider),!0)}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=qD(o4e.elevationModeChangeTypes,r,s);if(n!==ks.UPDATE)return n;const o=sp(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return this._getPrimitive()!=null}applyRendererDiff(e,i){var r;for(const s in e.diff){if(s!=="visualVariables"||!mP(this._fastUpdates,i,this._fastVisualVariableConvertOptions()))return cn.RecreateSymbol;(r=this._materials[0])==null||r.setParameters(this._fastUpdates.materialParameters)}return cn.FastUpdate}prepareSymbolLayerPatch(e){var r;if((r=this._patchTask)==null||r.abort(),e.diff.type!=="partial")return;const i=e.diff.diff;this._preparePatchResource(e,i)}_preparePatchResource(e,i){var l;if(!i.resource||i.resource.type!=="partial")return;const r=i.resource.diff;if(((l=r==null?void 0:r.href)==null?void 0:l.type)!=="complete")return;const s=r.href.newValue,{textures:n}=this._context.sharedResources;if(s==null||n==null||n0e(s)!=null)return;const o=this._getIconSize(),a=o*this._context.graphicsCoreOwner.view.state.pixelRatio;e.symbolLayerStatePatches.push(()=>{this._patchTask=Jl(this._patchTask),this._patchTask=uy(c=>this._context.schedule(async(u,d)=>{const f=await Vh(n.fromUrl(s,a,{signal:d}));Dt(d);const m=!f.ok;if(m&&jl(f.error),this._textureHandle=hi(this._textureHandle),this._patchTask=null,m){this._forEachMaterial(v=>{v.visible=!1,v.setParameters({textureId:null})});const y=`Failed to load (Request for icon resource failed: ${s})`;return void this.logger.error(new G("graphics3diconsymbollayer:request-failed",y))}this._textureHandle=f.value;const g=f.value.texture;this._size=a0e(g,o),this._forEachMaterial(y=>{y.setParameters({textureId:g.id}),y.visible=!0})},c))}),delete r.href}_defaultElevationInfoNoZ(){return tEt}_createAs3DShape(e,i,r,s,n,o,a){const l=this.getFastUpdateAttrValues(e),c=this._context.layer.uid,u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:c}),d=mQ(r,s0e,null,s,n,iEt,null,l,u),f=moe(this._context,i,d,o,a);if(f==null)return null;const m=new Ty(this,f.object,[d],null,null,yS,o);return m.alignedSampledElevation=f.sampledElevation,m.needsElevationUpdates=sp(o.mode)||o.mode==="absolute-height",m.getScreenSize=this._createScreenSizeGetter(n,l),m.calculateRelativeScreenBounds=g=>r.calculateRelativeScreenBounds(m.getScreenSize(),1,g),t2(m,i,this._context.elevationProvider),m}_createAsOverlay(e,i,r,s,n,o){r.renderPriority=this._renderPriority;const a=E();pl(i,a,this._context.overlaySR),a[2]=Noe;const l=this._context.clippingExtent;if(l!=null&&!Ese(l,a))return null;const c=this.getFastUpdateAttrValues(e),u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),d=mQ(r,s0e,a,s,n,null,null,c,u),f=new TP(d,{layerUid:o,graphicUid:e.uid}),m=new j6(this,[f],null,this._context.drapeSourceRenderer);return m.getScreenSize=this._createScreenSizeGetter(n,c),m.calculateRelativeScreenBounds=g=>r.calculateRelativeScreenBounds(m.getScreenSize(),1,g),m}_createScreenSizeGetter(e,i){const r=this._outlineSize+2;if(this._fastUpdates&&i){const o=e[0]/this._symbolTextureRatio,a=e[1]/this._symbolTextureRatio;return(l=mt())=>{const[c,u]=Une(rEt,this._fastUpdates.materialParameters,i);return l[0]=c*o+r,l[1]=u*a+r,l}}const s=e[0]/this._symbolTextureRatio+r,n=e[1]/this._symbolTextureRatio+r;return(o=mt())=>(o[0]=s,o[1]=n,o)}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),i=Ge(e,e,e),r=Uo(1),s=e*r,n=Ge(s,s,s);return new GD({size:!0,color:!0,rotation:!0,opacity:!1},i,n,r)}_forEachMaterial(e){this._materials.forEach(e),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._materials[0]}}};function eEt(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function p9(t){return t!=null&&(t==="cross"||t==="x")}function n0e(t){const e=mb(t);return(e==null?void 0:e.mediaType)==="application/json"?e.data:void 0}function o0e(t,e){return t==="relative"?Ei((e.x||0)+.5,.5-(e.y||0)):t in PU?PU[t]:PU.center}function a0e({parameters:t},e){const i=(t.width??1)/(t.height??1);return i>1?[e,Math.round(e/i)]:[Math.round(e*i),e]}gK.PRIMITIVE_SIZE=K2t,gK.elevationModeChangeTypes={definedChanged:ks.UPDATE,staysOnTheGround:ks.NONE,onTheGroundChanged:ks.RECREATE};const tEt={mode:"relative-to-ground",offset:0},iEt=ii(0,0,0,1),rEt=E();function yK(t){switch(t){case"butt":return Jd.BUTT;case"square":return Jd.SQUARE;case"round":return Jd.ROUND;default:return null}}function l0e(t){return t==="diamond"?"kite":t}function _K(t,e,i=null){const r=[],s=e.mapPositions;sEt(e,r);const n=r[0][1].data,o=r[0][1].indices.length,a=tw(o);return nEt(e,r,a),lEt(e,r,a),oEt(e,r,a),aEt(e,r,a),cEt(e,r,a),uEt(e,r,a),hEt(e,r,n),new Tn(t,r,s,Fs.Line,i)}function sEt(t,e){const{attributeData:{position:i},removeDuplicateStartEnd:r}=t,s=dEt(i)&&r,n=i.length/3-(s?1:0),o=new Array(2*(n-1)),a=s?i.slice(0,-3):i;let l=0;for(let c=0;c<n-1;c++)o[l++]=c,o[l++]=c+1;e.push([R.POSITION,new ht(a,o,3,s)])}function nEt(t,e,i){if(t.attributeData.colorFeature!=null)return;const r=t.attributeData.color;e.push([R.COLOR,new ht(r??Ud,i,4)])}function oEt(t,e,i){t.attributeData.normal&&e.push([R.NORMAL,new ht(t.attributeData.normal,i,3)])}function aEt(t,e,i){t.attributeData.colorFeature!=null&&e.push([R.COLORFEATUREATTRIBUTE,new ht([t.attributeData.colorFeature],i,1,!0)])}function lEt(t,e,i){t.attributeData.sizeFeature==null&&e.push([R.SIZE,new ht([t.attributeData.size??1],i,1,!0)])}function cEt(t,e,i){t.attributeData.sizeFeature!=null&&e.push([R.SIZEFEATUREATTRIBUTE,new ht([t.attributeData.sizeFeature],i,1,!0)])}function uEt(t,e,i){t.attributeData.opacityFeature!=null&&e.push([R.OPACITYFEATUREATTRIBUTE,new ht([t.attributeData.opacityFeature],i,1,!0)])}function hEt(t,e,i){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==Xe.Global||!t.overlayInfo.spatialReference.isGeographic)return;const r=co(i.length),s=_r(t.overlayInfo.spatialReference);for(let d=0;d<r.length;d+=3)xre(i,d,r,d,s);const n=i.length/3,o=Es(n+1);let a=pEt,l=fEt,c=0,u=0;Li(a,r[u++],r[u++]),u++,o[0]=0;for(let d=1;d<n+1;++d)d===n&&(u=0),Li(l,r[u++],r[u++]),u++,c+=$Re(a,l),o[d]=c,[a,l]=[l,a];e.push([R.DISTANCETOSTART,new ht(o,e[0][1].indices,1,!0)])}function dEt(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const pEt=mt(),fEt=mt();function nri(t,e){if(t==null||t.length===0)return[];const i=[];return t.forEach(r=>{const s=r.length,n=co(3*s);r.forEach((a,l)=>{n[3*l]=a[0],n[3*l+1]=a[1],n[3*l+2]=a[2]});const o={attributeData:{position:n,normal:e},removeDuplicateStartEnd:!1};i.push(o)}),i}function mEt(t,e,i,r){const s=t.type==="polygon"?ay.CCW_IS_HOLE:ay.NONE,n=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=sN(n,!!t.hasZ,s,t.spatialReference),l=co(o.length),c=lLe(o,t.spatialReference,0,l,0,o,0,o.length/3,e,i,r),u=c!=null;return{lines:u?a4e(a,o,l):[],projectionSuccess:u,sampledElevation:c}}function gEt(t,e){const i=t.type==="polygon"?ay.CCW_IS_HOLE:ay.NONE,r=t.type==="polygon"?t.rings:t.paths,{position:s,outlines:n}=sN(r,!1,i),o=ds(s,t.spatialReference,0,s,e,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=Noe;return{lines:o?a4e(n,s):[],projectionSuccess:o}}function a4e(t,e,i=null){const r=new Array;for(const{index:s,count:n}of t){if(n<=1)continue;const o=3*s,a=3*n;r.push({position:Xd(e,3*s,3*n),mapPositions:i!=null?Xd(i,o,a):void 0})}return r}function l4e(t){const e=new Hi,i=t.multipassEnabled&&t.output===j.Color,r=t.space===Vc.World;e.include(pNe,t),e.include(ONe,t);const{vertex:s,fragment:n}=e;return n.include(rm),Nc(s,t),e.attributes.add(R.POSITION,"vec3"),e.attributes.add(R.PREVPOSITION,"vec3"),e.attributes.add(R.UV0,"vec2"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),i&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),s.uniforms.add(new jr("nearFar",(o,a)=>a.camera.nearFar),new ji("viewport",(o,a)=>a.camera.fullViewport)),s.code.add(T`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(T`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),r?(e.attributes.add(R.NORMAL,"vec3"),uP(s),s.constants.add("tiltThreshold","float",.7),s.code.add(T`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):s.code.add(T`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),s.code.add(T`
      #define vecN ${r?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${r?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===r2.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===Vc.Screen&&(s.uniforms.add(new us("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),s.code.add(T`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),s.code.add(T`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),s.uniforms.add(new et("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),s.code.add(T`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),rO(s),s.code.add(T`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position, 1.0);
vec4 prev = view * vec4(prevPosition, 1.0);
clip(pos, prev);`),r?(t.hideOnShortSegments&&s.code.add(T`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),s.code.add(T`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(s.code.add(T`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===Vc.Screen&&s.code.add(T`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),s.code.add(T`
        ${i?"depth = pos.z;":""}

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${r?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),i&&e.include(xy,t),e.include(bn,t),n.uniforms.add(new ji("intrinsicColor",o=>o.color),new wt("tex",o=>o.markerTexture)),n.include(by),e.constants.add("texelSize","float",1/vS),n.code.add(T`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",Ooe/vS),e.constants.add("relativeTipLineWidth","float",Dbt),n.code.add(T`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${r?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),t.transparencyPassType===pt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),e.constants.add("symbolAlphaCutoff","float",ea),n.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${r?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===j.ObjectAndLayerIdColor?T`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===j.Color?T`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===j.Color&&t.transparencyPassType===pt.ColorAlpha?T`
            fragColor = premultiplyAlpha(fragColor);
            fragAlpha = fragColor.a;`:""}
    ${t.output===j.Highlight?T`fragColor = vec4(1.0);`:""}
  }
  `),e}const yEt=Object.freeze(Object.defineProperty({__proto__:null,build:l4e},Symbol.toStringTag,{value:"Module"})),c4e=new Map([[R.POSITION,0],[R.PREVPOSITION,1],[R.UV0,2],[R.NORMAL,3],[R.COLOR,4],[R.COLORFEATUREATTRIBUTE,4],[R.SIZE,5],[R.SIZEFEATUREATTRIBUTE,5],[R.OPACITYFEATUREATTRIBUTE,6]]);let u4e=class h4e extends Qi{initializeProgram(e){return new Ki(e.rctx,h4e.shader.get().build(this.configuration),c4e)}_makePipelineState(e,i){const r=this.configuration,s=e===pt.NONE;return Jt({blending:r.output===j.Color?s?Ru:$_(e):null,depthTest:r.space===Vc.Draped?null:{func:sw(e)},depthWrite:r.space===Vc.Draped?null:s?r.writeDepth?Nu:null:_6(e),drawBuffers:r.output===j.Depth?{buffers:[no.NONE]}:I_(e),colorWrite:ui,stencilWrite:r.hasOccludees?oy:null,stencilTest:r.hasOccludees?i?kb:nw:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Jt({blending:Ru,depthTest:TB,depthWrite:null,colorWrite:ui,stencilWrite:null,stencilTest:zLe}),this._occluderPipelineOpaque=Jt({blending:Ru,depthTest:TB,depthWrite:null,colorWrite:ui,stencilWrite:ULe,stencilTest:VLe}),this._occluderPipelineMaskWrite=Jt({blending:null,depthTest:ooe,depthWrite:null,colorWrite:null,stencilWrite:oy,stencilTest:kb})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e,i,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:i?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};u4e.shader=new qi(yEt,()=>ce(()=>Promise.resolve().then(()=>EHt),void 0));let _Et=class extends iw{constructor(e){super(e,new bEt),this.produces=new Map([[Pe.OPAQUE_MATERIAL,i=>i===j.Highlight||Q0(i)&&this.parameters.renderOccluded===er.OccludeAndTransparentStencil],[Pe.OPAQUE_NO_SSAO_DEPTH,i=>nb(i)],[Pe.OCCLUDER_MATERIAL,i=>jpe(i)&&this.parameters.renderOccluded===er.OccludeAndTransparentStencil],[Pe.TRANSPARENT_OCCLUDER_MATERIAL,i=>jpe(i)&&this.parameters.renderOccluded===er.OccludeAndTransparentStencil],[Pe.TRANSPARENT_MATERIAL,i=>Q0(i)&&this.parameters.writeDepth],[Pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>Q0(i)&&!this.parameters.writeDepth],[Pe.DRAPED_MATERIAL,i=>i===j.Color||i===j.Highlight]]),this._vertexAttributeLocations=c4e,this._configuration=new bo,this._layout=this.createLayout()}getConfiguration(e,i){return this._configuration.output=e,this._configuration.space=i.slot===Pe.DRAPED_MATERIAL?Vc.Draped:this.parameters.worldSpace?Vc.World:Vc.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Jd.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===er.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=As().vec3f(R.POSITION).vec3f(R.PREVPOSITION).vec2f(R.UV0);return this.parameters.worldSpace&&e.vec3f(R.NORMAL),this.parameters.vvSize?e.f32(R.SIZEFEATUREATTRIBUTE):e.f32(R.SIZE),this.parameters.vvColor?e.f32(R.COLORFEATUREATTRIBUTE):e.vec4f(R.COLOR),this.parameters.vvOpacity&&e.f32(R.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new wEt(this._layout,this.parameters)}createGLMaterial(e){return new vEt(e)}},vEt=class extends Zse{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextures.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(e){const i=this._material.parameters.markerPrimitive;return i!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextures.swap(i,this._markerPrimitive)}),this._markerPrimitive=i),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(u4e,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===j.Color&&this._updateOccludeeState(e),this._updateParameters(e)}},bEt=class extends HD{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=Jd.BUTT,this.anchor=r2.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}},wEt=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,i,r,s,n){const o=r.attributes.get(R.POSITION).data,a=o.length/3;let l=[1,0,0];const c=r.attributes.get(R.NORMAL);this._parameters.worldSpace&&c!=null&&(l=c.data);let u=1,d=0;this._parameters.vvSize?d=r.attributes.get(R.SIZEFEATUREATTRIBUTE).data[0]:r.attributes.has(R.SIZE)&&(u=r.attributes.get(R.SIZE).data[0]);let f=[1,1,1,1],m=0;this._parameters.vvColor?m=r.attributes.get(R.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has(R.COLOR)&&(f=r.attributes.get(R.COLOR).data);let g=0;this._parameters.vvOpacity&&(g=r.attributes.get(R.OPACITYFEATUREATTRIBUTE).data[0]);const y=new Float32Array(s.buffer);let v=n*(this.vertexBufferLayout.stride/4);const b=(C,M,O,D)=>{if(y[v++]=C[0],y[v++]=C[1],y[v++]=C[2],y[v++]=M[0],y[v++]=M[1],y[v++]=M[2],y[v++]=O[0],y[v++]=O[1],this._parameters.worldSpace&&(y[v++]=l[0],y[v++]=l[1],y[v++]=l[2]),this._parameters.vvSize?y[v++]=d:y[v++]=u,this._parameters.vvColor)y[v++]=m;else{const U=Math.min(4*D,f.length-4);y[v++]=f[U],y[v++]=f[U+1],y[v++]=f[U+2],y[v++]=f[U+3]}this._parameters.vvOpacity&&(y[v++]=g)};let w;(function(C){C[C.ASCENDING=1]="ASCENDING",C[C.DESCENDING=-1]="DESCENDING"})(w||(w={}));const x=(C,M)=>{const O=de(xEt,o[3*C],o[3*C+1],o[3*C+2]),D=TEt;let U=C+M;do de(D,o[3*U],o[3*U+1],o[3*U+2]),U+=M;while(US(O,D)&&U>=0&&U<a);e&&(nt(O,O,e),nt(D,D,e)),b(O,D,[-1,-1],C),b(O,D,[1,-1],C),b(O,D,[1,1],C),b(O,D,[-1,-1],C),b(O,D,[1,1],C),b(O,D,[-1,1],C)},S=this._parameters.placement;S!=="begin"&&S!=="begin-end"||x(0,w.ASCENDING),S!=="end"&&S!=="begin-end"||x(a-1,w.DESCENDING)}};const xEt=E(),TEt=E(),Ba={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},SEt={dash:Ba.dash,"dash-dot":[...Ba.dash,...Ba.dot],dot:Ba.dot,"long-dash":Ba["long-dash"],"long-dash-dot":[...Ba["long-dash"],...Ba.dot],"long-dash-dot-dot":[...Ba["long-dash"],...Ba.dot,...Ba.dot],none:null,"short-dash":Ba["short-dash"],"short-dash-dot":[...Ba["short-dash"],...Ba["short-dot"]],"short-dash-dot-dot":[...Ba["short-dash"],...Ba["short-dot"],...Ba["short-dot"]],"short-dot":Ba["short-dot"],solid:null},EEt=8;function CEt(t,e){return t==null?t:{pattern:t.slice(),pixelRatio:e}}function uri(t){return{pattern:[t,t],pixelRatio:2}}function d4e(t){return t!=null&&t.type==="style"?MEt(t.style):null}function MEt(t){return t!=null?CEt(SEt[t],EEt):null}const AEt=["polyline","polygon","extent"],c0e=new GD({size:!0,color:!0,rotation:!1,opacity:!0});let p4e=class f4e extends Sy{constructor(e,i,r,s){super(e,i,r,s)}async doLoad(){if(this._fastUpdates=fP(this._context.renderer,c0e),!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:Uo(1))<0)throw new G("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e,i=!1){var n,o;const r=this._getCombinedOpacityAndColor(i&&this._markerColor||this._materialColor);this._patternHidesLine&&!i&&(r[3]=0);const s={width:this._computeMaterialWidth((n=this.symbolLayer)==null?void 0:n.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:yK(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:d4e(this.symbolLayer.pattern)};return(o=this._fastUpdates)!=null&&o.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){var e;return(e=this.symbolLayer.material)==null?void 0:e.color}get _markerColor(){var e;return(e=this.symbolLayer.marker)==null?void 0:e.color}get _lineMaterial(){return this._materials[qs.Line]==null&&(this._materials[qs.Line]=new wM(this._getMaterialParameters(!1)),this._context.stage.add(this._materials[qs.Line])),this._materials[qs.Line]}get _ringMaterial(){return this._materials[qs.Ring]==null&&(this._materials[qs.Ring]=new wM(this._getMaterialParameters(!0)),this._context.stage.add(this._materials[qs.Ring])),this._materials[qs.Ring]}get _wireframeLineMaterial(){return this._materials[qs.LineWireframe]==null&&(this._materials[qs.LineWireframe]=new wM({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._materials[qs.LineWireframe])),this._materials[qs.LineWireframe]}get _wireframeRingMaterial(){return this._materials[qs.RingWireframe]==null&&(this._materials[qs.RingWireframe]=new wM({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._materials[qs.RingWireframe])),this._materials[qs.RingWireframe]}get _markerMaterial(){return this._materials[qs.Marker]==null&&this.symbolLayer.marker!=null&&(this._materials[qs.Marker]=new _Et({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:l0e(this.symbolLayer.marker.style)}),this._context.stage.add(this._materials[qs.Marker])),this._materials[qs.Marker]}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0}_getDrivenSize(e){return this._drivenProperties.size&&e.size?wn(l1t(e.size)):1}_getDrivenColor(e){const i=ii(1,1,1,1);return this._drivenProperties.color&&e.color&&(i[0]=e.color[0],i[1]=e.color[1],i[2]=e.color[2],e.color.length>0&&(i[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(i[3]=e.opacity),i}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,AEt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,r,i.uid)}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables")return cn.RecreateSymbol;{const s=this._fastUpdates;if(!mP(s,i,c0e))return cn.RecreateSymbol;this._forEachMaterial(n=>n==null?void 0:n.setParameters(s.materialParameters))}}return cn.FastUpdate}prepareSymbolLayerPatch(e){var n,o;if(e.diff.type!=="partial")return;const i=e.diff.diff,r={};((n=i.size)==null?void 0:n.type)==="complete"&&(r.width=this._computeMaterialWidth(i.size.newValue),delete i.size),((o=i.cap)==null?void 0:o.type)==="complete"&&(r.cap=yK(i.cap.newValue??"butt"),delete i.cap);const s=this._prepareMarkerPatch(e,i);this._prepareMaterialPatch(e,i,s),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a==null?void 0:a.setParameters(r)))}layerOpacityChanged(){this._forEachMaterial((e,i)=>this._updateMaterialLayerOpacity(e,i===qs.Marker))}_forEachMaterial(e){this._materials.forEach(e)}_updateMaterialLayerOpacity(e,i=!1){var a,l;if(e==null)return;const r=e.parameters.color,s=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,n=this._patternHidesLine&&!i?0:this._getCombinedOpacity(s),o=ii(r[0],r[1],r[2],n);e.setParameters({color:o})}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=qD(f4e.elevationModeChangeTypes,r,s);if(n!==ks.UPDATE)return n;const o=sp(s);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(i=>i==null?void 0:i.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){const s=u0e(e.graphic.geometry),n=s.type==="polygon"?s.rings:s.paths,o=new Array,a=Xn(),l=mEt(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),c=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(l,n,c,"LineSymbol3DLayer");for(let f=0;f<l.lines.length;f++){const m=l.lines[f],g=m.position,y=m.mapPositions;if(this._context.clippingExtent!=null&&(Zr(a),Mh(a,y),!Mf(a,this._context.clippingExtent)))continue;const v=this._createGeometry(s.type==="polygon"?this._ringMaterial:this._lineMaterial,e,g,y,s.type,S3.ELEVATED,r);o.push(v),Nr.LINE_WIREFRAMES&&o.push(v.instantiate({material:s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),this._markerMaterial!=null&&o.push(v.instantiate({material:this._markerMaterial}))}if(o.length===0)return null;const u=new ow({geometries:o,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),d=new Ty(this,u,o,null,null,e0t,i);return d.alignedSampledElevation=l.sampledElevation,d.needsElevationUpdates=sp(i.mode),d}_createGeometry(e,i,r,s,n,o,a){var y,v,b;const l=o===S3.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,c=n==="polygon",u=(y=this._fastUpdates)==null?void 0:y.visualVariables.color,d=(v=this._fastUpdates)==null?void 0:v.visualVariables.size,f=(b=this._fastUpdates)==null?void 0:b.visualVariables.opacity,m=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),g={position:r,size:d?null:this._getDrivenSize(i.renderingInfo),color:u?null:this._getDrivenColor(i.renderingInfo),sizeFeature:d?kf(d.field,i.graphic):null,colorFeature:u?kf(u.field,i.graphic):null,opacityFeature:f?kf(f.field,i.graphic):null};return _K(e,{overlayInfo:l,removeDuplicateStartEnd:c,mapPositions:s,attributeData:g},m)}_createAsOverlay(e,i){const r=e.graphic,s=u0e(r.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=Nr.LINE_WIREFRAMES?s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;a!=null&&(a.renderPriority=this._renderPriority-.001),l!=null&&(l.renderPriority=this._renderPriority-.002);const c=new Array,u=Xn(),d=Zr(),f=gEt(s,this._context.overlaySR),m=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,n,m,"LineSymbol3DLayer");for(const g of f.lines){if(Zr(u),Mh(u,g.position),!Mf(u,this._context.clippingExtent))continue;oP(d,u);const y=v=>{const b=this._createGeometry(v,e,g.position,void 0,s.type,S3.DRAPED,r.uid),w=new TP(b,{layerUid:i,graphicUid:r.uid});c.push(w)};if(l!=null){y(l);const v=this.symbolLayer.marker.placement;v!=="begin"&&v!=="begin-end"||Mh(u,g.position,0,1),v!=="end"&&v!=="begin-end"||Mh(u,g.position,g.position.length-3,1)}y(o),Nr.LINE_WIREFRAMES&&y(a)}return new j6(this,c,d,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return e!=null&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){var i;return e=e??Uo(1),this._drivenProperties.size?(i=this._fastUpdates)!=null&&i.visualVariables.size?wn(1):1:wn(e)}_prepareMaterialPatch(e,i,r){var a,l;const s=i.material;if(s==null)return void(r.changed&&r.useMaterialColor&&I4(this._getCombinedOpacityAndColor(this._materialColor),this._materials[qs.Marker],e));if(s.type==="collection")return;const n=s.type==="complete"?(a=s.newValue)==null?void 0:a.color:((l=s.diff.color)==null?void 0:l.type)==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);r.useMaterialColor&&I4(xD(o),this._materials[qs.Marker],e),this._patternHidesLine&&(o[3]=0),I4(o,this._materials[qs.Line],e),delete i.material}_prepareMarkerPatch(e,i){var u;const r=i.marker,s=this._markerMaterial;if(r==null||r.type!=="partial"||r.diff==null||r.diff.placement!=null||r.diff.style!=null&&r.diff.style.type!=="complete"||r.diff.color!=null&&r.diff.color.type!=="complete"||s==null)return{changed:!1,useMaterialColor:this._markerColor==null};const n=r.diff.color,o=n!=null,a=o?n.newValue:null,l=a==null&&this._markerColor==null;a&&I4(this._getCombinedOpacityAndColor(a),s,e);const c=(u=r.diff.style)==null?void 0:u.newValue;return c&&e.symbolLayerStatePatches.push(()=>s.setParameters({markerPrimitive:l0e(c)})),delete i.marker,{changed:o,useMaterialColor:l}}};function u0e(t){switch(t.type){case"extent":if(t instanceof ur)return Wf.fromExtent(t);break;case"polygon":case"polyline":return t}return null}function I4(t,e,i){e!=null&&i.symbolLayerStatePatches.push(()=>e.setParameters({color:t}))}var S3,qs;p4e.elevationModeChangeTypes={definedChanged:ks.RECREATE,staysOnTheGround:ks.NONE,onTheGroundChanged:ks.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(S3||(S3={})),function(t){t[t.Line=0]="Line",t[t.Ring=1]="Ring",t[t.LineWireframe=2]="LineWireframe",t[t.RingWireframe=3]="RingWireframe",t[t.Marker=4]="Marker"}(qs||(qs={}));let cR=null,jB=!0;function f9(t,e,i){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(jB)try{return new ImageData(t,e)}catch{jB=!1}return m4e(t,e,i)}function PEt(t,e,i,r){if(!e||!i)throw new Error("Cannot construct image data without dimensions");if(jB)try{return new ImageData(t,e,i)}catch{jB=!1}const s=m4e(e,i,r);return s.data.set(t,0),s}function OEt(){return cR||(cR=document.createElement("canvas"),cR.width=1,cR.height=1),cR}function m4e(t,e,i){return i||(i=OEt()),i.getContext("2d").createImageData(t,e)}async function REt(t,e){const i=window.URL.createObjectURL(t);try{const{data:r}=await yr(i,{...e,responseType:"image"});return r}catch(r){throw os(r)?r:new G("invalid-image",`Could not fetch requested image at ${i}`)}finally{window.URL.revokeObjectURL(i)}}async function hri(t,e){const{arrayBuffer:i,mediaType:r}=await $Et(t,e),s=r==="image/png";if(r==="image/gif"){const{isAnimatedGIF:n,parseGif:o}=await ce(()=>import("./gif-BOhUpbfS.js"),[]);if(n(i))return o(i,e)}if(s){const{isAnimatedPNG:n,parseApng:o}=await ce(()=>import("./apng-BlZf8TX4.js"),[]);if(n(i))return o(i,e)}return REt(new Blob([i],{type:r}),e)}async function $Et(t,e){var s;const i=mb(t);if(i!=null&&i.isBase64)return{arrayBuffer:d2e(i.data),mediaType:i.mediaType};const r=await yr(t,{responseType:"array-buffer",...e});return{arrayBuffer:r.data,mediaType:((s=r.getHeader)==null?void 0:s.call(r,"Content-Type"))??""}}var EC;const m9=new WeakMap;let IEt=0,Wm=EC=class extends Se{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,i,r){if(t instanceof HTMLImageElement){const s={type:"image-element",src:kS(t.src,r),crossOrigin:t.crossOrigin};e[i]=s}else if(t instanceof HTMLCanvasElement){const s={type:"canvas-element",imageData:h0e(t.getContext("2d").getImageData(0,0,t.width,t.height))};e[i]=s}else if(t instanceof HTMLVideoElement){const s={type:"video-element",src:kS(t.src,r),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[i]=s}else if(t instanceof ImageData){const s={type:"image-data",imageData:h0e(t)};e[i]=s}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=d0e(t.imageData),i=document.createElement("canvas");return i.width=e.width,i.height=e.height,i.getContext("2d").putImageData(e,0,0),i}case"image-data":return d0e(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return p0e(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return p0e(t);if(e){const i=e.substr(e.length-4,4).toLowerCase(),r=e.substr(0,15).toLocaleLowerCase();if(i===".png"||r==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(i="")=>`d:${i},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(m9.has(this.data)||m9.set(this.data,++IEt),e(m9.get(this.data))):e()}get memoryUsage(){let t=0;if(t+=this.url!=null?this.url.length:0,this.data!=null){const e=this.data;"data"in e?t+=e.data.byteLength:e instanceof HTMLImageElement?t+=e.naturalWidth*e.naturalHeight*3:e instanceof HTMLCanvasElement&&(t+=e.width*e.height*3)}return t}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new EC(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const i=this.clone();return t.set(this,i),i}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}static from(t){return typeof t=="string"?new EC({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new EC({data:t}):OS(EC,t)}};function h0e(t){let e="";for(let i=0;i<t.data.length;i++)e+=String.fromCharCode(t.data[i]);return{data:btoa(e),width:t.width,height:t.height}}function d0e(t){const e=atob(t.data),i=new Uint8ClampedArray(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return PEt(i,t.width,t.height)}function p0e(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}h([p({type:String,json:{write:_b}})],Wm.prototype,"url",null),h([p({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),p()],Wm.prototype,"data",null),h([We("data")],Wm.prototype,"writeData",null),h([ze("data")],Wm.prototype,"readData",null),h([p({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],Wm.prototype,"transparent",null),h([p({json:{write:!0}})],Wm.prototype,"wrap",void 0),h([p({readOnly:!0})],Wm.prototype,"contentHash",null),Wm=EC=h([I("esri.geometry.support.MeshTexture")],Wm);const E3=Wm;let CC=class extends Jr(Se){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};h([p({type:[Number],nonNullable:!0,json:{write:!0}})],CC.prototype,"offset",void 0),h([p({type:Number,nonNullable:!0,json:{write:!0}})],CC.prototype,"rotation",void 0),h([p({type:[Number],nonNullable:!0,json:{write:!0}})],CC.prototype,"scale",void 0),CC=h([I("esri.geometry.support.MeshTextureTransform")],CC);const mA=CC;var vK;let zp=vK=class extends Se{constructor(t){super(t),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=t!=null?t.get(this):null;if(i)return i;const r=new vK(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,r),r}clonePropertiesWithDeduplication(t){var e,i,r,s;return{color:this.color!=null?this.color.clone():null,colorTexture:(e=this.colorTexture)==null?void 0:e.cloneWithDeduplication(t),normalTexture:(i=this.normalTexture)==null?void 0:i.cloneWithDeduplication(t),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:(r=this.colorTextureTransform)==null?void 0:r.clone(),normalTextureTransform:(s=this.normalTextureTransform)==null?void 0:s.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let t=0;return t+=this.color!=null?16:0,this.colorTexture!=null&&(t+=this.colorTexture.memoryUsage),t+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(t+=this.normalTexture.memoryUsage),t+=this.normalTextureTransform!=null?20:0,t}};h([p({type:Qe,json:{write:!0}})],zp.prototype,"color",void 0),h([p({type:E3,json:{write:!0}})],zp.prototype,"colorTexture",void 0),h([p({type:mA,json:{write:!0}})],zp.prototype,"colorTextureTransform",void 0),h([p({type:E3,json:{write:!0}})],zp.prototype,"normalTexture",void 0),h([p({type:mA,json:{write:!0}})],zp.prototype,"normalTextureTransform",void 0),h([p({nonNullable:!0,json:{write:!0}})],zp.prototype,"alphaMode",void 0),h([p({nonNullable:!0,json:{write:!0}})],zp.prototype,"alphaCutoff",void 0),h([p({nonNullable:!0,json:{write:!0}})],zp.prototype,"doubleSided",void 0),zp=vK=h([I("esri.geometry.support.MeshMaterial")],zp);const Zoe=zp;var bK;let yd=bK=class extends Zoe{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=t!=null?t.get(this):null;if(i)return i;const r=new bK(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,r),r}getMemoryUsage(){let t=super.getMemoryUsage();return t+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(t+=this.emissiveTexture.memoryUsage),t+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(t+=this.occlusionTexture.memoryUsage),t+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=this.metallicRoughnessTextureTransform!=null?20:0,t}clonePropertiesWithDeduplication(t){var e,i,r,s,n,o,a;return{...super.clonePropertiesWithDeduplication(t),emissiveColor:(e=this.emissiveColor)==null?void 0:e.clone(),emissiveTexture:(i=this.emissiveTexture)==null?void 0:i.cloneWithDeduplication(t),emissiveTextureTransform:(r=this.emissiveTextureTransform)==null?void 0:r.clone(),occlusionTexture:(s=this.occlusionTexture)==null?void 0:s.cloneWithDeduplication(t),occlusionTextureTransform:(n=this.occlusionTextureTransform)==null?void 0:n.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:(o=this.metallicRoughnessTexture)==null?void 0:o.cloneWithDeduplication(t),metallicRoughnessTextureTransform:(a=this.metallicRoughnessTextureTransform)==null?void 0:a.clone()}}};h([p({type:Qe,json:{write:!0}})],yd.prototype,"emissiveColor",void 0),h([p({type:E3,json:{write:!0}})],yd.prototype,"emissiveTexture",void 0),h([p({type:mA,json:{write:!0}})],yd.prototype,"emissiveTextureTransform",void 0),h([p({type:E3,json:{write:!0}})],yd.prototype,"occlusionTexture",void 0),h([p({type:mA,json:{write:!0}})],yd.prototype,"occlusionTextureTransform",void 0),h([p({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],yd.prototype,"metallic",void 0),h([p({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],yd.prototype,"roughness",void 0),h([p({type:E3,json:{write:!0}})],yd.prototype,"metallicRoughnessTexture",void 0),h([p({type:mA,json:{write:!0}})],yd.prototype,"metallicRoughnessTextureTransform",void 0),yd=bK=h([I("esri.geometry.support.MeshMaterialMetallicRoughness")],yd);const g4e=yd;var OU;let id=OU=class extends Se{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return MC(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},se.getLogger(this))}castPosition(t){return t&&t instanceof Float32Array&&se.getLogger(this).warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),MC(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},se.getLogger(this))}castUv(t){return MC(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},se.getLogger(this))}castNormal(t){return MC(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},se.getLogger(this))}castTangent(t){return MC(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},se.getLogger(this))}clone(){const t={position:ie(this.position),uv:ie(this.uv),normal:ie(this.normal),tangent:ie(this.tangent),color:ie(this.color)};return new OU(t)}clonePositional(){const t={position:ie(this.position),normal:ie(this.normal),tangent:ie(this.tangent),uv:this.uv,color:this.color};return new OU(t)}get memoryUsage(){let t=0;return t+=this.position.byteLength,this.uv!=null&&(t+=this.uv.byteLength),this.normal!=null&&(t+=this.normal.byteLength),this.tangent!=null&&(t+=this.tangent.byteLength),this.color!=null&&(t+=this.color.byteLength),t}};function g9(t,e,i,r){const{loggerTag:s,stride:n}=e;return t.length%n!=0?(r.error(s,`Invalid array length, expected a multiple of ${n}`),new i([])):t}function MC(t,e,i,r,s){if(!t)return t;if(t instanceof e)return g9(t,r,e,s);for(const n of i)if(t instanceof n)return g9(new e(t),r,e,s);if(Array.isArray(t))return g9(new e(t),r,e,s);{const n=i.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${t.constructor.name}`),new e([])}}function uR(t,e,i){e[i]=LEt(t)}function LEt(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[i]=t[i];return e}h([p({json:{write:uR}})],id.prototype,"color",void 0),h([Kt("color")],id.prototype,"castColor",null),h([p({nonNullable:!0,json:{write:uR}})],id.prototype,"position",void 0),h([Kt("position")],id.prototype,"castPosition",null),h([p({json:{write:uR}})],id.prototype,"uv",void 0),h([Kt("uv")],id.prototype,"castUv",null),h([p({json:{write:uR}})],id.prototype,"normal",void 0),h([Kt("normal")],id.prototype,"castNormal",null),h([p({json:{write:uR}})],id.prototype,"tangent",void 0),h([Kt("tangent")],id.prototype,"castTangent",null),id=OU=h([I("esri.geometry.support.MeshVertexAttributes")],id);var cI;let Zm=cI=class extends Se{static from(t){return OS(cI,t)}constructor(t){super(t),this.faces=null,this.material=null,this.name=void 0,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return MC(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},se.getLogger(this))}castMaterial(t){return OS(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?g4e:Zoe,t)}clone(){return new cI({faces:ie(this.faces),shading:this.shading,material:ie(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(t,e){const i={faces:ie(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new cI(i)}get memoryUsage(){let t=0;return this.faces!=null&&(t+=this.faces.byteLength),this.material!=null&&(t+=this.material.memoryUsage),t}};h([p({json:{write:!0}})],Zm.prototype,"faces",void 0),h([Kt("faces")],Zm.prototype,"castFaces",null),h([p({type:Zoe,json:{write:!0}})],Zm.prototype,"material",void 0),h([Kt("material")],Zm.prototype,"castMaterial",null),h([p()],Zm.prototype,"name",void 0),h([p({type:String,json:{write:!0}})],Zm.prototype,"shading",void 0),h([p({type:Boolean})],Zm.prototype,"trustSourceNormals",void 0),Zm=cI=h([I("esri.geometry.support.MeshComponent")],Zm);const DEt=Zm;let uI=class extends Jr(Se){constructor(e){super(e),this.type="georeferenced",this.origin=null}};h([Ot({georeferenced:"georeferenced"},{readOnly:!0})],uI.prototype,"type",void 0),h([p({type:[Number],nonNullable:!1,json:{write:!0}})],uI.prototype,"origin",void 0),uI=h([I("esri.geometry.support.MeshGeoreferencedVertexSpace")],uI);const NEt=uI;let hI=class extends Jr(Se){constructor(e){super(e),this.type="local",this.origin=E()}};h([Ot({local:"local"},{readOnly:!0})],hI.prototype,"type",void 0),h([p({type:[Number],nonNullable:!0,json:{write:!0}})],hI.prototype,"origin",void 0),hI=h([I("esri.geometry.support.MeshLocalVertexSpace")],hI);const FEt=hI;function f0e(){return se.getLogger("esri.geometry.Mesh")}function kEt(t){return!G6(t)}function G6(t){return t.origin!=null}function mri(t){return G6(t.vertexSpace)}function gri(t,e){if(!G6(t))return null;const[i,r,s]=t.origin;return new bt({x:i,y:r,z:s,spatialReference:e})}function yri(t,e){const{x:i,y:r,z:s,spatialReference:n}=t,o=[i,r,s??0];return(e==null?void 0:e.geographic)!==void 0&&(fb(f0e(),"option: geographic",{replacement:"Use the `vertexSpace` option instead.",version:"4.29",warnOnce:!0}),e.vertexSpace&&f0e().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")),((e==null?void 0:e.vertexSpace)??VEt(e==null?void 0:e.geographic)??UEt(n))==="local"?new FEt({origin:o}):new NEt({origin:o})}function UEt(t){return t.isGeographic||t.isWebMercator?"local":"georeferenced"}function VEt(t){return t==null?void 0:t?"local":"georeferenced"}function _ri(t,e){return t.type===e.type&&(t.origin===e.origin||t.origin!=null&&e.origin!=null&&$o(t.origin,e.origin))}const zEt=()=>se.getLogger("esri.views.3d.support.buffer.math");function BEt(t,e,i){if(t.count!==e.count)return;const r=t.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],u=i[6],d=i[7],f=i[8],m=i[9],g=i[10],y=i[11],v=i[12],b=i[13],w=i[14],x=i[15],S=t.typedBuffer,C=t.typedBufferStride,M=e.typedBuffer,O=e.typedBufferStride;for(let D=0;D<r;D++){const U=D*C,k=D*O,H=M[k],V=M[k+1],X=M[k+2],q=M[k+3];S[U]=s*H+l*V+f*X+v*q,S[U+1]=n*H+c*V+m*X+b*q,S[U+2]=o*H+u*V+g*X+w*q,S[U+3]=a*H+d*V+y*X+x*q}}function jEt(t,e,i,r=4,s=r){if(t.length/r!=e.length/s)return void zEt().error("source and destination buffers need to have the same number of elements");const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],u=i[4],d=i[5],f=i[6],m=i[7],g=i[8],y=i[9],v=i[10],b=i[11],w=i[12],x=i[13],S=i[14],C=i[15];let M=0,O=0;for(let D=0;D<n;D++){const U=e[M],k=e[M+1],H=e[M+2],V=e[M+3];t[O]=o*U+u*k+g*H+w*V,t[O+1]=a*U+d*k+y*H+x*V,t[O+2]=l*U+f*k+v*H+S*V,t[O+3]=c*U+m*k+b*H+C*V,M+=s,O+=r}}function GEt(t,e,i){H6(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function H6(t,e,i,r=4,s=r){if(t.length/r!=e.length/s)return;const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],u=i[4],d=i[5],f=i[6],m=i[7],g=i[8];let y=0,v=0;for(let b=0;b<n;b++){const w=e[y],x=e[y+1],S=e[y+2],C=e[y+3];t[v]=o*w+c*x+f*S,t[v+1]=a*w+u*x+m*S,t[v+2]=l*w+d*x+g*S,t[v+3]=C,y+=s,v+=r}}function HEt(t,e){const i=Math.min(t.count,e.count),r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,u=n[c],d=n[c+1],f=n[c+2],m=u*u+d*d+f*f;if(m>0){const g=1/Math.sqrt(m);r[l]=g*u,r[l+1]=g*d,r[l+2]=g*f}}}function qEt(t,e,i){GB(t.typedBuffer,e,i,t.typedBufferStride)}function GB(t,e,i,r=4){const s=Math.min(t.length/r,e.count),n=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)t[l]=i*n[a],t[l+1]=i*n[a+1],t[l+2]=i*n[a+2],t[l+3]=i*n[a+3],a+=o,l+=r}Object.freeze(Object.defineProperty({__proto__:null,normalize:HEt,scale:GB,scaleView:qEt,transformMat3:H6,transformMat3View:GEt,transformMat4:jEt,transformMat4View:BEt},Symbol.toStringTag,{value:"Module"}));const WEt="Projection may be possible after calling projection.load().";function ZEt(t,e,i,r){t.error(`Failed to project from (wkid:${e.wkid}) to (wkid:${i.wkid}).${r?" ":""}${r}`)}function y4e(t,e,i,r,s){return q6(g_.TO_PCPF,ho.fromTypedArray(t),cl.NORMAL,rp.fromTypedArray(e),rp.fromTypedArray(i),r,ho.fromTypedArray(s))?s:null}function YEt(t,e,i,r,s){return q6(g_.FROM_PCPF,ho.fromTypedArray(t),cl.NORMAL,rp.fromTypedArray(e),rp.fromTypedArray(i),r,ho.fromTypedArray(s))?s:null}function XEt(t,e,i){return ds(t,e,0,i,Gh(e),0,t.length/3)?i:null}function JEt(t,e,i){return ds(t,Gh(i),0,e,i,0,t.length/3)?e:null}function wK(t,e,i){return Mb(io,i),O6(e,t,io),fz(io)&&wP(e,e),e}function xK(t,e,i){return lp(io,i),H6(e,t,io),fz(io)&&wP(e,e,4),e}function TK(t,e,i,r){const s=e===cl.NORMAL;return _4e(t,e,i,(n,o)=>{const a=Math.cos(kt(n));o[0]=s?a:1/a,o[1]=1},r)}function SK(t,e,i,r){const s=e===cl.NORMAL;return _4e(t,e,i,(n,o)=>{const a=Math.cosh(-n/lr.radius);o[0]=1,o[1]=s?a:1/a},r)}function _4e(t,e,i,r,s){const n=e===cl.NORMAL?3:4,o=[0,0];for(let a=0,l=1;a<t.length;a+=n,l+=3){r(i[l],o);const c=t[a]*o[0],u=t[a+1]*o[1],d=t[a+2],f=1/Math.sqrt(c*c+u*u+d*d);s[a]=c*f,s[a+1]=u*f,s[a+2]=d*f,n===4&&(s[a+3]=t[a+3])}return s}function v4e(t,e,i,r,s){if(!q6(g_.TO_PCPF,ho.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),cl.TANGENT,rp.fromTypedArray(e),rp.fromTypedArray(i),r,ho.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT)))return null;for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function QEt(t,e,i,r,s){if(!q6(g_.FROM_PCPF,ho.fromTypedArray(t,16),cl.TANGENT,rp.fromTypedArray(e),rp.fromTypedArray(i),r,ho.fromTypedArray(s,16)))return null;for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}var cl,g_;function m0e(t,e,i,r,s){switch($h(r,i,F0,r),t===g_.FROM_PCPF&&Zn(F0,F0),e){case cl.NORMAL:return Mb(s,F0);case cl.TANGENT:return lp(s,F0)}}function q6(t,e,i,r,s,n,o){if(!e)return;const a=r.count,l=Gh(n);if(tCt(n))for(let c=0;c<a;c++)s.getVec(c,L4),e.getVec(c,bm),ta(bm,bm,m0e(t,i,L4,l,io)),o.setVec(c,bm);else for(let c=0;c<a;c++){s.getVec(c,L4),e.getVec(c,bm);const u=az(r.get(c,1));let d=Math.cos(u);i===cl.TANGENT!=(t===g_.TO_PCPF)&&(d=1/d),m0e(t,i,L4,l,io),t===g_.TO_PCPF?(io[0]*=d,io[1]*=d,io[2]*=d,io[3]*=d,io[4]*=d,io[5]*=d):(io[0]*=d,io[3]*=d,io[6]*=d,io[1]*=d,io[4]*=d,io[7]*=d),ta(bm,bm,io),Ce(bm,bm),o.setVec(c,bm)}return o}function b4e(t){return t.vertexSpace.type==="local"?KEt(t):eCt(t)}function KEt({vertexSpace:t,transform:e,inSpatialReference:i,outSpatialReference:r,localMode:s,outPositions:n,positions:o}){const a=t.origin??On,l=t.origin!=null?(e==null?void 0:e.localMatrix)??Wr:Wr,c=Gh(i),u=r.isWebMercator&&s||!Bc(i,c)?i:c;$h(i,a,F0,u),gr(F0,F0,l);const d=n??co(o.length);return Ub(d,o,F0),ds(d,u,0,d,r,0,d.length/3),d}function eCt({vertexSpace:t,transform:e,outPositions:i,positions:r,inSpatialReference:s,outSpatialReference:n}){const o=t.origin!=null?(e==null?void 0:e.localMatrix)??Wr:Wr,a=i??co(r.length);eG(o,Wr)?hht(a,r):Ub(a,r,o);const l=t.origin??On;if(!$o(l,On)){const[c,u,d]=l;for(let f=0;f<a.length;f+=3)a[f]+=c,a[f+1]+=u,a[f+2]+=d}return ds(a,s,0,a,n,0,a.length/3)?a:null}function tCt(t){return t.isWGS84||OA(t)||f2(t)||m2(t)}(function(t){t[t.NORMAL=0]="NORMAL",t[t.TANGENT=1]="TANGENT"})(cl||(cl={})),function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"}(g_||(g_={}));const L4=E(),bm=E(),F0=ke(),io=Yr(),vri=Object.freeze(Object.defineProperty({__proto__:null,get VectorType(){return cl},loadProjectErrorMessage:WEt,logProjectionError:ZEt,project:b4e,projectFromPCPF:JEt,projectNormalFromPCPF:YEt,projectNormalToPCPF:y4e,projectTangentFromPCPF:QEt,projectTangentToPCPF:v4e,projectToPCPF:XEt,transformNormal:wK,transformTangent:xK,transformVectorENUPlateCarree:TK,transformVectorWMPlateCarree:SK},Symbol.toStringTag,{value:"Module"}));var sg;(function(t){t[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(sg||(sg={}));let w4e=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=X0.KTX2_ENCODING}};function C3(t){return(t==null?void 0:t.type)==="encoded-mesh-texture"}async function iCt(t){const e=new Blob([t]),i=await e.text();return JSON.parse(i)}async function rCt(t,e){if(e===X0.KTX2_ENCODING)return new w4e(t);const i=new Blob([t],{type:e}),r=URL.createObjectURL(i),s=new Image;if(le("esri-iPhone"))return new Promise((n,o)=>{const a=()=>{c(),n(s)},l=u=>{c(),o(u)},c=()=>{URL.revokeObjectURL(r),s.removeEventListener("load",a),s.removeEventListener("error",l)};s.addEventListener("load",a),s.addEventListener("error",l),s.src=r});try{s.src=r,await s.decode()}catch{console.warn("Failed decoding HTMLImageElement")}return URL.revokeObjectURL(r),s}function Tg(t){if(t==null)return null;const e=t.offset!=null?t.offset:wDe,i=t.rotation!=null?t.rotation:0,r=t.scale!=null?t.scale:xDe,s=KI(1,0,0,0,1,0,e[0],e[1],1),n=KI(Math.cos(i),-Math.sin(i),0,Math.sin(i),Math.cos(i),0,0,0,1),o=KI(r[0],0,0,0,r[1],0,0,0,1),a=Yr();return QA(a,n,o),QA(a,s,a),a}const sCt={disableDelayMs:2e3};let nCt=class extends Ty{constructor(){super(...arguments),this.fastTransformUpdatesAllowed=!1,this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1,this._autoDisableFastUpdatesTimeoutId=0}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}destroy(){super.destroy(),this._cancelAutoDisableFastUpdates()}enableFastTransformUpdates(e,i){if(!this.fastTransformUpdatesAllowed||this._fastTransformUpdatesEnabled)return;this._cancelAutoDisableFastUpdates(),this._fastTransformUpdatesEnabled=!0;const{stageObject:r}=this,s=r.geometries.slice();r.removeAllGeometries();const n=mz(y9,r.transformation),o=i.getOrigin(n);for(const a of s){const l=e(a.material),c=a.instantiate({material:l});c.localOrigin=o,r.addGeometry(c)}this._originalGeometries=s}autoDisableFastTransformUpdates(e){this._cancelAutoDisableFastUpdates(),this._autoDisableFastUpdatesTimeoutId=setTimeout(()=>{this._autoDisableFastUpdatesTimeoutId=0,e()},sCt.disableDelayMs)}updateAutoDisableFastTransformUpdates(e){this._autoDisableFastUpdatesTimeoutId&&this.autoDisableFastTransformUpdates(e)}_cancelAutoDisableFastUpdates(){clearTimeout(this._autoDisableFastUpdatesTimeoutId),this._autoDisableFastUpdatesTimeoutId=0}disableFastTransformUpdates(e){if(!this._fastTransformUpdatesEnabled)return;this._cancelAutoDisableFastUpdates(),this._fastTransformUpdatesEnabled=!1;const{stageObject:i}=this,r=i.geometries.map(s=>e(s.material));i.removeAllGeometries();for(let s=0;s<this._originalGeometries.length;s++){const n=this._originalGeometries[s],o=r[s];o.setParameters({modelTransformation:null}),o===n.material?i.addGeometry(n):i.addGeometry(n.instantiate({material:o}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,i,r){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:s}=this;if(s.geometries.length===0)return;const n=s.geometries[0].localOrigin,o=mz(y9,e),a=r.getOrigin(o);if(a===n)return;const l=(i==null?void 0:i.localMatrix)??Wr;s.shaderTransformation=null,s.transformation=e,s.geometries.forEach(c=>{c.transformation=l,c.localOrigin=a})}updateTransform(e,i,r){const{stageObject:s}=this,n=(i==null?void 0:i.localMatrix)??Wr;if(!this._fastTransformUpdatesEnabled)return s.shaderTransformation=null,s.transformation=e,s.geometries.forEach(m=>m.transformation=n),void this._updateEdgeTransform(r);const o=s.transformation,a=s.geometries[0].transformation,l=e,c=n,u=gr(g0e,o,a),d=gr(y0e,l,c),f=gr(_0e,d,Zn(_0e,a));s.shaderTransformation=f,this._setFastMaterialTransformation({matA:u,matB:d}),this._updateEdgeTransform(r)}alignWithElevation(e,i,r,s){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(e,i,r,s);r!=null&&T6(this.elevationContext.featureExpressionInfoContext,r);const n=(g,y)=>Nb(g,e,this.elevationContext,i,y),{stageObject:o}=this;if(!o.geometries[0].material.parameters.modelTransformation)return;const a=o.transformation,l=o.geometries[0].transformation,c=gr(g0e,a,l),u=o.effectiveTransformation,d=xn(oCt,u);this.alignedSampledElevation=yS(this,this.elevationContext,e.spatialReference,n,i,d),o.shaderTransformation=d;const f=o.geometries[0].transformation,m=gr(y0e,d,f);this._setFastMaterialTransformation({matA:c,matB:m}),this._updateEdgeTransform(s)}_setFastMaterialTransformation({matA:e,matB:i}){const{stageObject:r}=this;if(r.geometries.length===0)return;const s=r.geometries[0].localOrigin,n=g2(aCt,he(y9,s.vec3,-1)),o=gr(v0e,n,e),a=gr(b0e,n,i),l=Zn(v0e,o),c=gr(b0e,a,l);for(const u of r.geometries)u.material.setParameters({modelTransformation:c})}_updateEdgeTransform(e){const{stageObject:i,_stageLayer:r}=this;r.stage.renderer.withEdgeView(s=>{s.fastUpdateObject3DEdgesTransform(i)||this.resetEdgeObject(e)})}};const y9=E(),g0e=ke(),y0e=ke(),oCt=ke(),_0e=ke(),v0e=ke(),b0e=ke(),aCt=ke();let lCt=class{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(e,i,r){e.enableFastTransformUpdates(s=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(s))return s;const o=i.byMaterial(s);return this._fastTransformOriginalMaterials.set(s,o),i.delete(s),s}const n=new em(s.parameters);return r.stage.add(n),this._fastTransformClonedMaterials.set(n,s),n},r.localOriginFactory)}disable(e,i,r){const s=new Set,n=new Set;e.disableFastTransformUpdates(o=>{if(!this._fastTransformClonedMaterials.has(o)){const c=o,u=this._fastTransformOriginalMaterials.get(c);return i.has(u.uid)?(s.add(c),i.byUid(u.uid).material):(n.add(c),u.material)}const a=o,l=this._fastTransformClonedMaterials.get(a);return this._fastTransformClonedMaterials.delete(a),r.stage.remove(a),l});for(const o of s)this._fastTransformOriginalMaterials.delete(o),r.stage.remove(o);for(const o of n){const a=this._fastTransformOriginalMaterials.get(o);this._fastTransformOriginalMaterials.delete(o),i.set(a.uid,a)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(e,i,r){this._graphicReferenceCount--,this.disable(e,i,r)}forEachMaterialInfo(e){this._fastTransformOriginalMaterials.forEach(e)}forEachClonedMaterial(e){this._fastTransformClonedMaterials.forEach(e)}destroy(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:i})=>i)),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}},cCt=class{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),e=>e.material)}byUid(e){return this._byUid.get(e)}byMaterial(e){return this._byMaterial.get(e)}set(e,i){this._byUid.set(e,i),this._byMaterial.set(i.material,i)}delete(e){var r;const i=(r=this._byMaterial.get(e))==null?void 0:r.uid;i&&(this._byUid.delete(i),this._byMaterial.delete(e))}has(e){return this._byUid.has(e)}forEachMaterialInfo(e){this._byUid.forEach(e)}clear(){this._byUid.clear(),this._byMaterial.clear()}};const uCt=As().vec3f(R.POSITION),hCt=As().vec3f(R.POSITION).vec2f(R.UV0),dCt=As().vec3f(R.POSITION).vec4u8(R.COLOR),pCt=As().vec3f(R.POSITION).vec2f(R.UV0).vec4u8(R.OBJECTANDLAYERIDCOLOR);function x4e(t){const e=new Hi,{vertex:i,fragment:r}=e;return e.include(al,t),e.include(D2,t),Nc(i,t),e.attributes.add(R.POSITION,"vec3"),e.varyings.add("vpos","vec3"),i.code.add(T`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);
}`),t.output===j.Highlight&&e.include(rw,t),e.include(bn,t),r.uniforms.add(new et("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),t.hasVertexColors||r.uniforms.add(new ji("constantColor",s=>s.color)),r.code.add(T`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    ${t.output===j.ObjectAndLayerIdColor?T`color.a = 1.0;`:""}

    if (color.a < ${T.float(ea)}) {
      discard;
    }

    ${t.output===j.Color?T`fragColor = highlightSlice(color, vpos);`:""}
    ${t.output===j.Highlight?T`outputHighlight();`:""}
  }
  `),e}const fCt=Object.freeze(Object.defineProperty({__proto__:null,build:x4e},Symbol.toStringTag,{value:"Module"}));let T4e=class S4e extends Qi{initializeProgram(e){return new Ki(e.rctx,S4e.shader.get().build(this.configuration),Ai)}initializePipeline(){const e=this.configuration,i=ua(Be.SRC_ALPHA,Be.ONE,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),r=(s,n=null,o=null)=>Jt({blending:n,depthTest:ooe,depthWrite:o,colorWrite:ui,stencilWrite:e.hasOccludees?oy:null,stencilTest:e.hasOccludees?s?kb:nw:null});return e.output===j.Color?(this._occludeePipelineState=r(!0,e.transparent?i:null,Nu),r(!1,e.transparent?i:null,Nu)):r(!1)}get primitiveType(){return Ci.LINES}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};T4e.shader=new qi(fCt,()=>ce(()=>Promise.resolve().then(()=>CHt),void 0));let AC=class extends Uc{constructor(){super(...arguments),this.output=j.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.hasOccludees=!1}};h([B({count:j.COUNT})],AC.prototype,"output",void 0),h([B()],AC.prototype,"hasSlicePlane",void 0),h([B()],AC.prototype,"hasVertexColors",void 0),h([B()],AC.prototype,"transparent",void 0),h([B()],AC.prototype,"hasOccludees",void 0);let _9=class extends iw{constructor(e){super(e,new gCt),this._configuration=new AC,this.produces=new Map([[Pe.OPAQUE_MATERIAL,i=>i===j.Color||i===j.Highlight||i===j.ObjectAndLayerIdColor]])}getConfiguration(e){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration}intersect(e,i,r,s,n,o){if(!r.options.selectionMode||!e.visible)return;if(!LRe(i))return void se.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes.get(R.POSITION).data,l=r.camera,c=_Ct;Da(c,r.point);const u=2;de(hR[0],c[0]-u,c[1]+u,0),de(hR[1],c[0]+u,c[1]+u,0),de(hR[2],c[0]+u,c[1]-u,0),de(hR[3],c[0]-u,c[1]-u,0);for(let y=0;y<4;y++)if(!l.unprojectFromRenderScreen(hR[y],Uy[y]))return;il(l.eye,Uy[0],Uy[1],v9),il(l.eye,Uy[1],Uy[2],b9),il(l.eye,Uy[2],Uy[3],w9),il(l.eye,Uy[3],Uy[0],x9);let d=Number.MAX_VALUE,f=0;for(let y=0;y<a.length-5;y+=3){if(uc[0]=a[y]+i[12],uc[1]=a[y+1]+i[13],uc[2]=a[y+2]+i[14],hc[0]=a[y+3]+i[12],hc[1]=a[y+4]+i[13],hc[2]=a[y+5]+i[14],Or(v9,uc)<0&&Or(v9,hc)<0||Or(b9,uc)<0&&Or(b9,hc)<0||Or(w9,uc)<0&&Or(w9,hc)<0||Or(x9,uc)<0&&Or(x9,hc)<0)continue;if(l.projectToRenderScreen(uc,Uw),l.projectToRenderScreen(hc,Vw),Uw[2]<0&&Vw[2]>0){Re(wm,uc,hc);const b=l.frustum,w=-Or(b[Tr.NEAR],uc)/Te(wm,b[Tr.NEAR]);he(wm,wm,w),Ee(uc,uc,wm),l.projectToRenderScreen(uc,Uw)}else if(Uw[2]>0&&Vw[2]<0){Re(wm,hc,uc);const b=l.frustum,w=-Or(b[Tr.NEAR],hc)/Te(wm,b[Tr.NEAR]);he(wm,wm,w),Ee(hc,hc,wm),l.projectToRenderScreen(hc,Vw)}else if(Uw[2]<0&&Vw[2]<0)continue;Uw[2]=0,Vw[2]=0;const v=Fre(dS(Uw,Vw,T0e),c);v<d&&(d=v,ve(w0e,uc),ve(x0e,hc),f=y/3)}const m=r.rayBegin,g=r.rayEnd;if(d<u*u){let y=Number.MAX_VALUE;if(zMe(dS(w0e,x0e,T0e),dS(m,g,yCt),kw)){Re(kw,kw,m);const v=Ve(kw);he(kw,kw,1/v),y=v/Cr(m,g)}o(y,kw,f,!1)}}intersectDraped(e,i,r,s,n,o){if(!r.options.selectionMode)return;const a=e.attributes.get(R.POSITION).data,l=e.attributes.get(R.SIZE),c=l?l.data[0]:0,u=s[0],d=s[1],f=((c+1)/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,g=0;for(let y=0;y<a.length-5;y+=3){const v=a[y],b=a[y+1],w=u-v,x=d-b,S=a[y+3]-v,C=a[y+4]-b,M=Ne((S*w+C*x)/(S*S+C*C),0,1),O=S*M-w,D=C*M-x,U=O*O+D*D;U<m&&(m=U,g=y/3)}m<f*f&&n(o.dist,o.normal,g,!1)}createGLMaterial(e){return new mCt(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?dCt:uCt;return new lO(e)}},mCt=class extends ew{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===j.Color&&this._updateOccludeeState(e),this.ensureTechnique(T4e,e)}},gCt=class extends zne{constructor(){super(...arguments),this.color=Ud,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.hasOccludees=!1}};const uc=E(),hc=E(),wm=E(),kw=E(),Uw=Pa(),Vw=Pa(),w0e=E(),x0e=E(),T0e=im(),yCt=im(),_Ct=E(),hR=[Pa(),Pa(),Pa(),Pa()],Uy=[E(),E(),E(),E()],v9=tr(),b9=tr(),w9=tr(),x9=tr(),vCt=["mesh"];let bCt=class extends Sy{constructor(e,i,r,s){super(e,i,r,s),this._materialInfoCache=new cCt,this._fastUpdateProcessor=new lCt,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){Nr.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new _9({color:[1,0,1,1]}),this._debugTangentNormalMaterial=new _9({color:[1,.5,0,1]}),this._debugFaceNormalMaterial=new _9({color:[0,1,1,1]}))}destroy(){super.destroy(),this._textures.forEach(e=>e.unload()),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}get materials(){return this._materialInfoCache.materials}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,vCt,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(i),s=e.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,i){const r=this._getLayerOpacity();this._updateMaterialParameters(s=>{s.material.setParameters({layerOpacity:r});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),e.forEach(s=>{var n;return(n=i(s))==null?void 0:n.layerOpacityChanged(r,this._context.isAsync)})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Fb)}slicePlaneEnabledChanged(e,i){return this._updateMaterialParameters(({material:r})=>{r.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(r=>{var s;return(s=i(r))==null?void 0:s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters(({material:i})=>i.setParameters({usePBR:e})),!0}updateTransform(e,i,r,s){if(!e.fastTransformUpdatesAllowed)return!1;const n=e.fastTransformUpdatesEnabled;switch(s){case sg.EnableFastUpdates:if(n)return!0;break;case sg.DisableFastUpdates:if(!n)return!0;break;default:if(!n)return!!this.updateTransform(e,i,r,sg.EnableFastUpdates)&&(e.autoDisableFastTransformUpdates(()=>this.updateTransform(e,i,r,sg.DisableFastUpdates)),!0)}const o=this._context.renderCoordsHelper.spatialReference,a=$Ct,{origin:l,transform:c}=r;if(!$h(i,de(ts,l.x,l.y,l.z??0),a,o))return!1;switch(s){case sg.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case sg.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case sg.UpdateFastLocalOrigin:e.updateFastLocalOrigin(a,c,this._context.localOriginFactory)}const{elevationContext:u}=e;u.centerPointInElevationSR=this._getCenterPointInElevationSR(a);const{elevationProvider:d,renderCoordsHelper:f}=this._context,m=(g,y)=>Nb(g,d,u,f,y);return e.alignedSampledElevation=yS(e,u,d.spatialReference,m,f,a),e.updateTransform(a,c,this._context.isAsync),e.updateAutoDisableFastTransformUpdates(()=>this.updateTransform(e,i,r,sg.DisableFastUpdates)),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_materialPropertiesDefault(e,i){const r=this._requiresSymbolVertexColors(),s=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${i},svc:${r}`}}_materialProperties(e,i,r){const s=this._materialPropertiesDefault(e,r);if(!i.material)return s;const{color:n,colorTexture:o,colorTextureTransform:a,normalTexture:l,normalTextureTransform:c,doubleSided:u,alphaCutoff:d,alphaMode:f}=i.material,m=zw(n),g=zw(o),y=pR(a),v=zw(l),b=pR(c);if(s.color=n,s.colorTexture=o,s.normalTexture=l,s.uid=`${s.uid},cmuid:${m},ctmuid:${g},cttuid:${y},ntmuid:${v},nttuid:${b},ds:${u},ac:${d},am:${f}`,i.material instanceof g4e){const{metallic:w,roughness:x,metallicRoughnessTexture:S,metallicRoughnessTextureTransform:C,emissiveColor:M,emissiveTexture:O,emissiveTextureTransform:D,occlusionTexture:U,occlusionTextureTransform:k}=i.material,H=zw(S),V=pR(C),X=zw(M),q=zw(O),Z=pR(D),ye=zw(U),L=pR(k);s.metallic=w,s.roughness=x,s.metallicRoughnessTexture=S,s.emissiveColor=M,s.emissiveTexture=O,s.occlusionTexture=U,s.colorTextureTransform=dR(a),s.normalTextureTransform=dR(c),s.emissiveTextureTransform=dR(D),s.occlusionTextureTransform=dR(k),s.metallicRoughnessTextureTransform=dR(C),s.uid=`${s.uid},mrm:${w},mrr:${x},mrt:${H},mrtt:${V},emuid:${X},etmuid:${q},ett:${Z},otmuid:${ye},ott:${L}`}return s}_getInternalTextureId(e){const i=this._getInternalTexture(e,Rr.Opaque);return i==null?void 0:i.id}_getInternalTexture(e,i){const r=PCt(e);if(!r)return null;const s=`${e.contentHash}/${i}`;let n=this._textures.get(s);if(!n){let o=null;const a=this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy,l={wrap:CCt(e.wrap),noUnpackFlip:!0,maxAnisotropy:a,mipmap:a>1};C3(r)?(o=r.data,l.preMultiplyAlpha=!1,l.encoding=r.encoding):(o=r,l.preMultiplyAlpha=i!==Rr.Opaque,l.downsampleUncompressed=this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled),n=new Vb(o,l),this._textures.set(s,n),n.load(this._context.stage.renderView.renderingContext),this._context.stage.add(n)}return n}_setInternalMaterialParameters(e,i){var s,n;if(e.color!=null&&ACt(e.color,i),e.colorTexture!=null){const o=this._getInternalTexture(e.colorTexture,i.textureAlphaMode);o?(i.textureId=o.id,i.textureAlphaPremultiplied=!!o.parameters.preMultiplyAlpha):i.textureId=void 0}e.normalTexture&&(i.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor&&(i.emissiveFactor=Qe.toUnitRGB(e.emissiveColor)),e.emissiveTexture&&(i.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture&&(i.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture&&(i.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),i.colorTextureTransformMatrix=Tg(e.colorTextureTransform),i.normalTextureTransformMatrix=Tg(e.normalTextureTransform);const r=((s=e.normalTextureTransform)==null?void 0:s.scale)!=null?(n=e.normalTextureTransform)==null?void 0:n.scale:mG;i.scale=[r[0],r[1]],i.occlusionTextureTransformMatrix=Tg(e.occlusionTextureTransform),i.emissiveTextureTransformMatrix=Tg(e.emissiveTextureTransform),i.metallicRoughnessTextureTransformMatrix=Tg(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){var s,n;const i=this._drivenProperties.color;let r=((s=this.symbolLayer.material)==null?void 0:s.colorMixMode)??null;if(i)e.externalColor=Ud;else{const o=((n=this.symbolLayer.material)==null?void 0:n.color)??null;o?e.externalColor=Qe.toUnitRGBA(o):(r=null,e.externalColor=Ud)}r&&(e.colorMixMode=r),e.castShadows=!!this.symbolLayer.castShadows}_getOrCreateMaterial(e,i){var g,y,v;const r=(g=i.material)==null?void 0:g.color,s=(y=i.material)==null?void 0:y.colorTexture,n=(v=i.material)==null?void 0:v.alphaMode,o=n==="blend",a=n!=="opaque"&&(MCt(e)||r!=null&&r.a<1||(s==null?void 0:s.transparent)||o),l=this._materialProperties(e,i,a),c=this._materialInfoCache.byUid(l.uid);if(c)return c.material;const u={uid:l.uid,material:null,isComponentTransparent:a,alphaMode:i.material?i.material.alphaMode:"opaque"},d=BLe({normalTexture:l.normalTexture,metallicRoughnessTexture:l.metallicRoughnessTexture,metallicFactor:l.metallic,roughnessFactor:l.roughness,emissiveTexture:l.emissiveTexture,emissiveFactor:Qe.toUnitRGB(l.emissiveColor),occlusionTexture:l.occlusionTexture}),f={usePBR:this._usePBR(),isSchematic:d,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:On,diffuse:V0,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Br.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};f.mrrFactors=d?[...aoe]:[l.metallic,l.roughness,C6[2]],i.material&&(f.doubleSided=i.material.doubleSided,f.cullFace=i.material.doubleSided?Br.None:Br.Back,f.textureAlphaCutoff=i.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,u),this._setInternalMaterialParameters(l,f);const m=new em(f);return u.material=m,this._materialInfoCache.set(l.uid,u),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,i){e.transparent=this.needsDrivenTransparentPass||i.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,i.alphaMode==="auto"?e.textureAlphaMode=e.transparent?Rr.MaskBlend:Rr.Opaque:e.textureAlphaMode=i.alphaMode==="opaque"?Rr.Opaque:i.alphaMode==="mask"?Rr.Mask:Rr.Blend}_createFaceDebugNormals(e,i){const r=i.length,s=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*s,e.extent.height*s,e.extent.zmax-e.extent.zmin),o=[],a=[],l=i[0].transformation,c=Mb(Yr(),l);for(let u=0;u<r;u++){const d=i[u].attributes.get(R.POSITION);if(!d)continue;const f=d.data,m=d.indices;for(let g=0;g<m.length;g+=3)W6(f,m,g,fg),C4e(f,m,g,ts,Ad,CM),Ee(ts,ts,Ad),Ee(ts,ts,CM),he(ts,ts,1/3),nt(ts,ts,l),o.push(...ts),ta(fg,fg,c),Ce(fg,fg),Pn(ts,ts,fg,n),o.push(...ts),a.push(a.length),a.push(a.length)}return o.length?new Tn(this._debugFaceNormalMaterial,[[R.POSITION,new ht(o,a,3,!0)]],null,Fs.Line):null}_createPerVertexDebugVectors(e,i,r,s,n){const o=i.length,a=e.spatialReference.isGeographic?20015077/180:1,l=.1*n*Math.max(e.extent.width*a,e.extent.height*a,e.extent.zmax-e.extent.zmin),c=[],u=[],d=i[0].transformation,f=Mb(Yr(),d);r===R.TANGENT&&lp(f,d);for(let m=0;m<o;m++){const g=i[m],y=g.attributes.get(R.POSITION),v=g.attributes.get(r);if(!y||!v)continue;const b=y.data,w=y.indices,x=v.data,S=v.indices;for(let C=0;C<w.length;C++){const M=3*w[C],O=S[C]*v.stride;de(ts,b[M+0],b[M+1],b[M+2]),nt(ts,ts,d),c.push(...ts),de(Ad,x[O+0],x[O+1],x[O+2]),ta(Ad,Ad,f),Ce(Ad,Ad),Pn(ts,ts,Ad,l),c.push(...ts),u.push(u.length),u.push(u.length)}}return c.length?new Tn(s,[[R.POSITION,new ht(c,u,3,!0)]],null,Fs.Line):null}_createAs3DShape(e,i,r,s){const n=e.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,i,s);if(o==null)return null;const{geometries:a,objectTransformation:l}=o;if(Nr.DRAW_MESH_GEOMETRY_NORMALS){const v=this._createPerVertexDebugVectors(n,a,R.NORMAL,this._debugVertexNormalMaterial,1),b=this._createPerVertexDebugVectors(n,a,R.TANGENT,this._debugTangentNormalMaterial,.5),w=this._createFaceDebugNormals(n,a);v&&a.push(v),b&&a.push(b),w&&a.push(w)}const c=new ow({geometries:a,layerUid:this._context.layer.uid,graphicUid:s,isElevationSource:!0});c.transformation=l;const u=PLe(this.symbolLayer,{opacity:this._getLayerOpacity()}),d=u?new f0t(a[0].material,[u],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,f=new nCt(this,c,a,null,null,yS,r,d);this._fastUpdateProcessor.onAddGraphic(),f.needsElevationUpdates=Fb(r.mode),f.useObjectOriginAsAttachmentOrigin=!0,f.fastTransformUpdatesAllowed=this._fastTransformUpdatesAllowed(n),r.centerPointInElevationSR=this._getCenterPointInElevationSR(c.transformation);const{elevationProvider:m,renderCoordsHelper:g}=this._context,y=(v,b)=>Nb(v,m,r,g,b);return f.alignedSampledElevation=yS(f,r,m.spatialReference,y,g),f}_fastTransformUpdatesAllowed(e){const{vertexSpace:i,spatialReference:r}=e;if(!G6(i))return!1;const{type:s}=i,{view:n}=this._context.graphicsCoreOwner,{viewingMode:o}=n.state,a=n.spatialReference;return o===Xe.Global&&s==="local"||o===Xe.Local&&hs(a,r)&&s==="georeferenced"&&!r.isGeographic}_getCenterPointInElevationSR(e){const i=Zb(0,0,0,this._context.elevationProvider.spatialReference!=null?this._context.elevationProvider.spatialReference:null);return Yb([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,i),i}_passthroughReprojectionInfo(e){return e.reprojection===lu.NONE&&!!e.objectTransformation}_createPositionBuffer(e,i){const r=e.vertexAttributes.position;let s=r,n=null;if(i.reprojection===lu.NONE)return{position:s,georeferencedPositionBuffer:n};const o=i.reprojection===lu.RENDER?i.transformBeforeProject:null;o&&(s=Ub(new Float64Array(s.length),s,o));const{normal:a,tangent:l}=e.vertexAttributes;this._passthroughReprojectionInfo(i)||!a&&!l||(n=s);const c=s===r||s===n?new Float64Array(s.length):s;return ds(s,e.spatialReference,0,c,this._context.renderCoordsHelper.spatialReference,0,s.length/3),{position:c,georeferencedPositionBuffer:n}}_createNormalBuffer(e,i,r,s){const n=e.vertexAttributes.normal;if(n==null)return null;let o=n;const a=s.reprojection===lu.RENDER?s.transformBeforeProject:null;a&&(o=wK(o,new Float32Array(o.length),a));const l=this._context.graphicsCoreOwner.view.viewingMode;if(s.reprojection===lu.NONE)return o;if(l==="local"){if(!$S(this._context.renderCoordsHelper.spatialReference))return o;if(r==null)return null;if(e.spatialReference.isGeographic){const u=o===n?new Float32Array(o.length):o;return TK(o,cl.NORMAL,r,u)}if(e.spatialReference.isWebMercator){const u=o===n?new Float32Array(o.length):o;return SK(o,cl.NORMAL,r,u)}return o}if(r==null)return null;const c=o===n?new Float32Array(o.length):o;return y4e(o,r,i,e.spatialReference,c)}_createTangentBuffer(e,i,r,s){const n=e.vertexAttributes.tangent;if(n==null)return null;let o=n;const a=s.reprojection===lu.RENDER?s.transformBeforeProject:null;a&&(o=xK(o,new Float32Array(o.length),a));const l=this._context.graphicsCoreOwner.view.viewingMode;if(s.reprojection===lu.NONE)return o;if(l==="local"){if(!$S(this._context.renderCoordsHelper.spatialReference))return o;if(r==null)return null;if(e.spatialReference.isGeographic){const u=o===n?new Float32Array(o.length):o;return TK(o,cl.TANGENT,r,u)}if(e.spatialReference.isWebMercator){const u=o===n?new Float32Array(o.length):o;return SK(o,cl.TANGENT,r,u)}return o}if(r==null)return null;const c=o===n?new Float32Array(o.length):o;return v4e(o,r,i,e.spatialReference,c)}_createSymbolColorBuffer(e){var i,r;if(this._requiresSymbolVertexColors()){const s=this._getVertexOpacityAndColor(e),n=E0t((r=(i=this.symbolLayer)==null?void 0:i.material)==null?void 0:r.colorMixMode),o=new Uint8Array(4);return MLe(s,n,o),o}return null}_createBuffers(e,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=e.vertexAttributes.normal,n=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(s&&s.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(o&&o.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(n&&n.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),{position:l,georeferencedPositionBuffer:c}=this._createPositionBuffer(e,a),u=OCt(e),d=this._createSymbolColorBuffer(i),f=this._createNormalBuffer(e,l,c,a),m=this._createTangentBuffer(e,l,c,a),g=n,{transformation:y,position:v,normal:b,tangent:w}=this._passthroughReprojectionInfo(a)?{transformation:a.objectTransformation,position:l,normal:f,tangent:m}:this._transformOriginLocal(e,l,f,m);return{positionBuffer:v,normalBuffer:b,tangentBuffer:w,uvBuffer:g,colorBuffer:u,symbolColorBuffer:d,objectTransformation:y,geometryTransformation:a.reprojection===lu.NONE&&a.geometryTransformation?a.geometryTransformation:ke()}}_computeReprojectionInfo(e){var l;const{vertexSpace:i}=e,r=i.type==="georeferenced"?hs(this._context.renderCoordsHelper.spatialReference,e.spatialReference)?lu.NONE:lu.RENDER:lu.NONE;if(kEt(i))return{reprojection:r};const s=i.origin,n=ke(),o=((l=e.transform)==null?void 0:l.localMatrix)??Wr;if(r===lu.NONE)return $h(e.spatialReference,s,n,this._context.renderCoordsHelper.spatialReference),{reprojection:r,objectTransformation:n,geometryTransformation:YA(o)};const a=g2(ke(),s);return gr(a,a,o),{reprojection:r,transformBeforeProject:a}}_transformOriginLocal(e,i,r,s){const n=this._context.renderCoordsHelper.spatialReference,o=e.anchor;D4[0]=o.x,D4[1]=o.y,D4[2]=o.z??0;const a=ke();$h(e.spatialReference,D4,a,n),Zn(N4,a);const{position:l,normal:c,tangent:u}=e.vertexAttributes,d=i===l?new Float64Array(i.length):i;Ub(d,i,N4);const f=r?r===c?new Float32Array(r.length):r:null,m=s?s===u?new Float32Array(s.length):s:null;return r&&f&&wK(r,f,N4),s&&m&&xK(s,m,N4),{transformation:a,position:d,normal:f,tangent:m}}_validateFaces(e,i){const r=e.vertexAttributes.position.length/3,s=i.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(r<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_isOutsideClippingArea(e){var o;if(!this._context.clippingExtent)return!1;const i=(o=e.vertexAttributes)==null?void 0:o.position;if(!i)return!1;const r=this._context.elevationProvider.spatialReference,s=b4e({positions:i,transform:e.transform,vertexSpace:e.vertexSpace,inSpatialReference:e.spatialReference,outSpatialReference:r??e.spatialReference,localMode:this._context.stage.viewingMode===Xe.Local});if(!s)return!1;const n=s.length/3;return Zr(S9),Mh(S9,s,0,n),!Mf(S9,this._context.clippingExtent)}_createGeometryInfo(e,i,r){if(!Bc(e.spatialReference,this._context.renderCoordsHelper.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(!this._validateVertexSpace(e)||this._isOutsideClippingArea(e))return null;const s=this._createBuffers(e,i);if(s==null)return null;const{positionBuffer:n,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:u,objectTransformation:d,geometryTransformation:f}=s,m=ECt(e),g=new Array;let y=!1;const v=mz(ts,d),b=this._context.localOriginFactory.getOrigin(v);for(const w of m){if(!this._validateFaces(e,w))return null;const x=wCt(e,w);if(x.length===0)continue;const S=xCt(n,c,w,x);S.didFlipNormals&&(y=!0);const C=[[R.POSITION,new ht(n,x,3,!0)],[R.NORMAL,new ht(S.normals,S.indices,3,!0)]];a&&C.push([R.COLOR,new ht(a,x,4,!0)]),l&&C.push([R.SYMBOLCOLOR,new ht(l,tw(x.length),4,!0)]),o&&C.push([R.UV0,new ht(o,x,2,!0)]),u&&C.push([R.TANGENT,new ht(u,x,4,!0)]);const M=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerUid:this._context.layer.uid}),O=this._getOrCreateMaterial(e,w),D=new Tn(O,C,null,Fs.Mesh,M);D.transformation=f,D.localOrigin=b,g.push(D)}return y&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:g,objectTransformation:d}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial((i,r)=>{r.setParameters(i.parameters)})}_validateVertexSpace(e){const{_context:{graphicsCoreOwner:{view:{state:{viewingMode:i}}}}}=this,{vertexSpace:r}=e;return i!==Xe.Local||r.type!=="local"||(this.logger.warn("Displaying a mesh with a local vertex space in a view in local viewing mode is not supported."),!1)}test(){return{...super.test(),materials:this._materialInfoCache.materials}}},Yoe=class{constructor(e,i,r){this.normals=e,this.indices=i,this.didFlipNormals=r}};function wCt(t,e){return e.faces??R2(t.vertexAttributes.position.length/3)}function xCt(t,e,i,r){switch(i.shading||"flat"){default:case"source":return TCt(t,e,i,r);case"flat":return E4e(t,r);case"smooth":return SCt(t,r)}}function E4e(t,e){const i=Es(e.length),r=new Array(3*e.length);for(let s=0;s<e.length;s+=3){const n=W6(t,e,s,fg);for(let o=0;o<3;o++)i[s+o]=n[o],r[s+o]=s/3}return new Yoe(i,r,!1)}function TCt(t,e,i,r){if(e==null)return E4e(t,r);let s=!1;if(!i.trustSourceNormals)for(let n=0;n<r.length;n+=3){W6(t,r,n,fg);for(let o=0;o<3;o++){const a=3*r[n+o];ts[0]=e[a],ts[1]=e[a+1],ts[2]=e[a+2],Te(fg,ts)<0&&(e[a]=-e[a],e[a+1]=-e[a+1],e[a+2]=-e[a+2],s=!0)}}return new Yoe(e,r,s)}function SCt(t,e){const i={};for(let n=0;n<e.length;n+=3){const o=W6(t,e,n,fg);for(let a=0;a<3;a++){const l=e[n+a];let c=i[l];c||(c={normal:E(),count:0},i[l]=c),Ee(c.normal,c.normal,o),c.count++}}const r=Es(3*e.length),s=new Array(3*e.length);for(let n=0;n<e.length;n++){const o=i[e[n]];o.count!==1&&(Ce(o.normal,o.normal),o.count=1);for(let a=0;a<3;a++)r[3*n+a]=o.normal[a];s[n]=n}return new Yoe(r,s,!1)}function C4e(t,e,i,r,s,n){const o=3*e[i],a=3*e[i+1],l=3*e[i+2];r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2],s[0]=t[a],s[1]=t[a+1],s[2]=t[a+2],n[0]=t[l],n[1]=t[l+1],n[2]=t[l+2]}function W6(t,e,i,r){return C4e(t,e,i,ts,Ad,CM),Re(Ad,Ad,ts),Re(CM,CM,ts),ft(ts,Ad,CM),Ce(r,ts),r}function ECt(t){return t.components??ICt}function dR(t){if(!t)return null;const{scale:e,offset:i,rotation:r}=t;return{scale:e,offset:i,rotation:kt(r)}}function CCt(t="repeat"){if(typeof t=="string"){const e=T9(t);return{s:e,t:e}}return{s:T9(t.horizontal),t:T9(t.vertical)}}function T9(t){switch(t){case"clamp":return Mi.CLAMP_TO_EDGE;case"mirror":return Mi.MIRRORED_REPEAT;default:return Mi.REPEAT}}function MCt(t){const e=t.vertexAttributes.color;if(e==null)return!1;for(let i=3;i<e.length;i+=4)if(e[i]!==255)return!0;return!1}function ACt(t,e){e.diffuse=Qe.toUnitRGB(t),e.opacity=t.a}function PCt(t){return t.data??t.url}function zw(t){return t==null?"-":t instanceof Qe?t.toHex():t.contentHash}function pR(t){const{offset:e,scale:i,rotation:r}=t??RCt;return`${e[0]},${e[1]},${r},${i[0]},${i[1]}`}function OCt(t){return t.vertexAttributes.color}const RCt=new mA,D4=E(),ts=E(),Ad=E(),CM=E(),fg=E(),N4=ke(),$Ct=ke(),S9=Xn(),ICt=[new DEt];var lu;(function(t){t[t.NONE=0]="NONE",t[t.RENDER=1]="RENDER"})(lu||(lu={}));let LCt=class{constructor(e,i,r,s){this.graphics3DSymbolLayer=e,this.instanceIndex=i,this.elevationAligner=r,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const i=this._lodRenderer.instanceData;e!==i.getVisible(this.instanceIndex)&&i.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,i,r){if(this.elevationAligner){T6(this.elevationContext.featureExpressionInfoContext,r);const s=(o,a)=>Nb(o,e,this.elevationContext,i,a),n=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,i);n!=null&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(e=E()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,xm),nt(e,this._lodRenderer.baseBoundingSphere.center,xm)}getBoundingBoxObjectSpace(e=Xn()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,xm);const i=this._lodRenderer.baseBoundingBox;Zr(e);for(let r=0;r<8;++r)de(rd,1&r?i[3]:i[0],2&r?i[4]:i[1],4&r?i[5]:i[2]),nt(rd,rd,xm),Yf(e,rd);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,xm),e.render.origin[0]+=xm[12],e.render.origin[1]+=xm[13],e.render.origin[2]+=xm[14],e.render.num++}async getProjectedBoundingBox(e,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=DCt,l=Mse(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,xm);for(let u=0;u<l;u++){const d=a[u];rd[0]=o[d[0]],rd[1]=o[d[1]],rd[2]=o[d[2]],nt(rd,rd,xm),Bw[3*u]=rd[0],Bw[3*u+1]=rd[1],Bw[3*u+2]=rd[2]}if(!e(Bw,0,l))return null;Zr(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],Bw[u+d]),o[d+3]=Math.max(o[d+3],Bw[u+d]);c&&r.push({location:Bw.slice(u,u+3),screenSpaceBoundingRect:c})}if(i&&(Cf(o,E9),this.elevationContext.mode!=="absolute-height")){let u;const d=Jne(o,i.service.spatialReference,i);try{u=await i.service.queryElevation(E9[0],E9[1],s,d,"ground")}catch{}u!=null&&POe(o,0,0,-this.alignedSampledElevation+u)}return o}addObjectState(e,i){if(e===d_.Highlight){const r=new eB(e);this._addHighlightId(r),i.addExternal(s=>{this._removeHighlightId(s)},r)}}removeObjectState(e){this._highlights.forEach(i=>e.remove(i))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const Bw=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],rd=E(),E9=E(),DCt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],xm=ke();function NCt(t,e){const i=t.stageResources.geometries.map(s=>new xLe(s,t.stageResources.textures)),r=t.lodThreshold==null||t.lodThreshold===0&&e>0?kCt(i):t.lodThreshold;return new TLe(i,r,t.pivotOffset)}function FCt(t){return new SLe(t.map((e,i)=>NCt(e,i)))}function kCt(t){const e=t.reduce((i,{geometry:r})=>i+r.indexCount/3,0);return Math.sqrt(e*UCt/Math.PI)}const UCt=20;function VCt(t){return t=t||globalThis.location.hostname,zCt.some(e=>(t==null?void 0:t.match(e))!=null)}function EK(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(M4e)!=null||e.match(P4e)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(A4e)!=null||e.match(O4e)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const M4e=/^devext\.arcgis\.com$/,A4e=/^qaext\.arcgis\.com$/,P4e=/^[\w-]*\.mapsdevext\.arcgis\.com$/,O4e=/^[\w-]*\.mapsqa\.arcgis\.com$/,zCt=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local\.esri\.com$/,M4e,A4e,/^jsapps\.esri\.com$/,P4e,O4e];function BCt(t,e){Xoe(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function Xoe(t,e,i=2,r=i){const s=e.length/2;let n=0,o=0;if(Zg(e)||x6e(e)){for(let l=0;l<s;++l)t[n]=e[o],t[n+1]=e[o+1],n+=i,o+=r;return}const a=T6e(e);if(w6e(e))for(let l=0;l<s;++l)t[n]=Math.max(e[o]/a,-1),t[n+1]=Math.max(e[o+1]/a,-1),n+=i,o+=r;else for(let l=0;l<s;++l)t[n]=e[o]/a,t[n+1]=e[o+1]/a,n+=i,o+=r}function jCt(t,e,i,r){const s=t.typedBuffer,n=t.typedBufferStride,o=(r==null?void 0:r.count)??t.count;let a=((r==null?void 0:r.dstIndex)??0)*n;for(let l=0;l<o;++l)s[a]=e,s[a+1]=i,a+=n}Object.freeze(Object.defineProperty({__proto__:null,fill:jCt,normalizeIntegerBuffer:Xoe,normalizeIntegerBufferView:BCt},Symbol.toStringTag,{value:"Module"}));function GCt(t,e){Z6(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function Z6(t,e,i=3,r=i){const s=e.length/r;let n=0,o=0;for(let a=0;a<s;++a)t[n]=e[o],t[n+1]=e[o+1],t[n+2]=e[o+2],n+=i,o+=r}function HCt(t,e,i,r,s){const n=t.typedBuffer,o=t.typedBufferStride,a=(s==null?void 0:s.count)??t.count;let l=((s==null?void 0:s.dstIndex)??0)*o;for(let c=0;c<a;++c)n[l]=e,n[l+1]=i,n[l+2]=r,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:Z6,copyView:GCt,fill:HCt},Symbol.toStringTag,{value:"Module"}));function qCt(t,e){Joe(t.typedBuffer,e,t.typedBufferStride)}function Joe(t,e,i=4){const r=e.typedBuffer,s=e.typedBufferStride,n=e.count;let o=0,a=0;for(let l=0;l<n;++l)t[o]=r[a],t[o+1]=r[a+1],t[o+2]=r[a+2],t[o+3]=r[a+3],o+=i,a+=s}function WCt(t,e,i,r,s,n){const o=t.typedBuffer,a=t.typedBufferStride,l=(n==null?void 0:n.count)??t.count;let c=((n==null?void 0:n.dstIndex)??0)*a;for(let u=0;u<l;++u)o[c]=e,o[c+1]=i,o[c+2]=r,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:Joe,copyView:qCt,fill:WCt},Symbol.toStringTag,{value:"Module"}));let R4e=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,i){return this._load("json",e,i)}async loadBinary(e,i){return cy(e)?(Dt(i),kie(e)):this._load("binary",e,i)}async loadImage(e,i){return this._load("image",e,i)}async _load(e,i,r){if(this._streamDataRequester==null)return(await yr(i,{responseType:ZCt[e]})).data;const s=await Vh(this._streamDataRequester.request(i,e,r));if(s.ok===!0)return s.value;throw jl(s.error),new G("",`Request for resource failed: ${s.error}`)}};const ZCt={image:"image",binary:"array-buffer",json:"json","image+type":void 0};function YCt(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function XCt(t,e={}){return{data:t,parameters:{wrap:{s:Mi.REPEAT,t:Mi.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}function RU(t,e){const i=t.count;e||(e=new t.TypedArrayConstructor(i));for(let r=0;r<i;r++)e[r]=t.get(r);return e}Object.freeze(Object.defineProperty({__proto__:null,makeDense:RU},Symbol.toStringTag,{value:"Module"}));let S0e=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const i=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,i,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var M3,E0e;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(M3||(M3={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(E0e||(E0e={}));const $4e={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},JCt={pbrMetallicRoughness:$4e,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},QCt={ESRI_externalColorMixMode:"tint",ESRI_receiveShadows:!0,ESRI_receiveAmbientOcclusion:!0},C0e=(t={})=>{const e={...$4e,...t.pbrMetallicRoughness},i=KCt({...QCt,...t.extras});return{...JCt,...t,pbrMetallicRoughness:e,extras:i}};function KCt(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode="tint"}return t}const eMt={magFilter:di.LINEAR,minFilter:di.LINEAR_MIPMAP_LINEAR,wrapS:Mi.REPEAT,wrapT:Mi.REPEAT},tMt=t=>({...eMt,...t});function iMt(t){let e,i;return t.replace(/^(.*\/)?([^/]*)$/,(r,s,n)=>(e=s||"",i=n||"","")),{dirPart:e,filePart:i}}const F4={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let rMt=class Xv{constructor(e,i,r,s){if(this._context=e,this.uri=i,this.json=r,this._glbBuffer=s,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu","KHR_texture_transform"],this._baseUri=iMt(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),r.scenes==null)throw new G("gltf-loader-unsupported-feature","Scenes must be defined.");if(r.meshes==null)throw new G("gltf-loader-unsupported-feature","Meshes must be defined");if(r.nodes==null)throw new G("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,i,r){if(cy(i)){const o=mb(i);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new Xv(e,i,l)}catch{}const a=kie(i);if(Xv._isGLBData(a))return this._fromGLBData(e,i,a)}if(cMt.test(i)||(r==null?void 0:r.expectedType)==="gltf"){const o=await e.loadJSON(i,r);return new Xv(e,i,o)}const s=await e.loadBinary(i,r);if(Xv._isGLBData(s))return this._fromGLBData(e,i,s);if(uMt.test(i)||(r==null?void 0:r.expectedType)==="glb")throw new G("gltf-loader-invalid-glb","This is not a valid glb file.");const n=await e.loadJSON(i,r);return new Xv(e,i,n)}static _isGLBData(e){if(e==null)return!1;const i=new S0e(e);return i.remainingBytes()>=4&&i.readUint32()===F4.MAGIC}static async _fromGLBData(e,i,r){const s=await Xv._parseGLBData(r);return new Xv(e,i,s.json,s.binaryData)}static async _parseGLBData(e){const i=new S0e(e);if(i.remainingBytes()<12)throw new G("gltf-loader-error","glb binary data is insufficiently large.");const r=i.readUint32(),s=i.readUint32(),n=i.readUint32();if(r!==F4.MAGIC)throw new G("gltf-loader-error","Magic first 4 bytes do not fit to expected glb value.");if(e.byteLength<n)throw new G("gltf-loader-error","glb binary data is smaller than header specifies.");if(s!==2)throw new G("gltf-loader-unsupported-feature","An unsupported glb container version was detected. Only version 2 is supported.");let o,a,l=0;for(;i.remainingBytes()>=8;){const c=i.readUint32(),u=i.readUint32();if(l===0){if(u!==F4.CHUNK_TYPE_JSON)throw new G("gltf-loader-error","First glb chunk must be JSON.");if(c<0)throw new G("gltf-loader-error","No JSON data found.");o=await iCt(i.readUint8Array(c))}else if(l===1){if(u!==F4.CHUNK_TYPE_BIN)throw new G("gltf-loader-unsupported-feature","Second glb chunk expected to be BIN.");a=i.readUint8Array(c)}else se.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 glb chunks detected. Skipping.");l+=1}if(!o)throw new G("gltf-loader-error","No glb JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,i){const r=this.json.buffers[e];if(r.uri==null){if(this._glbBuffer==null)throw new G("gltf-loader-error","glb buffer not present");return this._glbBuffer}const s=await this._getBufferLoader(e,i);if(s.byteLength!==r.byteLength)throw new G("gltf-loader-error","Buffer byte lengths should match.");return s}async _getBufferLoader(e,i){const r=this._bufferLoaders.get(e);if(r)return r;const s=this.json.buffers[e].uri,n=this._context.loadBinary(this._resolveUri(s),i).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,n),n}async getAccessor(e,i){if(!this.json.accessors)throw new G("gltf-loader-unsupported-feature","Accessors missing.");const r=this.json.accessors[e];if((r==null?void 0:r.bufferView)==null)throw new G("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(r.type in[M3.MAT2,M3.MAT3,M3.MAT4])throw new G("gltf-loader-unsupported-feature",`AttributeType ${r.type} is not supported`);const s=this.json.bufferViews[r.bufferView],n=await this.getBuffer(s.buffer,i),o=oMt[r.type],a=aMt[r.componentType],l=o*a,c=s.byteStride||l;return{raw:n.buffer,byteStride:c,byteOffset:n.byteOffset+(s.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized}}async getIndexData(e,i){if(e.indices==null)return;const r=await this.getAccessor(e.indices,i);if(r.isDenselyPacked)switch(r.componentType){case St.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case St.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case St.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case St.UNSIGNED_BYTE:return RU(sd(hP,r));case St.UNSIGNED_SHORT:return RU(sd(i6,r));case St.UNSIGNED_INT:return RU(sd(s6,r))}}async getPositionData(e,i){if(e.attributes.POSITION==null)throw new G("gltf-loader-unsupported-feature","No POSITION vertex data found.");const r=await this.getAccessor(e.attributes.POSITION,i);if(r.componentType!==St.FLOAT)throw new G("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+St[r.componentType]);if(r.componentCount!==3)throw new G("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return sd(ho,r)}async getNormalData(e,i){if(e.attributes.NORMAL==null)throw new G("gltf-loader-error","No NORMAL vertex data found.");const r=await this.getAccessor(e.attributes.NORMAL,i);if(r.componentType!==St.FLOAT)throw new G("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+St[r.componentType]);if(r.componentCount!==3)throw new G("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return sd(ho,r)}async getTangentData(e,i){if(e.attributes.TANGENT==null)throw new G("gltf-loader-error","No TANGENT vertex data found.");const r=await this.getAccessor(e.attributes.TANGENT,i);if(r.componentType!==St.FLOAT)throw new G("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+St[r.componentType]);if(r.componentCount!==4)throw new G("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+r.componentCount.toFixed());return new Kf(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*r.entryCount)}async getTextureCoordinates(e,i){if(e.attributes.TEXCOORD_0==null)throw new G("gltf-loader-error","No TEXCOORD_0 vertex data found.");const r=await this.getAccessor(e.attributes.TEXCOORD_0,i);if(r.componentCount!==2)throw new G("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+r.componentCount.toFixed());if(r.componentType===St.FLOAT)return sd(O2,r);if(!r.normalized)throw new G("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return lMt(r)}async getVertexColors(e,i){if(e.attributes.COLOR_0==null)throw new G("gltf-loader-error","No COLOR_0 vertex data found.");const r=await this.getAccessor(e.attributes.COLOR_0,i);if(r.componentCount!==4&&r.componentCount!==3)throw new G("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+r.componentCount.toFixed());if(r.componentCount===4){if(r.componentType===St.FLOAT)return sd(Kf,r);if(r.componentType===St.UNSIGNED_BYTE)return sd(ml,r);if(r.componentType===St.UNSIGNED_SHORT)return sd(kD,r)}else if(r.componentCount===3){if(r.componentType===St.FLOAT)return sd(ho,r);if(r.componentType===St.UNSIGNED_BYTE)return sd(t6,r);if(r.componentType===St.UNSIGNED_SHORT)return sd(r6,r)}throw new G("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+St[r.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,i,r){var n,o,a,l,c,u,d,f,m,g;let s=e.material?this._materialCache.get(e.material):void 0;if(!s){const y=e.material!=null?C0e(this.json.materials[e.material]):C0e(),v=y.pbrMetallicRoughness,b=this.hasVertexColors(e),w=this.getTexture(v.baseColorTexture,i),x=this.getTexture(y.normalTexture,i),S=r?this.getTexture(y.occlusionTexture,i):void 0,C=r?this.getTexture(y.emissiveTexture,i):void 0,M=r?this.getTexture(v.metallicRoughnessTexture,i):void 0,O=e.material!=null?e.material:-1;s={alphaMode:y.alphaMode,alphaCutoff:y.alphaCutoff,color:v.baseColorFactor,doubleSided:!!y.doubleSided,colorTexture:await w,normalTexture:await x,name:y.name,id:O,occlusionTexture:await S,emissiveTexture:await C,emissiveFactor:y.emissiveFactor,metallicFactor:v.metallicFactor,roughnessFactor:v.roughnessFactor,metallicRoughnessTexture:await M,hasVertexColors:b,ESRI_externalColorMixMode:y.extras.ESRI_externalColorMixMode,colorTextureTransform:(o=(n=v==null?void 0:v.baseColorTexture)==null?void 0:n.extensions)==null?void 0:o.KHR_texture_transform,normalTextureTransform:(l=(a=y.normalTexture)==null?void 0:a.extensions)==null?void 0:l.KHR_texture_transform,occlusionTextureTransform:(u=(c=y.occlusionTexture)==null?void 0:c.extensions)==null?void 0:u.KHR_texture_transform,emissiveTextureTransform:(f=(d=y.emissiveTexture)==null?void 0:d.extensions)==null?void 0:f.KHR_texture_transform,metallicRoughnessTextureTransform:(g=(m=v==null?void 0:v.metallicRoughnessTexture)==null?void 0:m.extensions)==null?void 0:g.KHR_texture_transform,receiveAmbientOcclusion:y.extras.ESRI_receiveAmbientOcclusion,receiveShadows:y.extras.ESRI_receiveShadows}}return s}async getTexture(e,i){if(!e)return;if((e.texCoord||0)!==0)throw new G("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const r=e.index,s=this.json.textures[r],n=tMt(s.sampler!=null?this.json.samplers[s.sampler]:{}),o=M0e(s),a=this.json.images[o],l=await this._loadTextureImageData(r,s,i);return cD(this._textureCache,r,()=>{const c=d=>d===33071||d===33648||d===10497,u=d=>{throw new G("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${d}`)};return{data:l,wrapS:c(n.wrapS)?n.wrapS:u(n.wrapS),wrapT:c(n.wrapT)?n.wrapT:u(n.wrapT),minFilter:n.minFilter,name:a.name,id:r}})}getNodeTransform(e){if(e===void 0)return sMt;let i=this._nodeTransformCache.get(e);if(!i){const r=this.getNodeTransform(this._getNodeParent(e)),s=this.json.nodes[e];s.matrix?i=gr(ke(),r,s.matrix):s.translation||s.rotation||s.scale?(i=YA(r),s.translation&&dl(i,i,s.translation),s.rotation&&(k4[3]=OG(k4,s.rotation),Au(i,i,k4[3],k4)),s.scale&&_D(i,i,s.scale)):i=YA(r),this._nodeTransformCache.set(e,i)}return i}_resolveUri(e){return Tu(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=ZP.parse(this.json.asset.version,"glTF");nMt.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(i=>this._supportedExtensions.includes(i)))throw new G("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,i)=>{e.children&&e.children.forEach(r=>{this._nodeParentMap.set(r,i)})})}async _loadTextureImageData(e,i,r){const s=this._textureLoaders.get(e);if(s)return s;const n=this._createTextureLoader(i,r);return this._textureLoaders.set(e,n),n}async _createTextureLoader(e,i){const r=M0e(e),s=this.json.images[r];if(s.uri){if(s.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(s.uri),i);return new w4e(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(s.uri),i)}if(s.bufferView==null)throw new G("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(s.mimeType==null)throw new G("gltf-loader-unsupported-feature","Image mimeType must be defined.");const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,i);if(n.byteStride!=null)throw new G("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(n.byteOffset||0);return rCt(new Uint8Array(o.buffer,a,n.byteLength),s.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await $W(Array.from(this._bufferLoaders.values())),i=await $W(Array.from(this._textureLoaders.values()));return e.reduce((r,s)=>r+((s==null?void 0:s.byteLength)??0),0)+i.reduce((r,s)=>r+(s?C3(s)?s.data.byteLength:s.width*s.height*4:0),0)}};const sMt=PEe(ke(),Math.PI/2),nMt=new ZP(2,0,"glTF"),k4=qh(),oMt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},aMt={[St.BYTE]:1,[St.UNSIGNED_BYTE]:1,[St.SHORT]:2,[St.UNSIGNED_SHORT]:2,[St.HALF_FLOAT]:2,[St.FLOAT]:4,[St.INT]:4,[St.UNSIGNED_INT]:4};function lMt(t){switch(t.componentType){case St.BYTE:return new n6(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case St.UNSIGNED_BYTE:return new e6(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case St.SHORT:return new UD(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case St.UNSIGNED_SHORT:return new hne(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case St.UNSIGNED_INT:return new dne(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case St.FLOAT:return new O2(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}function sd(t,e){return new t(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*(e.entryCount-1)+e.componentByteSize*e.componentCount)}function M0e(t){var e;if(((e=t.extensions)==null?void 0:e.KHR_texture_basisu)!=null)return t.extensions.KHR_texture_basisu.source;if(t.source!==null)return t.source;throw new G("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}const cMt=/\.gltf$/i,uMt=/\.glb$/i;let hMt=0;async function I4e(t,e,i={},r=!0){var d,f;const s=await rMt.load(t,e,i),n="gltf_"+hMt++,o={lods:[],materials:new Map,textures:new Map,meta:dMt(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=(f=(d=s.json.asset.extras)==null?void 0:d.ESRI_webstyleSymbol)==null?void 0:f.webstyle,c=new Map;await pMt(s,async(m,g,y,v)=>{var X;const b=c.get(y)??0;c.set(y,b+1);const w=m.mode!==void 0?m.mode:Ci.TRIANGLES,x=w===Ci.TRIANGLES||w===Ci.TRIANGLE_STRIP||w===Ci.TRIANGLE_FAN?w:null;if(x==null)return void se.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+Ci[w]+"). Skipping primitive.");if(!s.hasPositions(m))return void se.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const S=s.getPositionData(m,i),C=s.getMaterial(m,i,r),M=s.hasNormals(m)?s.getNormalData(m,i):null,O=s.hasTangents(m)?s.getTangentData(m,i):null,D=s.hasTextureCoordinates(m)?s.getTextureCoordinates(m,i):null,U=s.hasVertexColors(m)?s.getVertexColors(m,i):null,k=s.getIndexData(m,i),H={name:v,transform:YA(g),attributes:{position:await S,normal:M?await M:null,texCoord0:D?await D:null,color:U?await U:null,tangent:O?await O:null},indices:await k,primitiveType:x,material:mMt(o,await C,n)};let V=null;((X=o.meta)==null?void 0:X.ESRI_lod)!=null&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(V=o.meta.ESRI_lod.thresholds[y]),o.lods[y]=o.lods[y]||{parts:[],name:v,lodThreshold:V},o.lods[y].parts[b]=H});for(const m of o.lods)m.parts=m.parts.filter(g=>!!g);const u=await s.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri,ESRI_webstyle:l},customMeta:{},size:u}}function dMt(t){const e=t.json;let i=null;return e.nodes.forEach(r=>{const s=r.extras;s!=null&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(i=s)}),i}async function pMt(t,e){const i=t.json,r=i.scenes[i.scene||0].nodes,s=r.length>1,n=[];for(const a of r){const l=i.nodes[a];n.push(o(a,0)),fMt(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,u)=>o(c,u+1))}async function o(a,l){const c=i.nodes[a],u=t.getNodeTransform(a);if(c.weights!=null&&se.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const d=i.meshes[c.mesh];for(const f of d.primitives)n.push(e(f,u,l,d.name))}for(const d of c.children||[])n.push(o(d,l))}await Promise.all(n)}function fMt(t){var e;return((e=t.extensions)==null?void 0:e.MSFT_lod)&&Array.isArray(t.extensions.MSFT_lod.ids)}function mMt(t,e,i){const r=n=>{const o=`${i}_tex_${n&&n.id}${n!=null&&n.name?"_"+n.name:""}`;if(n&&!t.textures.has(o)){const a=XCt(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:gMt.has(n.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},s=`${i}_mat_${e.id}_${e.name}`;if(!t.materials.has(s)){const n=YCt({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?r(e.colorTexture):void 0,textureNormal:e.normalTexture?r(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?r(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?r(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?r(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor,receiveShadows:e.receiveShadows,receiveAmbientOcclustion:e.receiveAmbientOcclusion});t.materials.set(s,n)}return s}const gMt=new Set([di.LINEAR_MIPMAP_LINEAR,di.LINEAR_MIPMAP_NEAREST]);function yMt(t,e){switch(e){case Ci.TRIANGLES:return _Mt(t);case Ci.TRIANGLE_STRIP:return vMt(t);case Ci.TRIANGLE_FAN:return bMt(t)}}function _Mt(t){return typeof t=="number"?R2(t):N1(t)?new Uint16Array(t):t}function vMt(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const i=e-2,r=Kz(3*i);if(typeof t=="number"){let s=0;for(let n=0;n<i;n+=1)n%2==0?(r[s++]=n,r[s++]=n+1,r[s++]=n+2):(r[s++]=n+1,r[s++]=n,r[s++]=n+2)}else{let s=0;for(let n=0;n<i;n+=1)n%2==0?(r[s++]=t[n],r[s++]=t[n+1],r[s++]=t[n+2]):(r[s++]=t[n+1],r[s++]=t[n],r[s++]=t[n+2])}return r}function bMt(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const i=e-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof t=="number"){let a=0;for(let l=0;l<i;++l)r[a++]=0,r[a++]=l+1,r[a++]=l+2;return r}const s=t[0];let n=t[1],o=0;for(let a=0;a<i;++a){const l=t[a+2];r[o++]=s,r[o++]=n,r[o++]=l,n=l}return r}let wMt=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},xMt=class{constructor(e,i,r){this.name=e,this.lodThreshold=i,this.pivotOffset=r,this.stageResources=new wMt,this.numberOfVertices=0}};const n0=()=>se.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function L4e(t,e){const i=await TMt(t,e),r=await AMt(i.textureDefinitions??{},e);let s=0;for(const n in r)if(r.hasOwnProperty(n)){const o=r[n];s+=o!=null&&o.image?o.image.width*o.image.height*4:0}return{resource:i,textures:r,size:s+jxe(i)}}async function TMt(t,e){const i=e==null?void 0:e.streamDataRequester;if(i)return SMt(t,i,e);const r=await Vh(yr(t,e));if(r.ok===!0)return r.value.data;jl(r.error),D4e(r.error)}async function SMt(t,e,i){const r=await Vh(e.request(t,"json",i));if(r.ok===!0)return r.value;jl(r.error),D4e(r.error.details.url)}function D4e(t){throw new G("",`Request for object resource failed: ${t}`)}function EMt(t){const e=t.params,i=e.topology;let r=!0;switch(e.vertexAttributes||(n0().warn("Geometry must specify vertex attributes"),r=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=e.faces;if(n){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=n[o];a!=null&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(n0().warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(n0().warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(n0().warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else n0().warn("Indexed geometries must specify faces"),r=!1;break}default:n0().warn(`Unsupported topology '${i}'`),r=!1}t.params.material||(n0().warn("Geometry requires material"),r=!1);const s=t.params.vertexAttributes;for(const n in s)s[n].values||(n0().warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function CMt(t,e){var g,y;const i=new Array,r=new Array,s=new Array,n=new Db,o=t.resource,a=ZP.parse(o.version||"1.0","wosr");OMt.validate(a);const l=o.model.name,c=o.model.geometries,u=o.materialDefinitions??{},d=t.textures;let f=0;const m=new Map;for(let v=0;v<c.length;v++){const b=c[v];if(!EMt(b))continue;const w=PMt(b),x=b.params.vertexAttributes,S=[],C=Z=>{if(b.params.topology==="PerAttributeArray")return null;const ye=b.params.faces;for(const L in ye)if(L===Z)return ye[L].values;return null},M=x[R.POSITION],O=M.values.length/M.valuesPerElement;for(const Z in x){const ye=x[Z],L=ye.values,N=C(Z)??R2(O);S.push([Z,new ht(L,N,ye.valuesPerElement,!0)])}const D=w.texture,U=d&&d[D];if(U&&!m.has(D)){const{image:Z,parameters:ye}=U,L=new Vb(Z,ye);r.push(L),m.set(D,L)}const k=m.get(D),H=k?k.id:void 0,V=w.material;let X=n.get(V,D);if(X==null){const Z=u[V.substring(V.lastIndexOf("/")+1)].params;Z.transparency===1&&(Z.transparency=0);const ye=U&&U.alphaChannelUsage,L=Z.transparency>0||ye==="transparency"||ye==="maskAndTransparency",N=U?N4e(U.alphaChannelUsage):void 0,z={ambient:zl(Z.diffuse),diffuse:zl(Z.diffuse),opacity:1-(Z.transparency||0),transparent:L,textureAlphaMode:N,textureAlphaCutoff:.33,textureId:H,initTextureTransparent:!0,doubleSided:!0,cullFace:Br.None,colorMixMode:Z.externalColorMixMode||"tint",textureAlphaPremultiplied:(U==null?void 0:U.parameters.preMultiplyAlpha)??!1};e!=null&&e.materialParameters&&Object.assign(z,e.materialParameters),X=new em(z),n.set(V,D,X)}s.push(X);const q=new Tn(X,S);f+=((y=(g=S.find(Z=>Z[0]===R.POSITION))==null?void 0:g[1])==null?void 0:y.indices.length)??0,i.push(q)}return{engineResources:[{name:l,stageResources:{textures:r,materials:s,geometries:i},pivotOffset:o.model.pivotOffset,numberOfVertices:f,lodThreshold:null}],referenceBoundingBox:MMt(i)}}function MMt(t){const e=Zr();return t.forEach(i=>{const r=i.boundingInfo;r!=null&&(Yf(e,r.bbMin),Yf(e,r.bbMax))}),e}async function AMt(t,e){const i=new Array;for(const n in t){const o=t[n],a=o.images[0].data;if(!a){n0().warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,u=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",d={noUnpackFlip:!0,wrap:{s:Mi.REPEAT,t:Mi.REPEAT},preMultiplyAlpha:N4e(u)!==Rr.Opaque},f=e!=null&&e.disableTextures?Promise.resolve(null):m_(l,e);i.push(f.then(m=>({refId:c,image:m,parameters:d,alphaChannelUsage:u})))}const r=await Promise.all(i),s={};for(const n of r)s[n.refId]=n;return s}function N4e(t){switch(t){case"mask":return Rr.Mask;case"maskAndTransparency":return Rr.MaskBlend;case"none":return Rr.Opaque;default:return Rr.Blend}}function PMt(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const OMt=new ZP(1,2,"wosr"),wE=2.1;async function F4e(t,e){var d;const i=k4e(EK(t));if(i.fileType==="wosr"){const f=await(e.cache?e.cache.loadWOSR(i.url,e):L4e(i.url,e)),{engineResources:m,referenceBoundingBox:g}=CMt(f,e);return{lods:m,referenceBoundingBox:g,isEsriSymbolResource:!1,isWosr:!0}}const r=await(e.cache?e.cache.loadGLTF(i.url,e,!!e.usePBR):I4e(new R4e(e.streamDataRequester),i.url,e,e.usePBR)),s=(d=r.model.meta)==null?void 0:d.ESRI_proxyEllipsoid,n=r.meta.isEsriSymbolResource&&s!=null&&r.meta.ESRI_webstyle==="EsriRealisticTreesStyle";n&&!r.customMeta.esriTreeRendering&&(r.customMeta.esriTreeRendering=!0,LMt(r,s));const o=!!e.usePBR,a=r.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:n,mrrFactors:[...K0t]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[...C6]},l={...e.materialParameters,treeRendering:n},{engineResources:c,referenceBoundingBox:u}=U4e(r,a,l,e.skipHighLods&&i.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:i.specifiedLodIndex});return{lods:c,referenceBoundingBox:u,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1}}function k4e(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function U4e(t,e,i,r){const s=t.model,n=new Array,o=new Map,a=new Map,l=s.lods.length,c=Zr();return s.lods.forEach((u,d)=>{const f=r.skipHighLods===!0&&(l>1&&d===0||l>3&&d===1)||r.skipHighLods===!1&&r.singleLodIndex!=null&&d!==r.singleLodIndex;if(f&&d!==0)return;const m=new xMt(u.name,u.lodThreshold,[0,0,0]);u.parts.forEach(g=>{const y=f?new em({}):RMt(s,g,m,e,i,o,a),{geometry:v,vertexCount:b}=$Mt(g,y??new em({})),w=v.boundingInfo;w!=null&&d===0&&(Yf(c,w.bbMin),Yf(c,w.bbMax)),y!=null&&(m.stageResources.geometries.push(v),m.numberOfVertices+=b)}),f||n.push(m)}),{engineResources:n,referenceBoundingBox:c}}function RMt(t,e,i,r,s,n,o){var m,g;const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=e.attributes.texCoord0!=null,u=e.attributes.normal!=null;if(l==null)return null;const d=IMt(l.alphaMode);if(!n.has(a)){if(c){const D=(U,k=!1)=>{if(U!=null&&!o.has(U)){const H=t.textures.get(U);if(H!=null){const V=H.data;o.set(U,new Vb(C3(V)?V.data:V,{...H.parameters,preMultiplyAlpha:!C3(V)&&k,encoding:C3(V)&&V.encoding!=null?V.encoding:void 0}))}}};D(l.textureColor,d!==Rr.Opaque),D(l.textureNormal),D(l.textureOcclusion),D(l.textureEmissive),D(l.textureMetallicRoughness)}const y=l.color[0]**(1/wE),v=l.color[1]**(1/wE),b=l.color[2]**(1/wE),w=l.emissiveFactor[0]**(1/wE),x=l.emissiveFactor[1]**(1/wE),S=l.emissiveFactor[2]**(1/wE),C=l.textureColor!=null&&c?o.get(l.textureColor):null,M=BLe({normalTexture:l.textureNormal,metallicRoughnessTexture:l.textureMetallicRoughness,metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor,emissiveTexture:l.textureEmissive,emissiveFactor:l.emissiveFactor,occlusionTexture:l.textureOcclusion}),O=((m=l.normalTextureTransform)==null?void 0:m.scale)!=null?(g=l.normalTextureTransform)==null?void 0:g.scale:mG;n.set(a,new em({...r,transparent:d===Rr.Blend,customDepthTest:XS.Lequal,textureAlphaMode:d,textureAlphaCutoff:l.alphaCutoff,diffuse:[y,v,b],ambient:[y,v,b],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?Br.None:Br.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:u?sr.Attribute:sr.ScreenDerivative,castShadows:!0,receiveShadows:l.receiveShadows,receiveAmbientOcclusion:l.receiveAmbientOcclustion,textureId:C!=null?C.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:l.textureNormal!=null&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:C!=null&&!!C.parameters.preMultiplyAlpha,occlusionTextureId:l.textureOcclusion!=null&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:l.textureEmissive!=null&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:l.textureMetallicRoughness!=null&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[w,x,S],mrrFactors:M?[...aoe]:[l.metallicFactor,l.roughnessFactor,r.mrrFactors[2]],isSchematic:M,colorTextureTransformMatrix:Tg(l.colorTextureTransform),normalTextureTransformMatrix:Tg(l.normalTextureTransform),scale:[O[0],O[1]],occlusionTextureTransformMatrix:Tg(l.occlusionTextureTransform),emissiveTextureTransformMatrix:Tg(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:Tg(l.metallicRoughnessTextureTransform),...s}))}const f=n.get(a);if(i.stageResources.materials.push(f),c){const y=v=>{v!=null&&i.stageResources.textures.push(o.get(v))};y(l.textureColor),y(l.textureNormal),y(l.textureOcclusion),y(l.textureEmissive),y(l.textureMetallicRoughness)}return f}function $Mt(t,e){const i=t.attributes.position.count,r=yMt(t.indices||i,t.primitiveType),s=Es(3*i),{typedBuffer:n,typedBufferStride:o}=t.attributes.position;Ub(s,n,t.transform,3,o);const a=[[R.POSITION,new ht(s,r,3,!0)]];if(t.attributes.normal!=null){const c=Es(3*i),{typedBuffer:u,typedBufferStride:d}=t.attributes.normal;Mb(xE,t.transform),O6(c,u,xE,3,d),fz(xE)&&wP(c,c),a.push([R.NORMAL,new ht(c,r,3,!0)])}if(t.attributes.tangent!=null){const c=Es(4*i),{typedBuffer:u,typedBufferStride:d}=t.attributes.tangent;lp(xE,t.transform),H6(c,u,xE,4,d),fz(xE)&&wP(c,c,4),a.push([R.TANGENT,new ht(c,r,4,!0)])}if(t.attributes.texCoord0!=null){const c=Es(2*i),{typedBuffer:u,typedBufferStride:d}=t.attributes.texCoord0;Xoe(c,u,2,d),a.push([R.UV0,new ht(c,r,2,!0)])}const l=t.attributes.color;if(l!=null){const c=new Uint8Array(4*i);l.elementCount===4?l instanceof Kf?GB(c,l,255):l instanceof ml?Joe(c,l):l instanceof kD&&GB(c,l,1/256):(c.fill(255),l instanceof ho?EB(c,l.typedBuffer,255,4,l.typedBufferStride):t.attributes.color instanceof t6?Z6(c,l.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof r6&&EB(c,l.typedBuffer,1/256,4,l.typedBufferStride)),a.push([R.COLOR,new ht(c,r,4,!0)])}return{geometry:new Tn(e,a),vertexCount:i}}const xE=Yr();function IMt(t){switch(t){case"BLEND":return Rr.Blend;case"MASK":return Rr.Mask;case"OPAQUE":case null:case void 0:return Rr.Opaque}}function LMt(t,e){for(let i=0;i<t.model.lods.length;++i){const r=t.model.lods[i];for(const s of r.parts){const n=s.attributes.normal;if(n==null)return;const o=s.attributes.position,a=o.count,l=E(),c=E(),u=E(),d=new Uint8Array(4*a),f=new Float64Array(3*a),m=Zn(ke(),s.transform);let g=0,y=0;for(let v=0;v<a;v++){o.getVec(v,c),n.getVec(v,l),nt(c,c,s.transform),Re(u,c,e.center),hz(u,u,e.radius);const b=u[2],w=Ve(u),x=Math.min(.45+.55*w*w,1);hz(u,u,e.radius),m!==null&&nt(u,u,m),Ce(u,u),i+1!==t.model.lods.length&&t.model.lods.length>1&&xr(u,u,l,b>-1?.2:Math.min(-4*b-3.8,1)),f[g]=u[0],f[g+1]=u[1],f[g+2]=u[2],g+=3,d[y]=255*x,d[y+1]=255*x,d[y+2]=255*x,d[y+3]=255,y+=4}s.attributes.normal=new ho(f),s.attributes.color=new ml(d)}}}const Dri=Object.freeze(Object.defineProperty({__proto__:null,fetch:F4e,gltfToEngineResources:U4e,parseUrl:k4e},Symbol.toStringTag,{value:"Module"})),DMt=()=>!!le("enable-feature:force-wosr"),Nri=()=>!!le("enable-feature:direct-3d-object-feature-layer-display"),NMt=()=>le.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0),FMt=()=>le.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),Fri=()=>!!le("enable-i3s-patching"),kMt=()=>le.add("enable-i3s-patching",!0,!0,!0),UMt=()=>le.add("enable-i3s-patching",!1,!0,!0),kri=()=>!!le("enable-feature:SceneLayer-editing"),VMt=(t="i3s-patching")=>{switch(UMt(),FMt(),le.add("enable-feature:SceneLayer-editing",!0,!0,!0),t){case"feature-layer-view":NMt();break;case"i3s-patching":kMt()}};VMt("i3s-patching");let C9={};async function zMt(t,e){try{return{data:(await Koe(t,e)).data,baseUrl:zie(t),styleUrl:t}}catch(i){return jl(i),null}}function BMt(t,e,i){var o;const r=e.portal!=null?e.portal:Wn.getDefault();let s;const n=`${r.url} - ${(o=r.user)==null?void 0:o.username} - ${t}`;return C9[n]||(C9[n]=jMt(t,r,i).then(a=>(s=a,a.fetchData())).then(a=>({data:a,baseUrl:s.itemUrl??"",styleName:t}))),C9[n]}function jMt(t,e,i){return e.load(i).then(()=>{const r=new gg({disableExtraQuery:!0,query:`owner:${A0e} AND type:${P0e} AND typekeywords:"${t}"`});return e.queryItems(r,i)}).then(({results:r})=>{var o;let s=null;const n=t.toLowerCase();if(r&&Array.isArray(r)){for(const a of r)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===n))&&a.type===P0e&&a.owner===A0e){s=a;break}}if(!s)throw new G("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return s.load(i)})}function Qoe(t,e,i){return(t==null?void 0:t.styleUrl)!=null?zMt(t.styleUrl,i):(t==null?void 0:t.styleName)!=null?BMt(t.styleName,e,i):Promise.reject(new G("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function V4e(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function z4e(t,e,i=["gltf"]){if(e==="cimRef")return encodeURI(t.cimRef);if(t.formatInfos&&!DMt())for(const r of i){const s=t.formatInfos.find(n=>n.type===r);if(s)return s.href}return encodeURI(t.webRef)}function Koe(t,e){const i={responseType:"json",query:{f:"json"},...e};return yr(Zd(t),i)}const A0e="esri_en",P0e="Style",GMt="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",HMt=Ag.fromSimpleMarkerSymbol(BFe),qMt=A2.fromSimpleLineSymbol(Boe),WMt=Kb.fromSimpleFillSymbol(jFe),ZMt=new RD({symbolLayers:new st([new C2({material:{color:zoe},edges:new vOe({size:Uo(1),color:new Qe(xSt)})})])}),YMt=new A2({symbolLayers:new st([new KP({material:{color:new Qe([0,0,0])},size:Uo(1)})])}),XMt=new Kb({symbolLayers:new st([new C2({outline:{color:new Qe([0,0,0]),size:Uo(1)}})])});function Uri(t){if(t==null)return null;switch(t.type){case"mesh":return ZMt;case"point":case"multipoint":return HMt;case"polyline":return qMt;case"polygon":case"extent":return WMt}return null}const TE={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function JMt(t,e=TE){var l,c,u,d;if(!t)return{symbol:null};const{retainId:i=TE.retainId,ignoreDrivers:r=TE.ignoreDrivers,hasLabelingContext:s=TE.hasLabelingContext,retainCIM:n=TE.retainCIM,cimFallbackEnabled:o=TE.cimFallbackEnabled}=e;let a=null;if(YS(t)||t instanceof P2)a=t.clone();else if(t.type==="cim"){const f=(c=(l=t.data)==null?void 0:l.symbol)==null?void 0:c.type;switch(f){case"CIMPointSymbol":a=n?t.clone():Ag.fromCIMSymbol(t);break;case"CIMLineSymbol":o&&(a=YMt.clone(),(u=e==null?void 0:e.logWarning)==null||u.call(e,"Unsupported CIM line symbology converted to fallback 3D line symbology"));break;case"CIMPolygonSymbol":o&&(a=XMt.clone(),(d=e==null?void 0:e.logWarning)==null||d.call(e,"Unsupported CIM polygon symbology converted to fallback 3D polygon symbology"))}if(!a)return{error:new G("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${f||"unknown"}' is unsupported in 3D`,{symbol:t})}}else if(t instanceof Wh)a=A2.fromSimpleLineSymbol(t);else if(t instanceof py)a=Ag.fromSimpleMarkerSymbol(t);else if(t instanceof $D)a=Ag.fromPictureMarkerSymbol(t);else if(t instanceof E_)a=e.geometryType&&e.geometryType==="mesh"?RD.fromSimpleFillSymbol(t):Kb.fromSimpleFillSymbol(t);else{if(!(t instanceof tO))return{error:new G("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};a=s?VG.fromTextSymbol(t):Ag.fromTextSymbol(t)}return i&&a&&a.type!=="cim"&&(a.id=t.id),r&&YS(a)&&a.symbolLayers.forEach(f=>f.ignoreDrivers=!0),{symbol:a}}function HB(t,e,i,r){const s=B4e(t,{},{context:r,isLabelSymbol:!1});s!=null&&(e[i]=s)}function O0e(t,e,i,r){const s=B4e(t,{},{context:r,isLabelSymbol:!0});s!=null&&(e[i]=s)}function R0e(t){return t instanceof eO||t instanceof P2}function B4e(t,e,i){if(t==null)return null;const{context:r,isLabelSymbol:s}=i,n=r==null?void 0:r.origin,o=r==null?void 0:r.messages;if(n==="web-scene"&&!R0e(t)){const a=JMt(t,{retainCIM:!0,hasLabelingContext:s});return a.symbol!=null?a.symbol.write(e,r):(o==null||o.push(new G("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:r,error:a.error})),null)}return(n==="web-map"||n==="portal-item"&&!aEe(r==null?void 0:r.layer))&&R0e(t)?(o==null||o.push(new G("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:r})),null):t.write(e,r)}function j4e(t,e){return Jot(t,null,e)}function QMt(t,e,i,r){const s=t.name;return s==null?Promise.reject(new G("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName&&t.styleName==="Esri2DPointSymbolsStyle"?KMt(s,e,r):Qoe(t,e,r).then(n=>tae(n,s,e,i,z4e,r))}function eae(t,e){return e.items.find(i=>i.name===t)}function tae(t,e,i,r,s,n){var m,g;const o=(i==null?void 0:i.portal)!=null?i.portal:Wn.getDefault(),a={portal:o,url:un(t.baseUrl),origin:"portal-item"},l=eae(e,t.data);if(!l){const y=`The symbol name '${e}' could not be found`;return Promise.reject(new G("symbolstyleutils:symbol-name-not-found",y,{symbolName:e}))}let c=yb(s(l,r),a),u=((m=l.thumbnail)==null?void 0:m.href)??null;const d=(g=l.thumbnail)==null?void 0:g.imageData;VCt()&&(c=EK(c)??"",u=EK(u));const f={portal:o,url:un(zie(c)),origin:"portal-item"};return Koe(c,n).then(y=>{const v=r==="cimRef"?V4e(y.data):y.data,b=j4e(v,f);if(b&&YS(b)){if(u){const w=yb(u,a);b.thumbnail=new pS({url:w})}else d&&(b.thumbnail=new pS({url:`data:image/png;base64,${d}`}));t.styleUrl?b.styleOrigin=new yL({portal:i.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(b.styleOrigin=new yL({portal:i.portal,styleName:t.styleName,name:e}))}return b})}function KMt(t,e,i){const r=GMt.replaceAll(/\{SymbolName\}/gi,t),s=e.portal!=null?e.portal:Wn.getDefault();return Koe(r,i).then(n=>{const o=V4e(n.data);return j4e(o,{portal:s,url:un(zie(r)),origin:"portal-item"})})}const eAt=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:tae,getStyleItemFromStyle:eae,resolveWebStyleSymbol:QMt},Symbol.toStringTag,{value:"Module"}));async function tAt(t){var a;if(t===null||t.styleName==null&&t.styleUrl==null)return null;const e=t.name;if(e==null)throw new G("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const i={portal:t.portal},r=await Qoe(t,i).catch(()=>null);if(r===null)return null;const s=eae(e,r.data);if(s&&!((a=s.formatInfos)!=null&&a.some(l=>l.type==="gltf_basisu")))return null;const n=await tae(r,e,i,"webRef",(l,c)=>z4e(l,c,["gltf_basisu","gltf"])).catch(()=>null);if(n===null||n.type!=="point-3d")return null;const o=n.symbolLayers.items[0];return o.type==="object"?o.resource:null}let iAt=class{constructor(e,i,r){this._elementSize=i,this._buffer=Sr.createVertex(e,cr.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.usedMemory}copyRange(e,i,r,s=0){const n=new Uint8Array(this.array,e*this.elementSize,(i-e)*this.elementSize);new Uint8Array(r.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,i){const r=e*this._elementSize,s=i*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,s)}resize(e){const i=e*this._elementSize,r=new ArrayBuffer(i);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=e}},rAt=class{constructor(e){this.modelOriginHi=e.getField(R.INSTANCEMODELORIGINHI,ho),this.modelOriginLo=e.getField(R.INSTANCEMODELORIGINLO,ho),this.model=e.getField(R.INSTANCEMODEL,$b),this.modelNormal=e.getField(R.INSTANCEMODELNORMAL,$b),this.featureAttribute=e.getField(R.INSTANCEFEATUREATTRIBUTE,Kf),this.color=e.getField(R.INSTANCECOLOR,ml),this.objectAndLayerIdColor=e.getField(R.INSTANCEOBJECTANDLAYERIDCOLOR,ml)}},$0e=class{constructor(e,i){this._rctx=e,this._instanceBufferLayout=i,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,i=this._tailIndex;return e>=i?e-i:e+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){var e;return((e=this._buffer)==null?void 0:e.usedMemory)??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){vt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){vt(this._updating,"not updating"),this.size<p6e*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){vt(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),vt(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){vt(this._updating,"not updating"),vt(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(qB,Math.floor(this._capacity*Aj));this._resize(e)}_shrink(){const e=Math.max(qB,Math.floor(this._capacity*d6e));this._resize(e)}_resize(e){if(vt(this._updating,"not updating"),e===this._capacity)return;const i=new iAt(this._rctx,this._instanceBufferLayout.stride,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,s=this._compactInstances(i);vt(s===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=i,this._view=new rAt(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,e),i-r):r>i?(this._buffer.copyRange(r,this._capacity,e),i>0&&this._buffer.copyRange(0,i,e,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,i){e<i?this._buffer.transferRange(e,i):e>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(e,this._capacity))}};const qB=64;var ls;function sAt(t){let e=As().mat4f64(R.LOCALTRANSFORM).mat4f64(R.GLOBALTRANSFORM).vec4f64(R.BOUNDINGSPHERE).vec3f64(R.MODELORIGIN).mat3f(R.INSTANCEMODEL).mat3f(R.INSTANCEMODELNORMAL).vec2f(R.MODELSCALEFACTORS);return t.includes(R.FEATUREATTRIBUTE)&&(e=e.vec4f(R.FEATUREATTRIBUTE)),t.includes(R.COLOR)&&(e=e.vec4u8(R.COLOR)),t.includes(R.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(R.OBJECTANDLAYERIDCOLOR)),e=e.u8(R.STATE).u8(R.LODLEVEL),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(ls||(ls={}));let I0e=class{constructor(e){this.localTransform=e.getField(R.LOCALTRANSFORM,xL),this.globalTransform=e.getField(R.GLOBALTRANSFORM,xL),this.modelOrigin=e.getField(R.MODELORIGIN,rp),this.model=e.getField(R.INSTANCEMODEL,$b),this.modelNormal=e.getField(R.INSTANCEMODELNORMAL,$b),this.modelScaleFactors=e.getField(R.MODELSCALEFACTORS,O2),this.boundingSphere=e.getField(R.BOUNDINGSPHERE,KG),this.featureAttribute=e.getField(R.FEATUREATTRIBUTE,Kf),this.color=e.getField(R.COLOR,ml),this.objectAndLayerIdColor=e.getField(R.OBJECTANDLAYERIDCOLOR,ml),this.state=e.getField(R.STATE,hP),this.lodLevel=e.getField(R.LODLEVEL,hP)}},PC=class extends Ue{constructor(e,i){super(e),this.events=new Us,this._capacity=0,this._size=0,this._next=0,this._layout=sAt(i),this._capacity=qB,this._buffer=this._layout.createBuffer(this._capacity),this._view=new I0e(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,ls.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const i=this._view.state;vt(e>=0&&e<this._capacity&&!!(i.get(e)&ls.ALLOCATED),"invalid instance handle"),this._getStateFlag(e,ls.ACTIVE)?this._setStateFlags(e,ls.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const i=this._view.state;vt(e>=0&&e<this._capacity&&!!(i.get(e)&ls.ALLOCATED),"invalid instance handle"),i.set(e,0),this._size--}setLocalTransform(e,i,r=!0){this._view.localTransform.setMat(e,i),r&&this.updateModelTransform(e)}getLocalTransform(e,i){this._view.localTransform.getMat(e,i)}setGlobalTransform(e,i,r=!0){this._view.globalTransform.setMat(e,i),r&&this.updateModelTransform(e)}getGlobalTransform(e,i){this._view.globalTransform.getMat(e,i)}updateModelTransform(e){const i=this._view,r=Wc,s=Tp;i.localTransform.getMat(e,L0e),i.globalTransform.getMat(e,M9);const n=gr(M9,M9,L0e);de(r,n[12],n[13],n[14]),i.modelOrigin.setVec(e,r),lp(s,n),i.model.setMat(e,s);const o=qKe(Wc,n);o.sort(),i.modelScaleFactors.set(e,0,o[1]),i.modelScaleFactors.set(e,1,o[2]),ED(s,s),x2(s,s),i.modelNormal.setMat(e,s),this._setStateFlags(e,ls.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,i){const r=this._view;r.model.getMat(e,Tp),r.modelOrigin.getVec(e,Wc),i[0]=Tp[0],i[1]=Tp[1],i[2]=Tp[2],i[3]=0,i[4]=Tp[3],i[5]=Tp[4],i[6]=Tp[5],i[7]=0,i[8]=Tp[6],i[9]=Tp[7],i[10]=Tp[8],i[11]=0,i[12]=Wc[0],i[13]=Wc[1],i[14]=Wc[2],i[15]=1}applyShaderTransformation(e,i){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedModelTransform(e,i){return this.getModelTransform(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i),i}getCombinedLocalTransform(e,i){this._view.localTransform.getMat(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedMaxScaleFactor(e){let i=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Wc,this,e),i*=Math.max(Wc[0],Wc[1],Wc[2])),i}getCombinedMedianScaleFactor(e){let i=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Wc,this,e),i*=nAt(Wc[0],Wc[1],Wc[2])),i}getModel(e,i){this._view.model.getMat(e,i)}setFeatureAttribute(e,i){this._view.featureAttribute.setVec(e,i)}getFeatureAttribute(e,i){this._view.featureAttribute.getVec(e,i)}setColor(e,i){this._view.color.setVec(e,i)}setObjectAndLayerIdColor(e,i){this._view.objectAndLayerIdColor.setVec(e,i)}setVisible(e,i){i!==this.getVisible(e)&&(this._setStateFlag(e,ls.VISIBLE,i),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,ls.VISIBLE)}setHighlight(e,i){i!==this.getHighlight(e)&&(this._setStateFlag(e,ls.HIGHLIGHT,i),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,ls.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++i;return i}_setStateFlags(e,i){const r=this._view.state;i=r.get(e)|i,r.set(e,i)}_clearStateFlags(e,i){const r=this._view.state;i=r.get(e)&~i,r.set(e,i)}_setStateFlag(e,i,r){r?this._setStateFlags(e,i):this._clearStateFlags(e,i)}_getStateFlag(e,i){return!!(this._view.state.get(e)&i)}_grow(){this._capacity=Math.max(qB,Math.floor(this._capacity*Aj)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new I0e(this._buffer)}_findSlot(){const e=this._view.state;let i=this._next;for(;e.get(i)&ls.ALLOCATED;)i=i+1===this._capacity?0:i+1;return this._next=i+1===this._capacity?0:i+1,i}};function nAt(t,e,i){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),i))}h([p({constructOnly:!0})],PC.prototype,"shaderTransformation",void 0),h([p()],PC.prototype,"_size",void 0),h([p({readOnly:!0})],PC.prototype,"size",null),PC=h([I("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],PC);const Wc=E(),Tp=Yr(),L0e=ke(),M9=ke();let oAt=class extends Of{constructor(e,i){super(r=>this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=i,this._tmpSphere=dn(),this._tmpMat4=ke()}addInstance(e){const i=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);nt(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*XA(r),i.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},aAt=class{constructor(e,i){this._worldSpaceRadius=e,this._minScreenSpaceRadii=i}selectLevel(e,i,r){const s=r.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*i/s;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)n>=this._minScreenSpaceRadii[a]&&(o=a);return o}},lAt=class extends SD{constructor(e,i,r,s,n,o){super(e,i),this.layerUid=e,this.graphicUid=i,this.geometryId=r,this.triangleNr=s,this.baseBoundingSphere=n,this.numLodLevels=o}};function iae(t){return ap(t)&&t.intersector===rs.LOD&&!!t.target}let cAt=class{constructor(e,i){const r=e.renderContext.rctx,s=i.geometry;this._materials=e.materials,s.material.setParameters({instancedDoublePrecision:!0});const n=s.material.createBufferWriter(),o=n.vertexBufferLayout,a=n.elementCount(s),l=o.createBuffer(a);n.write(null,null,s,l,0),this.geometry=s,this.material=s.material,this.glMaterials=new UNe(s.material,this._materials),this.vertexBufferLayout=o,this.vbo=Sr.createVertex(r,cr.STATIC_DRAW,l.buffer),this.vao=new _y(r,Ai,{geometry:ku(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,i,r,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,r,s,(u,d,f,m,g)=>{if(u>=0){if(i!=null&&!i(e.rayBegin,e.rayEnd,u))return;const y=new lAt(o.layerUid,o.graphicUid(n),c,f,a,l);if((e.results.min.drapedLayerOrder==null||g>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||u<e.results.min.dist)&&e.results.min.set(rs.LOD,y,u,d,e.transform.transform,g),e.options.store!==oa.MIN&&(e.results.max.drapedLayerOrder==null||g>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||u>e.results.max.dist)&&e.results.max.set(rs.LOD,y,u,d,e.transform.transform,g),e.options.store===oa.ALL){const v=ose(e.results.min.ray);v.set(rs.LOD,y,u,d,e.transform.transform,g),e.results.all.push(v)}}})}},uAt=class G4e{static async create(e,i,r){const s=await Promise.allSettled(i.components.map(o=>e.controller.schedule(()=>new cAt(e,o),r))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(op);if(ra(r)||n.length!==s.length){n.forEach(o=>o.destroy()),Dt(r);for(const o of s)if(o.status==="rejected")throw o.reason}return new G4e(i.minScreenSpaceRadius,n)}constructor(e,i){this.minScreenSpaceRadius=e,this.components=i}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,i,r,s,n,o,a){this.components.forEach(l=>l.intersect(e,i,r,s,n,o,this.boundingSphere,a))}get boundingBox(){if(this._boundingBox==null){const e=Zr();this.components.forEach(i=>{i.boundingInfo!=null&&(Yf(e,i.boundingInfo.bbMin),Yf(e,i.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const e=this.boundingBox,i=E();Cf(e,i),this._boundingSphere={center:i,radius:.5*AOe(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,i)=>e+i.triangleCount,0)}};const hAt=t=>{const e=t.baseBoundingSphere.radius,i=t.levels.map(r=>r.minScreenSpaceRadius);return new aAt(e,i)};let _d=class extends gdt{constructor(e,i){super(e),this.type=rs.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new Dr,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.produces=new Map([[Pe.OPAQUE_MATERIAL,r=>this._produces(r)],[Pe.TRANSPARENT_MATERIAL,r=>!!this._hasTransparentLevels()&&this._produces(r)]]),this._instanceData=new PC({shaderTransformation:e.shaderTransformation},e.optionalFields),this.addHandles(i.registerTask(It.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=pAt(this.optionalFields),this._glInstanceBufferLayout=ku(this._instanceBufferLayout,1),this.addHandles([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get usedMemory(){return this._allRenderInstanceData.reduce((e,i)=>i.reduce((r,s)=>r+s.usedMemory,e),0)}get renderStats(){const e=this._instanceData.size,i=[];return this._levels.forEach((r,s)=>{const n=this._allRenderInstanceData[0][s].size+this._allRenderInstanceData[1][s].size,o=r.triangleCount;i.push({renderedInstances:n,renderedTriangles:n*o,trianglesPerInstance:o})}),{totalInstances:e,renderedInstances:i.reduce((r,s)=>r+s.renderedInstances,0),renderedTriangles:i.reduce((r,s)=>r+s.renderedTriangles,0),levels:i}}async initializeRenderContext(e,i){this._context=e;const r=e.renderContext.rctx,s=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData[0].push(new $0e(r,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new $0e(r,this._instanceBufferLayout)),uAt.create(e,o,i)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(op);if(ra(i)||n.length!==s.length){n.forEach(o=>o.destroy()),Dt(i);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=hAt(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData[0].forEach(e=>e.destroy()),this._highlightRenderInstanceData[0].forEach(e=>e.destroy())}_hasTransparentLevels(){return this._levels.some(e=>e.components.some(i=>{const r=i.material.produces.get(Pe.TRANSPARENT_MATERIAL);return r==null?void 0:r(j.Color)}))}hasHighlights(){return this._highlightRenderInstanceData[0].some(e=>e.size>0)}_produces(e){return e!==j.Highlight&&e!==j.ShadowHighlight||this.hasHighlights()}prepareRender(e){if(!Nr.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const i=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),i||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(Eu),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const i=this._getInstanceDatas(e.output);if(!i)return null;const r=new Array;return i.forEach(s=>this.levels.forEach((n,o)=>{n.components.forEach(a=>r.push(this._beginComponent(e,s[o],a)))})),r}renderNode(e,i){const r=this._getInstanceDatas(e.output);if(!r||i==null)return;let s=0;e.rctx.bindVAO(),r.forEach(n=>this.levels.forEach((o,a)=>{o.components.forEach(l=>this._renderComponent(e,i[s++],n[a],l,a))}))}_getInstanceDatas(e){const i=e!==j.Highlight&&e!==j.ShadowHighlight,r=e!==j.ShadowExcludeHighlight;return i&&r?this._allRenderInstanceData:i?this._defaultRenderInstanceData:r?this._highlightRenderInstanceData:null}intersect(e,i,r,s){if(!this.baseMaterial.isVisible()||this._octree==null)return;const n=E();Re(n,s,r);const o=a=>{this._instanceData.getCombinedModelTransform(a,F0e),e.transform.set(F0e),nt(k0e,r,e.transform.inverse),nt(U0e,s,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),u=this._levels.length;vt(!!(l&ls.ACTIVE),"invalid instance state"),vt(c>=0&&c<u,"invaid lod level"),this._levels[c].intersect(e,i,k0e,U0e,a,this.metadata,u)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(r,n,o)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(this._octreeCached==null){const i=this._instanceData,r=(e=i.view)==null?void 0:e.state;if(!r)return null;this._octreeCached=new oAt(i,this.baseBoundingSphere);for(let s=0;s<i.capacity;++s)r.get(s)&ls.ACTIVE&&this._octreeCached.addInstance(s)}return this._octreeCached}_invalidateOctree(){this._octreeCached=qe(this._octreeCached)}queryDepthRange(e){if(this._octree==null)return{near:1/0,far:-1/0};const i=e.viewForward,r=this._octree.findClosest(i,Of.DepthOrder.FRONT_TO_BACK,e.frustum),s=this._octree.findClosest(i,Of.DepthOrder.BACK_TO_FRONT,e.frustum);if(r==null||s==null)return{near:1/0,far:-1/0};const n=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(r,Tm),Re(Tm,Tm,n);const a=Te(Tm,i)-Tm[3];o.boundingSphere.getVec(s,Tm),Re(Tm,Tm,n);const l=Te(Tm,i)+Tm[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(i=>i.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:i,_camera:r,_levelSelector:s}=this;this._allRenderInstanceData.forEach(d=>d.forEach(f=>f.beginUpdate()));const n=this._instanceData,o=n.view;let a=n.size;const l=n.capacity;let c=this._instanceIndex;const u=Math.ceil(l/500);for(let d=0;d<a&&!e.done;++d){c===this._cycleStartIndex&&this._startUpdateCycle();const f=o.state.get(c);let m=0;if(!(f&ls.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const g=o.lodLevel.get(c);if(f&ls.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][g].freeTail(),f&ls.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][g].freeTail(),f&ls.REMOVE)n.freeInstance(c);else if(f&ls.VISIBLE){let y=0;i&&(o.modelOrigin.getVec(c,N0e),y=s.selectLevel(N0e,n.getCombinedMedianScaleFactor(c),r)),m=f&~(ls.ACTIVE|ls.TRANSFORM_CHANGED),y>=0&&(f&ls.HIGHLIGHT?(D0e(this._highlightRenderInstanceData[0][y],o,c),m|=ls.HIGHLIGHT_ACTIVE):(D0e(this._defaultRenderInstanceData[0][y],o,c),m|=ls.DEFAULT_ACTIVE)),o.state.set(c,m),o.lodLevel.set(c,y)}else m=f&~(ls.ACTIVE|ls.TRANSFORM_CHANGED),o.state.set(c,m);if(this._octreeCached!=null){const y=!!(f&ls.ACTIVE),v=!!(m&ls.ACTIVE);!y&&v?this._octreeCached.addInstance(c):y&&!v?this._octreeCached.removeInstance(c):y&&v&&f&ls.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,c%u==0&&e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach(d=>d.forEach(f=>f.endUpdate())),this._context.requestRender()}_beginComponent(e,i,r){if(i.size===0)return null;const s=r.glMaterials.load(e.rctx,e.bindParameters.slot,e.output);return s!=null?s.beginSlot(e.bindParameters):null}_renderComponent(e,i,r,s,n){if(!i)return;const{bindParameters:o,rctx:a}=e;a.runAppleAmdDriverHelper();const l=a.bindTechnique(i,o,s.material.parameters,fAt);a.bindVAO(s.vao),i.ensureAttributeLocations(s.vao),Nr.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===j.Color&&(l.setUniform4fv("externalColor",V0e[Math.min(n,V0e.length-1)]),l.setUniform1i("colorMixMode",F3e.replace));const c=r.capacity,u=r.headIndex,d=r.tailIndex,f=r.firstIndex,m=this._glInstanceBufferLayout,g=(y,v)=>{Bse(a,Ai,r.buffer,m,y),a.drawArraysInstanced(i.primitiveType,0,s.vertexCount,v-y),QRe(a,Ai,r.buffer,m)};s.material.parameters.transparent&&f!=null?u>d?(vt(f>=d&&f<=u,"invalid firstIndex"),g(f,u),g(d,f)):u<d&&(f<=u?(vt(f>=0&&f<=u,"invalid firstIndex"),g(f,u),g(d,c),g(0,f)):(vt(f>=d&&f<=c,"invalid firstIndex"),g(f,c),g(0,u),g(d,f))):u>d?g(d,u):u<d&&(g(0,u),g(d,c)),a.bindVAO(null)}};function D0e(t,e,i){const r=t.allocateHead();dAt(e,i,t.view,r)}function dAt(t,e,i,r){wht(t.modelOrigin,e,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,t.model,e),i.modelNormal.copyFrom(r,t.modelNormal,e),t.color&&i.color&&i.color.copyFrom(r,t.color,e),t.objectAndLayerIdColor&&i.objectAndLayerIdColor&&i.objectAndLayerIdColor.copyFrom(r,t.objectAndLayerIdColor,e),t.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,t.featureAttribute,e)}function pAt(t){let e=As().vec3f(R.INSTANCEMODELORIGINHI).vec3f(R.INSTANCEMODELORIGINLO).mat3f(R.INSTANCEMODEL).mat3f(R.INSTANCEMODELNORMAL);return t!=null&&t.includes("featureAttribute")&&(e=e.vec4f(R.INSTANCEFEATUREATTRIBUTE)),t!=null&&t.includes("color")&&(e=e.vec4u8(R.INSTANCECOLOR)),t!=null&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(R.INSTANCEOBJECTANDLAYERIDCOLOR)),e}h([p({constructOnly:!0})],_d.prototype,"symbol",void 0),h([p({constructOnly:!0})],_d.prototype,"optionalFields",void 0),h([p({constructOnly:!0})],_d.prototype,"metadata",void 0),h([p({constructOnly:!0})],_d.prototype,"shaderTransformation",void 0),h([p()],_d.prototype,"_instanceData",void 0),h([p()],_d.prototype,"_cycleStartIndex",void 0),h([p({readOnly:!0})],_d.prototype,"_enableLevelSelection",null),h([p()],_d.prototype,"_updateCyclesWithStaticCamera",void 0),h([p({readOnly:!0})],_d.prototype,"running",null),_d=h([I("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],_d);const N0e=E(),Tm=ci(),F0e=ke(),k0e=E(),U0e=E(),V0e=[ii(1,0,1,1),ii(0,0,1,1),ii(0,1,0,1),ii(1,1,0,1),ii(1,0,0,1)],fAt=new T_t;let z0e=class{constructor(e,i,r,s,n,o,a,l,c,u,d,f){this.lodResources=e,this.lodRenderer=i,this.stageResources=r,this.originalMaterialParameters=s,this.resourceSize=n,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=u,this.physicalBasedRenderingEnabled=d,this.pivotOffset=f}},mAt=class extends Sy{getCachedSize(){const[e,i,r]=this._resources!=null?this._resources.symbolSize:[1,1,1];return{width:e,depth:i,height:r}}constructor(e,i,r,s){super(e,i,r,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}async doLoad(e){var i;if(!this._drivenProperties.size&&S6(this.symbolLayer))throw new Error;if(this._isPrimitive){const r=this.symbolLayer.resource,s=r&&g0t(r==null?void 0:r.primitive)?r.primitive:kOe;this._resources=await this._createResourcesForPrimitive(s,e)}else{const r=await tAt(this.symbol.styleOrigin),s=(r==null?void 0:r.href)??((i=this.symbolLayer.resource)==null?void 0:i.href);this._resources=await this._createResourcesForUrl(s,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return this._resources!=null?this._resources.extentPadding:0}get _isPrimitive(){var e;return!((e=this.symbolLayer.resource)!=null&&e.href)}get lodRenderer(){var e;return(e=this._resources)==null?void 0:e.lodRenderer}get materials(){var e;return((e=this._resources)==null?void 0:e.stageResources.materials)??[]}_setMaterialTransparencyParameters(e,i=(s=>(s=(r=>(r=this.symbolLayer)==null?void 0:r.material)())==null?void 0:s.color)()){const n=this._getCombinedOpacity(i),o=n<1||this.needsDrivenTransparentPass;return e.transparent=o,e.opacity=n,e.cullFace=o?Br.None:Br.Back,e}async _createResourcesForPrimitive(e,i){const r=this.symbolLayer,s=Xn(Oot(e)),n=zl(Hk(s)),o=zl(y8(n,r)),a=Ve(o),l=!1,c=!1,u={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...aoe],ambient:V0,diffuse:V0,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},d=!!u.usePBR;this._setMaterialTransparencyParameters(u);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:w,minWorldLength:x,maxWorldLength:S}=f.verticalOffset;u.verticalOffset={screenLength:wn(w),minWorldLength:x||0,maxWorldLength:S??1/0},u.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(u.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)u.externalColor=Ud;else{const w=r.material!=null?r.material.color:null,x=w!=null?Qe.toUnitRGBA(w):Ud;u.externalColor=x}this._fastUpdates=fP(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,null)),u.isInstanced=!0,this._fastUpdates?(Object.assign(u,this._fastUpdates.materialParameters),this._optionalFields.push(R.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(u.hasInstancedColor=!0,this._optionalFields.push(R.COLOR)),le("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(R.OBJECTANDLAYERIDCOLOR);const m=new em(u),g=ELe(e,m);if(!g)throw new Error(`Unknown object symbol primitive: ${e}`);const y=a4(g).map(w=>({opacity:1,transparent:w.parameters.transparent})),v=await this._createStageResources(g,d,i),b=await this._createLodRenderer(g,i);return new z0e(g,b,v,y,n,l,c,s,o,a,d,null)}async _createResourcesForUrl(e,i){var k,H;const r={materialParameters:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=fP(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(r.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push(R.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(r.materialParameters.hasInstancedColor=!0,this._optionalFields.push(R.COLOR)),le("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(R.OBJECTANDLAYERIDCOLOR);const s=this.symbol;if(s.type==="point-3d"&&s.verticalOffset){const{screenLength:V,minWorldLength:X,maxWorldLength:q}=s.verticalOffset;r.materialParameters.verticalOffset={screenLength:wn(V),minWorldLength:X||0,maxWorldLength:q??1/0},r.materialParameters.castShadows=!1}const n=this._context.physicalBasedRenderingEnabled;r.signal=i,r.usePBR=n,r.skipHighLods=this._context.skipHighSymbolLods;const o=await F4e(e,r),a=o.isEsriSymbolResource,l=o.isWosr,c=FCt(o.lods),u=this._context,d=this.symbolLayer.material,f=this._getExternalColorParameters(d),m=(H=(k=this.symbolLayer)==null?void 0:k.material)==null?void 0:H.color,g=this._getCombinedOpacity(m,{hasIntrinsicColor:!0}),y=this.needsDrivenTransparentPass,v=a4(c),b=a4(c).map(V=>({opacity:V.parameters.opacity||1,transparent:V.parameters.transparent}));v.forEach(V=>{const X=V.parameters;V.setParameters(f);const q=X.opacity*g,Z=q<1||y||X.transparent;V.setParameters({opacity:q,transparent:Z}),u.screenSizePerspectiveEnabled&&V.setParameters({screenSizePerspective:u.sharedResources.screenSizePerspectiveSettings})});const w=o.referenceBoundingBox,x=zl(Hk(w)),S=zl(c.levels[0].pivotOffset),C=zl(y8(x,this.symbolLayer)),M=Ve(C),O=this._fastUpdates;mP(O,this._context.renderer,this._fastVisualVariableConvertOptions(w,C,x,S))&&v.forEach(V=>V.setParameters(O.materialParameters));const D=await this._createStageResources(c,n,i),U=await this._createLodRenderer(c,i);return new z0e(c,U,D,b,x,a,l,w,C,M,n,S)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,i,r){const s=this._context.stage,n=a4(e);i!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),s.addMany(n),this._addDisposeResource(()=>s.removeMany(n));const o=Pme(e);s.addMany(o),this._addDisposeResource(()=>{o.forEach(l=>l.unload()),s.removeMany(o)}),await Promise.all(o.map(l=>this._context.stage.schedule(()=>l.load(s.renderView.renderingContext),r))),Dt(r);const a=Ome(e);return s.addMany(a),this._addDisposeResource(()=>s.removeMany(a)),{materials:n,textures:o,geometries:a}}async _createLodRenderer(e,i){const r=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:l=>this._instanceIndexToGraphicUid.get(l),notifyGraphicGeometryChanged:l=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(l)),notifyGraphicVisibilityChanged:l=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(l))},n=this._fastUpdates,o=n?{applyTransform:(l,c,u)=>{l.getFeatureAttribute(c,U4),xn(u,Pgt(n.materialParameters,U4,u))},scaleFactor:(l,c,u)=>{c.getFeatureAttribute(u,U4),Une(l,n.materialParameters,U4)}}:null,a=new _d({symbol:e,optionalFields:this._optionalFields,metadata:s,shaderTransformation:o},this._context.scheduler);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{r.removeRenderPlugin(a),a.destroy()}),await r.addRenderPlugin(a,i),a}_getExternalColorParameters(e){const i={};return this._drivenProperties.color?i.externalColor=Ud:(e==null?void 0:e.color)!=null?i.externalColor=Qe.toUnitRGBA(e.color):(i.externalColor=Ud,i.colorMixMode="ignore"),i}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;const r=_S(i.geometry);if(r==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const s=this.setGraphicElevationContext(i),n=e.renderingInfo;return this._createAs3DShape(i,r,n,s,i.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){var n,o;if(this._resources==null)return;const e=this._drivenProperties.opacity,i=!this._isPrimitive,r=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let a=0;a<r.length;a++){const l=r[a],c=(o=(n=this.symbolLayer)==null?void 0:n.material)==null?void 0:o.color,u=s[a],d=this._getCombinedOpacity(c,{hasIntrinsicColor:i})*u.opacity,f=d<1||e||u.transparent;l.setParameters({opacity:d,transparent:f}),this._isPrimitive&&l.setParameters({cullFace:f?Br.None:Br.Back})}}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Fb)}slicePlaneEnabledChanged(){if(this._resources==null)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(this._resources==null)return!0;const{stageResources:e,isWosr:i}=this._resources;for(const r of e.materials)this._isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,i){if(this._resources==null)return cn.RecreateSymbol;const{stageResources:{materials:r},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!mP(this._fastUpdates,i,this._fastVisualVariableConvertOptions(n,o,a,l)))return cn.RecreateSymbol;for(const u of r)u.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return cn.FastUpdate}computeComplexity(){if(this._resources==null)return super.computeComplexity();const e=this._resources.lodResources,i=dDe(e.levels),r=a=>Array.from(a.attributes.values()).reduce((l,c)=>l+pb(c.data,c.indices),0),s=Ome(e).reduce((a,l)=>a+r(l),0),n=Pme(e).reduce((a,l)=>a+l.memoryEstimate,0)+s,o={...hDe(this.symbol,this.symbolLayer),resourceBytes:n};return new $d({verticesPerFeature:i,memory:o})}_hasLodRenderer(){return this._resources!=null}_createAs3DShape(e,i,r,s,n,o){if(!this._hasLodRenderer()||this._resources==null)return null;const a=this.getFastUpdateAttrValues(e),l=this._context.clippingExtent;if(pl(i,SE,this._context.elevationProvider.spatialReference),l!=null&&!Ese(l,SE))return null;const c=j0e(s),u=this._computeGlobalTransform(i,s,A9,V4),d=this._computeLocalTransform(this._resources,this.symbolLayer,r,G0e),f=this._resources.lodRenderer.instanceData,m=f.addInstance();this._instanceIndexToGraphicUid.set(m,n),f.setLocalTransform(m,d,!1),f.setGlobalTransform(m,u),a&&f.setFeatureAttribute(m,a),this._fastUpdates==null&&this._hasPerInstanceColor()&&f.setColor(m,f3(r.color,r.opacity,255)),this._context.stage.renderView.objectAndLayerIdRenderHelper!=null&&f.setObjectAndLayerIdColor(m,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:o}));const g=new LCt(this,m,Kyt,s);return c&&(g.alignedSampledElevation=V4.sampledElevation),g.needsElevationUpdates=Fb(s.mode),t2(g,i,this._context.elevationProvider),g}_computeGlobalTransform(e,i,r,s){return Nb(e,this._context.elevationProvider,i,this._context.renderCoordsHelper,s),SE[0]=e.x,SE[1]=e.y,SE[2]=s.z,$h(e.spatialReference,SE,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(e,i,r,s){return tp(s),this._applyObjectRotation(r,!1,s),this._applyObjectRotation(i,!0,s),this._applyObjectScale(e,r,s),this._applyAnchor(e,i,s),s}_applyObjectScale(e,i,r){var o;if((o=this._fastUpdates)!=null&&o.requiresShaderTransformation)return;const s=this._drivenProperties.size&&i.size?i.size:e.symbolSize,n=Mme(s,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||_D(r,r,n)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const i=e.diff.diff;this._preparePatchTransform(e,i),this._preparePatchColor(e,i)}updateGeometry(e,i){if(this._resources==null)return!0;const r=i&&_S(i);if(r==null)return!1;const s=this.getGeometryElevationMode(i);return e.elevationContext.mode===s&&(this._computeGlobalTransform(r,e.elevationContext,A9,V4),j0e(e.elevationContext)&&(e.alignedSampledElevation=V4.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,A9,!0),t2(e,r,this._context.elevationProvider),!0)}_preparePatchTransform(e,i){if(!(i.heading||i.tilt||i.roll||i.width||i.height||i.depth||i.anchor||i.anchorPosition)||this._resources==null)return;const r=(g,y,v)=>(g!=null&&g.type==="complete"?g.newValue:y)??v,s=r(i.heading,this.symbolLayer.heading,0),n=r(i.tilt,this.symbolLayer.tilt,0),o=r(i.roll,this.symbolLayer.roll,0),a=r(i.width,this.symbolLayer.width,void 0),l=r(i.height,this.symbolLayer.height,void 0),c=r(i.depth,this.symbolLayer.depth,void 0),u=r(i.anchor,this.symbolLayer.anchor,void 0),d=r(i.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete i.heading,delete i.tilt,delete i.roll,delete i.width,delete i.height,delete i.depth,delete i.anchor,delete i.anchorPosition;const f={heading:s,tilt:n,roll:o,anchor:u,anchorPosition:d},m=this._resources;this.loadStatus===yh.LOADED&&e.symbolLayerStatePatches.push(()=>{m.symbolSize=zl(y8(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((g,y)=>{const v=this._computeLocalTransform(m,f,y,G0e),b=g.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(b,v,!0)})}_preparePatchColor(e,i){if(!i.material||i.material.type!=="partial")return;const r=i.material.diff;if(!r.color||r.color.type!=="complete"||r.color.newValue==null||r.color.oldValue==null)return;const s=r.color.newValue,n=s!=null?Qe.toUnitRGBA(s):Ud;delete r.color;const o=this._resources;o!=null&&e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParameters({},s)):l=this._setMaterialTransparencyParameters({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_applyObjectRotation(e,i,r){var s;if(!((s=this._fastUpdates)!=null&&s.requiresShaderTransformation)||!i)return p0t(e.heading,e.tilt,e.roll,r)}_applyAnchor(e,i,r){var n;if((n=this._fastUpdates)!=null&&n.requiresShaderTransformation)return;const s=B0e(e.resourceBoundingBox,e.pivotOffset,i);s&&dl(r,r,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,i,r,s){const n=e!=null?zl(Hk(e)):V0,o=e!=null?B0e(e,s,this.symbolLayer):On,a=this._context.renderCoordsHelper.unitInMeters,l=Mme(i??void 0,i,r,a),c=Ge(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new GD({size:!0,color:!0,rotation:!0,opacity:!1},n,i??V0,a,o,l,c)}};function B0e(t,e,i){const r=E();switch(i.anchor){case"center":ve(r,Cf(t)),sa(r,r);break;case"top":{const s=Cf(t);de(r,-s[0],-s[1],-t[5]);break}case"bottom":{const s=Cf(t);de(r,-s[0],-s[1],-t[2]);break}case"relative":{const s=Cf(t),n=Hk(t),o=i.anchorPosition,a=o?Ge(o.x,o.y,o.z):On;Xj(r,n,a),Ee(r,r,s),sa(r,r);break}default:e!=null?sa(r,e):ve(r,On)}return r}function j0e(t){return t.mode!=="absolute-height"}const SE=E(),G0e=ke(),A9=ke(),U4=ci(),V4=new WD;let gAt=class{constructor(e,i,r,s){this.vertices=e,this.positionsES=i,this.offset=s;const n=e.length,o=Math.floor(n/2),a=this.offset+3*o,l=r[a],c=r[a+1],u=r[a+2];this.origin=Ge(l,c,u),this.positions=Es(3*n);const d=this.offset+3*n;for(let f=this.offset;f<d;f+=3)this.positions[f]=r[f]-l,this.positions[f+1]=r[f+1]-c,this.positions[f+2]=r[f+2]-u;this.updatePathVertexInformation()}get usedMemory(){return pb(this.positions)}updatePathVertexInformation(){const e=this.vertices.length,i=this.vertices[0];let r=this.offset;const s=this.positions;i.vRight[0]=s[r+3]-s[r],i.vRight[1]=s[r+4]-s[r+1],i.vRight[2]=s[r+5]-s[r+2],r+=3;let n=Ve(i.vRight);i.vMinSiblingLength=n,Ce(i.vRight,i.vRight);let o=i;for(let a=1;a<e;++a){const l=this.vertices[a];if(l.vLeft=o.vRight,a<e-1){l.vRight[0]=s[r+3]-s[r],l.vRight[1]=s[r+4]-s[r+1],l.vRight[2]=s[r+5]-s[r+2];const c=Ve(l.vRight);l.vMinSiblingLength=Math.min(n,c),n=c,Ce(l.vRight,l.vRight)}else ve(l.vRight,l.vLeft),l.vMinSiblingLength=n;o=l,r+=3}}},yAt=class{constructor(e,i,r,s,n,o={}){this.path=e,this.profile=i,this.extruder=r,this.startCap=s,this.endCap=n,this.options=o,this._extrusionVertexCount=0;const a=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*a+2,this.numVerticesTotal=i.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.numVertices;this.numVerticesTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.numVertices;this.numVerticesTotal+=c,this.pathVertexData=pht(1*this.numVerticesTotal),this.profileRightAxes=Es(4*this.numVerticesTotal),this.profileUpAxes=Es(4*this.numVerticesTotal),this.profileVertexAndNormals=Es(4*this.numVerticesTotal),this.positions=Qz(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}get usedMemory(){return pb(this.pathVertexData,this.profileRightAxes,this.profileUpAxes,this.profileVertexAndNormals)+this.path.usedMemory+this.profile.usedMemory}emitVertex(e,i,r,s,n){const o=4*this._extrusionVertexCount;if(this.profileRightAxes[o]=i.right[0],this.profileRightAxes[o+1]=i.right[1],this.profileRightAxes[o+2]=i.right[2],this.profileUpAxes[o]=i.up[0],this.profileUpAxes[o+1]=i.up[1],this.profileUpAxes[o+2]=i.up[2],this.profileVertexAndNormals[o]=r[0],this.profileVertexAndNormals[o+1]=r[1],this.profileVertexAndNormals[o+2]=s[0],this.profileVertexAndNormals[o+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,n){const a=this.path.vertices[e],l=a.maxStretchDistance;this.profileRightAxes[o+3]=a.rotationRight[0]*l,this.profileUpAxes[o+3]=a.rotationRight[1]*l}else this.profileRightAxes[o+3]=0,this.profileUpAxes[o+3]=0;++this._extrusionVertexCount}emitCapVertex(e,i,r,s,n,o){const a=4*this._extrusionVertexCount;this.profileRightAxes[a]=i.right[0],this.profileRightAxes[a+1]=i.right[1],this.profileRightAxes[a+2]=i.right[2],this.profileRightAxes[a+3]=n,this.profileUpAxes[a]=i.up[0],this.profileUpAxes[a+1]=i.up[1],this.profileUpAxes[a+2]=i.up[2],this.profileUpAxes[a+3]=o,this.profileVertexAndNormals[a]=r[0],this.profileVertexAndNormals[a+1]=r[1],this.profileVertexAndNormals[a+2]=s[0],this.profileVertexAndNormals[a+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:i,vertices:r}=this.path;this.positions=Qz(e,i,3*r.length);let s=0;const n=(a,l,c,u,d)=>this.emitCapVertex(s,a,l,c,u,d),o=(a,l,c,u)=>this.emitVertex(s,a,l,c,u);for(this.startCap.rebuildConnectingProfileGeometry(r[s],this.profile,n),s=1;s<r.length-1;++s)this.extruder.extrude(r[s],this.profile,o);this.endCap.rebuildConnectingProfileGeometry(r[s],this.profile,n),s=0,this.startCap.rebuildCapGeometry(r[s],n),s=r.length-1,this.endCap.rebuildCapGeometry(r[s],n)}buildTopology(){const e=this.profile.vertices.length,i=this.profile.numSegments,r=this.numExtrusionProfiles-1;let s=3*(2*(i*r));this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.numIndices,this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const n=new Array,o=new Array,a=new Array,l=(c,u,d)=>{n.push(c),n.push(u),n.push(d),o.push(c),o.push(u),o.push(d),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[u]),a.push(this.pathVertexData[d])};for(let c=0;c<i;++c){const u=this.profile.indices[2*c],d=this.profile.indices[2*c+1];for(let f=0;f<r;++f){const m=f*e+u,g=(f+1)*e+d,y=f*e+d;l(m,(f+1)*e+u,g),l(m,g,y)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=jg(n),this.normalIndices=jg(o),this.pathVertexIndices=jg(a)}onPathChanged(){this._rebuildGeometry()}},rae=class{rebuildConnectingProfileGeometry(e,i,r){for(let s=0;s<i.vertices.length;++s)r(e.frame,i.vertices[s],i.normals[s],0,0)}},H0e=class extends rae{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}},z4=class extends rae{constructor(e,i=0,r=!1){super(),this.profile=e,this.profilePlaneOffset=i,this.flip=r}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,i,r){const s=this.profilePlaneOffset;for(let n=0;n<i.vertices.length;++n)r(e.frame,i.vertices[n],i.normals[n],s,0)}rebuildCapGeometry(e,i){const r=this.profile,s=this.flip?1:-1,n=this.profilePlaneOffset,o=H4e;Li(o,0,0);for(let a=0;a<r.vertices.length;++a)i(e.frame,r.vertices[a],o,n,s)}buildTopology(e,i){const r=this.profile,s=this.vertexBufferStart+r.indices[0];for(let n=1;n<r.numSegments;++n){const o=r.indices[2*n],a=r.indices[2*n+1],l=this.vertexBufferStart+o,c=this.vertexBufferStart+a;this.flip?i(c,l,s):i(s,l,c)}}},q0e=class extends rae{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const i=this.profile;e+=2*i.numSegments*(this.numSegments-1);for(let r=0;r<i.numSegments;++r){const s=i.indices[2*r],n=i.indices[2*r+1];i.poleIndices[s]===i.poleIndices[n]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,i){const r=this.profile,s=e.frame,n=.5*this.sign,o=_At,a=H4e;Li(a,0,0);for(const l of r.poles)l.normal?i(s,l.position,l.normal,n,0):i(s,l.position,a,n,this.sign);if(this.breakNormals)for(let l=0;l<r.vertices.length;++l)i(s,r.vertices[l],r.normals[l],0,0);for(let l=0;l<this.numSegments-1;++l){const c=(1-(l+1)/this.numSegments)*Math.PI*.5,u=Math.sin(c),d=Math.cos(c);for(let f=0;f<r.vertices.length;++f){const m=r.poles[r.poleIndices[f]];vg(o,r.vertices[f],m.position),bh(o,o,u),m.normal?(of(o,o,m.position),i(s,o,m.normal,n*d,0)):(bL(a,o),bh(a,a,u),of(o,o,m.position),i(s,o,a,n*d,this.sign*d))}}}buildTopology(e,i){const r=this.profile,s=this.breakNormals?this.vertexBufferStart+r.poles.length:this.firstProfileVertexIndex,n=this.breakNormals?this.vertexBufferStart+r.poles.length+r.vertices.length:this.vertexBufferStart+r.poles.length;for(let o=0;o<r.numSegments;++o){const a=r.indices[2*o],l=r.indices[2*o+1],c=this.vertexBufferStart+r.poleIndices[a],u=this.vertexBufferStart+r.poleIndices[l];let d=s+a,f=s+l;for(let m=0;m<this.numSegments-1;++m){const g=n+m*r.vertices.length+a,y=n+m*r.vertices.length+l;this.flip?(i(g,f,d),i(f,g,y)):(i(d,f,g),i(y,g,f)),d=g,f=y}this.flip?(i(c,f,d),c!==u&&i(c,u,f)):(i(d,f,c),c!==u&&i(f,u,c))}}};const _At=mt(),H4e=mt();let vAt=class{numProfilesPerJoin(){return 1}extrude(e,i,r){for(let s=0;s<i.vertices.length;++s)r(e.frame,i.vertices[s],i.normals[s],!1)}},P9=class{constructor(e,i){this.cutoffAngle=e,this.numBendSubdivisions=i}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,i,r){const s=wAt,{rotationAngle:n,rotationRight:o,frame:a}=e;if(Math.abs(n)>=this.cutoffAngle){const l=e.rotationFrameUp;for(let c=0;c<this.numBendSubdivisions+1;++c){Du(Z0e,.5*-n+c*n/this.numBendSubdivisions,l),bAt(s,a,Z0e);for(let u=0;u<i.vertices.length;++u)zn(i.vertices[u],o)*n>=0?r(s,i.vertices[u],i.normals[u],!1):r(a,e.applyMiterStretch(W0e,i.vertices[u]),i.normals[u],!0)}}else for(let l=0;l<this.numBendSubdivisions+1;++l)for(let c=0;c<i.vertices.length;++c){const u=zn(i.vertices[c],o)*n>=0;r(a,e.applyMiterStretch(W0e,i.vertices[c]),i.normals[c],!u)}}},q4e=class{constructor(){this.up=E(),this.right=E()}};function bAt(t,e,i){nt(t.up,e.up,i),nt(t.right,e.right,i)}const W0e=mt(),Z0e=ke(),wAt=new q4e;let xAt=class extends Tn{constructor(e,i,r,s,n,o){super(e,i,null,Fs.Mesh,o),this.path=r,this.geometrySR=s,this.stencilWidth=n}};var qg;function W4e(t){return"path"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(qg||(qg={}));let Z4e=class{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}},Y4e=class extends Z4e{constructor(e){super(e),this.vertexAttributeColor=ii(255,255,255,255),this.size=new Array,this.vertexAttributePosition=Es(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:i,pathVertexData:r,path:s,positions:n,profileRightAxes:o,profileUpAxes:a,profileVertexAndNormals:l}=this.builder;for(let c=0;c<i;++c){let u=r[c];const d=u===0||u===s.vertices.length-1;u*=3;const f=MAt;let m=0,g=0;const y=4*c,v=de(AAt,o[y],o[y+1],o[y+2]),b=de(PAt,a[y],a[y+1],a[y+2]),w=Li(Y0e,l[y]*e[0],l[y+1]*e[1]);if(d)ft(f,b,v),m=o[y+3]*e[0],g=a[y+3];else{const M=SAt,O=EAt;Li(M,o[y+3],a[y+3]);const D=Fse(M);bL(M,M);const U=zn(w,M);if(Math.abs(U)>D){Li(O,-M[1],M[0]);const k=zn(w,O);bh(M,M,D*Math.sign(U)),bh(O,O,k),of(w,M,O)}de(f,0,0,0)}const x=de(CAt,v[0]*w[0]+b[0]*w[1],v[1]*w[0]+b[1]*w[1],v[2]*w[0]+b[2]*w[1]),S=3*c;this.vertexAttributePosition[S]=n[u]+x[0]+f[0]*m,this.vertexAttributePosition[S+1]=n[u+1]+x[1]+f[1]*m,this.vertexAttributePosition[S+2]=n[u+2]+x[2]+f[2]*m;const C=Li(Y0e,l[y+2],l[y+3]);np(this.vertexAttributeNormal,c,v[0]*C[0]+b[0]*C[1]+f[0]*g,v[1]*C[0]+b[1]*C[1]+f[1]*g,v[2]*C[0]+b[2]*C[1]+f[2]*g)}}createGeometryData(){const e=this.builder.vertexIndices.length,{normalIndices:i,vertexIndices:r}=this.builder;return[[R.POSITION,new ht(this.vertexAttributePosition,r,3,!0)],[R.NORMALCOMPRESSED,new ht(this.vertexAttributeNormal,i,2,!0)],[R.COLOR,new ht(this.vertexAttributeColor,tw(e),4)]]}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,i,r,s){const n=this.builder.vertexIndices,o=new MD(this.vertexAttributePosition,3),a=n.length/3;ILe(e,i,0,a,n,o,void 0,r,(l,c,u)=>{s(l,u,c,!1)})}},TAt=class extends Z4e{constructor(e,i,r,s){super(e),this.sizeAttributeValue=i,this.colorAttributeValue=r,this.opacityAttributeValue=s,this.vvData=null,this.baked=new Y4e(e),this.vvData=Es(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n]=i,this.vvData[4*n+1]=r,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){const{positions:e,profileRightAxes:i,profileUpAxes:r,profileVertexAndNormals:s,pathVertexIndices:n,vertexIndices:o}=this.builder;return[[R.POSITION,new ht(e,n,3,!0)],[R.PROFILERIGHT,new ht(i,o,4,!0)],[R.PROFILEUP,new ht(r,o,4,!0)],[R.PROFILEVERTEXANDNORMAL,new ht(s,o,4,!0)],[R.FEATUREVALUE,new ht(this.vvData,n,4,!0)]]}onPathChanged(e){super.onPathChanged(e);const i=e.getMutableAttribute(R.POSITION);i&&(i.data=this.builder.positions)}};const Y0e=mt(),SAt=mt(),EAt=mt(),CAt=E(),MAt=E(),AAt=E(),PAt=E();function OAt(t,e){let i=null;const r=t.vertices.length,s=.99619469809,n=E(),o=E(),a=E(),l=E(),c=E(),u=E(),d=tr();let f=t.vertices[0];ve(o,e),de(n,0,1,0),tB(f.vRight,o,n,n,a,o,s),ve(f.frame.up,o),ve(f.frame.right,a);const m=t.positions;let g=t.offset;i=f;for(let y=1;y<r;++y){f=t.vertices[y],Ee(c,f.vLeft,f.vRight);let v=Ve(c);v>0?(v=1/Math.sqrt(v),c[0]=c[0]*v,c[1]=c[1]*v,c[2]=c[2]*v):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),u[0]=m[g]+i.frame.up[0],u[1]=m[g+1]+i.frame.up[1],u[2]=m[g+2]+i.frame.up[2],g+=3;const b=de(RAt,m[g],m[g+1],m[g+2]);TD(b,c,d),v2(d,jh(u,f.vLeft),l)?(l[0]-=m[g],l[1]-=m[g+1],l[2]-=m[g+2],Ce(o,l),ft(a,c,o),Ce(a,a)):tB(c,i.frame.up,i.frame.right,n,a,o,s),ve(f.frame.up,o),ve(f.frame.right,a),i=f}}const RAt=E();let X4e=class{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,i){return this.vertices.push(QR(e)),this.normals.push(QR(i)),this.vertices.length-1}addPole(e,i=null){return this.poles.push({position:QR(e),normal:i?QR(i):null}),this.poles.length-1}addSegment(e,i=null){this.indices.push(e.v0),this.indices.push(e.v1),i&&(this.poleIndices.push(i.v0),this.poleIndices.push(i.v1))}get numSegments(){return this.indices.length/2}translate(e,i){for(const r of this.vertices)r[0]+=e,r[1]+=i;for(const r of this.poles)r.position[0]+=e,r.position[1]+=i}get usedMemory(){return this.vertices.length*pb(this.vertices[0])*2+pb(this.indices)}};const J4e={top:[0,-.5],bottom:[0,.5]};function O9(t){const i=wLe,r=new X4e,s={v0:0,v1:0};r.addPole(Ei(0,0));for(let o=0;o<i;++o){const a=2*o*Math.PI/i,l=Math.cos(a),c=Math.sin(a),u=Ei(l*.5,c*.5),d=Ei(l,c);r.addVertex(u,d)}for(let o=0;o<i-1;++o){const a={v0:o,v1:o+1};r.addSegment(a,s)}const n={v0:i-1,v1:0};if(r.addSegment(n,s),t!=="center"){const o=J4e[t];r.translate(o[0],o[1])}return r}const $At={center:O9("center"),top:O9("top"),bottom:O9("bottom")},IAt={center:R9("center"),top:R9("top"),bottom:R9("bottom")};function R9(t){const r=new X4e,s=Ei(.5*-1,.5*-1),n=Ei(.5*1,.5*-1),o=Ei(.5*1,.5*1),a=Ei(.5*-1,.5*1),l=Ei(0,-1),c=Ei(1,0),u=Ei(0,1),d=Ei(-1,0);if(r.addPole(Ei(0,.5*1),u),r.addPole(Ei(0,.5*1)),r.addPole(Ei(0,.5*-1)),r.addPole(Ei(0,.5*-1),l),r.addVertex(s,l),r.addVertex(n,l),r.addSegment({v0:0,v1:1},{v0:3,v1:3}),r.addVertex(n,c),r.addVertex(o,c),r.addSegment({v0:2,v1:3},{v0:2,v1:1}),r.addVertex(o,u),r.addVertex(a,u),r.addSegment({v0:4,v1:5},{v0:0,v1:0}),r.addVertex(a,d),r.addVertex(s,d),r.addSegment({v0:6,v1:7},{v0:1,v1:2}),t!=="center"){const f=J4e[t];r.translate(f[0],f[1])}return r}function LAt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function DAt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function Q4e(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function NAt(t,e){if(t===e){const i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function FAt(t,e){const i=e[0],r=e[1],s=e[2],n=e[3];let o=i*n-s*r;return o?(o=1/o,t[0]=n*o,t[1]=-r*o,t[2]=-s*o,t[3]=i*o,t):null}function kAt(t,e){const i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t}function UAt(t){return t[0]*t[3]-t[2]*t[1]}function K4e(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=r*a+n*l,t[1]=s*a+o*l,t[2]=r*c+n*u,t[3]=s*c+o*u,t}function VAt(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+n*a,t[1]=s*l+o*a,t[2]=r*-a+n*l,t[3]=s*-a+o*l,t}function zAt(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1];return t[0]=r*a,t[1]=s*a,t[2]=n*l,t[3]=o*l,t}function BAt(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t}function jAt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function GAt(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function HAt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function qAt(t,e,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,e,i]}function WAt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function e5e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function ZAt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function YAt(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=Do();return Math.abs(i-o)<=u*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=u*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=u*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=u*Math.max(1,Math.abs(n),Math.abs(c))}function XAt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function JAt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}const QAt=K4e,KAt=e5e;Object.freeze(Object.defineProperty({__proto__:null,LDU:qAt,add:WAt,adjoint:kAt,copy:LAt,determinant:UAt,equals:YAt,exactEquals:ZAt,frob:HAt,fromRotation:BAt,fromScaling:jAt,identity:DAt,invert:FAt,mul:QAt,multiply:K4e,multiplyScalar:XAt,multiplyScalarAndAdd:JAt,rotate:VAt,scale:zAt,set:Q4e,str:GAt,sub:KAt,subtract:e5e,transpose:NAt},Symbol.toStringTag,{value:"Module"}));function t5e(){return[1,0,0,1]}function ePt(t){return[t[0],t[1],t[2],t[3]]}function tPt(t,e,i,r){return[t,e,i,r]}function iPt(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:ePt,create:t5e,createView:iPt,fromValues:tPt},Symbol.toStringTag,{value:"Module"}));let i5e=class{constructor(){this.vLeft=E(),this.vRight=E(),this.vMinSiblingLength=0,this.frame=new q4e}setFrameFromUpVector(e){ve(this.frame.up,e),Ee(mR,this.vLeft,this.vRight),Ce(mR,mR),he(Q0e,this.frame.up,Te(mR,this.frame.up)),Re(B4,mR,Q0e),Ce(B4,B4),ft(this.frame.right,B4,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}},rPt=class extends i5e{get rotationFrameUp(){return this.frame.up}get rotationRight(){return LMe}get rotationAngle(){return he(gv,this.frame.up,Te(this.frame.up,this.vLeft)),Re(gv,this.vLeft,gv),sa(gv,gv),Ce(gv,gv),he(CE,this.frame.up,Te(this.frame.up,this.vRight)),Re(CE,this.vRight,CE),Ce(CE,CE),ft(WB,this.rotationFrameUp,this.vLeft),Math.sign(Te(WB,this.vRight))*(Math.PI-po(Te(gv,CE)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,i){const r=this.rotationAngle;if(Math.abs(r)<=0)return i;const s=gZ(Math.cos(.5*r));return Li(e,(s-1+1)*i[0],i[1])}},sPt=class extends i5e{get rotationFrameUp(){const e=Math.sign(Te(this.frame.right,this.vRight));return ft(fR,this.vRight,this.vLeft),he(fR,fR,e),Ce(fR,fR)}get rotationRight(){const e=this.rotationFrameUp,i=Te(e,this.frame.up),r=Te(e,this.frame.right);return he(EE,this.frame.up,-r),he(J0e,this.frame.right,i),Ee(EE,EE,J0e),Ce(EE,EE),nPt(X0e,this.frame,EE),X0e}get rotationAngle(){const e=Math.sign(Te(this.frame.right,this.vRight));return sa(WB,this.vLeft),-e*(Math.PI-po(Te(WB,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*gZ(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,i){const r=this.rotationAngle;if(Math.abs(r)===0)return i;const s=gZ(Math.cos(.5*r)),n=this.rotationRight,o=Q4e(aPt,1+(s-1)*n[0]*n[0],(s-1)*n[0]*n[1],(s-1)*n[0]*n[1],1+(s-1)*n[1]*n[1]);return PRe(e,i,o)}};function nPt(t,e,i){Li(t,Te(i,e.right),Te(i,e.up))}function oPt(t){switch(t){case qg.World:return new rPt;case qg.Path:return new sPt}}const fR=E(),X0e=mt(),EE=E(),J0e=E(),WB=E(),gv=E(),CE=E(),Q0e=E(),mR=E(),B4=E(),aPt=t5e(),$9=8;function lPt(t,e){const i=R.FEATUREVALUE;t.attributes.add(i,"vec4");const r=t.vertex;r.code.add(T`
  bool isCapVertex() {
    return ${i}.w == 1.0;
  }
  `),r.uniforms.add(new jr("size",s=>s.size)),e.vvSize?(r.uniforms.add(new Wt("vvSizeMinSize",s=>s.vvSize.minSize),new Wt("vvSizeMaxSize",s=>s.vvSize.maxSize),new Wt("vvSizeOffset",s=>s.vvSize.offset),new Wt("vvSizeFactor",s=>s.vvSize.factor)),r.code.add(T`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${i}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):r.code.add(T`vec2 getSize(){
return size;
}`),e.vvOpacity?(r.constants.add("vvOpacityNumber","int",$9),r.uniforms.add(new Yl("vvOpacityValues",s=>s.vvOpacity.values,$9),new Yl("vvOpacityOpacities",s=>s.vvOpacity.opacityValues,$9)),r.code.add(T`
    vec4 applyOpacity(vec4 color) {
      float value = ${i}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):r.code.add(T`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(r.constants.add("vvColorNumber","int",hA),r.uniforms.add(new Yl("vvColorValues",s=>s.vvColor.values,hA),new J3e("vvColorColors",s=>s.vvColor.colors,hA)),r.code.add(T`
    vec4 getColor() {
      float value = ${i}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):r.code.add(T`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(FD),t.attributes.add(R.PROFILERIGHT,"vec4"),t.attributes.add(R.PROFILEUP,"vec4"),t.attributes.add(R.PROFILEVERTEXANDNORMAL,"vec4"),r.code.add(T`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),r.code.add(T`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),r.code.add(T`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),r.code.add(T`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let cPt=class extends HD{constructor(){super(...arguments),this.size=Ei(1,1)}};function VL(t,e){e.spherical?t.vertex.code.add(T`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(T`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(T`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(T`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function r5e(t){const e=new Hi,{vertex:i,fragment:r}=e;switch(Nc(i,t),e.varyings.add("vpos","vec3"),e.include(lPt,t),t.output!==j.Color&&t.output!==j.ObjectAndLayerIdColor||(e.include(al,t),e.include(vP,t),e.include(sO,t),e.include(L2,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.multipassEnabled&&e.varyings.add("depth","float"),i.code.add(T`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===j.Color?"forwardLinearDepth();":""}
        forwardObjectAndLayerIdColor();

        vcolor = getColor();
      }
    `)),e.include(xy,t),t.output){case j.Color:e.include(bn,t),e.include(e2,t),e.include(JD,t),e.include(vP,t),e.include(OLe,t),Qf(r,t),QD(r),uO(r),r.uniforms.add(i.uniforms.get("localOrigin"),new Wt("ambient",s=>s.ambient),new Wt("diffuse",s=>s.diffuse),new Wt("specular",s=>s.specular),new et("opacity",s=>s.opacity)),r.include(by),t.transparencyPassType===pt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),my(r),r.code.add(T`
        void main() {
          discardBySlice(vpos);
          ${t.multipassEnabled?"terrainDepthTest(depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${t.transparencyPassType===pt.ColorAlpha?T`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}
        }
      `);break;case j.Depth:e.include(al,t),i.code.add(T`void main() {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(bn,t),r.code.add(T`void main() {
discardBySlice(vpos);
}`);break;case j.Shadow:case j.ShadowHighlight:case j.ShadowExcludeHighlight:case j.ViewshedShadow:e.include(al,t),XG(e),e.varyings.add("depth","float"),i.code.add(T`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(bn,t),e.include(M6,t),r.code.add(T`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case j.ObjectAndLayerIdColor:e.include(bn,t),r.code.add(T`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`);break;case j.Normal:e.include(al,t),e.include(VL,t),uP(i),e.varyings.add("vnormal","vec3"),i.code.add(T`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(bn,t),r.code.add(T`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case j.Highlight:e.include(al,t),e.include(VL,t),e.varyings.add("vnormal","vec3"),i.code.add(T`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(bn,t),e.include(rw,t),r.code.add(T`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const uPt=Object.freeze(Object.defineProperty({__proto__:null,build:r5e},Symbol.toStringTag,{value:"Module"})),s5e=new Map([[R.POSITION,0],[R.PROFILERIGHT,1],[R.PROFILEUP,2],[R.PROFILEVERTEXANDNORMAL,3],[R.FEATUREVALUE,4],[R.OBJECTANDLAYERIDCOLOR,5]]);let hPt=class extends cPt{constructor(){super(...arguments),this.ambient=Ge(.2,.2,.2),this.diffuse=Ge(.8,.8,.8),this.specular=Ge(0,0,0),this.opacity=1,this.origin=E(),this.modelTransformation=null}},n5e=class o5e extends Qi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Xe.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Ki(e.rctx,o5e.shader.get().build(this.configuration),s5e)}initializePipeline(){const e=this.configuration.transparencyPassType,i=this.configuration,r=e===pt.NONE,s=e===pt.FrontFace;return Jt({blending:i.output===j.Color&&i.transparent?r?Ru:$_(e):null,culling:i.hasSlicePlane&&!i.transparent&&i.doubleSidedMode!==Cs.None?kRe:null,depthTest:{func:sw(e)},depthWrite:r||s?Nu:null,drawBuffers:i.output===j.Depth?{buffers:[no.NONE]}:I_(e),colorWrite:ui,stencilWrite:i.hasOccludees?oy:null,stencilTest:i.hasOccludees?nw:null,polygonOffset:r||s?null:b6})}};n5e.shader=new qi(uPt,()=>ce(()=>Promise.resolve().then(()=>MHt),void 0));let Ln=class extends Uc{constructor(){super(...arguments),this.output=j.Color,this.doubleSidedMode=Cs.None,this.transparencyPassType=pt.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1,this.objectAndLayerIdColorInstanced=!1}};h([B({count:j.COUNT})],Ln.prototype,"output",void 0),h([B({count:Cs.COUNT})],Ln.prototype,"doubleSidedMode",void 0),h([B({count:pt.COUNT})],Ln.prototype,"transparencyPassType",void 0),h([B()],Ln.prototype,"spherical",void 0),h([B()],Ln.prototype,"receiveShadows",void 0),h([B()],Ln.prototype,"receiveAmbientOcclusion",void 0),h([B()],Ln.prototype,"vvSize",void 0),h([B()],Ln.prototype,"vvColor",void 0),h([B()],Ln.prototype,"vvOpacity",void 0),h([B()],Ln.prototype,"hasSlicePlane",void 0),h([B()],Ln.prototype,"transparent",void 0),h([B()],Ln.prototype,"hasOccludees",void 0),h([B()],Ln.prototype,"multipassEnabled",void 0),h([B()],Ln.prototype,"cullAboveGround",void 0),h([B()],Ln.prototype,"doublePrecisionRequiresObfuscation",void 0),h([B({constValue:!1})],Ln.prototype,"occlusionPass",void 0),h([B({constValue:At.Disabled})],Ln.prototype,"pbrMode",void 0),h([B({constValue:!0})],Ln.prototype,"hasVvInstancing",void 0),h([B({constValue:!1})],Ln.prototype,"useCustomDTRExponentForWater",void 0),h([B({constValue:!1})],Ln.prototype,"useFillLights",void 0),h([B({constValue:!1})],Ln.prototype,"hasColorTexture",void 0);let dPt=class a5e extends iw{constructor(e){super(e,new fPt),this.supportsEdges=!0,this.produces=new Map([[Pe.OPAQUE_MATERIAL,i=>(this.parameters.castShadows&&rA(i)||a3(i))&&!this.parameters.transparent],[Pe.TRANSPARENT_MATERIAL,i=>(this.parameters.castShadows&&rA(i)||a3(i))&&this.parameters.transparent]]),this._vertexAttributeLocations=s5e,this._configuration=new Ln,this._vertexBufferLayout=a5e.getVertexBufferLayout()}getConfiguration(e,i){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e===j.Color&&(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Cs.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Cs.WindingOrder:Cs.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=i.ssao!=null),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==j.Shadow&&e!==j.ShadowExcludeHighlight&&e!==j.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,i,r,s,n,o){const a=e;if(!W4e(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:b,factor:w,minSize:x,maxSize:S}=this.parameters.vvSize,C=l.sizeAttributeValue;c[0]*=Ne(b[0]+C*w[0],x[0],S[0]),c[1]*=Ne(b[2]+C*w[2],x[2],S[2])}const u=new ZD(!1,r.options.normalRequired),d=Math.max(c[0],c[1]),f=e.boundingInfo;if(f==null)return void K0e(l,c,s,n,u,o);const m=ZS(f.bbMin[0]-d,f.bbMin[1]-d,f.bbMin[2]-d,f.bbMax[0]+d,f.bbMax[1]+d,f.bbMax[2]+d),g=[n[0]-s[0],n[1]-s[1],n[2]-s[2]],y=Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]),v=[y/g[0],y/g[1],y/g[2]];roe(m,s,v,r.tolerance)&&K0e(l,c,s,n,u,o)}createBufferWriter(){return new lO(this._vertexBufferLayout)}createGLMaterial(e){return new pPt(e)}static getVertexBufferLayout(){const e=As().vec3f(R.POSITION).vec4f(R.PROFILERIGHT).vec4f(R.PROFILEUP).vec4f(R.PROFILEVERTEXANDNORMAL).vec4f(R.FEATUREVALUE);return le("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(R.OBJECTANDLAYERIDCOLOR),e}},pPt=class extends ew{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){this.technique!=null&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output===j.Color&&(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(n5e,e)}};function K0e(t,e,i,r,s,n){t.baked.size&&t.baked.size[0]===e[0]&&t.baked.size[1]===e[1]||t.baked.bake(e),t.baked.intersect(i,r,s,n)}let fPt=class extends hPt{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const mPt=["polyline"];let gPt=class extends Sy{constructor(e,i,r,s){super(e,i,r,s),this._intrinsicSize=Ei(1,1),this._upVectorAlignment=qg.Path,this._stencilWidth=.1,this.usedMemory=0,this.ensureDrapedStatus(!1)}async doLoad(){var f,m,g,y,v;const e=this.symbolLayer.width!=null?this.symbolLayer.width:this.symbolLayer.height,i=this.symbolLayer.height!=null?this.symbolLayer.height:e;this._vvConvertOptions=new GD({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,i],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=((m=(f=this._context.renderer)==null?void 0:f.visualVariables)==null?void 0:m.length)>0?fP(this._context.renderer,this._vvConvertOptions):null;const r=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?qg.World:qg.Path;const s=this.symbolLayer.profile||"circle";switch(s){default:case"circle":this._profile=$At[r];break;case"quad":this._profile=IAt[r]}switch(this.symbolLayer.join){case"round":this._extruder=new P9(0,bLe);break;case"bevel":this._extruder=new P9(0,1);break;case"miter":this._extruder=new P9(.8*Math.PI,1);break;default:this._extruder=new vAt}const n=this.symbolLayer.cap||"butt";switch(n){case"none":this._startCap=new H0e,this._endCap=new H0e;break;case"butt":default:this._startCap=new z4(this._profile,0),this._endCap=new z4(this._profile,0,!0);break;case"square":this._startCap=new z4(this._profile,-.5),this._endCap=new z4(this._profile,.5,!0);break;case"round":{const b=s==="quad";this._startCap=new q0e({profile:this._profile,flip:!1,breakNormals:b,subdivisions:GQ}),this._endCap=new q0e({profile:this._profile,flip:!0,breakNormals:b,subdivisions:GQ});break}}const o=(y=(g=this.symbolLayer)==null?void 0:g.material)==null?void 0:y.color,a=this._getCombinedOpacityAndColor(o),l=zl(a),c=a[3],u=c<1||this.needsDrivenTransparentPass,d={diffuse:l,ambient:l,opacity:c,transparent:u,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:u||n==="none"?Br.None:Br.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(Li(this._intrinsicSize,e,i),!jQ(this._intrinsicSize[0])||!jQ(this._intrinsicSize[1])))throw new G("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if((v=this._fastUpdates)!=null&&v.visualVariables.size||bh(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const b={...d,...this._fastUpdates.materialParameters,size:PMe(this._intrinsicSize)};this._materials[0]=new dPt(b)}else d.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,d.normalType=sr.Compressed,this._materials[0]=new em(d);this._materials[0].setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials[0]=null,this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,mPt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i),s=e.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(){var s,n,o;const e=(n=(s=this.symbolLayer)==null?void 0:s.material)==null?void 0:n.color,i=this._getCombinedOpacity(e),r=i<1||this.needsDrivenTransparentPass;(o=this._materials[0])==null||o.setParameters({opacity:i,transparent:r})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Fb)}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){var e;return(e=this._materials[0])==null||e.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,i){var r;for(const s in e.diff){if(s!=="visualVariables"||!mP(this._fastUpdates,i,this._vvConvertOptions))return cn.RecreateSymbol;(r=this._materials[0])==null||r.setParameters(this._fastUpdates.materialParameters)}return cn.FastUpdate}_getVertexData(e){let i=0;const r=e.paths,s=[],n=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const d of r)i+=d.length;const l=co(3*i);let c,u=0;for(const d of r){s.push({offset:u,numVertices:d.length});for(const f of d)l[u++]=f[0],l[u++]=f[1],l[u++]=e.hasZ?f[2]:0}return o==null||n.equals(o)||ds(l,n,0,l,o,0,i)?(o==null||o.equals(a)?c=aIe(l):(c=co(3*i),ds(l,o,0,c,a,0,i)),{pathVertexDataInfos:s,vertexDataES:l,vertexDataRS:c}):null}_createAs3DShape(e,i,r,s){var g,y,v;this.usedMemory=0;const n=e.geometry,o=this._getVertexData(n);if(o==null)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(o.pathVertexDataInfos.length===0)return n.paths.length!==0&&n.paths.some(b=>b.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const a=new Array,l=n.spatialReference,c=Xn(),u=this._context.renderCoordsHelper,d=new lse(o.vertexDataES);for(const b of o.pathVertexDataInfos){const w=b.numVertices;if(w<2)continue;const x=b.offset;if(this._context.clippingExtent!=null&&(Zr(c),Mh(c,o.vertexDataES,x,w),!Mf(c,this._context.clippingExtent)))continue;const S=new Array,C=x+3*w;for(let V=x;V<C;V+=3){d.offset=V;const X=Gyt(d,this._context.elevationProvider,r,u);de(Xs,o.vertexDataRS[V],o.vertexDataRS[V+1],o.vertexDataRS[V+2]),u.setAltitude(Xs,X),o.vertexDataRS[V]=Xs[0],o.vertexDataRS[V+1]=Xs[1],o.vertexDataRS[V+2]=Xs[2],S.push(oPt(this._upVectorAlignment))}const M=new gAt(S,o.vertexDataES,o.vertexDataRS,x);l5e(M,this._upVectorAlignment,this._context.renderCoordsHelper);const O=new yAt(M,this._profile,this._extruder,this._startCap,this._endCap);let D=null;if(this._fastUpdates){const V=this._fastUpdates.visualVariables,X=kf((g=V.size)==null?void 0:g.field,e)??0,q=kf((y=V.color)==null?void 0:y.field,e)??0,Z=kf((v=V.opacity)==null?void 0:v.field,e)??0;D=new TAt(O,X,q,Z)}else{const V=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const Z=i.size;V[0]*=e_e(Z[0],Z[2]==="symbol-value"?this.symbolLayer.height||0:Z[2],this.symbolLayer.width||0),V[1]*=e_e(Z[2],Z[0]==="symbol-value"?this.symbolLayer.width||0:Z[0],this.symbolLayer.height||0)}let X;this._drivenProperties.color&&(X=i.color),this._drivenProperties.opacity&&i.opacity!=null&&(X=X?[X[0],X[1],X[2],i.opacity]:[1,1,1,i.opacity]);const q=new Y4e(O);q.bake(V),X&&q.bakeVertexColors(X),D=q}const U=D.createGeometryData(),k=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),H=new xAt(this._materials[0],U,D,l,this._stencilWidth,k);H.transformation=dl(ke(),Wr,O.path.origin),a.push(H),this.usedMemory+=O.usedMemory}if(a.length===0)return null;const f=new ow({geometries:a,layerUid:this._context.layer.uid,graphicUid:s}),m=new Ty(this,f,a,null,null,(b,w,x,S,C)=>_Pt(b,w,S,C,this._upVectorAlignment),r);return m.alignedSampledElevation=0,m.needsElevationUpdates=Fb(r.mode),m}};function l5e(t,e,i){const{origin:r,positions:s}=t;let n=t.offset;switch(e){default:case qg.World:for(const o of t.vertices)Xs[0]=s[n++]+r[0],Xs[1]=s[n++]+r[1],Xs[2]=s[n++]+r[2],i.worldUpAtPosition(Xs,Xs),o.setFrameFromUpVector(Xs);break;case qg.Path:Xs[0]=s[n]+r[0],Xs[1]=s[n+1]+r[1],Xs[2]=s[n+2]+r[2],i.worldUpAtPosition(Xs,Xs),OAt(t,Xs)}}function e_e(t,e,i){switch(t){case"symbol-value":return i;case"proportional":return e;default:return t}}function yPt(t,e,i,r){let s=0;const{origin:n,vertices:o,positions:a,positionsES:l}=t,c=t.offset+3*o.length;for(let u=t.offset;u<c;u+=3)de(Xs,l[u],l[u+1],l[u+2]),i(Xs,I9),s+=I9.sampledElevation,Xs[0]=a[u]+n[0],Xs[1]=a[u+1]+n[1],Xs[2]=a[u+2]+n[2],r.setAltitude(Xs,I9.z),a[u]=Xs[0]-n[0],a[u+1]=Xs[1]-n[1],a[u+2]=Xs[2]-n[2];return t.updatePathVertexInformation(),s/o.length}function _Pt(t,e,i,r,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!W4e(l))continue;const c=l.path,u=c.builder.path;a+=yPt(u,e,i,r),s!==qg.World&&l5e(u,s,r),c.onPathChanged(l),l.invalidateBoundingInfo(),n.geometryVertexAttributeUpdated(l,R.POSITION)}return a/o.length}const Xs=E(),I9=new WD;function vPt(t,e,i,r,s=1){if(i.isGeographic&&r===Xe.Global){const c=co(e.length),u=e.length,d=_r(i);for(let f=0;f<u;f+=3)xre(e,f,c,f,d);e=c}Li(jn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)jn[0]=Math.min(jn[0],e[c]),jn[1]=Math.min(jn[1],e[c+1]);const n=jn[0]%s,o=jn[1]%s,a=jn[0]-n,l=jn[1]-o;for(let c=0;c<e.length;c+=3){const u=c/3*4;t[u]=(e[c]-a)/s,t[u+1]=(e[c+1]-l)/s,t[u+2]=a/s,t[u+3]=l/s}}function c5e(t,e,i,r,s=1){de(jw,1,0,0),de(Gw,0,1,0),de(AE,0,0,1),wPt(L9,i),JKe(t_e,i)&&bPt(t_e,jw,Gw,AE,r,L9),Li(jn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Li(Hw,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let u=0;u<i.length;u+=3){de(ME,i[u],i[u+1],i[u+2]);const d=Te(jw,ME),f=Te(Gw,ME);jn[0]=Math.min(jn[0],d),jn[1]=Math.min(jn[1],f),Hw[0]=Math.max(Hw[0],d),Hw[1]=Math.max(Hw[1],f)}const n=Te(AE,L9);N9(yv,jn[0],jn[1],n,jw,Gw,AE),N9(qw,Hw[0],jn[1],n,jw,Gw,AE),N9(Ww,jn[0],Hw[1],n,jw,Gw,AE),Re(qw,qw,yv),he(qw,qw,.5),Re(Ww,Ww,yv),he(Ww,Ww,.5),Ee(yv,yv,qw),Ee(yv,yv,Ww);const o=jn[0]%s,a=jn[1]%s,l=jn[0]-o,c=jn[1]-a;for(let u=0;u<i.length;u+=3){de(ME,i[u],i[u+1],i[u+2]);const d=u/3,f=4*d;t[f]=(Te(jw,ME)-l)/s,t[f+1]=(Te(Gw,ME)-c)/s,t[f+2]=l/s,t[f+3]=c/s;const m=9*d;for(let g=0;g<3;g++)e[m+g]=yv[g],e[m+g+3]=qw[g],e[m+g+6]=Ww[g]}}const L9=E(),ME=E(),t_e=tr(),jw=E(),Gw=E(),AE=E(),jn=mt(),Hw=mt(),yv=E(),qw=E(),Ww=E();function bPt(t,e,i,r,s,n){s!=null?(s.basisMatrixAtPosition(n,Sm),de(j4,Sm[0],Sm[1],Sm[2]),de(G4,Sm[4],Sm[5],Sm[6]),de(D9,Sm[8],Sm[9],Sm[10])):(de(j4,1,0,0),de(G4,0,1,0),de(D9,0,0,1));const o=t;Te(o,D9)<0&&he(o,o,-1),ve(r,o);const a=Te(o,G4),l=Te(o,j4);Math.abs(a)>Math.abs(l)?(Pn(e,j4,o,-l),Ce(e,e),ft(i,e,o),Ce(i,i),he(i,i,-1)):(Pn(i,G4,o,-a),Ce(i,i),ft(e,i,o),Ce(e,e))}const Sm=ke(),j4=E(),G4=E(),D9=E();function wPt(t,e){de(gR,0,0,0);for(let i=0;i<e.length-3;i+=3)gR[0]+=e[i],gR[1]+=e[i+1],gR[2]+=e[i+2];he(t,gR,1/(e.length/3-1))}const gR=E();function N9(t,e,i,r,s,n,o){de(t,e*s[0]+i*n[0]+r*o[0],e*s[1]+i*n[1]+r*o[1],e*s[2]+i*n[2]+r*o[2])}let sae=class extends iw{intersect(e,i,r,s,n,o){return RLe(e,r,s,n,void 0,o)}};function u5e(t){const e=new Hi,{vertex:i,fragment:r,attributes:s,varyings:n}=e;Nc(i,t),e.include(al,t),e.include(D2,t),e.include(e_,t),e.include(L2,t),s.add(R.POSITION,"vec3"),t.vvColor&&s.add(R.COLORFEATUREATTRIBUTE,"float"),n.add("vColor","vec4"),n.add("vpos","vec3");const o=t.multipassEnabled&&t.output===j.Color;o&&n.add("depth","float"),i.uniforms.add(new ji("eColor",l=>l.color)),i.code.add(T`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${t.hasVertexColors?"vColor *= eColor;":t.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${o?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),e.include(bn,t),o&&e.include(xy,t),r.include(by);const a=t.output===j.Highlight;return a&&e.include(rw,t),t.transparencyPassType===pt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),r.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${o?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;

    ${t.output===j.ObjectAndLayerIdColor?T`fColor.a = 1.0;`:""}

    if (fColor.a < ${T.float(ea)}) {
      discard;
    }

    ${t.output===j.Color?T`fragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===pt.ColorAlpha?T`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}`:""}
    ${a?T`outputHighlight();`:""};
    ${t.output===j.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const xPt=Object.freeze(Object.defineProperty({__proto__:null,build:u5e},Symbol.toStringTag,{value:"Module"}));let h5e=class d5e extends Qi{initializeProgram(e){return new Ki(e.rctx,d5e.shader.get().build(this.configuration),Ai)}_createPipeline(e,i){const r=this.configuration,s=e===pt.NONE,n=e===pt.FrontFace;return Jt({blending:r.output===j.Color&&r.transparent?s?Ru:$_(e):null,culling:WG(r.cullFace),depthTest:r.draped?null:{func:sw(e)},depthWrite:r.draped?null:(s||n)&&r.writeDepth?Nu:null,drawBuffers:r.output===j.Depth?{buffers:[no.NONE]}:I_(e),colorWrite:ui,stencilWrite:r.hasOccludees?oy:null,stencilTest:r.hasOccludees?i?kb:nw:null,polygonOffset:s||n?r.polygonOffset?TPt:null:w6(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};h5e.shader=new qi(xPt,()=>ce(()=>Promise.resolve().then(()=>AHt),void 0));const TPt={factor:1,units:1};let wo=class extends Uc{constructor(){super(...arguments),this.output=j.Color,this.cullFace=Br.None,this.transparencyPassType=pt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1}};h([B({count:j.COUNT})],wo.prototype,"output",void 0),h([B({count:Br.COUNT})],wo.prototype,"cullFace",void 0),h([B({count:pt.COUNT})],wo.prototype,"transparencyPassType",void 0),h([B()],wo.prototype,"hasSlicePlane",void 0),h([B()],wo.prototype,"hasVertexColors",void 0),h([B()],wo.prototype,"transparent",void 0),h([B()],wo.prototype,"polygonOffset",void 0),h([B()],wo.prototype,"enableOffset",void 0),h([B()],wo.prototype,"writeDepth",void 0),h([B()],wo.prototype,"hasOccludees",void 0),h([B()],wo.prototype,"multipassEnabled",void 0),h([B()],wo.prototype,"cullAboveGround",void 0),h([B()],wo.prototype,"objectAndLayerIdColorInstanced",void 0),h([B()],wo.prototype,"vvColor",void 0),h([B()],wo.prototype,"draped",void 0),h([B({constValue:!1})],wo.prototype,"occlusionPass",void 0),h([B({constValue:!0})],wo.prototype,"hasVvInstancing",void 0),h([B({constValue:!1})],wo.prototype,"vvSize",void 0),h([B({constValue:!1})],wo.prototype,"vvOpacity",void 0);let i_e=class extends sae{constructor(e){super(e,new EPt),this.supportsEdges=!0,this.produces=new Map([[Pe.OPAQUE_MATERIAL,i=>i===j.Highlight||N8(i)&&!this._isTransparent],[Pe.OPAQUE_NO_SSAO_DEPTH,i=>nb(i)&&this.parameters.writeLinearDepth&&!this._isTransparent],[Pe.TRANSPARENT_MATERIAL,i=>N8(i)&&this._isTransparent&&this.parameters.writeDepth],[Pe.TRANSPARENT_NO_SSAO_DEPTH,i=>nb(i)&&this.parameters.writeLinearDepth&&this._isTransparent&&this.parameters.writeDepth],[Pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>(N8(i)||nb(i)&&this.parameters.writeLinearDepth)&&this._isTransparent&&!this.parameters.writeDepth],[Pe.DRAPED_MATERIAL,i=>k$e(i)]]),this._configuration=new wo}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<v6,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}createGLMaterial(e){return new SPt(e)}createBufferWriter(){const e=As().vec3f(R.POSITION);return le("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(R.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(R.COLORFEATUREATTRIBUTE):e.vec4u8(R.COLOR),new lO(e)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}},SPt=class extends ew{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===j.Color&&this._updateOccludeeState(e),this.ensureTechnique(h5e,e)}},EPt=class extends HD{constructor(){super(...arguments),this.color=Rh,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Br.None,this.hasOccludees=!1,this.draped=!1}};var Ko;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(Ko||(Ko={}));const CK=.70710678118,r_e=CK,CPt=.08715574274;function p5e(t){const e=new Hi,i=t.multipassEnabled&&t.output===j.Color,{vertex:r,fragment:s,attributes:n,varyings:o}=e;Nc(r,t),e.include(al,t),e.include(D2,t),e.include(e_,t),e.include(L2,t),t.draped?r.uniforms.add(new et("worldToScreenRatio",(l,c)=>1/c.screenToPCSRatio)):n.add(R.BOUNDINGRECT,"mat3"),n.add(R.POSITION,"vec3"),n.add(R.UVMAPSPACE,"vec4"),t.vvColor&&n.add(R.COLORFEATUREATTRIBUTE,"float"),o.add("vColor","vec4"),o.add("vpos","vec3"),o.add("vuv","vec2"),i&&o.add("depth","float"),r.uniforms.add(new ji("uColor",l=>l.color));const a=t.style===Ko.ForwardDiagonal||t.style===Ko.BackwardDiagonal||t.style===Ko.DiagonalCross;return a&&r.code.add(T`
      const mat2 rotate45 = mat2(${T.float(CK)}, ${T.float(-r_e)},
                                 ${T.float(r_e)}, ${T.float(CK)});
    `),t.draped||(Qf(r,t),r.uniforms.add(new et("worldToScreenPerDistanceRatio",(l,c)=>1/c.camera.perScreenPixelRatio)),r.code.add(T`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),r.code.add(T`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),r.code.add(T`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${T.float(CPt)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),r.code.add(T`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${a?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${a?" * rotate45":""};

      ${t.draped?"":T`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${T.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),r.code.add(T`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${t.hasVertexColors?"vColor *= uColor;":t.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),e.include(bn,t),s.include(by),t.draped&&s.uniforms.add(new et("texelSize",(l,c)=>1/c.camera.pixelRatio)),t.output===j.Highlight&&e.include(rw,t),i&&e.include(xy,t),t.output!==j.Highlight&&(s.code.add(T`
      const float lineWidth = ${T.float(t.lineWidth)};
      const float spacing = ${T.float(t.patternSpacing)};
      const float spacingINV = ${T.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||s.code.add(T`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),t.transparencyPassType===pt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),s.code.add(T`
    void main() {
      discardBySlice(vpos);
      ${i?"terrainDepthTest(depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${t.output!==j.Highlight?T`color.a *= ${MPt(t)};`:""}

      ${t.output===j.ObjectAndLayerIdColor?T`color.a = 1.0;`:""}

      if (color.a < ${T.float(ea)}) {
        discard;
      }

      ${t.output===j.Color?T`fragColor = color; ${t.transparencyPassType===pt.ColorAlpha?T`
                    fragColor = premultiplyAlpha(fragColor);
                    fragAlpha = fragColor.a;`:""}`:""}
      ${t.output===j.Highlight?T`outputHighlight();`:""}
      ${t.output===j.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:""}
    }
  `),e}function MPt(t){function e(i){return t.draped?T`coverage(vuv.${i}, texelSize)`:T`sampleAA(vuv.${i})`}switch(t.style){case Ko.ForwardDiagonal:case Ko.Horizontal:return e("y");case Ko.BackwardDiagonal:case Ko.Vertical:return e("x");case Ko.DiagonalCross:case Ko.Cross:return T`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const APt=Object.freeze(Object.defineProperty({__proto__:null,build:p5e},Symbol.toStringTag,{value:"Module"}));let f5e=class m5e extends Qi{initializeProgram(e){return new Ki(e.rctx,m5e.shader.get().build(this.configuration),le("enable-feature:objectAndLayerId-rendering")?y5e:g5e)}_setPipelineState(e,i){const r=this.configuration,s=e===pt.NONE,n=e===pt.FrontFace;return Jt({blending:r.output===j.Color?s?Ru:$_(e):null,culling:WG(r.cullFace),depthTest:r.draped?null:{func:sw(e)},depthWrite:r.draped?null:s?Nu:_6(e),drawBuffers:r.output===j.Depth?{buffers:[no.NONE]}:I_(e),colorWrite:ui,stencilWrite:r.hasOccludees?oy:null,stencilTest:r.hasOccludees?i?kb:nw:null,polygonOffset:s||n?r.polygonOffset?PPt:null:w6(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};f5e.shader=new qi(APt,()=>ce(()=>Promise.resolve().then(()=>PHt),void 0));const PPt={factor:1,units:1};let eo=class extends Uc{constructor(){super(...arguments),this.output=j.Color,this.cullFace=Br.None,this.transparencyPassType=pt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasOccludees=!1,this.enableOffset=!0,this.multipassEnabled=!1,this.cullAboveGround=!1,this.vvColor=!1,this.objectAndLayerIdColorInstanced=!1}};h([B({count:j.COUNT})],eo.prototype,"output",void 0),h([B({count:Br.COUNT})],eo.prototype,"cullFace",void 0),h([B({count:Ko.COUNT})],eo.prototype,"style",void 0),h([B({count:pt.COUNT})],eo.prototype,"transparencyPassType",void 0),h([B()],eo.prototype,"hasSlicePlane",void 0),h([B()],eo.prototype,"hasVertexColors",void 0),h([B()],eo.prototype,"polygonOffset",void 0),h([B()],eo.prototype,"hasOccludees",void 0),h([B()],eo.prototype,"patternSpacing",void 0),h([B()],eo.prototype,"lineWidth",void 0),h([B()],eo.prototype,"enableOffset",void 0),h([B()],eo.prototype,"draped",void 0),h([B()],eo.prototype,"multipassEnabled",void 0),h([B()],eo.prototype,"cullAboveGround",void 0),h([B()],eo.prototype,"vvColor",void 0),h([B({constValue:!0})],eo.prototype,"writeDepth",void 0),h([B({constValue:!1})],eo.prototype,"occlusionPass",void 0),h([B({constValue:!1})],eo.prototype,"hasVvInstancing",void 0),h([B({constValue:!1})],eo.prototype,"vvSize",void 0),h([B({constValue:!1})],eo.prototype,"vvOpacity",void 0);const g5e=new Map([[R.POSITION,0],[R.COLOR,3],[R.UVMAPSPACE,4],[R.COLORFEATUREATTRIBUTE,5],[R.BOUNDINGRECT,6]]),y5e=new Map([[R.POSITION,0],[R.COLOR,3],[R.UVMAPSPACE,4],[R.COLORFEATUREATTRIBUTE,5],[R.BOUNDINGRECT,6],[R.OBJECTANDLAYERIDCOLOR,9]]);let nae=class extends sae{constructor(e){super(e,new IPt),this.supportsEdges=!0,this.produces=new Map([[Pe.OPAQUE_MATERIAL,i=>mS(i)],[Pe.TRANSPARENT_MATERIAL,i=>Q0(i)],[Pe.TRANSPARENT_NO_SSAO_DEPTH,i=>nb(i)&&this.parameters.writeLinearDepth],[Pe.DRAPED_MATERIAL,i=>this.parameters.draped&&i===j.Color||mS(i)]]),this._vertexAttributeLocations=le("enable-feature:objectAndLayerId-rendering")?y5e:g5e,this._configuration=new eo}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<v6,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}createGLMaterial(e){return new OPt(e)}createBufferWriter(){const e=As().vec3f(R.POSITION).vec4f(R.UVMAPSPACE);return this.parameters.draped||e.mat3f(R.BOUNDINGRECT),this.parameters.vvColor?e.f32(R.COLORFEATUREATTRIBUTE):e.vec4u8(R.COLOR),le("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(R.OBJECTANDLAYERIDCOLOR),new RPt(e)}},OPt=class extends ew{_updateParameters(e){return this.ensureTechnique(f5e,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===j.Color&&this._updateOccludeeState(e),this._updateParameters(e)}},RPt=class extends lO{write(e,i,r,s,n){j3e(r,this.vertexBufferLayout,e,i,s,n);for(const o of this.vertexBufferLayout.fields.keys()){const a=r.attributes.get(o),l=a==null?void 0:a.indices;if(a&&l)switch(o){case R.UVMAPSPACE:{vt(a.size===4);const c=s.getField(o,Kf);c&&gP(a,c,n);break}case R.BOUNDINGRECT:{vt(a.size===9);const c=s.getField(o,$b);c&&$Pt(a,e,c,n);break}}}}};function $Pt(t,e,i,r){const{data:s,indices:n}=t,o=e,a=i.typedBuffer,l=i.typedBufferStride,c=n.length;r*=l;for(let u=0;u<c;++u){const d=9*n[u],f=s[d],m=s[d+1],g=s[d+2];a[r]=o[0]*f+o[4]*m+o[8]*g+o[12],a[r+1]=o[1]*f+o[5]*m+o[9]*g+o[13],a[r+2]=o[2]*f+o[6]*m+o[10]*g+o[14];for(let y=3;y<9;++y)a[r+y]=s[d+y];r+=l}}let IPt=class extends HD{constructor(){super(...arguments),this.color=ii(1,1,1,1),this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Br.None,this.hasOccludees=!1,this.style=Ko.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function LPt(t,e){const i=(t==null?void 0:t.pattern)??null;return i==null?new i_e(e):i.style==="none"||i.style==="solid"?(i.style==="none"&&(e.color=ii(0,0,0,0),e.forceTransparentMode=!0),new i_e(e)):(e.style=DPt(i.style),new nae(e))}function DPt(t){switch(t){case"horizontal":return Ko.Horizontal;case"vertical":return Ko.Vertical;case"cross":return Ko.Cross;case"forward-diagonal":return Ko.ForwardDiagonal;case"backward-diagonal":return Ko.BackwardDiagonal;case"diagonal-cross":return Ko.DiagonalCross;default:return}}function NPt(t){return t.material instanceof nae&&!t.material.parameters.draped}function FPt(t,e){if(NPt(t)){const i=t.attributes.get(R.POSITION).data,r=t.getMutableAttribute(R.UVMAPSPACE).data,s=t.getMutableAttribute(R.BOUNDINGRECT).data;c5e(r,s,i,e)}}function kPt(t,e,i,r,s){const n=hLe(t,e,i,r,s),o=t.stageObject.geometries;for(const a of o)FPt(a,s);return n}const UPt=["polyline","polygon","extent"],s_e=new GD({size:!1,color:!0,rotation:!1,opacity:!1});let _5e=class v5e extends Sy{constructor(e,i,r,s){super(e,i,r,s),this._needsUV=!1}async doLoad(){this._fastUpdates=fP(this._context.renderer,s_e)}_createMaterials(){var s,n,o;if(this._materials.length>0)return;const e=(n=(s=this.symbolLayer)==null?void 0:s.material)==null?void 0:n.color,i=this._getCombinedOpacityAndColor(e);this._materials[Ws.Fill]=LPt(this.symbolLayer,{color:i,forceTransparentMode:this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...(o=this._fastUpdates)==null?void 0:o.materialParameters}),this._needsUV=this._materials[Ws.Fill]instanceof nae;const r=this.symbolLayer.outline;if(BPt(r)){const a=d4e(r.pattern);this._materials[Ws.Outline]=new wM({width:wn(r.size),color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:a,cap:yK(r.patternCap||"butt")})}this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,UPt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._createMaterials(),this.draped?this._createAsOverlay(i,r):this._createAs3DShape(i,r,s)}applyRendererDiff(e,i){var r;for(const s in e.diff){if(s!=="visualVariables"||!mP(this._fastUpdates,i,s_e))return cn.RecreateSymbol;(r=this._materials[Ws.Fill])==null||r.setParameters(this._fastUpdates.materialParameters)}return cn.FastUpdate}layerOpacityChanged(){var e,i;if(this._materials[Ws.Fill]!=null){const r=this._materials[Ws.Fill].parameters.color,s=(i=(e=this.symbolLayer)==null?void 0:e.material)==null?void 0:i.color,n=this._getCombinedOpacity(s);this._materials[Ws.Fill].setParameters({color:[r[0],r[1],r[2],n],forceTransparentMode:this.needsDrivenTransparentPass})}if(this._materials[Ws.Outline]!=null){const r=this._materials[Ws.Outline].parameters.color;this._materials[Ws.Outline].setParameters({color:[r[0],r[1],r[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=qD(v5e.elevationModeChangeTypes,r,s);if(n!==ks.UPDATE)return n;const o=sp(s);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){var e;if((e=this._materials[Ws.Fill])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[Ws.Outline]){const i={hasSlicePlane:this._context.slicePlaneEnabled};this._materials[Ws.Outline].setParameters(i)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){var u;const s=IL(e.geometry);if(!s)return null;const n=Foe(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=new VPt(n,i,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=Es(4*a,!0),o.boundingRect=co(9*a,!0),c5e(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=(u=this._context.stage.renderView)==null?void 0:u.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(e,o),this._materials[Ws.Outline]&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,s.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new ow({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),c=new Ty(this,l,o.outGeometries,null,null,kPt,r);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=sp(r.mode),c}_createAs3DShapeFill(e,i){var s;const r=i.renderData.polygons;for(const{position:n,mapPositions:o,holeIndices:a,index:l,count:c}of r){if(this._context.clippingExtent!=null&&(Zr(Sp),Mh(Sp,o),!Mf(Sp,this._context.clippingExtent)))continue;const u=u1t(o,a,this._context.elevationProvider.spatialReference);if(u.length===0)continue;const d=(s=this._fastUpdates)==null?void 0:s.visualVariables.color,f=tge({material:this._materials[Ws.Fill],indices:u,mapPositions:o,attributeData:{position:n,color:d?null:i.color,colorFeature:d?kf(d.field,e):null,uvMapSpace:this._needsUV?Qz(i.uvMapSpace,4*l,4*c):null,boundingRect:this._needsUV?Xd(i.boundingRect,9*l,9*c):null,objectAndLayerIdColor:i.objectAndLayerIdColor}});i.outGeometries.push(f)}}_createAs3DShapeOutline(e){if(this._materials[Ws.Outline]==null)return;const i=e.renderData.outlines;for(const{mapPositions:r,position:s}of i){if(this._context.clippingExtent!=null&&(Zr(Sp),Mh(Sp,r),!Mf(Sp,this._context.clippingExtent)))continue;const n=_K(this._materials[Ws.Outline],{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:r,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(n)}}_createAsOverlay(e,i){var a;const r=IL(e.geometry);if(r==null)return null;this._materials[Ws.Fill].renderPriority=this._renderPriority+this._renderPriorityStep/2,this._materials[Ws.Outline]!=null&&(this._materials[Ws.Outline].renderPriority=this._renderPriority);const s=WNe(r,this._context.overlaySR),n=new zPt(s,i,this._context.layer.uid,e.uid),o=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=Es(4*o,!0),vPt(n.uvMapSpace,n.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),n.outBoundingBox=Zr(),n.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(n),this._createAsOverlayFill(e,n),this._materials[Ws.Outline]&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,r.rings,"rings","FillSymbol3DLayer"),n.outGeometries.length===0?null:new j6(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,i){var s;const r=i.renderData.polygons;for(const{position:n,holeIndices:o,index:a,count:l}of r){const c=Zr(Sp);if(Mh(c,n),!Mf(c,this._context.clippingExtent))continue;const u=bP(n,o,3);if(u.length===0)continue;oP(i.outBoundingBox,c);const d=(s=this._fastUpdates)==null?void 0:s.visualVariables.color,f=tge({material:this._materials[Ws.Fill],indices:u,attributeData:{position:n,color:d?null:i.color,colorFeature:d?kf(d.field,e):null,uvMapSpace:this._needsUV?Qz(i.uvMapSpace,4*a,4*l):null,objectAndLayerIdColor:i.objectAndLayerIdColor}});i.outGeometries.push(new TP(f,i))}}_createAsOverlayOutline(e){if(this._materials[Ws.Outline]==null)return;const i=e.renderData.outlines;for(let r=0;r<i.length;++r){const{position:s}=i[r];if(Zr(Sp),Mh(Sp,s),!Mf(Sp,this._context.clippingExtent))continue;oP(e.outBoundingBox,Sp);const n=_K(this._materials[Ws.Outline],{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(new TP(n,e))}}_getOutlineOpacity(){var i,r;const e=(r=(i=this.symbolLayer)==null?void 0:i.outline)==null?void 0:r.color;return(this.draped?1:this._getLayerOpacity())*(e!=null?e.a:0)}_getOutlineColor(){var r,s;const e=(s=(r=this.symbolLayer)==null?void 0:r.outline)==null?void 0:s.color,i=this._getOutlineOpacity();return f3(e!=null?Qe.toUnitRGB(e):null,i)}test(){return{...super.test(),createAsOverlay:(e,i)=>this._createAsOverlay(e,i),createAs3DShape:(e,i,r)=>this._createAs3DShape(e,i,r)}}};_5e.elevationModeChangeTypes={definedChanged:ks.RECREATE,staysOnTheGround:ks.NONE,onTheGroundChanged:ks.RECREATE};const Sp=Xn();let VPt=class extends D6{constructor(e,i,r,s){super(e,r,s),this.color=i}},zPt=class extends D6{constructor(e,i,r,s){super(e,r,s),this.color=i}};var Ws;function BPt(t){return(t==null?void 0:t.size)!=null&&t.size>0&&t.color!=null&&(t.pattern==null||t.pattern.type!=="style"||t.pattern.style!=="none")}(function(t){t[t.Fill=0]="Fill",t[t.Outline=1]="Outline"})(Ws||(Ws={}));let b5e=class{constructor(e,i="center",r=!1,s=mt(),n=ii(0,0,0,-1),o="world",a=E(),l=0){this.verticalOffset=e,this.anchor=i,this.hasLabelVerticalOffset=r,this.screenOffset=s,this.centerOffset=n,this.centerOffsetUnits=o,this.translation=a,this.elevationOffset=l}},w5e=class{constructor(e,i="center",r="center",s=null,n=mt()){this.placement=e,this.horizontalPlacement=i,this.verticalPlacement=r,this.text=s,this.displaySize=n}},x5e=class T5e{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=n_e(e.color),this.haloStyle=jPt(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?n_e(e.background.color):null}fontString(e){const i=this.definition.font;return`${i.style} ${i.weight} ${e}px ${i.family}, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji`}setFontProperties(e,i){e.font=this.fontString(i),e.textAlign="left",e.textBaseline="alphabetic"}static async fromSymbol(e,i){var f,m,g,y,v;const r=(f=e==null?void 0:e.material)==null?void 0:f.color,s=Qe.toUnitRGBA(r)??Rh,n=e.size!=null?wn(e.size):12,o=e.lineHeight,a=e.background!=null?Qe.toUnitRGBA(e.background.color):Rh,l={family:((m=e.font)==null?void 0:m.family)??"sans-serif",decoration:((g=e.font)==null?void 0:g.decoration)??"none",weight:((y=e.font)==null?void 0:y.weight)??"normal",style:((v=e.font)==null?void 0:v.style)??"normal"},c=e.halo,u=(c==null?void 0:c.color)!=null&&c.size>0?{size:wn(c.size),color:Qe.toUnitRGBA(c.color)}:{size:0,color:Rh},d=new T5e({color:s,size:n,background:{color:a,padding:e.background!=null?[.65*n,.5*n]:[0,0],borderRadius:e.background!=null?n*(6/16):0},lineSpacingFactor:o,font:l,halo:u,pixelRatio:i});if(e.font){let b=!1;const w=d.fontString(n);try{b=(await document.fonts.load(w)).some(x=>!Mxt(x))}catch{se.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${w}'. Some text symbology may be rendered using the default browser font.`)}if(!b&&!GPt.has(e.font.family))try{await Cxt(e.font)}catch{}}return d}};function jPt(t){return`rgb(${t.slice(0,3).map(e=>Math.floor(255*e)).toString()})`}function n_e(t){return`rgba(${t.slice(0,3).map(e=>Math.floor(255*e)).toString()},${t[3]})`}const GPt=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),_v=4096;let zT=class extends Ue{constructor(e){super(e),this.type=Fs.Texture,this.id=Ph(),this.events=new Us,this._glTexture=null,this._atlas=new WPt(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=Ut(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){return A3=0,[_v-vv-A3,_v-vv-A3-o_e]}load(e){if(this._glTexture)return this._glTexture;const i=new Xr;return i.wrapMode=Mi.CLAMP_TO_EDGE,i.samplingMode=di.LINEAR_MIPMAP_LINEAR,i.hasMipmap=!0,i.preMultiplyAlpha=!0,i.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new Er(e,i,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(It.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=$r(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=Ut(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.width.toString()),this._canvas.setAttribute("height",e.height.toString())}_resizeAtlas(e,i){var n,o;const{width:r,height:s}=this._atlas;r===e&&s===i||(this._atlas.width=e,this._atlas.height=i,(n=this._glTexture)==null||n.resize(e,i),(o=this._glTexture)==null||o.updateData(0,0,0,r,s,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach(a=>{const l=this._stageObjects.get(a.textRenderer.key);l==null||l.forEach(c=>F9(c,a))}),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(e,i,r,s){const n=this._atlas;if(n.width<r||n.height<s)return!1;let o=n.cursors.get(s);if(!o){if(n.height<n.nextY+s)return!1;o=[new a_e(n.nextY)],n.cursors.set(s,o),n.nextY+=s}let a=o.find(l=>n.width>=l.x+r);if(a==null){if(n.height<n.nextY+s)return!1;a=new a_e(n.nextY),n.nextY+=s,o.push(a)}return e.setNewPosition(a),this._elements.set(i,e),this._elementsToRender.set(i,e),a.x+=r,!0}_ensureStageObjects(e){const i=this._stageObjects.get(e);if(i)return i;const r=new Set;return this._stageObjects.set(e,r),r}_addStageObject(e,i){this._ensureStageObjects(e).add(i)}_removeStageObject(e,i){const r=this._stageObjects.get(e);r!=null&&r.delete(i)&&(i.geometries[0].setAttributeData(R.SIZE,[0,0]),i.geometryVertexAttributeUpdated(i.geometries[0],R.SIZE),this._elementsToRender.delete(e))}_processAddition(e){const i=e.textRenderer.key;if(this._needsRepack)return void this._elements.set(i,e);const r=this._atlas,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,o=s+vv,a=n+vv+o_e;if(!this._addAtlasElement(e,i,o,a)){if(this._canRepack)this._reset();else if(r.width<o){const l=Math.min(rb(Math.max(o,1.5*r.width)),_v);this._resizeAtlas(l,r.height)}else{const l=r.nextY+a,c=Math.min(rb(Math.max(l,1.5*r.height)),_v);if(c>r.height)this._resizeAtlas(r.width,c);else if(r.width<_v){const u=Math.min(rb(1.5*r.width),_v);this._resizeAtlas(u,r.height)}}this._elements.set(i,e)}}_renderElement(e){const i=e.commitNewPosition(),r=e.textRenderer;this._ctx.clearRect(i[0]-vv,i[1]-vv,r.renderedWidth+2*vv,r.renderedHeight+2*vv),r.render(this._ctx,i[0],i[1]);const s=this._stageObjects.get(r.key);s==null||s.forEach(n=>F9(n,e))}get running(){return this.updating}runTask(e){if(this._glTexture==null)return na;for(;this._needsRepack&&(this._canRepack||this._atlas.height<_v&&this._atlas.height<_v);){this._canRepack=this._needsRepack=!1;const i=this._elements;this._elements=new Map,i.forEach(r=>this._processAddition(r)),e.madeProgress()}if(this._elementsToRender.size>0){for(const[i,r]of this._elementsToRender){if(e.done)break;this._renderElement(r),this._elementsToRender.delete(i),e.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addTextTexture(e,i){const r=e.key;this._addStageObject(r,i);let s=this._elements.get(r);s==null&&(s=new qPt(this._atlas,e),this._processAddition(s),this.setDirty()),HPt(i,s),F9(i,s)}removeTextTexture(e,i){const r=e.key;if(!this._elements.get(r))return;this._removeStageObject(r,i);const s=this._stageObjects.get(r);s&&s.size!==0||this._elements.delete(r),(s==null?void 0:s.size)===0&&this._stageObjects.delete(r),this._canRepack=!0}setDirty(){this._glTexture&&(this.updating=!0)}get test(){}};function HPt(t,e){t.geometries[0].setAttributeData(R.SIZE,[e.textRenderer.displayWidth,e.textRenderer.displayHeight]),t.geometryVertexAttributeUpdated(t.geometries[0],R.SIZE)}function F9(t,e){t.geometries[0].setAttributeData(R.UV0,e.uv),t.geometryVertexAttributeUpdated(t.geometries[0],R.UV0,!0)}h([p({constructOnly:!0})],zT.prototype,"view",void 0),h([p({type:Boolean})],zT.prototype,"updating",void 0),zT=h([I("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],zT);const vv=2,o_e=2;let qPt=class{constructor(e,i){this._atlas=e,this.textRenderer=i,this._uv=ci(),this._newPosition=[0,0]}get uv(){if(this._xOffset==null||this._yOffset==null)return Rh;const{renderedWidth:e,renderedHeight:i}=this.textRenderer;return _s(this._uv,this._xOffset/this._atlas.width,(this._yOffset+i)/this._atlas.height,(this._xOffset+e)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}},WPt=class{constructor(e,i){this.width=e,this.height=i,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=A3}},a_e=class{constructor(e){this.y=e,this.x=A3}},A3=0,ZPt=class{constructor(e,i,r){this._renderer=new r4e(e,i,r,zT.maxSize)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=zB(YPt,this._renderer.renderedWidth,this._renderer.renderedHeight),i=e.getContext("2d");return i.save(),this._renderer.render(i,0,0),i.restore(),new Vb(e,{wrap:{s:Mi.CLAMP_TO_EDGE,t:Mi.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}};const YPt={canvas:null},XPt=Ge(0,0,1);let JPt=class extends Sy{constructor(e,i,r,s){super(e,i,r,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=S6(this.symbolLayer.size);if(e)throw new G("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await x5e.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const i=e.graphic,r=_S(i.geometry);if(r==null)return this.logger.warn(`unsupported geometry type for text symbol: ${i.geometry.type}`),null;const s=this.symbolLayer.text;if(s==null||s==="")return null;const n=$se(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(n!=null&&!GOe(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const{verticalAlignment:o}=this.symbolLayer,a=new b5e(n);Y2t(o,a.screenOffset);const l=new w5e(a,this.symbolLayer.horizontalAlignment,Z2t(o));return this._createAs3DShape(i,r,s,l)}createLabel(e,i,r,s,n){const o=e.graphic,a=_S(o.geometry);if(a==null)return this.logger.warn(`unsupported geometry type for label: ${o.geometry.type}`),null;const l=i.text;return!l||/^\s+$/.test(l)?null:this._createAs3DShape(o,a,l,i,r,s,n)}setGraphicElevationContext(e,i,r=0){return super.setGraphicElevationContext(e,i),i.addOffsetRenderUnits(r),i}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,i){return l_e(e,i,(r,s)=>{this.updateGraphicElevationContext(s,r)}),ks.UPDATE}slicePlaneEnabledChanged(e,i){return l_e(e,i,r=>{for(const s of r.stageObject.geometries)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,i){const r=i.elevationContext;this.setGraphicElevationContext(e,r,i.metadata!=null?i.metadata.elevationOffset:0),i.needsElevationUpdates=sp(r.mode)||r.mode==="absolute-height"}updateGeometry(e,i){if(this.draped||!this._validateGeometry(i))return!1;const{elevationContext:r,stageObject:s}=e;if(r.mode!==this.getGeometryElevationMode(i))return!1;const n=_S(i);if(!n)return!1;const o=fDe(s,this._context,n,r);if(o==null)return!1;const a=goe(this._context,n);return s.geometries[0].localOrigin===a&&(e.alignedSampledElevation=o,t2(e,n,this._context.elevationProvider),!0)}_defaultElevationInfoNoZ(){return KPt}_createAs3DShape(e,i,r,s,n=null,o=null,a=()=>s.placement.elevationOffset){var V;const l=this.setGraphicElevationContext(e,new _B,s.placement.elevationOffset),c=((V=e.geometry)==null?void 0:V.type)==="polyline",u=e.uid;let d=null,f=null;if(o==null){const X=n4e(s.horizontalPlacement);d=new ZPt(r,X,this._textRenderParameters);let q=null;if(this._context.sharedResources.textures!=null){f=this._context.sharedResources.textures.fromData(d.key,()=>d.create()),f.texture.events.on("unloaded",()=>q=hi(q));const Z=this._context.stage.renderView.textures.acquire(f.texture.id);if(Z==null||Fu(Z))return f.release(),null;q=Z}}const m=QPt(d,s),g={occlusionTest:!le("enable-feature:non-occluded-hud"),screenOffset:s.placement.screenOffset,anchorPosition:m,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.placement.centerOffsetUnits,drawInSecondSlot:!0};if(c&&(g.shaderPolygonOffset=1e-4),o?g.textureId=o.id:f&&(g.textureId=f.texture.id),s.placement.verticalOffset!=null){const{screenLength:X,minWorldLength:q,maxWorldLength:Z}=s.placement.verticalOffset;g.verticalOffset={screenLength:wn(X),minWorldLength:q||0,maxWorldLength:Z??1/0}}const y={screenOffset:g.screenOffset,anchorPosition:m,centerOffsetUnits:g.centerOffsetUnits,verticalOffset:g.verticalOffset,shaderPolygonOffset:g.shaderPolygonOffset};if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:X,screenSizePerspectiveSettingsLabels:q}=this._context.sharedResources,Z=i4e(this._textRenderParameters);g.screenSizePerspective=q.overrideFontHeight(Z.maxHeight),g.screenSizePerspectiveAlignment=X,y.fontHeight=Z.maxHeight}g.hasSlicePlane=this._context.slicePlaneEnabled;const v=(X,q,Z)=>{let ye=X.get(Z);return ye==null&&(ye=new yP(q),X.add(Z,ye)),ye},b=n?v(n,g,JSON.stringify(y)):new yP(g),w=s.placement.translation,x=d?Ei(d.displayWidth,d.displayHeight):jS,S=s.placement.centerOffset,C=XPt,M=mt(),O=mQ(b,C,w,null,x,S,M,null),D=moe(this._context,i,O,l,u);if(D==null)return null;const U=(X,q,Z,ye,L,N)=>{const z=a()||s.placement.elevationOffset,W=this.setGraphicElevationContext(e,q,z);return yS(X,W,Z,ye,L,N)},k=new Ty(this,D.object,[O],n==null?[b]:null,f,U,l);k.alignedSampledElevation=D.sampledElevation,k.needsElevationUpdates=sp(l.mode)||l.mode==="absolute-height",k.getScreenSize=(X=mt())=>(X[0]=d?d.displayWidth:s.displaySize[0],X[1]=d?d.displayHeight:s.displaySize[1],X);const H=new vLe(s.placement.elevationOffset,r);return k.metadata=H,t2(k,i,this._context.elevationProvider),k}};function l_e(t,e,i){t&&t.forEach(r=>{const s=e(r);s!=null&&i(s,r.graphic)})}function QPt(t,e){if(e.verticalPlacement==="baseline"){const r=H2t[e.horizontalPlacement],s=t!=null?t.baselineAnchorY:0;return Ei(r,s)}const i=W2t(e.horizontalPlacement,e.verticalPlacement);return PU[i]}const KPt={mode:"relative-to-ground",offset:0};function c_e(t){t.fragment.uniforms.add(new wt("texWaveNormal",e=>e.waveNormal),new wt("texWavePerturbation",e=>e.wavePerturbation),new ji("waveParams",e=>_s(eOt,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new jr("waveDirection",e=>Li(tOt,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))),t.include(S1t),t.fragment.code.add(T`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const eOt=ci(),tOt=mt();function S5e(t){const e=new Hi,{vertex:i,fragment:r}=e;Nc(i,t),e.include(al,t),e.attributes.add(R.POSITION,"vec3"),e.attributes.add(R.UV0,"vec2");const s=new ji("waterColor",n=>n.color);if(t.output===j.Color&&t.draped)return e.varyings.add("vpos","vec3"),i.uniforms.add(s),i.code.add(T`
        void main(void) {
          if (waterColor.a < ${T.float(ea)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(s),r.code.add(T`void main() {
fragColor = waterColor;
}`),e;switch(t.output===j.Color&&(e.include(VL,t),e.include(sO,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.multipassEnabled&&e.varyings.add("depth","float"),i.uniforms.add(s),i.code.add(T`
      void main(void) {
        if (waterColor.a < ${T.float(ea)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===j.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(xy,t),t.output){case j.Color:e.include(Gz),e.include(Xse,{pbrMode:At.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(c_e),e.include(bn,t),e.include(vP,t),e.include(rNe,t),r.uniforms.add(s,new et("timeElapsed",n=>n.timeElapsed),i.uniforms.get("view"),i.uniforms.get("localOrigin")),Qf(r,t),r.include(by),t.transparencyPassType===pt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),C_(r),my(r),r.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?T`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${t.transparencyPassType===pt.ColorAlpha?T`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `);break;case j.Normal:e.include(VL,t),e.include(c_e,t),e.include(bn,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),i.uniforms.add(s),i.code.add(T`
        void main(void) {
          if (waterColor.a < ${T.float(ea)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new et("timeElapsed",n=>n.timeElapsed)),r.code.add(T`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case j.Highlight:e.include(rw,t),e.varyings.add("vpos","vec3"),i.uniforms.add(s),i.code.add(T`
      void main(void) {
        if (waterColor.a < ${T.float(ea)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(bn,t),r.code.add(T`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case j.ObjectAndLayerIdColor:e.include(L2,t),e.varyings.add("vpos","vec3"),i.uniforms.add(s),i.code.add(T`
      void main(void) {
        if (waterColor.a < ${T.float(ea)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),e.include(bn,t),r.code.add(T`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return e}const iOt=Object.freeze(Object.defineProperty({__proto__:null,build:S5e},Symbol.toStringTag,{value:"Module"}));let E5e=class C5e extends Qi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Xe.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Ki(e.rctx,C5e.shader.get().build(this.configuration),Ai)}_setPipelineState(e){const i=this.configuration,r=e===pt.NONE,s=e===pt.FrontFace;return Jt({blending:i.output!==j.Normal&&i.output!==j.Highlight&&i.output!==j.ObjectAndLayerIdColor&&i.transparent?r?Ru:$_(e):null,depthTest:i.draped?null:{func:sw(e)},depthWrite:i.draped?null:r?i.writeDepth?Nu:null:_6(e),drawBuffers:I_(e),colorWrite:ui,polygonOffset:r||s?null:w6(i.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};E5e.shader=new qi(iOt,()=>ce(()=>Promise.resolve().then(()=>OHt),void 0));let to=class extends Uc{constructor(){super(...arguments),this.output=j.Color,this.transparencyPassType=pt.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}};h([B({count:j.COUNT})],to.prototype,"output",void 0),h([B({count:pt.COUNT})],to.prototype,"transparencyPassType",void 0),h([B()],to.prototype,"spherical",void 0),h([B()],to.prototype,"receiveShadows",void 0),h([B()],to.prototype,"hasSlicePlane",void 0),h([B()],to.prototype,"transparent",void 0),h([B()],to.prototype,"enableOffset",void 0),h([B()],to.prototype,"writeDepth",void 0),h([B()],to.prototype,"hasScreenSpaceReflections",void 0),h([B()],to.prototype,"doublePrecisionRequiresObfuscation",void 0),h([B()],to.prototype,"hasCloudsReflections",void 0),h([B()],to.prototype,"objectAndLayerIdColorInstanced",void 0),h([B()],to.prototype,"draped",void 0),h([B()],to.prototype,"multipassEnabled",void 0),h([B()],to.prototype,"cullAboveGround",void 0),h([B({constValue:!1})],to.prototype,"occlusionPass",void 0),h([B({constValue:At.Water})],to.prototype,"pbrMode",void 0),h([B({constValue:!0})],to.prototype,"useCustomDTRExponentForWater",void 0),h([B({constValue:!0})],to.prototype,"highStepCount",void 0),h([B({constValue:!1})],to.prototype,"useFillLights",void 0);let rOt=class extends ew{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){const i=e.ssr.lastFrameColor!=null;i!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:i})}_updateCloudsReflectionState(e){const i=e.cloudsFade.data!=null;i!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:i})}ensureResources(e){return this._techniques.constructionContext.waterTextures.ensureResources(e)}beginSlot(e){return this._output===j.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniques.constructionContext.waterTextures.passParameters),this.ensureTechnique(E5e,e)}},sOt=class extends sae{constructor(e){super(e,new M5e),this._configuration=new to,this._animation=new gIe,this.produces=new Map([[Pe.OPAQUE_MATERIAL,i=>Q0(i)&&!this.parameters.transparent||mS(i)],[Pe.TRANSPARENT_MATERIAL,i=>Q0(i)&&this.parameters.transparent||mS(i)],[Pe.DRAPED_MATERIAL,i=>this.parameters.draped&&i===j.Color||mS(i)],[Pe.DRAPED_WATER,i=>i===j.Normal]])}getConfiguration(e,i){return this._configuration.output=e,this._configuration.writeDepth=!0,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<v6,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}update(e){const i=Math.min(e.camera.relativeElevation,e.camera.distance);this._animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*i<nOt;const r=this._animation.advance(e);return this.setParameters({timeElapsed:Cie(this._animation.time)*this.parameters.animationSpeed},!1),this._animation.enabled&&r}createGLMaterial(e){return new rOt(e)}createBufferWriter(){return new lO(le("enable-feature:objectAndLayerId-rendering")?pCt:hCt)}get test(){}},M5e=class extends zne{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=Ei(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=ii(0,0,0,0),this.transparent=!0,this.hasSlicePlane=!1,this.draped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=E(),this.modelTransformation=null}};const nOt=35e3,oOt={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},aOt=["polyline","polygon","extent"];let BT=class MK extends Sy{constructor(e,i,r,s){super(e,i,r,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,aOt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(i):this._createAs3DShape(i,r,i.uid)}ensureMaterial(){if(this._materials[0])return;const e=new M5e,i=this.symbolLayer.color;i!=null&&(e.color=Qe.toUnitRGBA(i));const r=this._getCombinedOpacity(i,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],r],e.transparent=r<1||this.needsDrivenTransparentPass,e.waveDirection=this.symbolLayer.waveDirection!=null?MK.headingVectorFromAngle(this.symbolLayer.waveDirection):Ei(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=oOt[s];e.waveStrength=n.waveStrength,e.waveTextureRepeat=n.textureRepeat,e.waveVelocity=n.waveVelocity,e.flowStrength=n.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.draped=this.draped,this._materials[0]=new sOt(e),this._context.stage.add(this._materials[0])}layerOpacityChanged(){if(this._materials[0]==null)return;const e=this._materials[0].parameters.color,i=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=i<1||this.needsDrivenTransparentPass;this._materials[0].setParameters({color:[e[0],e[1],e[2],i],transparent:r})}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=qD(MK.elevationModeChangeTypes,r,s);if(n!==ks.UPDATE)return n;const o=sp(s);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){var d;const s=IL(e.geometry);if(s==null)return null;const n=Foe(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=n.position.length/3,a=co(2*o);u_e(a,n.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new lOt(n,a,this._context.layer.uid,e.uid);if(l.objectAndLayerIdColor=(d=this._context.stage.renderView)==null?void 0:d.getObjectAndLayerIdColor(l),this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,s.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new ow({geometries:l.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),u=new Ty(this,c,l.outGeometries,null,null,hLe,i);return u.alignedSampledElevation=l.renderData.sampledElevation,u.needsElevationUpdates=sp(i.mode),u}_create3DShapeGeometries(e){const i=e.renderData.polygons,r=e.uvCoords;for(const{count:s,index:n,position:o,mapPositions:a,holeIndices:l}of i){if(this._context.clippingExtent!=null&&(Zr(Zw),Mh(Zw,a),!Mf(Zw,this._context.clippingExtent)))continue;const c=bP(a,l,3);if(c.length===0)continue;const u=Xd(r,2*n,2*s),d=ige({material:this._materials[0],indices:c,mapPositions:a,attributeData:{position:o,uv0:u}},e.objectAndLayerIdColor);e.outGeometries.push(d)}}_createAsOverlay(e){var a;const i=IL(e.geometry);if(i==null)return null;this._materials[0].renderPriority=this._renderPriority;const r=WNe(i,this._context.overlaySR),s=r.position.length/3,n=co(2*s);u_e(n,r.position,s,this._context.overlaySR);const o=new cOt(r,n,this._context.layer.uid,e.uid);return o.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(o),o.outBoundingBox=Zr(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,i.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new j6(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const i=e.uvCoords,r=e.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of r){if(Zr(Zw),Mh(Zw,s),!Mf(Zw,this._context.clippingExtent))continue;oP(e.outBoundingBox,Zw);const l=bP(s,n,3);if(l.length===0)continue;const c=Xd(i,2*o,2*a),u=ige({material:this._materials[0],indices:l,attributeData:{position:s,uv0:c}},e.objectAndLayerIdColor);e.outGeometries.push(new TP(u,e))}}static headingVectorFromAngle(e){const i=mt(),r=Yj(e);return i[0]=Math.sin(r),i[1]=Math.cos(r),i}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};function u_e(t,e,i,r){const s=ec(r);zh(bv);for(let a=0;a<i;a++)Li(h_e,e[3*a],e[3*a+1]),gre(bv,h_e);GS(bv,bv,s);const n=bv[0]%BT.unitSizeOfTexture,o=bv[1]%BT.unitSizeOfTexture;H4[0]=bv[0]-n,H4[1]=bv[1]-o;for(let a=0;a<i;a++)t[2*a]=(e[3*a]*s-H4[0])/BT.unitSizeOfTexture,t[2*a+1]=(e[3*a+1]*s-H4[1])/BT.unitSizeOfTexture}BT.unitSizeOfTexture=100,BT.elevationModeChangeTypes={definedChanged:ks.RECREATE,staysOnTheGround:ks.NONE,onTheGroundChanged:ks.RECREATE};const H4=mt(),bv=oi(),h_e=mt(),Zw=Xn();let lOt=class extends D6{constructor(e,i,r,s){super(e,r,s),this.uvCoords=i}},cOt=class extends D6{constructor(e,i,r,s){super(e,r,s),this.uvCoords=i}};function uOt(t,e,i,r){var n;const s=((n=dOt[t.type])==null?void 0:n[e.type])||hOt[e.type];return s?new s(t,e,i,r):(se.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const hOt={icon:gK,object:mAt,line:p4e,path:gPt,fill:_5e,extrude:Ewt,text:JPt,water:BT},dOt={"mesh-3d":{fill:bCt}};let pOt=class extends foe{set symbol(e){this._symbol=e,e.symbolLayers.forEach((i,r)=>{const s=this.symbolLayers[r];s!=null&&(s.symbol=e,s.symbolLayer=i)})}get symbol(){return this._symbol}constructor(e,i,r){super(i.schedule),this._symbol=e,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const s=[];for(let n=0;n<r;n++){const o=i.at(n);if(o.enabled===!1)continue;q4.renderPriority=1-(1+n)/r,q4.renderPriorityStep=1/r,q4.ignoreDrivers=o.ignoreDrivers;const a=uOt(this.symbol,o,this._context,q4),l=oD(e,()=>{this.symbolLayers[n]=null,a.destroy()});l&&s.push(l),this.symbolLayers[n]=a}if(await jj(this.symbolLayers,async(n,o)=>{if(n!=null)try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}}),s.forEach(n=>n.remove()),Dt(e),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(e){const i=this.symbolLayers[e];return i!=null?i.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e==null?void 0:e.queryForSnapping)}createGraphics3DGraphic(e,i){var o,a;const r=e.graphic,s=this.symbolLayers.map(l=>(l==null?void 0:l.createGraphics3DGraphic(e))??null),n=this._context.arcade||((a=(o=this._context.featureExpressionInfoContext)==null?void 0:o.arcade)==null?void 0:a.modules)||null;return new Vvt(r,i||this,s,e.layer,n)}get complexity(){return poe(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,i){const r=this.symbolLayers.length;for(let s=0;s<r;s++){const n=this.symbolLayers[s],o=a=>{const l=a.layers[s];return l instanceof Ty?l:null};if(n!=null&&!n.globalPropertyChanged(e,i,o))return!1}return!0}applyRendererDiff(e,i){return this.loadStatus!==yh.LOADED?cn.RecreateSymbol:this.symbolLayers.reduce((r,s)=>r!==cn.RecreateSymbol&&s!=null?Math.min(r,s.applyRendererDiff(e,i)):r,cn.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===yh.FAILED||e.diff.type!=="partial")return;const i=e.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(s==null)return;const o=r[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const u=l.layers[n];u!=null&&a.graphics3DGraphicPatches.forEach(d=>d(u,c))})}})}updateGeometry(e,i){return this._updateGeometryOrTransform(e,(r,s)=>r.updateGeometry(s,i))}updateTransform(e,i,r,s){return this._updateGeometryOrTransform(e,(n,o)=>n.updateTransform(o,i,r,s))}_updateGeometryOrTransform(e,i){for(let r=0;r<this.symbolLayers.length;r++){const s=this.symbolLayers[r];if(s==null)continue;const n=e.layers[r];if(!n||!i(s,n))return!1}return!0}onRemoveGraphic(e){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(r==null)continue;const s=e.layers[i];s!=null&&r.onRemoveGraphic(s)}}getFastUpdateStatus(){let e=0,i=0,r=0;return this.symbolLayers.forEach(s=>{s!=null&&(s.loadStatus===yh.LOADING?e++:s.isFastUpdatesEnabled()?r++:i++)}),{loading:e,slow:i,fast:r}}async queryForSnapping(e,i,r,s){const n=this.symbolLayers.filter(op).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,i,r,s)),o=await Promise.all(n);return Dt(s),o.flat()}destroy(){if(!this.destroyed){super.destroy();for(const e of this.symbolLayers)e!=null&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const q4=new zvt;let fOt=class extends foe{constructor(e,i,r){super(i),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const i=await this.symbol.fetchSymbol({signal:e});i.id=this.symbol.id,this.graphics3DSymbol=this._convert(i),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:cDe}globalPropertyChanged(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,i)}applyRendererDiff(e,i){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,i):cn.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,i)}updateTransform(e,i,r,s){var n;return((n=this.graphics3DSymbol)==null?void 0:n.updateTransform(e,i,r,s))??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function oae(t){return t instanceof fOt?t.graphics3DSymbol:t instanceof pOt?t:null}const zL=()=>se.getLogger("esri.views.3d.layers.graphics.labelPlacement");let mOt=class{constructor(e,i,r,s=null){this.graphics3DGraphic=e,this.labelSymbol=i,this.labelClass=r,this.disablePlacement=s}};function d_e(t){const e=SOt(t);if(e==null)return null;const i=gOt(t,e);if(i==null)return null;const r=i.anchor,s=!!e.hasLabelVerticalOffset,n=e.verticalOffset;return _Ot(new b5e(n,r,s),i,t)}function gOt(t,e){if(e.anchor)return e;const i=t.labelClass.labelPlacement,r=Rf[i],s=r||ZB(t);return i&&!r&&zL().warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),yOt(s,t)}function aae(t){const e=t.graphics3DGraphic.graphics3DSymbol,i=oae(e);return i!=null?i.symbol.symbolLayers.at(0):null}function yOt(t,e){const i=e.graphics3DGraphic.graphic.geometry;if(i==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?(zL().warnOncePerTick(p_e(t==null?void 0:t.placement,e.disablePlacement.logEntityDescription)),ZB(e)):t;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return zL().warnOncePerTick(p_e(t==null?void 0:t.placement,`'${r}' geometries`)),ZB(e);break;case"point":case"mesh":return t}return t}function p_e(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function ZB(t){const e=t.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:On,anchor:"center"};case"polygon":{const i=aae(t);return i!=null&&i.type==="extrude"?Rf["above-center"]:{placement:"center-center",normalizedOffset:On,anchor:"center"}}case"point":case"mesh":return Rf["above-center"];default:return}}function _Ot(t,e,i){const r=i.graphics3DGraphic.graphic.geometry;if(r==null)return null;switch(r.type){case"point":case"mesh":bOt(t,e,i);break;case"polygon":vOt(t,e,i)}const s=U2t-BB;return t.screenOffset[0]+=s*e.normalizedOffset[0],t.screenOffset[1]+=s*e.normalizedOffset[1],t}function vOt(t,e,i){const r=aae(i);if(r!=null)switch(r.type){case"extrude":{const s=i.graphics3DGraphic.layers[0];s!=null?(s.getBoundingBoxObjectSpace(P3),Cf(P3,t.translation),t.translation[2]=Qb(P3)/2):de(t.translation,0,0,0),A5e(t,e,s);break}}}function bOt(t,e,i){const r=aae(i);if(r==null)return;const s=i.graphics3DGraphic.layers[0];switch(s!=null?s.getCenterObjectSpace(t.translation):de(t.translation,0,0,0),r.type){case"icon":case"text":wOt(t,e,i,s);break;case"object":case"fill":A5e(t,e,s)}}function wOt(t,e,i,r){const{graphics3DGraphic:s}=i,n=r!=null?r.getScreenSize():null;if(s.isDraped||n==null)t.hasLabelVerticalOffset||t.anchor==="center"||(Rf[i.labelClass.labelPlacement]&&zL().warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center");else{const o=xOt(i);t.screenOffset[0]=n[0]/2*(e.normalizedOffset[0]-o[0]);const a=n[1]/2*(e.normalizedOffset[1]-o[1]);t.hasLabelVerticalOffset?(t.centerOffset[1]=a,t.centerOffsetUnits="screen"):t.screenOffset[1]=a}}function xOt(t,e=EOt){const{graphics3DGraphic:i}=t,r=i.layers[0],s=(r==null?void 0:r.stageObject.geometries[0].material)??null;if(s&&s instanceof yP){const n=s.parameters.anchorPosition;e[0]=2*(n[0]-.5),e[1]=2*(n[1]-.5)}else e[0]=0,e[1]=0;return e}function A5e(t,e,i){const r=i!=null?i.getBoundingBoxObjectSpace(P3):P3,s=Ge(r[3]-r[0],r[4]-r[1],r[5]-r[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);t.centerOffset[0]=n/2*e.normalizedOffset[0];const o=t.translation[2],a=s[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=Ve(s);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function TOt(t){return t==="above-center"}function SOt(t){const e=t.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=t,s=oae(r.graphics3DSymbol),n=(s==null?void 0:s.symbol.type)==="point-3d"?s.symbol:null,o=Rf[e]||ZB(t);return n!=null&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:n.verticalOffset.clone(),anchor:null,normalizedOffset:null}:!i||!i.hasVisibleVerticalOffset()||n!=null&&n.supportsCallout()&&n.verticalOffset&&!r.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&TOt(o.placement)?{placement:"above-center",verticalOffset:i.verticalOffset.clone(),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(zL().errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}const Rf={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},f_e={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in f_e){const e=f_e[t],i=Rf[t];e.forEach(r=>{Rf[r]=i})}Object.freeze&&(Object.freeze(Rf),Object.keys(Rf).forEach(t=>{var e;Object.freeze(Rf[t]),Object.freeze((e=Rf[t])==null?void 0:e.normalizedOffset)}));const EOt=[0,0],P3=Xn();let m_e=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,i){this._materials.set(e,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}},g_e=class{constructor(e,i){this.labelingContext=e,this.graphics3DGraphic=i,this.hasGraphics3DResources=!1,this.visible=!1,this.addedToTextureAtlas=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},COt=class{constructor(e,i,r,s,n){this.labelClass=e,this.graphics3DSymbol=i,this.graphics3DCalloutSymbolLayer=r,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0}},MOt=class{constructor(e,i,r,s,n,o,a,l){this.layer=i,this.graphics3DCore=r,this.scaleVisibility=s,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new dNe(e,{pickable:!0,disableOctree:!0},i.uid)}destroy(){this.stageLayer.destroy()}},qx=class extends Ue{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this.addHandles([te(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),te(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(It.LABELER,this)]),this._textTextureAtlas=new zT({view:this.view}),this._hudMaterialCollection=new m_e(this.view._stage),this._calloutMaterialCollection=new m_e(this.view._stage)}dispose(){this.removeAllHandles(),this._textTextureAtlas=Ut(this._textTextureAtlas),this._hudMaterialCollection=Ut(this._hudMaterialCollection),this._calloutMaterialCollection=Ut(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear()}destroy(){this.dispose(),Ep.graphic=null,Ep.renderingInfo=null,Ep.layer=null}_activateLabelingContext(e){e.graphics.forEach((i,r)=>{const s=new g_e(e,i);this._labels.set(r,s),e.labelsToInitialize.set(r,s),i.setVisibilityFlag(Ro.LABEL,Aa.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((i,r)=>{i.setVisibilityFlag(Ro.LABEL,Aa.USER,!1),this.setLabelGraphicVisibility(i,!1),i.clearLabelGraphics(),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];r&&(this._textTextureAtlas.addTextTexture(r,i.stageObject),e.addedToTextureAtlas=!0)}}_removeLabelTextureFromAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];r!=null&&(this._textTextureAtlas.removeTextTexture(r,i.stageObject),e.addedToTextureAtlas=!1)}}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),na}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const i of this._labelingContexts)if(i.active)if(k9(i))this._dirty=!0;else if(U9(i.labelClassContexts)){if(i.labelClassContexts===null){this._deactivateLabelingContext(i);continue}this._createLabelClassContext(i),this._dirty=!0}else Eh(i.labelsToInitialize,(r,s)=>(this._ensureGraphics3DResources(r)&&(this._labels.set(s,r),this.deconflictor.setDirty(),e.madeProgress()),(r.visible&&r.textInitialized||!r.visible&&r.hasGraphics3DResources)&&(i.labelsToInitialize.delete(s),e.madeProgress()),e.done))&&(this._dirty=!0);this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var o,a,l;const i=(o=e.labelClassAbortController)==null?void 0:o.signal;e.layer.when&&await e.layer.when(),Dt(i),(a=e.scaleVisibility)==null||a.updateScaleRangeActive();const r=e.graphics3DCore,s=r.layer,n=(l=s.labelingInfo)==null?void 0:l.filter(c=>!!c.symbol);!n||n.length===0||(await jj(n,async(c,u)=>{const d=c.symbol,f=oae(r.getOrCreateGraphics3DSymbol(d));if(f==null)return void se.getLogger(this).error("Failed to create Graphics3DSymbol for label");await f.load(),Dt(i);let m=null;$se(d)&&d.hasVisibleCallout()&&(m=K_t(d,r.symbolCreationContext),await m.load(),Dt(i));const g=await Vh(Byt(c,e.layer.fieldsIndex,this.view.spatialReference));if(Dt(i),g.ok===!0){const y=await this._createTextRenderParameters(f.symbol);Dt(i),e.labelClassContexts[u]=new COt(c,f,m,y,g.value)}else se.getLogger(this).error(`Label expression failed to evaluate: ${g.error}`)}),Dt(i))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(i=>{if(os(i))throw i;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const i=e.symbolLayers.at(0);return(i==null?void 0:i.type)!=="text"?null:x5e.fromSymbol(i,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced;const i=e.labelClassAbortController;e.labelClassAbortController=new AbortController,Jl(i),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,i,r,s,n,o){const a=new w5e(r,r0e(r.anchor),q2t(r.anchor),e.text,Ei(e.displayWidth,e.displayHeight));return Ep.graphic=i,Ep.renderingInfo=null,Ep.layer=s,n.createLabel(Ep,a,this._hudMaterialCollection,this._textTextureAtlas,()=>{const l=d_e(o);return l?l.elevationOffset:null})}_createLineCalloutGraphic(e,i,r,s,n){Ep.graphic=e,Ep.layer=n;const o=s.screenOffset[0];return Ep.renderingInfo=new J_t(null,i,s.translation,s.centerOffset,o,s.centerOffsetUnits,s.elevationOffset,this._calloutMaterialCollection),r.createGraphics3DGraphic(Ep)}_ensureGraphics3DResources(e){var c,u;if(e.hasGraphics3DResources)return!1;const i=e.graphics3DGraphic;if(i.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,s=r.labelClassContexts;if(U9(s)||!r.emptySymbolLabelSupported&&i.layers.length===0)return!1;let n=!1;const o=i.graphic,a=r.layer,l=W4(r.layer);for(let d=0;d<s.length;d++){const f=e.textRenderers[d],m=e.textLabelPlacements[d];if(f==null||m==null)continue;const g=s[d],y=g.graphics3DSymbol,v=y.symbol&&y.symbol.type==="label-3d"?y.symbol:null,b=y.symbolLayers[0];if(!b)continue;b.setElevationInfoOverride(r.elevationInfoOverride);const w=new mOt(i,v,g.labelClass),x=this._createTextSymbolGraphic(f,o,m,a,b,w);if(x==null)return!1;x._labelClass=g.labelClass,x._labelIndex=d,i.addLabelGraphic(x,r.stageLayer),i.deconflictionPriority=((c=g.textRenderParameters)==null?void 0:c.definition.size)??0,i.setVisibilityFlag(Ro.LABEL,Aa.USER,l),i.setVisibilityFlag(Ro.LABEL,Aa.SCALE_RANGE,!0),i.setVisibilityFlag(Ro.LABEL,Aa.DECONFLICTION,!1),n=!0;const S=g.graphics3DCalloutSymbolLayer;if(S&&m.hasLabelVerticalOffset){S.setElevationInfoOverride(r.elevationInfoOverride);const C=this._createLineCalloutGraphic(o,v,S,m,a);C!=null&&(g.calloutSymbolLayerIndex=i.labelLayers.length,i.addLabelGraphic(C,r.stageLayer))}break}return n&&((u=r.scaleVisibility)==null||u.updateGraphicLabelScaleVisibility(i)),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const i=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelLayers){if(r._labelClass==null)continue;const s=i[r._labelIndex].graphics3DSymbol.symbolLayers[0];s==null||s.onRemoveGraphic(r)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var n;if(e.textInitialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(U9(r))return;const s=e.graphics3DGraphic.graphic;for(let o=0;o<r.length;o++){const a=r[o];if(e.textRenderers[o]=null,e.textLabelPlacements[o]=null,(a==null?void 0:a.textRenderParameters)==null)continue;const l=a.labelFunction;let c;if(l.type==="arcade")try{const w=l.needsHydrationToEvaluate()?Syt(s,i.layer):s;c=l.evaluate(w)}catch{c=null}else c=l.evaluate(s);if(c==null||c===""||/^\s+$/.test(c))continue;const u=a.graphics3DSymbol,d=((n=u.symbol)==null?void 0:n.type)==="label-3d"?u.symbol:null;if(!u.symbolLayers[0])continue;const f=e.graphics3DGraphic,m=a.labelClass,g=i.disablePlacement,y=d_e({graphics3DGraphic:f,labelSymbol:d,labelClass:m,disablePlacement:g});if(y==null)continue;const v=r0e(y.anchor),b=n4e(v);e.textRenderers[o]=new r4e(c,b,a.textRenderParameters,zT.maxSize),e.textLabelPlacements[o]=y}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,i){const r=i.graphic.uid;if(e.graphics.set(r,i),e.active){const s=new g_e(e,i);this._labels.set(r,s),e.labelsToInitialize.set(r,s)}this.setDirty(),this.deconflictor.setDirty()}_updateGraphicGeometry(e,i){const r=i.graphic.uid,s=this._labels.get(r);if(!s)return!0;for(const n of s.graphics3DGraphic.labelLayers)if(n._labelClass!=null&&!e.labelClassContexts[n._labelIndex].graphics3DSymbol.symbolLayers[0].updateGeometry(n,i.graphic.geometry))return!1;return this.setDirty(),this.deconflictor.setDirty(),!0}_removeGraphic(e,i){const r=i.graphic.uid,s=this._labels.get(r);e.graphics.delete(r),s&&(this._destroyGraphic(s,r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,i){this._labels.delete(i),e.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,i){if(!i)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of i){const s=e.graphics.get(r);s&&(this._removeGraphic(e,s),this._addGraphic(e,s))}}_globalPropertyChanged(e,i){for(const r of i.labelClassContexts){const s=new Map;i.graphics.forEach(o=>s.set(o.graphic.uid,o));const n=o=>o.labelLayers[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,s,n),r.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,s,o)}}}_visibilityInfoChange(e){const i=W4(e.layer);i&&!e.active&&this._activateLabelingContext(e),!i&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((i,r)=>{const s=this._labels.get(r);s&&(this._destroyGraphic(s,r),s.visible=!1,e.labelsToInitialize.set(r,s))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const i of this._labelingContexts)if(i.graphics3DCore===e)return i;return null}addGraphicsOwner(e,i,r){const s=(r==null?void 0:r.emptySymbolLabelSupported)||!1,n=(r==null?void 0:r.elevationInfoOverride)||null,o=(r==null?void 0:r.disablePlacement)||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new MOt(this.view._stage,a,e,i,s,n,o,W4(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),updateGraphicGeometry:c=>this._updateGraphicGeometry(l,c),layerLabelsEnabled:()=>W4(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const i=this._findLabelingContext(e);if(!i)return;const r=this._labelingContexts.indexOf(i);this._labelingContexts.splice(r,1),i.graphics.forEach(s=>this._removeGraphic(i,s)),i.destroy(),this.setDirty()}setLabelGraphicVisibility(e,i){const r=e.graphic.uid,s=this._labels.get(r);s&&s.visible!==i&&(i&&!s.addedToTextureAtlas?(this._addLabelTextureToAtlas(s),s.textInitialized||s.labelingContext.labelsToInitialize.set(r,s)):!i&&s.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(s),s.visible=i,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(i=>k9(i))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((i,r)=>i+(k9(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){}};function k9(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function U9(t){return!t||t.length===0}function W4(t){var e;return t.labelsVisible===!0&&!!((e=t.labelingInfo)!=null&&e.some(i=>!!i.symbol))}h([p({constructOnly:!0})],qx.prototype,"view",void 0),h([p({constructOnly:!0})],qx.prototype,"deconflictor",void 0),h([p()],qx.prototype,"_textTextureAtlas",void 0),h([p({type:Boolean,readOnly:!0})],qx.prototype,"updating",null),qx=h([I("esri.views.3d.layers.graphics.Labeler")],qx);const Ep=new Q_t(null,null,null);let dI=class OC{constructor(e,i,r,s=null){this.lij=[0,0,0],this.extent=oi(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Oc.VISIBLE_ON_SURFACE,screenRect:oi(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(e,i,r,s)}acquire(e,i,r,s){this.tilingScheme=s,this.id=OC.id(e,i,r),this.lij[0]=e,this.lij[1]=i,this.lij[2]=r,s.getExtent(e,i,r,this.extent),this.resolution=s.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const i=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return e?(e[0].acquire(i,r,s,this.tilingScheme),e[1].acquire(i,r+1,s,this.tilingScheme),e[2].acquire(i,r,s+1,this.tilingScheme),e[3].acquire(i,r+1,s+1,this.tilingScheme),e):[new OC(i,r,s,this.tilingScheme),new OC(i,r+1,s,this.tilingScheme),new OC(i,r,s+1,this.tilingScheme),new OC(i,r+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,l_(e.measures.screenRect,this.measures.screenRect)}static id(e,i,r){return`${e}/${i}/${r}`}};var Oc;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(Oc||(Oc={}));function AOt(t,e,i,r,s,n,o=1){const a=wb(e,s,cG);if(a==null)return!1;if(a===Is){if(t===r&&i===n)return!0;const c=i+o;for(let u=i,d=n;u<c;++u,++d)ve(r[d],t[u]);return!0}const l=i+o;for(let c=i,u=n;c<l;++c,++u)a(t[c],0,r[u],0);return!0}const P5e=.5*Math.PI,POt=P5e/Math.PI*180;let OOt=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:E(),direction:E()};for(let i=0;i<4;i++)this._extent[i]={origin:E(),direction:E(),cap:{next:null,direction:E()}},this._planes[i]=tr();this._planes[Tr.NEAR]=tr(),this._planes[Tr.FAR]=tr(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,i,r,s=!0){const n=this._extent;this._toRenderBoundingExtent(e,i,r),Ee(this._center.origin,n[0].origin,n[2].origin),he(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||he(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,v_(a.cap.direction,a.origin,l.origin),pL(a.direction,a.cap.direction,a.origin,this._planes[o]),s||he(a.direction,a.direction,-1)}pL(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[Tr.NEAR]),s?xY(this._planes[Tr.NEAR],this._planes[Tr.FAR]):(yG(this._planes[Tr.FAR],this._planes[Tr.NEAR]),xY(this._planes[Tr.NEAR],this._planes[Tr.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=i,this._minGlobalAltitude=.9*_r(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,i,r=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===Xe.Global){const n=this._maxSpanSpatialReference.isGeographic?POt:P5e*i;if(this._maxSpan>n)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const n=this._extent[0];return!(r||!e.intersectsRay(jh(n.origin,n.direction)))}for(let n=0;n<this._extent.length;n++){const o=this._extent[n];if(!r&&e.intersectsRay(jh(o.origin,o.direction))||e.intersectsLineSegment(dS(o.origin,o.cap.next,$Ot),o.cap.direction))return!0}const s=r?this._planes:this._planesWithoutFar;for(let n=0;n<e.lines.length;n++){const o=e.lines[n];if(Udt(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,i,r){yre(e,Cp),Cp[2]=r,$h(i,Cp,V9,this._renderCoordsHelper.spatialReference),Zn(y_e,V9),Zr(Zc);for(const{x0:n,x1:o,y0:a,y1:l}of ROt)for(let c=0;c<5;c++){const u=c/4;Cp[0]=Bt(e[n],e[o],u),Cp[1]=Bt(e[a],e[l],u),Cp[2]=r,Fo(Cp,i,Cp,this._renderCoordsHelper.spatialReference),nt(Cp,Cp,y_e),Yf(Zc,Cp)}de(this._extent[0].origin,Zc[0],Zc[1],Zc[2]),de(this._extent[1].origin,Zc[3],Zc[1],Zc[2]),de(this._extent[2].origin,Zc[3],Zc[4],Zc[2]),de(this._extent[3].origin,Zc[0],Zc[4],Zc[2]);for(let n=0;n<4;++n)nt(this._extent[n].origin,this._extent[n].origin,V9)}_toRenderBoundingExtentLocal(e,i,r){fG(e,i,Vy,this._renderCoordsHelper.spatialReference),de(this._extent[0].origin,Vy[0],Vy[1],r),de(this._extent[1].origin,Vy[2],Vy[1],r),de(this._extent[2].origin,Vy[2],Vy[3],r),de(this._extent[3].origin,Vy[0],Vy[3],r)}_toRenderBoundingExtent(e,i,r){switch(this._renderCoordsHelper.viewingMode){case Xe.Global:this._toRenderBoundingExtentGlobal(e,i,r);break;case Xe.Local:this._toRenderBoundingExtentLocal(e,i,r);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(Or(e.planes[Tr.NEAR],this._center.origin)<0&&Te(this._center.direction,e.direction)<0)return!0;for(let i=0;i<4;i++){const r=this._extent[i];if(Or(e.planes[Tr.NEAR],r.origin)<0&&Te(r.direction,e.direction)<0)return!0}return!1}};const ROt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],Cp=E(),V9=ke(),y_e=ke(),Zc=Xn(),Vy=oi(),$Ot=im();let IOt=class{constructor(e,i){this._renderCoordsHelper=e,this._getIsGroundOpaque=i,this._surfaceElevation=0,this._isGroundOpaque=!1,this._cache=new Map,this._frustumBoundingSphereCenter=E(),this._frustumBoundingSphereRadius=0,this._frustum=new j1(e),this._extendedFrustum=new j1(e),this._intersector=new OOt({renderCoordsHelper:e}),this._renderSR=e.spatialReference;const r=Gh(this._renderSR);this._renderSREllipsoidRadius=_r(r).radius,this._renderCoordsHelper=e}begin(e,i){this._surfaceElevation=i,this._aboveGround=e.aboveGround,this._isGroundOpaque=this._getIsGroundOpaque(),this._frustum.update(e),x_e(this._frustum),this._updateExtendedFrustum(e),this._updateFrustumBoundingSphere()}end(){this._cache.clear()}calculate(e){const i=this._renderCoordsHelper.viewingMode===Xe.Global&&e.lij[0]>=LOt&&e.lij[0]<DOt,r=this._getOrCalculateSingleTileVisibility(e,!i);return r!==Oc.INVISIBLE&&i?this._calculateAggregatedChildrenVisibility(e):r}_calculateAggregatedChildrenVisibility(e){let i=Oc.INVISIBLE;const r=this._cache.get(e.id);if(r!=null)return r;const s=w_e.acquire();e.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==Oc.INVISIBLE&&(i=o,o===Oc.VISIBLE_ON_SURFACE))break}return w_e.release(s),this._cache.set(e.id,i),i}_getOrCalculateSingleTileVisibility(e,i){const r=this._cache.get(e.id);if(r!=null)return r;const s=this._calculateSingleTileVisibility(e);return i&&this._cache.set(e.id,s),s}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===Xe.Global&&e.lij[0]<NOt?this._calculateSingleTileVisibilitySided(e,!1)===Oc.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_isTileVisibleInFrustum(e){return this._renderCoordsHelper.viewingMode===Xe.Local?this._isTileVisibleInFrustumLocal(e):this._isTileVisibleInFrustumGlobal(e)}_updateFrustumBoundingSphere(){const e=this._frustum,i=e.origin,r=ZOt;Ce(r,e.direction);const s=e.points,n=YOt;Ii(n,s[4],i);const o=.5*Te(n,n)/Te(r,n),a=this._frustumBoundingSphereCenter;Pn(a,i,r,o);const l=1+o;this._frustumBoundingSphereRadius=l}_isTileVisibleInFrustumLocal(e){const i=e.tilingScheme.spatialReference,r=e.extent,s=this._renderSR,n=BOt;if(n[0]=r[0],n[1]=r[1],n[2]=0,n[3]=r[2],n[4]=r[3],n[5]=0,!ds(n,i,0,n,s,0,2))return!1;const o=S_e;de(o[0],n[0],n[1],0),de(o[1],n[3],n[1],0),de(o[2],n[3],n[4],0),de(o[3],n[0],n[4],0);const a=E_e;de(a,.5*(n[0]+n[3]),.5*(n[1]+n[4]),.5*(n[2]+n[5]));const l=jOt;de(l,0,0,1);const c=.5*Y1(o[0],o[2]),u=this._frustum,d=this._frustumBoundingSphereRadius,f=this._frustumBoundingSphereCenter,m=JOt;Ii(m,f,a);const g=Te(l,m),y=XOt;if(Pn(y,a,l,g),Y1(y,f)>c+d)return!1;const v=zOt,b=this._isGroundOpaque&&this._aboveGround,w=this._isGroundOpaque&&!this._aboveGround,x=Math.min(w?_R:1/0,g+d),S=Math.max(b?-_R:-1/0,g-d);for(let C=0;C<4;++C)Pn(v[C],o[C],l,x),Pn(v[C+4],o[C],l,S);return!AK(u.planes,v,8)}_isTileVisibleInFrustumGlobal(e){const i=e.tilingScheme.spatialReference,r=e.extent,s=this._isGroundOpaque&&this._aboveGround,n=this._isGroundOpaque&&!this._aboveGround;if(e.lij[0]<O5e)return!0;const o=S_e,a=.5*(r[0]+r[2]);if(de(o[0],r[0],r[1],0),de(o[1],r[2],r[1],0),de(o[2],r[2],r[3],0),de(o[3],r[0],r[3],0),de(o[4],a,r[1],0),de(o[5],a,r[3],0),!AOt(o,i,0,o,this._renderSR,0,6))return!1;const l=o[0][2]>0,c=o[3][2]<0,u=l||c,d=this._renderSREllipsoidRadius;if(u){const K=Ge(0,0,1),ne=GOt;Jv(ne,K,o[0]);const we=HOt;if(Jv(we,K,o[1]),l){const Ie=C_e,je=o[4],ut=M_e;Jv(ut,je,K),Jv(Ie,ut,je);const ot=o[0];ft(ot,ne,Ie),yR(ot,d);const at=o[1];ft(at,we,Ie),yR(at,d)}else if(c){const Ie=C_e,je=o[5],ut=M_e;Jv(ut,je,K),Jv(Ie,je,ut);const ot=o[3];ft(ot,Ie,ne),yR(ot,d);const at=o[2];ft(at,Ie,we),yR(at,d)}}const f=E_e;{const K=Ii(tRt,o[3],o[0]);Ce(K,K);const ne=Ee(iRt,o[0],o[3]);he(ne,ne,.5);const we=-Te(ne,K),Ie=Ee(rRt,o[0],o[1]);he(Ie,Ie,.5);const je=Ee(sRt,o[2],o[3]);he(je,je,.5);const ut=Ii(nRt,je,Ie);Ce(ut,ut);const ot=-(we+Te(K,Ie))/Te(K,ut);Pn(f,Ie,ut,ot),yR(f,d)}const m=this._frustumBoundingSphereRadius,g=this._frustumBoundingSphereCenter,y=this._frustum,v=y.planes,b=qOt;Ce(b,f);const w=Te(o[0],b)/kl(o[0]),x=y.origin,S=y.points;let C=!1;if(s){{C=!0;const ne=Ce(E(),x);for(let we=0;we<4;++we){const Ie=S[4+we],je=Ii(E(),Ie,x);Ce(je,je);const ut=ft(E(),ne,je);Ce(ut,ut);const ot=ft(E(),je,ut);if(Ce(ot,ot),Te(x,ot)>d){C=!1;break}}}if(C&&Te(x,b)<d*w-_R)return!1;const K=Ce(wRt,y.origin);if(Te(K,b)<0)return!1;{const ne=Ce(xRt,y.direction);if(Te(ne,b)>TRt)return!1}}const M=Math.sqrt(1-w*w);if(M>.9)return!0;let O=!1;{const K=Te(b,g),ne=kl(g);if(ne<=m&&!v.some(je=>Or(je,z9)>0)){if(!s)return!0;O=!0}const we=K/ne;if(!O&&K<=0&&-K>m)return!1;const Ie=m/ne;if(Math.sqrt(1-we*we)*Math.sqrt(1-Ie*Ie)-Ie*we>M)return!1}if(!C&&(o.some(K=>y.intersectsPoint(K))||y.intersectsPoint(f)))return!0;const D=QOt;Ii(D,g,z9);const U=Te(D,b),k=WOt;he(k,b,U);const H=Y1(k,g),V=i.isWGS84,X=e.lij,q=V&&X[2]===2**X[0]-1,Z=V&&X[2]===0,ye=Z?mRt:q?pRt:hRt,L=Z?gRt:q?fRt:dRt;if(!O){const K=o,ne=yRt,we=oRt,Ie=aRt,je=z9;for(const ut of ye){const ot=K[ut];if(T_e(we,K[(ut+1)%4],ot),T_e(Ie,je,ot),Jv(ne,Ie,we),VOt(ne,S,1))return!1}}let N=null;if(!s&&U<1.01*m){const K=2.5*m;if(H>w*K+m)return!1;const ne=eRt,we=K/w;for(let Ie=0;Ie<4;++Ie)he(ne[Ie],o[Ie],we/d);de(ne[4],0,0,0),N=ne}else{const K=(n?d+_R:U+m)/w,ne=s?d-_R:(U-m)/w,we=KOt;for(let Ie=0;Ie<4;++Ie){const je=o[Ie];he(we[Ie],je,ne/d),he(we[Ie+4],je,K/d)}N=we}if(AK(v,N,N.length))return!1;const z=y.lines,W=lRt,J=cRt;for(const K of z){Ce(J,K.direction);for(const ne of L){const we=N[ne];if(Ce(W,we),B9(J,W,N,S))return!1;const Ie=(ne+1)%4;if(s){const je=N[Ie];if(Ii(W,je,we),Ce(W,W),B9(J,W,N,S))return!1}if(n){const je=N[4+ne],ut=N[4+Ie];if(Ii(W,ut,je),Ce(W,W),B9(J,W,N,S))return!1}}}return!0}_calculateSingleTileVisibilitySided(e,i){return this._isTileVisibleInFrustum(e)?(this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,i),this._intersector.isVisibleInFrustum(this._frustum,this._renderSREllipsoidRadius,!0)?Oc.VISIBLE_ON_SURFACE:Oc.VISIBLE_WHEN_EXTENDED):Oc.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),x_e(this._extendedFrustum);const i=this._renderCoordsHelper.worldUpAtPosition(e.eye,hh);this._aboveGround||sa(i,i);const r=po(-Te(i,e.viewForward));if(this._hasExtendedFrustum=r>e.fovY/2,!this._hasExtendedFrustum)return;const s=this._extendedFrustumParameters(),n=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this._renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,hh),a){case _t.FAR_BOTTOM_LEFT:case _t.FAR_TOP_LEFT:case _t.NEAR_BOTTOM_LEFT:case _t.NEAR_TOP_LEFT:TY(this._extendedFrustum.planes[Tr.LEFT],hh,hh);break;case _t.FAR_BOTTOM_RIGHT:case _t.FAR_TOP_RIGHT:case _t.NEAR_BOTTOM_RIGHT:case _t.NEAR_TOP_RIGHT:TY(this._extendedFrustum.planes[Tr.RIGHT],hh,hh)}he(hh,hh,s.direction),this._renderCoordsHelper.intersectInfiniteManifold(jh(l,hh),s.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(n),il(n[_t.NEAR_BOTTOM_LEFT],n[_t.NEAR_BOTTOM_RIGHT],n[_t.NEAR_TOP_RIGHT],v_e),il(n[_t.NEAR_BOTTOM_RIGHT],n[_t.NEAR_TOP_RIGHT],n[_t.NEAR_TOP_LEFT],b_e),Te(v_e,b_e)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[_t.NEAR_BOTTOM_LEFT],o[_t.NEAR_BOTTOM_RIGHT]]=[o[_t.NEAR_BOTTOM_RIGHT],o[_t.NEAR_BOTTOM_LEFT]]:[o[_t.NEAR_TOP_LEFT],o[_t.NEAR_TOP_RIGHT]]=[o[_t.NEAR_TOP_RIGHT],o[_t.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-__e;return{zWithMargin:e,pointIndices:j1.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:i=>i>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+__e;return{zWithMargin:e,pointIndices:j1.planePointIndices.top,direction:1,needsAltitudeAdjustment:i=>i<e}}};const LOt=2,DOt=6,NOt=12,FOt=.95,__e=1,hh=E(),v_e=tr(),b_e=tr(),w_e=new la(Array,t=>{t.length!==4&&(t[0]=new dI,t[1]=new dI,t[2]=new dI,t[3]=new dI)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});function x_e(t){const e=j1.nearFarLineIndices,i=t.mutablePoints;for(const r of e){const[s,n]=r,o=i[s],a=i[n];Re(hh,a,o),he(hh,hh,FOt),Ee(i[n],o,hh)}t.updatePoints(i)}function Jv(t,e,i){return ft(t,e,i),Ce(t,t),t}function T_e(t,e,i){return Ii(t,e,i),Ce(t,t),t}function yR(t,e){return he(t,t,e/kl(t)),t}const kOt=[Tr.LEFT,Tr.RIGHT,Tr.BOTTOM,Tr.TOP,Tr.FAR];function UOt(t,e,i){for(let r=0;r<i;++r)if(Or(t,e[r])<=0)return!1;return!0}function AK(t,e,i){for(const r of kOt)if(UOt(t[r],e,i))return!0;return!1}const O5e=4;function VOt(t,e,i){for(const r of e)if(Te(r,t)<i)return!1;return!0}const zOt=[E(),E(),E(),E(),E(),E(),E(),E()],BOt=[0,0,0,0,0,0],S_e=[E(),E(),E(),E(),E(),E()],E_e=E(),jOt=E(),C_e=E(),GOt=E(),HOt=E(),M_e=E(),qOt=E(),WOt=E(),ZOt=E(),YOt=E(),XOt=E(),JOt=E(),z9=Ge(0,0,0),QOt=E(),KOt=[E(),E(),E(),E(),E(),E(),E(),E()],eRt=[E(),E(),E(),E(),E()],tRt=E(),iRt=E(),rRt=E(),sRt=E(),nRt=E(),oRt=E(),aRt=E(),lRt=E(),cRt=E(),uRt=E(),hRt=[0,1,2,3],dRt=[0,1,2,3],pRt=[0,1,3],fRt=[0,1,3],mRt=[1,2,3],gRt=[1,2,3],yRt=E();function _Rt(t,e,i){let r=1/0,s=-1/0;for(const n of i){const o=Te(e,n);r=Math.min(r,o),s=Math.max(s,o)}t[0]=r,t[1]=s}function vRt(t,e,i,r){let s=1/0,n=-1/0;for(const o of r){const a=Te(i,o);if(s=Math.min(s,a),n=Math.max(n,a),s<=e&&n>=t)return!1}return!0}const bRt=[0,0];function B9(t,e,i,r){if(i.length===0||r.length===0)return!0;const s=uRt;Jv(s,t,e);const n=r[0]<i[0],o=n?i:r,a=bRt;return _Rt(a,s,n?r:i),vRt(a[0],a[1],s,o)}const _R=430,wRt=E(),xRt=E(),TRt=Math.cos(.25*Math.PI);let SRt=class{constructor(e){this._camera=new Dr,this._focusOnMap=[0,0],this._screenRect=oi(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new IOt(e.renderCoordsHelper,e.getIsGroundOpaque)}begin(e,i,r){this._camera.copyFrom(e),this._surfaceElevation=r,this._focusOnMap[0]=i.x,this._focusOnMap[1]=i.y,rG(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,r)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=wXe(e.extent,this._focusOnMap),e.measures.visibility!==Oc.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const i=ERt,r=1<<i,s=e.measures.screenRect;zh(s);let n=0;const o=e.lij,a=o[0],l=a+i,c=o[1]<<i,u=o[2]<<i,d=this._tileSizeWithBias(e),f=d*d,m=this._camera,{frustum:g,viewport:y}=m;if(this._renderCoordsHelper.viewingMode===Xe.Local||a>O5e){const v=A_e;this._tilingScheme.getExtent(o[0],o[1],o[2],v);const b=PE,w=ARt,x=zh();for(let M=0;M<4;++M)this._toRenderCoords(v,R_e[M][0],R_e[M][1],w[M]),m.projectToScreen(w[M],b[M]),gre(x,b[M]);const S=AK(g,w,4),C=x[0]>y[2]||x[1]>y[3]||x[2]<y[0]||x[3]<y[1];if(S||C)return void(e.measures.shouldSplit=!1)}for(let v=0;v<r;v++)for(let b=0;b<r;b++)if(n+=this._computeScreenArea(l,c+v,u+b,s),n>f)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===Oc.VISIBLE_WHEN_EXTENDED?this._tileSize*CRt:this._tileSize}_computeScreenArea(e,i,r,s){this._tilingScheme.ensureMaxLod(e);const n=A_e;this._tilingScheme.getExtent(e,i,r,n);const o=MRt;return this._toRenderCoords(n,0,3,o[0]),this._toRenderCoords(n,2,3,o[1]),this._toRenderCoords(n,2,1,o[2]),this._toRenderCoords(n,0,1,o[3]),this._computeTriangleScreenArea([o[0],o[1],o[2]],s)+this._computeTriangleScreenArea([o[2],o[1],o[3]],s)}_computeTriangleScreenArea(e,i){const r=this._camera.frustum[Tr.NEAR];let s=0,n=-1,o=-1;for(let a=0;a<3;++a)Or(r,e[a])>0?(s++,n===-1&&(n=a)):o===-1&&(o=a);if(s===0)return this._computeTriangleScreenAreaInside(e,i);if(s===1){const a=O_e,l=(n+1)%3,c=(n+2)%3,u=n;ve(a[0],e[l]),ve(a[1],e[c]),Y4(a[2],e[c],e[u],r);const d=this._computeTriangleScreenAreaInside(a,i);return Y4(a[1],e[l],e[u],r),d+this._computeTriangleScreenAreaInside(a,i)}if(s===2){const a=O_e,l=o;ve(a[0],e[l]);const c=(o+1)%3,u=(o+2)%3;return Y4(a[1],e[l],e[c],r),Y4(a[2],e[l],e[u],r),this._computeTriangleScreenAreaInside(a,i)}return 0}_computeTriangleScreenAreaInside(e,i){for(let r=0;r<3;r++)this._camera.projectToRenderScreen(e[r],P_e),this._camera.renderToScreen(P_e,PE[r]),Q1(i,PE[r],i);return ght(PE[0],PE[1],PE[2])}_toRenderCoords(e,i,r,s){return Z4[0]=e[i],Z4[1]=e[r],Z4[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(Z4,this._tilingScheme.spatialReference,s),s}};const ERt=2,CRt=5,PE=[Ss(),Ss(),Ss(),Ss()],A_e=oi(),Z4=E(),MRt=[E(),E(),E(),E()],P_e=Pa(),O_e=[E(),E(),E()];function Y4(t,e,i,r){const s=Or(r,e),n=Or(r,i),o=Math.abs(n-s);he(t,e,Math.abs(n)/o),Pn(t,t,i,Math.abs(s)/o)}const ARt=[E(),E(),E(),E()],R_e=[[0,3],[2,3],[2,1],[0,1]];function sni(t,e,i){if(t==null||i==null)return!1;let r=!0;return Bn[0]=t.xmin!=null?t.xmin:0,Bn[1]=t.ymin!=null?t.ymin:0,Bn[2]=t.zmin!=null?t.zmin:0,r=r&&ds(Bn,t.spatialReference,0,e,i,0,1),Bn[0]=t.xmax!=null?t.xmax:0,Bn[1]=t.ymax!=null?t.ymax:0,Bn[2]=t.zmax!=null?t.zmax:0,r=r&&ds(Bn,t.spatialReference,0,e,i,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),r}function R5e(t,e,i){if(t==null||i==null)return!1;let r=!0;return Bn[0]=t.xmin!=null?t.xmin:0,Bn[1]=t.ymin!=null?t.ymin:0,Bn[2]=t.zmin!=null?t.zmin:0,r=r&&ds(Bn,t.spatialReference,0,Bn,i,0,1),e[0]=Bn[0],e[1]=Bn[1],Bn[0]=t.xmax!=null?t.xmax:0,Bn[1]=t.ymax!=null?t.ymax:0,Bn[2]=t.zmax!=null?t.zmax:0,r=r&&ds(Bn,t.spatialReference,0,Bn,i,0,1),e[2]=Bn[0],e[3]=Bn[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),r}const Bn=E();let Xo=class extends Ue{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void se.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const i=this._get("filterExtent");if(i===e||i!=null&&e&&i.equals(e))return;const r=e!=null?e.clone():null;this._set("filterExtent",r),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=oi();return R5e(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new st,this.tileSize=512,this._idToTile=new Map,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new ai}initialize(){this.addHandles([te(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),or),te(()=>{var e,i,r;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(i=this.viewState)==null?void 0:i.contentCamera,(r=this.focus)==null?void 0:r.location]},()=>this._setDirty(),hr),te(()=>{var e;return((e=this.terrain)==null?void 0:e.baseOpacity)??1},()=>this._setDirty())]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(It.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=$r(this._frameWorker)}addClient(){const e=Ph();return this._clients.add(e),this._clients.size===1&&this._setDirty(),Gi(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(Eu))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=It.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=It.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new SRt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,getIsGroundOpaque:()=>{var i;return(((i=this.terrain)==null?void 0:i.baseOpacity)??1)===1}}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(i=>new dI(i[0],i[1],i[2],e))}_purgeHorizonTiles(e){if(e.sort((i,r)=>{const s=i.measures.screenRect,n=r.measures.screenRect;return s[1]+s[3]-(n[1]+n[3])}),!(e.length>ORt))return e.toArray();zh(X4);for(let i=0;i<e.length;i++)if(Q1(X4,e.data[i].measures.screenRect,X4),Lc(X4)>PRt)return e.data.slice(i,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:i}=this;for(;this._pendingTiles.length>0&&!e.done;){const r=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!oG(this._filterExtentRect,r.extent)||(this._tileMeasurements.updateTile(r),r.measures.visibility!==Oc.INVISIBLE&&(r.measures.shouldSplit?(i.ensureMaxLod(r.lij[0]+1),this._pendingTiles.push(...r.getChildren())):this._newTiles.push(r)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const s of this.tiles.items)s.used=!1;const i=e.filter(s=>{const n=this._idToTile.get(s.id);return n?(n.copyMeasurementsFrom(s),n.used=!0):this._idToTile.set(s.id,s),!n}),r=this.tiles.items.filter(s=>!s.used&&(this._idToTile.delete(s.id),!0));this.tiles.removeMany(r),this.tiles.addMany(i),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,i)=>e.measures.visibility!==i.measures.visibility?e.measures.visibility===Oc.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-i.measures.distance),this.tiles.forEach((e,i)=>e.loadPriority=i)}};h([p({constructOnly:!0})],Xo.prototype,"scheduler",void 0),h([p({constructOnly:!0})],Xo.prototype,"renderCoordsHelper",void 0),h([p({constructOnly:!0})],Xo.prototype,"tilingSchemeOwner",void 0),h([p({constructOnly:!0})],Xo.prototype,"cameraOnSurface",void 0),h([p({constructOnly:!0})],Xo.prototype,"focus",void 0),h([p({constructOnly:!0})],Xo.prototype,"viewState",void 0),h([p({constructOnly:!0})],Xo.prototype,"terrain",void 0),h([p()],Xo.prototype,"tiles",void 0),h([p()],Xo.prototype,"tileSize",void 0),h([p({readOnly:!0})],Xo.prototype,"tilingScheme",null),h([p()],Xo.prototype,"filterExtent",null),h([p({readOnly:!0})],Xo.prototype,"_filterExtentRect",null),h([p({readOnly:!0})],Xo.prototype,"_rootTileIds",null),h([p({value:!1})],Xo.prototype,"suspended",null),h([p({readOnly:!0})],Xo.prototype,"updating",null),Xo=h([I("esri.views.3d.layers.support.FeatureTileTree3D")],Xo);const X4=oi(),PRt=10,ORt=50;let $s=class extends Ue{constructor(){super(...arguments),this._propertiesPool=new u_({camera:Dr},this),this._lastSeenCameraProjectionValues=new Dr,this.mode=$i.ANIMATING,this._cssCamera=new Dr,this._camera=new Dr,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new Us,this.viewingMode=Xe.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,i){this._set("viewingMode",e),this._set("spatialReference",i),this._set("constraints",new s0({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new u_({camera:Dr},this)}destroy(){var e;this.cameraController=null,(e=this._propertiesPool)==null||e.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===Xe.Global){const e=_r(this.spatialReference).radius;this.camera=new Dr({eye:Ge(4*e,0,0),center:Ge(e,0,0),up:Ge(0,0,1)})}else this.camera=new Dr({eye:Ge(0,0,100),center:Ge(0,0,0),up:Ge(0,1,0)})}get animation(){return this.cameraController instanceof EL&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:i,width:r,pixelRatio:s}=this.camera;return e.pixelRatio=1,e.height=Math.round(i/s),e.width=Math.round(r/s),e}get camera(){return this._camera}set camera(e){e!==nd&&nd.copyFrom(e),nd.computeUp(this.viewingMode),this.events.emit("before-camera-change",nd);const i=this._camera;if($Rt(this._lastSeenCameraProjectionValues,nd)&&(this._lastSeenCameraProjectionValues.copyFrom(nd),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!i.equals(nd)&&(this._camera=this._propertiesPool.get("camera").copyFrom(nd),this._cameraChanged=!i.almostEquals(nd),this._cameraChanged)){const r=VSe(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===$i.IDLE}get updating(){return this.mode!==$i.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===Xe.Global}get isLocal(){return this.viewingMode===Xe.Local}get navigating(){var e;return!!((e=this.cameraController)!=null&&e.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){var i;this.stopActiveCameraController()?((i=this.cameraController)==null||i.destroy(),e&&(this.removeHandles($_e),this.addHandles(No(()=>e.state===gs.Finished||e.state===gs.Stopped,()=>{this._set("cameraController",null),this.updateCamera(r=>e.onControllerEnd(r))},{sync:!0,once:!0}),$_e),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=gs.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==gs.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();nd.copyFrom(this._get("camera")),e(nd),this.camera=nd,this._processingUpdates=!1,this._processUpdateQueue()}};h([p()],$s.prototype,"mode",void 0),h([p({readOnly:!0,type:aP})],$s.prototype,"animation",null),h([p({type:Dr})],$s.prototype,"cssCamera",null),h([p()],$s.prototype,"_cssCamera",void 0),h([p({type:Dr})],$s.prototype,"camera",null),h([p()],$s.prototype,"_camera",void 0),h([p({readOnly:!0})],$s.prototype,"pixelRatio",null),h([p()],$s.prototype,"rasterPixelRatio",void 0),h([p()],$s.prototype,"contentPixelRatio",void 0),h([p({readOnly:!0})],$s.prototype,"alignPixelEnabled",null),h([p({readOnly:!0})],$s.prototype,"updating",null),h([p({})],$s.prototype,"_contentCamera",void 0),h([p({type:Dr})],$s.prototype,"contentCamera",null),h([p({readOnly:!0})],$s.prototype,"fixedContentCamera",null),h([p({readOnly:!0})],$s.prototype,"constraints",void 0),h([p({readOnly:!0})],$s.prototype,"events",void 0),h([p({readOnly:!0})],$s.prototype,"isGlobal",null),h([p({readOnly:!0})],$s.prototype,"isLocal",null),h([p({readOnly:!0})],$s.prototype,"viewingMode",void 0),h([p({readOnly:!0})],$s.prototype,"spatialReference",void 0),h([p()],$s.prototype,"navigating",null),h([p()],$s.prototype,"stationary",null),h([p()],$s.prototype,"_cameraChanged",void 0),h([p()],$s.prototype,"cameraController",null),$s=h([I("esri.views.3d.state.ViewState")],$s);const RRt=$s;function $Rt(t,e){return t.fov!==e.fov||t.fullViewport[0]!==e.fullViewport[0]||t.fullViewport[1]!==e.fullViewport[1]||t.fullViewport[2]!==e.fullViewport[2]||t.fullViewport[3]!==e.fullViewport[3]||t.padding[gi.TOP]!==e.padding[gi.TOP]||t.padding[gi.RIGHT]!==e.padding[gi.RIGHT]||t.padding[gi.BOTTOM]!==e.padding[gi.BOTTOM]||t.padding[gi.LEFT]!==e.padding[gi.LEFT]}const nd=new Dr,$_e="ViewStateHandles";function $5e(t){return t?URt:VRt}function IRt(t,e){return e!=null&&e.mode?e.mode:$5e(t).mode}function LRt(t,e){return e??$5e(t)}function I5e(t,e){return IRt(t!=null&&t.hasZ,e)}function ani(t,e){return LRt(t!=null&&!!t.hasZ,e)}function lni(t){const e=L5e(t);return I5e(t.geometry,e)}function cni(t){const e=L5e(t),i=I5e(t.geometry,e),r=e!=null&&i!=="on-the-ground"?N5e(e):0,s=e==null?void 0:e.featureExpressionInfo;return{mode:i,offset:r,featureExpressionInfo:s}}function uni(t){return NRt(t)||DRt(t)}function DRt(t){var e;return((e=t==null?void 0:t.featureExpressionInfo)==null?void 0:e.expression)==="0"}function NRt(t){if(!t||t.mode==="on-the-ground")return!1;const e=t!=null&&t.featureExpressionInfo?t.featureExpressionInfo.expression:null;return!(!e||e==="0")}function L5e(t){return t.layer&&"elevationInfo"in t.layer?t.layer.elevationInfo:null}function lae(t,e){if(!(t!=null&&t.offset))return 0;const{offset:i,unit:r}=t;if(r==="decimal-degrees")return 0;const s=r!=="unknown"&&r?r:"meters",n=X2e(e);return n?Vr(i,s,n):0}function hni(t,e,i){if(!(i!=null&&i.mode))return;const r=t.hasZ?t.z:0,s=lae(i,t.spatialReference);switch(i.mode){case"absolute-height":return r-s;case"on-the-ground":return 0;case"relative-to-ground":return r-((e.elevationProvider.getElevation(t.x,t.y,r,t.spatialReference,"ground")??0)+s);case"relative-to-scene":return r-((e.elevationProvider.getElevation(t.x,t.y,r,t.spatialReference,"scene")??0)+s)}}function dni(t,e,i,r=null){return D5e(t,e.x,e.y,e.hasZ?e.z:0,e.spatialReference,i,r)}function pni(t,e,i,r,s=null){return D5e(t,e[0],e[1],e.length>2?e[2]:0,i,r,s)}function D5e(t,e,i,r,s,n,o=null){if(n==null)return;const a=o!=null?o.mode:"absolute-height";if(a==="on-the-ground")return 0;const{absoluteZ:l}=FRt(e,i,r,s,t,n);return kRt(l,e,i,r,s,t,o,a)}function FRt(t,e,i,r,s,n){const o=lae(n,r);switch(n.mode){case"absolute-height":return{absoluteZ:i+o,elevation:0};case"on-the-ground":{const a=s.elevationProvider.getElevation(t,e,0,r,"ground")??0;return{absoluteZ:a,elevation:a}}case"relative-to-ground":{const a=s.elevationProvider.getElevation(t,e,i,r,"ground")??0;return{absoluteZ:i+a+o,elevation:a}}case"relative-to-scene":{const a=s.elevationProvider.getElevation(t,e,i,r,"scene")??0;return{absoluteZ:i+a+o,elevation:a}}}}function kRt(t,e,i,r,s,n,o,a){const l=lae(o,s);switch(a){case"absolute-height":return t-l;case"relative-to-ground":return t-((n.elevationProvider.getElevation(e,i,r,s,"ground")??0)+l);case"relative-to-scene":return t-((n.elevationProvider.getElevation(e,i,r,s,"scene")??0)+l)}}function fni(t,e){if(e==null)return!1;const{mode:i}=e;return i!=null&&(t==="scene"&&i==="relative-to-scene"||t==="ground"&&i!=="absolute-height")}function mni(t,e,i){return i&&i.mode!==e?`${t} only support ${e} elevation mode`:null}function gni(t,e,i){return(i==null?void 0:i.mode)===e?`${t} do not support ${e} elevation mode`:null}function yni(t,e){return(e==null?void 0:e.featureExpressionInfo)!=null&&e.featureExpressionInfo.expression!=="0"?`${t} do not support featureExpressionInfo`:null}function _ni(t,e){e&&t.warn(".elevationInfo=",e)}function N5e(t){return((t==null?void 0:t.offset)??0)*fLe(t==null?void 0:t.unit)}const URt={mode:"absolute-height",offset:0},VRt={mode:"on-the-ground",offset:null},F5e="OBJECTID";let vni=class extends SD{constructor(e,i,r,s){super(i,r),this.point=e,this.createGraphic=s}};function k5e(t){return ap(t)&&t.intersector===rs.PCL&&!!t.target}let wni=class extends WAe{constructor(e,i,r,s,n){super(e),this.layerUid=e,this.sublayerUid=i,this.nodeIndex=r,this.componentIndex=s,this.triangleNr=n}},Tni=class extends SD{constructor(e,i,r){super(i,null),this.point=e,this.createVoxelGraphic=r}},Eni=class extends SD{constructor(e,i){super(e,null),this.createTiles3DGraphic=i}};function Y6(t){return ap(t)&&t.intersector===rs.I3S&&!!t.target}function U5e(t){return ap(t)&&t.intersector===rs.VOXEL&&!!t.target}function zRt(t){return ap(t)&&t.intersector===rs.TILES3D&&!!t.target}function V5e(t,e){var i,r;return CG(t)||MG(t)?BL((i=t.target)==null?void 0:i.object,e):twt(t)?(r=e.map)==null?void 0:r.ground:k5e(t)||Y6(t)||kNe(t)||U5e(t)?BL(t.target,e):null}function Mni(t,e){const i=cae(t,e);return i!=null&&i.type==="graphic"?i.graphic:null}function cae(t,e){var i;if(t==null)return null;if(CG(t)||MG(t))return I_e((i=t.target)==null?void 0:i.object,e);if(k5e(t)){const r=t.target.createGraphic();return{type:"graphic",graphic:r,layer:r.layer}}if(U5e(t)){const r=t.target.createVoxelGraphic();return{type:"graphic",graphic:r,layer:r.layer}}if(zRt(t)){const r=t.target.createTiles3DGraphic();return{type:"graphic",graphic:r,layer:r.layer}}return kNe(t)||iae(t)?I_e(t.target,e):Y6(t)?BRt(t.target,e):null}function I_e(t,e){if((t==null?void 0:t.graphicUid)==null)return null;const i=BL(t,e);if(i==null)return null;if(i===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const r=e.allLayerViews.find(s=>s.layer===i);return!r||r.suspended||t.graphicUid==null?null:"getHit"in r?r.getHit(t.graphicUid):null}function BRt(t,e){const i=BL(t,e);if(i==null)return null;const r=e.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?GRt(r.getGraphicFromIntersectorTarget(t)):null}function jRt(t,e){const i=BL(t,e);if(i==null)return null;const r=e.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(t):null}function GRt(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function BL(t,e){return(t==null?void 0:t.layerUid)==null?null:e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.allLayers.find(i=>i.uid===t.layerUid)}function Ani(t,e){if(CG(t)||MG(t))return eb(t.target.object.boundingVolumeWorldSpace.bounds);if(iae(t)){$Ee(J4,t.transformation);const i=Math.max(J4[0],J4[1],J4[2]);return t.target.baseBoundingSphere.radius*i}if(Y6(t)){const i=jRt(t.target,e);return i?.5*AOe(i):null}return null}function Pni(t){return!CG(t)&&!MG(t)&&(iae(t)?t.target.numLodLevels>1:!!Y6(t))}const J4=E();async function HRt(t,e,i,r){const s=i?j5e(t,i):r,n=Ss(e.x,e.y);s.requiresGroundFeedback=!0,s.enableDraped=!0;const o=ip(t.state.viewingMode);o.options.selectionMode=!0,o.options.store=oa.ALL,t.sceneIntersectionHelper.intersectIntersectorScreen(n,o,s);const a=WRt(t,o.results.all,s.graphics),l=o.results.ground,c=V5e(l,t),u=c!=null&&"type"in c&&tL(c.type)?c:null,d={screenPoint:e,results:a,ground:{mapPoint:MM(t,l),distance:ap(l)?l.distanceInRenderSpace:0,layer:u}};return Nr.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(d.intersector=o),d}function qRt(t,e,i,r){var u,d,f,m,g;const s=i?j5e(t,i):r,n=!(!((u=s.graphics)!=null&&u.include)&&!((d=s.graphics)!=null&&d.exclude)),o=!(!((f=s.mediaElements)!=null&&f.include)&&!((m=s.mediaElements)!=null&&m.exclude)),a=yf(e);s.enableDraped=s.include&&!s.include.has(Ab)||((g=s.exclude)==null?void 0:g.has(Ab));const l=t.sceneIntersectionHelper,c=ip(t.state.viewingMode);if(c.options.selectionMode=!0,c.options.store=n||o?oa.ALL:oa.MIN,c.options.hud=!(i!=null&&i.excludeHud),l.intersectIntersectorScreen(a,c,s),n||o){for(const y of c.results.all){const v=cae(y,t);if(v==null||n&&(v.type!=="graphic"||z5e(s.graphics,v.graphic))||o&&(v.type!=="media"||B5e(s.mediaElements,v.element)))return MM(t,y)}return null}return MM(t,c.results.min)}function WRt(t,e,i){const r=new Array;let s=null;for(let n=0;n<e.length;n++){const o=e[n],a=V5e(o,t);if(a!=null&&(a===t.map.ground||"type"in a&&tL(a.type)))break;const l=cae(o,t);if(l==null)continue;if(l.type==="graphic"){if(s==null&&n!==e.length-1&&(s=new Set),s!=null){const d=uae(l.graphic);if(s.has(d))continue;s.add(d)}if(!z5e(i,l.graphic))continue}const c=MM(t,o),u=o.distanceInRenderSpace;if(l.type==="media"){const d=l.element.toSource(c);r.push({...l,mapPoint:c,distance:u,sourcePoint:d})}else r.push({...l,mapPoint:c,distance:u})}return r}function MM(t,e,i){return e.getIntersectionPoint(AM)?(i=PK(t,AM,i),e.intersector===rs.TERRAIN&&t.basemapTerrain&&(i.z=Mg(t.basemapTerrain,i)??0),i):null}function uae(t){var s;const e=t.sourceLayer,i=t.layer,r=e&&"objectIdField"in e?e:i&&"objectIdField"in i?i:e;if(r){const n=r.objectIdField??F5e,o=(s=t.attributes)==null?void 0:s[n];if(o)return`o-${r.id}-${o}`}return`u-${t.uid}`}function z5e(t,e){return B5e(t,uae(e))}function B5e(t,e){return t==null||(t.include==null||t.include.has(e))&&(t.exclude==null||!t.exclude.has(e))}function PK(t,e,i){let r=t.spatialReference||Ze.WGS84;return Fo(e,t.renderSpatialReference,AM,r)?e=AM:(r=Ze.WGS84,Fo(e,t.renderSpatialReference,AM,r)&&(e=AM)),i?(i.x=e[0],i.y=e[1],i.z=e[2],i.spatialReference=r):i=new bt(e,r),i}function j5e(t,e){const i=OK(t,e.include,SP.INCLUDE),r=OK(t,e.exclude,SP.EXCLUDE);return{include:i.layerUids,exclude:r.layerUids,graphics:{include:i.graphicUids,exclude:r.graphicUids},mediaElements:{include:i.mediaElements,exclude:r.mediaElements}}}function OK(t,e,i,r={layerUids:void 0,graphicUids:void 0,mediaElements:void 0}){if(!e)return r;if(e instanceof ca)ZRt(r,uae(e)),i===SP.INCLUDE&&(t.graphicsView!=null&&e.layer===t?OE(r,t.graphicsView.processor.layer.id):e.layer&&OE(r,e.layer.uid));else if("layer"in e&&"element"in e)YRt(r,e.element),i===SP.INCLUDE&&OE(r,e.layer.uid);else if(LW(e))for(const s of e)s===t.graphics&&t.graphicsView!=null?OE(r,t.graphicsView.processor.layer.id):s===t.map.ground?OE(r,Ab):OK(t,s,i,r);else"uid"in e&&OE(r,e.uid);return r}function OE(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function ZRt(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function YRt(t,e){t.mediaElements||(t.mediaElements=new Set),t.mediaElements.add(e)}const AM=E();var SP;(function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"})(SP||(SP={}));let XRt=class{constructor(e,i,r){this.viewingMode=e,this._forEachLayer=i,this._view=r,this._externalIntersectionHandlers=new ai,this._tolerance=tP,this._tmpRay=lo(),this._tmpRegion=oi(),this._validateHUDIntersector=ip(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,i,r){return this.intersectRay(this._getPickRay(e,this._tmpRay),L_e(this.viewingMode),i,r)}intersectScreenFreePointFallback(e,i,r){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),i,r)}intersectRayFreePointFallback(e,i,r){return this.intersectRay(e,L_e(this.viewingMode),i,r)||this._intersectRayFreePointLocal(e,i)}intersectRay(e,i,r,s){return i.options.selectionMode=!1,i.options.store=oa.MIN,this.computeIntersection(e,i,s),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(e,i,r=.5,s=.5){return e.getRenderCenter(K4,r,s),K4[0]+=.0466,K4[1]-=.0123,Pne(e,K4,i)}intersectIntersectorScreen(e,i,r){this.computeIntersection(this._getPickRay(e,this._tmpRay),i,r)}intersectToolIntersectorScreen(e,i,r){const s=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(s,i,r)}intersectToolIntersectorRay(e,i,r){i.options.selectionMode=!0,this.computeIntersection(e,i,r);const s=i.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||ap(s)&&s.intersector!==rs.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(e,i,r))}setTolerance(e=tP){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((i,r)=>i.type===rs.TERRAIN?1:r.type===rs.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((i,r)=>i.type===rs.TERRAIN?1:r.type===rs.TERRAIN?-1:0)}_getPickRay(e,i){const r=this._view.state.camera;return Ane(r,e,i)}_intersectRayFreePointLocal(e,i){return this.viewingMode!==Xe.Local||e==null||Ee(i,e.origin,Ce(it.get(),e.direction)),!1}intersectElevationFromScreen(e,i,r=0,s=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),i,r,s)}_intersectElevation(e,i,r=0,s=null){if(e==null)return null;const n=this._view,{renderCoordsHelper:o}=n,a=a_(n.spatialReference),l=i!=null?i.mode:"absolute-height",c=N5e(i)/a,u=(l!=="on-the-ground"?c+r:0)*a/o.unitInMeters,{camera:d}=n.state;if(l==="absolute-height"){const S=o==null?void 0:o.getAltitude(d.eye),C=Te(Ce(vR,e.direction),o.worldUpAtPosition(d.eye,KRt));if(S<u&&C<0||S>=u&&C>0)return null;if(o.intersectInfiniteManifold(e,u,vR)){const M=PK(n,vR);return M.z??(M.z=0),M.z-=c,M}return null}const f=it.get();d.projectToRenderScreen(e.origin,f);const m=new D_e(null,this._forEachLayer),{slicePlane:g}=n,y=g!=null?fde(g):null,v=ip(this.viewingMode);v.options.store=oa.MIN,v.options.verticalOffset=u,v.options.normalRequired=!1;const b=e.origin,w=Ee(it.get(),b,e.direction);v.reset(b,w,d),v.point=f;const x=s?"type"in s&&s.type==="graphics"?S=>S.layerUid!==s.uid:S=>S.graphicUid!==s.uid:null;switch(l){case"relative-to-scene":{const S=C=>(!x||x(C))&&!!C.lastValidElevationBB;v.intersect(m.layers,f,this._tolerance,null,S),this._externalIntersectionHandlers.forAll(C=>{if(C.type===rs.I3S||C.type===rs.TERRAIN||C.type===rs.TILES3D){const M=C.slicePlaneEnabled?y:null;C.intersect(v,M,v.rayBegin,v.rayEnd,f)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(S=>{if(S.isGround){const C=S.slicePlaneEnabled?y:null;S.intersect(v,C,v.rayBegin,v.rayEnd,f)}})}if(v.results.min.getIntersectionPoint(vR)){const S=PK(n,vR);return S.z=r,S}return null}computeIntersection(e,i,r,s){var y;if(e==null)return;const n=this._view.state.camera,o=it.get();n.projectToRenderScreen(e.origin,o);const a=new D_e(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const l=e.origin,c=Ee(it.get(),e.origin,e.direction);i.reset(l,c,n),i.intersect(a.layers,o,this._tolerance);const u=this._view.slicePlane,d=u!=null?fde(u):null;i.intersect(a.sliceableLayers,o,this._tolerance,d);const f=r&&(r.requiresGroundFeedback||r.enableDraped);this._externalIntersectionHandlers.forAll(v=>{const b=v.layerUid,w=Array.isArray(b),x=w?b:[b];w&&(i.options.filteredLayerUids=[]);let S=!1;for(const C of x)a.filterLayerUid(C)?S=!0:w&&i.options.filteredLayerUids.push(C);if(i.options.isFiltered=!S,v.isGround&&f||!i.options.isFiltered){const C=v.slicePlaneEnabled?d:null;v.intersect(i,C,l,c,o,s)}});const m=it.get(),g=this._view.basemapTerrain;if(r&&r.enableDraped&&g.spatialReference!=null&&i.results.ground.getIntersectionPoint(m)){const v=g.overlayManager.renderer,b=this._view.renderCoordsHelper.spatialReference,w=it.get();this._view.renderCoordsHelper.fromRenderCoords(m,w,g.spatialReference),w[2]=((y=this._view.elevationProvider)==null?void 0:y.getElevation(m[0],m[1],m[2],b,"ground"))??0,v.intersect(i,w,i.results.ground,x=>a.filterRenderGeometry(x))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(e){const i=e.results.hud;l_(this._tmpRegion,CZ);const r=this._view.state.camera,s=[],n=this._tmpRegion,o=b=>{const w=new QRt(b);r.projectToRenderScreen(b.target.center,w.screenPoint),w.screenPoint[0]=Math.floor(w.screenPoint[0]),w.screenPoint[1]=Math.floor(w.screenPoint[1]),s.push(w),gre(n,w.screenPoint)};e.sortResults(i.all),i.min.dist!=null&&o(i.min);for(const b of i.all)i.min.target.object!==b.target.object&&i.max.target.object!==b.target.object&&o(b);if(i.max.dist!=null&&i.max.target.object!==i.min.target.object&&o(i.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=r.fullWidth,l=r.fullHeight,c=Math.max(0,n[0]-pI),u=Math.max(0,n[1]-pI),d=Math.min(nl(n)+2*pI,a-c),f=Math.min(Lc(n)+2*pI,l-u);if(d<=0||f<=0)return;const m=new Uint8Array(d*f*4);this._view._stage.renderer.readHUDVisibility(c,u,d,f,m);let g=!0;const y=e.results.max.dist==null;let v=0;for(const b of s)for(const w of JRt){const x=4*(Math.min(b.screenPoint[0]+w[0],a)-n[0]+(Math.min(b.screenPoint[1]+w[1],l)-n[1])*d);if(!(x<0||x>=m.length)&&m[x]){g&&(e.results.min.copy(b.result),g=!1),y&&e.results.max.copy(b.result),e.options.store===oa.ALL&&e.results.all.splice(v++,0,b.result);break}}}};const pI=1,JRt=(()=>{const t=[],e=pI;for(let i=-e;i<=e;i++)for(let r=-e;r<=e;r++)t.push([r+e,i+e]);return t})();let QRt=class{constructor(e){this.result=e,this.screenPoint=Pa()}},Q4;function L_e(t){return Q4&&Q4.viewingMode===t||(Q4=ip(t)),Q4}let D_e=class{constructor(e,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,i(r=>{r.pickable&&this.filterLayerUid(r.apiLayerUid)&&(r.sliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(e){const{include:i,exclude:r}=this;return e==null?i==null&&r==null:(i==null||i.has(e))&&(r==null||!r.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function N_e(t){return typeof t=="object"&&"intersect"in t}const vR=E(),KRt=E(),K4=Pa();let Ini=class{constructor(e,i){this.spatialReference=e,this._view=i}getElevation(e,i,r){return this._view.elevationProvider.getElevation(e,i,0,this.spatialReference,r)}async queryElevation(e,i,r,s,n){return this._view.elevationProvider.queryElevation(e,i,0,this.spatialReference,n,r,s)}},e$t=class{constructor(e,i,r,s){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(It.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(e)this.runTask(Eu);else for(const i of this._queries)i.result.reject(ki())}queryElevation(e,i,r,s=0){const n=aa(),o={x:e,y:i,minDemResolution:s,result:n,signal:r};return this._queries.push(o),Ra(r,()=>{Vxe(this._queries,o),n.reject(ki())}),n.promise}get running(){return this._queries.length>0}runTask(e){const i=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return i.forEach(u=>u.result.reject()),void e.madeProgress();const s=i.map(u=>[u.x,u.y]),n=i.reduce((u,d)=>Math.min(u,d.minDemResolution),1/0),o=new jP({points:s,spatialReference:this.spatialReference}),a=i.length>1&&i.some(u=>!!u.signal)?new AbortController:null,l=a!=null?a.signal:i[0].signal;if(a!=null){let u=0;i.forEach(d=>Ra(d.signal,()=>{u++,d.result.reject(ki()),u===i.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};r.queryElevation(o,c).then(u=>{i.forEach((d,f)=>{d.signal!=null&&d.signal.aborted?d.result.reject(ki()):d.result.resolve(u.geometry.points[f][2])})}).catch(u=>{i.forEach(d=>d.result.reject(u))}),e.madeProgress()}get test(){}},YB=class{constructor(e=1/0,i=-1/0){this.elevationRangeMin=e,this.elevationRangeMax=i}get elevationRangeValid(){return!Number.isNaN(this.elevationRangeMin)}invalidateElevationRange(){this.elevationRangeMin=NaN}expandElevationRangeValues(e,i){this.elevationRangeMin=Math.min(this.elevationRangeMin,e),this.elevationRangeMax=Math.max(this.elevationRangeMax,i)}expandElevationRange(e){this.elevationRangeMin=Math.min(this.elevationRangeMin,e.elevationRangeMin),this.elevationRangeMax=Math.max(this.elevationRangeMax,e.elevationRangeMax)}setElevationRange(e){this.elevationRangeMin=e.elevationRangeMin,this.elevationRangeMax=e.elevationRangeMax}},fI=class extends Us.EventedMixin(Ue){get spatialReference(){var e,i;return(i=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:i.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this.lastElevationQuery=null,this._cacheEnabled=!1}destroy(){this._cachedQuery=qe(this._cachedQuery)}enableCache(e){e||(this.lastElevationQuery=null),this._cacheEnabled=e}getElevation(e,i,r,s,n){if(this._cacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&i===a.y&&r===a.z&&hs(s,a.spatialReference)&&n===a.queryContext)return a.result}let o=null;return o=e5(o,this._im,e,i,r,s,n),o==null&&(o=e5(o,this._ground,e,i,r,s,n)),n==="scene"&&(o=e5(o,this._scene,e,i,r,s,n)),this._cacheEnabled&&(this.lastElevationQuery={x:e,y:i,z:r,spatialReference:s,queryContext:n,result:o}),o}getSphereElevationBounds(e,i,r){const s=new YB;function n(o){for(const a of o)if(a.getSphereElevationBounds){const l=a.getSphereElevationBounds(e,i,r);l!=null&&s.expandElevationRangeValues(l.elevationRangeMin,l.elevationRangeMax)}}return n(this._ground),n(this._im),r==="scene"&&n(this._scene),s}getRootElevationBounds(){const e=new YB;for(const i of[this._im,this._ground,this._scene])i.forEach(r=>{if(r.getRootElevationBounds){const s=r.getRootElevationBounds();s!=null&&e.expandElevationRangeValues(s.elevationRangeMin,s.elevationRangeMax)}});return e}async queryElevation(e,i,r,s,n,o=null,a=0){const l=this._getElevationQuery(s);try{const c=await l.queryElevation(e,i,o,a);return n==="scene"?e5(c,this._scene,e,i,r,s,n):c}catch(c){return jl(c),this.getElevation(e,i,r,s,n)}}register(e,i){this.addHandles(i.on("elevation-change",r=>this.emit("elevation-change",r)),i),this._providersFromContext(e).push(i)}unregister(e){this.removeHandles(e);for(const i of[this._im,this._ground,this._scene]){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}_getElevationQuery(e=this.view.spatialReference){const i=this._cachedQuery;if(i!=null&&hs(e,i.spatialReference))return i;i==null||i.destroy({completeTasks:!0});const{wkid:r,wkt:s,wkt2:n,latestWkid:o}=e,a=new e$t(this.view.resourceController.scheduler,new Ze({wkid:r,wkt:s,wkt2:n,latestWkid:o}),()=>{var l;return(l=this.view.map)==null?void 0:l.ground},{maximumAutoTileRequests:4});return this._cachedQuery=a,a}};function e5(t,e,i,r,s,n,o){for(const a of e){const l=a.getElevation(i,r,s,n,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}h([p({constructOnly:!0})],fI.prototype,"view",void 0),h([p()],fI.prototype,"spatialReference",null),fI=h([I("esri.views.3d.support.CombinedElevationProvider")],fI);let jL=class RK{static isValidProfile(e){return e in RK.profiles}static getDefaultProfile(){return le("esri-iPhone")?"low":"medium"}static apply(e,i){const r=RK.profiles[e];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxNumberOfDrawCalls=r.graphics3D.maxNumberOfDrawCalls,i.graphics3D.maxTotalNumberOfVertices=r.graphics3D.maxTotalNumberOfVertices,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable,i.graphics3D.skipHighSymbolLods=r.graphics3D.skipHighSymbolLods,i.graphics3D.uncompressedTextureDownsamplingEnabled=r.graphics3D.uncompressedTextureDownsamplingEnabled;const s=i.sceneService.object,n=r.sceneService.object;s.lodFactor=n.lodFactor,i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.vtlContentZoom=r.tiledSurface.vtlContentZoom,i.tiledSurface.elevationLevelDelta=r.tiledSurface.elevationLevelDelta,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.fadeDuration=r.fadeDuration,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.highResolutionAtmosphere=r.highResolutionAtmosphere,i.reflections=r.reflections,i.ambientOcclusion=r.ambientOcclusion,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumPixelRatio=r.maximumPixelRatio}};jL.test={reset(){const t=G5e();for(const e of Object.keys(t))jL.profiles[e]=t[e]}};const bR={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};function G5e(){const t=!!le("esri-mobile"),e=!!le("ios"),i=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,elevationLevelDelta:3,reduceTileLevelDifferences:!0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+bR.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:13e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:3,reduceTileLevelDifferences:!le("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600+bR.GalaxyS20:750+bR.FullHD,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:23e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:2,reduceTileLevelDifferences:!le("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900+bR.SurfacePro7:1500+bR.FullHDRetina,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}(function(t){t.profiles=G5e()})(jL||(jL={}));const $U=jL,H5e=new Qe([0,255,255]),q5e=1,W5e=.25,Z5e=new Qe([0,0,0]),Y5e=.4,X5e=.2;let Ym=class extends Ue{constructor(){super(...arguments),this.color=H5e.clone(),this.haloColor=null,this.haloOpacity=q5e,this.fillOpacity=W5e,this.shadowOpacity=Y5e,this.shadowColor=Z5e.clone(),this.shadowDifference=X5e}};h([p({type:Qe})],Ym.prototype,"color",void 0),h([p({type:Qe})],Ym.prototype,"haloColor",void 0),h([p()],Ym.prototype,"haloOpacity",void 0),h([p()],Ym.prototype,"fillOpacity",void 0),h([p()],Ym.prototype,"shadowOpacity",void 0),h([p({type:Qe})],Ym.prototype,"shadowColor",void 0),h([p()],Ym.prototype,"shadowDifference",void 0),Ym=h([I("esri.views.3d.support.HighlightOptions")],Ym);const J5e=Ym;function t$t(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function hae(t){return typeof t=="string"?un(t):ie(t)}function i$t(t,e,i){const r={};for(const s in t){if(s==="declaredClass")continue;const n=t[s];if(n!=null&&typeof n!="function")if(Array.isArray(n))r[s]=n.map(o=>i$t(o));else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(i==null?void 0:i[s]);r[s]=JSON.stringify(o)}else r[s]=JSON.stringify(n);else r[s]=n}return r}function r$t(t){return{geometryType:GP(t[0]),geometries:t.map(e=>e.toJSON())}}function Q5e(t,e,i){const r=LXe(e);return t.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}let Wx=class extends Se{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(s=>s.toJSON()),i=this.geometries[0],r={};return r.outSR=PA(this.outSpatialReference),r.inSR=PA(i.spatialReference),r.geometries=JSON.stringify({geometryType:GP(i),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};h([p()],Wx.prototype,"geometries",void 0),h([p({json:{read:{source:"outSR"}}})],Wx.prototype,"outSpatialReference",void 0),h([p()],Wx.prototype,"transformation",void 0),h([p()],Wx.prototype,"transformForward",void 0),Wx=h([I("esri.rest.support.ProjectParameters")],Wx);const X6=Wx,s$t=Qs(X6);async function dae(t,e,i){e=s$t(e);const r=hae(t),s={...r.query,f:"json",...e.toJSON()},n=e.outSpatialReference,o=GP(e.geometries[0]),a=t$t(s,i);return yr(r.path+"/project",a).then(({data:{geometries:l}})=>Q5e(l,o,n))}async function pae(t=null,e){var s,n;if(rr.geometryServiceUrl)return rr.geometryServiceUrl;if(!t)throw new G("internal:geometry-service-url-not-configured");let i;i="portal"in t?t.portal||Wn.getDefault():t,await i.load({signal:e});const r=(n=(s=i.helperServices)==null?void 0:s.geometry)==null?void 0:n.url;if(!r)throw new G("internal:geometry-service-url-not-configured");return r}async function n$t(t,e,i=null,r){const s=await pae(i,r),n=new X6({geometries:[t],outSpatialReference:e}),o=await dae(s,n,{signal:r});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new G("internal:geometry-service-projection-failed")}const o$t=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:pae,projectGeometry:n$t},Symbol.toStringTag,{value:"Module"}));let a$t=class{constructor(e,i){this.spatialReference=i,this.unitInMeters=ec(this.spatialReference,_r(this.spatialReference).metersPerDegree);const r=e&&"portalItem"in e?e.portalItem:void 0;this._geometryServiceURLPromise=pae(r).catch(()=>{throw new G("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const i=await this._geometryServiceURLPromise;let r,s=!0;Array.isArray(e[0])&&typeof e[0]!="number"?r=e:(r=[e],s=!1);const n=r.map(l=>l instanceof bt?l:new bt(l,this.spatialReference)),o=new X6({geometries:n,outSpatialReference:Ze.WGS84}),a=(await dae(i,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return s?a:a[0]}};var Qt;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(Qt||(Qt={}));const Zx=[Qt.ELEVATION,Qt.MAP];async function l$t(t,e){if(t.type==="2d")return t.hitTest(e);const i=await t.hitTest(e);if(i.results.length===0)return i;const r=i.results[0],s=(r.distance??0)*(1+c$t),n=i.results.findIndex(o=>(o.distance??0)>s);return n!==-1&&(i.results=i.results.slice(0,n)),r&&i.ground.distance>s&&(i.ground.mapPoint=null),i}const c$t=.05;async function u$t(t,e){var f,m,g,y,v;const{results:i,ground:r}=await l$t(t,e),s=(!r.layer||!tL(r.layer.type))&&r.mapPoint,n=[],o=p$t(t),a=s?h$t(t,o):d$t;let l=0,c=0;const u=()=>{const b=a.layerViews[c];s&&b&&"fetchPopupFeaturesAtLocation"in b&&n.push({mapPoint:r.mapPoint,layerView:b}),++c};let d=null;for(;l<i.length||c<a.layerViews.length;){const b=i[l];if(b&&b.type!=="graphic")++l;else if(((f=b==null?void 0:b.layer)==null?void 0:f.type)!=="scene"||((m=b==null?void 0:b.layer)==null?void 0:m.parent)!==((g=t==null?void 0:t.map)==null?void 0:g.basemap))if(b){const w=(y=b.layer)==null?void 0:y.uid,x=a.layerUids.has(w)&&b.distance===r.distance,S=o.get((v=b.layer)==null?void 0:v.uid);if(d??(d=b.mapPoint),c<a.layerViews.length&&(x||(b.distance??0)>r.distance)&&a.layerViews[c]!==S){u();continue}n.push({graphic:b.graphic,layerView:S}),++l}else u();else++l}return d??(d=r.mapPoint),{hits:n,location:d}}function h$t(t,e){const i=new Set,r=[];for(let n=t.basemapTerrain.numLayers(Qt.MAP)-1;n>=0;n--){const o=t.basemapTerrain.layerViewByIndex(n,Qt.MAP);i.add(o.layer.uid),r.push(o)}const s=t.basemapTerrain.overlayManager.renderer.layers;for(const{uid:n}of s){const o=e.get(n);o&&(i.add(n),r.push(o))}return r.reverse(),{layerUids:i,layerViews:r}}const d$t={layerUids:new Set,layerViews:[]};function p$t(t){const e=new Map;for(const i of t.allLayerViews){const r=i.layer.uid;e.set(r,i)}return e}let ch=class extends Ue{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1,this.uncompressedTextureDownsamplingEnabled=!1}};h([p()],ch.prototype,"minTotalNumberOfFeatures",void 0),h([p()],ch.prototype,"maxTotalNumberOfFeatures",void 0),h([p()],ch.prototype,"maxNumberOfDrawCalls",void 0),h([p()],ch.prototype,"maxTotalNumberOfVertices",void 0),h([p()],ch.prototype,"snapshotAvailable",void 0),h([p()],ch.prototype,"polygonLodFactor",void 0),h([p()],ch.prototype,"polylineLodFactor",void 0),h([p()],ch.prototype,"skipHighSymbolLods",void 0),h([p()],ch.prototype,"uncompressedTextureDownsamplingEnabled",void 0),ch=h([I("esri.views.3d.support.QualitySettings.Graphics3DSettings")],ch);let $f=class extends Ue{constructor(){super(...arguments),this.lodFactor=1}};h([p()],$f.prototype,"lodFactor",void 0),$f=h([I("esri.views.3d.support.QualitySettings.LoDFactorSettings")],$f);let M0=class extends Ue{constructor(){super(...arguments),this.object=new $f,this.point=new $f,this.integratedMesh=new $f,this.pointCloud=new $f,this.uncompressedTextureDownsamplingEnabled=!1}};h([p({type:$f})],M0.prototype,"object",void 0),h([p({type:$f})],M0.prototype,"point",void 0),h([p({type:$f})],M0.prototype,"integratedMesh",void 0),h([p({type:$f})],M0.prototype,"pointCloud",void 0),h([p()],M0.prototype,"uncompressedTextureDownsamplingEnabled",void 0),M0=h([I("esri.views.3d.support.QualitySettings.SceneServiceSettings")],M0);let A0=class extends Ue{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.elevationLevelDelta=3,this.reduceTileLevelDifferences=!0}};h([p()],A0.prototype,"lodBias",void 0),h([p()],A0.prototype,"angledSplitBias",void 0),h([p()],A0.prototype,"vtlContentZoom",void 0),h([p()],A0.prototype,"elevationLevelDelta",void 0),h([p()],A0.prototype,"reduceTileLevelDifferences",void 0),A0=h([I("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],A0);let PM=class extends Ue{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};h([p()],PM.prototype,"pixelRatio",void 0),h([p()],PM.prototype,"maxTotalNumberOfFeatures",void 0),PM=h([I("esri.views.3d.support.QualitySettings.HeatmapSettings")],PM);let ma=class extends Ue{constructor(){super(...arguments),this.graphics3D=new ch,this.sceneService=new M0,this.tiledSurface=new A0,this.heatmap=new PM,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};h([p({type:ch})],ma.prototype,"graphics3D",void 0),h([p({type:M0})],ma.prototype,"sceneService",void 0),h([p({type:A0})],ma.prototype,"tiledSurface",void 0),h([p({type:PM})],ma.prototype,"heatmap",void 0),h([p()],ma.prototype,"fadeDuration",void 0),h([p()],ma.prototype,"antialiasingEnabled",void 0),h([p()],ma.prototype,"physicallyBasedRenderingEnabled",void 0),h([p()],ma.prototype,"highQualityTransparency",void 0),h([p()],ma.prototype,"highResolutionAtmosphere",void 0),h([p()],ma.prototype,"reflections",void 0),h([p()],ma.prototype,"ambientOcclusion",void 0),h([p()],ma.prototype,"memoryLimit",void 0),h([p()],ma.prototype,"additionalCacheMemory",void 0),h([p()],ma.prototype,"frameRate",void 0),h([p()],ma.prototype,"maximumPixelRatio",void 0),ma=h([I("esri.views.3d.support.QualitySettings")],ma);const F_e=ma;let f$t=class $K{constructor(e,i,r,s){this.viewingMode=e,this.spatialReference=i,this.unitInMeters=r,this._coordinateSystem=s,this._tmpCoordinateSystem=Het(s),this.referenceEllipsoid=_r(i),this.sphericalPCPF=Gh(i)}set extent(e){e&&qet(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return ett(this._coordinateSystem,e)}setAltitude(e,i,r=e){return xAe(this._coordinateSystem,r,i,e)}setAltitudeOfTransformation(e,i){ttt(this._coordinateSystem,i,e,i)}worldUpAtPosition(e,i){return Xet(this._coordinateSystem,e,i)}worldBasisAtPosition(e,i,r){return Jet(this._coordinateSystem,e,i,r)}basisMatrixAtPosition(e,i){const r=this.worldBasisAtPosition(e,ys.X,it.get()),s=this.worldBasisAtPosition(e,ys.Y,it.get()),n=this.worldBasisAtPosition(e,ys.Z,it.get());return hy(i,r[0],r[1],r[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),i}headingAtPosition(e,i){const r=this.worldUpAtPosition(e,it.get()),s=this.worldBasisAtPosition(e,ys.Y,it.get()),n=XMe(i,s,r);return La(n)}intersectManifoldClosestSilhouette(e,i,r){return n8(this._coordinateSystem,i,this._tmpCoordinateSystem),Ket(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,i,r){n8(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=it.get();return Qet(this._tmpCoordinateSystem,e,s)?ve(r,s):null}intersectInfiniteManifold(e,i,r){if(this.viewingMode===Xe.Global)return this.intersectManifold(e,i,r);n8(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=it.get();return v2(s.plane,e,n)?ve(r,n):null}toRenderCoords(e,i,r){return kz(e)?pl(e,i,this.spatialReference):Fo(e,i,r,this.spatialReference)}fromRenderCoords(e,i,r=null){return kz(i)?(r!=null&&(i.spatialReference=r),Yb(e,this.spatialReference,i)?i:null):Fo(e,this.spatialReference,i,r)?i:null}static create(e,i){switch(e){case Xe.Local:return new $K(Xe.Local,i,ec(i),Yet());case Xe.Global:return new $K(Xe.Global,i,1,Zet(i))}}static renderUnitScaleFactor(e,i){return Rue(e)/Rue(i)}};var Sg;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(Sg||(Sg={}));const m$t=(()=>{const t=new Array;return t[Sg.ELEVATION]=10,t[Sg.BASEMAP]=10,t[Sg.I3S_INDEX]=10,t[Sg.I3S_DATA]=10,t[Sg.SYMBOLOGY]=5,t})(),g$t=30;function y$t(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function _$t(t){return new Il({view:t})}const k_e=.1,t5=1,j9=1,v$t=.75,b$t=.6,U_e=1.3;let Il=class extends Ue{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new zNe,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0,this.addHandles(PS({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(t5),this._maxMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(e,i){return new lwt(e,this._cacheStorage,i)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();this._memoryPredicted<b$t&&this._canFastRecover?(this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(t5)):e?(this._memoryPredicted>1.1*j9||this._usedMemory>j9)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>k_e&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/U_e),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1)):(this._downscaleMemoryUsed=0,this._usedMemory>j9?(this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/U_e),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(this._usedMemory<v$t&&this._quality<t5?(this._stableQuality=this._quality,e=this._updateQuality(this._quality+.05)):this._quality<1&&(this._canFastRecover=!0))),this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,k_e),t5))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){var a,l,c,u,d;if(!this.view)return;(l=(a=this.view._stage)==null?void 0:a.renderer)==null||l.tick();const e=(u=(c=this.view._stage)==null?void 0:c.renderer)==null?void 0:u.usedMemory;let i=(((d=this.view.basemapTerrain)==null?void 0:d.usedMemory)??0)+(e?e.fbos+e.edges+e.plugins:0),r=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(f=>{if(y$t(f)){const m=f.ignoresMemoryFactor?this._quality:1;i+=f.usedMemory*m,r+=f.unloadedMemory*m}});const s=this._warnMemoryUsage==null||Math.round(10*i)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(i>n&&s){this._warnMemoryUsage=i;const f=g=>(g/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",m=Math.round(100*this._quality);se.getLogger(this).warn(`Memory Limit exceeded! Limit: ${f(n)} Current: ${f(i)} Projected: ${f(i+r)} Quality: ${m}%`)}this._usedMemory=i/n,this._memoryPredicted=(i+r)/n;const o=n-i;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){}};h([p({constructOnly:!0})],Il.prototype,"view",void 0),h([p()],Il.prototype,"maxMemory",null),h([p()],Il.prototype,"additionalCacheMemory",null),h([p({readOnly:!0})],Il.prototype,"memoryFactor",null),h([p({readOnly:!0})],Il.prototype,"updating",null),h([p({readOnly:!0})],Il.prototype,"usedMemory",null),h([p({readOnly:!0})],Il.prototype,"usedCacheMemory",null),h([p()],Il.prototype,"_quality",void 0),h([p()],Il.prototype,"_usedMemory",void 0),h([p()],Il.prototype,"_updating",void 0),h([p()],Il.prototype,"_stableQuality",void 0),h([p()],Il.prototype,"_maxMemory",void 0),h([p()],Il.prototype,"_additionalCacheMemory",void 0),Il=h([I("esri.views.3d.support.MemoryController")],Il);let w$t=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},x$t=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new T$t}},T$t=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},S$t=class{constructor(e,i,r,s){this._workerFunc=e,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=s.map(n=>new x$t(n))}destroy(){this._clients.length=0}hasQuota(e){const i=this._clients[e];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(e){const i=this._clients[e.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(r,s)=>this._taskCallback(r,s))):i.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const i=this._clients[e.client];this._totalNumWorkers--,i&&(i.numWorkers--,i.statistics.requests++,i.statistics.size+=e.size||0,i.statistics.duration+=e.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,vt(i.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,i){e._cancelled||(this._callbackFunc(e,i),this._taskFinished(e))}getStatsForType(e){const i=this._clients[e];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){}},E$t=class{constructor(e,i){this.element=e,this.type="image+type",this.isOpaque=i==="image/jpeg"}};function RC(t){return t!=null&&"type"in t&&t.type==="vector-tile"}function K5e(t){return t!=null&&"type"in t&&t.type==="raster-tile"}function eke(t){return t!=null&&"type"in t&&t.type==="tile-texture"}function J6(t){return t!=null&&"type"in t&&t.type==="image+type"}let IU=class extends Ue{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,i,r){this._loadQueue=new S$t((s,n)=>this._startLoading(s,n),(s,n)=>this._doneLoadingCB(s,n),e,i),r&&(this._frameTask=r.registerTask(It.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=$r(this._frameTask),this._tasks.forEach(e=>Jl(e.abortController)),this._loadQueue=qe(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,i,r,s={}){const n=aa();n.__signal=s!=null?s.signal:null;const o=this._createOrUpdateTask(e,i,r,s,n);return Ra(s,()=>this._cancelRequest(o,n)),n.promise}_createTask(e,i,r,s,n,o){const a=new A$t(e,i,r,s,n);return this._updateTask(a,o),this._tasks.set(n,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,i){var r;q3(e.resolvers,i),i.reject(ki()),e.resolvers.length===0&&(e.status===Sd.DOWNLOADING&&(e.status=Sd.CANCELLED,this._loadQueue.cancel(e),(r=e.abortController)==null||r.abort(),e.request=null,e.abortController=null),e.status=Sd.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,i){e.resolvers.push(i)}_createOrUpdateTask(e,i,r,s,n){const o=P$t((s==null?void 0:s.uid)||e,i,r),a=this._tasks.get(o);return a?(this._updateTask(a,n),a):this._createTask(e,s,i,r,o,n)}_doneLoadingCB(e,i){this._loadQueue&&(vt(e.status===Sd.DOWNLOADING),e.status=Sd.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:i}):this._doneLoading(e,i))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const i=this._onLoadQueue.shift();Dt(i.task.abortController),i.task.abortController=null,i.callback(i.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const i=this._doneQueue.shift();i.task.status!==Sd.DOWNLOADED&&(i.err=i.err||ki()),this._doneLoading(i.task,i.err),e.madeProgress()}}_doneLoading(e,i){if(i&&!os(i)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=J6(e.result)||e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const s of e.resolvers)if(i)os(i)?s.reject(i):s.reject(new G("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${i}`,{url:e.url,error:i}));else{--r;const n=r>0?ie(e.result):e.result;s.resolve(n)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,i){if(e.status===Sd.CANCELLED)return!1;let r,s;switch(e.startTime=performance.now(),e.status=Sd.DOWNLOADING,e.docType){case"binary":s="array-buffer",r=0;break;case"image":s="image";break;case"image+type":s="array-buffer";break;default:s="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=yr(e.url,{...e.options,responseType:s,timeout:r,signal:n});const o=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:i,task:e}):(e.abortController=null,i(e))},a=l=>{e.status===Sd.DOWNLOADING&&i(e,l)};return e.docType!=="image+type"?(e.request.then(l=>o(l.data),a),!0):(e.request.then(l=>{const c=l.data,u=M$t(c);if(s="image",e.size=c.byteLength,u==="unknown")return e.request=yr(e.url,{responseType:s,timeout:r,signal:n}),void e.request.then(m=>o(m.data),a);const d=new Blob([c],{type:u}),f=window.URL.createObjectURL(d);e.request=yr(f,{responseType:s,timeout:r,signal:n}),e.request.then(m=>o(new E$t(m.data,u)),a).finally(()=>window.URL.revokeObjectURL(f))},a),!0)}get test(){}};h([p({readOnly:!0})],IU.prototype,"updating",void 0),IU=h([I("esri.views.3d.support.StreamDataLoader")],IU);const C$t={numRetries:0};function M$t(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let A$t=class extends w$t{constructor(e,i,r,s,n){super(s),this.url=e,this.options=i,this.docType=r,this.key=n,this.result=null,this.status=Sd.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=C$t.numRetries}};function P$t(t,e,i){return`${t}:${e}:${i}`}var Sd;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(Sd||(Sd={}));let LU=class extends Ue{constructor(){super(...arguments),this.updating=!1}};function O$t(t){return new Bp({view:t})}h([p({readOnly:!0})],LU.prototype,"updating",void 0),LU=h([I("esri.views.3d.support.ResourceController.ResourceControllerMain")],LU);let Bp=class extends LU{constructor(){super(...arguments),this._immediateTask=ZA,this._normalTask=ZA,this._updatingObjects=Ug([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=SQe(),this._memoryController=_$t(this.view),this._streamDataLoader=new IU,this._streamDataLoader.setup(g$t,m$t,this._scheduler),this.addHandles([te(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},or),te(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=PS({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(It.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(It.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=$r(this._frameTask),this._streamDataLoader=qe(this._streamDataLoader),this._memoryController=qe(this._memoryController),this._scheduler=qe(this._scheduler),this.view=null}get updating(){var e,i,r,s;return!!((e=this._memoryController)!=null&&e.updating||(i=this._streamDataLoader)!=null&&i.updating||(r=this._immediateTask)!=null&&r.updating)||((s=this._updatingObjects)==null?void 0:s.value.some(n=>n.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const i=this._streamDataLoader;return{request:(r,s,n)=>i.request(r,s,e,n),get busy(){return!i.hasDownloadSlots(e)}}}addUpdatingObject(e){const i=this._updatingObjects;return i.value=[...i.value,e],Gi(()=>{i.value=i.value.filter(r=>r!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(Cie(e.deltaTime)),!this._scheduler)||(this._memoryController.update(),this._scheduler.updateBudget(e)&&this._scheduler.frame())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){}};h([p()],Bp.prototype,"view",void 0),h([p()],Bp.prototype,"_scheduler",void 0),h([p()],Bp.prototype,"_memoryController",void 0),h([p()],Bp.prototype,"_streamDataLoader",void 0),h([p()],Bp.prototype,"_immediateTask",void 0),h([p()],Bp.prototype,"_normalTask",void 0),h([p()],Bp.prototype,"_updatingObjects",void 0),h([p({readOnly:!0})],Bp.prototype,"updating",null),Bp=h([I("esri.views.3d.support.ResourceController")],Bp);var GL;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(GL||(GL={}));let roi=class{constructor(e,i=0,r=0,s=0,n=0,o=null){this.usedMemory=e,this.displayedFeatures=i,this.totalFeatures=r,this.maximumFeatures=s,this.nodes=n,this.core=o}};function R$t(t){return"performanceInfo"in t}let $$t=class{constructor(e){this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer;const i=e.performanceInfo;this.memory=i.usedMemory,this.displayedNumberOfFeatures=i.displayedFeatures,this.maximumNumberOfFeatures=i.maximumFeatures,this.totalNumberOfFeatures=i.totalFeatures}},I$t=class{constructor(e){var i,r,s,n;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,e.resourceController!=null){const o=e.resourceController.memoryController;this.totalMemory=(o.maxMemory??0)*GL.MEGABYTES,this.usedMemory=Math.round(o.usedMemory*this.totalMemory),this.quality=e.quality,this.load=e.resourceController.scheduler.load,this.cachedMemory=o.usedCacheMemory}this.terrainMemory=((i=e.basemapTerrain)==null?void 0:i.usedMemory)??0,this.edgesMemory=((r=e._stage)==null?void 0:r.renderer.usedMemory.edges)??0,this.fboMemory=((s=e._stage)==null?void 0:s.renderer.usedMemory.fbos)??0,(n=e.allLayerViews)==null||n.items.forEach(o=>{R$t(o)&&this.layerPerformanceInfos.push(new $$t(o))}),this.layerPerformanceInfos.sort((o,a)=>a.memory-o.memory)}},L$t=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,i,r){const s=r?`gltfPBR:${e}`:`gltf:${e}`,n=this._gltfMemCache.get(s);return n!=null?Promise.resolve(n):V_e(this._gltfLoading,this._gltfMemCache,s,o=>I4e(new R4e(o.streamDataRequester),e,o,r),i)}loadWOSR(e,i){const r=`wosr:${e}:${i.disableTextures}`,s=this._wosrMemCache.get(r);return s!=null?Promise.resolve(s):V_e(this._wosrLoading,this._wosrMemCache,r,n=>L4e(e,n),i)}};async function V_e(t,e,i,r,s){Dt(s);const n=Ra(s,()=>D$t(t,i));let o=t.get(i);if(o)o.refCount++;else{const a=new AbortController;o={refCount:1,abortController:a,promise:r({...s,signal:a.signal})},t.set(i,o)}try{const a=await o.promise;return e.put(i,a,a.size),t.delete(i),Dt(s),a}finally{$r(n)}}function D$t(t,e){const i=t.get(e);i!=null&&--i.refCount>0||(t.delete(e),i!=null&&i.abortController.abort())}let OM=class extends Ue{constructor(e,i){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(i==null?void 0:i.registerTask(It.TEXTURE_UNLOAD))??ZA}normalizeCtorArgs(){return{}}destroy(){var e,i,r;super.destroy(),(e=this._frameTask)==null||e.remove(),(i=this._textureRequests)==null||i.forEach(s=>this._releaseTextureRequest(s)),(r=this._textureRequests)==null||r.clear()}get updating(){return this._frameTask.updating}fromData(e,i){const r=this.makeUid(e);let s=this._textureRequests.get(r);if(!s){const n=new ike;n.texture=i(),this._stage&&(n.texture.load(this._stage.renderView.renderingContext),this._stage.add(n.texture)),this._textureRequests.set(r,n),s=n}return s.referenceCount++,new tke(r,s.texture,()=>this._release(r))}_release(e){const i=this._textureRequests.get(e);i?(i.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),i.referenceCount--,i.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){}_releaseNow(e){var r;if(!this._textureRequests)return;const i=this._textureRequests.get(e);!i||i.referenceCount>0||((r=i.texture)==null||r.unload(),this._releaseTextureRequest(i),this._textureRequests.delete(e))}_releaseTextureRequest(e){var i;e.texture?(i=this._stage)==null||i.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,i=null){return i!=null?`${e}.${i}px`:e}};h([p()],OM.prototype,"_frameTask",void 0),h([p()],OM.prototype,"updating",null),OM=h([I("esri.views.3d.support.TextureCollection")],OM);let tke=class{constructor(e,i,r){this.uid=e,this.texture=i,this.release=r}},ike=class{constructor(){this.referenceCount=0}},N$t=class extends OM{constructor(e,i,r){super(i,r),this._streamDataRequester=e}async fromUrl(e,i,r){Dt(r);const s=r==null?void 0:r.signal,n=this.makeUid(e,i);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:n,signal:a.signal});o=new ike,o.abortController=a;const c=o;this._textureRequests.set(n,o),o.textureAsync=l.then(async u=>{const d=this._createTexture(e,u,i);return c.texture=d,c.abortController=null,await d.load(this._stage.renderView.renderingContext),this._stage.add(d),new tke(n,d,()=>this._release(n))},u=>{throw c.abortController=null,u})}o.referenceCount++;try{return await Sie(o.textureAsync,s)}catch(a){throw this._release(n),a}}_createTexture(e,i,r){var n;const s={width:i.width,height:i.height,wrap:{s:Mi.CLAMP_TO_EDGE,t:Mi.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(v2e(e)){if(r||i.width===0&&i.height===0){const o=i.width?i.height/i.width:1;r=r||64,o>1?(i.width=Math.round(r/o),i.height=r):(i.width=r,i.height=Math.round(r*o))}(n=this._stage.renderView)!=null&&n.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return new Vb(i,s)}},F$t=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(Sg.SYMBOLOGY),this.objectResourceCache=new L$t((r,s)=>e.resourceController.memoryController.newCache(r,s)),this.textures=new N$t(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const i=_r(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=w3e(e.viewingMode,i),this.screenSizePerspectiveSettingsLabels=cgt(e.viewingMode,i)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return Gi();this._graphicsOwners.push(e);const i=te(()=>{var r;return(r=e.layer)==null?void 0:r.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Gi(()=>{i.remove(),q3(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(i=>{var r;return((r=i.layer)==null?void 0:r.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new ly;const i=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([te(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,i,or),this._viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=qe(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;i5.distance=e.centerOnSurfaceInfrequent.distance,i5.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(i5),this.screenSizePerspectiveSettingsLabels.update(i5),this._view._stage.renderView.requestRender()}get test(){}};const i5={distance:0,fovY:0};let $C=class{constructor(e,i,r=""){this.graphics=e,this._symbol=new Ag({symbolLayers:new st([new z1({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new M2({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})])})}show(e,i){if(i==null)return;this.hide();const r=new bt({x:e[0],y:e[1],z:e[2],spatialReference:i});this._graphic=new ca({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},O1=class extends Ue{constructor(e){super(e)}};h([p({constructOnly:!0})],O1.prototype,"renderCoordsHelper",void 0),h([p({constructOnly:!0})],O1.prototype,"surface",void 0),h([p({constructOnly:!0})],O1.prototype,"state",void 0),O1=h([I("esri.views.3d.support.pointsOfInterest.PointOfInterest")],O1);const k$t=Array;let jp=class extends O1{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new u_({location:bt,renderLocation:k$t},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=E(),this._tmpPoint=new bt}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.addHandles(Ks(()=>{var i,r;return(r=(i=this.map)==null?void 0:i.ground)==null?void 0:r.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=qe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get scale(){const e=this._camera,i=Cr(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return Pb(r,i,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){var s;if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!((s=this.map)!=null&&s.ground))return this._updateSurfaceAltitude(0),na;const e=this.state.spatialReference;this._tmpPoint.spatialReference=e,this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);const i=(this._tmpPoint.z??0)>U$t&&this.renderCoordsHelper.viewingMode===Xe.Global&&(e.isWGS84||e.isWebMercator);let r=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:i?V$t:0}).then(n=>this._updateSurfaceAltitude(n.geometry.z??0)).catch(n=>{os(n)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===r&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),r=null}),this._pendingElevationQueryController=r,na}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(G9,this._estimatedSurfaceAltitude,this._camera.eye),$o(this._get("renderLocation"),G9)||(this._set("renderLocation",ve(this._propertiesPool.get("renderLocation"),G9)),this.notifyChange("renderLocation"))}};h([p({constructOnly:!0})],jp.prototype,"scheduler",void 0),h([p({constructOnly:!0})],jp.prototype,"cache",void 0),h([p({constructOnly:!0})],jp.prototype,"task",void 0),h([p()],jp.prototype,"location",null),h([p({constructOnly:!0})],jp.prototype,"map",void 0),h([p()],jp.prototype,"renderLocation",void 0),h([p()],jp.prototype,"scale",null),h([p()],jp.prototype,"updating",null),jp=h([I("esri.views.3d.support.pointsOfInterest.CameraOnSurface")],jp);const G9=E(),U$t=1e5,V$t=1e6,z$t=Array;let Ed=class extends O1{constructor(e){super(e),this._propertiesPool=new u_({location:bt,renderLocation:z$t},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=E(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=$r(this._frameWorker),this._propertiesPool=qe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,na}_updateRenderLocation(){const e=j$t;let i=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!i&&r&&(i=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),i&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=G$t;i&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,s)&&(ve(e,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),i?this.distance=Cr(this._camera.eye,e):(he(e,this._camera.viewForward,this._get("distance")),Ee(e,e,this._camera.eye)),$o(this._get("renderLocation"),e)||this._set("renderLocation",ve(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,i){var s,n;const r=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(r.ray,e,i))return!1;if(this.state.isGlobal){const o=_r(this.renderCoordsHelper.spatialReference).radius,a=o+e,l=sl(r.eye),c=l<a*a,u=Cr(r.eye,i);if(c&&u>o/4){const d=a-Math.sqrt(l);return he(i,r.viewForward,d),Ee(i,i,r.eye),!0}}else{const o=(s=this.surface)!=null&&s.ready?this.surface.extent:null;o!=null&&fG(o,(n=this.surface)==null?void 0:n.spatialReference,wR,this.renderCoordsHelper.spatialReference)&&(i[0]=Ne(i[0],wR[0],wR[2]),i[1]=Ne(i[1],wR[1],wR[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,i){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,i)){if(Nr.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,s=Cr(r,e),n=Cr(r,i);if(Math.abs(n-s)/s>B$t)return!0}return!1}};h([p({constructOnly:!0})],Ed.prototype,"scheduler",void 0),h([p({constructOnly:!0})],Ed.prototype,"task",void 0),h([p()],Ed.prototype,"distance",void 0),h([p({constructOnly:!0})],Ed.prototype,"estimateSurfaceAltitudeAtCenter",void 0),h([p({readOnly:!0})],Ed.prototype,"location",null),h([p({readOnly:!0})],Ed.prototype,"renderLocation",void 0),h([p()],Ed.prototype,"updating",void 0),Ed=h([I("esri.views.3d.support.pointsOfInterest.CenterOnSurface")],Ed);const B$t=.05,j$t=E(),G$t=E(),wR=oi();let H$t=class{constructor(e){this._handles=new ly,this.events=new Us,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=qe(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),e.removed.forEach(i=>this._handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",q$t)}};const q$t={},W$t=Array;let Gp=class extends O1{constructor(e){super(e),this._propertiesPool=new u_({location:bt,renderLocation:W$t},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([te(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),te(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.addHandles(this.scheduler.registerTask(It.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=qe(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get worldUnitsPerContentPixel(){const{camera:e,contentPixelRatio:i}=this.state;return e.computeRenderPixelSizeAt(this.renderLocation)*(e.pixelRatio/i)}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),i=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(i,z_e);const n=Math.max(0,(Math.acos(Te(z_e,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!US(e,i)){const c=this._propertiesPool.get("renderLocation");ve(c,i),this._set("renderLocation",c)}return na}const o=1-Ne(n/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(B_e);const l=this._propertiesPool.get("renderLocation");return xr(l,i,B_e,a),e&&US(e,l)||this._set("renderLocation",l),na}_calculateScreenHorizontalEdgeOnSurface(e){const i=this.state.contentCamera,r=i.getRenderCenter(Pa());if(r[1]=i.aboveGround?i.padding[gi.BOTTOM]:i.fullHeight-i.padding[gi.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(i.unprojectFromRenderScreen(r,xR)){Re(xR,xR,i.eye);const n=Ce(xR,xR);if(this.renderCoordsHelper.intersectInfiniteManifold(jh(i.eye,n),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,i.eye)}updateRenderLocation(){this._dirty=!0}};h([p()],Gp.prototype,"_dirty",void 0),h([p({constructOnly:!0})],Gp.prototype,"scheduler",void 0),h([p({constructOnly:!0})],Gp.prototype,"centerOnSurface",void 0),h([p({constructOnly:!0})],Gp.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),h([p()],Gp.prototype,"updating",null),h([p()],Gp.prototype,"location",null),h([p()],Gp.prototype,"renderLocation",void 0),h([p()],Gp.prototype,"worldUnitsPerContentPixel",null),Gp=h([I("esri.views.3d.support.pointsOfInterest.Focus")],Gp);const z_e=E(),xR=E(),B_e=E();let o0=class extends Ue{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=E();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([te(()=>{var e,i;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(i=this.surfaceView)==null?void 0:i.extent]},()=>this._update()),Ks(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}_update(){var r;if(this._updateController&&(this._updateController.abort(),this._updateController=null),((r=this.surfaceView)==null?void 0:r.extent)==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=yre(this.surfaceView.extent),i=new bt({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(i,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(s=>{this._updateController=null,this._set("location",s.geometry)}).catch(s=>{})):this._set("location",i)}};h([p({constructOnly:!0})],o0.prototype,"view",void 0),h([p({constructOnly:!0})],o0.prototype,"cache",void 0),h([p()],o0.prototype,"surface",null),h([p()],o0.prototype,"surfaceView",null),h([p({readOnly:!0})],o0.prototype,"location",void 0),h([p({readOnly:!0})],o0.prototype,"renderLocation",null),o0=h([I("esri.views.3d.support.pointsOfInterest.StableSurfaceCenter")],o0);let a0=class extends Ue{constructor(e){super(e),this._tileGeometryUpdateExtent=zh(),this._tileGeometryUpdateSpatialReference=null,this.events=new Us,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(It.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",Z$t),zh(this._tileGeometryUpdateExtent),this._set("updating",!1)),na}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,Q1(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let i=1;i<this.centerOnSurfaces.length;i++){const r=this.centerOnSurfaces[i];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,i){const r=this.state.contentCamera.eye,s=Y$t,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,Yw,i),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,Xw,i),Yw[0]<Xw[0]?(s[0]=Yw[0],s[2]=Xw[0]):(s[0]=Xw[0],s[2]=Yw[0]),Yw[1]<Xw[1]?(s[1]=Yw[1],s[3]=Xw[1]):(s[1]=Xw[1],s[3]=Yw[1]),oG(s,e)}};h([p({constructOnly:!0})],a0.prototype,"state",void 0),h([p({constructOnly:!0})],a0.prototype,"centerOnSurfaces",void 0),h([p({constructOnly:!0})],a0.prototype,"renderCoordsHelper",void 0),h([p({constructOnly:!0})],a0.prototype,"scheduler",void 0),h([p({constructOnly:!0})],a0.prototype,"surface",void 0),h([p({readOnly:!0})],a0.prototype,"updating",void 0),a0=h([I("esri.views.3d.support.pointsOfInterest.SurfaceGeometryUpdates")],a0);const Z$t={},Yw=E(),Xw=E(),Y$t=zh();let Cc=class extends Ue{constructor(e){super(e),this.renderPointOfView=E(),this._pois=new Array,this._debugCenters=new Map,this._tmpRay=lo(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new u_({renderPointOfView:X$t},this)}initialize(){var u;const{state:e,basemapTerrain:i,renderCoordsHelper:r,map:s}=this.view;this._surfaceIntersector=ip(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=oa.MIN,this._contentIntersector=ip(e.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=(u=this.view.basemapTerrain)==null?void 0:u.elevationQueryCache,l={state:e,scheduler:o,surface:i,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new Ed({...l,task:It.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new Ed({...l,task:It.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new Ed({...l,task:It.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new jp({...l,cache:a,task:It.POINT_OF_INTEREST_INFREQUENT,map:s})),this._set("surfaceGeometryUpdates",new a0({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new H$t({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new o0({cache:a,view:this.view})),this._set("focus",new Gp({state:e,scheduler:o,surface:i,renderCoordsHelper:r,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(d,f)=>this._estimateSurfaceIntersectionAtRenderPoint(d,this.view.state.contentCamera,f)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new $C(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new $C(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new $C(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new $C(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new $C(c,"green","Focus")),this.addHandles([te(()=>e.contentCamera,d=>this._cameraChanged(d),or),te(()=>i.extent,()=>this._updateCenterPointsOfInterest()),No(()=>!i.updating,()=>this._updateCenterPointsOfInterest(),or),Ks(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),Ks(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),No(()=>Nr.SHOW_POI,d=>this._setDebug(d),$t)]),this._cameraChanged(this.view.state.contentCamera);for(const d of this._pois)d.runTask()}destroy(){this._setDebug(!1),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(i=>i.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,RE,Q$t)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(RE):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const i=e.origin,r=Ee(RE,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,i,r),this._surfaceIntersector.results.min.getIntersectionPoint(RE)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(RE)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,i,r){const s=Pne(i,e,J$t);if(s==null)return null;const n=s.origin,o=Ee(RE,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,i),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,o),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const i=e.eye;$o(this.renderPointOfView,i)||this._set("renderPointOfView",ve(this._propertiesPool.get("renderPointOfView"),i))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(i=>i.hide()),void this.removeHandles("debug");for(const i of this._pois)this.addHandles(te(()=>i.renderLocation,r=>{var s;return(s=this._debugCenters.get(i))==null?void 0:s.show(r,i.renderCoordsHelper.spatialReference)},$t),"debug")}get test(){}};h([p()],Cc.prototype,"centerOnContent",void 0),h([p()],Cc.prototype,"centerOnSurfaceFrequent",void 0),h([p()],Cc.prototype,"centerOnSurfaceInfrequent",void 0),h([p()],Cc.prototype,"cameraOnSurface",void 0),h([p()],Cc.prototype,"focus",void 0),h([p()],Cc.prototype,"renderPointOfView",void 0),h([p()],Cc.prototype,"surfaceOrigin",void 0),h([p()],Cc.prototype,"contentGeometryUpdates",void 0),h([p()],Cc.prototype,"surfaceGeometryUpdates",void 0),h([p({constructOnly:!0})],Cc.prototype,"view",void 0),h([p()],Cc.prototype,"updating",null),Cc=h([I("esri.views.3d.support.pointsOfInterest.PointsOfInterest")],Cc);const X$t=Array,RE=E(),J$t=lo(),Q$t={exclude:new Set([Ab])};let K$t=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,i){this._store.put(e,i,i.values.byteLength+256)}};function bS(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function rke(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function eIt(t,e,i,r,s,n,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=r,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function tIt(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:rke,create:bS,createView:tIt,fromValues:eIt},Symbol.toStringTag,{value:"Module"}));var gu,j_e,G_e;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(gu||(gu={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(j_e||(j_e={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(G_e||(G_e={}));let y_=class Yx{static getId(e,i,r,s){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${i}/${r}/${s}`}constructor(e,i,r,s){this.set(e,i,r,s)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(e){this.set(e)}get hash(){const e=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|e<<8|r}acquire(e,i,r,s){this.set(e,i,r,s)}contains(e){const i=e.level-this.level;return i>=0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}containsChild(e){const i=e.level-this.level;return i>0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new Yx(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,i,r,s){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[n,o,a,l]=e.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+i,this.col=+r,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new Yx(this.level-1,this.row>>1,this.col>>1,this.world)}getNeighborId(e,i){return`${this.level}/${this.row+i}/${this.col+e}/${this.world}`}getChildKeys(){const e=this.level+1,i=this.row<<1,r=this.col<<1,s=this.world;return[new Yx(e,i,r,s),new Yx(e,i,r+1,s),new Yx(e,i+1,r,s),new Yx(e,i+1,r+1,s)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};y_.pool=new la(y_,null,null,25,50);function wv(t,e){return[t,e]}function Jw(t,e,i){return t[0]=e,t[1]=i,t}function iIt(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}const Mp=new y_("0/0/0/0");let rIt=class ske{static create(e,i,r=null){const s=Fg(e.spatialReference),n=i.origin||wv(e.origin.x,e.origin.y),o=wv(e.size[0]*i.resolution,e.size[1]*i.resolution),a=wv(-1/0,-1/0),l=wv(1/0,1/0),c=wv(1/0,1/0);r!=null&&(Jw(a,Math.max(0,Math.floor((r.xmin-n[0])/o[0])),Math.max(0,Math.floor((n[1]-r.ymax)/o[1]))),Jw(l,Math.max(0,Math.floor((r.xmax-n[0])/o[0])),Math.max(0,Math.floor((n[1]-r.ymin)/o[1]))),Jw(c,l[0]-a[0]+1,l[1]-a[1]+1));const{cols:u,rows:d}=i;let f,m,g,y;return!r&&u&&d&&(Jw(a,u[0],d[0]),Jw(l,u[1],d[1]),Jw(c,u[1]-u[0]+1,d[1]-d[0]+1)),e.isWrappable?(f=wv(Math.ceil(Math.round((s.valid[1]-s.valid[0])/i.resolution)/e.size[0]),c[1]),m=wv(Math.floor((s.origin[0]-n[0])/o[0]),a[1]),g=wv(f[0]+m[0]-1,l[1]),y=!0):(m=a,g=l,f=c,y=!1),new ske(i.level,i.resolution,i.scale,n,a,l,c,o,m,g,f,y)}constructor(e,i,r,s,n,o,a,l,c,u,d,f){this.level=e,this.resolution=i,this.scale=r,this.origin=s,this.first=n,this.last=o,this.size=a,this.norm=l,this.worldStart=c,this.worldEnd=u,this.worldSize=d,this.wrap=f}normalizeCol(e){if(!this.wrap)return e;const i=this.worldSize[0];return e<0?i-1-Math.abs((e+1)%i):e%i}denormalizeCol(e,i){return this.wrap?this.worldSize[0]*i+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){return this.origin[0]+e*this.norm[0]}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,i,r=!1){Mp.set(i);const s=r?Mp.col:this.denormalizeCol(Mp.col,Mp.world),n=Mp.row;return iIt(e,this.getXForColumn(s),this.getYForRow(n+1),this.getXForColumn(s+1),this.getYForRow(n)),e}getTileCoords(e,i,r=!1){Mp.set(i);const s=r?Mp.col:this.denormalizeCol(Mp.col,Mp.world);return Array.isArray(e)?Jw(e,this.getXForColumn(s),this.getYForRow(Mp.row)):(e.x=this.getXForColumn(s),e.y=this.getYForRow(Mp.row)),e}},IK=class{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}*keys(){const e=this.lodInfo;for(const{row:i,colFrom:r,colTo:s}of this.spans)for(let n=r;n<=s;n++){const o=e.getWorldForColumn(n);yield new y_(e.level,i,e.normalizeCol(n),o)}}forEach(e,i){const{spans:r,lodInfo:s}=this,{level:n}=s;if(r.length!==0)for(const{row:o,colFrom:a,colTo:l}of r)for(let c=a;c<=l;c++)e.call(i,n,o,s.normalizeCol(c),s.getWorldForColumn(c))}};IK.pool=new la(IK);let H9=class{constructor(e,i,r){this.row=e,this.colFrom=i,this.colTo=r}};const en=new y_("0/0/0/0");let sIt=class nke{static create(e,i){e[1]>i[1]&&([e,i]=[i,e]);const[r,s]=e,[n,o]=i,a=n-r,l=o-s,c=l!==0?a/l:0,u=(Math.ceil(s)-s)*c,d=(Math.floor(s)-s)*c;return new nke(r,Math.floor(s),Math.ceil(o),c,a<0?u:d,a<0?d:u,a<0?n:r,a<0?r:n)}constructor(e,i,r,s,n,o,a,l){this.x=e,this.ymin=i,this.ymax=r,this.invM=s,this.leftAdjust=n,this.rightAdjust=o,this.leftBound=a,this.rightBound=l}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const qu=[[0,0],[0,0],[0,0],[0,0]],nIt=1e-6;let Eoi=class{constructor(e,i=null,r=e.lods[0].level,s=e.lods[e.lods.length-1].level){this.tileInfo=e,this.fullExtent=i,this.scales=[],this._infoByScale={},this._infoByLevel={};const n=e.lods.filter(a=>a.level>=r&&a.level<=s);this.minScale=n[0].scale,this.maxScale=n[n.length-1].scale;const o=this._lodInfos=n.map(a=>rIt.create(e,a,i));n.forEach((a,l)=>{this._infoByLevel[a.level]=o[l],this._infoByScale[a.scale]=o[l],this.scales[l]=a.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel[typeof e=="number"?e:e.level]}getTileBounds(e,i,r=!1){en.set(i);const s=this._infoByLevel[en.level];return s?s.getTileBounds(e,en,r):e}getTileCoords(e,i,r=!1){en.set(i);const s=this._infoByLevel[en.level];return s?s.getTileCoords(e,en,r):e}getTileCoverage(e,i=192,r=!0,s="closest"){if(!r&&(e.scale>this.minScale||e.scale<this.maxScale))return null;const n=s==="closest"?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),o=IK.pool.acquire(n),a=this._wrap;let l,c,u,d=1/0,f=-1/0;const m=o.spans;qu[0][0]=qu[0][1]=qu[1][1]=qu[3][0]=-i,qu[1][0]=qu[2][0]=e.size[0]+i,qu[2][1]=qu[3][1]=e.size[1]+i;for(const b of qu)e.toMap(b,b),b[0]=n.getColumnForX(b[0]),b[1]=n.getRowForY(b[1]);const g=[];let y=3;for(let b=0;b<4;b++){if(qu[b][1]===qu[y][1]){y=b;continue}const w=sIt.create(qu[b],qu[y]);d=Math.min(w.ymin,d),f=Math.max(w.ymax,f),g[w.ymin]===void 0&&(g[w.ymin]=[]),g[w.ymin].push(w),y=b}if(d==null||f==null||f-d>100)return null;let v=[];for(l=d;l<f;){g[l]!=null&&(v=v.concat(g[l])),c=1/0,u=-1/0;for(let b=v.length-1;b>=0;b--){const w=v[b];c=Math.min(c,w.getLeftCol()),u=Math.max(u,w.getRightCol())}if(c=Math.floor(c),u=Math.floor(u),l>=n.first[1]&&l<=n.last[1])if(a)if(n.size[0]<n.worldSize[0]){const b=Math.floor(u/n.worldSize[0]);for(let w=Math.floor(c/n.worldSize[0]);w<=b;w++)m.push(new H9(l,Math.max(n.getFirstColumnForWorld(w),c),Math.min(n.getLastColumnForWorld(w),u)))}else m.push(new H9(l,c,u));else c>n.last[0]||u<n.first[0]||(c=Math.max(c,n.first[0]),u=Math.min(u,n.last[0]),m.push(new H9(l,c,u)));l+=1;for(let b=v.length-1;b>=0;b--){const w=v[b];w.ymax>=l?w.incrRow():v.splice(b,1)}}return o}getTileParentId(e){en.set(e);const i=this._infoByLevel[en.level],r=this._lodInfos.indexOf(i)-1;return r<0?null:(this._getTileIdAtLOD(en,this._lodInfos[r],en),en.id)}getTileResolution(e){const i=this._infoByLevel[typeof e=="object"?e.level:e];return i?i.resolution:-1}getTileScale(e){const i=this._infoByLevel[e.level];return i?i.scale:-1}intersects(e,i){en.set(i);const r=this._infoByLevel[en.level],s=e.lodInfo;if(s.resolution>r.resolution){this._getTileIdAtLOD(en,s,en);const o=s.denormalizeCol(en.col,en.world);for(const a of e.spans)if(a.row===en.row&&a.colFrom<=o&&a.colTo>=o)return!0}if(s.resolution<r.resolution){const[o,a,l,c]=e.spans.reduce((y,v)=>(y[0]=Math.min(y[0],v.row),y[1]=Math.max(y[1],v.row),y[2]=Math.min(y[2],v.colFrom),y[3]=Math.max(y[3],v.colTo),y),[1/0,-1/0,1/0,-1/0]),u=r.denormalizeCol(en.col,en.world),d=s.getColumnForX(r.getXForColumn(u)),f=s.getRowForY(r.getYForRow(en.row)),m=s.getColumnForX(r.getXForColumn(u+1))-1,g=s.getRowForY(r.getYForRow(en.row+1))-1;return!(d>c||m<l||f>a||g<o)}const n=s.denormalizeCol(en.col,en.world);return e.spans.some(o=>o.row===en.row&&o.colFrom<=n&&o.colTo>=n)}normalizeBounds(e,i,r){if(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],this._wrap){const s=Fg(this.tileInfo.spatialReference),n=-r*(s.valid[1]-s.valid[0]);e[0]+=n,e[2]+=n}return e}getSmallestInfoForScale(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>i[0])return this._infoByScale[i[0]];for(let r=1;r<i.length-1;r++)if(e>i[r]+nIt)return this._infoByScale[i[r-1]];return this._infoByScale[i[i.length-1]]}getClosestInfoForScale(e){const i=this.scales;return this._infoByScale[e]||(e=i.reduce((r,s)=>Math.abs(s-e)<Math.abs(r-e)?s:r,i[0])),this._infoByScale[e]}scaleToLevel(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let r=i.length-1;r>=0;r--)if(e<i[r])return r===i.length-1?this._infoByScale[i[i.length-1]].level:this._infoByScale[i[r]].level+(i[r]-e)/(i[r]-i[r+1]);return this._infoByScale[i[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}zoomToScale(e){return this.tileInfo.zoomToScale(e)}_getTileIdAtLOD(e,i,r){const s=this._infoByLevel[r.level];return e.set(r),i.resolution<s.resolution?null:(i.resolution===s.resolution||(e.level=i.level,e.col=Math.floor(r.col*s.resolution/i.resolution+.01),e.row=Math.floor(r.row*s.resolution/i.resolution+.01)),e)}},oIt=class{constructor(e,i){this.item=e,this.controller=i,this.promise=null}},aIt=class{constructor(e){this._schedule=null,this._task=null,this._deferreds=new Kk,this._controllers=new Kk,this._processingItems=new Kk,this._pausedSignal=Ug(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new Ez(e.peeker),this.process=e.process;const i=e.scheduler;e.priority&&i&&(this._task=i.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=$r(this._schedule),this._task=$r(this._task)}get updating(){var e;return!!((e=this._task)!=null&&e.updating)||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){const i=this._controllers.get(e);i&&i.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(i=>e.push(i)),this._controllers.clear(),e.forEach(i=>i.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((i,r)=>e(r))}get(e){const i=this._deferreds.get(e);return i?i.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,i){const r=this.get(e);if(r)return r;const s=new AbortController;let n=null;i&&(n=Ra(i,()=>s.abort()));const o=()=>{const u=this._processingItems.get(e);u&&u.controller.abort(),a(),c.reject(ki())},a=()=>{l.remove(),n!=null&&n.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},l=oD(s.signal,o),c=aa();return this._deferreds.set(e,c),this._controllers.set(e,s),c.promise.then(a,a),this._queue.push(e),this._scheduleNext(),c.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){var i;const e=this._queue.popLast();return e&&((i=this._deferreds.get(e))==null||i.reject(ki("Removed from queue")),this._removeItem(e)),e}reset(){const e=[];this._processingItems.forEach(i=>e.push(i)),this._processingItems.clear();for(const i of e)this._queue.push(i.item),i.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=p2(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(i))}_processError(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(i))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(e==null)return;let i;const r=new AbortController,s=new oIt(e,r);this._processingItems.set(e,s);try{i=this.process(e,r.signal)}catch(n){this._processError(s,n)}Fu(i)?(s.promise=i,i.then(n=>this._processResult(s,n),n=>this._processError(s,n))):this._processResult(s,i)}get test(){}};function lIt(t,e){return t.length=0,e.forEach(i=>t.push(i)),t}const q9=new Set,r5=[],$E=new Map,H_e=[0,0];let Qw=class extends Ue{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:i,strategy:r}=this;this._queue=new aIt({concurrency:e,process:(s,n)=>{const o=this._keyToItem.get(s);return i(o,{signal:n})},peeker:r==="scale-first"?s=>this._peekByScaleFirst(s):s=>this._peekByCenterFirst(s)})}destroy(){this.clear(),this._queue=qe(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}abort(e){const i=typeof e=="string"?e:e.id;this._queue.abort(i)}clear(){this._queue.clear(),this._keyToItem.clear()}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const i=typeof e=="string"?e:e.id;return this.has(i)&&this._queue.isOngoing(i)}pause(){this._queue.pause()}push(e){const i=e.key.id;if(this._queue.has(i))return this._queue.get(i);const r=this._queue.push(i),s=()=>{this._keyToItem.delete(i)};return this._keyToItem.set(i,e),r.then(s,s),r}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView;let r=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;e.forEach(u=>{const d=this._keyToItem.get(u),f=this.tileInfoView.getTileScale(d.key);$E.has(f)||($E.set(f,[]),r=Math.max(f,r),s=Math.min(f,s)),$E.get(f).push(d.key),q9.add(f)});let n=this.state.scale;$E.has(n)||(lIt(r5,q9),r5.sort((u,d)=>u-d),n=r5.reduce((u,d)=>Math.abs(d-n)<Math.abs(u-n)?d:u,r5[0])),n=Math.min(n,r),n=Math.max(n,s);const o=$E.get(n),a=i.getClosestInfoForScale(n),l=a.getColumnForX(this.state.center[0]),c=a.getRowForY(this.state.center[1]);return o.sort((u,d)=>{const f=a.denormalizeCol(u.col,u.world),m=a.denormalizeCol(d.col,d.world);return Math.sqrt((l-f)*(l-f)+(c-u.row)*(c-u.row))-Math.sqrt((l-m)*(l-m)+(c-d.row)*(c-d.row))}),q9.clear(),$E.clear(),o[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView,r=this.state.center;let s,n=Number.POSITIVE_INFINITY;return e.forEach(o=>{const a=this._keyToItem.get(o);i.getTileCoords(H_e,a.key);const l=Ob(H_e,r);l<n&&(n=l,s=a.key)}),s.id}};h([p({constructOnly:!0})],Qw.prototype,"concurrency",void 0),h([p({constructOnly:!0})],Qw.prototype,"process",void 0),h([p()],Qw.prototype,"state",void 0),h([p({constructOnly:!0})],Qw.prototype,"strategy",void 0),h([p({constructOnly:!0})],Qw.prototype,"tileInfoView",void 0),Qw=h([I("esri.views.2d.tiling.TileQueue")],Qw);new y_(0,0,0,0);let cIt=class{constructor(e,i){this.sourceTile=i,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},uIt=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function q_e(t,e,i,r,s,n){const o=i-s;if(o>=0)return(e>>o)+(r-(n<<o))*(t>>o);const a=-o;return e-(n-(r<<a))*(t>>a)<<a}let oke=class{constructor(e,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(e/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(e,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(e,i,r,s){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function hIt(t,e,i,r,s,n,o){const a=e[r++];for(let l=0;l<a;l++){const c=new cIt(n,o);c.xTile=e[r++],c.yTile=e[r++],c.hash=e[r++],c.priority=e[r++],c.featureIndex=e[r++];const u=e[r++];for(let m=0;m<u;m++){const g=e[r++],y=e[r++],v=e[r++],b=e[r++],w=!!e[r++],x=e[r++],S=i[r++],C=i[r++],M=e[r++],O=e[r++];c.colliders.push({xTile:g,yTile:y,dxPixels:v,dyPixels:b,hard:w,partIndex:x,width:M,height:O,minLod:S,maxLod:C})}const d=t[r++];for(let m=0;m<d;m++)c.textVertexRanges.push([t[r++],t[r++]]);const f=t[r++];for(let m=0;m<f;m++)c.iconVertexRanges.push([t[r++],t[r++]]);s.push(c)}return r}function dIt(t,e,i){for(const[r,s]of t.symbols)pIt(t,e,i,s,r)}function pIt(t,e,i,r,s){const n=t.layerData.get(s);if(n.type===gu.SYMBOL){for(const o of r){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0];c.startOpacity;const u=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&u===0;const d=u?255:0;l=d<<24|d<<16|d<<8|d}else l=0;for(const[c,u]of o.iconVertexRanges)for(let d=c;d<c+u;d+=4)n.iconOpacity[d/4]=l;if(o.selectedForRendering){const c=a.parts[1];c.startOpacity;const u=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&u===0;const d=u?255:0;l=d<<24|d<<16|d<<8|d}else l=0;for(const[c,u]of o.textVertexRanges)for(let d=c;d<c+u;d+=4)n.textOpacity[d/4]=l}n.lastOpacityUpdate=e,n.opacityChanged=!0}}function fIt(t,e,i,r){const s=t.colliders;let n,o,a,l;for(const c of s)if(t.unique.show&&t.unique.parts[c.partIndex].show&&(n=c.xScreen-r[0]+c.dxScreen,o=c.yScreen-r[1]+c.dyScreen,a=n+c.width,l=o+c.height,FSt(i,e.x,e.y,n,o,a,l)))return!0;return!1}let Q6=class{constructor(e,i){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let r=1;const s=new Uint32Array(e);this.layerUIDs=[];const n=s[r++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},mIt=class extends Q6{constructor(e,i){super(e,i),this.type=gu.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.lineIndexStart=r[s++],this.lineIndexCount=r[s++];const n=r[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=r[s++],l=r[s++],c=r[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){var e,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((i=this.vao)==null?void 0:i.usedMemory)??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=Ut(this.vao)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++],a=Sr.createVertex(e,cr.STATIC_DRAW,new Int32Array(n.buffer,4*r,o));r+=o;const l=s[r++],c=Sr.createIndex(e,cr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l));r+=l;const u=this.layer.lineMaterial;this.vao=new Jf(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}},gIt=class extends Q6{constructor(e,i){super(e,i),this.type=gu.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.fillIndexStart=r[s++],this.fillIndexCount=r[s++],this.outlineIndexStart=r[s++],this.outlineIndexCount=r[s++];const n=r[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=r[s++],l=r[s++],c=r[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){var e,i,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((i=this.fillVAO)==null?void 0:i.usedMemory)??0)+(((r=this.outlineVAO)==null?void 0:r.usedMemory)??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=Ut(this.fillVAO),this.outlineVAO=Ut(this.outlineVAO)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++],a=Sr.createVertex(e,cr.STATIC_DRAW,new Int32Array(n.buffer,4*r,o));r+=o;const l=s[r++],c=Sr.createIndex(e,cr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l));r+=l;const u=s[r++],d=Sr.createVertex(e,cr.STATIC_DRAW,new Int32Array(n.buffer,4*r,u));r+=u;const f=s[r++],m=Sr.createIndex(e,cr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,f));r+=f;const g=this.layer,y=g.fillMaterial,v=g.outlineMaterial;this.fillVAO=new Jf(e,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:a},c),this.outlineVAO=new Jf(e,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:d},m)}},yIt=class extends Q6{constructor(e,i,r){super(e,i),this.type=gu.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(e),n=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++],c=s[a++],u=s[a++],d=new y_(l,c,u,0),f=s[a++];for(let v=0;v<f;v++){const b=s[a++],w=s[a++],x=s[a++];this.iconPerPageElementsMap.set(b,[w,x])}const m=s[a++];for(let v=0;v<m;v++){const b=s[a++],w=s[a++],x=s[a++];this.glyphPerPageElementsMap.set(b,[w,x])}const g=s[a++],y=s[a++];this.iconOpacity=new Int32Array(g),this.textOpacity=new Int32Array(y),a=hIt(s,n,o,a,this.symbols,r,d),this.bufferDataOffset=a}get memoryUsed(){var e,i,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((i=this.iconVAO)==null?void 0:i.usedMemory)??0)+(((r=this.textVAO)==null?void 0:r.usedMemory)??0)+pb(this.iconOpacity)+pb(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[i,r]of this.iconPerPageElementsMap)e+=r[1];for(const[i,r]of this.glyphPerPageElementsMap)e+=r[1];return e/3}doDestroy(){this.iconVAO=Ut(this.iconVAO),this.textVAO=Ut(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,i=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===i.usedMemory&&i.setSubData(e,0,0,e.length);const r=this.textOpacity,s=this.textVAO.vertexBuffers.opacity;r.length>0&&r.byteLength===s.usedMemory&&s.setSubData(r,0,0,r.length)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++],a=Sr.createVertex(e,cr.STATIC_DRAW,new Int32Array(n.buffer,4*r,o));r+=o;const l=s[r++],c=Sr.createIndex(e,cr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l));r+=l;const u=s[r++],d=Sr.createVertex(e,cr.STATIC_DRAW,new Int32Array(n.buffer,4*r,u));r+=u;const f=s[r++],m=Sr.createIndex(e,cr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,f));r+=f;const g=Sr.createVertex(e,cr.STATIC_DRAW,this.iconOpacity.buffer),y=Sr.createVertex(e,cr.STATIC_DRAW,this.textOpacity.buffer),v=this.layer,b=v.iconMaterial,w=v.textMaterial;this.iconVAO=new Jf(e,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:a,opacity:g},c),this.textVAO=new Jf(e,w.getAttributeLocations(),w.getLayoutInfo(),{geometry:d,opacity:y},m)}},_It=class extends Q6{constructor(e,i){super(e,i),this.type=gu.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.circleIndexStart=r[s++],this.circleIndexCount=r[s++],this.bufferDataOffset=s}get memoryUsed(){var e,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((i=this.vao)==null?void 0:i.usedMemory)??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=Ut(this.vao)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++],a=Sr.createVertex(e,cr.STATIC_DRAW,new Int32Array(n.buffer,4*r,o));r+=o;const l=s[r++],c=Sr.createIndex(e,cr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l));r+=l;const u=this.layer.circleMaterial;this.vao=new Jf(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}};const koi=!0,vIt=32,LK=200;let bIt=class extends Us{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){var r;if(this._stage===e)return;const i=this._stage;this._stage=e,e?(r=this._stage)!=null&&r.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i==null||i.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=aa(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=aa(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var e,i;(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,(i=this._fadeOutResolver)==null||i.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale),this.setTransform(e.state)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,i){const r=le("mapview-transitions-duration")===0?0:1/le("mapview-transitions-duration");if(this.fadeTransitionEnabled&&r!==0){const s=this._fadeOutResolver||!this.visible?0:this.opacity,n=this.computedOpacity;if(n===s)this.computedVisible=this.visible;else{const o=e*r;this.computedOpacity=n>s?Math.max(s,n-o):Math.min(s,n+o),this.computedVisible=this.computedOpacity>0;const a=s===this.computedOpacity;this.inFadeTransition=!a,a||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},ake=class extends bIt{constructor(e,i,r,s,n,o,a=n,l=o){super(),this.tileDebugInfoTexture=null,this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}},this._destroyed=!1,this.key=new y_(e),this.resolution=i,this.x=r,this.y=s,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null),this._destroyed=!0}get debugSlot(){let e=this;for(;e.parent!==this._stage;){if(!e.parent)return 0;e=e.parent}return this._stage.children.indexOf(e)}setTransform(e){const i=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*i,a=this.height/this.rangeY*i;rse(r,o,0,0,0,a,0,s,n,1),QA(this.transforms.displayViewScreenMat3,e.displayViewMat3,r)}get destroyed(){return this._destroyed}},zoi=class lke extends ake{constructor(e,i,r,s,n,o,a,l=null){super(e,i,r,s,n,o,4096,4096),this.styleRepository=a,this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this.featureIndex=null,this.triangleCount=0,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<LK}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<LK)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(e){var r,s;let i=!1;for(const n of e){const o=this.layerData.get(n);o&&(this._memoryUsedByLayerData-=o.memoryUsed,o.type===gu.SYMBOL&&this.symbols.delete(n)&&(i=!0),o.destroy(),this.layerData.delete(n))}(r=this._memCache)==null||r.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&((s=this.featureIndex)==null||s.clear(),this.emit("symbols-changed")),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}dispose(){this.status!=="unloaded"&&(this.featureIndex=null,cke.delete(this),lke._destroyRenderBuckets(this.layerData),this.layerData.clear(),this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get usedMemory(){return this._memoryUsedByLayerData+256}changeDataImpl(e){var r,s;(r=this.featureIndex)==null||r.clear();let i=!1;if(e){const{bucketsWithData:n,emptyBuckets:o}=e,a=this._createRenderBuckets(n);if(o&&o.byteLength>0){const l=new Uint32Array(o);for(const c of l)this._deleteLayerData(c)}for(const[l,c]of a)this._deleteLayerData(l),c.type===gu.SYMBOL&&(this.symbols.set(l,c.symbols),i=!0),this._memoryUsedByLayerData+=c.memoryUsed,this.layerData.set(l,c);(s=this._memCache)==null||s.updateSize(this.key.id,this,this.usedMemory)}this._hasSymbolBuckets=!1;for(const[n,o]of this.layerData)o.type===gu.SYMBOL&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const i=this.resolution/(e.resolution*e.pixelRatio),r=this.width/this.rangeX*i,s=this.height/this.rangeY*i,n=[0,0];e.toScreen(n,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;AG(o),KA(o,o,n),PG(o,o,Math.PI*e.rotation/180),CD(o,o,[r,s,1])}_createTransforms(){return{displayViewScreenMat3:bS(),tileMat3:bS(),tileUnitsToPixels:bS()}}static _destroyRenderBuckets(e){if(!e)return;const i=new Set;for(const r of e.values())i.has(r)||(r.destroy(),i.add(r));e.clear()}_createRenderBuckets(e){const i=new Map,r=new Map;for(const s of e){const n=this._deserializeBucket(s,r);for(const o of n.layerUIDs)i.set(o,n)}return i}_deserializeBucket(e,i){let r=i.get(e);if(r)return r;switch(new Uint32Array(e)[0]){case gu.FILL:r=new gIt(e,this.styleRepository);break;case gu.LINE:r=new mIt(e,this.styleRepository);break;case gu.SYMBOL:r=new yIt(e,this.styleRepository,this);break;case gu.CIRCLE:r=new _It(e,this.styleRepository)}return i.set(e,r),r}_deleteLayerData(e){if(!this.layerData.has(e))return;const i=this.layerData.get(e);this._memoryUsedByLayerData-=i.memoryUsed,i.destroy(),this.layerData.delete(e)}};const cke=new Map;function wIt(){cke.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(i=>console.log(i)),console.log("========"),t[1].forEach(i=>console.log(i))})}let xIt=class{constructor(e="scene"){this.context=e,this.extent=zh()}};const joi={value:.5,readOnly:!0},TIt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let RM=class{constructor(e=0,i=0){this.min=e,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},SIt=class{constructor(e,i){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(i[2]-i[0]),this.dy=(e.width-1)/(i[3]-i[1]),this.x0=i[0],this.y1=i[3]}},EIt=class{constructor(e,i,r){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=i,this.samplerData=new SIt(r,i)}computeMinMaxValue(e,i,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.data.width,u=this.samplerData.data.values,d=.5*pse;let f=(c-1)/o,m=(r-this.j*o)*f,g=(i-this.i*o)*f;if(f<1){const y=Math.floor(m),v=Math.floor(g),b=y+v*c,w=u[b],x=u[b+1],S=u[b+c],C=u[b+c+1];if(w+x+S+C<d){const M=m-y,O=g-v,D=tF(w,x,S,C,M,O),U=tF(w,x,S,C,M+f,O),k=tF(w,x,S,C,M,O+f),H=tF(w,x,S,C,M+f,O+f);return s.min=Math.min(D,U,k,H),s.max=Math.max(D,U,k,H),s}m=y,g=v,f=1}else m=Math.floor(m),g=Math.floor(g),f=Math.ceil(f);for(let y=m;y<=m+f;y++)for(let v=g;v<=g+f;v++){const b=u[y+v*c];b<d?(a=Math.min(a,b),l=Math.max(l,b)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}};const CIt=.5*pse;function Ts(t,e,i){if(i==null)return null;for(const r of i){if(!r)continue;const s=r.safeWidth;let n=Ne(r.dy*(r.y1-e),0,s),o=Ne(r.dx*(t-r.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=r.data.width,u=a*c+l,d=r.data.values,f=d[u],m=d[u+1],g=u+c,y=d[g],v=d[g+1];if(f+y+m+v<CIt){n-=a,o-=l;const b=f+(m-f)*o;return b+(y+(v-y)*o-b)*n}}return null}var Pt;(function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"})(Pt||(Pt={}));function uke(t){return fae(t)||f2(t)||m2(t)}function fae(t){return o_(t)||OA(t)}const IE=E(),MIt=E(),zy=E(),By=E();function AIt(t,e,i=0){const r=t.extent;if(r==null)return!1;if(i===0)return sCe(r,e);const s=Math.min(r[2]-r[0],r[3]-r[1]);return bXe(r,e,i*s)}function s5(t,e,i,r){ve(IE,i),IE[r]=e[r];const s=Re(IE,IE,e),n=Re(MIt,t,e),o=Te(n,s),a=Te(s,s);let l;l=o<=0?e:a<=o?i:Ee(IE,e,he(s,s,o/a));const c=Re(IE,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function PIt(t,e,i){const r=t.extent;if(r==null)return 0;zy[0]=r[0],zy[1]=r[1],zy[2]=i,By[0]=r[2],By[1]=r[3],By[2]=i;let s=1/0,n=1/0;return e[0]<zy[0]?s=s5(e,zy,By,0):e[0]>By[0]&&(s=s5(e,By,zy,0)),e[1]<zy[1]?n=s5(e,zy,By,1):e[1]>By[1]&&(n=s5(e,By,zy,1)),Math.min(s,n)}function OIt(t,e,i,r){if(t==null)return dse();const s=t.spatialReference;if(s.isGeographic&&!fae(s))return new G("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const n=bu.checkUnsupported(t);return n??(i==null?new G("tilingscheme:extent-not-exist","The layer does not provide a layer extent."):RIt(t,i)||(e==null||s.equals(e)||e.isWGS84&&s.isWebMercator?null:new G("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")))}function RIt(t,e){const i=t.lods,r=i[0].resolution*2**i[0].level,s=[r*t.size[0],r*t.size[1]],n=[t.origin.x,t.origin.y],o=rCe(e),a=oi();bu.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>uM){const c=i[0].scale*2**i[0].level;let u=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/r;const d=Math.floor(Math.log(u)/Math.log(10));return u=Math.ceil(u/10**d)*10**d,new G("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+u.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:u,requiredNumRootTiles:l,allowedNumRootTiles:uM})}return null}const $It=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:OIt,isInsideExtent:AIt,tiltToExtentEdge:PIt},Symbol.toStringTag,{value:"Module"}));function IIt(){return!0}function LIt(){return 0}function DIt(t,e,i,r){if(t==null)return dse();const s=(t==null?void 0:t.lods.length)-1,n=t.spatialReference;if(n.isWebMercator){if(!bu.makeWebMercatorAuxiliarySphere(s).compatibleWith(t,r))return new G("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!uke(n))return new G("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!bu.makeGCSWithTileSize(t.spatialReference,t.size[0],s).compatibleWith(t,r))return t.spatialReference.isWGS84?new G("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new G("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?null:new G("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const NIt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:DIt,isInsideExtent:IIt,tiltToExtentEdge:LIt},Symbol.toStringTag,{value:"Module"})),FIt={[Xe.Global]:NIt,[Xe.Local]:$It};function Nn(t,e){t||console.warn("Terrain: "+e)}let ao=!1,XB=!1;function kIt(t){XB=t,ao=ao||t}function UIt(t){ao=t}function Ye(t,e){var i;if(ao&&!t){const r=(i=new Error().stack)==null?void 0:i.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+r),new Error("Assertion failed"+(e?": "+e:""))}}function DK(t){return mae(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function JB(t){return(t==null?void 0:t.type)==="imagery-tile"||(t==null?void 0:t.type)==="wcs"}function mae(t){return(t==null?void 0:t.type)==="imagery-tile-3d"}function hke(t){return(t==null?void 0:t.type)==="tile-3d"}function EP(t){return(t==null?void 0:t.type)==="vector-tile-3d"}function dke(t){return(t==null?void 0:t.type)==="wmts-3d"}function NK(t){return(t==null?void 0:t.type)==="elevation-3d"}function TR(t){return(t==null?void 0:t.type)==="group"}function HL(t){return t&&(hke(t)||dke(t)||mae(t)||EP(t))}function FK(t){return t&&(hke(t)||mae(t)||EP(t)||dke(t))}function kK(t){return FK(t)||NK(t)}function VIt(t){var e;return K5e((e=t==null?void 0:t.sourceLayerInfo)==null?void 0:e.data)}function zIt(t){return pke(t==null?void 0:t.sourceLayerInfo)||!!(t!=null&&t.isVTLBackground)}function BIt(t){var e;return eke((e=t==null?void 0:t.sourceLayerInfo)==null?void 0:e.data)}function jIt(t){var i;const e=(i=t==null?void 0:t.sourceLayerInfo)==null?void 0:i.data;return J6(e)||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData}function pke(t){return RC(t==null?void 0:t.data)}function gA(t){return t!=null&&"release"in t&&t.release(),null}function Woi(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function gae(t,e,i,r,s){return FIt[r].checkIfTileInfoSupportedForViewSR(t,i,e,s)}function K6(t,e,i){var o;let r=null,s=null;if((t==null?void 0:t.type)==="wmts"){const a=GIt(t,e,i);r=a.tileInfo,s=a.fullExtent}else{s=JB(t)?t.getCompatibleFullExtent(e):t.fullExtent;const a=i===Xe.Local;JB(t)?r=t.getCompatibleTileInfo(e,s,a):(t==null?void 0:t.type)==="vector-tile"?r=a&&!HIt(e)||qIt.force512VTL?t.tileInfo:t.tileInfo.getCompatibleForVTL(256):r=t.tileInfo}const n="tilemapCache"in t?(o=t.tilemapCache)==null?void 0:o.effectiveMaxLOD:void 0;return r!=null&&s!=null&&gae(r,s,e,i,n)==null?{tileInfo:r,fullExtent:s}:null}function GIt(t,e,i){const r=CZe(t);if(r!=null){if(!st.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const s=r.find(n=>gae(n.tileInfo,n.fullExtent,e,i)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function HIt(t){return t.isWGS84||t.isWebMercator||OA(t)||!RS(t)}const qIt={force512VTL:!1};function W_e(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function jy(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function kd(t,e,i=YIt){return Math.abs(t-e)<i}function QB(t){return t===Pt.NORTH_EAST?Pt.SOUTH_WEST:t===Pt.NORTH_WEST?Pt.SOUTH_EAST:t===Pt.SOUTH_WEST?Pt.NORTH_EAST:Pt.NORTH_WEST}function yae(t){return t===Pt.NORTH?Pt.SOUTH:t===Pt.EAST?Pt.WEST:t===Pt.SOUTH?Pt.NORTH:Pt.EAST}function WIt(t){return t===Pt.NORTH_WEST||t===Pt.SOUTH_WEST}function ZIt(t){return t===Pt.NORTH_WEST||t===Pt.NORTH_EAST}function Z_e(t){return t===Pt.NORTH_WEST||t===Pt.WEST||t===Pt.SOUTH_WEST}function Y_e(t){return t===Pt.NORTH_EAST||t===Pt.EAST||t===Pt.SOUTH_EAST}function X_e(t){return t===Pt.SOUTH_EAST||t===Pt.SOUTH||t===Pt.SOUTH_WEST}function J_e(t){return t===Pt.NORTH_EAST||t===Pt.NORTH||t===Pt.NORTH_WEST}const If=[Pt.NORTH,Pt.EAST,Pt.SOUTH,Pt.WEST],KB=[Pt.NORTH_EAST,Pt.SOUTH_EAST,Pt.SOUTH_WEST,Pt.NORTH_WEST],YIt=1e-5;let Td=class extends Ue{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(i=>{const r=i.layer;if("operationalLayerType"in r&&EZe(r.operationalLayerType)&&this.viewSpatialReference!=null){const s=fke(r.fullExtent,this.viewSpatialReference);s!=null&&e.push(rCe(s))}}),e}};function XIt(t,e){return t===Xe.Global?new UK(e):new VK(e)}h([p({readOnly:!0})],Td.prototype,"layerViewsExtent",null),h([p({readOnly:!0})],Td.prototype,"tiledLayersExtent",null),h([p({readOnly:!0})],Td.prototype,"stencilEnabledExtents",null),h([p()],Td.prototype,"viewSpatialReference",void 0),h([p()],Td.prototype,"tilingScheme",void 0),h([p()],Td.prototype,"defaultTiledLayersExtent",void 0),h([p({constructOnly:!0})],Td.prototype,"layers",void 0),h([p({constructOnly:!0})],Td.prototype,"layerViews",void 0),Td=h([I("esri.views.3d.terrain.ExtentHelper")],Td);let UK=class extends Td{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?WPe:Fst}};UK=h([I("esri.views.3d.terrain.ExtentHelper.ExtentHelperGlobal")],UK);let VK=class extends Td{_computeLayerViewsExtent(){const e=zh(),i=this.viewSpatialReference;this.layerViews.forEach(n=>{const o=n.layer;if(n.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=fke("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,i);Q1(e,a,e)}});const r=TZ(e)?e:null,s=this._get("layerViewsExtent");return rS(r,s)?s:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const i=this.viewSpatialReference,r=zh();this.layers.forEach(o=>{var a;if(o.loaded&&qI(o)){const l=K6(o,i,Xe.Local);if(l==null)return;const{tileInfo:c,fullExtent:u}=l,d="tilemapCache"in o?(a=o.tilemapCache)==null?void 0:a.effectiveMaxLOD:void 0;c!=null&&u!=null&&(JB(o)||e.compatibleWith(c,d)&&u.spatialReference.equals(e.spatialReference))&&Q1(r,u,r)}}),Q1(r,this.defaultTiledLayersExtent,r);const s=TZ(r)?r:null,n=this._get("tiledLayersExtent");return rS(s,n)?n:s}};function fke(t,e){return t==null||t.spatialReference.equals(e)?t:XI(t,t.spatialReference,e)}VK=h([I("esri.views.3d.terrain.ExtentHelper.ExtentHelperLocal")],VK);function mke(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const i=Object.keys(t);for(const r of i)r.includes(".glsl")&&delete t[r]}}const gke=1.3,JIt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let xv,bc=class extends Ue{constructor(e){super(e),this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=le("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){const e=this.view;this.renderer=new gd({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),e._stage.renderer.plugins.add(this.renderer);const i=()=>this.setDrawTexturesDirty();this._groundIntersector=ip(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([te(()=>this.renderer.hasHighlights,i),this.renderer.events.on("has-water",r=>{var s;return(s=e._stage)==null?void 0:s.renderer.setParameters({hasOverlayWater:r})}),this.renderer.events.on("content-changed",i),te(()=>e.state.camera.pixelRatio,i),te(()=>e.state.alignPixelEnabled,i),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),te(()=>{var r,s,n;return[(r=e.pointsOfInterest)==null?void 0:r.renderPointOfView,(n=(s=e.pointsOfInterest)==null?void 0:s.centerOnSurfaceFrequent)==null?void 0:n.location]},()=>this.setPlacementDirty()),te(()=>{var r,s;return[(r=e.state)==null?void 0:r.pixelRatio,(s=e.state)==null?void 0:s.contentPixelRatio]},()=>this.setPlacementDirty(),or),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(It.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",r=>{this._updateOverlays(Eu,r.camera,ar.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlays(ar.BACKGROUND,r)})]),e._stage.renderer.renderOverlay=r=>this._renderOverlay(r)}destroy(){var e;(e=this.view)!=null&&e._stage&&(this.view._stage.renderer.plugins.remove(this.renderer),this.view._stage.renderer.renderOverlay=()=>{}),xv&&(xv.hide(),xv=null),this.renderer=qe(this.renderer)}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||Nr.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?_r(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return gke/this.view.resolutionScale}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccludedDraped(){return this.renderer.rendersOccludedDraped}_renderOverlay(e){if(this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays)return this._dispatchAnimationUpdate(e),this._drawOverlays(ar.UPDATE,this.view.state)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const i=this.view.renderSpatialReference;e!=null&&i!=null?(this._renderSR=i,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new vb(-20037508342787e-6,20037508342787e-6):new vb(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}registerDrapeSource(e,i,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this.renderer.createDrapeSourceRenderer(e,i,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),s}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,ah)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,ar.UPDATE)}_updateOverlays(e,i,r){if(!this._spatialReference)return na;const s=this._computeOverlayResolution(i);this._computeOverlayExtents(i,s,Em),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,Em.stretch);const n=this._updateOverlay(Mn.INNER,Em.inner,s,1*Em.pixelRatioAdjustment,Em.mapUnitsPerPixel),o=nl(Em.inner)/nl(Em.outer),a=this._updateOverlay(Mn.OUTER,Em.outer,s,o*Em.pixelRatioAdjustment,Em.mapUnitsPerPixel);n!==ng.EXTENT&&a!==ng.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(r)),n===ng.NONE&&a===ng.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const i=this.view.state.contentPixelRatio*this.view.resolutionScale,r=e.fullWidth/e.pixelRatio*i,s=e.fullHeight/e.pixelRatio*i,n=Math.ceil(1.5*Math.max(r,s));return Math.min(rb(n),this._maxResolution)}_updateOverlay(e,i,r,s,n){if(this.renderer.overlays.length===0)return ng.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=n,o.pixelRatio=s,QIt(i,o.extent)&&r===o.resolution)return a===n?ng.NONE:ng.RERENDER_ONLY;l_(o.extent,i),o.resolution=r;const l=yre(o.extent);return o.renderLocalOrigin=MB(l[0],l[1],0,"OV_"+this._latestOriginId++),ng.EXTENT}setTileParameters(e){const i=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[Mn.INNER],s=this.renderer.overlays[Mn.OUTER],n=e.extent;this._rectInsideRect(r.extent,n)||this._rectanglesOverlap(n,r.extent)||this._rectanglesOverlap(n,s.extent)?(this._setTileOverlayData(n,Mn.INNER,i),this._setTileOverlayData(n,Mn.OUTER,i)):(this._clearTileOverlayData(Mn.INNER,i),this._clearTileOverlayData(Mn.OUTER,i))}else this._clearTileOverlayData(Mn.INNER,i),this._clearTileOverlayData(Mn.OUTER,i)}overlayPixelSizeInMapUnits(e,i){if(this.renderer.overlays.length===0)return i();const r=this.renderer.overlays[Mn.INNER],s=this.renderer.overlays[Mn.OUTER],n=this._pointIsInExtent(e,r.extent)?r:s;return(n.extent[2]-n.extent[0])/n.resolution}_setTileOverlayData(e,i,r){if(this.renderer.overlays.length===0)return;const s=this.renderer.overlays[i].extent,n=nl(s),o=Lc(s);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(s[0],a);const l=this._longitudeCyclical.minimalMonotonic(s[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}r.setScale(i,nl(e)/n,Lc(e)/o),r.setOffset(i,(a-s[0])/n,(e[1]-s[1])/o)}_clearTileOverlayData(e,i){i.setScale(e,-1,-1),i.setOffset(e,-1,-1)}async reloadShaders(){mke(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(Eu)}_dispatchAnimationUpdate(e){const i=e-this._animationTimeLast;if(i>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const r=i/this.surface.view._stage.renderer.animationTimeDilation,s=new k3e(this.view.state.camera,r,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(s)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,i,r,s){const n=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,i3t,i,r);if(n==null)return!1;const o=n.origin,a=Ee(n5,n.origin,n.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(s)}_findHorizonBasedPointOfInterest(e,i){let r=.5;const s=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=Ne(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+a,e.aboveGround?n-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const u=n5;XP(wG(xG,_r(this.view.spatialReference).radius+l),jh(e.eye,e.viewForward),u),Re(u,u,e.eye);const d=bb.normalize(XMe(e.viewForward,u,e.viewRight))/e.fovY+.5,f=d<=0||d>=1?.5:s;r=c?f*d:d+f*(1-d)}else{const u=.5*Math.PI-Math.acos(-e.viewForward[2]),d=Math.tan(u),f=ii(0,d,1,0),m=Pu(f,f,e.projectionMatrix)[1],g=Ne(.5+.5*m,0,1);r=g===1||g===0?.5:c?g*s:1-(1-g)*s}return!!this._intersectGroundFromView(e,.5,r,i)&&iL(i,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,i,r){var U;const s=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=E();this._findHorizonBasedPointOfInterest(e,n)||ve(n,s),Nr.OVERLAY_SHOW_CENTER?(xv==null&&(xv=new $C(this.view.graphics,"red")),xv.show(n,this._renderSR)):xv!=null&&xv.hide();const o=Math.max(.1,Cr(e.eye,n)),a=Ib(this.view.renderCoordsHelper,s,e.eye);this._overlaySREqualsRenderSR||Fo(n,this._renderSR,n,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&((U=this._spatialReference)==null?void 0:U.isGeographic),u=c&&this._spatialReference?1/_r(this._spatialReference).metersPerDegree:1,d=this.view.state.contentPixelRatio,f=e.perScreenPixelRatio/d*o*u;r.mapUnitsPerPixel=f/this._worldToPCSRatio,r.stretch=this._overlayStretch;let m=i*f/2*r.stretch,g=!1,y=c?90:1/0;this._isSpherical&&l&&this._spatialReference&&(this._spatialReference.isWebMercator?(m/=Math.cos(az(n[1])),y=l[3]):(g=!0,m/=_r(this._spatialReference).metersPerDegree,y=90),m>=y&&(m=y,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let v=1;g&&(v=1/Math.max(.2,Math.cos(Math.abs(kt(n[1])))),m*v>180&&(v=180/m),r.mapUnitsPerPixel*=v);const b=Math.log(2)/12;m=Math.exp(Math.round(Math.log(m)/b)*b);const w=m*v,x=32,S=.5*i/(x*w),C=.5*i/(x*m);n[0]=Math.round(n[0]*S)/S,n[1]=Math.round(n[1]*C)/C;const M=r.inner;M[0]=n[0]-w,M[1]=n[1]-m,M[2]=n[0]+w,M[3]=n[1]+m,this._isSpherical&&this._shiftExtentToFitBounds(M,1/0,y);const O=r.outer;if(6*w>nl(l))l_(O,l);else if(Math.PI/2-Math.abs(a-Math.PI/2)<=.25*Math.PI)O[0]=M[0]-w,O[1]=M[1]-m,O[2]=M[2]+w,O[3]=M[3]+m;else{Fo(e.eye,this._renderSR,n5,this._spatialReference),vg(Kw,n,n5);let k=-Math.atan2(Kw[1],Kw[0])+.125*Math.PI;k<0&&(k+=2*Math.PI);const H=Math.floor(k/(.25*Math.PI));GS(Kw,JIt[H],2*m),Kw[0]*=v,Kw[2]*=v,kre(O,M,Kw)}if(this._isSpherical)O[0]=this._longitudeCyclical.clamp(O[0]),O[2]=this._longitudeCyclical.clamp(O[2]),O[1]=Math.max(O[1],-y),O[3]=Math.min(O[3],y);else{const k=SZ(M,l,e3t),H=SZ(O,l,t3t);nhe(k,H)&&(O[2]=O[0],O[3]=O[1])}const D=Math.abs(M[2]-M[0])/i;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,D),r.pixelRatioAdjustment=r.mapUnitsPerPixel/D}_drawOverlays(e,i){if(!this.renderer.hasOverlays)return;if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;const r=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;const s=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(),this.renderer.drawOverlays(i),s!==this.renderer.computeValidity()&&this.surface.updateTileOverlayParams(ar.UPDATE),r?(this.surface.requestRender(e),e===ar.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(ar.BACKGROUND),this.renderer}_rectanglesOverlap(e,i){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(i[0],i[2],e[0])||this._longitudeCyclical.contains(i[0],i[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],i[0]))&&!(e[1]>i[3]||e[3]<i[1]):oG(e,i))}_rectInsideRect(e,i){return i!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],i[0])&&this._longitudeCyclical.contains(e[0],e[2],i[2])&&i[1]>e[1]&&i[3]<e[3]:nhe(e,i))}_pointIsInExtent(e,i){if(this._longitudeCyclical)return this._longitudeCyclical.contains(i[0],i[2],e.x)&&e.y>=i[1]&&e.y<=i[3];const r=e.x,s=e.y;return r>i[0]&&r<i[2]&&s>i[1]&&s<i[3]}_shiftExtentToFitBounds(e,i,r){let s=0,n=0;e[0]<-i?s=e[0]+i:e[2]>i&&(s=i-e[2]),e[1]<-r?n=e[1]+r:e[3]>r&&(n=r-e[3]),yz(e,s,n)}get test(){}};function QIt(t,e){const r=Nr.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r}h([p()],bc.prototype,"_spatialReference",void 0),h([p({readOnly:!0})],bc.prototype,"running",null),h([p()],bc.prototype,"_placementDirty",void 0),h([p()],bc.prototype,"_contentUpdated",void 0),h([p()],bc.prototype,"_isSpherical",null),h([p()],bc.prototype,"_worldToPCSRatio",null),h([p()],bc.prototype,"renderer",void 0),h([p({constructOnly:!0})],bc.prototype,"view",void 0),h([p({constructOnly:!0})],bc.prototype,"surface",void 0),h([p()],bc.prototype,"suspended",null),h([p()],bc.prototype,"updating",null),h([p({type:Boolean})],bc.prototype,"rendersOccludedDraped",null),bc=h([I("esri.views.3d.terrain.OverlayManager")],bc);let KIt=class{constructor(){this.inner=oi(),this.outer=oi(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=gke}};const Kw=ci(),n5=E(),Em=new KIt,e3t=oi(),t3t=oi(),i3t=lo();var ng;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(ng||(ng={}));let r3t=class{constructor(){this.indices=null,this.indexCount=0,this.edgeIndicesStartIndex=0,this.poleIndicesStartIndex=0,this.vertexAttributes=null,this.edgeVerticesStartIndex=0,this.poleVerticesStartIndex=0,this.maxEdgeVertexCount=0,this.boundingBox=Zr(),this.numVerticesPerSide=0,this.minu=0,this.minv=0,this.maxu=1,this.maxv=1,this.outerEdgesOffsetAndLength=[0,0,0,0,0,0,0,0]}release(){this.vertexAttributes=hi(this.vertexAttributes),this.indices=null}reset(){this.indices=null,this.vertexAttributes=null,Zr(this.boundingBox),this.numVerticesPerSide=0}getEdgeFirstVertexIndex(e){return this.outerEdgesOffsetAndLength[2*e]}getEdgeCount(e){return this.outerEdgesOffsetAndLength[2*e+1]}getEdgeVertexIndex(e,i){return this.getEdgeAttributeIndex(e,i)}getEdgeVertexPosition(e,i,r,s){this._getEdgeVertexRaw(this.getEdgeAttributeIndex(e,s),i),Ee(i,i,r)}getEdgeNormal(e,i,r){const{typedBuffer:s,typedBufferStride:n}=this.vertexAttributes.normalCompressed;Twt(i,s,this.getEdgeAttributeIndex(e,r),n)}setEdgeNormalFromValues(e,i,r,s,n){this._setNormal(this.getEdgeAttributeIndex(e,i),r,s,n)}setEdgeVertexFromValuesRawPositionUV(e,i,r,s,n,o,a){const l=this.getEdgeAttributeIndex(e,i);this.vertexAttributes.position.setValues(l,r,s,n),this._setUV(l,o,a)}setEdgeVertexFromValuesRawPositionUVNormal(e,i,r,s,n,o,a,l,c,u){const d=this.getEdgeAttributeIndex(e,i);this.vertexAttributes.position.setValues(d,r,s,n),this._setUV(d,o,a),this._setNormal(d,l,c,u)}_getEdgeVertexRaw(e,i){this.vertexAttributes.position.getVec(e,i)}_setNormal(e,i,r,s){const{typedBuffer:n,typedBufferStride:o}=this.vertexAttributes.normalCompressed;np(n,e,i,r,s,o)}_setUV(e,i,r){Vf(this.vertexAttributes.uv0,e,i,r)}getEdgeAttributeIndex(e,i){return Ye(0<=i&&i<this.getEdgeCount(e)),this.getEdgeFirstVertexIndex(e)+i}};const Q_e=16384;function Vf(t,e,i,r){t.setValues(e,i*Q_e,r*Q_e)}let s3t=class{constructor(){this.sinLonLUT=new Array(t$+1),this.cosLonLUT=new Array(t$+1),this.sinLatLUT=new Array(t$+1),this.cosLatLUT=new Array(t$+1)}update(e,i,r){const s=i[0],n=i[2];for(let o=0;o<=e;o++){const a=o/e,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=r(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},n3t=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.samplerDataVersion=0,this.clippingArea=null,this.wireframe=!1,this.cornerPeerNeighbors=[null,null,null,null],this.cornerNeighborCornerTiles=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.cornerNeighborCornerTileSamplerVersions=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1]}},yke=class DU{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=qe(this._current),this._next=qe(this._next),this._waiting=qe(this._waiting),this._delayed=qe(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let e=DU.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,cb.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const i=this._fadeDuration,r=this._current!=null&&this._next.texture===this._current.texture,s=this._next.type!==vn.FADING,n=e-this._fadeStart>=i;(r||s||n)&&(qe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=DU.test.fadeMoment||performance.now(),i=Math.max(0,e-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return this._next!=null||this._delayed!=null}push(e,i=cb.Immediate){this._delayed=qe(this._delayed),this._push(e,i)}_push(e,i){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const r=DU.test.fadeMoment||performance.now();return i!==cb.Immediate?(this._delayed=e,void(this._delayedTime=r+i)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(r))):void(e!=null&&(qe(this._waiting),this._waiting=e))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const i=this._getFadeDuration();return e+i-e%i}get _isFadingEnabled(){return this._getFadeDuration()>0}};var cb;yke.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(cb||(cb={}));var CP;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(CP||(CP={}));let _ke=class{constructor(){this._queue=new ai,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var i;const e=(i=this._last)==null?void 0:i.children;return e!=null&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},o3t=class{constructor(){this._q=new ai}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let i=0;i<this._q.length;++i){const r=this._q.data[i];r.isLeaf||this._q.pushArray(r.children)}}}next(){return this._q.pop()}};function O3(t,e,i){if((e==null?void 0:e.fullExtent)==null)return!1;const r=e.fullExtent,s=t.extent;if(i){if(s[0]<r.xmin||s[1]<r.ymin||s[2]>r.xmax||s[3]>r.ymax)return!1}else if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;const n=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&n>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&n<.99999999*a)}function Lg(t,e){const i=t.lij,r=e.lij;return i[0]-r[0]||i[1]-r[1]||i[2]-r[2]}function a3t(t,e,i=null){i==null||i.length===0?t===CP.BACK_TO_FRONT?e.sort(l3t):e.sort(c3t):e.sort((r,s)=>u3t(r,s,t,i))}function l3t(t,e){const i=e.screenDepth-t.screenDepth;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function c3t(t,e){const i=t.screenDepth-e.screenDepth;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function vke(t,e,i){const r=t.screenDepth,s=e.screenDepth;return r<s?-i:r>s?i:Lg(t,e)}function u3t(t,e,i,r){return K_e(t,r)===K_e(e,r)?vke(t,e,i):t?i:-i}function K_e(t,e){for(const i of e)if(t.intersectsExtent(i))return!0;return!1}function h3t(t,e){const i=t.distanceToPOI-e.distanceToPOI;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function d3t(t,e){const i=t.length;for(let r=0;r<i;++r)t.at(r).updateDistanceToPOI(e);t.sort(h3t)}function p3t(t,e,i){let r=1,s=0,n=0;for(;t!==e;)if(r*=.5,s*=.5,n*=.5,1&t.lij[2]&&(s+=.5),1&t.lij[1]||(n+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(e,s,n,r)}function f3t(t){for(let e=0;e<t.length;e++){const i=t[e],r=i.parent;if(r)for(let s=0;s<4;s++){const n=r.children[s];if(n&&n!==i)return!0}}return!1}function sai(t,e){if(!t||!e||t[0]===e[0])return!1;const i=t[0]<e[0],r=i?t:e,s=i?e:t,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}let _ae=class{get updating(){return!!this._tileRequested}init(e,i,r,s){this.tile=e,this._layerIdx=i,this._layerClass=r,this._suspended=s,this._tileLayerInfo=e.getLayerInfo(i,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,i){this._setUpsampleTile(e,i),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,vn.FADING,i):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(e,i),s=DK(r),{minLevel:n,maxLevel:o}=r.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?O3:()=>!0;let u=this.tile;const d=u.level;let f;const m=this._tileLayerInfo.upsampleInfo,g=m!=null?m.tile.level:-1,y=m!=null&&g-d>=a,v=s==null?void 0:s.tilemapCache,b=r.type==="vector-tile-3d"?r.schemaHelper:null;for(;u&&c(u,s,!1)&&u.level>=n;){const w=u.level,x=d-w,S=u.layerInfo[i][e];if(S.data&&x>=a){(!y||w>g)&&this._setUpsampleTile(u),S.dataInvalidated&&(f=u);break}const C=(b==null?void 0:b.getLevelRowColumn(u.lij))??u.lij;if((v==null?void 0:v.getAvailability(C[0],C[1],C[2]))!=="unavailable"&&w<=o&&!S.data&&!S.dataMissing&&((!f||u.level===n||w%qPe==0||d-f.level<a)&&(f=u),x>=l))break;u=u.parent}if(f!=null&&d-f.level<a)if(m)f=null;else{const w=this._findAncestorWithData();w!=null&&(this._setUpsampleTile(w),f=w.layerInfo[i][e].dataInvalidated?w:null)}return f}_findAncestorWithData(){const e=this.tile.elevationLevel,i=this._desiredMinLevelDelta;let r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(e-s.level>=i)return s;r=s}return r}_setUpsampleTile(e,i){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,vn.FADING,i)}get test(){}},m3t=class extends _ae{constructor(){super(...arguments),this.type="none"}get _desiredMinLevelDelta(){throw eve}get _progressiveLevelModulo(){throw eve}dispose(){}};const eve=new Error("Abstract method called on TileAgent"),Yc=new m3t;let g3t=class extends _ae{constructor(){super(...arguments),this.type="elevation",this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return this.tile.elevationLevelDelta-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}};function y3t(t){return t.type==="elevation"}let _3t=class extends _ae{constructor(){super(),this.type="map",this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return qPe}};function v3t(t){return t.type==="map"}var el;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(el||(el={}));let NU=class{constructor(){this.waitingAgents=new ai,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const i=W9.acquire();return i._init(e),i}release(){this.dispose(),FU.delete(this),W9.release(this)}dispose(){this.loadingAgent=Ut(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=gA(this._data)}static prune(){W9.prune(0)}_init(e){this.waitingAgents.clear(),this._data=gA(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Jl(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,i){if(e!==i&&i!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile.unrefMapData()}i.refMapData(),p3t(e,i,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){gA(this._data),this._data=e}};const W9=new la(NU,null,()=>{}),FU=new Map;function b3t(){FU.size>0&&(console.log(`${FU.size} live TilePerLayerInfo allocations:`),FU.forEach(t=>console.log(t,`
`)))}var Tt;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.GEOMETRY=8]="GEOMETRY",t[t.TEXTURE_NOFADING=16]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=32]="TEXTURE_FADING"})(Tt||(Tt={}));const w3t=.1;let vae=class{constructor(){this._lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=oi(),this._elevationBoundsMin=NaN,this._elevationBoundsMax=0,this.layerInfo=[[],[]],this.extentInRadians=oi(),this.centerAtSeaLevel=E(),this._center=[E(),dn(),E()],this.up=lre(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=E(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0}get lij(){return this._lij}get elevationLevelDelta(){return this._surface.getElevationLevelDelta(this.level)}static prune(){bae.prune(0),wae.prune(0),NU.prune()}get _isCached(){return!this.isLeaf&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBoundsMin(){return this._elevationBoundsMin}get elevationBoundsMax(){return this._elevationBoundsMax}get level(){return this._lij[0]}get key(){return`${this._lij[0]}/${this._lij[1]}/${this._lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[yn.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,i=(e==null?void 0:e.frustumVisibility)??el.INTERSECTS;this._frustumVisibility=i===el.INSIDE?el.INSIDE:i===el.OUTSIDE?el.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const r=this._frustumVisibility!==el.OUTSIDE&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}init(e,i,r,s,n){this._lij[0]=e,this._lij[1]=i,this._lij[2]=r,this.ellipsoid=_r(n.tilingScheme.spatialReference),n.tilingScheme.getExtent(e,i,r,this.extent),n.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,n.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[yn.MIDDLE][3]=0,this.elevationLevel=e,s&&!Number.isNaN(s.elevationBoundsMin)?(this._elevationBoundsMin=s.elevationBoundsMin,this._elevationBoundsMax=s.elevationBoundsMax):(this._elevationBoundsMin=0,this._elevationBoundsMax=0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=s,this.unsetChildren(),this._surface=n,this.updateVisibility(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0;for(const o of Zx){const a=n.numLayers(o),l=this.layerInfo[o];for(const c of l)c.release();l.length=a;for(let c=0;c<a;c++)l[c]=NU.acquire(this._surface.upsampleInfoPool),o===Qt.ELEVATION&&this.findElevationBoundsForLayer(c,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(n.tilingScheme.pixelSize,t$)}dispose(){Nn(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of Zx){for(const i of this.layerInfo[e])i.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[Qt.MAP].reduce((e,{data:i})=>e+(RC(i)?i.usedMemory/i.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){var r;if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=this._baseUsedMemory,this._mapTileMemoryInternal=0;let e=0;for(const{data:s}of this.layerInfo[Qt.MAP])RC(s)?e+=this._getTerrainDataMemory(s):this._mapTileMemoryInternal+=this._getTerrainDataMemory(s);const i=this._cpuImageMemorySize;for(const s of this.layerInfo[Qt.ELEVATION])this._usedMemory+=s.data?i:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=((r=this.renderData.texture)==null?void 0:r.usedMemory)??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,i){const r=this.layerInfo[e][i];return r!=null&&r.data?e===Qt.MAP?this._isCached?0:this._getTerrainDataMemory(r.data):e===Qt.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return eke(e)?e.texture.usedMemory:K5e(e)?e.memoryUsage:RC(e)?e.usedMemory/e.referenced:J6(e)||e instanceof HTMLImageElement?this._cpuImageMemorySize:0}updateScreenDepth(e){const i=this._center[yn.MIDDLE],r=e,s=i[0],n=i[1],o=i[2],a=r[2]*s+r[6]*n+r[10]*o+r[14];this.screenDepth=a<0?0:a/(r[3]*s+r[7]*n+r[11]*o+r[15])}shouldSplit(e,i,r){if(!this.visible||e.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===el.OUTSIDE))return Tt.NONE;const s=this.level;Re(a5,this._center[yn.MIDDLE],i);let n=sl(a5),o=a5,a=this._center[yn.MIDDLE];Re(Z9,this._center[yn.TOP],i);const l=sl(Z9);l<n&&(n=l,o=Z9,a=this._center[yn.TOP]),Re(Y9,this._center[yn.BOTTOM],i);const c=sl(Y9);if(c<n&&(n=c,o=Y9,a=this._center[yn.BOTTOM]),this._edgeLen2>n&&s<e.maxLod)return Tt.SPLIT;const u=Math.sqrt(n),d=e.fovX*u*2,f=this._edgeLen/d,m=()=>{if(s<e.maxLod)return this.elevationLevel=s,Tt.NONE;const O=s+Math.ceil(-Math.log2(e.relativeWidthLimit/f));return O!==this.elevationLevel?(this.elevationLevel=O,Tt.ELEVATION):Tt.NONE},g=r!=null?r-s:1/0;if(g<=.5)return m();const y=Te(this.up,a5),v=this._elevationBoundsMax-this._elevationBoundsMin,b=v/this.edgeLen;if(e.aboveGround&&y>0&&b<.001&&y/u-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-b>0)return Tt.NONE;const w=r!=null?3-Math.min(g,2):1;if(f*w<e.relativeWidthLimit||s>=e.maxLod)return m();if(s<7)return Tt.SPLIT;he(jo,this.up,y),Re(jo,jo,o);const x=sl(jo);if(x<=this.radius*this.radius)return Tt.SPLIT;he(jo,jo,this.radius/Math.sqrt(x)),Ee(jo,jo,a),Re(jo,i,jo);const S=Math.min(1,(Math.abs(Te(jo,this.up))+.5*v+this._curvatureHeight)/Ve(jo)),C=w3t/e.angledSplitBias,M=e.fovY*u*2;return S*(this._edgeLen/M*w)<C*e.relativeHeightLimit?Tt.NONE:Tt.SPLIT}setChildren(e,i,r,s){Nn(!!(e&&i&&r&&s),"Null child passed");const n=this._children;return n[0]=e,n[1]=i,n[2]=r,n[3]=s,n}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of Zx)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const i of Zx){const r=this.layerInfo[i];for(const s of r)s.loadingAgent&&s.loadingAgent!==Yc&&(o5(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(Tt.GEOMETRY),this.resetPendingUpdate(Tt.TEXTURE_NOFADING),this.resetPendingUpdate(Tt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[Qt.MAP];for(const i of e)i.loadingAgent&&i.loadingAgent!==Yc&&(o5(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(rS(e,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._isWithinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const s=r&&this._isWithinClippingArea,n=!(r||i||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(Tt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,i){return this.layerInfo[i][e]}hasLayerData(e,i){const r=this.layerInfo[i][e];return!(!(r!=null&&r.data)||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of Zx){const i=this.layerInfo[e];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==Yc&&r.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(Tt.SPLIT)||e!==Qt.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){const i=this._pendingUpdates;return this._pendingUpdates|=e,e===Tt.SPLIT||e===Tt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate(),i!==this._pendingUpdates}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,i,r){const s=this.layerInfo[i][e];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,e),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,e);const a=RC(s.data);return r.dataArrived(this,a),!0}if(s.requestPromise)return!0;Jl(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,i,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this._lij[0]===e[0]&&this._lij[1]===e[1]&&this._lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const i=this._children;return i[0]?i[0].findByLij(e)||i[1].findByLij(e)||i[2].findByLij(e)||i[3].findByLij(e):null}distanceToSquared(e){return sl(Re(jo,this._center[yn.MIDDLE],e))}containsPoint(e){const i=this.extent;return e[0]>=i[0]&&e[1]>=i[1]&&e[0]<=i[2]&&e[1]<=i[3]}containsPointXY(e,i){const r=this.extent;return e>=r[0]&&i>=r[1]&&e<=r[2]&&i<=r[3]}unrequestLayerData(e,i,r){const s=this.layerInfo[i][e],n=s.waitingAgents,o=n.removeUnordered(r)!=null;Nn(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(e,i,r){const s=RC(r),n=this.layerInfo[i][e];n.data=r,n.dataInvalidated=!1,n.waitingAgents.forAll(o=>o.dataArrived(this,s)),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,i){const r=this.layerInfo[i][e];r.dataMissing=!0,r.waitingAgents.forAll(s=>s.dataMissing()),r.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,i,r){switch(r&&this.forEachLoadedNeighbor(s=>s.updateRenderData(e,i)),e){case Qt.MAP:return this._updateTexture(i);case Qt.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===vn.FADING?Tt.TEXTURE_NOFADING:Tt.TEXTURE_FADING),this.setPendingUpdate(e===vn.FADING?Tt.TEXTURE_FADING:Tt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(Tt.GEOMETRY);for(const e of this.layerInfo[Qt.ELEVATION])e.pendingUpdates|=Tt.GEOMETRY}invalidateLayerData(e,i){this.layerInfo[i][e].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const e=this._elevationBoundsMin,i=this._elevationBoundsMax;let r=1/0,s=-1/0;const n=this.layerInfo[Qt.ELEVATION];let o=!0;for(const a of n)a.elevationBounds!=null&&(r=Math.min(r,a.elevationBounds.min),s=Math.max(s,a.elevationBounds.max),a.elevationBounds.hasNoDataValues||(o=!1));o&&(r=Math.min(r,0),s=Math.max(s,0)),e===r&&i===s||(this._elevationBoundsMin=r,this._elevationBoundsMax=s,this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBoundsMin,i=this._elevationBoundsMax,r=.5*(e+i),s=this._center;he(jo,this.up,r),Ee(s[yn.MIDDLE],this.centerAtSeaLevel,jo),he(jo,this.up,e),Ee(s[yn.TOP],this.centerAtSeaLevel,jo),he(jo,this.up,i),Ee(s[yn.BOTTOM],this.centerAtSeaLevel,jo)}findElevationBoundsForLayer(e,i){const r=this.layerInfo[Qt.ELEVATION][e],s=this.elevationLevelDelta,n=Math.max(this.elevationLevel-s,0),o=r.elevationBounds;if(o!=null&&o.level>=i&&o.level<=n)return;const a=this._surface.layerViewByIndex(e,Qt.ELEVATION),l=DK(a);if(!O3(this,l,!1))return;const c=T3t;let u=!1;const d=r.data;if(d&&d.level<=n){const f=r.data;c.min=f.samplerData.data.minValue,c.max=f.samplerData.data.maxValue,c.hasNoDataValues=f.samplerData.data.hasNoDataValues,c.level=this.level,u=!0}else{let f,m,g=0;for(let y=this._parent;y&&(!m||g<s)&&(g=this.elevationLevel-y.level,f=m||f,m=y.layerInfo[Qt.ELEVATION][e].data,!(!m&&f&&y.level<=n));y=y.parent);m=m||f,m&&(m.computeMinMaxValue(this._lij[0],this._lij[1],this._lij[2],c),c.min!==1/0&&(c.level=m.level,u=!0))}u&&(r.elevationBounds==null&&(r.elevationBounds=new RM),r.elevationBounds.copyFrom(c))}modifyLayers(e,i,r){const s=this.layerInfo[r];for(const a of s)a.loadingAgent&&a.loadingAgent!==Yc&&(o5(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)e[a]===void 0&&s[a].release();const n=new Array(...s),o=i.length;s.length=o;for(let a=0;a<o;a++){const l=i[a];s[a]=l>-1?n[l]:NU.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,vn.FADING))}updateAgents(e){if(this.renderData){const i=this.layerInfo[e];for(const r of i)r.loadingAgent===Yc&&(r.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of Zx){const i=this._isSuspended(e);for(const r of this.layerInfo[e])r.loadingAgent&&r.loadingAgent!==Yc&&(r.loadingAgent.setSuspension(i),r.loadingAgent===Yc&&this.updateRenderData(e,vn.FADING))}}removeLayerAgent(e,i){const r=this.layerInfo[i][e];r.loadingAgent&&r.loadingAgent!==Yc&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(e,i){const r=this.layerInfo[i][e];r.loadingAgent=Yc,r.data||r.upsampleInfo!=null||this._createOrUpdateAgents(e+1,i)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||LA(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,i,r){var s,n,o;for(let a=e;a<i;++a){const l=this._surface.layerViewByIndex(a,r);if(HL(l)&&((s=l==null?void 0:l.layer)==null?void 0:s.blendMode)!=="normal"||LA((n=l==null?void 0:l.layer)==null?void 0:n.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(e,i){const r=this.layerInfo[i];if(r.length===0)return;const s=this._isSuspended(i);for(let n=e;n<r.length;++n){const o=r[n];let a=!1;const l=this._surface.layerViewByIndex(n,i),c=DK(l);if(o.loadingAgent?O3(this,c,!1)?(o.loadingAgent!==Yc&&o.loadingAgent.setSuspension(s),o.loadingAgent!==Yc&&(a=o.loadingAgent.update())):o.dispose():O3(this,c,!1)&&(o.loadingAgent=x3t(this,n,i,s),a=o.loadingAgent.startLoading(),a?o.loadingAgent===Yc&&this.setPendingUpdate(Tt.GEOMETRY):(o5(o.loadingAgent),o.loadingAgent=Yc)),o.loadingAgent===Yc&&this.updateRenderData(i,vn.FADING),!this._hasBlendModes(e,r.length,i)&&a&&l.isOpaque)return}}_isWithinExtent(e){const i=this.extent;return i[0]>=e[0]&&e[2]>=i[2]&&i[1]>=e[1]&&e[3]>=i[3]}intersectsExtent(e){const i=this.extent;return i[2]>=e[0]&&e[2]>=i[0]&&i[3]>=e[1]&&e[3]>=i[1]}getElevationVerticesPerSide(e){const i=this.elevationLevel-this.level,r=Math.max(this.level-e,this.elevationLevelDelta-i),s=Ne(1+(this.maxTesselation>>r),2,this.maxTesselation+1),n=this.getDefaultVerticesPerSide();return Math.max(s,n)}_findLIJ(e,i){if(!e)return null;const r=this.surface.rootTiles;if(r!=null){for(const s of r)if(S3t(s,e)){let n=s,o=e[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!i(n);){const a=e[1]>>o&1,l=e[2]>>o&1;n=n.children[2*a+l],o--}return i(n)?n:null}}return null}findNeighborTile(e,i){const r=this._lij,s=this.getNeighborLIJ(r,e);return s?kU(r,s)?i(this)?this:null:this._findLIJ(s,i):null}findCorner(e,i){const r=e===Pt.NORTH_EAST?1:e===Pt.NORTH_WEST?0:e===Pt.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!i||!i(s));)s=s.children[r];return s}findNeighborCornerTileExact(e,i){var r;return((r=this.findNeighborTile(e,s=>i(s)||s.level===this.level))==null?void 0:r.findCorner(QB(e),i))||null}forAllSubtreeOnSide(e,i){const r=e===Pt.NORTH?[0,1]:e===Pt.NORTH_EAST?[1]:e===Pt.EAST?[1,3]:e===Pt.SOUTH_EAST?[3]:e===Pt.SOUTH?[2,3]:e===Pt.SOUTH_WEST?[2]:e===Pt.WEST?[0,2]:[0],s=n=>{const o=n.children;!i(n)&&o[0]&&r.forEach(a=>s(o[a]))};s(this)}getNeighborEdgeStartVertexIndex(e,i){if(!i)return 0;const r=this.level-i.level;if(Ye(!ao||r>=0),r===0)return 0;const s=2**r,n=!(1&~e),o=n?0:1,a=i.lij[o+1]*s,l=this._lij[o+1],c=l-a,u=n?s-1-c:c;return ao&&(Ye(a<=l&&l<a+s),Ye(0<=u&&u<s)),u}forEachLoadedNeighbor(e){const i=this.level,r=s=>s.level===i||s.isLoaded;If.forEach(s=>{const n=this.findNeighborTile(s,r);n!=null&&n!==this&&n.forAllSubtreeOnSide(yae(s),o=>!!o.isLoaded&&(e(o,s),!0))}),KB.forEach(s=>{var o;const n=(o=this.findNeighborTile(s,r))==null?void 0:o.findCorner(QB(s),a=>a.isLoaded);Ye(!n||zK(this,n,s)),n!=null&&n.isLoaded&&e(n,s)})}getNeighborLIJ(e,i){const r=J_e(i)?-1:X_e(i)?1:0,s=Z_e(i)?-1:Y_e(i)?1:0,n=[e[0],e[1]+r,e[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this._lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this._lij[2]===0}get isNorthEnd(){return this._lij[1]===0}get isSouthEnd(){const e=this.surface.extent,i=(e==null?void 0:e[1])??null;return i!=null&&this.extent[1]+Do()>=i}checkGeometryWaterproofness(){var e;XB&&(Ye(this.isLoaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const i=this.extent,r=this.surface.rootTilesExtent,s=.25*(i[2]-i[0]);if(J_e(e)&&i[3]+s>=r[3]||X_e(e)&&i[1]-s<=r[1])return!1;const n=this.surface.isGlobal;return!(!n&&Z_e(e)&&i[0]-s<=r[0])&&!(!n&&Y_e(e)&&i[2]+s>=r[2])}updateDistanceToPOI(e){const i=this._lastPOI;if(this.distanceToPOI>=0&&i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2])return;ve(this._lastPOI,e);const r=this._center[yn.MIDDLE],s=e[0]-r[0],n=e[1]-r[1],o=e[2]-r[2];this.distanceToPOI=s*s+n*n+o*o}get test(){return{cachedMemory:this._cachedMemory}}};function x3t(t,e,i,r){const s=i===Qt.ELEVATION?wae.acquire():bae.acquire();return s.init(t,e,i,r),s}function o5(t){t.dispose(),y3t(t)?wae.release(t):v3t(t)&&bae.release(t)}const bae=new la(_3t),wae=new la(g3t),T3t=new RM;var yn;function S3t(t,e){const i=t.lij,r=e[0]-i[0];return!(r<0)&&e[1]>>r===i[1]&&e[2]>>r===i[2]}function kU(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function E3t(t,e,i){if(t==null||e==null)return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&i===Pt.EAST||t.isWestEnd&&e.isEastEnd&&i===Pt.WEST))return!0;const r=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(i){case Pt.NORTH:return kd(t.extent[3],e.extent[1],r);case Pt.SOUTH:return kd(t.extent[1],e.extent[3],r);case Pt.EAST:return kd(t.extent[2],e.extent[0],r)||kd(t.extent[2],-e.extent[0],r);case Pt.WEST:return kd(t.extent[0],e.extent[2],r)||kd(t.extent[0],-e.extent[2],r)}}function zK(t,e,i){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?tve(t,e,i):tve(e,t,QB(i)))}function tve(t,e,i){Ye(t.level>=e.level);const r=WIt(i),s=ZIt(i),n=t.extent,o=e.extent,a=[r?n[0]:n[2],s?n[3]:n[1]],l=[r?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),u=kd(a[0],l[0],c)||t.surface.isGlobal&&kd(a[0],-l[0],c),d=kd(a[1],l[1],c);if(u&&d)return!0;if(t.level===e.level||!u&&!d)return Ye(!1),!1;const f=u?ive(o[1],o[3],n[1],n[3],c):ive(o[0],o[2],n[0],n[2],c);return Ye(f),f}function ive(t,e,i,r,s){return t-s<=i&&i<=r&&r<=e+s}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(yn||(yn={}));const a5=E(),Z9=E(),Y9=E(),jo=E();let C3t=class{constructor(){this._scales=ii(-1,-1,-1,-1),this._offsets=ii(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,i,r){this._scales[2*e]=i,this._scales[2*e+1]=r}setOffset(e,i,r){this._offsets[2*e]=i,this._offsets[2*e+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}};function M3t(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(T`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(T`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(T`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}function xae(t){t.code.add(T`
    float lineFactorAtPosition(float value) {
      float pos = value * ${T.float(257)};
      if(pos < 0.5 || pos > ${T.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}var Dg;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(Dg||(Dg={}));let A3t=class extends uoe{constructor(){super(...arguments),this.overlayOpacity=1}};function P3t(t,e){const{vertex:i,fragment:r,varyings:s}=t;s.add("vtc","vec2"),i.uniforms.add(new rve("texOffsetAndScale")),r.uniforms.add(new sve("tex")),r.uniforms.add(new X9("textureOpacities"));const n=e.textureFadingEnabled&&!e.renderOccluded;n&&(i.uniforms.add(new rve("nextTexOffsetAndScale")),s.add("nvtc","vec2"),r.uniforms.add(new sve("texNext")),r.uniforms.add(new X9("nextTexOpacities")),r.uniforms.add(new O3t("fadeFactor")));const o=e.tileBlendInput===Dg.ColorComposite,a=e.tileBlendInput===Dg.GridComposite;a&&r.include(xae),o&&r.uniforms.add(new X9("backgroundColor")),i.code.add(T`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${n?T`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:T``}
  }`),r.code.add(T`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?T`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?T`backgroundColor`:T`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:T`return color;`}
    }`),n?r.code.add(T`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):r.code.add(T`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let O3t=class extends Vs{constructor(e){super(e,"float")}},X9=class extends Vs{constructor(e){super(e,"vec3")}},rve=class extends Vs{constructor(e){super(e,"vec4")}},sve=class extends Vs{constructor(e){super(e,"sampler2D")}},Tae=class extends A3t{};function bke(t){const e=new Hi,{vertex:i,fragment:r,varyings:s}=e;e.include(FD),e.include(aO,t),e.include(Af,t);const n=()=>{e.include(VL,t),i.code.add(T`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};Nc(i,t),e.include(al,t);const o=t.overlayMode!==Rg.Disabled,a=o&&t.invisible;switch(t.output){case j.Color:{e.include(P3t,t),e.include(e2,t),o&&e.include(rR,{...t,pbrMode:t.pbrMode===At.Simplified?At.TerrainWithWater:At.Water});const l=t.overlayMode===Rg.EnabledWithWater;l&&e.include(M3t,t),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),n(),t.screenSizePerspective&&uP(i);const c=t.receiveShadows&&!t.renderOccluded;c&&e.include(sO,t),t.screenSizePerspective&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),i.code.add(T`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${l?T`forwardVertexTangent(vnormal);`:T``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?T`setOverlayVTC(uv);`:""}
          ${t.tileBorders?T`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?T`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${c?T`forwardLinearDepth();`:""}

        }
      `),e.include(bn,t),e.include(e2,t),e.include(JD,t),e.include(vP,t),Qf(r,t),QD(r),uO(r),r.uniforms.add(i.uniforms.get("localOrigin"),new Wt("viewDirection",(u,d)=>Ce(nve,de(nve,d.camera.viewMatrix[12],d.camera.viewMatrix[13],d.camera.viewMatrix[14])))),l&&r.uniforms.add(new wt("ovWaterTex",(u,d)=>{var f;return(f=d.overlay)==null?void 0:f.getTexture(is.WaterNormal)}),new U$e("view",(u,d)=>dl(R3t,d.camera.viewMatrix,u.origin))),r.code.add(T`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),C_(r),my(r),r.code.add(T`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?T`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?T`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===At.Simplified||t.pbrMode===At.TerrainWithWater?T`fragColor = vec4(evaluatePBRSimplifiedLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:T`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${l?T`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?T`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?T`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:T`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?T`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case j.Depth:a&&e.include(rR,t),i.code.add(T`
              void main(void) {
                ${a?T`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPosition(proj, view, position);
              }
          `),r.code.add(T`
              void main() {
                ${a?T`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              }
          `);break;case j.Shadow:case j.ShadowHighlight:case j.ShadowExcludeHighlight:case j.ViewshedShadow:e.include(M6,t),OJ(e),XG(e),i.code.add(T`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),r.code.add(T`void main() {
outputDepth(linearDepth);
}`);break;case j.Normal:a&&e.include(rR,t),s.add("vnormal","vec3"),uP(i),n(),i.code.add(T`
        void main(void) {
          ${a?T`setOverlayVTC(getUV0());`:""}
          gl_Position = transformPosition(proj, view, position);
          vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
        }
      `),r.code.add(T`
        void main() {
          ${a?T`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
          vec3 normal = normalize(vnormal);
          if (gl_FrontFacing == false) {
            normal = -normal;
          }
          fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
        }
      `);break;case j.Highlight:o&&e.include(rR,t),i.code.add(T`
          void main() {
            ${o?T`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(rw,t),r.code.add(T`
          void main() {
            ${o?T`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===j.ObjectAndLayerIdColor&&(o?(e.include(rR,{...t,pbrMode:At.Disabled}),i.code.add(T`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),r.code.add(T`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)):(i.code.add(T`void main(void) {
        ${t.opaque?T` gl_Position = transformPosition(proj, view, position);`:""}
      }`),r.code.add(T`void main() {
fragColor = vec4(0.0);
}`))),e}const R3t=ke(),nve=E(),$3t=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:Tae,build:bke},Symbol.toStringTag,{value:"Module"}));let wke=class xke extends Qi{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,i){i.spherical=e.viewingMode===Xe.Global}initializeProgram(e){return new Ki(e.rctx,xke.shader.get().build(this.configuration),Tke)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const i=this.configuration,r=i.backfaceCullingEnabled&&!i.renderOccluded;return Jt({blending:i.renderOccluded?Hh(Be.ONE,Be.ONE_MINUS_SRC_ALPHA):null,culling:r?Vse:null,depthTest:i.renderOccluded?null:{func:br.LESS},depthWrite:i.renderOccluded?null:Nu,colorWrite:ui,stencilTest:e?J0t(kc.IntegratedMeshMaskExcluded):null,drawBuffers:i.output===j.Depth?{buffers:[no.NONE]}:null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}};wke.shader=new qi($3t,()=>ce(()=>Promise.resolve().then(()=>RHt),void 0));const Tke=new Map([[R.POSITION,0],[R.UV0,1],[R.NORMALCOMPRESSED,2]]);let I3t=class{constructor(){this.geometry=new r3t,this.intersectionData=null,this.geometryState=null,this._vao=null,this._texture=null,this._textureRef=new yke(()=>this.tile.surface.fadeDuration),this.overlay=new C3t,this._localOrigin=null,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._modifiedFlags=0}get tile(){return this._tile}get localOrigin(){return this._localOrigin}init(e,i){this.clear(),this._tile=e,this.geometry.reset(),this.intersectionData=null,this.geometryState=new n3t,this._localOrigin=i,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this.wireframeChanged||this.clippingAreaChanged||this.samplerDataChanged||this.numVerticesPerSideChanged||this.dirtyCorners||this.dirtyEdgeResolutions||this.dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),ao&&this.tile.intersectsClippingArea)for(let i=0;i<4;++i)Ye(this.geometry.getEdgeCount(i)===this.geometryState.edgeResolutions[i]+1)}_calculateEdgeResolution(e,i){var l;const r=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const c=r.surface.extent;if(c!=null&&(e===0&&r.extent[3]>c[3]||e===1&&r.extent[2]>c[2]||e===2&&r.extent[1]<c[1]||e===3&&r.extent[0]<c[0]))return s}const n=r.level,o=If[e];if(!i)return Ye(((l=r.surface)==null?void 0:l.rootTiles)==null||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(o)),s;if(i.isLoaded){const c=i,u=c.renderData.geometryState,d=n-c.level;if(Ye(d>=0),d===0){const g=u.numVerticesPerSide-1;return Math.max(g,s)}const f=2**d,m=u.edgeResolutions[(e+2)%4]/f;return Math.max(1,m)}Ye(!i.isLeaf);let a=s;return i.forAllSubtreeOnSide(yae(o),c=>c===r||(c.isLoaded?(a=Math.max(a,2**(c.level-n)),!0):(Ye(!c.isLeaf),!1))),a}updateNeighborData(){var o;const e=this.tile;if(!e.intersectsClippingArea)return;const i=e.renderData.geometryState,r=a=>(a.isLoaded||a.level===e.level)&&(a==null?void 0:a.intersectsClippingArea),s=i.edgePeerNeighbors,n=i.edgePeerNeighborSamplerVersions;for(let a=0;a<4;++a){const l=e.findNeighborTile(If[a],r),c=AT(e,l),u=((o=c==null?void 0:c.renderData)==null?void 0:o.geometryState.samplerDataVersion)??-1,d=s[a],f=c!==AT(e,d),m=n[a]!==u;ao&&l&&(Ye(e.level>=l.level),Ye(e.level-l.level<=Vn)),s[a]=l,(f||m)&&(n[a]=u,this._markEdgeDirty(a));const g=i.edgeResolutions[a],y=this._calculateEdgeResolution(a,l);Ye(rL(y)),Ye(y>=1),i.edgeResolutions[a]=y,g!==y&&this._markEdgeResolutionDirty(a)}for(let a=0;a<4;++a){const l=e.findNeighborTile(KB[a],r);i.cornerPeerNeighbors[a]=l;const c=AT(e,s[a]),u=AT(e,s[(a+1)%4]),d=AT(e,l);Ap[a]=d,Ap[(a+1)%4]=u,Ap[(a+2)%4]=e,Ap[(a+3)%4]=c,Ye(Ap.some(y=>(y==null?void 0:y.isLoaded)||y===e));const f=Ap.reduce((y,v)=>Math.min(y,(v==null?void 0:v.level)??1/0),1/0);Ap.forEach((y,v)=>{y&&(y==null?void 0:y.level)>f&&(Ap[v]=null)}),Ye(Ap.some(y=>(y==null?void 0:y.isLoaded)||y===e));const m=i.cornerNeighborCornerTiles,g=i.cornerNeighborCornerTileSamplerVersions;for(let y=0;y<4;++y){const v=Ap[y],b=(v==null?void 0:v.renderData.geometryState.samplerDataVersion)??-1,w=4*a+y,x=m[w]!==v,S=!x&&g[w]!==b;(x||S)&&(m[w]=v,g[w]=b,this._markCornerDirty(a))}ao&&Ye(Sae.some(y=>{var v;return((v=m[4*a+y])==null?void 0:v.isLoaded)||m[4*a+y]===e}))}ao&&Ye(this.geometryState.edgeResolutions.every(a=>a>0));for(let a=0;a<4;++a)Ap[a]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;ao&&Ye(!this.tile.intersectsClippingArea||this.geometryState.edgeResolutions.every(m=>m>0)),this.intersectionData=null;const{tile:i,_vao:r,geometry:s,geometryState:n}=this,o=!r||!1||this.wireframeChanged||this.samplerDataChanged||this.clippingAreaChanged||this.numVerticesPerSideChanged,a=this.dirtyEdgeResolutions!==0,l=n.edgeResolutions.reduce((m,g)=>m+g+1,0),c=o||a&&l>((s==null?void 0:s.maxEdgeVertexCount)??0),u=!c&&a,d=!u&&(this.dirtyEdges!==0||a),f=!d&&this.dirtyCorners!==0;c?(this.releaseGeometry(),this._createGeometry(e)):u?i.updateEdgeElevationsAndResolutions():d||f?i.updateEdgeElevations():f?i.updateCornerElevations():console.warn("Update for no reason?"),this._modifiedFlags=0}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=Ut(this._vao),this.geometry.release(),!0)}ensureTexture(e,i,r){const s=i?Ht.RGBA:Ht.RGB;return this._texture==null||this._texture.descriptor.width===e&&this._texture.descriptor.pixelFormat===s||this.releaseTexture(),this._texture==null&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}get numVerticesPerSideChanged(){return!!(this._modifiedFlags&D3t)}get samplerDataChanged(){return!!(this._modifiedFlags&N3t)}get clippingAreaChanged(){return!!(this._modifiedFlags&F3t)}get wireframeChanged(){return!!(this._modifiedFlags&k3t)}get dirtyEdges(){return this._modifiedFlags>>J9&15}get dirtyCorners(){return this._modifiedFlags>>Q9&15}get dirtyEdgeResolutions(){return this._modifiedFlags>>K9&15}_markCornerDirty(e){const i=1<<e<<Q9;this._modifiedFlags|=i}_markEdgeDirty(e){const i=1<<e<<J9;this._modifiedFlags|=i,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const i=1<<e<<K9;this._modifiedFlags|=i,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._modifiedFlags|=15<<Q9|15<<J9|15<<K9}updateGeometryState(){const e=this._getElevationInfo(),i=this.tile,r=e.samplerData?i.getElevationVerticesPerSide(e.maxTileLevel):i.getDefaultVerticesPerSide(),s=Math.max(r,5);let n=i.clippingArea;i.intersectsClippingArea&&!i.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==s&&(this._modifiedFlags|=1,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),e.changed&&(this._modifiedFlags|=2,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),db(o.clippingArea,n)||(this._modifiedFlags=4,o.clippingArea=n,a=!0);const l=i.surface.wireframe;return o.wireframe!==l&&(this._modifiedFlags=8,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const i=this.geometry.vertexAttributes,r=this.geometry.indices,s=e.gl;this._vao=new _y(e,Tke,{geometry:ku(i.layout)},{geometry:Sr.createVertex(e,s.STATIC_DRAW,i.buffer)},Sr.createIndex(e,s.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,i=cb.Immediate){e!=null&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,i=this.tile.layerInfo[Qt.ELEVATION],r=i.length,s=new Array(r);let n=0,o=0,a=!1;for(let u=0;u<r;u++){const d=i[u];if(d.upsampleInfo!=null){const f=d.upsampleInfo.tile,m=f.layerInfo[Qt.ELEVATION][u].data,g=m&&m.samplerData;e&&e[n]===g||(a=!0),s[n++]=g,o=Math.max(o,f.lij[0])}else if(d.data){const f=this.tile.surface.layerViewByIndex(u,Qt.ELEVATION);if(O3(this.tile,f.layer,!1)){const m=d.data;e&&e[n]===m.samplerData||(a=!0),s[n++]=m.samplerData,o=this.tile.level}}}e!=null&&e.length!==n&&(a=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var i,r,s;const e=((i=this.intersectionData)==null?void 0:i.estimatedMemoryUsage)??0;return(((r=this.geometry.indices)==null?void 0:r.byteLength)??0)+(((s=this.geometry.vertexAttributes)==null?void 0:s.byteLength)??0)+e}get texture(){return this._texture}get test(){}checkGeometryWaterproofness(){if(!ao)return;const e=this.tile;if(!e.isLoaded||!e.intersectsClippingArea||e.level===0)return void Ye(e==null?void 0:e.isLoaded);const i=e.surface.extent;if(i!=null&&!e.intersectsExtent(i))return;const r=If.map((a,l)=>i!=null&&(l<2?-1:1)*(e.extent[3-l]-i[3-l])<0),s=e.level;Ye(this.dirtyCorners===0),Ye(this.dirtyEdges===0),Ye(this.dirtyEdgeResolutions===0),Ye(!this.numVerticesPerSideChanged),Ye(!this.samplerDataChanged),Ye(!this.clippingAreaChanged),Ye(!this.wireframeChanged);const n=KB.map(a=>e.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.isLoaded||l.level===e.level)??null).map(a=>a!=null&&a.intersectsClippingArea?a:null),o=this.geometryState;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=n[a];Ye(c===l,`Tile[${e.lij}].corner[${a}] out of date: cur=[${l==null?void 0:l.lij}] exp=[${c==null?void 0:c.lij}]`)}If.forEach((a,l)=>{if(r[l])return;const c=e.findNeighborTile(a,J=>(J.level===s||(J==null?void 0:J.isLoaded))&&(J==null?void 0:J.intersectsClippingArea));if(!c){const J=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(a);return void Ye(!J)}Ye(c.isLoaded||c.level===e.level),Ye(c===this.geometryState.edgePeerNeighbors[l]);const u=s-c.level;if(!c.isLoaded)return Ye(!c.isLeaf),void Ye(u===0);const d=c.renderData;Ye(E3t(e,c,a)),Ye(u>=0);const f=2**u;if(u<0)return void Ye(!1);const m=e.renderData,g=m.geometry,y=m.localOrigin,v=g.getEdgeCount(l),b=g.numVerticesPerSide-1,w=d.geometry;if(!w)return void Ye(!1);const x=d.localOrigin,S=this.geometryState.edgePeerNeighbors[l];if(S!=null&&S.isLoaded){const J=S.renderData;Ye(m.geometryState.edgePeerNeighborSamplerVersions[l]===J.geometryState.samplerDataVersion),Ye(this.geometryState.edgePeerNeighborSamplerVersions[l]===J.geometryState.samplerDataVersion)}const C=(l+2)%4,M=w.getEdgeCount(C),O=v-1,D=M-1;Ye(O*f===D,`Tile[${e.lij}]:e${l},res=${O} edgeRes mismatch with Neighbor[${c.lij}]:e${C},res=${D} (expected:${O*f})`);const U=e.extent,k=a===Pt.NORTH||a===Pt.SOUTH,H=M-1,V=H>>u,X=v-1;if(V<1)return void Ye(X===1);Ye(V===X),Ye(rL(V));const q=w.numVerticesPerSide-1;Ye(u>0||V===Math.max(q,b));const Z=e.getNeighborEdgeStartVertexIndex(l,c);Ye(0<=Z&&Z<f);const ye=Z*V;Ye(0<=ye&&ye<=H-V);let L=0,N=ye;g.getEdgeVertexPosition(l,Cm,y,0),g.getEdgeVertexPosition(l,Mm,y,v-1);const z=Cr(Cm,Mm),W=Math.max(L3t,1e-4*z);for(let J=0;J<=V;++J){g.getEdgeVertexPosition(l,Cm,y,L),w.getEdgeVertexPosition(C,Mm,x,N);const K=J/V,ne=k?U[0]+K*(U[2]-U[0]):a===Pt.WEST?U[0]:U[2],we=k?a===Pt.SOUTH?U[1]:U[3]:U[1]+K*(U[3]-U[1]),Ie=e.surface.extent;if(Ie==null||nG(Ie,ne,we)){const je=Y1(Cm,Mm),ut=kl(Cm)-lr.radius,ot=kl(Mm)-lr.radius,at=je<W;if(!at){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${L}/${v}] and [${c.lij}].edge${C}[${N}/${M}]`),Ie!=null&&console.warn("  surface extent= ",Ie," x,y=",ne,",",we);const li=E();Re(li,m.localOrigin,d.localOrigin),kl(li)>0&&console.warn(`   localOrigins: ${m.localOrigin} vs ${d.localOrigin} d=${kl(li)} [${li}]`),(()=>{const re=hn(Cm),Ae=hn(Mm);e.updateEdgeElevations(),c.updateEdgeElevations(),g.getEdgeVertexPosition(l,Cm,y,L),w.getEdgeVertexPosition(C,Mm,x,N);const ae=E();Ii(ae,Cm,re),kl(ae)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${re} vs ${Cm} d=${kl(ae)} [${ae}]`),Ii(ae,Mm,Ae),kl(ae)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${Ae} vs ${Mm} d=${kl(ae)} [${ae}]`)})();const Y=g.getEdgeCount(l),ee=w.getEdgeCount(M);Ye(at,`Mismatch in tile [${e.lij}].edge[${l}][${L}/${Y}] vs neighbor [${c.lij}].edge[${C}][${N}/${ee}] ${jy(Cm)} vs ${jy(Mm)}  dist=${je} h(t|n|d)=${ut}|${ot}|${ot-ut}`)}g.getEdgeNormal(l,LE,L),w.getEdgeNormal(C,DE,N),Ce(ove,LE),Ce(ave,DE);const tt=Te(ove,ave),rt=1-tt<.01||!1||e===c;if(!rt){const li=E();Ii(li,LE,DE);const Y=()=>`Mismatch in tile edge normal ${W_e(e.lij)} (${L}/${v-1}) edge ${l} vs neighbor ${W_e(c.lij)}  (${N}/${M-1}) nedge ${C} :${jy(LE)} vs ${jy(DE)}  dot = ${tt} : ${jy(li)}`;console.warn("Mismatch in tile edge normal: ",Y());{e.updateEdgeElevations(),c.updateEdgeElevations();const ee=E(),re=E();g.getEdgeNormal(l,ee,L),w.getEdgeNormal(C,re,N),US(LE,ee)||console.warn("Missing update in tile normal: ",jy(LE)," => ",jy(ee)),US(DE,re)||console.warn("Missing update in neighbor normal: ",jy(DE)," => ",jy(re))}Ye(rt,Y())}}L+=1,N+=1}})}};const Cm=E(),Mm=E(),LE=E(),DE=E(),ove=E(),ave=E(),L3t=1,Ap=[null,null,null,null];function AT(t,e){return e!=null&&e.isLoaded||e===t?e:null}const D3t=1,N3t=2,F3t=4,k3t=8,J9=4,Q9=8,K9=12,Sae=[0,1,2,3],U3t=65536;function V3t(t,e){const{tile:i,geometry:r,geometryState:s}=t,{extentInRadians:n,surface:o}=i,{isWebMercator:a,renderer:l}=o,{numVerticesPerSide:c,wireframe:u}=s,d=c-1,f=(c-2)**2,m=a&&(e===Fd.HAS_SOUTH_POLE||e===Fd.HAS_BOTH_POLES),g=a&&(e===Fd.HAS_NORTH_POLE||e===Fd.HAS_BOTH_POLES),y=((m?1:0)+(g?1:0))*UU*c,v=kke(s),b=f+y+4*v,w=l.tileGeometryCache.acquire(b);r.numVerticesPerSide=c,r.vertexAttributes=w,r.maxEdgeVertexCount=v;const{boundingBox:x}=r;Zr(x);const S=Cae(t);Jo.update(d,n,S),B3t(t),r.poleVerticesStartIndex=f;const C=z3t(t,m,g);r.edgeVerticesStartIndex=f+y,Aae(t),Eae(t),Oke(r,C,u),t.intersectionData=null}function z3t(t,e,i){const{tile:r,localOrigin:s,geometry:n}=t,{extent:o,ellipsoid:a}=r,{boundingBox:l,numVerticesPerSide:c,vertexAttributes:u,poleVerticesStartIndex:d}=n,f=c-1,m=s[0],g=s[1],y=s[2],v=a.radius,b=o[1],w=o[3],x=[];let S=d;const C=(M,O)=>{const D=O*c;Qd(-m,-g,M*v-y,l),x.push(new oLt(M===1,D,M===1?0:2,S,UU));const U=Cke(M===-1?b:w,v),k=M*Math.PI/2-U,H=.99*(M===1?1:-1),V=v+0,{position:X,uv0:q}=u,{typedBuffer:Z,typedBufferStride:ye}=u.normalCompressed;for(let L=1;L<=UU;++L){const N=U+k*(L/UU),z=Math.cos(N),W=Math.sin(N);for(let J=0;J<=f;J++){const K=J/f,ne=Jo.sinLonLUT[J],we=Jo.cosLonLUT[J]*z,Ie=ne*z,je=W,ut=we*V-m,ot=Ie*V-g,at=je*V-y;Qd(ut,ot,at,l),X.setValues(S,ut,ot,at),Vf(q,S,K,H),np(Z,S,we,Ie,je,ye),++S}}};return e&&C(-1,0),i&&C(1,f),x}function B3t(t){const{tile:e}=t;if(!e.intersectsClippingArea)return;const{geometry:i,geometryState:r,localOrigin:s}=t,{numVerticesPerSide:n,samplerData:o}=r,a=n-2,l=n-1,{vertexAttributes:c,boundingBox:u}=i,d=c.position,f=c.uv0,{typedBuffer:m,typedBufferStride:g}=c.normalCompressed,{extent:y}=e,v=y[0],b=y[2],w=y[1],x=y[3],S=e.ellipsoid.radius,C=s[0],M=s[1],O=s[2],D=d.typedBuffer,U=d.typedBufferStride,k=1/l;let H=0;if(1<=a){const V=k,X=w*(1-V)+x*V,q=Jo.sinLatLUT[1],Z=Jo.cosLatLUT[1];for(let ye=1;ye<=a;ye++){const L=ye*k,N=v*(1-L)+b*L,z=Jo.sinLonLUT[ye],W=Jo.cosLonLUT[ye],J=S+Ts(N,X,o),K=J*W*Z-C,ne=J*z*Z-M,we=J*q-O;Qd(K,ne,we,u);const Ie=(ye-1)*U;D[Ie]=K,D[Ie+1]=ne,D[Ie+2]=we,Vf(f,ye-1,L,V)}}for(let V=1;V<=a;V++){const X=V*k,q=w*(1-X)+x*X,Z=Jo.sinLatLUT[V],ye=Jo.cosLatLUT[V],L=V+1,N=L*k,z=w*(1-N)+x*N,W=Jo.sinLatLUT[L],J=Jo.cosLatLUT[L],K=Jo.sinLonLUT[0],ne=Jo.cosLonLUT[0],we=S+Ts(v,q,o);let Ie=ne*ye*we-C,je=K*ye*we-M,ut=Z*we-O;const ot=H*U;let at=D[ot],tt=D[ot+1],rt=D[ot+2];for(let li=1;li<=a;li++){const Y=li*k,ee=v*(1-Y)+b*Y,re=Jo.sinLonLUT[li],Ae=Jo.cosLonLUT[li];let ae=0,fe=0,Me=0;if(li<a){const Si=(H+1)*U;ae=D[Si],fe=D[Si+1],Me=D[Si+2]}else{const Si=Jo.sinLonLUT[l],Qr=Jo.cosLonLUT[l],zs=S+Ts(b,q,o);ae=Qr*ye*zs-C,fe=Si*ye*zs-M,Me=Z*zs-O}const Oe=Ie,be=je,xe=ut;Ie=at,je=tt,ut=rt,at=ae,tt=fe,rt=Me;const _e=ae-Oe,Le=fe-be,Fe=Me-xe;let lt=0,ct=0,Vt=0;if(V>1){const Si=(H-a)*U;lt=D[Si],ct=D[Si+1],Vt=D[Si+2]}else{const Si=Jo.sinLatLUT[0],Qr=Jo.cosLatLUT[0],zs=S+Ts(ee,w,o);lt=Ae*Qr*zs-C,ct=re*Qr*zs-M,Vt=Si*zs-O}const Ct=S+Ts(ee,z,o),Zt=Ae*J*Ct-C,Xt=re*J*Ct-M,vi=W*Ct-O;if(V<a){const Si=H+a,Qr=Si*U;D[Qr]=Zt,D[Qr+1]=Xt,D[Qr+2]=vi,Qd(Zt,Xt,vi,u),Vf(f,Si,Y,N)}const xi=lt-Zt,Di=ct-Xt,Nt=Vt-vi;let jt=Ae*ye,ei=re*ye,dr=Z;dr*dr<.999&&(jt=Fe*Di-Le*Nt,ei=_e*Nt-Fe*xi,dr=Le*xi-_e*Di);const pn=1/Math.sqrt(jt*jt+ei*ei+dr*dr);np(m,H,jt*pn,ei*pn,dr*pn,g),++H}}}function j3t(t){t.tile.intersectsClippingArea&&(Eae(t),pO(t),t.intersectionData=null)}function G3t(t){t.tile.intersectsClippingArea&&(Ike(t),Eae(t),pO(t),Nke(t),t.intersectionData=null)}function H3t(t){t.tile.intersectsClippingArea&&(Eke(t),Ske(t,!0),pO(t),t.intersectionData=null)}function Eae(t){t.tile.intersectsClippingArea&&(Eke(t),Ske(t))}function Ske(t,e=!1){const{geometry:i,geometryState:r,tile:s,localOrigin:n}=t,{level:o,extent:a,extentInRadians:l,ellipsoid:c}=s,u=c.radius,d=l[0],f=l[2],m=l[1],g=l[3],{samplerData:y}=r,v=a[0],b=a[2],w=a[1],x=a[3],S=Cae(t),{boundingBox:C,vertexAttributes:M}=i,O=n[0],D=n[1],U=n[2],k=M.position,H=k.typedBuffer,V=k.typedBufferStride,X=M.uv0;for(let q=0;q<4;++q){const Z=q===1||q===3,ye=r.edgeResolutions[q];Ye(rL(ye));const L=ye+1,N=AT(s,r.edgePeerNeighbors[q]);if(Fke(s,N,q)){Lke(t,q,N);continue}const z=N!=null;Ye(!z||N.level===s.level),Ye(!z||Lg(s,N)<=0);const W=N==null?void 0:N.renderData,J=W==null?void 0:W.geometryState;if(ao){const _e=s.surface;if(!N&&_e&&!_e.updatingRootTiles){const Le=If[q],Fe=s.findNeighborTile(Le,lt=>lt.isLoaded||lt.isLeaf||lt.level===s.level);Fe?Fe.intersectsClippingArea&&(Ye(!Fe.isLoaded),Ye(!Fe.isLeaf),Ye(Fe.level===o)):Ye((_e==null?void 0:_e.rootTiles)==null||!s.shouldHaveNeighbor(Le))}}const K=q===1?a[2]:a[0],ne=N==null?void 0:N.extent,we=ne&&Z?q===1?ne[0]:ne[2]:K,Ie=q===0?a[3]:a[1],je=q===1?1:0,ut=q===0?1:0,ot=q===1?f:d,at=q===0?g:m,tt=Math.sin(ot),rt=Math.cos(ot),li=Math.sin(at),Y=Math.cos(at),ee=J==null?void 0:J.samplerData,re=z?(_e,Le,Fe)=>.5*(Ts(_e,Le,y)+Ts(Fe,Le,ee)):(_e,Le,Fe)=>Ts(_e,Le,y),Ae=i.outerEdgesOffsetAndLength[2*q+0],ae=e&&L>3?L-3:1,fe=y!=null&&y.some(_e=>_e!=null),Me=ee!=null&&ee.some(_e=>_e!=null),Oe=fe||Me,be=1/ye,xe=Ae;Ye(!ne||kd(ne[2]-ne[0],a[2]-a[0])),(()=>{const _e=q===1?-1:q===3?1:0,Le=q===0?-1:q===2?1:0,Fe=(a[2]-a[0])*be,lt=_e*Fe,ct=Le*Fe,Vt=Z?_e*((f-d)*be):0,Ct=Z?0:Le*be,Zt=ut,Xt=Z?ot+Vt:ot,vi=Z?Math.sin(Xt):tt,xi=Z?Math.cos(Xt):rt,Di=Z?ot-Vt:ot,Nt=Z?Math.sin(Di):tt,jt=Z?Math.cos(Di):rt,ei=Z?at:S(Zt+Ct),dr=Z?li:Math.sin(ei),pn=Z?Y:Math.cos(ei),Si=Z?at:S(Zt-Ct),Qr=Z?li:Math.sin(Si),zs=Z?Y:Math.cos(Si);let Vo=0,vl=0,bl=0;{const Pi=0*be,as=Z?K:v*(1-Pi)+b*Pi,$n=Z?we:as,fo=Z?w*(1-Pi)+x*Pi:Ie,me=Z?ot:d*(1-Pi)+f*Pi,nr=Z?tt:Math.sin(me),pp=Z?rt:Math.cos(me),mo=Z?S(Pi):at,fp=Z?Math.sin(mo):li,Et=Z?Math.cos(mo):Y,jc=u+re(as,fo,$n);Vo=pp*Et*jc,vl=nr*Et*jc,bl=fp*jc}let zo=0,Sn=0,Bs=0;{const Pi=1*be,as=Z?K:v*(1-Pi)+b*Pi,$n=Z?we:as,fo=Z?w*(1-Pi)+x*Pi:Ie,me=Z?ot:d*(1-Pi)+f*Pi,nr=Z?tt:Math.sin(me),pp=Z?rt:Math.cos(me),mo=Z?S(Pi):at,fp=Z?Math.sin(mo):li,Et=Z?Math.cos(mo):Y,jc=u+re(as,fo,$n);zo=pp*Et*jc,Sn=nr*Et*jc,Bs=fp*jc}for(let Pi=1;Pi<L-1;Pi+=ae){let as=0,$n=0,fo=0;{const wl=(Pi+1)*be,Gc=Z?K:v*(1-wl)+b*wl,nm=Z?we:Gc,yo=Z?w*(1-wl)+x*wl:Ie,Ps=Z?ot:d*(1-wl)+f*wl,U_=Z?tt:Math.sin(Ps),hw=Z?rt:Math.cos(Ps),dw=Z?S(wl):at,F2=Z?Math.sin(dw):li,pw=Z?Math.cos(dw):Y,V_=u+re(Gc,yo,nm);as=hw*pw*V_,$n=U_*pw*V_,fo=F2*V_}const me=as,nr=$n,pp=fo,mo=zo,fp=Sn,Et=Bs;zo=me,Sn=nr,Bs=pp;{const wl=xe+Pi,Gc=wl*V,nm=mo-O,yo=fp-D,Ps=Et-U;H[Gc]=nm,H[Gc+1]=yo,H[Gc+2]=Ps,Qd(nm,yo,Ps,C);const U_=Pi*be;Vf(X,wl,Z?je:U_,Z?U_:ut)}const jc=Vo,go=vl,lw=bl;Vo=mo,vl=fp,bl=Et;const cw=mo,ic=fp,Ey=Et,uw=1/Math.sqrt(cw*cw+ic*ic+Ey*Ey),pi=Ey*uw;let F_=0,Cy=0,k_=0;if(Oe&&pi*pi<.999){let wl=0,Gc=0,nm=0;{const yo=q===0?-1:1;wl=yo*(me-jc),Gc=yo*(nr-go),nm=yo*(pp-lw)}{const yo=Pi*be,Ps=Z?K:v*(1-yo)+b*yo,U_=Z?we:Ps,hw=Z?w*(1-yo)+x*yo:Ie,dw=Z?ot:d*(1-yo)+f*yo,F2=Z?tt:Math.sin(dw),pw=Z?rt:Math.cos(dw),V_=Z?S(yo):at,yN=Z?Math.sin(V_):li,rc=Z?Math.cos(V_):Y;let yO=cw,_O=ic,Q=Ey;if(z){const $e=u+Ts(U_-lt,hw-ct,ee),He=Z?rc:zs;yO=(Z?jt:pw)*He*$e,_O=(Z?Nt:F2)*He*$e,Q=(Z?yN:Qr)*$e}{const $e=u+Ts(Ps+lt,hw+ct,y),He=Z?rc:pn,Oi=(Z?xi:pw)*He*$e,En=(Z?vi:F2)*He*$e,js=(Z?yN:dr)*$e;z||(yO=2*cw-Oi,_O=2*ic-En,Q=2*Ey-js);const xl=q===3?-1:1,fw=xl*(yO-Oi),Cle=xl*(_O-En),Mle=xl*(Q-js);F_=nm*Cle-Gc*Mle,Cy=wl*Mle-nm*fw,k_=Gc*fw-wl*Cle;const hH=1/Math.sqrt(F_*F_+Cy*Cy+k_*k_);F_*=hH,Cy*=hH,k_*=hH}}}else F_=cw*uw,Cy=ic*uw,k_=Ey*uw;i.setEdgeNormalFromValues(q,Pi,F_,Cy,k_)}})()}}function Eke(t){Dke(t)}function Cke(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function q3t(t,e,i,r){return Cke(t*(1-r)+e*r,i)}function W3t(t,e,i){return t*(1-i)+e*i}function Cae(t){const{tile:e}=t;if(e.surface.isWebMercator){const r=e.extent,s=e.ellipsoid.radius;return n=>q3t(r[1],r[3],s,n)}const i=e.extentInRadians;return r=>W3t(i[1],i[3],r)}function Z3t(t,e){const{tile:i,geometryState:r,geometry:s}=t,{extent:n,surface:o}=i,{wireframe:a}=r,l=n[0],c=n[1],u=n[2]-l,d=n[3]-c,{numVerticesPerSide:f,clippingArea:m}=r,g=m!=null?Math.max(0,(m[0]-l)/u):0,y=m!=null?Math.max(0,(m[1]-c)/d):0,v=m!=null?Math.min(1,(m[2]-l)/u):1,b=m!=null?Math.min(1,(m[3]-c)/d):1,w=(f-2)**2,x=kke(r),S=w+4*x,C=o.renderer.tileGeometryCache.acquire(S),{boundingBox:M}=s;Zr(M),s.numVerticesPerSide=f,s.vertexAttributes=C,s.maxEdgeVertexCount=x,s.minu=g,s.minv=y,s.maxu=v,s.maxv=b,Y3t(t),s.edgeVerticesStartIndex=w,Aae(t),Mae(t),Oke(s,[],a),t.intersectionData=null}function Y3t(t){const e=t.tile;if(!e.intersectsClippingArea)return;const{geometry:i,geometryState:r,localOrigin:s}=t,{samplerData:n,clippingArea:o,numVerticesPerSide:a}=r,{surface:l,extent:c,ellipsoid:u}=e,{isWebMercatorOnPlateCarree:d}=l,f=o??Pae,m=c[0],g=c[1],y=c[2],v=c[3],b=Math.max(m,f[0]),w=Math.min(y,f[2]),x=Math.max(g,f[1]),S=Math.min(v,f[3]),C=u.radius,M=e.horizontalScale,O=a-1,D=a-2,{minu:U,minv:k,maxu:H,maxv:V,boundingBox:X,vertexAttributes:q}=i,Z=q.position,ye=q.uv0,{typedBuffer:L,typedBufferStride:N}=q.normalCompressed,z=s[0],W=s[1],J=s[2],K=Z.typedBuffer,ne=Z.typedBufferStride;let we=0;const Ie=Ne(g,x,S),je=d?(Math.PI/2-2*Math.atan(Math.exp(-Ie/C)))*C:Ie*M,ut=1/O,ot=Ne(g*(1-ut)+v*ut,x,S);let at=je,tt=d?(Math.PI/2-2*Math.atan(Math.exp(-ot/C)))*C:ot*M;for(let rt=1;rt<=D;rt++){const li=rt/O,Y=Ne(g*(1-li)+v*li,x,S),ee=Ne(li,k,V),re=tt,Ae=(rt-1)/O,ae=Ne(g*(1-Ae)+v*Ae,x,S),fe=at,Me=(rt+1)/O,Oe=Ne(g*(1-Me)+v*Me,x,S),be=d?(Math.PI/2-2*Math.atan(Math.exp(-Oe/C)))*C:Oe*M,xe=Ne(Me,k,V);at=tt,tt=be;const _e=Ne(m,b,w);let Le=_e*M,Fe=Ts(_e,Y,n);const lt=1/O,ct=Ne(lt,U,H),Vt=Ne(m*(1-ct)+y*ct,b,w);let Ct=ct,Zt=Vt,Xt=Vt*M,vi=Ts(Vt,Y,n);if(rt===1){const xi=Xt-z,Di=at-W,Nt=vi-J,jt=0*ne;K[jt]=xi,K[jt+1]=Di,K[jt+2]=Nt,Qd(xi,Di,Nt,X);const ei=Ne(lt,U,H);Vf(ye,we,ei,ee)}for(let xi=1;xi<=D;xi++){const Di=Xt,Nt=vi,jt=(xi+1)/O,ei=Ne(jt,U,H),dr=Ne(m*(1-jt)+y*jt,b,w),pn=Zt;Zt=dr;{const Sn=we+1,Bs=Sn*ne;if(rt===1||xi===D){const Pi=dr*M,as=Ts(dr,Y,n);if(rt===1&&xi<D){const $n=Pi-z,fo=re-W,me=as-J;K[Bs]=$n,K[Bs+1]=fo,K[Bs+2]=me,Qd($n,fo,me,X),Vf(ye,Sn,ei,ee)}Xt=Pi,vi=as}else Xt=K[Bs]+z,vi=K[Bs+2]+J}const Si=Xt,Qr=vi,zs=Le,Vo=Fe;Le=Di,Fe=Nt;const vl=(we-D)*ne,bl=rt===1?Ts(pn,ae,n):K[vl+2]+J,zo=Ts(pn,Oe,n);if(rt<D){const Sn=we+D,Bs=Sn*ne,Pi=Di-z,as=be-W,$n=zo-J;K[Bs]=Pi,K[Bs+1]=as,K[Bs+2]=$n,Qd(Pi,as,$n,X);const fo=Ct;Ct=ei,Vf(ye,Sn,fo,xe)}{const Sn=Si-zs,Bs=fe-be,Pi=Bs*(Qr-Vo),as=Sn*(bl-zo),$n=-Bs*Sn,fo=Pi*Pi+as*as+$n*$n;if(fo===0)np(L,we,0,0,1,N);else{const me=1/Math.sqrt(fo);np(L,we,Pi*me,as*me,$n*me,N)}}++we}}}function X3t(t,e){t.tile.intersectsClippingArea&&(Ake(t),Mke(t,!0),pO(t),t.intersectionData=null)}function J3t(t,e){t.tile.intersectsClippingArea&&(Ike(t),Mae(t),pO(t),Nke(t),t.intersectionData=null)}function Q3t(t,e){t.tile.intersectsClippingArea&&(Mae(t),pO(t),t.intersectionData=null)}function Mae(t,e){t.tile.intersectsClippingArea&&(Ake(t),Mke(t,!1))}function Mke(t,e){const{geometry:i,geometryState:r,localOrigin:s}=t,n=t.tile,{surface:o,extent:a}=n,{clippingArea:l,samplerData:c}=r,u=l??Pae,d=a[0],f=a[2],m=a[1],g=a[3],y=[g>u[3],f>u[2],m<u[1],d<u[0]],v=n.horizontalScale,b=Pke(o.isWebMercatorOnPlateCarree,n.ellipsoid.radius,v),{minu:w,minv:x,maxu:S,maxv:C,boundingBox:M}=i,O=Math.max(d,u[0]),D=Math.min(f,u[2]),U=Math.max(m,u[1]),k=Math.min(g,u[3]),H=s[0],V=s[1],X=s[2];for(let q=0;q<4;++q){const Z=q===1||q===3,ye=r.edgeResolutions[q];Ye(rL(ye));const L=ye+1,N=y[q],z=AT(n,r.edgePeerNeighbors[q]);if(!N&&Fke(n,z,q)){Lke(t,q,z);continue}const W=z!=null&&!N,J=z==null?void 0:z.renderData,K=J==null?void 0:J.geometryState;if(ao&&(Ye(!W||z.level===n.level),Ye(!W||Lg(n,z)<=0),n&&!z&&!o.updatingRootTiles)){const be=If[q],xe=n.findNeighborTile(be,_e=>_e.isLoaded||_e.isLeaf||_e.level===n.level);o.updatingRootTiles||(xe?xe.intersectsClippingArea&&(Ye(!xe.isLoaded),Ye(!xe.isLeaf),Ye(xe.level===n.level)):Ye((o==null?void 0:o.rootTiles)==null||!n.shouldHaveNeighbor(be)))}const ne=Ne(q===1?f:d,O,D),we=Ne(q===0?g:m,U,k),Ie=K==null?void 0:K.samplerData,je=e&&L>3?L-3:1,ut=Ne(q===1?1:0,w,S),ot=Ne(q===0?1:0,x,C),at=W?(be,xe)=>.5*(Ts(be,xe,Ie)+Ts(be,xe,c)):(be,xe)=>Ts(be,xe,c),tt=(f-d)/ye,rt=Z?q===1?tt:-tt:0,li=Z?0:q===0?tt:-tt,Y=-rt,ee=-li;let re=0,Ae=0,ae=0;{const be=0/ye,xe=Z?ne:Ne(d*(1-be)+f*be,O,D),_e=Z?Ne(m*(1-be)+g*be,U,k):we,Le=at(xe,_e);re=xe*v,Ae=b(_e),ae=Le}let fe=0,Me=0,Oe=0;{const be=1/ye,xe=Z?ne:Ne(d*(1-be)+f*be,O,D),_e=Z?Ne(m*(1-be)+g*be,U,k):we,Le=at(xe,_e);fe=xe*v,Me=b(_e),Oe=Le}for(let be=1;be<L-1;be+=je){const xe=be/ye,_e=fe,Le=Me,Fe=Oe;{const Nt=Z?ut:Ne(xe,w,S),jt=Z?Ne(xe,x,C):ot,ei=_e-H,dr=Le-V,pn=Fe-X;Qd(_e,dr,pn,M),i.setEdgeVertexFromValuesRawPositionUV(q,be,ei,dr,pn,Nt,jt)}{const Nt=(be+1)/ye,jt=Z?ne:Ne(d*(1-Nt)+f*Nt,O,D),ei=Z?Ne(m*(1-Nt)+g*Nt,U,k):we,dr=at(jt,ei);fe=jt*v,Me=b(ei),Oe=dr}const lt=fe,ct=Oe,Vt=re,Ct=Ae,Zt=ae;re=_e,Ae=Le,ae=Fe;let Xt=0,vi=0,xi=0;if(Z){const Nt=Me-Le,jt=ct-Fe,ei=Ct-Le,dr=Zt-Fe,pn=Ne(m*(1-xe)+g*xe,U,k),Si=ne+Y,Qr=Si*v-_e,zs=Ts(Si,pn,c)-Fe,Vo=q===3?-1:1;if(Xt=Vo*(-ei+Nt)*zs,vi=Vo*Qr*(-dr+jt),xi=-Vo*Qr*(-ei+Nt),W){const vl=ne+rt,bl=vl*v-_e;Xt=(-ei+Nt)*(zs-(Ts(vl,pn,Ie)-Fe)),vi=(Qr-bl)*(-dr+jt),xi=-(Qr-bl)*(-ei+Nt)}}else{const Nt=lt-_e,jt=ct-Fe,ei=Vt-_e,dr=Zt-Fe,pn=Ne(d*(1-xe)+f*xe,O,D),Si=we+ee,Qr=Ts(pn,Si,c)-Fe,zs=b(Si)-Le,Vo=q===2?-1:1;if(Xt=Vo*zs*(-dr+jt),vi=Vo*(-ei+Nt)*Qr,xi=-Vo*zs*(-ei+Nt),W){const vl=pn,bl=we+li,zo=b(bl)-Le;Xt=(-zs+zo)*(-dr+jt),vi=(-ei+Nt)*(-Qr+(Ts(vl,bl,Ie)-Fe)),xi=-(-zs+zo)*(-ei+Nt)}}const Di=1/Math.sqrt(Xt*Xt+vi*vi+xi*xi);i.setEdgeNormalFromValues(q,be,Xt*Di,vi*Di,xi*Di)}}}function Ake(t,e){Dke(t)}function K3t(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function eLt(t,e){return t*e}function Pke(t,e,i){return t?r=>K3t(r,e):r=>eLt(r,i)}function Oke(t,e,i){const{numVerticesPerSide:r,vertexAttributes:s,maxEdgeVertexCount:n}=t,o=r-1,a=s.count,l=2*(r-3)*(r-3),c=4*(o+n-3),u=Sae.reduce((y,v)=>y+(o+t.getEdgeCount(v)-3),0),d=e.reduce((y,v)=>y+o*(2*(v.latitudeResolution-1)+1),0),f=3*(i?2:1),m=(l+c+d)*f,g=a>=U3t?new Uint32Array(m):new Uint16Array(m);for(let y=0;y<m;++y)g[y]=0;t.indices=g,t.indexCount=(l+u+d)*f,t.poleIndicesStartIndex=l*f,t.edgeIndicesStartIndex=(l+d)*f,i?(rLt(t),sLt(t,e),$ke(t)):(tLt(t),iLt(t,e),Rke(t))}function tLt(t){const{numVerticesPerSide:e,indices:i,vertexAttributes:r}=t,{position:s}=r,{typedBuffer:n,typedBufferStride:o}=s,a=e-2,l=e-3,c=0,u=e-3;let d=0;for(let f=0;f<l;++f){const m=f*a;for(let g=c;g<u;++g){const y=m+g,v=y+1,b=v+a,w=b-1;Uke(y,v,b,w,o,n)?(i[d]=y,i[d+1]=v,i[d+2]=b,i[d+3]=b,i[d+4]=w,i[d+5]=y):(i[d]=y,i[d+1]=v,i[d+2]=w,i[d+3]=w,i[d+4]=v,i[d+5]=b),d+=6}}}function iLt(t,e){const{numVerticesPerSide:i,indices:r,poleIndicesStartIndex:s}=t,n=i-1;let o=s;for(const a of e){const l=a.isNorth?1:2,c=a.isNorth?2:1,u=a.isNorth?3:4,d=a.isNorth?4:3;let f=t.getEdgeVertexIndex(a.connectedOuterEdgeOffset,0),m=1;for(let g=0;g<a.latitudeResolution;++g){const y=g===0?a.rowOffset:f+i;for(let v=0;v<n;v++){const b=y+v;r[o]=f,r[o+l]=f+1,r[o+c]=b,g<a.latitudeResolution-1?(r[o+u]=f+1,r[o+d]=b+1,r[o+5]=b,o+=6):o+=3,f+=m}f=y,m=1}}}function Rke(t){const{indices:e,numVerticesPerSide:i,edgeIndicesStartIndex:r}=t,s=i-1,n=s-2;let o=r;for(let a=0;a<4;++a){const l=Oae[a];let c=0,u=0;const d=t.getEdgeCount(a),f=l.count;Ye(f===s-1);const m=a===1||a===2,g=m?1:2,y=m?2:1,v=t.getEdgeFirstVertexIndex(a),b=1,w=l.vertex0Index,x=l.stride;for(;c<d-1||u<f-1;){const S=w+u*x,C=v+c*b,M=c<d-1,O=u<f-1,D=M&&(!O||(M?0+s*(c+.5)/(d-1):0)<=(O?1+n*(u+.5)/(f-1):0));D?++c:++u;const U=D?C+b:S+x;e[o]=S,e[o+g]=C,e[o+y]=U,o+=3}}t.indexCount=o}function rLt(t){const{indices:e,numVerticesPerSide:i,vertexAttributes:r}=t,{position:s}=r,{typedBuffer:n,typedBufferStride:o}=s,a=i-2;let l=0;for(let c=0;c<i-3;++c){const u=c*a;for(let d=0;d<i-3;++d){const f=c*a+d,m=f+1,g=m+a,y=g-1,v=u+d,b=v+1,w=b+a;Uke(v,b,w,w-1,o,n)?($M(e,l,f,m,g),l+=6,$M(e,l,g,y,f)):($M(e,l,f,m,y),l+=6,$M(e,l,y,g,m)),l+=6}}}function sLt(t,e){const{indices:i,numVerticesPerSide:r,poleIndicesStartIndex:s}=t,n=r-1;let o=s;for(const a of e){const l=a.connectedOuterEdgeOffset;let c=t.getEdgeVertexIndex(l,0),u=1;for(let d=0;d<a.latitudeResolution;++d){const f=d===0?a.rowOffset:c+r;for(let m=0;m<n;m++)$M(i,o,c,c+1,f+m),o+=6,d<a.latitudeResolution-1&&($M(i,o,c+1,f+m+1,f+m),o+=6),c+=u;c=f,u=1}}}function $ke(t){const{indices:e,numVerticesPerSide:i,edgeIndicesStartIndex:r}=t,s=i-1,n=s-2;let o=r;for(let a=0;a<4;++a){const l=Oae[a];let c=0,u=0;const d=t.getEdgeCount(a),f=l.count;Ye(f===s-1);const m=a===1||a===2,g=m?1:3,y=m?3:1,v=t.getEdgeFirstVertexIndex(a),b=1,w=l.vertex0Index,x=l.stride;for(;c<d-1||u<f-1;){const S=w+u*x,C=v+c*b,M=c<d-1,O=u<f-1,D=M&&(!O||(M?0+s*(c+.5)/(d-1):0)<=(O?1+n*(u+.5)/(f-1):0));D?++c:++u;const U=D?C+b:S+x;e[o]=S,e[o+g]=C,e[o+g+1]=C,e[o+y]=U,e[o+y+1]=U,e[o+5]=S,o+=6}}t.indexCount=o}function Aae(t){const{geometry:e,geometryState:i}=t,{edgeResolutions:r}=i,{numVerticesPerSide:s,edgeVerticesStartIndex:n}=e,o=s-2;let a=n;for(let l=0;l<4;++l){{const c=l===0||l===2,u=(l===0?o-1:0)*o+(l===1?o-1:0),d=(c?0:1)*o+(c?1:0),f=Oae[l];f.vertex0Index=u,f.stride=d,f.count=o}{const c=r[l]+1;e.outerEdgesOffsetAndLength[2*l+0]=a,e.outerEdgesOffsetAndLength[2*l+1]=c,a+=c}}}function Ike(t){Aae(t),t.geometryState.wireframe?$ke(t.geometry):Rke(t.geometry)}function Lke(t,e,i){const{geometryState:r,geometry:s,tile:n,localOrigin:o}=t,a=e===1||e===3,l=r.edgeResolutions[e];Ye(rL(l));const c=l+1,{boundingBox:u,minu:d,minv:f,maxu:m,maxv:g,vertexAttributes:y}=s,v=Ne(e===1?1:0,d,m),b=Ne(e===0?1:0,f,g),w=i.renderData,x=w.geometryState,S=w.geometry,C=(e+2)%4,M=S.getEdgeCount(C),O=n.getNeighborEdgeStartVertexIndex(e,i)*l,D=l*2**(n.level-i.level);Ye(x.edgeResolutions[C]===D),Ye(M-1===D);const U=w.localOrigin[0]-o[0],k=w.localOrigin[1]-o[1],H=w.localOrigin[2]-o[2],V=s.getEdgeFirstVertexIndex(e),X=y.position,q=X.typedBuffer,Z=X.typedBufferStride,ye=y.normalCompressed,L=ye.typedBuffer,N=ye.typedBufferStride,z=y.uv0,W=S.vertexAttributes,J=S.getEdgeFirstVertexIndex(C),K=W.position.typedBuffer,ne=W.position.typedBufferStride,we=W.normalCompressed.typedBuffer,Ie=W.normalCompressed.typedBufferStride;for(let je=1;je<c-1;++je){const ut=V+je,ot=J+(O+je),at=ut*Z,tt=ot*ne,rt=K[tt]+U,li=K[tt+1]+k,Y=K[tt+2]+H;q[at]=rt,q[at+1]=li,q[at+2]=Y,Qd(rt,li,Y,u);const ee=ut*N,re=ot*Ie;L[ee]=we[re],L[ee+1]=we[re+1];const Ae=je/l,ae=a?v:Ne(Ae,d,m),fe=a?Ne(Ae,f,g):b;Vf(z,ut,ae,fe)}}function Dke(t){var ee;const{geometry:e,geometryState:i,localOrigin:r}=t,{clippingArea:s,samplerData:n}=i,{minu:o,minv:a,maxu:l,maxv:c,boundingBox:u,vertexAttributes:d}=e,f=t.tile,{surface:m,ellipsoid:g,extent:y,extentInRadians:v,horizontalScale:b}=f,w=((ee=m.view)==null?void 0:ee.viewingMode)==="local",x=g.radius;let S=0,C=0,M=0;const O=(re,Ae,ae)=>{const fe=v[Ae===0?1:3],Me=v[re===0?0:2],Oe=Math.cos(fe),be=Math.sin(fe),xe=Math.sin(Me),_e=Math.cos(Me),Le=x+ae;S=_e*Oe*Le,C=xe*Oe*Le,M=be*Le},D=w?(()=>{const re=s,Ae=re!=null&&(y[3]>re[3]||y[2]>re[2]||y[1]<re[1]||y[0]<re[0]),ae=Pke(m.isWebMercatorOnPlateCarree,x,b);return(fe,Me,Oe)=>{const be=fe===0?y[0]:y[2],xe=Me===0?y[1]:y[3],_e=Ae?Ne(be,re[0],re[2]):be,Le=Ae?Ne(xe,re[1],re[3]):xe,Fe=Oe;S=_e*b,C=ae(Le),M=Fe}})():O;let U=0,k=0,H=0,V=0,X=0,q=0,Z=0,ye=0,L=0;const N=w&&m.isWebMercatorOnPlateCarree,z=(re,Ae,ae,fe,Me)=>{let Oe=0,be=0,xe=0;if(w){const _e=Ae*b,Le=N?(Math.PI/2-2*Math.atan(Math.exp(-ae/x)))*x:ae*b;Oe=_e-S,be=Le-C,xe=fe-M}else{const _e=Cae(re),Le=re.tile,Fe=Le.extent,lt=Le.extentInRadians,ct=(Ae-Fe[0])/(Fe[2]-Fe[0]),Vt=(ae-Fe[1])/(Fe[3]-Fe[1]),Ct=lt[0]*(1-ct)+lt[2]*ct,Zt=_e(Vt),Xt=Math.cos(Zt),vi=Math.sin(Zt),xi=Math.sin(Ct),Di=Math.cos(Ct),Nt=x+fe;Oe=Di*Xt*Nt-S,be=xi*Xt*Nt-C,xe=vi*Nt-M}switch(Me){case 0:Z+=Oe,ye+=be,L+=xe;break;case 1:V-=Oe,X-=be,q-=xe;break;case 2:Z-=Oe,ye-=be,L-=xe;break;case 3:V+=Oe,X+=be,q+=xe}},W=s??Pae,J=y[0],K=y[2],ne=y[1],we=y[3],Ie=[we>W[3],K>W[2],ne<W[1],J<W[0]],je=Math.max(J,W[0]),ut=Math.min(K,W[2]),ot=Math.max(ne,W[1]),at=Math.min(we,W[3]),tt=re=>Math.max(W[0],Math.min(W[2],re)),rt=re=>Math.max(W[1],Math.min(W[3],re)),li=re=>{const Ae=i.cornerNeighborCornerTiles;U=0,k=0,H=1,V=0,X=0,q=0,Z=0,ye=0,L=0;let ae=1/0;for(let _e=0;_e<4;++_e){const Le=Ae[4*re+_e];ae=Math.min(ae,(Le==null?void 0:Le.level)??1/0)}for(let _e=0;_e<4;++_e){const Le=Ae[4*re+_e];SR[_e]=(Le==null?void 0:Le.level)===ae?Le:null}let fe=1,Me=0;for(let _e=0;_e<4;++_e){const Le=SR[_e];Le&&(fe=Math.max(fe,Le==null?void 0:Le.renderData.geometryState.numVerticesPerSide),Me=Le.extent[2]-Le.extent[0])}const Oe=Me,be=fe;Ye(be>1);const xe=Oe/be;for(let _e=0;_e<4;++_e){const Le=SR[(_e+3)%4],Fe=SR[_e%4];if(!Le&&!Fe)continue;const lt=_e===0?1:_e===1?2:_e===2?3:0,ct=_e===0?2:_e===1?3:_e===2?0:1;if(Le&&Fe){const Vt=e7[_e][0]*xe,Ct=e7[_e][1]*xe,Zt=Le.extent,Xt=tt(Zt[lt===0||lt===1?2:0]+Vt),vi=rt(Zt[lt===0||lt===3?3:1]+Ct),xi=Fe.extent,Di=tt(xi[ct===0||ct===1?2:0]+Vt),Nt=rt(xi[ct===0||ct===3?3:1]+Ct),jt=Le.renderData,ei=Fe.renderData,dr=Ts(Xt,vi,jt.geometryState.samplerData),pn=Ts(Di,Nt,ei.geometryState.samplerData);z(jt,Xt,vi,.5*(dr+pn),_e)}else{const Vt=Le??Fe,Ct=Le?lt:ct,Zt=Vt.extent,Xt=e7[_e],vi=tt(Zt[Ct===0||Ct===1?2:0]+Xt[0]*xe),xi=rt(Zt[Ct===0||Ct===3?3:1]+Xt[1]*xe),Di=Vt.renderData,Nt=Ts(vi,xi,Di.geometryState.samplerData);z(Di,vi,xi,Nt,_e)}}if(!w){const _e=Math.sqrt(S*S+C*C+M*M);U=S/_e,k=C/_e,H=M/_e}if(w||H*H<.999){const _e=Math.sqrt(V*V+X*X+q*q);V/=_e,X/=_e,q/=_e;const Le=Math.sqrt(Z*Z+ye*ye+L*L);Z/=Le,ye/=Le,L/=Le,U=q*ye-X*L,k=V*L-q*Z,H=X*Z-V*ye;const Fe=1/Math.sqrt(U*U+k*k+H*H);U*=Fe,k*=Fe,H*=Fe}},Y=i.cornerNeighborCornerTiles;for(let re=0;re<4;++re){const Ae=re,ae=(re+1)%4,fe=re===0||re===1?1:0,Me=re===0||re===3?1:0,Oe=Ne(fe,o,l),be=Ne(Me,a,c),xe=e.getEdgeFirstVertexIndex(Ae),_e=e.getEdgeCount(Ae),Le=re===0||re===3?_e-1:0,Fe=e.getEdgeFirstVertexIndex(ae),lt=e.getEdgeCount(ae),ct=re===0||re===1?lt-1:0;let Vt=-1;for(let Xt=0;Xt<4;++Xt){const vi=Y[4*re+Xt],xi=Y[4*re+Vt];vi&&(Vt===-1||Lg(xi,vi)>0)&&(Vt=Xt)}const Ct=Vt,Zt=Y[4*re+Ct];if(Zt!==f){const Xt=f.level-Zt.level,vi=2**Xt,xi=[Zt.lij[0]+Xt,Zt.lij[1]*vi,Zt.lij[2]*vi],Di=[xi[1]+vi===f.lij[1],re===0&&(Ct===1||Ct===0&&Zt!==Y[4*re+3])||re===1&&(Ct===0||Ct===1&&Zt!==Y[4*re+2]),xi[1]===f.lij[1]+1,re===2&&(Ct===3||Ct===2&&Zt!==Y[4*re+1])||re===3&&(Ct===2||Ct===3&&Zt!==Y[4*re+0])],Nt=Di.reduce((Si,Qr)=>Si+(Qr?1:0),0);Ye(Nt===1||Nt===2);let jt=-1,ei=-1;const dr=Zt.renderData;if(Nt===1){const Si=Di.findIndex(zs=>zs);Ye(0<=Si&&Si<=3),jt=(Si+2)%4;const Qr=i.edgeResolutions[Si];ei=f.getNeighborEdgeStartVertexIndex(Si,Zt)*Qr+Qr*(Si===0&&re===0||Si===1&&re===0||Si===2&&re===1||Si===3&&re===3?1:0)}else{Ye(Di[1]||Di[3]),jt=Di[1]?3:1;const Si=dr.geometryState.edgeResolutions[jt];ei=re===0||re===3?0:Si}const pn=dr.geometry;{const Si=xe+Le,Qr=Fe+ct,zs=pn.getEdgeFirstVertexIndex(jt)+ei,Vo=pn.vertexAttributes,vl=dr.localOrigin;{const zo=Vo.position,Sn=zo.typedBuffer,Bs=zs*zo.typedBufferStride,Pi=Sn[Bs]+vl[0]-r[0],as=Sn[Bs+1]+vl[1]-r[1],$n=Sn[Bs+2]+vl[2]-r[2];Qd(Pi,as,$n,u);const fo=d.position,me=fo.typedBuffer;{const nr=Si*fo.typedBufferStride;me[nr]=Pi,me[nr+1]=as,me[nr+2]=$n}{const nr=Qr*fo.typedBufferStride;me[nr]=Pi,me[nr+1]=as,me[nr+2]=$n}}const bl=d.uv0;Vf(bl,Si,Oe,be),Vf(bl,Qr,Oe,be);{const zo=Vo.normalCompressed.typedBuffer,Sn=zs*Vo.normalCompressed.typedBufferStride,Bs=d.normalCompressed,Pi=Bs.typedBuffer;{const as=Si*Bs.typedBufferStride;Pi[as]=zo[Sn],Pi[as+1]=zo[Sn+1]}{const as=Qr*Bs.typedBufferStride;Pi[as]=zo[Sn],Pi[as+1]=zo[Sn+1]}}}}else{const Xt=Ie[Ae],vi=Ie[ae];let xi;if(Xt||vi){const ei=Ne(J*(1-fe)+K*fe,je,ut),dr=Ne(ne*(1-Me)+we*Me,ot,at);xi=Ts(ei,dr,n)}else xi=nLt(Y,re);D(fe,Me,xi),li(re);const Di=S-r[0],Nt=C-r[1],jt=M-r[2];Qd(Di,Nt,jt,u),e.setEdgeVertexFromValuesRawPositionUVNormal(Ae,Le,Di,Nt,jt,Oe,be,U,k,H),e.setEdgeVertexFromValuesRawPositionUVNormal(ae,ct,Di,Nt,jt,Oe,be,U,k,H)}}for(let re=0;re<4;++re)SR[re]=null}function nLt(t,e){var a,l;const i=4*e,r=Sae.reduce((c,u)=>{var d;return Math.min(c,((d=t[i+u])==null?void 0:d.level)??1/0)},1/0);ao&&(Ye(!t[i+0]||!t[i+2]||zK(t[i+0],t[i+2],Pt.SOUTH_WEST)),Ye(!t[i+1]||!t[i+3]||zK(t[i+1],t[i+3],Pt.NORTH_WEST)));let s=0,n=0;for(let c=0;c<4;++c){const u=t[i+c];if(u&&u.level===r){const d=c===0||c===1,f=c===0||c===3,m=u.extent,g=m[d?0:2],y=m[f?1:3],v=(l=(a=u.renderData)==null?void 0:a.geometryState)==null?void 0:l.samplerData;n+=Ts(g,y,v),s++}}const o=s?n/s:0;return Ye(o!=null),o}function pO(t){const{vao:e,geometry:i}=t,{vertexAttributes:r,edgeVerticesStartIndex:s}=i,n=r.position.typedBuffer;e.vertexBuffers.geometry.setSubData(n,s,s,n.length)}function Nke(t){const{vao:e,geometry:i}=t,{indices:r,indexCount:s,edgeIndicesStartIndex:n}=i;e.indexBuffer.setSubData(r,n,n,s)}let oLt=class{constructor(e,i,r,s,n){this.isNorth=e,this.connectedRowOffset=i,this.connectedOuterEdgeOffset=r,this.rowOffset=s,this.latitudeResolution=n}};const e7=[[0,1],[1,0],[0,-1],[-1,0]],Jo=new s3t,Pae=rG(-1/0,-1/0,1/0,1/0),SR=[null,null,null,null];function Fke(t,e,i){if(!e)return!1;const r=Lg(t,e);return r>0||r===0&&i>=2}let l5=class{constructor(){this.vertex0Index=0,this.stride=1,this.count=0}getVertexIndex(e){return Ye(0<=e&&e<this.count),this.vertex0Index+this.stride*e}};const Oae=[new l5,new l5,new l5,new l5];function Qd(t,e,i,r){t<r[0]?r[0]=t:t>r[3]&&(r[3]=t),e<r[1]?r[1]=e:e>r[4]&&(r[4]=e),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}function kke(t){const{edgeResolutions:e,numVerticesPerSide:i}=t,r=1+Math.max(...e);return Math.max(i,r)}function Uke(t,e,i,r,s,n){const o=t*s,a=n[o],l=n[o+1],c=n[o+2],u=e*s,d=n[u],f=n[u+1],m=n[u+2],g=i*s,y=n[g],v=n[g+1],b=n[g+2],w=r*s,x=n[w],S=n[w+1],C=n[w+2];return(d-x)*(d-x)+(f-S)*(f-S)+(m-C)*(m-C)>(a-y)*(a-y)+(l-v)*(l-v)+(c-b)*(c-b)}function $M(t,e,i,r,s){t[e]=i,t[e+1]=r,t[e+2]=r,t[e+3]=s,t[e+4]=s,t[e+5]=i}const UU=6;let aLt=class extends vae{constructor(e,i,r,s,n){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=oi(),this._baseUsedMemory=900,this._subtreeGeometryElevationBoundMin=0,this._subtreeGeometryElevationBoundMax=0,this.init(e,i,r,s,n)}init(e,i,r,s,n){super.init(e,i,r,s,n);const o=n.view.renderSpatialReference,a=n.spatialReference,l=o!=null&&$S(o)&&a!=null&&a.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=l;const{isWebMercatorOnPlateCarree:c}=n,u=this._extentInRenderSR,d=this.extent;if(c){const f=Ge(d[0],d[1],0);Fo(f,Ze.WebMercator,f,Ze.PlateCarree);const m=Ge(d[2],d[3],0);Fo(m,Ze.WebMercator,m,Ze.PlateCarree),u[0]=f[0],u[1]=f[1],u[2]=m[0],u[3]=m[1]}else for(let f=0;f<4;++f)u[f]=d[f]*l;this.centerAtSeaLevel[0]=.5*(u[0]+u[2]),this.centerAtSeaLevel[1]=.5*(u[1]+u[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(u[2]-u[0],u[3]-u[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,i=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),s=Math.sqrt(i*i+r*r),n=.5*(this.elevationBoundsMax-this.elevationBoundsMin),o=Math.max(s,n);this._center[yn.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const i=this._aabb(),r=i[0],s=i[1],n=i[2],o=i[3],a=i[4],l=i[5];let c=!0;for(let u=0;u<6;u++){const d=e[u],f=d[0],m=d[1],g=d[2],y=d[3];if(f*(f>0?r:o)+m*(m>0?s:a)+g*(g>0?n:l)+y>=0)return el.OUTSIDE;c=c&&f*(f<0?r:o)+m*(m<0?s:a)+g*(g<0?n:l)+y<=0}return c?el.INSIDE:el.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return Eot(e[0],e[1],Math.min(this.elevationBoundsMin,this._subtreeGeometryElevationBoundMin),e[2],e[3],Math.max(this.elevationBoundsMax,this._subtreeGeometryElevationBoundMax))}intersectsRay(e,i,r,s){return c5[0]=1/i[0],c5[1]=1/i[1],c5[2]=1/i[2],soe(this._aabb(),e,c5,r,s)}createGeometry(){Z3t(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds(),this.setMemoryDirty()}_updateSubtreeGeometryElevationsBounds(){const e=this._subtreeGeometryElevationBoundMin,i=this._subtreeGeometryElevationBoundMax,r=this.renderData;let s=e,n=i;if(r){const o=r.geometry.boundingBox;s=o[2],n=o[5]}else if(!this.isLeaf){s=1/0,n=-1/0;for(const o of this.children)s=Math.min(s,o._subtreeGeometryElevationBoundMin),n=Math.max(n,o._subtreeGeometryElevationBoundMax)}if(s!==this._subtreeGeometryElevationBoundMin||n!==this._subtreeGeometryElevationBoundMax){this._subtreeGeometryElevationBoundMin=s,this._subtreeGeometryElevationBoundMax=n;const o=this.parent;o==null||o._updateSubtreeGeometryElevationsBounds()}}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){X3t(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevations(){Q3t(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevationsAndResolutions(){J3t(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}get horizontalScale(){return this._horizontalScaleFactor}};const c5=E();let lLt=class{constructor(){this.extent=ci(),this.minLevel=0,this.maxLevel=0,this.callback=null}},VU=class extends Ue{constructor(){super(...arguments),this._queries=new ai({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new ai({initialSize:30}),this._queryPool=new la(lLt)}queryVisibleLevelRange(e,i,r,s){const n=this._queryPool.acquire();Hd(n.extent,e),n.minLevel=i??-Number.MAX_VALUE,n.maxLevel=r??Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const i=this._queries.data[e];this._queryPool.release(i),i.callback(e>=this._queriesInvPtr),i.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const i=e.level;let r=0;for(;r<this._queriesInvPtr;){const s=this._queries.data[r],n=s.extent;i>=s.minLevel&&i<=s.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}};h([p()],VU.prototype,"updating",null),VU=h([I("esri.views.3d.terrain.ScaleRangeQueries")],VU);function cLt(t,e,i,r){const s=Math.cos(i);t[0]=Math.cos(e)*s*r,t[1]=Math.sin(e)*s*r,t[2]=Math.sin(i)*r}let uLt=class extends vae{constructor(e,i,r,s,n){super(),this._convexHull=new Array(24),this._boundingSphere=dn(),this._baseUsedMemory=1816,this.init(e,i,r,s,n)}init(e,i,r,s,n){super.init(e,i,r,s,n);const o=this.ellipsoid.radius,a=this.extentInRadians[0],l=this.extentInRadians[1],c=this.extentInRadians[2],u=this.extentInRadians[3],d=Bt(l,u,.5),f=Bt(a,c,.5),m=e===0?0:Math.min(Math.abs(l),Math.abs(u));this._edgeLen=(c-a)*Math.cos(m)*o,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=o-Math.sqrt(o*o-this._edgeLen2/4),cLt(this.centerAtSeaLevel,f,d,this.ellipsoid.radius),Ce(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)de(e[yn.MIDDLE],0,0,0),de(e[yn.TOP],0,0,0),de(e[yn.BOTTOM],0,0,0),e[yn.MIDDLE][3]=this.ellipsoid.radius+this.elevationBoundsMax;else{this._updateCenter();const i=e[yn.MIDDLE],r=this.convexHull;let s=0;for(let n=0;n<8;++n)s=Math.max(s,hLt(i,r,3*n));e[yn.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibilityStatus(e){if(!B1(e,this._boundingSphere))return el.OUTSIDE;if(this.lij[0]<10)return el.INTERSECTS;const i=this.convexHull,r=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<iO;n++){const o=n===Tr.NEAR,a=e[n],l=a[0],c=a[1],u=a[2],d=a[3]-(o?r:0);let f=!1;for(let m=0;m<8;++m){const g=3*m;if(l*i[g]+c*i[g+1]+u*i[g+2]+d<0){if(f=!0,!s)break}else s=!1}if(!f)return el.OUTSIDE}return s?el.INSIDE:el.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){V3t(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),ao&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,i=e,r=this.elevationBoundsMin,s=this.elevationBoundsMax,n=this.ellipsoid.radius,o=s;if(this.level===0)de(i,0,0,0),e[3]=n+o;else{const a=this.extentInRadians,l=.5*(a[0]+a[2]),c=a[1],u=a[3];ex(uve,l,c,n),ex(hve,l,u,n),Ee(i,uve,hve),he(i,i,(n+.5*(r+s))/kl(i));const d=this.convexHull;let f=0;const m=(y,v)=>{const b=y[0]-d[3*v],w=y[1]-d[3*v+1],x=y[2]-d[3*v+2];return Math.sqrt(b*b+w*w+x*x)};for(let y=0;y<8;++y){const v=m(i,y);f=Math.max(f,v)}const g=f;e[3]=g+2}}_updateConvexHull(){const e=this.extentInRadians,i=this.ellipsoid.radius;if(this.level===0)return;const r=this.elevationBoundsMin,s=this.elevationBoundsMax,n=this._getPatchType(),o=this.surface.isWebMercator,a=o&&n===Fd.HAS_NORTH_POLE,l=o&&n===Fd.HAS_SOUTH_POLE,c=l||a,u=Math.PI/2,d=e[0],f=e[2],m=l?-u:e[1],g=a?u:e[3],y=.5*(d+f),v=r,b=i+(c?Math.min(0,v-1):v),w=(L,N,z)=>ex(L,N,z,b),x=E(),S=E(),C=E(),M=E();w(x,d,m),w(S,d,g),w(C,f,g),w(M,f,m);const O=(L,N)=>{for(let z=0;z<3;++z)this._convexHull[3*N+z]=L[z]};O(x,0),O(S,1),O(C,2),O(M,3);const D=s,U=i+(c?Math.max(0,D+1):D),k=E(),H=E(),V=E();ex(H,y,g,b),ex(V,y,m,b),Ee(k,H,V),Ce(k,k);const X=E(),q=E(),Z=(L,N)=>{Ii(q,L,N),Ce(q,q);const z=-Te(L,X)/Te(q,X);Ye(z>=0),he(q,q,z),Ee(L,L,q)};if(2**this.lij[0]>2*this.lij[1]){const L=V,N=E();ft(N,cve,L),Ce(N,N),ft(X,L,N),Ce(X,X),Ye(kd(Te(X,L)/kl(L),0)),Z(x,S),Z(M,C),O(x,0),O(M,3)}else if(2**this.lij[0]!==2*this.lij[1]){const L=H,N=E();ft(N,cve,L),Ce(N,N),ft(X,N,L),Ce(X,X),Z(S,x),Z(C,M),O(S,1),O(C,2)}const ye=(L,N)=>{const z=U/Te(N,k);for(let W=0;W<3;++W)this._convexHull[3*L+W]=N[W]*z};ye(4,x),ye(5,S),ye(6,C),ye(7,M)}_getPatchType(){const e=this.lij[1],i=e===0,r=e===(1<<this.level)-1;return i?r?Fd.HAS_BOTH_POLES:Fd.HAS_NORTH_POLE:r?Fd.HAS_SOUTH_POLE:Fd.REGULAR}intersectsRay(e,i,r,s){const n=this._boundingSphere,o=n[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=n[0]-e[0],c=n[1]-e[1],u=n[2]-e[2],d=(l*i[0]+c*i[1]+u*i[2])/a,f=i[0]*d-l,m=i[1]*d-c,g=i[2]*d-u;return f*f+m*m+g*g<o*o}getDefaultVerticesPerSide(){return this.level<lve.length?lve[this.level]+1:2}updateCornerElevations(){H3t(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){j3t(this.renderData),this._updateBoundingVolumes()}updateEdgeElevationsAndResolutions(){G3t(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var Ae;if(!ao||this.level<=2)return;const e=this._boundingSphere,i=e[3],r=e,s=E(),n=this.ellipsoid.radius,o=this.elevationBoundsMin,a=this.elevationBoundsMax,l=n+o,c=1,u=0,d=this._center[yn.MIDDLE][3],f=this.convexHull,m=(ae,fe)=>{for(let Me=0;Me<3;++Me)ae[Me]=f[3*fe+Me]};{const ae=E(),fe=E(),Me=E(),Oe=E(),be=E(),xe=(_e,Le,Fe,lt)=>{m(fe,_e),m(Me,Le),m(Oe,Fe),Ii(fe,fe,Me),Ii(Oe,Oe,Me),ft(ae,fe,Oe),Ce(ae,ae);const ct=Te(ae,Me);m(be,lt);const Vt=Te(ae,be),Ct=Math.abs(Vt-ct);Ye(kd(Ct,0),`Non coplanar ${_e},${Le},${Fe},${lt} diff = ${Ct}`)};xe(0,1,2,3),xe(4,5,6,7),xe(0,1,4,5),xe(1,2,5,6),xe(2,3,6,7),xe(3,0,7,4)}const g=co(24),y=(ae,fe,Me)=>{const Oe=4*ae;for(let be=0;be<3;++be)g[Oe+be]=fe[be];g[Oe+3]=Me},v=E(),b=E(),w=E(),x=E(),S=(ae,fe,Me,Oe)=>{m(v,fe),m(b,Me),m(w,Oe),Ii(v,v,b),Ce(v,v),Ii(w,w,b),Ce(w,w),ft(x,v,w),Ce(x,x);const be=Te(x,b);y(ae,x,be)};S(0,0,1,2),S(1,1,0,4),S(2,1,5,2),S(3,3,2,6),S(4,4,0,3),S(5,4,6,5);const C=1,M=(ae,fe,Me,Oe)=>{const be=4*ae;return g[be]*fe+g[be+1]*Me+g[be+2]*Oe-g[be+3]},O=(ae,fe,Me,Oe)=>M(ae,fe,Me,Oe)>=-C,D=(ae,fe)=>O(ae,fe[0],fe[1],fe[2]),U=2**this.lij[0]>2*this.lij[1],k=(ae,fe,Me)=>Math.sqrt(Vke(ae,fe,Me,r[0],r[1],r[2]))<i,H=ae=>k(ae[0],ae[1],ae[2]),V=(ae,fe)=>k(ae[fe],ae[fe+1],ae[fe+2]),X=this.extentInRadians,q=.5*(X[0]+X[2]),Z=X[1],ye=X[3],L=E(),N=E();ex(L,q,ye,l),ex(N,q,Z,l);const z=U?"Upper":"Lower";let W=!0;for(let ae=0;ae<6;++ae){for(let fe=0;fe<8;++fe){const Me=3*fe,Oe=O(ae,f[Me],f[Me+1],f[Me+2]);W&&(W=Oe),Ye(Oe,`Tile[${this.lij}] Convex hull point ${fe} outside of plane ${ae}`)}Ye(D(ae,N),`Tile[${this.lij}] (${z}) bottom mid outside of plane ${ae}`),Ye(D(ae,L),`Tile[${this.lij}] (${z}) top mid outside of plane ${ae}`)}Ye(W,"Not all convex hull points are inside  convex hull polyhedron"),Ye(H(N),`Tile[${this.lij}] (${z}) bottom mid outside of bounding sphere`),Ye(H(L),`Tile[${this.lij}] (${z}) top mid outside of bounding sphere`);for(let ae=0;ae<8;++ae){const fe=V(f,3*ae);Ye(fe,`Tile[${this.lij}] Convex hull point ${ae} outside of bounding sphere`)}for(let ae=0;ae<6;++ae)for(let fe=0;fe<8;++fe){const Me=3*fe;O(ae,f[Me],f[Me+1],f[Me+2])||console.error(`Tile[${this.lij}] Convex hull point ${fe} outside of plane ${ae}`)}const{extentInRadians:J}=this,K=Math.max(J[2]-J[0],J[3]-J[1]),ne=Math.round(K*n),{renderData:we}=this;if(!we)return;const{geometry:Ie,geometryState:je,localOrigin:ut}=we,ot=(Ae=Ie.vertexAttributes)==null?void 0:Ae.position;if(!ot)return;const at=E(),tt=Ie.numVerticesPerSide-2,{indices:rt,indexCount:li,edgeVerticesStartIndex:Y,poleVerticesStartIndex:ee}=Ie;if(!rt)return;const re=new Set;for(let ae=0;ae<li;++ae){const fe=rt[ae];if(re.has(fe))continue;re.add(fe);const Me=fe<ee,Oe=fe>=Y;let be=!1,xe=-1;if(Oe){let Nt=Y;for(let jt=0;jt<4;++jt){const ei=je.edgeResolutions[jt];if(fe===Nt||fe===Nt+ei-1){be=!0;break}if(Nt+=ei,fe<Nt){xe=jt;break}}}const _e=Oe?je.edgePeerNeighbors[xe]:null,Le=Oe&&_e&&Lg(this,_e)>0;ot.getVec(fe,s),Ee(at,s,ut);const Fe=kl(at)-n;let lt=0,ct=!1;const Vt=o-Fe,Ct=Fe-a,Zt=Vt>c,Xt=Ct>c,vi=Zt||Xt,xi=()=>{const Nt=Me?"internal":Oe&&!be?"edge":be?"corner":"pole";return`Tile[${this.lij}].vertex[${fe}]:${Nt}`+(Zt?"(below)":Xt?"(above)":"")+(Le?"(Neighbor)":"")},Di=Y1(at,r);if(Di>=i+u){const Nt=Di-i;vi||(console.error(`${xi()} is out of the bounding sphere by ${Nt.toFixed(0)} / ${i.toFixed(0)}[tol=${u}] h=${Fe.toFixed(0)} / [${o.toFixed(0)}..${a.toFixed(0)}] (${(Nt/i).toFixed(0)})`),ct=!0)}for(let Nt=0;Nt<6;++Nt)if(!O(Nt,at[0],at[1],at[2])){const jt=M(Nt,at[0],at[1],at[2]),ei=fe%tt,dr=(fe-ei)/tt;Nt===0&&Vt||Nt===5&&Ct||(console.error(`${xi()} (${ei},${dr})|${tt}] is out of the bounding trapezoid plane ${Nt} h=${Math.round(Fe)} / [${Math.round(o)}..${Math.round(a)}] dist=${Math.round(jt)} radii = ${Math.round(i)}/${Math.round(d)}} : maxL = ${ne}`),++lt)}if(ct||lt>0)break}}get convexHull(){return this._convexHull}};const lve=[128,64,64,32,16,8,8,4];function hLt(t,e,i){return Vke(t[0],t[1],t[2],e[i],e[i+1],e[i+2])}function Vke(t,e,i,r,s,n){const o=r-t,a=s-e,l=n-i;return o*o+a*a+l*l}const ex=(t,e,i,r)=>{const s=Math.cos(e),n=Math.sin(e),o=Math.cos(i),a=Math.sin(i);t[0]=r*o*s,t[1]=r*o*n,t[2]=r*a},cve=[0,0,1],uve=E(),hve=E();let Hp=class extends Ue{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};h([p()],Hp.prototype,"fovX",void 0),h([p()],Hp.prototype,"fovY",void 0),h([p()],Hp.prototype,"relativeWidthLimit",void 0),h([p()],Hp.prototype,"relativeHeightLimit",void 0),h([p()],Hp.prototype,"maxLod",void 0),h([p()],Hp.prototype,"angledSplitBias",void 0),h([p()],Hp.prototype,"aboveGround",void 0),h([p()],Hp.prototype,"frustum",void 0),Hp=h([I("esri.views.3d.terrain.SplitLimits")],Hp);const dLt=As().vec3f(R.POSITION).vec2i16(R.UV0).vec2i16(R.NORMALCOMPRESSED,{glNormalized:!0});let pLt=class{constructor(e){this._storage=new oN((i,r)=>e.newCache(i,r),"TileGeometry")}acquire(e){const r=Math.ceil(e/4)*4,s=this._storage,n=fLt(r),o=s.pop(n);if(o)return o;const a=dLt.createBuffer(r);return a.release=()=>s.put(n,a),a}clear(){this._storage.clear()}destroy(){this._storage.destroy()}};function fLt(t){return t.toString()}var Je;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Je||(Je={}));const BK={normal:Je.Normal,average:Je.Average,lighten:Je.Lighten,lighter:Je.Lighter,screen:Je.Screen,plus:Je.Plus,"color-dodge":Je.ColorDodge,darken:Je.Darken,multiply:Je.Multiply,"color-burn":Je.ColorBurn,overlay:Je.Overlay,"soft-light":Je.SoftLight,"hard-light":Je.HardLight,"vivid-light":Je.VividLight,hue:Je.Hue,saturation:Je.Saturation,luminosity:Je.Luminosity,color:Je.Color,difference:Je.Difference,exclusion:Je.Exclusion,minus:Je.Minus,invert:Je.Invert,reflect:Je.Reflect,"destination-over":Je.DestinationOver,"destination-atop":Je.DestinationAtop,"destination-in":Je.DestinationIn,"destination-out":Je.DestinationOut,"source-atop":Je.SourceAtop,"source-in":Je.SourceIn,"source-out":Je.SourceOut,xor:Je.Xor};function mLt(t){return t===Je.DestinationOver||t===Je.DestinationAtop||t===Je.DestinationIn||t===Je.DestinationOut||t===Je.SourceAtop||t===Je.SourceIn||t===Je.SourceOut||t===Je.Xor}let zke=class extends tc{constructor(){super(...arguments),this.blendMode=Je.Normal}};h([B({count:Je.COUNT})],zke.prototype,"blendMode",void 0);var Ja;(function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"})(Ja||(Ja={}));var An;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(An||(An={}));var hf;(function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"})(hf||(hf={}));let R3=class extends zke{constructor(){super(...arguments),this.output=An.Composite,this.baseOpacityMode=Ja.NotRequired,this.premultipliedSource=hf.Off}};h([B({count:An.COUNT})],R3.prototype,"output",void 0),h([B({count:Ja.COUNT})],R3.prototype,"baseOpacityMode",void 0),h([B()],R3.prototype,"premultipliedSource",void 0);let Bke=class extends Fr{constructor(){super(...arguments),this.scale=1,this.offset=jS}};function jke(t){t.attributes.add(R.POSITION,"vec2"),t.attributes.add(R.UV0,"vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.uniforms.add(new et("scale",e=>e.scale),new jr("offset",e=>e.offset)).code.add(T`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}function gLt(t,e){const i=e.blendMode;i!==Je.Normal&&(i===Je.Reflect&&t.code.add(T`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==Je.ColorDodge&&i!==Je.VividLight||t.code.add(T`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==Je.ColorBurn&&i!==Je.VividLight||t.code.add(T`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===Je.Overlay&&t.code.add(T`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===Je.HardLight&&t.code.add(T`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===Je.SoftLight&&t.code.add(T`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===Je.VividLight&&t.code.add(T`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==Je.Hue&&i!==Je.Saturation&&i!==Je.Color&&i!==Je.Luminosity||(t.code.add(T`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==Je.Hue&&i!==Je.Saturation||t.code.add(T`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(T`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===Je.Multiply?T`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Average?T`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Lighten?T`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Darken?T`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Lighter?T`return vec4(cl * ol + cb * ob, ol + ob);`:i===Je.Plus?T`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===Je.Minus?T`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===Je.Screen?T`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Difference?T`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Invert?T`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Je.DestinationOver?T`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===Je.DestinationAtop?T`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===Je.DestinationOut?T`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===Je.SourceAtop?T`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Je.SourceOut?T`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===Je.Xor?T`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===Je.DestinationIn?T`return vec4(cb * ob * ol, ol * ob);`:i===Je.SourceIn?T`return vec4(cl * ol * ob, ol * ob);`:i===Je.Hue?T`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Saturation?T`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Color?T`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Luminosity?T`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Exclusion?T`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Reflect?T`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.ColorDodge?T`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.ColorBurn?T`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.Overlay?T`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.SoftLight?T`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.HardLight?T`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Je.VividLight?T`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:T``}
    }
  `))}function Gke(t,e){const i=e.output===An.GridComposite,r=e.output===An.ColorComposite,s=e.output===An.GroupBackgroundComposite,n=e.output===An.Composite,o=e.baseOpacityMode===Ja.Required,a=t.fragment;o&&a.uniforms.add(new et("baseOpacity",d=>d.baseOpacity)),i?a.include(xae):r?a.uniforms.add(new Wt("backgroundColor",d=>d.backgroundColor)):n&&a.uniforms.add(new wt("fboColor",d=>d.fboTexture));const l=e.blendMode!==Je.Normal,c=e.premultipliedSource===hf.On,u=!l&&!c&&(n&&!o||s);a.include(gLt,e),a.code.add(T`
    vec4 getBackground(vec2 uv) {
      return ${o?T`baseOpacity *`:""} ${s?T`vec4(0.0, 0.0, 0.0, 0.0)`:r?T`vec4(backgroundColor, 1.0)`:i?T`vec4(gridColor(uv), 1.0)`:T`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec2 bgUV, vec4 colorLayer, float opacity) {
      ${l?T`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec4 bgColor = getBackground(bgUV);
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:T`
          float composeAlpha = colorLayer.a * opacity;
          ${u?T`return colorLayer * opacity;`:T`
            vec4 bgColor = getBackground(bgUV);
            return bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}var zb;function Hke(t){const e=new Hi,i=e.fragment;if(e.include(jke),t.background===zb.Only){const r=t.output===An.ColorComposite;return r?i.uniforms.add(new Wt("backgroundColor",s=>s.backgroundColor)):i.include(xae),i.code.add(T`
      void main() {
        fragColor = vec4(${r?T`backgroundColor`:T`gridColor(uv)`}, 1.0);
      }
    `),e}return e.include(Gke,t),i.uniforms.add(new wt("tex",r=>r.texture),new et("opacity",r=>r.opacity)).code.add(T`void main() {
fragColor = blendLayers(uv, texture(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(zb||(zb={}));const yLt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return zb},build:Hke},Symbol.toStringTag,{value:"Module"}));let _Lt=class extends Bke{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=On}},qke=class Wke extends Qi{initializeProgram(e){return new Ki(e.rctx,Wke.shader.get().build(this.configuration),Ai)}initializePipeline(){return Jt({blending:Hh(Be.ONE,Be.ONE_MINUS_SRC_ALPHA),colorWrite:ui})}};qke.shader=new qi(yLt,()=>ce(()=>Promise.resolve().then(()=>$Ht),void 0));let Zke=class extends R3{constructor(){super(...arguments),this.background=zb.BelowLayer}};h([B()],Zke.prototype,"background",void 0);let jK=class{constructor(e,i,r,s,n,o){this.texture=e,this.type=i,e.retain(),this.offsetAndScale=ii(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=Ge(s,n,o)}destroy(){this.texture.release()}};var wS,n2;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(wS||(wS={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(n2||(n2={}));var GK,R1,ej,gf,HK,tj,qK,$1,WK;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(GK||(GK={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(R1||(R1={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(ej||(ej={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(gf||(gf={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(HK||(HK={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(tj||(tj={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(qK||(qK={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}($1||($1={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(WK||(WK={}));let Pp=class{};Pp.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:R1.VISIBLE}},Pp.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:R1.VISIBLE}},Pp.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:R1.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:iK.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:rK.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},Pp.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:R1.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:ej.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:tj.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:gf.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:tj.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:HK.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:gf.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:qK.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[WK.HORIZONTAL]}},Pp.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:R1.VISIBLE}},Pp.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},Pp.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:$1.MAP}},Pp.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:$1.MAP},"line-width":{type:"number",minimum:0,default:1}},Pp.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:$1.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:$1.MAP}},Pp.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},Pp.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:$1.MAP}};function vLt(t,e,i,r,s,n){const{iconRotationAlignment:o,textRotationAlignment:a,iconTranslate:l,iconTranslateAnchor:c,textTranslate:u,textTranslateAnchor:d}=r;let f=0;for(const m of t.colliders){const[g,y]=m.partIndex===0?l:u,v=m.partIndex===0?c:d,b=m.minLod<=n&&n<=m.maxLod;f+=b?0:1,m.enabled=b,m.xScreen=m.xTile*s[0]+m.yTile*s[3]+s[6],m.yScreen=m.xTile*s[1]+m.yTile*s[4]+s[7],v===$1.MAP?(m.xScreen+=i*g-e*y,m.yScreen+=e*g+i*y):(m.xScreen+=g,m.yScreen+=y),gf.VIEWPORT===(m.partIndex===0?o:a)?(m.dxScreen=m.dxPixels,m.dyScreen=m.dyPixels):(m.dxScreen=i*(m.dxPixels+m.width/2)-e*(m.dyPixels+m.height/2)-m.width/2,m.dyScreen=e*(m.dxPixels+m.width/2)+i*(m.dyPixels+m.height/2)-m.height/2)}t.colliders.length>0&&f===t.colliders.length&&(t.unique.show=!1)}let bLt=class{constructor(e,i,r,s,n,o){this._symbols=e,this._styleRepository=s,this._zoom=n,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new oke(i,r,vIt),this._si=Math.sin(Math.PI*o/180),this._co=Math.cos(Math.PI*o/180);for(const a of e)for(const l of a.symbols)this._allNeededMatrices.has(l.tile)||this._allNeededMatrices.set(l.tile,rke(l.tile.transforms.tileUnitsToPixels))}work(e){const i=this._gridIndex;function r(n){const o=n.xScreen+n.dxScreen,a=n.yScreen+n.dyScreen,l=o+n.width,c=a+n.height,[u,d,f,m]=i.getCellSpan(o,a,l,c);for(let g=d;g<=m;g++)for(let y=u;y<=f;y++){const v=i.cells[g][y];for(const b of v){const w=b.xScreen+b.dxScreen,x=b.yScreen+b.dyScreen,S=w+b.width,C=x+b.height;if(!(l<w||o>S||c<x||a>C))return!0}}return!1}const s=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const n=this._symbols[this._currentLayerCursor],o=this._getProperties(n.styleLayerUID);for(;this._currentSymbolCursor<n.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-s>e)return!1;const a=n.symbols[this._currentSymbolCursor];if(!a.unique.show)continue;vLt(a,this._si,this._co,o,this._allNeededMatrices.get(a.tile),this._zoom);const l=a.unique;if(!l.show)continue;const{iconAllowOverlap:c,iconIgnorePlacement:u,textAllowOverlap:d,textIgnorePlacement:f}=o;for(const m of a.colliders){if(!m.enabled)continue;const g=l.parts[m.partIndex];g.show&&!(m.partIndex?d:c)&&r(m)&&(m.hard?l.show=!1:g.show=!1)}if(l.show)for(const m of a.colliders){if(!m.enabled||(m.partIndex?f:u)||!l.parts[m.partIndex].show)continue;const g=m.xScreen+m.dxScreen,y=m.yScreen+m.dyScreen,v=g+m.width,b=y+m.height,[w,x,S,C]=this._gridIndex.getCellSpan(g,y,v,b);for(let M=x;M<=C;M++)for(let O=w;O<=S;O++)this._gridIndex.cells[M][O].push(m)}}}return!0}_getProperties(e){const i=this._styleProps.get(e);if(i)return i;const r=this._zoom,s=this._styleRepository.getStyleLayerByUID(e),n=s.getLayoutValue("symbol-placement",r)!==ej.POINT;let o=s.getLayoutValue("icon-rotation-alignment",r);o===gf.AUTO&&(o=n?gf.MAP:gf.VIEWPORT);let a=s.getLayoutValue("text-rotation-alignment",r);a===gf.AUTO&&(a=n?gf.MAP:gf.VIEWPORT);const l=s.getPaintValue("icon-translate",r),c=s.getPaintValue("icon-translate-anchor",r),u=s.getPaintValue("text-translate",r),d=s.getPaintValue("text-translate-anchor",r),f={iconAllowOverlap:s.getLayoutValue("icon-allow-overlap",r),iconIgnorePlacement:s.getLayoutValue("icon-ignore-placement",r),textAllowOverlap:s.getLayoutValue("text-allow-overlap",r),textIgnorePlacement:s.getLayoutValue("text-ignore-placement",r),iconRotationAlignment:o,textRotationAlignment:a,iconTranslateAnchor:c,iconTranslate:l,textTranslateAnchor:d,textTranslate:u};return this._styleProps.set(e,f),f}};function wLt(t,e){if(t.priority-e.priority)return t.priority-e.priority;const i=t.tile.key,r=e.tile.key;return i.world-r.world?i.world-r.world:i.level-r.level?i.level-r.level:i.row-r.row?i.row-r.row:i.col-r.col?i.col-r.col:t.xTile-e.xTile?t.xTile-e.xTile:t.yTile-e.yTile}let xLt=class{get running(){return this._running}constructor(e,i,r,s,n,o){this._visibleTiles=e,this._symbolRepository=i,this._createCollisionJob=r,this._assignTileSymbolsOpacity=s,this._symbolLayerSorter=n,this._isLayerVisible=o,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}setScreenSize(e,i){this._screenWidth===e&&this._screenHeight===i||this.restart(),this._screenWidth=e,this._screenHeight=i}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const i=performance.now();if(!this._selectionJob.work(e)||(this._selectionJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const i=performance.now();if(!this._collisionJob.work(e)||(this._collisionJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const i=performance.now();if(!this._opacityJob.work(e)||(this._opacityJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}return this._running=!1,!0}_createSelectionJob(){const e=this._symbolRepository.uniqueSymbols;for(let l=0;l<e.length;l++){const c=e[l];for(let u=0;u<c.uniqueSymbols.length;u++){const d=c.uniqueSymbols[u];for(const f of d.tileSymbols)f.selectedForRendering=!1}}const i=[];let r=0,s=0;const n=this._isLayerVisible;function o(l){let c;const u=performance.now();for(;s<e.length;s++,r=0){const d=e[s],f=d.styleLayerUID;if(!n(f)){i[s]||(i[s]={styleLayerUID:f,symbols:[]});continue}i[s]=i[s]||{styleLayerUID:f,symbols:[]};const m=i[s];for(;r<d.uniqueSymbols.length;r++){if(c=d.uniqueSymbols[r],r%100==99&&performance.now()-u>l)return!1;let g=null,y=!1,v=!1;for(const b of c.tileSymbols)if(!v||!y){const w=b.tile;(!g||w.isCoverage||w.neededForCoverage&&!y)&&(g=b,(w.neededForCoverage||w.isCoverage)&&(v=!0),w.isCoverage&&(y=!0))}if(g.selectedForRendering=!0,v){m.symbols.push(g),c.show=!0;for(const b of c.parts)b.show=!0}else c.show=!1}}for(const d of i)d.symbols.sort(wLt);return!0}const a=this._symbolLayerSorter;return{work:o,get sortedSymbols(){return i.sort(a)}}}_createOpacityJob(){const e=this._assignTileSymbolsOpacity,i=this._visibleTiles;let r=0;function s(n,o){const a=n.symbols;for(const[l,c]of a)TLt(c,o);e(n,o);for(const l of n.childrenTiles)s(l,o)}return{work(n){const o=performance.now();for(;r<i.length;r++){if(performance.now()-o>n)return!1;const a=i[r];a.parentTile==null&&s(a,performance.now())}return!0}}}};function TLt(t,e){for(const i of t){const r=i.unique;for(const s of r.parts){const n=s.targetOpacity>.5?1:-1;s.startOpacity+=n*((e-s.startTime)/LK),s.startOpacity=Math.min(Math.max(s.startOpacity,0),1),s.startTime=e,s.targetOpacity=r.show&&s.show?1:0}}}const SLt=32,ELt=8,CLt=64,MLt=20;let ALt=class{constructor(e,i,r){this.tileCoordRange=e,this._visibleTiles=i,this._createUnique=r,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){return this._uniqueSymbolLayerArray==null&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}get uniqueSymbolsReferences(){return this._uniqueSymbolsReferences}add(e,i){this._uniqueSymbolLayerArray=null;let r=this._tiles.get(e.id);r||(r={symbols:new Map},this._tiles.set(e.id,r));const s=new Map;if(i)for(const a of i)r.symbols.has(a)&&(s.set(a,r.symbols.get(a)),r.symbols.delete(a));else for(const[a,l]of e.layerData)r.symbols.has(a)&&(s.set(a,r.symbols.get(a)),r.symbols.delete(a));this._removeSymbols(s);const n=e.symbols,o=new Map;for(const[a,l]of n){let c=l.length;if(c>=SLt){let u=this.tileCoordRange;do u/=2,c/=4;while(c>ELt&&u>CLt);const d=new oke(this.tileCoordRange,this.tileCoordRange,u);o.set(a,{flat:l,index:d}),r.symbols.set(a,{flat:l,index:d});for(const f of l)d.getCell(f.xTile,f.yTile).push(f)}else o.set(a,{flat:l}),r.symbols.set(a,{flat:l})}this._addSymbols(e.key,n)}deleteStyleLayers(e){this._uniqueSymbolLayerArray=null;for(const[i,r]of this._tiles){const s=new Map;for(const n of e)r.symbols.has(n)&&(s.set(n,r.symbols.get(n)),r.symbols.delete(n));this._removeSymbols(s),r.symbols.size===0&&this._tiles.delete(i)}}removeTile(e){this._uniqueSymbolLayerArray=null;const i=this._tiles.get(e.id);if(!i)return;const r=new Map;for(const[s,n]of e.symbols)i.symbols.has(s)&&(r.set(s,i.symbols.get(s)),i.symbols.delete(s));this._removeSymbols(r),i.symbols.size===0&&this._tiles.delete(e.id)}querySymbols(e,i,r,s){const n=[],o=this.uniqueSymbols;for(const a of o){const l=a.styleLayerUID,c=a.uniqueSymbols;for(const u of c){const d=u.tileSymbols.find(f=>f.selectedForRendering);d&&fIt(d,e,i*(window.devicePixelRatio||1),r)&&n.push({vtlSymbol:d,styleLayerUID:l,tileKey:d.tile.key})}}return n}_removeSymbols(e){for(const[i,{flat:r}]of e)for(const s of r){const n=s.unique,o=n.tileSymbols,a=o.length-1;for(let l=0;l<a;l++)if(o[l]===s){o[l]=o[a];break}if(o.length=a,a===0){const l=this._uniqueSymbolsReferences.get(i);l.delete(n),l.size===0&&this._uniqueSymbolsReferences.delete(i)}s.unique=null}}_addSymbols(e,i){if(i.size===0)return;const r=this._visibleTiles;for(const s of r)s.parentTile||s.key.world!==e.world||s.key.level===e.level&&!s.key.equals(e)||this._matchSymbols(s,e,i);for(const[s,n]of i)for(const o of n)if(o.unique==null){const a=this._createUnique();o.unique=a,a.tileSymbols.push(o);let l=this._uniqueSymbolsReferences.get(s);l||(l=new Set,this._uniqueSymbolsReferences.set(s,l)),l.add(a)}}_matchSymbols(e,i,r){if(e.key.level>i.level){const n=e.key.level-i.level;if(e.key.row>>n!==i.row||e.key.col>>n!==i.col)return}if(i.level>e.key.level){const n=i.level-e.key.level;if(i.row>>n!==e.key.row||i.col>>n!==e.key.col)return}if(i.equals(e.key)){for(const n of e.childrenTiles)this._matchSymbols(n,i,r);return}const s=new Map;for(const[n,o]of r){const a=[];for(const d of o){const f=q_e(this.tileCoordRange,d.xTile,i.level,i.col,e.key.level,e.key.col),m=q_e(this.tileCoordRange,d.yTile,i.level,i.row,e.key.level,e.key.row);f>=0&&f<this.tileCoordRange&&m>=0&&m<this.tileCoordRange&&a.push({symbol:d,xTransformed:f,yTransformed:m})}const l=[],c=(e.key.level<i.level?1:1<<e.key.level-i.level)+MLt,u=this._tiles.get(e.id).symbols.get(n);if(u){const d=u.flat;for(const f of a){let m,g=!1;const y=f.xTransformed,v=f.yTransformed;m=u.index!=null?u.index.getCell(y,v):d;const b=f.symbol,w=b.hash;for(const x of m)if(w===x.hash&&Math.abs(y-x.xTile)<=c&&Math.abs(v-x.yTile)<=c){const S=x.unique;b.unique=S,S.tileSymbols.push(b),g=!0;break}g||l.push(b)}}l.length>0&&s.set(n,l)}for(const n of e.childrenTiles)this._matchSymbols(n,i,s)}_createUniqueSymbolLayerArray(){const e=this._uniqueSymbolsReferences,i=new Array(e.size);let r,s=0;for(const[n,o]of e){const a=new Array(o.size);r=0;for(const l of o)a[r++]=l;i[s]={styleLayerUID:n,uniqueSymbols:a},s++}return i}};function PLt(t,e){const i=t.transforms.tileUnitsToPixels,r=Yj(e),s=Math.cos(r),n=Math.sin(r),o=Math.ceil(512*(Math.abs(n)+Math.abs(s)));AG(Am),KA(Am,Am,[o/2,o/2]),PG(Am,Am,r),KA(Am,Am,[-256,-256]),CD(Am,Am,[1/8,1/8,1]),t.transforms.tileUnitsToPixels=Am;const a=[],l=new ALt(4096,a,()=>new uIt),c=new xLt(a,l,(u,d,f)=>new bLt(u,d,f,t.styleRepository,t.key.level,e),(u,d)=>{dIt(u,d,!1)},()=>0,u=>{const d=t.styleRepository.getStyleLayerByUID(u).getLayoutProperty("visibility");return!d||d.getValue()!==R1.NONE});a.push(t),l.add(t),c.setScreenSize(o,o),c.continue(1/0),l.removeTile(t),t.transforms.tileUnitsToPixels=i}const Am=bS();let OLt=class extends ake{_createTransforms(){return{displayViewScreenMat3:bS(),tileMat3:bS()}}},RLt=class{constructor(){this._candidateTiles=[]}schedule(e){this._candidateTiles.includes(e)||this._candidateTiles.push(e)}reshuffle(e){const i=[];for(const r of this._candidateTiles)e>0?(r.reshuffle(),e--):i.push(r);this._candidateTiles=i}};const $Lt=.125;let ILt=class{constructor(){this._renderParams={reshuffleManager:new RLt,context:null,drawPhase:1,state:new LLt,stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null},this._backgroundTile=new OLt(new y_(0,0,0,0),0,0,0,512,512,4096,4096),this._heading=0,this._declutteredForHeading=new WeakMap}dispose(){this._renderParams=null}renderBackground(e,i,r,s,n,o,a,l,c,u){const d=this._backgroundTile;this._updateRenderParameters(e,i,d,r,n,o,a,l,c,u),this._renderParams.stencilSymbols=!1,r.drawBackground(this._renderParams,d,s)}renderContent(e,i,r,s,n,o,a,l,c,u,d,f){this._declutter(r),s.forAll(g=>this._declutter(g.sourceLayerInfo.data)),this._stencilSymbols(e,i,r,s,n,o,a,Math.round(1/l),c,u,d,f);let m=1;r.stencilRef=m++,e.setStencilFunction(br.EQUAL,r.stencilRef,255),this._render(e,i,r,n,o,a,l,c,u,d,f),s.forAll(g=>{g.sourceLayerInfo.data.stencilRef=m++,this._renderSymbols(e,g.sourceLod,g.sourceLayerInfo.data,n,o,a,Math.round(1/l),g.offset,u,d,f)})}_stencilSymbols(e,i,r,s,n,o,a,l,c,u,d,f){let m=1;r.stencilRef=m++,e.setDepthTestEnabled(!1),e.setDepthWriteEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(bs.KEEP,bs.KEEP,bs.REPLACE),e.setStencilWriteMask(255),e.setStencilFunction(br.ALWAYS,r.stencilRef,255),this._stencilTileSymbols(e,i,r,n,o,a,l,c,u,d,f);for(const g of s.toArray()){const{sourceLod:y,offset:v,sourceLayerInfo:b}=g;b.data.stencilRef=m++,e.setStencilFunction(br.ALWAYS,b.data.stencilRef,255),this._stencilTileSymbols(e,y,b.data,n,o,a,l,v,u,d,f)}e.setStencilWriteMask(0),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!0),e.setColorMask(!0,!0,!0,!0)}_renderSymbols(e,i,r,s,n,o,a,l,c,u,d){e.setStencilFunction(br.EQUAL,r.stencilRef,255),this._render(e,i,r,s,n,o,a,l,c,u,d,GK.SYMBOL)}_render(e,i,r,s,n,o,a,l,c,u,d,f){this._updateRenderParameters(e,i,r,s,o,a,l,c,u,d),this._renderParams.stencilSymbols=!1,s.drawTile(this._renderParams,r,n,f)}_stencilTileSymbols(e,i,r,s,n,o,a,l,c,u,d){this._updateRenderParameters(e,i,r,s,o,a,l,c,u,d),this._renderParams.stencilSymbols=!0,r.triangleCount=0,s.drawSymbols(this._renderParams,r,n)}_updateRenderParameters(e,i,r,s,n,o,a,l,c,u){"type"in r&&r.type==="vector-tile"&&!r.stage&&r.attachWithContext(e);const d=i[0]-n.getLevelShift(i[0]),f=this._renderParams;f.context=e,f.painter=s,f.glyphMosaic=s.glyphMosaic,f.spriteMosaic=s.spriteMosaic,f.pixelRatio=c*u,f.displayLevel=d,f.requiredLevel=d;const m=n.getScale(i[0]),[g,y]=n.getOffset(i,o*m),v=$Lt*o*m/l,b=r.transforms.displayViewScreenMat3;b[0]=v,b[4]=-v,b[6]=-1-g-a[0]*o*2,b[7]=1+y+(1-a[1])*o*2-2;const w=f.state,x=l/u;w.size[0]=x,w.size[1]=x,w.pixelRatio=u,w.rotation=(360-this._heading)%360;const S=2/x;rse(w.displayViewMat3,S,0,0,0,-S,0,-1,1,1);const C=AG(w.displayMat3),M=Yj(this._heading);KA(C,C,[x/2,x/2]),PG(C,C,M),KA(C,C,[-x/2,-x/2]),QA(C,w.displayViewMat3,C)}updateHeading(e){this._heading=e}_declutter(e){this._declutteredForHeading.get(e)!==this._heading&&(PLt(e,(360-this._heading)%360),this._declutteredForHeading.set(e,this._heading))}},LLt=class{constructor(){this.size=[0,0],this.pixelRatio=1,this.rotation=0,this.displayMat3=Yr(),this.displayViewMat3=Yr(),this.transform=null,this.inverseTransform=null,this.viewMat2d=null,this.viewMat3=null,this.id=0,this.extent=null,this.center=null,this.scale=1,this.resolution=0,this.worldScreenWidth=0,this.spatialReference=null,this.viewpoint=null,this.getScreenTransform=null,this.toMap=null,this.toScreen=null,this.clone=null,this.copy=null,this.toJSON=null}};function DLt(t){t.fragment.uniforms.add(new wt("u_colormap",e=>e.u_colormap),new et("u_colormapOffset",e=>e.colormap.u_colormapOffset),new et("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new et("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(T`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function NLt(t){t.fragment.uniforms.add(new wt("u_transformGrid",e=>e.u_transformGrid),new jr("u_transformSpacing",e=>e.common.u_transformSpacing),new jr("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(T`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let FLt=class extends Bke{constructor(e,i,r){super(),this.common=e,this.u_image=i,this.u_transformGrid=r}};function kLt(t,e){t.include(NLt),t.fragment.uniforms.add(new wt("u_image",r=>r.u_image),new Bg("u_flipY",r=>r.common.u_flipY),new Bg("u_applyTransform",r=>r.common.u_applyTransform));const{requireBilinearWithNN:i}=e;i&&t.fragment.uniforms.add(new jr("u_srcImageSize",r=>r.common.u_srcImageSize)),t.fragment.code.add(T`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),i?t.fragment.code.add(T`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(T`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}let eH=class extends FLt{constructor(e,i,r,s,n,o){super(e,s,n),this.colormap=i,this.symbolizer=r,this.u_colormap=o,this.backgroundColor=On,this.fboTexture=null,this.baseOpacity=1}},Yke=class extends eH{},Xke=class extends eH{};function Jke(t){const e=new Hi;return e.include(jke),e.include(kLt,t),e.include(DLt,t),e.include(Gke,t),e.fragment.code.add(T`vec4 applyBackgroundBlend(vec4 layerColor) {
return blendLayers(vuv, layerColor, u_opacity);
}`),t.colorizerType===wS.Stretch?VLt(e,t):t.colorizerType===wS.Lut?ULt(e):t.colorizerType===wS.Hillshade&&zLt(e,t),e}function ULt(t){t.fragment.code.add(T`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function VLt(t,e){t.fragment.uniforms.add(new cO("u_bandCount",r=>r.symbolizer.u_bandCount),new Yl("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new Yl("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new Yl("u_factor",r=>r.symbolizer.u_factor,3),new et("u_minOutput",r=>r.symbolizer.u_minOutput),new et("u_maxOutput",r=>r.symbolizer.u_maxOutput),new Bg("u_useGamma",r=>r.symbolizer.u_useGamma),new Yl("u_gamma",r=>r.symbolizer.u_gamma,3),new Yl("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new et("u_opacity",r=>r.common.u_opacity)),t.fragment.code.add(T`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=e.applyColormap?T`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:T`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(T`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===n2.Noop?T`
        fragColor = applyBackgroundBlend(currentPixel);`:T`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function zLt(t,e){const i=t.fragment;i.uniforms.add(new wt("u_image",s=>s.u_image),new cO("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new Yl("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new Yl("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new Yl("u_cosZs",s=>s.symbolizer.u_cosZs,6),new Yl("u_weights",s=>s.symbolizer.u_weights,6),new jr("u_factor",s=>s.symbolizer.u_factor),new et("u_minValue",s=>s.symbolizer.u_minValue),new et("u_maxValue",s=>s.symbolizer.u_maxValue),new jr("u_srcImageSize",s=>s.common.u_srcImageSize)),i.include(by),i.code.add(T`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),i.code.add(T`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=e.applyColormap?T`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:T`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.code.add(T`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}const BLt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:Xke,ColorizerStretchUniforms:Yke,ColorizerUniforms:eH,build:Jke},Symbol.toStringTag,{value:"Module"}));let Qke=class Kke extends Qi{initializeProgram(e){return new Ki(e.rctx,Kke.shader.get().build(this.configuration),Ai)}initializePipeline(){return Jt({blending:Hh(Be.ONE,Be.ONE_MINUS_SRC_ALPHA),colorWrite:ui})}};Qke.shader=new qi(BLt,()=>ce(()=>Promise.resolve().then(()=>IHt),void 0));let mI=class extends R3{constructor(){super(...arguments),this.colorizerType=wS.Stretch,this.stretchType=n2.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};h([B({count:wS.COUNT})],mI.prototype,"colorizerType",void 0),h([B({count:n2.COUNT})],mI.prototype,"stretchType",void 0),h([B()],mI.prototype,"applyColormap",void 0),h([B()],mI.prototype,"requireBilinearWithNN",void 0);let dve=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const i=this._fbos.get(e);if(i)return i;const r=new wy(this._rctx,new Xr(e),new b$e(Ea.DEPTH24_STENCIL8,e));return this._fbos.set(e,r),r}};const jLt=()=>se.getLogger("esri.views.3d.terrain");let GLt=class{constructor(e,i){this._rctx=e,this._techniques=i,this._fbos=[],this._vectorTileHelper=new ILt,this._bindParameters=new YG(null,null),this._blendLayersTechniqueConfig=new Zke,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=vy(this._rctx,DD)}dispose(){this._fbos.forEach(Ut),this._fbos=null,this._vtFBO=Ut(this._vtFBO),this._vaoQuad=Ut(this._vaoQuad),this._vectorTileHelper=Ut(this._vectorTileHelper),this._backgroundTechnique=hi(this._backgroundTechnique),this._applyOpacityTechnique=hi(this._applyOpacityTechnique),this._blendLayersTechnique=hi(this._blendLayersTechnique)}updateHeading(e){var i;(i=this._vectorTileHelper)==null||i.updateHeading(e)}_getBlendLayersTechnique(e,i,r,s=hf.Off,n=zb.BelowLayer){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=r,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._blendLayersTechnique=this._techniques.releaseAndAcquire(qke,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,i){const r=this._getBlendLayersTechnique(Je.Normal,i?An.ColorComposite:An.GridComposite,Ja.NotRequired,hf.Off,zb.Only),s=this._rctx.bindTechnique(r,this._bindParameters,e);this._render(s)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Ci.TRIANGLE_STRIP,0,J0(this._vaoQuad,"geometry"))}drawGroup(e,i,r,s,n=hf.On){i===An.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture),e.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);const o=e.baseOpacity<1?Ja.Required:Ja.NotRequired,a=this._getBlendLayersTechnique(s,i,o,n),l=this._rctx.bindTechnique(a,this._bindParameters,e);this._render(l)}drawImageData(e,i,r,s,n=hf.Off){if(e.texture==null)return;const o=e.baseOpacity<1?Ja.Required:Ja.NotRequired;e.fboTexture=i===An.GroupBackgroundComposite||s===Je.Normal&&o===Ja.NotRequired&&n===hf.Off?null:this.switch(r).colorTexture;const a=this._getBlendLayersTechnique(s,i,o,n),l=this._rctx.bindTechnique(a,this._bindParameters,e);this._render(l)}drawRasterData(e,i,r,s,n){const o=n.sourceLayerInfo.data;if(!o.source||(n.tile.surface.layerViewByIndex(n.layerIndex,Qt.MAP).ensureSymbolizerParameters(o),!o.bind(this._rctx)))return;const a=e.baseOpacity<1?Ja.Required:Ja.NotRequired;e.fboTexture=s===Je.Normal&&a===Ja.NotRequired?null:this.switch(r).colorTexture;const l=this._getRasterColorizerTechnique(o,i,s,a);o.opacity=e.opacity;const c=o.getUniforms();c.scale=n.scale,c.offset=n.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const u=this._rctx.bindTechnique(l,null,c);this._render(u)}_getRasterColorizerTechnique(e,i,r,s){const n=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new mI,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=i,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?n2.Noop:n2.PerBand,this._rasterColorizerTechnique=this._techniques.releaseAndAcquire(Qke,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,i,r,s,n,o,a,l){const c=this._rctx,u=n.sourceLayerInfo.data,d=n.tile.surface.layerViewByIndex(n.layerIndex,Qt.MAP),f=e.baseOpacity<1?Ja.Required:Ja.NotRequired,m=f===Ja.Required||e.opacity<1||s!==Je.Normal||i!==An.Composite,g=m?hf.On:hf.Off,y=this._getBlendLayersTechnique(s,i,f,g);c.setPipelineState(y.getPipeline());let v=null,b=null;m?(b=this.currentFBO(r),this._vtFBO==null&&(this._vtFBO=new dve(this._rctx)),v=this._vtFBO.get(r),c.bindFramebuffer(v),this._clearCurrentFBO()):l&&c.clear(zr.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.renderBackground(c,n.sourceLod,d.painter,d.layer.styleRepository,d.schemaHelper,Math.round(1/n.scale),n.offset,a,o,d.contentZoom),u&&this._vectorTileHelper.renderContent(c,n.sourceLod,u,n.vtlNeighborInfos,d.painter,d.layer.styleRepository,d.schemaHelper,Math.round(1/n.scale),n.offset,a,o,d.contentZoom)}catch(w){jLt().warnOnce("A render call containing vector tiles did not resolve correctly.",w)}return v==null||(c.bindFramebuffer(b),e.texture=v.colorTexture,e.offset=jS,e.scale=1,this.drawImageData(e,i,r,s,g),l)}copyFBOToTexture(e){const i=this._rctx,r=i.bindTexture(e.texture,Er.TEXTURE_UNIT_FOR_UPDATES),s=e.descriptor;i.gl.copyTexImage2D(Ns.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),e.generateMipmap(),i.bindTexture(r,Er.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clear(zr.COLOR_BUFFER_BIT|zr.DEPTH_BUFFER_BIT|zr.STENCIL_BUFFER_BIT)}_initFBO(e,i,r){this._rctx.bindFramebuffer(e),r&&(this._rctx.setViewport(0,0,i,i),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,i=0,r=!0){if(this._current=i,i>=this._fbos.length)for(let s=this._fbos.length;s<=i;s++)this._fbos.push(new dve(this._rctx));this._initFBO(this._fbos[i].get(e),e,r)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const i=this.currentFBO(e),r=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),i}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const i=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},HLt=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new ai({allocator:e=>e||new qLt})}},qLt=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},pve=class{constructor(e,i){this._texture=e,this._cache=i,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){if(--this._refCount,this._refCount===0)if(this._cache){const e=`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`;this._cache.put(e,this)}else this.dispose()}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.usedMemory}},WLt=class{constructor(e,i,r,s,n,o){this.start=e,this.end=i,this.blendMode=r,this.opacity=s,this.output=n,this.baseOpacity=o}},ZLt=class{constructor(e,i,r,s){this._rctx=e,this.tileSize=i,this._techniques=r,this._cache=s,this._passParameters=new _Lt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._compositor=new GLt(this._rctx,this._techniques),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._compositor=Ut(this._compositor),this._backgroundTexture=hi(this._backgroundTexture)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateHeading(e){var i;(i=this._compositor)==null||i.updateHeading(e)}updateTileTexture(e,i){if(!e.renderData)return;const r=e.surface,s=r.baseOpacity;let n=0,o=0,a=this.tileSize,l=!1,c=!1;const u=r.view.state.contentPixelRatio;let d=!1;ij.clear(),NE.length=0;const f=e.layerInfo[Qt.MAP];let m=0,g=null;for(;m<f.length;m++){const b=r.layerViewByIndex(m,Qt.MAP),w=b.layer.opacity,x=b.fullOpacity;if(c=c||lk(b.layer),HL(b)){let M=b.layer.blendMode!=="normal";if(LA(b.layer.parent)){const O=ZK(b.layer.parent);O!=null&&O!==""&&(M=eUe(b.layer.parent)||M)}M&&(d=M,l=!1)}if(w===0&&!d){f[m].pendingUpdates&=~(Tt.TEXTURE_NOFADING&Tt.TEXTURE_FADING);continue}++o;const S=EP(b),C=t7(e,m,S);if(C){if(f[m].pendingUpdates&=~(Tt.TEXTURE_NOFADING&Tt.TEXTURE_FADING),LA(b.layer.parent)){const M=ZK(b.layer.parent);M!=null&&M!==""&&tUe(b.layer.parent,m)}S?a=Math.max(a,this.tileSize*u):s===1&&x===1&&(b.isOpaque||this._dataToTexture(C)&&C.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n,g===null&&(g=m)}}const y=a/this.tileSize,v=this._ensureBackgroundTexture(this.tileSize);n!==0&&g!==null?n===1&&!d&&this._useLayerTexture(e,g)||this._composeLayers(e,i,m-1,c,a,y,!l||d,ij,d):XLt(e,o,v,i!==vn.FADING)}_ensureBackgroundTexture(e){return this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e,!1),this._backgroundDirty=!0),this._backgroundDirty&&(this._compositor.bind(e),this._passParameters.offset=jS,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._compositor.drawBackground(this._passParameters,this.backgroundColor!=null),this._compositor.copyFBOToTexture(this._backgroundTexture),this._compositor.unbind(),this._backgroundDirty=!1),this._backgroundTexture}_useLayerTexture(e,i){const r=e.surface.layerViewByIndex(i,Qt.MAP),s=lk(r.layer),n=s?e.surface.baseOpacity:1,o=s?1:e.surface.baseOpacity,a=r.fullOpacity,l=t7(e,i,!1);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new jK(l.sourceLayerInfo.data,vn.FADING,l,n,o,a)),!0)}_composeLayers(e,i,r,s,n,o,a,l,c){this._compositor.ensureBuffer(n);const u=e.surface.baseOpacity;let d=!1,f=di.LINEAR_MIPMAP_LINEAR,m=!1,g=0;for(let w=r;w>=0;w--){const x=e.surface.layerViewByIndex(w,Qt.MAP),S=EP(x),C=t7(e,w,S),M=x.layer.opacity;if(!C||M===0&&!c)continue;const O=!lk(x.layer)&&!d;O&&(d=!0);let D=!1;l.forEach(V=>{V.start===w&&(V.output=s?An.Composite:a&&O?this.backgroundIsGrid?An.GridComposite:An.ColorComposite:An.Composite,V.baseOpacity=O?u:1,NE.push(V),this._compositor.openGroup(n),D=!0)});const U=g===0,k=D?An.GroupBackgroundComposite:a&&U?this.backgroundIsGrid?An.GridComposite:An.ColorComposite:An.Composite,H=BK[HL(x)?x.layer.blendMode:"normal"];for(this._passParameters.baseOpacity=O&&!D&&u<1?u:1,this._passParameters.opacity=M,zIt(C)?m=this._compositor.drawVectorData(this._passParameters,k,n,H,C,o,this.tileSize,m):VIt(C)?(this._compositor.drawRasterData(this._passParameters,k,n,H,C),YLt(C)&&(f=di.NEAREST)):this._dataToTexture(C)&&(this._passParameters.texture=C.sourceLayerInfo.data.texture,this._passParameters.offset=C.offset,this._passParameters.scale=C.scale,this._compositor.drawImageData(this._passParameters,k,n,H));NE.length>0&&NE[NE.length-1].end===w;){const V=NE.pop();this._passParameters.baseOpacity=V.baseOpacity,this._passParameters.opacity=V.opacity,this._passParameters.offset=jS,this._passParameters.scale=1,this._compositor.drawGroup(this._passParameters,V.output,n,BK[V.blendMode])}g++}const y=e.renderData,v=c||d&&u<1,b=y.ensureTexture(n,v,()=>this._buildTexture(n,v,f));this._compositor.copyFBOToTexture(b),this._compositor.unbind(),y.setTextureReference(new jK(b,i,iUe,d?1:u,0,1))}_dataToTexture(e){if(jIt(e)){const i=e.sourceLayerInfo;i.data=this._buildTexture(i.data,!0),e.tile.setMemoryDirty()}return BIt(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,i,r=di.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const s=new Xr;s.wrapMode=Mi.CLAMP_TO_EDGE,s.samplingMode=r,s.maxAnisotropy=this._maxAnisotropy,s.preMultiplyAlpha=!0,s.flipped=!0,s.hasMipmap=!0,i||(s.pixelFormat=Ht.RGB);const n=this._rctx;let o;if(typeof e=="number")s.width=s.height=e,o=this._buildTileTexture(s,e);else if(J6(e))s.isOpaque=e.isOpaque,s.isOpaque&&(s.pixelFormat=Ht.RGB),o=this._buildTileTexture(s,e.element.width,e.element);else try{s.width=e.width,s.height=e.height,o=this._buildTileTexture(s,e.width,e)}catch{o=new pve(e$e(n)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const a=n.bindTexture(o.texture,Er.TEXTURE_UNIT_FOR_UPDATES);return o.generateMipmap(),n.bindTexture(a,Er.TEXTURE_UNIT_FOR_UPDATES),o}_buildTileTexture(e,i,r){const s=`${i} ${e.pixelFormat}`,n=this._cache.pop(s);return n?(n.retain(),n.texture.setData(r),n):new pve(new Er(this._rctx,e,r),this._cache)}get test(){}};function t7(t,e,i){ja.layerIndex=e,ja.vtlNeighborInfos.clear();const r=t.layerInfo[Qt.MAP][e];if(Li(ja.offset,0,0),ja.tile=t,ja.scale=1,ja.sourceLod=t.lij,ja.sourceLayerInfo=r,ja.isVTLBackground=i,r.data)return i&&t.forEachLoadedNeighbor((n,o)=>{if(n.level!==t.level)return;const a=n.layerInfo[Qt.MAP][e];if(!pke(a)||r.data===a.data)return;const l=ja.vtlNeighborInfos.pushNew();l.offset=l0[o],l.sourceLod=n.lij,l.sourceLayerInfo=a}),ja;const s=r.upsampleInfo;if(s){const n=s.tile.layerInfo[Qt.MAP][e];return ja.tile=s.tile,Da(ja.offset,s.offset),ja.scale=s.scale,ja.sourceLod=s.tile.lij,ja.sourceLayerInfo=n,ja}return i?ja:null}function ZK(t){return t.uid}function YLt(t){const e=t.sourceLayerInfo.data;return!!e.source&&e.interpolation==="nearest"}function eUe(t){let e=t.blendMode!=="normal";return LA(t.parent)&&(e=eUe(t.parent)||e),e}function tUe(t,e){LA(t.parent)&&tUe(t.parent,e);const i=ZK(t);if(i!=null&&i!==""){const r=ij.get(i);r?r.start=e:ij.set(i,new WLt(e,e,t.blendMode,t.opacity,An.Composite,1))}}function XLt(t,e,i,r){const s=t.renderData,n=!r&&s.textureReference!=null&&(t.surface.view.layerViewManager.updating||e>0)?cb.Delayed:cb.Immediate;s.setTextureReference(new jK(i,vn.FADING,iUe,t.surface.baseOpacity,0,1),n)}const ij=new Map,NE=new Array,ja=new HLt,iUe={offset:[0,0],scale:1},l0=new Array;l0[Pt.NORTH]=[0,-1],l0[Pt.NORTH_EAST]=[-1,-1],l0[Pt.EAST]=[-1,0],l0[Pt.SOUTH_EAST]=[-1,1],l0[Pt.SOUTH]=[0,1],l0[Pt.SOUTH_WEST]=[1,1],l0[Pt.WEST]=[1,0],l0[Pt.NORTH_WEST]=[1,-1];const JLt=200,i7=40,QLt=.8,KLt=10,gI=1e-6;function eDt(t,e,i){const r=e,s=i;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(r[a]<l){if(s[a]<=gI)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-gI){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=t[a+3];if(r[a]>l){if(s[a]>=-gI)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]>=gI){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}let fve=class{constructor(e,i,r,s,n){this.aabb=e,this.axis=i,this.d=r,this.midStartIndex=s,this.rightStartIndex=n}},rUe=class YK{constructor(e,i,r,s){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=i,this.positions=s,this._rayDirection=E(),this._callback=gve,this._intersectionOptions=mve,this.bspNodeTree=new Array;const n=r-i,o=new(n<nDt?Uint8Array:n<oDt?Uint16Array:Uint32Array)(n);this.triangleIndexMap=o;for(let a=0;a<n;++a)o[a]=a;{const a=sDt(e,i,r,s.data,s.stride),l=Ne(Math.log2(n/i7),2,KLt),c=(u,d,f)=>{const m=iDt(o,a,u,d),g=d-u;if(g<=i7){const S=new fve(m,void 0,0,u,d);return this.bspNodeTree.push(S),S}const{axis:y,midValue:v}=rDt(m),b=tDt(o,a,u,d,y,v),w=(S,C)=>{if(f>l)return;const M=C-S;return M<i7||M>=QLt*g?void 0:c(S,C,f+1)},x=new fve(m,y,v,b.next,b.mid);return this.bspNodeTree.push(x),x.leftNode=w(u,b.next),x.rightNode=w(b.mid,d),x};c(0,n,0)}}intersectRayTriangleRange(e,i){if(e>=i)return;const r=this.positions;LLe(this._rayFrom,this._rayDirection,e,i,this.globalTriangleVertexIndices,r.data,r.stride,this._intersectionOptions.normalRequired,this._callback,this.triangleIndexMap,this.firstTriangleIndex),YK.numFacesTested+=i-e}intersectRay(e,i,r,s){YK.numFacesTested=0;const n=e,o=i,a=o[0]-n[0],l=o[1]-n[1],c=o[2]-n[2];if(a*a+l*l+c*c<gI)return;this._rayFrom=n;const u=this._rayDirection;u[0]=a,u[1]=l,u[2]=c;const d=this.triangleIndexMap.length;this._callback=s,this._intersectionOptions=r,this.intersectRayBSP(this.bspNodeTree[0],0,d),this._callback=gve,this._intersectionOptions=mve}intersectRayBSP(e,i,r){const s=this._rayFrom,n=this._rayDirection;if(!eDt(e.aabb,s,n))return;const o=e.axis,a=e.d;if(s[o]<a||n[o]<0){const l=i,c=e.midStartIndex;if(l<c){const u=e.leftNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),s[o]>a||n[o]>0){const l=e.rightStartIndex,c=r;if(l<c){const u=e.rightNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleIndexMap.byteLength}};rUe.numFacesTested=0;const FE=[1/0,1/0,1/0],kE=[-1/0,-1/0,-1/0];function tDt(t,e,i,r,s,n){let o=i,a=r;for(;o<a;){const c=t[o];e[6*c+s+3]<=n?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=r;l<a;){const c=t[a-1];e[6*c+s]>=n?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function iDt(t,e,i,r){if(r<=i)return ZS(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*t[i];for(let n=0;n<3;++n)FE[n]=e[s+0+n],kE[n]=e[s+3+n]}for(let s=i+1;s<r;++s){const n=6*t[s];for(let o=0;o<3;++o)FE[o]=Math.min(FE[o],e[n+0+o]),kE[o]=Math.max(kE[o],e[n+3+o])}return ZS(FE[0],FE[1],FE[2],kE[0],kE[1],kE[2])}function rDt(t){const e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2],s=e>i?e>r?0:i>r?1:2:i>r?1:r>e?2:0;return{axis:s,midValue:(t[s]+t[s+3])/2}}function sDt(t,e,i,r,s){const n=i-e,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+e),c=t[l]*s,u=t[l+1]*s,d=t[l+2]*s;for(let f=0;f<3;++f){const m=r[c+f],g=r[u+f],y=r[d+f];o[6*a+f]=Math.min(m,g,y),o[6*a+3+f]=Math.max(m,g,y)}}return o}const nDt=255,oDt=65535,mve=new ZD,gve=()=>{};let Gs=class extends Uc{constructor(){super(...arguments),this.output=j.Color,this.overlayMode=Rg.Disabled,this.tileBlendInput=Dg.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.opaque=!0,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=At.Simplified}};h([B({count:j.COUNT})],Gs.prototype,"output",void 0),h([B({count:Rg.COUNT})],Gs.prototype,"overlayMode",void 0),h([B({count:Dg.COUNT})],Gs.prototype,"tileBlendInput",void 0),h([B()],Gs.prototype,"spherical",void 0),h([B()],Gs.prototype,"doublePrecisionRequiresObfuscation",void 0),h([B()],Gs.prototype,"receiveShadows",void 0),h([B()],Gs.prototype,"hasSlicePlane",void 0),h([B()],Gs.prototype,"backfaceCullingEnabled",void 0),h([B()],Gs.prototype,"textureFadingEnabled",void 0),h([B()],Gs.prototype,"renderOccluded",void 0),h([B()],Gs.prototype,"hasScreenSpaceReflections",void 0),h([B()],Gs.prototype,"hasCloudsReflections",void 0),h([B()],Gs.prototype,"invisible",void 0),h([B()],Gs.prototype,"opaque",void 0),h([B()],Gs.prototype,"tileBorders",void 0),h([B()],Gs.prototype,"visualizeNormals",void 0),h([B()],Gs.prototype,"screenSizePerspective",void 0),h([B()],Gs.prototype,"receiveAmbientOcclusion",void 0),h([B({count:At.COUNT})],Gs.prototype,"pbrMode",void 0),h([B({constValue:sr.Compressed})],Gs.prototype,"normalType",void 0),h([B({constValue:vs.Compressed})],Gs.prototype,"textureCoordinateType",void 0),h([B({constValue:!1})],Gs.prototype,"highStepCount",void 0),h([B({constValue:!1})],Gs.prototype,"useCustomDTRExponentForWater",void 0),h([B({constValue:!1})],Gs.prototype,"useFillLights",void 0),h([B({constValue:!0})],Gs.prototype,"hasColorTexture",void 0);const r7=7,aDt=10,s7=Xn();var tl;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(tl||(tl={}));let vd=class extends wIe{get _isGlobal(){return this._stage.viewingMode===Xe.Global}get _techniques(){return this._context.techniques}get _rctx(){return this._context.renderContext.rctx}constructor(e,i,r,s,n){super({}),this._overlayRenderer=e,this._stage=i,this._allTiles=r,this._ellipsoidRadius=s,this.type=rs.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new Gs,this._passParameters=new Tae,this._drawParameters=new QQ,this._renderDataPool=new la(I3t),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new _ke,this._transparencyState=tl.Opaque,this._castShadows=!1,this._inViewshed=!1,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=er.Occlude,this.produces=new Map([[Pe.OPAQUE_TERRAIN,()=>this._produces()],[Pe.TRANSPARENT_TERRAIN,()=>this._produces()],[Pe.OCCLUDED_TERRAIN,()=>this._produces()]]),this._tileTextureCache=new oN((o,a)=>n.newCache(o,a),"TileTexture"),this.tileGeometryCache=new pLt(n)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this),this.addHandles(te(()=>this._overlayRenderer.rendersOccludedDraped,e=>{this.renderOccludedFlags=e?LB:er.Occlude,this.setNeedsRender()},or))}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?fne:o6}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set visible(e){this._set("visible",!!e),this.setDirty()}updateHeading(e){var i;(i=this._tileRenderer)==null||i.updateHeading(e)}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===tl.TransparentWithDraped||e===tl.Empty,this._techniqueConfiguration.opaque=e===tl.Opaque,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return Ab}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e,this._getLocalOriginOfTile(e)))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,Tt.TEXTURE_FADING)}updateTileTexture(e,i){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,i===Tt.TEXTURE_FADING?vn.FADING:vn.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(i))}updateTileGeometryState(e){for(const r of e.layerInfo[Qt.ELEVATION])r.pendingUpdates&=~Tt.GEOMETRY;e.resetPendingUpdate(Tt.GEOMETRY);const i=e.renderData.updateGeometryState();return i&&this.setDirty(),i}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const i=e.renderData;i&&(i.releaseGeometry(),this._renderDataPool.release(i),i.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const i=aDt-r7,r=Math.max(0,Math.floor((e.level-i)/r7)*r7);if(this._isGlobal&&r===0)return On;for(;e.parent&&e.level>r;)e=e.parent;return e.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=ar.UPDATE){this._patchesByOriginDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=ar.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=ar.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._tileRenderer=new ZLt(this._rctx,this._tileSize,this._techniques,this._tileTextureCache),this.updateTileBackground(),this._emptyTex=e$e(this._rctx)}uninitializeRenderContext(){this._emptyTex=Ut(this._emptyTex),this._tileRenderer=Ut(this._tileRenderer)}intersect(e,i,r,s){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==tl.Opaque)return;const n=lDt,o=cDt;Re(n,s,r),de(o,1/n[0],1/n[1],1/n[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,u=e.options.store===oa.MIN,d=!!e.results.ground.target,f=Grt(e.verticalOffset),m=e.tolerance;let g,y=u&&a.dist!=null?a.dist:1/0;const v=e.options,b=v.normalRequired||!v.backfacesTerrain,w=new ZD(!1,b),x=C=>{const M=C.renderData;if(!(M!=null&&M.vao))return;const O=M.geometry;UG(s7,O.boundingBox);const D=M.localOrigin;f!=null&&(f.localOrigin=D,f.applyToAabb(s7));const U=s7;if(UE[0]=r[0]-D[0],UE[1]=r[1]-D[1],UE[2]=r[2]-D[2],!soe(U,UE,o,m,y))return;const k=(z,W,J)=>{z.set(this.type,C,W,J,Wr),y=u&&a.dist!=null?a.dist:1/0},H=(z,W,J)=>{if((!b||J!=null)&&z>=0&&(v.backfacesTerrain||Te(J,n)<0)&&(v.invisibleTerrain||!v.selectionMode||i==null||i(r,s,z))){if((c.dist==null||z<c.dist)&&k(c,z,J),v.isFiltered)return;v.store===oa.ALL&&(g==null?(g=ose(e.ray),k(g,z,J),e.results.all.push(g)):z<g.dist&&k(g,z,J)),(a.dist==null||z<a.dist)&&k(a,z,J),v.store!==oa.MIN&&(l.dist==null||z>l.dist)&&k(l,z,J)}},V=uDt;Re(V,s,D);const{indices:X,indexCount:q}=O,Z=O.vertexAttributes,ye=Z.getField(R.POSITION,ho),L=new MD(ye.typedBuffer,3,Z.stride/4),N=q/3;if(!f&&N>JLt){const z=C.renderData;z.intersectionData==null&&(z.intersectionData=new rUe(X,0,N,L)),z.intersectionData.intersectRay(UE,V,w,H)}else ILe(UE,V,0,N,X,L,f,w,H)},S=this._rootTiles;S!=null&&(()=>{const C=this._tileIterator;C.reset(S);const M=e.options.invisibleTerrain;for(let O=C.next();O;O=C.next())!(O.visible||M&&O.intersectsClippingArea)||f==null&&!O.intersectsRay(r,n,m,y)||d&&this._useStencilForTile(O)?C.skipSubtree():x(O)})()}processScaleRangeQueries(e,i){var r;if(!i.done)for(this._updatePatchGroups();e.updating&&!i.done;){e.prepare();for(const s of this._visiblePatchesByOrigin.values())for(const n of s)((r=n.renderData)==null?void 0:r.textureReference)!=null&&e.queriesForTile(n);e.process(),i.madeProgress()}}prepareTechnique(e){const i=le("enable-feature:terrain-shadows")&&e.bindParameters.shadowMap.enabled;i!==this._castShadows&&(this._castShadows=i,this._patchesByOriginDirty=!0);const r=e.bindParameters.viewshedEnabled;if(this._inViewshed!==r&&(this._inViewshed=r,this._patchesByOriginDirty=!0),e.bindParameters.slot===Pe.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&LB))return null}else{const s=this.transparency===tl.Opaque?Pe.OPAQUE_TERRAIN:Pe.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==s)return null}if(this.transparency===tl.Empty)return null;switch(e.output){case j.Color:return this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.lastFrameColor!=null,this._techniqueConfiguration.hasCloudsReflections=e.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssao!=null,this._techniqueConfiguration.overlayMode=this._overlayRenderer.mode,this._updateTechnique(j.Color,e.bindParameters.slot===Pe.OCCLUDED_TERRAIN);case j.Shadow:case j.ShadowExcludeHighlight:return this._castShadows?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(j.Shadow,!1)):null;case j.ViewshedShadow:return this._inViewshed?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(j.ViewshedShadow,!1)):null;case j.Depth:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(j.Depth,!1);case j.Normal:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(j.Normal,!1);case j.ObjectAndLayerIdColor:return this._updateTechnique(j.ObjectAndLayerIdColor,!1);case j.Highlight:return this._overlayRenderer.hasHighlights?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(j.Highlight,!1)):null}return null}renderNode(e,i){switch(this._updatePatchGroups(),i.useStencil=!1,e.output){case j.Color:{const r=e.bindParameters.slot===Pe.OCCLUDED_TERRAIN?is.Occluded:is.Color;this._renderMaterialPass(e,i,r);break}case j.Depth:case j.Normal:this._renderAuxiliaryPass(e,i,is.Color,this._visiblePatchesByOrigin);break;case j.Highlight:this._renderAuxiliaryPass(e,i,is.Highlight,this._visiblePatchesByOrigin);break;case j.Shadow:case j.ShadowExcludeHighlight:case j.ViewshedShadow:this._renderAuxiliaryPass(e,i,null,this._allPatchesByOrigin);break;case j.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,i,is.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(e){if(this._tileRenderer==null)return;const i=this._tileRenderer;let r;if(e!=null){const s=Qe.toUnitRGBA(e);r=Ge(s[0]||0,s[1]||0,s[2]||0)}i.setBackground(r),this._allTiles.forAll(s=>i.updateTileTexture(s,vn.FADING)),this._techniqueConfiguration.tileBlendInput=i.backgroundIsGrid?Dg.GridComposite:i.backgroundColor!=null?Dg.ColorComposite:Dg.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==CP.NONE){const e=Array.from(this._visiblePatchesByOrigin.values()),i=this._stencilEnabledLayerExtents;for(const r of e)a3t(this.renderOrder,r,i);e.sort((r,s)=>vke(r[0],s[0],this.renderOrder)),this._visiblePatchesByOrigin=new Map(e.map(r=>[r[0].renderData.localOrigin,r])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var i;const e=this._rootTiles;if(e!=null){(i=e[0])==null||i.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(const r of e)this._rebuildPatchGroupsForRootTile(r)}}_rebuildPatchGroupsForRootTile(e){const i=this._tileIterator;for(i.resetOne(e);!i.done;){const r=i.next(),s=r.renderData;if(!s){this._numTilesCulled++;continue}const n=s.localOrigin;if(this._castShadows||this._inViewshed){let a=this._allPatchesByOrigin.get(n);a||(a=[],this._allPatchesByOrigin.set(n,a)),a.push(r)}if(!r.visible){this._numTilesCulled++,i.skipSubtree();continue}let o=this._visiblePatchesByOrigin.get(n);o||(o=[],this._visiblePatchesByOrigin.set(n,o)),o.push(r),i.skipSubtree()}}_useStencilForTile(e){for(const i of this._stencilEnabledLayerExtents)if(e.intersectsExtent(i))return!0;return!1}_renderAuxiliaryPass(e,i,r,s){const n=e.rctx;this._passParameters.overlayContent=r,n.bindTechnique(i,e.bindParameters,this._passParameters);const o=this._stencilEnabledLayerExtents.length>0;s.forEach(a=>{this._drawParameters.origin=a[0].renderData.localOrigin,i.program.bindDraw(this._drawParameters,e.bindParameters,this._passParameters);for(let l=0;l<a.length;l++)this._renderPatch(e,i,a[l],Ci.TRIANGLES,o,r)}),e.rctx.bindVAO(null)}_renderMaterialPass(e,i,r){var f;const{rctx:s}=e;this._passParameters.overlayContent=r,s.bindTechnique(i,e.bindParameters,this._passParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;const n=e.bindParameters.camera,o=i.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const m=w3e(this._stage.viewingMode,this._ellipsoidRadius),g=this.pointsOfInterest.centerOnSurfaceFrequent.distance;m.update({distance:g,fovY:n.fovY})}const a=this._stencilEnabledLayerExtents.length>0,l=r===is.Occluded;l&&(o.bindTexture("tex",this._emptyTex),o.setUniform3fv("textureOpacities",On),o.setUniform4fv("texOffsetAndScale",Rh));const c=((f=this._tileRenderer)==null?void 0:f.backgroundColor)!=null?this._tileRenderer.backgroundColor:On;this._techniqueConfiguration.tileBlendInput===Dg.ColorComposite&&o.setUniform3fv("backgroundColor",c);const u=this.wireframe?Ci.LINES:Ci.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&o.bindTexture("texNext",this._emptyTex);const d=this._visiblePatchesByOrigin;for(const m of d.values()){const g=m[0].renderData.localOrigin;i.program.bindDraw(new QQ(g),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const y of m){const v=y.renderData,b=v.textureReference;if(b!=null){if(!l){o.setUniform4fv("texOffsetAndScale",b.offsetAndScale),o.bindTexture("tex",b.texture.texture);const w=v.textureFadeFactor,x=w<1?v.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&x!=null&&w<1?(o.setUniform1f("fadeFactor",w),o.setUniform4fv("nextTexOffsetAndScale",x.offsetAndScale),o.setUniform3fv("nextTexOpacities",x.opacities),o.bindTexture("texNext",x.texture.texture)):o.setUniform1f("fadeFactor",1),v.textureIsFading&&this.setNeedsRender(),o.setUniform3fv("textureOpacities",b.opacities)}this._renderPatch(e,i,y,u,a,r),y.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,i,r,s,n,o){const a=r.renderData,l=a.vao,c=l==null?void 0:l.indexBuffer;if(!l||c==null)return void(ao&&console.error("Rendered tile with no indices: ",r.lij," : ",a));const u=i.program;o==null||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(u,a.overlay),n&&(i.useStencil=this._useStencilForTile(r),e.rctx.setPipelineState(i.getPipeline()));const d=a.geometry.indexCount;e.rctx.bindVAO(l),u.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(s,d,c.indexType,0)}_bindOverlayPatchData(e,i){e.setUniform4fv("overlayTexOffset",i.offsets),e.setUniform4fv("overlayTexScale",i.scales)}_updateTechnique(e,i){return this._techniqueConfiguration.output=e,this._techniqueConfiguration.renderOccluded=i,this._shaderTechnique=this._techniques.releaseAndAcquire(wke,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){}};h([p({readOnly:!0})],vd.prototype,"_isGlobal",null),h([p()],vd.prototype,"renderOccludedFlags",void 0),h([p({value:!1})],vd.prototype,"renderingDisabled",null),h([p({value:!0})],vd.prototype,"visible",null),h([p()],vd.prototype,"renderPatchBorders",null),h([p()],vd.prototype,"visualizeNormals",null),h([p()],vd.prototype,"cullBackFaces",null),h([p({value:CP.FRONT_TO_BACK})],vd.prototype,"renderOrder",null),h([p()],vd.prototype,"wireframe",null),vd=h([I("esri.views.3d.terrain.TerrainRenderer")],vd);const lDt=E(),cDt=E(),UE=E(),uDt=E();let hDt=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},Xm=class extends Ue{constructor(e){super(e)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),te(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(i=>!(!qI(i)||i.isRejected())&&!(i.isFulfilled()&&!dDt(i,this.viewSpatialReference,this.viewingMode))&&(e=i,!((i==null?void 0:i.type)==="vector-tile"||JB(i)))),e)if(e.isResolved()){const i=K6(e,this.viewSpatialReference,this.viewingMode);if(i!=null){const r=new bu(i.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const i=e.when().catch(()=>{}).then(()=>{i!==this._waitTask||this.destroyed||this._update()});this._waitTask=i}_lockTilingScheme(e){if(this.viewingMode===Xe.Global){const i=e.levels.length-1,r=e.spatialReference;r.isWebMercator?e=bu.makeWebMercatorAuxiliarySphere(i):fae(r)&&(e=bu.makeGCSWithTileSize(e.spatialReference,e.pixelSize,i))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles(te(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Xe.Global){const e=this.extentHelper.viewSpatialReference;e.isWebMercator?this.tilingScheme=bu.WebMercatorAuxiliarySphere:uke(e)&&(this.tilingScheme=bu.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||rS(e,this.extent)||(this.tilingScheme=bu.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){}};function dDt(t,e,i){return K6(t,e,i)!=null}h([p()],Xm.prototype,"tilingScheme",void 0),h([p({readOnly:!0})],Xm.prototype,"extent",void 0),h([p({value:!1})],Xm.prototype,"tilingSchemeLocked",void 0),h([p({constructOnly:!0})],Xm.prototype,"viewSpatialReference",void 0),h([p({constructOnly:!0})],Xm.prototype,"layers",void 0),h([p({constructOnly:!0})],Xm.prototype,"extentHelper",void 0),h([p({constructOnly:!0})],Xm.prototype,"viewingMode",void 0),Xm=h([I("esri.views.3d.terrain.TilingSchemeLogic")],Xm);let pDt=class{constructor(){this.offset=mt(),this.scale=0,this.tile=null}init(e,i,r,s){this.tile=e,this.offset[0]=i,this.offset[1]=r,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}};var zU;let si=zU=class extends Us.EventedMixin(Ue){constructor(t){var e,i,r;super(t),this._scaleRangeQueries=new VU,this._iteratorPool=new la(_ke,s=>s.remove=()=>this._iteratorPool.release(s)),this._postorderIterator=new o3t,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new hDt,this._viewChanged=!1,this.heading=0,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=E(),this._eyePosSurfaceSR=E(),this._splitLimits=new Hp,this._frustum=wL(),this._viewProjectionMatrix=ke(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new Z0,this._frameTask=ZA,this._allTiles=new ai,this._upsampleInfoPool=new la(pDt),this._shouldEmitChangeEvent=!1,this._rootTilesExtent=oi(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=Ze.WebMercator,this._elevationProjectorCache=new Map,this.visibleElevationBounds=new RM(1/0,-1/0),this.rootTileElevationBounds=new RM(1/0,-1/0),this._sebProjectorMap=new Map,this._sebProjectorCache=Ere(),this._tilingSchemeSpatialReference=null,this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateCarree=!1,this.overlayManager=new bc({...t,surface:this}),this._isGlobal=!((i=(e=t.view)==null?void 0:e.state)!=null&&i.isLocal),this._isGeographic=((r=this._spatialReference)==null?void 0:r.isGeographic)??!1,this._tileConstructor=this._isGlobal?uLt:aLt}initialize(){const t=this.view,e=t.resourceController,i=e.memoryController;this._tileCache=new oN((l,c)=>i.newCache(l,c),"terrain-tile"),this._upsampleMapCache=i.newCache("terrain-upsample",l=>l.unloadMapData()),this._elevationQueryCache=new K$t(i.newCache("elevation-query"));const r=this.overlayManager;this._renderer=new vd(r.renderer,t._stage,this._allTiles,_r(t.spatialReference).radius,i),this.addHandles([te(()=>r.renderer.isEmpty,()=>this._evaluateTransparency()),te(()=>this.renderer.visible,l=>this.suspended=!l),te(()=>this.heading,l=>{this._renderer.updateHeading(l),this._updateTileTextures(vn.FADING)}),te(()=>{var l,c;return{heading:(l=t.camera)==null?void 0:l.heading,state:(c=t.state)==null?void 0:c.mode}},({heading:l,state:c})=>{if(l==null)return;if(this.isGlobal&&this.isGeographic||this.isWebMercatorOnPlateCarree)return void(this.heading=90*Math.round(l/90)%360);const u=Math.round(l)%360,d=Math.abs(u-this.heading);(c===$i.IDLE||Math.min(d,360-d)>=30)&&(this.heading=u)})],"overlayManager"),this.addHandles([te(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?vn.UNFADED:vn.IMMEDIATE)},hr),te(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?vn.UNFADED:vn.IMMEDIATE),hr),te(()=>this.backgroundColor,(l,c)=>{l!=null&&l.equals(c)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(l))},or),te(()=>this.snapLevel,()=>this._viewChanged=!0,or),te(()=>this.view.pointsOfInterest,l=>{this._renderer.pointsOfInterest=l,this._watchUpdatingTracking.removeAll(),l&&this._watchUpdatingTracking.add(()=>l.focus.renderLocation,()=>this._allTilesSorted=!1)}),te(()=>Nr.TERRAIN_TILE_TREE_SHOW_TILES,l=>{l&&!this._treeDebugger?ce(()=>import("./TerrainTileTree3DDebugger-UkvEnp_U.js"),__vite__mapDeps([191,192])).then(({TerrainTileTree3DDebugger:c})=>{!this._treeDebugger&&Nr.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new c({view:t}))}):l||(this._treeDebugger=qe(this._treeDebugger))},$t)]);const{spatialReference:s}=t;this._extentHelper=XIt(this.viewingMode,{layers:t.map.allLayers,layerViews:t.allLayerViews,viewSpatialReference:s});const n=new oL({getCollections:()=>{var l,c;return(c=(l=t.defaultsFromMap)==null?void 0:l.mapCollections)==null?void 0:c.map(({layers:u})=>u)},getChildrenFunction:l=>l&&"layers"in l?l.layers:null}),o=new Xm({layers:n,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:s});this._set("tilingSchemeLogic",o),this._updateTilingScheme(),this._elevationDataRequester=e.createStreamDataRequester(Sg.ELEVATION),this._mapDataRequester=e.createStreamDataRequester(Sg.BASEMAP);const a=e.scheduler;this._frameTask=a.registerTask(It.TERRAIN_SURFACE,this),this.addHandles([te(()=>this._extentHelper.stencilEnabledExtents,l=>this._renderer.setStencilEnabledLayerExtents(l),$t),te(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),or),te(()=>this.extent,()=>this._updateRootTiles(),$t),t.on("resize",()=>this._viewChangeUpdate()),te(()=>{const l=t.state;return[this._lodBias,this.lodSnapping,t.quality,l.camera,l.contentCamera,l.fixedContentCamera]},()=>this._viewChangeUpdate(),hr),te(()=>{var l;return(l=t.qualitySettings)==null?void 0:l.fadeDuration},l=>this._renderer.textureFadingEnabled=l>0,$t),te(()=>{var l;return(l=t.qualitySettings)==null?void 0:l.physicallyBasedRenderingEnabled},l=>this._renderer.pbrMode=l?At.Simplified:At.Disabled,$t),te(()=>{var l;return(l=t.qualitySettings)==null?void 0:l.tiledSurface.elevationLevelDelta},()=>this._updateAllTileGeometries()),te(()=>this._userClippingExtent,()=>this._updateClippingExtent(),or)]),this.addHandles(t.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._frameTask.remove(),this._watchUpdatingTracking.destroy(),this._removeAllTiles(),this._set("tilingSchemeLogic",qe(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((t,e)=>this._unregisterTiledLayerView(e)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",qe(this.overlayManager)),this._tileCache=qe(this._tileCache),vae.prune(),this._treeDebugger=qe(this._treeDebugger),this._renderer=qe(this._renderer),this._iteratorPool=qe(this._iteratorPool),this._upsampleMapCache=qe(this._upsampleMapCache),this._elevationQueryCache=qe(this._elevationQueryCache),this._set("view",null),this._extentHelper=qe(this._extentHelper),this._upsampleInfoPool=qe(this._upsampleInfoPool),wIt(),b3t()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnapping===_3.ON){const t=this.view,e=this.tilingScheme,i=t.terrainScale;if(e&&i){const r=e.levelAtScale(i)+t.qualitySettings.tiledSurface.lodBias,s=e.getMaxLod();return Math.min(r,s||1/0)}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?_3.ON:_3.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get _userClippingExtent(){const{spatialReference:t}=this,{clippingArea:e}=this.view;if(e==null||t==null)return null;const i=oi(),r=R5e(e,i,t)?i:null,s=this._get("extent");return rS(r,s)?s:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const t=SZ(this.groundExtent,this._userClippingExtent,oi()),e=this._get("extent");return rS(t,e)?e:t}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var t;return(t=this.tilingSchemeLogic)==null?void 0:t.extent}get updating(){var t,e;return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||(t=this._watchUpdatingTracking)!=null&&t.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||(e=this.overlayManager)!=null&&e.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){var t,e,i;return((i=(e=(t=this.view)==null?void 0:t.map)==null?void 0:e.ground)==null?void 0:i.opacity)??1}set baseOpacity(t){this.view.map.ground.opacity=t}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(t){this._renderer.renderOrder=t,this._set("renderOrder",t)}get rootTiles(){return this._rootTiles}get spatialReference(){var t;return((t=this.tilingScheme)==null?void 0:t.spatialReference)??null}get backgroundColor(){var t,e,i;return(i=(e=(t=this.view)==null?void 0:t.map)==null?void 0:e.ground)==null?void 0:i.surfaceColor}set backgroundColor(t){this.view.map.ground.surfaceColor=t}set slicePlaneEnabled(t){this._renderer.slicePlaneEnabled=t,this._set("slicePlaneEnabled",t),this._evaluateTransparency()}get tilingSchemeLocked(){var t;return((t=this.tilingSchemeLogic)==null?void 0:t.tilingSchemeLocked)??!1}get wireframe(){var t;return(t=this._renderer)==null?void 0:t.wireframe}set wireframe(t){t!==this._renderer.wireframe&&(this._renderer.wireframe=t,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===tl.Opaque}set suspended(t){this._set("suspended",t),this._viewChangeUpdate()}get fadeDuration(){return this.view.qualitySettings.fadeDuration??0}intersect(t,e,i,r){this._renderer.intersect(t,e,i,r)}getElevationLevelDelta(t){return t<4?3:this.view.qualitySettings.tiledSurface.elevationLevelDelta}getElevation(t,e,i,r){const s=this._rootTiles;if(!(s!=null&&s.length)||s[0].layerInfo[Qt.ELEVATION].length===0)return null;let n=this._elevationProjectorCache.get(r);if(n===void 0&&(n=wb(r,this._spatialReference)??null,this._elevationProjectorCache.set(r,n)),n==null)return se.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;const o=de(ER,t,e,i);return n(o,0,o,0),yve(s,o[0],o[1])}getElevations(t,e,i){const r=this._rootTiles,s=r?r[0].layerInfo[Qt.ELEVATION].length:0;if(r!=null&&r.length&&s!==0)for(let n=0;n<e;++n){const o=3*n;i(n,yve(r,t[o],t[o+1]))}else for(let n=0;n<e;++n)i(n,null)}getScale(t){if(!this.tilingScheme)return null;if(!pl(t,ER,this.spatialReference))return se.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const e=this._rootTiles;if(e!=null){for(const i of e)if(i!=null&&i.containsPoint(ER)){let r=i;for(;r.children[0]&&!r.rendered;){const s=r.children[0].extent;let n=0;ER[0]>s[2]&&(n+=1),ER[1]<s[1]&&(n+=2),r=r.children[n]}return this._getLodBiasCorrectedScale(r.level)}}return 1/0}_ensureSEBProject(t){const e=this._sebProjectorMap.get(t);if(e)return e;const i=wb(t,this._tilingSchemeSpatialReference,this._sebProjectorCache)??null;return this._sebProjectorMap.set(t,i),i}getSphereElevationBounds(t,e){const i=this._ensureSEBProject(e);if(i==null)return se.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;qS(t,VE);const r=VE;i(r,0,r,0);const s=new YB,n=this._rootTiles;if(n!=null){const o=[];for(const l of n)o.push(l);let a=0;for(;a<o.length;){const l=o[a];if(++a,!she(l.extent,VE))continue;const c=l.children;if(c[0]==null||l.rendered)s.expandElevationRangeValues(l.elevationBoundsMin,l.elevationBoundsMax);else for(const u of c)o.push(u)}}return s}getRootElevationBounds(){return new YB(this.rootTileElevationBounds.min,this.rootTileElevationBounds.max)}getSphereScale(t,e){if(!this.tilingScheme)return null;if(!pl(t,VE,this.spatialReference))return se.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;VE[3]=e;let i=null;const r=n=>{if(n&&she(n.extent,VE)){const o=n.children;if(o[0]&&!n.rendered)for(const a of o)r(a);else{const a=this._getLodBiasCorrectedScale(n.level);i=i==null?a:Math.min(i,a)}}},s=this._rootTiles;if(s!=null)for(const n of s)r(n);return i}queryVisibleScaleRange(t,e,i,r){const s=e?this.tilingScheme.levelAtScale(e):0,n=i?this.tilingScheme.levelAtScale(i):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(t,s+o,n+o,r)}_evaluateTransparency(){var n,o;const t=this.baseOpacity,e=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,r=this._allSurfaceLayersTransparent()?e?tl.Empty:tl.TransparentWithDraped:t>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?tl.Opaque:tl.Semitransparent,s=i!==r;return s&&(this._renderer.transparency=r,(o=(n=this.view)==null?void 0:n._stage)==null||o.renderer.setParameters({terrainTransparency:this._renderer.transparency})),s}_updateTilingScheme(){var i,r,s,n;const t=this.tilingSchemeLogic.tilingScheme;if(t===this.tilingScheme)return;Nn(!!t,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((r=(i=this.view)==null?void 0:i.state)!=null&&r.isLocal),this.tilingScheme&&this._removeAllTiles();const e=(t==null?void 0:t.spatialReference)??Ze.WebMercator;this._spatialReference=e,this._isWebMercator=!!(e!=null&&e.isWebMercator),this._isWebMercatorOnPlateCarree=this._isWebMercator&&$S((s=this.view)==null?void 0:s.renderSpatialReference),this._isGeographic=(e==null?void 0:e.isGeographic)??!1,this._set("tilingScheme",t),this._tilingSchemeSpatialReference=(n=this.tilingScheme)==null?void 0:n.spatialReference,this._sebProjectorMap.clear(),this._updateClippingExtent(),t&&(this._updateTiledLayers(),this._renderer.setTileSize(t.pixelSize),this.overlayManager.setSpatialReference(t.spatialReference),this._updateRootTiles())}_acquireTile(t,e,i,r){const s=this._tileCache.pop(zU._tileMemcacheKey);return s?(s.init(t,e,i,r,this),s):new this._tileConstructor(t,e,i,r,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:t,tilingScheme:e}=this;if(!e)return;const i=mDt;let r=e.rootTilesInExtent(t,i,5*uM);if(this._rootTiles!=null){if(r.length>uM)return void se.getLogger(this).warn(kst);const s=this._rootTiles.map(o=>o.lij),n=bW(s,r,kU);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){const o=this._rootTiles.filter(a=>!(n.removed.findIndex(l=>kU(l,a.lij))>-1)||(this._purgeTile(a),!1));n.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,r.length>uM&&(se.getLogger(this).warn(Ust),r=e.rootTilesInExtent(t,i,uM)),this._setRootTiles(r.map(s=>this._newRootTile(s)));rS(i,this._rootTilesExtent)||(this._rootTilesExtent=oi(i)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const t=this._allTiles.filter(e=>e.isLoaded&&e.intersectsClippingArea);t.sort(Lg),t.forEach(e=>this._renderer.updateTileGeometryState(e)),t.forEach(e=>e.renderData.updateNeighborData()),this._updateTilesGeometries(t),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(t){if(t.length===0)return;t.sort(Lg);const e=this.renderer;t.forEach(i=>e.updateGeometryIfNeeded(i)),t.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(t){return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===Tt.SPLIT}_newRootTile(t){const e=this._acquireTile(0,t[1],t[2],null);return this._shouldSplit(e)&&e.setPendingUpdate(Tt.SPLIT),this._loadTile(e),this._markTileToUpdate(e),this._updateRootTileElevationBounds(),e}_setRootTiles(t){if(this._rootTiles=t,this._allTiles.clear(),t!=null){const e=this._iteratorPool.acquire();for(e.reset(t);!e.done;)this._allTiles.push(e.next());e.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(t)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(t){t.updateClippingStatus(this.extent)&&t.resetPendingUpdate(Tt.GEOMETRY)&&this._updateTileGeometryState(t)}_updateTilesVisibility(t){if(t==null)return;const e=f3t(t),i=this.visibleElevationBounds;let r=e?i.min:1/0,s=e?i.max:-1/0;const n=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(t);!a.done;){const l=a.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(Tt.GEOMETRY)&&this._updateTileGeometryState(l),l.computeVisibility(),l.updateScreenDepth(o),l.renderData&&(r=Math.min(l.elevationBoundsMin,r),s=Math.max(l.elevationBoundsMax,s))}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(r)&&isFinite(s)&&(i.min!==r||i.max!==s)&&(this.visibleElevationBounds=new RM(r,s))}_updateRootTileElevationBounds(){let t=1/0,e=-1/0;const i=this._rootTiles;i!=null&&i.forEach(({elevationBoundsMin:s,elevationBoundsMax:n})=>{t=Math.min(t,s),e=Math.max(e,n)});const r=this.rootTileElevationBounds;r.min===t&&r.max===e||(this.rootTileElevationBounds=new RM(t,e))}_updateViewDependentParameters(){const{camera:t,contentCamera:e}=this.view.state,i=Math.tan(.5*e.fovX),r=Math.tan(.5*e.fovY),s=this.tilingScheme.pixelSize,n=2**-this._lodBias*t.pixelRatio;this._splitLimits.aboveGround=t.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=s/t.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/t.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=Zz(this._splitLimits.frustum??wL(),e.frustum):this._splitLimits.frustum=null,Zz(this._frustum,t.frustum),gr(this._viewProjectionMatrix,e.projectionMatrix,e.viewMatrix),ve(this._eyePosRenderSR,e.eye),Fo(t.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateTileGeometryState(t){t.updateVisibility(),this._renderer.updateTileGeometryState(t)&&this._markTileToUpdate(t),this._usedMemory=null}_markAllTileNeighborsForUpdate(t){t.forEachLoadedNeighbor(e=>{this._layerViews[Qt.MAP].some(EP)&&e.setPendingUpdate(Tt.TEXTURE_FADING),this._pendingTilesToUpdate.add(e)})}_updateTileTexture(t,e){const i=t.resetPendingUpdate(Tt.TEXTURE_FADING)?Tt.TEXTURE_FADING:!!t.resetPendingUpdate(Tt.TEXTURE_NOFADING)&&Tt.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(t,i),this._usedMemory=null,e.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;const t=n7.extent;zh(t),this._pendingTilesForElevationUpdateEvent.forEach(e=>Q1(t,e.extent,t)),this._pendingTilesForElevationUpdateEvent.clear(),n7.spatialReference=this.spatialReference,this.emit("elevation-change",n7),this._shouldEmitChangeEvent=!1}runTask(t){this._handleLayerViewChanges(t),this._frameTask.processQueue(t),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,t),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(t),this._sortTiles(t);const e=!this.view.state.fixedContentCamera;if(this._mergeAndSplit(t,e),this._updateElevation(t),this._updateTextures(t),e||this._mergeAndSplit(t,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),t.done&&t.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue"),ao&&this._checkTileInvariant(),!t.hasProgressed)return na}_checkTileInvariant(){const t=new Map;this._allTiles.forAll(e=>t.set(e,new Set)),this._allTiles.forAll(e=>{var i;if(Nn(e.rendered===e.isLeaf,` rendered ${e.rendered} != ${e.isLeaf} leaf`),!e.isLeaf){const r=n=>n.unmergableChildCount===0&&n.maxLevelDeltaNeighborCount===0,s=e.children.reduce((n,o)=>n+(r(o)?0:1),0);if(Nn(e.unmergableChildCount===s,` Tile[${e.lij.toString()}] unmergeable child count mismatch: actual ${e.unmergableChildCount} vs ${s}`),e.hasPendingUpdate(Tt.MERGE)){Nn(!e.hasPendingUpdate(Tt.SPLIT),"Tile can be both split and merge at the same time");for(const n of e.children)Nn(n.isLeaf||n.hasPendingUpdate(Tt.MERGE),"Child of tile to merge must also merge")}}for(let r=0;r<4;++r){if(e.rendered){const a=(i=e.renderData)==null?void 0:i.geometryState.edgePeerNeighbors[r];if(a!=null){{const l=e.level-a.level<=Vn;l||(console.log(`tile level delta [${e.lij.toString()}] vs [${a.lij.toString()}] > ${Vn}  (edge[${r}])`),Nn(l,`tile level delta [${e.level}] vs [${a.level}] > ${Vn}`))}Nn(e.level-a.level<=Vn,`Max tile lod delta exceeded: [${e.lij.toString()}] vs [${a.lij.toString()}]`)}}const s=e.level-Vn,n=a=>a.isLeaf||a.level===e.level,o=e.findNeighborTile(If[r],n);if(o!=null){if(e.isLeaf&&e.level>=Vn){let a=o;for(;e.level-a.level<Vn;)a=a.parent;const l=[s,e.lij[1]>>Vn,e.lij[2]>>Vn];if(!kU(l,a.lij)){const c=t.get(a);Nn(!c.has(e),"Cannot already have neighbor"),c.add(e)}}Nn(o.rendered||o.level===e.level,"Non-same-level-neighbor of rendered must be rendered"),Nn(e.level-o.level<=Vn,`Tile level delta [${e.level}] vs [${o.level}] > ${Vn}`)}}}),this._allTiles.forAll(e=>{const i=e.maxLevelDeltaNeighborCount,r=t.get(e);Nn(i===r.size,`Tile[${e.lij.toString()}] merge-blocker mismatch: actual ${i} vs ${r.size}`)})}_updateAllTilesStatus(t){if(!this._viewChanged||!this._rootTiles||t.done)return;this._viewChanged=!1;const e=new gDt(this._allTiles.length);e.pushAll(this._rootTiles);const i=this.snapLevel,r=this._splitLimits,s=this._eyePosRenderSR;this._allTiles.forAll(o=>{o.maxLevelDeltaNeighborCount=0,o.unmergableChildCount=0});const n=this._viewProjectionMatrix;for(;!e.empty;){const o=e.pop(),a=o.parent,l=a!=null&&a.hasPendingUpdate(Tt.MERGE),c=l?Tt.MERGE:o.shouldSplit(r,s,i),u=c===Tt.SPLIT;o.isLeaf?o7(o,u):e.pushAll(o.children),l?(o.resetPendingUpdate(Tt.SPLIT),o.isLeaf||o.setPendingUpdate(Tt.MERGE),this._updateClippingStatus(o),o.updateVisibility(),o.updateScreenDepth(n)):u?(o.resetPendingUpdate(Tt.MERGE),o.isLeaf&&o.setPendingUpdate(Tt.SPLIT)):(o.resetPendingUpdate(Tt.SPLIT)&&o.updateAgentSuspension(),c===Tt.ELEVATION&&o.updateAgents(Qt.ELEVATION),o.isLeaf||(o.setPendingUpdate(Tt.MERGE),o.resetPendingUpdate(Tt.SPLIT)))}this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),t.madeProgress()}_sortTiles(t){t.done||this._allTilesSorted||(d3t(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),t.madeProgress())}_markTileToUpdate(t){Ye(t.isLoaded),t.intersectsClippingArea&&(this._pendingTilesToUpdate.add(t),this._markAllTileNeighborsForUpdate(t))}_updatePendingTileGeometries(){const t=this._pendingTilesToUpdate,e=Array.from(t.keys()).filter(s=>s.isLoaded&&s.intersectsClippingArea);if(e.length===0)return void t.clear();const i=(s,n)=>{!(n!=null&&n.isLoaded)||!n.intersectsClippingArea||n.level<s.level||t.has(n)||(t.add(n),e.push(n),n.renderData.updateNeighborData())};e.sort(Lg);const r=e.length;for(let s=0;s<r;++s){const n=e[s];Ye(n.isLoaded),Ye(n.intersectsClippingArea);const o=n.renderData;o.updateNeighborData();const a=o.dirtyEdgeResolutions,l=o.geometryState,c=u=>{var f;const d=KB[u];i(n,(f=l.cornerPeerNeighbors[u])==null?void 0:f.findCorner(QB(d),m=>m.isLoaded))};for(let u=0;u<4;++u)if(a&1<<u){const d=o.geometryState.edgePeerNeighbors[u];d&&(d==null?void 0:d.level)>=n.level&&d.forAllSubtreeOnSide(yae(If[u]),f=>!(!f.isLoaded||!f.intersectsClippingArea)&&(Ye(t.has(f)||Lg(n,f)<0),i(n,f),!0)),c((u+1)%4),c(u)}}t.clear(),this._updateTilesGeometries(e),this._shouldEmitChangeEvent=!0,ao&&XB&&this.checkAllTilesWaterproofness()}_mergeAndSplit(t,e){if(this.suspended||t.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const r=this.view.state.fixedContentCamera;let s=!1;for(;!t.done;){s=!0;let n=!1;const o=!this._allTiles.some(a=>{if(!i&&!r&&!a.visible)return t.done;let l=a;if(a.hasPendingUpdate(Tt.MERGE)){if(!e||a.unmergableChildCount>0)return t.done;for(a.resetPendingUpdate(Tt.MERGE);l.parent!=null&&l.parent.unmergableChildCount===0&&l.parent.resetPendingUpdate(Tt.MERGE);)l=l.parent;this._mergeTile(l),n=!0,t.madeProgress()}else if(a.resetPendingUpdate(Tt.SPLIT)){let c=!0;const u=a.level;if(u>=Vn){const d=f=>f.isLeaf||u-f.level<Vn;for(let f=0;f<4;++f){const m=a.findNeighborTile(If[f],d);m!=null&&u-m.level===Vn&&(c=!1,ao&&(Ye(m.isLeaf),Ye(m.hasPendingUpdate(Tt.SPLIT))))}}c?(this._splitTile(a),t.madeProgress(),n=!0):a.setPendingUpdate(Tt.SPLIT)}return t.done});if(n&&(this._allTilesSorted=!1,this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries()),o){if(!i){i=!0;continue}if(!n)break}else this._allTilesDirty=!0}s?t.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(t)}_updateElevation(t){t.done||(this._allTiles.some(e=>(e.resetPendingUpdate(Tt.GEOMETRY)&&(this._updateTileGeometryState(e),this._shortBatches&&this._updatePendingTileGeometries(),t.madeProgress()),t.done)),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(t){t.done||this._allTiles.some(e=>(this._updateTileTexture(e,t),t.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(ar.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const t=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-(1-t)*Nst}_getLodBiasCorrectedScale(t){const e=this.tilingScheme.levels,i=Ne(t-this._lodBias,0,e.length-1),r=i-Math.floor(i);return e[Math.floor(i)].scale*(1-r)+e[Math.ceil(i)].scale*r}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(t=>this._purgeTile(t)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.renderer.visible=!1}_purgeDescendantTiles(t){if(!t.children[0])return;const e=t.children.slice();t.unsetChildren();for(let i=0;i<4;++i)this._purgeTile(e[i])}_purgeTile(t){t.isLeaf?_ve(t):this._purgeDescendantTiles(t),this._allTiles.removeUnordered(t),this._unloadTile(t),this._tileCache.put(zU._tileMemcacheKey,t)}_unloadTile(t){this._pendingTilesToUpdate.delete(t),this._pendingTilesForElevationUpdateEvent.delete(t),t.unload(this._renderer)}_splitTile(t){Nn(t.isLeaf,"Tile that is already split should not be split again!"),Nn(t.rendered,"Tile marked to split is not rendered"),_ve(t);const e=t.level+1,i=2*t.lij[1],r=2*t.lij[2],s=t.setChildren(this._createTile(e,i,r,t),this._createTile(e,i,r+1,t),this._createTile(e,i+1,r,t),this._createTile(e,i+1,r+1,t));this._allTiles.pushArray(s),t.updateAgentSuspension(),Nn(t.rendered,"parent should be rendered"),this._unloadTile(t),s.forEach(n=>this._loadTile(n)),s.forEach(n=>this._pendingTilesToUpdate.add(n)),this._markAllTileNeighborsForUpdate(t),this._emitTileScaleChange(t,t.level+1),this._allTilesDirty=!0,this._shortBatches&&this._updatePendingTileGeometries(),s.forEach(n=>o7(n,n.hasPendingUpdate(Tt.SPLIT))),++this._performanceInfo.numSplit}_emitTileScaleChange(t,e=t.level){u5.spatialReference=this.spatialReference,u5.extent=t.extent,u5.scale=this._getLodBiasCorrectedScale(e),this.emit("scale-change",u5)}_createTile(t,e,i,r){Nn(!!r,"_createTile sanity check");const s=this._acquireTile(t,e,i,r);return s.updateClippingStatus(this.extent),s.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(s)&&s.setPendingUpdate(Tt.SPLIT),s}get _shortBatches(){return this.view.state.mode!==$i.IDLE}_mergeTile(t){Nn(!t.hasPendingUpdate(Tt.SPLIT),"_mergeTile sanity check"),Nn(!t.isLeaf,"Cannot merge a leaf"),t.isLeaf||(this._purgeDescendantTiles(t),Nn(!t.renderData,"_mergeTile sanity check"),this._loadTile(t),this._markTileToUpdate(t),this._emitTileScaleChange(t),this._shortBatches&&this._updatePendingTileGeometries(),o7(t,!1),this._allTilesDirty=!0,++this._performanceInfo.numMerged)}_loadTile(t){t.load(),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(t)}_handleLayerViewChanges(t=Eu){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let e=!1;const i=new Set;let r=-1;for(let s=this.view.allLayerViews.length-1;s>=0;s--){const n=this.view.allLayerViews.items[s];if(i.add(n.uid),kK(n)||TR(n))if(this._basemapLayerViewHandles.has(n.uid)&&!TR(n)){const o=this._layerClassFromLayerView(n),a=this._getLayerIdxByUID(o,n.uid);a!=null&&((a<r||r==null)&&(e=!0),r=a)}else this._registerTiledLayerView(n),n.layer.loaded&&(e=!0)}this._basemapLayerViewHandles.forEach((s,n)=>{i.has(n)||(this._unregisterTiledLayerView(n),e=!0)}),e&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),t.madeProgress()}_allSurfaceLayersTransparent(){var e,i;let t=((i=(e=this.view.map)==null?void 0:e.ground)==null?void 0:i.opacity)===0;for(const r of this.view.allLayerViews.items)if(FK(r)&&!lk(r.layer)&&r.fullOpacity!==0)return t=!1,t;return t}_hasCompositeBlendMode(){for(const t of this.view.allLayerViews.items)if((HL(t)||TR(t))&&mLt(BK[t.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(t){return NK(t)?Qt.ELEVATION:Qt.MAP}_registerTiledLayerView(t){const e=[];if((HL(t)||TR(t))&&e.push(te(()=>t.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(vn.UNFADED)})),!TR(t)){const i=this._layerClassFromLayerView(t);e.push(te(()=>t.suspended,()=>this._updateTiledLayers())),e.push(te(()=>t.fullOpacity,()=>this._updateTileTextures(vn.UNFADED))),e.push(te(()=>"effectiveScaleRange"in t.layer?t.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),e.push(t.on("data-changed",()=>{const r=this._getLayerIdxByUID(i,t.uid);r!=null&&this._invalidateLayerData(r,i)}))}this._unregisterTiledLayerView(t.uid),this._basemapLayerViewHandles.set(t.uid,e)}_unregisterTiledLayerView(t){const e=this._basemapLayerViewHandles.get(t);if(e){for(const i of e)i.remove();this._basemapLayerViewHandles.delete(t)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const t=this.view.allLayerViews,e=[[],[]];let i=null;t.forEach(r=>{if(!r.layer||r.suspended||!kK(r)||!r.fullExtent)return;const s=this._layerClassFromLayerView(r);if(s===Qt.MAP){const n=r.displayLevelRange.maxLevel;n!==1/0&&(i===null||n>i)&&(i=n)}e[s].push(r)});for(const r of Zx){const s=this._layerViews[r],n=e[r];n.reverse();const o=n.length;let a=s.length!==o;const l=new Array(o),c=new Array(s.length);this._layerIndexByUid[r].clear();for(let u=0;u<o;u++){const d=n[u].uid;this._layerIndexByUid[r].set(d,u);const f=s.indexOf(n[u]);l[u]=f,u!==f&&(a=!0),f>-1&&(c[f]=u)}if(a){const u=this._postorderIterator;for(u.reset(this._rootTiles);!u.done;)u.next().modifyLayers(c,l,r);this._layerViews[r]=n,this._restartAllAgents(r),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&(this._viewChangeUpdate(),this.notifyChange("tilingScheme"))}_restartAllAgents(t){const e=this._postorderIterator;for(e.reset(this._rootTiles);!e.done;){const i=e.next();i.restartAgents(t),t===Qt.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(t,e){return this._layerViews[e][t]}numLayers(t){return this._layerViews[t].length}_updateTileTextures(t){this._allTiles.forAll(e=>{e.updateAgents(Qt.MAP),t===vn.IMMEDIATE?this.renderer.updateTileTexture(e,Tt.TEXTURE_NOFADING):e.updateRenderData(Qt.MAP,t)}),this._evaluateTransparency()}_invalidateLayerData(t,e){this._allTiles.forAll(i=>i.removeLayerAgent(t,e)),this._allTiles.forAll(i=>i.invalidateLayerData(t,e))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(t=ar.UPDATE){this.renderer.setNeedsRender(t)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(t,e,i,r){const s=this.layerViewByIndex(e,i),n=s.layer;return!n.tilemapCache||EP(s)?this._requestTileData(t,i,s,r):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(t.lij[0],t.lij[1],t.lij[2],{...r,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,Dt(r),os(o)||this._dataMissing(t,i,s),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(t,i,s,r),r.signal)))}_requestTileData(t,e,i,r){const s=e===Qt.ELEVATION;return r.requester??(r.requester=s?this._elevationDataRequester:this._mapDataRequester),s?NK(i)?this._requestElevationTileData(t,i,r):Promise.reject():FK(i)?this._requestMapTileData(t,i,r):Promise.reject()}_requestElevationTileData(t,e,i){++this._asyncWorkItems;const r=n=>{!ra(i)&&n&&(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(t,e,n))},s=n=>{os(n)||(se.getLogger(this).error(`Tile ${t.lij.toString()} layer ${Qt.ELEVATION}/${e.uid} error ${n}`),this._dataMissing(t,Qt.ELEVATION,e),this.requestUpdate())};return e.fetchTile(t.lij,i).then(n=>this._frameTask.schedule(()=>r(n)),s).finally(()=>--this._asyncWorkItems)}_elevationDataArrived(t,e,i){const r=this._layerIndexByUid[Qt.ELEVATION].get(e.uid);if(r==null)return void se.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",Qt.ELEVATION,t.lij.toString());const s=new EIt(t.lij,t.extent,i);t.dataArrived(r,Qt.ELEVATION,s);const n=[t],o=t.level,a=this._iteratorPool.acquire();for(a.reset(n);!a.done;){const l=a.next();l.findElevationBoundsForLayer(r,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(n)}_requestMapTileData(t,e,i){++this._asyncWorkItems;const r=(a,l)=>{gA(l),ra(i)||(console.error(`Tile ${t.lij.toString()} layer ${Qt.MAP}/${e.uid} error ${a}`),this._dataMissing(t,Qt.MAP,e),this.requestUpdate())},s=a=>l=>r(l,a),n=a=>this._frameTask.schedule(()=>{this.requestUpdate(),ra(i)?gA(a):this._mapTileDataArrived(t,e,a)},i.signal,s(a)).catch(s(a)),o=(a,l=null)=>this._frameTask.schedule(()=>r(a,l));return e.fetchTile(t.lij,i).then(n,o).finally(()=>--this._asyncWorkItems)}_mapTileDataArrived(t,e,i){const r=this._getLayerIdxByUID(Qt.MAP,e.uid);if(r==null)return gA(i),void se.getLogger(this).warn("TerrainSurface: received data from unknown layer");t.dataArrived(r,Qt.MAP,i)}_getLayerIdxByUID(t,e){return this._layerIndexByUid[t].get(e)}_dataMissing(t,e,i){const r=this._getLayerIdxByUID(e,i.uid);r!=null?t.dataMissing(r,e):se.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(t){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(e=>{e.renderData&&this.overlayManager.setTileParameters(e)}),this._renderer.setNeedsRender(t))}get performanceInfo(){const t=this._performanceInfo;return t.numNodes=this._allTiles.length,t.numLeaves=t.numVisible=t.numRendered=t.numLoadedPerLevel.length=t.numRenderedPerLevel.length=0,this._allTiles.forAll(e=>{e.isLeaf&&t.numLeaves++;const i=e.level;e.renderData&&(t.numLoadedPerLevel[i]=(t.numLoadedPerLevel[i]||0)+1),e.visible&&(t.numVisible++,e.rendered&&(t.numRenderedPerLevel[i]=(t.numRenderedPerLevel[i]||0)+1,t.numRendered++))}),t}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((t,e)=>t+e.usedMemory,0)):null}getUsedMemoryForLayerView(t){let e=0;const i=this._layerClassFromLayerView(t),r=this._getLayerIdxByUID(i,t.uid);return r!=null&&this._allTiles.forAll(s=>e+=s.getUsedMemoryForLayer(i,r)),e}getTile(t){if(t==null||this._rootTiles==null)return null;const e=t.split("/").map(o=>+o);if(e[0]===0)return this._rootTiles.find(o=>o.lij[1]===e[1]&&o.lij[2]===e[2]);const i=e[0],r=e[1]>>i,s=e[2]>>i;let n;if(this._rootTiles.some(o=>o.lij[1]===r&&o.lij[2]===s&&(n=o,!0)),n){let o=1<<e[0]-1;for(;n.lij[0]<e[0];){let a=e[1]&o?2:0;if((e[2]&o)>0&&a++,!n.children[a])return null;n=n.children[a],o>>=1}return Nn(n.lij[0]===e[0]&&n.lij[1]===e[1]&&n.lij[2]===e[2],"not the right tile?"),n}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(t){this._renderer.renderPatchBorders=t}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(t){this._renderer.visualizeNormals=t}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(t){this._renderer.renderingDisabled=t}get test(){}checkAllTilesWaterproofness(){if(!XB)return;const t=this._rootTiles;if(t==null)return;const e=n=>{var o,a,l;return((l=(a=(o=n==null?void 0:n.renderData)==null?void 0:o.geometry)==null?void 0:a.indices)==null?void 0:l.length)>0},i=(n,o)=>{e(n)&&console.error("Tile[",n.lij,"] has geometry although parent[",o.lij,"] has geom")},r=n=>{var o,a;if(n.intersectsClippingArea)if(n.renderData&&!n.renderData.geometryState&&console.error("Tile[",n.lij,"] has renderData but not geometryState"),n.renderData&&!n.renderData.geometry&&console.error("Tile[",n.lij,"] has renderData but not geometryInfo"),!((o=n.renderData)!=null&&o.geometry)||(((a=n.renderData.geometry.indices)==null?void 0:a.length)??0)>0||console.error("Tile[",n.lij,"] has renderData but no indices - geometryInfo: ",n.renderData.geometry),e(n)){n.checkGeometryWaterproofness();for(const l of n.children)i(l,n)}else if(n.isLeaf)console.error("Tile[",n.lij,"] has no geometry and no children, from root to leaf");else for(const l of n.children)r(l)},s=n=>{var c;const o=((c=n.parent)==null?void 0:c.visible)??!0,a=n.visible;n.computeVisibility();const l=n.visible;if(a!==l&&o&&console.error(" Tile[",n.lij,"] has out of date visibility: ",a," instead of ",l),!n.isLeaf)for(const u of n.children)s(u)};for(const n of t)r(n),s(n)}get isGlobal(){return this._isGlobal}get isGeographic(){return this._isGeographic}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateCarree(){return this._isWebMercatorOnPlateCarree}isEastEndWrap(t){return this._isGlobal&&t[2]===this.lijEastEnd(t[0])-1}isWestEndWrap(t){return this._isGlobal&&t[2]===0}lijEastEnd(t){return 1<<t+(this._isGeographic?1:0)}wrapEastWest(t){const e=this.lijEastEnd(t[0]),i=t[2];if(0<=i&&i<e)return t;if(!this._isGlobal)return null;const r=(i+(i<0?e:0))%e;return[t[0],t[1],r]}enableInternalChecks(t){UIt(t)}enableWaterproofnessChecks(t){kIt(t)}};si._tileMemcacheKey="TerrainTileMemcache",h([p()],si.prototype,"_renderer",void 0),h([p({constructOnly:!0})],si.prototype,"_scaleRangeQueries",void 0),h([p({constructOnly:!0})],si.prototype,"view",void 0),h([p({constructOnly:!0})],si.prototype,"overlayManager",void 0),h([p()],si.prototype,"_hasPendingUpdates",void 0),h([p()],si.prototype,"_asyncWorkItems",void 0),h([p()],si.prototype,"_allTilesDirty",void 0),h([p()],si.prototype,"_allTilesSorted",void 0),h([p()],si.prototype,"_viewChanged",void 0),h([p({type:Number})],si.prototype,"heading",void 0),h([p()],si.prototype,"_splitLimits",void 0),h([p({readOnly:!0})],si.prototype,"_watchUpdatingTracking",void 0),h([p()],si.prototype,"_frameTask",void 0),h([p({readOnly:!0})],si.prototype,"snapLevel",null),h([p({readOnly:!0})],si.prototype,"lodSnapping",null),h([p()],si.prototype,"_userClippingExtent",null),h([p()],si.prototype,"_rootTilesExtent",void 0),h([p({readOnly:!0})],si.prototype,"extent",null),h([p({readOnly:!0})],si.prototype,"groundExtent",null),h([p({readOnly:!0})],si.prototype,"_tilingSchemeExtent",null),h([p({readOnly:!0})],si.prototype,"updating",null),h([p({readOnly:!0})],si.prototype,"running",null),h([p(TIt)],si.prototype,"updatingProgress",void 0),h([p({readOnly:!0})],si.prototype,"updatingProgressValue",null),h([p()],si.prototype,"_maxNumUpdating",void 0),h([p()],si.prototype,"baseOpacity",null),h([p()],si.prototype,"hasCompositeBlendMode",void 0),h([p({readOnly:!0})],si.prototype,"viewingMode",null),h([p()],si.prototype,"maxTextureScale",void 0),h([p({readOnly:!0})],si.prototype,"ready",null),h([p({value:CP.FRONT_TO_BACK})],si.prototype,"renderOrder",null),h([p({readOnly:!0})],si.prototype,"rootTiles",null),h([p()],si.prototype,"_rootTiles",void 0),h([p({readOnly:!0})],si.prototype,"spatialReference",null),h([p({type:Qe})],si.prototype,"backgroundColor",null),h([p({value:!1})],si.prototype,"slicePlaneEnabled",null),h([p({readOnly:!0})],si.prototype,"tilingScheme",void 0),h([p({readOnly:!0})],si.prototype,"tilingSchemeLocked",null),h([p({readOnly:!0})],si.prototype,"tilingSchemeLogic",void 0),h([p()],si.prototype,"wireframe",null),h([p({value:!1})],si.prototype,"suspended",null),h([p()],si.prototype,"fadeDuration",null),h([p()],si.prototype,"visibleElevationBounds",void 0),h([p()],si.prototype,"rootTileElevationBounds",void 0),h([p()],si.prototype,"_layerViewsDirty",void 0),h([p()],si.prototype,"renderPatchBorders",null),h([p()],si.prototype,"visualizeNormals",null),h([p()],si.prototype,"renderingDisabled",null),si=zU=h([I("esri.views.3d.terrain.TerrainSurface")],si);const fDt=si,ER=E(),VE=dn(),mDt=oi();new ai;const n7=new xIt("ground"),u5={spatialReference:null,extent:null,scale:0};function yve(t,e,i){var r;for(const s of t){if(!s.containsPointXY(e,i))continue;let n=s;for(;n&&!n.renderData;){const a=(e>n.extentMidX?1:0)+(i<n.extentMidY?2:0);n=n.children[a]}const o=((r=n==null?void 0:n.renderData)==null?void 0:r.geometryState.samplerData)??null;return Ts(e,i,o)}return null}class gDt{constructor(e){this.capacity=e,this._head=0,this._tail=0,this._data=new Array(e)}push(e){const i=this._tail;if(!(i<this.capacity))throw new Error("Queue full");this._data[i]=e,this._tail=i+1}pushAll(e){const i=e.length;if(i===0)return;const r=this._tail;if(!(r+i<=this.capacity))throw new Error("Queue full");for(let s=0;s<i;++s)this._data[r+s]=e[s];this._tail=r+i}pop(){const e=this._head;if(e<this._tail){const i=this._data[e];return this._head=e+1,i}}get empty(){return this._head>=this._tail}get full(){return this._tail>=this._data.length}}function o7(t,e){!t.isLeaf||t.level<Vn||Rae(t,i=>{e&&sUe(i);const r=XK(i);if(i.maxLevelDeltaNeighborCount++,r){let s=i.parent;for(;s;){const n=XK(s);if(s.unmergableChildCount++,!n)break;s=s.parent}}})}function sUe(t){if(t.hasPendingUpdate(Tt.SPLIT))return;let e=t.parent;for(;e!=null&&e.resetPendingUpdate(Tt.MERGE);)e=e.parent;t.resetPendingUpdate(Tt.MERGE),t.isLeaf&&t.setPendingUpdate(Tt.SPLIT),t.level<Vn||Rae(t,i=>{sUe(i)})}function _ve(t){t.level<Vn||Rae(t,e=>{if(e.maxLevelDeltaNeighborCount--,e.maxLevelDeltaNeighborCount===0&&e.unmergableChildCount===0){let i=e.parent;for(;i&&(i.unmergableChildCount--,XK(i));)i=i.parent}})}function XK(t){return t.maxLevelDeltaNeighborCount===0&&t.unmergableChildCount===0}function Rae(t,e){if(t.level<Vn)return;const i=t.level-Vn,r=t.lij[1]>>Vn,s=t.lij[2]>>Vn,n=o=>o.isLeaf||o.level===i;for(let o=0;o<4;++o){const a=t.findNeighborTile(If[o],n);if(!a||a.level!==i)continue;const l=a.lij;l[1]===r&&l[2]===s||e(a)}}let yDt=class{constructor(e,i,r,s){this.operation=e,this.geometry=i,this.states=r,this.sync=s}},yI=class extends Ue{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,i){const r=this._dirtyGeomRecords.get(e);r&&(r.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c},u)=>{let d=!1;if(l===fs.UPDATE){const f=o.get(u);if(f){if(c&Hn.TRANSFORMATION){const m=this.model.getObject(n);this.model.updateRenderGeometryTransformation(m,a,f)&&(d=!0)}d||i.updates.push({renderGeometry:f,updateType:c})}else vt(!1,"ModelDirtySet.commitLayer: invalid update")}if(l===fs.REMOVE||d){const f=o.get(u);f?(i.removes.push(f),o.delete(u)):l===fs.REMOVE&&vt(!1,"ModelDirtySet.commitLayer: invalid remove")}if(l===fs.ADD||d){const f=this.model.getObject(n);if(f!=null){const m=this.model.getRenderGeometry(f,a);i.adds.push(m),o.set(u,m)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(n)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}commitSyncUpdates(e,i){const r=this._dirtyGeomRecords.get(e);r&&r.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c,sync:u},d)=>{let f=!1;if(l===fs.UPDATE&&u){const m=o.get(d);if(m){if(c&Hn.TRANSFORMATION){const g=this.model.getObject(n);this.model.updateRenderGeometryTransformation(g,a,m)&&(f=!0)}f||i.updates.push({renderGeometry:m,updateType:c})}else vt(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}})})}getResidentRenderGeometries(e,i){const r=this._residentGeomRecords.get(e);r&&r.forEach(s=>s.forEach(n=>i.push(n)))}_objectStateChanged(e,i){for(const r of i.geometries)this._updateOrCreateDirtyRecord(i,r,null,fs.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(Hn.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(Hn.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(Hn.OCCLUDEE,e)}attributesChanged({object:e,geometry:i,sync:r}){this._updateOrCreateDirtyRecord(e,i,null,fs.UPDATE,Hn.GEOMETRY,r)}layerAdded(e){e.objects.forAll(i=>this._layerObjectAdded(e,i))}layerRemoved(e){e.objects.forAll(i=>this._layerObjectRemoved(e,i))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,i){const r=e.id;for(const s of i.geometries)this._geometryAdded(i,s,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const i of e.objects)this._layerObjectAdded(e.layer,i)}layerObjectsRemoved(e){for(const i of e.objects)this._layerObjectRemoved(e.layer,i)}_layerObjectRemoved(e,i){const r=e.id;for(const s of i.geometries)this._geometryRemoved(i,s,r)}transformationChanged(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(s=>{this._updateOrCreateDirtyRecord(e,s.geometry,i,fs.UPDATE,Hn.TRANSFORMATION)})}shaderTransformationChanged(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(s=>{s.objectShaderTransformationChanged(e.shaderTransformation)})}geometryAdded(e){this._geometryAdded(e.object,e.geometry)}_geometryAdded(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,fs.ADD)}geometryRemoved(e){this._geometryRemoved(e.object,e.geometry)}_geometryRemoved(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,fs.REMOVE)}_updateOrCreateDirtyRecord(e,i,r,s,n=Hn.NONE,o=!1){r=r??this._getParentLayerId(e);const a=e.id,l=i.id,c=this._ensureDirtyRecord(r,a),u=c.get(l);let d=!1;if(u){const f=u.operation;f===fs.REMOVE&&s===fs.ADD&&u.states!==Hn.NONE?u.operation=fs.UPDATE:f===fs.REMOVE&&s===fs.ADD||f===fs.ADD&&s===fs.REMOVE?(c.delete(l),d=!0):f!==fs.UPDATE||s!==fs.REMOVE&&s!==fs.UPDATE?(vt((f===fs.REMOVE||f===fs.ADD)&&s===fs.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),u.states|=n):(u.operation=s,u.states|=n),u.sync=u.sync||o}else c.set(l,new yDt(s,i,n,o));this.dirty=!d||this._hasDirtyGeometryRecords}_ensureGeomRecord(e,i){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let s=r.get(i);return s||(s=new Map,r.set(i,s)),s}get _hasDirtyGeometryRecords(){for(const e of this._dirtyGeomRecords.values())for(const i of e.values())if(i.size>0)return!0;return!1}_ensureDirtyRecord(e,i){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let s=r.get(i);return s||(s=new Map,r.set(i,s)),s}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:r9e}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let i="";return this._dirtyGeomRecords.forEach((r,s)=>{r.forEach((n,o)=>{i.length>0&&(i+=`
`),i+=s+"."+o;const a=[];n.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){i+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)i+=a[l][c]+", "}})}),i}get test(){}};h([p({constructOnly:!0})],yI.prototype,"model",void 0),h([p()],yI.prototype,"dirty",void 0),yI=h([I("esri.views.3d.webgl-engine.lib.ModelDirtySet")],yI);const _Dt=yI;let BU=class extends Ue{constructor(){super(...arguments),this.dirtySet=new _Dt({model:this}),this._content=new Map,this._originFactory=new NNe(null)}getObject(e){return this._content.get(e)}add(e){const i=e.id;vt(!this._content.has(i),"Model/Stage already contains object to be added"),this._content.set(i,e),OB(e)&&this.dirtySet.layerAdded(e)}remove(e){return!!this._content.has(e.id)&&(this._content.delete(e.id),OB(e)&&this.dirtySet.layerRemoved(e),!0)}addMany(e){for(const i of e)i&&(vt(!this._content.has(i.id),"Model/Stage already contains object to be added"),this._content.set(i.id,i))}removeMany(e){for(const i of e)i&&(vt(this._content.has(i.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(i.id))}has(e){return this._content.has(e.id)}forEachOfType(e,i){this._content.forEach(r=>{r.type===e&&i(r)})}getRenderGeometry(e,i){const r=new TP(i,{castShadow:e.castShadow,objectShaderTransformation:e.shaderTransformation});r.transformation=e.getCombinedStaticTransformation(i,vve);const{localOrigin:s}=i;return r.localOrigin=s??this._originFactory.getOrigin(r.boundingSphere),r}updateRenderGeometryTransformation(e,i,r){if(e==null)return!1;r.transformation=e.getCombinedStaticTransformation(i,vve);const s=this._originFactory.getOrigin(r.boundingSphere);return r.localOrigin!==s}getStats(){const e={},i=Array.from(this._content.values());for(let r=0;r<Fs.COUNT;++r)e[r]=i.filter(s=>s.type===r).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){}};h([p({constructOnly:!0})],BU.prototype,"dirtySet",void 0),BU=h([I("esri.views.3d.webgl-engine.parts.Model")],BU);const vve=ke();let vDt=class{constructor(e){this._totalCount=e,this._componentCountCache=-1,this._indexRanges=[0,e]}allVisible(){return this.componentCount===this._totalCount}allInvisible(){return this._indexRanges.length===0}isVisible(e){if(e<0||e>=this._totalCount)return!1;if(this.allVisible())return!0;{const i=this._indexRanges;let r=0,s=i.length/2;if(e<i[2*r]||e>i[2*s]+i[2*s+1])return!1;for(;s-r>0;){const n=Math.floor(.5*(r+s)),o=i[2*n];if(e<o){if(s-r==1)return!1;s=n;continue}if(e<o+i[2*n+1])return!0;if(s-r==1)return!1;r=n+1}return!1}}get componentCount(){if(this._componentCountCache===-1){const e=this._indexRanges;let i=0;for(let r=0;r<e.length;r+=2)i+=e[r+1];this._componentCountCache=i}return this._componentCountCache}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=bDt(e),this._componentCountCache=-1}forEachComponent(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r],n=s+i[r+1];for(let o=s;o<n;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r];if(!e(s,s+i[r+1]))return!1}return!0}computeOffsetRanges(e){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){const n=r[s],o=n+r[s+1],a=e[n],l=e[o];i[s]=a,i[s+1]=l-a}return i}};function bDt(t){const e=new Array;if(t.length===0)return e;let i=t[0],r=1;for(let s=1;s<t.length;s++){const n=t[s];i+r===n?r+=1:(e.push(i),e.push(r),i=n,r=1)}return e.push(i),e.push(r),e}let wDt=class{constructor(e,i){this.offsets=i,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const r=this.count;this.visibility=new vDt(r),this.materialDataBuffer=e.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:e,defaultRanges:i}=xDt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=i}}};function xDt(t,e,i){const r=[],s=[];let n=i.length,o=i.length;return e.forEachComponent(a=>(t[a]>0?(n!==a-1&&(r.length&&r.push(i[n+1]-r[r.length-1]),r.push(i[a])),n=a):(o!==a-1&&(s.length&&s.push(i[o+1]-s[s.length-1]),s.push(i[a])),o=a),!0)),r.length&&r.push(i[n+1]-r[r.length-1]),s.length&&s.push(i[o+1]-s[s.length-1]),{highlightRanges:r,defaultRanges:s}}let TDt=class{constructor(e,i,r,s,n,o){this.transform=e,this.toMapSpace=i,this.obb=r,this.components=s,this.renderable=n,this.intersectionGeometry=o,this.visible=!1,this.offsetObb=null}destroy(){this.intersectionGeometry=qe(this.intersectionGeometry),this.renderable=qe(this.renderable),this.components=qe(this.components)}};function SDt(t,e,i,r,s,n,o){const a=n-o,l=e-t,c=new Float64Array(4*l);for(let u=0;u<l;++u){const d=3*(u+t),f=s*i[d+0],m=r[f+0],g=r[f+1],y=a/(r[f+2]-o),v=m*y,b=g*y,w=s*i[d+1],x=r[w+0],S=r[w+1],C=a/(r[w+2]-o),M=x*C,O=S*C,D=s*i[d+2],U=r[D+0],k=r[D+1],H=a/(r[D+2]-o),V=U*H,X=k*H,q=4*u;c[q+0]=Math.min(v,M,V),c[q+1]=Math.min(b,O,X),c[q+2]=Math.max(v,M,V),c[q+3]=Math.max(b,O,X)}return c}function EDt(t,e,i,r,s){const n=e-t,o=new Float64Array(4*n);for(let a=0;a<n;++a){const l=3*(a+t),c=s*i[l+0],u=r[c+0],d=r[c+1],f=s*i[l+1],m=r[f+0],g=r[f+1],y=s*i[l+2],v=r[y+0],b=r[y+1],w=4*a;o[w+0]=Math.min(u,m,v),o[w+1]=Math.min(d,g,b),o[w+2]=Math.max(u,m,v),o[w+3]=Math.max(d,g,b)}return o}function CDt(t,e){return new(MDt(t))(e)}function MDt(t){return t<128?Uint8Array:t<32768?Uint16Array:t<1<<31?Uint32Array:Array}let nUe=class{constructor(e,i){this.elementCount=e,this.model=i,this._elementIndexMap=null,this._bspNodes=[],this._generatedBVH=!1,this.localMode=i.localMode,this.planetCenterZ=i.planetCenterZ,this.geometryMinZ=i.geometryMinZ,this.planetCenter=Ge(0,0,this.planetCenterZ),this.maxBspNodeDepth=i.maxBspNodeDepth??8,this.minElementCountForBVH=i.minElementCountForBVH??15,this.minBspNodeElementCount=i.minBspNodeElementCount??5}get elementIndexMap(){return this._ensureBVH(),this._elementIndexMap}get _skipBVH(){return this.elementCount<this.minElementCountForBVH||this.geometryMinZ<.5*this.planetCenterZ}_ensureBVH(){this._generatedBVH||this._skipBVH||this._bspNodes.length===0&&this._generateBsp()}intersectRay(e,i,r){this.elementCount<1||(this._skipBVH?this._intersectRayWithoutBVH(r):this._intersectRayWithBVH(e,i,r))}_intersectRayWithoutBVH(e){this._intersectRange(0,this.elementCount)}_intersectRange(e,i){this.model.intersectRange(e,i)}_intersectRayWithBVH(e,i,r){this._ensureBVH(),r?this._intersectGeometryWithBVHVerticalRay(e):this._intersectGeometryWithBVHGeneralRay(e,i)}_intersectGeometryWithBVHVerticalRay(e){let i=e[0],r=e[1];if(!this.localMode){const{geometryMinZ:o,planetCenterZ:a}=this,l=(o-a)/(e[2]-a);i=e[0]*l,r=e[1]*l}const{_bspNodes:s}=this;let n=0;for(;n>=0;){const o=s[n],{d:a,dim:l,minIndexIndex:c,minMidIndexIndex:u,maxMidIndexIndex:d,maxIndexIndex:f,aabb2D:m}=o;if(i<m[0]||i>m[2]||r<m[1]||r>m[3])break;if(l===-1||o.child0===-1&&o.child1===-1){this._intersectRange(c,f);break}{this._intersectRange(u,d);const g=(l===0?i:r)-a;if(g<0){if(o.child0===-1){this._intersectRange(c,u);break}n=o.child0}else{if(!(g>0))break;if(o.child1===-1){this._intersectRange(d,f);break}n=o.child1}}}}_intersectGeometryWithBVHGeneralRay(e,i){let r=e[0],s=e[1],n=i[0],o=i[1];const{geometryMinZ:a}=this;if(!this.localMode){let g=0,y=1;const v=Math.min(.5*this.planetCenterZ,a),b=e[2],w=i[2];if(b<v&&w<v||(b<v&&(g=(v-b)/(w-b)),w<v&&(y=(v-b)/(w-b)),g>y))return;const x=(1-g)*e[0]+g*i[0],S=(1-g)*e[1]+g*i[1],C=(1-g)*e[2]+g*i[2],M=(1-y)*e[0]+y*i[0],O=(1-y)*e[1]+y*i[1],D=(1-y)*e[2]+y*i[2],{planetCenterZ:U}=this,k=a-U,H=k/(C-U);r=x*H,s=S*H;const V=k/(D-U);n=M*V,o=O*V}const l=n-r,c=o-s,u=this._bspNodes;let d=1;{const{aabb2D:g}=u[0],y=(w,x,S,C)=>{if(Math.abs(x)<1e-5*Math.max(C-S,1))return!1;const M=x>0,O=M?C:S,D=w+d*x;return(M?D<O:D>O)&&(d=Math.max((O-w)/x,d),!0)},v=()=>y(r,l,g[0],g[2]),b=()=>y(s,c,g[1],g[3]);Math.abs(l)>=Math.abs(c)?v()||b():b()||v()}const f=[0,0,d];let m=0;for(;m<f.length;){const g=f[m];let y=f[m+1],v=f[m+2];if(m+=3,y>v)continue;const b=u[g],{minIndexIndex:w,maxIndexIndex:x}=b,{child0:S,child1:C,minMidIndexIndex:M,maxMidIndexIndex:O,aabb2D:D,d:U,dim:k}=b;{const H=r+y*l,V=r+v*l,X=Math.min(H,V),q=Math.max(H,V),Z=D[0],ye=D[2];if(q<Z||ye<X)continue;if(X<Z){const L=(Z-r)/l;l>0?y=Math.max(y,L):v=Math.min(v,L)}if(ye<q){const L=(ye-r)/l;l>0?v=Math.min(v,L):y=Math.max(y,L)}}{const H=s+y*c,V=s+v*c,X=Math.min(H,V),q=Math.max(H,V),Z=D[1],ye=D[3];if(q<Z||ye<X)continue;if(X<Z){const L=(Z-s)/c;c>0?y=Math.max(y,L):v=Math.min(v,L)}if(ye<q){const L=(ye-s)/c;c>0?v=Math.min(v,L):y=Math.max(y,L)}}if(S===-1&&C===-1)this._intersectRange(w,x);else{const H=k===0?r:s,V=k===0?l:c,X=H+y*V,q=H+v*V,Z=Math.min(X,q),ye=Math.max(X,q),L=Ne((U-H)/V,0,d);w<M&&Z<=U&&(S!==-1?(f.push(S),f.push(V>=0?y:Math.max(y,L)),f.push(V>=0?Math.min(v,L):v)):this._intersectRange(w,M)),this._intersectRange(M,O),O<x&&U<=ye&&(C!==-1?(f.push(C),f.push(V>=0?Math.max(y,L):y),f.push(V>=0?v:Math.min(v,L))):this._intersectRange(O,x))}}}_generateBsp(){const{elementCount:e}=this;if(e<1)return;const i=CDt(e,e);this._elementIndexMap=i;for(let m=0;m<e;++m)i[m]=m;const r=this.model.getAabbs2D();let s=0;const n=this._bspNodes;n.length=0;const{localMode:o}=this;let a=!1;if(!o){const{planetCenterZ:m,geometryMinZ:g}=this;a=m>=0||g<.5*m}const l=[],c=(m,g,y,v,b)=>{l.push(m),l.push(g),l.push(y),l.push(v<0?-1:(b?0:1)+2*v)},{maxBspNodeDepth:u,minBspNodeElementCount:d}=this,f=(m,g,y,v,b)=>{const w=n.length;if(w>0&&(a||y>=u||g-m<d))return;const x=[0,0,0,0];RDt(x,m,g,i,r);const{d:S,dim:C}=o?ADt(x):PDt(x),{rangeMidStart:M,rangeMidEnd:O}=ODt(m,g,C,S,i,r),D=y===u-1,U=!D&&M>=m+d,k=!D&&g>=O+d;if(U||k||w===0){const H=new $Dt(m,M,O,g,C,S,x);if(U&&c(m,M,y+1,w,!0),k&&c(O,g,y+1,w,!1),n.push(H),v!==-1){const V=n[v];b?V.child0=w:V.child1=w}}};for(c(0,e,0,-1,!1);s<l.length;){const m=l[s],g=l[s+1],y=l[s+2],v=l[s+3];s+=4;const b=v>>1;f(m,g,y,b,v-(b<<1)==0)}this._generatedBVH=!0}};function ADt(t){const e=t[0],i=t[1],r=t[2],s=t[3];let n,o;return r-e>=s-i?(o=.5*(e+r),n=0):(o=.5*(i+s),n=1),{d:o,dim:n}}function PDt(t){const e=t[0],i=t[1],r=t[2],s=t[3];let n,o;return r-e>=s-i?(n=0,o=.5*(e+r)):(n=1,o=.5*(i+s)),{dim:n,d:o}}function ODt(t,e,i,r,s,n){let o=t;{let u=e;for(;o<u;){const d=s[o];bve(d,i,r,n)<0?++o:(--u,s[o]=s[u],s[u]=d)}}const a=o;let l=o,c=e;for(;l<c;){const u=s[c-1];bve(u,i,r,n)>0?--c:(s[c-1]=s[l],s[l]=u,++l)}return{rangeMidStart:a,rangeMidEnd:c}}function bve(t,e,i,r){const s=4*t,n=r[s+0+e];return r[s+2+e]<i?-1:n>i?1:0}function RDt(t,e,i,r,s){let n=1/0,o=1/0,a=-1/0,l=-1/0;for(let c=e;c<i;++c){const u=4*r[c];n=Math.min(n,s[u+0]),o=Math.min(o,s[u+1]),a=Math.max(a,s[u+2]),l=Math.max(l,s[u+3])}t[0]=n,t[1]=o,t[2]=a,t[3]=l}let $Dt=class{constructor(e,i,r,s,n,o,a){this.minIndexIndex=e,this.minMidIndexIndex=i,this.maxMidIndexIndex=r,this.maxIndexIndex=s,this.dim=n,this.d=o,this.aabb2D=a,this.child0=-1,this.child1=-1}},IDt=class{constructor(e,i,r,s,n,o,a,l,c){this.componentIndex=e,this.vertexData=i,this.vertexStride=r,this.indexData=s,this.startTriangleNumber=n,this.endTriangleNumber=o,this.geometryMinZ=a,this.planetCenterZ=l,this.localMode=c,this.maxBspNodeDepth=8,this.minElementCountForBVH=20,this.minBspNodeElementCount=10,this.rayDirection=E(),this.ray0=E(),this.isVerticalRay=!1,this._triangleHitCallback=wve,this.totalElevationOffset=0,this.normalRequired=!1,this._bvh=new nUe(o-n,this)}getAabbs2D(){return this.localMode?EDt(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride):SDt(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride,this.geometryMinZ,this.planetCenterZ)}get numTriangles(){return this.endTriangleNumber-this.startTriangleNumber}intersectRay(e,i,r,s,n,o){ve(this.ray0,e),Ii(this.rayDirection,i,e),this.isVerticalRay=r,this.totalElevationOffset=s,this.normalRequired=o,this._triangleHitCallback=n,this._bvh.intersectRay(e,i,r),this._triangleHitCallback=wve}intersectRange(e,i){const r=this._bvh.elementIndexMap;oUe(this.ray0,this.rayDirection,e,i,this.indexData,this.vertexData,this.vertexStride,this.totalElevationOffset,this.planetCenterZ,this.normalRequired,this._triangleHitCallback,r,this.startTriangleNumber)}getTriangleElevationOffset(e){return this.totalElevationOffset}};function oUe(t,e,i,r,s,n,o,a,l,c,u,d=null,f=0){a!==0?z0t(t,e,i,r,s,n,o,a,l,c,u,d,f):LLe(t,e,i,r,s,n,o,c,u,d,f)}function wve(){}function LDt(t,e,i,r){if(i>=e)return t;t==null&&(t=DDt());const s=t.isVisibleBit;let n=t.data;const o=aUe(n),a=i/o|0,l=i-o*a,c=(e-1)/o|0,u=n,d=r===s;if(!(i<u.length*o)&&d){const f=a+1,m=Math.ceil(u.length*Aj),g=c+1;let y=Math.max(f,m);y=Math.min(y,g),n=new Uint32Array(y),n.set(u)}return a<n.length&&(n[a]=FDt(n[a],l,d)),t.data=n,t}function JK(t,e){if(t==null)return!0;const{isVisibleBit:i,data:r}=t,s=aUe(r);return e<r.length*s?NDt(i,r,e,s):!t.isVisibleBit}function DDt(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function NDt(t,e,i,r){const s=i/r|0,n=i-s*r;return kDt(e[s],n)===t}function aUe(t){return t.BYTES_PER_ELEMENT*8}function FDt(t,e,i){return t&~(1<<e)|(i?1:0)<<e}function kDt(t,e){return!!(t&1<<e)}let UDt=class{constructor(e,i,r,s,n,o,a,l){this.vertexData=e,this.vertexStride=i,this.indexData=r,this._components=s,this._componentAabbs3D=n,this.geometryMinZ=o,this.planetCenterZ=a,this.localMode=l,this.maxBspNodeDepth=6,this.minElementCountForBVH=10,this.minBspNodeElementCount=3,this._ray0=jDt,this._ray1=GDt,this._invDir=E(),this._componentVerticalOffsets=null,this._verticalOffset=null,this._tolerance=0,this._intersectionOptions=HDt,this._callback=xve,this.rayDirectionC=E(),this._componentIndexMap=null,this._bvh=new nUe(s.count,this),this.componentIntersectionData=new Array(s.count)}get numComponents(){return this._components.count}get minZGlobal(){return this.geometryMinZ-this.planetCenterZ}getAabbs2D(){return this.localMode?this.getAabbs2DLocal():this.getAabbs2DGlobal()}getAabbs2DGlobal(){const{numComponents:e,planetCenterZ:i,minZGlobal:r}=this,s=new Float64Array(4*e),n=this._componentAabbs3D;for(let o=0;o<e;++o){const a=6*o,l=n[a+0],c=n[a+1],u=n[a+2],d=n[a+3],f=n[a+4],m=r/(u-i),g=r/(n[a+5]-i),y=Math.min(l*m,l*g),v=Math.min(c*m,c*g),b=Math.max(d*m,d*g),w=Math.max(f*m,f*g),x=4*o;s[x+0]=y,s[x+1]=v,s[x+2]=b,s[x+3]=w}return s}getAabbs2DLocal(){const{numComponents:e}=this,i=new Float64Array(4*e),r=this._componentAabbs3D;for(let s=0;s<e;++s){const n=6*s,o=r[n+0],a=r[n+1],l=r[n+3],c=r[n+4],u=4*s;i[u+0]=o,i[u+1]=a,i[u+2]=l,i[u+3]=c}return i}intersectRay(e,i,r,s,n,o,a){const{isVerticalRay:l}=a;this._ray0=e,this._ray1=i,this._componentVerticalOffsets=r,this._verticalOffset=s,this._tolerance=o,this._intersectionOptions=a,this._componentIndexMap=this._bvh.elementIndexMap,W0t(e,i,this._invDir),this._callback=n,this._bvh.intersectRay(e,i,l),this._callback=xve}intersectRange(e,i){const r=this._componentIndexMap,s=this._components,n=s.pickability,o=s.visibility;for(let a=e;a<i;++a){const l=r?r[a]:a;JK(n,l)&&o.isVisible(l)&&this._intersectComponent(l)}}getComponentTriangleCount(e){const i=this._components.offsets,r=i[e]/3;return i[e+1]/3-r}getComponentAabb3D(e,i){const r=this._componentAabbs3D,s=6*e;return i[0]=r[s],i[1]=r[s+1],i[2]=r[s+2],i[3]=r[s+3],i[4]=r[s+4],i[5]=r[s+5],i}_intersectComponent(e){if(!JK(this._components.pickability,e))return;const i=this.getComponentAabb3D(e,VDt);let r=!1;const{localMode:s,_componentVerticalOffsets:n,_verticalOffset:o,_ray0:a,_ray1:l,_invDir:c,planetCenterZ:u,_tolerance:d,rayDirectionC:f,componentIntersectionData:m}=this,{isVerticalRay:g}=this._intersectionOptions,y=this._components.offsets,v=ve(zDt,a),b=ve(BDt,l),w=(n==null?void 0:n[e])??0,x=w+((o==null?void 0:o.offset)??0);if(x!==0&&(s?(v[2]=a[2]-x,b[2]=l[2]-x,r=!0):o!=null&&(o.componentOffset=w)),o==null||r||x===0||o.applyToAabb(i),!roe(i,v,c,d))return;Ii(f,b,v);const S=y[e]/3,C=y[e+1]/3,M=C-S,O=(X,q,Z)=>{this._callback(X,q,e,Z)},{vertexData:D,vertexStride:U,indexData:k,_intersectionOptions:H}=this,{normalRequired:V}=H;if(M>qDt){let X=m[e];X==null&&(X=new IDt(e,D,U,k,S,C,this.geometryMinZ,u,s),m[e]=X),X.intersectRay(v,b,g,r?0:x,O,V)}else oUe(v,f,S,C,k,D,U,r?0:x,u,V,O)}};const VDt=Xn(),zDt=E(),BDt=E(),jDt=E(),GDt=E(),xve=()=>{},HDt=new ZD,qDt=40;let WDt=class{constructor(e,i,r){this.viewingMode=e,this.positionData=i,this._components=r,this.verticalOffset=null,this.componentVerticalOffsets=null,this._planetCenter=E(),this._componentBvh=null,this._aabb=[0,0,0,0,0,0],this._indices=i.indices?jg(i.indices):R2(i.positions.length/3),this._positions=i.positions}destroy(){this._positions=null,this._indices=null,this._perComponentAabbs=null,this._componentBvh=null}getComponentAabb(e,i){const r=this._ensureComponentAabbs(),s=6*e;return i[0]=r[s],i[1]=r[s+1],i[2]=r[s+2],i[3]=r[s+3],i[4]=r[s+4],i[5]=r[s+5],i}getComponentAabbs(){return this._ensureComponentAabbs()}_ensureComponentAabbs(){return this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs()),this._perComponentAabbs}getComponentPositions(e,i){i.indices=this._indices,i.data=this._positions,i.stride=3,i.startIndex=this._components.offsets[e],i.endIndex=this._components.offsets[e+1]}intersect(e,i,r,s,n,o,a,l){this.verticalOffset=s,this.componentVerticalOffsets=n;const{position:c}=o,u=Ii(ZDt,e,c),d=Ii(YDt,i,c),f=ED(XDt,o.rotationScale);ta(u,u,f),ta(d,d,f);const m=x2(QDt,f);if(this.viewingMode===Xe.Global){const y=this._planetCenter;sa(y,c),ta(y,y,f)}const g=(y,v,b,w)=>{l(b,y,w?ta(JDt,w,m):null,v)};this._intersectComponents(u,d,n,s,g,r,a)}_computePerComponentAabbs(){const e=this._aabb,i=.5*(e[0]+e[3]),r=.5*(e[1]+e[4]),s=.5*(e[2]+e[5]),n=this._components.count,o=Es(6*n),a=this._indices,l=this._positions,c=this._components.offsets;let u=0,d=1/0,f=1/0,m=1/0,g=-1/0,y=-1/0,v=-1/0;for(let b=0;b<n;b++){const w=c[b],x=c[b+1];let S=1/0,C=1/0,M=1/0,O=-1/0,D=-1/0,U=-1/0;if(w<x)for(let k=w;k<x;k++){const H=3*a[k],V=l[H],X=l[H+1],q=l[H+2];S=Math.min(S,V),C=Math.min(C,X),M=Math.min(M,q),O=Math.max(O,V),D=Math.max(D,X),U=Math.max(U,q)}else S=i,C=r,M=s,O=i,D=r,U=s;o[u++]=S,o[u++]=C,o[u++]=M,o[u++]=O,o[u++]=D,o[u++]=U,d=Math.min(d,S),f=Math.min(f,C),m=Math.min(m,M),g=Math.max(g,O),y=Math.max(y,D),v=Math.max(v,U)}return this._aabb[0]=d,this._aabb[1]=f,this._aabb[2]=m,this._aabb[3]=g,this._aabb[4]=y,this._aabb[5]=v,o}_intersectComponents(e,i,r,s,n,o,a){let l=this._componentBvh;l==null&&(l=new UDt(this._positions,3,this._indices,this._components,this._ensureComponentAabbs(),this.geometryMinZ,this.planetCenterZ,this.localMode),this._componentBvh=l),l.intersectRay(e,i,r,s,n,o,a)}get geometryMinZ(){return this._aabb[2]}get planetCenterZ(){return this._planetCenter[2]}get numTriangles(){return this._indices.length/3}get localMode(){return this.viewingMode===Xe.Local}get positions(){return this._positions}get indices(){return this._indices}get aabb(){return this._ensureComponentAabbs(),this._aabb}};const ZDt=E(),YDt=E(),XDt=Yr(),JDt=E(),QDt=Yr();let KDt=class{constructor(e,i,r){this.material=e,this.geometry=i,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}},eNt=class{constructor(e,i,r,s){this.vao=e,this.primitiveType=i,this.parameters=r,this.indexed=s}dispose(){this.vao.dispose()}},$ae=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function tNt(t,e){return{near:t,far:e}}function cN(t){return tNt(1/0,-1/0)}function rj(t,e,i){return t.near=e,t.far=i,t}function MP(t,e){e!=null&&(t.near=Math.min(t.near,e.near),t.far=Math.max(t.far,e.far))}function h5(t,e){return t.near<=e&&e<=t.far}const QK={near:0,far:0};function iNt(t,e){const i=cN(),{eye:r,frustum:s,viewForward:n}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=Te(Ii(ih,a.center,r),n),c=a.projectedRadius(n);if(h5(i,l-c)&&h5(i,l+c))return;const u=aNt(a,s);if(u===-1)return;if(u===0)return Gy.far=l+c,Gy.near=l-c,void MP(i,Gy);const d=d5.pushNew();d.near=l-c,d.far=l+c,d.mask=u,d.object=o});for(let o=0;o<d5.length;o++){const a=d5.data[o];if(h5(i,a.near)&&h5(i,a.far))continue;Gy.far=a.far,Gy.near=1/0,oNt(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,r,rNt,c=>{let u=sNt;for(let d=0;d<lUe&&c.length>0;d++){if(!(a.mask&1<<d))continue;nNt(s[d],c,u);const f=c;c=u,u=f}for(let d=0;d<c.length;d+=3){de(Mc,c.data[d],c.data[d+1],c.data[d+2]);const f=Te(Ii(Mc,Mc,r),n);Gy.near=Math.min(Gy.near,f)}})===0&&(Gy.near=0),MP(i,Gy)}return d5.length=0,i}const d5=new ai({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=null,t)}),Gy=cN(),Mc=E(),tx=E(),rNt=new ai({deallocator:null}),sNt=new ai({deallocator:null});function nNt(t,e,i){i.length=0;const r=e.length-3;a7(Mc,e,r);const s=Or(t,Mc);s<=0&&(i.push(Mc[0]),i.push(Mc[1]),i.push(Mc[2]));let n=0,o=s;for(;n<r;n+=3){a7(tx,e,n);const a=Or(t,tx);o*a<0&&(xr(Mc,tx,Mc,a/(a-o)),Ac(i,Mc)),a<=0&&Ac(i,tx),o=a,ve(Mc,tx)}o*s<0&&(a7(tx,e,r),xr(Mc,tx,Mc,s/(s-o)),Ac(i,Mc))}function a7(t,e,i){return de(t,e.data[i],e.data[i+1],e.data[i+2])}function Ac(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function oNt(t,e,i,r){tb(Sve,t.quaternion),Ii(ih,e,t.center),fu(ih,ih,Sve);const s=t.halfSize,n=8*((ih[0]<-s[0]?-1:ih[0]>s[0]?1:0)+3*(ih[1]<-s[1]?-1:ih[1]>s[1]?1:0)+9*(ih[2]<-s[2]?-1:ih[2]>s[2]?1:0)+13),o=Tve[n];if(o===0)return o;fL(p5,t.quaternion),CD(p5,p5,t.halfSize);const a=(l,c)=>{const u=Tve[n+c+1];return de(l,((1&u)<<1)-1,(2&u)-1,((4&u)>>1)-1),ta(l,l,p5),Ee(l,t.center,l)};return i.length=0,Ac(i,a(l7,0)),Ac(i,a(Eve,1)),Ac(i,a(ih,2)),Ac(i,a(Cve,3)),r(i),o===1||(i.length=0,Ac(i,l7),Ac(i,Cve),Ac(i,a(ih,4)),Ac(i,a(Mve,5)),r(i),o===2||(i.length=0,Ac(i,l7),Ac(i,Mve),Ac(i,a(ih,6)),Ac(i,Eve),r(i))),o}const Tve=(()=>{const t=new Array(216);let e=0;const i=r=>{for(let s=0;s<r.length;s++)t[e+s]=r[s];e+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),t})(),lUe=4;function aNt(t,e){let i=0;for(let r=0;r<lUe;r++){const s=t.intersectPlane(e[r]);if(s>0)return-1;s===0&&(i|=1<<r)}return i}const p5=Yr(),Sve=qh(),ih=E(),l7=E(),Eve=E(),Cve=E(),Mve=E();let lNt=class{constructor(e){this._objects=e}submit(e,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(e,i,r))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?iNt(e,this._objects.visibleObjects):null}};function cNt(t){const e=As().vec3f(R.POSITION);return t.hasNormals&&e.vec2i16(R.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===vs.Default?e.vec2f(R.UV0):t.textureCoordinates===vs.Atlas&&(e.vec2f(R.UV0),e.vec4u16(R.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(R.COLOR,{glNormalized:!0}),e}let uNt=class{constructor(){this.externalColor=ci(),this.externalColorMixMode=qn.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}};var xu;function hNt(t,e){const i=t.vertex;switch(i.code.add(T`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case xu.None:i.code.add(T`#define vertexDiscardByOpacity(_opacity_) {}`);break;case xu.Opaque:i.code.add(T`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case xu.Transparent:i.code.add(T`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case xu.COUNT:break;default:e.vertexDiscardMode}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(xu||(xu={}));var Wg;function wli(t){return t&&f2(t)?Wg.Mars:t&&m2(t)?Wg.Moon:Wg.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(Wg||(Wg={}));var Vd;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(Vd||(Vd={}));let wi=class extends tc{constructor(){super(...arguments),this.output=j.Color,this.textureCoordinateType=vs.None,this.componentData=Hg.Uniform,this.cullFace=Br.Back,this.vertexDiscardMode=xu.None,this.doubleSidedMode=Cs.WindingOrder,this.alphaDiscardMode=Rr.Opaque,this.integratedMeshMode=Vd.None,this.transparencyPassType=pt.NONE,this.ellipsoidMode=Wg.Earth,this.pbrMode=At.Disabled,this.normalType=sr.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.hasNormalTextureTransform=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};h([B({count:j.COUNT})],wi.prototype,"output",void 0),h([B({count:vs.COUNT})],wi.prototype,"textureCoordinateType",void 0),h([B({count:Hg.COUNT})],wi.prototype,"componentData",void 0),h([B({count:Br.COUNT})],wi.prototype,"cullFace",void 0),h([B({count:xu.COUNT})],wi.prototype,"vertexDiscardMode",void 0),h([B({count:Cs.COUNT})],wi.prototype,"doubleSidedMode",void 0),h([B({count:Rr.COUNT})],wi.prototype,"alphaDiscardMode",void 0),h([B({count:Vd.COUNT})],wi.prototype,"integratedMeshMode",void 0),h([B({count:pt.COUNT})],wi.prototype,"transparencyPassType",void 0),h([B({count:Wg.COUNT})],wi.prototype,"ellipsoidMode",void 0),h([B({count:At.COUNT})],wi.prototype,"pbrMode",void 0),h([B({count:sr.COUNT})],wi.prototype,"normalType",void 0),h([B()],wi.prototype,"spherical",void 0),h([B()],wi.prototype,"doublePrecisionRequiresObfuscation",void 0),h([B()],wi.prototype,"hasVertexColors",void 0),h([B()],wi.prototype,"hasNormals",void 0),h([B()],wi.prototype,"hasSlicePlane",void 0),h([B()],wi.prototype,"hasColorTexture",void 0),h([B()],wi.prototype,"receiveAmbientOcclusion",void 0),h([B()],wi.prototype,"receiveShadows",void 0),h([B()],wi.prototype,"blendingEnabled",void 0),h([B()],wi.prototype,"hasScreenSpaceReflections",void 0),h([B()],wi.prototype,"hasPolygonOffset",void 0),h([B()],wi.prototype,"hasMetallicRoughnessTexture",void 0),h([B()],wi.prototype,"hasEmissionTexture",void 0),h([B()],wi.prototype,"hasOcclusionTexture",void 0),h([B()],wi.prototype,"hasNormalTexture",void 0),h([B()],wi.prototype,"hasOccludees",void 0),h([B()],wi.prototype,"multipassEnabled",void 0),h([B()],wi.prototype,"cullAboveGround",void 0),h([B()],wi.prototype,"hasNormalTextureTransform",void 0),h([B()],wi.prototype,"hasCloudsReflections",void 0),h([B()],wi.prototype,"snowCover",void 0),h([B()],wi.prototype,"objectAndLayerIdColor",void 0),h([B({constValue:!1})],wi.prototype,"occlusionPass",void 0),h([B({constValue:Zi.Draw})],wi.prototype,"pbrTextureBindType",void 0),h([B({constValue:!0})],wi.prototype,"hasSliceHighlight",void 0),h([B({constValue:!1})],wi.prototype,"hasSliceInVertexProgram",void 0),h([B({constValue:!1})],wi.prototype,"useCustomDTRExponentForWater",void 0),h([B({constValue:!1})],wi.prototype,"hasVertexTangents",void 0),h([B({constValue:!0})],wi.prototype,"supportsTextureAtlas",void 0),h([B({constValue:!1})],wi.prototype,"highStepCount",void 0),h([B({constValue:!1})],wi.prototype,"instancedDoublePrecision",void 0),h([B({constValue:!1})],wi.prototype,"hasModelTransformation",void 0),h([B({constValue:!0})],wi.prototype,"useFillLights",void 0),h([B({constValue:!1})],wi.prototype,"objectAndLayerIdColorInstanced",void 0);function dNt(t,e){t.include(D2,e),t.fragment.include(hoe);const i=t.fragment;i.uniforms.add(new bB("baseColor",r=>r.baseColor)),i.uniforms.add(new HLe("objectOpacity",r=>r.objectOpacity)),e.hasVertexColors?i.code.add(T`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(T`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(T`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function Ave(t,e){const i=t.fragment;switch(e.doubleSidedMode){case Cs.None:i.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Cs.View:t.include(sA,e),i.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Cs.WindingOrder:i.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case Cs.COUNT:}switch(e.normalType){case sr.Attribute:case sr.Compressed:t.include(E6,e),i.code.add(T`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case sr.ScreenDerivative:t.include(sA,e),i.code.add(T`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case sr.Ground:e.spherical?(t.include(sA,e),i.code.add(T`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):i.code.add(T`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),i.code.add(T`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case sr.COUNT:}}function pNt(t,e){const i=t.fragment;if(e.hasColorTexture&&(e.output===j.Color||e.alphaDiscardMode!==Rr.Opaque)){t.include(Wse,e);const r=e.textureCoordinateType===vs.Atlas;i.uniforms.add(new zg("baseColorTexture",s=>s.texture)),r?(t.include(qse),i.code.add(T`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):i.code.add(T`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else i.code.add(T`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function cUe(t){const e=new Hi;e.include(sA,t),e.include(E6,t),e.include(D2,t),e.include(Af,t),e.include(sO,t),e.include(O0t,t),e.include(t_t,t),e.include(kgt,t),e.include(pNt,t),e.include(hNt,t);const{vertex:i,fragment:r}=e;t.pbrMode!==At.Normal&&t.pbrMode!==At.Schematic||(e.include(Yse,t),t.hasNormalTexture&&e.include(ZLe,t));const s=t.output===j.Shadow||t.output===j.ShadowHighlight||t.output===j.ShadowExcludeHighlight;s&&t.componentData===Hg.Varying?i.code.add(T`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):i.code.add(T`#define discardShadows(castShadows) {}`);const n=t.integratedMeshMode===Vd.ColorOverlay||t.integratedMeshMode===Vd.ColorOverlayWithWater,o=n&&t.output===j.Color&&t.pbrMode===At.WaterOnIntegratedMesh;n&&(e.include(e2,t),e.include(M1t,t),t.spherical?i.code.add(T`
      const float invEllipsoidRadius = ${T.float(1/(t.ellipsoidMode===Wg.Earth?lr.radius:t.ellipsoidMode===Wg.Mars?Nf.radius:n_.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):i.code.add(T`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),i.code.add(T`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===j.ObjectAndLayerIdColor?T`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${T.float(ea)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===j.ObjectAndLayerIdColor?T`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?T`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:T`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${n?T`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===j.Color&&(r.include(Use),e.include(xy,t),e.include(dNt,t),e.include(Ave,t),e.include(e2,t),t.transparencyPassType===pt.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),t.receiveShadows?(e.include(KD,t),r.code.add(T`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):r.code.add(T`float evaluateShadow() { return 0.0; }`),n&&r.uniforms.add(new wt("ovColorTex",(l,c)=>nNe(l,c))),r.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.multipassEnabled?T`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?T`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===At.Normal||t.pbrMode===At.Schematic?(my(r),r.code.add(T`
        ${t.pbrMode===At.Normal?T`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?r.code.add(T`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):r.code.add(T`vec3 shadingNormal = normalVertex;`),r.code.add(T`${t.spherical?T`vec3 normalGround = normalize(positionWorld());`:T`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),r.code.add(T`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();
        ${t.snowCover?T`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1.1), snow);
                ssao = mix(ssao, 0.5 * ssao, snow);
                shadingNormal = mix(shadingNormal, surfaceNormal, snow);`:""}

        ${n?T` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?r.code.add(T`float shadow = evaluateShadow();`):t.spherical?(uO(r),r.code.add(T`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):r.code.add(T`float shadow = 0.0;`),o&&r.uniforms.add(new wt("ovNormalTex",(l,c)=>{var u;return(u=c.overlay)==null?void 0:u.getTexture(is.WaterNormal)})),t.snowCover&&r.code.add(T`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),r.code.add(T`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${n?T` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?T`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),r.code.add(T`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===pt.ColorAlpha?T`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `));const a=t.output===j.Depth;return(a||s||t.output===j.ViewshedShadow)&&(a||e.include(M6,t),r.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${a?"":T`outputDepth(linearDepth);`}
      }
    `)),t.output===j.Normal&&(e.include(Ave,t),r.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material to influence ambient occlusion,
        // see the ssao fragment shader
        float alpha = ${t.normalType===sr.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===j.ObjectAndLayerIdColor&&e.fragment.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?T`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===j.Highlight&&(e.include(rw),r.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?T`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}const fNt=Object.freeze(Object.defineProperty({__proto__:null,build:cUe},Symbol.toStringTag,{value:"Module"}));let uUe=class hUe extends Qi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Xe.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Ki(e.rctx,hUe.shader.get().build(this.configuration),dUe)}_setPipelineState(e){const i=this.configuration,r=i.integratedMeshMode!==Vd.None,s=e===pt.NONE,n=e===pt.FrontFace;return Jt({blending:i.output===j.Color&&i.blendingEnabled?s?Ru:$_(e):null,culling:WG(i.cullFace),depthTest:{func:sw(e)},depthWrite:s||n?Nu:null,drawBuffers:i.output===j.Depth?{buffers:[no.NONE]}:I_(e),colorWrite:ui,stencilWrite:r||i.hasOccludees?oy:null,stencilTest:r?Q0t(kc.IntegratedMeshMaskExcluded):i.hasOccludees?nw:null,polygonOffset:s||n?i.hasPolygonOffset?{factor:2,units:2}:null:b6})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};uUe.shader=new qi(fNt,()=>ce(()=>Promise.resolve().then(()=>LHt),void 0));const dUe=new Map([[R.POSITION,0],[R.NORMAL,1],[R.NORMALCOMPRESSED,1],[R.COLOR,2],[R.UV0,3],[R.UVREGION,4],[R.COMPONENTINDEX,5]]);let mNt=class extends Fr{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},Iae=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function Ds(t={}){return(e,i)=>{const r=e._parameterCount??0;if(e._parameterCount=r+1,t.vectorOps){const s=t.vectorOps;Object.defineProperty(e,i,{get(){return this[r]},set(n){const o=this[r];if(o==null)this[r]=n;else{if(s.equals(o,n))return;s.copy(o,n)}this._setDirty()}})}else Object.defineProperty(e,i,{get(){return this[r]},set(s){this[r]!==s&&(t.dispose&&this[r]&&this[r].dispose(),this[r]=s,this._setDirty())}})}}function Pve(){return(t,e)=>{const i=t._parameterCount??0;t._parameterCount=i+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(i),Object.defineProperty(t,e,{get(){return this[i]},set(r){this[i]!==r&&(this[i]=r,this._setDirty())}})}}let pUe=class{constructor(e){this._low=E(),this._high=E(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){ve(this._low,ve(Ove,e));const i=Ii(Ove,e,this._low);ve(this._high,i)}get(e){return Ee(e,this._low,this._high)}getLowScaled(e){return he(e,this._low,1)}};const Ove=wu();let xo=class extends mNt{constructor(e,i){super(),this.toMapSpace=i,this.baseColor=ii(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=zl(C6),this.emissiveFactor=Ge(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new jU,this.componentParameters=new $3,this.textureAlphaCutoff=gB,this.alphaDiscardMode=Rr.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=Wg.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new wi;const r=new pUe(e.position),s=AMe(e.rotationScale);ED(s,s),x2(s,s),this.transformNormalGlobalFromModel=s,this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=hi(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(e,i,r,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.hasNormals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,n.hasEmissionTexture=this.emissionTexture!=null,n.hasOcclusionTexture=this.occlusionTexture!=null,n.hasNormalTexture=this.normalTexture!=null,n.transparencyPassType=i.identifier===Gl.Material&&r.transparencyPassType!=null?r.transparencyPassType:pt.NONE,n.multipassEnabled=i.identifier===Gl.Material&&r.multipassEnabled,n.cullAboveGround=i.identifier===Gl.Material&&r.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?Cs.View:Cs.None,n.hasColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();if(n.blendingEnabled=o===Nl.Transparent||o===Nl.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?_Nt(r)?yNt(r)?Vd.ColorOverlayWithWater:Vd.ColorOverlay:Vd.NoOverlay:Vd.None,n.hasPolygonOffset=this.polygonOffsetEnabled,n.pbrMode=n.integratedMeshMode===Vd.ColorOverlayWithWater?At.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?s.needsNormals&&this.isIntegratedMesh?At.Disabled:At.Schematic:At.Normal:At.Disabled,n.normalType=s.needsNormals?n.hasNormals?sr.Compressed:sr.ScreenDerivative:sr.Ground,n.hasSlicePlane=r.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,i.identifier===Gl.ShadowMap)n.output=j.Shadow,n.vertexDiscardMode=xu.None;else if(i.identifier===Gl.ViewshedShadowMap)n.output=j.ViewshedShadow,n.vertexDiscardMode=xu.None;else if(i.identifier===Gl.Highlight)n.output=j.Highlight,n.vertexDiscardMode=xu.None;else{switch(o===Nl.OpaqueAndTransparent?n.vertexDiscardMode=i.transparent?xu.Opaque:xu.Transparent:n.vertexDiscardMode=xu.None,n.output=i.output,n.receiveAmbientOcclusion=!1,n.receiveShadows=!1,i.output){case j.Color:n.receiveAmbientOcclusion=r.ssao!=null,n.hasOccludees=r.hasOccludees,n.receiveShadows=r.shadowMap.ready,n.hasScreenSpaceReflections=r.ssr.lastFrameColor!=null,n.hasCloudsReflections=r.cloudsFade.data!=null;break;case j.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(r)}return this._technique=e.releaseAndAcquire(uUe,n,this._technique),this._setClean(),this._technique}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,i,r){if(this.objectOpacity===0)return;const s=r.renderable.geometry,n=r.components,o=r.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Nl.Opaque:e.materialOpaque.submitDraw(this,s,a,o);break;case Nl.Transparent:e.materialTransparent.submitDraw(this,s,a,o);break;case Nl.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,s,a,o),e.materialTransparent.submitDraw(this,s,a,o);break;case Nl.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,s,a,o),gNt(i)&&e.highlightIntegratedMesh.submitDraw(this,s,a,o)}const u=this.componentParameters.castShadows!==oo.None;u&&e.shadowMap.submitDraw(this,s,a,o),l!=null&&(e.highlight.submitDraw(this,s,l,o),u&&e.highlightShadowMap.submitDraw(this,s,l,o)),i.viewshedEnabled&&e.viewshedShadowMap.submitDraw(this,s,a,o),u&&c!=null&&e.defaultShadowMap.submitDraw(this,s,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?Nl.IntegratedMesh:this.objectOpacity<1?Nl.Transparent:this.componentParameters.opaqueOverride===oo.All?Nl.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Rr.Blend||this.alphaDiscardMode===Rr.MaskBlend?Nl.Transparent:this.componentParameters.transparent===oo.None?Nl.Opaque:this.componentParameters.transparent===oo.All?Nl.Transparent:Nl.OpaqueAndTransparent}};var Nl,oo;h([Ds({vectorOps:YMe})],xo.prototype,"baseColor",void 0),h([Ds()],xo.prototype,"usePBR",void 0),h([Ds()],xo.prototype,"hasParametersFromSource",void 0),h([Ds({vectorOps:Wue})],xo.prototype,"mrrFactors",void 0),h([Ds({vectorOps:Wue})],xo.prototype,"emissiveFactor",void 0),h([Ds({dispose:!0})],xo.prototype,"baseColorTexture",void 0),h([Ds({dispose:!0})],xo.prototype,"metallicRoughnessTexture",void 0),h([Ds({dispose:!0})],xo.prototype,"emissionTexture",void 0),h([Ds({dispose:!0})],xo.prototype,"occlusionTexture",void 0),h([Ds({dispose:!0})],xo.prototype,"normalTexture",void 0),h([Ds()],xo.prototype,"objectOpacity",void 0),h([Pve()],xo.prototype,"commonMaterialParameters",void 0),h([Pve()],xo.prototype,"componentParameters",void 0),h([Ds()],xo.prototype,"textureAlphaCutoff",void 0),h([Ds()],xo.prototype,"alphaDiscardMode",void 0),h([Ds()],xo.prototype,"isIntegratedMesh",void 0),h([Ds()],xo.prototype,"polygonOffsetEnabled",void 0),h([Ds()],xo.prototype,"ellipsoidMode",void 0),h([Ds()],xo.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(Nl||(Nl={}));let jU=class extends Iae{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Br.Back,this.hasSlicePlane=!0}};h([Ds()],jU.prototype,"doubleSided",void 0),h([Ds()],jU.prototype,"cullFace",void 0),h([Ds()],jU.prototype,"hasSlicePlane",void 0);let $3=class extends Iae{constructor(){super(...arguments),this.externalColor=ii(1,1,1,1),this.externalColorMixMode=qn.Multiply,this.castShadows=oo.All}get transparent(){return this.externalColor[3]<1?oo.All:oo.None}get opaqueOverride(){return this.externalColorMixMode===qn.Replace&&this.externalColor[3]===1?oo.All:oo.None}get visible(){return this.externalColor[3]>0?oo.All:oo.None}get type(){return Hg.Uniform}};h([Ds({vectorOps:YMe})],$3.prototype,"externalColor",void 0),h([Ds()],$3.prototype,"externalColorMixMode",void 0),h([Ds()],$3.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(oo||(oo={}));let _I=class extends Iae{constructor(){super(...arguments),this.texture=null,this.transparent=oo.None,this.opaqueOverride=oo.None,this.castShadows=oo.None}get type(){return Hg.Varying}};function gNt(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(is.Highlight))!=null}function yNt(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(is.WaterNormal))!=null}function _Nt(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(is.ColorNoRasterImage))!=null}h([Ds()],_I.prototype,"texture",void 0),h([Ds()],_I.prototype,"transparent",void 0),h([Ds()],_I.prototype,"opaqueOverride",void 0),h([Ds()],_I.prototype,"castShadows",void 0);const fUe=As().vec3f(R.POSITION).u16(R.COMPONENTINDEX).freeze(),vNt=As().vec2u8(R.SIDENESS).freeze(),Oli=ku(vNt),KK=As().vec3f(R.POSITION0).vec3f(R.POSITION1).vec2i16(R.NORMALCOMPRESSED).u16(R.COMPONENTINDEX).u8(R.VARIANTOFFSET,{glNormalized:!0}).u8(R.VARIANTSTROKE).u8(R.VARIANTEXTENSION,{glNormalized:!0}).freeze(),eee=As().vec3f(R.POSITION0).vec3f(R.POSITION1).vec2i16(R.NORMALCOMPRESSED).vec2i16(R.NORMAL2COMPRESSED).u16(R.COMPONENTINDEX).u8(R.VARIANTOFFSET,{glNormalized:!0}).u8(R.VARIANTSTROKE).u8(R.VARIANTEXTENSION,{glNormalized:!0}).freeze(),Rli=new Map([[R.POSITION0,0],[R.POSITION1,1],[R.COMPONENTINDEX,2],[R.VARIANTOFFSET,3],[R.VARIANTSTROKE,4],[R.VARIANTEXTENSION,5],[R.NORMALCOMPRESSED,6],[R.NORMAL2COMPRESSED,7],[R.SIDENESS,8]]);function Rve(t,e,i){const r=e/3,s=new Uint32Array(i+1),n=new Uint32Array(i+1),o=(b,w)=>{b<w?s[b+1]++:n[w+1]++};for(let b=0;b<r;b++){const w=t[3*b],x=t[3*b+1],S=t[3*b+2];o(w,x),o(x,S),o(S,w)}let a=0,l=0;for(let b=0;b<i;b++){const w=s[b+1],x=n[b+1];s[b+1]=a,n[b+1]=l,a+=w,l+=x}const c=new Uint32Array(6*r),u=s[i],d=(b,w,x)=>{if(b<w){const S=s[b+1]++;c[2*S]=w,c[2*S+1]=x}else{const S=n[w+1]++;c[2*u+2*S]=b,c[2*u+2*S+1]=x}};for(let b=0;b<r;b++){const w=t[3*b],x=t[3*b+1],S=t[3*b+2];d(w,x,b),d(x,S,b),d(S,w,b)}const f=(b,w)=>{const x=2*b,S=w-b;for(let C=1;C<S;C++){const M=c[x+2*C],O=c[x+2*C+1];let D=C-1;for(;D>=0&&c[x+2*D]>M;D--)c[x+2*D+2]=c[x+2*D],c[x+2*D+3]=c[x+2*D+1];c[x+2*D+2]=M,c[x+2*D+3]=O}};for(let b=0;b<i;b++)f(s[b],s[b+1]),f(u+n[b],u+n[b+1]);const m=new Int32Array(3*r),g=(b,w)=>b===t[3*w]?0:b===t[3*w+1]?1:b===t[3*w+2]?2:-1,y=(b,w)=>{const x=g(b,w);m[3*w+x]=-1},v=(b,w,x,S)=>{const C=g(b,w);m[3*w+C]=S;const M=g(x,S);m[3*S+M]=w};for(let b=0;b<i;b++){let w=s[b];const x=s[b+1];let S=n[b];const C=n[b+1];for(;w<x&&S<C;){const M=c[2*w],O=c[2*u+2*S];M===O?(v(b,c[2*w+1],O,c[2*u+2*S+1]),w++,S++):M<O?(y(b,c[2*w+1]),w++):(y(O,c[2*u+2*S+1]),S++)}for(;w<x;)y(b,c[2*w+1]),w++;for(;S<C;)y(c[2*u+2*S],c[2*u+2*S+1]),S++}return m}const c7=.7;let mUe=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?wNt:bNt}write(e,i,r){f5.seed=this._edgeHashFunction(r);const s=f5.getIntRange(0,255),n=f5.getIntRange(0,this.settings.variants-1),o=f5.getFloat(),a=255*(.5*xNt(-(1-Math.min(o/c7,1))+Math.max(0,o-c7)/(1-c7),1.2)+.5);e.position0.setVec(i,r.position0),e.position1.setVec(i,r.position1),e.componentIndex.set(i,r.componentIndex),e.variantOffset.set(i,s),e.variantStroke.set(i,n),e.variantExtension.set(i,a)}};const v1=new Float32Array(6),b1=new Uint32Array(v1.buffer),IM=new Uint32Array(1);function bNt(t){return v1[0]=t.position0[0],v1[1]=t.position0[1],v1[2]=t.position0[2],v1[3]=t.position1[0],v1[4]=t.position1[1],v1[5]=t.position1[2],IM[0]=31*(31*(31*(31*(31*(166811+b1[0])+b1[1])+b1[2])+b1[3])+b1[4])+b1[5],IM[0]}function wNt(t){const e=v1;e[0]=zE(t.position0[0]),e[1]=zE(t.position0[1]),e[2]=zE(t.position0[2]),e[3]=zE(t.position1[0]),e[4]=zE(t.position1[1]),e[5]=zE(t.position1[2]),IM[0]=5381;for(let i=0;i<b1.length;i++)IM[0]=31*IM[0]+b1[i];return IM[0]}const $ve=1e4;function zE(t){return Math.round(t*$ve)/$ve}function xNt(t,e){return Math.abs(t)**e*Math.sign(t)}let tee=class{constructor(){this._commonWriter=new mUe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return KK.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r),Ee(BE,r.faceNormal0,r.faceNormal1),Ce(BE,BE);const{typedBuffer:s,typedBufferStride:n}=e.normalCompressed;np(s,i,BE[0],BE[1],BE[2],n)}};tee.Layout=KK,tee.glLayout=ku(KK,1);let iee=class{constructor(){this._commonWriter=new mUe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return eee.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r);{const{typedBuffer:s,typedBufferStride:n}=e.normalCompressed;np(s,i,r.faceNormal0[0],r.faceNormal0[1],r.faceNormal0[2],n)}{const{typedBuffer:s,typedBufferStride:n}=e.normal2Compressed;np(s,i,r.faceNormal1[0],r.faceNormal1[1],r.faceNormal1[2],n)}}};iee.Layout=eee,iee.glLayout=ku(eee,1);const BE=E(),f5=new JT;let TNt=class{constructor(){this.position0=E(),this.position1=E(),this.faceNormal0=E(),this.faceNormal1=E(),this.componentIndex=0,this.cosAngle=0}};const GU=-1;function SNt(t,e,i){const r=t.vertices.position,s=t.vertices.componentIndex,n=Jc.position0,o=Jc.position1,a=Jc.faceNormal0,l=Jc.faceNormal1,{edges:c,normals:u}=ANt(t),d=c.length/4,f=e.allocate(d);let m=0;const g=d,y=i==null?void 0:i.allocate(g);let v=0,b=0,w=0;m5.length=0;for(let D=0;D<d;++D){const U=4*D;r.getVec(c.data[U],n),r.getVec(c.data[U+1],o);const k=m5.pushNew();k.index=4*D,k.length=Cr(n,o)}m5.sort((D,U)=>U.length-D.length);const x=new Array,S=new Array;m5.forAll(({length:D,index:U})=>{const k=c.data[U],H=c.data[U+1],V=c.data[U+2],X=c.data[U+3],q=X===GU;if(r.getVec(k,n),r.getVec(H,o),q){const Z=3*V;de(a,u.data[Z],u.data[Z+1],u.data[Z+2]),ve(l,a),Jc.componentIndex=s.get(k),Jc.cosAngle=Te(a,l)}else{let Z=3*V;if(de(a,u.data[Z],u.data[Z+1],u.data[Z+2]),Z=3*X,de(l,u.data[Z],u.data[Z+1],u.data[Z+2]),Jc.componentIndex=s.get(k),Jc.cosAngle=Te(a,l),CNt(Jc,RNt))return;Jc.cosAngle<-.9999&&ve(l,a)}b+=D,w++,q||ENt(Jc,INt)?(e.write(f,m++,Jc),x.push(D)):MNt(Jc,gUe)&&(y&&i&&i.write(y,v++,Jc),S.push(D))});const C=new Float32Array(x.reverse()),M=new Float32Array(S.reverse()),O=y&&i?{instancesData:y.slice(0,v),lodInfo:{lengths:M}}:void 0;return{regular:{instancesData:f.slice(0,m),lodInfo:{lengths:C}},silhouette:O,averageEdgeLength:b/w}}function ENt(t,e){return t.cosAngle<e}function CNt(t,e){return t.cosAngle>e}function MNt(t,e){const i=po(t.cosAngle);return v_(Ive,t.position1,t.position0),i*(Te(ft(ONt,t.faceNormal0,t.faceNormal1),Ive)>0?-1:1)>e}function ANt(t){const e=t.faces.length/3,i=t.faces,r=t.neighbors,s=t.vertices.position;Xc.length=u7.length=0;for(let n=0;n<e;n++){const o=3*n,a=r[o],l=r[o+1],c=r[o+2],u=i[o],d=i[o+1],f=i[o+2];s.getVec(u,ix),s.getVec(d,g5),s.getVec(f,y5),Re(g5,g5,ix),Re(y5,y5,ix),ft(ix,g5,y5),Ce(ix,ix),u7.pushArray(ix),(a===GU||u<d)&&(Xc.push(u),Xc.push(d),Xc.push(n),Xc.push(a)),(l===GU||d<f)&&(Xc.push(d),Xc.push(f),Xc.push(n),Xc.push(l)),(c===GU||f<u)&&(Xc.push(f),Xc.push(u),Xc.push(n),Xc.push(c))}return{edges:Xc,normals:u7}}let PNt=class{constructor(){this.index=0,this.length=0}};const m5=new ai({allocator:t=>t||new PNt,deallocator:null}),Xc=new ai({deallocator:null}),u7=new ai({deallocator:null}),Jc=new TNt,ONt=E(),Ive=E(),ix=E(),g5=E(),y5=E(),gUe=kt(4),RNt=Math.cos(gUe),$Nt=kt(35),INt=Math.cos($Nt);function Fli(t){const e=LNt(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return Lve.updateSettings(t.writerSettings),Dve.updateSettings(t.writerSettings),SNt(e,Lve,Dve)}function LNt(t,e,i,r){if(e){const o=Rve(i,r,t.count);return new DNt(i,r,o,t)}const s=ZQ(t.buffer,t.stride/4,{originalIndices:i,originalIndicesLength:r}),n=Rve(s.indices,r,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:fUe.createView(s.buffer)}}let DNt=class{constructor(e,i,r,s){this.faces=e,this.facesLength=i,this.neighbors=r,this.vertices=s}};const Lve=new tee,Dve=new iee,Uli=As().vec3f(R.POSITION0).vec3f(R.POSITION1),NNt=As().vec3f(R.POSITION0).vec3f(R.POSITION1).u16(R.COMPONENTINDEX);let FNt=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},kNt=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this.textureWidth=4096,this._dirty=!0;const r=new Xr(this.textureWidth,1);r.samplingMode=di.NEAREST,r.wrapMode=Mi.CLAMP_TO_EDGE,this._texture=new Er(this._rctx,r),this._data=new ml(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,i,r,s,n,o){const a=e*this._fieldCount+i;this._dirty=!0,this._data.set(a,0,r),this._data.set(a,1,s),this._data.set(a,2,n),this._data.set(a,3,o)}setDataElement(e,i,r,s){const n=e*this._fieldCount+i;this._dirty=!0,this._data.set(n,r,s)}getDataElement(e,i,r){const s=e*this._fieldCount+i;return this._dirty=!0,this._data.get(s,r)}resizeToFit(e){const i=(e+1)*this._fieldCount;if(i>this._data.count){const r=Math.ceil(i/this.textureWidth)*this.textureWidth,s=new ml(new ArrayBuffer(4*r));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,i=this._texture.descriptor.height;this._data.count>e*i&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const yUe=65536;let UNt=class{constructor(e,i=1){this.textureBuffer=new kNt(e,i),this._indexManager=new FNt(yUe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},VNt=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const r of this._buffers)if(r.availableCount>=e)return r;if(e>yUe)return null;const i=new UNt(this._rctx,this._fieldCount);return this._buffers.push(i),i}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const Nve=()=>se.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let zNt=class{constructor(e,i){this._renderManager=e,this._viewingMode=i,this._elevationRangeCacheVerticalOffset=NaN,this._elevationRangeCacheMin=NaN,this._elevationRangeCacheMax=NaN,this._visible=new ai,this._hidden=new ai,this._renderSubmit=new lNt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=le("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new VNt(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){vt(this._hidden.length===0&&this._visible.length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy(),this._visible.forAll(e=>e.destroy()),this._hidden.forAll(e=>e.destroy()),this._visible.clear(),this._hidden.clear()}createObject(e){const i=e.geometry,r=new wDt(this._componentBufferManager,jg(i.componentOffsets)),s=this._createRenderable(e,r),n=new WDt(this._viewingMode,i.positionData,r),o=new TDt(e.transform,e.toMapSpace,e.obb.clone(),r,s,n);return(o.visible?this._visible:this._hidden).push(o),o}destroyObject(e){const i=e;(i.visible?this._visible:this._hidden).removeUnordered(i),i.destroy(),this._notifyDirty()}setObjectVisibility(e,i){const r=e;i!==r.visible&&(i?(this._hidden.removeUnordered(r),this._visible.push(r)):(this._visible.removeUnordered(r),this._hidden.push(r)),r.visible=i,this._notifyDirty())}preSubmit(e){const i=e.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=uo(i,r.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,i){const r=e.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,i){const r=e;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,i){return e.components.visibility.forEachComponent(i)}getComponentCount(e){const i=e,r=i.components.visibility.componentCount;return{visible:r,invisible:i.components.count-r}}setComponentData(e,i){const r=e,s=r.renderable.material,n=r.components,o=n.materialDataBuffer,a=n.materialDataIndices,l=new uNt,c=o.textureBuffer,u=new Uint8Array(4),d=new Uint32Array(u.buffer);let f=0,m=0,g=0,y=n.verticalOffsets,v=1/0,b=-1/0,w=!1,x=!1,S=0;for(let C=0;C<n.count;C++){i(C,l),f+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===qn.Replace&&l.externalColor[3]===1),g+=+l.castShadows,MLe(l.externalColor,l.externalColorMixMode,u),u[2]=254&u[2]|+l.castShadows,c.setData(a[C],0,u[0],u[1],u[2],u[3]),w||(w=C>0&&S!==d[0]),S=d[0],x||(x=l.elevationOffset!==0),x&&y==null&&(y=new Array(C).fill(0)),y!=null&&(y[C]=l.elevationOffset),v=Math.min(v,l.elevationOffset),b=Math.max(b,l.elevationOffset),P0t(l.elevationOffset,u),c.setData(a[C],1,u[0],u[1],u[2],u[3]);const M=l.objectAndLayerIdColor;M!=null&&c.setData(a[C],2,M[0],M[1],M[2],M[3]),l.pickable!==JK(n.pickability,C)&&(n.pickability=LDt(n.pickability,n.count,C,l.pickable))}n.verticalOffsets=x?y:null,r.offsetObb=x?oPe(r.obb,v,b,this._viewingMode,r.offsetObb??r.obb.clone()):null,w||x||this._hasObjectAndLayerId?(s.componentParameters=new _I,s.componentParameters.castShadows=h7(g,n.count),s.componentParameters.transparent=h7(f,n.count),s.componentParameters.opaqueOverride=h7(m,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new $3,s.componentParameters.castShadows=l.castShadows?oo.All:oo.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._elevationRangeCacheVerticalOffset=NaN,this._notifyDirty()}getComponentAabb(e,i,r,s=!1){e.intersectionGeometry.getComponentAabb(i,r);const n=e,o=n.components.verticalOffsets;if(s||o==null)return r;const a=o[i];if(this._viewingMode===Xe.Local||a===0)return r[2]+=a,r[5]+=a,r;const l=Mde(a);return l.localOrigin=n.transform.position,l.applyToAabb(r)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,i,r){return e.intersectionGeometry.getComponentPositions(i,r)}expandRangeWithComponentObjectElevationRange(e,i,r,s){Number.isNaN(this._elevationRangeCacheVerticalOffset)||this._elevationRangeCacheVerticalOffset!==i||s.expandElevationRangeValues(this._elevationRangeCacheMin,this._elevationRangeCacheMax);const n=e,o=n.components,a=o.count,l=o.verticalOffsets,c=n.intersectionGeometry,u=this._viewingMode===Xe.Local,d=c.getComponentAabbs(),f=jNt;let m=1/0,g=-1/0;for(let y=0;y<a;y++){const v=6*y,b=(l==null?void 0:l[y])??0;let w=1/0,x=-1/0;if(u)w=d[v+2]+b+i,x=d[v+5]+b+i;else{if(f[0]=d[v],f[1]=d[v+1],f[2]=d[v+2],f[3]=d[v+3],f[4]=d[v+4],f[5]=d[v+5],b!==0){const O=Mde(b);O.localOrigin=n.transform.position,O.applyToAabb(f)}const S=Math.max(Math.abs(f[3]),Math.abs(f[0])),C=Math.max(Math.abs(f[4]),Math.abs(f[1])),M=i+f[5]+r;s.expandElevationRangeValues(i+f[2],Math.sqrt(S*S+C*C+M*M)-r)}s.expandElevationRangeValues(w,x),m=Math.min(m,w),g=Math.max(g,x)}this._elevationRangeCacheVerticalOffset=i,this._elevationRangeCacheMin=m,this._elevationRangeCacheMax=g}intersect(e,i,r,s,n,o,a){const l=e,{transform:c}=l,{position:u}=c;return n!=null&&(n.localOrigin=u),l.intersectionGeometry.intersect(i,r,s,n,l.components.verticalOffsets,c,o,a)}addEdges(e,i,r,s,n){const o=e,{indices:a,positions:l}=o.intersectionGeometry,c=o.components.offsets;return i.addComponentObject(o,l,a,c,r,s,n)}async extractEdgeInformation(e,i,r){const s=e,n=s.components.visibility;if(n.allInvisible())return{buffer:NNt.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=fUe.createBuffer(a.length/3);Z6(c.position.typedBuffer,a,c.position.typedBufferStride,3),WDe(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const u=c.count,d=this._computeVisibilityIndices(o,n,l,u);return{origin:hn(s.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:d,indicesLength:d.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(e,i,r){let s=0;for(let n=0;n<r.length-1;n++){const o=r[n],a=r[n+1];for(let l=o;l<a;l++){const c=i?i[l]:l;e.set(c,s)}s++}}_computeVisibilityIndices(e,i,r,s){if(e&&i.allVisible())return e;let n=0;i.forEachComponentRange((l,c)=>(n+=r[c]-r[l],!0));const o=Zg(e)?new Array(n):(e==null?void 0:e.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return i.forEachComponentRange((l,c)=>{const u=r[l],d=r[c];for(let f=u;f<d;f++)o[a++]=e?e[f]:f;return!0}),o}addComponentHighlight(e,i){const r=e.components;r.highlightCounts==null&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[i]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(e,i){const r=e.components;if(r.highlightCounts==null)return void Nve().warn("Removing non-existing highlight.");const s=r.highlightCounts[i],n=r.highlightCounts[r.count];if(s!==0){if(s>1)return r.highlightCounts[i]=s-1,void(r.highlightCounts[r.count]=n-1);r.highlightCounts[i]=0,r.highlightsDirty(),this._notifyDirty(),n===1?r.highlightCounts=null:r.highlightCounts[r.count]=n-1}else Nve().warn("Removing non-existing highlight.")}clearHighlights(e){const i=e.components;i.highlightCounts!=null&&(i.highlightCounts=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._visible}_createRenderable(e,i){const r=this._renderManager.rctx,s=e.geometry,n=s.vertices.layoutParameters,o=Sr.createVertex(r,cr.STATIC_DRAW,s.vertices.data),a=s.indices?Sr.createIndex(r,cr.STATIC_DRAW,s.indices):null,l=ku(cNt(n)),c=new Uint16Array(s.vertices.count);for(let y=0;y<i.count;y++){const v=i.offsets[y],b=i.offsets[y+1],w=i.materialDataIndices[y];if(s.indices!=null)for(let x=v;x<b;x++)c[s.indices[x]]=w;else for(let x=v;x<b;x++)c[x]=w}const u=Sr.createVertex(r,cr.STATIC_DRAW,c.buffer),d=new xo(e.transform,e.toMapSpace),f=new Jf(r,dUe,{data:l,componentIndices:BNt},{data:o,componentIndices:u},a),m=new eNt(f,Ci.TRIANGLES,n,a!=null),g={cameraDepthSquared:.5,gpuMemoryEstimate:o.usedMemory+u.usedMemory+(a!=null?a.usedMemory:0)};return new KDt(d,m,g)}_notifyDirty(){this._renderManager.notifyDirty()}};const BNt=ku(As().u16(R.COMPONENTINDEX));function h7(t,e){return t===e?oo.All:t===0?oo.None:oo.Some}const jNt=Xn();let Lae=class extends Fr{};function _Ue(){const t=new Hi,{outputs:e,fragment:i}=t;return t.include(ka),i.uniforms.add(new zg("textureInput",r=>r.input)),i.constants.add("sampleArea","int",Math.ceil(qL/2)),e.add("fragGrid","vec2"),i.code.add(T`
    void main() {
      float red = 0.0;
      float green = 1.0;
      int cellSize = ${T.int(rf)};
      vec2 texelSize = 1.0 / vec2(textureSize(textureInput, 0));
      vec2 offset = floor(gl_FragCoord.xy) * vec2(float(cellSize));

      for(int x = -sampleArea; x < cellSize + sampleArea; x += 2) {
        for(int y = -sampleArea; y < cellSize + sampleArea; y += 2) {
          vec2 coord = (offset + vec2(float(x), float(y))) * texelSize;
          vec4 value = texture(textureInput, coord);
          float mx = floor(max(value.g, value.b));

          red = max(red, ceil(value.r));
          green = min(green, mx);
          if(red == 1.0 && green == 0.0) {
            fragGrid = vec2(red, green);
            return;
          }
        }
      }
      fragGrid = vec2(red, green);
    }`),t}const rf=32,qL=9,Dae=.4,GNt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:Lae,blurSize:Dae,build:_Ue,gridCellPixelSize:rf,outlineSize:qL},Symbol.toStringTag,{value:"Module"}));function vUe(){const t=new Hi,{vertex:e,fragment:i}=t,r=e.code,s=i.code;return t.attributes.add(R.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(R.UV0,"vec2"),e.uniforms.add(new wt("coverageTex",n=>n.coverageTexture),new jr("coverageRounding",n=>n.coverageRounding)),r.add(T`void main() {
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),i.uniforms.add(new wt("tex",n=>n.blurTexture),new wt("highlightTexture",n=>n.highlightTexture),new ji("uColor",n=>n.color),new ji("haloColor",n=>n.haloColor),new ji("opacities",n=>_s(HNt,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),i.constants.add("inner","float",1-(qL-Dae)/qL),s.add(T`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(highlightTexture, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float outlineFactor = smoothstep(0.0, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const HNt=ci(),qNt=Object.freeze(Object.defineProperty({__proto__:null,build:vUe},Symbol.toStringTag,{value:"Module"}));let bUe=class wUe extends Qi{initializeProgram(e){return new Ki(e.rctx,wUe.shader.get().build(),Ai)}initializePipeline(){return Jt({blending:ua(Be.SRC_ALPHA,Be.ONE,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),colorWrite:ui})}};bUe.shader=new qi(qNt,()=>ce(()=>Promise.resolve().then(()=>DHt),void 0));let Nae=class extends Fr{constructor(){super(...arguments),this.blurSize=mt()}};function xUe(){const t=new Hi,{attributes:e,varyings:i,vertex:r,fragment:s}=t;return e.add(R.POSITION,"vec2"),e.add(R.UV0,"vec2"),i.add("blurCoordinate","vec3"),r.uniforms.add(new wt("coverageTex",n=>n.coverageTexture),new jr("coverageRounding",n=>n.coverageRounding)),r.code.add(T`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), cov.g);
}`),s.uniforms.add(new XLe("blurSize",n=>n.blurSize),new zg("tex",n=>n.blurInputTexture)),s.code.add(T`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),t}const WNt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:Nae,build:xUe},Symbol.toStringTag,{value:"Module"}));let TUe=class SUe extends Qi{initializeProgram(e){return new Ki(e.rctx,SUe.shader.get().build(),Ai)}initializePipeline(){return Jt({colorWrite:ui})}};TUe.shader=new qi(WNt,()=>ce(()=>Promise.resolve().then(()=>NHt),void 0));let EUe=class CUe extends Qi{initializeProgram(e){return new Ki(e.rctx,CUe.shader.get().build(),Ai)}initializePipeline(){return Jt({colorWrite:ui})}};EUe.shader=new qi(GNt,()=>ce(()=>Promise.resolve().then(()=>FHt),void 0));let ZNt=class extends Fr{constructor(){super(...arguments),this.color=ii(1,0,1,1),this.haloColor=ii(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.coverageRounding=Ei(1,1)}},IC=class extends YD{constructor(e){super(e),this.produces="highlight-color",this.consumes={required:["highlight-color","highlights"]},this._passParameters=new ZNt,this._downsampleDrawParameters=new Lae,this._blurDrawParameters=new Nae,this._blurColorFormat=le("mac")?ss.RGBA:ss.RGBA4,this._grid={coverage:null,vao:null,verticalCellCount:0,horizontalCellCount:0,viewportWidth:0,viewportHeight:0},this._blurTechnique=e.techniques.acquire(TUe),this._downsampleTechnique=e.techniques.acquire(EUe),this._applyTechnique=e.techniques.acquire(bUe)}initialize(){this.addHandles([te(()=>this.view.highlightOptions.color,e=>{this._passParameters.color=vL(e??H5e),this.view.highlightOptions.haloColor||(this._passParameters.haloColor=this._passParameters.color),this.requestRender(ar.UPDATE)},hr),te(()=>this.view.highlightOptions.haloColor,e=>{this._passParameters.haloColor=e!=null?vL(e):this._passParameters.color,this.requestRender(ar.UPDATE)},hr),te(()=>this.view.highlightOptions.haloOpacity,e=>{this._passParameters.haloOpacity=e??q5e,this._passParameters.haloOpacityOccluded=.25*this._passParameters.haloOpacity,this.requestRender(ar.UPDATE)},hr),te(()=>this.view.highlightOptions.fillOpacity,e=>{this._passParameters.fillOpacity=e??W5e,this._passParameters.fillOpacityOccluded=.25*this._passParameters.fillOpacity,this.requestRender(ar.UPDATE)},hr)])}destroy(){this._blurTechnique.release(),this._downsampleTechnique.release(),this._applyTechnique.release(),this._grid.coverage=hi(this._grid.coverage),this._grid.vao=Ut(this._grid.vao)}render(e){var b,w,x;if(this.bindParameters.decorations===Zl.OFF)return e.find(({name:S})=>S==="highlight-color");if(!(this._blurTechnique.compiled&&this._downsampleTechnique.compiled&&this._applyTechnique.compiled))return this.requestRender(ar.UPDATE),e.find(({name:S})=>S==="highlight-color");const i=e.find(({name:S})=>S==="highlights").getTexture(),r=this.bindParameters.camera,s=r.fullWidth,n=r.fullHeight,o=r.pixelRatio,a=Math.ceil(s/o),l=Math.ceil(n/o),c=this.renderingContext;this._gridUpdateResources(i),this._gridComputeCoverage(i,this.bindParameters),this._passParameters.highlightTexture=i,this._passParameters.coverageTexture=(b=this._grid.coverage)==null?void 0:b.getTexture();const{width:u,height:d}=i.descriptor;Li(this._passParameters.coverageRounding,u/(Math.ceil(u/rf)*rf),d/(Math.ceil(d/rf)*rf));const f=this._grid.vao;c.bindVAO(f);const m=this.fboCache.acquire(a,l,"highlight blur",this._blurColorFormat);c.unbindTexture((w=m.fbo)==null?void 0:w.colorTexture),c.bindFramebuffer(m.fbo),c.setClearColor(0,0,0,0),c.clear(zr.COLOR_BUFFER_BIT),c.setViewport(0,0,a,l),this._blurDrawParameters.blurInputTexture=i,Li(this._blurDrawParameters.blurSize,1/a,0);const g=c.bindTechnique(this._blurTechnique,this.bindParameters,this._passParameters,this._blurDrawParameters);c.drawArrays(this._blurTechnique.primitiveType,0,J0(f,"geometry"));const y=this.fboCache.acquire(a,l,"highlight blur",this._blurColorFormat);c.unbindTexture((x=y.fbo)==null?void 0:x.colorTexture),c.bindFramebuffer(y.fbo),c.setClearColor(0,0,0,0),c.clear(zr.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=m.getTexture(),Li(this._blurDrawParameters.blurSize,0,1/l),g.bindDraw(this._blurDrawParameters,this.bindParameters,this._passParameters),c.drawArrays(this._blurTechnique.primitiveType,0,J0(f,"geometry"));const v=e.find(({name:S})=>S==="highlight-color");return c.bindFramebuffer(v.fbo),c.setViewport4fv(r.fullViewport),this._passParameters.blurTexture=y.getTexture(),c.bindTechnique(this._applyTechnique,this.bindParameters,this._passParameters),c.drawArrays(this._applyTechnique.primitiveType,0,J0(f,"geometry")),m.release(),y.release(),v}_gridUpdateResources(e){var f;const i=this.renderingContext,r=this._grid,s=Math.ceil(e.descriptor.height/rf),n=Math.ceil(e.descriptor.width/rf);if(r.vao&&r.verticalCellCount===s&&r.horizontalCellCount===n)return;r.verticalCellCount=s,r.horizontalCellCount=n;const o=s+1,a=n+1,l=1/s,c=1/n,u=new Float32Array(6*4*o*a);let d=0;for(let m=0;m<o;m++)for(let g=0;g<a;g++)u[d++]=(g-.5)*c*2-1,u[d++]=(m-.5)*l*2-1,u[d++]=g*c,u[d++]=m*l,u[d++]=(g+.5)*c*2-1,u[d++]=(m-.5)*l*2-1,u[d++]=g*c,u[d++]=m*l,u[d++]=(g-.5)*c*2-1,u[d++]=(m+.5)*l*2-1,u[d++]=g*c,u[d++]=m*l,u[d++]=(g-.5)*c*2-1,u[d++]=(m+.5)*l*2-1,u[d++]=g*c,u[d++]=m*l,u[d++]=(g+.5)*c*2-1,u[d++]=(m-.5)*l*2-1,u[d++]=g*c,u[d++]=m*l,u[d++]=(g+.5)*c*2-1,u[d++]=(m+.5)*l*2-1,u[d++]=g*c,u[d++]=m*l;(f=r.vao)==null||f.dispose(),r.vao=new _y(i,Ai,{geometry:DD},{geometry:Sr.createVertex(i,cr.STATIC_DRAW,u)})}_gridComputeCoverage(e,i){var l,c;const r=this.renderingContext,s=this._grid,n=e.descriptor,o=Math.ceil(n.width/rf),a=Math.ceil(n.height/rf);this._downsampleDrawParameters.input=e,(l=s.coverage)==null||l.release(),s.coverage=this.fboCache.acquire(o,a,"highlight coverage",ss.RG),r.unbindTexture((c=s.coverage.fbo)==null?void 0:c.colorTexture),r.bindFramebuffer(s.coverage.fbo),r.bindTechnique(this._downsampleTechnique,i,this._passParameters,this._downsampleDrawParameters),r.setViewport(0,0,o,a),r.screen.draw()}get test(){}};h([p()],IC.prototype,"produces",void 0),h([p()],IC.prototype,"consumes",void 0),h([p({constructOnly:!0})],IC.prototype,"techniques",void 0),IC=h([I("esri.views.3d.webgl-engine.effects.highlight.Highlight")],IC);let Fae=class extends tc{constructor(){super(...arguments),this.receiveShadows=!0}};h([B()],Fae.prototype,"receiveShadows",void 0);function MUe(t){const e=t.fragment;t.include(XD),e.include(fy),e.code.add(T`vec3 normalFromDepth(sampler2D depthMap, vec3 pixelPos, vec2 fragCoord, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
float leftPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(-1, 0), 0).r);
float rightPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(1, 0), 0).r);
float bottomPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, -1), 0).r);
float topPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, 1), 0).r);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`)}const YNt=.99999,XNt=.025;function AUe(t){const e=new Hi;e.include(KD,t),e.include(ka),e.include(MUe);const i=e.fragment;return i.include(rm),i.uniforms.add(new wt("defaultDepthTex",(r,s)=>s.shadowMap.getSnapshot(s2.ExcludeHighlight)),new wt("highlightDepthTex",(r,s)=>s.shadowMap.getSnapshot(s2.Highlight)),new wt("depthMap",(r,s)=>{var n;return(n=s.depth)==null?void 0:n.attachment}),new wt("highlightTexture",r=>r.highlight),new ji("uColor",r=>r.shadowColor),new et("opacity",r=>r.shadowOpacity),new et("occludedOpacity",r=>r.occludedShadowOpacity),new et("terminationFactor",r=>r.opacityElevation*r.dayNightTerminator),new Wt("lightingMainDirectionView",(r,s)=>Ce(kve,nt(kve,s.lighting.mainLight.direction,s.camera.viewInverseTransposeMatrix))),new us("inverseViewMatrix",(r,s)=>Zn(Fve,dl(Fve,s.camera.viewMatrix,s.camera.center)))),i.constants.add("unoccludedHighlightFlag","vec4",Gne),i.code.add(T`
    void main(void) {
      vec4 highlightInfo = texture(highlightTexture, uv);
      float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
      if (visiblyHighlighted > ${T.float(YNt)}) {
        discard;
      }

      float depth = depthFromTexture(depthMap, uv);

      // 1.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
      if (depth >= 1.0 || depth <= 0.0) {
        discard;
      }

      float currentPixelDepth = linearizeDepth(depth);
      vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
      vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

      mat4 shadowMatrix;
      float linearDepth = -currentPixelDepth;
      int i = chooseCascade(linearDepth, shadowMatrix);
      if (i >= numCascades) {
        discard;
      }

      vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
        discard;
      }

      ivec2 texSize = textureSize(highlightDepthTex, 0);
      ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

      float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
      bool shadowHighlight = depthHighlight < lvpos.z;
      if (!shadowHighlight) {
        discard;
      }

      float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
      bool shadowDefault = depthDefault < lvpos.z;

      vec3 normal = normalFromDepth(depthMap, currentPixelPos.xyz, gl_FragCoord.xy, uv);
      bool shaded = dot(normal, lightingMainDirectionView) < ${T.float(XNt)};

      float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
      fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
    }
  `),e}const Fve=ke(),kve=E(),JNt=Object.freeze(Object.defineProperty({__proto__:null,build:AUe},Symbol.toStringTag,{value:"Module"}));let QNt=class extends uoe{constructor(){super(...arguments),this.shadowColor=ii(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},PUe=class OUe extends Qi{constructor(e){super(e,new Fae,()=>this.destroy())}initializeProgram(e){return new Ki(e.rctx,OUe.shader.get().build(this.configuration),Ai)}initializePipeline(){return Jt({blending:ua(Be.SRC_ALPHA,Be.ONE,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),colorWrite:ui,depthTest:null,depthWrite:null})}get primitiveType(){return Ci.TRIANGLE_STRIP}};PUe.shader=new qi(JNt,()=>ce(()=>Promise.resolve().then(()=>kHt),void 0));const KNt=.001953125,eFt=4e4,tFt=5e4;let Xx=class extends YD{constructor(e){super(e),this.produces="composite-color",this.consumes={required:["composite-color","highlights"]},this._passParameters=new QNt,this._maxOpacity=1,this._shadowDifference=.2,this._technique=e.techniques.acquire(PUe)}initialize(){this.addHandles([te(()=>this.view.highlightOptions.shadowOpacity,e=>{this._passParameters.shadowOpacity=e??Y5e,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},hr),te(()=>this.view.highlightOptions.shadowDifference,e=>{this._shadowDifference=e??X5e,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},hr),te(()=>this.view.highlightOptions.shadowColor,e=>{this._passParameters.shadowColor=vL(e??Z5e),this._updateMaxOpacity()},hr)])}destroy(){this._technique.release()}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}render(e){var n;const i=e.find(({name:o})=>o==="composite-color"),r=this.bindParameters;if(!r.shadowHighlightsVisible||!r.depth||!this._ensureIfVisible(r.camera,r.lighting.mainLight.direction))return i;if(!this._technique.compiled)return this.requestRender(ar.UPDATE),i;this._passParameters.highlight=(n=e.find(({name:o})=>o==="highlights"))==null?void 0:n.getTexture(),this._passParameters.origin=r.camera.center;const s=this.renderingContext;return s.bindFramebuffer(i.fbo),s.bindTechnique(this._technique,r,this._passParameters),s.screen.draw(),i}_ensureIfVisible(e,i){this._passParameters.opacityElevation=1-sL(eFt,tFt,e.relativeElevation);const r=this.viewingMode===Xe.Global?Ce(Uve,e.center):de(Uve,0,0,1),s=Te(r,i);return this._passParameters.dayNightTerminator=sL(0,1,Ne(30*s,0,1)),this._maxOpacity*this._passParameters.opacityElevation*this._passParameters.dayNightTerminator>=KNt}};h([p()],Xx.prototype,"produces",void 0),h([p()],Xx.prototype,"consumes",void 0),h([p({constructOnly:!0})],Xx.prototype,"viewingMode",void 0),h([p({constructOnly:!0})],Xx.prototype,"techniques",void 0),Xx=h([I("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],Xx);const Uve=E();let kae=class extends Fr{constructor(){super(...arguments),this.mask=null,this.overlay=null,this.input=null,this.size=0}};function RUe(){const t=new Hi;return t.attributes.add(R.POSITION,"vec2"),t.vertex.uniforms.add(new ji("drawPosition",(e,i)=>iFt(e,i))),t.varyings.add("vUV","vec2"),t.vertex.code.add(T`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new wt("textureInput",e=>e.input)),t.fragment.uniforms.add(new wt("textureMask",e=>e.mask)),t.fragment.uniforms.add(new wt("textureOverlay",e=>e.overlay)),t.fragment.uniforms.add(new Bg("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new Bg("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(T`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function iFt(t,e){const i=e.camera.pixelRatio,r=t.magnifier.offset.x*i,s=t.magnifier.offset.y*i;yf(t.magnifier.position,Vve);const n=e.camera.screenToRender(Vve,rFt),o=Math.ceil(i*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return _s(sFt,(n[0]+r)/a*2-1,(n[1]-s)/l*2-1,o/a*2,o/l*2)}const Vve=Ss(),rFt=MEe(),sFt=ci(),nFt=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:kae,build:RUe},Symbol.toStringTag,{value:"Module"}));let $Ue=class IUe extends Qi{initializeProgram(e){return new Ki(e.rctx,IUe.shader.get().build(),Ai)}initializePipeline(){return Jt({blending:Hh(Be.ONE,Be.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:ui})}};$Ue.shader=new qi(nFt,()=>ce(()=>Promise.resolve().then(()=>UHt),void 0));async function oFt(t){const e=ce(()=>import("./mask-svg-cNit2NTT.js"),[]),i=ce(()=>import("./overlay-svg-DioSRl-7.js"),[]),r=m_((await e).default,{signal:t}),s=m_((await i).default,{signal:t}),n={mask:await r,overlay:await s};return Dt(t),n}let Qv=class extends YD{constructor(e){super(e),this.produces="magnifier-color",this.consumes={required:["magnifier-color"]},this._imageSources=null,this._imageLoadTask=null,this._passParameters=new kae,this._vao=null,this._technique=null,this._magnifier=null,this._tmpScreenPoint=Ss(),this._tmpRenderPoint=MEe()}initialize(){this.addHandles([te(()=>this.view.magnifier,e=>this._update(e),hr)])}_update(e){if(e===this._magnifier)return;this.removeAllHandles(),this._magnifier=e;const i=()=>{const r=this._validMagnifier;r?(this._loadResources(r),this.produces="magnifier-color"):this.produces="disabled",this.requestRender()};this._magnifier&&this.addHandles(te(()=>{var r;return(r=this._magnifier)==null?void 0:r.version},i)),i()}get _validMagnifier(){var e,i,r;return(e=this._magnifier)!=null&&e.visible&&((i=this._magnifier)!=null&&i.position)&&((r=this._magnifier)==null?void 0:r.size)>0?this._magnifier:null}get _factor(){var e;return((e=this._magnifier)==null?void 0:e.factor)||1}destroy(){this._magnifier=null,this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeTextures(),this._vao=Ut(this._vao)}_disposeTextures(){this._passParameters.mask=Ut(this._passParameters.mask),this._passParameters.overlay=Ut(this._passParameters.overlay),this._passParameters.input=Ut(this._passParameters.input)}render(e){var v;const i=this._validMagnifier,r=e.find(({name:b})=>b==="magnifier-color");if(i==null)return r;if(this._imageSources==null)return this.requestRender(ar.UPDATE),r;const s=this.renderingContext,n=this.camera.pixelRatio,o=Math.ceil(n*i.size);if(this._vao??(this._vao=vy(s,zse,Ai,0,1)),this._technique??(this._technique=this.techniques.acquire($Ue)),this._ensureTextureResources(s,o),!((v=this._technique)!=null&&v.compiled)||!this._passParameters.input)return this.requestRender(ar.UPDATE),r;const a=Math.ceil(1/this._factor*o),l=this._passParameters.input;l.resize(a,a),yf(i.position,this._tmpScreenPoint);const c=this.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),u=this.camera.fullWidth,d=this.camera.fullHeight,f=.5*a,m=.5*a;c[0]=Ne(c[0],f,u-f-1),c[1]=Ne(c[1],m,d-m-1);const g=Math.floor(c[0]-f),y=Math.floor(c[1]-m);return s.bindFramebuffer(r.fbo),this._technique.program.bindTexture("textureInput",l),s.gl.copyTexImage2D(l.descriptor.target,0,l.descriptor.pixelFormat,g,y,a,a,0),this._passParameters.magnifier=i,s.bindTechnique(this._technique,this.bindParameters,this._passParameters),s.bindVAO(this._vao),s.drawArrays(Ci.TRIANGLE_STRIP,0,4),r}_loadResources(e){var s,n,o;const{maskUrl:i,overlayUrl:r}=e;((s=this._imageLoadTask)==null?void 0:s.maskUrl)===i&&((n=this._imageLoadTask)==null?void 0:n.overlayUrl)===r||((o=this._imageLoadTask)==null||o.task.abort(),this._imageLoadTask=this._imageSources=null),this._imageSources||this._imageLoadTask||(this._imageLoadTask={maskUrl:i,overlayUrl:r,task:uy(async a=>{const l=i==null||r==null?oFt(a):null,c=i!=null?m_(i,{signal:a}):l.then(d=>d.mask),u=r!=null?m_(r,{signal:a}):l.then(d=>d.overlay);this._imageSources={mask:await c,overlay:await u}})})}_ensureTextureResources(e,i){if(this._imageSources==null||this._passParameters.size===i&&this._passParameters.input&&this._passParameters.mask&&this._passParameters.overlay)return;this._disposeTextures(),this._imageSources.overlay.width=this._imageSources.mask.width=i,this._imageSources.overlay.height=this._imageSources.mask.height=i;const r=new Xr;r.internalFormat=Ht.RGBA,r.wrapMode=Mi.CLAMP_TO_EDGE,r.flipped=!0,r.preMultiplyAlpha=!v2e(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result,this._passParameters.overlay=new Er(e,r,this._imageSources.overlay),r.pixelFormat=r.internalFormat=Ht.ALPHA,r.preMultiplyAlpha=!1,this._passParameters.mask=new Er(e,r,this._imageSources.mask),r.pixelFormat=r.internalFormat=Ht.RGBA,r.flipped=!1,this._passParameters.input=new Er(e,r)}};h([p()],Qv.prototype,"produces",void 0),h([p()],Qv.prototype,"consumes",void 0),h([p()],Qv.prototype,"_imageSources",void 0),h([p()],Qv.prototype,"_imageLoadTask",void 0),h([p({constructOnly:!0})],Qv.prototype,"techniques",void 0),Qv=h([I("esri.views.3d.webgl-engine.effects.magnifier.MagnifierRenderNode")],Qv);const jE={maxSearchSteps:8,maxDistanceAreaTex:16};function LUe(){const t=new Hi;return t.include(ka),t.fragment.uniforms.add(new wt("edgesTexture",e=>e.inputTexture),new wt("areaTexture",e=>e.areaTexture),new wt("searchTexture",e=>e.searchTexture)),t.fragment.code.add(T`
    #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
    #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

    vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset, vec2 resolution) {
      return texture(tex, coord + offset.x * resolution, 0.0);
    }

    float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
      e.r = bias + e.r * scale;
      return 255.0 * texture( searchTex, e, 0.0 ).r;
    }

    float searchLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${T.int(jE.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x += 0.25 * resolution.x;
      texcoord.x += resolution.x;
      texcoord.x += 2.0 * resolution.x;
      texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
      return texcoord.x;
    }

    float searchRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${T.int(jE.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x -= 0.25 * resolution.x;
      texcoord.x -= resolution.x;
      texcoord.x -= 2.0 * resolution.x;
      texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
      return texcoord.x;
    }

    float searchUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${T.int(jE.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y -= 0.25 * resolution.y;
      texcoord.y -= resolution.y;
      texcoord.y -= 2.0 * resolution.y;
      texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
      return texcoord.y;
    }

    float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${T.int(jE.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y += 0.25 * resolution.y;
      texcoord.y += resolution.y;
      texcoord.y += 2.0 * resolution.y;
      texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
      return texcoord.y;
    }

    vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
      vec2 texcoord = float( ${T.int(jE.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
      texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
      texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
      return texture( areaTex, texcoord, 0.0 ).rg;
    }

    void main() {
      vec2 size = vec2(textureSize(edgesTexture, 0));
      vec2 resolution = 1.0 / size;
      vec2 pixelCoord = uv * size;
      vec4 offsets[2];
      offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
      offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
      vec4 maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${T.int(jE.maxSearchSteps)} );

      ivec4 subsampleIndices = ivec4(0.0);
      vec4 weights = vec4(0.0);
      vec2 e = texture( edgesTexture, uv ).rg;
      if ( e.g > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.x = searchLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x, resolution );
        coords.y = offsets[1].y;
        d.x = coords.x;
        float e1 = texture( edgesTexture, coords, 0.0 ).r;
        coords.x = searchRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y, resolution );
        d.y = coords.x;
        d = d * size.x - pixelCoord.x;
        vec2 sqrt_d = sqrt( abs(d) );
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ), resolution).r;
        weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
      }

      if ( e.r > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.y = searchUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z, resolution );
        coords.x = offsets[0].x;
        d.x = coords.y;
        float e1 = texture( edgesTexture, coords, 0.0 ).g;
        coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w, resolution );
        d.y = coords.y;
        d = d * size.y - pixelCoord.y;
        vec2 sqrt_d = sqrt(abs(d));
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0), resolution).g;
        weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

        // for some reason the following lines are necessary to prevent
        // texture lookup precision issues on some Intel integrated graphics chips
        vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
        weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
      }
      fragColor = weights;
    }`),t}const aFt=Object.freeze(Object.defineProperty({__proto__:null,build:LUe},Symbol.toStringTag,{value:"Module"}));let DUe=class NUe extends Qi{initializeProgram(e){return new Ki(e.rctx,NUe.shader.get().build(),Ai)}initializePipeline(){return Jt({colorWrite:ui})}};DUe.shader=new qi(aFt,()=>ce(()=>Promise.resolve().then(()=>VHt),void 0));function FUe(){const t=new Hi;return t.include(ka),t.fragment.uniforms.add(new wt("blendWeightsTexture",e=>e.inputTexture),new wt("colorTexture",e=>e.color)),t.fragment.code.add(T`void main() {
vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),t}const lFt=Object.freeze(Object.defineProperty({__proto__:null,build:FUe},Symbol.toStringTag,{value:"Module"}));let kUe=class UUe extends Qi{initializeProgram(e){return new Ki(e.rctx,UUe.shader.get().build(),Ai)}initializePipeline(){return Jt({colorWrite:ui})}};kUe.shader=new qi(lFt,()=>ce(()=>Promise.resolve().then(()=>zHt),void 0));const zve={threshold:.05,localConstrastAdaption:2};function VUe(){const t=new Hi;return t.include(ka),t.fragment.uniforms.add(new wt("colorTexture",e=>e.color)),t.outputs.add("fragEdges","vec2"),t.fragment.code.add(T`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
      vec4 offsets[3];
      offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
      offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
      offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${T.float(zve.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges *= step(maxDelta, float(${T.float(zve.localConstrastAdaption)}) * delta.xy);

      fragEdges = edges;
    }
  `),t}const cFt=Object.freeze(Object.defineProperty({__proto__:null,build:VUe},Symbol.toStringTag,{value:"Module"}));let zUe=class BUe extends Qi{initializeProgram(e){return new Ki(e.rctx,BUe.shader.get().build(),Ai)}initializePipeline(){return Jt({colorWrite:ui})}};zUe.shader=new qi(cFt,()=>ce(()=>Promise.resolve().then(()=>BHt),void 0));let uFt=class extends Fr{},Kv=class extends YD{constructor(e){super(e),this.produces="disabled",this.consumes={required:["aa-color","composite-color"]},this._areaTexture=null,this._searchTexture=null,this._smaaParameters=new uFt,this._edgeTechnique=e.techniques.acquire(zUe),this._blendTechnique=e.techniques.acquire(DUe),this._blurTechnique=e.techniques.acquire(kUe)}initialize(){this.addHandles([te(()=>this.isEnabled(),e=>e?this.enable():this.disable(),hr)])}async enable(){if(this.produces="aa-color",this._abortController||this._areaTexture&&this._searchTexture)return;this._abortController=new AbortController;const e=this._abortController.signal;try{const i=await ce(()=>import("./SMAAData-DCEZ61Cs.js"),[]);await this._loadTextures(i,e),this.requestRender(ar.UPDATE)}catch{}this._abortController=null}async _loadTextures(e,i){Dt(i);const[r,s]=await Promise.allSettled([m_(e.areaTexture,{signal:i}),m_(e.searchTexure,{signal:i})]);if(Dt(i),r.status!=="fulfilled"||s.status!=="fulfilled")return;const n=this.renderingContext;this._areaTexture=Bve(n,di.LINEAR,Ht.RGB,r.value),this._searchTexture=Bve(n,di.NEAREST,Ht.LUMINANCE,s.value)}disable(){this.produces="disabled"}destroy(){this._searchTexture=Ut(this._searchTexture),this._areaTexture=Ut(this._areaTexture),this._blurTechnique.release(),this._blendTechnique.release(),this._edgeTechnique.release()}render(e){var c,u;const i=e.find(({name:d})=>d==="aa-color");if(!(this._edgeTechnique.compiled&&this._blendTechnique.compiled&&this._blurTechnique.compiled&&this._areaTexture&&this._searchTexture))return this.requestRender(ar.UPDATE),i;const r=e.find(({name:d})=>d==="composite-color"),s=r.fbo.width,n=r.fbo.height,o=this.renderingContext;o.setViewport(0,0,s,n);const a=this.fboCache.acquire(s,n,"smaa edges",ss.RG);o.unbindTexture((c=a.fbo)==null?void 0:c.colorTexture),o.bindFramebuffer(a.fbo),o.setClearColor(0,0,0,1),o.clear(zr.COLOR_BUFFER_BIT),this._smaaParameters.color=r.getTexture(),o.bindTechnique(this._edgeTechnique,null,this._smaaParameters),o.screen.draw();const l=this.fboCache.acquire(s,n,"smaa blend");return o.unbindTexture((u=l.fbo)==null?void 0:u.colorTexture),o.bindFramebuffer(l.fbo),o.setClearColor(0,0,1,1),o.clear(zr.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=a.getTexture(),this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,o.bindTechnique(this._blendTechnique,null,this._smaaParameters),o.screen.draw(),a.release(),o.bindFramebuffer(i.fbo),o.setClearColor(0,1,0,1),o.clear(zr.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=l.getTexture(),o.bindTechnique(this._blurTechnique,null,this._smaaParameters),o.screen.draw(),l.release(),i}};function Bve(t,e,i,r){const s=new Xr;return s.pixelFormat=i,s.wrapMode=Mi.CLAMP_TO_EDGE,s.width=r.width,s.height=r.height,s.samplingMode=e,new Er(t,s,r)}h([p()],Kv.prototype,"produces",void 0),h([p()],Kv.prototype,"consumes",void 0),h([p({constructOnly:!0})],Kv.prototype,"isEnabled",void 0),h([p({constructOnly:!0})],Kv.prototype,"techniques",void 0),h([p()],Kv.prototype,"_abortController",void 0),Kv=h([I("esri.views.3d.webgl-engine.effects.smaa.SMAA")],Kv);let tH=class extends Fr{constructor(){super(...arguments),this.opacity=1}};function jUe(t){const e=new Hi;return e.include(ka),e.fragment.uniforms.add(new wt("tex",i=>i.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new et("opacity",i=>i.opacity)),t.isDepthBlit&&(e.fragment.uniforms.add(new jr("nearFar",(i,r)=>r.camera.nearFar)),e.fragment.include(fy),e.fragment.include(rm)),e.fragment.code.add(T`
    void main() {
      ${t.isDepthBlit?T`
              float normalizedLinearDepth = (-linearDepthFromTexture(tex, uv) - nearFar[0]) / (nearFar[1] - nearFar[0]);
              fragColor = float2rgba(normalizedLinearDepth);`:T`
              fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};`}
    }`),e}const hFt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:tH,build:jUe},Symbol.toStringTag,{value:"Module"}));var Cu;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(Cu||(Cu={}));let I3=class extends tc{constructor(){super(...arguments),this.alphaMode=Cu.None,this.hasOpacityFactor=!1,this.isDepthBlit=!1}};h([B({count:Cu.COUNT})],I3.prototype,"alphaMode",void 0),h([B()],I3.prototype,"hasOpacityFactor",void 0),h([B()],I3.prototype,"isDepthBlit",void 0);let Uae=class GUe extends Qi{initializeProgram(e){return new Ki(e.rctx,GUe.shader.get().build(this.configuration),Ai)}initializePipeline(){switch(this.configuration.alphaMode){case Cu.None:return Jt({colorWrite:ui});case Cu.Alpha:return Jt({blending:ua(Be.SRC_ALPHA,Be.ONE,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),colorWrite:ui});case Cu.PremultipliedAlpha:case Cu.COUNT:return Jt({blending:Hh(Be.ONE,Be.ONE_MINUS_SRC_ALPHA),colorWrite:ui})}}};Uae.shader=new qi(hFt,()=>ce(()=>Promise.resolve().then(()=>jHt),void 0));let Vae=class extends Fr{};function HUe(){const t=new Hi;return t.include(ka),t.fragment.uniforms.add(new wt("tex",e=>e.texture)),t.fragment.code.add(T`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),t}const dFt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:Vae,build:HUe},Symbol.toStringTag,{value:"Module"}));let qUe=class WUe extends Qi{initializeProgram(e){return new Ki(e.rctx,WUe.shader.get().build(),Ai)}initializePipeline(){return Jt({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};qUe.shader=new qi(dFt,()=>ce(()=>Promise.resolve().then(()=>GHt),void 0));let zae=class extends Fr{};function ZUe(){const t=new Hi;return t.include(ka),t.fragment.uniforms.add(new wt("colorTexture",e=>e.colorTexture),new wt("alphaTexture",e=>e.alphaTexture),new wt("frontFaceTexture",e=>e.frontFaceTexture)),t.fragment.code.add(T`void main() {
float srcAlpha = texture(alphaTexture, uv).r;
if(srcAlpha <= 1e-5){
discard;
}
vec4 srcColor = texture(colorTexture, uv);
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb / srcAlpha, frontFace.rgb, frontFace.a), 1.0 - srcColor.a);
}`),t}const pFt=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:zae,build:ZUe},Symbol.toStringTag,{value:"Module"}));let Bae=class YUe extends Qi{initializeProgram(e){return new Ki(e.rctx,YUe.shader.get().build(),Ai)}initializePipeline(){return Jt({blending:ua(Be.SRC_ALPHA,Be.ONE,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),colorWrite:ui})}};Bae.shader=new qi(pFt,()=>ce(()=>Promise.resolve().then(()=>HHt),void 0));let fFt=class{constructor(e,i){this._rctx=e,this._techniques=i,this._configuration=new I3,this._passParameters=new tH,this._oitParameters=new zae,this._hudParameters=new Vae}compositeOIT(e,i,r,s){this._oitParameters.colorTexture=i,this._oitParameters.alphaTexture=r,this._oitParameters.frontFaceTexture=s;const n=this._techniques.acquire(Bae);this._rctx.bindTechnique(n,e,this._oitParameters),this._rctx.screen.draw(),n.release()}compositeHUD(e,i){this._hudParameters.texture=i;const r=this._techniques.acquire(qUe);this._rctx.bindTechnique(r,e,this._hudParameters),this._rctx.screen.draw(),r.release()}composite(e,i,r=Cu.None,s=1){this._configuration.alphaMode=r,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=i,this._passParameters.opacity=s;const n=this._techniques.acquire(Uae,this._configuration);this._rctx.bindTechnique(n,e,this._passParameters),this._rctx.screen.draw(),n.release()}blitDepthToLinearDepth(e,i){this._configuration.isDepthBlit=!0,this.composite(e,i),this._configuration.isDepthBlit=!1}};const mFt=1e4,ree=100,gFt=500,yFt=500,_Ft=.1;function vFt(t,e,i){return eoe(e,t)*(i[1]-i[0])+i[0]}function bFt(t,e,i){let r=0;if(!e.some(n=>!!n.materialReference&&(r+=n.numGeometries,r>=mFt)))return PFt.compute(t,e);const s=cN();return i.forAll(n=>MP(s,wFt(t,n))),s}function wFt(t,e){if(!e.visible)return;const i=cN(),r=e.getSpatialQueryAccelerator();return r?xFt(i,t,r):TFt(i,t,e.objects),i}function xFt(t,e,i){const r=e.eye,s=e.viewForward,n=e.frustum,o=l=>l.visible,a=i.objectCount;if(a<gFt)rj(Pd,e.near,Math.min(t.near,e.far)),i.forEachInDepthRange(r,s,Of.DepthOrder.FRONT_TO_BACK,Pd,(l,c)=>{see(t,e,l),Pd.far=t.near,c.setRange(Pd)},n,o),rj(Pd,Math.max(t.far,e.near),e.far),i.forEachInDepthRange(r,s,Of.DepthOrder.BACK_TO_FRONT,Pd,(l,c)=>{see(t,e,l),Pd.near=t.far,c.setRange(Pd)},n,o);else{const l=Math.max(Math.min(a,yFt),Math.ceil(a*_Ft)),c=i.findClosest(s,Of.DepthOrder.FRONT_TO_BACK,n,o,l),u=i.findClosest(s,Of.DepthOrder.BACK_TO_FRONT,n,o,l);c&&u&&(jve(t,e,c.boundingVolumeWorldSpace.bounds),jve(t,e,u.boundingVolumeWorldSpace.bounds))}}function TFt(t,e,i){GE.clear(),i.forAll(r=>{r.visible&&r.geometries.length!==0&&GE.add(r)}),GE.empty||(GE.sort(e),rj(Pd,e.near,Math.min(t.near,e.far)),GE.forEachInDepthRange(Pd,Of.DepthOrder.FRONT_TO_BACK,(r,s)=>{s<t.near&&see(t,e,r)}),rj(Pd,Math.max(t.far,e.near),e.far),GE.forEachInDepthRange(Pd,Of.DepthOrder.BACK_TO_FRONT,(r,s,n)=>{t.far=Math.max(t.far,n)}))}function see(t,e,i){if(!i.visible||!B1(e.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,s=AFt;i.geometries.forEach(n=>{gr(s,r,n.transformation);const o=XA(s);XUe(t,e,n.boundingInfo,s,o)})}function XUe(t,e,i,r,s){if(i==null)return;nt(Vl,i.center,r);const{eye:n,viewForward:o}=e,a=o[0]*(Vl[0]-n[0])+o[1]*(Vl[1]-n[1])+o[2]*(Vl[2]-n[2]);if(Vl[3]=i.radius*s,!(a-Vl[3]>t.near&&a+Vl[3]<t.far)&&B1(e.frustum,Vl))if(i.radius>ree&&i.getChildren())for(const l of i.getChildren())XUe(t,e,l,r,s);else nee.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function jve(t,e,i){const r=e.eye,s=e.viewForward,n=(i[0]-r[0])*s[0]+(i[1]-r[1])*s[1]+(i[2]-r[2])*s[2];t.near=Math.min(t.near,n-i[3]),t.far=Math.max(t.far,n+i[3])}let SFt=class{constructor(){this._items=new ai({allocator:e=>e||{object:null,distance:0,near:0,far:0},deallocator:e=>(e.object=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().object=e}sort(e){const i=e.eye,r=e.viewForward;this._items.forAll(s=>{const n=s.object.boundingVolumeWorldSpace.bounds,o=(n[0]-i[0])*r[0]+(n[1]-i[1])*r[1]+(n[2]-i[2])*r[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(e,i,r){if(i===Of.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.object,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.object,n.near,n.far)}}},EFt=class{constructor(){this._view=ke(),this._viewProj=ke(),this._frustum=wL(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,i){this._reset(),xn(this._view,e.viewMatrix),gr(this._viewProj,e.projectionMatrix,this._view),Zz(this._frustum,e.frustum);const r=this._view,s=r[2],n=r[6],o=r[10],a=r[14];i.forAll(f=>{f.materialReference&&f.forEachGeometry&&f.forEachGeometry(m=>{if(!m.visible||!m.castShadow)return;const g=m.boundingSphere,y=s*g[0]+n*g[1]+o*g[2]+a,v=y-g[3],b=y+g[3];this._geometries.push(m),this._near.push(-b),this._far.push(-v)})});const l=new $ae;if(this._geometries.length===0)return l;for(let f=0;f<this._geometries.length;++f)this._near[f]>l.far&&(l.far=this._near[f]),this._near[f]>2&&this._far[f]<l.near&&(l.near=this._far[f]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let u=0,d=0;for(let f=0;f<this._geometries.length;++f)this._near[f]<l.near&&(this._near[f]>=c.near?l.near=this._near[f]:this._nearCandidates[u++]=f),this._far[f]>l.far&&(this._far[f]<=c.far?l.far=this._far[f]:this._farCandidates[d++]=f);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((f,m)=>this._near[f]<this._near[m]?-1:this._near[f]>this._near[m]?1:0),this._farCandidates.sort((f,m)=>this._far[f]<this._far[m]?1:this._far[f]>this._far[m]?-1:0);for(let f=0;f<this._nearCandidates.length;++f){const m=this._nearCandidates[f];if(this._near[m]<l.near){const g=this._geometries[m],y=g.boundingInfo;this._includeNearBoundingInfoRec(y,g.shaderTransformation,l)}}for(let f=0;f<this._farCandidates.length;++f){const m=this._farCandidates[f];if(this._far[m]>l.far){const g=this._geometries[m],y=g.boundingInfo;this._includeFarBoundingInfoRec(y,g.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,i,r){if(e==null)return;const s=e.center;nt(Vl,s,i);const n=XA(i),o=Vl[0],a=Vl[1],l=Vl[2],c=e.radius*n,u=this._frustum;if(u[0][0]*o+u[0][1]*a+u[0][2]*l+u[0][3]>c||u[1][0]*o+u[1][1]*a+u[1][2]*l+u[1][3]>c||u[2][0]*o+u[2][1]*a+u[2][2]*l+u[2][3]>c||u[3][0]*o+u[3][1]*a+u[3][2]*l+u[3][3]>c)return;const d=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],f=d+c;if(!(-(d-c)<2||-f>=r.near))if(-f>this._looseRange.near)r.near=-f;else{if(c>ree){const m=e.getChildren();if(m!==void 0){for(const g of m)this._includeNearBoundingInfoRec(g,i,r);return}}nee.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,i,r){if(e==null)return;let s=e.radius;const n=e.center;nt(Vl,n,i);const o=XA(i),a=Vl[0],l=Vl[1],c=Vl[2];s*=o;const u=this._frustum;if(u[0][0]*a+u[0][1]*l+u[0][2]*c+u[0][3]>s||u[1][0]*a+u[1][1]*l+u[1][2]*c+u[1][3]>s||u[2][0]*a+u[2][1]*l+u[2][2]*c+u[2][3]>s||u[3][0]*a+u[3][1]*l+u[3][2]*c+u[3][3]>s)return;const d=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-s;if(!(-d<=r.far))if(-d<this._looseRange.far)r.far=-d;else{if(s>ree){const f=e.getChildren();if(f!==void 0){for(const m of f)this._includeFarBoundingInfoRec(m,i,r);return}}nee.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}},CFt=class{constructor(){this._modelViewProj=ke(),this._clipPosition=[ci(),ci(),ci(),ci(),ci(),ci(),ci(),ci()]}unionDepthRangeWithAABB(e,i,r,s,n){const o=this._modelViewProj;gr(o,i,r);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],u=l===0||l===3||l===4||l===7?s[0]:n[0],d=l===0||l===1||l===4||l===5?s[1]:n[1],f=l<4?s[2]:n[2];c[0]=o[0]*u+o[4]*d+o[8]*f+o[12],c[1]=o[1]*u+o[5]*d+o[9]*f+o[13],c[2]=o[2]*u+o[6]*d+o[10]*f+o[14],c[3]=o[3]*u+o[7]*d+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=MFt(this._clipPosition[p7[l][0]],this._clipPosition[p7[l][1]],this._clipPosition[p7[l][2]]);let u=!0;for(let d=0;d<c.length;++d)if(c[d][3]>=2){u=!1;break}if(!u){a=!0;for(let d=0;d<c.length;++d){const f=c[d][3];Number.isFinite(f)&&(e.near=Math.min(f,e.near),e.far=Math.max(f,e.far))}}}return a}};function MFt(t,e,i){let r=[t,e,i];for(let s=0;s<4;++s){const n=r;r=[];for(let o=0;o<n.length;++o){const a=n[o],l=n[(o+1)%n.length];d7(l,s)?(d7(a,s)||r.push(Gve(a,l,s)),r.push(l)):d7(a,s)&&r.push(Gve(a,l,s))}}return r}function d7(t,e){return e===0?t[0]>=-t[3]:e===1?t[1]>=-t[3]:e===2?t[0]<=t[3]:e===3?t[1]<=t[3]:void vt(!1)}function Gve(t,e,i){let r=0;return i===0?r=(-t[3]-t[0])/(e[0]-t[0]+e[3]-t[3]):i===1?r=(-t[3]-t[1])/(e[1]-t[1]+e[3]-t[3]):i===2?r=(t[3]-t[0])/(e[0]-t[0]-e[3]+t[3]):i===3&&(r=(t[3]-t[1])/(e[1]-t[1]-e[3]+t[3])),gG(ci(),t,e,r)}const p7=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Vl=dn(),AFt=ke(),Pd=cN(),GE=new SFt,PFt=new EFt,nee=new CFt;let OFt=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new ml(new ArrayBuffer(4)),this._layerToOidToColor=new Db,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Db,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,i,r,s,n,o=null,a=null,l=null){e&&i&&r&&s&&(this._layerUidToId.set(s,r),this._layerUidToPopupEnabled.set(s,n),n&&this._layerUidToGraphicsUidToObjectId.set(s,i,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l}))}getObjectAndLayerIdColor(e){const i=this.getObjectAndLayerIdColorArray(e);return ii(i.get(0,1),i.get(0,2),i.get(0,3),255)}getObjectAndLayerIdColorArray(e){var o;if(!e.layerUid||!e.graphicUid)return this.colorZero;const i=this._layerUidToPopupEnabled.get(e.layerUid);if(i===void 0)return this.colorZero;if(i===!1)return this.colorZero;const r=(o=this._layerUidToGraphicsUidToObjectId.get(e.layerUid,e.graphicUid))==null?void 0:o.objectId;if(!r)return this.colorZero;let s=this._layerToOidToColor.get(e.layerUid,r);if(!s){for(;!s;){const a=Math.floor(16777214*Math.random())+1;this._colorToUID.has(a)||(s=a)}if(s>16777215)throw new Error("Object ID Overflow");this._layerToOidToColor.set(e.layerUid,r,s),this._colorToUID.set(s,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new ml(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[i,r]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(r.layerUid,r.graphicUid),n=this._layerUidToId.get(r.layerUid);s&&n&&e.set(i,s.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:s.objectId,lid:n,attrId:s.attributeNodeId,attrIdx:s.attributeIndex,subLayerId:s.subLayerId}:{type:"object-and-layer-id",oid:s.objectId,lid:n})}return e}};var I1,jT;(function(t){t.OPAQUE="opaque-color",t.TRANSPARENT="transparent-color",t.COMPOSITE="composite-color",t.FINAL="final-color"})(I1||(I1={})),function(t){t.ANTIALIASING="aa-color",t.HIGHLIGHTS="highlight-color",t.MAGNIFIER="magnifier-color"}(jT||(jT={}));let JUe=class{constructor(e,i){this.key=e,this.free=i,this.incarnation=0,this._refCount=1}retain(e=1){this._refCount+=e}release(){return this._refCount===0?(console.log(`Releasing already released FBO attachment in ${new Error().stack}`),!0):(--this._refCount,this._refCount===0&&(this.free(),!0))}};var AP;(function(t){t[t.FBO=0]="FBO",t[t.DEPTH=1]="DEPTH",t[t.COLOR=2]="COLOR"})(AP||(AP={}));let QUe=class extends JUe{constructor(e,i,r){super(e,r),this.attachment=i,this.name=""}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.usedMemory}},RFt=class extends QUe{constructor(e,i,r){super(e,i,r),this.attachment=i,this.type=AP.COLOR}},Hve=class extends QUe{constructor(){super(...arguments),this.type=AP.DEPTH}};function $Ft(t){return(t==null?void 0:t.attachment.type)===p_.Texture}let KUe=class extends JUe{constructor(e,i,r,s,n,o){super(e,o),this.type=AP.FBO,this._colors=new Map,this._name="composite-color",this.acquireDepth=null,this.acquireColor=null,this._name=i,this.fbo=r,this.acquireDepth=s,this.acquireColor=n}dispose(){var e;(e=this.fbo)==null||e.dispose()}get usedMemory(){var e;return((e=this.fbo)==null?void 0:e.usedMemory)||0}get name(){return this._name}setName(e){this._name=e}getTexture(e=Gn.COLOR_ATTACHMENT0){var i,r;return e===cP?(i=this.fbo)==null?void 0:i.depthStencilTexture:(r=this.fbo)==null?void 0:r.getColorTexture(e)}getAttachment(e=Gn.COLOR_ATTACHMENT0){return e===cP?this._depth:this._colors.get(e)}attachDepth(e){var i;return e==null||e.retain(),this.detachDepth(),e&&((i=this.fbo)==null||i.attachDepthStencil(e.attachment)),this._depth=e,this}detachDepth(){var e,i;(e=this.fbo)==null||e.detachDepthStencilTexture(),(i=this.fbo)==null||i.detachDepthStencilBuffer(),this._depth=hi(this._depth)}obtainDepthTexture(){var i;const e=this._depth;return $Ft(e)?((i=this.fbo)==null||i.detachDepthStencilTexture(),this._depth=null,e):null}attachColor(e,i){var r;return e.retain(),this.detachColor(i),(r=this.fbo)==null||r.attachColorTexture(e.attachment,i),this._colors.set(i,e),this}detachColor(e){var r;(r=this.fbo)==null||r.detachColorTexture(e);const i=this._colors.get(e);this._colors.delete(e),i==null||i.release()}detachAll(){this._colors.forEach((e,i)=>this.detachColor(i)),this.detachDepth()}},f7=class{constructor(e,i){this._last=new ai,this._incarnation=0,this._cache=new oN(e,i)}destroy(){var e;(e=this._last)==null||e.forAll(i=>i.dispose()),this._last=null,this._cache.destroy()}set interactive(e){var i;e&&!this._last?this._last=new ai:e||((i=this._last)==null||i.forAll(r=>r.dispose()),this._last=null)}clean(){var e;(e=this._last)==null||e.filterInPlace(i=>!(i.incarnation<this._incarnation)||(this._cache.put(i.key,i),!1))}frame(){++this._incarnation}pop(e){if(this._last){const i=this._last.find(r=>r.key===e);if(i)return this._last.removeUnordered(i),i}return this._cache.pop(e)}put(e){e.incarnation=this._incarnation,this._last?this._last.push(e):this._cache.put(e.key,e)}get usedMemory(){var e;return((e=this._last)==null?void 0:e.reduce((i,r)=>i+r.usedMemory,0))??0}},IFt=class{constructor(e){this.rctx=e,this._acquired=new Set,this._cache=new f7(e.newCache,"FBOCache"),this._depthCache=new f7(e.newCache,"DepthAttachmentCache"),this._colorCache=new f7(e.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy(),this._depthCache.destroy(),this._colorCache.destroy()}clean(){this._cache.clean(),this._colorCache.clean(),this._depthCache.clean()}frameStart(){this._cache.frame(),this._colorCache.frame(),this._depthCache.frame(),this.debugCallback&&this.debugCallback()}frameEnd(){const e=this.debugCallback;e&&this._acquired.forEach(i=>i.type===AP.FBO&&e(i.name,i.fbo))}get usedMemory(){return Array.from(this._acquired.values()).reduce((e,i)=>{var r;return e+("getTexture"in i?((r=i.getTexture())==null?void 0:r.usedMemory)??0:i.usedMemory)},this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(e){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=e}acquire(e,i,r,s=ss.RGBA){const n=m7(s,e,i);let o=this._cache.pop(n);if(o){o.retain(),o.setName(r);const a=this.rctx.getBoundFramebufferObject();this.rctx.bindFramebuffer(o.fbo),this.rctx.setDrawBuffers([Gn.COLOR_ATTACHMENT0]),this.rctx.bindFramebuffer(a)}else o=new KUe(n,r,new wy(this.rctx,{...qve[s],width:e,height:i}),a=>{a??(a=Oo.DEPTH_STENCIL_TEXTURE);const l=this._acquireDepth(a,o.fbo.width,o.fbo.height,`${o.name} depth`);return o.attachDepth(l),l.release(),o},(a,l)=>{l??(l=ss.RGBA);const c=this._acquireColor(l,e,i,`${o.name} color ${a}`);return o.attachColor(c,a),c.release(),o},()=>{this.debugCallback&&this.debugCallback(o.name,o.fbo),this._acquired.delete(o),o.detachAll(),this._cache.put(o)});return this._trackHandle(o)}acquireDepth(e,i,r,s){return this._acquireDepth(e,i,r,s)}_acquireDepth(e,i,r,s){const n=m7(e,i,r),o=this._depthCache.pop(n);if(o)return o.retain(),o.name=s,this._trackHandle(o);const a=e===Oo.DEPTH_STENCIL_TEXTURE?new Hve(n,new Er(this.rctx,{...Wve[e],width:i,height:r}),()=>{this._acquired.delete(a),this._depthCache.put(a)}):new Hve(n,new w$e(this.rctx,{...Wve[e],width:i,height:r}),()=>{this._acquired.delete(a),this._depthCache.put(a)});return a.name=s,this._trackHandle(a)}_acquireColor(e,i,r,s){const n=m7(e,i,r),o=this._colorCache.pop(n);if(o)return o.retain(),o.name=s,this._trackHandle(o);const a=new RFt(n,new Er(this.rctx,{...qve[e],width:i,height:r}),()=>{this._acquired.delete(a),this._colorCache.put(a)});return a.name=s,this._trackHandle(a)}_trackHandle(e){return this._acquired.add(e),e}};const WL=new KUe("default","default",null,()=>WL,()=>WL,()=>{});function m7(t,e,i){return`${t}x${e}x${i}`}const HU=new Xr;HU.pixelFormat=Ht.RED,HU.internalFormat=xt.R8,HU.wrapMode=Mi.CLAMP_TO_EDGE;const qU=new Xr;qU.pixelFormat=Ht.RG,qU.internalFormat=xt.RG8,qU.wrapMode=Mi.CLAMP_TO_EDGE;const WU=new Xr;WU.internalFormat=xt.RGBA4,WU.dataType=fl.UNSIGNED_SHORT_4_4_4_4,WU.wrapMode=Mi.CLAMP_TO_EDGE;const eVe=new Xr;eVe.wrapMode=Mi.CLAMP_TO_EDGE;const vI=new Xr;vI.wrapMode=Mi.CLAMP_TO_EDGE,vI.samplingMode=di.LINEAR_MIPMAP_LINEAR,vI.hasMipmap=!0,vI.maxAnisotropy=8;const bI=new Xr;bI.pixelFormat=Ht.RED,bI.dataType=fl.HALF_FLOAT,bI.internalFormat=xt.R16F,bI.samplingMode=di.NEAREST;const ZU=new Xr;ZU.dataType=fl.HALF_FLOAT,ZU.internalFormat=xt.RGBA16F,ZU.samplingMode=di.NEAREST;const qve={[ss.RED]:HU,[ss.RG]:qU,[ss.RGBA4]:WU,[ss.RGBA]:eVe,[ss.RGBA_MIPMAP]:vI,[ss.R16F]:bI,[ss.RGBA16F]:ZU},wI=new Xr;wI.pixelFormat=Ht.DEPTH_STENCIL,wI.dataType=fl.UNSIGNED_INT_24_8,wI.samplingMode=di.NEAREST,wI.wrapMode=Mi.CLAMP_TO_EDGE;const Wve={[Oo.DEPTH_STENCIL_TEXTURE]:wI,[Oo.DEPTH16_BUFFER]:new b$e(Ea.DEPTH_COMPONENT16,4)};var ZL;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(ZL||(ZL={}));let Hy=class{constructor(e,i,r=ZL.FrontToBack){this._rctx=e,this._techniques=i,this._sorting=r,this._draws=new ai({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,i,r,s){const n=this._draws.pushNew();n.geometry=i,n.geometryRanges=r,n.material=e,n.depthSquaredHint=s,n.indexType=(i.indexed?i.vao.indexBuffer.indexType:null)??0}prepare(e,i){return this._draws.map(r=>r.material.prepareTechnique(this._techniques,e,i,r.geometry.parameters))}dispatch(e,i,r){const s=this._rctx;this._previouslyBoundDraw.clear();let n=null;const o=this._draws.length;for(let a=0;a<o;a++){const l=r[a];l===n&&l.configuration.transparencyPassType===pt.NONE||(s.bindTechnique(l,i,e),n=l);const c=this._draws.data[a],u=c.geometry;s.bindVAO(u.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,i,e),this._previouslyBoundDraw.set(l,c.material));const d=c.geometryRanges,f=d.length;if(c.indexType!==0){const m=YU.get(c.indexType);for(let g=0;g<f;g+=2){const y=d[g],v=d[g+1];s.drawElements(u.primitiveType,v,c.indexType,y*m)}}else for(let m=0;m<f;m+=2){const g=d[m],y=d[m+1];s.drawArrays(u.primitiveType,g,y)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===ZL.FrontToBack?1:-1;this._draws.sort((i,r)=>{const s=e*(i.depthSquaredHint-r.depthSquaredHint);return s!==0?s:i.geometry.vao.byteSize-r.geometry.vao.byteSize})}get count(){return this._draws.length}};const YU=new Map;YU.set(St.UNSIGNED_BYTE,1),YU.set(St.UNSIGNED_SHORT,2),YU.set(St.UNSIGNED_INT,4);let oee=class extends mdt{constructor(){super({}),this._passes=null,this.produces=new Map([[Pe.OPAQUE_MATERIAL,e=>this._produces(e)],[Pe.TRANSPARENT_MATERIAL,e=>!!(this._passes&&this._passes.materialTransparent.count>0)&&this._produces(e)],[Pe.INTEGRATED_MESH,e=>this._produces(e)]]),this._materialPassParameters=new b1t,this._shadowPassParameters=new w1t,this._highlightPassParameters=new x1t,this._viewshedPassParameters=new T1t,this._systems=new Set}initializeRenderContext(e){this._context=e;const i=e.renderContext.rctx,r=e.techniques;this._passes={materialOpaque:new Hy(i,r),materialTransparent:new Hy(i,r,ZL.BackToFront),materialIntegratedMesh:new Hy(i,r),shadowMap:new Hy(i,r),highlight:new Hy(i,r),highlightIntegratedMesh:new Hy(i,r),highlightShadowMap:new Hy(i,r),viewshedShadowMap:new Hy(i,r),defaultShadowMap:new Hy(i,r)}}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}_produces(e){return this._systems.size!==0&&this._passes!==null&&(e===j.Highlight?this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0:e!==j.ShadowHighlight||this._passes.highlight.count>0)}prepareRender(e){if(this._systems.size!==0&&this._passes!==null){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,e.bindParameters));for(const i of Object.values(this._passes))i.finishSubmit();this._context.techniques.frameUpdate()}}prepareTechniques(e){if(this._systems.size===0)return null;const i=e.output===j.Shadow||e.output===j.ShadowHighlight||e.output===j.ShadowExcludeHighlight?this._shadowPassParameters:e.output===j.ViewshedShadow?this._viewshedPassParameters:e.output===j.Highlight?this._highlightPassParameters:this._materialPassParameters,r=e.bindParameters;return this._updateParameters(r.camera,i,r.slot===Pe.TRANSPARENT_MATERIAL),this._materialPassParameters.output=e.output,this._invoke(e,(s,n)=>s.prepare(n,e.bindParameters))}renderNode(e,i){this._invoke(e,(r,s)=>r.dispatch(s,e.bindParameters,i))}_invoke(e,i){if(this._passes===null)return null;switch(e.bindParameters.slot){case Pe.OPAQUE_MATERIAL:switch(e.output){case j.Color:case j.Depth:case j.Normal:case j.ObjectAndLayerIdColor:return i(this._passes.materialOpaque,this._materialPassParameters);case j.Highlight:return i(this._passes.highlight,this._highlightPassParameters);case j.Shadow:return i(this._passes.shadowMap,this._shadowPassParameters);case j.ShadowHighlight:return i(this._passes.highlightShadowMap,this._shadowPassParameters);case j.ShadowExcludeHighlight:return i(this._passes.defaultShadowMap,this._shadowPassParameters);case j.ViewshedShadow:return i(this._passes.viewshedShadowMap,this._viewshedPassParameters)}break;case Pe.TRANSPARENT_MATERIAL:switch(e.output){case j.Color:case j.Depth:case j.Normal:case j.ObjectAndLayerIdColor:return i(this._passes.materialTransparent,this._materialPassParameters)}break;case Pe.INTEGRATED_MESH:switch(e.output){case j.Color:case j.Depth:case j.Normal:case j.ObjectAndLayerIdColor:return i(this._passes.materialIntegratedMesh,this._materialPassParameters);case j.Highlight:return i(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(e){const i=new $ae;return this._systems.forEach(r=>MP(i,r.queryShadowCasterDepthRange(e))),i}_updateParameters(e,i,r){const s=e.viewInverseTransposeMatrix;de(g7,s[3],s[7],s[11]),y7.set(g7),ve(i.transformWorldFromViewTH,y7.high),ve(i.transformWorldFromViewTL,y7.low),ve(i.slicePlaneLocalOrigin,g7),lp(i.transformViewFromCameraRelativeRS,e.viewMatrix),xn(i.transformProjFromView,e.projectionMatrix),i.identifier===Gl.Material&&(this._materialPassParameters.transparent=r,x2(Zve,i.transformViewFromCameraRelativeRS),ED(i.transformNormalViewFromGlobal,Zve))}};oee=h([I("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],oee);const g7=E(),Zve=Yr(),y7=new pUe;function _5(t){return t.name}let LFt=class{constructor(e){this._context=e,this._nodes=new ai}destroy(){this._nodes.forEach(e=>e.destroy()),this._nodes.clear()}add(e){this._nodes.push(e),qz&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:i})=>i).join(", ")}`)}remove(e){this._nodes.remove(e),qz&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:i})=>i).join(", ")}`)}produces(e){return this._nodes.some(({produces:i})=>i===e)}require(e,...i){const r=this._nodes;return i.reduce((s,n)=>s+r.reduce((o,{consumes:a,produces:l})=>o+(a.required.includes(e)&&l===n?1:0),0),0)}optional(e,...i){const r=this._nodes;return i.reduce((s,n)=>s+r.reduce((o,{consumes:a,produces:l})=>{var c;return o+((c=a.optional)!=null&&c.includes(e)&&l===n?1:0)},0),0)}updateAnimation(){return this._nodes.reduce((e,i)=>i.updateAnimation()||e,!1)}render(e,i,r=()=>{}){const s=_5(e)?e.name:e,n=this._nodes.filter(({produces:o})=>o===s);return n.length===0||(n.forEach(o=>{const a=_5(e)?[e]:[];for(const l of o.consumes.required){if(l===s)continue;const c=i.get(l);if(!c)return void(r&&r(a));a.push(c)}if(o.consumes.optional)for(const l of o.consumes.optional){if(l===s)continue;const c=i.get(l);c&&a.push(c)}try{const l=o.doRender(a,this._context);l&&l!==e&&(_5(e)?(e.release(),e=l,i.set(s,e)):e=l)}catch(l){se.getLogger(o).errorOnce(l)}r&&r(a)}),this._context.rctx.enforceState()),_5(e)?e:WL}},DFt=class{constructor(e){this._context=e,this._renderPlugins=new ai,this._materialRenderers=new Map,this._slots=new Array,this._renderVersion=Ug(0);for(let i=0;i<Pe.MAX_SLOTS;++i)this._slots[i]=[]}destroy(){this._renderPlugins.forEach(e=>e.destroy()),this._renderPlugins.clear(),this._materialRenderers.clear()}get plugins(){return this._renderPlugins}add(e,i){const r=()=>{if(i!=null&&i.aborted)throw e.uninitializeRenderContext(),ki();this._renderPlugins.push(e),e.materialReference&&this._materialRenderers.set(e.materialReference,e),e.produces.forEach((n,o)=>{this._slots[o].push(e)}),this._context.requestRender(),this._renderVersion.value++},s=e.initializeRenderContext(this._context,i);if(Fu(s))return s.then(r);r()}remove(e){if(e.materialReference!=null&&this._materialRenderers.delete(e.materialReference),this._renderPlugins.removeUnordered(e)!=null){for(let i=0;i<this._slots.length;++i)this._slots[i]=this._slots[i].filter(r=>r!==e);e.uninitializeRenderContext(),this._context.requestRender(),this._renderVersion.value++}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let i=!1;return this._renderPlugins.forAll(r=>{r.updateAnimation&&(i=r.updateAnimation(e)||i)}),i}renderFeatureChanged(){this._renderPlugins.forAll(e=>{e.renderFeatureChanged&&e.renderFeatureChanged()})}prepare(...e){for(const i of e)this._context.renderContext.bindParameters.slot=i,this._slots[i].forEach(r=>{const s=r.produces.get(i);s!=null&&s(j.Color)&&(vQ(r)&&r.prepareTechnique(this._context.renderContext),afe(r)&&r.prepareTechniques(this._context.renderContext))})}_getRenderables(){const e=this._context.renderContext.bindParameters.slot,i=this._context.renderContext.output??j.Color,r=new Map;return this._slots[e].forEach(s=>{const n=s.produces.get(e);if(n!=null&&n(i)&&(!s.isDecoration||this._context.renderContext.bindParameters.decorations!==Zl.OFF))if(vQ(s)){const o=s.prepareTechnique(this._context.renderContext);o!=null&&r.set(s,o)}else if(afe(s)){const o=s.prepareTechniques(this._context.renderContext);o!=null&&r.set(s,o)}else r.set(s,null)}),r}render(e,...i){for(const r of i)this._context.renderContext.bindParameters.slot=r,this._getRenderables().forEach((s,n)=>n.renderNode(this._context.renderContext,s,e))}queryDepthRange(e){const i=new $ae;return this._renderPlugins.forAll(r=>{var n;const s=(n=r.queryDepthRange)==null?void 0:n.call(r,e);MP(i,s)}),i}get updating(){return this._renderVersion.value>=0&&this._renderPlugins.some(e=>e.running)}produces(e,...i){for(const r of i)if(this._slots[r].some(s=>{const n=s.produces.get(r);return!!n&&n(e)}))return!0;return!1}consumes(e){return this._renderPlugins.some(i=>i.consumes().required.includes(e))}getMaterialRenderer(e){return this._materialRenderers.get(e)}removeEmptyMaterialRenderers(){this._renderPlugins.filterInPlace(e=>!e.materialReference||e.numGeometries!==0||(this._materialRenderers.delete(e.materialReference),e.destroy(),!1))}get hasDecorations(){return this._renderPlugins.some(e=>e.isDecoration)}get hasOccludees(){return this._renderPlugins.some(e=>e.hasOccludees)}get renderOccludedFlags(){return this._renderPlugins.reduce((e,i)=>e|i.renderOccludedFlags,er.None)}get usedMemory(){return this._renderPlugins.reduce((e,i)=>i.materialReference!==null?e:e+(i.usedMemory??0),0)}get test(){}},NFt=class{constructor(e){this.techniques=e,this._blitConfiguration=new I3,this._blitParameters=new tH}render(e,i,r,s,n){e.bindFramebuffer(r.fbo);const o=this.techniques.acquire(Uae,this._blitConfiguration);return e.setClearColor(0,0,0,1),e.clear(zr.COLOR_BUFFER_BIT),o!=null&&o.compiled?(this._blitParameters.texture=i.getTexture(),e.bindTechnique(o,s,this._blitParameters),e.screen.draw(),o.release(),r):(n(ar.UPDATE),r)}},FFt=class{constructor(){this._step=Jve,this._dilation=1,this._firstIdleTime=0}frame(e,i){if(i?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,le("disable-feature:high-quality-idle"))this._dilation=1;else{const s=i?performance.now()-this._firstIdleTime:0;if(s>=Yve+UFt)return this._step=1/0,void(this._dilation=1);this._dilation=s>=Yve?VFt:1}const r=Ne(e/kFt,Jve,BFt);this._step===1/0?this._step=r:this._step=this._step*Xve+r*(1-Xve)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const kFt=.5,Yve=12e4,UFt=1e4,VFt=10,Xve=.9,zFt=30,Jve=1e3/1,BFt=1e3/zFt;let jFt=class{constructor(e,i){this._fbos=e,this.compositingHelper=i,this._width=4,this._height=4,this._clearColor=ci()}dispose(){this._color=hi(this._color),this.releaseBuffers()}get framebuffer(){return this.color.attachDepth(this.depth),this.color.fbo}get colorTexture(){return this.color.getTexture()}get depthTexture(){return this.depth.attachment}initializeFrame(e,i,r){this._fbos.interactive=r===pf.Default;const s=this._fbos.rctx;this._width=e.fullWidth,this._height=e.fullHeight,FT(this,s.parameters.maxTextureSize);const n=this._color;return this._color=null,this.releaseBuffers(),Hd(this._clearColor,i),n}releaseBuffers(){var e;(e=this._color)==null||e.detachDepth(),this._depth=hi(this._depth)}renderHUDVisibility(e,i,r){var s,n;return((s=e==null?void 0:e.fbo)==null?void 0:s.width)===this._width&&((n=e==null?void 0:e.fbo)==null?void 0:n.height)===this._height||(e==null||e.release(),e=this._fbos.acquire(this._width,this._height,"hud visibility",ss.RGBA4)),e.attachDepth(r||this.depth),this._fbos.rctx.bindFramebuffer(e.fbo),this._fbos.rctx.clearFramebuffer(GFt),i(),e.detachDepth(),e}compositeToHUDVisibility(e,i){var r;this._fbos.rctx.bindFramebuffer((r=e.hudVisibility)==null?void 0:r.fbo),this.compositingHelper.compositeHUD(e,i)}renderOITPass(e,i,r){let s,n;const{_width:o,_height:a}=this;switch(i){case pt.ColorAlpha:s=this._fbos.acquire(o,a,r?"oit hud color alpha":"oit color alpha",ss.RGBA16F),s.acquireColor(Gn.COLOR_ATTACHMENT1,ss.R16F),n=[0,0,0,1];break;case pt.FrontFace:s=this._fbos.acquire(o,a,r?"oit hud front":"oit front"),n=[0,0,0,0]}return r?s.acquireDepth(Oo.DEPTH16_BUFFER):s.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(s.fbo),this._fbos.rctx.clearFramebuffer(n,r,r),e(),s.detachDepth(),s}compositeToFramebuffer(e,i,r,s){this.bindFbo(),this.compositingHelper.composite(e,i,r,s)}compositeOIT(e,i,r,s){s?(this._fbos.rctx.bindFramebuffer(s.fbo),this._fbos.rctx.setClearColor(0,0,0,1e-13),this._fbos.rctx.clear(zr.COLOR_BUFFER_BIT)):this.bindFbo(),this.compositingHelper.compositeOIT(e,i.getTexture(),i.getTexture(Gn.COLOR_ATTACHMENT1),r.getTexture())}renderDepthDetached(e){this._bindTarget(this.color),e(),this._bindTarget(this.color,this.depth)}renderToCachedFBO(e,i,r,s,n=ss.RGBA,o=Oo.DEPTH16_BUFFER,a=this._width,l=this._height,c=null){var u,d;return((u=e==null?void 0:e.fbo)==null?void 0:u.width)===a&&((d=e==null?void 0:e.fbo)==null?void 0:d.height)===l||(e=hi(e)),e=e??this._fbos.acquire(a,l,i,n),c==null||c.forEach(f=>e.acquireColor(f.attachment,f.format)),o!=null&&e.acquireDepth(o),this._fbos.rctx.bindFramebuffer(e.fbo),this._fbos.rctx.clearFramebuffer(s,!0,!0),r(),e}renderToTargets(e,i,r,s,n=!1,o=!1){this._bindTarget(i,r),this._fbos.rctx.clearFramebuffer(s,n,o),e(),i.detachDepth()}bindFbo(){const e=this._color==null;if(this._bindTarget(this.color,this.depth),e){const i=this._fbos.rctx;i.setClearStencil(0),i.setClearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),i.clear(zr.COLOR_BUFFER_BIT|zr.DEPTH_BUFFER_BIT|zr.STENCIL_BUFFER_BIT)}}_bindTarget(e,i){e.attachDepth(i),this._fbos.rctx.bindFramebuffer(e.fbo)}get width(){return this._width}get height(){return this._height}get color(){return this._ensureColor()}_ensureColor(){return this._color||(this._color=this._fbos.acquire(this._width,this._height,"composite-color")),this._color}updateColor(e){const i=this._ensureColor();i.attachDepth(this.depth),this._color=e(i)}get depth(){return this._depth||(this._depth=this._fbos.acquireDepth(Oo.DEPTH_STENCIL_TEXTURE,this._width,this._height,"depth")),this._depth}};const GFt=[0,1,0,1];let HFt=class{constructor(){this._inputs=new Map}set(e,i){this._inputs.set(e,i)}get(e){return this._inputs.get(e)}has(e){return this._inputs.has(e)}release(e){var i;(i=this._inputs.get(e))!=null&&i.release()&&this._inputs.delete(e)}};const uN=255,qFt=1/uN;function tVe(t){const e=new Hi,i=e.fragment;return i.include(rm),i.include(fy),e.include(XD),e.include(ka),e.include(KD,t),i.uniforms.add(new wt("shadowMap",(r,s)=>s.shadowMap.depthTexture),new wt("depthMap",(r,s)=>{var n;return(n=s.depth)==null?void 0:n.attachment}),new us("inverseViewMatrix",(r,s)=>Zn(Qve,dl(Qve,s.camera.viewMatrix,s.camera.center)))),i.constants.add("sampleValue","float",qFt),e.outputs.add("sampleCount","float"),i.code.add(T`void main(void) {
float depth = depthFromTexture(depthMap, uv);
if (depth >= 1.0 || depth <= 0.0) {
discard;
}
float currentPixelDepth = linearizeDepth(depth);
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
ivec2 texSize = textureSize(shadowMap, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMap);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
sampleCount = sampleValue;
}`),e}const Qve=ke(),WFt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:uN,build:tVe},Symbol.toStringTag,{value:"Module"}));var PP;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(PP||(PP={}));let aee=class extends tc{constructor(){super(...arguments),this.visualization=PP.Gradient,this.bandsEnabled=!1}};h([B({count:PP.COUNT})],aee.prototype,"visualization",void 0),h([B()],aee.prototype,"bandsEnabled",void 0);let jae=class extends Fr{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=xD(ZFt),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const ZFt=ii(.01,0,.25,1);function iVe(t){const e=new Hi,i=e.fragment;i.include(rm),i.include(Use),e.include(XD),e.include(ka);const{visualization:r,bandsEnabled:s}=t;i.constants.add("inverseSampleValue","float",uN),i.uniforms.add(new wt("shadowCastMap",a=>a.shadowCastMap),new et("sampleScale",a=>a.sampleScale),new et("opacityFromElevation",a=>a.opacityFromElevation),new ji("uColor",a=>a.color));const n=r===PP.Gradient,o=r===PP.Threshold;return n&&s?i.uniforms.add(new et("bandSize",a=>a.bandSize)):o&&i.uniforms.add(new et("threshold",a=>a.threshold)),i.code.add(T`
    void main(void) {
      float record = texture(shadowCastMap, uv).r;
      float pixelSamples = record * inverseSampleValue;
      if (pixelSamples < 1.0) {
        discard;
      }

      float strength = pixelSamples * sampleScale;

      ${o?T`
          if (strength <= threshold) {
            discard;
          }`:""}

      ${n&&s?T`strength = ceil(strength / bandSize) * bandSize;`:""}

      fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?T`* strength`:""});
    }
  `),e}const YFt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:jae,build:iVe},Symbol.toStringTag,{value:"Module"}));let rVe=class sVe extends Qi{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new Ki(e.rctx,sVe.shader.get().build(this.configuration),Ai)}initializePipeline(){return Jt({blending:Ru,colorWrite:ui,depthTest:null,depthWrite:null})}get primitiveType(){return Ci.TRIANGLE_STRIP}};rVe.shader=new qi(YFt,()=>ce(()=>Promise.resolve().then(()=>qHt),void 0));const XFt=4e4,JFt=5e4,nVe=1/512;let XU=class extends Ue{constructor(e,i,r,s){super({}),this._techniques=e,this._rctx=i,this._data=r,this._requestRender=s,this._passParameters=new jae(this._data),this._techniqueConfig=new aee,this._enabled=!1,this._vao=vy(i)}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=Ut(this._vao),this._techniques.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniques.releaseAndAcquire(rVe,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const i=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(i,e,this._passParameters),this._rctx.drawArrays(i.primitiveType,0,J0(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>nVe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniques.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniques.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const i=this._passParameters.color;YM(e,i)||(Hd(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};h([p()],XU.prototype,"opacityFromElevation",null),XU=h([I("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],XU);let oVe=class aVe extends Qi{constructor(e){super(e,new Fae,()=>this.destroy())}initializeProgram(e){return new Ki(e.rctx,aVe.shader.get().build(this.configuration),Ai)}initializePipeline(){return Jt({blending:ua(Be.ONE,Be.ONE,Be.ONE,Be.ONE),colorWrite:ui,depthTest:null,depthWrite:null})}get primitiveType(){return Ci.TRIANGLE_STRIP}};oVe.shader=new qi(WFt,()=>ce(()=>Promise.resolve().then(()=>WHt),void 0));let wc=class extends Ue{constructor(e,i,r,s,n,o){super({}),this.fbos=e,this._stage=r,this._prepareForShadowMapPass=s,this._renderToShadowMap=n,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new uoe,this._cachedLightDirections=[],this._depthRange=QK,this._previewing=!1,this._cameraForcedForScreenshot=!1,this._shadowAccumulatorKey="shadowAccumulator",this._rctx=e.rctx,this._bindParameters=new YG(new Roe(e,r.viewingMode),null),this._bindParameters.shadowMap.enabled=!0,this._vao=vy(this._rctx),this._accumulationRenderer=new XU(i,this._rctx,this,o);const a=this._stage.view.resourceController.scheduler;this.addHandles([a.registerTask(It.SHADOW_ACCUMULATOR,this),te(()=>r.renderView,l=>{this.removeHandles(Kve),l!=null&&this.addHandles(l.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),Kve)},hr),te(()=>this._previewing,()=>this._requestRenderIfEnabled(),or)],this._shadowAccumulatorKey)}normalizeCtorArgs(){return{}}dispose(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=Ut(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Ut(this._fbo),this._vao=Ut(this._vao),this._accumulationTechniqueCached=hi(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new oVe(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){return this._bindParameters.depth!=null&&this._depthRange!==QK&&this._opacityFromElevation>nVe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const i=this._cachedLightDirections;if(db(i,e,US))return;const r=Math.min(uN,e.length);i.length=r,this._sampleCount=r;for(let s=0;s<r;++s)i[s]=ve(i[s]??E(),e[s]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,i,r,s){if(this._depthRange=i,this._updateCamera(r),this._bindParameters.contentCamera=s,this._bindParameters.depth=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return!1;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(QFt,this._sampleCount-this._progress);for(let o=0;o<n;++o)this._accumulateShadow();return this._cameraForcedForScreenshot=!1,this._requestRender(),n>0}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const i=this._fbo!=null;e.enabled!==i&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,i){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||i<0||i>=this._fbo.height?0:(this._fbo.readPixels(e,i,1,1,Ht.RGBA,fl.UNSIGNED_BYTE,e1e),e1e[0]/this._progress)}_enable(){this._progress=0;const e=new Xr;e.pixelFormat=Ht.RED,e.internalFormat=xt.R8,e.wrapMode=Mi.CLAMP_TO_EDGE,this._fbo=new wy(this._rctx,e),this._requestRender()}_disable(){this._fbo=Ut(this._fbo),this._requestRender()}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clear(zr.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._bindParameters,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,J0(this._vao,"geometry"))}_updateCamera(e){const i=this._fbo;if(i==null)return;const r=this._bindParameters.camera;e.equals(r)||r.copyFrom(e),i.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-sL(XFt,JFt,e.relativeElevation)}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){}};h([p()],wc.prototype,"_progress",void 0),h([p()],wc.prototype,"_sampleCount",void 0),h([p()],wc.prototype,"_fbo",void 0),h([p()],wc.prototype,"_depthRange",void 0),h([p()],wc.prototype,"_previewing",void 0),h([p()],wc.prototype,"_accumulationRenderer",void 0),h([p()],wc.prototype,"_isRefining",null),h([p()],wc.prototype,"_isActive",null),h([p()],wc.prototype,"canAccumulate",null),h([p()],wc.prototype,"_isDoneAccumulating",null),h([p()],wc.prototype,"_opacityFromElevation",null),h([p()],wc.prototype,"running",null),wc=h([I("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],wc);const QFt=6,Kve="renderView",e1e=new Uint8Array(4),t1e=T_();let KFt=class{constructor(){this._plane=T_()}get isEnabled(){return!lAe(this.plane,t1e)}get plane(){return this._plane}set plane(e){b2(e||t1e,this._plane)}},e1=class extends Dr{constructor(){super(...arguments),this.sectionAngles=ci()}get sectionAnglesDeg(){return dL(this.sectionAngles.map(e=>La(e)))}set sectionAnglesDeg(e){this.sectionAngles=dL(e.map(i=>kt(i)))}get projectionMatrix(){const e=ke();return aL(e,this.sectionMatrix,this._projectionMatrixInternal)}get sectionMatrix(){const e=this.sectionAngles[0],i=this.sectionAngles[1],r=this.sectionAngles[2],s=this.sectionAngles[3];vt(e<=i),vt(r<=s);const n=2*Math.tan(this.fovX/2),o=2*Math.tan(this.fovY/2),a=Math.tan(e),l=Math.tan(i),c=Math.tan(r),u=l-a,d=Math.tan(s)-c,f=n/u,m=o/d,g=-(a+u/2)/n*2,y=-(c+d/2)/o*2,v=ke();g2(v,[g,y,0]);const b=ke();AEe(b,[f,m,1]);const w=ke();return aL(w,b,v)}get _sectionRatioX(){const e=Math.tan(this.sectionAngles[0]),i=Math.tan(this.sectionAngles[1]),r=2*Math.tan(this.fovX/2);return Math.min(1,(i-e)/r)}setViewport(e,i){const r=i*this._sectionRatioX;return this.viewport=[e[0],e[1],r,i],r}};h([p()],e1.prototype,"sectionAngles",void 0),h([p()],e1.prototype,"sectionAnglesDeg",null),h([p()],e1.prototype,"projectionMatrix",null),h([p()],e1.prototype,"sectionMatrix",null),h([p()],e1.prototype,"_sectionRatioX",null),e1=h([I("esri.views.3d.webgl-engine.lib.ViewshedFaceCamera")],e1);let e4t=class{constructor(){this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.textureSizeMultiple=128,this.toleranceSides=5,this.toleranceBottomTop=10}textureSizeModifier(e){return e?this.textureSizeModHighQuality:this.textureSizeModLowQuality}textureResizeModulo(e){return Math.ceil(e/this.textureSizeMultiple)*this.textureSizeMultiple}};const _7=["front","left","right","back","top","bottom"];function t4t(t){return!["top","bottom"].includes(t)}let i4t=class{constructor(e){this._fbos=e,this._enabled=!1,this._faces={},this._textureWidth=0,this._textureHeight=0,this.settings=new e4t,this._maxTextureWidth=Math.min(le("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}get depthTexture(){var e;return(e=this._handle)==null?void 0:e.getTexture()}get enabled(){return this._enabled}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get isTextureZero(){return this._textureWidth===0||this._textureHeight===0}get nearFar(){const e=this.faces;return e.length===0?null:e[0].nearFar}get numActiveFaces(){const e=this._faces;let i=0;return Object.keys(e).forEach(r=>{e[r]&&(i+=1)}),i}get faces(){const e=this._faces,i=[];for(const r of _7){const s=e[r];s&&i.push(s)}return i}get atlasRegions(){return this.faces.map(e=>[e.x/this._textureWidth,(e.x+e.width)/this._textureWidth,e.y/this._textureHeight,(e.y+e.height)/this._textureHeight])}get viewshedProjectionMatrices(){return this.faces.map(e=>e.projectionMatrix)}get viewshedViewMatrices(){return this.faces.map(e=>e.viewMatrix)}_setupFaceCamera(e,i,r,s){const{observerRenderSpace:n,tiltedUpVector:o,targetRenderSpace:a,farDistanceRenderSpace:l,horizontalFieldOfView:c,verticalFieldOfView:u}=i,d=E();Ii(d,a,n);const f=E(),m=E(),g=(U,k)=>{const H=E(),V=ke();return Du(V,U,k),nt(H,d,V),Ee(H,n,H),H};let y,v=o;const b=Math.min(90,c),w=Math.min(90,Math.max(0,(c-90)/2));let x=-45,S=45,C=-45,M=45;if(t4t(e)){const U=k=>Ne(k,-45,45);C=U(-u/2)-this.settings.toleranceBottomTop,M=U(+u/2)+this.settings.toleranceBottomTop}switch(e){case"front":y=a,x=-b/2,S=b/2;break;case"left":y=g(Math.PI/2,o),x=45-w;break;case"right":y=g(-Math.PI/2,o),S=-45+w;break;case"top":y=Ee(f,n,o),v=sa(m,d);break;case"bottom":y=Ii(f,n,o),v=d;break;case"back":y=g(Math.PI,o)}const O=new e1({center:y,eye:n,up:v,far:l});O.sectionAnglesDeg=[x-this.settings.toleranceSides,S+this.settings.toleranceSides,C,M],O.fovY=Math.PI/2;const D=O.setViewport(r,s);return this._faces[e]=O,D}_bindFBO(){var i;const e=this._fbos.rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer((i=this._handle)==null?void 0:i.fbo)}_computeActiveFaces(e){const i=new Set,{horizontalFieldOfView:r,verticalFieldOfView:s}=e,n=-s/2,o=s/2;return r===0||s===0||(n<=45&&o>=-45&&i.add("front"),r>90&&(i.add("left"),i.add("right")),r>270&&i.add("back"),o>45-this.settings.toleranceBottomTop&&i.add("top"),n<-45+this.settings.toleranceBottomTop&&i.add("bottom")),i}_computeBaseTextureSize(e,i,r,s){const n=Math.min(window.devicePixelRatio,i)/e.pixelRatio,o=this.settings.textureSizeModifier(r),a=rb(Math.floor(Math.max(e.fullWidth,e.fullHeight)*n*o)),l=Math.floor(this._maxTextureWidth/s),c=Math.min(l,a);return t$e(c)}_ensureFBO(){var r,s,n,o,a;const e=this._textureWidth,i=this._textureHeight;((s=(r=this._handle)==null?void 0:r.fbo)==null?void 0:s.width)===e&&((o=(n=this._handle)==null?void 0:n.fbo)==null?void 0:o.height)===i||((a=this._handle)==null||a.release(),this._handle=this._fbos.acquire(e,i,"viewshed shadow map",ss.RGBA4)),this._handle.acquireDepth(Oo.DEPTH16_BUFFER)}clearFBO(){const e=this._fbos.rctx;this._ensureFBO(),this._bindFBO(),e.setClearColor(1,1,1,1),e.clear(zr.COLOR_BUFFER_BIT|zr.DEPTH_BUFFER_BIT)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._handle=hi(this._handle)}start(e,i,r,s){if(this._faces={},!this.enabled)return!1;const n=this._computeActiveFaces(i),o=n.size;if(o===0)return!1;const a=this._computeBaseTextureSize(e,s,r,o);if(a===0)return!1;let l=0,c=0,u=0;return _7.filter(d=>n.has(d)).forEach(d=>{const f=r4t(d,o);f>c&&(u=Math.max(u,l),l=0),c=f;const m=f*a;l+=this._setupFaceCamera(d,i,[l,m],a)}),u=Math.max(u,l),this._textureWidth=this.settings.textureResizeModulo(u),this._textureHeight=s4t(o)*a,this.clearFBO(),!0}finish(){var e;(e=this._handle)==null||e.detachDepth()}get test(){return{faces:this._faces,faceTypes:_7}}};function r4t(t,e){if(e<4)return 0;const i=t==="front"||t==="left";return e===4?i?0:1:i||t==="right"?0:1}function s4t(t){return t<4?1:2}let n4t=class extends Fr{constructor(){super(...arguments),this.localOrigin=are()}};function o4t(t){t.include(XD),t.fragment.uniforms.add(new us("inverseViewMatrix",(e,i)=>{const r=ke();return dl(r,i.camera.viewMatrix,e.localOrigin),Hb(r,r)})),t.fragment.code.add(T`vec4 reconstructLocalPosition(vec2 coord, float linearDepth) {
vec4 cameraSpace = vec4(reconstructPosition(coord, linearDepth), 1.0);
return inverseViewMatrix * cameraSpace;
}`)}let Gae=class extends n4t{constructor(){super(...arguments),this.targetVector=[1,0,0],this.upVector=[0,0,1],this.fovs=[45,45],this.headingAndTilt=[0,0],this.shadowMap={depthTexture:null,nearFar:[1,100],numActiveFaces:1,atlasRegions:[[0,0,1,1]]},this.projectionMatrices=Wr.flat(),this.viewMatrices=Wr.flat()}};function lVe(t){const e=new Hi,i=e.fragment;e.include(ka),e.include(o4t),e.include(qse),i.include(fy),i.include(loe),i.uniforms.add(new wt("depthTexture",(s,n)=>{var o;return(o=n.depth)==null?void 0:o.attachment})),i.uniforms.add(new us("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new us("inverseViewNormalMatrix",(s,n)=>Hb(a4t,n.camera.viewInverseTransposeMatrix))),i.uniforms.add(new Wt("viewshedTargetVector",(s,n)=>s.targetVector),new Wt("viewshedUpVector",(s,n)=>s.upVector),new jr("viewshedFOVs",(s,n)=>s.fovs),new jr("viewshedHeadingAndTilt",(s,n)=>s.headingAndTilt),new jr("viewshedNearFar",(s,n)=>s.shadowMap.nearFar??[1,100])),i.uniforms.add(new wt("viewshedShadowMap",s=>s.shadowMap.depthTexture),new HQ("viewshedProjectionMatrices",(s,n)=>s.projectionMatrices,6),new HQ("viewshedViewMatrices",(s,n)=>s.viewMatrices,6),new cO("viewshedNumFaces",(s,n)=>s.shadowMap.numActiveFaces),new Yl("viewshedAtlasRegions",(s,n)=>s.shadowMap.atlasRegions.flat(),24)),i.constants.add("visibleColor","vec4",[0,1,0,.5]),i.constants.add("occludedColor","vec4",[1,0,0,.5]);const r=t.useNormalMap;return r?(i.uniforms.add(new wt("normalMap",(s,n)=>s.normalTexture)),i.code.add(T`vec3 normalFromTexture() {
vec4 norm4 = texture(normalMap, uv);
vec3 nNormal = vec3(-1.0) + 2.0 * norm4.xyz;
return normalize((inverseViewNormalMatrix * vec4(nNormal, 1.0)).xyz);
}`)):e.include(MUe),i.code.add(T`
    // UV coordinates of point projected onto viewshed shadow map
    vec2 getViewshedUv(vec4 worldPosition, int face) {
      mat4 viewshedMatrix = viewshedProjectionMatrices[face];
      vec4 viewshedUv4 = viewshedMatrix * worldPosition;
      vec3 viewshedUv = viewshedUv4.xyz / viewshedUv4.w;
      return viewshedUv.xy;
    }

    float viewshedDepthToFloat(float depth) {
      return (depth - viewshedNearFar[0]) / (viewshedNearFar[1] - viewshedNearFar[0]);
    }

    // Orthographic depth to viewshed of given point and given cube map face in range [0, 1].
    float getOrthographicDepthToViewshed(vec4 worldPosition, int face) {
      mat4 viewshedViewMatrix = viewshedViewMatrices[face];
      vec4 viewshedUv4 = viewshedViewMatrix * worldPosition;
      vec3 viewshedUv = viewshedUv4.xyz / viewshedUv4.w;
      float depth = -viewshedUv.z;
      return viewshedDepthToFloat(depth);
    }

    // Read depth from shadow map given uv and cube map face
    float getDepthFromShadowMap(vec2 uv, int face) {
      int index = 4 * face;

      float umin = viewshedAtlasRegions[index];
      float umax = viewshedAtlasRegions[index + 1];
      float vmin = viewshedAtlasRegions[index + 2];
      float vmax = viewshedAtlasRegions[index + 3];

      vec4 atlasRegion = vec4(umin, vmin, umax, vmax);
      return rgba4ToFloat(textureAtlasLookup(viewshedShadowMap, uv, atlasRegion));
    }

    struct ViewshedPoint {
      int face;
      vec2 uv;
      bool isWithin;
      float orthographicDepth;
    };

    // Find cube map face the given position lies in and return relevant information about it
    bool getViewshedPoint(vec4 worldPosition, out ViewshedPoint point) {
      vec3 nUp = normalize(viewshedUpVector);

      // Try with all active cube map faces
      for(int i=0; i < viewshedNumFaces; i++) {

        // Check if when projected, point lies within shadow map texture
        vec2 viewshedUv = getViewshedUv(worldPosition, i);
        if (viewshedUv.x > 0.0 && viewshedUv.x < 1.0 && viewshedUv.y > 0.0 && viewshedUv.y < 1.0) {
          float orthoDepth = getOrthographicDepthToViewshed(worldPosition, i);
          if (orthoDepth >= 0.0) { // found a cube map face

            // Check whether point is really inside viewshed geometry, not just within the camera frustum

            // outside farDistance
            vec3 position = worldPosition.xyz;
            bool isWithin = length(position) <= viewshedNearFar[1];

            // horizontally outside fov
            float t = dot(nUp, position);
            bool isBottomHalf = t > 0.0;
            vec3 nProjVector = normalize(position - t * nUp);
            if (isWithin) {
              float angle = acos(dot(normalize(viewshedTargetVector), nProjVector));
              if (angle > viewshedFOVs[0] / 2.0) {
                isWithin = false;
              }
            }

            // vertically outside fov
            if (isWithin) {
              float angle = acos(dot(nProjVector, normalize(position)));
              if (!isBottomHalf) {
                angle = -angle;
              }
              float tilt = viewshedHeadingAndTilt[1];
              float limit = viewshedFOVs[1] / 2.0;
              if (angle > limit || angle < -limit) {
                isWithin = false;
              }
            }

            point = ViewshedPoint(i, viewshedUv, isWithin, orthoDepth);
            return true;
          }
        }
      }

      // no cube face matches
      return false;
    }

    float normalCosAngle(float linearDepth, vec3 localPosition) {
      ${r?T`vec3 normal = normalFromTexture();`:T`
        vec3 cameraSpacePosition = reconstructPosition(gl_FragCoord.xy, linearDepth);
        vec3 normal = normalFromDepth(depthTexture, cameraSpacePosition, gl_FragCoord.xy, uv);
        normal = (inverseViewNormalMatrix * vec4(normal, 1.0)).xyz;
        `};

      vec3 viewingDir = normalize(localPosition);
      return dot(normal, viewingDir);
    }

    void main() {
      float depth = depthFromTexture(depthTexture, uv);

      // Outside camera planes
      if (depth >= 1.0 || depth <= 0.0) {
        return;
      }

      float linearDepth = linearizeDepth(depth);

      // Relative to viewshed position
      vec4 localPosition = reconstructLocalPosition(gl_FragCoord.xy, linearDepth);

      ViewshedPoint point;
      bool foundFace = getViewshedPoint(localPosition, point);

      // Outside every viewshed
      if (!foundFace || !point.isWithin) {
        return;
      }

      float viewshedDepth = getDepthFromShadowMap(point.uv, point.face);
      float distance = point.orthographicDepth;

      bool visible = distance < viewshedDepth;
      fragColor = visible ? visibleColor : occludedColor;

      float cosAngle = normalCosAngle(linearDepth, localPosition.xyz);

      // Everything facing away, and close to parallel is considered occluded.
      // Theshold corresponds to around 0.6 degrees, tuned empirically.
      if (cosAngle > -0.01) {
        fragColor = occludedColor;
      }
    }`),e}const a4t=ke(),l4t=Object.freeze(Object.defineProperty({__proto__:null,ViewshedPassParameters:Gae,build:lVe},Symbol.toStringTag,{value:"Module"}));let cVe=class uVe extends Qi{initializeProgram(e){return new Ki(e.rctx,uVe.shader.get().build(this.configuration),Ai)}initializePipeline(){return Jt({colorWrite:ui,blending:Ru})}};cVe.shader=new qi(l4t,()=>ce(()=>Promise.resolve().then(()=>ZHt),void 0));let hVe=class extends tc{constructor(){super(...arguments),this.useNormalMap=!0}};h([B()],hVe.prototype,"useNormalMap",void 0);let Jx=class extends mne{get viewshedShadowMap(){return this._viewshedShadowMap}get enabled(){return this._viewsheds.length>0}constructor(e,i){super(e),this._pluginContext=null,this.renderHighQuality=!1,this._parameters=new Gae,this._configuration=new hVe,this._viewsheds=new st,this.produces=new Map([[Pe.VIEWSHED,()=>!0]]),this._renderShadowMap=i}initialize(){this.addHandles(te(()=>this.view.qualitySettings.maximumPixelRatio,e=>this._maximumPixelRatio=e,hr))}destroy(){this.uninitializeRenderContext()}consumes(){return this.enabled?fne:o6}initializeRenderContext(e){this._pluginContext=e,this._viewshedShadowMap=new i4t(this.fboCache),this._viewshedShadowMap.enabled=!0}renderNode(e,i,r){var a,l,c;const{bindParameters:s,rctx:n}=e;if(!this.enabled||!s.depth||r==null)return;const o=this._setupNormals(r);if(this._technique!=null&&this._configuration.useNormalMap===o||(this._configuration.useNormalMap=o,this._technique=(a=this._pluginContext)==null?void 0:a.techniques.acquire(cVe,this._configuration)),(l=this._technique)==null?void 0:l.compiled)for(const u of this._viewsheds){const d=e.rctx.getBoundFramebufferObject(),f=this._renderViewshedShadowCubeMap(s,u),m=this._viewshedShadowMap;f&&m.depthTexture!=null&&!m.isTextureZero&&(this._setPassParameters(u),e.rctx.bindFramebuffer(d),n.bindTechnique(this._technique,s,this._parameters),n.screen.draw())}else(c=this._pluginContext)==null||c.requestRender()}uninitializeRenderContext(){this._pluginContext=null,this._viewshedShadowMap.dispose(),this._technique=qe(this._technique)}updateViewsheds(e){const i=e.removes;i!=null&&(st.isCollection(i)?this._viewsheds.removeMany(i):this._viewsheds.remove(i));const r=e.adds;if(r!=null)if(st.isCollection(r)){const s=r.filter(n=>!this._viewsheds.includes(n));this._viewsheds.addMany(s)}else this._viewsheds.includes(r)||this._viewsheds.add(r)}_renderViewshedShadowCubeMap(e,i){const r=this._viewshedShadowMap;if(!r.enabled)return!1;const s=r.start(e.camera,i,this.renderHighQuality,this._maximumPixelRatio);if(s)for(const n of r.faces)this._renderShadowMap(e,n,j.ViewshedShadow);return r.finish(),s}_setPassParameters(e){const i=this._parameters,r=this._viewshedShadowMap,s=e.observerRenderSpace;i.localOrigin=s,i.fovs=[kt(e.horizontalFieldOfView),kt(e.verticalFieldOfView)],i.headingAndTilt=[kt(e.heading),kt(e.tiltParallelToSurface)],i.upVector=e.tiltedUpVector;const n=c4t(e.targetRenderSpace,s);i.targetVector=n,i.shadowMap=r;const o=[],a=[];for(let l=0;l<r.numActiveFaces;l++)dl(v7,r.viewshedViewMatrices[l],s),o.push(...v7.flat()),u4t(r.viewshedProjectionMatrices[l],v7,i1e),a.push(...i1e.flat());i.viewMatrices=o,i.projectionMatrices=a}_setupNormals(e){const i=e.get("normals"),r=i==null?void 0:i.getTexture();return this._parameters.normalTexture=r,r!=null}get test(){return{viewsheds:this._viewsheds}}};function c4t(t,e){const i=E();return Ii(i,t,e)}function u4t(t,e,i){const r=Ge(.5,.5,.5);return g2(i,r),_D(i,i,r),aL(i,i,t),aL(i,i,e),i}h([p()],Jx.prototype,"_pluginContext",void 0),h([p()],Jx.prototype,"fboCache",void 0),h([p()],Jx.prototype,"view",void 0),h([p()],Jx.prototype,"viewshedShadowMap",null),Jx=h([I("esri.views.3d.webgl-engine.lib.Viewshed")],Jx);const v7=ke(),i1e=ke();let r1e=class{constructor(e,i,r,s,n,o,a,l,c){this.createQuery=e,this.deleteQuery=i,this.resultAvailable=r,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},c0=!1;function h4t(t,e){if(e.disjointTimerQuery)return null;let i=t.getExtension("EXT_disjoint_timer_query_webgl2");return i?new r1e(()=>t.createQuery(),r=>{t.deleteQuery(r),c0=!1},r=>t.getQueryParameter(r,t.QUERY_RESULT_AVAILABLE),r=>t.getQueryParameter(r,t.QUERY_RESULT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{c0||(c0=!0,t.beginQuery(i.TIME_ELAPSED_EXT,r))},()=>{t.endQuery(i.TIME_ELAPSED_EXT),c0=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>t.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=t.getExtension("EXT_disjoint_timer_query"),i?new r1e(()=>i.createQueryEXT(),r=>{i.deleteQueryEXT(r),c0=!1},r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{c0||(c0=!0,i.beginQueryEXT(i.TIME_ELAPSED_EXT,r))},()=>{i.endQueryEXT(i.TIME_ELAPSED_EXT),c0=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function d4t(t,e){const i=t.capabilities.disjointTimerQuery;return i==null?null:new p4t(i,e)}let p4t=class{constructor(e,i){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,i.forEach(r=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(r,null)})}start(){c0||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const i=this._queryResults.get(e);if(i==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(i))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const r=this._timer.getResult(i)/1e6;return this._queryPool.unshift(i),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,r}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var Ls;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.DEPTH="depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.NORMALS="normals",t.SSAO="SSAO",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.OPAQUE_ENVIRONMENT="opaque environment",t.TRANSPARENT_ENVIRONMENT="transparent environment",t.LASER_LINES="laser lines",t.VIEWSHED="viewshed",t.OCCLUDED="occluded",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(Ls||(Ls={}));const b7=Object.values(I1).concat(Object.values(jT)).concat(Object.values(Ls)),s1e="Total";let f4t=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new U0(s1e),this._cpuTimeSamplers=new Map(b7.map(i=>[i,new U0(i)])),this._enableGPUTimer=0,this._totalGPUTime=new U0("GPU"),this._gpuTimeSamplers=new Map(b7.map(i=>[i,new U0(i)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const i=[...b7,s1e];this._gpuTimerPool=d4t(this._rctx,i)}if(this._gpuTimerPool==null)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let e=!1;return{hasGPUTimerSupport:!0,remove:()=>{e||(e=!0,--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=Ut(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool&&this._gpuTimerPool.start()}advance(e){const i=performance.now();if(this._cpuTimeSamplers.get(e).record(i-this._lastTimeStampCPU),this._lastTimeStampCPU=i,this._gpuTimerPool){const r=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(r),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){const i=this._gpuTimerPool.stop(Ls.FINISH);this._gpuTimeSamplers.get(Ls.FINISH).record(i),this._rctx.gl.flush()}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),this._gpuTimerPool&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((i,r)=>i+(r.last||0),0)),++this._totalFrameCount}};class JU{constructor(e,i,r,s,n,o){this._stage=e,this._techniques=r,this._rctx=s,this._compositingHelper=n,this._requestRender=o,this._pluginsHas={hudElements:!1,water:!1},this._hasOverlayWater=!1,this.renderOverlay=a=>{},this._isRendering=!1,this._inGlobeView=!1,this._backgroundColor=ii(0,0,0,1),this._sliceHelper=new KFt,this._blit=null,this._state=Ug($i.IDLE),this._highQualityTransparencyEnabled=!0,this._terrainTransparency=tl.Opaque,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new FFt,this._loadEdgeViewTask=null,this._edgeViewCallbacks=[],this._reprojectionMatrixVersion=Ug(0),this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new HFt,this._releaseNormals=a=>{a.some(({name:l})=>l==="normals")&&this._pluginInput.release("normals")},this._debugNeedsDepth=!1,this.fboCache=new IFt(s),this._renderStateFeatures=Ug(Gfe(!le("disable-feature:high-quality-idle"),e.view.qualityProfile)),this._offscreen=new jFt(this.fboCache,this._compositingHelper),this.performanceInfo=new f4t(this._rctx),this._shadowMap=new Roe(this.fboCache,e.viewingMode),this._viewshed=new Jx({fboCache:this.fboCache,view:e.view},(a,l,c)=>{l.setGLViewport(this._rctx);const{camera:u,contentCamera:d}=a;this._ensureBindParametersCamera(l,l),this._renderAllGeometry(c),this._ensureBindParametersCamera(u,d),a.camera.setGLViewport(this._rctx)}),this._shadowAccumulator=new wc(this.fboCache,r,e,a=>{const l=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureBindParametersCamera(a.camera,a.contentCamera),this._plugins.prepareRender(),this._shadowMap.enabled=l},(a,l,c)=>{const u=this._stage.view.qualitySettings.maximumPixelRatio;a.shadowMap.start(a.camera,l,c,!0,u),this._renderShadowCascades(j.Shadow,a.shadowMap),a.shadowMap.finish(),a.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(a.camera,a.contentCamera)},o),this._renderContext=new Wbt(this._rctx,this._offscreen,this._shadowMap,this._sliceHelper),this._nodes=new LFt(this._renderContext),this._plugins=new DFt({renderContext:this._renderContext,techniques:r,materials:i,requestRender:o,controller:e,fbos:this.fboCache,isFeatureEnabled:a=>this.isFeatureEnabled(a)}),this.renderPassManager=new oee,this._plugins.add(this.renderPassManager),this._plugins.add(this._viewshed),this._handles=[te(()=>this._stage.view.state.camera,()=>o(),hr),te(()=>Nr.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,a=>{this._renderHiddenTransparentEdges=a?()=>this._renderEdges(vh.TRANSPARENT):()=>{},o()},$t),te(()=>{var a;return(a=this._stage.view.environment.background)==null?void 0:a.color},a=>{const l=a?vL(a):Rh;_s(this._backgroundColor,l[0]*l[3],l[1]*l[3],l[2]*l[3],l[3]),o()},hr),te(()=>this._stage.view.state.camera.relativeElevation,a=>{this._inGlobeView=(a??1/0)>=SB},hr)]}destroy(){this._handles.forEach(e=>e.remove()),this._gpuTimerHandle=$r(this._gpuTimerHandle),this._nodes.destroy(),this._offscreen.dispose(),this._shadowMap.dispose(),this._shadowAccumulator.dispose(),this._loadEdgeViewTask=Jl(this._loadEdgeViewTask),this._edgeView=qe(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this.fboCache.destroy(),this._plugins.destroy(),cIe.prune()}get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeatures(e=null,i=!le("disable-feature:high-quality-idle")){this._renderStateFeatures.value=Gfe(i,e),this._plugins.renderFeatureChanged(),this._requestRender()}isFeatureEnabled(e,i=this._state.value){return this._renderStateFeatures.value.get(i,e)??!1}setFeatureEnabled(e,i,r){this._renderStateFeatures.mutate(s=>s.set(i,e,r)),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Ys.HighQualityTransparency)}get hasReflections(){return(this._pluginsHas.water||this._hasOverlayWater)&&(this._ssrEnabled||this.isFeatureEnabled(Ys.WaterReflection))}get hasDecorations(){return this._plugins.hasDecorations||this._nodes.produces("magnifier-color")}get hasHighlights(){return this._plugins.produces(j.Highlight,Pe.OPAQUE_MATERIAL,Pe.TRANSPARENT_MATERIAL,Pe.DRAPED_MATERIAL)}get hasLaserlines(){return this._plugins.produces(this._renderContext.output,Pe.LASERLINES,Pe.LASERLINES_CONTRAST_CONTROL)}get hasSSAO(){return(this._stage.view.qualitySettings.ambientOcclusion||this.isFeatureEnabled(Ys.SSAO))&&!this._inGlobeView}get hasSMAA(){return this._stage.view.qualitySettings.antialiasingEnabled||this.isFeatureEnabled(Ys.Antialiasing)}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(Ys.HighResolutionAtmosphere)}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=hi(this._bindParameters.ssr.lastFrameColor),this._bindParameters.multipassTerrain.depth=hi(this._bindParameters.multipassTerrain.depth),this._bindParameters.multipassGeometry.depth=hi(this._bindParameters.multipassGeometry.depth)}_disposeOffscreenBuffers(){this._offscreen.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._viewshed.viewshedShadowMap.disposeOffscreenBuffers(),this._bindParameters.depth=hi(this._bindParameters.depth),this._bindParameters.hudVisibility=hi(this._bindParameters.hudVisibility)}get updating(){return this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._plugins.updating||!this.isCameraFinal}loadEdgeView(){return this._loadEdgeViewTask||(this._loadEdgeViewTask=uy(async e=>{const{EdgeView:i}=await ce(()=>import("./EdgeView-DPtQilcw.js"),__vite__mapDeps([193,194,5,33]));Dt(e);const r=this._edgeView=new i({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniques:this._techniques,setNeedsRender:()=>this._requestRender(),schedule:m4t(this._stage.view.resourceController)});return this._handles.push(te(()=>r.updating,()=>this._requestRender(),or)),this._requestRender(),this._edgeViewCallbacks.forEach(s=>s(r)),this._edgeViewCallbacks.length=0,r})),this._loadEdgeViewTask.promise}withEdgeView(e){this.loadEdgeView(),this._edgeView==null?this._edgeViewCallbacks.push(e):e(this._edgeView)}get edgeView(){return this._edgeView}get isCameraFinal(){return this._reprojectionMatrixVersion.value>=0&&eG(this._bindParameters.ssr.reprojectionMatrix,Wr)}set _reprojectionMatrix(e){Fxe(this._bindParameters.ssr.reprojectionMatrix,e)&&this._reprojectionMatrixVersion.value++}get shadowsEnabled(){var e;return!!((e=this._shadowMap)!=null&&e.enabled)}setParameters(e){var s;const{_shadowMap:i,_bindParameters:r}=this;if(((s=e.qualitySettings)==null?void 0:s.reflections)!==void 0&&this._ssrEnabled!==e.qualitySettings.reflections&&(this._ssrEnabled=e.qualitySettings.reflections,this._requestRender()),e.shadowMap!==void 0&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&i.maxCascades!==e.shadowMapMaxCascades&&(i.maxCascades=e.shadowMapMaxCascades,this._requestRender()),e.environment!=null){e.environment.weather!=null&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=!!e.weatherVisible);const n=e.environment.lighting.type!=="virtual";r.enableFillLights!==n&&(r.enableFillLights=n,this._requestRender())}e.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.terrainTransparency!==void 0&&this._terrainTransparency!==e.terrainTransparency&&(this._terrainTransparency=e.terrainTransparency,this._requestRender()),e.shadowCast!==void 0&&this._shadowAccumulator.setOptions(e.shadowCast)}get hasSlicePlane(){return!!this._sliceHelper.plane}get plugins(){return this._plugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(e,i){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:r,removes:s,updates:n}=e;if(r.length===0&&s.length===0&&n.length===0)return;const o=P$e(e);let a=!1;o.forEach((l,c)=>{if(i.done)return;let u=this._plugins.getMaterialRenderer(c);if(u==null&&l.adds.length>0){const d=new b3({material:c});d.initializeRenderContext(this._plugins._context),u=d,this._plugins.add(u)}u&&(u.modify(l),u.numGeometries===0&&(a=!0)),l.removes.forEach(d=>e.removes.removeUnordered(d)),l.adds.forEach(d=>e.adds.removeUnordered(d)),l.updates.forEach(d=>e.updates.removeUnordered(d)),i.madeProgress()}),a&&this._plugins.removeEmptyMaterialRenderers(),this._updateHasFlags(),this._requestRender()}_updateHasFlags(){const e=this._pluginsHas;e.hudElements=this._plugins.produces(j.Color,Pe.LINE_CALLOUTS_HUD_DEPTH,Pe.HUD_MATERIAL,Pe.LABEL_MATERIAL),e.water=this._plugins.produces(j.Normal,Pe.DRAPED_WATER),this._bindParameters.hasOccludees=this._plugins.hasOccludees}updateAnimation(e){const i=this._hasAnimations;return this._hasAnimations=this._plugins.updateAnimation(e),this._hasAnimations=this._nodes.updateAnimation()||this._hasAnimations,this._hasAnimations!==i&&(this._gpuTimerHandle=i?$r(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(e,i,r=pf.Default,s=Zl.ON){var X,q,Z,ye;this._isRendering=!0,this.performanceInfo.startFrame(),this.fboCache.frameStart(),this._disposeBindBuffers();const n=this._offscreen,{camera:o,contentCamera:a,mode:l,alignPixelEnabled:c}=e;this._state.value=l,this._bindParameters.overlay=this.renderOverlay(i),this._bindParameters.overlay&&this.performanceInfo.advance(Ls.OVERLAY),this._renderContext.time=i,this._bindParameters.transparencyPassType=pt.NONE,this._bindParameters.alignPixelEnabled=c,this._bindParameters.decorations=s,this._bindParameters.mainColor=this._bindParameters.mainDepth=null,this._bindParameters.viewshedEnabled=this._viewshed.enabled;const u=this._nodes.produces("magnifier-color"),d=this._nodes.produces("final-color"),f=T_(this._sliceHelper.plane);s===Zl.OFF&&(this._sliceHelper.plane=null),o.setGLViewport(this._rctx);const m=n.initializeFrame(o,this._backgroundColor,r);this.hasReflections?this._bindParameters.ssr.lastFrameColor=m:m==null||m.release(),this._ensureBindParametersCamera(o,a),this._plugins.prepareRender(),this._bindParameters.shadowHighlightsVisible=this._needsShadowHighlight&&s===Zl.ON;const g=this._plugins.produces(j.Color,Pe.OPAQUE_TERRAIN)&&(this._terrainTransparency===tl.Semitransparent||this._terrainTransparency===tl.TransparentWithDraped),y=this._highQualityTransparency&&g,v=this._plugins.produces(j.Color,...v5);this._prepareShaders(y,v),this.performanceInfo.advance(Ls.PREPARE);const b=this._computeDepthRange(o);this._renderShadowMap(o,this._bindParameters.lighting.mainLight.direction,b),this._ensureBindParametersCamera(o,a);let w=this._renderNormals();if(this._pluginInput.set("normals",w),w){let L=null;this._needsDepth&&(L=w.getAttachment(cP),L==null||L.retain()),this._pluginInput.set("ssao",this._renderSSAO()),this._renderNoSSAOGeometryDepth(L),w=null}else this._renderAllGeometryDepth();this._renderShadowAccumulation(b,o,a),this._ensureBindParametersSSR(i),this._renderContext.output=j.Color,n.bindFbo(),this._bindParameters.mainColor=n.colorTexture,this._bindParameters.mainDepth=n.depthTexture;const x=this.plugins.produces(j.Color,...w7);x&&this._renderOpaqueGeometry(),this._offscreen.updateColor(L=>this._renderNodes(I1.OPAQUE,L,x)),(q=(X=this.fboCache).debugCallback)==null||q.call(X,"opaque-color",this._offscreen.color.fbo),this._renderPlugins(Pe.OPAQUE_ENVIRONMENT,Ls.OPAQUE_ENVIRONMENT),this._renderMultipassTerrainDepth(y),this._setMultipassTerrain(y),this._renderEdges(vh.OPAQUE),n.bindFbo(),this._renderPlugins(Pe.VOXEL,Ls.VOXEL),this._renderHiddenTransparentEdges(),v&&(this._oitEnabled?this._renderOITPass(LM.Geometry):this._renderTransparentMaterial()),this._offscreen.updateColor(L=>this._renderNodes(I1.TRANSPARENT,L,v)),(ye=(Z=this.fboCache).debugCallback)==null||ye.call(Z,"transparent-color",this._offscreen.color.fbo),this._renderMultipassGeometryDepth(y),this._renderHUDVisibility(),y||this._plugins.render(this._pluginInput,Pe.LINE_CALLOUTS);const S=r===pf.ObjectAndLayerID?this._renderObjectAndLayerIdColor():null;this._renderEdges(vh.TRANSPARENT);const C=g?this._renderTransparentTerrain():null;C&&(this.performanceInfo.advance(Ls.TRANSPARENT_TERRAIN),this._bindParameters.hudVisibility&&(y?this._renderLineCallouts(Pc.Occluded):n.compositeToHUDVisibility(this._bindParameters,C.getTexture()),this._renderHUD(Pc.Occluded,n.color))),this._setTerrainCulling(!1),C&&(n.compositeToFramebuffer(this._bindParameters,C.getTexture(),Cu.PremultipliedAlpha,1),C.release(),y&&(this._renderEdges(vh.OPAQUE),v&&(this._oitEnabled?this._renderOITPass(LM.Geometry):this._renderTransparentMaterial(),this.performanceInfo.advance(Ls.TRANSPARENT)),this._renderEdges(vh.TRANSPARENT))),this._bindParameters.ssao=hi(this._bindParameters.ssao),y&&this._renderLineCallouts(Pc.NotOccluded),this._setMultipassEnabled(!1),this._renderTransparentEnvironment(),this._renderViewshed(),this._renderLaserlines(),this._renderOccluded(),this._pluginInput.set("highlights",this._renderHighlightPrepass()),this._offscreen.updateColor(L=>this._renderNodes(I1.COMPOSITE,L));const M=this._nodes.produces("aa-color"),O=!(r!==pf.Default||d||u&&s===Zl.ON&&r===pf.Default),D=this._pluginInput.get("composite-color"),U=O?WL:this.fboCache.acquire(D.fbo.width,D.fbo.height,"aa-color"),k=M?this._renderNodes(jT.ANTIALIASING,U):this._blitToDefault(D,U,!1);this._pluginInput.set(jT.ANTIALIASING,k),this._renderHUD(Pc.NotOccluded,k);const H=this._renderNodes(jT.HIGHLIGHTS,k);let V=this._renderNodes(jT.MAGNIFIER,H);return u&&s===Zl.ON&&r===pf.Default&&!d&&(V=this._blitToDefault(V)),d?(V.attachDepth(n.depth),this._blitToDefault(this._renderNodes(I1.FINAL,V)),V.detachDepth()):this._pluginInput.set(I1.FINAL,V),this._pluginInput.release("highlights"),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),this._offscreen.releaseBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=f,this._isRendering=!1,this.fboCache.frameEnd(),this.performanceInfo.finishFrame(),r!==pf.Default&&(this._releaseFBOs(),this._disposeOffscreenBuffers()),{screen:this._pluginInput.get("final-color"),oid:S}}_prepareShaders(e,i){this._renderContext.output=j.Color,this._prepareOpaqueGeometry(),this._setMultipassTerrain(e),this._plugins.prepare(Pe.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),e||this._plugins.prepare(Pe.LINE_CALLOUTS),i&&this._prepareTransparencySlots(),this._plugins.prepare(Pe.VIEWSHED,Pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Pe.TRANSPARENT_ENVIRONMENT,Pe.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(){if(!le("enable-feature:objectAndLayerId-rendering"))return;const e=this._renderContext.output,i=this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oid");return i.acquireDepth(Oo.DEPTH_STENCIL_TEXTURE),this._rctx.bindFramebuffer(i.fbo),this.fboCache.rctx.clearFramebuffer([0,0,0,0],!0,!0),this._renderAllGeometry(j.ObjectAndLayerIdColor),this._rctx.bindFramebuffer(i.fbo),this.fboCache.rctx.clearFramebuffer(void 0,!0,!0),this._bindParameters.hudRenderStyle=Pc.NotOccluded,this._plugins.render(this._pluginInput,Pe.HUD_MATERIAL),this._renderContext.output=e,this.performanceInfo.advance(Ls.OBJECT_AND_LAYER_ID_COLOR),i}finish(e){this._hasAnimations||this._animationTimestep.clear();const i=this.performanceInfo.gpuSamplingEnabled,r=e===ar.BACKGROUND;if(r||i){const s=r?this.performanceInfo.elapsedTime:0,n=i?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),o=Math.max(s,n);this._animationTimestep.frame(o,r)}}readDepthPixels(e,i){var o;if(!this._bindParameters.mainDepth)return;const{width:r,height:s}=this._offscreen,n=this.fboCache.acquire(r,s,"linear-depth");this._rctx.bindFramebuffer(n.fbo),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.clearFramebuffer([0,0,0,0],!0,!0),this._compositingHelper.blitDepthToLinearDepth(this._bindParameters,this._bindParameters.mainDepth),(o=n.fbo)==null||o.readPixels(e[0],e[1],e[2],e[3],Ht.RGBA,fl.UNSIGNED_BYTE,i),n.release()}readHUDVisibility(e,i,r,s,n){var o,a;(a=(o=this._bindParameters.hudVisibility)==null?void 0:o.fbo)==null||a.readPixels(e,i,r,s,Ht.RGBA,fl.UNSIGNED_BYTE,n)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_setMultipassTerrain(e){this._setMultipassEnabled(e),this._setTerrainCulling(e)}_setMultipassEnabled(e){this._bindParameters.multipassEnabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderEdges(e){const i=this._edgeView;if(!(i!=null&&i.shouldRender()))return;const{width:r,height:s,depth:n}=this._offscreen,o=this.fboCache.acquire(r,s,"edges"),a=()=>i.render(this._bindParameters,e),l=this._bindParameters.multipassGeometry.depth;this._offscreen.renderToTargets(a,o,l??n,o1e),this._offscreen.compositeToFramebuffer(this._bindParameters,o.getTexture(),Cu.Alpha,1),o.release(),this.performanceInfo.advance(e===vh.OPAQUE?Ls.OPAQUE_EDGES:Ls.TRANSPARENT_EDGES)}_renderShadowMap(e,i,r){const s=this._shadowMap;s.enabled&&(s.start(e,i,r,this.isFeatureEnabled(Ys.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._needsShadowHighlight?(this._renderShadowCascades(j.ShadowHighlight,this._shadowMap),s.moveSnapshot(s2.Highlight),this._renderShadowCascades(j.ShadowExcludeHighlight,this._shadowMap),s.copySnapshot(s2.ExcludeHighlight),this._renderShadowCascades(j.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(j.Shadow),s.finish(),e.setGLViewport(this._rctx),this.performanceInfo.advance(Ls.SHADOW_MAP))}_renderShadowCascades(e,i=this._shadowMap){for(const r of i.cascades)r.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(r.camera,r.camera),this._renderAllGeometry(e)}get _needsDepth(){return this._plugins.consumes(j.Depth)||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast||this._debugNeedsDepth}_renderNoSSAOGeometryDepth(e){if(!this._needsDepth||!e)return void(this._bindParameters.depth=hi(this._bindParameters.depth));const{width:i,height:r}=this._offscreen,s=this.fboCache.acquire(i,r,"depth");s.attachDepth(e),e.release(),this._rctx.bindFramebuffer(s.fbo),this._rctx.clearFramebuffer(void 0,!1,!0),this._renderGeometryExcludedFromSSAO(j.Depth),hi(this._bindParameters.depth),this._bindParameters.depth=s.obtainDepthTexture(),s.release(),this.performanceInfo.advance(Ls.DEPTH)}_renderAllGeometryDepth(){if(!this._needsDepth)return void(this._bindParameters.depth=hi(this._bindParameters.depth));const{width:e,height:i}=this._offscreen,r=this.fboCache.acquire(e,i,"depth").acquireDepth(Oo.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(r.fbo),this._rctx.clearFramebuffer(void 0,!0,!0),this._renderAllGeometry(j.Depth),hi(this._bindParameters.depth),this._bindParameters.depth=r.obtainDepthTexture(),r.release(),this.performanceInfo.advance(Ls.DEPTH)}_renderMultipassTerrainDepth(e){if(!e)return void(this._bindParameters.multipassTerrain.depth=hi(this._bindParameters.multipassTerrain.depth));const i=this._renderContext.output;this._renderContext.output=j.Depth;const{width:r,height:s}=this._offscreen,n=this.fboCache.acquire(r,s,"terrain depth").acquireDepth(Oo.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(n.fbo),this._rctx.clearFramebuffer(void 0,!0,!0),this._renderTransparentTerrain(),hi(this._bindParameters.multipassTerrain.depth),this._bindParameters.multipassTerrain.depth=n.obtainDepthTexture(),this._renderContext.output=i,n.release()}_renderMultipassGeometryDepth(e){if(!e)return void(this._bindParameters.multipassGeometry.depth=hi(this._bindParameters.multipassGeometry.depth));const i=this._renderContext.output,{width:r,height:s}=this._offscreen,n=this.fboCache.acquire(r,s,"geometry depth").acquireDepth(Oo.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(n.fbo),this._rctx.clearFramebuffer(void 0,!0,!0),this._renderOpaqueGeometryAndTransparentMaterial(j.Depth),this._renderContext.output=i,hi(this._bindParameters.multipassGeometry.depth),this._bindParameters.multipassGeometry.depth=n.obtainDepthTexture(),n.release()}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(e){if(!this._needsDepthRange)return QK;const i=bFt(e,this._plugins.plugins,this._stage.layers);return MP(i,this._plugins.queryDepthRange(e)),i.near=Math.max(e.near,i.near),i.far=Math.min(e.far,i.far),i}_renderNormals(){const e=this._nodes.require("normals","final-color","composite-color","opaque-color","transparent-color"),i=(this.hasSSAO?1:0)+(this.hasLaserlines?1:0)+e;if(i===0)return;const r=this._offscreen.renderToCachedFBO(null,"normals",()=>this._renderGeometryForSSAO(j.Normal),[0,0,0,0],ss.RGBA,Oo.DEPTH_STENCIL_TEXTURE),s=this._nodes.optional("normals","final-color","composite-color","opaque-color","transparent-color")+(this._viewshedEnabled?1:0);return r.retain(i+s-1),this.performanceInfo.advance(Ls.NORMALS),r}_renderSSAO(){const e=this._pluginInput.get("normals");if(!this.hasSSAO||!e)return void(e==null?void 0:e.detachDepth());const i=this._nodes.render("ssao",this._pluginInput);return this._bindParameters.ssao=i,e.detachDepth(),this._pluginInput.release("normals"),this.performanceInfo.advance(Ls.SSAO),i}_renderAllGeometry(e){this._renderContext.output=e,this._plugins.prepare(Pe.TRANSPARENT_TERRAIN),this._renderOpaqueGeometryAndTransparentMaterial(e),this._renderTransparentTerrain()}_renderOpaqueGeometryAndTransparentMaterial(e){this._renderContext.output=e,this._plugins.prepare(Pe.TRANSPARENT_MATERIAL,Pe.TRANSPARENT_NO_SSAO_DEPTH),this._renderOpaqueGeometry(),this._renderTransparentMaterial()}_renderGeometryForSSAO(e){this._renderContext.output=e,this._plugins.render(this._pluginInput,Pe.INTEGRATED_MESH,Pe.OPAQUE_TERRAIN,Pe.OPAQUE_MATERIAL,Pe.TRANSPARENT_MATERIAL),this._renderTransparentTerrain()}_renderGeometryExcludedFromSSAO(e){this._renderContext.output=e,this._plugins.render(this._pluginInput,Pe.OPAQUE_NO_SSAO_DEPTH,Pe.TRANSPARENT_NO_SSAO_DEPTH)}_prepareOpaqueGeometry(){this._plugins.prepare(...w7,Pe.OPAQUE_ENVIRONMENT)}_renderOpaqueGeometry(){this._plugins.render(this._pluginInput,...w7)}_renderTransparentMaterial(){this._plugins.render(this._pluginInput,...v5)}_renderTransparentTerrain(){const e=this._renderContext.output;if(!this._plugins.produces(e,Pe.TRANSPARENT_TERRAIN))return;const i=()=>this._plugins.render(this._pluginInput,Pe.TRANSPARENT_TERRAIN);if(e!==j.Color)return void i();const{width:r,height:s,depth:n}=this._offscreen,o=this.fboCache.acquire(r,s,"transparent terrain");return this._offscreen.renderToTargets(i,o,n,[0,0,0,0]),o}_renderHUDVisibility(){this._plugins.produces(this._renderContext.output,Pe.OCCLUSION_PIXELS)?(this._bindParameters.hudVisibility=this._offscreen.renderHUDVisibility(this._bindParameters.hudVisibility,()=>this._plugins.render(this._pluginInput,Pe.OCCLUSION_PIXELS),this._bindParameters.multipassGeometry.depth),this._offscreen.bindFbo(),this.performanceInfo.advance(Ls.HUD_VISIBILITY)):this._bindParameters.hudVisibility=hi(this._bindParameters.hudVisibility)}_renderLineCallouts(e){if(this._bindParameters.hudRenderStyle=e,e===Pc.Occluded){const i=()=>this._plugins.render(this._pluginInput,Pe.LINE_CALLOUTS),{width:r,height:s,color:n}=this._offscreen,o=this.fboCache.acquireDepth(Oo.DEPTH16_BUFFER,r,s,"line callouts");this._offscreen.renderToTargets(i,n,o,void 0,!0,!0),o.release()}else this._plugins.render(this._pluginInput,Pe.LINE_CALLOUTS)}_renderLaserlines(){if(this.hasLaserlines){if(this._plugins.render(this._pluginInput,Pe.LASERLINES),this._plugins.produces(this._renderContext.output,Pe.LASERLINES_CONTRAST_CONTROL)){const e=this._offscreen,{width:i,height:r,depth:s}=e,n=this.fboCache.acquire(i,r,"laser lines"),o=()=>this._plugins.render(this._pluginInput,Pe.LASERLINES_CONTRAST_CONTROL);e.renderToTargets(o,n,s,o1e),e.compositeToFramebuffer(this._bindParameters,n.getTexture(),Cu.PremultipliedAlpha,1),n.release()}this._pluginInput.release("normals"),this.performanceInfo.advance(Ls.LASER_LINES)}}_renderHUD(e,i){if(this._pluginsHas.hudElements){if(this._oitEnabled){const r=this._renderOITPass(LM.HUD,e);this._rctx.bindFramebuffer(i.fbo),this._compositingHelper.composite(this._bindParameters,r.getTexture(),Cu.PremultipliedAlpha),r.release()}else if(e===Pc.Occluded){this._renderContext.output=j.Color;const r=()=>this._renderHUDElements(e),{width:s,height:n,color:o}=this._offscreen,a=this.fboCache.acquireDepth(Oo.DEPTH16_BUFFER,s,n,"hud");this._offscreen.renderToTargets(r,o,a,void 0,!0,!0),a.release()}else this._renderContext.output=j.Color,i.acquireDepth(Oo.DEPTH16_BUFFER),this._rctx.bindFramebuffer(i.fbo),this._renderHUDElements(e),i.detachDepth();this.performanceInfo.advance(e===Pc.Occluded?Ls.HUD_OCCLUDED:Ls.HUD)}}_renderHUDElements(e){this._bindParameters.hudRenderStyle=e,this._plugins.prepare(Pe.LINE_CALLOUTS_HUD_DEPTH,Pe.HUD_MATERIAL,Pe.LABEL_MATERIAL),this._plugins.render(this._pluginInput,Pe.LINE_CALLOUTS_HUD_DEPTH,Pe.HUD_MATERIAL,Pe.LABEL_MATERIAL)}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._plugins.produces(j.ShadowHighlight,Pe.OPAQUE_MATERIAL)}_renderHighlightPrepass(){if(!this.hasHighlights)return;const e=()=>{this._renderAllGeometry(j.Highlight),this._rctx.clear(zr.DEPTH_BUFFER_BIT),this._renderHUDElements(Pc.Both)},i=this._offscreen.renderToCachedFBO(null,"highlights",e,[0,0,0,0],ss.RGBA4,Oo.DEPTH_STENCIL_TEXTURE);return i.detachDepth(),i}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_renderShadowAccumulation(e,i,r){this._needsShadowCast&&this._bindParameters.depth&&this._shadowAccumulator.renderAccumulation(this._bindParameters.depth,e,i,r)&&this.performanceInfo.advance(Ls.ACCUMULATED_SHADOWS)}_prepareTransparencySlots(){this._renderContext.output=j.Color,this._bindParameters.transparencyPassType=pt.ColorAlpha,this._plugins.prepare(...v5),this._bindParameters.transparencyPassType=pt.FrontFace,this._plugins.prepare(...v5),this._bindParameters.transparencyPassType=pt.NONE,this._techniques.acquire(Bae).release()}_renderOITPass(e,i=Pc.Both){const r=e===LM.HUD,s=r?this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oit hud composite"):null,n=r?()=>this._renderHUDElements(i):()=>this._renderTransparentMaterial(),o=this._renderContext.output;this._renderContext.output=j.Color,this._bindParameters.transparencyPassType=pt.ColorAlpha;const a=this._offscreen.renderOITPass(n,pt.ColorAlpha,r);this._bindParameters.transparencyPassType=pt.FrontFace;const l=this._offscreen.renderOITPass(n,pt.FrontFace,r);return this._offscreen.compositeOIT(this._bindParameters,a,l,s),s==null||s.detachDepth(),l.release(),a.release(),this._bindParameters.transparencyPassType=pt.NONE,this._renderContext.output=o,s}_renderOccluded(){let e=0;Wu.clear(),this._plugins.plugins.forAll(l=>{l.materialReference&&l.queryRenderOccludedState(er.OccludeAndTransparentStencil)&&(e|=er.OccludeAndTransparentStencil,Wu.push(l))});const i=this._offscreen,r=(l,c,u,d,f)=>{if(!(e&c))return;const{width:m,height:g,depth:y}=i,v=this.fboCache.acquire(m,g,"tmp color");i.renderToTargets(u,v,y,[0,0,0,0],d,f),i.compositeToFramebuffer(this._bindParameters,v.getTexture(),Cu.PremultipliedAlpha,l),v.release()},s=(l,c)=>{this._bindParameters.slot=l,c.forAll(u=>{if(vQ(u)){const d=u.prepareTechnique(this._renderContext);d&&u.renderNode(this._renderContext,d)}})};Wu.length!==0&&(s(Pe.OCCLUDER_MATERIAL,Wu),r(.5,er.OccludeAndTransparentStencil,()=>s(Pe.TRANSPARENT_OCCLUDER_MATERIAL,Wu),!1,!1));const n=Wu.length>0;Wu.clear(),this._plugins.plugins.forAll(l=>{if(!l.materialReference)return;const c=l.queryRenderOccludedState(er.OccludeAndTransparent),u=l.queryRenderOccludedState(er.Transparent),d=l.queryRenderOccludedState(er.Opaque);(c||u||d)&&(e|=c?er.OccludeAndTransparent:u?er.Transparent:er.Opaque,Wu.push(l))});const o=this._plugins.renderOccludedFlags;if(e|=o,!e)return;const a=l=>{this._renderContext.renderOccludedMask=l,o>er.Occlude&&this._plugins.render(this._pluginInput,Pe.OCCLUDED_TERRAIN),s(Pe.OPAQUE_MATERIAL,Wu),s(Pe.TRANSPARENT_MATERIAL,Wu),s(Pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Wu),this._renderContext.renderOccludedMask=$B};this._renderContext.output=j.Color,r(.5,er.OccludeAndTransparent,()=>a(er.OccludeAndTransparent),!0,kc.OutlineVisualElementMask),r(.5,er.Transparent,()=>a(er.Transparent),!0,kc.OutlineVisualElementMask),r(1,er.Opaque,()=>a(er.Opaque),!0,kc.OutlineVisualElementMask),(n||Wu.length>0)&&this.performanceInfo.advance(Ls.OCCLUDED),Wu.clear()}_renderTransparentEnvironment(){this._shadowAccumulator.render(this._bindParameters),this._offscreen.bindFbo(),this._plugins.render(this._pluginInput,Pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Pe.TRANSPARENT_ENVIRONMENT),this.performanceInfo.advance(Ls.TRANSPARENT_ENVIRONMENT)}_renderViewshed(){this._viewshedEnabled&&(this._viewshed.renderHighQuality=this.isFeatureEnabled(Ys.HighResolutionViewshed),this._plugins.render(this._pluginInput,Pe.VIEWSHED),this._pluginInput.release("normals"),this.performanceInfo.advance(Ls.VIEWSHED))}_renderPlugins(e,i){this._plugins.produces(this._renderContext.output,e)&&(this._plugins.render(this._pluginInput,e),this.performanceInfo.advance(i))}_renderNodes(e,i,r=!1){if(!this._nodes.produces(e))return r&&this.performanceInfo.advance(e),i;i.setName(e),this._pluginInput.set(e,i);const s=this._nodes.render(i,this._pluginInput,this._releaseNormals);return this.performanceInfo.advance(e),s}_blitToDefault(e,i=WL,r=!0){this._blit||(this._blit=new NFt(this._techniques));const s=this._blit.render(this._rctx,e,i,this._bindParameters,this._requestRender);return this._pluginInput.set(e.name,s),r&&e.release(),s}_ensureBindParametersCamera(e,i){this._bindParameters.camera=e,this._bindParameters.contentCamera=i}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.lastFrameColor){this._ssrEnableTime==null&&(this._ssrEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Wr:(Zn(l1e,this._bindParameters.camera.viewMatrix),Zn(a1e,this._bindParameters.camera.projectionMatrix),gr(HE,l1e,a1e),gr(HE,this._renderContext.lastFrameCamera.viewMatrix,HE),gr(HE,this._renderContext.lastFrameCamera.projectionMatrix,HE),this._reprojectionMatrix=HE);const i=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=i>0?Math.min(i,e-this._ssrEnableTime)/i:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=Wr,this._ssrEnableTime=null}addRenderNode(e){this._nodes.add(e),this._requestRender()}removeRenderNode(e){this._nodes.remove(e),this._requestRender()}get usedMemory(){var e;return{fbos:this.fboCache.usedMemory,plugins:this._plugins.usedMemory,edges:((e=this.edgeView)==null?void 0:e.usedMemory)??0}}get _viewshedEnabled(){return this._viewshed.enabled&&this._plugins.produces(this._renderContext.output,Pe.VIEWSHED)}get test(){}}var LM,n1e;h([p({readOnly:!0})],JU.prototype,"fullResolutionAtmosphere",null),h([p()],JU.prototype,"_edgeView",void 0),h([p()],JU.prototype,"updating",null),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(LM||(LM={})),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.ShadowMap=2]="ShadowMap",t[t.HudVisibility=3]="HudVisibility",t[t.ViewshedShadowMap=4]="ViewshedShadowMap"}(n1e||(n1e={}));const o1e=[0,0,0,0],w7=[Pe.INTEGRATED_MESH,Pe.OPAQUE_TERRAIN,Pe.OPAQUE_MATERIAL,Pe.OPAQUE_NO_SSAO_DEPTH],v5=[Pe.TRANSPARENT_MATERIAL,Pe.TRANSPARENT_NO_SSAO_DEPTH],Wu=new ai,a1e=ke(),l1e=ke(),HE=ke();function m4t(t){return e=>t.immediate.schedule(e)}let g4t=class{constructor(e){this._rctx=e,this._vao=y4t(e)}destroy(){this._vao=Ut(this._vao)}draw(){this._vao!=null&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(Ci.TRIANGLES,0,3))}get test(){}};function y4t(t,e=zse,i=Ai){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new _y(t,i,{geometry:e},{geometry:Sr.createVertex(t,cr.STATIC_DRAW,r)})}let dVe=class pVe{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=pVe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return Sr.createIndex(this._rctx,cr.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,Rt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(Ci.POINTS,1,St.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){}},c1e=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Be.ONE,dstRGB:Be.ZERO,srcAlpha:Be.ONE,dstAlpha:Be.ZERO},this.blendEquation={mode:h_.ADD,modeAlpha:h_.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Pf.BACK,this.frontFace=lP.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=br.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Pf.FRONT_AND_BACK,func:br.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Pf.FRONT_AND_BACK,fail:bs.KEEP,zFail:bs.KEEP,zPass:bs.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.transformFeedbackBuffer=null,this.uniformBufferBindingPoints=new Array,this.transformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.drawBuffers={defaultFramebuffer:[no.BACK],fbos:new WeakMap},this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},_4t=class{constructor(){for(this._current=new Array,this._allocations=null;this._current.length<an.COUNT;)this._current.push(0)}increment(e,i,r=1){var s;this._current[e]+=r,(s=this._allocations)==null||s.add(i)}decrement(e,i,r=1){var s;this._current[e]-=r,(s=this._allocations)==null||s.remove(i)}get current(){return this._current}get total(){return this.current.reduce((e,i,r)=>e+(r<an.UNCOUNTED?i:0),0)}get resourceInformation(){var i;let e="";if(this.total>0){e+=`Live objects:
`;for(let r=0;r<an.COUNT;++r){const s=this._current[r];s>0&&(e+=`${an[r]}: ${s}
`)}}return e+=(i=this._allocations)==null?void 0:i.resetLog(),e}},v4t=class{constructor(e,i,r){const s=i.textureFilterAnisotropic,n=r.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=s?Math.min(e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY),n):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES),this.maxDrawBuffers=e.getParameter(e.MAX_DRAW_BUFFERS)}};const b4t=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var u1e,fVe={exports:{}};(u1e=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(fVe.exports=u1e);const w4t=zD(fVe.exports);var h1e,mVe={exports:{}};h1e=mVe,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(h1e.exports=e)}();const d1e=zD(mVe.exports);var gVe={exports:{}};(function(t){(function(e){var i=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();i!==void 0&&(t.exports=i)})()})(gVe);const x4t=zD(gVe.exports);var Op=999,p1e=9999,x7=0,T7=1,f1e=2,m1e=3,g1e=4,b5=5,T4t=6,S4t=7,E4t=8,y1e=9,C4t=10,_1e=11,M4t=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function A4t(){var t,e,i,r=0,s=0,n=Op,o=[],a=[],l=1,c=0,u=0,d=!1,f=!1,m="";return function(V){return a=[],V!==null?y(V.replace?V.replace(/\r\n/g,`
`):V):v()};function g(V){V.length&&a.push({type:M4t[n],data:V,position:u,line:l,column:c})}function y(V){var X;for(r=0,i=(m+=V).length;t=m[r],r<i;){switch(X=r,n){case x7:r=C();break;case T7:r=S();break;case f1e:r=x();break;case m1e:r=M();break;case g1e:r=U();break;case _1e:r=D();break;case b5:r=k();break;case p1e:r=H();break;case y1e:r=w();break;case Op:r=b()}X!==r&&(m[X]===`
`?(c=0,++l):++c)}return s+=r,m=m.slice(r),a}function v(V){return o.length&&g(o.join("")),n=C4t,g("(eof)"),a}function b(){return o=o.length?[]:o,e==="/"&&t==="*"?(u=s+r-1,n=x7,e=t,r+1):e==="/"&&t==="/"?(u=s+r-1,n=T7,e=t,r+1):t==="#"?(n=f1e,u=s+r,r):/\s/.test(t)?(n=y1e,u=s+r,r):(d=/\d/.test(t),f=/[^\w_]/.test(t),u=s+r,n=d?g1e:f?m1e:p1e,r)}function w(){return/[^\s]/g.test(t)?(g(o.join("")),n=Op,r):(o.push(t),e=t,r+1)}function x(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,r+1):(g(o.join("")),n=Op,r)}function S(){return x()}function C(){return t==="/"&&e==="*"?(o.push(t),g(o.join("")),n=Op,r+1):(o.push(t),e=t,r+1)}function M(){if(e==="."&&/\d/.test(t))return n=b5,r;if(e==="/"&&t==="*")return n=x7,r;if(e==="/"&&t==="/")return n=T7,r;if(t==="."&&o.length){for(;O(o););return n=b5,r}if(t===";"||t===")"||t==="("){if(o.length)for(;O(o););return g(t),n=Op,r+1}var V=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||V){for(;O(o););return n=Op,r}return o.push(t),e=t,r+1}function O(V){for(var X,q,Z=0;;){if(X=d1e.indexOf(V.slice(0,V.length+Z).join("")),q=d1e[X],X===-1){if(Z--+V.length>0)continue;q=V.slice(0,1).join("")}return g(q),u+=q.length,(o=o.slice(q.length)).length}}function D(){return/[^a-fA-F0-9]/.test(t)?(g(o.join("")),n=Op,r):(o.push(t),e=t,r+1)}function U(){return t==="."||/[eE]/.test(t)?(o.push(t),n=b5,e=t,r+1):t==="x"&&o.length===1&&o[0]==="0"?(n=_1e,o.push(t),e=t,r+1):/[^\d]/.test(t)?(g(o.join("")),n=Op,r):(o.push(t),e=t,r+1)}function k(){return t==="f"&&(o.push(t),e=t,r+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,r+1):/[^\d]/.test(t)?(g(o.join("")),n=Op,r):(o.push(t),e=t,r+1)}function H(){if(/[^\d\w_]/.test(t)){var V=o.join("");return n=w4t.indexOf(V)>-1?E4t:x4t.indexOf(V)>-1?S4t:T4t,g(o.join("")),n=Op,r}return o.push(t),e=t,r+1}}function P4t(t){var e=A4t(),i=[];return i=(i=i.concat(e(t))).concat(e(null))}function O4t(t){return P4t(t)}function R4t(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const S7=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function $4t(t,e="100",i="300 es"){const r=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of t)if(s.type==="preprocessor"){const n=r.exec(s.data);if(n){const o=n[1].replaceAll(/\s{2,}/g," ");if(o===i)return o;if(o===e)return s.data="#version "+i,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function I4t(t,e){for(let i=e-1;i>=0;i--){const r=t[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function xI(t,e,i,r){r=r||i;for(const s of t)if(s.type==="ident"&&s.data===i)return r in e?e[r]++:e[r]=0,xI(t,e,r+"_"+e[r],r);return i}function yVe(t,e,i="afterVersion"){function r(l,c){for(let u=c;u<l.length;u++){const d=l[u];if(d.type==="operator"&&d.data===";")return u}return null}function s(l){let c=-1,u=0,d=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(/#(if|ifdef|ifndef)\s+.+/.test(m.data)?++u:/#endif\s*.*/.test(m.data)&&--u),i!=="afterVersion"&&i!=="afterPrecision"||m.type==="preprocessor"&&m.data.startsWith("#version")&&(d=Math.max(d,f)),i==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const g=r(l,f);if(g===null)throw new Error("precision statement not followed by any semicolons!");d=Math.max(d,g)}c<d&&u===0&&(c=f)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=s(t);o(a-1)&&t.splice(a++,0,n);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,n)}function L4t(t,e,i,r="lowp"){yVe(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function D4t(t,e,i,r,s="lowp"){yVe(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function N4t(t,e){let i,r,s=-1;for(let n=e;n<t.length;n++){const o=t[n];if(o.type==="operator"&&(o.data==="["&&(i=n),o.data==="]")){r=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return i&&r&&t.splice(i,r-i+1),s}function v1e(t,e){if(t.startsWith("#version 300"))return t;const i=O4t(t);if($4t(i,"100","300 es")==="300 es")return t;let r=null,s=null;const n={},o={};for(let a=0;a<i.length;++a){const l=i[a];switch(l.type){case"keyword":e===_h.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===_h.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===_h.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(r||(r=xI(i,n,"fragColor"),L4t(i,r,"vec4")),l.data=r),e===_h.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=N4t(i,a+1),u=xI(i,n,"fragData");D4t(i,u,"vec4",c,"mediump"),l.data=u}else e===_h.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(s||(s=xI(i,n,"gl_FragDepth")),l.data=s);break;case"ident":if(b4t.includes(l.data)){if(e===_h.VERTEX_SHADER&&I4t(i,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=xI(i,n,l.data)),l.data=o[l.data]}}}for(let a=i.length-1;a>=0;--a){const l=i[a];if(l.type==="preprocessor"){const c=l.data.match(/#extension\s+(.*):/);if(c!=null&&c[1]&&S7.has(c[1].trim())){const f=i[a+1];i.splice(a,f&&f.type==="whitespace"?2:1)}const u=l.data.match(/#ifdef\s+(.*)/);u!=null&&u[1]&&S7.has(u[1].trim())&&(l.data="#if 1");const d=l.data.match(/#ifndef\s+(.*)/);d!=null&&d[1]&&S7.has(d[1].trim())&&(l.data="#if 0")}}return F4t(t,R4t(i))}function F4t(t,e){return e}const k4t=4294967295;let U4t=class{constructor(e,i,r,s,n=new Map,o=[]){var c;this._context=e,this._locations=s,this._uniformBlockBindings=n,this._transformFeedbackVaryings=o,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),i=v1e(i,_h.VERTEX_SHADER),r=v1e(r,_h.FRAGMENT_SHADER),this._vShader=b1e(this._context,_h.VERTEX_SHADER,i),this._fShader=b1e(this._context,_h.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(an.Shader,this),vJ()&&(this.vertexShader=i,this.fragmentShader=r),this.usedMemory=i.length+r.length;const a=this._context.gl,l=a.createProgram();a.attachShader(l,this._vShader),a.attachShader(l,this._fShader),this._locations.forEach((u,d)=>a.bindAttribLocation(l,u,d)),(c=this._transformFeedbackVaryings)!=null&&c.length&&a.transformFeedbackVaryings(l,this._transformFeedbackVaryings,a.SEPARATE_ATTRIBS),a.linkProgram(l),vJ()&&!a.getProgramParameter(l,a.LINK_STATUS)&&console.error(`Could not link shader
validated: ${a.getProgramParameter(l,a.VALIDATE_STATUS)}, gl error ${a.getError()}, vertex: ${a.getShaderParameter(this._vShader,a.COMPILE_STATUS)}, fragment: ${a.getShaderParameter(this._fShader,a.COMPILE_STATUS)}, info log: ${a.getProgramInfoLog(l)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[u,d]of this._uniformBlockBindings){const f=a.getUniformBlockIndex(l,u);f<k4t&&a.uniformBlockBinding(l,f,d)}this._glName=l,this._context.instanceCounter.increment(an.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get hasTransformFeedbackVaryings(){var e;return!!((e=this._transformFeedbackVaryings)!=null&&e.length)}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl,i=this._context.instanceCounter;this._nameToUniformLocation.forEach(r=>r&&i.decrement(an.Uniform,r)),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(i.decrement(an.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,i.decrement(an.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,i.decrement(an.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const i=this._nameToUniformLocation.get(e);if(i!==void 0)return i;if(this.glName){const r=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,r),r&&this._context.instanceCounter.increment(an.Uniform,r),r}return null}hasUniform(e){return this._getUniformLocation(e)!=null}setUniform1i(e,i){const r=this._nameToUniform1.get(e);r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1iv(e,i){Pm(this._nameToUniform1v,e,i)&&this._context.gl.uniform1iv(this._getUniformLocation(e),i)}setUniform2iv(e,i){Pm(this._nameToUniform2,e,i)&&this._context.gl.uniform2iv(this._getUniformLocation(e),i)}setUniform3iv(e,i){Pm(this._nameToUniform3,e,i)&&this._context.gl.uniform3iv(this._getUniformLocation(e),i)}setUniform4iv(e,i){Pm(this._nameToUniform4,e,i)&&this._context.gl.uniform4iv(this._getUniformLocation(e),i)}setUniform1f(e,i){const r=this._nameToUniform1.get(e);r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1fv(e,i){Pm(this._nameToUniform1v,e,i)&&this._context.gl.uniform1fv(this._getUniformLocation(e),i)}setUniform2f(e,i,r){const s=this._nameToUniform2.get(e);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),this._nameToUniform2.set(e,[i,r])):i===s[0]&&r===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),s[0]=i,s[1]=r)}setUniform2fv(e,i){Pm(this._nameToUniform2,e,i)&&this._context.gl.uniform2fv(this._getUniformLocation(e),i)}setUniform3f(e,i,r,s){const n=this._nameToUniform3.get(e);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,s),this._nameToUniform3.set(e,[i,r,s])):i===n[0]&&r===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,s),n[0]=i,n[1]=r,n[2]=s)}setUniform3fv(e,i){const r=this._getUniformLocation(e);r!=null&&Pm(this._nameToUniform3,e,i)&&this._context.gl.uniform3fv(r,i)}setUniform4f(e,i,r,s,n){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,s,n),this._nameToUniform4.set(e,[i,r,s,n])):o!==void 0&&i===o[0]&&r===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,s,n),o[0]=i,o[1]=r,o[2]=s,o[3]=n)}setUniform4fv(e,i){const r=this._getUniformLocation(e);r!=null&&Pm(this._nameToUniform4,e,i)&&this._context.gl.uniform4fv(r,i)}setUniformMatrix3fv(e,i,r=!1){const s=this._getUniformLocation(e);s!=null&&Pm(this._nameToUniformMatrix3,e,i)&&this._context.gl.uniformMatrix3fv(s,r,i)}setUniformMatrix4fv(e,i,r=!1){const s=this._getUniformLocation(e);s!=null&&Pm(this._nameToUniformMatrix4,e,i)&&this._context.gl.uniformMatrix4fv(s,r,i)}stop(){}};function b1e(t,e,i){const r=t.gl,s=r.createShader(e);return r.shaderSource(s,i),r.compileShader(s),vJ()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===_h.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(V4t(i))),s}function V4t(t){let e=2;return t.replaceAll(`
`,()=>`
`+z4t(e++)+":")}function z4t(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function Pm(t,e,i){const r=t.get(e);if(!r)return t.set(e,Array.from(i)),!0;const s=i.length;if(r.length!==s)return t.set(e,Array.from(i)),!0;for(let n=0;n<s;++n){const o=i[n];if(r[n]!==o){for(r[n]=o;n<s;++n)r[n]=i[n];return!0}}return!1}let B4t=class{constructor(e){this._rctx=e,this._store=new Db}dispose(){this._store.forEach(e=>e.forEach(i=>i.dispose())),this._store.clear()}acquire(e,i,r,s){const n=this._store.get(e,i);if(n!=null)return n.ref(),n;const o=new U4t(this._rctx,e,i,r,s);return o.ref(),this._store.set(e,i,o),o}get test(){}},iH=class{constructor(){this._result=!1}dispose(){this._program=Ut(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},j4t=class extends iH{constructor(e){super(),this._rctx=e,this._helperProgram=null,le("mac")&&le("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){var e;super.dispose(),(e=this._helperProgram)==null||e.dispose(),this._helperProgram=null}_test(e){const i=this._rctx,r=i.getBoundFramebufferObject(),{x:s,y:n,width:o,height:a}=i.getViewport();i.resetState();const l=new Xr(1);l.wrapMode=Mi.CLAMP_TO_EDGE,l.samplingMode=di.NEAREST;const c=new wy(i,l),u=Sr.createIndex(this._rctx,cr.STATIC_DRAW,new Uint8Array([0]));i.bindFramebuffer(c),i.setViewport(0,0,1,1),i.useProgram(this._helperProgram),i.bindBuffer(u,Rt.ELEMENT_ARRAY_BUFFER),i.drawElements(Ci.POINTS,1,St.UNSIGNED_BYTE,0),i.useProgram(e),i.bindVAO(null),i.drawArrays(Ci.TRIANGLES,0,258);const d=new Uint8Array(4);return c.readPixels(0,0,1,1,Ht.RGBA,fl.UNSIGNED_BYTE,d),i.setViewport(s,n,o,a),i.bindFramebuffer(r),c.dispose(),u.dispose(),d[0]===255}_prepareProgram(){const i=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${T.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,r=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${T.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(i,r,new Map([]))}_prepareHelperProgram(){const e=dVe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},G4t=class extends iH{constructor(e){super(),this._rctx=e,this._program=w1e(this._rctx,!1),this._obfuscated=w1e(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=Ut(this._obfuscated)}_test(e){if(le("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const i=this._rctx,r=i.getBoundFramebufferObject(),{x:s,y:n,width:o,height:a}=i.getViewport(),l=this._runProgram(e),c=this._runProgram(this._obfuscated);return i.setViewport(s,n,o,a),i.bindFramebuffer(r),l!==0&&(c===0||l/c>5)}_runProgram(e){const i=this._rctx;i.resetState();const r=new Xr(1);r.wrapMode=Mi.CLAMP_TO_EDGE,r.samplingMode=di.NEAREST;const s=new wy(i,r),n=Sr.createVertex(i,cr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Jf(i,new Map([["position",0]]),{geometry:[new Xf("position",2,St.UNSIGNED_SHORT,0,4)]},{geometry:n}),a=Ge(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=Ge(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);AJ(a,c,3);const u=new Float32Array(6);AJ(l,u,3),i.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",u[0],u[2],u[4]),e.setUniform3f("u_lowB",u[1],u[3],u[5]),i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(Ci.TRIANGLE_STRIP,0,4);const d=new Uint8Array(4);s.readPixels(0,0,1,1,Ht.RGBA,fl.UNSIGNED_BYTE,d),o.dispose(),s.dispose();const f=(a[2]-l[2])/25,m=eoe(d);return Math.abs(f-m)}};function w1e(t,e){const i=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `;return t.programCache.acquire(i,`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `,new Map([["position",0]]))}let H4t=class extends iH{constructor(e){var s,n;if(super(),this._rctx=e,!e.gl||!((s=e.capabilities.colorBufferFloat)!=null&&s.textureFloat&&((n=e.capabilities.colorBufferFloat)!=null&&n.floatBlend)))return;const i=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,r=new Xr(1);r.wrapMode=Mi.CLAMP_TO_EDGE,r.dataType=fl.FLOAT,r.internalFormat=xt.RGBA32F,r.samplingMode=di.NEAREST;const s=new wy(i,r),n=Sr.createVertex(i,cr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Jf(i,new Map([["a_pos",0]]),{geometry:[new Xf("a_pos",2,St.UNSIGNED_SHORT,0,4)]},{geometry:n});i.gl.getError(),i.useProgram(e);const a=i.getBoundFramebufferObject(),{x:l,y:c,width:u,height:d}=i.getViewport();i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(Ci.TRIANGLE_STRIP,0,4);const f=Jt({blending:Hh(Be.ZERO,Be.ONE_MINUS_SRC_ALPHA)});i.setPipelineState(f),i.drawArrays(Ci.TRIANGLE_STRIP,0,4);const m=i.gl.getError();return i.setViewport(l,c,u,d),i.bindFramebuffer(a),o.dispose(),s.dispose(),m!==i.gl.INVALID_OPERATION||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}};new Xf("a_pos",2,St.BYTE,0,2);new Xf("a_pos",2,St.BYTE,0,4),new Xf("a_tex",2,St.BYTE,2,4);const q4t={geometry:[new Xf("a_pos",2,St.UNSIGNED_SHORT,0,4)]};let W4t=class extends iH{constructor(e){super(),this._rctx=e;const i=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const i=this._rctx;if(!i.gl)return e.dispose(),!0;const r=new Xr(1);r.wrapMode=Mi.CLAMP_TO_EDGE,r.samplingMode=di.NEAREST;const s=new wy(i,r),n=Sr.createVertex(i,cr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Jf(i,new Map([["a_pos",0]]),q4t,{geometry:n}),a=new Xr;a.samplingMode=di.LINEAR,a.wrapMode=Mi.CLAMP_TO_EDGE;const l=new Er(i,a,TI);i.useProgram(e),i.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=i.getBoundFramebufferObject(),{x:u,y:d,width:f,height:m}=i.getViewport();i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.setClearColor(0,0,0,0),i.setBlendingEnabled(!1),i.clear(zr.COLOR_BUFFER_BIT),i.bindVAO(o),i.drawArrays(Ci.TRIANGLE_STRIP,0,4);const g=new Uint8Array(4);return s.readPixels(0,0,1,1,Ht.RGBA,fl.UNSIGNED_BYTE,g),o.dispose(),s.dispose(),l.dispose(),i.setViewport(u,d,f,m),i.bindFramebuffer(c),g[0]!==255}};const TI=new Image;TI.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",TI.width=5,TI.height=5,TI.decode();let Z4t=class{constructor(e){this.rctx=e,this.floatBufferBlend=new H4t(e),this.svgPremultipliesAlpha=new W4t(e),this.doublePrecisionRequiresObfuscation=new G4t(e),this.drawArraysRequiresIndicesTypeReset=new j4t(e)}dispose(){this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function Y4t(t,e){if(e.compressedTextureETC)return null;const i=t.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function X4t(t,e){if(e.compressedTextureS3TC)return null;const i=t.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function J4t(t,e){if(e.textureFilterAnisotropic)return null;const i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function Q4t(t,e){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),r=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}function K4t(t,e,i,r,s){if(e[i])return!1;for(const n of s)if(t.getExtension(n))return!0;return!1}function e5t(t,e){if(e.textureNorm16)return null;const i=t.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function t5t(t,e){const i=e.loseContext&&t.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}let i5t=class{constructor(e,i){this._gl=e,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._colorBufferFloat=null,this._loseContext=null,this._textureNorm16=null,this._textureFloatLinear=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get compressedTextureETC(){return this._compressedTextureETC??(this._compressedTextureETC=Y4t(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC??(this._compressedTextureS3TC=X4t(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic??(this._textureFilterAnisotropic=J4t(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery??(this._disjointTimerQuery=h4t(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get colorBufferFloat(){return this._colorBufferFloat??(this._colorBufferFloat=Q4t(this._gl,this._disabledExtensions)),this._colorBufferFloat}get loseContext(){return this._loseContext??(this._loseContext=t5t(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16??(this._textureNorm16=e5t(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear??(this._textureFloatLinear=K4t(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},r5t=class{constructor(e,i){this.gl=e,this.instanceCounter=new _4t,this.programCache=new B4t(this),this._transformFeedbackRequestInfo=null,this._state=new c1e,this._numOfDrawCalls=0,this._numOfTriangles=0,this._loadExtensions(),this.configure(i)}configure(e){this._capabilities=new i5t(this.gl,e),this._parameters=new v4t(this.gl,this._capabilities,e),Er.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new c1e,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new Sct({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const s=r.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const s=r.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=r.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)},setDrawBuffers:r=>{if(r)this.setDrawBuffers(r.buffers);else{const{drawFramebuffer:s}=this._state;s===null?this.setDrawBuffers([no.BACK]):s.colorAttachments.length===0?this.setDrawBuffers([no.NONE]):this.setDrawBuffers([Gn.COLOR_ATTACHMENT0])}}}),this.enforceState(),Ut(this._driverTest),this._driverTest=new Z4t(this)}dispose(){Ut(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Rt.ARRAY_BUFFER),this.unbindBuffer(Rt.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(Rt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Rt.PIXEL_PACK_BUFFER),this.unbindBuffer(Rt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Rt.COPY_READ_BUFFER),this.unbindBuffer(Rt.COPY_WRITE_BUFFER),this._state.textureUnitMap.length=0,af()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,i){for(let r=0;r<e.length;++r)this._state.textureUnitMap[e[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null),this._state.vertexArrayObject=null,this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,i,r,s){e===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(e,i,r,s),this._state.blendColor.r=e,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(e,i){e===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,i),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,i,r,s){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(e,i,r,s),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,i){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(e,i),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(e,i,r,s){this._state.colorMask.r===e&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===s||(this.gl.colorMask(e,i,r,s),this._state.colorMask.r=e,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(e,i,r,s){this._state.clearColor.r===e&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===s||(this.gl.clearColor(e,i,r,s),this._state.clearColor.r=e,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=s)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,i){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=i,this.gl.polygonOffset(e,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,i,r,s){this._state.scissorRect.x===e&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===s||(this.gl.scissor(e,i,r,s),this._state.scissorRect.x=e,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=s)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,i){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===i||(this.gl.depthRange(e,i),this._state.depthRange.zNear=e,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,i,r){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(e,i,r),this._state.stencilFunction.face=Pf.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,i,r,s){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(e,i,r,s),this._state.stencilFunction.face=e,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,i,r){this._state.stencilOperation.face===Pf.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(e,i,r),this._state.stencilOperation.face=Pf.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,i,r,s){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(e,i,r,s),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,i=!1){const r=this._state.activeTexture;return e>=0&&(i||e!==this._state.activeTexture)&&(this.gl.activeTexture(A8+e),this._state.activeTexture=e),r}setDrawBuffers(e){const{drawFramebuffer:i}=this._state,r=i===null,s=r?this._state.drawBuffers.defaultFramebuffer:this._state.drawBuffers.fbos.get(i);if((s==null?void 0:s.length)!==e.length||!s.every((n,o)=>n===e[o]))if(e.length>this.parameters.maxDrawBuffers)console.error("Setting more active draw buffers than GL.MAX_DRAW_BUFFERS allows.");else{if(r){if(e.length>1)return void console.error("The default framebuffer can only have one active draw buffer.");if(e[0]!==no.BACK&&e[0]!==no.NONE)return void console.error("The default framebuffer can only use the constants GL.BACK or GL.NONE as draw buffers.")}r||!e.includes(no.BACK)?(this.gl.drawBuffers(e),r?this._state.drawBuffers.defaultFramebuffer=e:this._state.drawBuffers.fbos.set(i,e),this._stateTracker.invalidateDrawBuffers()):console.error("A framebuffer object can only use the constants GL.COLOR_ATTACHMENTi or GL.NONE as draw buffers.")}}clear(e,i=255){var r;if(e){if(e&zr.COLOR_BUFFER_BIT){const s=(r=this._state.drawFramebuffer)==null?void 0:r.colorAttachments;s&&this.setDrawBuffers(s),this.setColorMask(!0,!0,!0,!0)}e&zr.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&zr.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(i),this.gl.clear(e)}}clearFramebuffer(e,i=!1,r=!1){let s=0;if(e){const o=Math.max(1e-13,e[3]);this.setClearColor(e[0],e[1],e[2],o),s|=zr.COLOR_BUFFER_BIT}i&&(s|=zr.DEPTH_BUFFER_BIT),r===!1?r=0:(r===!0&&(r=255),s|=zr.STENCIL_BUFFER_BIT),s&&this.clear(s,r)}drawArrays(e,i,r){var s,n;if(this._transformFeedbackRequestInfo){if(e!==this._transformFeedbackRequestInfo.primitiveType)throw new Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");if(((s=this._state.program)==null?void 0:s.hasTransformFeedbackVaryings)==null)throw new Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying")}if(af()){this._numOfDrawCalls++,this._numOfTriangles+=x1e(e,r);const o=this._state.textureUnitMap;for(let a=0;a<o.length;a++){const l=o[a];if(l!=null&&l===((n=this._state.drawFramebuffer)==null?void 0:n.colorTexture))throw new Error(`Detected readWrite. Texture already bound at index ${a}`)}}this.gl.drawArrays(e,i,r),bg(this.gl)}drawArraysInstanced(e,i,r,s){this.gl.drawArraysInstanced(e,i,r,s),bg(this.gl)}drawElements(e,i,r,s){if(this._transformFeedbackRequestInfo)throw new Error("Cannot called drawElements during a transform feedback request");if(af()&&(this._numOfDrawCalls++,this._numOfTriangles+=x1e(e,i)),this.gl.drawElements(e,i,r,s),af()){const n=JRe(this);if(n){const o=this.getBoundVAO(),a=o==null?void 0:o.indexBuffer,l=o==null?void 0:o.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},u={mode:e,count:i,type:r,offset:s},d=(a==null?void 0:a.size)??0,f=s+i,m=d<f?`. Buffer is too small. Attempted to draw index ${f} of ${d}`:"";console.error(`drawElements: ${n}${m}`,{args:u,vao:c})}}}logInfo(){af()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){af()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,i,r,s){r=Math.max(Math.round(r),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===e&&n.y===i&&n.width===r&&n.height===s||(n.x=e,n.y=i,n.width=r,n.height=s,this.gl.viewport(e,i,r,s))}setViewport4fv(e){this.setViewport(e[0],e[1],e[2],e[3])}restoreViewport({x:e,y:i,width:r,height:s}){this.setViewport(e,i,r,s)}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var i;this._state.program!==e&&((i=this._state.program)==null||i.stop(),this._state.program=e,this.gl.useProgram((e==null?void 0:e.glName)??null))}bindTexture(e,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[i];return(e==null?void 0:e.glName)==null?(s!=null&&(this.setActiveTexture(i,r),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[i]=null,s):r||s!==e?(this.setActiveTexture(i,r),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[i]=e,s):(e.isDirty&&(this.setActiveTexture(i,r),e.applyChanges()),s)}unbindTexture(e){if(e!=null)for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===e&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(e,i=!1){if(i||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(this._stateTracker.invalidateDrawBuffers(),e==null)return this.gl.bindFramebuffer(Qa.FRAMEBUFFER,null),void(this._state.readFramebuffer=this._state.drawFramebuffer=null);e.initializeAndBind(Qa.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,i,r=!1){const s=i===Qa.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(r||n!==e)&&(e==null?this.gl.bindFramebuffer(i,null):e.initializeAndBind(i),s?this._state.readFramebuffer=e??null:(this._stateTracker.invalidateDrawBuffers(),this._state.drawFramebuffer=e??null))}blitFramebuffer(e,i,r=0,s=0,n=e.width,o=e.height,a=0,l=0,c=i.width,u=i.height,d=zr.COLOR_BUFFER_BIT,f=di.NEAREST){this.bindFramebufferSeparate(e,Qa.READ_FRAMEBUFFER),this.bindFramebufferSeparate(i,Qa.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,s,n,o,a,l,c,u,d,f)}bindBuffer(e,i){if(e)switch(i??(i=e.bufferType),i){case Rt.ARRAY_BUFFER:this._state.vertexBuffer=dc(this.gl,e,i,this._state.vertexBuffer);break;case Rt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=dc(this.gl,e,i,this._state.indexBuffer);break;case Rt.UNIFORM_BUFFER:this._state.uniformBuffer=dc(this.gl,e,i,this._state.uniformBuffer);break;case Rt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=dc(this.gl,e,i,this._state.pixelPackBuffer);break;case Rt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=dc(this.gl,e,i,this._state.pixelUnpackBuffer);break;case Rt.COPY_READ_BUFFER:this._state.copyReadBuffer=dc(this.gl,e,i,this._state.copyReadBuffer);break;case Rt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=dc(this.gl,e,i,this._state.copyWriteBuffer);break;case Rt.TRANSFORM_FEEDBACK_BUFFER:this._state.transformFeedbackBuffer=dc(this.gl,e,i,this._state.transformFeedbackBuffer)}}bindRenderbuffer(e){const i=this.gl;e||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=e===Rt.UNIFORM_BUFFER?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let s=r[i];return s==null&&(s={buffer:null,offset:0,size:0},r[i]=s),s}bindBufferBase(e,i,r){const s=this._getBufferBinding(e,i);s!=null&&(s.buffer===r&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(e,i,r?r.glName:null),s.buffer=r,s.offset=0,s.size=0))}bindBufferRange(e,i,r,s,n){const o=this._getBufferBinding(e,i);o!=null&&(o.buffer===r&&o.offset===s&&o.size===n||(s%this._parameters.uniformBufferOffsetAlignment==0?(this.gl.bindBufferRange(e,i,r.glName,s,n),o.buffer=r,o.offset=s,o.size=n):console.error("Uniform buffer binding offset is not a multiple of the context offset alignment")))}bindUBO(e,i,r,s){i!=null?(af()&&(s??i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&s!==void 0?this.bindBufferRange(Rt.UNIFORM_BUFFER,e,i.buffer,r,s):this.bindBufferBase(Rt.UNIFORM_BUFFER,e,i.buffer)):this.bindBufferBase(Rt.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const s=this._state.uniformBufferBindingPoints[i];s!=null&&s.buffer===e.buffer&&this.bindBufferBase(Rt.UNIFORM_BUFFER,i,null)}}unbindBuffer(e){switch(e){case Rt.ARRAY_BUFFER:this._state.vertexBuffer=dc(this.gl,null,e,this._state.vertexBuffer);break;case Rt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=dc(this.gl,null,e,this._state.indexBuffer);break;case Rt.UNIFORM_BUFFER:this._state.uniformBuffer=dc(this.gl,null,e,this._state.uniformBuffer);break;case Rt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=dc(this.gl,null,e,this._state.pixelPackBuffer);break;case Rt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=dc(this.gl,null,e,this._state.pixelUnpackBuffer);break;case Rt.COPY_READ_BUFFER:this._state.copyReadBuffer=dc(this.gl,null,e,this._state.copyReadBuffer);break;case Rt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=dc(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}bindTransformFeedback(e){const{gl:i}=this;i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,e.glName)}beginTransformFeedback(e,i){if(this._transformFeedbackRequestInfo)throw new Error("Already in a transform feedback request");const{gl:r}=this;r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,e.glName),r.beginTransformFeedback(i),this._transformFeedbackRequestInfo={primitiveType:i}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw new Error("Not in a transform feedback request");const{gl:e}=this;e.endTransformFeedback(),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),this._transformFeedbackRequestInfo=null}async clientWaitAsync(e=10){const{gl:i}=this,r=i.fenceSync(_J.SYNC_GPU_COMMANDS_COMPLETE,0);if(!r)throw new Error("Client wait failed, could not create sync object");let s;this.instanceCounter.increment(an.Sync,r),i.flush();do await MS(e),s=i.clientWaitSync(r,0,0);while(s===Hz.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(an.Sync,r),i.deleteSync(r),s===Hz.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=Qa.FRAMEBUFFER){return e===Qa.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Rt.ARRAY_BUFFER),this.unbindBuffer(Rt.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(Rt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Rt.PIXEL_PACK_BUFFER),this.unbindBuffer(Rt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Rt.COPY_READ_BUFFER),this.unbindBuffer(Rt.COPY_WRITE_BUFFER);for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(Be.ONE,Be.ZERO),this.setBlendEquation(h_.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Pf.BACK),this.setFrontFace(lP.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(br.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(br.ALWAYS,0,0),this.setStencilOp(bs.KEEP,bs.KEEP,bs.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setDrawBuffers([no.BACK]),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var r,s,n;const{gl:e}=this;e.bindVertexArray(null);for(let o=0;o<this.parameters.maxVertexAttributes;o++)e.disableVertexAttribArray(o);this._state.vertexBuffer?e.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):e.bindBuffer(Rt.ARRAY_BUFFER,null),this._state.indexBuffer?e.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):e.bindBuffer(Rt.ELEMENT_ARRAY_BUFFER,null),this._state.uniformBuffer?e.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):e.bindBuffer(Rt.UNIFORM_BUFFER,null);for(let o=0;o<this._parameters.maxUniformBufferBindings;o++){const a=this._state.uniformBufferBindingPoints[o];if(a!=null){const{buffer:l,offset:c,size:u}=a;l!==null?c===0&&u===0?e.bindBufferBase(Rt.UNIFORM_BUFFER,o,l.glName):e.bindBufferRange(Rt.UNIFORM_BUFFER,o,l.glName,c,u):e.bindBufferBase(Rt.UNIFORM_BUFFER,o,null)}}if(this._state.pixelPackBuffer?e.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):e.bindBuffer(Rt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?e.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):e.bindBuffer(Rt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?e.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):e.bindBuffer(Rt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?e.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):e.bindBuffer(Rt.COPY_WRITE_BUFFER,null),e.bindFramebuffer(Qa.READ_FRAMEBUFFER,null),e.readBuffer(e.BACK),this._state.readFramebuffer&&(e.bindFramebuffer(Qa.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),e.readBuffer(Gn.COLOR_ATTACHMENT0)),e.bindFramebuffer(Qa.DRAW_FRAMEBUFFER,((r=this._state.drawFramebuffer)==null?void 0:r.glName)??null),this._state.drawFramebuffer===null){const o=this._state.drawBuffers.defaultFramebuffer;e.drawBuffers(o??[no.BACK])}else{const o=this._state.drawBuffers.fbos.get(this._state.drawFramebuffer);e.drawBuffers(o??[Gn.COLOR_ATTACHMENT0])}if(this._state.vertexArrayObject){const o=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(o)}e.useProgram(((s=this._state.program)==null?void 0:s.glName)??null),e.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),e.bindRenderbuffer(e.RENDERBUFFER,((n=this._state.renderbuffer)==null?void 0:n.glName)??null),this._state.blend===!0?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),e.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),e.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),e.clearDepth(this._state.clearDepth),e.clearStencil(this._state.clearStencil),e.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),e.cullFace(this._state.cullFace),e.depthFunc(this._state.depthFunction),e.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._state.depthWrite),e.frontFace(this._state.frontFace),e.lineWidth(1),this._state.faceCulling===!0?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),e.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._state.stencilWriteMask);for(let o=0;o<this.parameters.maxTextureImageUnits;o++){e.activeTexture(A8+o),e.bindTexture(Ns.TEXTURE_2D,null),e.bindTexture(Ns.TEXTURE_CUBE_MAP,null),e.bindTexture(Ns.TEXTURE_3D,null),e.bindTexture(Ns.TEXTURE_2D_ARRAY,null);const a=this._state.textureUnitMap[o];a!=null&&e.bindTexture(a.descriptor.target,a.glName)}e.activeTexture(A8+this._state.activeTexture);const i=this._state.viewport;e.viewport(i.x,i.y,i.width,i.height),this.resetInfo()}_loadExtensions(){this.gl.getExtension("KHR_parallel_shader_compile")}};function dc(t,e,i,r){return e?r!==e&&t.bindBuffer(i,e.glName):t.bindBuffer(i,null),e}function x1e(t,e){switch(t){case Ci.POINTS:return 2*e;case Ci.TRIANGLES:return e/3;case Ci.TRIANGLE_STRIP:case Ci.TRIANGLE_FAN:return e-2;default:return 0}}let s5t=class extends r5t{constructor(e,i,r){super(e,i),this.gl=e,this.newCache=r,this._appleAmdDriverHelper=null,this._refCount=1,this.screen=new g4t(this)}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){var e;super.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose(),this.screen.destroy()}bindTechnique(e,i,r,s,n){return this.useProgram(e.program),this.setPipelineState(e.getPipeline(!!n)),e.program.bindPass(r,i),s&&e.program.bindDraw(s,i,r),e.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??(this._appleAmdDriverHelper=new dVe(this)),this._appleAmdDriverHelper.run())}get test(){}};function T1e(t){return!!t.frameUpdate}let LC=class extends Ue{constructor(e,i,r){super({}),this._stage=e,this._techniques=i,this._rctx=r,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Us,this._frameTask=e.view.resourceController.scheduler.registerTask(It.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(Fs.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniques.acquire(Ioe,new Loe)),this._textureTechnique}acquire(e){const i=this._textures.get(e);return i?(i.ref(),i.loadingPromise??i):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(i=>{const r=i.texture.frameUpdate(i.previousToken);r>=0&&r!==i.previousToken&&(i.previousToken=r,e=!0)}),e&&this.events.emit("changed",ar.BACKGROUND)}_createNewRef(e){const i=this._stage.getObject(e);if(i==null)return vt(i!==void 0),null;const r=i.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(e)}),s=new n5t(e,()=>{this._frameTask.schedule(()=>{s.isUnreferenced&&i.unload()})});return this._textures.set(e,s),s.ref(),i.glTexture?(this._updateGLTexture(s,i.glTexture),T1e(i)&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule(()=>{const n=i.load(this._rctx),o=l=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,l),T1e(i)&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),s),a=l=>(this._loadingCount--,s.loadingPromise=null,os(l)||se.getLogger(this).error(l),null);return Fu(n)?n.then(o,a):o(n)}),s.loadingPromise)}_updateGLTexture(e,i){e.glTexture=i,this.events.emit("changed",ar.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};h([p()],LC.prototype,"_loadingCount",void 0),h([p()],LC.prototype,"_frameTask",void 0),h([p()],LC.prototype,"updating",null),LC=h([I("esri.views.3d.webgl-engine.lib.TextureRepository")],LC);let n5t=class{constructor(e,i){this.id=e,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(se.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function o5t(t,e){return new fNe(i=>Nbt(i,t),i=>i,e)}let SI=class extends Ue{constructor(){super(...arguments),this._passParameters=new a5t,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=Jl(this._resourcesTask),this._passParameters.waveNormal=Ut(this._passParameters.waveNormal),this._passParameters.wavePerturbation=Ut(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=uy(async i=>{await Promise.allSettled([this._loadImageResource(e,mr("esri/images/materials/water/normals.jpg"),r=>this._passParameters.waveNormal=r,i),this._loadImageResource(e,mr("esri/images/materials/water/perturbation.jpg"),r=>this._passParameters.wavePerturbation=r,i)])})),this._resourcesTask.finished?Rb.LOADED:Rb.LOADING}async _loadImageResource(e,i,r,s){try{const n=await m_(i,{signal:s});Dt(s);const o=new Xr(n.width,n.height);o.pixelFormat=Ht.RGB,o.samplingMode=di.LINEAR_MIPMAP_LINEAR,o.hasMipmap=!0,o.maxAnisotropy=8,r(new Er(e,o,n))}catch(n){se.getLogger(this).error("Failed to load water material normal texture.",n)}}};h([p()],SI.prototype,"_resourcesTask",void 0),h([p({type:Boolean,readOnly:!0})],SI.prototype,"updating",null),SI=h([I("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],SI);let a5t=class extends Fr{};const S1e=2048,l5t=1.5,c5t=8;function u5t(t,e){const{format:i,quality:r,rotation:s,disableDecorations:n}=t||{},o=Hae(t,e.padding),a=y5t(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=g5t(t,a),u=b5t(i),d=E5t[u];return{format:u,quality:Ne(r??d,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!!(t!=null&&t.ignoreBackground),ignorePadding:!!(t!=null&&t.ignorePadding)}}function h5t(t,e){const i=u5t(t,e),r=i.area,s=i.width/r.width,n=Hae(i,e.padding),o=n.left+n.right,a=n.top+n.bottom,l=e.width-o,c=e.height-a,u=Math.floor(l*s+o),d=Math.floor(c*s+a),f=(t==null?void 0:t.layers)??[],m=i.ignoreBackground,g=i.ignorePadding;return{framebufferWidth:u,framebufferHeight:d,region:{x:Math.floor(r.x*s)+n.left,y:Math.floor(r.y*s)+n.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:f,disableDecorations:i.disableDecorations,ignoreBackground:m,ignorePadding:g,objectAndLayerIdColor:!1}}function E7(t,e,i){const{ctx:r,canvas:s}=_Ve(t,i),n=r.getImageData(0,0,t.width,t.height),o=p5t(s,e);return vVe(s),{dataUrl:o,data:n}}function C7(t,e){const{ctx:i,canvas:r}=_Ve(t,e),s=i.getImageData(0,0,t.width,t.height);return vVe(r),s}function _Ve(t,e){const i=d5t();e.premultipliedAlpha&&x5t(t),i.width=t.width,i.height=t.height;const r=i.getContext("2d",{willReadFrequently:!0});return r.putImageData(t,0,0),e.flipY&&w5t(r),{ctx:r,canvas:i}}function vVe(t){t.width=0,t.height=0}function d5t(){return M7==null&&(M7=document.createElement("canvas")),M7}let M7=null;function p5t(t,e){const i=T5t[e.format],r=e.quality/100;return t.toDataURL(i,r)}function f5t(t,e,i,r=0,s=0,n=t.width-r,o=t.height-s,a=!1){const{data:l}=t,{width:c,height:u,data:d}=e,f=n/c,m=o/u,g=Math.ceil(f/2),y=Math.ceil(m/2),v=t.width;for(let b=0;b<u;b++)for(let w=0;w<c;w++){const x=4*(w+(a?u-b-1:b)*c);let S=0,C=0,M=0,O=0,D=0,U=0;const k=(b+.5)*m;for(let H=Math.floor(b*m);H<(b+1)*m;H++){const V=Math.abs(k-(H+.5))/y,X=(w+.5)*f,q=V*V;for(let Z=Math.floor(w*f);Z<(w+1)*f;Z++){const ye=Math.abs(X-(Z+.5))/g,L=Math.sqrt(q+ye*ye);if(L>=1)continue;let N=2*L*L*L-3*L*L+1;const z=4*(r+Z+(s+H)*v);U+=N*l[z+3],C+=N,M+=N*l[z],O+=N*l[z+1],D+=N*l[z+2],S+=N}}d[x]=M/S,d[x+1]=O/S,d[x+2]=D/S,d[x+3]=U/C}return e}function m5t(t,e,i){if(!e)return t;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:o}=t,a=Hae(t,i),l=a.left+a.right,c=a.top+a.bottom,u=r-l,d=s-c,f=Math.min(c5t,Math.min((S1e-l)/u,(S1e-c)/d));return f<l5t?t:{...t,framebufferWidth:Math.round(u*f)+l,framebufferHeight:Math.round(d*f)+c,pixelRatio:n*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:r,height:s}}}function g5t(t,e){if(!t)return e;const i=t.width,r=t.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return e;const s=e.width/e.height;return r==null?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}function y5t(t,e){const i={x:0,y:0,width:e.width,height:e.height};if(t!=null&&t.area){t.area.x!=null&&(i.x=Math.floor(t.area.x)),t.area.y!=null&&(i.y=Math.floor(t.area.y));const r=t.area.width!=null?Math.floor(t.area.width):null,s=t.area.height!=null?Math.floor(t.area.height):null;if(i.width=e.width-i.x,i.height=e.height-i.y,r!=null&&s!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,s);else if(r==null&&s!=null){const n=Math.min(i.width,r);i.height=n/i.width*i.height,i.width=n}else if(r!=null&&s==null){const n=Math.min(i.height,s);i.width=n/i.height*i.width,i.height=n}}return _5t(v5t(i,t),e)}function _5t(t,e){const i=Math.floor(Math.max(t.x,0)),r=Math.floor(Math.max(t.y,0)),s={x:i,y:r,width:Math.floor(Math.min(t.width,e.width-i)),height:Math.floor(Math.min(t.height,e.height-r))},n=s.width/s.height,o=t.width/t.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),u=s.height-c;return{x:s.x,y:Math.floor(s.y+u/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function v5t(t,e){if((e==null?void 0:e.width)==null||e.height==null)return t;const i=e.width/e.height,r=t.width/t.height;if(r===i)return t;if(r<i){const n=Math.floor(t.height*i);return t.x-=(n-t.width)/2,t.width=n,t}const s=Math.floor(t.width/i);return t.y-=(s-t.height)/2,t.height=s,t}function Hae(t,e){return!e||t!=null&&t.ignorePadding?C5t:e}function b5t(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return S5t}}function w5t(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function x5t(t){const e=t.data,i=e.length;for(let r=0;r<i;r+=4){const s=e[r+3];if(s!==255&&s>0){const n=255/s;e[r]=e[r]*n,e[r+1]=e[r+1]*n,e[r+2]=e[r+2]*n}}}const T5t={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},E1e=98,S5t="png",E5t={png:100,jpg:E1e,jpeg:E1e},C5t={top:0,right:0,bottom:0,left:0};let M5t=class{constructor(e,i,r){this.parameters=e,this.frameHasDecorations=i,this.fbos=r}},A5t=class{constructor(e,i,r){this._rctx=e,this._renderFunctions=i,this._forceCameraHook=r,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(ar.BACKGROUND);const i=aa();return this._screenshotQueue.push({settings:e,resolver:i}),i.promise}update(e,i){for(const r of this._screenshotQueue){if(this._rctx==null){r.resolver.reject();continue}const s={...r.settings,pixelRatio:r.settings.pixelRatio*e.parameters.camera.pixelRatio},n=this._renderScreenshot(e,s,i);r.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,i,r){e.width=i.width,e.height=i.height;const s=e.getContext("2d"),n=r.pixelRatio;return s.save(),s.translate(0,i.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(n,n),i=this._renderFunctions.renderOverlay(e,r.disableDecorations?Zl.OFF:Zl.ON,i),s.restore(),i}_readbackScreenshot(e,i){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},i):this._readbackScreenshotImmediate(e,i)}_readbackScreenshotResampled(e,i){const{framebufferWidth:r,framebufferHeight:s,region:n,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=f9(r,s,a);this._rctx.gl.readPixels(0,0,r,s,Ht.RGBA,St.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=f9(n.width,n.height,a);return f5t(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,i){const{framebufferHeight:r,region:s}=e,n=this._ensureScreenshotEncodeCanvas(),o=f9(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,Ht.RGBA,St.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(n,o,e)}_renderScreenshot(e,i,r){const s=e.parameters.camera,n={width:i.framebufferWidth,height:i.framebufferHeight};FT(n,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let o=!1;const a=i.disableDecorations&&e.frameHasDecorations,l=n.width!==s.fullWidth||n.height!==s.fullHeight,c=i.ignorePadding&&s.pixelRatio!==i.pixelRatio,u=l||a||c||i.objectAndLayerIdColor;let d=null,f=null;if(u){const v=s.clone();if(i.ignorePadding){const C=xD(v.padding);for(let M=0;M<4;M++)C[M]=Math.round(C[M]/v.pixelRatio*i.pixelRatio);v.padding=C}v.fullWidth=n.width,v.fullHeight=n.height,v.pixelRatio=i.pixelRatio;const b=s.fovX-v.fovX,w=s.fovY-v.fovY;b<0&&b<w?v.fovX=s.fovX:w<0&&w<b&&(v.fovY=s.fovY);const x={camera:v,contentCamera:v,mode:$i.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio};this._forceCameraHook(x),o=!0;const S=this._renderFunctions.renderScene(x,r,i.objectAndLayerIdColor?pf.ObjectAndLayerID:pf.Screenshot,i.disableDecorations?Zl.OFF:Zl.ON);f=S.screen,d=S.oid}const m=()=>{this._rctx.bindFramebuffer(null),f==null||f.release()};this._rctx.bindFramebuffer(f==null?void 0:f.fbo);const g=this._readbackScreenshot(i,m);let y=null;if(i.objectAndLayerIdColor){const v=()=>{this._rctx.bindFramebuffer(null),d==null||d.release()};this._rctx.bindFramebuffer(d==null?void 0:d.fbo),y=this._readbackScreenshot(i,v),this._rctx.bindFramebuffer(null)}if(u&&!this._rctx.contextAttributes.alpha)for(let v=3;v<g.data.length;v+=4)g.data[v]=255;if(y&&!this._rctx.contextAttributes.alpha)for(let v=3;v<y.data.length;v+=4)y.data[v]=255;return o&&this._forceCameraHook(e.parameters),[g,y]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}};function lee(t,e={}){return t.getContext("webgl2",e)||null}let ga=class extends Ue{constructor(e){super({}),this.events=new Us,this.waterTextures=new SI,this.objectAndLayerIdRenderHelper=le("enable-feature:objectAndLayerId-rendering")?new OFt:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode;try{this._initializeContext(e)}catch(s){return void console.error("Failed to initialize context",s)}const{memoryController:i}=e.view.resourceController;this.stippleTextures=H1t(this._rctx,i),this.markerTextures=o5t(this._rctx,i),this._techniques=new aNe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextures:this.stippleTextures,waterTextures:this.waterTextures,markerTextures:this.markerTextures}),this._textures=new LC(e,this._techniques,this._rctx),this.addHandles(this._textures.events.on("changed",s=>this.requestRender(s))),this._materials=new lNe(this._textures,this._techniques,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new fFt(this._rctx,this._techniques),this.renderer=new JU(e,this._materials,this._techniques,this._rctx,this._compositingHelper,s=>this.requestRender(s)),this.addHandles([te(()=>e.view.ready,s=>{s&&this._createRenderNodes(e.view,e.viewingMode)},$t),te(()=>{var s;return(s=this.waterTextures)==null?void 0:s.updating},()=>this.requestRender(),$t),te(()=>e.view.qualityProfile,s=>{var n;return(n=this.renderer)==null?void 0:n.updateRenderFeatures(s)},hr)]);const r={renderScene:(s,n,o,a)=>this.renderer.render(s,n,o,a),requestRenderScene:s=>this.requestRender(s),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(s,n,o)=>e.options.screenshot.renderOverlay(s,n,o)};this._screenshotManager=new A5t(this._rctx,r,s=>this.events.emit("force-camera-for-screenshot",s)),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=$r(this._frameTask),this._techniques=qe(this._techniques),this._componentObjects=qe(this._componentObjects),this._screenshotManager=qe(this._screenshotManager),qe(this.renderer),this._textures=qe(this._textures),qe(this.waterTextures),qe(this.markerTextures),qe(this.stippleTextures),this._canvas=null,this._container=null,this._rctx=qe(this._rctx)}_createRenderNodes(e,i){new Vx({view:e,isEnabled:()=>this.renderer.hasSSAO,techniques:this._techniques}),new Kv({view:e,isEnabled:()=>this.renderer.hasSMAA,techniques:this._techniques}),new Qv({view:e,techniques:this._techniques}),new IC({view:e,techniques:this._techniques}),new Xx({view:e,viewingMode:i,techniques:this._techniques})}requestRender(e=ar.UPDATE){this._needsRender=!0,e===ar.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textures.updating||this.waterTextures.updating}get textures(){return this._textures}get compositingHelper(){return this._compositingHelper}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(i=>i[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,i,r,s,n,o=n){const a=s.constrainWindowSize(i,r,n*s.pixelRatio,o*s.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(a,l);let c=Number.MAX_VALUE;for(let u=0;u<a[2]*a[3];u++){const d=vFt(4*u,l,s.nearFar);c>d&&d!==s.nearFar[0]&&d!==s.nearFar[1]&&(c=d)}if(e){const u=e.pickDepth(i*s.pixelRatio,r*s.pixelRatio,s);u!=null&&c>u&&u!==s.nearFar[0]&&u!==s.nearFar[1]&&(c=u)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const i=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<i)&&(this._tmpDepthBuffer=new Uint8Array(i)),this._tmpDepthBuffer}async reloadShaders(){mke(),await this._techniques.reloadAll(),this.requestRender()}_registerFrameTask(e){const i=e.view.state;let r=!1,s=ar.BACKGROUND,n=!1;const o={preRender:({time:a})=>{r=this.updating,s=this._needsUpdate?ar.UPDATE:ar.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||i.forcedAnimationTime!=null||r||this._needsRender){const c=l/this.renderer.animationTimeDilation,u=new k3e(i.camera,c,i.forcedAnimationTime);this.renderer.updateAnimation(u)&&this.requestRender(ar.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&i.camera.fullWidth>0&&i.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(i,a),n=!0,l&&this.renderer.hasReflections&&(this.requestRender(ar.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=this.renderer.hasSlicePlane||this.renderer.hasDecorations||this.renderer.hasHighlights,c=new M5t(i,l,this.renderer.fboCache);this._textures.update(),this._screenshotManager.update(c,a)},finish:()=>{n&&(this.renderer.finish(i.mode===$i.IDLE?s:ar.UPDATE),n=!1)}};this._frameTask=PS(o)}_initializeContext(e){const i=e.options;this._canvas=i.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:i.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:i.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:i.preserveDrawingBuffer??!1},s=lee(this._canvas,r);s!=null?(this._rctx=P5t(s,e),this._loadShaderOnlyExtensions(),!i.alpha&&this._rctx.contextAttributes.alpha&&se.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&le("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):se.getLogger(this).error("A WebGL2 context could not be created.")}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloatLinear")}getObjectAndLayerIdColor(e){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return this._componentObjects==null&&(this._componentObjects=new zNt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjects}set componentObjectCollection(e){this._componentObjects=e}};function P5t(t,e){const i={disabledExtensions:e.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:e.options.debugWebGLExtensions||{},maxAnisotropy:8},r=(s,n)=>e.view.resourceController.memoryController.newCache(s,n);return new s5t(t,i,r)}h([p({type:Boolean,readOnly:!0})],ga.prototype,"updating",null),h([p()],ga.prototype,"_rctx",void 0),h([p()],ga.prototype,"_container",void 0),h([p()],ga.prototype,"_canvas",void 0),h([p()],ga.prototype,"stippleTextures",void 0),h([p()],ga.prototype,"markerTextures",void 0),h([p()],ga.prototype,"waterTextures",void 0),h([p({readOnly:!0})],ga.prototype,"objectAndLayerIdRenderHelper",void 0),h([p()],ga.prototype,"_textures",void 0),h([p({readOnly:!0})],ga.prototype,"renderer",void 0),h([p()],ga.prototype,"_screenshotManager",void 0),h([p()],ga.prototype,"componentObjectCollection",null),h([p()],ga.prototype,"_componentObjects",void 0),h([p()],ga.prototype,"_needsUpdate",void 0),h([p()],ga.prototype,"_needsWaterReflectionUpdate",void 0),ga=h([I("esri.views.3d.webgl-engine.parts.RenderView")],ga);let rh=class extends Ue{constructor(e){super(e),this._model=new BU,this._layers=new ai,this._asyncChangeSet=new SJ,this._syncChangeSet=new SJ,this._layerSyncSet=new Set}initialize(){this._set("renderView",new ga(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(It.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.renderView.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),OB(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e!=null&&!this.destroyed&&this._model.remove(e)&&(OB(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){var i,r;e!=null&&((i=this._model)==null||i.removeMany(e),(r=this.renderView)==null||r.requestRender())}forEachOfType(e,i){this._model.forEachOfType(e,i)}handleEvent(e,i){this.destroyed||(this._model.dirtySet[e](i),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){if(this._frameTask.processQueue(e),this._commit(e),!e.hasProgressed)return na}_commit(e){const i=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{if(e.done)return;const s=this._layerSyncSet.has(r.id)||r.updatePolicy===ab.SYNC,n=s?this._syncChangeSet:this._asyncChangeSet;i.commitLayer(r.id,n),this._layerSyncSet.delete(r.id),n.empty||(this.renderer.modify(n,s?Eu:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Eu),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{e.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==ab.ASYNC||(i.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(i=>{this._layerSyncSet.has(i.id)||i.updatePolicy===ab.SYNC?(e.commitLayer(i.id,this._syncChangeSet),this._layerSyncSet.delete(i.id)):e.commitSyncUpdates(i.id,this._syncChangeSet)});for(const i of this._layerSyncSet)e.commitLayer(i,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Eu),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Eu),this.renderView.requestRender())}schedule(e,i){return this._frameTask.schedule(e,i)}reschedule(e,i){return this._frameTask.reschedule(e,i)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,Eu))}addRenderPlugin(e,i){const r=this.renderer.plugins.add(e,i),s=()=>{N_e(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if(Fu(r))return r.then(s);s()}removeRenderPlugin(e){this.destroyed||(N_e(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.plugins.remove(e))}get performanceInfo(){return this._model.getStats()}get test(){}};rh.DebugSettings={endFrameContentValidation:!1},h([p({constructOnly:!0})],rh.prototype,"view",void 0),h([p({constructOnly:!0})],rh.prototype,"options",void 0),h([p({readOnly:!0})],rh.prototype,"viewingMode",null),h([p({constructOnly:!0})],rh.prototype,"container",void 0),h([p({readOnly:!0})],rh.prototype,"updating",null),h([p({constructOnly:!0})],rh.prototype,"_model",void 0),h([p()],rh.prototype,"renderView",void 0),h([p({readOnly:!0})],rh.prototype,"renderer",null),h([p({readOnly:!0})],rh.prototype,"running",null),rh=h([I("esri.views.3d.webgl-engine.Stage")],rh);function C1e(t){return t&&typeof t.highlight=="function"}function O5t(t){return t&&typeof t.maskOccludee=="function"}function R5t(t,e,i){return t==null||t>=i&&(e===0||t<=e)}function uui(t,e){if(e&&t){const{minScale:i,maxScale:r}=t;if($5t(i,r))return R5t(e,i,r)}return!0}function $5t(t,e){return t!=null&&t>0||e!=null&&e>0}function hui(t){return!(t!=null&&t.minScale)||!t.maxScale||t.minScale>=t.maxScale}let A7;function I5t(){return A7||(A7=N5t()),A7}let L5t=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}};function D5t(t){if(typeof WebGL2RenderingContext>"u")return null;const e=document.createElement("canvas");if(!e)return null;let i=lee(e,{failIfMajorPerformanceCaveat:!0});if(i==null&&(i=lee(e),i!=null&&(t.majorPerformanceCaveat=!0)),i==null)return i;t.available=!0,t.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const r=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return r&&(t.supportsHighPrecisionFragment=r.precision>0),i}function N5t(){const t=new L5t,e=D5t(t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function F5t(t){const e=I5t();return e.available?t==="3d"&&e.majorPerformanceCaveat?new G("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):e.supportsHighPrecisionFragment?e.supportsVertexShaderSamplers?null:new G("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new G("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new G("webgl:required","WebGL2 is required but not supported.",new Error().stack)}function k5t(t){return t&&"nodeType"in t}function U5t(t){return t&&typeof t.render=="function"}const M1e={component:"esri-component"};let Qx=class extends Ue{constructor(){super(...arguments),this.widget=null}destroy(){var e;this.node=null,(e=this.widget)==null||e.destroy()}get id(){var e,i;return this._get("id")??((e=this.widget)==null?void 0:e.id)??((i=this.node)==null?void 0:i.id)}set id(e){this._set("id",e)}set node(e){const i=this._get("node");e!==i&&(e&&e.classList.add(M1e.component),i&&i.classList.remove(M1e.component),this._set("node",e))}castNode(e){var i;return(i=this.widget)==null||i.destroy(),e?typeof e=="string"||k5t(e)?(this._set("widget",null),pG(e)):(U5t(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};h([p()],Qx.prototype,"id",null),h([p()],Qx.prototype,"node",null),h([Kt("node")],Qx.prototype,"castNode",null),h([p({readOnly:!0})],Qx.prototype,"widget",void 0),Qx=h([I("esri.views.ui.Component")],Qx);const QU=Qx,bVe="calcite-mode-";function V5t(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function wVe(){return V5t().startsWith("dark")}function z5t(){return`${bVe}${wVe()?"dark":"light"}`}function B5t(t){j5t(t),t.classList.add(z5t())}function j5t(t){Array.from(t.classList).forEach(e=>{e.startsWith(bVe)&&t.classList.remove(e)})}const G5t={left:0,top:0,bottom:0,right:0},xVe={bottom:30,top:15,right:15,left:15},qy="esri-ui",Qc={ui:qy,corner:`${qy}-corner`,innerContainer:`${qy}-inner-container`,manualContainer:`${qy}-manual-container`,cornerContainer:`${qy}-corner-container`,topLeft:`${qy}-top-left`,topRight:`${qy}-top-right`,bottomLeft:`${qy}-bottom-left`,bottomRight:`${qy}-bottom-right`};function H5t(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function w5(t){return t===0?"0":`${t}px`}function P7(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function O7(t,{top:e,bottom:i,left:r,right:s}){t.style.top=e,t.style.bottom=i,t.style.left=r,t.style.right=s}let Jm=class extends Us.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol"),this._locale=Ou(),this.view=null,this._applyViewPadding=()=>{const i=this.container;i&&O7(i,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const i=this._innerContainer;i&&O7(i,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([te(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,$t),te(()=>this.padding,this._applyUIPadding,$t),te(()=>[this.container,this._locale],([e,i])=>{e&&e.setAttribute("lang",i)},$t),sTe(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const i=this._get("container");e!==i&&(e&&(e.classList.add(Qc.ui),B5t(e),this._attachContainers(e)),i&&(i.classList.remove(Qc.ui),O7(i,{top:"",bottom:"",left:"",right:""}),bMe(i)),this._set("container",e))}get height(){var n;const e=((n=this.view)==null?void 0:n.height)??0;if(e===0)return e;const i=this._getViewPadding(),{top:r,bottom:s}=i;return Math.max(e-r-s,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...xVe,...e}}get width(){var n;const e=((n=this.view)==null?void 0:n.width)??0;if(e===0)return e;const i=this._getViewPadding(),{left:r,right:s}=i;return Math.max(e-r-s,0)}add(e,i){let r,s,n;if(Array.isArray(e))return void e.forEach(a=>this.add(a,i));const o=P7(e);o&&({index:r,position:i,component:e,key:s}=o),i&&typeof i=="object"&&({index:r,key:s,position:i,internal:n}=i),!e||i&&!this._isValidPosition(i)||this._add(e,i,r,s,n)}remove(e,i){var s,n;if(!e)return;if(Array.isArray(e))return e.map(o=>this.remove(o,i));const r=this._find(e);if(r){if(this._componentMap.has(r)&&((s=this._componentMap.get(r))==null?void 0:s.key)!==i)return;const o=this._components.indexOf(r),a=r.node.parentNode;return a==null||a.removeChild(r.node),this._componentMap.delete(r),(n=r.widget)==null||n.removeHandlesReference(this._removeWidgetHandleKey),this._components.splice(o,1)[0]}}empty(e,i={removeInternal:!1}){if(Array.isArray(e)){for(const n of e)this.empty(n,i);return}const r=this._positionNameToContainerLookup[e??"manual"],s=Array.prototype.slice.call(r.children).map(n=>this._findByNode(n)).filter(n=>{var o;return n==null?!1:!(((o=this._componentMap.get(n))==null?void 0:o.internal)??!1)||i.removeInternal});for(const n of s)this.remove(n)}move(e,i){if(Array.isArray(e)&&e.forEach(o=>this.move(o,i)),!e)return;let r;const s=P7(e)||P7(i);if(s&&(r=s.index,i=s.position,e=s.component||e),i&&!this._isValidPosition(i))return;const n=this.remove(e);n&&this.add(n,{position:i,index:r})}find(e){if(!e)return null;const i=this._findById(e);return i&&(i.widget||i.node)}getComponents(e,i={includeInternal:!1}){return e?Array.isArray(e)?e.flatMap(r=>this._getComponentsAtPosition(r,i)):this._getComponentsAtPosition(e,i):this._components.filter(r=>{var s;return i.includeInternal||!((s=this._componentMap.get(r))!=null&&s.internal)}).map(({widget:r,node:s})=>r??s)}getPosition(e){for(const i in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[i].contains(e))return i;return null}_add(e,i,r,s,n){e instanceof QU||(e=new QU({node:e}));const{widget:o}=e;o!=null&&o instanceof Ue&&o.addHandles(Gi(()=>{queueMicrotask(()=>this.remove(e))}),this._removeWidgetHandleKey),this._place({component:e,position:i,index:r}),this._components.push(e),this._componentMap.set(e,{key:s,internal:n})}_find(e){return e?e instanceof QU?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){var e;return((e=this.view)==null?void 0:e.padding)??G5t}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(Qc.innerContainer,Qc.cornerContainer);const i=document.createElement("div");i.classList.add(Qc.innerContainer,Qc.manualContainer);const r=document.createElement("div");r.classList.add(Qc.topLeft,Qc.corner),e.appendChild(r);const s=document.createElement("div");s.classList.add(Qc.topRight,Qc.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(Qc.bottomLeft,Qc.corner),e.appendChild(n);const o=document.createElement("div");o.classList.add(Qc.bottomRight,Qc.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=i;const a=Cb();this._cornerNameToContainerLookup={"top-left":r,"top-right":s,"bottom-left":n,"bottom-right":o,"top-leading":a?s:r,"top-trailing":a?r:s,"bottom-leading":a?o:n,"bottom-trailing":a?n:o},this._positionNameToContainerLookup={manual:i,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const i=e.position??"manual",{component:r,index:s}=e,n=this._positionNameToContainerLookup[i],o=s!=null&&s>-1;if(H5t(r.widget)&&r.widget.startup(),!o)return void n.appendChild(r.node);const a=Array.from(n.children);if(s===0)return void(n.firstChild?Dhe(r.node,n.firstChild):n.appendChild(r.node));s>=a.length?n.appendChild(r.node):Dhe(r.node,a[s])}_toPixelPosition(e){return{top:w5(e.top),left:w5(e.left),right:w5(e.right),bottom:w5(e.bottom)}}_findByComponent(e){return this._components.find(i=>i===e)??null}_findById(e){return this._components.find(({id:i})=>i===e)??null}_findByNode(e){return this._components.find(({node:i})=>i===e)??null}_getComponentsAtPosition(e,i){const r=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(r.children).map(s=>this._findByNode(s)).filter(op).filter(s=>{var n;return i.includeInternal||!((n=this._componentMap.get(s))!=null&&n.internal)}).map(({widget:s,node:n})=>s??n)}};h([p()],Jm.prototype,"_locale",void 0),h([p()],Jm.prototype,"container",null),h([p()],Jm.prototype,"height",null),h([p({value:xVe})],Jm.prototype,"padding",null),h([Kt("padding")],Jm.prototype,"castPadding",null),h([p()],Jm.prototype,"view",void 0),h([p()],Jm.prototype,"width",null),Jm=h([I("esri.views.ui.UI")],Jm);const q5t=Jm,W5t={handleInterceptedEvent:(t,e,i,r)=>(t.scheduleRender(),e.properties[`on${r.type}`].apply(e.properties.bind||i,[r]))},Z5t={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}},Y5t=t=>({...Z5t,...t}),X5t=(t,e)=>{const i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i},J5t=(t,e)=>t.find(e),A1e=(t,e,i=!1)=>{let r=t;return e.forEach((s,n)=>{const o=r!=null&&r.children?J5t(r.children,a=>a.domNode===s):void 0;i&&!o&&n!==e.length-1||(r=o)}),r},Q5t=t=>{let e;const i={...W5t,...t},r=Y5t(i),s=r.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],u=(f,m,g)=>{var b;let y;r.eventHandlerInterceptor=(w,x,S,C)=>function(M){let O;s("domEvent",M);const D=X5t(M.currentTarget,y.domNode),U=D.some(H=>{var V;return customElements.get((V=H==null?void 0:H.tagName)==null?void 0:V.toLowerCase())});if(M.eventPhase===Event.CAPTURING_PHASE||!U)D.reverse(),O=A1e(y.getLastRender(),D);else{const H=M.composedPath(),V=H.slice(H.indexOf(M.currentTarget),H.indexOf(y.domNode)).reverse();O=A1e(y.getLastRender(),V,!0)}let k;return O&&(k=i.handleInterceptedEvent(e,O,this,M)),s("domEventProcessed",M),k},(b=i.postProcessProjectionOptions)==null||b.call(i,r);const v=g();y=f(m,v,r),r.eventHandlerInterceptor=void 0,l.push(y),c.push(g),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(y,v)};let d=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();s("rendered",void 0),l[f].update(m),s("patched",void 0)}s("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(d=i.modifyDoRenderImplementation(d,l,c)),e={renderNow:d,scheduleRender:()=>{n||a||(n=requestAnimationFrame(d))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(f,m)=>{u(V1.append,f,m)},insertBefore:(f,m)=>{u(V1.insertBefore,f,m)},merge:(f,m)=>{u(V1.merge,f,m)},replace:(f,m)=>{u(V1.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},e};/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
 * v2.11.1
 */const TVe="calcite-mode-auto",SVe="calcite-mode-dark",K5t="calcite-mode-light",mui={autoMode:TVe,darkMode:SVe,lightMode:K5t,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"},gui={filter:250,nextTick:0,resize:150,reposition:100};/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
 * v2.11.1
 */const r_=globalThis.calciteConfig,yui=(r_==null?void 0:r_.focusTrapStack)||[],_ui=(r_==null?void 0:r_.logLevel)||"info",P1e="2.11.1",ekt="2024-08-02",tkt="dff26357be7ecaa7cefeb1bc2522fd54177aea87";function ikt(){if(r_&&r_.version)return;console.info(`Using Calcite Components ${P1e} [Date: ${ekt}, Revision: ${tkt}]`);const t=r_||globalThis.calciteConfig||{};Object.defineProperty(t,"version",{value:P1e,writable:!1}),globalThis.calciteConfig=t}var Eg={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,formAssociated:!1,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0,experimentalSlotFixes:!1},rkt=Object.defineProperty,skt=(t,e)=>{for(var i in e)rkt(t,i,{get:e[i],enumerable:!0})},EVe=new WeakMap,N2=t=>EVe.get(t),nkt=(t,e)=>{const i={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return EVe.set(t,i)},O1e=(t,e)=>e in t,hN=(t,e)=>(0,console.error)(t,e),sj=new Map,okt=[],akt="slot-fb{display:contents}slot-fb[hidden]{display:none}",R1e="http://www.w3.org/1999/xlink",dN=typeof window<"u"?window:{},zf=dN.document||{head:{}},vui=dN.HTMLElement||class{},Na={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,i,r)=>t.addEventListener(e,i,r),rel:(t,e,i,r)=>t.removeEventListener(e,i,r),ce:(t,e)=>new CustomEvent(t,e)},lkt=(()=>{let t=!1;try{zf.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),ckt=t=>Promise.resolve(t),ukt=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),cee=!1,uee=[],CVe=[],MVe=(t,e)=>i=>{t.push(i),cee||(cee=!0,e&&Na.$flags$&4?hkt(hee):Na.raf(hee))},$1e=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(i){hN(i)}t.length=0},hee=()=>{$1e(uee),$1e(CVe),(cee=uee.length>0)&&Na.raf(hee)},hkt=t=>ckt().then(t),bui=MVe(uee,!1),dkt=MVe(CVe,!0),pkt=t=>{const e=new URL(t,Na.$resourcesUrl$);return e.origin!==dN.location.origin?e.href:e.pathname},fkt=t=>Na.$resourcesUrl$=t,I1e={},mkt="http://www.w3.org/2000/svg",gkt="http://www.w3.org/1999/xhtml",ykt=t=>t!=null,qae=t=>(t=typeof t,t==="object"||t==="function");function _kt(t){var e,i,r;return(r=(i=(e=t.head)==null?void 0:e.querySelector('meta[name="csp-nonce"]'))==null?void 0:i.getAttribute("content"))!=null?r:void 0}var vkt={};skt(vkt,{err:()=>AVe,map:()=>bkt,ok:()=>dee,unwrap:()=>wkt,unwrapErr:()=>xkt});var dee=t=>({isOk:!0,isErr:!1,value:t}),AVe=t=>({isOk:!1,isErr:!0,value:t});function bkt(t,e){if(t.isOk){const i=e(t.value);return i instanceof Promise?i.then(r=>dee(r)):dee(i)}if(t.isErr){const i=t.value;return AVe(i)}throw"should never get here"}var wkt=t=>{if(t.isOk)return t.value;throw t.value},xkt=t=>{if(t.isErr)return t.value;throw t.value},o2=(t,e="")=>()=>{},PVe=(t,e,...i)=>{let r=null,s=null,n=null,o=!1,a=!1;const l=[],c=d=>{for(let f=0;f<d.length;f++)r=d[f],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof t!="function"&&!qae(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?nj(null,r):r),a=o)};if(c(i),e){e.key&&(s=e.key),e.name&&(n=e.name);{const d=e.className||e.class;d&&(e.class=typeof d!="object"?d:Object.keys(d).filter(f=>d[f]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,Ekt);const u=nj(t,null);return u.$attrs$=e,l.length>0&&(u.$children$=l),u.$key$=s,u.$name$=n,u},nj=(t,e)=>{const i={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return i.$attrs$=null,i.$key$=null,i.$name$=null,i},Tkt={},Skt=t=>t&&t.$tag$===Tkt,Ekt={forEach:(t,e)=>t.map(L1e).forEach(e),map:(t,e)=>t.map(L1e).map(e).map(Ckt)},L1e=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),Ckt=t=>{if(typeof t.vtag=="function"){const i={...t.vattrs};return t.vkey&&(i.key=t.vkey),t.vname&&(i.name=t.vname),PVe(t.vtag,i,...t.vchildren||[])}const e=nj(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},Mkt=t=>okt.map(e=>e(t)).find(e=>!!e),Akt=(t,e)=>t!=null&&!qae(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,Pkt=t=>t,wui=(t,e,i)=>{const r=Pkt(t);return{emit:s=>Okt(r,e,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:s})}},Okt=(t,e,i)=>{const r=Na.ce(e,i);return t.dispatchEvent(r),r},D1e=new WeakMap,Rkt=(t,e,i)=>{let r=sj.get(t);ukt&&i?(r=r||new CSSStyleSheet,typeof r=="string"?r=e:r.replaceSync(e)):r=e,sj.set(t,r)},$kt=(t,e,i)=>{var r;const s=OVe(e,i),n=sj.get(s);if(t=t.nodeType===11?t:zf,n)if(typeof n=="string"){t=t.head||t;let o=D1e.get(t),a;if(o||D1e.set(t,o=new Set),!o.has(s)){{a=zf.createElement("style"),a.innerHTML=n;const l=(r=Na.$nonce$)!=null?r:_kt(zf);l!=null&&a.setAttribute("nonce",l),t.insertBefore(a,t.querySelector("link"))}e.$flags$&4&&(a.innerHTML+=akt),o&&o.add(s)}}else t.adoptedStyleSheets.includes(n)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,n]);return s},Ikt=t=>{const e=t.$cmpMeta$,i=t.$hostElement$,r=e.$flags$,s=o2("attachStyles",e.$tagName$),n=$kt(i.shadowRoot?i.shadowRoot:i.getRootNode(),e,t.$modeName$);r&10&&(i["s-sc"]=n,i.classList.add(n+"-h"),r&2&&i.classList.add(n+"-s")),s()},OVe=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),N1e=(t,e,i,r,s,n)=>{if(i!==r){let o=O1e(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=F1e(i),u=F1e(r);l.remove(...c.filter(d=>d&&!u.includes(d))),l.add(...u.filter(d=>d&&!c.includes(d)))}else if(e==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?t.style.setProperty(l,r[l]):t.style[l]=r[l])}else if(e!=="key")if(e==="ref")r&&r(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n"){if(e[2]==="-"?e=e.slice(3):O1e(dN,a)?e=a.slice(2):e=a[2]+e.slice(3),i||r){const l=e.endsWith(RVe);e=e.replace(Dkt,""),i&&Na.rel(t,e,i,l),r&&Na.ael(t,e,r,l)}}else{const l=qae(r);if((o||l&&r!==null)&&!s)try{if(t.tagName.includes("-"))t[e]=r;else{const u=r??"";e==="list"?o=!1:(i==null||t[e]!=u)&&(t[e]=u)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),r==null||r===!1?(r!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(R1e,e):t.removeAttribute(e)):(!o||n&4||s)&&!l&&(r=r===!0?"":r,c?t.setAttributeNS(R1e,e,r):t.setAttribute(e,r))}}},Lkt=/\s/,F1e=t=>t?t.split(Lkt):[],RVe="Capture",Dkt=new RegExp(RVe+"$"),$Ve=(t,e,i)=>{const r=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,s=t&&t.$attrs$||I1e,n=e.$attrs$||I1e;for(const o of k1e(Object.keys(s)))o in n||N1e(r,o,s[o],void 0,i,e.$flags$);for(const o of k1e(Object.keys(n)))N1e(r,o,s[o],n[o],i,e.$flags$)};function k1e(t){return t.includes("ref")?[...t.filter(e=>e!=="ref"),"ref"]:t}var DC,pee,OP,oj=!1,aj=!1,Wae=!1,gh=!1,lj=(t,e,i,r)=>{var s;const n=e.$children$[i];let o=0,a,l,c;if(oj||(Wae=!0,n.$tag$==="slot"&&(DC&&r.classList.add(DC+"-s"),n.$flags$|=n.$children$?2:1)),n.$text$!==null)a=n.$elm$=zf.createTextNode(n.$text$);else if(n.$flags$&1)a=n.$elm$=zf.createTextNode("");else{if(gh||(gh=n.$tag$==="svg"),a=n.$elm$=zf.createElementNS(gh?mkt:gkt,!oj&&Eg.slotRelocation&&n.$flags$&2?"slot-fb":n.$tag$),gh&&n.$tag$==="foreignObject"&&(gh=!1),$Ve(null,n,gh),ykt(DC)&&a["s-si"]!==DC&&a.classList.add(a["s-si"]=DC),Yae(a,r),n.$children$)for(o=0;o<n.$children$.length;++o)l=lj(t,n,o,a),l&&a.appendChild(l);n.$tag$==="svg"?gh=!1:a.tagName==="foreignObject"&&(gh=!0)}return a["s-hn"]=OP,n.$flags$&3&&(a["s-sr"]=!0,a["s-cr"]=pee,a["s-sn"]=n.$name$||"",a["s-rf"]=(s=n.$attrs$)==null?void 0:s.ref,c=t&&t.$children$&&t.$children$[i],c&&c.$tag$===n.$tag$&&t.$elm$&&YL(t.$elm$,!1)),a},YL=(t,e)=>{Na.$flags$|=1;const i=Array.from(t.childNodes);if(t["s-sr"]&&Eg.experimentalSlotFixes){let r=t;for(;r=r.nextSibling;)r&&r["s-sn"]===t["s-sn"]&&r["s-sh"]===OP&&i.push(r)}for(let r=i.length-1;r>=0;r--){const s=i[r];s["s-hn"]!==OP&&s["s-ol"]&&(ub(DVe(s),s,Zae(s)),s["s-ol"].remove(),s["s-ol"]=void 0,s["s-sh"]=void 0,Wae=!0),e&&YL(s,e)}Na.$flags$&=-2},IVe=(t,e,i,r,s,n)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===OP&&(o=o.shadowRoot);s<=n;++s)r[s]&&(a=lj(null,i,s,t),a&&(r[s].$elm$=a,ub(o,a,Zae(e))))},LVe=(t,e,i)=>{for(let r=e;r<=i;++r){const s=t[r];if(s){const n=s.$elm$;kVe(s),n&&(aj=!0,n["s-ol"]?n["s-ol"].remove():YL(n,!0),n.remove())}}},Nkt=(t,e,i,r,s=!1)=>{let n=0,o=0,a=0,l=0,c=e.length-1,u=e[0],d=e[c],f=r.length-1,m=r[0],g=r[f],y,v;for(;n<=c&&o<=f;)if(u==null)u=e[++n];else if(d==null)d=e[--c];else if(m==null)m=r[++o];else if(g==null)g=r[--f];else if(x5(u,m,s))NC(u,m,s),u=e[++n],m=r[++o];else if(x5(d,g,s))NC(d,g,s),d=e[--c],g=r[--f];else if(x5(u,g,s))(u.$tag$==="slot"||g.$tag$==="slot")&&YL(u.$elm$.parentNode,!1),NC(u,g,s),ub(t,u.$elm$,d.$elm$.nextSibling),u=e[++n],g=r[--f];else if(x5(d,m,s))(u.$tag$==="slot"||g.$tag$==="slot")&&YL(d.$elm$.parentNode,!1),NC(d,m,s),ub(t,d.$elm$,u.$elm$),d=e[--c],m=r[++o];else{for(a=-1,l=n;l<=c;++l)if(e[l]&&e[l].$key$!==null&&e[l].$key$===m.$key$){a=l;break}a>=0?(v=e[a],v.$tag$!==m.$tag$?y=lj(e&&e[o],i,a,t):(NC(v,m,s),e[a]=void 0,y=v.$elm$),m=r[++o]):(y=lj(e&&e[o],i,o,t),m=r[++o]),y&&ub(DVe(u.$elm$),y,Zae(u.$elm$))}n>c?IVe(t,r[f+1]==null?null:r[f+1].$elm$,i,r,o,f):o>f&&LVe(e,n,c)},x5=(t,e,i=!1)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:i?!0:t.$key$===e.$key$:!1,Zae=t=>t&&t["s-ol"]||t,DVe=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,NC=(t,e,i=!1)=>{const r=e.$elm$=t.$elm$,s=t.$children$,n=e.$children$,o=e.$tag$,a=e.$text$;let l;a===null?(gh=o==="svg"?!0:o==="foreignObject"?!1:gh,o==="slot"&&!oj||$Ve(t,e,gh),s!==null&&n!==null?Nkt(r,s,e,n,i):n!==null?(t.$text$!==null&&(r.textContent=""),IVe(r,null,e,n,0,n.length-1)):s!==null&&LVe(s,0,s.length-1),gh&&o==="svg"&&(gh=!1)):(l=r["s-cr"])?l.parentNode.textContent=a:t.$text$!==a&&(r.data=a)},NVe=t=>{const e=t.childNodes;for(const i of e)if(i.nodeType===1){if(i["s-sr"]){const r=i["s-sn"];i.hidden=!1;for(const s of e)if(s!==i){if(s["s-hn"]!==i["s-hn"]||r!==""){if(s.nodeType===1&&(r===s.getAttribute("slot")||r===s["s-sn"])||s.nodeType===3&&r===s["s-sn"]){i.hidden=!0;break}}else if(s.nodeType===1||s.nodeType===3&&s.textContent.trim()!==""){i.hidden=!0;break}}}NVe(i)}},I0=[],FVe=t=>{let e,i,r;for(const s of t.childNodes){if(s["s-sr"]&&(e=s["s-cr"])&&e.parentNode){i=e.parentNode.childNodes;const n=s["s-sn"];for(r=i.length-1;r>=0;r--)if(e=i[r],!e["s-cn"]&&!e["s-nr"]&&e["s-hn"]!==s["s-hn"]&&!Eg.experimentalSlotFixes)if(U1e(e,n)){let o=I0.find(a=>a.$nodeToRelocate$===e);aj=!0,e["s-sn"]=e["s-sn"]||n,o?(o.$nodeToRelocate$["s-sh"]=s["s-hn"],o.$slotRefNode$=s):(e["s-sh"]=s["s-hn"],I0.push({$slotRefNode$:s,$nodeToRelocate$:e})),e["s-sr"]&&I0.map(a=>{U1e(a.$nodeToRelocate$,e["s-sn"])&&(o=I0.find(l=>l.$nodeToRelocate$===e),o&&!a.$slotRefNode$&&(a.$slotRefNode$=o.$slotRefNode$))})}else I0.some(o=>o.$nodeToRelocate$===e)||I0.push({$nodeToRelocate$:e})}s.nodeType===1&&FVe(s)}},U1e=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",kVe=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(kVe)},ub=(t,e,i)=>{const r=t==null?void 0:t.insertBefore(e,i);return Yae(e,t),r},UVe=t=>{const e=[];return t&&e.push(...t["s-scs"]||[],t["s-si"],t["s-sc"],...UVe(t.parentElement)),e},Yae=(t,e,i=!1)=>{var r;if(t&&e&&t.nodeType===1){const s=new Set(UVe(e).filter(Boolean));if(s.size&&((r=t.classList)==null||r.add(...t["s-scs"]=[...s]),t["s-ol"]||i))for(const n of Array.from(t.childNodes))Yae(n,t,!0)}},Fkt=(t,e,i=!1)=>{var r,s,n,o,a;const l=t.$hostElement$,c=t.$cmpMeta$,u=t.$vnode$||nj(null,null),d=Skt(e)?e:PVe(null,null,e);if(OP=l.tagName,c.$attrsToReflect$&&(d.$attrs$=d.$attrs$||{},c.$attrsToReflect$.map(([f,m])=>d.$attrs$[m]=l[f])),i&&d.$attrs$)for(const f of Object.keys(d.$attrs$))l.hasAttribute(f)&&!["key","ref","style","class"].includes(f)&&(d.$attrs$[f]=l[f]);d.$tag$=null,d.$flags$|=4,t.$vnode$=d,d.$elm$=u.$elm$=l.shadowRoot||l,DC=l["s-sc"],oj=(c.$flags$&1)!==0,pee=l["s-cr"],aj=!1,NC(u,d,i);{if(Na.$flags$|=1,Wae){FVe(d.$elm$);for(const f of I0){const m=f.$nodeToRelocate$;if(!m["s-ol"]){const g=zf.createTextNode("");g["s-nr"]=m,ub(m.parentNode,m["s-ol"]=g,m)}}for(const f of I0){const m=f.$nodeToRelocate$,g=f.$slotRefNode$;if(g){const y=g.parentNode;let v=g.nextSibling;{let b=(r=m["s-ol"])==null?void 0:r.previousSibling;for(;b;){let w=(s=b["s-nr"])!=null?s:null;if(w&&w["s-sn"]===m["s-sn"]&&y===w.parentNode){for(w=w.nextSibling;w===m||w!=null&&w["s-sr"];)w=w==null?void 0:w.nextSibling;if(!w||!w["s-nr"]){v=w;break}}b=b.previousSibling}}(!v&&y!==m.parentNode||m.nextSibling!==v)&&m!==v&&(!m["s-hn"]&&m["s-ol"]&&(m["s-hn"]=m["s-ol"].parentNode.nodeName),ub(y,m,v),m.nodeType===1&&(m.hidden=(n=m["s-ih"])!=null?n:!1)),m&&typeof g["s-rf"]=="function"&&g["s-rf"](m)}else m.nodeType===1&&(i&&(m["s-ih"]=(o=m.hidden)!=null?o:!1),m.hidden=!0)}}aj&&NVe(d.$elm$),Na.$flags$&=-2,I0.length=0}if(Eg.experimentalScopedSlotChanges&&c.$flags$&2)for(const f of d.$elm$.childNodes)f["s-hn"]!==OP&&!f["s-sh"]&&(i&&f["s-ih"]==null&&(f["s-ih"]=(a=f.hidden)!=null?a:!1),f.hidden=!0);pee=void 0},kkt=(t,e)=>{},Xae=(t,e)=>(t.$flags$|=16,kkt(t,t.$ancestorComponent$),dkt(()=>Ukt(t,e))),Ukt=(t,e)=>{const i=t.$hostElement$,r=o2("scheduleUpdate",t.$cmpMeta$.$tagName$),s=i;if(!s)throw new Error(`Can't render component <${i.tagName.toLowerCase()} /> with invalid Stencil runtime! Make sure this imported component is compiled with a \`externalRuntime: true\` flag. For more information, please refer to https://stenciljs.com/docs/custom-elements#externalruntime`);let n;return e?n=yA(s,"componentWillLoad"):n=yA(s,"componentWillUpdate"),n=V1e(n,()=>yA(s,"componentWillRender")),r(),V1e(n,()=>zkt(t,s,e))},V1e=(t,e)=>Vkt(t)?t.then(e).catch(i=>{console.error(i),e()}):e(),Vkt=t=>t instanceof Promise||t&&t.then&&typeof t.then=="function",zkt=async(t,e,i)=>{const r=t.$hostElement$,s=o2("update",t.$cmpMeta$.$tagName$);r["s-rc"],i&&Ikt(t);const n=o2("render",t.$cmpMeta$.$tagName$);Bkt(t,e,r,i),n(),s(),jkt(t)},z1e=null,Bkt=(t,e,i,r)=>{try{z1e=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(Eg.hasRenderFn||Eg.reflect)&&(Eg.vdomRender||Eg.reflect)&&(Eg.hydrateServerSide||Fkt(t,e,r))}catch(l){hN(l,t.$hostElement$)}return z1e=null,null},jkt=t=>{const e=t.$cmpMeta$.$tagName$,i=t.$hostElement$,r=o2("postUpdate",e),s=i;t.$ancestorComponent$,yA(s,"componentDidRender"),t.$flags$&64?(yA(s,"componentDidUpdate"),r()):(t.$flags$|=64,yA(s,"componentDidLoad"),r())},xui=t=>{{const e=N2(t),i=e.$hostElement$.isConnected;return i&&(e.$flags$&18)===2&&Xae(e,!1),i}},yA=(t,e,i)=>{if(t&&t[e])try{return t[e](i)}catch(r){hN(r)}},Gkt=(t,e)=>N2(t).$instanceValues$.get(e),Hkt=(t,e,i,r)=>{const s=N2(t),n=t,o=s.$instanceValues$.get(e),a=s.$flags$,l=n;i=Akt(i,r.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){s.$instanceValues$.set(e,i);{if(r.$watchers$&&a&128){const d=r.$watchers$[e];d&&d.map(f=>{try{l[f](i,o,e)}catch(m){hN(m,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,e)===!1)return;Xae(s,!1)}}}},qkt=(t,e,i)=>{var r,s;const n=t.prototype;if(e.$members$||e.$watchers$||t.watchers){t.watchers&&!e.$watchers$&&(e.$watchers$=t.watchers);const o=Object.entries((r=e.$members$)!=null?r:{});o.map(([a,[l]])=>{(l&31||l&32)&&Object.defineProperty(n,a,{get(){return Gkt(this,a)},set(c){Hkt(this,a,c,e)},configurable:!0,enumerable:!0})});{const a=new Map;n.attributeChangedCallback=function(l,c,u){Na.jmp(()=>{var d;const f=a.get(l);if(this.hasOwnProperty(f))u=this[f],delete this[f];else{if(n.hasOwnProperty(f)&&typeof this[f]=="number"&&this[f]==u)return;if(f==null){const m=N2(this),g=m==null?void 0:m.$flags$;if(g&&!(g&8)&&g&128&&u!==c){const v=this,b=(d=e.$watchers$)==null?void 0:d[l];b==null||b.forEach(w=>{v[w]!=null&&v[w].call(v,u,c,l)})}return}}this[f]=u===null&&typeof this[f]=="boolean"?!1:u})},t.observedAttributes=Array.from(new Set([...Object.keys((s=e.$watchers$)!=null?s:{}),...o.filter(([l,c])=>c[0]&15).map(([l,c])=>{var u;const d=c[1]||l;return a.set(d,l),c[0]&512&&((u=e.$attrsToReflect$)==null||u.push([l,d])),d})]))}}return t},Wkt=async(t,e,i,r)=>{let s;if(!(e.$flags$&32)){e.$flags$|=32,i.$lazyBundleId$;{s=t.constructor;const o=t.localName;customElements.whenDefined(o).then(()=>e.$flags$|=128)}if(s&&s.style){let o;typeof s.style=="string"?o=s.style:typeof s.style!="string"&&(e.$modeName$=Mkt(t),e.$modeName$&&(o=s.style[e.$modeName$]));const a=OVe(i,e.$modeName$);if(!sj.has(a)){const l=o2("registerStyles",i.$tagName$);Rkt(a,o,!!(i.$flags$&1)),l()}}}e.$ancestorComponent$,Xae(e,!0)},B1e=t=>{},Zkt=t=>{if(!(Na.$flags$&1)){const e=N2(t),i=e.$cmpMeta$,r=o2("connectedCallback",i.$tagName$);e.$flags$&1?(VVe(t,e,i.$listeners$),e!=null&&e.$lazyInstance$?B1e(e.$lazyInstance$):e!=null&&e.$onReadyPromise$&&e.$onReadyPromise$.then(()=>B1e(e.$lazyInstance$))):(e.$flags$|=1,i.$flags$&12&&Ykt(t),i.$members$&&Object.entries(i.$members$).map(([s,[n]])=>{if(n&31&&t.hasOwnProperty(s)){const o=t[s];delete t[s],t[s]=o}}),Wkt(t,e,i)),r()}},Ykt=t=>{const e=t["s-cr"]=zf.createComment("");e["s-cn"]=!0,ub(t,e,t.firstChild)},Xkt=async t=>{if(!(Na.$flags$&1)){const e=N2(t);e.$rmListeners$&&(e.$rmListeners$.map(i=>i()),e.$rmListeners$=void 0)}},Tui=(t,e)=>{const i={$flags$:e[0],$tagName$:e[1]};i.$members$=e[2],i.$listeners$=e[3],i.$watchers$=t.$watchers$,i.$attrsToReflect$=[];const r=t.prototype.connectedCallback,s=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){nkt(this,i)},connectedCallback(){const n=N2(this);VVe(this,n,i.$listeners$),Zkt(this),r&&r.call(this)},disconnectedCallback(){Xkt(this),s&&s.call(this)},__attachShadow(){if(!this.shadowRoot)this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)});else if(this.shadowRoot.mode!=="open")throw new Error(`Unable to re-use existing shadow root for ${i.$tagName$}! Mode is set to ${this.shadowRoot.mode} but Stencil only supports open shadow roots.`)}}),t.is=i.$tagName$,qkt(t,i)},Sui=(t,e)=>e,VVe=(t,e,i,r)=>{i&&i.map(([s,n,o])=>{const a=Qkt(t,s),l=Jkt(e,o),c=Kkt(s);Na.ael(a,n,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>Na.rel(a,n,l,c))})},Jkt=(t,e)=>i=>{var r;try{Eg.lazyLoad||t.$hostElement$[e](i)}catch(s){hN(s)}},Qkt=(t,e)=>e&4?zf:e&8?dN:e&16?zf.body:t,Kkt=t=>lkt?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0;/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
 * v2.11.1
 */const zVe=()=>typeof navigator<"u"&&typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;function eUt(){return navigator.userAgentData}function Eui(){if(!zVe())return"";const t=eUt();return t!=null&&t.brands?t.brands.map(({brand:e,version:i})=>`${e}/${i}`).join(" "):navigator.userAgent}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
 * v2.11.1
 */function j1e(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,i=()=>t.contains(SVe)||t.contains(TVe)&&e?"dark":"light",r=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),s=o=>{n!==o&&r(o),n=o};let n=i();r(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(i())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function tUt(){zVe()&&(document.readyState==="interactive"?j1e():document.addEventListener("DOMContentLoaded",()=>j1e(),{once:!0})),ikt()}const iUt=tUt;iUt();let BVe;function rUt(){try{pkt(".")}catch{fkt(Tu(mr(BVe)))}}function sm(t){var i;const e=[];for(const r of Object.keys(t))customElements.get(`calcite-${r}`)||e.push((i=t[r])==null?void 0:i.call(t));return e.length>0?Promise.all(e):null}BVe="components/assets";const jVe=Symbol("widget"),GVe=Symbol("widget-test-data"),sUt=[],nUt={},cj=new WeakMap;function HVe(t,e){let i=e.children;if(i!=null&&i.length)for(let s=0;s<i.length;++s)i[s]=HVe(t,i[s]);else i=sUt;const r=e.vnodeSelector;if(uj(r)){const s=e.properties||nUt,n=s.key||r;return{vnodeSelector:"div",properties:{key:n,afterCreate:oUt,afterUpdate:aUt,afterRemoved:qVe,parentWidget:t,widgetConstructor:r,widgetProperties:{...s,key:n,children:i}},children:void 0,text:void 0,domNode:null}}return e}function oUt(t,e,i,{parentWidget:r,widgetConstructor:s,widgetProperties:n}){var a;const o=new s(n);o.container=t,cj.set(t,o),(a=o.afterCreate)==null||a.call(o,o,t),r.addHandles(Gi(()=>qVe(t))),queueMicrotask(()=>{o[GVe].projector.renderNow()})}function aUt(t,e,i,{widgetProperties:r}){var n;const s=cj.get(t);s&&(s.set(r),(n=s.afterUpdate)==null||n.call(s,s,t))}function qVe(t){var i;const e=cj.get(t);e&&((i=e.afterRemoved)==null||i.call(e,e,t),e.destroy(),cj.delete(t))}function uj(t){return typeof t=="function"&&t[jVe]}const G1e=new Set;function lUt(t){G1e.add(t),t.finally(()=>G1e.delete(t))}var WVe;const cUt="esri.widgets.Widget";let uUt=0;function ZVe(t,e){const i=Object.prototype.hasOwnProperty;for(const r in e)i.call(e,r)&&i.call(t,r)&&(t[r]!=null&&e[r]!=null&&typeof t[r]=="object"&&typeof e[r]=="object"?ZVe(t[r],e[r]):t[r]=e[r]);return t}const hUt=Q5t({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,i=/capture$/i;t.eventHandlerInterceptor=(r,s,n,o)=>{const a=e==null?void 0:e(r,s,n,o),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in n)||l){const c=r[2].toLowerCase()+r.slice(3),u=m=>a==null?void 0:a.call(n,m);n.addEventListener(c,u,l);const d=()=>n.removeEventListener(c,u,l),f=o.afterRemoved;o.afterRemoved=m=>{f==null||f(m),d()}}return a}},handleInterceptedEvent(t,e,i,r){const{eventPhase:s,type:n}=r,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,l&&a in l))&&(FAe(),t.scheduleRender(),l[a].call(l.bind||i,r))}});let R7=!1,Yo=class extends dD(Us.EventedAccessor){constructor(e,i){super(e,i),this._attached=!1,this._projector=hUt,this._readyForTrueRender=!1,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=q0(async()=>{var l;if((l=this._messageBundleProps)!=null&&l.length){const c=await Promise.allSettled(this._messageBundleProps.map(async({bundlePath:u,propertyName:d})=>{if(this.destroyed)return;let f=await gSe(u);this.uiStrings&&Object.keys(this.uiStrings)&&(f=ZVe(ie(f),this.uiStrings)),this[d]=f}));if(this.destroyed)return;for(const u of c)u.status==="rejected"&&se.getLogger(this).error("widget-intl:locale-error",this.declaredClass,u.reason)}await this.loadLocale()}),rUt();const r="esri-widget-uid-"+dG(),s=this.render.bind(this);this._trackingTarget=new Vj(()=>{this.autoRenderingEnabled&&this.scheduleRender()});const n=()=>({vnodeSelector:"div",properties:{key:`${r}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}),o=()=>{var d,f;if(!this._readyForTrueRender||this.destroyed)return null;const l=s()??n(),c=l.properties??(l.properties={});if(c.key??(c.key=r),uj(l.vnodeSelector)){if(!this.visible)return n()}else this.visible?c.styles||(c.styles={}):(c.class="",c.styles={display:"none"}),(d=c.styles).display??(d.display="");let u=0;return(f=l.children)==null||f.forEach(m=>{var g;uj(m.vnodeSelector)||(m.properties??(m.properties={}),(g=m.properties).key??(g.key=`${this.id}--${u++}`))}),HVe(this,l)};this.render=()=>{if(R7)return o();let l=tit(this)??null;if(l)return l;this._trackingTarget.clear(),R7=!0;try{l=s_(this._trackingTarget,o)}catch(c){throw se.getLogger(this).error(c),c}finally{R7=!1}return l&&iit(this,l),l};const a=this.beforeFirstRender();a?this._resourcesFetch=a.then(()=>{this._readyForTrueRender=!0,this._postInitialize()}):(this._resourcesFetch=Promise.resolve().then(()=>{this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),lUt(this._resourcesFetch)}normalizeCtorArgs(e,i){const r={...e};return i&&(r.container=i),r}postInitialize(){}beforeFirstRender(){var i;const e=this.loadDependencies();return(i=this._messageBundleProps)!=null&&i.length||e?Promise.all([e,this._loadLocale()]).then(()=>{}).catch(RW):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(qe(this._trackingTarget),qe(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,l8(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return pG(e)}get domNode(){return this.container}set domNode(e){this.container=e}get icon(){return null}set icon(e){this._overrideIfSome("icon",e)}get id(){var e;return this._get("id")||((e=this.container)==null?void 0:e.id)||Date.now().toString(16)+"-widget-"+uUt++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(WVe=jVe,GVe)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(l8(this),this._projector.scheduleRender())}own(e){_Se(se.getLogger(this),"`Widget.own()` is deprecated in favor of 'Widget.addHandles()'",{replacement:"Widget.addHandles()",version:"4.28"}),this.addHandles(e)}classes(...e){return kAe.apply(this,e)}renderNow(){l8(this),this._projector.renderNow()}_postInitialize(){var i;if(this.destroyed)return;this.scheduleRender(),(i=this._delegatedEventNames)!=null&&i.length&&this.addHandles(te(()=>this.viewModel,(r,s)=>{s&&this.removeHandles("delegated-events"),r&&Nj(r)&&this.addHandles(this._delegatedEventNames.map(n=>kP(r,n,o=>{this.emit(n,o)})),"delegated-events")},hr)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(RW),this.scheduleRender()};this.addHandles([sTe(e),te(()=>this.uiStrings,e),No(()=>this.container,r=>{this.destroyed||this._attach(r)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var i;this._attached&&(this._projector.detach(this.render),this._attached=!1),(i=e==null?void 0:e.parentNode)==null||i.removeChild(e)}};Yo[WVe]=!0,h([p()],Yo.prototype,"_readyForTrueRender",void 0),h([p({value:null})],Yo.prototype,"container",null),h([Kt("container")],Yo.prototype,"castContainer",null),h([p()],Yo.prototype,"icon",null),h([p()],Yo.prototype,"id",null),h([p()],Yo.prototype,"label",null),h([p()],Yo.prototype,"renderable",null),h([p()],Yo.prototype,"uiStrings",void 0),h([p()],Yo.prototype,"viewModel",void 0),h([p({value:!0})],Yo.prototype,"visible",null),h([p()],Yo.prototype,"key",void 0),h([p()],Yo.prototype,"children",void 0),h([p()],Yo.prototype,"afterCreate",void 0),h([p()],Yo.prototype,"afterUpdate",void 0),h([p()],Yo.prototype,"afterRemoved",void 0),Yo=h([I(cUt)],Yo);const Ua=Yo;let KU,eV=null;const _A=new Map;async function Mui(t){eV==null&&(KU==null&&(KU=ce(()=>import("./Lyr3DWasmPerSceneView-BESd06Vc.js"),__vite__mapDeps([195,67,5,68,114]))),eV=await KU);const e=t.view;let i=_A.get(e);return i||(i=new eV.default({view:e}),_A.set(e,i)),await i.initializeWasm(),i.add3DTilesLayerView(t)}function dUt(t){return _A.get(t)}function Aui(t){const e=t.view,i=_A.get(e);i&&i.remove3DTilesLayerView(t)<1&&(_A.delete(e),_A.size===0&&(KU=null,eV=null))}function H1e(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function pUt(t,e){return t.length!==e.length||t.some((i,r)=>i.text!==e[r].text)}function CR(t,e,i){!i||!e||t.find(r=>r.layerView===e&&r.text===i)||t.push({text:i,layerView:e})}function fUt(t){return t.type==="bing-maps"}const Wy=[];let FC=class extends Ue{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new st,this.view=null,this._allLayerViewsChange=i=>{var s;this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");const r=(s=this.view)==null?void 0:s.allLayerViews;r&&(this.addHandles(r.map(n=>te(()=>{var o;return[n.suspended,(o=n.layer)==null?void 0:o.attributionVisible]},()=>this._updateAttributionItems())).toArray(),"suspension"),r.forEach(n=>{n.declaredClass==="esri.views.3d.layers.Tiles3DLayerView3D"&&this.addHandles(n.on("visible-geometry-changed",()=>this._updateAttributionItems()),"visible-geometry-changed")})),i!=null&&i.removed&&i.removed.forEach(n=>{this._pendingAttributions.delete(n),this._fetchedAttributionData.delete(n)}),this._updateAttributionItems()},this.addHandles([Ks(()=>{var i;return(i=this.view)==null?void 0:i.allLayerViews},"change",i=>this._allLayerViewsChange(i),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),No(()=>{var i;return((i=this.view)==null?void 0:i.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){var e;return(e=this.view)!=null&&e.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,i=e==null?void 0:e.allLayerViews;if(Wy.length=0,!e||!i)return void this._clear();i.forEach(s=>{var a,l;if(s.suspended||!((a=s.layer)!=null&&a.attributionVisible))return;const n=s.layer;if(H1e(n,"user"))return void CR(Wy,s,n.copyright);if(n.hasAttributionData){if(this._fetchedAttributionData.has(s)){const c=this._fetchedAttributionData.get(s);return void(c?CR(Wy,s,this._getDynamicAttribution(c,e,n)):H1e(n)&&CR(Wy,s,n.copyright))}return void this._fetchAttributionData(s)}const o="portalItem"in n?(l=n.portalItem)==null?void 0:l.accessInformation:void 0;CR(Wy,s,o||n.copyright)});const r=i.find(s=>{var n;return((n=s.layer)==null?void 0:n.type)==="integrated-mesh-3dtiles"});if(this.view&&r){const s=dUt(this.view);if(s){const n=s.getAttributionText();for(let o=0;o<n.length;++o)CR(Wy,r,n[o])}}pUt(this.items,Wy)&&(this.items.removeAll(),this.items.addMany(Wy)),Wy.length=0,this.notifyChange("state")}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const i=await Vh(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const r=i.ok?this._createContributionIndex(i.value,fUt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,r)}this._updateAttributionItems()}_createContributionIndex(e,i){const r=e.contributors,s={};if(!r)return s;for(let n=0;n<r.length;n++){const o=r[n],a=o.coverageAreas;if(!a)return;for(const l of a){const c=l.bbox,u=l.zoomMin-(i&&l.zoomMin?1:0),d=l.zoomMax-(i&&l.zoomMax?1:0),f=new ur({xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:Ze.WGS84}),m={extent:kg(f),attribution:o.attribution||"",score:l.score!=null?l.score:100,id:n};for(let g=u;g<=d;g++)s[g]??(s[g]=[]),s[g].push(m)}}return s.maxKey=Math.max.apply(null,Object.keys(s)),s}_getDynamicAttribution(e,i,r){var u;const{extent:s,scale:n}=i;let o=((u=r.tileInfo)==null?void 0:u.scaleToZoom(n))??0;if(o=Math.min(e.maxKey??0,Math.round(o)),!s||o==null||o<=-1)return"";const a=e[o],l=mD(s.center.clone().normalize(),i.spatialReference),c=new Set;return a?a.filter(d=>{const f=d.id,m=!c.has(f)&&l&&d.extent&&ire(d.extent,l);return m&&c.add(f),m}).sort((d,f)=>f.score-d.score||d.objectId-f.objectId).map(d=>d.attribution).join(", "):""}};h([p({readOnly:!0,type:st})],FC.prototype,"items",void 0),h([p({readOnly:!0})],FC.prototype,"state",null),h([p()],FC.prototype,"view",void 0),FC=h([I("esri.widgets.Attribution.AttributionViewModel")],FC);const YVe=FC,ni={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"};function mUt(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:yUt(t[e])}}}function gUt(t){const e=t==null?void 0:t.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function yUt(t){return function(e,...i){gUt(e)?oit(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...i)}}function Fa(t){return(e,i)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:i})}}var _Ut=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},XVe=function(t,e){for(var i=0,r=t.length;i<r;i++){var s=t[i];Array.isArray(s)?XVe(s,e):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=_Ut(s)),e.push(s))}},vUt=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:i[0],domNode:null};var s=[];return XVe(i,s),{vnodeSelector:t,properties:e||void 0,children:s,text:void 0,domNode:null}};function ge(t,e,...i){return typeof t!="function"||uj(t)?vUt(t,e,...i):t(e,...i)}function bUt(...t){return t}const qE="esri-attribution",WE={base:qE,poweredBy:`${qE}__powered-by`,sources:`${qE}__sources`,open:`${qE}--open`,sourcesOpen:`${qE}__sources--open`,link:`${qE}__link`};let xc=class extends Ua{constructor(e,i){super(e,i),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.itemDelimiter=" | ",this.messages=null,this.viewModel=new YVe}initialize(){this.addHandles(Ks(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,i)=>(e.includes(i.text)||e.push(i.text),e),[]).join(this.itemDelimiter)}get icon(){return"description"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[WE.open]:this._isOpen};return ge("div",{bind:this,class:this.classes(WE.base,ni.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return ge("div",{class:WE.poweredBy},"Powered by"," ",ge("a",{class:WE.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,i=this._isInteractive,r=i?0:void 0,{attributionText:s}=this,n={[WE.sourcesOpen]:e,[ni.interactive]:i};return ge("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(WE.sources,n),innerHTML:s,tabIndex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let i=!1;const{clientHeight:r,clientWidth:s,scrollWidth:n}=e,o=n>s,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(i=!0),this._isOpen){const l=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,l&&(this._isOpen=!1,i=!0)}i&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};h([p()],xc.prototype,"_isOpen",void 0),h([p()],xc.prototype,"_isInteractive",null),h([p()],xc.prototype,"_attributionTextOverflowed",void 0),h([p()],xc.prototype,"_prevSourceNodeHeight",void 0),h([p({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],xc.prototype,"attributionText",null),h([p()],xc.prototype,"icon",null),h([p()],xc.prototype,"itemDelimiter",void 0),h([p()],xc.prototype,"label",null),h([p(),Fa("esri/widgets/Attribution/t9n/Attribution")],xc.prototype,"messages",void 0),h([p()],xc.prototype,"view",null),h([p({type:YVe})],xc.prototype,"viewModel",void 0),h([mUt()],xc.prototype,"_toggleState",null),xc=h([I("esri.widgets.Attribution")],xc);const wUt=xc;function xUt(t){var e,i;return((e=t==null?void 0:t.spatialReference)==null?void 0:e.isWebMercator)||((i=t==null?void 0:t.spatialReference)==null?void 0:i.isGeographic)||!1}const Jae=t=>{let e=class extends t{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return Fj(r),this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return h([p()],e.prototype,"goToOverride",void 0),h([p()],e.prototype,"view",void 0),e=h([I("esri.widgets.support.GoTo")],e),e};let Kx=class extends Jae(Ue){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(te(()=>this.view,this._updateRotationWatcher,$t))}destroy(){this.view=null}get canShowNorth(){return xUt(this.view)}get state(){var e;return!((e=this.view)!=null&&e.ready)||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){var e,i;(e=this.view)!=null&&e.ready&&(((i=this.view)==null?void 0:i.type)==="2d"?this.callGoTo({target:{rotation:0},options:{animationMode:"always",duration:le("mapview-essential-goto-duration")}}):this.callGoTo({target:{heading:0}}))}_updateForRotation(e){e!=null&&this._set("orientation",{z:e})}_updateForCamera(e){if(!e)return;const i=-e.heading;this._set("orientation",{x:0,y:0,z:i})}_updateRotationWatcher(e){this.removeAllHandles(),e&&this.addHandles(e.type==="2d"?te(()=>e==null?void 0:e.rotation,this._updateForRotation,$t):te(()=>e==null?void 0:e.camera,this._updateForCamera,$t))}};h([p({readOnly:!0})],Kx.prototype,"canShowNorth",null),h([p({readOnly:!0})],Kx.prototype,"orientation",void 0),h([p({readOnly:!0})],Kx.prototype,"state",null),h([p()],Kx.prototype,"view",void 0),Kx=h([I("esri.widgets.Compass.CompassViewModel")],Kx);const JVe=Kx,q1e="esri-compass",W1e={base:q1e,iconContainer:`${q1e}__icon-container`};let u0=class extends Ua{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new JVe,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=r=>({transform:`rotateZ(${r.z}deg)`})}loadDependencies(){return sm({button:()=>ce(()=>import("./calcite-button-DQc9b2O5.js"),__vite__mapDeps([196,197,198,199,200,201,202,203,204,205,206,207,208])),icon:()=>ce(()=>import("./calcite-icon-BwrxrAiO.js"),__vite__mapDeps([209,207,198,199,206]))})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return this.viewModel.state==="rotation"?"arrow-up":"compass-needle"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:i}=this.viewModel,{messages:r}=this;return ge("div",{class:this.classes(W1e.base,ni.widget)},ge("calcite-button",{class:ni.widgetButton,disabled:i==="disabled",kind:"neutral",label:r.reset,onclick:this._reset,round:!0,scale:"s",title:r.reset},ge("div",{"aria-hidden":"true",class:W1e.iconContainer,title:r.reset},ge("calcite-icon",{icon:this.icon,styles:this._toRotationTransform(e)}))))}};h([p()],u0.prototype,"goToOverride",null),h([p()],u0.prototype,"icon",null),h([p()],u0.prototype,"label",null),h([p(),Fa("esri/widgets/Compass/t9n/Compass")],u0.prototype,"messages",void 0),h([p()],u0.prototype,"view",null),h([p({type:JVe})],u0.prototype,"viewModel",void 0),u0=h([I("esri.widgets.Compass")],u0);const QVe=u0,Z1e="esri-navigation-toggle",Y1e={base:Z1e,isLayoutHorizontal:`${Z1e}--horizontal`};let kC=class extends Ue{constructor(e){super(e),this._navigationMode="pan",this.view=null}initialize(){this.addHandles(No(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var e,i;return(e=this.view)!=null&&e.ready&&((i=this.view)==null?void 0:i.type)==="3d"?"ready":"disabled"}get navigationMode(){return this._navigationMode}set navigationMode(e){this._navigationMode=e,this._setNavigationMode()}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate")}_setNavigationMode(){var i;const e=(i=this.view)==null?void 0:i.inputManager;e&&(e.primaryDragAction=this._navigationMode==="pan"?"pan":"rotate")}};h([p({readOnly:!0})],kC.prototype,"state",null),h([p()],kC.prototype,"_navigationMode",void 0),h([p()],kC.prototype,"view",void 0),kC=h([I("esri.widgets.NavigationToggle.NavigationToggleViewModel")],kC);const KVe=kC;let h0=class extends Ua{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new KVe,this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{var s;const r=((s=this.viewModel)==null?void 0:s.navigationMode)==="pan"?this._rotateButton:this._panButton;r==null||r.setFocus(),this.toggle()}}loadDependencies(){return sm({button:()=>ce(()=>import("./calcite-button-DQc9b2O5.js"),__vite__mapDeps([196,197,198,199,200,201,202,203,204,205,206,207,208]))})}get icon(){return"move"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){var s,n;const e=((s=this.viewModel)==null?void 0:s.state)==="disabled",i=((n=this.viewModel)==null?void 0:n.navigationMode)==="pan",r=this.messages.toggle;return ge("div",{class:this.classes(Y1e.base,ni.widget,{[Y1e.isLayoutHorizontal]:this.layout==="horizontal"})},ge("calcite-button",{afterCreate:o=>{this._panButton=o},appearance:i?"outline-fill":"solid",class:ni.widgetButton,disabled:e,iconStart:"move",kind:"neutral",label:r,onclick:this._toggle,tabIndex:i?void 0:-1,title:r}),ge("calcite-button",{afterCreate:o=>{this._rotateButton=o},appearance:i?"solid":"outline-fill",class:ni.widgetButton,disabled:e,iconStart:"rotate",kind:"neutral",label:r,onclick:this._toggle,tabIndex:i?-1:void 0,title:r}))}};h([p()],h0.prototype,"icon",null),h([p()],h0.prototype,"label",null),h([p({value:"vertical"})],h0.prototype,"layout",null),h([p(),Fa("esri/widgets/NavigationToggle/t9n/NavigationToggle")],h0.prototype,"messages",void 0),h([p()],h0.prototype,"view",null),h([p({type:KVe})],h0.prototype,"viewModel",void 0),h0=h([I("esri.widgets.NavigationToggle")],h0);const TUt=h0;let eT=class extends Ue{get canZoomIn(){var r,s,n;if(!((r=this.view)==null?void 0:r.ready))return!1;const i=(n=(s=this.view)==null?void 0:s.constraints)==null?void 0:n.effectiveMaxScale;return i===0||this._scale>i}get canZoomOut(){var s;const{view:e}=this;if(!(e==null?void 0:e.ready))return!1;const r=(s=e.constraints)==null?void 0:s.effectiveMinScale;return r===0||this._scale<r}get _scale(){var i,r,s;const e=(r=(i=this.view)==null?void 0:i.animation)==null?void 0:r.target;return(e&&"then"in e||e==null?void 0:e.scale)??((s=this.view)==null?void 0:s.scale)??0}};h([p({readOnly:!0})],eT.prototype,"canZoomIn",null),h([p({readOnly:!0})],eT.prototype,"canZoomOut",null),h([p()],eT.prototype,"view",void 0),h([p()],eT.prototype,"_scale",null),eT=h([I("esri.widgets.Zoom.ZoomConditions2D")],eT);const SUt=eT;let UC=class extends Ue{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};h([p({readOnly:!0})],UC.prototype,"canZoomIn",null),h([p({readOnly:!0})],UC.prototype,"canZoomOut",null),h([p()],UC.prototype,"view",void 0),UC=h([I("esri.widgets.Zoom.ZoomConditions3D")],UC);const EUt=UC;let t1=class extends Ue{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return this._zoomConditions!=null&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new SUt({view:e}):e.type==="3d"&&(this._zoomConditions=new EUt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():H0(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():H0(e.goTo({zoomFactor:.5}))}};h([p()],t1.prototype,"_zoomConditions",void 0),h([p()],t1.prototype,"canZoomIn",null),h([p()],t1.prototype,"canZoomOut",null),h([p({readOnly:!0})],t1.prototype,"state",null),h([p()],t1.prototype,"view",null),t1=h([I("esri.widgets.Zoom.ZoomViewModel")],t1);const eze=t1,X1e={base:"esri-zoom",horizontalLayout:"esri-zoom--horizontal"};let d0=class extends Ua{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new eze,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return sm({button:()=>ce(()=>import("./calcite-button-DQc9b2O5.js"),__vite__mapDeps([196,197,198,199,200,201,202,203,204,205,206,207,208]))})}get icon(){return"magnifying-glass-plus"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e={[X1e.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:r}=this.viewModel,{zoomIn:s,zoomOut:n}=this.messages;return ge("div",{class:this.classes(X1e.base,ni.widget,e)},ge("calcite-button",{class:ni.widgetButton,disabled:!i,iconStart:"plus",kind:"neutral",label:s,onclick:this.zoomIn,title:s}),ge("calcite-button",{class:ni.widgetButton,disabled:!r,iconStart:"minus",kind:"neutral",label:n,onclick:this.zoomOut,title:n}))}};h([p()],d0.prototype,"icon",null),h([p()],d0.prototype,"label",null),h([p({value:"vertical"})],d0.prototype,"layout",null),h([p(),Fa("esri/widgets/Zoom/t9n/Zoom")],d0.prototype,"messages",void 0),h([p()],d0.prototype,"view",null),h([p({type:eze})],d0.prototype,"viewModel",void 0),d0=h([I("esri.widgets.Zoom")],d0);const CUt=d0;function MUt(t){return(t==null?void 0:t.view)!==void 0}let tV=class extends q5t{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=i=>{this.components.forEach(r=>{const s=this._find(r),n=s==null?void 0:s.widget;MUt(n)&&(n.view=i)})},this._componentsWatcher=(i,r)=>{this._removeComponents(r),this._addComponents(i),this._adjustPadding(i)}}initialize(){this.addHandles([te(()=>this.components,this._componentsWatcher,$t),te(()=>this.view,this._updateViewAwareWidgets,$t)])}_add(e,i,r,s,n){let o=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;o=this._createComponent(e)}super._add(o,i,r,s,n)}_removeComponents(e){e.forEach(i=>{const r=this._find(i);r&&(this.remove(r),r.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:i}=this.padding;this.padding=i}}_addComponents(e){this.constructed&&e.forEach(i=>this.add(this._createComponent(i),this._defaultPositionLookup[i]))}_createComponent(e){const i=this._createWidget(e);return new QU({id:e,node:i})}_createWidget(e){const i=this.view;switch(e){case"attribution":return new wUt({view:i});case"compass":return new QVe({view:i});case"navigation-toggle":return new TUt({view:i});case"zoom":return new CUt({view:i})}}};h([p()],tV.prototype,"components",void 0),tV=h([I("esri.views.ui.DefaultUI")],tV);const tze=tV;let iV=class extends tze{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};h([p()],iV.prototype,"components",void 0),iV=h([I("esri.views.ui.3d.DefaultUI3D")],iV);const ize=iV;let dt=class extends ltt(Kst(wit(Gat))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new u_({slicePlane:tAe},this),this._resourceController=O$t(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new zQ({view:this}),this.labeler=new qx({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new JA,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new bT,this.environment=new wC,this.environmentManager=new Up,this.floors=new st,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new Wat({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new RRt,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new ize,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new J5e,cKe();const e=(i=null)=>{i!=null&&i.type===Lr.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.addHandles([Ks(()=>{var i;return(i=this.map)==null?void 0:i.allLayers},"after-changes",i=>e(i),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),te(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new sgt({view:this}),this.stateManager=new rn({view:this})}initialize(){this.groundView=new zst({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.addHandles(Ks(()=>{var e;return(e=this.map)==null?void 0:e.allLayers},"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},$t),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},$t),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>Wqe(e>0?1e3/Math.ceil(e):0),$t),this.updatingHandles.add(()=>{var e;return(e=this.map)==null?void 0:e.ground},t,hr),this.updatingHandles.add(()=>{var e,i;return(i=(e=this.map)==null?void 0:e.ground)==null?void 0:i.opacity},()=>this._updateDefaultHitTestOptions(),hr),this.addHandles(te(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),or))}destroy(){var t;this.destroyed||(this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=qe(this.sharedSymbolResources),this._set("labeler",qe(this.labeler)),this._set("deconflictor",qe(this.deconflictor)),this._resourceController=qe(this._resourceController),this._set("stateManager",qe(this.stateManager)),this._set("inputManager",qe(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",qe(this.environmentManager)),this._set("environment",qe(this.environment)),this.groundView=qe(this.groundView),this._exitBasemapTerrain(),(t=this._stage)==null||t.destroy())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var t;return(t=this.basemapTerrain)==null?void 0:t.spatialReference}get animation(){var t;return(t=this.state)==null?void 0:t.animation}get camera(){var t;return(t=this.stateManager)==null?void 0:t.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){var t;return(t=this.stateManager)==null?void 0:t.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){var t;return(t=this.stateManager)==null?void 0:t.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){if(this.viewingMode==="global")return null;const t=this.map;let e=this._userClippingArea||jce(t,"clippingArea");return!this._userClippingArea&&!jce(t,"clippingEnabled")||e==null?(this._clippingArea=null,null):e instanceof ur?this.spatialReference&&(e=T5(e,this.spatialReference),e==null)?(se.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),e.intersection(this._groundAndLayersExtent)==null&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(se.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&t!=null?se.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===Xe.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return e==null||t==null||e.spatialReference.equals(t)?e:T5(e,t)}get tileInfo(){var t,e;return(e=(t=this.basemapTerrain)==null?void 0:t.tilingScheme)==null?void 0:e.toTileInfo()}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||Ze.WGS84,i=T5(this.clippingArea,e);i!=null&&(t=t!=null?t.intersection(i):i);const r=this._get("dataExtent");return t!=null&&t.equals(r)?r:t}get _groundAndLayersExtent(){const t=this.spatialReference||Ze.WGS84;let e;const i=n=>{const o=T5(n,t);o!=null&&(e!=null?e.union(o):e=o.clone())},r=this.basemapTerrain;if(r!=null&&r.spatialReference){const n=r.groundExtent;i(new ur({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const n=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||i(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const s=this._get("_groundAndLayersExtent");return e.equals(s)?s:e}castEnvironment(t){var e;return t?t instanceof wC?t:t instanceof WA?((e=this.environment)==null?void 0:e.cloneWithWebsceneEnvironment(t))??wC.fromWebsceneEnvironment(t):Qs(wC,t):new wC}get extent(){var t;return(t=this.stateManager)==null?void 0:t.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){var t;return(t=this.stateManager)==null?void 0:t.screenCenter}get frustum(){var t;return(t=this.stateManager)==null?void 0:t.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){var t;return this.navigating||(((t=this.toolViewManager)==null?void 0:t.interacting)??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){var t;return((t=this.state)==null?void 0:t.navigating)??!1}get padding(){var t;return(t=this.stateManager)==null?void 0:t.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){$U.isValidProfile(t)&&($U.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||$U.getDefaultProfile()}set slicePlane(t){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:t}),t==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");b2(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){var t;return!!this.viewingMode&&!!((t=this.stateManager)!=null&&t.preinit(this.spatialReference))}get resolution(){return this.spatialReference!=null?rtt(this.scale,this.spatialReference):0}get scale(){var t;return(t=this.stateManager)==null?void 0:t.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get terrainScale(){var t;return(t=this.stateManager)==null?void 0:t.terrainScale}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?qb.deriveUnitFromSR(t,this.spatialReference):null}get updating(){var s,n,o,a;if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,i=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(l=>{if(l.isFulfilled()){if(l.updating){if(e=!0,l.suspended||kK(l))return;++i,t+=l.updatingProgress}}else++i});for(const l of this._updatingObjects)l!=null&&l.updating&&(i+=.1,t+=.5*.1);for(const l of this._updatingObjectsWithProgress)l!=null&&l.updating&&(++i,t+=l.updatingProgress);const r=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||r||this._createGraphicsViewController||(s=this.inputManager)!=null&&s.updating||(o=(n=this.map)==null?void 0:n.allLayers)!=null&&o.some(l=>!l.isFulfilled())||(a=this.textures)!=null&&a.updating),e?(this._numUpdating=Math.max(i,this._numUpdating),t+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const l=performance.now();if(t<1){const c=Math.min((l-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-c)+t*c}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?l:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){var i;const t=this._predeterminedViewingMode;if(t!=null)return QH(t);const e=this.spatialReference;return e?((i=this.defaultsFromMap)==null?void 0:i.viewingMode)!=null&&e.equals(this.defaultsFromMap.spatialReference)?QH(this.defaultsFromMap.viewingMode):cL(e,Xe.Global)?"global":"local":"global"}set viewingMode(t){this.ready?se.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){var t;return(t=this.stateManager)==null?void 0:t.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get quality(){var t,e;return((e=(t=this._resourceController)==null?void 0:t.memoryController)==null?void 0:e.memoryFactor)??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new I$t(this)}on(t,e,i,r){return this.viewEvents.on(t,e,i,r)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return se.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const i=ope(t)?npe(this,t):t;return qRt(this,i,e,this._defaultToMapOptions)}toScreen(t){if(!this.ready)return se.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(t.z==null?Mg(this.elevationProvider,t):null)??0;return pl(t,S5,this.renderSpatialReference,e),this.state.camera.projectToScreen(S5,$7),ep($7[0],$7[1])}pixelSizeAt(t){return this.ready?t?(pl(t,S5,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(S5)):0:(se.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t,()=>this.pixelSizeAt(t)):1}hitTest(t,e){if(!this.ready)return se.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=ope(t)?npe(this,t):t;return HRt(this,i,e,this._defaultHitTestOptions)}async popupHitTest(t){return u$t(this,t)}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(t.parent==null)throw new G("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return E7(i,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return C7(i,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e);return[C7(i[0],this._pixelFormat()),C7(i[1],this._pixelFormat())]}_completeSettings(t){const e=h5t(t,this);return e.pixelRatio/=this.state.pixelRatio,m5t(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){}async takeScreenshotWithObjectAndLayerId(t){if(!le("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e),r=E7(i[0],e,this._pixelFormat()),s=this._completeSettings(t);return s.format="png",[r,E7(i[1],s,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return ppe.importLayerView(t)}hasLayerViewModule(t){return ppe.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var t,e,i;return this.map&&"initialViewProperties"in this.map&&((t=this.map.initialViewProperties)==null?void 0:t.spatialReference)||((e=this.defaultsFromMap)==null?void 0:e.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.ready)&&this._initialDefaultSpatialReference||null}async validate(){let t=F5t(this.type);const e=le("safari");if(e&&e<9&&(t=new G("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),t!=null)throw se.getLogger(this).warn("#validate()",t.message),t}get _predeterminedViewingMode(){var e;const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(e=this.map.initialViewProperties)==null?void 0:e.viewingMode:null)??null;return t!=null?xhe(t):null}getSpatialReferenceSupport(t,e){const i=this._predeterminedViewingMode;if(i!=null)return this._validateSpatialReferenceForViewingMode(t,e,i)?{constraints:this._makeSpatialReferenceConstraints(t,e,i)}:null;const r=this._validateSpatialReferenceForViewingMode(t,e,Xe.Local),s=this._validateSpatialReferenceForViewingMode(t,e,Xe.Global);return r||s?r&&s?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:r?{constraints:this._makeSpatialReferenceConstraints(t,e,Xe.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,Xe.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,i){return!!cL(t,i)&&(e==null||!!Bue(e)||(!qI(e)||K6(e,t,i)!=null)&&(!zue(e)||i!==Xe.Global))}_makeSpatialReferenceConstraints(t,e,i){if(e==null)return[{spatialReference:t,viewingMode:i}];const{isWebMercator:r,isWGS84:s}=t;return Bue(e)&&(r||s)?!s||i===Xe.Local||gae(e.tileInfo,e.fullExtent,t,Xe.Global)===null?[{spatialReference:t,viewingMode:i},{spatialReference:Ze.WebMercator,viewingMode:i}]:[{spatialReference:r?Ze.WGS84:Ze.WebMercator,viewingMode:i}]:qI(e)||zue(e)||!r&&!s?qI(e)&&r&&i!==Xe.Global?[{spatialReference:t,viewingMode:i},{spatialReference:Ze.WGS84,viewingMode:Xe.Local}]:[{spatialReference:t,viewingMode:i}]:[{spatialReference:t,viewingMode:i},{spatialReference:r?Ze.WGS84:Ze.WebMercator,viewingMode:i}]}_validateSpatialReference(t){const e=this.getSpatialReferenceSupport(t)!=null,i=this._predeterminedViewingMode;return e||(i!=null?se.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${QH(i)} viewing mode.`):t.isGeographic&&se.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}trackGraphicState(t){if(!t.graphic)return se.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let i=null,r=!1;const s=n=>{var o;!r&&n!=null&&"processor"in n&&((o=n.processor)==null?void 0:o.type)==="graphics-3d"&&n.processor.graphicsCore&&(i=n.processor.graphicsCore.trackGraphicState(t))};return e!=null?s(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),Gi(()=>{r=!0,i!=null&&(i.remove(),i=null)})}highlight(t){if(Array.isArray(t))return ES(t.map(i=>this.highlight(i)));if(st.isCollection(t))return ES(t.toArray().map(i=>this.highlight(i)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):Gi()}maskOccludee(t){if(!t)return se.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let i=null,r=!1;const s=n=>{!r&&n!=null&&O5t(n)&&(i=n.maskOccludee(t))};return e!=null?s(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),Gi(()=>{r=!0,i!=null&&(i.remove(),i=null)})}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){this.graphicsView!=null&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await VS(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new G("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((i,r)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(t.layer)&&(s.remove(),this.whenLayerView(t.layer).then(i,r))})}):this.whenLayerView(t.layer)}_initBasemapTerrain(){this._set("basemapTerrain",new fDt({view:this})),this._set("elevationProvider",new fI({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Cc({view:this})),this._set("featureTiles",new Xo({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{var i;const e=(i=this.basemapTerrain)==null?void 0:i.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const r=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?b_(sG(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(r):this.featureTiles.filterExtent=r}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>Nr.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(ce(()=>import("./FeatureTileTree3DDebugger-DZAWs9O0.js"),__vite__mapDeps([210,192]))).then(({FeatureTileTree3DDebugger:i})=>{!this._featureTreeDebugger&&Nr.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new i({view:this}))}):e||!this._featureTreeDebugger||Nr.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},hr),this.updatingHandles.add(()=>this.clippingArea,t,hr),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,hr)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new a$t(this.map,t));const e=this.state.isGlobal,i=itt(e,t);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",f$t.create(this.state.viewingMode,i)),e||this.addHandles(te(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.extent},r=>{const s=this.renderCoordsHelper.spatialReference;r==null||r[0]===0&&r[1]===0&&r[2]===0&&r[3]===0||!fG(r,this.basemapTerrain.spatialReference,J1e,s)||(this.renderCoordsHelper.extent=J1e)},or),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(tP/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){t!=null&&t.type===Lr.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(te(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),or),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e,i){if(!this.overlay||!this.overlay.hasVisibleItems)return i;const r=t.getContext("2d");return r.putImageData(i,0,0),this.overlay.renderCanvas(t,{disableDecorations:e===Zl.OFF}),r.getImageData(0,0,i.width,i.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(r,s,n)=>this._renderScreenshotOverlay(r,s,n)}},e=new XRt(this.state.viewingMode,r=>this._stage.layers.forAll(r),this);this._set("sceneIntersectionHelper",e);const i=pG(this.surface);this._stage=new rh({view:this,options:t,container:i}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,r=>this._stage.renderer.setParameters({highQualityTransparency:r}),$t),this.on("pointer-move",()=>{var r;return(r=this._stage)==null?void 0:r.renderer.resetAnimation()}),kP(this._stage.renderView.canvas,"webglcontextlost",r=>{this.fatalError=new G("webgl-context-lost",r.statusMessage)})],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(tP/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=qe(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new F$t({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await ce(async()=>{const{default:i}=await import("./GraphicsView3D-BWz-Rbfu.js");return{default:i}},__vite__mapDeps([211,124,109,29,23,24,82]))).default;Dt(t),await VS(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.ready},t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=xhe(this.viewingMode);t===Xe.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.addHandles(Ks(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded();const e=this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties:null,i=e==null?void 0:e.environment;i&&MMe(this.environment,i),this.timeExtent=e==null?void 0:e.timeExtent,this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect(),this._set("textures",new OM(this._stage,this.resourceController.scheduler));const r=this._resolveWhenReady;this._resolveWhenReady=[],r.forEach(s=>s(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._set("textures",qe(this.textures)),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(Ab);for(const t of this.map.allLayers.items)tL(t.type)&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(Ab);for(const t of this.map.allLayers.items)tL(t.type)&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}};function T5(t,e){return t!=null&&Bc(t.spatialReference,e)?b_(t,e):null}dt.type="3d",h([p()],dt.prototype,"_userClippingArea",void 0),h([p()],dt.prototype,"_resourceController",void 0),h([p()],dt.prototype,"_stage",void 0),h([p({readOnly:!0})],dt.prototype,"deconflictor",void 0),h([p({readOnly:!0})],dt.prototype,"labeler",void 0),h([p(vY(JA,"analyses"))],dt.prototype,"analyses",void 0),h([p({type:aP,readOnly:!0})],dt.prototype,"animation",null),h([p({readOnly:!0})],dt.prototype,"basemapTerrain",void 0),h([p({readOnly:!0})],dt.prototype,"elevationProvider",void 0),h([p()],dt.prototype,"camera",null),h([p({type:Bh})],dt.prototype,"contentCamera",null),h([p({readOnly:!0})],dt.prototype,"canvas",void 0),h([p({type:bt})],dt.prototype,"center",null),h([p({type:ur})],dt.prototype,"clippingArea",null),h([p({type:bT})],dt.prototype,"constraints",void 0),h([p({type:ur,readOnly:!0})],dt.prototype,"renderDataExtent",null),h([p({readOnly:!0})],dt.prototype,"tileInfo",null),h([p({type:ur,readOnly:!0})],dt.prototype,"dataExtent",null),h([p({type:ur,readOnly:!0})],dt.prototype,"_groundAndLayersExtent",null),h([p({type:wC})],dt.prototype,"environment",void 0),h([Kt("environment")],dt.prototype,"castEnvironment",null),h([p({readOnly:!0})],dt.prototype,"environmentManager",void 0),h([p({type:ur})],dt.prototype,"extent",null),h([p()],dt.prototype,"floors",void 0),h([p()],dt.prototype,"screenCenter",null),h([p()],dt.prototype,"frustum",null),h([p({type:Number,readOnly:!0})],dt.prototype,"fullOpacity",void 0),h([p({readOnly:!0})],dt.prototype,"graphicsView",void 0),h([p({readOnly:!0})],dt.prototype,"analysisViewManager",void 0),h([p()],dt.prototype,"groundView",void 0),h([p({type:Boolean})],dt.prototype,"initialExtentRequired",null),h([p()],dt.prototype,"_defaultsFromMapSettings",null),h([p()],dt.prototype,"interacting",null),h([p()],dt.prototype,"stationary",null),h([p()],dt.prototype,"navigating",null),h([p()],dt.prototype,"map",void 0),h([p({readOnly:!0})],dt.prototype,"mapCoordsHelper",void 0),h([p()],dt.prototype,"padding",null),h([p({type:Cc,readOnly:!0})],dt.prototype,"pointsOfInterest",void 0),h([p({type:Xo,readOnly:!0})],dt.prototype,"featureTiles",void 0),h([p()],dt.prototype,"_featureTreeDebugger",void 0),h([p({type:Boolean})],dt.prototype,"screenSizePerspectiveEnabled",void 0),h([p({constructOnly:!0})],dt.prototype,"deactivatedWebGLExtensions",void 0),h([p({constructOnly:!0})],dt.prototype,"debugWebGLExtensions",void 0),h([p({constructOnly:!0})],dt.prototype,"renderCanvas",void 0),h([p({constructOnly:!0})],dt.prototype,"state",void 0),h([p({readOnly:!0})],dt.prototype,"inputManager",void 0),h([p({readOnly:!0})],dt.prototype,"stateManager",void 0),h([p({type:["low","medium","high"]})],dt.prototype,"qualityProfile",null),h([p({type:F_e,get(){let t=this._get("qualitySettings");return t||(t=new F_e,$U.apply(this.qualityProfile,t)),t}})],dt.prototype,"qualitySettings",void 0),h([p()],dt.prototype,"slicePlane",null),h([p({readOnly:!0})],dt.prototype,"typeSpecificPreconditionsReady",null),h([p({readOnly:!0})],dt.prototype,"renderCoordsHelper",void 0),h([p({readOnly:!0})],dt.prototype,"sceneIntersectionHelper",void 0),h([p({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],dt.prototype,"resolution",null),h([p({type:Number})],dt.prototype,"scale",null),h([p()],dt.prototype,"heightModelInfo",null),h([p()],dt.prototype,"spatialReference",void 0),h([p({type:Boolean,constructOnly:!0})],dt.prototype,"alphaCompositingEnabled",void 0),h([p({constructOnly:!0})],dt.prototype,"preserveDrawingBufferEnabled",void 0),h([p({type:Boolean})],dt.prototype,"supersampleScreenshotsEnabled",void 0),h([p({readOnly:!0})],dt.prototype,"type",void 0),h([p(),Kt(t=>t instanceof tze?t:OS(ize,t))],dt.prototype,"ui",void 0),h([p({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],dt.prototype,"updating",null),h([p()],dt.prototype,"_updatingObjects",null),h([p()],dt.prototype,"_updatingObjectsWithProgress",null),h([p({type:Number,readOnly:!0,dependsOn:["updating"]})],dt.prototype,"updatingProgress",void 0),h([p({type:["global","local"]})],dt.prototype,"viewingMode",null),h([p({type:Zf})],dt.prototype,"viewpoint",null),h([p({type:Number})],dt.prototype,"zoom",null),h([p({type:J5e})],dt.prototype,"highlightOptions",void 0),h([p({readOnly:!0})],dt.prototype,"quality",null),h([p({readOnly:!0})],dt.prototype,"resolutionScale",null),h([p()],dt.prototype,"textures",void 0),dt=h([I("esri.views.SceneView")],dt);const S5=E(),$7=Ss(),J1e=oi(),Q1e=dt;function Qae(t){return e=>{e.hasOwnProperty("_delegatedEventNames")||(e._delegatedEventNames=e._delegatedEventNames?e._delegatedEventNames.slice():[]);const i=e._delegatedEventNames,r=Array.isArray(t)?t:AUt(t);i.push(...r)}}function AUt(t){return t.split(",").map(e=>e.trim())}const rze=()=>se.getLogger("esri.widgets.support.geolocationUtils");function PUt(){const t=le("esri-geolocation");return t||rze().warn("geolocation-unsupported","Geolocation unsupported."),t}function OUt(){const t=window.isSecureContext;return t||rze().warn("insecure-context","Geolocation requires a secure origin."),t}function RUt(){return PUt()&&OUt()}function $Ut(t,e){const{position:i,view:r}=t,s=IUt(i),n=s==null?void 0:s.coords;if(!n)throw new G("geometry-service:no-coords","Geolocation has no coordinates");return DUt(LUt(n),r,e)}function IUt(t){const e=t&&t.coords||{},i={accuracy:e.accuracy,altitude:e.altitude,altitudeAccuracy:e.altitudeAccuracy,heading:e.heading,latitude:e.latitude,longitude:e.longitude,speed:e.speed};return t&&{coords:i,timestamp:t.timestamp}}function LUt({longitude:t,latitude:e,altitude:i}){return new bt({longitude:t,latitude:e,z:i||void 0,spatialReference:{wkid:4326}})}function DUt(t,e,i){if(!e)return Promise.resolve(t);const r=e.spatialReference;return r.isWGS84?Promise.resolve(t):r.isWebMercator?Promise.resolve(kg(t)):NUt(i).then(s=>{if(!s)throw new G("geometry-service:missing-url","Geometry service URL is missing");const n=new X6({geometries:[t],outSpatialReference:r});return dae(s,n,i).then(o=>o[0])})}function NUt(t){if(rr.geometryServiceUrl)return Promise.resolve(rr.geometryServiceUrl);const e=Wn.getDefault();return e.load(t).catch(()=>{}).then(()=>{var i,r;return(r=(i=e.helperServices)==null?void 0:i.geometry)==null?void 0:r.url})}const FUt=2500,sze={type:"CIMPictureMarker",primitiveName:"headingOverride",enable:!0,anchorPoint:{x:0,y:-.5},anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:36,billboardMode3D:"FaceNearPlane",invertBackfaceTexture:!0,scaleX:1,textureFilter:"Picture",url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAkCAYAAACe0YppAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAYaSURBVHgBvVfNb1VFFD/nzP16xRYJKYREEiJoDLLShQkrSNzoHv8I2QgxwY8FJWHhxoVxISEu2AordWNiQjAxEBeEsKAmhCCwkPDRAn1t33v33jnH37n3Fam0pa8kTjOde+/MnN/5+J0z85jW08yYTpxgfzx0bS+fO0R0YHqyeb9w7YEtLTv+9rSdOH7ciNleJJJX/Do1JQ3AltdlT35fiN6gG8kD8akdmzO+6w/zM7wdw725rUY78DBXtmATA6PZntFgm9Kjm6o/HFJpdi5Xhp+16sDBC+H+gUmZfjIXHKC+35U42ZHZfpe30BZS7okNFnhu8wTRk2ek5LEV2q+N8nEj6yuNVRjHddftrt4ahyJbOxF+Uppi/Rf47NlA05Pp9vkyRNkkD8sqUJHwOGfSpYFQFXhTJryQBaZSeAxbFus+U1K0gJm2oy3QKwuZzqeuSK5kpW6BEsE6+nCsAHDXQWuaOljzU8uP/ToxUW4KcwKg8QzOSdFL6Swm0hurAC7N2qIW7ncwNgYKF4la3/w7RnzrUK29KseXWqmTKXGl45Zrd9CLrsSjr96fcw4kS46mTsJznSTrVBR6VQJQdDbpZTWexxgCYCFz30cquD8oYVQgtUAUzfo8wGtqGoNRFmFZ1KKulJMQu3Vpm/I8Pup3ekvES57GaabXo4lsszEA6zrkhcmAAkBNshi59O9wVsokBLZUCQAxllXVBkyCDRQuTlLLiLSEqw3gfUqU0kVdsKymsnzyPLm8fXZxDxVZgvUhg9QyaKDI7AhpSlRVEaA83JM+/V8pGO0PMTHyZwra9FQVk4i1e0D6dPK9v5agkmXAhc0Bw5MjlAQQE0lSDbUmbBX4kGfsiiQWuSZtdle1S4F73cUKJgviyw4mmmqlVSoR/FAK2d1noWQZ8N79MySw0tgNzhN00jRFaPM6y3IyLWBxXuOdvMfhaIy1MQctmvnEMGrMq2Y/ekC3dHF14I84gmZP2s0pgiJFHVwYhIIrMC1zgT4fQgsS0CG48LWtslAsgeKZK5U1c5Slj+nEvvJZqOWubr5ks8iE3bVqCMQCz4p5aiUqpMrOdHz2qLFTxAMSPLwY8WpmntNwrXIMCWvESGH+7n9hVi6ZJ6/sR5gnycFFQgsCQEEB8T9TbsCGy4PrZrEBjGyIt4EApoGRXWKP6Mt3fnvOvhWBjR4gdjtJEDmGQQkBSCS6Teys5qECABTPWOBwcPWgAPIU+E2+Rq3J8lsrQawMHNPbqAXvRqasWcMB/mK42N3twM6/FsbJTZK2Fru15K7niPVIp6RHn++9vRKErAg8ta+MFq4LBxAJKY1EajpxLj5KUzFzOMTni4btxoUzXPzIIOwLnEPxGVqlyWoTdO/WNRUXJhDmAgNAJVd0eABj8FTCvLbpEnxdOycJlFNXVq6MDvzthwOQ654LaMGGVofQWIWtXhM9xaCQp85QIZFMPXcpuUPH3uquJj6htVonvySD+KY6c2AulPAzHdVaZElvPCGBgvkIRUECr1J4qmV6LdGyJvAnu+94HZMla1Eg1AuGVyQWnNCwzqsUXK5+AIsUyPRc1Rbpi93X1xK9tsXtkj9U7INWSWvU0DaZ6OlVAmUDiqgbrwY2Z3ThRVKFXrgi/R0x9GMplxAyER6ynAtZin1DQoLVznLMU+/mywMf3dlDpbyMlbjLQDhLw/Sh24sm5dhTrlHKgS/T0X2zLw/sLeGr5OlEbg2uHwAFw5reKuKsJj8kcIj0zq9H5PqAj+z6E8y+YRIaUhnAEOrcWgv9m3shQ1H7mz5duVJtDLhZqZcNlrEDwXKwCzncdFg+PJeVf1m3uPUupLR7Hq6tHNyLhw1TCmdGbm0BmaUjr63LzaMBH943D9f+yO5uZ7HfcLktqdwqMU0jtPUDN6vDOfzgKFrXtta6q83vfHU4M5KoURbT4W3zsPIqrgQFO8GozV8ocZGOTN4dRdRowN6CnOLmKkk5t7H1i+HPNGJj2kj7buYajoRXh2+36eOt+2nENrrF3ozODEmFC0D4hjbQNgYc+DSYjd9qqGSJXqL/tZ16/DWdfvw9bbCt41hcpYn9RAEX9Q22fwC74ny5v9iplQAAAABJRU5ErkJggg=="},kUt=new S_({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:0},anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:14,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:17,ymax:17},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[8.5,0],[7.02,.13],[5.59,.51],[4.25,1.14],[3.04,1.99],[1.99,3.04],[1.14,4.25],[.51,5.59],[.13,7.02],[0,8.5],[.13,9.98],[.51,11.41],[1.14,12.75],[1.99,13.96],[3.04,15.01],[4.25,15.86],[5.59,16.49],[7.02,16.87],[8.5,17],[9.98,16.87],[11.41,16.49],[12.75,15.86],[13.96,15.01],[15.01,13.96],[15.86,12.75],[16.49,11.41],[16.87,9.98],[17,8.5],[16.87,7.02],[16.49,5.59],[15.86,4.25],[15.01,3.04],[13.96,1.99],[12.75,1.14],[11.41,.51],[9.98,.13],[8.5,0]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Round",joinStyle:"Round",lineStyle3D:"Strip",miterLimit:10,width:2,color:[255,255,255,255]},{type:"CIMSolidFill",enable:!0,color:[0,122,194,255]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:0},anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:16,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:17,ymax:17},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[8.5,0],[7.02,.13],[5.59,.51],[4.25,1.14],[3.04,1.99],[1.99,3.04],[1.14,4.25],[.51,5.59],[.13,7.02],[0,8.5],[.13,9.98],[.51,11.41],[1.14,12.75],[1.99,13.96],[3.04,15.01],[4.25,15.86],[5.59,16.49],[7.02,16.87],[8.5,17],[9.98,16.87],[11.41,16.49],[12.75,15.86],[13.96,15.01],[15.01,13.96],[15.86,12.75],[16.49,11.41],[16.87,9.98],[17,8.5],[16.87,7.02],[16.49,5.59],[15.86,4.25],[15.01,3.04],[13.96,1.99],[12.75,1.14],[11.41,.51],[9.98,.13],[8.5,0]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Round",joinStyle:"Round",lineStyle3D:"Strip",miterLimit:10,width:0,color:[255,255,255,255]},{type:"CIMSolidFill",enable:!0,color:[0,0,0,66]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,offsetX:0,offsetY:-1},sze],angleAlignment:"Map"},primitiveOverrides:[{type:"CIMPrimitiveOverride",primitiveName:"headingOverride",propertyName:"Rotation",valueExpressionInfo:{type:"CIMExpressionInfo",title:"Rotation override",expression:"360 - $feature.heading",returnType:"Default"}},{type:"CIMPrimitiveOverride",primitiveName:"headingOverride",propertyName:"TintColor",valueExpressionInfo:{type:"CIMExpressionInfo",title:"TintColor override",expression:"IIF(IsEmpty($feature.heading), [255, 255, 255, 0], [255, 255, 255, 1])",returnType:"Default"}}]}});let Qm=class extends Jae(Us.EventedMixin(Ue)){constructor(){super(...arguments),this._geolocationUsable=!0,this.geolocationOptions=null,this.goToLocationEnabled=!0,this.graphic=new ca({symbol:kUt}),this.scale=null,this.rotationEnabled=!0,this.view=null}initialize(){RUt()||(this._geolocationUsable=!1),this.addHandles([te(()=>{var e;return(e=this.view)==null?void 0:e.type},()=>this._handleViewTypeChange(),$t)])}destroy(){this._clearGraphic(),this.view=null}_clearGraphic(){const{view:e,graphic:i}=this;e&&i&&e.graphics.remove(i)}_addGraphic(){const{view:e,graphic:i}=this;e!=null&&e.graphics&&i&&!e.graphics.includes(i)&&e.graphics.push(i)}_handleViewTypeChange(){var e;sze.enable=((e=this.view)==null?void 0:e.type)==="2d"}_getScaleWithinConstraints(e,i){if(!i)return e;if(i.type==="2d"){const{effectiveMaxScale:r,effectiveMinScale:s}=i.constraints;return Math.min(s,Math.max(r,e))}return e}_getScale(e){const{scale:i}=this,r=typeof i=="number"?i:FUt;return this._getScaleWithinConstraints(r,e)}_getHeading(e,i){var o;const r=i==null?void 0:i.spatialReference,s=(r==null?void 0:r.isWebMercator)||(r==null?void 0:r.isGeographic),n=(o=e.coords)==null?void 0:o.heading;return!s||typeof n!="number"||isNaN(n)||n<0||n>360?null:n}_addHeading(e){const{heading:i,target:r,view:s}=e;s&&i!==null&&(s.type!=="3d"?s.type==="2d"&&(r.rotation=360-i):r.heading=i)}async _animatePoint(e,i,r,s){const{view:n}=this;if(!this.goToLocationEnabled||!n)return;const o={target:e,scale:i};this.rotationEnabled&&this._addHeading({heading:r,target:o,view:n});const a={signal:s.signal};Dt(a),await this.callGoTo({target:o,options:a})}async updatePosition(e,i){try{const r=this.view,s=await $Ut({position:e,view:r},{signal:i.signal}),{graphic:n}=this,{timestamp:o,coords:a}=e,{accuracy:l,altitude:c,altitudeAccuracy:u,latitude:d,longitude:f,speed:m}=a,g=this._getHeading(e,r),y={timestamp:o,accuracy:l,altitude:c,altitudeAccuracy:u,heading:g,latitude:d,longitude:f,speed:m};n&&(n.geometry=s,n.attributes=y);const v=this._getScale(r);await this._animatePoint(s,v,g,i)}catch(r){if(!os(r))throw new G("geolocation-positioning:invalid-point","Cannot position invalid point",{error:r})}return e}};h([p()],Qm.prototype,"_geolocationUsable",void 0),h([p()],Qm.prototype,"geolocationOptions",void 0),h([p()],Qm.prototype,"goToLocationEnabled",void 0),h([p({type:ca,nonNullable:!0})],Qm.prototype,"graphic",void 0),h([p()],Qm.prototype,"scale",void 0),h([p()],Qm.prototype,"rotationEnabled",void 0),h([p()],Qm.prototype,"view",void 0),Qm=h([I("esri.widgets.support.GeolocationPositioning")],Qm);const UUt=Qm,VUt=15e3;let bd=class extends UUt{constructor(e){super(e),this._watchId=void 0,this._trackStartingTimeoutId=void 0,this._settingPosition=null,this._trackController=null,this.error=void 0,this.positionFilterFunction=null}destroy(){this._stopTracking()}get state(){return this._geolocationUsable?this.view&&!this.view.ready?"disabled":this._settingPosition||this._trackStartingTimeoutId!==void 0?"waiting":this.tracking?"tracking":this.error!=null?"error":"ready":"feature-unsupported"}get tracking(){return this._watchId!==void 0}start(){this.state!=="disabled"&&this.state!=="feature-unsupported"&&this._startTracking()}stop(){this.state!=="disabled"&&this.state!=="feature-unsupported"&&this._stopTracking()}_stopWatchingPosition(){this._watchId!==void 0&&(navigator.geolocation.clearWatch(this._watchId),this._watchId=void 0)}_stopTracking(){this._abortTrack(),this._clearWaitingTimer(),this._stopWatchingPosition(),this._clearGraphic()}_startTracking(){this._stopTracking();const e=q0(async i=>{this._abortTrack();const r=new AbortController;this._trackController=r;const{timestamp:s,coords:n}=i,o={timestamp:s,coords:{...n}};this.error=void 0;try{if(typeof this.positionFilterFunction=="function"&&!this.positionFilterFunction.call(null,{position:o})||(await this.updatePosition(i,r),this._trackController!==r))return;this._clearWaitingTimer(),this._addGraphic(),this.emit("track",{position:i}),this._trackController=null}catch(a){if(os(a))return;throw this._trackController=null,this._emitError(a),this._clearWaitingTimer(),a}},0);this._watchId=navigator.geolocation.watchPosition(i=>{this._settingPosition=e(i).catch(H0)},this._handleWatchPositionError.bind(this),this.geolocationOptions??void 0),this._trackStartingTimeoutId=setTimeout(()=>{this._trackStartingTimeoutId=void 0},VUt)}_handleWatchPositionError(e){e.code===e.PERMISSION_DENIED&&this._stopTracking(),this._emitError(e)}_abortTrack(){var e;(e=this._trackController)==null||e.abort(),this._trackController=null}_clearWaitingTimer(){clearTimeout(this._trackStartingTimeoutId),this._trackStartingTimeoutId=void 0,this._settingPosition=null}_emitError(e){this.error=e,this.emit("track-error",{error:e})}};h([p()],bd.prototype,"_watchId",void 0),h([p()],bd.prototype,"_trackStartingTimeoutId",void 0),h([p()],bd.prototype,"_settingPosition",void 0),h([p()],bd.prototype,"error",void 0),h([p()],bd.prototype,"positionFilterFunction",void 0),h([p({readOnly:!0})],bd.prototype,"state",null),h([p({readOnly:!0})],bd.prototype,"tracking",null),h([p()],bd.prototype,"start",null),h([p()],bd.prototype,"stop",null),bd=h([I("esri.widgets.Track.TrackViewModel")],bd);const nze=bd,zUt={base:"esri-track"};let Tc=class extends Ua{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new nze,this._toggleTracking=()=>{const r=this.viewModel;r&&r.state!=="feature-unsupported"&&r.state!=="disabled"&&(r.state!=="tracking"&&r.state!=="waiting"?this.viewModel.start():this.viewModel.stop())}}loadDependencies(){return sm({button:()=>ce(()=>import("./calcite-button-DQc9b2O5.js"),__vite__mapDeps([196,197,198,199,200,201,202,203,204,205,206,207,208])),tooltip:()=>ce(()=>import("./calcite-tooltip-DzQ_U6v0.js"),__vite__mapDeps([212,198,199,213,214,215,216]))})}get geolocationOptions(){return this.viewModel.geolocationOptions}set geolocationOptions(e){this.viewModel.geolocationOptions=e}get goToLocationEnabled(){return this.viewModel.goToLocationEnabled}set goToLocationEnabled(e){this.viewModel.goToLocationEnabled=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get icon(){return"compass-north-circle"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get rotationEnabled(){return this.viewModel.rotationEnabled}set rotationEnabled(e){this.viewModel.rotationEnabled=e}get scale(){return this.viewModel.scale}set scale(e){this.viewModel.scale=e}get tracking(){return this.viewModel.tracking}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}start(){this.viewModel.start()}stop(){this.viewModel.stop()}render(){var u;const{viewModel:e,messages:i,icon:r}=this,s=e==null?void 0:e.state,n=s==="tracking",o=this._localizeError((u=this.viewModel)==null?void 0:u.error),a=(n?i==null?void 0:i.stopTracking:i==null?void 0:i.startTracking)??"",l=s==="feature-unsupported",c=(s==="tracking"?"pause":void 0)??r;return ge("div",{class:this.classes(zUt.base,ni.widget)},!l&&ge("calcite-button",{class:ni.widgetButton,disabled:s==="disabled",iconStart:c,kind:"neutral",label:a,loading:s==="waiting",onclick:this._toggleTracking,title:a}),o?ge("calcite-tooltip",{open:!0,overlayPositioning:"fixed",referenceElement:this.container},o):null)}_localizeError(e){var i,r,s;return e instanceof GeolocationPositionError?e.code===GeolocationPositionError.PERMISSION_DENIED?(i=this.messages)==null?void 0:i.permissionError:e.code===GeolocationPositionError.TIMEOUT?(r=this.messages)==null?void 0:r.timeoutError:(s=this.messages)==null?void 0:s.positionUnavailable:e instanceof Error?e.message:void 0}};h([p()],Tc.prototype,"geolocationOptions",null),h([p()],Tc.prototype,"goToLocationEnabled",null),h([p()],Tc.prototype,"goToOverride",null),h([p()],Tc.prototype,"graphic",null),h([p()],Tc.prototype,"icon",null),h([p()],Tc.prototype,"label",null),h([p(),Fa("esri/widgets/Track/t9n/Track")],Tc.prototype,"messages",void 0),h([p()],Tc.prototype,"rotationEnabled",null),h([p()],Tc.prototype,"scale",null),h([p({readOnly:!0})],Tc.prototype,"tracking",null),h([p()],Tc.prototype,"view",null),h([p({type:nze}),Qae(["track","track-error"])],Tc.prototype,"viewModel",void 0),Tc=h([I("esri.widgets.Track")],Tc);const BUt=Tc;function hj(t,e,i,r){let s=null,n=1e3;typeof e=="number"?(n=e,r=i):(s=e??null,n=i);let o,a=0;const l=()=>{a=0,t.apply(r,o)},c=(...u)=>{s&&s.apply(r,u),o=u,n?a||(a=setTimeout(l,n)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}function fee(t){var e;switch(t==null?void 0:t.type){case"point":return t;case"extent":return t.center;case"polygon":return t.centroid;case"multipoint":case"polyline":return(e=t.extent)==null?void 0:e.center;default:return null}}function jUt(t){return t?{backgroundImage:`url(${t})`}:{}}function GUt({action:t,feature:e}){const i=e==null?void 0:e.attributes,r="image"in t?t.image:void 0;return r&&i?dg(r,i):r??""}function oze(t,e,i){return t.units[e][i]}function fO(t,e,i,r=2,s="abbr"){return`${Xl(e,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:e>0?"never":"exceptZero"})} ${oze(t,i,s)}`}function rH(t,e,i,r=2,s="abbr"){return`${Xl(e,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:"exceptZero"})} ${oze(t,i,s)}`}function Gui(t,e,i,r=2,s="abbr"){const n=Qie(e,i);return fO(t,Vr(e,i,n),n,r,s)}function Hui(t,e,i,r=2,s="abbr"){const n=Qie(e,i);return rH(t,Vr(e,i,n),n,r,s)}function qui(t,e,i,r=2,s="abbr"){const n=Kie(e,i);return fO(t,Vr(e,i,n),n,r,s)}function Wui(t,e,i,r=2,s="abbr"){const n=Kie(e,i);return rH(t,Vr(e,i,n),n,r,s)}function Zui(t,e,i,r=2,s="abbr"){const n=ere(e,i);return fO(t,Vr(e,i,n),n,r,s)}function Yui(t,e,i,r=2,s="abbr"){const n=ere(e,i);return rH(t,Vr(e,i,n),n,r,s)}function Xui(t,e,i,r=2,s="abbr"){const n=tre(e,i);return fO(t,Vr(e,i,n),n,r,s)}function Jui(t,e,i,r=2,s="abbr"){const n=tre(e,i);return rH(t,Vr(e,i,n),n,r,s)}function Qui(t,e,i,r=2,s="abbr"){const n=PWe(e,i);return fO(t,Vr(e,i,n),n,r,s)}function Kui(t,e,i,r=2,s="abbr"){const n=OWe(e,i);return fO(t,Vr(e,i,n),n,r,s)}const HUt=(t,e)=>({style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:e,minimumFractionDigits:e,signDisplay:t>0?"never":"exceptZero"});function ehi(t,e,i,r,s,n=lG,o=!0){let a=n.normalize(elt(Vr(t,e,"degrees"),i,r),0,o);const l=HUt(a,s??2);return a=aze(a,l),Xl(a,l)}function thi(t,e,i,r,s){i!==r&&(t=-t);const n={style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:s=s??2,minimumFractionDigits:s,signDisplay:"exceptZero"};let o=Vr(t,e,"degrees")%360;return o=aze(o,n),Xl(o,n)}const K1e=new Map;function aze(t,e){const i=JSON.stringify(e);let r=K1e.get(i);return r||(r=new Intl.NumberFormat("en-US",e),K1e.set(i,r)),/^[-+]?360\.?0*°?$/.test(r.format(t))?0:t}const ebe=["B","kB","MB","GB","TB"];function qUt(t,e){let i=(e=Math.round(e))===0?0:Math.floor(Math.log(e)/Math.log(GL.KILOBYTES));i=Ne(i,0,ebe.length-1);const r=Xl(e/GL.KILOBYTES**i,{maximumFractionDigits:2});return Xg(t.units.bytes[ebe[i]],{fileSize:r})}function WUt(t){const{exifInfo:e,exifName:i,tagName:r}=t;if(!e||!i||!r)return null;const s=e.find(n=>n.name===i);return s?ZUt({tagName:r,tags:s.tags}):null}function ZUt(t){const{tagName:e,tags:i}=t;if(!i||!e)return null;const r=i.find(s=>s.name===e);return(r==null?void 0:r.value)||null}var mee;const YUt={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let tu=mee=class extends Se{constructor(t){super(t),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:t}=this,e=WUt({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:t});return YUt[e]||null}clone(){return new mee({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};h([p({type:String})],tu.prototype,"contentType",void 0),h([p()],tu.prototype,"exifInfo",void 0),h([p({readOnly:!0})],tu.prototype,"orientationInfo",null),h([p({type:Xi})],tu.prototype,"id",void 0),h([p({type:String})],tu.prototype,"globalId",void 0),h([p({type:String})],tu.prototype,"keywords",void 0),h([p({type:String})],tu.prototype,"name",void 0),h([p({json:{read:!1}})],tu.prototype,"parentGlobalId",void 0),h([p({json:{read:!1}})],tu.prototype,"parentObjectId",void 0),h([p({type:Xi})],tu.prototype,"size",void 0),h([p({json:{read:!1}})],tu.prototype,"url",void 0),tu=mee=h([I("esri.rest.query.support.AttachmentInfo")],tu);const XUt=tu;var gee;let ya=gee=class extends Se{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new gee(ie({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};h([p({type:[String],json:{write:!0}})],ya.prototype,"attachmentTypes",void 0),h([p({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],ya.prototype,"attachmentsWhere",void 0),h([p({type:Boolean,json:{write:!0}})],ya.prototype,"cacheHint",void 0),h([p({type:[String],json:{write:!0}})],ya.prototype,"keywords",void 0),h([p({type:[Number],json:{write:!0}})],ya.prototype,"globalIds",void 0),h([p({json:{write:!0}})],ya.prototype,"name",void 0),h([p({type:Number,json:{read:{source:"resultRecordCount"}}})],ya.prototype,"num",void 0),h([p({type:[Number],json:{write:!0}})],ya.prototype,"objectIds",void 0),h([p({type:Boolean,json:{default:!1,write:!0}})],ya.prototype,"returnMetadata",void 0),h([p({type:[Number],json:{write:!0}})],ya.prototype,"size",void 0),h([p({type:Number,json:{read:{source:"resultOffset"}}})],ya.prototype,"start",void 0),h([We("start"),We("num")],ya.prototype,"writeStart",null),h([p({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],ya.prototype,"where",void 0),ya=gee=h([I("esri.rest.support.AttachmentQuery")],ya),ya.from=Qs(ya);const yee=ya;function JUt(t){return _se(t)||Gnt(t)||Hnt(t)}function lze(t,e){const{format:i,timeZoneOptions:r,fieldType:s}=e??{};let n,o;if(r&&({timeZone:n,timeZoneName:o}=nSe(r.layerTimeZone,r.datesInUnknownTimezone,r.viewTimeZone,C1(i||"short-date-short-time"),s)),typeof t=="string"&&isNaN(Date.parse(s==="time-only"?`1970-01-01T${t}Z`:t)))return t;switch(s){case"date-only":{const a=C1(i||"short-date");return typeof t=="string"?G8e(t,{...a}):Mu(t,{...a,timeZone:Yg})}case"time-only":{const a=C1(i||"short-time");return typeof t=="string"?H8e(t,a):Mu(t,{...a,timeZone:Yg})}case"timestamp-offset":{if(!n&&typeof t=="string"&&new Date(t).toISOString()!==t)return t;const a=i||r?C1(i||"short-date-short-time"):void 0,l=a?{...a,timeZone:n,timeZoneName:o}:void 0;return typeof t=="string"?q8e(t,l):Mu(t,l)}default:{const a=i||r?C1(i||"short-date-short-time"):void 0;return Mu(typeof t=="string"?new Date(t):t,a?{...a,timeZone:n,timeZoneName:o}:void 0)}}}const QUt="esri.widgets.Feature.support.featureUtils",_ee=()=>se.getLogger(QUt),KUt=/href=(""|'')/gi,eVt=/(\{([^{\r\n]+)\})/g,tVt=/'/g,cze=/^\s*expression\//i,iVt=/(\n)/gi,rVt=/[\u00A0-\u9999<>&]/gim,sVt=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,nVt=/^(?:mailto:|tel:)/,uze="relationships/",tbe=C1("short-date-short-time");function hze(t){if(t!=null)return(t.sourceLayer||t.layer)??void 0}async function dj({type:t,value:e,event:i}){try{return typeof e=="function"?e(i):e}catch(r){return void _ee().error("error",`An error occurred when calling the "${t}" function`,{error:r,graphic:i.graphic,value:e})}}function dze(t=""){if(t)return!nVt.test(t.trim().toLowerCase())}function Kae(t){return!!t&&cze.test(t)}function oVt(t,e){if(!e||!Kae(e)||!t)return;const i=e.replace(cze,"").toLowerCase();return t.find(({name:r})=>r.toLowerCase()===i)}function pze(t,e){const i=oVt(e,t==null?void 0:t.fieldName);return i?i.title||null:t?t.label||t.fieldName:null}function aVt(t,e){const i=e.get(t.toLowerCase());return`{${(i==null?void 0:i.fieldName)||t}}`}function lVt(t){return t.replaceAll(KUt,"")}function XL(t,e){const i=ele(e,t);return i?i.name:t}function cVt(t,e){return t&&t.map(i=>XL(i,e))}function ele(t,e){return t&&typeof t.getField=="function"&&e?t.getField(e)??null:null}function fze(t){return`${t}`.trim()}function GT({attributes:t,globalAttributes:e,layer:i,text:r,expressionAttributes:s,fieldInfoMap:n}){return r?vee({formattedAttributes:e,template:pVt(r,{...e,...s,...t},i),fieldInfoMap:n}):""}function vee({formattedAttributes:t,template:e,fieldInfoMap:i}){return fze(lVt(Xg(Xg(e,r=>aVt(r,i)),t)))}function uVt(t,e,i=!1){const r=e[t];if(typeof r=="string"){const s="%27",n=(i?encodeURIComponent(r):r).replaceAll(tVt,s);e[t]=n}}function hVt(t,e=!1){const i={...t};return Object.keys(i).forEach(r=>uVt(r,i,e)),i}function dVt(t,e,i){const r=(e=fze(e))&&e[0]!=="{";return Xg(t,hVt(i,r||!1))}function bee(t,e){return t.replaceAll(eVt,(i,r,s)=>{const n=ele(e,s);return n?`{${n.name}}`:r})}function pVt(t,e,i){const r=bee(t,i);return r&&r.replaceAll(sVt,(s,n,o)=>dVt(s,n||o,e))}function fVt(t,e){if(typeof t=="string"&&e&&e.dateFormat==null&&(e.places!=null||e.digitSeparator!=null)){const i=Number(t);if(!isNaN(i))return i}return t}function mVt(t){return t!=null&&typeof t=="object"&&"fieldsIndex"in t&&"geometryType"in t&&"getField"in t&&"load"in t&&"loaded"in t&&"objectIdField"in t&&"spatialReference"in t&&"type"in t&&(t.type==="feature"||t.type==="scene"||t.type==="sublayer")&&"when"in t}function gVt(t){return t!=null&&typeof t=="object"&&"createQuery"in t&&"queryFeatureCount"in t&&"queryObjectIds"in t&&"queryRelatedFeatures"in t&&"queryRelatedFeaturesCount"in t&&"relationships"in t}function mze(t){return mVt(t)&&gVt(t)}function yVt(t,e){var u;const{fieldInfos:i,fieldName:r,preventPlacesFormatting:s,layer:n,timeZone:o}=e,a=gze(i,r),l=ele(n,r);if(a&&!zY(r)){const d=l==null?void 0:l.type,f=(u=a.format)==null?void 0:u.dateFormat;if(d==="date"||d==="date-only"||d==="time-only"||d==="timestamp-offset"||f)return lze(t,{format:f,fieldType:d,timeZoneOptions:{layerTimeZone:n&&"preferredTimeZone"in n?n.preferredTimeZone:null,viewTimeZone:o,datesInUnknownTimezone:!(!n||!("datesInUnknownTimezone"in n))&&!!n.datesInUnknownTimezone}})}const c=a==null?void 0:a.format;return typeof t=="string"&&zY(r)&&c?_Vt(t,c):typeof(t=fVt(t,c))=="string"||t==null||c==null?pN(t):Xl(t,s?{...FV(c),minimumFractionDigits:0,maximumFractionDigits:20}:FV(c))}function _Vt(t,e){return t=t.trim(),/\d{2}-\d{2}/.test(t)?t:t.includes(",")?I7(t,",",", ",e):t.includes(";")?I7(t,";","; ",e):t.includes(" ")?I7(t," "," ",e):Xl(Number(t),FV(e))}function I7(t,e,i,r){return t.trim().split(e).map(s=>Xl(Number(s),FV(r))).join(i)}function gze(t,e){if(t!=null&&t.length&&e)return t.find(i=>{var r;return((r=i.fieldName)==null?void 0:r.toLowerCase())===e.toLowerCase()})}function vVt({fieldName:t,graphic:e,layer:i}){if(j0(t)||!i||typeof i.getFeatureType!="function")return null;const{typeIdField:r}=i;if(!r||t!==r)return null;const s=i.getFeatureType(e);return s?s.name:null}function bVt({fieldName:t,value:e,graphic:i,layer:r}){if(j0(t)||!r||typeof r.getFieldDomain!="function")return null;const s=i&&r.getFieldDomain(t,{feature:i});return s&&s.type==="coded-value"?s.getName(e):null}function wVt(t,e,i,r){const{creatorField:s,creationDateField:n,editorField:o,editDateField:a}=t;if(!e)return;const l=nSe(r&&"preferredTimeZone"in r?r.preferredTimeZone:null,!(!r||!("datesInUnknownTimezone"in r))&&!!r.datesInUnknownTimezone,i,tbe,"date"),c={...tbe,...l},u=e[a];if(typeof u=="number"){const f=e[o];return{type:"edit",date:Mu(u,c),user:f}}const d=e[n];if(typeof d=="number"){const f=e[s];return{type:"create",date:Mu(d,c),user:f}}return null}function xVt(t,e){const i=new Map;if(!t)return i;for(const r of t){if(!r.fieldName)continue;const s=XL(r.fieldName,e);r.fieldName=s,i.set(s.toLowerCase(),r)}return i}function ibe(t){const e=[];if(!t)return e;const{fieldInfos:i,content:r}=t;return i&&e.push(...i),r&&Array.isArray(r)&&r.forEach(s=>{if(s.type==="fields"){const n=s==null?void 0:s.fieldInfos;n&&e.push(...n)}}),e}function tle(t){return t.replaceAll(rVt,e=>`&#${e.charCodeAt(0)};`)}function pN(t){return typeof t=="string"?t.replaceAll(iVt,'<br class="esri-text-new-line" />'):t}function yze(t){var d;const{value:e,fieldName:i,fieldInfos:r,fieldInfoMap:s,layer:n,graphic:o,timeZone:a}=t;if(e==null)return"";const l=bVt({fieldName:i,value:e,graphic:o,layer:n});if(l)return l;const c=vVt({fieldName:i,graphic:o,layer:n});if(c)return c;if(s.get(i.toLowerCase()))return yVt(e,{fieldInfos:r||Array.from(s.values()),fieldName:i,layer:n,timeZone:a});const u=(d=n==null?void 0:n.fieldsIndex)==null?void 0:d.get(i);return u&&(JUt(u)||aOe(u))?lze(e,{fieldType:u.type,timeZoneOptions:{layerTimeZone:n&&"preferredTimeZone"in n?n.preferredTimeZone:null,viewTimeZone:a,datesInUnknownTimezone:!(!n||!("datesInUnknownTimezone"in n))&&!!n.datesInUnknownTimezone}}):pN(e)}function L7({fieldInfos:t,attributes:e,layer:i,graphic:r,fieldInfoMap:s,relatedInfos:n,timeZone:o}){const a={};return n==null||n.forEach(l=>CVt({attributes:a,relatedInfo:l,fieldInfoMap:s,fieldInfos:t,layer:i,timeZone:o})),e&&Object.keys(e).forEach(l=>{const c=e[l];a[l]=yze({fieldName:l,fieldInfos:t,fieldInfoMap:s,layer:i,value:c,graphic:r,timeZone:o})}),a}async function _ze(t,e){var u,d;const{layer:i,graphic:r,outFields:s,objectIds:n,returnGeometry:o,spatialReference:a}=t,l=n[0];if(typeof l!="number"&&typeof l!="string"){const f="Could not query required fields for the specified feature. The feature's ID is invalid.",m={layer:i,graphic:r,objectId:l,requiredFields:s};return _ee().warn(f,m),null}if(!((d=(u=cEe(i))==null?void 0:u.operations)!=null&&d.supportsQuery)){const f="The specified layer cannot be queried. The following fields will not be available.",m={layer:i,graphic:r,requiredFields:s,returnGeometry:o};return _ee().warn(f,m),null}const c=i.createQuery();return c.objectIds=n,c.outFields=s!=null&&s.length?s:[i.objectIdField],c.returnGeometry=!!o,c.returnZ=!!o,c.returnM=!!o,c.outSpatialReference=a,(await i.queryFeatures(c,e)).features[0]}async function TVt(t){var r;if(!((r=t.expressionInfos)!=null&&r.length))return!1;const e=await ry(),{arcadeUtils:{hasGeometryFunctions:i}}=e;return i(t)}async function SVt({graphic:t,popupTemplate:e,layer:i,spatialReference:r},s){if(!i||!e||(typeof i.load=="function"&&await i.load(s),!t.attributes))return;const n=i.objectIdField,o=t.attributes[n];if(o==null)return;const a=[o],l=await e.getRequiredFields(i.fieldsIndex),c=Knt(l,t),u=c?[]:l.includes(n)?l:[...l,n],d=e.returnGeometry||await TVt(e);if(c&&!d)return;const f=await _ze({layer:i,graphic:t,outFields:u,objectIds:a,returnGeometry:d,spatialReference:r},s);f&&(f.geometry&&(t.geometry=f.geometry),f.attributes&&(t.attributes={...t.attributes,...f.attributes}))}function j0(t=""){return!!t&&t.includes(uze)}function EVt(t){return t?`${uze}${t.layerId}/${t.fieldName}`:""}function rbe({attributes:t,graphic:e,relatedInfo:i,fieldInfos:r,fieldInfoMap:s,layer:n,timeZone:o}){t&&e&&i&&Object.keys(e.attributes).forEach(a=>{const l=EVt({layerId:i.relation.id.toString(),fieldName:a}),c=e.attributes[a];t[l]=yze({fieldName:l,fieldInfos:r,fieldInfoMap:s,layer:n,value:c,graphic:e,timeZone:o})})}function CVt({attributes:t,relatedInfo:e,fieldInfoMap:i,fieldInfos:r,layer:s,timeZone:n}){var o,a;t&&e&&((o=e.relatedFeatures)==null||o.forEach(l=>rbe({attributes:t,graphic:l,relatedInfo:e,fieldInfoMap:i,fieldInfos:r,layer:s,timeZone:n})),(a=e.relatedStatsFeatures)==null||a.forEach(l=>rbe({attributes:t,graphic:l,relatedInfo:e,fieldInfoMap:i,fieldInfos:r,layer:s,timeZone:n})))}const sbe=t=>{if(!t)return!1;const e=t.toUpperCase();return e.includes("CURRENT_TIMESTAMP")||e.includes("CURRENT_DATE")||e.includes("CURRENT_TIME")},vze=({layer:t,method:e,query:i,definitionExpression:r})=>{var o,a;if(!((a=(o=t.capabilities)==null?void 0:o.query)!=null&&a.supportsCacheHint)||e==="attachments")return;const s=i.where!=null?i.where:null,n=i.geometry!=null?i.geometry:null;sbe(r)||sbe(s)||(n==null?void 0:n.type)==="extent"||i.resultType==="tile"||(i.cacheHint=!0)},MVt=({query:t,layer:e,method:i})=>{vze({layer:e,method:i,query:t,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression??""}`})},AVt=({queryPayload:t,layer:e,method:i})=>{vze({layer:e,method:i,query:t,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression??""}`})};function PVt(t,e,i){var r,s;return t&&e&&i?e.type==="sublayer"?DM({layers:(r=e.layer)==null?void 0:r.sublayers,map:t,relatedLayer:e,relationship:i})||DM({layers:(s=e.layer)==null?void 0:s.subtables,map:t,relatedLayer:e,relationship:i}):DM({layers:t.allLayers,map:t,relatedLayer:e,relationship:i})||DM({layers:t.allTables,map:t,relatedLayer:e,relationship:i}):null}function nbe(t,e){return t==null?void 0:t.allTables.find(i=>{var r;return i.type==="feature"&&i.layerId===e.id&&i.url===((r=e.layer)==null?void 0:r.url)})}function DM({map:t,relationship:e,relationship:{relatedTableId:i},relatedLayer:r,layers:s}){var n;if(!s)return null;for(const o of s){if(o.type==="map-image"){const l=DM({layers:o.sublayers,map:t,relatedLayer:r,relationship:e})||DM({layers:o.subtables,map:t,relatedLayer:r,relationship:e});if(l)return l;continue}if(!mze(o))continue;if(r.type==="sublayer"){if(o!==r&&o.id===i)return o.isTable?nbe(t,o):o;continue}const a=r.type==="scene"&&r.associatedLayer?r.associatedLayer.url:r.url;if(!a)return null;if(o.type!=="sublayer"){if(o!==r&&o.url===a&&o.layerId===i)return o}else if(o!==r&&((n=o.layer)==null?void 0:n.url)===a&&o.id===i)return o.isTable?nbe(t,o):o}return null}const obe={editing:!1,operations:{add:!0,update:!0,delete:!0}},bze=st.ofType(XUt);let iu=class extends Ue{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities={...obe},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new bze,this.fileInfos=new st,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles(te(()=>this.graphic,()=>this._graphicChanged(),$t))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(e){return{...obe,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:e}=this;if(!e)return!1;const i=e.layer||e.sourceLayer;return(i==null?void 0:i.loaded)&&"capabilities"in i&&i.capabilities&&"operations"in i.capabilities&&"supportsResizeAttachments"in i.capabilities.operations&&i.capabilities.operations.supportsResizeAttachments||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:i}=this;if(!e||typeof e.queryAttachments!="function")throw new G("invalid-layer","getAttachments(): A valid layer is required.");const r=this._getObjectId(),s=new yee({objectIds:[r],returnMetadata:!0}),n=[],o=e.queryAttachments(s).then(l=>l[r]||n).catch(()=>n);this._getAttachmentsPromise=o,this.notifyChange("state");const a=await o;return i.destroyAll(),a.length&&i.addMany(a),this._getAttachmentsPromise=null,this.notifyChange("state"),a}async addAttachment(e,i=this.graphic){var l;const{_attachmentLayer:r,attachmentInfos:s,capabilities:n}=this;if(!i)throw new G("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:i});if(!e)throw new G("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!((l=n.operations)!=null&&l.add))throw new G("invalid-capabilities","addAttachment(): add capabilities are required.");if(!r||typeof r.addAttachment!="function")throw new G("invalid-layer","addAttachment(): A valid layer is required.");const o=r.addAttachment(i,e).then(c=>this._queryAttachment(c.objectId,i)),a=await o;return s.add(a),a}async deleteAttachment(e){var l;const{_attachmentLayer:i,attachmentInfos:r,graphic:s,capabilities:n}=this;if(!e)throw new G("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!((l=n.operations)!=null&&l.delete))throw new G("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!i||typeof i.deleteAttachments!="function")throw new G("invalid-layer","deleteAttachment(): A valid layer is required.");if(!s)throw new G("invalid-graphic","deleteAttachment(): A graphic is required.");const o=i.deleteAttachments(s,[e.id]).then(()=>e),a=await o;return r.remove(a),a.destroy(),a}async updateAttachment(e,i=this.activeAttachmentInfo){var u;const{_attachmentLayer:r,attachmentInfos:s,graphic:n,capabilities:o}=this;if(!e)throw new G("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!i)throw new G("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:i});if(!((u=o.operations)!=null&&u.update))throw new G("invalid-capabilities","updateAttachment(): Update capabilities are required.");const a=s.indexOf(i);if(!r||typeof r.updateAttachment!="function")throw new G("invalid-layer","updateAttachment(): A valid layer is required.");if(!n)throw new G("invalid-graphic","updateAttachment(): A graphic is required.");const l=r.updateAttachment(n,i.id,e).then(d=>this._queryAttachment(d.objectId)),c=await l;return s.splice(a,1,c),c}async commitFiles(){return await Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,i){if(!e||!i)return null;const r={file:e,form:i};return this.fileInfos.add(r),r}updateFile(e,i,r=this.activeFileInfo){if(!e||!i||!r)return null;const s=this.fileInfos.indexOf(r);return s>-1&&this.fileInfos.splice(s,1,{file:e,form:i}),this.fileInfos.items[s]}deleteFile(e){const i=this.fileInfos.find(r=>r.file===e);return i?(this.fileInfos.remove(i),i):null}async _queryAttachment(e,i){const{_attachmentLayer:r}=this;if(!e||!(r!=null&&r.queryAttachments))throw new G("invalid-attachment-id","Could not query attachment.");const s=this._getObjectId(i),n=new yee({objectIds:[s],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return r.queryAttachments(n).then(o=>o[s][0])}_getObjectId(e=this.graphic){return(e==null?void 0:e.getObjectId())??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,i=hze(e);this._attachmentLayer=i?i.type==="scene"&&i.associatedLayer!=null?i.associatedLayer:i:null}};h([p()],iu.prototype,"capabilities",void 0),h([Kt("capabilities")],iu.prototype,"castCapabilities",null),h([p()],iu.prototype,"activeAttachmentInfo",void 0),h([p()],iu.prototype,"activeFileInfo",void 0),h([p({readOnly:!0,type:bze})],iu.prototype,"attachmentInfos",void 0),h([p()],iu.prototype,"fileInfos",void 0),h([p({type:ca})],iu.prototype,"graphic",void 0),h([p()],iu.prototype,"mode",void 0),h([p({readOnly:!0})],iu.prototype,"state",null),h([p()],iu.prototype,"filesEnabled",void 0),h([p({readOnly:!0})],iu.prototype,"supportsResizeAttachments",null),iu=h([I("esri.widgets.Attachments.AttachmentsViewModel")],iu);const ile=iu;function abe(t){const e=t.toLowerCase();return e==="image/bmp"||e==="image/emf"||e==="image/exif"||e==="image/gif"||e==="image/x-icon"||e==="image/jpeg"||e==="image/png"||e==="image/tiff"||e==="image/x-wmf"}function OVt(t){const e=mr("esri/themes/base/images/files/");return t?t==="text/plain"?`${e}text-32.svg`:t==="application/pdf"?`${e}pdf-32.svg`:t==="text/csv"?`${e}csv-32.svg`:t==="application/gpx+xml"?`${e}gpx-32.svg`:t==="application/x-dwf"?`${e}cad-32.svg`:t==="application/postscript"||t==="application/json"||t==="text/xml"||t==="model/vrml"?`${e}code-32.svg`:t==="application/x-zip-compressed"||t==="application/x-7z-compressed"||t==="application/x-gzip"||t==="application/x-tar"||t==="application/x-gtar"||t==="application/x-bzip2"||t==="application/gzip"||t==="application/x-compress"||t==="application/x-apple-diskimage"||t==="application/x-rar-compressed"||t==="application/zip"?`${e}zip-32.svg`:t.includes("image/")?`${e}image-32.svg`:t.includes("audio/")?`${e}sound-32.svg`:t.includes("video/")?`${e}video-32.svg`:t.includes("msexcel")||t.includes("ms-excel")||t.includes("spreadsheetml")?`${e}excel-32.svg`:t.includes("msword")||t.includes("ms-word")||t.includes("wordprocessingml")?`${e}word-32.svg`:t.includes("powerpoint")||t.includes("presentationml")?`${e}report-32.svg`:`${e}generic-32.svg`:`${e}generic-32.svg`}const k0={checkMark:"esri-icon-check-mark",close:"esri-icon-close",collapse:"esri-icon-collapse",down:"esri-icon-down",downArrow:"esri-icon-down-arrow",dragHorizontal:"esri-icon-drag-horizontal",dragVertical:"esri-icon-drag-vertical",duplicate:"esri-icon-duplicate",expand:"esri-icon-expand",fontFallbackText:"esri-icon-font-fallback-text",forward:"esri-icon-forward",handleVertical:"esri-icon-handle-vertical",icon:"esri-icon",left:"esri-icon-left",loadingIndicator:"esri-icon-loading-indicator",locateCircled:"esri-icon-locate-circled",minus:"esri-icon-minus",noticeTriangle:"esri-icon-notice-triangle",pause:"esri-icon-pause",play:"esri-icon-play",plus:"esri-icon-plus",radioChecked:"esri-icon-radio-checked",radioUnchecked:"esri-icon-radio-unchecked",refresh:"esri-icon-refresh",reverse:"esri-icon-reverse",right:"esri-icon-right",search:"esri-icon-search",swap:"esri-icon-swap",table:"esri-icon-table",trash:"esri-icon-trash",up:"esri-icon-up",upArrow:"esri-icon-up-arrow",upDownArrows:"esri-icon-up-down-arrows",urbanModel:"esri-icon-urban-model",zoomInMagnifyingGlass:"esri-icon-zoom-in-magnifying-glass",zoomToObject:"esri-icon-zoom-to-object"},lbe={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},Mr="esri-attachments",fi={base:Mr,loaderContainer:`${Mr}__loader-container`,loader:`${Mr}__loader`,fadeIn:`${Mr}--fade-in`,container:`${Mr}__container`,containerList:`${Mr}__container--list`,containerPreview:`${Mr}__container--preview`,actions:`${Mr}__actions`,deleteButton:`${Mr}__delete-button`,addAttachmentButton:`${Mr}__add-attachment-button`,errorMessage:`${Mr}__error-message`,items:`${Mr}__items`,item:`${Mr}__item`,itemButton:`${Mr}__item-button`,itemMask:`${Mr}__item-mask`,itemMaskIcon:`${Mr}__item-mask--icon`,itemImage:`${Mr}__image`,itemImageResizable:`${Mr}__image--resizable`,itemLabel:`${Mr}__label`,itemFilename:`${Mr}__filename`,itemChevronIcon:`${Mr}__item-chevron-icon`,itemLink:`${Mr}__item-link`,itemLinkOverlay:`${Mr}__item-link-overlay`,itemLinkOverlayIcon:`${Mr}__item-link-overlay-icon`,itemEditIcon:`${Mr}__item-edit-icon`,itemAddIcon:`${Mr}__item-add-icon`,itemAddButton:`${Mr}__item-add-button`,formNode:`${Mr}__form-node`,fileFieldset:`${Mr}__file-fieldset`,fileLabel:`${Mr}__file-label`,fileName:`${Mr}__file-name`,fileInput:`${Mr}__file-input`,metadata:`${Mr}__metadata`,metadataFieldset:`${Mr}__metadata-fieldset`,progressBar:`${Mr}__progress-bar`},D7=window.CSS;let qa=class extends Ua{constructor(e,i){super(e,i),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...lbe},this._supportsImageOrientation=D7&&D7.supports&&D7.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(e){return e!=null&&e.viewModel||(e={viewModel:new ile,...e}),e}initialize(){this.addHandles([Ks(()=>{var e;return(e=this.viewModel)==null?void 0:e.attachmentInfos},"change",()=>this.scheduleRender()),Ks(()=>{var e;return(e=this.viewModel)==null?void 0:e.fileInfos},"change",()=>this.scheduleRender()),te(()=>{var e;return(e=this.viewModel)==null?void 0:e.mode},()=>this._modeChanged(),$t)])}loadDependencies(){return sm({icon:()=>ce(()=>import("./calcite-icon-BwrxrAiO.js"),__vite__mapDeps([209,207,198,199,206]))})}get capabilities(){return this.viewModel.capabilities}set capabilities(e){this.viewModel.capabilities=e}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get icon(){return"attachment"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return{...lbe,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:i}=this;return this._set("submitting",!0),this._set("error",null),i.addAttachment(e).then(r=>(this._set("submitting",!1),this._set("error",null),i.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new G("attachments:add-attachment",this.messages.addErrorMessage,r)),r})}deleteAttachment(e){const{viewModel:i}=this;return this._set("submitting",!0),this._set("error",null),i.deleteAttachment(e).then(r=>(this._set("submitting",!1),this._set("error",null),i.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new G("attachments:delete-attachment",this.messages.deleteErrorMessage,r)),r})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:i}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(i).then(r=>(this._set("submitting",!1),this._set("error",null),e.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new G("attachments:update-attachment",this.messages.updateErrorMessage,r)),r})}addFile(){const e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){const{viewModel:e}=this,i=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",i}deleteFile(e){var r;const i=this.viewModel.deleteFile(e||((r=this.viewModel.activeFileInfo)==null?void 0:r.file));return this.viewModel.mode="view",i}render(){const{submitting:e,viewModel:i}=this,{state:r}=i;return ge("div",{class:this.classes(fi.base,ni.widget)},e?this._renderProgressBar():null,r==="loading"?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){const{error:e,visibleElements:i}=this;return e&&i.errorMessage?ge("div",{class:fi.errorMessage,key:"error-message"},e.message):null}_renderAttachments(){const{activeFileInfo:e,mode:i,activeAttachmentInfo:r}=this.viewModel;return i==="add"?this._renderAddForm():i==="edit"?this._renderDetailsForm(r||e):this._renderAttachmentContainer()}_renderLoading(){return ge("div",{class:fi.loaderContainer,key:"loader"},ge("div",{class:fi.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?ge("div",{class:fi.progressBar,key:"progress-bar"}):null}_renderAddForm(){const{submitting:e,selectedFile:i}=this,r=e||!i,s=this.visibleElements.cancelAddButton?ge("button",{bind:this,class:this.classes(ni.button,ni.buttonTertiary,ni.buttonSmall,ni.buttonHalf,e&&ni.buttonDisabled),disabled:e,onclick:this._cancelForm,type:"button"},this.messages.cancel):null,n=this.visibleElements.addSubmitButton?ge("button",{class:this.classes(ni.button,ni.buttonSecondary,ni.buttonSmall,ni.buttonHalf,{[ni.buttonDisabled]:r}),disabled:r,type:"submit"},this.messages.add):null,o=i?ge("span",{class:fi.fileName,key:"file-name"},i.name):null,a=ge("form",{afterCreate:ade,afterRemoved:ode,bind:this,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},ge("fieldset",{class:fi.fileFieldset},o,ge("label",{class:this.classes(fi.fileLabel,ni.button,ni.buttonSecondary)},i?this.messages.changeFile:this.messages.selectFile,ge("input",{bind:this,class:fi.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),n,s);return ge("div",{class:fi.formNode,key:"add-form-container"},a)}_renderDetailsForm(e){var S,C,M;const{visibleElements:i,viewModel:r,selectedFile:s,submitting:n}=this,{capabilities:o}=r,a=n||!s;let l,c,u,d;s?(l=s.type,c=s.name,u=s.size):e&&"file"in e?(l=e.file.type,c=e.file.name,u=e.file.size):e&&"contentType"in e&&(l=e.contentType,c=e.name,u=e.size,d=e.url);const f=o.editing&&((S=o.operations)!=null&&S.delete)&&i.deleteButton?ge("button",{bind:this,class:this.classes(ni.button,ni.buttonSmall,ni.buttonTertiary,fi.deleteButton,{[ni.buttonDisabled]:n}),disabled:n,key:"delete-button",onclick:O=>this._submitDeleteAttachment(O,e),type:"button"},this.messages.delete):void 0,m=o.editing&&((C=o.operations)!=null&&C.update)&&i.updateButton?ge("button",{class:this.classes(ni.button,ni.buttonSmall,ni.buttonThird,{[ni.buttonDisabled]:a}),disabled:a,key:"update-button",type:"submit"},this.messages.update):void 0,g=this.visibleElements.cancelUpdateButton?ge("button",{bind:this,class:this.classes(ni.button,ni.buttonSmall,ni.buttonTertiary,ni.buttonThird,{[ni.buttonDisabled]:n}),disabled:n,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0,y=o.editing&&((M=o.operations)!=null&&M.update)?ge("fieldset",{class:fi.fileFieldset,key:"file"},ge("span",{class:fi.fileName,key:"file-name"},c),ge("label",{class:this.classes(fi.fileLabel,ni.button,ni.buttonSecondary)},this.messages.changeFile,ge("input",{bind:this,class:fi.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0,v=ge("fieldset",{class:fi.metadataFieldset,key:"size"},ge("label",null,qUt(this.messagesUnits,u??0))),b=ge("fieldset",{class:fi.metadataFieldset,key:"content-type"},ge("label",null,l)),w=d!=null?ge("a",{class:fi.itemLink,href:d,rel:"noreferrer",target:"_blank"},this._renderImageMask(e,400),ge("div",{class:fi.itemLinkOverlay},ge("span",{class:fi.itemLinkOverlayIcon},ge("calcite-icon",{icon:"launch"})))):this._renderImageMask(e,400),x=ge("form",{afterCreate:ade,afterRemoved:ode,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:O=>this._submitUpdateAttachment(O,e)},ge("div",{class:fi.metadata},v,b),y,ge("div",{class:fi.actions},f,g,m));return ge("div",{class:fi.formNode,key:"edit-form-container"},w,x)}_renderImageMask(e,i){return e?"file"in e?this._renderGenericImageMask(e.file.name,e.file.type):this._renderImageMaskForAttachment(e,i):null}_renderGenericImageMask(e,i){const{supportsResizeAttachments:r}=this.viewModel,s=OVt(i),n={[fi.itemImageResizable]:r};return ge("div",{class:this.classes(fi.itemMaskIcon,fi.itemMask),key:s},ge("img",{alt:e,class:this.classes(n,fi.itemImage),src:s,title:e}))}_renderImageMaskForAttachment(e,i){const{supportsResizeAttachments:r}=this.viewModel;if(!e)return null;const{contentType:s,name:n,url:o}=e;if(!r||!abe(s))return this._renderGenericImageMask(n,s);const a=this._getCSSTransform(e),l=a?{transform:a,"image-orientation":"none"}:{},c=`${o}${o!=null&&o.includes("?")?"&":"?"}w=${i}`,u={[fi.itemImageResizable]:r};return ge("div",{class:this.classes(fi.itemMask),key:c},ge("img",{alt:n,class:this.classes(u,fi.itemImage),src:c,styles:l,title:n}))}_renderFile(e){const{file:i}=e;return ge("li",{class:fi.item,key:i},ge("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:fi.itemButton,key:"details-button",onclick:()=>this._startEditFile(e),title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(e),ge("label",{class:fi.itemLabel},ge("span",{class:fi.itemFilename},i.name||this.messages.noTitle),ge("span",{"aria-hidden":"true",class:this.classes(fi.itemChevronIcon,Cb(this.container)?k0.left:k0.right)}))))}_renderAttachmentInfo({attachmentInfo:e,displayType:i}){const{viewModel:r,effectiveDisplayType:s}=this,{capabilities:n,supportsResizeAttachments:o}=r,{contentType:a,name:l,url:c}=e,u=this._renderImageMask(e,i==="list"?48:400),d=n.editing?ge("span",{"aria-hidden":"true",class:this.classes(fi.itemChevronIcon,Cb(this.container)?k0.left:k0.right)}):null,f=[u,s==="preview"&&o&&abe(a)?null:ge("label",{class:fi.itemLabel},ge("span",{class:fi.itemFilename},l||this.messages.noTitle),d)],m=n.editing?ge("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:fi.itemButton,"data-attachment-info-id":e.id,key:"details-button",onclick:()=>this._startEditAttachment(e),title:this.messages.attachmentDetails,type:"button"},f):ge("a",{class:fi.itemButton,href:c??void 0,key:"details-link",rel:"noreferrer",target:"_blank"},f);return ge("li",{class:fi.item,key:e},m)}_renderAttachmentContainer(){var g;const{effectiveDisplayType:e,viewModel:i,visibleElements:r}=this,{attachmentInfos:s,capabilities:n,fileInfos:o}=i,a=!!(s!=null&&s.length),l=!!(o!=null&&o.length),c={[fi.containerList]:e!=="preview",[fi.containerPreview]:e==="preview"},u=n.editing&&((g=n.operations)!=null&&g.add)&&r.addButton?ge("button",{bind:this,class:this.classes(ni.button,ni.buttonTertiary,fi.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:"button"},ge("span",{"aria-hidden":"true",class:this.classes(fi.itemAddIcon,k0.plus)}),this.messages.add):void 0,d=a?ge("ul",{class:fi.items,key:"attachments-list"},s.toArray().map(y=>this._renderAttachmentInfo({attachmentInfo:y,displayType:e}))):void 0,f=l?ge("ul",{class:fi.items,key:"file-list"},o.toArray().map(y=>this._renderFile(y))):void 0,m=l||a?void 0:ge("div",{class:ni.empty},this.messages.noAttachments);return ge("div",{class:this.classes(fi.container,c),key:"attachments-container"},d,f,m,u)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){var s;const i=e.target,r=(s=i.files)==null?void 0:s.item(0);this._set("selectedFile",r)}_submitDeleteAttachment(e,i){e.preventDefault(),i&&("file"in i?this.deleteFile(i.file):i&&this.deleteAttachment(i))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,i){e.preventDefault(),i&&"file"in i?this.updateFile():this.updateAttachment()}_startEditAttachment(e){const{viewModel:i}=this;i.activeFileInfo=null,i.activeAttachmentInfo=e,i.mode="edit"}_startEditFile(e){const{viewModel:i}=this;i.activeAttachmentInfo=null,i.activeFileInfo=e,i.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){const{orientationInfo:i}=e;return!this._supportsImageOrientation&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};h([p()],qa.prototype,"capabilities",null),h([p()],qa.prototype,"displayType",void 0),h([p({readOnly:!0})],qa.prototype,"effectiveDisplayType",null),h([p()],qa.prototype,"graphic",null),h([p()],qa.prototype,"icon",null),h([p()],qa.prototype,"label",null),h([p(),Fa("esri/widgets/Attachments/t9n/Attachments")],qa.prototype,"messages",void 0),h([p(),Fa("esri/core/t9n/Units")],qa.prototype,"messagesUnits",void 0),h([p({readOnly:!0})],qa.prototype,"selectedFile",void 0),h([p({readOnly:!0})],qa.prototype,"submitting",void 0),h([p({readOnly:!0})],qa.prototype,"error",void 0),h([p({type:ile})],qa.prototype,"viewModel",void 0),h([p()],qa.prototype,"visibleElements",void 0),h([Kt("visibleElements")],qa.prototype,"castVisibleElements",null),qa=h([I("esri.widgets.Attachments")],qa);const RVt=qa;let EI=class extends ile{constructor(e){super(e),this.description=null,this.title=null}};h([p()],EI.prototype,"description",void 0),h([p()],EI.prototype,"title",void 0),EI=h([I("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],EI);const rle=EI;function sle({level:t,class:e,...i},r){const s=$Vt(t);return ge(`h${s}`,{...i,"aria-level":String(s),class:kAe(ni.heading,e),role:"heading"},r)}function $Vt(t){return Ne(Math.ceil(t),1,6)}const N7="esri-feature-element-info",F7={base:N7,title:`${N7}__title`,description:`${N7}__description`};let VC=class extends Ua{constructor(e,i){super(e,i),this.description=null,this.headingLevel=2,this.title=null}render(){return ge("div",{class:F7.base},this._renderTitle(),this._renderDescription())}_renderTitle(){const{title:e}=this;return e?ge(sle,{class:F7.title,innerHTML:e,level:this.headingLevel}):null}_renderDescription(){const{description:e}=this;return e?ge("div",{class:F7.description,innerHTML:e,key:"description"}):null}};h([p()],VC.prototype,"description",void 0),h([p()],VC.prototype,"headingLevel",void 0),h([p()],VC.prototype,"title",void 0),VC=h([I("esri.widgets.Feature.support.FeatureElementInfo")],VC);const sH=VC,IVt={base:"esri-feature-attachments"};let Km=class extends Ua{constructor(e,i){super(e,i),this._featureElementInfo=null,this.attachmentsWidget=new RVt,this.headingLevel=2,this.viewModel=new rle}initialize(){this._featureElementInfo=new sH,this.addHandles([te(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.description,(i=this.viewModel)==null?void 0:i.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),$t),te(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,$t)])}destroy(){var e;this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),(e=this._featureElementInfo)==null||e.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var i;const{attachmentsWidget:e}=this;return ge("div",{class:IVt.base},(i=this._featureElementInfo)==null?void 0:i.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){var s;const{description:e,title:i,headingLevel:r}=this;(s=this._featureElementInfo)==null||s.set({description:e,title:i,headingLevel:r})}};h([p({readOnly:!0})],Km.prototype,"attachmentsWidget",void 0),h([p()],Km.prototype,"description",null),h([p()],Km.prototype,"displayType",null),h([p()],Km.prototype,"graphic",null),h([p()],Km.prototype,"headingLevel",void 0),h([p()],Km.prototype,"title",null),h([p({type:rle})],Km.prototype,"viewModel",void 0),Km=h([I("esri.widgets.Feature.FeatureAttachments")],Km);const LVt=Km;let i1=class extends Ue{constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles(te(()=>this.creator,i=>{this._destroyContent(),this._createContent(i)},$t))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:i,destroyer:r}=this;e&&i&&(dj({type:"content",value:r,event:{graphic:i}}),this._set("created",null))}async _createContent(e){const i=this.graphic;if(!i||!e)return;const r=dj({type:"content",value:e,event:{graphic:i}});this._loadingPromise=r,this.notifyChange("state");const s=await r;r===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",s))}};h([p({readOnly:!0})],i1.prototype,"created",void 0),h([p()],i1.prototype,"creator",void 0),h([p()],i1.prototype,"destroyer",void 0),h([p({type:ca})],i1.prototype,"graphic",void 0),h([p({readOnly:!0})],i1.prototype,"state",null),i1=h([I("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],i1);const pj=i1;function wze(t){return t&&typeof t.render=="function"}function DVt(t){return t&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}const k7="esri-feature-content",U7={base:k7,loaderContainer:`${k7}__loader-container`,loader:`${k7}__loader`};let zC=class extends Ua{constructor(e,i){super(e,i),this.viewModel=null,this._addTargetToAnchors=r=>{Array.from(r.querySelectorAll("a")).forEach(s=>{dze(s.href)&&!s.hasAttribute("target")&&s.setAttribute("target","_blank")})}}get creator(){var e;return(e=this.viewModel)==null?void 0:e.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){var e;return(e=this.viewModel)==null?void 0:e.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}render(){var i;const e=(i=this.viewModel)==null?void 0:i.state;return ge("div",{class:U7.base},e==="loading"?this._renderLoading():this._renderCreated())}_renderLoading(){return ge("div",{class:U7.loaderContainer,key:"loader"},ge("div",{class:U7.loader}))}_renderCreated(){var i;const e=(i=this.viewModel)==null?void 0:i.created;return e?e instanceof HTMLElement?ge("div",{afterCreate:this._attachToNode,bind:e,key:e}):wze(e)?ge("div",{key:e},!e.destroyed&&e.render()):ge("div",{afterCreate:this._addTargetToAnchors,innerHTML:e,key:e}):null}_attachToNode(e){const i=this;e.appendChild(i)}};h([p()],zC.prototype,"creator",null),h([p()],zC.prototype,"graphic",null),h([p({type:pj})],zC.prototype,"viewModel",void 0),zC=h([I("esri.widgets.Feature.FeatureContent")],zC);const rV=zC;let p0=class extends Ue{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:i}=this,r=[];return i==null||i.forEach(s=>{if(!(!s.hasOwnProperty("visible")||s.visible))return;const n=s.clone();n.label=pze(n,e),r.push(n)}),r}};h([p()],p0.prototype,"attributes",void 0),h([p({type:[_Oe]})],p0.prototype,"expressionInfos",void 0),h([p()],p0.prototype,"description",void 0),h([p({type:[AD]})],p0.prototype,"fieldInfos",void 0),h([p({readOnly:!0})],p0.prototype,"formattedFieldInfos",null),h([p()],p0.prototype,"title",void 0),p0=h([I("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],p0);const nH=p0,NVt=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function FVt(t,e){if(typeof e!="string"||!e)return e;const i=NVt.find(l=>l.pattern.test(e));if(!i)return e;const r=e.match(i.pattern),s=r==null?void 0:r[2],n=Xg(Xg(i.label,{messages:t,hierPart:s}),{appName:i.appName}),o=i.target?` target="${i.target}"`:"",a=i.target==="_blank"?' rel="noreferrer"':"";return e.replace(i.pattern,`<a${o} href="$1"${a}>${n}</a>`)}const E5="esri-feature-fields",C5={base:E5,fieldHeader:`${E5}__field-header`,fieldData:`${E5}__field-data`,fieldDataDate:`${E5}__field-data--date`};let qp=class extends Ua{constructor(e,i){super(e,i),this._featureElementInfo=null,this.viewModel=new nH,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new sH,this.addHandles(te(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.description,(i=this.viewModel)==null?void 0:i.title]},()=>this._setupFeatureElementInfo(),$t))}destroy(){var e;(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var e;return ge("div",{class:C5.base},(e=this._featureElementInfo)==null?void 0:e.render(),this._renderFields())}_renderFieldInfo(e,i){var u;const{attributes:r}=this.viewModel,s=e.fieldName||"",n=e.label||s,o=r?r[s]==null?"":r[s]:"",a=!!((u=e.format)!=null&&u.dateFormat),l=typeof o=="number"&&!a?this._forceLTR(o):FVt(this.messagesURIUtils,o),c={[C5.fieldDataDate]:a};return ge("tr",{key:`fields-element-info-row-${s}-${i}`},ge("th",{class:C5.fieldHeader,innerHTML:n,key:`fields-element-info-row-header-${s}-${i}`}),ge("td",{class:this.classes(C5.fieldData,c),innerHTML:l,key:`fields-element-info-row-data-${s}-${i}`}))}_renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e!=null&&e.length?ge("table",{class:ni.table,summary:this.messages.fieldsSummary},ge("tbody",null,e.map((i,r)=>this._renderFieldInfo(i,r)))):null}_setupFeatureElementInfo(){var r;const{description:e,title:i}=this;(r=this._featureElementInfo)==null||r.set({description:e,title:i})}_forceLTR(e){return`&lrm;${e}`}};h([p()],qp.prototype,"attributes",null),h([p()],qp.prototype,"description",null),h([p()],qp.prototype,"expressionInfos",null),h([p()],qp.prototype,"fieldInfos",null),h([p()],qp.prototype,"title",null),h([p({type:nH,nonNullable:!0})],qp.prototype,"viewModel",void 0),h([p(),Fa("esri/widgets/Feature/t9n/Feature")],qp.prototype,"messages",void 0),h([p(),Fa("esri/widgets/support/t9n/uriUtils")],qp.prototype,"messagesURIUtils",void 0),qp=h([I("esri.widgets.Feature.FeatureFields")],qp);const xze=qp,kVt={maximumFractionDigits:20};function UVt(t){return Xl(t,kVt)}var wee;let tT=wee=class extends Se{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,i){e[i]=t??0}clone(){return new wee({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};h([p({type:Qe,json:{type:[Xi],write:!0}})],tT.prototype,"color",void 0),h([p({type:String,json:{write:!0}})],tT.prototype,"label",void 0),h([p({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],tT.prototype,"value",void 0),h([We("value")],tT.prototype,"writeValue",null),tT=wee=h([I("esri.renderers.visualVariables.support.ColorStop")],tT);const VVt=tT,zVt="<",BVt=">";function jVt(t,e,i,r){let s="";return e===0?s=`${zVt} `:e===i&&(s=`${BVt} `),s+UVt(t)}const GVt=new Qe([64,64,64]);function HVt(t,e){const i=[],r=t.length-1;return t.length===5?i.push(0,2,4):i.push(0,r),t.map((s,n)=>i.includes(n)?jVt(s,n,r):null)}async function qVt(t,e,i){let r=!1,s=[],n=[];if(t.stops){const c=t.stops;s=c.map(u=>u.value),r=c.some(u=>!!u.label),r&&(n=c.map(u=>u.label))}const o=s[0],a=s[s.length-1];if(o==null&&a==null)return null;const l=r?null:HVt(s);return(await Promise.all(s.map(async(c,u)=>({value:c,color:t.type==="opacity"?await WVt(c,t):(await ce(async()=>{const{getColor:d}=await Promise.resolve().then(()=>Eoe);return{getColor:d}},void 0)).getColor(t,c),label:r?n[u]:(l==null?void 0:l[u])??""})))).reverse()}async function WVt(t,e,i){const r=new Qe(GVt),s=(await ce(async()=>{const{getOpacity:n}=await Promise.resolve().then(()=>Eoe);return{getOpacity:n}},void 0)).getOpacity(e,t);return s!=null&&(r.a=s),r}var xee;let CI=xee=class extends Se{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new xee({color:this.color&&this.color.clone(),ratio:this.ratio})}};h([p({type:Qe,json:{type:[Xi],default:null,write:!0}})],CI.prototype,"color",void 0),h([p({type:Number,json:{write:!0}})],CI.prototype,"ratio",void 0),CI=xee=h([I("esri.renderers.support.HeatmapColorStop")],CI);const L3=CI;function ZVt(t){if(!t.colorStops)return[];const e=[...t.colorStops].filter(r=>{var s;return((s=r.color)==null?void 0:s.a)>0});let i=e.length-1;if(e&&e[0]){const r=e[i];r&&r.ratio!==1&&(e.push(new L3({ratio:1,color:r.color})),i++)}return e.map((r,s)=>{var o,a;let n="";return s===0?n=((o=t.legendOptions)==null?void 0:o.minLabel)||"low":s===i&&(n=((a=t.legendOptions)==null?void 0:a.maxLabel)||"high"),{color:r.color,label:n,ratio:r.ratio}}).reverse()}C1("short-date");async function Zu(t,e,i){cD(t,e,()=>[]).push(...i)}async function YVt(t){var i,r;const e=new Map;if(!t)return e;if("visualVariables"in t&&t.visualVariables){const s=t.visualVariables.filter(n=>n.type==="color");for(const n of s){const o=(await qVt(n)??[]).map(a=>a.color);await Zu(e,n.field||n.valueExpression,o)}}if(t.type==="heatmap"){const s=ZVt(t).map(n=>n.color);await Zu(e,t.field||t.valueExpression,s)}else if(t.type==="pie-chart"){for(const s of t.attributes)await Zu(e,s.field||s.valueExpression,[s.color]);await Zu(e,"default",[(i=t==null?void 0:t.othersCategory)==null?void 0:i.color,vE(t.backgroundFillSymbol,null)])}else if(t.type==="dot-density"){for(const s of t.attributes)await Zu(e,s.field||s.valueExpression,[s.color]);await Zu(e,"default",[t.backgroundColor])}else if(t.type==="unique-value")if(((r=t.authoringInfo)==null?void 0:r.type)==="predominance")for(const s of t.uniqueValueInfos??[])await Zu(e,s.value.toString(),[vE(s.symbol,null)]);else{const s=(t.uniqueValueInfos??[]).map(c=>vE(c.symbol,null)),{field:n,field2:o,field3:a,valueExpression:l}=t;(n||l)&&await Zu(e,n||l,s),o&&await Zu(e,o,s),a&&await Zu(e,a,s)}else if(t.type==="class-breaks"){const s=t.classBreakInfos.map(a=>vE(a.symbol,null)),{field:n,valueExpression:o}=t;await Zu(e,n??o,s)}else t.type==="simple"&&await Zu(e,"default",[vE(t.symbol,null)]);return"defaultSymbol"in t&&t.defaultSymbol&&await Zu(e,"default",[vE(t.defaultSymbol,null)]),e.forEach((s,n)=>{const o=h2(s.filter(Boolean),(a,l)=>JSON.stringify(a)===JSON.stringify(l));e.set(n,o)}),e}const M5={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new Ef({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ze.WebMercator}),minus180Line:new Ef({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ze.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new Ef({paths:[[[180,-180],[180,180]]],spatialReference:Ze.WGS84}),minus180Line:new Ef({paths:[[[-180,-180],[-180,180]]],spatialReference:Ze.WGS84})}};function HT(t,e){return Math.ceil((t-e)/(2*e))}function Tze(t,e){const i=D3(t);for(const r of i)for(const s of r)s[0]+=e;return t}function D3(t){return ol(t)?t.rings:t.paths}async function XVt(t,e,i,r){const s=hae(t),n=e[0].spatialReference,o={...r,responseType:"json",query:{...s.query,f:"json",sr:PA(n),target:JSON.stringify({geometryType:GP(e[0]),geometries:e}),cutter:JSON.stringify(i)}},a=await yr(s.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(u=>{const d=ty(u);return d.spatialReference=n,d})}}async function JVt(t,e,i){const r=typeof t=="string"?un(t):t,s=e[0].spatialReference,n=GP(e[0]),o={...i,query:{...r.query,f:"json",sr:PA(s),geometries:JSON.stringify(r$t(e))}},{data:a}=await yr(r.path+"/simplify",o);return Q5e(a.geometries,n,s)}const Sze=()=>se.getLogger("esri.geometry.support.normalizeUtils");function QVt(t){return t.type==="polygon"}function KVt(t){return t[0].type==="polygon"}function ezt(t){return t[0].type==="polyline"}function tzt(t,e){if(!(t instanceof Ef||t instanceof Wf)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw Sze().error(s),new G(s)}const i=D3(t),r=[];for(const s of i){const n=[];r.push(n),n.push([s[0][0],s[0][1]]);for(let o=0;o<s.length-1;o++){const a=s[o][0],l=s[o][1],c=s[o+1][0],u=s[o+1][1],d=Math.sqrt((c-a)*(c-a)+(u-l)*(u-l)),f=(u-l)/d,m=(c-a)/d,g=d/e;if(g>1){for(let w=1;w<=g-1;w++){const x=w*e,S=m*x+a,C=f*x+l;n.push([S,C])}const y=(d+Math.floor(g-1)*e)/2,v=m*y+a,b=f*y+l;n.push([v,b])}n.push([c,u])}}return QVt(t)?new Wf({rings:r,spatialReference:t.spatialReference}):new Ef({paths:r,spatialReference:t.spatialReference})}function cbe(t,e,i){if(e){const r=tzt(t,1e6);t=rM(r,!0)}return i&&(t=Tze(t,i)),t}function ube(t,e,i){if(Array.isArray(t)){const r=t[0];if(r>e){const s=HT(r,e);t[0]=r+s*(-2*e)}else if(r<i){const s=HT(r,i);t[0]=r+s*(-2*i)}}else{const r=t.x;if(r>e){const s=HT(r,e);t=t.clone().offset(s*(-2*e),0)}else if(r<i){const s=HT(r,i);t=t.clone().offset(s*(-2*i),0)}}return t}function izt(t,e){let i=-1;for(let r=0;r<e.cutIndexes.length;r++){const s=e.cutIndexes[r],n=e.geometries[r],o=D3(n);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let u=0;for(let f=0;f<l.length;f++){const m=l[f][0];u=m>u?m:u}u=Number(u.toFixed(9));const d=-360*HT(u,180);for(let f=0;f<l.length;f++){const m=n.getPoint(a,f);n.setPoint(a,f,m.clone().offset(d,0))}return!0}})}if(s===i){if(KVt(t))for(const a of D3(n))t[s]=t[s].addRing(a);else if(ezt(t))for(const a of D3(n))t[s]=t[s].addPath(a)}else i=s,t[s]=n}return t}async function Eze(t,e,i){if(!Array.isArray(t))return Eze([t],e);e&&typeof e!="string"&&Sze().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r=typeof e=="string"?e:(e==null?void 0:e.url)??rr.geometryServiceUrl;let s,n,o,a,l,c,u,d,f=0;const m=[],g=[];for(const S of t)if(S!=null)if(s||(s=S.spatialReference,n=Fg(s),o=s.isWebMercator,c=o?102100:4326,a=M5[c].maxX,l=M5[c].minX,u=M5[c].plus180Line,d=M5[c].minus180Line),n)if(S.type==="mesh")g.push(S);else if(S.type==="point")g.push(ube(S.clone(),a,l));else if(S.type==="multipoint"){const C=S.clone();C.points=C.points.map(M=>ube(M,a,l)),g.push(C)}else if(S.type==="extent"){const C=S.clone()._normalize(!1,!1,n);g.push(C.rings?new Wf(C):C)}else if(S.extent){const C=S.extent,M=HT(C.xmin,l)*(2*a);let O=M===0?S.clone():Tze(S.clone(),M);C.offset(M,0);let{xmin:D,xmax:U}=C;D=Number(D.toFixed(9)),U=Number(U.toFixed(9)),C.intersects(u)&&U!==a?(f=U>f?U:f,O=cbe(O,o),m.push(O),g.push("cut")):C.intersects(d)&&D!==l?(f=U*(2*a)>f?U*(2*a):f,O=cbe(O,o,360),m.push(O),g.push("cut")):g.push(O)}else g.push(S.clone());else g.push(S);else g.push(S);let y=HT(f,a),v=-90;const b=y,w=new Ef;for(;y>0;){const S=360*y-180;w.addPath([[S,v],[S,-1*v]]),v*=-1,y--}if(m.length>0&&b>0){const S=izt(m,await XVt(r,m,w,i)),C=[],M=[];for(let U=0;U<g.length;U++){const k=g[U];if(k!=="cut")M.push(k);else{const H=S.shift(),V=t[U];V!=null&&V.type==="polygon"&&V.rings&&V.rings.length>1&&H.rings.length>=V.rings.length?(C.push(H),M.push("simplify")):M.push(o?kg(H):H)}}if(!C.length)return M;const O=await JVt(r,C,i),D=[];for(let U=0;U<M.length;U++){const k=M[U];k!=="simplify"?D.push(k):D.push(o?kg(O.shift()):O.shift())}return D}const x=[];for(let S=0;S<g.length;S++){const C=g[S];if(C!=="cut")x.push(C);else{const M=m.shift();x.push(o===!0?kg(M):M)}}return x}function Cze(t){const e={};for(const i in t){if(i==="declaredClass")continue;const r=t[i];if(r!=null&&typeof r!="function")if(Array.isArray(r)){e[i]=[];for(let s=0;s<r.length;s++)e[i][s]=Cze(r[s])}else typeof r=="object"?r.toJSON&&(e[i]=JSON.stringify(r)):e[i]=r}return e}var w1;(function(t){t[t.varint=0]="varint",t[t.fixed64=1]="fixed64",t[t.delimited=2]="delimited",t[t.fixed32=5]="fixed32",t[t.unknown=99]="unknown"})(w1||(w1={}));const hbe=4294967296,rzt=new TextDecoder("utf-8"),szt=le("safari")||le("ios")?6:le("ff")?12:32;let Tee=class sV{constructor(e,i,r=0,s=e?e.byteLength:0){this._tag=0,this._dataType=w1.unknown,this._init(e,i,r,s)}_init(e,i,r,s){this._data=e,this._dataView=i,this._pos=r,this._end=s}asUnsafe(){return this}clone(){return new sV(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const i=this._decodeVarint();if(this._tag=i>>3,this._dataType=7&i,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;if(e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128||(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128)||(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128)||(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128)||(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128))return e;throw new Error("Varint overflow")}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();return e>>>1^-(1&e)}getSInt64(){return this._decodeSVarint()}getBool(){const e=this._data[this._pos]!==0;return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,i=this._pos,r=e.getUint32(i,!0)+e.getUint32(i+4,!0)*hbe;return this._skip(8),r}getSFixed64(){const e=this._dataView,i=this._pos,r=e.getUint32(i,!0)+e.getInt32(i+4,!0)*hbe;return this._skip(8),r}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),i=this._pos,r=this._toString(this._data,i,i+e);return this._skip(e),r}getBytes(){const e=this._getLength(),i=this._pos,r=this._toBytes(this._data,i,i+e);return this._skip(e),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,i,r,s){const n=this.getMessage(),o=e(n,i,r,s);return n.release(),o}processMessage(e){const i=this.getMessage(),r=e(i);return i.release(),r}getMessage(){const e=this._getLength(),i=sV.pool.acquire();return i._init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),i}release(){sV.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case w1.varint:this._decodeVarint();break;case w1.fixed64:this._skip(8);break;case w1.delimited:this._skip(this._getLength());break;case w1.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let i=this._pos,r=0,s=0;if(this._end-i>=10)do{if(s=e[i++],r|=127&s,!(128&s)||(s=e[i++],r|=(127&s)<<7,!(128&s))||(s=e[i++],r|=(127&s)<<14,!(128&s))||(s=e[i++],r|=(127&s)<<21,!(128&s))||(s=e[i++],r+=268435456*(127&s),!(128&s))||(s=e[i++],r+=34359738368*(127&s),!(128&s))||(s=e[i++],r+=4398046511104*(127&s),!(128&s))||(s=e[i++],r+=562949953421312*(127&s),!(128&s))||(s=e[i++],r+=72057594037927940*(127&s),!(128&s))||(s=e[i++],r+=9223372036854776e3*(127&s),!(128&s)))break;throw new Error("Varint too long!")}while(!1);else{let n=1;for(;i!==this._end&&(s=e[i],128&s);)++i,r+=(127&s)*n,n*=128;if(i===this._end)throw new Error("Varint overrun!");++i,r+=s*n}return this._pos=i,r}_decodeSVarint(){const e=this._data;let i,r=0,s=0;const n=1&e[this._pos];if(s=e[this._pos++],r|=127&s,!(128&s)||(s=e[this._pos++],r|=(127&s)<<7,!(128&s))||(s=e[this._pos++],r|=(127&s)<<14,!(128&s))||(s=e[this._pos++],r|=(127&s)<<21,!(128&s))||(s=e[this._pos++],r+=268435456*(127&s),!(128&s))||(s=e[this._pos++],r+=34359738368*(127&s),!(128&s))||(s=e[this._pos++],r+=4398046511104*(127&s),!(128&s)))return n?-(r+1)/2:r/2;if(i=BigInt(r),s=e[this._pos++],i+=0x2000000000000n*BigInt(127&s),!(128&s)||(s=e[this._pos++],i+=0x100000000000000n*BigInt(127&s),!(128&s))||(s=e[this._pos++],i+=0x8000000000000000n*BigInt(127&s),!(128&s)))return Number(n?-(i+1n)/2n:i/2n);throw new Error("Varint too long!")}_getLength(){if(this._dataType!==w1.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,i,r){if((r=Math.min(this._end,r))-i>szt){const o=e.subarray(i,r);return rzt.decode(o)}let s="",n="";for(let o=i;o<r;++o){const a=e[o];128&a?n+="%"+a.toString(16):(s+=decodeURIComponent(n)+String.fromCharCode(a),n="")}return n.length&&(s+=decodeURIComponent(n)),s}_toBytes(e,i,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,i,r-i)}};Tee.pool=new la(Tee,void 0,t=>{t._data=null,t._dataView=null});const Mze=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];let hhi=class{constructor(e){this._options=e,this.geometryTypes=Mze,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new LDe}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!(e!=null&&e.features)||!e.hasZ||!this._options.sourceSpatialReference||!e.spatialReference||hs(e.spatialReference,this._options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const i=a_(this._options.sourceSpatialReference)/a_(e.spatialReference);if(i!==1)for(const r of e.features){if(!gvt(r))continue;const s=r.geometry.coords;for(let n=2;n<s.length;n+=3)s[n]*=i}}addFeature(e,i){e.features.push(i)}createFeature(){return new i2}createSpatialReference(){return{wkid:0}}createGeometry(){return new gl}addField(e,i){e.fields.push(i)}allocateCoordinates(e){e.coords.length=e.lengths.reduce((i,r)=>i+r,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,i){e.coords[this._coordinatePtr++]=i}addCoordinatePoint(e,i){e.coords.push(i)}addLength(e,i){e.lengths.push(i)}addQueryGeometry(e,i){e.queryGeometry=i.queryGeometry,e.queryGeometryType=i.queryGeometryType}createPointGeometry(){return new gl}};const dbe=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML","esriFieldTypeBigInteger","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"],pbe=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],fbe=["upperLeft","lowerLeft"];function mbe(t){return t>=dbe.length?null:dbe[t]}function nzt(t){return t>=pbe.length?null:pbe[t]}function gbe(t){return t>=fbe.length?null:fbe[t]}function ybe(t,e){return e>=t.geometryTypes.length?null:t.geometryTypes[e]}function ozt(t,e,i){const s=t.asUnsafe(),n=e.createPointGeometry(i);for(;s.next();)switch(s.tag()){case 3:{const o=s.getUInt32(),a=s.pos()+o;let l=0;for(;s.pos()<a;)e.addCoordinatePoint(n,s.getSInt64(),l++);break}default:s.skip()}return n}function azt(t,e,i){const n=t.asUnsafe(),o=e.createGeometry(i),a=2+(i.hasZ?1:0)+(i.hasM?1:0);for(;n.next();)switch(n.tag()){case 2:{const l=n.getUInt32(),c=n.pos()+l;let u=0;for(;n.pos()<c;)e.addLength(o,n.getUInt32(),u++);break}case 3:{const l=n.getUInt32(),c=n.pos()+l;let u=0;for(e.allocateCoordinates(o);n.pos()<c;)e.addCoordinate(o,n.getSInt64(),u),u++,u===a&&(u=0);break}default:n.skip()}return o}function lzt(t){const s=t.asUnsafe(),n=new gl;let o="esriGeometryPoint";for(;s.next();)switch(s.tag()){case 2:{const a=s.getUInt32(),l=s.pos()+a;for(;s.pos()<l;)n.lengths.push(s.getUInt32());break}case 3:{const a=s.getUInt32(),l=s.pos()+a;for(;s.pos()<l;)n.coords.push(s.getSInt64());break}case 1:o=Mze[s.getEnum()];break;default:s.skip()}return{queryGeometry:n,queryGeometryType:o}}function czt(t){const u=t.asUnsafe();for(;u.next();)switch(u.tag()){case 1:return u.getString();case 2:return u.getFloat();case 3:return u.getDouble();case 4:return u.getSInt32();case 5:return u.getUInt32();case 6:return u.getInt64();case 7:return u.getUInt64();case 8:return u.getSInt64();case 9:return u.getBool();default:return u.skip(),null}return null}function uzt(t){const a=t.asUnsafe(),l={type:mbe(0)};for(;a.next();)switch(a.tag()){case 1:l.name=a.getString();break;case 2:l.type=mbe(a.getEnum());break;case 3:l.alias=a.getString();break;case 4:l.sqlType=nzt(a.getEnum());break;case 5:a.skip();break;case 6:l.defaultValue=a.getString();break;default:a.skip()}return l}function hzt(t){const r={},s=t.asUnsafe();for(;s.next();)switch(s.tag()){case 1:r.name=s.getString();break;case 2:r.isSystemMaintained=s.getBool();break;default:s.skip()}return r}function dzt(t,e,i,r){const a=e.createFeature(i);let l=0;for(;t.next();)switch(t.tag()){case 1:{const c=r[l++].name;a.attributes[c]=t.processMessage(czt);break}case 2:a.geometry=t.processMessageWithArgs(azt,e,i);break;case 4:a.centroid=t.processMessageWithArgs(ozt,e,i);break;default:t.skip()}return a}function pzt(t){const n=[1,1,1,1],o=t.asUnsafe();for(;o.next();)switch(o.tag()){case 1:n[0]=o.getDouble();break;case 2:n[1]=o.getDouble();break;case 4:n[2]=o.getDouble();break;case 3:n[3]=o.getDouble();break;default:o.skip()}return n}function fzt(t){const n=[0,0,0,0],o=t.asUnsafe();for(;o.next();)switch(o.tag()){case 1:n[0]=o.getDouble();break;case 2:n[1]=o.getDouble();break;case 4:n[2]=o.getDouble();break;case 3:n[3]=o.getDouble();break;default:o.skip()}return n}function mzt(t){const s={originPosition:gbe(0)},n=t.asUnsafe();for(;n.next();)switch(n.tag()){case 1:s.originPosition=gbe(n.getEnum());break;case 2:s.scale=n.processMessage(pzt);break;case 3:s.translate=n.processMessage(fzt);break;default:n.skip()}return s}function gzt(t){const s={},n=t.asUnsafe();for(;n.next();)switch(n.tag()){case 1:s.shapeAreaFieldName=n.getString();break;case 2:s.shapeLengthFieldName=n.getString();break;case 3:s.units=n.getString();break;default:n.skip()}return s}function yzt(t,e){const a=e.createSpatialReference();for(;t.next();)switch(t.tag()){case 1:a.wkid=t.getUInt32();break;case 5:a.wkt=t.getString();break;case 2:a.latestWkid=t.getUInt32();break;case 3:a.vcsWkid=t.getUInt32();break;case 4:a.latestVcsWkid=t.getUInt32();break;default:t.skip()}return a}function _zt(t,e){const y=e.createFeatureResult(),v=t.asUnsafe();y.geometryType=ybe(e,0);let b=!1;for(;v.next();)switch(v.tag()){case 1:y.objectIdFieldName=v.getString();break;case 3:y.globalIdFieldName=v.getString();break;case 4:y.geohashFieldName=v.getString();break;case 5:y.geometryProperties=v.processMessage(gzt);break;case 7:y.geometryType=ybe(e,v.getEnum());break;case 8:y.spatialReference=v.processMessageWithArgs(yzt,e);break;case 10:y.hasZ=v.getBool();break;case 11:y.hasM=v.getBool();break;case 12:y.transform=v.processMessage(mzt);break;case 9:y.exceededTransferLimit=v.getBool();break;case 13:e.addField(y,v.processMessage(uzt));break;case 15:b||(e.prepareFeatures(y),b=!0),e.addFeature(y,v.processMessageWithArgs(dzt,e,y,y.fields));break;case 2:y.uniqueIdField=v.processMessage(hzt);break;default:v.skip()}return e.finishFeatureResult(y),y}function vzt(t,e){const s={};let n=null;for(;t.next();)switch(t.tag()){case 4:n=t.processMessageWithArgs(lzt);break;case 1:s.featureResult=t.processMessageWithArgs(_zt,e);break;default:t.skip()}return n!=null&&s.featureResult&&e.addQueryGeometry(s,n),s}function bzt(t,e){try{const r=new Tee(new Uint8Array(t),new DataView(t)),s={};for(;r.next();)r.tag()===2?s.queryResult=r.processMessageWithArgs(vzt,e):r.skip();return s}catch(i){throw new G("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:i})}}function wzt(t,e){const i=bzt(t,e),r=i.queryResult.featureResult,s=i.queryResult.queryGeometry,n=i.queryResult.queryGeometryType;if(r&&r.features&&r.features.length&&r.objectIdFieldName){const o=r.objectIdFieldName;for(const a of r.features)a.attributes&&(a.objectId=a.attributes[o])}return r&&(r.queryGeometry=s,r.queryGeometryType=n),r}function See(t,e,i){if(!(i!=null&&i.features)||!i.hasZ)return;const r=NCe(i.geometryType,e,t.outSpatialReference);if(r!=null)for(const s of i.features)r(s.geometry)}const _be="Layer does not support extent calculation.";function xzt(t,e){if(e&&t.type==="extent")return`${t.xmin},${t.ymin},${t.xmax},${t.ymax}`;if(e&&t.type==="point")return`${t.x},${t.y}`;const i=t.toJSON();return delete i.spatialReference,JSON.stringify(i)}function Tzt(t,e){var l;const i=t.geometry,r=t.toJSON();delete r.compactGeometryEnabled,delete r.defaultSpatialReferenceEnabled;const s=r;let n,o,a;if(i!=null&&(o=i.spatialReference,a=PA(o),s.geometryType=GP(i),s.geometry=xzt(i,t.compactGeometryEnabled),s.inSR=a),r.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=r.groupByFieldsForStatistics.join(",")),r.objectIds&&(s.objectIds=r.objectIds.join(",")),r.orderByFields&&(s.orderByFields=r.orderByFields.join(",")),!r.outFields||!r.returnDistinctValues&&(e!=null&&e.returnCountOnly||e!=null&&e.returnExtentOnly||e!=null&&e.returnIdsOnly)?delete s.outFields:r.outFields.includes("*")?s.outFields="*":s.outFields=r.outFields.join(","),r.outSR?(s.outSR=PA(r.outSR),n=t.outSpatialReference):i&&(r.returnGeometry||r.returnCentroid)&&(s.outSR=s.inSR,n=o),r.returnGeometry&&delete r.returnGeometry,r.outStatistics&&(s.outStatistics=JSON.stringify(r.outStatistics)),r.fullText&&(s.fullText=JSON.stringify(r.fullText)),r.pixelSize&&(s.pixelSize=JSON.stringify(r.pixelSize)),r.quantizationParameters&&(t.defaultSpatialReferenceEnabled&&o!=null&&((l=t.quantizationParameters)==null?void 0:l.extent)!=null&&o.equals(t.quantizationParameters.extent.spatialReference)&&delete r.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(r.quantizationParameters)),r.parameterValues&&(s.parameterValues=JSON.stringify(r.parameterValues)),r.rangeValues&&(s.rangeValues=JSON.stringify(r.rangeValues)),r.dynamicDataSource&&(s.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r.timeExtent){const c=r.timeExtent,{start:u,end:d}=c;u==null&&d==null||(s.time=u===d?u:`${u??"null"},${d??"null"}`),delete r.timeExtent}return t.defaultSpatialReferenceEnabled&&o!=null&&n!=null&&o.equals(n)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function Szt(t,e,i,r){const s=e.timeExtent!=null&&e.timeExtent.isEmpty?{data:{features:[]}}:await fN(t,e,"json",r);return See(e,i,s.data),s}async function phi(t,e,i,r){if(e.timeExtent!=null&&e.timeExtent.isEmpty)return{data:i.createFeatureResult()};const s=await Ezt(t,e,r),n=s;return n.data=wzt(s.data,i),n}function Ezt(t,e,i){return fN(t,e,"pbf",i)}function fhi(t,e,i){return e.timeExtent!=null&&e.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):fN(t,e,"json",i,{returnIdsOnly:!0})}function mhi(t,e,i){return e.timeExtent!=null&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):fN(t,e,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}async function ghi(t,e,i){if(e.timeExtent!=null&&e.timeExtent.isEmpty)return{data:{count:0,extent:null}};const r=await fN(t,e,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}),s=r.data;if(s.hasOwnProperty("extent"))return r;if(s.features)throw new Error(_be);if(s.hasOwnProperty("count"))throw new Error(_be);return r}async function fN(t,e,i,r={},s={}){const n=typeof t=="string"?un(t):t,o=e.geometry?[e.geometry]:[],a=await Eze(o,null,{signal:r.signal}),l=a==null?void 0:a[0];l!=null&&((e=e.clone()).geometry=l);const c=Cze({...n.query,f:i,...s,...Tzt(e,s)});return yr(Uh(n.path,Czt(e,s)?"query3d":"query"),{...r,responseType:i==="pbf"?"array-buffer":"json",query:{...c,...r.query}})}function Czt(t,e){return t.formatOf3DObjects!=null&&!(e.returnCountOnly||e.returnExtentOnly||e.returnIdsOnly)}var Eee;const Cee=new Ji({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let _a=Eee=class extends Se{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){var s;const i=Ze.fromJSON(e.spatialReference),r=[];for(let n=0;n<t.length;n++){const o=t[n],a=ca.fromJSON(o),l=(s=o.geometry)==null?void 0:s.spatialReference;a.geometry==null||l||(a.geometry.spatialReference=i);const c=o.aggregateGeometries,u=a.aggregateGeometries;if(c&&u!=null)for(const d in u){const f=u[d],m=c[d],g=m==null?void 0:m.spatialReference;f==null||g||(f.spatialReference=i)}r.push(a)}return r}writeGeometryType(t,e,i,r){if(t)return void Cee.write(t,e,i,r);const{features:s}=this;if(s){for(const n of s)if((n==null?void 0:n.geometry)!=null)return void Cee.write(n.geometry.type,e,i,r)}}readQueryGeometry(t,e){if(!t)return null;const i=!!t.spatialReference,r=ty(t);return r&&!i&&e.spatialReference&&(r.spatialReference=Ze.fromJSON(e.spatialReference)),r}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:i}=this;if(i){for(const r of i)if(r&&r.geometry!=null&&r.geometry.spatialReference)return void(e.spatialReference=r.geometry.spatialReference.toJSON())}}clone(){return new Eee(this.cloneProperties())}cloneProperties(){return ie({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let i=0;i<e.features.length;i++){const r=e.features[i];if(r.geometry){const s=t==null?void 0:t[i];r.geometry=(s==null?void 0:s.toJSON())||r.geometry}}return e}quantize(t){const{scale:[e,i],translate:[r,s]}=t,n=c=>Math.round((c-r)/e),o=c=>Math.round((s-c)/i),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,u=a.length;c<u;c++)l!=null&&l(a[c].geometry)||(a.splice(c,1),c--,u--);return this.transform=t,this}unquantize(){var f,m;const{geometryType:t,features:e,transform:i}=this;if(!i)return this;const{translate:[r,s],scale:[n,o]}=i,a=g=>g*n+r,l=g=>s-g*o;let c=null,u=null;if(this.hasZ&&((f=i==null?void 0:i.scale)==null?void 0:f[2])!=null){const{translate:[,,g],scale:[,,y]}=i;c=v=>v*y+g}if(this.hasM&&((m=i==null?void 0:i.scale)==null?void 0:m[3])!=null){const{translate:[,,,g],scale:[,,,y]}=i;u=v=>v==null?v:v*y+g}const d=this._getHydrationFunction(t,a,l,c,u);for(const{geometry:g}of e)g!=null&&d&&d(g);return this.transform=null,this}_quantizePoints(t,e,i){let r,s;const n=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];if(o>0){const c=e(l[0]),u=i(l[1]);c===r&&u===s||(n.push([c-r,u-s]),r=c,s=u)}else r=e(l[0]),s=i(l[1]),n.push([r,s])}return n.length>0?n:null}_getQuantizationFunction(t,e,i){return t==="point"?r=>(r.x=e(r.x),r.y=i(r.y),r):t==="polyline"||t==="polygon"?r=>{const s=ol(r)?r.rings:r.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,e,i);c&&n.push(c)}return n.length>0?(ol(r)?r.rings=n:r.paths=n,r):null}:t==="multipoint"?r=>{const s=this._quantizePoints(r.points,e,i);return s&&s.length>0?(r.points=s,r):null}:t==="extent"?r=>r:null}_getHydrationFunction(t,e,i,r,s){return t==="point"?n=>{n.x=e(n.x),n.y=i(n.y),r&&(n.z=r(n.z))}:t==="polyline"||t==="polygon"?n=>{const o=ol(n)?n.rings:n.paths;let a,l;for(let c=0,u=o.length;c<u;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const g=d[f];f>0?(a+=g[0],l+=g[1]):(a=g[0],l=g[1]),g[0]=e(a),g[1]=i(l)}}if(r&&s)for(let c=0,u=o.length;c<u;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const g=d[f];g[2]=r(g[2]),g[3]=s(g[3])}}else if(r)for(let c=0,u=o.length;c<u;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const g=d[f];g[2]=r(g[2])}}else if(s)for(let c=0,u=o.length;c<u;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const g=d[f];g[2]=s(g[2])}}}:t==="extent"?n=>{n.xmin=e(n.xmin),n.ymin=i(n.ymin),n.xmax=e(n.xmax),n.ymax=i(n.ymax),r&&n.zmax!=null&&n.zmin!=null&&(n.zmax=r(n.zmax),n.zmin=r(n.zmin)),s&&n.mmax!=null&&n.mmin!=null&&(n.mmax=s(n.mmax),n.mmin=s(n.mmin))}:t==="multipoint"?n=>{const o=n.points;let a,l;for(let c=0,u=o.length;c<u;c++){const d=o[c];c>0?(a+=d[0],l+=d[1]):(a=d[0],l=d[1]),d[0]=e(a),d[1]=i(l)}if(r&&s)for(let c=0,u=o.length;c<u;c++){const d=o[c];d[2]=r(d[2]),d[3]=s(d[3])}else if(r)for(let c=0,u=o.length;c<u;c++){const d=o[c];d[2]=r(d[2])}else if(s)for(let c=0,u=o.length;c<u;c++){const d=o[c];d[2]=s(d[2])}}:null}};h([p({type:String,json:{write:!0}})],_a.prototype,"displayFieldName",void 0),h([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],_a.prototype,"exceededTransferLimit",void 0),h([p({type:[ca],json:{write:!0}})],_a.prototype,"features",void 0),h([ze("features")],_a.prototype,"readFeatures",null),h([p({type:[GG],json:{write:!0}})],_a.prototype,"fields",void 0),h([p({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:Cee.read}}})],_a.prototype,"geometryType",void 0),h([We("geometryType")],_a.prototype,"writeGeometryType",null),h([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],_a.prototype,"hasM",void 0),h([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],_a.prototype,"hasZ",void 0),h([p({types:y2,json:{write:!0}})],_a.prototype,"queryGeometry",void 0),h([ze("queryGeometry")],_a.prototype,"readQueryGeometry",null),h([p({type:Ze,json:{write:!0}})],_a.prototype,"spatialReference",void 0),h([We("spatialReference")],_a.prototype,"writeSpatialReference",null),h([p({json:{write:!0}})],_a.prototype,"transform",void 0),_a=Eee=h([I("esri.rest.support.FeatureSet")],_a),_a.prototype.toJSON.isDefaultToJSON=!0;const nle=_a;async function V7(t,e,i){const r=await Mzt(t,e,i);return nle.fromJSON(r)}async function Mzt(t,e,i){const r=hae(t),s={...i},n=Lh.from(e),{data:o}=await Szt(r,n,n.sourceSpatialReference,s);return o}var Mee;let gn=Mee=class extends Se{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new Mee(ie({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};h([p({type:Boolean,json:{write:!0}})],gn.prototype,"cacheHint",void 0),h([p({type:nf,json:{write:!0}})],gn.prototype,"dynamicDataSource",void 0),h([p({type:String,json:{write:!0}})],gn.prototype,"gdbVersion",void 0),h([p({type:Number,json:{write:!0}})],gn.prototype,"geometryPrecision",void 0),h([p({type:Date})],gn.prototype,"historicMoment",void 0),h([We("historicMoment")],gn.prototype,"_writeHistoricMoment",null),h([p({type:Number,json:{write:!0}})],gn.prototype,"maxAllowableOffset",void 0),h([p({json:{write:!0}})],gn.prototype,"objectIds",void 0),h([p({type:[String],json:{write:!0}})],gn.prototype,"orderByFields",void 0),h([p({type:[String],json:{write:!0}})],gn.prototype,"outFields",void 0),h([p({type:Ze,json:{read:{source:"outSR"},write:{target:"outSR"}}})],gn.prototype,"outSpatialReference",void 0),h([p({json:{write:!0}})],gn.prototype,"relationshipId",void 0),h([p({type:Number,json:{read:{source:"resultOffset"}}})],gn.prototype,"start",void 0),h([We("start"),We("num")],gn.prototype,"writeStart",null),h([p({type:Number,json:{read:{source:"resultRecordCount"}}})],gn.prototype,"num",void 0),h([p({json:{write:!0}})],gn.prototype,"returnGeometry",void 0),h([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],gn.prototype,"returnM",void 0),h([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],gn.prototype,"returnZ",void 0),h([p({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],gn.prototype,"where",void 0),gn=Mee=h([I("esri.rest.support.RelationshipQuery")],gn),gn.from=Qs(gn);const RP=gn,yhi=Object.freeze(Object.defineProperty({__proto__:null,default:RP},Symbol.toStringTag,{value:"Module"}));var Aee;let BC=Aee=class extends Se{constructor(t){super(t),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new Aee({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};h([p({type:[String],json:{write:!0}})],BC.prototype,"groupByFields",void 0),h([p({type:Number,json:{write:!0}})],BC.prototype,"topCount",void 0),h([p({type:[String],json:{write:!0}})],BC.prototype,"orderByFields",void 0),BC=Aee=h([I("esri.rest.support.TopFilter")],BC);const Azt=BC;var Pee;const vbe=new Ji({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),bbe=new Ji({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Hs=Pee=class extends Se{constructor(t){super(t),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new Pee(ie({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};h([p({type:Boolean,json:{write:!0}})],Hs.prototype,"cacheHint",void 0),h([p({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],Hs.prototype,"distance",void 0),h([p({types:y2,json:{read:ty,write:!0}})],Hs.prototype,"geometry",void 0),h([p({type:Number,json:{write:!0}})],Hs.prototype,"geometryPrecision",void 0),h([p({type:Number,json:{write:!0}})],Hs.prototype,"maxAllowableOffset",void 0),h([p({type:Number,json:{read:{source:"resultRecordCount"}}})],Hs.prototype,"num",void 0),h([p({json:{write:!0}})],Hs.prototype,"objectIds",void 0),h([p({type:[String],json:{write:!0}})],Hs.prototype,"orderByFields",void 0),h([p({type:[String],json:{write:!0}})],Hs.prototype,"outFields",void 0),h([p({type:Ze,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Hs.prototype,"outSpatialReference",void 0),h([p({type:String,json:{write:!0}})],Hs.prototype,"resultType",void 0),h([p({json:{write:!0}})],Hs.prototype,"returnGeometry",void 0),h([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Hs.prototype,"returnM",void 0),h([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Hs.prototype,"returnZ",void 0),h([p({type:Number,json:{read:{source:"resultOffset"}}})],Hs.prototype,"start",void 0),h([We("start"),We("num")],Hs.prototype,"writeStart",null),h([p({type:String,json:{read:{source:"spatialRel",reader:vbe.read},write:{target:"spatialRel",writer:vbe.write}}})],Hs.prototype,"spatialRelationship",void 0),h([p({type:$a,json:{write:!0}})],Hs.prototype,"timeExtent",void 0),h([p({type:Azt,json:{write:!0}})],Hs.prototype,"topFilter",void 0),h([p({type:String,json:{read:bbe.read,write:{writer:bbe.write,overridePolicy(t){return{enabled:t!=null&&this.distance!=null&&this.distance>0}}}}})],Hs.prototype,"units",void 0),h([p({type:String,json:{write:!0}})],Hs.prototype,"where",void 0),Hs=Pee=h([I("esri.rest.support.TopFeaturesQuery")],Hs),Hs.from=Qs(Hs);const A5=Hs,Pzt="esri.widgets.Feature.support.relatedFeatureUtils",wbe=()=>se.getLogger(Pzt),xbe=new Map;function nV(t){if(!j0(t))return null;const[e,i]=t.split("/").slice(1);return{layerId:e,fieldName:i}}function Ozt(t,e){if(!e.relationships)return null;let i=null;const{relationships:r}=e;return r.some(s=>s.id===parseInt(t,10)&&(i=s,!0)),i}function Rzt({originRelationship:t,relationships:e,layerId:i}){return e.find(({relatedTableId:r,id:s})=>`${r}`===i&&s===(t==null?void 0:t.id))??null}function $zt(t,e){const i=e.toLowerCase();for(const r in t)if(r.toLowerCase()===i)return t[r];return null}function Izt(t,e){const i=Ozt(t,e);if(i)return{url:`${e.url}/${i.relatedTableId}`,sourceSpatialReference:e.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function Lzt(t,e){if(!e||!t)return;const{features:i,statsFeatures:r}=t,s=i==null?void 0:i.value;e.relatedFeatures=s?s.features:[];const n=r==null?void 0:r.value;e.relatedStatsFeatures=n?n.features:[]}function Dzt(t,e,i,r){var n;const s=new RP;return s.outFields=["*"],s.relationshipId=typeof e.id=="number"?e.id:parseInt(e.id,10),s.objectIds=[t.attributes[i.objectIdField]],s.gdbVersion=i.gdbVersion??null,s.historicMoment=i.historicMoment??null,((n=i.queryRelatedFeatures)==null?void 0:n.call(i,s,r))??Promise.resolve({})}function Nzt(t,e,i){let r=0;const s=[];for(;r<e.length;)s.push(`${t} IN (${e.slice(r,i+r)})`),r+=i;return s.join(" OR ")}function Fzt(t){return t?h2(t):void 0}function kzt(t){return t?h2(t,(e,i)=>JSON.stringify(e.toJSON())===JSON.stringify(i.toJSON())):void 0}async function Uzt(t,e,i,r){const s=i.layerId.toString(),{layerInfo:n,relation:o,relatedFields:a,outStatistics:l,url:c,sourceSpatialReference:u}=e,d=Fzt(a),f=kzt(l);if(!n||!o)return null;const m=Rzt({originRelationship:o,relationships:n.relationships,layerId:s});if(m!=null&&m.relationshipTableId&&m.keyFieldInRelationshipTable){const y=(await Dzt(t,m,i,r))[t.attributes[i.objectIdField]];if(!y)return null;const v=y.features.map(b=>b.attributes[n.objectIdField]);if(f!=null&&f.length&&n.supportsStatistics){const b=new Lh;b.where=Nzt(n.objectIdField,v,1e3),b.outFields=d,b.outStatistics=f,b.sourceSpatialReference=u;const w={features:Promise.resolve(y),statsFeatures:V7(c,b)};return jf(w)}}const g=m==null?void 0:m.keyField;if(g){const y=DG(Gzt(n.fields,g)),v=$zt(t.attributes,o.keyField),b=y?`${g}=${v}`:`${g}='${v}'`,w=i.historicMoment,x=i.gdbVersion,S=V7(c,new Lh({where:b,outFields:d,sourceSpatialReference:u,historicMoment:w,gdbVersion:x}),r),C=f!=null&&f.length&&n.supportsStatistics?V7(c,new Lh({where:b,outFields:d,outStatistics:f,sourceSpatialReference:u}),r):null,M={features:S};return C&&(M.statsFeatures=C),jf(M)}return null}function Vzt(t,e){return yr(t,{query:{f:"json"},signal:e==null?void 0:e.signal})}function zzt({relatedInfos:t,layer:e},i){const r={};return t.forEach((s,n)=>{const{relation:o}=s;if(!o){const d=new G("relation-required","A relation is required on a layer to retrieve related records.");throw wbe().error(d),d}const{relatedTableId:a}=o;if(typeof a!="number"){const d=new G("A related table ID is required on a layer to retrieve related records.");throw wbe().error(d),d}const l=`${e.url}/${a}`,c=xbe.get(l),u=c??Vzt(l);c||xbe.set(l,u),r[n]=u}),Sie(jf(r),i)}function Bzt({graphic:t,relatedInfos:e,layer:i},r){const s={};return e.forEach((n,o)=>{n.layerInfo&&(s[o]=Uzt(t,n,i,r))}),jf(s)}function jzt({relatedInfo:t,fieldName:e,fieldInfo:i}){var r,s;if((r=t.relatedFields)==null||r.push(e),i.statisticType){const n=new lRe({statisticType:i.statisticType,onStatisticField:e,outStatisticFieldName:e});(s=t.outStatistics)==null||s.push(n)}}function Gzt(t,e){if(t!=null){e=e.toLowerCase();for(const i of t)if(i&&i.name.toLowerCase()===e)return i}return null}const Tbe={chartAnimation:!0};let To=class extends Ue{constructor(e){super(e),this.abilities={...Tbe},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{...Tbe,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:i}=this,r=(e+i)%i;this.activeMediaInfoIndex=r}_pageContentElementMedia(e){const{activeMediaInfoIndex:i}=this,r=i+e;this._setContentElementMedia(r)}_formatMediaInfos(){const{mediaInfos:e,layer:i}=this,r=this.attributes??{},s=this.formattedAttributes??{},n=this.expressionAttributes??{},o=this.fieldInfoMap??new Map;return(e==null?void 0:e.map(a=>{const l=a==null?void 0:a.clone();return l?(l.title=GT({attributes:r,fieldInfoMap:o,globalAttributes:s,expressionAttributes:n,layer:i,text:l.title}),l.caption=GT({attributes:r,fieldInfoMap:o,globalAttributes:s,expressionAttributes:n,layer:i,text:l.caption}),l.altText=GT({attributes:r,fieldInfoMap:o,globalAttributes:s,expressionAttributes:n,layer:i,text:l.altText}),l.type==="image"?l.value?(this._setImageValue({value:l.value,formattedAttributes:s,layer:i}),l.value.sourceURL?l:void 0):void 0:l.type==="pie-chart"||l.type==="line-chart"||l.type==="column-chart"||l.type==="bar-chart"?l.value?(this._setChartValue({value:l.value,chartType:l.type,attributes:r,formattedAttributes:s,layer:i,expressionAttributes:n}),l):void 0:null):null}).filter(op))??[]}_setImageValue(e){const i=this.fieldInfoMap??new Map,{value:r,formattedAttributes:s,layer:n}=e,{linkURL:o,sourceURL:a}=r;if(a){const l=bee(a,n);r.sourceURL=vee({formattedAttributes:s,template:l,fieldInfoMap:i})}if(o){const l=bee(o,n);r.linkURL=vee({formattedAttributes:s,template:l,fieldInfoMap:i})}}_setChartValue(e){const{value:i,attributes:r,formattedAttributes:s,chartType:n,layer:o,expressionAttributes:a}=e,{popupTemplate:l,relatedInfos:c}=this,{fields:u,normalizeField:d}=i,f=o;if(i.fields=cVt(u,f),d&&(i.normalizeField=XL(d,f)),!u.some(g=>!!(s[g]!=null||j0(g)&&(c!=null&&c.size))))return;const m=(l==null?void 0:l.fieldInfos)??[];u.forEach((g,y)=>{var w;const v=(w=i.colors)==null?void 0:w[y];if(j0(g))return void(i.series=[...i.series,...this._getRelatedChartInfos({fieldInfos:m,fieldName:g,formattedAttributes:s,chartType:n,value:i,color:v})]);const b=this._getChartOption({value:i,attributes:r,chartType:n,formattedAttributes:s,expressionAttributes:a,fieldName:g,fieldInfos:m,color:v});i.series.push(b)})}_getRelatedChartInfos(e){var g;const{fieldInfos:i,fieldName:r,formattedAttributes:s,chartType:n,value:o,color:a}=e,l=[],c=nV(r),u=c&&((g=this.relatedInfos)==null?void 0:g.get(c.layerId.toString()));if(!u)return l;const{relatedFeatures:d,relation:f}=u;if(!f||!d)return l;const{cardinality:m}=f;return d.forEach(y=>{const{attributes:v}=y;v&&Object.keys(v).forEach(b=>{b===c.fieldName&&l.push(this._getChartOption({value:o,attributes:v,formattedAttributes:s,fieldName:r,chartType:n,relatedFieldName:b,hasMultipleRelatedFeatures:(d==null?void 0:d.length)>1,fieldInfos:i,color:a}))})}),m==="one-to-many"||m==="many-to-many"?l:[l[0]]}_getTooltip({label:e,value:i,chartType:r}){return r==="pie-chart"?`${e}`:`${e}: ${i}`}_getChartOption(e){var O;const{value:i,attributes:r,formattedAttributes:s,expressionAttributes:n,fieldName:o,relatedFieldName:a,fieldInfos:l,chartType:c,hasMultipleRelatedFeatures:u,color:d}=e,f=this.layer,m=this.fieldInfoMap??new Map,{normalizeField:g,tooltipField:y}=i,v=g?j0(g)?r[nV(g).fieldName]:r[g]:null,b=Kae(o)&&n&&n[o]!==void 0?n[o]:a&&r[a]!==void 0?r[a]:r[o]!==void 0?r[o]:s[o],w=new hOe({fieldName:o,color:d,value:b===void 0?null:b&&v?b/v:b});if(j0(o)){const D=m.get(o.toLowerCase()),U=y&&m.get(y.toLowerCase()),k=(D==null?void 0:D.fieldName)??o,H=u&&y?nV(y).fieldName:(U==null?void 0:U.fieldName)??y,V=u&&H?r[H]:s[H]??(D==null?void 0:D.label)??(D==null?void 0:D.fieldName)??a,X=u&&a?r[a]:s[k];return w.tooltip=this._getTooltip({label:V,value:X,chartType:c}),w}const x=gze(l,o),S=XL(o,f),C=y&&s[y]!==void 0?s[y]:pze(x||new AD({fieldName:S}),(O=this.popupTemplate)==null?void 0:O.expressionInfos),M=s[S];return w.tooltip=this._getTooltip({label:C,value:M,chartType:c}),w}};h([p()],To.prototype,"abilities",void 0),h([Kt("abilities")],To.prototype,"castAbilities",null),h([p()],To.prototype,"activeMediaInfoIndex",void 0),h([p({readOnly:!0})],To.prototype,"activeMediaInfo",null),h([p()],To.prototype,"attributes",void 0),h([p()],To.prototype,"description",void 0),h([p()],To.prototype,"fieldInfoMap",void 0),h([p()],To.prototype,"formattedAttributes",void 0),h([p()],To.prototype,"expressionAttributes",void 0),h([p({readOnly:!0})],To.prototype,"formattedMediaInfos",null),h([p()],To.prototype,"isAggregate",void 0),h([p()],To.prototype,"layer",void 0),h([p({readOnly:!0})],To.prototype,"formattedMediaInfoCount",null),h([p()],To.prototype,"mediaInfos",void 0),h([p()],To.prototype,"popupTemplate",void 0),h([p()],To.prototype,"relatedInfos",void 0),h([p()],To.prototype,"title",void 0),To=h([I("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],To);const qT=To,_o="esri-feature-media",pc={base:_o,mediaContainer:`${_o}__container`,mediaItemContainer:`${_o}__item-container`,mediaItem:`${_o}__item`,mediaItemText:`${_o}__item-text`,mediaItemTitle:`${_o}__item-title`,mediaItemCaption:`${_o}__item-caption`,mediaNavigation:`${_o}__item-navigation`,mediaPagination:`${_o}__pagination`,mediaPaginationText:`${_o}__pagination-text`,mediaPrevious:`${_o}__previous`,mediaPreviousIconLTR:`${_o}__previous-icon`,mediaPreviousIconRTL:`${_o}__previous-icon--rtl`,mediaNext:`${_o}__next`,mediaNextIconLTR:`${_o}__next-icon`,mediaNextIconRTL:`${_o}__next-icon--rtl`,mediaChart:`${_o}__chart`,mediaPaginationButton:`${_o}__pagination-button`,mediaPaginationIcon:`${_o}__pagination-icon`,mediaChartRendered:`${_o}__chart--rendered`},z7=15,Tv="category",MR="value",Hzt="rgba(50, 50, 50, 1)",qzt=250,Wzt=500,Zzt=200;let Sc=class extends Ua{constructor(e,i){super(e,i),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new qT,this.messages=null,this._disposeChart=r=>{var s;(s=this._chartRootMap.get(r))==null||s.dispose(),this._chartRootMap.delete(r)},this._createChart=async r=>{const{destroyed:s,viewModel:n}=this;if(s||!n||!r)return;const{createRoot:o}=await ce(()=>import("./chartUtilsAm5-BODKBiY4.js"),__vite__mapDeps([217,218,219,220])),a=await o(r);this._chartRootMap.set(r,a),this._renderChart({mediaInfo:n.activeMediaInfo,root:a})}}initialize(){this._featureElementInfo=new sH,this.addHandles([te(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(i=this.viewModel)==null?void 0:i.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),$t),te(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.description,(i=this.viewModel)==null?void 0:i.title]},()=>this._setupFeatureElementInfo(),$t)])}loadDependencies(){return sm({icon:()=>ce(()=>import("./calcite-icon-BwrxrAiO.js"),__vite__mapDeps([209,207,198,199,206]))})}destroy(){var e;this._clearMediaRefreshTimer(),(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var e;return ge("div",{bind:this,class:pc.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this._renderMedia())}_renderMedia(){const{formattedMediaInfoCount:e,activeMediaInfoIndex:i}=this.viewModel,r=this._renderMediaText();return e?ge("div",{class:pc.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),ge("div",{class:pc.mediaNavigation},r,e>1?ge("div",{class:pc.mediaPagination},this._renderMediaPageButton("previous"),ge("span",{class:pc.mediaPaginationText},dg(this.messages.pageText,{index:i+1,total:e})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const i=e&&e.title?ge("div",{class:pc.mediaItemTitle,innerHTML:e.title,key:"media-title"}):null,r=e&&e.caption?ge("div",{class:pc.mediaItemCaption,innerHTML:e.caption,key:"media-caption"}):null;return i||r?ge("div",{class:pc.mediaItemText,key:"media-text"},i,r):null}_renderImageMediaInfo(e){if(!e.value)return null;const{_refreshIntervalInfo:i}=this,{activeMediaInfoIndex:r,formattedMediaInfoCount:s}=this.viewModel,{value:n,refreshInterval:o,altText:a,title:l,type:c}=e,{sourceURL:u,linkURL:d}=n,f=dze(d??void 0)?"_blank":"_self",m=f==="_blank"?"noreferrer":"",g=o?i:null,y=g?g.timestamp:0,v=g?g.sourceURL:u,b=ge("img",{alt:a||l,key:`media-${c}-${r}-${s}-${y}`,src:v??void 0});return(d?ge("a",{href:d,rel:m,target:f,title:l},b):null)??b}_renderChartMediaInfo(e){const{activeMediaInfoIndex:i,formattedMediaInfoCount:r}=this.viewModel;return ge("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:pc.mediaChart,key:`media-${e.type}-${i}-${r}`})}_renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this._renderImageMediaInfo(e):e.type.includes("chart")?this._renderChartMediaInfo(e):null:null}_renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;return e?ge("div",{class:pc.mediaItemContainer,key:"media-container"},ge("div",{class:pc.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const i=e==="previous",r=i?this.messages.previous:this.messages.next,s=i?"chevron-left":"chevron-right",n=i?"media-previous":"media-next",o=i?this._previous:this._next;return ge("button",{"aria-label":r,bind:this,class:pc.mediaPaginationButton,key:n,onclick:o,tabIndex:0,title:r,type:"button"},ge("calcite-icon",{class:pc.mediaPaginationIcon,icon:s,scale:"s"}))}_setupFeatureElementInfo(){var r;const{description:e,title:i}=this;(r=this._featureElementInfo)==null||r.set({description:e,title:i})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;const{isAggregate:e,layer:i}=this.viewModel;return e&&(i!=null&&i.featureReduction)&&"renderer"in i.featureReduction?i.featureReduction.renderer:i==null?void 0:i.renderer}async _getSeriesColors(e){const{colorAm5:i}=await ce(()=>import("./chartCommon-BGALUHy4.js"),__vite__mapDeps([221,218,222,219,223])),r=new Map;return e.forEach(s=>{s.color&&r.set(s,i(s.color.toCss(!0)))}),r}async _getRendererColors(){const{colorAm5:e}=await ce(()=>import("./chartCommon-BGALUHy4.js"),__vite__mapDeps([221,218,222,219,223])),i=new Map,r=this._getRenderer(),s="default";if(!r)return i;const n=await YVt(r);return n.delete(s),Array.from(n.values()).every(o=>(o==null?void 0:o.length)===1)&&Array.from(n.keys()).forEach(o=>{var l,c;const a=(c=(l=n.get(o))==null?void 0:l[0])==null?void 0:c.toCss(!0);a&&i.set(o,e(a))}),i}_handleMediaKeyup(e){const{key:i}=e;i==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),i==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!pRe()}_getChartAnimationMS(){return this._canAnimateChart()?qzt:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?Wzt:0}async _renderChart(e){const{root:i,mediaInfo:r}=e,{value:s,type:n}=r,{ResponsiveThemeAm5:o,DarkThemeAm5:a,AnimatedThemeAm5:l,ColorSetAm5:c,ThemeAm5:u,esriChartColorSet:d}=await ce(async()=>{const{ResponsiveThemeAm5:S,DarkThemeAm5:C,AnimatedThemeAm5:M,ColorSetAm5:O,ThemeAm5:D,esriChartColorSet:U}=await import("./chartCommon-BGALUHy4.js");return{ResponsiveThemeAm5:S,DarkThemeAm5:C,AnimatedThemeAm5:M,ColorSetAm5:O,ThemeAm5:D,esriChartColorSet:U}},__vite__mapDeps([221,218,222,219,223])),f=u.new(i);f.rule("ColorSet").set("colors",d),f.rule("ColorSet").set("reuse",!0);const m=[o.new(i),f];wVe()&&m.push(a.new(i)),this._canAnimateChart()&&m.push(l.new(i)),i.setThemes(m);const g=await this._getRendererColors(),y=await this._getSeriesColors(s.series),v=c.new(i,{}),b=y.get(s.series[0]),w=b?{lineSettings:{stroke:b}}:void 0,x=s.series.map((S,C)=>{const M=y.get(S)||g.get(S.fieldName)||v.getIndex(C);return{[Tv]:S.tooltip,[MR]:S.value,columnSettings:{fill:M,stroke:M},...w}}).filter(S=>n!=="pie-chart"||S.value!=null&&S.value>0);n==="pie-chart"?this._createPieChart(e,x):this._createXYChart(e,x)}_getDirection(){return Cb(this.container)?"rtl":"ltr"}_isInversed(){return!!Cb(this.container)}async _customizeChartTooltip(e,i="horizontal"){var s;const{colorAm5:r}=await ce(()=>import("./chartCommon-BGALUHy4.js"),__vite__mapDeps([221,218,222,219,223]));e.setAll({pointerOrientation:i}),(s=e.get("background"))==null||s.setAll({stroke:r(Hzt)}),e.label.setAll({direction:this._getDirection(),oversizedBehavior:"wrap",maxWidth:Zzt})}async _createPieChart(e,i){const{TooltipAm5:r}=await ce(()=>import("./chartCommon-BGALUHy4.js"),__vite__mapDeps([221,218,222,219,223])),{PieChartAm5:s,PieSeriesAm5:n}=await ce(async()=>{const{PieChartAm5:y,PieSeriesAm5:v}=await import("./pieChart-Tq5fevzR.js");return{PieChartAm5:y,PieSeriesAm5:v}},__vite__mapDeps([224,225,218,223,220])),{mediaInfo:o,root:a}=e,{title:l}=o,c=5,u=(o==null?void 0:o.altText)||(o==null?void 0:o.title)||"",d=a.container.children.push(s.new(a,{ariaLabel:u,focusable:!0,paddingBottom:c,paddingTop:c,paddingLeft:c,paddingRight:c})),f=`{category}: {valuePercentTotal.formatNumber('0.00')}%
 ({value})`,m=r.new(a,{labelText:f}),g=d.series.push(n.new(a,{name:l,valueField:MR,categoryField:Tv,tooltip:m}));g.ticks.template.set("forceHidden",!0),g.labels.template.set("forceHidden",!0),g.slices.template.states.create("active",{shiftRadius:c}),this._customizeChartTooltip(m),g.slices.template.setAll({ariaLabel:f,focusable:!0,templateField:"columnSettings"}),g.data.setAll(i),g.appear(this._getChartSeriesAnimationMS()),d.appear(this._getChartAnimationMS()),d.root.dom.classList.toggle(pc.mediaChartRendered,!0)}_getMinSeriesValue(e){let i=0;return e.forEach(r=>i=Math.min(r.value,i)),i}async _createColumnChart(e,i,r){const{TooltipAm5:s,ScrollbarAm5:n}=await ce(()=>import("./chartCommon-BGALUHy4.js"),__vite__mapDeps([221,218,222,219,223])),{CategoryAxisAm5:o,AxisRendererXAm5:a,ValueAxisAm5:l,AxisRendererYAm5:c,ColumnSeriesAm5:u}=await ce(async()=>{const{CategoryAxisAm5:S,AxisRendererXAm5:C,ValueAxisAm5:M,AxisRendererYAm5:O,ColumnSeriesAm5:D}=await import("./xyChart-C20g54gE.js");return{CategoryAxisAm5:S,AxisRendererXAm5:C,ValueAxisAm5:M,AxisRendererYAm5:O,ColumnSeriesAm5:D}},__vite__mapDeps([226,218,223,220,225,222])),{mediaInfo:d,root:f}=i,{value:m,title:g}=d;e.setAll({wheelX:"panX",wheelY:"zoomX"});const y=e.xAxes.push(o.new(f,{renderer:a.new(f,{inversed:this._isInversed()}),categoryField:Tv}));y.get("renderer").labels.template.setAll({forceHidden:!0});const v=e.yAxes.push(l.new(f,{renderer:c.new(f,{inside:!1}),min:this._getMinSeriesValue(m.series)}));v.get("renderer").labels.template.setAll({direction:this._getDirection()});const b="{categoryX}",w=s.new(f,{labelText:b}),x=e.series.push(u.new(f,{name:g,xAxis:y,yAxis:v,valueYField:MR,categoryXField:Tv,tooltip:w}));this._customizeChartTooltip(w),x.columns.template.setAll({ariaLabel:b,focusable:!0,templateField:"columnSettings"}),m.series.length>z7&&e.set("scrollbarX",n.new(f,{orientation:"horizontal"})),y.data.setAll(r),x.data.setAll(r),x.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createBarChart(e,i,r){const{TooltipAm5:s,ScrollbarAm5:n}=await ce(()=>import("./chartCommon-BGALUHy4.js"),__vite__mapDeps([221,218,222,219,223])),{CategoryAxisAm5:o,AxisRendererXAm5:a,ValueAxisAm5:l,AxisRendererYAm5:c,ColumnSeriesAm5:u}=await ce(async()=>{const{CategoryAxisAm5:S,AxisRendererXAm5:C,ValueAxisAm5:M,AxisRendererYAm5:O,ColumnSeriesAm5:D}=await import("./xyChart-C20g54gE.js");return{CategoryAxisAm5:S,AxisRendererXAm5:C,ValueAxisAm5:M,AxisRendererYAm5:O,ColumnSeriesAm5:D}},__vite__mapDeps([226,218,223,220,225,222])),{mediaInfo:d,root:f}=i,{value:m,title:g}=d;e.setAll({wheelX:"panY",wheelY:"zoomY"});const y=e.yAxes.push(o.new(f,{renderer:c.new(f,{inversed:!0}),categoryField:Tv}));y.get("renderer").labels.template.setAll({forceHidden:!0});const v=e.xAxes.push(l.new(f,{renderer:a.new(f,{inside:!1,inversed:this._isInversed()}),min:this._getMinSeriesValue(m.series)}));v.get("renderer").labels.template.setAll({direction:this._getDirection()});const b="{categoryY}",w=s.new(f,{labelText:b}),x=e.series.push(u.new(f,{name:g,xAxis:v,yAxis:y,valueXField:MR,categoryYField:Tv,tooltip:w}));this._customizeChartTooltip(w,"vertical"),x.columns.template.setAll({ariaLabel:b,focusable:!0,templateField:"columnSettings"}),m.series.length>z7&&e.set("scrollbarY",n.new(f,{orientation:"vertical"})),y.data.setAll(r),x.data.setAll(r),x.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createLineChart(e,i,r){var C,M,O;const{TooltipAm5:s,ScrollbarAm5:n}=await ce(()=>import("./chartCommon-BGALUHy4.js"),__vite__mapDeps([221,218,222,219,223])),{CategoryAxisAm5:o,AxisRendererXAm5:a,ValueAxisAm5:l,AxisRendererYAm5:c,LineSeriesAm5:u}=await ce(async()=>{const{CategoryAxisAm5:D,AxisRendererXAm5:U,ValueAxisAm5:k,AxisRendererYAm5:H,LineSeriesAm5:V}=await import("./xyChart-C20g54gE.js");return{CategoryAxisAm5:D,AxisRendererXAm5:U,ValueAxisAm5:k,AxisRendererYAm5:H,LineSeriesAm5:V}},__vite__mapDeps([226,218,223,220,225,222])),{root:d,mediaInfo:f}=i,{value:m,title:g}=f;e.setAll({wheelX:"panX",wheelY:"zoomX"});const y=e.xAxes.push(o.new(d,{renderer:a.new(d,{inversed:this._isInversed()}),categoryField:Tv}));y.get("renderer").labels.template.setAll({forceHidden:!0});const v=e.yAxes.push(l.new(d,{renderer:c.new(d,{inside:!1}),min:this._getMinSeriesValue(m.series)}));v.get("renderer").labels.template.setAll({direction:this._getDirection()});const b="{categoryX}",w=(M=(C=r[0])==null?void 0:C.lineSettings)==null?void 0:M.stroke,x=s.new(d,{getFillFromSprite:!w,labelText:b});w&&((O=x.get("background"))==null||O.setAll({fill:w}));const S=e.series.push(u.new(d,{name:g,xAxis:y,yAxis:v,valueYField:MR,categoryXField:Tv,tooltip:x}));S.strokes.template.setAll({templateField:"lineSettings"}),this._customizeChartTooltip(x,"vertical"),m.series.length>z7&&e.set("scrollbarX",n.new(d,{orientation:"horizontal"})),y.data.setAll(r),S.data.setAll(r),S.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createXYChart(e,i){const{XYChartAm5:r,XYCursorAm5:s}=await ce(()=>import("./xyChart-C20g54gE.js"),__vite__mapDeps([226,218,223,220,225,222])),{root:n,mediaInfo:o}=e,{type:a}=o,l=(o==null?void 0:o.altText)||(o==null?void 0:o.title)||"",c=n.container.children.push(r.new(n,{ariaLabel:l,focusable:!0,panX:!0,panY:!0}));c.set("cursor",s.new(n,{})),a==="column-chart"&&await this._createColumnChart(c,e,i),a==="bar-chart"&&await this._createBarChart(c,e,i),a==="line-chart"&&await this._createLineChart(c,e,i),c.root.dom.classList.toggle(pc.mediaChartRendered,!0)}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const i=Date.now();this._refreshIntervalInfo={timestamp:i,sourceURL:e&&this._getImageSource(e,i)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;(e==null?void 0:e.type)==="image"&&(e==null?void 0:e.refreshInterval)>0&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:i,value:r}=e,s=6e4*i;this._updateMediaInfoTimestamp(r.sourceURL);const n=setInterval(()=>{this._updateMediaInfoTimestamp(r.sourceURL)},s);this._refreshTimer=n}_getImageSource(e,i){const r=e.includes("?")?"&":"?",[s,n=""]=e.split("#");return`${s}${r}timestamp=${i}${n?"#":""}${n}`}};h([p()],Sc.prototype,"_refreshIntervalInfo",void 0),h([p()],Sc.prototype,"attributes",null),h([p()],Sc.prototype,"activeMediaInfoIndex",null),h([p()],Sc.prototype,"description",null),h([p()],Sc.prototype,"fieldInfoMap",null),h([p()],Sc.prototype,"layer",null),h([p()],Sc.prototype,"mediaInfos",null),h([p()],Sc.prototype,"popupTemplate",null),h([p()],Sc.prototype,"relatedInfos",null),h([p()],Sc.prototype,"title",null),h([p({type:qT})],Sc.prototype,"viewModel",void 0),h([p(),Fa("esri/widgets/Feature/t9n/Feature")],Sc.prototype,"messages",void 0),Sc=h([I("esri.widgets.Feature.FeatureMedia")],Sc);const Aze=Sc;var Oee;let MI=Oee=class extends Se{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new Oee({minValue:this.minValue,maxValue:this.maxValue})}};h([p({type:Number,json:{write:!0}})],MI.prototype,"minValue",void 0),h([p({type:Number,json:{write:!0}})],MI.prototype,"maxValue",void 0),MI=Oee=h([I("esri.renderers.support.AuthoringInfoClassBreakInfo")],MI);var Ree;let x1=Ree=class extends Se{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=new Array}clone(){return new Ree({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:ie(this.classBreakInfos)})}};h([p({type:String,json:{write:!0}})],x1.prototype,"field",void 0),h([p({type:String,json:{write:!0}})],x1.prototype,"normalizationField",void 0),h([p({type:String,json:{write:!0}})],x1.prototype,"label",void 0),h([p({type:[MI],json:{write:!0}})],x1.prototype,"classBreakInfos",void 0),x1=Ree=h([I("esri.renderers.support.AuthoringInfoFieldInfo")],x1);var $ee;let jC=$ee=class extends Se{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new $ee({label:this.label,value:this.value,size:this.size})}};h([p({type:String,json:{write:!0}})],jC.prototype,"label",void 0),h([p({type:Number,json:{write:!0}})],jC.prototype,"size",void 0),h([p({type:Number,json:{write:!0}})],jC.prototype,"value",void 0),jC=$ee=h([I("esri.renderers.support.AuthoringInfoSizeStop")],jC);const Yzt=jC;var Iee;const P5=new Ji({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),O5=new Ji({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),Sbe={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},Ebe=["high-to-low","above-and-below","centered-on","extremes"],Cbe=[...new Set(["high-to-low","above-and-below","centered-on","extremes","above","below","high-to-low","above-and-below","above","below","reference-size"])],Mbe=["seconds","minutes","hours","days","months","years"],Xzt=["circle","diamond","hexagon-flat","hexagon-pointy","square"];let va=Iee=class extends Se{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}get normalizationField(){return this.theme==="reference-size"?this._get("normalizationField"):null}set normalizationField(t){this._set("normalizationField",t)}get referenceSizeScale(){return this.theme==="reference-size"?this._get("referenceSizeScale"):null}set referenceSizeScale(t){this._set("referenceSizeScale",t)}get referenceSizeSymbolStyle(){return this.theme==="reference-size"?this._get("referenceSizeSymbolStyle"):null}set referenceSizeSymbolStyle(t){this._set("referenceSizeSymbolStyle",t)}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get sizeStops(){return this.theme==="reference-size"?this._get("sizeStops"):null}set sizeStops(t){this._set("sizeStops",t)}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new Iee({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,normalizationField:this.normalizationField,referenceSizeScale:this.referenceSizeScale,referenceSizeSymbolStyle:this.referenceSizeSymbolStyle,sizeStops:ie(this.sizeStops),startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};h([p({types:Sbe,json:{write:!0}})],va.prototype,"endTime",void 0),h([Kt("endTime")],va.prototype,"castEndTime",null),h([p({type:String,json:{write:!0}})],va.prototype,"field",void 0),h([p({type:Number,json:{write:!0}})],va.prototype,"maxSliderValue",void 0),h([p({type:Number,json:{write:!0}})],va.prototype,"minSliderValue",void 0),h([p({type:String,json:{origins:{"web-scene":{write:!1}},write:!0}})],va.prototype,"normalizationField",null),h([p({type:Number,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],va.prototype,"referenceSizeScale",null),h([p({type:Xzt,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],va.prototype,"referenceSizeSymbolStyle",null),h([p({types:Sbe,json:{write:!0}})],va.prototype,"startTime",void 0),h([Kt("startTime")],va.prototype,"castStartTime",null),h([p({type:[Yzt],json:{origins:{"web-scene":{write:!1}},write:!0}})],va.prototype,"sizeStops",null),h([p({type:P5.apiValues,value:null,json:{type:P5.jsonValues,read:P5.read,write:P5.write}})],va.prototype,"style",null),h([p({type:Cbe,value:null,json:{type:Cbe,origins:{"web-scene":{type:Ebe,write:{writer:(t,e)=>{Ebe.includes(t)&&(e.theme=t)}}}},write:!0}})],va.prototype,"theme",null),h([p({type:O5.apiValues,json:{type:O5.jsonValues,read:O5.read,write:O5.write}})],va.prototype,"type",void 0),h([p({type:Mbe,json:{type:Mbe,write:!0}})],va.prototype,"units",void 0),va=Iee=h([I("esri.renderers.support.AuthoringInfoVisualVariable")],va);const Jzt=va;let oV=class extends Se{constructor(e){super(e),this.type=null}};h([p({readOnly:!0,json:{read:!1,write:!0}})],oV.prototype,"type",void 0),oV=h([I("esri.rest.support.ColorRamp")],oV);const ole=oV;var Lee;let iT=Lee=class extends ole{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new Lee({fromColor:ie(this.fromColor),toColor:ie(this.toColor),algorithm:this.algorithm})}};h([Ot({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],iT.prototype,"algorithm",void 0),h([p({type:Qe,json:{type:[Xi],write:!0}})],iT.prototype,"fromColor",void 0),h([p({type:Qe,json:{type:[Xi],write:!0}})],iT.prototype,"toColor",void 0),h([p({type:["algorithmic"]})],iT.prototype,"type",void 0),iT=Lee=h([I("esri.rest.support.AlgorithmicColorRamp")],iT);const ale=iT;var Dee;let AI=Dee=class extends ole{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new Dee({colorRamps:ie(this.colorRamps)})}};h([p({type:[ale],json:{write:!0}})],AI.prototype,"colorRamps",void 0),h([p({type:["multipart"]})],AI.prototype,"type",void 0),AI=Dee=h([I("esri.rest.support.MultipartColorRamp")],AI);const Pze=AI,Qzt={key:"type",base:ole,typeMap:{algorithmic:ale,multipart:Pze}};function Kzt(t){return t!=null&&t.type?t.type==="algorithmic"?ale.fromJSON(t):t.type==="multipart"?Pze.fromJSON(t):null:null}var Nee;const rx=new Ji({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),R5=new Ji({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),Abe=new Ji({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),Pbe=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],eBt=["high-to-low","above-and-below","above","below"],tBt=["flow-line","wave-front"],iBt=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let Cn=Nee=class extends Se{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?Kzt(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){var t;return new Nee({classificationMethod:this.classificationMethod,colorRamp:ie(this.colorRamp),fadeRatio:ie(this.fadeRatio),fields:(t=this.fields)==null?void 0:t.slice(0),field1:ie(this.field1),field2:ie(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(e=>e.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};h([p({type:rx.apiValues,value:null,json:{type:rx.jsonValues,read:rx.read,write:rx.write,origins:{"web-document":{default:"manual",type:rx.jsonValues,read:rx.read,write:rx.write}}}})],Cn.prototype,"classificationMethod",null),h([p({types:Qzt,json:{write:!0}})],Cn.prototype,"colorRamp",void 0),h([ze("colorRamp")],Cn.prototype,"readColorRamp",null),h([p({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Cn.prototype,"fadeRatio",void 0),h([p({type:[String],value:null,json:{write:!0}})],Cn.prototype,"fields",null),h([p({type:x1,value:null,json:{write:!0}})],Cn.prototype,"field1",null),h([p({type:x1,value:null,json:{write:!0}})],Cn.prototype,"field2",null),h([p({type:tBt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Cn.prototype,"flowTheme",null),h([p({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],Cn.prototype,"focus",null),h([p({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],Cn.prototype,"isAutoGenerated",void 0),h([p({type:Number,value:null,json:{type:Xi,write:!0}})],Cn.prototype,"numClasses",null),h([p({type:Pbe,json:{type:Pbe,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],Cn.prototype,"lengthUnit",void 0),h([p({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Cn.prototype,"maxSliderValue",void 0),h([p({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Cn.prototype,"minSliderValue",void 0),h([p({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Cn.prototype,"statistics",null),h([p({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],Cn.prototype,"standardDeviationInterval",null),h([p({type:R5.apiValues,value:null,json:{type:R5.jsonValues,read:R5.read,write:R5.write,origins:{"web-scene":{type:Abe.jsonValues,write:{writer:Abe.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],Cn.prototype,"type",null),h([p({type:[Jzt],json:{write:!0}})],Cn.prototype,"visualVariables",void 0),h([p({type:iBt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Cn.prototype,"univariateSymbolStyle",null),h([p({type:eBt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Cn.prototype,"univariateTheme",null),Cn=Nee=h([I("esri.renderers.support.AuthoringInfo")],Cn);const lle=Cn,B7=new Ji({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let PI=class extends Se{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const i=new Set;return await this.collectRequiredFields(i,e),Array.from(i).sort()}getSymbol(e,i){}async getSymbolAsync(e,i){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};h([p({type:lle,json:{write:!0}})],PI.prototype,"authoringInfo",void 0),h([p({type:B7.apiValues,readOnly:!0,json:{type:B7.jsonValues,read:!1,write:{writer:B7.write,ignoreOrigin:!0}}})],PI.prototype,"type",void 0),PI=h([I("esri.renderers.Renderer")],PI);const D_=PI;function rBt(t){var e,i;return((i=(e=t.match(sBt))==null?void 0:e[1])==null?void 0:i.replace(/\\'/g,"'"))??null}const sBt=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var Fee;let vA=Fee=class extends Se{constructor(){super(...arguments),this.title=null}clone(){return new Fee({title:this.title})}};h([p({type:String,json:{write:!0}})],vA.prototype,"title",void 0),vA=Fee=h([I("esri.renderers.support.LegendOptions")],vA);var kee;let aV=kee=class extends vA{constructor(){super(...arguments),this.showLegend=null}clone(){return new kee({title:this.title,showLegend:this.showLegend})}};h([p({type:Boolean,json:{write:!0}})],aV.prototype,"showLegend",void 0),aV=kee=h([I("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],aV);const Oze=aV,j7=new Ji({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let Wp=class extends Se{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(se.getLogger(this).error(".field: field must be a string value"),null):uD(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};h([p()],Wp.prototype,"index",void 0),h([p({type:j7.apiValues,readOnly:!0,json:{read:j7.read,write:j7.write}})],Wp.prototype,"type",void 0),h([p({type:String,json:{write:!0}})],Wp.prototype,"field",void 0),h([Kt("field")],Wp.prototype,"castField",null),h([p({type:String,json:{write:!0}})],Wp.prototype,"valueExpression",void 0),h([p({type:String,json:{write:!0}})],Wp.prototype,"valueExpressionTitle",void 0),h([p({readOnly:!0})],Wp.prototype,"arcadeRequired",null),h([p({type:Oze,json:{write:!0}})],Wp.prototype,"legendOptions",void 0),Wp=h([I("esri.renderers.visualVariables.VisualVariable")],Wp);const mN=Wp;var Uee;let rT=Uee=class extends mN{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){var t;return new Uee({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:(t=this.legendOptions)==null?void 0:t.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};h([p({readOnly:!0})],rT.prototype,"cache",null),h([p({type:["color"],json:{type:["colorInfo"]}})],rT.prototype,"type",void 0),h([p({type:String,json:{write:!0}})],rT.prototype,"normalizationField",void 0),h([p({type:[VVt],json:{write:!0}})],rT.prototype,"stops",null),rT=Uee=h([I("esri.renderers.visualVariables.ColorVariable")],rT);const Rze=rT;var Vee;let r1=Vee=class extends Se{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return FA(e.transparency)}writeOpacity(t,e,i){e[i]=yD(t)}clone(){return new Vee({label:this.label,opacity:this.opacity,value:this.value})}};h([p({type:String,json:{write:!0}})],r1.prototype,"label",void 0),h([p({type:Number,json:{type:Xi,write:{target:"transparency"}}})],r1.prototype,"opacity",void 0),h([ze("opacity",["transparency"])],r1.prototype,"readOpacity",null),h([We("opacity")],r1.prototype,"writeOpacity",null),h([p({type:Number,json:{write:!0}})],r1.prototype,"value",void 0),r1=Vee=h([I("esri.renderers.visualVariables.support.OpacityStop")],r1);const nBt=r1;var zee;let sT=zee=class extends mN{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){var t;return new zee({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:(t=this.legendOptions)==null?void 0:t.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};h([p({readOnly:!0})],sT.prototype,"cache",null),h([p({type:["opacity"],json:{type:["transparencyInfo"]}})],sT.prototype,"type",void 0),h([p({type:String,json:{write:!0}})],sT.prototype,"normalizationField",void 0),h([p({type:[nBt],json:{write:!0}})],sT.prototype,"stops",null),sT=zee=h([I("esri.renderers.visualVariables.OpacityVariable")],sT);const $ze=sT;var Bee;let f0=Bee=class extends mN{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(t,e,i,r){if(r!=null&&r.messages){const s=`visualVariables[${this.index}]`;r.messages.push(new G("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:r}))}}clone(){var t;return new Bee({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:(t=this.legendOptions)==null?void 0:t.clone()})}};h([p({readOnly:!0})],f0.prototype,"cache",null),h([p({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],f0.prototype,"axis",void 0),h([p({type:["rotation"],json:{type:["rotationInfo"]}})],f0.prototype,"type",void 0),h([p({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],f0.prototype,"rotationType",void 0),h([p({type:String,json:{write:!0}})],f0.prototype,"valueExpressionTitle",void 0),h([We("web-scene","valueExpressionTitle")],f0.prototype,"writeValueExpressionTitleWebScene",null),f0=Bee=h([I("esri.renderers.visualVariables.RotationVariable")],f0);const Ize=f0;function oBt(t){return vr(t)}var jee;let s1=jee=class extends Se{constructor(t){super(t),this.label=null,this.size=null,this.value=null,this.useMinValue=null,this.useMaxValue=null}clone(){return new jee({label:this.label,size:this.size,value:this.value,useMaxValue:this.useMaxValue,useMinValue:this.useMinValue})}};h([p({type:String,json:{write:!0}})],s1.prototype,"label",void 0),h([p({type:Number,cast:vr,json:{write:!0}})],s1.prototype,"size",void 0),h([p({type:Number,json:{write:!0}})],s1.prototype,"value",void 0),h([p({type:Boolean,json:{write:!1}})],s1.prototype,"useMinValue",void 0),h([p({type:Boolean,json:{write:!1}})],s1.prototype,"useMaxValue",void 0),s1=jee=h([I("esri.renderers.visualVariables.support.SizeStop")],s1);const lV=s1;var Gee;let cV=Gee=class extends Oze{constructor(){super(...arguments),this.customValues=null}clone(){var t;return new Gee({title:this.title,showLegend:this.showLegend,customValues:(t=this.customValues)==null?void 0:t.slice(0)})}};h([p({type:[Number],json:{write:!0}})],cV.prototype,"customValues",void 0),cV=Gee=h([I("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],cV);const aBt=cV;var Hee;const $5=new Ji({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),qee=new Ji({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function Obe(t){if(t!=null)return typeof t=="string"||typeof t=="number"?oBt(t):t.type==="size"?bM(t)?t:(delete(t={...t}).type,new Gr(t)):void 0}function Rbe(t,e,i){if(typeof t!="object")return t;const r=new Gr;return r.read(t,i),r}let Gr=Hee=class extends mN{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&XDe.test(this.valueExpression)}}set index(t){bM(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),bM(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return ZDe(this)}set maxDataValue(t){t&&this.stops&&(se.getLogger(this).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(se.getLogger(this).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return Obe(t)}readMaxSize(t,e,i){return Rbe(t,e,i)}set minDataValue(t){t&&this.stops&&(se.getLogger(this).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(se.getLogger(this).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return Obe(t)}readMinSize(t,e,i){return Rbe(t,e,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value):t&&(se.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return Zvt(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,i,r){if(t==="$view.scale"){if(r!=null&&r.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;r.messages.push(new G("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:r}))}}else e[i]=t}readValueUnit(t){return t?qee.read(t):null}clone(){var t,e;return new Hee({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:bM(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:bM(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:(t=this.stops)==null?void 0:t.map(i=>i.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:(e=this.legendOptions)==null?void 0:e.clone()})}flipSizes(){if(this.transformationType===Qo.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===Qo.Stops){const t=this.stops;if(!t)return this;const e=t.map(r=>r.size).reverse(),i=t.length;for(let r=0;r<i;r++)t[r].size=e[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){var t;return(t=this.stops)==null?void 0:t.map(e=>e.value||0)}};h([p({readOnly:!0})],Gr.prototype,"cache",null),h([p({type:$5.apiValues,json:{type:$5.jsonValues,origins:{"web-map":{read:!1}},read:$5.read,write:$5.write}})],Gr.prototype,"axis",void 0),h([p()],Gr.prototype,"index",null),h([p({type:String,readOnly:!0})],Gr.prototype,"inputValueType",null),h([p({type:aBt,json:{write:!0}})],Gr.prototype,"legendOptions",void 0),h([p({type:Number,value:null,json:{write:!0}})],Gr.prototype,"maxDataValue",null),h([p({type:Number,value:null,json:{write:!0}})],Gr.prototype,"maxSize",null),h([Kt("maxSize")],Gr.prototype,"castMaxSize",null),h([ze("maxSize")],Gr.prototype,"readMaxSize",null),h([p({type:Number,value:null,json:{write:!0}})],Gr.prototype,"minDataValue",null),h([p({type:Number,value:null,json:{write:!0}})],Gr.prototype,"minSize",null),h([Kt("minSize")],Gr.prototype,"castMinSize",null),h([ze("minSize")],Gr.prototype,"readMinSize",null),h([p({type:String,json:{write:!0}})],Gr.prototype,"normalizationField",void 0),h([p({readOnly:!0})],Gr.prototype,"arcadeRequired",null),h([p({type:String})],Gr.prototype,"scaleBy",void 0),h([p({type:[lV],value:null,json:{write:!0}})],Gr.prototype,"stops",null),h([p({type:["outline"],json:{write:!0}})],Gr.prototype,"target",void 0),h([p({type:String,readOnly:!0})],Gr.prototype,"transformationType",null),h([p({type:["size"],json:{type:["sizeInfo"]}})],Gr.prototype,"type",void 0),h([p({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],Gr.prototype,"useSymbolValue",void 0),h([p({type:String,json:{write:!0}})],Gr.prototype,"valueExpression",void 0),h([ze("valueExpression",["valueExpression","expression"])],Gr.prototype,"readValueExpression",null),h([We("web-scene","valueExpression")],Gr.prototype,"writeValueExpressionWebScene",null),h([p({type:["radius","diameter","area","width","distance"],json:{write:!0}})],Gr.prototype,"valueRepresentation",void 0),h([p({type:qee.apiValues,json:{write:qee.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],Gr.prototype,"valueUnit",void 0),h([ze("valueUnit")],Gr.prototype,"readValueUnit",null),Gr=Hee=h([I("esri.renderers.visualVariables.SizeVariable")],Gr);const cle=Gr,lBt={color:Rze,size:cle,opacity:$ze,rotation:Ize},cBt=new Ji({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),uBt=/^\[([^\]]+)\]$/i;let uV=class extends Ue{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),e=e&&e.filter(i=>!!i),e==null?void 0:e.length){for(const i of e)switch(i.type){case"color":this.colorVariables.push(i);break;case"opacity":this.opacityVariables.push(i);break;case"rotation":this.rotationVariables.push(i);break;case"size":this.sizeVariables.push(i)}this.sizeVariables.length&&this.sizeVariables.some(i=>!!i.target)&&e.sort((i,r)=>{let s=null;return s=i.target===r.target?0:i.target?1:-1,s});for(let i=0;i<e.length;i++)e[i].index=i;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,i,r){const{rotationExpression:s,rotationType:n}=i,o=s==null?void 0:s.match(uBt),a=o==null?void 0:o[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:n,field:a})),e)return e.map(l=>{const c=cBt.read(l.type),u=lBt[c];u||(se.getLogger(this).warn(`Unknown variable type: ${c}`),r!=null&&r.messages&&r.messages.push(new Jg("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:r})));const d=new u;return d.read(l,r),d})}writeVariables(e,i){const r=[];for(const s of e){const n=s.toJSON(i);n&&r.push(n)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};h([p()],uV.prototype,"visualVariables",null),uV=h([I("esri.renderers.visualVariables.VisualVariableFactory")],uV);const hBt=uV,dBt={base:mN,key:"type",typeMap:{opacity:$ze,color:Rze,rotation:Ize,size:cle}},mO=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new hBt}set visualVariables(i){this._vvFactory.visualVariables=i,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(i,r,s){return this._vvFactory.readVariables(i,r,s)}writeVisualVariables(i,r,s,n){r[s]=this._vvFactory.writeVariables(i,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const i of this.visualVariables)if(i.arcadeRequired)return!0;return!1}hasVisualVariables(i,r){return i?this.getVisualVariablesForType(i,r).length>0:this.getVisualVariablesForType("size",r).length>0||this.getVisualVariablesForType("color",r).length>0||this.getVisualVariablesForType("opacity",r).length>0||this.getVisualVariablesForType("rotation",r).length>0}getVisualVariablesForType(i,r){const s=this.visualVariables;return s?s.filter(n=>n.type===i&&(typeof r=="string"?n.target===r:r!==!1||!n.target)):[]}async collectVVRequiredFields(i,r){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&Fc(i,r,n.field),n.normalizationField&&Fc(i,r,n.normalizationField),n.valueExpression&&(pBt(n.valueExpression,i,r)||await Ql(i,r,n.valueExpression)))}};return h([p({types:[dBt],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),h([ze("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),h([We("visualVariables")],e.prototype,"writeVisualVariables",null),e=h([I("esri.renderers.mixins.VisualVariablesMixin")],e),e};function pBt(t,e,i){const r=rBt(t);return r!=null&&(Fc(e,i,r),!0)}const oH={types:tRe,json:{write:{writer:HB},origins:{"web-scene":{types:Yde,write:{writer:HB},read:{reader:VP({types:Yde})}}}}},ule=hie({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},oH),Lze={types:{base:_l,key:"type",typeMap:{"simple-fill":fS.typeMap["simple-fill"],"picture-fill":fS.typeMap["picture-fill"],"polygon-3d":fS.typeMap["polygon-3d"]}},json:{write:{writer:HB},origins:{"web-scene":{type:Kb,write:{writer:HB}}}}},hV={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t==null?void 0:t.toString()}}}};var Wee;let n1=Wee=class extends Se{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){var t;return new Wee({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:((t=this.symbol)==null?void 0:t.clone())??null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};h([p({type:String,json:{write:!0}})],n1.prototype,"description",void 0),h([p({type:String,json:{write:!0}})],n1.prototype,"label",void 0),h([p({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],n1.prototype,"minValue",void 0),h([p({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],n1.prototype,"maxValue",void 0),h([p(ule)],n1.prototype,"symbol",void 0),n1=Wee=h([I("esri.renderers.support.ClassBreakInfo")],n1);const fj=n1;var Zee;const Dze="log",dV="percent-of-total",pV="field",I5=new Ji({esriNormalizeByLog:Dze,esriNormalizeByPercentOfTotal:dV,esriNormalizeByField:pV}),fBt=Qs(fj);let So=Zee=class extends mO(D_){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,i){if(!Array.isArray(t))return;let r=e.minValue;return t.map(s=>{const n=new fj;return n.read(s,i),n.minValue==null&&(n.minValue=r),n.maxValue==null&&(n.maxValue=n.minValue),r=n.maxValue,n})}writeClassBreakInfos(t,e,i,r){const s=t.map(n=>n.write({},r));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),e[i]=s}castField(t){return t==null?t:typeof t=="function"?(se.getLogger(this).error(".field: field must be a string value"),null):uD(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,i=this.normalizationTotal!=null;return e||i?(t=e&&pV||i&&dV||null,e&&i&&se.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):t!==pV&&t!==dV||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,i){let r=null;r=typeof t=="number"?new fj({minValue:t,maxValue:e,symbol:iRe(i)}):fBt(ie(t)),this.classBreakInfos.push(r),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const s=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(s[0]===t&&s[1]===e){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(t,e){return this.valueExpression&&(e==null?void 0:e.arcade)==null&&se.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let i=e;this.valueExpression&&(e==null?void 0:e.arcade)==null&&(i={...i,arcade:await ry()});const r=this.getBreakIndex(t,i);return r!==-1?this.classBreakInfos[r]:null}getSymbol(t,e){if(this.valueExpression&&(e==null?void 0:e.arcade)==null)return void se.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(t,e);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&(e==null?void 0:e.arcade)==null){const s=await ry(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:s}}const r=this.getBreakIndex(t,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}getSymbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((r,s)=>r+s.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){var t,e;return new Zee({field:this.field,backgroundFillSymbol:(t=this.backgroundFillSymbol)==null?void 0:t.clone(),defaultLabel:this.defaultLabel,defaultSymbol:(e=this.defaultSymbol)==null?void 0:e.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:ie(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:ie(this.visualVariables),legendOptions:ie(this.legendOptions),authoringInfo:ie(this.authoringInfo)})}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(t,e)),Ql(t,e,this.valueExpression)];Fc(t,e,this.field),Fc(t,e,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:s,arcade:n,timeZone:o}=e??{},{valueExpression:a}=this;let l=this._compiledValueExpression.valueExpression===a?this._compiledValueExpression.compiledFunction:null;const c=n.arcadeUtils;if(!l){const d=c.createSyntaxTree(a);l=c.createFunction(d),this._compiledValueExpression.compiledFunction=l}this._compiledValueExpression.valueExpression=a;const u=c.executeFunction(l,c.createExecContext(t,c.getViewInfo({viewingMode:i,scale:r,spatialReference:s}),o));return this._getBreakIndexfromInfos(u)}_getBreakIndexForField(t){const e=this.field,i=t.attributes,r=this.normalizationType;let s=parseFloat(i[e]);if(r){const n=this.normalizationTotal,o=parseFloat(this.normalizationField?i[this.normalizationField]:void 0);if(r===Dze)s=Math.log(s)*Math.LOG10E;else if(r!==dV||n==null||isNaN(n)){if(r===pV&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=t&&(e?t<=r[1]:t<r[1]))return i}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let i=1;i<e;i++)if(t[i-1].maxValue!==t[i].minValue)return!1;return!0}};h([p(Lze)],So.prototype,"backgroundFillSymbol",void 0),h([p({type:[fj]})],So.prototype,"classBreakInfos",void 0),h([ze("classBreakInfos")],So.prototype,"readClassBreakInfos",null),h([We("classBreakInfos")],So.prototype,"writeClassBreakInfos",null),h([p({type:String,json:{write:!0}})],So.prototype,"defaultLabel",void 0),h([p(oH)],So.prototype,"defaultSymbol",void 0),h([p({type:String,json:{write:!0}})],So.prototype,"field",void 0),h([Kt("field")],So.prototype,"castField",null),h([p({type:Boolean})],So.prototype,"isMaxInclusive",void 0),h([p({type:vA,json:{write:!0}})],So.prototype,"legendOptions",void 0),h([p({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],So.prototype,"minValue",null),h([p({type:String,json:{write:!0}})],So.prototype,"normalizationField",void 0),h([p({type:Number,cast:t=>Id(t),json:{write:!0}})],So.prototype,"normalizationTotal",void 0),h([p({type:I5.apiValues,value:null,json:{type:I5.jsonValues,read:I5.read,write:I5.write}})],So.prototype,"normalizationType",null),h([Ot({classBreaks:"class-breaks"})],So.prototype,"type",void 0),h([p({type:String,json:{write:!0}})],So.prototype,"valueExpression",void 0),h([p({type:String,json:{write:!0}})],So.prototype,"valueExpressionTitle",void 0),So=Zee=h([I("esri.renderers.ClassBreaksRenderer")],So);const Nze=So;let aH=class{};function mBt(t){return t instanceof IP?t===aH.instance:(t==null?void 0:t.toString().toLowerCase())==="unknown"}function Ehi(t){return mBt(t)?aH.instance:t}aH.instance=new kh("Etc/UTC");function gBt(t){return"timeZone"in t}function yBt(t){return"timeZone"in t}function _Bt(t){return"dateFieldsTimeZone"in t}const vBt=new Map;let Fze=class fV{static fromJSON(e){return new fV(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new fV(e.fields??[],Ibe(e))}static fromLayerJSON(e){return new fV(e.fields??[],Ibe(e))}constructor(e=[],i){var s;this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=i?new Map(i):null;const r=[];for(const n of this.fields){const o=n==null?void 0:n.name,a=$be(o);if(o&&a){const l=PT(o);this._fieldsMap.set(o,n),this._fieldsMap.set(l,n),this._normalizedFieldsMap.set(a,n),r.push(`${l}:${n.type}:${(s=this._timeZoneByFieldName)==null?void 0:s.get(o)}`),_se(n)?(this.dateFields.push(n),this._dateFieldsSet.add(n)):DG(n)&&(this._numericFieldsSet.add(n),this.numericFields.push(n)),Bde(n)||jde(n)||(n.editable=n.editable==null||!!n.editable,n.nullable=n.nullable==null||!!n.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)Bde(e)||jde(e)||e.nullable||Rnt(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===(e==null?void 0:e.uid)}has(e){return this.get(e)!=null}get(e){if(!e)return;let i=this._fieldsMap.get(e);return i||(i=this._fieldsMap.get(PT(e))??this._normalizedFieldsMap.get($be(e)),i&&this._fieldsMap.set(e,i),i)}getTimeZone(e){const i=this.get(e&&typeof e!="string"?e.name:e);return i?this._timeZoneByFieldName?this._timeZoneByFieldName.get(i.name):i.type==="date"||i.type==="esriFieldTypeDate"?(se.getLogger("esri.layers.support.FieldsIndex").error(new G("getTimeZone:no-timezone-information",`no time zone information for field '${i.name}'`)),Yg):kze.has(i.type)?CS:null:null}getLuxonTimeZone(e){const i=this.getTimeZone(e);return i?i===CS?aH.instance:i===Yg?ll.utcInstance:cD(vBt,i,()=>kh.create(i)):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return aOe(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){var i;return((i=this.get(e))==null?void 0:i.name)??void 0}toJSON(){return{fields:this.fields.map(e=>JV(e)?e.toJSON():e),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}};function PT(t){return t.trim().toLowerCase()}function $be(t){var e;return((e=mnt(t))==null?void 0:e.toLowerCase())??""}const kze=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function Ibe(t){const e=new Map;if(!t.fields)return e;const i=t.datesInUnknownTimezone===!0,{timeInfo:r,editFieldsInfo:s}=t,n=(r?"startField"in r?r.startField:r.startTimeField:"")??"",o=(r?"endField"in r?r.endField:r.endTimeField:"")??"",a=_Bt(t)?t.dateFieldsTimeZone??null:t.dateFieldsTimeReference?Q5(t.dateFieldsTimeReference):null,l=s?gBt(s)?s.timeZone??a:s.dateFieldsTimeReference?Q5(s.dateFieldsTimeReference):a??Yg:null,c=r?yBt(r)?r.timeZone??a:r.timeReference?Q5(r.timeReference):a:null,u=new Map([[PT((s==null?void 0:s.creationDateField)??""),l],[PT((s==null?void 0:s.editDateField)??""),l],[PT(n),c],[PT(o),c]]);for(const{name:d,type:f}of t.fields)if(kze.has(f))e.set(d,CS);else if(f!=="date"&&f!=="esriFieldTypeDate")e.set(d,null);else if(i)e.set(d,CS);else{const m=u.get(PT(d??""))??a;e.set(d,m)}return e}const Lbe="esri.renderers.support.DictionaryLoader",bBt={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let Uze=class{constructor(e,i,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new KFe(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=e,this.config=i,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,i){var d;let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(i));try{r=await this._dictionaryPromise}catch(f){if(os(f))return this._dictionaryPromise=null,null}const s=(d=this._dictionaryVersion)==null?void 0:d.since(4,0),n={};if(this.fieldMap)for(const f of this._symbolFields){const m=yFe(this.fieldMap[f],this._fieldIndex);if(m){const g=e.attributes[m];n[f]=s?g:g!=null?""+e.attributes[m]:""}else n[f]=""}let o=null;try{o=r==null?void 0:r(n,i)}catch{return null}if(!o||typeof o!="string"||o==="invalid")return null;const a=o.split(";"),l=[],c=[];for(const f of a)if(f)if(f.includes("po:")){const m=f.substr(3).split("|");if(m.length===3){const g=m[0],y=m[1];let v=m[2];if(y==="DashTemplate")v=v.split(" ").map(b=>Number(b));else if(y==="Color"){const b=new Qe(v).toRgba();v=[b[0],b[1],b[2],255*b[3]]}else v=Number(v);c.push({primitiveName:g,propertyName:y,value:v,defaultValue:null})}}else if(f.includes("|")){for(const m of f.split("|"))if(this._itemNames.has(m)){l.push(m);break}}else this._itemNames.has(f)&&l.push(f);const u=e.geometry==null||!e.geometry.hasZ&&e.geometry.type==="point";return this._cimPartsToCIMSymbol(e,l,c,u,i)}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void se.getLogger(Lbe).error("no valid URL!");const i=yr(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:e!=null?e.signal:null}),[{data:r}]=await Promise.all([i,ry()]);if(!r)throw this._dictionaryPromise=null,new G("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:s,dictionary_version:n,expression:o,itemsNames:a}=r,l=o;let c=!1;n&&(this._dictionaryVersion=ZP.parse(n),c=this._dictionaryVersion.since(4,0)),this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(a),this._symbolFields=s.symbol;const u={};if(this.config){const m=this.config;for(const g in m)u[g]=m[g]}if(s.configuration)for(const m of s.configuration)u.hasOwnProperty(m.name)||(u[m.name]=m.value);const d=[];if(e!=null&&e.fields&&this.fieldMap)for(const m in this.fieldMap){const g=this.fieldMap[m],y=e.fields.filter(v=>v.name.toLowerCase()===(g==null?void 0:g.toLowerCase()));y.length>0&&d.push({...y[0],type:c?y[0].type:"esriFieldTypeString"})}d.length>0&&(this._fieldIndex=new Fze(d));const f=dnt(l,e!=null?e.spatialReference:null,d,u).then(m=>{const g={scale:0};return(y,v)=>{if(m==null)return null;const b=m.repurposeFeature({geometry:null,attributes:y});return g.scale=v!=null?v.scale??void 0:void 0,m.evaluate({$feature:b,$view:g},m.services)}}).catch(m=>(se.getLogger(Lbe).error("Creating dictionary expression failed:",m),null));return this._dictionaryPromise=f,f}async _cimPartsToCIMSymbol(e,i,r,s,n){const o=new Array(i.length);for(let c=0;c<i.length;c++)o[c]=this._getSymbolPart(i[c],n);let a=await Promise.all(o);const l=this.fieldMap;if(l){a=ie(a);for(const c of a)EM.applyDictionaryTextOverrides(c,e,l,this._fieldIndex,pK(c))}return new S_({data:wBt(a,r,s)})}async _getSymbolPart(e,i){const r=this._symbolCache.get(e);if(r)return r;if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(o=>o.data);const s=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,e),n=yr(s,{responseType:"json",query:{f:"json"},...i});this._ongoingRequests.set(e,n),n.finally(()=>this._ongoingRequests.delete(e));try{const o=await n;return this._symbolCache.put(e,o.data),o.data}catch(o){throw o}}};function wBt(t,e,i){if(!t||t.length===0)return null;const r={...t[0]};if(t.length>1){r.symbolLayers=[];for(const s of t){const n=s;r.symbolLayers.unshift(...n.symbolLayers)}}return i&&(r.callout=bBt),{type:"CIMSymbolReference",symbol:r,primitiveOverrides:e}}var Yee;let Zp=Yee=class extends mO(D_){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new Uze(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,i,r){r!=null&&r.origin||super.writeVisualVariables(t,e,i,r)}clone(){return new Yee({config:ie(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:ie(this.fieldMap),url:ie(this.url),visualVariables:ie(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await Ql(t,e,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];e.has(r)&&t.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};h([p({type:Uze})],Zp.prototype,"_loader",null),h([p({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],Zp.prototype,"config",void 0),h([p({type:Object,json:{write:!0}})],Zp.prototype,"fieldMap",void 0),h([p({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],Zp.prototype,"scaleExpression",void 0),h([We("scaleExpression")],Zp.prototype,"writeData",null),h([p({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],Zp.prototype,"scaleExpressionTitle",void 0),h([p({type:String,json:{write:!0}})],Zp.prototype,"url",void 0),h([We("visualVariables")],Zp.prototype,"writeVisualVariables",null),Zp=Yee=h([I("esri.renderers.DictionaryRenderer")],Zp);const xBt=Zp;var Xee;let m0=Xee=class extends Se{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(se.getLogger(this).error(".field: field must be a string value"),null):uD(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){var t;return new Xee({color:(t=this.color)==null?void 0:t.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};h([p({type:Qe,json:{type:[Number],write:!0}})],m0.prototype,"color",void 0),h([p({type:String,json:{write:!0}})],m0.prototype,"field",void 0),h([Kt("field")],m0.prototype,"castField",null),h([p({type:String,json:{write:!0}})],m0.prototype,"label",void 0),h([p({type:String,json:{write:!0}})],m0.prototype,"valueExpression",void 0),h([p({type:String,json:{write:!0}})],m0.prototype,"valueExpressionTitle",void 0),m0=Xee=h([I("esri.renderers.support.AttributeColorInfo")],m0);const Vze=m0;var Jee;let mV=Jee=class extends Se{constructor(){super(...arguments),this.unit=null}clone(){return new Jee({unit:this.unit})}};h([p({type:String,json:{write:!0}})],mV.prototype,"unit",void 0),mV=Jee=h([I("esri.renderers.support.DotDensityLegendOptions")],mV);const TBt=mV;var Qee;let ru=Qee=class extends mO(D_){constructor(t){super(t),this.attributes=null,this.backgroundColor=new Qe([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new Wh,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new E_({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){var t;return((t=this.attributes)==null?void 0:t.reduce((e,i)=>e+i.getAttributeHash(),""))??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new Qee({attributes:ie(this.attributes),backgroundColor:ie(this.backgroundColor),dotBlendingEnabled:ie(this.dotBlendingEnabled),dotShape:ie(this.dotShape),dotSize:ie(this.dotSize),dotValue:ie(this.dotValue),legendOptions:ie(this.legendOptions),outline:ie(this.outline),referenceScale:ie(this.referenceScale),seed:ie(this.seed),visualVariables:ie(this.visualVariables),authoringInfo:ie(this.authoringInfo)})}getControllerHash(){var e;return`${(e=this.attributes)==null?void 0:e.map(i=>i.field||i.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const i of this.attributes??[])i.valueExpression&&await Ql(t,e,i.valueExpression),i.field&&t.add(i.field)}};h([p({type:[Vze],json:{write:!0}})],ru.prototype,"attributes",void 0),h([p({type:Qe,json:{write:!0}})],ru.prototype,"backgroundColor",void 0),h([p({type:Boolean,json:{write:!0}})],ru.prototype,"dotBlendingEnabled",void 0),h([p({type:String,json:{write:!1}})],ru.prototype,"dotShape",void 0),h([p({type:Number,json:{write:!0}})],ru.prototype,"dotSize",void 0),h([p({type:TBt,json:{write:!0}})],ru.prototype,"legendOptions",void 0),h([p({type:Wh,json:{default:null,write:!0}})],ru.prototype,"outline",void 0),h([p({type:Number,json:{write:!0}})],ru.prototype,"dotValue",void 0),h([p({type:Number,json:{write:!0}})],ru.prototype,"referenceScale",void 0),h([p({type:Number,json:{write:!0}})],ru.prototype,"seed",void 0),h([Ot({dotDensity:"dot-density"})],ru.prototype,"type",void 0),ru=Qee=h([I("esri.renderers.DotDensityRenderer")],ru);const SBt=ru;let GC=class extends Jr(Se){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};h([p({type:String,json:{write:!0}})],GC.prototype,"minLabel",void 0),h([p({type:String,json:{write:!0}})],GC.prototype,"maxLabel",void 0),h([p({type:String,json:{write:!0}})],GC.prototype,"title",void 0),GC=h([I("esri.renderers.support.HeatmapLegendOptions")],GC);const hle=2.4;function EBt(t){return Uo(t*hle)}function CBt(t){return wn(t)/hle}function MBt(t,e,i,r){let{color:s,ratio:n}=e,{color:o,ratio:a}=i;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=Ne((r-n)/(a-n),0,1);gG(t,s.toArray(),o.toArray(),l)}function Ahi(t){const i=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),t.length<1)return i;let r=t[0],s=t[0],n=1;const o=ci();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<t.length;)r=s,s=t[n++];MBt(o,r,s,l),i.set(o,4*a)}return i}function Phi(t,e,i){const r=Math.sqrt(t**2+e**2)/i;return r>1?0:3/(Math.PI*i**2)*(1-r**2)**2}function Ohi(t){return typeof t=="function"?t:t?e=>+e[t]:()=>1}var Kee;function Dbe(t){if(t!=null){const{maxDensity:e,minDensity:i,radius:r}=t;if(e!=null||i!=null||r!=null){const{blurRadius:s,maxPixelIntensity:n,minPixelIntensity:o,...a}=t;return a}}return t}let ba=Kee=class extends D_{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new L3({ratio:0,color:new Qe("rgba(255, 140, 0, 0)")}),new L3({ratio:.75,color:new Qe("rgba(255, 140, 0, 1)")}),new L3({ratio:.9,color:new Qe("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(t){return Dbe(t)}get blurRadius(){return CBt(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",EBt(t)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(hle**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(t,e){this._warnedProps[t]||hl(this).getDefaultOrigin()==="user"&&(this._warnedProps[t]=!0,p2(()=>{DR(se.getLogger(this),t,{replacement:`${String(e)} (suggested value: ${this._get(e)})`,version:"4.24"})}))}read(t,e){t=Dbe(t),super.read(t,e)}getSymbol(){return new py}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const i=this.field,r=this.valueExpression;i&&typeof i=="string"&&Fc(t,e,i),r&&typeof r=="string"&&await Ql(t,e,r)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new Kee({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:ie(this.colorStops),field:this.field,legendOptions:ie(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};h([p({type:lle,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],ba.prototype,"authoringInfo",void 0),h([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ba.prototype,"blurRadius",null),h([p({type:[L3],json:{write:!0}})],ba.prototype,"colorStops",void 0),h([p({type:String,json:{write:!0}})],ba.prototype,"field",void 0),h([p({type:GC,json:{write:!0}})],ba.prototype,"legendOptions",void 0),h([p({type:Number,json:{write:!0}})],ba.prototype,"maxDensity",void 0),h([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ba.prototype,"maxPixelIntensity",null),h([p({type:Number,json:{write:!0}})],ba.prototype,"minDensity",void 0),h([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ba.prototype,"minPixelIntensity",null),h([p({type:Number,cast:vr,json:{write:!0}})],ba.prototype,"radius",void 0),h([p({type:Number,range:{min:0},json:{default:0,write:!0}})],ba.prototype,"referenceScale",void 0),h([Ot({heatmap:"heatmap"})],ba.prototype,"type",void 0),h([p({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],ba.prototype,"valueExpression",void 0),h([p({type:String})],ba.prototype,"valueExpressionTitle",void 0),h([p({readOnly:!0})],ba.prototype,"_pixelIntensityToDensity",null),ba=Kee=h([I("esri.renderers.HeatmapRenderer")],ba);const zze=ba;let OT=class extends Jr(Se){constructor(){super(...arguments),this.color=new Qe([0,0,0,0]),this.label=null,this.threshold=0}};h([p({type:Qe,json:{write:!0}})],OT.prototype,"color",void 0),h([p({type:String,json:{write:!0}})],OT.prototype,"label",void 0),h([p({type:Number,range:{min:0,max:1},json:{write:!0}})],OT.prototype,"threshold",void 0),OT=h([I("esri.renderers.support.OthersCategory")],OT);let gV=class extends Jr(Se){constructor(){super(...arguments),this.title=null}};h([p({type:String,json:{write:!0}})],gV.prototype,"title",void 0),gV=h([I("esri.renderers.support.PieChartLegendOptions")],gV);let sh=class extends mO(Jr(D_)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new Qe([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new OT,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new py({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(op)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,i)=>e+i.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,i)=>e+JSON.stringify(i),"")}async collectRequiredFields(e,i){await this.collectVVRequiredFields(e,i);for(const r of this.attributes)r.valueExpression&&await Ql(e,i,r.valueExpression),r.field&&e.add(r.field)}};h([p({type:[Vze],json:{write:!0}})],sh.prototype,"attributes",void 0),h([p({type:E_,json:{default:null,write:!0}})],sh.prototype,"backgroundFillSymbol",void 0),h([p({type:Qe,json:{write:!0}})],sh.prototype,"defaultColor",void 0),h([p({type:String,json:{write:!0}})],sh.prototype,"defaultLabel",void 0),h([p({type:Number,range:{min:0,max:1},json:{write:!0}})],sh.prototype,"holePercentage",void 0),h([p({type:OT,json:{write:!0}})],sh.prototype,"othersCategory",void 0),h([p({type:gV,json:{write:!0}})],sh.prototype,"legendOptions",void 0),h([p({type:Wh,json:{default:null,write:!0}})],sh.prototype,"outline",void 0),h([p({type:Number,cast:vr,json:{write:!0}})],sh.prototype,"size",void 0),h([Ot({pieChart:"pie-chart"})],sh.prototype,"type",void 0),sh=h([I("esri.renderers.PieChartRenderer")],sh);const ABt=sh;var ete;let nT=ete=class extends mO(D_){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(i=>i.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new ete({description:this.description,label:this.label,symbol:ie(this.symbol),visualVariables:ie(this.visualVariables),authoringInfo:ie(this.authoringInfo)})}};h([p({type:String,json:{write:!0}})],nT.prototype,"description",void 0),h([p({type:String,json:{write:!0}})],nT.prototype,"label",void 0),h([p(ule)],nT.prototype,"symbol",void 0),h([Ot({simple:"simple"})],nT.prototype,"type",void 0),nT=ete=h([I("esri.renderers.SimpleRenderer")],nT);const gO=nT,PBt=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function tte(t){return t instanceof Ue}function Nbe(t){return t instanceof st?Object.keys(t.items):tte(t)?hl(t).keys():t?Object.keys(t):[]}function L5(t,e){return t instanceof st?t.items[e]:t[e]}function OBt(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function N3(t){return t?t.declaredClass:null}function Bze(t,e){var d;const i=t.diff;if(i&&typeof i=="function")return i(t,e);const r=Nbe(t),s=Nbe(e);if(r.length===0&&s.length===0)return;if(!r.length||!s.length||OBt(t,e))return{type:"complete",oldValue:t,newValue:e};const n=s.filter(f=>!r.includes(f)),o=r.filter(f=>!s.includes(f)),a=r.filter(f=>s.includes(f)&&L5(t,f)!==L5(e,f)).concat(n,o).sort(),l=N3(t);if(l&&PBt.has(l)&&a.length)return{type:"complete",oldValue:t,newValue:e};let c;const u=tte(t)&&tte(e);for(const f of a){const m=L5(t,f),g=L5(e,f);let y;if((u||typeof m!="function"&&typeof g!="function")&&m!==g&&(m!=null||g!=null)){if(i&&i[f]&&typeof i[f]=="function")y=(d=i[f])==null?void 0:d.call(i,m,g);else if(m instanceof Date&&g instanceof Date){if(m.getTime()===g.getTime())continue;y={type:"complete",oldValue:m,newValue:g}}else y=typeof m=="object"&&typeof g=="object"&&N3(m)===N3(g)?Bze(m,g):{type:"complete",oldValue:m,newValue:g};y!=null&&(c!=null?c.diff[f]=y:c={type:"partial",diff:{[f]:y}})}}return c}function Lhi(t,e){return RBt(t,e)}function RBt(t,e){if(t==null)return!1;const i=e.split(".");let r=t;for(const s of i){if(r.type==="complete")return!0;if(r.type!=="partial")return!1;{const n=r.diff[s];if(!n)return!1;r=n}}return!0}function Dhi(t,e){if(!t)return!1;if(t.type==="partial"){const i=Object.keys(t.diff);return i.length===1&&i[0]===e}return!1}function $Bt(t,e){if(typeof t!="function"&&typeof e!="function"&&(t!=null||e!=null))return t==null||e==null||typeof t=="object"&&typeof e=="object"&&N3(t)!==N3(e)?{type:"complete",oldValue:t,newValue:e}:Bze(t,e)}function D5(t){if(t==null)return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const i of e.added)if(!D5(i))return!1;for(const i of e.removed)if(!D5(i))return!1;for(const i of e.changed)if(!D5(i))return!1;return!0}case"partial":for(const e in t.diff)if(!D5(t.diff[e]))return!1;return!0}}let HC=class extends Jr(Se){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};h([p(hV)],HC.prototype,"value",void 0),h([p(hV)],HC.prototype,"value2",void 0),h([p(hV)],HC.prototype,"value3",void 0),HC=h([I("esri.renderers.support.UniqueValue")],HC);const bA=HC;let o1=class extends Jr(Se){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const i=typeof(e=Array.isArray(e)?e:[e])[0];return i==="string"||i==="number"?e.map(r=>new bA({value:r})):i==="object"?e[0]instanceof bA?e:e.map(r=>new bA(r)):null}};h([p({type:String,json:{write:!0}})],o1.prototype,"description",void 0),h([p({type:String,json:{write:!0}})],o1.prototype,"label",void 0),h([p(oH)],o1.prototype,"symbol",void 0),h([p({type:[bA],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new bA({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const i=[];for(const r of t){const s=[r.value,r.value2,r.value3].filter(op).map(n=>n.toString());i.push(s)}e.values=i}}}})],o1.prototype,"values",void 0),h([Kt("values")],o1.prototype,"castValues",null),o1=h([I("esri.renderers.support.UniqueValueClass")],o1);const jze=o1;let OI=class extends Jr(Se){constructor(e){super(e),this.heading=null,this.classes=null}};h([p({type:String,json:{write:!0}})],OI.prototype,"heading",void 0),h([p({type:[jze],json:{write:!0}})],OI.prototype,"classes",void 0),OI=h([I("esri.renderers.support.UniqueValueGroup")],OI);const ite=OI;var rte;let oT=rte=class extends Se{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new rte({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){var e;const t=JSON.stringify((e=this.symbol)==null?void 0:e.toJSON());return`${this.value}.${t}`}};h([p({type:String,json:{write:!0}})],oT.prototype,"description",void 0),h([p({type:String,json:{write:!0}})],oT.prototype,"label",void 0),h([p(ule)],oT.prototype,"symbol",void 0),h([p(hV)],oT.prototype,"value",void 0),oT=rte=h([I("esri.renderers.support.UniqueValueInfo")],oT);const F3=oT;var RI;const Gze="esri.renderers.UniqueValueRenderer",Sv=()=>se.getLogger(Gze),Fbe="uvInfos-watcher",kbe="uvGroups-watcher",IBt=",",LBt=Qs(F3);function DBt(t){const{field1:e,field2:i,field3:r,fieldDelimiter:s,uniqueValueInfos:n,valueExpression:o}=t,a=!(!e||!i);return[{classes:(n??[]).map(l=>{var b;const{symbol:c,label:u,value:d,description:f}=l,[m,g,y]=a?((b=d==null?void 0:d.toString())==null?void 0:b.split(s||""))||[]:[d],v=[];return(e||o)&&v.push(m),i&&v.push(g),r&&v.push(y),{symbol:c,label:u,values:[v],description:f}})}]}let nn=RI=class extends mO(D_){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,i){if(!e&&!i)return;if(!e||!i)return{type:"complete",oldValue:e,newValue:i};let r=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<i.length;n++){const o=e.find(a=>a.value===i[n].value);o?$Bt(o,i[n])?(s.changed.push({type:"complete",oldValue:o,newValue:i[n]}),r=!0):s.unchanged.push({oldValue:o,newValue:i[n]}):(s.added.push(i[n]),r=!0)}for(let n=0;n<e.length;n++)i.find(o=>o.value===e[n].value)||(s.removed.push(e[n]),r=!0);return r?s:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:uD(t)}writeField(t,e,i,r){typeof t=="string"?e[i]=t:r!=null&&r.messages?r.messages.push(new G("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):Sv().error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,i){return i.portal||Wn.getDefault()}readStyleOrigin(t,e,i){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const r=yb(e.styleUrl,i);return Object.freeze({styleUrl:r})}}writeStyleOrigin(t,e,i,r){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=kS(t.styleUrl,r))}set uniqueValueGroups(t){this.styleOrigin?Sv().error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?Sv().error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){var r;if(this.styleOrigin)return void Sv().error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof t=="object"?LBt(t):new F3({value:t,symbol:iRe(e)}),(r=this.uniqueValueInfos)==null||r.push(i),this._valueInfoMap[i.value]=i,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void Sv().error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e)for(let i=0;i<e.length;i++){const r=e[i];if(String(r.value)===String(t)){delete this._valueInfoMap[t],e.splice(i,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let i=e;return this.valueExpression&&(e==null?void 0:e.arcade)==null&&(i={...i,arcade:await ry()}),this._getUniqueValueInfo(t,i)}getSymbol(t,e){if(this.valueExpression&&(e==null?void 0:e.arcade)==null)return void Sv().error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this._getUniqueValueInfo(t,e);return(i==null?void 0:i.symbol)||this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&(i==null?void 0:i.arcade)==null){const s=await ry(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:s}}const r=this._getUniqueValueInfo(t,i);return(r==null?void 0:r.symbol)||this.defaultSymbol}getSymbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){var r;const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=(r=this.uniqueValueInfos)==null?void 0:r.reduce((s,n)=>s+n.getMeshHash(),"");return`${t}.${e}.${i}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new RI({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:ie(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:ie(this.visualVariables),legendOptions:ie(this.legendOptions),authoringInfo:ie(this.authoringInfo),backgroundFillSymbol:ie(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=ie(this.uniqueValueInfos),i=ie(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(ie(this.styleOrigin))),Object.freeze(e),Object.freeze(i)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",i),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(t,e)),Ql(t,e,this.valueExpression)];Fc(t,e,this.field),Fc(t,e,this.field2),Fc(t,e,this.field3),await Promise.all(i)}populateFromStyle(){return Qoe(this.styleOrigin,{portal:this.portal}).then(t=>{var i;const e=[];return this._valueInfoMap={},t!=null&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach(r=>{const s=new P2({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:r.name});this.defaultSymbol||r.name!==t.data.defaultItem||(this.defaultSymbol=s,this._isDefaultSymbolDerived=!0);const n=new F3({value:r.name,symbol:s});e.push(n),this._valueInfoMap[r.name]=n}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&((i=this.uniqueValueInfos)!=null&&i.length)&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",IBt)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[e.value+""]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(Fbe);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const i of t)e.push(te(()=>({symbol:i.symbol,value:i.value,label:i.label,description:i.description}),(r,s)=>{r!==s&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,Fbe)}}_watchUniqueValueGroups(){this.removeHandles(kbe);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const i of t){e.push(te(()=>({classes:i.classes}),(r,s)=>{r!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const r of i.classes??[])e.push(te(()=>({symbol:r.symbol,values:r.values,label:r.label,description:r.description}),(s,n)=>{s!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,kbe)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:i,field3:r,fieldDelimiter:s,uniqueValueGroups:n,valueExpression:o}=this;if(!e&&!o)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!e||!i);for(const l of n)for(const c of l.classes??[]){const{symbol:u,label:d,values:f,description:m}=c;for(const g of f??[]){const{value:y,value2:v,value3:b}=g,w=[y];i&&w.push(v),r&&w.push(b);const x=a?w.join(s||""):w[0]??void 0;t.push(new F3({symbol:u,label:d,value:x,description:m}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:i,valueExpression:r,fieldDelimiter:s,uniqueValueInfos:n}=this;if(!e&&!r||!n.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!e||!i),a=n.map(c=>{var b;const{symbol:u,label:d,value:f,description:m}=c,[g,y,v]=o?((b=f==null?void 0:f.toString())==null?void 0:b.split(s||""))||[]:[f];return new jze({symbol:u,label:d,description:m,values:[new bA({value:g,value2:y,value3:v})]})}),l=[new ite({classes:a})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:s,arcade:n,timeZone:o}=e??{};let a=this._cache.compiledFunc;const l=n.arcadeUtils;if(!a){const u=l.createSyntaxTree(this.valueExpression);a=l.createFunction(u),this._cache.compiledFunc=a}const c=l.executeFunction(a,l.createExecContext(t,l.getViewInfo({viewingMode:i,scale:r,spatialReference:s}),o));return this._valueInfoMap[c+""]}_getUnqiueValueInfoForFields(t){const e=this.field,i=t.attributes;let r;if(this.field2){const s=this.field2,n=this.field3,o=[];e&&o.push(i[e]),s&&o.push(i[s]),n&&o.push(i[n]),r=o.join(this.fieldDelimiter||"")}else e&&(r=i[e]);return this._valueInfoMap[r+""]}static fromPortalStyle(t,e){const i=new RI(e==null?void 0:e.properties);i._set("styleOrigin",Object.freeze({styleName:t})),i._set("portal",(e==null?void 0:e.portal)||Wn.getDefault());const r=i.populateFromStyle();return r.catch(s=>{Sv().error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",s)}),r}static fromStyleUrl(t,e){const i=new RI(e==null?void 0:e.properties);i._set("styleOrigin",Object.freeze({styleUrl:t}));const r=i.populateFromStyle();return r.catch(s=>{Sv().error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),r}};h([p({readOnly:!0})],nn.prototype,"_cache",null),h([Ot({uniqueValue:"unique-value"})],nn.prototype,"type",void 0),h([p(Lze)],nn.prototype,"backgroundFillSymbol",void 0),h([p({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],nn.prototype,"field",null),h([Kt("field")],nn.prototype,"castField",null),h([We("field")],nn.prototype,"writeField",null),h([p({type:String,value:null,json:{write:!0}})],nn.prototype,"field2",null),h([p({type:String,value:null,json:{write:!0}})],nn.prototype,"field3",null),h([p({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],nn.prototype,"orderByClassesEnabled",void 0),h([p({type:String,value:null,json:{write:!0}})],nn.prototype,"valueExpression",null),h([p({type:String,json:{write:!0}})],nn.prototype,"valueExpressionTitle",void 0),h([p({type:vA,json:{write:!0}})],nn.prototype,"legendOptions",void 0),h([p({type:String,json:{write:!0}})],nn.prototype,"defaultLabel",void 0),h([p(hie({...oH},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],nn.prototype,"defaultSymbol",null),h([p({type:String,value:null,json:{write:!0}})],nn.prototype,"fieldDelimiter",null),h([p({type:Wn,readOnly:!0})],nn.prototype,"portal",void 0),h([ze("portal",["styleName"])],nn.prototype,"readPortal",null),h([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],nn.prototype,"styleOrigin",void 0),h([ze("styleOrigin",["styleName","styleUrl"])],nn.prototype,"readStyleOrigin",null),h([We("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],nn.prototype,"writeStyleOrigin",null),h([p({type:[ite],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,i)=>(e.uniqueValueGroups||DBt(e)).map(r=>ite.fromJSON(r,i))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],nn.prototype,"uniqueValueGroups",null),h([p({type:[F3],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],nn.prototype,"uniqueValueInfos",null),nn=RI=h([I(Gze)],nn);const dle=nn,lH={key:"type",base:D_,typeMap:{heatmap:zze,simple:gO,"unique-value":dle,"class-breaks":Nze,"dot-density":SBt,dictionary:xBt,"pie-chart":ABt},errorContext:"renderer"},NBt={key:"type",base:D_,typeMap:{simple:gO,"unique-value":dle,"class-breaks":Nze,heatmap:zze},errorContext:"renderer",validate:FBt};function FBt(t){switch(t.type){case"simple":return kBt(t);case"unique-value":return UBt(t);case"class-breaks":return VBt(t);case"heatmap":return t}}function kBt(t){if(t.symbol)return t;se.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}function UBt(t){const e=t.uniqueValueInfos,i=e==null?void 0:e.filter(({symbol:r,label:s},n)=>(r||se.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${n}] ${s}) without a symbol from web scene.`),!!r));return(i==null?void 0:i.length)!==(e==null?void 0:e.length)&&(t.uniqueValueInfos=i),t}function VBt(t){const e=t.classBreakInfos,i=e==null?void 0:e.filter(({symbol:r,label:s},n)=>(r||se.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${n}] ${s}) without a symbol from web scene.`),!!r));return(i==null?void 0:i.length)!==(e==null?void 0:e.length)&&(t.classBreakInfos=i),t}function Uhi(t,e){return JL(t,null,e)}const zBt=VP({types:lH});function JL(t,e,i){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(i!=null&&i.messages&&i.messages.push(new Jg("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:i})),null):zBt(t,e,i):null}const Ia=(t=>t)(["operational-layers","basemap","ground"]);var ste;let aT=ste=class extends Se{constructor(t){super(t),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new ste({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};h([p({type:String,json:{write:!0}})],aT.prototype,"expression",void 0),h([p({type:String,json:{write:!0}})],aT.prototype,"name",void 0),h([p({type:["boolean","date","number","string"],json:{write:!0}})],aT.prototype,"returnType",void 0),h([p({type:String,json:{write:!0}})],aT.prototype,"title",void 0),aT=ste=h([I("esri.form.ExpressionInfo")],aT);const BBt=aT;let lT=class extends Se{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};h([p({type:String,json:{write:!0}})],lT.prototype,"description",void 0),h([p({type:String,json:{write:!0}})],lT.prototype,"label",void 0),h([p()],lT.prototype,"type",void 0),h([p({type:String,json:{write:!0}})],lT.prototype,"visibilityExpression",void 0),lT=h([I("esri.form.elements.Element")],lT);const a2=lT;var nte;let yV=nte=class extends Se{constructor(t){super(t),this.type=null}clone(){return new nte({type:this.type})}};h([p({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],yV.prototype,"type",void 0),yV=nte=h([I("esri.form.elements.inputs.AttachmentInput")],yV);const jBt=yV;var ote;let cT=ote=class extends a2{constructor(t){super(t),this.attachmentKeyword=null,this.editableExpression=null,this.input=null,this.type="attachment"}clone(){return new ote({attachmentKeyword:this.attachmentKeyword,description:this.description,editableExpression:this.editableExpression,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};h([p({type:String,json:{write:!0}})],cT.prototype,"attachmentKeyword",void 0),h([p({type:String,json:{write:!0}})],cT.prototype,"editableExpression",void 0),h([p({type:jBt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],cT.prototype,"input",void 0),h([p({type:["attachment"],json:{read:!1,write:!0}})],cT.prototype,"type",void 0),cT=ote=h([I("esri.form.elements.AttachmentElement")],cT);const Ube=cT;let _V=class extends Se{constructor(e){super(e),this.type=null}};h([p()],_V.prototype,"type",void 0),_V=h([I("esri.form.elements.inputs.Input")],_V);const N_=_V;let $I=class extends N_{constructor(e){super(e),this.maxLength=null,this.minLength=0}};h([p({type:Number,json:{write:!0}})],$I.prototype,"maxLength",void 0),h([p({type:Number,json:{write:!0}})],$I.prototype,"minLength",void 0),$I=h([I("esri.form.elements.inputs.TextInput")],$I);const ple=$I;var ate;let vV=ate=class extends ple{constructor(t){super(t),this.type="barcode-scanner"}clone(){return new ate({maxLength:this.maxLength,minLength:this.minLength})}};h([p({type:["barcode-scanner"],json:{read:!1,write:!0}})],vV.prototype,"type",void 0),vV=ate=h([I("esri.form.elements.inputs.BarcodeScannerInput")],vV);const GBt=vV;var lte;let qC=lte=class extends N_{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new lte({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};h([p({type:String,json:{write:!0}})],qC.prototype,"noValueOptionLabel",void 0),h([p({type:Boolean,json:{write:!0}})],qC.prototype,"showNoValueOption",void 0),h([p({type:["combo-box"],json:{read:!1,write:!0}})],qC.prototype,"type",void 0),qC=lte=h([I("esri.form.elements.inputs.ComboBoxInput")],qC);const HBt=qC;var cte;function Vbe(t){return t??null}function zbe(t){return t??null}let eg=cte=class extends N_{constructor(t){super(t),this.max=null,this.min=null,this.type="date-picker"}readMax(t,e){return Vbe(e.max)}writeMax(t,e){e.max=zbe(t)}readMin(t,e){return Vbe(e.min)}writeMin(t,e){e.min=zbe(t)}clone(){return new cte({max:this.max,min:this.min})}};h([p({type:String,json:{type:String,write:!0}})],eg.prototype,"max",void 0),h([ze("max")],eg.prototype,"readMax",null),h([We("max")],eg.prototype,"writeMax",null),h([p({type:String,json:{type:String,write:!0}})],eg.prototype,"min",void 0),h([ze("min")],eg.prototype,"readMin",null),h([We("min")],eg.prototype,"writeMin",null),h([p({type:["date-picker"],json:{read:!1,write:!0}})],eg.prototype,"type",void 0),eg=cte=h([I("esri.form.elements.inputs.DatePickerInput")],eg);const qBt=eg;var ute;function G7(t){return t??null}function H7(t){return t??null}let su=ute=class extends N_{constructor(t){super(t),this.includeTimeOffset=!0,this.max=null,this.min=null,this.timeResolution="minutes",this.type="datetimeoffset-picker"}readMax(t,e){return G7(e.max)}writeMax(t,e){e.max=H7(t)}readMin(t,e){return G7(e.min)}writeMin(t,e){e.min=H7(t)}readTimeResolution(t,e){return G7(e.timeResolution)}writeTimeResolution(t,e){e.timeResolution=H7(t)}clone(){return new ute({includeTimeOffset:this.includeTimeOffset,max:this.max,min:this.min,timeResolution:this.timeResolution})}};h([p({type:Boolean,json:{write:!0}})],su.prototype,"includeTimeOffset",void 0),h([p({type:String,json:{type:String,write:!0}})],su.prototype,"max",void 0),h([ze("max")],su.prototype,"readMax",null),h([We("max")],su.prototype,"writeMax",null),h([p({type:String,json:{type:String,write:!0}})],su.prototype,"min",void 0),h([ze("min")],su.prototype,"readMin",null),h([We("min")],su.prototype,"writeMin",null),h([p({type:String,json:{type:String,write:!0}})],su.prototype,"timeResolution",void 0),h([ze("timeResolution")],su.prototype,"readTimeResolution",null),h([We("timeResolution")],su.prototype,"writeTimeResolution",null),h([p({type:["datetimeoffset-picker"],json:{read:!1,write:!0}})],su.prototype,"type",void 0),su=ute=h([I("esri.form.elements.inputs.DateTimeOffsetPickerInput")],su);const WBt=su;var hte;function Bbe(t){return t!=null?new Date(t):null}function jbe(t){return t?t.getTime():null}let Yp=hte=class extends N_{constructor(t){super(t),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(t,e){return Bbe(e.max)}writeMax(t,e){e.max=jbe(t)}readMin(t,e){return Bbe(e.min)}writeMin(t,e){e.min=jbe(t)}clone(){return new hte({includeTime:this.includeTime,max:this.max,min:this.min})}};h([p({type:Boolean,json:{write:!0}})],Yp.prototype,"includeTime",void 0),h([p({type:Date,json:{type:Number,write:!0}})],Yp.prototype,"max",void 0),h([ze("max")],Yp.prototype,"readMax",null),h([We("max")],Yp.prototype,"writeMax",null),h([p({type:Date,json:{type:Number,write:!0}})],Yp.prototype,"min",void 0),h([ze("min")],Yp.prototype,"readMin",null),h([We("min")],Yp.prototype,"writeMin",null),h([p({type:["datetime-picker"],json:{read:!1,write:!0}})],Yp.prototype,"type",void 0),Yp=hte=h([I("esri.form.elements.inputs.DateTimePickerInput")],Yp);const ZBt=Yp;var dte;let WC=dte=class extends N_{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new dte({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};h([p({type:String,json:{write:!0}})],WC.prototype,"noValueOptionLabel",void 0),h([p({type:Boolean,json:{write:!0}})],WC.prototype,"showNoValueOption",void 0),h([p({type:["radio-buttons"],json:{read:!1,write:!0}})],WC.prototype,"type",void 0),WC=dte=h([I("esri.form.elements.inputs.RadioButtonsInput")],WC);const YBt=WC;var pte;let ZC=pte=class extends N_{constructor(t){super(t),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new pte({offValue:this.offValue,onValue:this.onValue})}};h([p({type:[String,Number],json:{write:!0}})],ZC.prototype,"offValue",void 0),h([p({type:[String,Number],json:{write:!0}})],ZC.prototype,"onValue",void 0),h([p({type:["switch"],json:{read:!1,write:!0}})],ZC.prototype,"type",void 0),ZC=pte=h([I("esri.form.elements.inputs.SwitchInput")],ZC);const XBt=ZC;var fte;let bV=fte=class extends ple{constructor(t){super(t),this.type="text-area"}clone(){return new fte({maxLength:this.maxLength,minLength:this.minLength})}};h([p({type:["text-area"],json:{read:!1,write:!0}})],bV.prototype,"type",void 0),bV=fte=h([I("esri.form.elements.inputs.TextAreaInput")],bV);const JBt=bV;var mte;let wV=mte=class extends ple{constructor(t){super(t),this.type="text-box"}clone(){return new mte({maxLength:this.maxLength,minLength:this.minLength})}};h([p({type:["text-box"],json:{read:!1,write:!0}})],wV.prototype,"type",void 0),wV=mte=h([I("esri.form.elements.inputs.TextBoxInput")],wV);const QBt=wV;var gte;function q7(t){return t??null}function W7(t){return t??null}let nh=gte=class extends N_{constructor(t){super(t),this.max=null,this.min=null,this.timeResolution="minutes",this.type="time-picker"}readMax(t,e){return q7(e.max)}writeMax(t,e){e.max=W7(t)}readMin(t,e){return q7(e.min)}writeMin(t,e){e.min=W7(t)}readTimeResolution(t,e){return q7(e.timeResolution)}writeTimeResolution(t,e){e.timeResolution=W7(t)}clone(){return new gte({max:this.max,min:this.min,timeResolution:this.timeResolution})}};h([p({type:String,json:{type:String,write:!0}})],nh.prototype,"max",void 0),h([ze("max")],nh.prototype,"readMax",null),h([We("max")],nh.prototype,"writeMax",null),h([p({type:String,json:{type:String,write:!0}})],nh.prototype,"min",void 0),h([ze("min")],nh.prototype,"readMin",null),h([We("min")],nh.prototype,"writeMin",null),h([p({type:String,json:{type:String,write:!0}})],nh.prototype,"timeResolution",void 0),h([ze("timeResolution")],nh.prototype,"readTimeResolution",null),h([We("timeResolution")],nh.prototype,"writeTimeResolution",null),h([p({type:["time-picker"],json:{read:!1,write:!0}})],nh.prototype,"type",void 0),nh=gte=h([I("esri.form.elements.inputs.TimePickerInput")],nh);const KBt=nh,ejt={base:N_,key:"type",typeMap:{"barcode-scanner":GBt,"combo-box":HBt,"date-picker":qBt,"datetime-picker":ZBt,"datetimeoffset-picker":WBt,"radio-buttons":YBt,switch:XBt,"text-area":JBt,"text-box":QBt,"time-picker":KBt}};var yte;let wd=yte=class extends a2{constructor(t){super(t),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){return this._get("editable")??!0}set editable(t){this._set("editable",t)}clone(){return new yte({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};h([p({types:aRe,json:{read:{reader:jG},write:!0}})],wd.prototype,"domain",void 0),h([p({type:Boolean,json:{write:!0}})],wd.prototype,"editable",null),h([p({type:String,json:{write:!0}})],wd.prototype,"editableExpression",void 0),h([p({type:String,json:{write:!0}})],wd.prototype,"fieldName",void 0),h([p({type:String,json:{write:!0}})],wd.prototype,"hint",void 0),h([p({types:ejt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],wd.prototype,"input",void 0),h([p({type:String,json:{write:!0}})],wd.prototype,"requiredExpression",void 0),h([p({type:String,json:{read:!1,write:!0}})],wd.prototype,"type",void 0),h([p({type:String,json:{write:!0}})],wd.prototype,"valueExpression",void 0),wd=yte=h([I("esri.form.elements.FieldElement")],wd);const Gbe=wd;var _te;let g0=_te=class extends a2{constructor(t){super(t),this.displayCount=null,this.displayType="list",this.editableExpression=null,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new _te({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editableExpression:this.editableExpression,label:this.label,orderByFields:ie(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};h([p({type:Number,json:{write:!0}})],g0.prototype,"displayCount",void 0),h([p({type:["list"],json:{write:!0}})],g0.prototype,"displayType",void 0),h([p({type:String,json:{write:!0}})],g0.prototype,"editableExpression",void 0),h([p({type:[wse],json:{write:!0}})],g0.prototype,"orderByFields",void 0),h([p({type:Number,json:{write:!0}})],g0.prototype,"relationshipId",void 0),h([p({type:["relationship"],json:{read:!1,write:!0}})],g0.prototype,"type",void 0),g0=_te=h([I("esri.form.elements.RelationshipElement")],g0);const Hbe=g0;var vte;let YC=vte=class extends a2{constructor(t){super(t),this.text=null,this.textFormat="plain-text",this.type="text"}clone(){return new vte({text:this.text,textFormat:this.textFormat,visibilityExpression:this.visibilityExpression})}};h([p({type:String,json:{write:!0}})],YC.prototype,"text",void 0),h([p({type:String,json:{write:!0}})],YC.prototype,"textFormat",void 0),h([p({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],YC.prototype,"type",void 0),YC=vte=h([I("esri.form.elements.TextElement")],YC);const qbe=YC;function Hze(t){return{typesWithGroup:{base:a2,key:"type",typeMap:{attachment:Ube,field:Gbe,group:t,relationship:Hbe,text:qbe}},typesWithoutGroup:{base:a2,key:"type",typeMap:{attachment:Ube,field:Gbe,relationship:Hbe,text:qbe}}}}function qze(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function Wze(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>r[s.type]).map(s=>s.toJSON())}function Zze(t,e,i=!0){return t?t.map(r=>Gf(i?e.typesWithGroup:e.typesWithoutGroup,r)):null}var bte;let og=bte=class extends a2{constructor(t){super(t),this.elements=null,this.initialState="expanded",this.type="group"}castElements(t){return Zze(t,Z7,!1)}readElements(t,e){return qze(e.formElements,Z7,!1)}writeElements(t,e){e.formElements=Wze(t,Z7,!1)}clone(){return new bte({description:this.description,elements:ie(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};h([p({json:{write:!0}})],og.prototype,"elements",void 0),h([Kt("elements")],og.prototype,"castElements",null),h([ze("elements",["formElements"])],og.prototype,"readElements",null),h([We("elements")],og.prototype,"writeElements",null),h([p({type:["collapsed","expanded"],json:{write:!0}})],og.prototype,"initialState",void 0),h([p({type:String,json:{read:!1,write:!0}})],og.prototype,"type",void 0),og=bte=h([I("esri.form.elements.GroupElement")],og);const Z7=Hze(og),tjt=og,ijt=t=>t.type==="field",rjt=t=>t.type==="group",sjt=t=>t.type==="text";var wte;const Y7=Hze(tjt);let Xp=wte=class extends Se{constructor(t){super(t),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(t){return Zze(t,Y7)}readElements(t,e){return qze(e.formElements,Y7)}writeElements(t,e){e.formElements=Wze(t,Y7)}clone(){return new wte({description:this.description,expressionInfos:ie(this.expressionInfos),elements:ie(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}async getFieldsUsed(t,e){const i=new Set,{description:r,elements:s,expressionInfos:n,title:o}=this;if(k3(i,t,r),k3(i,t,o),!s)return[];const a=njt(s,n).map(l=>Ql(i,t,l));await Promise.all(a);for(const l of s)Yze(i,{fieldsIndex:t,relationships:e},l);return Array.from(i).sort()}};function Yze(t,e,i){var s;const{fieldsIndex:r}=e;if(!r||r.fields.length!==t.size)switch(k3(t,r,i.label),k3(t,r,i.description),i.type){case"field":Fc(t,r,i.fieldName);break;case"group":i.elements.forEach(n=>Yze(t,e,n));break;case"relationship":if(e.relationships){const n=e.relationships.find(o=>o.id===i.relationshipId);n&&Fc(t,r,n.keyField)}WS(t,r,(s=i.orderByFields)==null?void 0:s.map(n=>n.field));break;case"text":k3(t,r,i.text)}}function njt(t,e){if(!e||e.length===0)return[];const i=Xze(t),r=[];for(const s of e)i.has(s.name)&&r.push(s.expression);return r}function Xze(t){const e=new Set;for(const i of t)if(oue(e,i.visibilityExpression),!sjt(i)){if(rjt(i))jV(e,Xze(i.elements));else if(oue(e,i.editableExpression),ijt(i)){const{requiredExpression:r,valueExpression:s}=i;jV(e,[r,s])}}return e}function k3(t,e,i){WS(t,e,cOe(i))}h([p({type:String,json:{write:!0}})],Xp.prototype,"description",void 0),h([p({json:{write:!0}})],Xp.prototype,"elements",void 0),h([Kt("elements")],Xp.prototype,"castElements",null),h([ze("elements",["formElements"])],Xp.prototype,"readElements",null),h([We("elements")],Xp.prototype,"writeElements",null),h([p({type:[BBt],json:{write:!0}})],Xp.prototype,"expressionInfos",void 0),h([p({type:Boolean,json:{default:!1,write:!0}})],Xp.prototype,"preserveFieldValuesWhenHidden",void 0),h([p({type:String,json:{write:!0}})],Xp.prototype,"title",void 0),Xp=wte=h([I("esri.form.FormTemplate")],Xp);const ojt=Xp;function Wbe(t,e,i){if(t.hasM==null||t.hasZ)for(const r of e)for(const s of r)s.length>2&&(s[2]*=i)}function ajt(t,e,i){if(!t&&!e||!i)return;const r=a_(i);Zbe(t,i,r),Zbe(e,i,r)}function Zbe(t,e,i){if(t)for(const r of t)ljt(r.geometry,e,i)}function ljt(t,e,i){if(!(t!=null&&t.spatialReference)||hs(t.spatialReference,e))return;const r=a_(t.spatialReference)/i;if(r!==1){if("x"in t)t.z!=null&&(t.z*=r);else if("rings"in t)Wbe(t,t.rings,r);else if("paths"in t)Wbe(t,t.paths,r);else if("points"in t&&(t.hasM==null||t.hasZ))for(const s of t.points)s.length>2&&(s[2]*=r)}}let cjt=0,P0=class extends ey.LoadableMixin(dD(st)){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const i=e!=null?e.signal:null;return this.addResolvingPromise(this._startWorker(i)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get _workerGeometryType(){var i;const e=(i=this.layer)==null?void 0:i.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,i={}){await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);See(e,this.layer.spatialReference,r);const s=nle.fromJSON(r);if(!this._requiresClientGraphicMapping())return s;const n=this.layer.objectIdField;for(const o of s.features){const a=o.attributes[n],l=this._idToClientGraphic.get(a);l&&(o.geometry=l.geometry)}return s.geometryType=this.layer.geometryType,s}async queryFeaturesJSON(e,i={}){if(this._requiresClientGraphicMapping())throw new G("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);return See(e,this.layer.spatialReference,r),r}queryFeatureCount(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,i))}queryObjectIds(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,i))}queryExtent(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,i)).then(r=>({count:r.count,extent:ur.fromJSON(r.extent)}))}querySnapping(e,i={}){return this.load(i).then(()=>this._connection.invoke("querySnapping",e,i))}async _applyEdits(e){if(!this._connection)throw new G("feature-layer-source:edit-failure","Memory source not loaded");const i=this.layer.objectIdField;let r=null;const s=[],n=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const o=u=>"objectId"in u&&u.objectId!=null?u.objectId:"attributes"in u&&u.attributes[i]!=null?u.attributes[i]:null;if(e.addFeatures&&(r=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const u of e.deleteFeatures){const d=o(u);d!=null&&s.push(d)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const u of e.updateFeatures)if(n.push(this._serializeFeature(u)),a){const d=o(u);d!=null&&a.set(d,u)}}ajt(r?r.features:null,n,this.layer.spatialReference);const{fullExtent:l,featureEditResults:c}=await this._connection.invoke("applyEdits",{adds:r?r.features:[],updates:n,deletes:s});return this.fullExtent=l,r&&r.finish(c.uidToObjectId),this._updateClientGraphicIds(a,c),this._createEditsResult(c)}async _prepareClientMapping(e,i){if(this._layerOrSourceGeometryType!=="mesh"||e==null)return;const r=[];for(const{geometry:s}of e)s==null||s.type!=="mesh"||s.hasExtent||s.loaded||r.push(s.load({signal:i}));r.length&&await Promise.all(r)}_updateClientGraphicIds(e,i){if(this._idToClientGraphic){if(e)for(const r of i.updateResults){if(!r.success)continue;const s=e.get(r.objectId);s!=null&&this._addIdToClientGraphic(s)}for(const r of i.deleteResults)r.success&&this._idToClientGraphic.delete(r.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const i=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:i?new G("feature-layer-source:edit-failure",i.description,{code:i.code}):null}}_prepareAddFeatures(e){const i=new Map,r=new Array(e.length);let s=null;for(let o=0;o<e.length;o++){const a=e[o],l=this._serializeFeature(a);s||a.geometry==null||(s=a.geometry.type),r[o]=l,i.set(`${l.uid}`,a)}const n=this;return{features:r,inferredGeometryType:s,finish(o){const a=n.sourceJSON.objectIdField;for(const l in o){const c=o[l],u=i.get(l);u&&(u.attributes||(u.attributes={}),c===-1?delete u.attributes[a]:u.attributes[a]=c,n._addIdToClientGraphic(u))}}}}_addIdToClientGraphic(e){var s;if(!this._idToClientGraphic)return;const i=this.sourceJSON.objectIdField,r=(s=e.attributes)==null?void 0:s[i];r!=null&&this._idToClientGraphic.set(r,e)}get _layerOrSourceGeometryType(){var e,i;return((e=this.layer)==null?void 0:e.geometryType)??((i=this.sourceJSON)==null?void 0:i.geometryType)}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:i}=e,r=this._geometryForSerialization(e),s=(cjt++).toString();return r?{uid:s,geometry:r.toJSON(),attributes:i}:{uid:s,attributes:i}}_geometryForSerialization(e){const{geometry:i}=e;return i==null?null:this._geometryRequiresClientGraphicMapping(i)?i.extent?Wf.fromExtent(i.extent):null:i}async _startWorker(e){this._connection=await uKe("MemorySourceWorker",{strategy:le("feature-layers-workers")?"dedicated":"local",signal:e,registryTarget:this});const{fields:i,spatialReference:r,objectIdField:s,hasM:n,hasZ:o,timeInfo:a,dateFieldsTimeZone:l}=this.layer,c=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const u=this._prepareAddFeatures(this.items);this.addHandles(this.on("before-changes",g=>{se.getLogger(this).error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),g.preventDefault()}));const d={features:u.features,fields:i==null?void 0:i.map(g=>g.toJSON()),geometryType:ahe.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&n,hasZ:this._layerOrSourceGeometryType==="mesh"||o,objectIdField:s,spatialReference:c?null:r&&r.toJSON(),timeInfo:(a==null?void 0:a.toJSON())??null,dateFieldsTimeZone:l},f=await this._connection.invoke("load",d,{signal:e});for(const g of f.warnings)se.getLogger(this.layer).warn("#load()",`${g.message} (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{warning:g});f.featureErrors.length&&se.getLogger(this.layer).warn("#load()",`Encountered ${f.featureErrors.length} validation errors while loading features. (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{errors:f.featureErrors});const m=f.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(u.inferredGeometryType)&&(m.geometryType=ahe.toJSON(u.inferredGeometryType)),this.sourceJSON=m,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),u.finish(f.assignedObjectIds)}};h([Gie({Type:ca,ensureType:Qs(ca)})],P0.prototype,"itemType",void 0),h([p()],P0.prototype,"type",void 0),h([p({constructOnly:!0})],P0.prototype,"layer",void 0),h([p({readOnly:!0})],P0.prototype,"_workerGeometryType",null),h([p()],P0.prototype,"sourceJSON",void 0),P0=h([I("esri.layers.graphics.sources.MemorySource")],P0);function ujt(t){return"portalItem"in t}const hjt=t=>{let e=class extends t{get apiKey(){var i;return this._isOverridden("apiKey")?this._get("apiKey"):ujt(this)?(i=this.portalItem)==null?void 0:i.apiKey:null}set apiKey(i){i!=null?this._override("apiKey",i):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return h([p({type:String})],e.prototype,"apiKey",null),e=h([I("esri.layers.mixins.APIKeyMixin")],e),e},djt=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const i=WP(this.url);if(i!=null&&i.title)return i.title}return this._get("title")||""}set title(i){this._set("title",i)}set url(i){this._set("url",_Je(i,se.getLogger(this)))}};return h([p()],e.prototype,"title",null),h([p({type:String})],e.prototype,"url",null),e=h([I("esri.layers.mixins.ArcGISService")],e),e},pjt={type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}},Ybe={read:{reader:FL},write:{allowNull:!0,writer:kL}},fjt={json:{read:!1,write:!1,origins:{"web-map":Ybe,"portal-item":Ybe}}},mjt=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return h([p(pjt)],e.prototype,"blendMode",void 0),h([p(fjt)],e.prototype,"effect",void 0),e=h([I("esri.layers.mixins.BlendLayer")],e),e},gjt=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return h([p({type:Object,json:{write:{overridePolicy:i=>({enabled:!!(i&&Object.keys(i).length>0)})}}})],e.prototype,"customParameters",void 0),e=h([I("esri.layers.mixins.CustomParametersMixin")],e),e},yjt=jJe(),Jze=new Map,Qze=new Map;async function Ghi(t,e,i){if(!t||!i)return!1;if(!e)return!0;const r=new URL(t).host;let s=Jze.get(r);if(!s){const n=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");s=(await yr(n,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return s===e}async function Hhi(t,e,i=!1){var n,o,a;if(!t||!e)return!0;const r=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),s=(n=Qze.get(r))==null?void 0:n.entries();if(s){for(const[l,c]of s)if(c.name===e){const u=!((o=c.stack)!=null&&o.hasForwardEdits());if(!u&&i){const[{deleteForwardEdits:d},{default:f}]=await Promise.all([ce(()=>import("./deleteForwardEdits-36TR-m42.js"),[]),ce(()=>import("./DeleteForwardEditsParameters-BcR2Pwgh.js"),[])]),m=await d(r,l,new f({sessionId:yjt,moment:c.moment}));return m.success&&((a=c.stack)==null||a.clearForwardEdits()),m.success}return u}}return!0}function _jt(t,e){var s;if(!t)return!1;const i=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),r=(s=Qze.get(i))==null?void 0:s.entries();if(r){for(const[n,o]of r)if(o.name===e)return o.lockType==="edit"}return!1}const fle=new Us.EventEmitter;function vjt(t){return fle.on("apply-edits",new WeakRef(t))}function bjt(t){return fle.on("update-moment",new WeakRef(t))}function qhi(t,e,i=null,r=!1){const s=aa();return r=e==null||r,fle.emit("apply-edits",{serviceUrl:t,layerId:e,gdbVersion:i,mayReceiveServiceEdits:r,result:s.promise}),s}const Kze=Symbol();function Whi(t){return t!=null&&typeof t=="object"&&Kze in t}function AR(t){return t!=null&&typeof t=="object"&&"gdbVersion"in t}function X7(t,e,i){const r=new URL(t).host,s=Jze.get(r),n=o=>!o||o===s;return n(e)&&n(i)||e===i}const wjt=t=>{var e;let i=class extends t{constructor(...r){super(...r),this[e]=!0,this._applyEditsHandler=s=>{const{serviceUrl:n,layerId:o,gdbVersion:a,mayReceiveServiceEdits:l,result:c}=s,u=n===this.url,d=o!=null&&this.layerId!=null&&o===this.layerId,f=AR(this),m=AR(this)&&X7(n,a,this.gdbVersion);if(!u||f&&!m||!d&&!l)return;const g=c.then(y=>{var w;if(this.lastEditsEventDate=new Date,d&&(y.addedFeatures.length||y.updatedFeatures.length||y.deletedFeatures.length||y.addedAttachments.length||y.updatedAttachments.length||y.deletedAttachments.length))return this.emit("edits",ie(y)),y;const v=(w=y.editedFeatures)==null?void 0:w.find(({layerId:x})=>x===this.layerId);if(v){const{adds:x,updates:S,deletes:C}=v.editedFeatures,M={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:x?x.map(({attributes:O})=>({objectId:this.objectIdField&&O[this.objectIdField],globalId:this.globalIdField&&O[this.globalIdField]})):[],deletedFeatures:C?C.map(({attributes:O})=>({objectId:this.objectIdField&&O[this.objectIdField],globalId:this.globalIdField&&O[this.globalIdField]})):[],updatedFeatures:S?S.map(({current:{attributes:O}})=>({objectId:this.objectIdField&&O[this.objectIdField],globalId:this.globalIdField&&O[this.globalIdField]})):[],editedFeatures:ie(y.editedFeatures),exceededTransferLimit:!1,historicMoment:ie(y.historicMoment)};return this.emit("edits",M),M}const b={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:ie(y.editedFeatures),exceededTransferLimit:!1,historicMoment:ie(y.historicMoment)};return"historicMoment"in this&&this._shouldUpdateHistoricMoment(n,a,b.historicMoment)&&this.emit("edits",b),b}).then(y=>("historicMoment"in this&&this._shouldUpdateHistoricMoment(n,a,y.historicMoment)&&(this.historicMoment=y.historicMoment),y));this.emit("apply-edits",{result:g})},this._updateMomentHandler=s=>{const{serviceUrl:n,gdbVersion:o,moment:a}=s,l=n===this.url,c=AR(this),u=AR(this)&&X7(n,o,this.gdbVersion),d=AR(this)&&!X7(n,this.gdbVersion,null);l&&c&&u&&d&&"historicMoment"in this&&this.historicMoment!==a&&(this.historicMoment=a)},this.when().then(()=>{this.addHandles(vjt(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(bjt(this._updateMomentHandler))},()=>{})}_shouldUpdateHistoricMoment(r,s,n){return"historicMoment"in this&&this.historicMoment!==n&&_jt(r,s)}};return e=Kze,h([p()],i.prototype,"lastEditsEventDate",void 0),i=h([I("esri.layers.mixins.EditBusLayer")],i),i};var xte;const J7=new Ji({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),Q7=new Ji({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let tg=xte=class extends Se{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:i,spatialRelationship:r,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new Lh({geometry:ie(i),objectIds:ie(n),spatialRelationship:r,timeExtent:ie(s),where:e,units:o,distance:a,...t})}clone(){const{where:t,geometry:e,spatialRelationship:i,timeExtent:r,objectIds:s,units:n,distance:o}=this;return new xte({geometry:ie(e),objectIds:ie(s),spatialRelationship:i,timeExtent:ie(r),where:t,units:n,distance:o})}};h([p({type:String,json:{write:!0}})],tg.prototype,"where",void 0),h([p({types:y2,json:{write:!0}})],tg.prototype,"geometry",void 0),h([p({type:J7.apiValues,json:{name:"spatialRel",read:{reader:J7.read},write:{allowNull:!1,writer:J7.write,overridePolicy(){return{enabled:this.geometry!=null}}}}})],tg.prototype,"spatialRelationship",void 0),h([p({type:Number,json:{write:{overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],tg.prototype,"distance",void 0),h([p({type:[Number],json:{write:!0}})],tg.prototype,"objectIds",void 0),h([p({type:Q7.apiValues,json:{read:Q7.read,write:{writer:Q7.write,overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],tg.prototype,"units",void 0),h([p({type:$a,json:{write:!0}})],tg.prototype,"timeExtent",void 0),tg=xte=h([I("esri.layers.support.FeatureFilter")],tg);const xjt=tg;var Tte;const Xbe={read:{reader:FL},write:{writer:kL,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},Jbe={read:{reader:FL},write:{writer:kL,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},Qbe={name:"showExcludedLabels",default:!0};let uT=Tte=class extends Se{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){var r,s;const i=super.write(t,e);if(e!=null&&e.origin){if(i.filter){const n=Object.keys(i.filter);if(n.length>1||n[0]!=="where")return(r=e.messages)==null||r.push(new G("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in i)return(s=e.messages)==null||s.push(new G("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return i}clone(){return new Tte({filter:this.filter!=null?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};h([p({type:xjt,json:{write:{allowNull:!0,writer(t,e,i,r){const s=t==null?void 0:t.write({},r);s&&Object.keys(s).length!==0?ia(i,s,e):ia(i,null,e)}}}})],uT.prototype,"filter",void 0),h([p({json:{read:FL,write:{writer:kL,allowNull:!0},origins:{"web-map":Xbe,"portal-item":Xbe}}})],uT.prototype,"includedEffect",void 0),h([p({json:{read:FL,write:{writer:kL,allowNull:!0},origins:{"web-map":Jbe,"portal-item":Jbe}}})],uT.prototype,"excludedEffect",void 0),h([p({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":Qbe,"portal-item":Qbe}}})],uT.prototype,"excludedLabelsVisible",void 0),uT=Tte=h([I("esri.layers.support.FeatureEffect")],uT);const Tjt=uT,Kbe={write:{allowNull:!0}},Sjt={type:Tjt,json:{origins:{"web-map":Kbe,"portal-item":Kbe}}},Ejt=t=>{let e=class extends t{constructor(){super(...arguments),this.featureEffect=null}};return h([p(Sjt)],e.prototype,"featureEffect",void 0),e=h([I("esri.layers.mixins.FeatureEffectLayer")],e),e};var Ste;let II=Ste=class extends Se{constructor(t){super(t)}async collectRequiredFields(t,e){return Ql(t,e,this.expression)}clone(){return new Ste({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};h([p({type:String,json:{write:!0}})],II.prototype,"expression",void 0),h([p({type:String,json:{write:!0}})],II.prototype,"title",void 0),II=Ste=h([I("esri.symbols.support.FeatureExpressionInfo")],II);const ewe=II;var Ete;const N5=Kl()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),twe=new Ji({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let y0=Ete=class extends Se{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,i,r){e[i]=t.write({},r),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):t!=null||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new Ete({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&nqe(this.featureExpressionInfo,t.featureExpressionInfo)}};h([p({type:ewe,json:{write:!0}})],y0.prototype,"featureExpressionInfo",void 0),h([ze("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],y0.prototype,"readFeatureExpressionInfo",null),h([We("featureExpressionInfo",{featureExpressionInfo:{type:ewe},"featureExpression.value":{type:[0]}})],y0.prototype,"writeFeatureExpressionInfo",null),h([p({type:N5.apiValues,nonNullable:!0,json:{type:N5.jsonValues,read:N5.read,write:{writer:N5.write,isRequired:!0}}})],y0.prototype,"mode",null),h([p({type:Number,json:{write:!0}})],y0.prototype,"offset",void 0),h([p({type:s0t,json:{type:String,read:twe.read,write:twe.write}})],y0.prototype,"unit",null),y0=Ete=h([I("esri.symbols.support.ElevationInfo")],y0);const Cjt=y0,Mjt={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:Ia}}},mle={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,i){e[i]=!t}}}},gle={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:Ia}}},Ajt={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:_b}}},Pjt={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:Ia}}},Ojt={value:null,type:Cjt,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:Ia}}};function Zhi(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const eBe={write:{enabled:!0,layerContainerTypes:Ia},read:!0},Cte={type:Number,json:{origins:{"web-document":eBe,"portal-item":{write:!0}}}},Rjt={...Cte,json:{...Cte.json,origins:{"web-document":{...eBe,write:{enabled:!0,layerContainerTypes:Ia,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,i)=>{var r;return i&&i.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?(r=e.layerDefinition)!=null&&r.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?FA(e.layerDefinition.drawingInfo.transparency):void 0:FA(e.drawingInfo.transparency)}}}},Yhi={type:ur,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const i=ur.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(i.spatialReference=Ze.fromJSON(e.spatialReference)),i}}}},read:!1}},$jt={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},Ijt={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.minScale",write:{enabled:!0,layerContainerTypes:Ia}}},name:"layerDefinition.minScale",write:!0}},Ljt={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.maxScale",write:{enabled:!0,layerContainerTypes:Ia}}},name:"layerDefinition.maxScale",write:!0}},tBe={json:{write:{ignoreOrigin:!0,layerContainerTypes:Ia},origins:{"web-map":{read:!1,write:!1}}}};let _0=class extends Jr(Se){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.timeZone=null}};h([p()],_0.prototype,"creatorField",void 0),h([p()],_0.prototype,"creationDateField",void 0),h([p()],_0.prototype,"editorField",void 0),h([p()],_0.prototype,"editDateField",void 0),h([p()],_0.prototype,"realm",void 0),h([p(NV("dateFieldsTimeReference",!0))],_0.prototype,"timeZone",void 0),_0=h([I("esri.layers.support.EditFieldsInfo")],_0);const Djt=_0;let ag=class extends Jr(Se){constructor(e){super(e)}};h([p({constructOnly:!0,json:{write:!0}})],ag.prototype,"name",void 0),h([p({constructOnly:!0,json:{write:!0}})],ag.prototype,"fields",void 0),h([p({constructOnly:!0,json:{write:!0}})],ag.prototype,"isAscending",void 0),h([p({constructOnly:!0,json:{write:!0}})],ag.prototype,"indexType",void 0),h([p({constructOnly:!0,json:{write:!0}})],ag.prototype,"isUnique",void 0),h([p({constructOnly:!0,json:{write:!0}})],ag.prototype,"description",void 0),ag=h([I("esri.layers.support.FeatureIndex")],ag);async function Njt(t,e,i){e=e.clone(),t.capabilities.query.supportsMaxRecordCountFactor&&(e.maxRecordCountFactor=iBe(t));const r=Fjt(t),s=t.capabilities.query.supportsPagination;e.start=0,e.num=r;let n=null;for(;;){const o=await t.source.queryFeaturesJSON(e,i);if(n==null?n=o:n.features=n.features.concat(o.features),n.exceededTransferLimit=o.exceededTransferLimit,!s||!o.exceededTransferLimit)break;e.start+=r}return n}function Fjt(t){return iBe(t)*kjt(t)}function kjt(t){return t.capabilities.query.maxRecordCount||2e3}function iBe(t){return t.capabilities.query.supportsMaxRecordCountFactor?Lh.MAX_MAX_RECORD_COUNT_FACTOR:1}const Mte=new Ji({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function Ujt(t,e,i,r){const s=await aw(t);if(await yle(t,e,r),!s.addAttachment)throw new G(r,"Layer source does not support addAttachment capability");return s.addAttachment(e,i)}function yle(t,e,i){var n,o;const{attributes:r}=e,{objectIdField:s}=t;return(o=(n=t.capabilities)==null?void 0:n.data)!=null&&o.supportsAttachment?e?r?s&&r[s]?Promise.resolve():Promise.reject(new G(i,`feature is missing the identifying attribute ${s}`)):Promise.reject(new G(i,"'attributes' are required on a feature to query attachments")):Promise.reject(new G(i,"A feature is required to add/delete/update attachments")):Promise.reject(new G(i,"this layer doesn't support attachments"))}async function Vjt(t,e,i,r,s){const n=await aw(t);if(await yle(t,e,s),!n.updateAttachment)throw new G(s,"Layer source does not support updateAttachment capability");return n.updateAttachment(e,i,r)}async function zjt(t,e,i){const{applyEdits:r}=await ce(()=>import("./editingSupport-DUOeuD9Y.js"),__vite__mapDeps([227,102])),s=await t.load();let n=i;return s.type==="feature"&&s.infoFor3D&&e.deleteFeatures!=null&&s.globalIdField!=null&&(n={...n,globalIdToObjectId:await nGt(s,e.deleteFeatures,s.globalIdField)}),r(s,s.source,e,i)}async function Bjt(t,e,i){const{uploadAssets:r}=await ce(()=>import("./editingSupport-DUOeuD9Y.js"),__vite__mapDeps([227,102])),s=await t.load();return r(s,s.source,e,i)}async function jjt(t,e,i,r){const s=await aw(t);if(await yle(t,e,r),!s.deleteAttachments)throw new G(r,"Layer source does not support deleteAttachments capability");return s.deleteAttachments(e,i)}async function Gjt(t,e,i){const r=(await t.load({signal:e==null?void 0:e.signal})).source;if(!r.fetchRecomputedExtents)throw new G(i,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(e)}async function Hjt(t,e,i,r){var m,g;e=yee.from(e),await t.load();const s=t.source,n=t.capabilities;if(!((m=n==null?void 0:n.data)!=null&&m.supportsAttachment))throw new G(r,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:u,start:d,where:f}=e;if(!((g=n==null?void 0:n.operations)!=null&&g.supportsQueryAttachments)&&((o==null?void 0:o.length)>0||(l==null?void 0:l.length)>0||(u==null?void 0:u.length)>0||c||d||f))throw new G(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(a!=null&&a.length||l!=null&&l.length||f))throw new G(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!s.queryAttachments)throw new G(r,"Layer source does not support queryAttachments capability",e);return s.queryAttachments(e)}async function qjt(t,e,i,r){const s=await aw(t);if(!s.queryObjectIds)throw new G(r,"Layer source does not support queryObjectIds capability");return s.queryObjectIds(Lh.from(e)??t.createQuery(),i)}async function Wjt(t,e,i,r){const s=await aw(t);if(!s.queryFeatureCount)throw new G(r,"Layer source does not support queryFeatureCount capability");return s.queryFeatureCount(Lh.from(e)??t.createQuery(),i)}async function Zjt(t,e,i,r){const s=await aw(t);if(!s.queryExtent)throw new G(r,"Layer source does not support queryExtent capability");return s.queryExtent(Lh.from(e)??t.createQuery(),i)}async function Yjt(t,e,i,r){const s=await aw(t);if(!s.queryRelatedFeatures)throw new G(r,"Layer source does not support queryRelatedFeatures capability");return s.queryRelatedFeatures(RP.from(e),i)}async function Xjt(t,e,i,r){const s=await aw(t);if(!s.queryRelatedFeaturesCount)throw new G(r,"Layer source does not support queryRelatedFeaturesCount capability");return s.queryRelatedFeaturesCount(RP.from(e),i)}async function Jjt(t){const e=t.source;if(e!=null&&e.refresh)try{const{dataChanged:i,updates:r}=await e.refresh();if(r!=null&&(t.sourceJSON={...t.sourceJSON,...r},t.read(r,{origin:"service",url:t.parsedUrl})),i)return!0}catch{}if(t.definitionExpression)try{return(await fse(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function Qjt(t){var o,a;const e=new Lh,i=(o=t.capabilities)==null?void 0:o.data,r=(a=t.capabilities)==null?void 0:a.query;e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,r&&(e.compactGeometryEnabled=r.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),i&&(i.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),i.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:s,timeExtent:n}=t;return e.timeExtent=s!=null&&n!=null?n.offset(-s.value,s.unit):n||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function rBe(t){const{globalIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeGlobalID")return r.name}}function sBe(t){const{objectIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeOID")return r.name}}function Kjt(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}function eGt(t,e){const{subtypes:i,subtypeField:r}=t;if(!e||!(i!=null&&i.length)||!r)return null;const s=e.attributes[r];return s==null?null:i.find(n=>n.code===s)}async function aw(t){return(await t.load()).source}async function tGt(t,e){if(!Bi||Bi.findCredential(t))return;let i;try{const r=await lEe(t,e);r&&(i=await Bi.checkSignInStatus(`${r}/sharing`))}catch{}if(i)try{const r=e!=null?e.signal:null;await Bi.getCredential(t,{signal:r})}catch{}}async function iGt(t,e,i){var s;const r=(s=t.parsedUrl)==null?void 0:s.path;r&&t.authenticationTriggerEvent===e&&await tGt(r,i)}function rGt(t){return!xV(t)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const K7=VP({types:tRe});function _le(t,e){var i;if(t.defaultSymbol)return(i=t.types)!=null&&i.length?new dle({defaultSymbol:K7(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(r=>({id:r.id,symbol:K7(r.symbol,r,e)}))}):new gO({symbol:K7(t.defaultSymbol,t,e)})}function sGt(t){var r,s,n;let e=(r=t.sourceJSON)==null?void 0:r.cacheMaxAge;if(!e)return!1;const i=(n=(s=t.editingInfo)==null?void 0:s.lastEditDate)==null?void 0:n.getTime();return i==null||(e*=1e3,Date.now()-i<e)}async function nGt(t,e,i){if(e==null)return null;const r=[],{objectIdField:s}=t;if(e.forEach(c=>{let u=null;if("attributes"in c){const{attributes:d}=c;u={globalId:d[i],objectId:d[s]!=null&&d[s]!==-1?d[s]:null}}else u={globalId:c.globalId,objectId:c.objectId!=null&&c.objectId!==-1?c.objectId:null};u.globalId!=null&&(u.objectId!=null&&u.objectId!==-1||r.push(u.globalId))}),r.length===0)return null;const n=t.createQuery();n.where=r.map(c=>`${i}='${c}'`).join(" OR "),n.returnGeometry=!1,n.outFields=[s,i],n.cacheHint=!1;const o=await uWe(Njt(t,n));if(!o.ok)return null;const a=new Map,l=o.value.features;for(const c of l){const u=c.attributes[i],d=c.attributes[s];u!=null&&d!=null&&d!==-1&&a.set(u,d)}return a}function oGt(t,e,i){if(!e||!i||!t)return null;const r=i.getAttribute(e);return r==null?null:t.find(s=>{const{id:n}=s;return n!=null&&n.toString()===r.toString()})??null}function xV(t){var e;return((e=t.sourceJSON)==null?void 0:e.isMultiServicesView)||aGt(t)}function aGt(t){var e,i;return!!((i=(e=t.sourceJSON)==null?void 0:e.capabilities)!=null&&i.toLowerCase().split(",").map(r=>r.trim()).includes("map"))}let XC=class extends Jr(Se){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};h([p({type:String,json:{read:{source:"shapeAreaFieldName"}}})],XC.prototype,"shapeAreaField",void 0),h([p({type:String,json:{read:{source:"shapeLengthFieldName"}}})],XC.prototype,"shapeLengthField",void 0),h([p({type:String,json:{read:t=>kWe.read(t)||UWe.read(t)}})],XC.prototype,"units",void 0),XC=h([I("esri.layers.support.GeometryFieldsInfo")],XC);const lGt=XC;var Ate;let JC=Ate=class extends Se{constructor(t){super(t),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new st}clone(){return new Ate({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};h([p({type:String,json:{write:!0}})],JC.prototype,"floorField",void 0),h([p({json:{read:!1,write:!1}})],JC.prototype,"viewAllMode",void 0),h([p({json:{read:!1,write:!1}})],JC.prototype,"viewAllLevelIds",void 0),JC=Ate=h([I("esri.layers.support.LayerFloorInfo")],JC);const cGt=JC,iwe=new Ji({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),rwe=new Ji({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let xd=class extends Jr(Se){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};h([p({json:{read:iwe.read,write:iwe.write}})],xd.prototype,"cardinality",void 0),h([p({json:{read:!0,write:!0}})],xd.prototype,"composite",void 0),h([p({json:{read:!0,write:!0}})],xd.prototype,"id",void 0),h([p({json:{read:!0,write:!0}})],xd.prototype,"keyField",void 0),h([p({json:{read:!0,write:!0}})],xd.prototype,"keyFieldInRelationshipTable",void 0),h([p({json:{read:!0,write:!0}})],xd.prototype,"name",void 0),h([p({json:{read:!0,write:!0}})],xd.prototype,"relatedTableId",void 0),h([p({json:{read:!0,write:!0}})],xd.prototype,"relationshipTableId",void 0),h([p({json:{read:rwe.read,write:rwe.write}})],xd.prototype,"role",void 0),xd=h([I("esri.layers.support.Relationship")],xd);const uGt=xd;function qt(t,e,i){return!!nBe(t,e,i)}function LI(t,e,i){return nBe(t,e,i)}function nBe(t,e,i){return t&&t.hasOwnProperty(e)?t[e]:i}const hGt={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function dGt(t){var i;const e=(i=t==null?void 0:t.supportedSpatialAggregationStatistics)==null?void 0:i.map(r=>r.toLowerCase());return{envelope:!!(e!=null&&e.includes("envelopeaggregate")),centroid:!!(e!=null&&e.includes("centroidaggregate")),convexHull:!!(e!=null&&e.includes("convexhullaggregate"))}}function gN(t,e){var r;const i=(r=t==null?void 0:t.supportedOperationsWithCacheHint)==null?void 0:r.map(s=>s.toLowerCase());return!!(i!=null&&i.includes(e.toLowerCase()))}function oBe(t,e){return{analytics:pGt(t),attachment:fGt(t),data:mGt(t),metadata:gGt(t),operations:yGt(t.capabilities,t,e),query:_Gt(t,e),queryRelated:vGt(t),queryTopFeatures:bGt(t),editing:wGt(t)}}function pGt(t){return{supportsCacheHint:gN(t.advancedQueryCapabilities,"queryAnalytics")}}function fGt(t){const e=t.attachmentProperties,i={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:gN(t.advancedQueryCapabilities,"queryAttachments"),supportsResize:qt(t,"supportsAttachmentsResizing",!1)};return e&&Array.isArray(e)&&e.forEach(r=>{const s=hGt[r.name];s&&(i[s]=!!r.isEnabled)}),i}function mGt(t){return{isVersioned:qt(t,"isDataVersioned",!1),supportsAttachment:qt(t,"hasAttachments",!1),supportsM:qt(t,"hasM",!1),supportsZ:qt(t,"hasZ",!1)}}function gGt(t){return{supportsAdvancedFieldProperties:qt(t,"supportsFieldDescriptionProperty",!1)}}function yGt(t,e,i){const r=t?t.toLowerCase().split(",").map(f=>f.trim()):[],s=i?WP(i):null,n=r.includes(s!=null&&s.serverType==="MapServer"?"data":"query"),o=r.includes("editing")&&!e.datesInUnknownTimezone;let a=o&&r.includes("create"),l=o&&r.includes("delete"),c=o&&r.includes("update");const u=r.includes("changetracking"),d=e.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:qt(e,"supportsCalculate",!1),supportsTruncate:qt(e,"supportsTruncate",!1),supportsValidateSql:qt(e,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:u,supportsQuery:n,supportsQueryAnalytics:qt(d,"supportsQueryAnalytic",!1),supportsQueryAttachments:qt(d,"supportsQueryAttachments",!1),supportsQueryTopFeatures:qt(d,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:qt(e,"supportsAttachmentsResizing",!1),supportsSync:r.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:qt(e,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:qt(e,"supportsAsyncConvert3D",!1)}}function _Gt(t,e){const i=t.advancedQueryCapabilities,r=t.ownershipBasedAccessControlForFeatures,s=t.archivingInfo,n=t.currentVersion,o=e==null?void 0:e.includes("MapServer"),a=!o||n>=le("mapserver-pbf-version-support"),l=QCe(e),c=new Set((t.supportedQueryFormats??"").split(",").map(u=>u.toLowerCase().trim()));return{maxRecordCount:LI(t,"maxRecordCount",void 0),maxRecordCountFactor:LI(t,"maxRecordCountFactor",void 0),standardMaxRecordCount:LI(t,"standardMaxRecordCount",void 0),supportedSpatialAggregationStatistics:dGt(i),supportsCacheHint:qt(i,"supportsQueryWithCacheHint",!1)||gN(i,"query"),supportsCentroid:qt(i,"supportsReturningGeometryCentroid",!1),supportsCompactGeometry:l,supportsDefaultSpatialReference:qt(i,"supportsDefaultSR",!1),supportsDisjointSpatialRelationship:qt(i,"supportsDisjointSpatialRel",!1),supportsDistance:qt(i,"supportsQueryWithDistance",!1),supportsDistinct:qt(i,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:qt(i,"supportsReturningQueryExtent",!1),supportsFormatPBF:a&&c.has("pbf"),supportsFullTextSearch:qt(i,"supportsFullTextSearch",!1),supportsGeometryProperties:qt(i,"supportsReturningGeometryProperties",!1),supportsHavingClause:qt(i,"supportsHavingClause",!1),supportsHistoricMoment:qt(s,"supportsQueryWithHistoricMoment",!1),supportsMaxRecordCountFactor:qt(i,"supportsMaxRecordCountFactor",!1),supportsOrderBy:qt(i,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:qt(i,"supportsPagination",!1),supportsPercentileStatistics:qt(i,"supportsPercentileStatistics",!1),supportsQuantization:qt(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:qt(t,"supportsQuantizationEditMode",!1),supportsQueryByAnonymous:qt(r,"allowAnonymousToQuery",!0),supportsQueryByOthers:qt(r,"allowOthersToQuery",!0),supportsQueryGeometry:qt(t,"supportsReturningQueryGeometry",!1),supportsResultType:qt(i,"supportsQueryWithResultType",!1),supportsSpatialAggregationStatistics:qt(i,"supportsSpatialAggregationStatistics",!1),supportsSqlExpression:qt(i,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:qt(t,"useStandardizedQueries",!1),supportsStatistics:qt(i,"supportsStatistics",t.supportsStatistics),supportsTopFeaturesQuery:qt(i,"supportsTopFeaturesQuery",!1),tileMaxRecordCount:LI(t,"tileMaxRecordCount",void 0)}}function vGt(t){const e=t.advancedQueryCapabilities,i=qt(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:qt(e,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i,supportsCacheHint:gN(e,"queryRelated")}}function bGt(t){return{supportsCacheHint:gN(t.advancedQueryCapabilities,"queryTopFilter")}}function wGt(t){const e=t.ownershipBasedAccessControlForFeatures,i=t?t.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:qt(t,"allowGeometryUpdates",!0),supportsGlobalId:qt(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:qt(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:qt(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:qt(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:qt(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:qt(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:qt(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:qt(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:qt(e,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:qt(i,"supportsAsyncApplyEdits",!1),zDefault:LI(t,"zDefault",void 0)}}function edi(t){var e;return{operations:{supportsAppend:qt(t,"supportsAppend",!1),supportsExportClip:qt(t,"supportsExportClip",!1),supportsExportFrameset:qt(t,"supportsExportFrameset",!1),supportsMensuration:qt(t,"supportsMensuration",!1),supportsUpdate:qt(t,"supportsUpdate",!1)},query:{supportsCoverageQuery:((e=t==null?void 0:t.playbackInfo)==null?void 0:e.klv["0601"])??!1}}}let v0=class extends Jr(Se){constructor(e){super(e),this.code=null,this.defaultValues={},this.domains=null,this.name=null}readDomains(e){if(!e)return null;const i={};for(const r of Object.keys(e))i[r]=jG(e[r]);return i}writeDomains(e,i){var s;if(!e)return;const r={};for(const n of Object.keys(e))e[n]&&(r[n]=(s=e[n])==null?void 0:s.toJSON());i.domains=r}};h([p({type:Number,json:{write:!0}})],v0.prototype,"code",void 0),h([p({type:Object,json:{write:!0}})],v0.prototype,"defaultValues",void 0),h([p({json:{write:!0}})],v0.prototype,"domains",void 0),h([ze("domains")],v0.prototype,"readDomains",null),h([We("domains")],v0.prototype,"writeDomains",null),h([p({type:String,json:{write:!0}})],v0.prototype,"name",void 0),v0=h([I("esri.layers.support.Subtype")],v0);const xGt=v0,TGt=t=>{let e=class extends t{constructor(){super(...arguments),this.copyright=null,this.capabilities=null,this.dateFieldsTimeZone=null,this.datesInUnknownTimezone=!1,this.definitionExpression=null,this.displayField=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.globalIdField=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.indexes=new(st.ofType(ag)),this.isTable=!1,this.layerId=void 0,this.maxScale=0,this.minScale=0,this.objectIdField=null,this.preferredTimeZone=null,this.relationships=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.sourceJSON=null,this.spatialReference=Ze.WGS84,this.subtypeField=null,this.subtypes=null,this.trackIdField=null,this.version=void 0}get authenticationTriggerEvent(){if(!this.url)return null;const{capabilities:i}=this;if(i){const{query:s,operations:n,editing:o}=i;if(!s.supportsQueryByOthers||!s.supportsQueryByAnonymous||n.supportsEditing&&!(o.supportsUpdateByOthers&&o.supportsUpdateByAnonymous&&o.supportsDeleteByOthers&&o.supportsDeleteByAnonymous))return"load"}if(this.userHasUpdateItemPrivileges){if(sGt(this))return"load";if(this.hasUpdateItemRestrictions)return i.operations.supportsQuery?"editing":"load"}if(this.userHasFullEditingPrivileges&&this.hasFullEditingRestrictions)return"editing";const r=this.editFieldsInfo;return(r!=null&&r.creatorField||r!=null&&r.editorField)&&(i!=null&&i.operations.supportsEditing)?"editing":null}readCapabilitiesFromService(i,r){return oBe(r,this.url)}readEditingInfo(i,r){const{editingInfo:s}=r;return s?{lastEditDate:s.lastEditDate!=null?new Date(s.lastEditDate):null}:null}get effectiveCapabilities(){const i=this.capabilities;if(!i)return null;const r=ie(i),{operations:s,editing:n}=r;return xV(this)?(this.userHasUpdateItemPrivileges&&(s.supportsQuery=!0),r):this.userHasUpdateItemPrivileges?(s.supportsAdd=s.supportsDelete=s.supportsEditing=s.supportsQuery=s.supportsUpdate=n.supportsDeleteByOthers=n.supportsGeometryUpdate=n.supportsUpdateByOthers=!0,r):(this.userHasFullEditingPrivileges&&s.supportsEditing&&(s.supportsAdd=s.supportsDelete=s.supportsUpdate=n.supportsGeometryUpdate=!0),r)}readGlobalIdFieldFromService(i,r){return rBe(r)}get hasFullEditingRestrictions(){const i=this.capabilities;if(!i||xV(this))return!1;const{operations:r,editing:s}=i;return r.supportsEditing&&!(r.supportsAdd&&r.supportsDelete&&r.supportsUpdate&&s.supportsGeometryUpdate)}get hasUpdateItemRestrictions(){const i=this.capabilities;if(!i)return!1;const{operations:r,editing:s}=i;return xV(this)?!r.supportsQuery:!(r.supportsAdd&&r.supportsDelete&&r.supportsEditing&&r.supportsQuery&&r.supportsUpdate&&s.supportsDeleteByOthers&&s.supportsGeometryUpdate&&s.supportsUpdateByOthers)}readIsTableFromService(i,r){return r.type==="Table"}readMaxScale(i,r){return r.effectiveMaxScale||i||0}readMinScale(i,r){return r.effectiveMinScale||i||0}readObjectIdFieldFromService(i,r){return sBe(r)}readServiceDefinitionExpression(i,r){return r.definitionQuery||r.definitionExpression}set url(i){if(i==null)return void this._set("url",i);const r=vJe({layer:this,url:i,nonStandardUrlAllowed:!0,logger:se.getLogger(this)});this._set("url",r.url),r.layerId!=null&&this._set("layerId",r.layerId)}writeUrl(i,r,s,n){bJe(this,i,null,r,n)}readVersion(i,r){return Kjt(r)}};return h([p({readOnly:!0})],e.prototype,"authenticationTriggerEvent",null),h([p({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),h([p({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],e.prototype,"capabilities",void 0),h([ze("service","capabilities")],e.prototype,"readCapabilitiesFromService",null),h([p(NV("dateFieldsTimeReference"))],e.prototype,"dateFieldsTimeZone",void 0),h([p({type:Boolean})],e.prototype,"datesInUnknownTimezone",void 0),h([p({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],e.prototype,"definitionExpression",void 0),h([p({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],e.prototype,"displayField",void 0),h([p({readOnly:!0,type:Djt})],e.prototype,"editFieldsInfo",void 0),h([p({readOnly:!0})],e.prototype,"editingInfo",void 0),h([ze("editingInfo")],e.prototype,"readEditingInfo",null),h([p({readOnly:!0})],e.prototype,"effectiveCapabilities",null),h([p((()=>{const i=ie(Ojt),r=i.json.origins;return r["web-map"]={read:!1,write:!1},r["portal-item"]={read:!1,write:!1},i})())],e.prototype,"elevationInfo",void 0),h([p({type:cGt,json:{name:"layerDefinition.floorInfo",write:!0,origins:{"web-scene":{name:"layerDefinition.floorInfo",write:{enabled:!0,layerContainerTypes:Ia}}}}})],e.prototype,"floorInfo",void 0),h([p({type:ur,json:{origins:{service:{read:{source:"extent"}}}}})],e.prototype,"fullExtent",void 0),h([p()],e.prototype,"gdbVersion",void 0),h([p({readOnly:!0,type:lGt,json:{read:{source:"geometryProperties"}}})],e.prototype,"geometryFieldsInfo",void 0),h([p({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:Mte.read}}}})],e.prototype,"geometryType",void 0),h([p({type:String})],e.prototype,"globalIdField",void 0),h([ze("service","globalIdField",["globalIdField","fields"])],e.prototype,"readGlobalIdFieldFromService",null),h([p({readOnly:!0})],e.prototype,"hasFullEditingRestrictions",null),h([p({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasM",void 0),h([p({readOnly:!0})],e.prototype,"hasUpdateItemRestrictions",null),h([p({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasZ",void 0),h([p({readOnly:!0,type:qb})],e.prototype,"heightModelInfo",void 0),h([p({type:Date})],e.prototype,"historicMoment",void 0),h([p({type:st.ofType(ag),readOnly:!0})],e.prototype,"indexes",void 0),h([p({readOnly:!0})],e.prototype,"isTable",void 0),h([ze("service","isTable",["type"])],e.prototype,"readIsTableFromService",null),h([p({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],e.prototype,"layerId",void 0),h([p(Ljt)],e.prototype,"maxScale",void 0),h([ze("service","maxScale",["maxScale","effectiveMaxScale"])],e.prototype,"readMaxScale",null),h([p(Ijt)],e.prototype,"minScale",void 0),h([ze("service","minScale",["minScale","effectiveMinScale"])],e.prototype,"readMinScale",null),h([p({type:String})],e.prototype,"objectIdField",void 0),h([ze("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdFieldFromService",null),h([p(NV("preferredTimeReference"))],e.prototype,"preferredTimeZone",void 0),h([p({type:[uGt],readOnly:!0})],e.prototype,"relationships",void 0),h([p({type:Boolean})],e.prototype,"returnM",void 0),h([p({type:Boolean})],e.prototype,"returnZ",void 0),h([p({readOnly:!0,json:{write:!1}})],e.prototype,"serverGens",void 0),h([p({readOnly:!0})],e.prototype,"serviceDefinitionExpression",void 0),h([ze("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],e.prototype,"readServiceDefinitionExpression",null),h([p({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"serviceItemId",void 0),h([p()],e.prototype,"sourceJSON",void 0),h([p({type:Ze,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],e.prototype,"spatialReference",void 0),h([p({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],e.prototype,"subtypeField",void 0),h([p({type:[xGt],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"subtypes",void 0),h([p({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],e.prototype,"trackIdField",void 0),h([p(Ajt)],e.prototype,"url",null),h([We("url")],e.prototype,"writeUrl",null),h([p({json:{origins:{service:{read:!0}},read:!1}})],e.prototype,"version",void 0),h([ze("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],e.prototype,"readVersion",null),e=h([I("esri.layers.mixins.FeatureLayerBase")],e),e};let QC=class extends Jr(Se){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};h([p({type:String,json:{write:!0}})],QC.prototype,"expression",void 0),h([p({type:String,json:{write:!0}})],QC.prototype,"title",void 0),h([p({type:String,json:{write:!0}})],QC.prototype,"returnType",void 0),QC=h([I("esri.layers.support.ExpressionInfo")],QC);const vle=QC;var Pte;let b0=Pte=class extends Se{constructor(t){super(t),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new Pte({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:ie(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};h([p({type:Boolean,json:{write:!0}})],b0.prototype,"isAutoGenerated",void 0),h([p({type:String,json:{write:!0}})],b0.prototype,"name",void 0),h([p({type:String,json:{write:!0}})],b0.prototype,"alias",void 0),h([p({type:String,json:{write:!0}})],b0.prototype,"onStatisticField",void 0),h([p({type:vle,json:{write:!0}})],b0.prototype,"onStatisticExpression",void 0),h([p({type:String,json:{write:!0}})],b0.prototype,"statisticType",void 0),b0=Pte=h([I("esri.layers.support.AggregateField")],b0);const l2=b0;let hb=class extends Se{constructor(){super(...arguments),this.type=null}};h([p({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],hb.prototype,"type",void 0),hb=h([I("esri.layers.support.FeatureReduction")],hb);var Ote;let a1=Ote=class extends Se{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(t,e){return e.value?BQ(e.value):t}writeExpression(t,e,i){this.value!=null&&(t=BQ(this.value)),t!=null&&(e[i]=t)}clone(){return new Ote({expression:this.expression,title:this.title,value:this.value})}};h([p({type:String,json:{write:{writerEnsuresNonNull:!0}}})],a1.prototype,"expression",void 0),h([ze("expression",["expression","value"])],a1.prototype,"readExpression",null),h([We("expression")],a1.prototype,"writeExpression",null),h([p({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],a1.prototype,"title",void 0),h([p({json:{read:!1,write:!1}})],a1.prototype,"value",void 0),a1=Ote=h([I("esri.layers.support.LabelExpressionInfo")],a1);const aBe=a1;var Rte;const F5=new Ji({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function k5(t,e,i){return{enabled:!aEe(i==null?void 0:i.layer)}}function lBe(t){var e;return!t||t.origin!=="service"&&((e=t.layer)==null?void 0:e.type)!=="map-image"}function SGt(t){return(t==null?void 0:t.type)==="map-image"}function cBe(t){var e,i;return!!SGt(t)&&!!((i=(e=t.capabilities)==null?void 0:e.exportMap)!=null&&i.supportsArcadeExpressionForLabeling)}function EGt(t){return lBe(t)||cBe(t==null?void 0:t.layer)}let Dn=Rte=class extends Se{static evaluateWhere(t,e){const i=(r,s,n)=>{switch(s){case"=":return r==n;case"<>":return r!=n;case">":return r>n;case">=":return r>=n;case"<":return r<n;case"<=":return r<=n}return!1};try{if(t==null)return!0;const r=t.split(" ");if(r.length===3)return i(e[r[0]],r[1],r[2]);if(r.length===7){const s=i(e[r[0]],r[1],r[2]),n=r[3],o=i(e[r[4]],r[5],r[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=OSt,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const i=e.labelExpressionInfo;if(!i||!i.value&&!i.expression)return t}writeLabelExpression(t,e,i){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)t=Iyt(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const r=Wne(this.labelExpressionInfo.expression);r&&(t="["+r+"]")}}t!=null&&(e[i]=t)}writeLabelExpressionInfo(t,e,i,r){if(t==null&&this.labelExpression!=null&&lBe(r))t=new aBe({expression:this.getLabelExpressionArcade()});else if(!t)return;const s=t.toJSON(r);s.expression&&(e[i]=s)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return x6(this)}getLabelExpressionArcade(){return Lyt(this)}getLabelExpressionSingleField(){return Dyt(this)}hash(){return JSON.stringify(this)}clone(){return new Rte({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:ie(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:ie(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};h([p({type:String,json:{write:!0}})],Dn.prototype,"name",void 0),h([p({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:k5}}}}})],Dn.prototype,"allowOverrun",void 0),h([p({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:k5}}}}})],Dn.prototype,"deconflictionStrategy",void 0),h([p({type:String,json:{write:{overridePolicy(t,e,i){return this.labelExpressionInfo&&(i==null?void 0:i.origin)==="service"&&cBe(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],Dn.prototype,"labelExpression",void 0),h([ze("labelExpression")],Dn.prototype,"readLabelExpression",null),h([We("labelExpression")],Dn.prototype,"writeLabelExpression",null),h([p({type:aBe,json:{write:{overridePolicy:(t,e,i)=>EGt(i)?{allowNull:!0}:{enabled:!1}}}})],Dn.prototype,"labelExpressionInfo",void 0),h([We("labelExpressionInfo")],Dn.prototype,"writeLabelExpressionInfo",null),h([p({type:F5.apiValues,json:{type:F5.jsonValues,read:F5.read,write:F5.write}})],Dn.prototype,"labelPlacement",void 0),h([p({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],Dn.prototype,"labelPosition",void 0),h([p({type:Number})],Dn.prototype,"maxScale",void 0),h([We("maxScale")],Dn.prototype,"writeMaxScale",null),h([p({type:Number})],Dn.prototype,"minScale",void 0),h([We("minScale")],Dn.prototype,"writeMinScale",null),h([p({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:k5}}}}})],Dn.prototype,"repeatLabel",void 0),h([p({type:Number,cast:vr,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:k5}}}}})],Dn.prototype,"repeatLabelDistance",void 0),h([p({types:Qot,json:{origins:{"web-scene":{types:Kot,write:O0e,default:null}},write:O0e,default:null}})],Dn.prototype,"symbol",void 0),h([p({type:Boolean,json:{write:!0}})],Dn.prototype,"useCodedValues",void 0),h([p({type:String,json:{write:!0}})],Dn.prototype,"where",void 0),Dn=Rte=h([I("esri.layers.support.LabelClass")],Dn);const cH=Dn;var $te;let Ll=$te=class extends hb{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=null,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.size=vr("12px"),this.fields=[],this.renderer=null}writeFields(t,e,i){const r=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());ia(i,r,e)}readRenderer(t,e,i){var s;const r=(s=e.drawingInfo)==null?void 0:s.renderer;return r?JL(r,e,i)??void 0:_le(e,i)}clone(){return new $te({fields:ie(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:ie(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:ie(this.popupTemplate),renderer:ie(this.renderer),binType:ie(this.binType),size:this.size})}};h([Ot({binning:"binning"})],Ll.prototype,"type",void 0),h([Ot({geohash:"geohash",square:"square"}),p({type:["geohash","square"]})],Ll.prototype,"binType",void 0),h([p({type:Number,json:{write:!0}})],Ll.prototype,"fixedBinLevel",void 0),h([p({type:[cH],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Ll.prototype,"labelingInfo",void 0),h([p(gle)],Ll.prototype,"labelsVisible",void 0),h([p({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Ll.prototype,"maxScale",void 0),h([p(mle)],Ll.prototype,"popupEnabled",void 0),h([p({type:PD,json:{name:"popupInfo",write:!0}})],Ll.prototype,"popupTemplate",void 0),h([p({type:Number,cast:t=>t==="auto"?t:vr(t)})],Ll.prototype,"size",void 0),h([p({type:[l2],json:{write:!0}})],Ll.prototype,"fields",void 0),h([We("fields")],Ll.prototype,"writeFields",null),h([p({types:lH,json:{write:{target:"drawingInfo.renderer"}}})],Ll.prototype,"renderer",void 0),h([ze("renderer",["drawingInfo.renderer"])],Ll.prototype,"readRenderer",null),Ll=$te=h([I("esri.layers.support.FeatureReductionBinning")],Ll);const uBe=Ll;var Ite;function swe(t){var e;return t.type==="simple"&&!((e=t.visualVariables)!=null&&e.length)}let Eo=Ite=class extends Se{constructor(t){super(t),this.type="cluster",this.clusterRadius=vr("80px"),this.clusterMinSize=vr("12px"),this.clusterMaxSize=vr("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=[]}readRenderer(t,e,i){var s,n;const r=(s=e.drawingInfo)==null?void 0:s.renderer;return(n=r==null?void 0:r.authoringInfo)!=null&&n.isAutoGenerated?null:r?swe(r)?null:JL(r,e,i)??void 0:_le(e,i)}readSymbol(t,e,i){var s,n;const r=(s=e.drawingInfo)==null?void 0:s.renderer;if((n=r==null?void 0:r.authoringInfo)!=null&&n.isAutoGenerated)return null;if(r&&swe(r)){const o=JL(r,e,i);return o==null?void 0:o.symbol}return null}writeSymbol(t,e,i,r){var n,o;const s=(o=(n=this.renderer)==null?void 0:n.authoringInfo)==null?void 0:o.isAutoGenerated;if(!this.renderer||s){const a=new gO({symbol:t});e.drawingInfo={renderer:a.write({},r)}}}writeFields(t,e,i){const r=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());ia(i,r,e)}readFields(t,e,i){return t.filter(r=>!r.isAutoGenerated).map(r=>l2.fromJSON(r))}clone(){return new Ite({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:ie(this.labelingInfo),labelsVisible:this.labelsVisible,fields:ie(this.fields),maxScale:this.maxScale,renderer:ie(this.renderer),symbol:ie(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:ie(this.popupTemplate)})}};h([p({type:["cluster"],readOnly:!0,json:{write:!0}})],Eo.prototype,"type",void 0),h([p({type:Number,cast:t=>t==="auto"?t:vr(t),json:{write:!0}})],Eo.prototype,"clusterRadius",void 0),h([p({type:Number,cast:vr,json:{write:!0}})],Eo.prototype,"clusterMinSize",void 0),h([p({type:Number,cast:vr,json:{write:!0}})],Eo.prototype,"clusterMaxSize",void 0),h([p({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Eo.prototype,"maxScale",void 0),h([p(mle)],Eo.prototype,"popupEnabled",void 0),h([p({type:PD,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Eo.prototype,"popupTemplate",void 0),h([p({types:lH,json:{write:{target:"drawingInfo.renderer"}}})],Eo.prototype,"renderer",void 0),h([ze("renderer",["drawingInfo.renderer"])],Eo.prototype,"readRenderer",null),h([p({types:Xot})],Eo.prototype,"symbol",void 0),h([ze("symbol",["drawingInfo.renderer"])],Eo.prototype,"readSymbol",null),h([We("symbol")],Eo.prototype,"writeSymbol",null),h([p({type:[cH],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Eo.prototype,"labelingInfo",void 0),h([p(gle)],Eo.prototype,"labelsVisible",void 0),h([p({type:[l2],json:{write:!0}})],Eo.prototype,"fields",void 0),h([We("fields")],Eo.prototype,"writeFields",null),h([ze("fields")],Eo.prototype,"readFields",null),Eo=Ite=h([I("esri.layers.support.FeatureReductionCluster")],Eo);const hBe=Eo;var Lte;let TV=Lte=class extends hb{constructor(t){super(t),this.type="selection"}clone(){return new Lte}};h([p({type:["selection"]})],TV.prototype,"type",void 0),TV=Lte=h([I("esri.layers.support.FeatureReductionSelection")],TV);const nwe=TV,owe={key:"type",base:hb,typeMap:{cluster:hBe,binning:uBe}},CGt={types:{key:"type",base:hb,typeMap:{selection:nwe,cluster:hBe,binning:uBe}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:owe},"portal-item":{types:owe},"web-scene":{types:{key:"type",base:hb,typeMap:{selection:nwe}},name:"layerDefinition.featureReduction",write:{layerContainerTypes:Ia}}}}},ZE={Base64:0,Hex:1,String:2,Raw:3},wA=8,dBe=(1<<wA)-1;function H1(t,e){const i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function MGt(t){const e=[];for(let i=0,r=t.length*wA;i<r;i+=wA)e[i>>5]|=(t.charCodeAt(i/wA)&dBe)<<i%32;return e}function AGt(t){const e=[];for(let i=0,r=32*t.length;i<r;i+=wA)e.push(String.fromCharCode(t[i>>5]>>>i%32&dBe));return e.join("")}function PGt(t){const e="0123456789abcdef",i=[];for(let r=0,s=4*t.length;r<s;r++)i.push(e.charAt(t[r>>2]>>r%4*8+4&15)+e.charAt(t[r>>2]>>r%4*8&15));return i.join("")}function OGt(t){const e="=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=[];for(let s=0,n=4*t.length;s<n;s+=3){const o=(t[s>>2]>>s%4*8&255)<<16|(t[s+1>>2]>>(s+1)%4*8&255)<<8|t[s+2>>2]>>(s+2)%4*8&255;for(let a=0;a<4;a++)8*s+6*a>32*t.length?r.push(e):r.push(i.charAt(o>>6*(3-a)&63))}return r.join("")}function RGt(t,e){return t<<e|t>>>32-e}function uH(t,e,i,r,s,n){return H1(RGt(H1(H1(e,t),H1(r,n)),s),i)}function El(t,e,i,r,s,n,o){return uH(e&i|~e&r,t,e,s,n,o)}function Cl(t,e,i,r,s,n,o){return uH(e&r|i&~r,t,e,s,n,o)}function Ml(t,e,i,r,s,n,o){return uH(e^i^r,t,e,s,n,o)}function Al(t,e,i,r,s,n,o){return uH(i^(e|~r),t,e,s,n,o)}function $Gt(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let i=1732584193,r=-271733879,s=-1732584194,n=271733878;for(let o=0;o<t.length;o+=16){const a=i,l=r,c=s,u=n;i=El(i,r,s,n,t[o],7,-680876936),n=El(n,i,r,s,t[o+1],12,-389564586),s=El(s,n,i,r,t[o+2],17,606105819),r=El(r,s,n,i,t[o+3],22,-1044525330),i=El(i,r,s,n,t[o+4],7,-176418897),n=El(n,i,r,s,t[o+5],12,1200080426),s=El(s,n,i,r,t[o+6],17,-1473231341),r=El(r,s,n,i,t[o+7],22,-45705983),i=El(i,r,s,n,t[o+8],7,1770035416),n=El(n,i,r,s,t[o+9],12,-1958414417),s=El(s,n,i,r,t[o+10],17,-42063),r=El(r,s,n,i,t[o+11],22,-1990404162),i=El(i,r,s,n,t[o+12],7,1804603682),n=El(n,i,r,s,t[o+13],12,-40341101),s=El(s,n,i,r,t[o+14],17,-1502002290),r=El(r,s,n,i,t[o+15],22,1236535329),i=Cl(i,r,s,n,t[o+1],5,-165796510),n=Cl(n,i,r,s,t[o+6],9,-1069501632),s=Cl(s,n,i,r,t[o+11],14,643717713),r=Cl(r,s,n,i,t[o],20,-373897302),i=Cl(i,r,s,n,t[o+5],5,-701558691),n=Cl(n,i,r,s,t[o+10],9,38016083),s=Cl(s,n,i,r,t[o+15],14,-660478335),r=Cl(r,s,n,i,t[o+4],20,-405537848),i=Cl(i,r,s,n,t[o+9],5,568446438),n=Cl(n,i,r,s,t[o+14],9,-1019803690),s=Cl(s,n,i,r,t[o+3],14,-187363961),r=Cl(r,s,n,i,t[o+8],20,1163531501),i=Cl(i,r,s,n,t[o+13],5,-1444681467),n=Cl(n,i,r,s,t[o+2],9,-51403784),s=Cl(s,n,i,r,t[o+7],14,1735328473),r=Cl(r,s,n,i,t[o+12],20,-1926607734),i=Ml(i,r,s,n,t[o+5],4,-378558),n=Ml(n,i,r,s,t[o+8],11,-2022574463),s=Ml(s,n,i,r,t[o+11],16,1839030562),r=Ml(r,s,n,i,t[o+14],23,-35309556),i=Ml(i,r,s,n,t[o+1],4,-1530992060),n=Ml(n,i,r,s,t[o+4],11,1272893353),s=Ml(s,n,i,r,t[o+7],16,-155497632),r=Ml(r,s,n,i,t[o+10],23,-1094730640),i=Ml(i,r,s,n,t[o+13],4,681279174),n=Ml(n,i,r,s,t[o],11,-358537222),s=Ml(s,n,i,r,t[o+3],16,-722521979),r=Ml(r,s,n,i,t[o+6],23,76029189),i=Ml(i,r,s,n,t[o+9],4,-640364487),n=Ml(n,i,r,s,t[o+12],11,-421815835),s=Ml(s,n,i,r,t[o+15],16,530742520),r=Ml(r,s,n,i,t[o+2],23,-995338651),i=Al(i,r,s,n,t[o],6,-198630844),n=Al(n,i,r,s,t[o+7],10,1126891415),s=Al(s,n,i,r,t[o+14],15,-1416354905),r=Al(r,s,n,i,t[o+5],21,-57434055),i=Al(i,r,s,n,t[o+12],6,1700485571),n=Al(n,i,r,s,t[o+3],10,-1894986606),s=Al(s,n,i,r,t[o+10],15,-1051523),r=Al(r,s,n,i,t[o+1],21,-2054922799),i=Al(i,r,s,n,t[o+8],6,1873313359),n=Al(n,i,r,s,t[o+15],10,-30611744),s=Al(s,n,i,r,t[o+6],15,-1560198380),r=Al(r,s,n,i,t[o+13],21,1309151649),i=Al(i,r,s,n,t[o+4],6,-145523070),n=Al(n,i,r,s,t[o+11],10,-1120210379),s=Al(s,n,i,r,t[o+2],15,718787259),r=Al(r,s,n,i,t[o+9],21,-343485551),i=H1(i,a),r=H1(r,l),s=H1(s,c),n=H1(n,u)}return[i,r,s,n]}function pBe(t,e=ZE.Hex){const i=e||ZE.Base64,r=$Gt(MGt(t),t.length*wA);switch(i){case ZE.Raw:return r;case ZE.Hex:return PGt(r);case ZE.String:return AGt(r);case ZE.Base64:return OGt(r)}}const IGt=()=>se.getLogger("esri.views.2d.layers.support.clusterUtils");le.add("esri-cluster-arcade-enabled",!0);const LGt=le("esri-cluster-arcade-enabled"),DGt=new Set(["simple-line","simple-fill","picture-fill"]);function awe(t,e){let i=e.clone();if(!NGt(i))return i;if(e.getSymbols().some(r=>DGt.has(r.type))&&(i=new gO({symbol:new py})),i.authoringInfo||(i.authoringInfo=new lle),i.authoringInfo.isAutoGenerated=!0,"visualVariables"in i){const r=(i.visualVariables||[]).filter(s=>s.valueExpression!=="$view.scale");r.forEach(s=>{s.type==="rotation"?s.field?s.field=sx(t,s.field,"avg_angle","number"):s.valueExpression&&(s.field=PR(t,s.valueExpression,"avg_angle","number"),s.valueExpression=null):s.normalizationField?(s.field=sx(t,s.field,"avg_norm","number",s.normalizationField),s.normalizationField=null):s.field?s.field=sx(t,s.field,"avg","number"):s.valueExpression&&(s.field=PR(t,s.valueExpression,"avg","number"),s.valueExpression=null)}),i.visualVariables=r}switch(i.type){case"simple":break;case"pie-chart":for(const r of i.attributes)r.field?r.field=sx(t,r.field,"sum","number"):r.valueExpression&&(r.field=PR(t,r.valueExpression,"sum","number"),r.valueExpression=null);break;case"unique-value":i.field?i.field=sx(t,i.field,"mode","string"):i.valueExpression&&(i.field=PR(t,i.valueExpression,"mode","string"),i.valueExpression=null);break;case"class-breaks":i.normalizationField?(i.field=sx(t,i.field,"avg_norm","number",i.normalizationField),i.normalizationField=null):i.field?i.field=sx(t,i.field,"avg","number"):i.valueExpression&&(i.field=PR(t,i.valueExpression,"avg","number"),i.valueExpression=null)}return i}const NGt=t=>{const e=i=>IGt().error(new G("Unsupported-renderer",i,{renderer:t}));if(!t)return!1;switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const i=t.normalizationType;if(i!=="field")return e(`FeatureReductionCluster does not support a normalizationType of ${i}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!LGt){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some(i=>!(!("valueExpression"in i)||!i.valueExpression)))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function FGt(t,e,i){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const r=i,s="field",n=e.toLowerCase()+",norm:"+s+","+r.toLowerCase();return"cluster_avg_"+pBe(n)}}}function PR(t,e,i,r){const s=pBe(e),n=i==="mode"?`cluster_type_${s}`:i==="sum"?`cluster_sum_${s}`:`cluster_avg_${s}`;return t.some(o=>o.name===n)||t.push(new l2({name:n,isAutoGenerated:!0,onStatisticExpression:new vle({expression:e,returnType:r}),statisticType:i})),n}function sx(t,e,i,r,s){if(e==="cluster_count"||t.some(o=>o.name===e))return e;const n=FGt(i,e,s);return t.some(o=>o.name===n)||(i==="avg_norm"?t.push(new l2({name:n,isAutoGenerated:!0,onStatisticExpression:new vle({expression:`$feature.${e} / $feature.${s}`,returnType:r}),statisticType:"avg"})):t.push(new l2({name:n,isAutoGenerated:!0,onStatisticField:e,statisticType:i}))),n}const kGt=t=>{let e=class extends t{constructor(...i){super(...i),this.addHandles(te(()=>this.renderer,()=>{if(this.featureReduction){const r=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",r)}},or))}set featureReduction(i){const r=this._normalizeFeatureReduction(i);this._set("featureReduction",r)}set renderer(i){}_withClusterVariable(i,r,s){const n=i.clone();return"visualVariables"in n&&(n.visualVariables||(n.visualVariables=[]),n.visualVariables.some(o=>o.type==="size")||n.visualVariables.push(new cle({field:"cluster_count",stops:[new lV({value:1}),new lV({useMinValue:!0,size:r}),new lV({useMaxValue:!0,size:s})]}))),n}_normalizeFeatureReduction(i){var d;if((i==null?void 0:i.type)!=="cluster")return i;const r=i.clone(),s=[new l2({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],n=(r.fields??[]).filter(f=>!f.isAutoGenerated),o=i.renderer&&!((d=i.renderer.authoringInfo)!=null&&d.isAutoGenerated),{clusterMinSize:a,clusterMaxSize:l}=r;if(o){r.fields=[...s,...n];const f=this._withClusterVariable(r.renderer,a,l);return r.effectiveFeatureRenderer=f,r.effectiveClusterRenderer=f,r}if(i.symbol){if(r.fields=[...s,...n],r.renderer=null,!this.renderer)return r.effectiveFeatureRenderer=null,r.effectiveClusterRenderer=null,r;const f=awe(s,this.renderer),m=this._withClusterVariable(f,a,l),g="visualVariables"in m&&m.visualVariables?m.visualVariables:[],y=new gO({symbol:i.symbol,visualVariables:g});return r.fields=[...s,...n],r.effectiveFeatureRenderer=m,r.effectiveClusterRenderer=y,r}if(!this.renderer)return i;const c=awe(s,this.renderer);r.fields=[...s,...n],r.renderer=c;const u=this._withClusterVariable(c,a,l);return r.effectiveFeatureRenderer=u,r.effectiveClusterRenderer=u,r}};return h([p(CGt)],e.prototype,"featureReduction",null),e=h([I("esri.layers.mixins.FeatureReductionLayer")],e),e},lwe={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GeoRSS:!0,GroupLayer:!0,KML:!0,KnowledgeGraphLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},cwe={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0},uwe={ArcGISFeatureLayer:!0,SubtypeGroupTable:!0},UGt={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GroupLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,KML:!0,LineOfSightLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,RasterDataLayer:!0,VectorTileLayer:!0,Voxel:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/basemap":{ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-scene/tables":{ArcGISFeatureLayer:!0},"web-map/operational-layers":lwe,"web-map/basemap":cwe,"web-map/tables":uwe,"link-chart/operational-layers":{...lwe,LinkChartLayer:!0},"link-chart/basemap":cwe,"link-chart/tables":uwe,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,BuildingSceneLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,MediaLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,SubtypeGroupLayer:!0}},VGt=t=>{let e=class extends t{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId(i,r,s){var n;return((n=s==null?void 0:s.portalItem)==null?void 0:n.type)==="Group Layer"?void 0:i}writeListMode(i,r,s,n){(n&&n.layerContainerType==="ground"||i&&t7e(this,s,{},n))&&(r[s]=i)}writeOperationalLayerType(i,r,s,n){i&&(n==null?void 0:n.layerContainerType)!=="tables"&&(r.layerType=i)}writeTitle(i,r){r.title=i??"Layer"}readTimeExtent(i){return i?$a.fromArray(i):null}writeTimeExtent(i,r,s,n){i&&n.layerContainerType!=="tables"&&(i.isEmpty?n!=null&&n.messages&&n.messages.push(new G("layer:invalid-visibilityTimeExtent","visibilityTimeExtent cannot be empty")):r[s]=i.toArray())}read(i,r){r&&(r.layer=this),l2e(this,i,s=>super.read(i,s),r)}write(i,r){var o,a;if(!this.persistenceEnabled&&!(r!=null&&r.ignorePersistenceEnabled))return null;if(r!=null&&r.origin){const l=`${r.origin}/${r.layerContainerType||"operational-layers"}`,c=UGt[l];let u=!!(c!=null&&c[this.operationalLayerType]);if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(u=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&l==="web-map/operational-layers"&&(u=!1),!u)return(o=r.messages)==null||o.push(new G("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const s=super.write(i,{...r,layer:this}),n=!!r&&!!r.messages&&!!r.messages.filter(l=>l instanceof G&&l.name==="web-document-write:property-required").length;return MA(s==null?void 0:s.url)?((a=r==null?void 0:r.messages)==null||a.push(new G("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return h([p({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),h([ze("id",["id"])],e.prototype,"readId",null),h([p(tBe)],e.prototype,"listMode",void 0),h([We("listMode")],e.prototype,"writeListMode",null),h([p({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:Ia}}}}})],e.prototype,"operationalLayerType",void 0),h([We("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),h([p(Cte)],e.prototype,"opacity",void 0),h([p({type:Boolean,readOnly:!1})],e.prototype,"persistenceEnabled",void 0),h([p({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),h([We("title"),We(["web-scene"],"title")],e.prototype,"writeTitle",null),h([p({type:$a,json:{origins:{"web-scene":{write:{layerContainerTypes:Ia}}}}})],e.prototype,"visibilityTimeExtent",void 0),h([ze("visibilityTimeExtent")],e.prototype,"readTimeExtent",null),h([We(["portal-item","web-map","web-scene"],"visibilityTimeExtent",{visibilityTimeExtent:{type:[[Xi,UP]]}})],e.prototype,"writeTimeExtent",null),h([p({type:Boolean,json:{origins:{"web-scene":{name:"visibility",write:{enabled:!0,layerContainerTypes:Ia}}},name:"visibility",write:!0}})],e.prototype,"visible",void 0),e=h([I("esri.layers.mixins.OperationalLayer")],e),e};var Dte;const U5=new Ji({asc:"ascending",desc:"descending"});let KC=Dte=class extends Se{constructor(t){super(t),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new Dte({field:this.field,valueExpression:this.valueExpression,order:this.order})}};h([p({type:String,json:{write:!0}})],KC.prototype,"field",void 0),h([p({type:String,json:{write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],KC.prototype,"valueExpression",void 0),h([p({type:U5.apiValues,json:{type:U5.jsonValues,read:U5.read,write:U5.write}})],KC.prototype,"order",void 0),KC=Dte=h([I("esri.layers.support.OrderByInfo")],KC);const fBe=KC;function zGt(t,e,i){if(!t)return null;const r=t.find(n=>!!n.field);if(!r)return null;const s=new fBe;return s.read(r,i),[s]}function BGt(t,e,i,r){const s=t.find(n=>!!n.field);s&&ia(i,[s.toJSON()],e)}const jGt={type:[fBe],json:{origins:{"web-scene":{write:!1,read:!1}},name:"layerDefinition.orderBy",read:{reader:zGt},write:{writer:BGt}}},GGt=t=>{let e=class extends t{constructor(){super(...arguments),this.orderBy=null}};return h([p(jGt)],e.prototype,"orderBy",void 0),e=h([I("esri.layers.mixins.OrderedLayer")],e),e},HGt=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=qe(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(i){i!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",i))}readPortalItem(i,r,s){if(r.itemId)return new iS({id:r.itemId,portal:s==null?void 0:s.portal})}writePortalItem(i,r){i!=null&&i.id&&(r.itemId=i.id)}async loadFromPortal(i,r){var s;if((s=this.portalItem)!=null&&s.id)try{const{load:n}=await ce(()=>import("./layersLoader-B_gQ_-88.js"),__vite__mapDeps([228,9,7,8,6]));return Dt(r),await n({instance:this,supportedTypes:i.supportedTypes,validateItem:i.validateItem,supportsData:i.supportsData,layerModuleTypeMap:i.layerModuleTypeMap},r)}catch(n){throw os(n)||se.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${n}`),n}}async finishLoadEditablePortalLayer(i){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(i).catch(r=>(jl(r),!0)))}async setUserPrivileges(i,r){if(!rr.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(r);if(this.url)try{const{features:{edit:s,fullEdit:n},content:{updateItem:o}}=await this._fetchUserPrivileges(i,r);this._set("userHasEditingPrivileges",s),this._set("userHasFullEditingPrivileges",n),this._set("userHasUpdateItemPrivileges",o)}catch(s){jl(s)}}async _fetchUserPrivileges(i,r){let s=this.portalItem;if(!i||!s||!s.loaded||s.sourceUrl)return this._fetchFallbackUserPrivileges(r);const n=i===s.id;if(n&&s.portal.user)return whe(s);let o,a;if(n)o=s.portal.url;else try{o=await lEe(this.url,r)}catch(d){jl(d)}if(!o||!v7e(o,s.portal.url))return this._fetchFallbackUserPrivileges(r);try{const d=r!=null?r.signal:null;a=await(Bi==null?void 0:Bi.getCredential(`${o}/sharing`,{prompt:!1,signal:d}))}catch(d){jl(d)}const l=!0,c=!1,u=!1;if(!a)return{features:{edit:l,fullEdit:c},content:{updateItem:u}};try{if(n?await s.reload():(s=new iS({id:i,portal:{url:o}}),await s.load(r)),s.portal.user)return whe(s)}catch(d){jl(d)}return{features:{edit:l,fullEdit:c},content:{updateItem:u}}}async _fetchFallbackUserPrivileges(i){let r=!0;try{r=await this._fetchUserHasEditingPrivileges(i)}catch(s){jl(s)}return{features:{edit:r,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(i){const r=this.url?Bi==null?void 0:Bi.findCredential(this.url):null;if(!r)return!0;const s=V5.credential===r?V5.user:await this._fetchEditingUser(i);return V5.credential=r,V5.user=s,(s==null?void 0:s.privileges)==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(i){var u,d;const r=(d=(u=this.portalItem)==null?void 0:u.portal)==null?void 0:d.user;if(r)return r;const s=Bi==null?void 0:Bi.findServerInfo(this.url??"");if(!(s!=null&&s.owningSystemUrl))return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=Wn.getDefault();if(o&&o.loaded&&Zd(o.restUrl)===Zd(n))return o.user;const a=`${n}/community/self`,l=i!=null?i.signal:null,c=await Vh(yr(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?rre.fromJSON(c.value.data):null}read(i,r){r&&(r.layer=this),super.read(i,r)}write(i,r){var o;const s=r==null?void 0:r.portal,n=((o=this.portalItem)==null?void 0:o.id)&&(this.portalItem.portal||Wn.getDefault());return s&&n&&!g2e(n.restUrl,s.restUrl)?(r.messages&&r.messages.push(new G("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(i,{...r,layer:this})}};return h([p({type:iS})],e.prototype,"portalItem",null),h([ze("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),h([We("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),h([p({clonable:!1})],e.prototype,"resourceReferences",void 0),h([p({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),h([p({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),h([p({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=h([I("esri.layers.mixins.PortalLayer")],e),e},V5={credential:null,user:null};let DI=class extends Ue{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};h([p()],DI.prototype,"updating",void 0),h([p()],DI.prototype,"status",void 0),DI=h([I("esri.layers.support.PublishingInfo")],DI);const qGt=DI,WGt=Symbol(),ZGt=t=>{var e;let i=class extends t{constructor(){super(...arguments),this[e]=!0}get publishingInfo(){if(this.destroyed)return null;const r=this._get("publishingInfo");if(r)return r;const s=new qGt;return this._checkPublishingStatus(s),s}_checkPublishingStatus(r){let o=0;const a=async c=>{let u;r.updating=!0;try{u=await this.fetchPublishingStatus()}catch{u="unavailable"}u!=="published"&&u!=="unavailable"||(r.status==="publishing"&&this.refresh(),l.remove()),r.status=u,r.updating=!1,l.removed||(o=setTimeout(a,c,c+125))},l={removed:!1,remove(){this.removed=!0,clearTimeout(o)}};this.when().catch(()=>l.remove()),a(250),this.addHandles(l)}};return e=WGt,h([p({readOnly:!0,clonable:!1})],i.prototype,"publishingInfo",null),i=h([I("esri.layers.mixins.PublishableLayer")],i),i},q1=new st,U3=new WeakMap;function YGt(t){JGt(t)&&q1.push(new WeakRef(t))}function XGt(t){const e=q1.find(i=>i.deref()===t);e&&q1.remove(e)}function JGt(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function mBe(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:mBe(e,t%e):0}let eW=0,z5=0;function QGt(){const t=Date.now();let e=!1;for(const i of q1){const r=i.deref();r?r.refreshInterval&&t-(U3.get(r)??0)+5>=6e4*r.refreshInterval&&(U3.set(r,t),r.refresh(t)):e=!0}if(e)for(let i=q1.length-1;i>=0;i--)q1.at(i).deref()||q1.removeAt(i)}FSe(()=>{const t=Date.now();let e=0;for(const i of q1){const r=i.deref();r&&(e=mBe(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?U3.get(r)||U3.set(r,t):U3.delete(r))}if(e!==z5){if(z5=e,clearInterval(eW),z5===0)return void(eW=0);eW=setInterval(QGt,z5)}});function ndi(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const hwe=.1,KGt=t=>{let e=class extends t{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=q0(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||YGt(this)},()=>{})}destroy(){XGt(this)}castRefreshInterval(i){return i>=hwe?i:i<=0?0:hwe}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){H0(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{se.getLogger(this).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}get test(){}};return h([p({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:Ia}}}}})],e.prototype,"refreshInterval",void 0),h([Kt("refreshInterval")],e.prototype,"castRefreshInterval",null),h([p({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),h([p({readOnly:!0})],e.prototype,"refreshParameters",null),e=h([I("esri.layers.mixins.RefreshableLayer")],e),e},e6t=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const i={minScale:this.minScale,maxScale:this.maxScale},r=this.parent;r&&"effectiveScaleRange"in r&&t6t(i,r.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===i.minScale&&s.maxScale===i.maxScale?s:i}};return h([p({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),h([p({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),h([p({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=h([I("esri.layers.mixins.ScaleRangeLayer")],e),e};function t6t(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}function dwe(t,e){return qA.fromJSON({value:t,unit:e})}let Wa=class extends Jr(Se){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeZone=null,this.trackIdField=null,this.useTime=!0,this.stops=null}readFullTimeExtent(e,i){return i.timeExtent&&Array.isArray(i.timeExtent)&&i.timeExtent.length===2?$a.fromArray(i.timeExtent):null}writeFullTimeExtent(e,i){(e==null?void 0:e.start)!=null&&e.end!=null?i.timeExtent=e.toArray():i.timeExtent=null}readInterval(e,i){return i.timeInterval&&i.timeIntervalUnits?dwe(i.timeInterval,i.timeIntervalUnits):i.defaultTimeInterval&&i.defaultTimeIntervalUnits?dwe(i.defaultTimeInterval,i.defaultTimeIntervalUnits):null}writeInterval(e,i){i.timeInterval=(e==null?void 0:e.toJSON().value)??null,i.timeIntervalUnits=(e==null?void 0:e.toJSON().unit)??null}};h([p({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],Wa.prototype,"cumulative",void 0),h([p({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],Wa.prototype,"endField",void 0),h([p({type:$a,json:{write:{enabled:!0,allowNull:!0}}})],Wa.prototype,"fullTimeExtent",void 0),h([ze("fullTimeExtent",["timeExtent"])],Wa.prototype,"readFullTimeExtent",null),h([We("fullTimeExtent")],Wa.prototype,"writeFullTimeExtent",null),h([p({type:Boolean,json:{write:!0}})],Wa.prototype,"hasLiveData",void 0),h([p({type:qA,json:{write:{enabled:!0,allowNull:!0}}})],Wa.prototype,"interval",void 0),h([ze("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Wa.prototype,"readInterval",null),h([We("interval")],Wa.prototype,"writeInterval",null),h([p({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],Wa.prototype,"startField",void 0),h([p(NV("timeReference",!0))],Wa.prototype,"timeZone",void 0),h([p({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Wa.prototype,"trackIdField",void 0),h([p({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],Wa.prototype,"useTime",void 0),h([p({type:[Date],json:{read:!1}})],Wa.prototype,"stops",void 0),Wa=h([I("esri.layers.support.TimeInfo")],Wa);const gBe=Wa,i6t={type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation",layerContainerTypes:Ia}}},r6t=t=>{let e=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(i,r){const s=r.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=Are.fromJSON(s.timeOffsetUnits);return n&&o?new qA({value:n,unit:o}):null}set timeInfo(i){eOe(i,this.fieldsIndex),this._set("timeInfo",i)}};return h([p({type:$a,json:{write:!1}})],e.prototype,"timeExtent",void 0),h([p({type:qA})],e.prototype,"timeOffset",void 0),h([ze("service","timeOffset",["timeInfo.exportOptions"])],e.prototype,"readOffset",null),h([p({value:null,type:gBe,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"timeInfo",null),h([p(i6t)],e.prototype,"useViewTime",void 0),e=h([I("esri.layers.mixins.TemporalLayer")],e),e},pwe=new Ji({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let l1=class extends Jr(Se){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};h([p({json:{write:!0}})],l1.prototype,"name",void 0),h([p({json:{write:!0}})],l1.prototype,"description",void 0),h([p({json:{read:pwe.read,write:pwe.write}})],l1.prototype,"drawingTool",void 0),h([p({json:{write:!0}})],l1.prototype,"prototype",void 0),h([p({json:{write:!0}})],l1.prototype,"thumbnail",void 0),l1=h([I("esri.layers.support.FeatureTemplate")],l1);const ble=l1;let w0=class extends Jr(Se){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const i={};for(const r of Object.keys(e))i[r]=jG(e[r]);return i}writeDomains(e,i){var s;const r={};for(const n of Object.keys(e))e[n]&&(r[n]=(s=e[n])==null?void 0:s.toJSON());i.domains=r}};h([p({json:{write:!0}})],w0.prototype,"id",void 0),h([p({json:{write:!0}})],w0.prototype,"name",void 0),h([p({json:{write:!0}})],w0.prototype,"domains",void 0),h([ze("domains")],w0.prototype,"readDomains",null),h([We("domains")],w0.prototype,"writeDomains",null),h([p({type:[ble],json:{write:!0}})],w0.prototype,"templates",void 0),w0=h([I("esri.layers.support.FeatureType")],w0);const yBe=w0;function s6t(){return{fields:{type:[GG],value:null,set:function(t){if(t&&le("big-integer-warning-enabled")){const e=t.filter(i=>i.type==="big-integer"||i.type==="oid"&&(i.length||0)>=8);if(e.length){const i=e.map(r=>`'${r.name}'`).join(", ");se.getLogger(this).warn("#fields",`Layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}') references big-integer field(s): ${i}, support for which is experimental. Only integers less than ${Number.MAX_SAFE_INTEGER} (Number.MAX_SAFE_INTEGER) are supported.`)}}this._set("fields",t)}},fieldsIndex:{readOnly:!0,get(){return Fze.fromLayer(this)}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){var e;const t=this._userOutFields;if(!(t!=null&&t.length))return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const i of t)((e=this.fieldsIndex)==null?void 0:e.has(i))||se.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${i} found in outFields`,{layer:this,outFields:t});return yse(this.fieldsIndex,t)}}}}const tW=()=>se.getLogger("esri.layers.support.labelingInfo"),n6t=/\[([^[\]]+)\]/gi;function iW(t,e,i){return t?t.map(r=>{var n;const s=new cH;if(s.read(r,i),s.labelExpression){const o=e.fields||((n=e.layerDefinition)==null?void 0:n.fields)||this.fields;s.labelExpression=s.labelExpression.replaceAll(n6t,(a,l)=>`[${o6t(l,o)}]`)}return s}):null}function o6t(t,e){if(!e)return t;const i=t.toLowerCase();for(let r=0;r<e.length;r++){const s=e[r].name;if(s.toLowerCase()===i)return s}return t}const a6t={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along","above-along","below-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};function cdi(t,e){const i=[];for(const r of t){const s=r.labelPlacement,n=a6t[e];if(!r.symbol)return tW().warn("No ILabelClass symbol specified."),[];if(!n)return tW().error(new G("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),[];if(n.includes(s))i.push(r);else{const o=n[0];s&&tW().warn(`Found invalid label placement type ${s} for ${e}. Defaulting to ${o}`);const a=r.clone();a.labelPlacement=o,i.push(a)}}return i}const eM=[];function l6t(t,e){if(QCe(t.url??""))return!0;const{wkid:i}=e;for(const r of eM){if((t.version??0)>=r[0])return!0;if(typeof r[1]=="function"&&(r[1]=r[1]()),r[1].has(i))return!1}return!0}eM.push([10.91,()=>{const t=new Set([9709,9716,9741,9761,9766]);for(let e=9712;e<=9713;e++)t.add(e);for(let e=9748;e<=9749;e++)t.add(e);for(let e=20904;e<=20932;e++)t.add(e);for(let e=21004;e<=21032;e++)t.add(e);for(let e=21207;e<=21264;e++)t.add(e);for(let e=21307;e<=21364;e++)t.add(e);for(let e=23301;e<=23333;e++)t.add(e);for(let e=102759;e<=102760;e++)t.add(e);for(let e=102934;e<=102955;e++)t.add(e);return t}]),eM.push([10.9,()=>{const t=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let e=9356;e<=9360;e++)t.add(e);for(let e=9404;e<=9407;e++)t.add(e);for(let e=9476;e<=9482;e++)t.add(e);for(let e=9487;e<=9494;e++)t.add(e);for(let e=9697;e<=9699;e++)t.add(e);return t}]),eM.push([10.81,()=>{const t=new Set([9265,9333,103598,103699]);for(let e=9248;e<=9254;e++)t.add(e);for(let e=9271;e<=9273;e++)t.add(e);for(let e=9284;e<=9285;e++)t.add(e);for(let e=21453;e<=21463;e++)t.add(e);return t}]),eM.push([10.8,()=>{const t=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let e=8035;e<=8036;e++)t.add(e);for(let e=8455;e<=8456;e++)t.add(e);for(let e=8518;e<=8529;e++)t.add(e);for(let e=8533;e<=8536;e++)t.add(e);for(let e=8538;e<=8540;e++)t.add(e);for(let e=8677;e<=8679;e++)t.add(e);for(let e=8902;e<=8903;e++)t.add(e);for(let e=8907;e<=8910;e++)t.add(e);for(let e=8949;e<=8951;e++)t.add(e);for(let e=8972;e<=8987;e++)t.add(e);for(let e=9039;e<=9040;e++)t.add(e);for(let e=9068;e<=9069;e++)t.add(e);for(let e=9140;e<=9141;e++)t.add(e);for(let e=9148;e<=9150;e++)t.add(e);for(let e=9153;e<=9159;e++)t.add(e);for(let e=9205;e<=9218;e++)t.add(e);for(let e=9221;e<=9222;e++)t.add(e);for(let e=54098;e<=54101;e++)t.add(e);return t}]),eM.push([10.71,()=>{const t=new Set([6316]);for(let e=8351;e<=8353;e++)t.add(e);for(let e=9294;e<=9297;e++)t.add(e);for(let e=22619;e<=22621;e++)t.add(e);for(let e=103586;e<=103594;e++)t.add(e);return t}]);async function c6t(t,e,i){const r=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(r&&r.type==="unique-value"&&r.styleOrigin){const s=await Vh(r.populateFromStyle());if(Dt(i),s.ok===!1){const n=s.error;e!=null&&e.messages&&e.messages.push(new Jg("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:e})),t.clear("renderer",e==null?void 0:e.origin)}}}function u6t({displayField:t,editFieldsInfo:e,fields:i,objectIdField:r,title:s},n){if(!i)return null;const o=f6t({editFieldsInfo:e,fields:i,objectIdField:r},n);if(!o.length)return null;const a=y6t({titleBase:s,fields:i,displayField:t}),l=g6t();return new PD({title:a,content:l,fieldInfos:o})}const h6t=(t,e)=>e.visibleFieldNames?e.visibleFieldNames.has(t.name):Pnt(t,e);function d6t(t,e){const i=t;return e&&(t=t.filter(r=>!e.includes(r.type))),t===i&&(t=t.slice()),t.sort(p6t),t}function p6t(t,e){return t.type==="oid"?-1:e.type==="oid"?1:fwe(t)?-1:fwe(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function f6t(t,e){const i=e==null?void 0:e.visibleFieldNames;return d6t(t.fields??[],(e==null?void 0:e.ignoreFieldTypes)||_6t).map(r=>new AD({fieldName:r.name,isEditable:Ant(r,t),label:r.alias,format:m6t(r),visible:h6t(r,{...t,visibleFieldNames:i})}))}function m6t(t){switch(t.type){case"small-integer":case"integer":case"single":return new Dk({digitSeparator:!0,places:0});case"double":return new Dk({digitSeparator:!0,places:2});case"string":return zY(t.name)?new Dk({digitSeparator:!0,places:0}):void 0;default:return}}function g6t(){return[new sP,new mL]}function y6t(t){const e=_nt(t),{titleBase:i}=t;return e?`${i}: {${e.trim()}}`:i??""}function fwe(t){var i;return(t.name&&t.name.toLowerCase())==="name"?!0:((i=t.alias)==null?void 0:i.toLowerCase())==="name"}const _6t=["geometry","blob","raster","guid","xml"],fc="FeatureLayer";function B5(t,e){return new G("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}function mwe(t){return t&&t instanceof st}const rW=s6t();function sW(t,e,i){const r=!!(i!=null&&i.writeLayerSchema);return{enabled:r,ignoreOrigin:r}}let Lt=class extends TGt(kGt(Ejt(ZGt(wjt(mjt(GGt(r6t(e6t(KGt(djt(VGt(HGt(wre(gjt(hjt(Jr(lL))))))))))))))))){constructor(...t){super(...t),this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.resourceInfo=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=Ze.WGS84,this.subtypeCode=null,this.supportedSourceTypes=new Set(["Feature Layer","Oriented Imagery Layer","Table","Catalog Layer"]),this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0,this._debouncedSaveOperations=q0(async(e,i,r)=>{const{save:s,saveAs:n}=await ce(()=>import("./featureLayerUtils-gPde6IrT.js"),__vite__mapDeps([229,230,9]));switch(e){case Cg.SAVE:return s(this,i);case Cg.SAVE_AS:return n(this,r,i)}})}destroy(){var t;(t=this.source)==null||t.destroy()}normalizeCtorArgs(t,e){return typeof t=="string"?{url:t,...e}:t}load(t){var r;const e=t!=null?t.signal:null;if((r=this.portalItem)!=null&&r.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(e).then(s=>this.initLayerProperties(s))),Promise.resolve(this);const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"]},t).catch(jl).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const s=await this._fetchFirstValidLayerId(e);s!=null&&(this.layerId=s)}if(!this.url&&!this._hasMemorySource())throw new G("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(e))}).then(()=>iGt(this,"load",t));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(t,e){return e=e.layerDefinition||e,oBe(e,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){var t;return!(this.loaded&&!((t=this.capabilities)!=null&&t.operations.supportsEditing))&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(t){this._overrideIfSome("editingEnabled",t)}readEditingEnabled(t,e){return this._readEditingEnabled(e,!1)}readEditingEnabledFromWebMap(t,e,i){return this._readEditingEnabled(e,!0,i)}writeEditingEnabled(t,e){this._writeEditingEnabled(t,e,!1)}writeEditingEnabledToWebMap(t,e,i,r){this._writeEditingEnabled(t,e,!0,r)}get effectiveEditingEnabled(){return rGt(this)}readIsTable(t,e){return(e=(e==null?void 0:e.layerDefinition)??e).type==="Table"||!e.geometryType}writeIsTable(t,e,i,r){r!=null&&r.writeLayerSchema&&ia(i,t?"Table":"Feature Layer",e)}readGlobalIdField(t,e){return rBe(e.layerDefinition||e)}readObjectIdField(t,e){return sBe(e.layerDefinition||e)}get parsedUrl(){const t=un(this.url);return t!=null&&(this.dynamicDataSource!=null?t.path=Uh(t.path,"dynamicLayer"):this.layerId!=null&&(t.path=Uh(t.path,this.layerId.toString()))),t}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(t){Vde(t,this.fieldsIndex),this._set("renderer",t)}readRenderer(t,e,i){var s;e=e.layerDefinition||e;const r=(s=e.drawingInfo)==null?void 0:s.renderer;if(r){const n=JL(r,e,i)??void 0;return n||se.getLogger(this).error("Failed to create renderer",{rendererDefinition:e.drawingInfo.renderer,layer:this,context:i}),n}return _le(e,i)}set source(t){const e=this._get("source");e!==t&&(mwe(e)&&this._resetMemorySource(e),mwe(t)&&this._initMemorySource(t),this._set("source",t))}castSource(t){return t?Array.isArray(t)||t instanceof st?new P0({layer:this,items:t}):t:null}readSource(t,e){const i=nle.fromJSON(e.featureSet);return new P0({layer:this,items:(i==null?void 0:i.features)??[]})}readTemplates(t,e){const i=e.editFieldsInfo,r=i==null?void 0:i.creatorField,s=i==null?void 0:i.editorField;return t=t==null?void 0:t.map(n=>ble.fromJSON(n)),this._fixTemplates(t,r),this._fixTemplates(t,s),t}readTitle(t,e){var s,n,o;const i=((s=e.layerDefinition)==null?void 0:s.name)??e.name,r=e.title||((n=e.layerDefinition)==null?void 0:n.title);if(i){const a=(o=this.portalItem)==null?void 0:o.title;if(this.sublayerTitleMode==="item-title")return this.url?yJe(this.url,i):i;let l=i;if(!l&&this.url){const c=WP(this.url);c!=null&&(l=c.title)}return l?(this.sublayerTitleMode==="item-title-and-service-name"&&a&&a!==l&&(l=a+" - "+l),Mre(l)):void 0}if(this.sublayerTitleMode==="item-title"&&r)return r}readTitleFromWebMap(t,e){var i;return e.title||((i=e.layerDefinition)==null?void 0:i.name)}readTypeIdField(t,e){let i=(e=e.layerDefinition||e).typeIdField;if(i&&e.fields){i=i.toLowerCase();const r=e.fields.find(s=>s.name.toLowerCase()===i);r&&(i=r.name)}return i}readTypes(t,e){t=(e=e.layerDefinition||e).types;const i=e.editFieldsInfo,r=i==null?void 0:i.creatorField,s=i==null?void 0:i.editorField;return t==null?void 0:t.map(n=>(n=yBe.fromJSON(n),this._fixTemplates(n.templates,r),this._fixTemplates(n.templates,s),n))}readVisible(t,e){var i;return((i=e.layerDefinition)==null?void 0:i.defaultVisibility)!=null?!!e.layerDefinition.defaultVisibility:e.visibility!=null?!!e.visibility:void 0}async addAttachment(t,e){return Ujt(this,t,e,fc)}async updateAttachment(t,e,i){return Vjt(this,t,e,i,fc)}async applyEdits(t,e){return zjt(this,t,e)}async uploadAssets(t,e){return Bjt(this,t,e)}on(t,e){return super.on(t,e)}createPopupTemplate(t){return u6t(this,t)}async createGraphicsSource(t){if(this._hasMemorySource()&&this.source)return this.source.load({signal:t});const{default:e}=await Sie(ce(()=>import("./FeatureLayerSource-Bxx-OAnq.js"),__vite__mapDeps([231,101,102,100,227,31,28,232,233,234])),t);return new e({layer:this,supportedSourceTypes:this.supportedSourceTypes}).load({signal:t})}createQuery(){const t=Qjt(this);t.dynamicDataSource=this.dynamicDataSource;const e=this.subtypeCode!=null?`${this.subtypeField} = ${this.subtypeCode}`:null,i=int(this.definitionExpression,e);return t.where=i||"1=1",t}async deleteAttachments(t,e){return jjt(this,t,e,fc)}async fetchRecomputedExtents(t){return Gjt(this,t,fc)}getFeatureType(t){return oGt(this.types,this.typeIdField,t)}getFieldDomain(t,e){var n;const i=e==null?void 0:e.feature,r=eGt(this,i);if(r){const o=(n=r.domains)==null?void 0:n[t];return(o==null?void 0:o.type)==="inherited"?this._getLayerDomain(t):o}const s=this.getFeatureType(i);if(s){const o=s.domains&&s.domains[t];if(o&&o.type!=="inherited")return o}return this._getLayerDomain(t)}getField(t){return this.fieldsIndex.get(t)}async queryAttachments(t,e){return Hjt(this,t,e,fc)}async queryFeatures(t,e){const i=await this.load(),r=await i.source.queryFeatures(Lh.from(t)??i.createQuery(),e);if(r!=null&&r.features)for(const s of r.features)s.layer=s.sourceLayer=i;return r}async queryObjectIds(t,e){return qjt(this,t,e,fc)}async queryFeatureCount(t,e){return Wjt(this,t,e,fc)}async queryExtent(t,e){return Zjt(this,t,e,fc)}async queryRelatedFeatures(t,e){return Yjt(this,t,e,fc)}async queryRelatedFeaturesCount(t,e){return Xjt(this,t,e,fc)}async queryTopFeatures(t,e){var n;const{source:i,capabilities:r}=await this.load();if(!i.queryTopFeatures||!((n=r==null?void 0:r.query)!=null&&n.supportsTopFeaturesQuery))throw new G(fc,"Layer source does not support queryTopFeatures capability");const s=await i.queryTopFeatures(A5.from(t),e);if(s!=null&&s.features)for(const o of s.features)o.layer=o.sourceLayer=this;return s}async queryTopObjectIds(t,e){const{source:i,capabilities:r}=await this.load();if(!i.queryTopObjectIds||!(r!=null&&r.query.supportsTopFeaturesQuery))throw new G(fc,"Layer source does not support queryTopObjectIds capability");return i.queryTopObjectIds(A5.from(t),e)}async queryTopFeaturesExtent(t,e){var s;const{source:i,capabilities:r}=await this.load();if(!i.queryTopExtents||!((s=r==null?void 0:r.query)!=null&&s.supportsTopFeaturesQuery))throw new G(fc,"Layer source does not support queryTopExtents capability");return i.queryTopExtents(A5.from(t),e)}async queryTopFeatureCount(t,e){var s;const{source:i,capabilities:r}=await this.load();if(!i.queryTopCount||!((s=r==null?void 0:r.query)!=null&&s.supportsTopFeaturesQuery))throw new G(fc,"Layer source does not support queryFeatureCount capability");return i.queryTopCount(A5.from(t),e)}read(t,e){const i=t.featureCollection;if((i||t.type==="Feature Collection")&&(this.resourceInfo=t),i){const r=i.layers;r&&r.length===1&&(super.read(r[0],e),i.showLegend!=null&&super.read({showLegend:i.showLegend},e))}super.read(t,e),e&&e.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo","dateFieldsTimeZone"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(t,e){e={...e,origin:(e==null?void 0:e.origin)??void 0,writeLayerSchema:(e==null?void 0:e.writeLayerSchema)??this._hasMemorySource()};const{origin:i,layerContainerType:r,messages:s}=e;if(this.dynamicDataSource)return s==null||s.push(B5(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if((i==="web-map"||i==="web-scene")&&r!=="tables")return s==null||s.push(B5(this,`a table source can only be written to tables, not ${r}`)),null;if(this._hasMemorySource())return s==null||s.push(B5(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&(i==="web-map"||i==="web-scene")&&r==="tables")return s==null||s.push(B5(this,"using a non-table source cannot be written to tables in web maps or web scenes")),null;return super.write(t,e)}clone(){if(this._hasMemorySource())throw new G(fc,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(t){var e;return!!this.loaded&&(((e=this.source)==null?void 0:e.type)==="memory"||l6t(this,t))}async save(t){return this._debouncedSaveOperations(Cg.SAVE,t)}async saveAs(t,e){return this._debouncedSaveOperations(Cg.SAVE_AS,e,t)}_readEditingEnabled(t,e,i){var s;let r=(s=t.layerDefinition)==null?void 0:s.capabilities;return r?this._hasEditingCapability(r):(r=t.capabilities,e&&(i==null?void 0:i.origin)==="web-map"&&!this._hasMemorySource()&&r?this._hasEditingCapability(r):void 0)}_hasEditingCapability(t){return t.toLowerCase().split(",").map(e=>e.trim()).includes("editing")}_writeEditingEnabled(t,e,i,r){var s,n;if(!t){const o=(n=(s=this.capabilities)==null?void 0:s.operations)!=null&&n.supportsSync?"Query,Sync":"Query";ia("layerDefinition.capabilities",o,e),i&&!(r!=null&&r.writeLayerSchema)&&(e.capabilities=o)}}_getLayerDomain(t){const e=this.fieldsIndex.get(t);return e?e.domain:null}_fetchFirstValidLayerId(t){return yr(this.url??"",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:t}).then(e=>{const i=e.data;if(i)return this.findFirstValidLayerId(i)})}async initLayerProperties(t){var e;return this._set("source",t),t.sourceJSON&&(this.sourceJSON=t.sourceJSON,this.read(t.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:(e=this.portalItem)==null?void 0:e.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),Vde(this.renderer,this.fieldsIndex),eOe(this.timeInfo,this.fieldsIndex),c6t(this,{origin:"service"})}async hasDataChanged(){return Jjt(this)}async fetchPublishingStatus(){const t=this.source;return t!=null&&t.fetchPublishingStatus?t.fetchPublishingStatus():"unavailable"}_verifyFields(){var e,i;const t=((e=this.parsedUrl)==null?void 0:e.path)??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+t+")"),this.isTable||this._hasMemorySource()||t.search(/\/FeatureServer\//i)!==-1||(i=this.fields)!=null&&i.some(r=>r.type==="geometry")||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+t+")")}_fixTemplates(t,e){t&&t.forEach(i=>{var s;const r=(s=i.prototype)==null?void 0:s.attributes;r&&e&&delete r[e]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new G("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new G("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(t){t.forEach(e=>{e.layer=this,e.sourceLayer=this}),this.addHandles([t.on("after-add",e=>{e.item.layer=this,e.item.sourceLayer=this}),t.on("after-remove",e=>{e.item.layer=null,e.item.sourceLayer=null})],"fl-source")}_resetMemorySource(t){t.forEach(e=>{e.layer=null,e.sourceLayer=null}),this.removeHandles("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}findFirstValidLayerId(t){return Array.isArray(t.layers)&&t.layers.length>0?t.layers[0].id:Array.isArray(t.tables)&&t.tables.length>0?t.tables[0].id:void 0}};h([ze("service","capabilities")],Lt.prototype,"readCapabilities",null),h([p({json:{origins:{"web-scene":{write:!1}},write:!0}})],Lt.prototype,"charts",void 0),h([p({readOnly:!0})],Lt.prototype,"createQueryVersion",null),h([p({json:{read:{source:"layerDefinition.copyrightText"}}})],Lt.prototype,"copyright",void 0),h([p({json:{read:{source:"layerDefinition.displayField"}}})],Lt.prototype,"displayField",void 0),h([p({types:fS,readOnly:!0})],Lt.prototype,"defaultSymbol",void 0),h([p({type:nf})],Lt.prototype,"dynamicDataSource",void 0),h([p({type:Boolean})],Lt.prototype,"editingEnabled",null),h([ze(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Lt.prototype,"readEditingEnabled",null),h([ze("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Lt.prototype,"readEditingEnabledFromWebMap",null),h([We(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Lt.prototype,"writeEditingEnabled",null),h([We("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Lt.prototype,"writeEditingEnabledToWebMap",null),h([p({readOnly:!0})],Lt.prototype,"effectiveEditingEnabled",null),h([p({...rW.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:sW}}}}})],Lt.prototype,"fields",void 0),h([p(rW.fieldsIndex)],Lt.prototype,"fieldsIndex",void 0),h([p({type:ojt,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Lt.prototype,"formTemplate",void 0),h([p({json:{read:{source:"layerDefinition.extent"}}})],Lt.prototype,"fullExtent",void 0),h([p({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:sW,writer(t,e,i){const r=t?Mte.toJSON(t):null;r&&ia(i,r,e)}}}},read:{source:"layerDefinition.geometryType",reader:Mte.read}}})],Lt.prototype,"geometryType",void 0),h([p({json:{read:{source:"layerDefinition.hasM"}}})],Lt.prototype,"hasM",void 0),h([p({json:{read:{source:"layerDefinition.hasZ"}}})],Lt.prototype,"hasZ",void 0),h([p($jt)],Lt.prototype,"id",void 0),h([p({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],Lt.prototype,"infoFor3D",void 0),h([p({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Lt.prototype,"isTable",void 0),h([ze("service","isTable",["type","geometryType"]),ze("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Lt.prototype,"readIsTable",null),h([We("web-map","isTable")],Lt.prototype,"writeIsTable",null),h([p(gle)],Lt.prototype,"labelsVisible",void 0),h([p({type:[cH],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:iW,write:!1},"web-scene":{name:"layerDefinition.drawingInfo.labelingInfo",read:iW,write:{enabled:!0,layerContainerTypes:Ia}}},name:"layerDefinition.drawingInfo.labelingInfo",read:iW,write:!0}})],Lt.prototype,"labelingInfo",void 0),h([p((()=>{const t=ie(Rjt);return t.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,i,r){ia(r,yD(e),i)}}},t})())],Lt.prototype,"opacity",void 0),h([p(Pjt)],Lt.prototype,"legendEnabled",void 0),h([p({type:["show","hide"],json:(()=>{const t=ie(tBe.json);return t.origins["portal-item"]={read:!1,write:!1},t})()})],Lt.prototype,"listMode",void 0),h([ze("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],Lt.prototype,"readGlobalIdField",null),h([p({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:sW}}}}})],Lt.prototype,"objectIdField",void 0),h([ze("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],Lt.prototype,"readObjectIdField",null),h([p({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Lt.prototype,"operationalLayerType",void 0),h([p(rW.outFields)],Lt.prototype,"outFields",void 0),h([p({readOnly:!0})],Lt.prototype,"parsedUrl",null),h([p({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Lt.prototype,"path",void 0),h([p(mle)],Lt.prototype,"popupEnabled",void 0),h([p({type:PD,json:{name:"popupInfo",write:!0}})],Lt.prototype,"popupTemplate",void 0),h([p({readOnly:!0})],Lt.prototype,"defaultPopupTemplate",null),h([p({types:lH,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:NBt,name:"layerDefinition.drawingInfo.renderer",write:{layerContainerTypes:Ia,overridePolicy:(t,e,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(t,e,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}})],Lt.prototype,"renderer",null),h([ze("service","renderer",["drawingInfo.renderer","defaultSymbol"]),ze("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Lt.prototype,"readRenderer",null),h([p()],Lt.prototype,"resourceInfo",void 0),h([p((()=>{const t=ie(Mjt);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],Lt.prototype,"screenSizePerspectiveEnabled",void 0),h([p({clonable:!1})],Lt.prototype,"source",null),h([Kt("source")],Lt.prototype,"castSource",null),h([ze("portal-item","source",["featureSet"]),ze("web-map","source",["featureSet"])],Lt.prototype,"readSource",null),h([p({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],Lt.prototype,"spatialReference",void 0),h([p({type:Number})],Lt.prototype,"subtypeCode",void 0),h([p({type:[ble]})],Lt.prototype,"templates",void 0),h([ze("templates",["editFieldsInfo","creatorField","editorField","templates"])],Lt.prototype,"readTemplates",null),h([p({type:gBe})],Lt.prototype,"timeInfo",void 0),h([p()],Lt.prototype,"title",void 0),h([ze("service","title",["name"]),ze("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Lt.prototype,"readTitle",null),h([ze("web-map","title",["layerDefinition.name","title"])],Lt.prototype,"readTitleFromWebMap",null),h([p({type:String})],Lt.prototype,"sublayerTitleMode",void 0),h([p({json:{read:!1}})],Lt.prototype,"type",void 0),h([p({type:String})],Lt.prototype,"typeIdField",void 0),h([ze("service","typeIdField"),ze("typeIdField",["layerDefinition.typeIdField"])],Lt.prototype,"readTypeIdField",null),h([p({type:[yBe]})],Lt.prototype,"types",void 0),h([ze("service","types",["types"]),ze("types",["layerDefinition.types"])],Lt.prototype,"readTypes",null),h([p({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Lt.prototype,"visible",void 0),h([ze("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Lt.prototype,"readVisible",null),Lt=h([I("esri.layers.FeatureLayer")],Lt);const _Be=Lt,udi=Object.freeze(Object.defineProperty({__proto__:null,default:_Be},Symbol.toStringTag,{value:"Module"})),v6t="esri.widgets.Feature.support.arcadeFeatureUtils",gwe=()=>se.getLogger(v6t);function b6t(t){return typeof t=="string"?pN(tle(t)):Array.isArray(t)?w6t(t):(t==null?void 0:t.declaredClass)==="esri.arcade.Dictionary"?x6t(t):t}function w6t(t){return`<ul class="esri-widget__list">${t.map(e=>`<li>${typeof e=="string"?pN(tle(e)):e}</li>`).join("")}</ul>`}function x6t(t){const e=t.keys().map(i=>{const r=t.field(i);return`<tr><th>${i}</th><td>${typeof r=="string"?pN(tle(r)):r}</td></tr>`}).join("");return`<table class="${ni.table}">${e}</table>`}function vBe(){return ce(()=>import("./arcade-x8KfXeCd.js"),__vite__mapDeps([235,27,70]))}function T6t(t){return"createQuery"in t&&"queryFeatures"in t}async function S6t({graphic:t,view:e,options:i}){const{isAggregate:r,layer:s}=t;if(!r||!s||(e==null?void 0:e.type)!=="2d")return[];const n=await e.whenLayerView(s);if(!T6t(n))return[];const o=n.createQuery(),a=t.getObjectId();o.aggregateIds=a!=null?[a]:[];const{features:l}=await n.queryFeatures(o,i);return l}function E6t({layer:t,aggregatedFeatures:e,interceptor:i}){const{fields:r,objectIdField:s,geometryType:n,spatialReference:o,displayField:a}=t;return new _Be({fields:r,objectIdField:s,geometryType:n,spatialReference:o,displayField:a,interceptor:i,...t.type==="feature"?{templates:t.templates,typeIdField:t.typeIdField,types:t.types}:null,source:e})}async function bBe({expressionInfo:t,arcade:e,interceptor:i,spatialReference:r,map:s,graphic:n,location:o,view:a,options:l}){var x;if(!(t!=null&&t.expression))return null;const{isAggregate:c}=n,u=(n.sourceLayer||n.layer)??void 0,d=c?"feature-reduction-popup":"popup",f=e.createArcadeProfile(d),m=e.createArcadeExecutor(t.expression,f).catch(S=>gwe().error("arcade-executor-error",{error:S,expressionInfo:t})),[g,y]=await Promise.all([S6t({graphic:n,view:a,options:l}),m]);if(!y)return null;const v=d==="feature-reduction-popup"?E6t({layer:u,aggregatedFeatures:g,interceptor:i}):void 0,b={...d==="feature-reduction-popup"?{$aggregatedFeatures:v}:{$datastore:u==null?void 0:u.url,$layer:(u==null?void 0:u.type)==="feature"||(u==null?void 0:u.type)==="subtype-sublayer"||(u==null?void 0:u.type)==="catalog-footprint"||(u==null?void 0:u.type)==="oriented-imagery"?u:(u==null?void 0:u.type)==="scene"&&u.associatedLayer!=null?u.associatedLayer:void 0,$map:s,$userInput:o,$graph:(u==null?void 0:u.type)==="knowledge-graph-sublayer"?(x=u==null?void 0:u.parentCompositeLayer)==null?void 0:x.knowledgeGraph:void 0},$feature:n},w={abortSignal:(l==null?void 0:l.signal)??void 0,interceptor:i??void 0,rawOutput:!0,spatialReference:r??void 0,timeZone:a==null?void 0:a.timeZone};return await y.executeAsync(b,w).catch(S=>gwe().error("arcade-execution-error",{error:S,graphic:n,expressionInfo:t})).finally(()=>v==null?void 0:v.destroy())}async function C6t({expressionInfos:t,spatialReference:e,graphic:i,interceptor:r,map:s,view:n,location:o,options:a}){if(!(t!=null&&t.length))return{};const l=await vBe(),c={};for(const f of t)c[`expression/${f.name}`]=bBe({expressionInfo:f,arcade:l,interceptor:r,spatialReference:e,map:s,graphic:i,location:o,view:n,options:a});const u=await jf(c),d={};for(const f in u)d[f]=b6t(u[f].value);return d}const M6t=1;let nu=class extends Ue{constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._cancelQuery=()=>{const{_abortController:i}=this;i&&i.abort(),this._abortController=null},this._createVM=()=>{var s,n;const i=(s=this.contentElement)==null?void 0:s.type;(n=this.contentElementViewModel)==null||n.destroy();const r=i==="fields"?new nH:i==="media"?new qT:i==="text"?new pj:null;this._set("contentElementViewModel",r)},this._compile=async()=>{this._cancelQuery();const i=new AbortController;this._abortController=i,await this._compileExpression(),this._abortController===i&&(this._abortController=null)},this._compileThrottled=hj(this._compile,M6t,this),this._compileExpression=async()=>{const{expressionInfo:i,graphic:r,interceptor:s,spatialReference:n,map:o,location:a,view:l,_abortController:c}=this;if(!i||!r)return void this._set("contentElement",null);const u=await vBe();if(c!==this._abortController)return;const d=await bBe({arcade:u,expressionInfo:i,graphic:r,location:a,interceptor:s,map:o,spatialReference:n,view:l});if(!d||d.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const f=await d.castAsJsonAsync(c==null?void 0:c.signal),m=f==null?void 0:f.type,g=m==="media"?gL.fromJSON(f):m==="text"?nP.fromJSON(f):m==="fields"?sP.fromJSON(f):null;this._set("contentElement",g)},this.addHandles([te(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),$t),te(()=>[this.contentElement],()=>this._createVM(),$t)])}initialize(){this.addHandles(this._compileThrottled)}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)??null}set spatialReference(e){this._override("spatialReference",e)}get state(){const{_abortController:e,contentElement:i,contentElementViewModel:r}=this;return e?"loading":i||r?"ready":"disabled"}get map(){var e;return((e=this.view)==null?void 0:e.map)??null}set map(e){this._override("map",e)}};h([p()],nu.prototype,"_abortController",void 0),h([p({type:uOe})],nu.prototype,"expressionInfo",void 0),h([p({type:ca})],nu.prototype,"graphic",void 0),h([p({readOnly:!0})],nu.prototype,"contentElement",void 0),h([p({readOnly:!0})],nu.prototype,"contentElementViewModel",void 0),h([p()],nu.prototype,"interceptor",void 0),h([p({type:bt})],nu.prototype,"location",void 0),h([p()],nu.prototype,"spatialReference",null),h([p({readOnly:!0})],nu.prototype,"state",null),h([p()],nu.prototype,"map",null),h([p()],nu.prototype,"view",void 0),nu=h([I("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],nu);const wle=nu,ywe="esri-feature",_we={base:`${ywe}-expression`,loadingSpinnerContainer:`${ywe}__loading-container`};let SV=class extends Ua{constructor(e,i){super(e,i),this._contentWidget=null,this.viewModel=new wle}initialize(){this.addHandles(te(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),$t))}loadDependencies(){return sm({loader:()=>ce(()=>import("./calcite-loader-DVZXO4Kd.js"),__vite__mapDeps([236,208,199]))})}destroy(){this._destroyContentWidget()}render(){var i;const{state:e}=this.viewModel;return ge("div",{class:_we.base},e==="loading"?this._renderLoading():e==="disabled"?null:(i=this._contentWidget)==null?void 0:i.render())}_renderLoading(){return ge("div",{class:_we.loadingSpinnerContainer,key:"loading-container"},ge("calcite-loader",{inline:!0,label:""}))}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:i}=this.viewModel,r=i==null?void 0:i.type;this._destroyContentWidget();const s=e?r==="fields"?new xze({viewModel:e}):r==="media"?new Aze({viewModel:e}):r==="text"?new rV({viewModel:e}):null:null;this._contentWidget=s,this.scheduleRender()}};h([p({type:wle})],SV.prototype,"viewModel",void 0),SV=h([I("esri.widgets.Feature.FeatureExpression")],SV);const A6t=SV;var vwe;(function(t){t.TOO_SHORT="length-validation-error::too-short",t.TOO_LONG="length-validation-error::too-long"})(vwe||(vwe={}));const P6t=t=>{var i;const e=[];if(t.formTemplate){const{description:r,title:s}=t.formTemplate;(i=t.fields)==null||i.forEach(n=>{const o=s&&zce(s,n.name),a=r&&zce(r,n.name);(o||a)&&e.push(n.name)})}return e},nW=100;let es=class extends Jr(bD(Ue)){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:i}=this;i&&i.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:i}=this;i&&i.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:i}=this;i&&i.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const i=new AbortController;this._queryAbortController=i,await H0(this._query()),this._queryAbortController===i&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._loaded=!1,this._cancelQueryFeatureCount();const i=new AbortController;this._queryFeatureCountAbortController=i,await H0(this._queryFeatureCount()),this._queryFeatureCountAbortController===i&&(this._queryFeatureCountAbortController=null),this._loaded=!0},this._queryPageController=async()=>{const i=new AbortController;this._queryPageAbortController=i,await H0(this._queryPage()),this._queryPageAbortController===i&&(this._queryPageAbortController=null)},this._queryDebounced=q0(this._queryController,nW),this._queryFeatureCountDebounced=q0(this._queryFeatureCountController,nW),this._queryPageDebounced=q0(this._queryPageController,nW),this._query=async()=>{const{_queryAbortController:i,relatedFeatures:r}=this;this.featureCount&&(this._destroyRelatedFeatureViewModels(),this.featurePage=1,r.destroyAll(),this.destroyed||r.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:i==null?void 0:i.signal}))))},this.addHandles([te(()=>{var i;return[this.displayCount,this.graphic,this.layer,(i=this.layer)==null?void 0:i.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount]},()=>this._queryDebounced(),$t),te(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),te(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.destroyAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){const{featuresPerPage:i,featureCount:r}=this,s=1,n=Math.ceil(r/i)||1;this._set("featurePage",Math.min(Math.max(e,s),n))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:e,relatedLayer:i}=this;return e&&(i!=null&&i.loaded)?e.map(r=>{const s=r.clone();return s.field=XL(r.field,i),s}):e??[]}get supportsCacheHint(){var e,i,r;return!!((r=(i=(e=this.layer)==null?void 0:e.capabilities)==null?void 0:i.queryRelated)!=null&&r.supportsCacheHint)}get canLoad(){return!!this.map&&this.relationshipId!=null&&typeof this.objectId=="number"}get canQuery(){var i,r;const e=(r=(i=this.layer)==null?void 0:i.capabilities)==null?void 0:r.queryRelated;return!!(this.relatedLayer&&this.relationship&&this.relationshipId!=null&&this.objectId!=null&&(e!=null&&e.supportsCount)&&(e!=null&&e.supportsPagination))}get itemDescriptionFieldName(){var e;return((e=this.orderByFieldsFixedCasing[0])==null?void 0:e.field)||null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){var e,i;return(this.objectIdField&&((i=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:i[this.objectIdField]))??null}get objectIdField(){var e;return((e=this.layer)==null?void 0:e.objectIdField)||null}get relatedFeatures(){return this._get("relatedFeatures")||new st}get relatedLayer(){const{layer:e,map:i,relationship:r}=this;return e!=null&&e.loaded&&i&&r?PVt(i,e,r)??null:null}get relationship(){var r;const{relationshipId:e,layer:i}=this;return e!=null?((r=i==null?void 0:i.relationships)==null?void 0:r.find(({id:s})=>s===e))??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new st}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:i,_queryPageAbortController:r,canQuery:s,_loaded:n,canLoad:o}=this;return i||o&&!n?"loading":e||r?"querying":s?"ready":"disabled"}getRelatedFeatureByObjectId(e){return this.relatedFeatures.find(i=>i.getObjectId()===e)}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){var e;(e=this.relatedFeatureViewModels)==null||e.destroyAll()}async _queryFeatureCount(){const{layer:e,relatedLayer:i,relationshipId:r,objectId:s,_queryFeatureCountAbortController:n,canQuery:o,supportsCacheHint:a}=this;if(await(e==null?void 0:e.load()),await(i==null?void 0:i.load()),!o||!e||!i||s==null)return void this._set("featureCount",0);const l=i.createQuery(),{historicMoment:c,gdbVersion:u}=e,d=new RP({cacheHint:a,gdbVersion:u,historicMoment:c,relationshipId:r,returnGeometry:!1,objectIds:[s],where:l.where??void 0}),f=await e.queryRelatedFeaturesCount(d,{signal:n==null?void 0:n.signal});this._set("featureCount",f[s]||0)}_sliceFeatures(e){const{showAllEnabled:i,displayCount:r}=this;return i?e:r?e.slice(0,r):[]}async _queryPage(){const{relatedFeatures:e,featurePage:i,showAllEnabled:r,_queryPageAbortController:s,featureCount:n}=this;!r||i<2||!n||e.addMany(await this._queryRelatedFeatures({signal:s==null?void 0:s.signal}))}async _queryRelatedFeatures(e){var U;const{orderByFieldsFixedCasing:i,showAllEnabled:r,featuresPerPage:s,displayCount:n,layer:o,relationshipId:a,featurePage:l,featureCount:c,relatedLayer:u,supportsCacheHint:d}=this,{canQuery:f,objectId:m}=this;if(!f||!o||!u||m==null)return[];const g=r?((l-1)*s+c)%c:0,y=r?s:n,v=u.objectIdField,b=[...i.map(k=>k.field),...P6t(u),v].filter(op),w=i.map(k=>`${k.field} ${k.order}`),x=u.createQuery(),{historicMoment:S,gdbVersion:C}=o,M=new RP({orderByFields:w,start:g,num:y,outFields:b,cacheHint:d,historicMoment:S,gdbVersion:C,relationshipId:a,returnGeometry:!1,objectIds:[m],where:x.where??void 0}),O=await o.queryRelatedFeatures(M,{signal:e==null?void 0:e.signal}),D=((U=O[m])==null?void 0:U.features)||[];return D.forEach(k=>{k.sourceLayer=u,k.layer=u}),D}};h([p()],es.prototype,"_loaded",void 0),h([p()],es.prototype,"_queryAbortController",void 0),h([p()],es.prototype,"_queryPageAbortController",void 0),h([p()],es.prototype,"_queryFeatureCountAbortController",void 0),h([p({value:1})],es.prototype,"featurePage",null),h([p()],es.prototype,"featuresPerPage",void 0),h([p({readOnly:!0})],es.prototype,"orderByFieldsFixedCasing",null),h([p({readOnly:!0})],es.prototype,"supportsCacheHint",null),h([p({readOnly:!0})],es.prototype,"canLoad",null),h([p({readOnly:!0})],es.prototype,"canQuery",null),h([p()],es.prototype,"description",void 0),h([p({readOnly:!0})],es.prototype,"itemDescriptionFieldName",null),h([p({value:3})],es.prototype,"displayCount",null),h([p({type:ca})],es.prototype,"graphic",void 0),h([p()],es.prototype,"layer",void 0),h([p()],es.prototype,"map",void 0),h([p({readOnly:!0})],es.prototype,"objectId",null),h([p({readOnly:!0})],es.prototype,"objectIdField",null),h([p()],es.prototype,"orderByFields",void 0),h([p({readOnly:!0})],es.prototype,"relatedFeatures",null),h([p({readOnly:!0})],es.prototype,"relatedLayer",null),h([p({readOnly:!0})],es.prototype,"relationship",null),h([p()],es.prototype,"featureCount",void 0),h([p({readOnly:!0})],es.prototype,"relatedFeatureViewModels",null),h([p()],es.prototype,"relationshipId",void 0),h([p()],es.prototype,"showAllEnabled",void 0),h([p()],es.prototype,"state",null),h([p()],es.prototype,"title",void 0),es=h([I("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],es);const xle=es,EV="esri-feature",OR=`${EV}-relationship`,Ev={base:OR,listContainer:`${OR}__list`,listItem:`${OR}__list-item`,listItemHidden:`${OR}__list-item--hidden`,listContainerQuerying:`${OR}__list--querying`,featureObserver:`${EV}__feature-observer`,stickySpinnerContainer:`${EV}__sticky-loading-container`,loadingSpinnerContainer:`${EV}__loading-container`},bwe={title:!0,description:!0};let Ec=class extends Ua{constructor(e,i){super(e,i),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([r])=>{r!=null&&r.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new xle,this.messages=null,this.messagesCommon=null,this.visibleElements={...bwe},this._increaseFeaturePage=()=>{const{state:r,showAllEnabled:s,relatedFeatures:n,featuresPerPage:o,featurePage:a}=this.viewModel;r==="ready"&&s&&n.length>=o*a&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new sH,this.addHandles([te(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),$t),te(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),Ks(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return sm({icon:()=>ce(()=>import("./calcite-icon-BwrxrAiO.js"),__vite__mapDeps([209,207,198,199,206])),list:()=>ce(()=>import("./calcite-list-6jVkAsuQ.js"),__vite__mapDeps([237,198,199,200,206,238,239,203,204,205,214,207,240,197,201,202,208,241])),"list-item":()=>ce(()=>import("./calcite-list-item-EMXjDwnQ.js"),__vite__mapDeps([242,198,199,200,204,205,206,203,239,238,243,202,207,208])),loader:()=>ce(()=>import("./calcite-loader-DVZXO4Kd.js"),__vite__mapDeps([236,208,199])),notice:()=>ce(()=>import("./calcite-notice-sm0XPbpv.js"),__vite__mapDeps([244,245,206,198,199,203,204,205,215,202,207]))})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=qe(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:e,featureCount:i,displayCount:r,state:s}=this.viewModel;return!e&&!!i&&s==="ready"&&(i>r||r===0)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get featureCountDescription(){const{messages:e}=this,{featureCount:i}=this.viewModel;return dg(e==null?void 0:e.numberRecords,{number:i})}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}castVisibleElements(e){return{...bwe,...e}}render(){var i;const{state:e}=this.viewModel;return ge("div",{class:this.classes(Ev.base,ni.widget)},(i=this._featureElementInfo)==null?void 0:i.render(),e==="loading"?this._renderLoading():e==="disabled"?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_renderStickyLoading(){return this.viewModel.state==="querying"?ge("div",{class:Ev.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return ge("calcite-loader",{inline:!0,label:""})}_renderLoading(){return ge("div",{class:Ev.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return ge("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){const e=Cb(this.container)?"chevron-left":"chevron-right";return ge("calcite-icon",{icon:e,scale:"s",slot:"content-end"})}_renderRelatedFeature(e){var n;const{itemDescriptionFieldName:i}=this.viewModel,r=e.title;e.description=i&&((n=e.formattedAttributes)==null?void 0:n.global[i]);const s=e.state==="loading";return ge("calcite-list-item",{class:this.classes(Ev.listItem,{[Ev.listItemHidden]:s}),description:e.description??"",key:e.uid,label:r,onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:e})},this._renderChevronIconNode())}_renderShowAllListItem(){var e;return this.displayShowAllButton?ge("calcite-list-item",{description:this.featureCountDescription,key:"show-all-item",label:(e=this.messages)==null?void 0:e.showAll,onCalciteListItemSelect:()=>this.emit("show-all-records")},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){var e;return ge("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},ge("div",{slot:"message"},(e=this.messages)==null?void 0:e.noRelatedFeatures))}_renderFeatureObserver(){return ge("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:Ev.featureObserver,key:"feature-observer"})}_renderList(){const{relatedFeatureViewModels:e}=this.viewModel;return ge("calcite-list",null,e.toArray().map(i=>this._renderRelatedFeature(i)),this._renderShowAllListItem())}_renderRelatedFeatures(){const{displayListItems:e}=this,{state:i}=this.viewModel;return ge("div",{class:this.classes(Ev.listContainer,{[Ev.listContainerQuerying]:i==="querying"}),key:"list-container"},e?this._renderList():i==="ready"?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){var e;return ge("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},ge("div",{slot:"message"},(e=this.messages)==null?void 0:e.relationshipNotFound))}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:e}=this.viewModel,i="related-feature-viewmodels";this.removeHandles(i),e==null||e.forEach(r=>{this.addHandles(te(()=>[r.title,r.state],()=>this.scheduleRender(),$t),i)}),this.scheduleRender()}_setupFeatureElementInfo(){var n;const{headingLevel:e,visibleElements:i}=this,r=i.description&&this.description,s=i.title&&this.title;(n=this._featureElementInfo)==null||n.set({description:r,title:s,headingLevel:e})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:e,showAllEnabled:i}=this.viewModel;await MS(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&i&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};h([p()],Ec.prototype,"_relatedFeatureIntersectionObserverNode",void 0),h([p({readOnly:!0})],Ec.prototype,"displayShowAllButton",null),h([p({readOnly:!0})],Ec.prototype,"displayListItems",null),h([p()],Ec.prototype,"description",null),h([p({readOnly:!0})],Ec.prototype,"featureCountDescription",null),h([p()],Ec.prototype,"headingLevel",void 0),h([p()],Ec.prototype,"title",null),h([p({type:xle})],Ec.prototype,"viewModel",void 0),h([p(),Fa("esri/widgets/Feature/t9n/Feature")],Ec.prototype,"messages",void 0),h([p(),Fa("esri/t9n/common")],Ec.prototype,"messagesCommon",void 0),h([p()],Ec.prototype,"visibleElements",void 0),h([Kt("visibleElements")],Ec.prototype,"castVisibleElements",null),Ec=h([I("esri.widgets.Feature.FeatureRelationship")],Ec);const wwe=Ec;let O6t=class{constructor(e,i){this.preLayerQueryCallback=e,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=r=>{}),this.preRequestCallback||(this.preLayerQueryCallback=r=>{})}};var NI;const R6t=1,xwe="content-view-models",Twe="relationship-view-models",Swe={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let ws=NI=class extends bD(Ue){constructor(t){super(t),this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=hj(this._graphicChanged,R6t,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...Swe},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=e=>{const{abilities:i}=this;return e.type==="attachments"&&!!i.attachmentsContent||e.type==="custom"&&!!i.customContent||e.type==="fields"&&!!i.fieldsContent||e.type==="media"&&!!i.mediaContent||e.type==="text"&&!!i.textContent||e.type==="expression"&&!!i.expressionContent||e.type==="relationship"&&!!i.relationshipContent},this.addHandles(te(()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone],()=>this._graphicChangedThrottled(),$t))}initialize(){this.addHandles(this._graphicChangedThrottled)}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return this.graphic!=null?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return xVt(ibe(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return hze(this.graphic)}castAbilities(t){return{...Swe,...t}}get isTable(){var t;return((t=this._sourceLayer)==null?void 0:t.isTable)||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(t){this._set("graphic",(t==null?void 0:t.clone())??null)}get spatialReference(){var t;return((t=this.view)==null?void 0:t.spatialReference)??null}set spatialReference(t){this._override("spatialReference",t)}get timeZone(){var t;return((t=this.view)==null?void 0:t.timeZone)??Kd}set timeZone(t){this._overrideIfSome("timeZone",t)}get map(){var t;return((t=this.view)==null?void 0:t.map)||null}set map(t){this._override("map",t)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(t,e){const i=this.contentViewModels[t];i instanceof qT&&i.setActiveMedia(e)}nextMedia(t){const e=this.contentViewModels[t];e instanceof qT&&e.next()}previousMedia(t){const e=this.contentViewModels[t];e instanceof qT&&e.previous()}async updateGeometry(){var o;const{graphic:t,spatialReference:e,_sourceLayer:i}=this;await(i==null?void 0:i.load());const r=i==null?void 0:i.objectIdField;if(!r||!t||!i)return;const s=(o=t==null?void 0:t.attributes)==null?void 0:o[r];if(s==null)return;const n=[s];if(!t.geometry){const a=await _ze({layer:i,graphic:t,outFields:[],objectIds:n,returnGeometry:!0,spatialReference:e}),l=a==null?void 0:a.geometry;l&&(t.geometry=l)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:t}=this;if(!t)return;const e=new AbortController;this._featureAbortController=e;try{await this._queryFeature({signal:e.signal})}catch(i){os(i)||(this._error=i,se.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:t,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===e&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:t}=this;t&&t.abort(),this._featureAbortController=null}_compileContentElement(t,e){return t.type==="attachments"?this._compileAttachments(t,e):t.type==="custom"?this._compileCustom(t,e):t.type==="fields"?this._compileFields(t,e):t.type==="media"?this._compileMedia(t,e):t.type==="text"?this._compileText(t,e):t.type==="expression"?this._compileExpression(t,e):t.type==="relationship"?this._compileRelationship(t,e):void 0}_compileContent(t){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(t)?t.filter(this._isAllowedContentType).map((e,i)=>this._compileContentElement(e,i)).filter(op):typeof t=="string"?this._compileText(new nP({text:t}),0).text:t}_destroyContentViewModels(){this.removeHandles(Twe),this.removeHandles(xwe),this.contentViewModels.forEach(t=>t&&!t.destroyed&&t.destroy()),this._set("contentViewModels",[])}_matchesFeature(t,e){var s;const i=(s=t==null?void 0:t.graphic)==null?void 0:s.getObjectId(),r=e==null?void 0:e.getObjectId();return i!=null&&r!=null&&i===r}_setRelatedFeaturesViewModels({relatedFeatureViewModels:t,relatedFeatures:e,map:i}){const{view:r,spatialReference:s,timeZone:n}=this;e==null||e.filter(Boolean).forEach(o=>{t.some(a=>this._matchesFeature(a,o))||t.add(new NI({abilities:{relationshipContent:!1},map:i,view:r,spatialReference:s,timeZone:n,graphic:o}))}),t.forEach(o=>{(e==null?void 0:e.find(l=>this._matchesFeature(o,l)))||t.remove(o)})}_setExpressionContentVM(t,e){const i=this.formattedAttributes,{contentElement:r,contentElementViewModel:s}=t,n=r==null?void 0:r.type;s&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:e,formattedAttributes:i}),s.set(this._createFieldsVMParams(r,e))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:e,formattedAttributes:i}),s.set(this._createMediaVMParams(r,e))),n==="text"&&s.set(this._createTextVMParams(r)))}_compileRelationship(t,e){const{displayCount:i,orderByFields:r,relationshipId:s,title:n,description:o}=t,{_sourceLayer:a,graphic:l,map:c}=this;if(!mze(a))return;const u=new xle({displayCount:i,graphic:l,orderByFields:r,relationshipId:s,layer:a,map:c,...this._compileTitleAndDesc({title:n,description:o})});return this.contentViewModels[e]=u,this.addHandles(Ks(()=>u.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(u)),Twe),t}_compileExpression(t,e){const{expressionInfo:i}=t,{graphic:r,map:s,spatialReference:n,view:o,location:a}=this,l=new wle({expressionInfo:i,graphic:r,interceptor:NI.interceptor,map:s,spatialReference:n,view:o,location:a});return this.contentViewModels[e]=l,this.addHandles(te(()=>l.contentElementViewModel,()=>this._setExpressionContentVM(l,e),$t),xwe),t}_compileAttachments(t,e){const{graphic:i}=this,{description:r,title:s}=t;return this.contentViewModels[e]=new rle({graphic:i,...this._compileTitleAndDesc({title:s,description:r})}),t}_compileCustom(t,e){const{graphic:i}=this,{creator:r,destroyer:s}=t;return this.contentViewModels[e]=new pj({graphic:i,creator:r,destroyer:s}),t}_compileTitleAndDesc({title:t,description:e}){const{_fieldInfoMap:i,_sourceLayer:r,graphic:s,formattedAttributes:n}=this,o=s==null?void 0:s.attributes,a=this._expressionAttributes,l=n.global;return{title:GT({attributes:o,fieldInfoMap:i,globalAttributes:l,expressionAttributes:a,layer:r,text:t}),description:GT({attributes:o,fieldInfoMap:i,globalAttributes:l,expressionAttributes:a,layer:r,text:e})}}_createFieldsVMParams(t,e){const i=this._effectivePopupTemplate,r=this.formattedAttributes,s={...r==null?void 0:r.global,...r==null?void 0:r.content[e]},n=(t==null?void 0:t.fieldInfos)||(i==null?void 0:i.fieldInfos),o=n==null?void 0:n.filter(({fieldName:u})=>!!u&&(Kae(u)||j0(u)||s.hasOwnProperty(u))),a=i==null?void 0:i.expressionInfos,{description:l,title:c}=t;return{attributes:s,expressionInfos:a,fieldInfos:o,...this._compileTitleAndDesc({title:c,description:l})}}_compileFields(t,e){const i=t.clone(),r=new nH(this._createFieldsVMParams(t,e));return this.contentViewModels[e]=r,i.fieldInfos=r.formattedFieldInfos.slice(0),i}_createMediaVMParams(t,e){const{abilities:i,graphic:r,_fieldInfoMap:s,_effectivePopupTemplate:n,relatedInfos:o,_sourceLayer:a,_expressionAttributes:l}=this,c=this.formattedAttributes,u=(r==null?void 0:r.attributes)??{},{description:d,mediaInfos:f,title:m}=t;return{abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:t.activeMediaInfoIndex||0,attributes:u,isAggregate:r==null?void 0:r.isAggregate,layer:a,fieldInfoMap:s,formattedAttributes:{...c==null?void 0:c.global,...c==null?void 0:c.content[e]},expressionAttributes:l,mediaInfos:f,popupTemplate:n,relatedInfos:o,...this._compileTitleAndDesc({title:m,description:d})}}_compileMedia(t,e){const i=t.clone(),r=new qT(this._createMediaVMParams(t,e));return i.mediaInfos=r.formattedMediaInfos.slice(0),this.contentViewModels[e]=r,i}_createTextVMParams(t){var n;const{graphic:e,_fieldInfoMap:i,_sourceLayer:r,_expressionAttributes:s}=this;if(t&&t.text){const o=(e==null?void 0:e.attributes)??{},a=((n=this.formattedAttributes)==null?void 0:n.global)??{};t.text=GT({attributes:o,fieldInfoMap:i,globalAttributes:a,expressionAttributes:s,layer:r,text:t.text})}return{graphic:e,creator:t.text}}_compileText(t,e){const i=t.clone();return this.contentViewModels[e]=new pj(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:t,_sourceLayer:e,graphic:i,timeZone:r}=this;if(!t)return;const{lastEditInfoEnabled:s}=t,n=e==null?void 0:e.editFieldsInfo;return s&&n?wVt(n,i==null?void 0:i.attributes,r,e):void 0}_compileTitle(t){var a;const{_fieldInfoMap:e,_sourceLayer:i,graphic:r,_expressionAttributes:s}=this,n=(r==null?void 0:r.attributes)??{},o=((a=this.formattedAttributes)==null?void 0:a.global)??{};return GT({attributes:n,fieldInfoMap:e,globalAttributes:o,expressionAttributes:s,layer:i,text:t})}async _getTitle(){const{_effectivePopupTemplate:t,graphic:e}=this;return e?dj({type:"title",value:t==null?void 0:t.title,event:{graphic:e}}):null}async _getContent(){const{_effectivePopupTemplate:t,graphic:e}=this;return e?dj({type:"content",value:t==null?void 0:t.content,event:{graphic:e}}):null}async _queryFeature(t){const{_featureAbortController:e,_sourceLayer:i,graphic:r,_effectivePopupTemplate:s}=this,n=this.map,o=this.view,a=this.spatialReference,l=this.location;if(e!==this._featureAbortController||!r)return;await SVt({graphic:r,popupTemplate:s,layer:i,spatialReference:a},t);const{content:{value:c},title:{value:u}}=await jf({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:d}}=await jf({checkForRelatedFeatures:this._checkForRelatedFeatures(t),expressionAttributes:C6t({expressionInfos:s==null?void 0:s.expressionInfos,spatialReference:a,graphic:r,map:n,interceptor:NI.interceptor,view:o,options:t,location:l})});e===this._featureAbortController&&r&&(this._expressionAttributes=d,this._graphicExpressionAttributes={...r.attributes,...d},this._set("formattedAttributes",this._createFormattedAttributes(c)),this._set("title",this._compileTitle(u)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(c)||null))}_createMediaFormattedAttributes({contentElement:t,contentElementIndex:e,formattedAttributes:i}){const{_effectivePopupTemplate:r,graphic:s,relatedInfos:n,_sourceLayer:o,_fieldInfoMap:a,_graphicExpressionAttributes:l,timeZone:c}=this;i.content[e]=L7({fieldInfos:r==null?void 0:r.fieldInfos,graphic:s,attributes:{...l,...t.attributes},layer:o,fieldInfoMap:a,relatedInfos:n,timeZone:c})}_createFieldsFormattedAttributes({contentElement:t,contentElementIndex:e,formattedAttributes:i}){if(t.fieldInfos){const{graphic:r,relatedInfos:s,_sourceLayer:n,_fieldInfoMap:o,_graphicExpressionAttributes:a,timeZone:l}=this;i.content[e]=L7({fieldInfos:t.fieldInfos,graphic:r,attributes:{...a,...t.attributes},layer:n,fieldInfoMap:o,relatedInfos:s,timeZone:l})}}_createFormattedAttributes(t){const{_effectivePopupTemplate:e,graphic:i,relatedInfos:r,_sourceLayer:s,_fieldInfoMap:n,_graphicExpressionAttributes:o,timeZone:a}=this,l=e==null?void 0:e.fieldInfos,c={global:L7({fieldInfos:l,graphic:i,attributes:o,layer:s,fieldInfoMap:n,relatedInfos:r,timeZone:a}),content:[]};return Array.isArray(t)&&t.forEach((u,d)=>{u.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:u,contentElementIndex:d,formattedAttributes:c}),u.type==="media"&&this._createMediaFormattedAttributes({contentElement:u,contentElementIndex:d,formattedAttributes:c})}),c}_checkForRelatedFeatures(t){const{graphic:e,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(e,ibe(i),t)}async _queryRelatedInfos(t,e,i){const{relatedInfos:r,_sourceLayer:s}=this;r.clear();const n=(s==null?void 0:s.associatedLayer)!=null?await(s==null?void 0:s.associatedLayer.load(i)):s;if(!n||!t)return;const o=e.filter(c=>!!c.fieldName&&j0(c.fieldName));if(!(o!=null&&o.length))return;e.forEach(c=>this._configureRelatedInfo(c,n));const a=await zzt({relatedInfos:r,layer:n},i);Object.keys(a).forEach(c=>{var f;const u=r.get(c.toString()),d=(f=a[c])==null?void 0:f.value;u&&d&&(u.layerInfo=d.data)});const l=await Bzt({graphic:t,relatedInfos:r,layer:n},i);Object.keys(l).forEach(c=>{var u;Lzt((u=l[c])==null?void 0:u.value,r.get(c.toString()))})}_configureRelatedInfo(t,e){const{relatedInfos:i}=this,r=nV(t.fieldName||"");if(!r)return;const{layerId:s,fieldName:n}=r;if(!s)return;const o=i.get(s.toString())||Izt(s,e);o&&(jzt({relatedInfo:o,fieldName:n,fieldInfo:t}),this.relatedInfos.set(s,o))}};ws.interceptor=new O6t(MVt,AVt),h([p()],ws.prototype,"_error",void 0),h([p()],ws.prototype,"_featureAbortController",void 0),h([p({readOnly:!0})],ws.prototype,"_effectivePopupTemplate",null),h([p({readOnly:!0})],ws.prototype,"_fieldInfoMap",null),h([p({readOnly:!0})],ws.prototype,"_sourceLayer",null),h([p()],ws.prototype,"abilities",void 0),h([Kt("abilities")],ws.prototype,"castAbilities",null),h([p({readOnly:!0})],ws.prototype,"content",void 0),h([p({readOnly:!0})],ws.prototype,"contentViewModels",void 0),h([p()],ws.prototype,"description",void 0),h([p({type:Boolean})],ws.prototype,"defaultPopupTemplateEnabled",void 0),h([p({readOnly:!0})],ws.prototype,"isTable",null),h([p({readOnly:!0})],ws.prototype,"state",null),h([p({readOnly:!0})],ws.prototype,"formattedAttributes",void 0),h([p({type:ca,value:null})],ws.prototype,"graphic",null),h([p({readOnly:!0})],ws.prototype,"lastEditInfo",void 0),h([p({type:bt})],ws.prototype,"location",void 0),h([p({readOnly:!0})],ws.prototype,"relatedInfos",void 0),h([p()],ws.prototype,"spatialReference",null),h([p()],ws.prototype,"timeZone",null),h([p({readOnly:!0})],ws.prototype,"title",void 0),h([p()],ws.prototype,"map",null),h([p({readOnly:!0})],ws.prototype,"waitingForContent",null),h([p()],ws.prototype,"view",void 0),ws=NI=h([I("esri.widgets.Feature.FeatureViewModel")],ws);const Tle=ws,Ga="esri-feature",Fn={base:Ga,container:`${Ga}__size-container`,title:`${Ga}__title`,main:`${Ga}__main-container`,btn:`${Ga}__button`,icon:`${Ga}__icon`,content:`${Ga}__content`,contentNode:`${Ga}__content-node`,contentNodeText:`${Ga}__content-node--text`,contentElement:`${Ga}__content-element`,text:`${Ga}__text`,lastEditedInfo:`${Ga}__last-edited-info`,fields:`${Ga}__fields`,fieldHeader:`${Ga}__field-header`,fieldData:`${Ga}__field-data`,fieldDataDate:`${Ga}__field-data--date`,loadingSpinnerContainer:`${Ga}__loading-container`},wBe=t=>{let e=class extends t{constructor(){super(...arguments),this.renderNodeContent=i=>wze(i)&&!i.destroyed?ge("div",{class:Fn.contentNode,key:i},i.render()):i instanceof HTMLElement?ge("div",{afterCreate:this._attachToNode,bind:i,class:Fn.contentNode,key:i}):DVt(i)?ge("div",{afterCreate:this._attachToNode,bind:i.domNode,class:Fn.contentNode,key:i}):null}_attachToNode(i){const r=this;i.appendChild(r)}};return e=h([I("esri.widgets.Feature.support.FeatureContentMixin")],e),e};var Nte;const Ewe={title:!0,content:!0,lastEditedInfo:!0},Cwe="relationship-handles";let Co=Nte=class extends wBe(Ua){constructor(t,e){super(t,e),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements={...Ewe},this.viewModel=new Tle}initialize(){this.addHandles(te(()=>{var t;return(t=this.viewModel)==null?void 0:t.contentViewModels},()=>this._setupContentWidgets(),$t))}loadDependencies(){return sm({notice:()=>ce(()=>import("./calcite-notice-sm0XPbpv.js"),__vite__mapDeps([244,245,206,198,199,203,204,205,215,202,207])),loader:()=>ce(()=>import("./calcite-loader-DVZXO4Kd.js"),__vite__mapDeps([236,208,199]))})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(t){this.viewModel.graphic=t}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(t){this.viewModel.defaultPopupTemplateEnabled=t}get isTable(){return this.viewModel.isTable}get icon(){return"polygon"}set icon(t){this._overrideIfSome("icon",t)}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(t){this.viewModel.spatialReference=t}get timeZone(){return this.viewModel.timeZone}set timeZone(t){this.viewModel.timeZone=t}get title(){return this.viewModel.title}castVisibleElements(t){return{...Ewe,...t}}get map(){return this.viewModel.map}set map(t){this.viewModel.map=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}setActiveMedia(t,e){return this.viewModel.setActiveMedia(t,e)}nextMedia(t){return this.viewModel.nextMedia(t)}previousMedia(t){return this.viewModel.previousMedia(t)}render(){const{state:t}=this.viewModel,e=ge("div",{class:Fn.container,key:"container"},this._renderTitle(),t==="error"?this._renderError():t==="loading"?this._renderLoading():this._renderContentContainer());return ge("div",{class:this.classes(Fn.base,ni.widget)},e)}_renderError(){const{messagesCommon:t,messages:e,visibleElements:i}=this;return ge("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},i.title?ge("div",{key:"error-title",slot:"title"},t.errorMessage):null,ge("div",{key:"error-message",slot:"message"},e.loadingError))}_renderLoading(){return ge("div",{class:Fn.loadingSpinnerContainer,key:"loading-container"},ge("calcite-loader",{inline:!0,label:""}))}_renderContentContainer(){const{visibleElements:t}=this;return t.content?ge("div",{class:Fn.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){const{visibleElements:t,title:e}=this;return t.title?ge(sle,{class:Fn.title,innerHTML:e,level:this.headingLevel}):null}_renderContent(){const t=this.viewModel.content,e="content";if(!t)return null;if(Array.isArray(t))return t.length?ge("div",{class:Fn.contentNode,key:`${e}-content-elements`},t.map(this._renderContentElement,this)):null;if(typeof t=="string"){const i=this._contentWidgets[0];return!i||i.destroyed?null:ge("div",{class:this.classes(Fn.contentNode,Fn.contentNodeText),key:`${e}-content`},i.render())}return this.renderNodeContent(t)}_renderContentElement(t,e){var r;const{visibleElements:i}=this;if(typeof i.content!="boolean"&&!((r=i.content)!=null&&r[t.type]))return null;switch(t.type){case"attachments":return this._renderAttachments(e);case"custom":return this._renderCustom(t,e);case"fields":return this._renderFields(e);case"media":return this._renderMedia(e);case"text":return this._renderText(t,e);case"expression":return this._renderExpression(e);case"relationship":return this._renderRelationship(e);default:return null}}_renderAttachments(t){const e=this._contentWidgets[t];if(!e||e.destroyed)return null;const{state:i,attachmentInfos:r}=e.viewModel;return i==="loading"||r.length>0?ge("div",{class:this.classes(Fn.contentElement),key:this._buildKey("attachments-element",t)},e.render()):null}_renderRelationship(t){const e=this._contentWidgets[t];return e&&!e.destroyed&&this.flowItems?ge("div",{class:Fn.contentElement,key:this._buildKey("relationship-element",t)},e.render()):null}_renderExpression(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:ge("div",{class:Fn.contentElement,key:this._buildKey("expression-element",t)},e.render())}_renderCustom(t,e){const{creator:i}=t,r=this._contentWidgets[e];return!r||r.destroyed?null:i?ge("div",{class:Fn.contentElement,key:this._buildKey("custom-element",e)},r.render()):null}_renderFields(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:ge("div",{class:Fn.contentElement,key:this._buildKey("fields-element",t)},e.render())}_renderMedia(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:ge("div",{class:Fn.contentElement,key:this._buildKey("media-element",t)},e.render())}_renderLastEditInfo(){const{visibleElements:t,messages:e}=this,{lastEditInfo:i}=this.viewModel;if(!i||!t.lastEditedInfo)return null;const{date:r,user:s}=i,n=i.type==="edit"?s?e.lastEditedByUser:e.lastEdited:s?e.lastCreatedByUser:e.lastCreated,o=dg(n,{date:r,user:s});return ge("div",{class:this.classes(Fn.lastEditedInfo,Fn.contentElement),key:"edit-info-element"},o)}_renderText(t,e){const i=t.text,r=this._contentWidgets[e];return!r||r.destroyed?null:i?ge("div",{class:this.classes(Fn.contentElement,Fn.text),key:this._buildKey("text-element",e)},r.render()):null}_buildKey(t,...e){var i,r;return`${t}__${((r=(i=this.viewModel)==null?void 0:i.graphic)==null?void 0:r.uid)||"0"}-${e.join("-")}`}_destroyContentWidget(t){t&&(t.viewModel=null,!t.destroyed&&t.destroy())}_destroyContentWidgets(){this.removeHandles(Cwe),this._contentWidgets.forEach(t=>this._destroyContentWidget(t)),this._contentWidgets=[]}_addFeatureRelationshipHandles(t){const{flowItems:e,visibleElements:i}=this;this.addHandles([Ks(()=>t,"select-record",({featureViewModel:r})=>{e&&(r.abilities={relationshipContent:!0},e.push(new Nte({flowItems:e,viewModel:r,visibleElements:i})))}),Ks(()=>t,"show-all-records",()=>{if(!e)return;const{viewModel:r}=t;r.showAllEnabled=!0;const s=new wwe({visibleElements:{title:!1,description:!1},viewModel:r});this._addFeatureRelationshipHandles(s),e.push(s)})],Cwe)}_setupContentWidgets(){var s;this._destroyContentWidgets();const{headingLevel:t,visibleElements:e}=this,i=(s=this.viewModel)==null?void 0:s.content,{contentViewModels:r}=this.viewModel;if(Array.isArray(i))i.forEach((n,o)=>{if(n.type==="attachments"&&(this._contentWidgets[o]=new LVt({displayType:n.displayType,headingLevel:e.title&&t<6?t+1:t,viewModel:r[o]})),n.type==="fields"&&(this._contentWidgets[o]=new xze({viewModel:r[o]})),n.type==="media"&&(this._contentWidgets[o]=new Aze({viewModel:r[o]})),n.type==="text"&&(this._contentWidgets[o]=new rV({viewModel:r[o]})),n.type==="custom"&&(this._contentWidgets[o]=new rV({viewModel:r[o]})),n.type==="expression"&&(this._contentWidgets[o]=new A6t({viewModel:r[o]})),n.type==="relationship"){const a=new wwe({viewModel:r[o]});this._addFeatureRelationshipHandles(a),this._contentWidgets[o]=a}},this);else{const n=r[0];n&&!n.destroyed&&(this._contentWidgets[0]=new rV({viewModel:n}))}this.scheduleRender()}};h([p()],Co.prototype,"graphic",null),h([p()],Co.prototype,"defaultPopupTemplateEnabled",null),h([p()],Co.prototype,"flowItems",void 0),h([p()],Co.prototype,"headingLevel",void 0),h([p({readOnly:!0})],Co.prototype,"isTable",null),h([p()],Co.prototype,"icon",null),h([p()],Co.prototype,"label",null),h([p(),Fa("esri/widgets/Feature/t9n/Feature")],Co.prototype,"messages",void 0),h([p(),Fa("esri/t9n/common")],Co.prototype,"messagesCommon",void 0),h([p()],Co.prototype,"spatialReference",null),h([p()],Co.prototype,"timeZone",null),h([p({readOnly:!0})],Co.prototype,"title",null),h([p()],Co.prototype,"visibleElements",void 0),h([Kt("visibleElements")],Co.prototype,"castVisibleElements",null),h([p()],Co.prototype,"map",null),h([p()],Co.prototype,"view",null),h([p({type:Tle})],Co.prototype,"viewModel",void 0),Co=Nte=h([I("esri.widgets.Feature")],Co);const $6t=Co;let hT=class extends Us.EventedAccessor{constructor(e){super(e),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([No(()=>{const i=this.screenLocationEnabled?this.view:null;return i?[i.size,i.type==="3d"?i.camera:i.viewpoint]:null},()=>this.notifyChange("screenLocation")),te(()=>this.screenLocation,(i,r)=>{i!=null&&r!=null&&this.emit("view-change")})])}destroy(){this.view=null}get screenLocation(){const{location:e,view:i,screenLocationEnabled:r}=this,s=i==null?void 0:i.spatialReference,n=s?UCe(e,s).geometry:null;return r&&n&&(i!=null&&i.ready)?i.toScreen(n):null}};h([p()],hT.prototype,"location",void 0),h([p()],hT.prototype,"screenLocation",null),h([p()],hT.prototype,"screenLocationEnabled",void 0),h([p()],hT.prototype,"view",void 0),hT=h([I("esri.widgets.support.AnchorElementViewModel")],hT);const xBe=hT;let CV=class extends xBe{constructor(e){super(e),this.visible=!1}};h([p()],CV.prototype,"visible",void 0),CV=h([I("esri.widgets.Spinner.SpinnerViewModel")],CV);const TBe=CV,oW="esri-spinner",aW={base:oW,spinnerStart:`${oW}--start`,spinnerFinish:`${oW}--finish`};let dT=class extends Ua{constructor(e,i){super(e,i),this._animationDelay=500,this._animationPromise=null,this.viewModel=new TBe}initialize(){this.addHandles(te(()=>this.visible,e=>this._visibleChange(e)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}show(e){const{location:i,promise:r}=e??{};i&&(this.viewModel.location=i),this.visible=!0;const s=()=>this.hide();r&&r.catch(()=>{}).then(s)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:i}=this.viewModel,r=!!i,s=e&&r,n=!e&&r,o={[aW.spinnerStart]:s,[aW.spinnerFinish]:n},a=this._getPositionStyles();return ge("div",{class:this.classes(aW.base,o),styles:a})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const i=MS(this._animationDelay);this._animationPromise=i,i.catch(()=>{}).then(()=>{this._animationPromise===i&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:i}=this.viewModel;if(i==null||e==null)return{};const{padding:r}=i;return{left:e.x-r.left+"px",top:e.y-r.top+"px"}}};h([p()],dT.prototype,"location",null),h([p()],dT.prototype,"view",null),h([p({type:TBe})],dT.prototype,"viewModel",void 0),h([p()],dT.prototype,"visible",null),dT=h([I("esri.widgets.Spinner")],dT);const I6t=dT,Pl="esri-features",xa={icon:`${Pl}__icon`,actionImage:`${Pl}__action-image`,base:Pl,container:`${Pl}__container`,contentContainer:`${Pl}__content-container`,contentFeature:`${Pl}__content-feature`,flowItemCollapsed:`${Pl}__flow-item--collapsed`,header:`${Pl}__header`,footer:`${Pl}__footer`,featureMenuObserver:`${Pl}__feature-menu-observer`,actionExit:`${Pl}__action--exit`,loader:`${Pl}__loader`,featuresHeading:`${Pl}__heading`,paginationActionBar:`${Pl}__pagination-action-bar`,paginationPrevious:`${Pl}__pagination-previous`,paginationNext:`${Pl}__pagination-next`};let pT=class extends Ua{constructor(e,i){super(e,i),this.messages=null,this.closed=!1,this.closable=!0,this._handleOpenRelatedFeature=r=>{this.emit("open-related-feature",{feature:r})}}loadDependencies(){return sm({action:()=>ce(()=>import("./calcite-action-CfqxQbq3.js"),__vite__mapDeps([246,243,198,199,200,203,204,205,206,202,207,208])),"flow-item":()=>ce(()=>import("./calcite-flow-item-CD1QPnN4.js"),__vite__mapDeps([247,198,199,200,203,204,205,206,248,243,202,207,208,213,214,249,215,216,241]))})}render(){const{flowItems:e}=this,i=e==null?void 0:e.toArray();return ge(bUt,null,i==null?void 0:i.map(r=>this._renderRelatedRecordsFlowItem(r)))}_handleCloseClick(){this.emit("close")}_handleExitClick(){this.emit("exit")}_handleRelatedRecordsBackClick(){var i;const e=(i=this.flowItems)==null?void 0:i.pop();e&&("showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e&&(e.viewModel=null,e.destroy()))}_renderRelatedRecordsFlowItem(e){var l;const{messages:i,closable:r,closed:s}=this,n="graphic"in e&&!e.isTable&&((l=e.graphic)==null?void 0:l.geometry),o=i.exitRelatedRecords,a=i.selectFeature;return ge("calcite-flow-item",{bind:this,closable:r,closed:s,description:this._getRelatedRecordsFlowItemDescription(e),heading:e.title??"",key:`flow-item-${e.viewModel.uid}`,onCalciteFlowItemBack:c=>{c.preventDefault(),this._handleRelatedRecordsBackClick()},onCalciteFlowItemClose:this._handleCloseClick},ge("calcite-action",{appearance:"transparent",bind:this,class:xa.actionExit,icon:"move-up",key:"exit-related-records-action",onclick:this._handleExitClick,slot:"header-actions-start",text:o,title:o}),n?ge("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-related-feature-action",onclick:()=>this._handleOpenRelatedFeature(e),slot:"header-actions-end",text:a,title:a}):null,ge("div",{class:xa.container},e.render()))}_getRelatedRecordsFlowItemDescription(e){return"featureCountDescription"in e?e.featureCountDescription:e.viewModel.description??""}};h([p()],pT.prototype,"flowItems",void 0),h([p(),Fa("esri/widgets/Features/t9n/Features")],pT.prototype,"messages",void 0),h([p()],pT.prototype,"closed",void 0),h([p()],pT.prototype,"closable",void 0),pT=h([I("esri.widgets.Features.FeaturesRelatedRecords")],pT);const L6t=pT;let D6t=class{constructor(e){this._observable=new BP,this._set=new Set(e)}get size(){return Ft(this._observable),this._set.size}add(e){const i=this._set.size;return this._set.add(e),this._set.size!==i&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(e){const i=this._set.delete(e);return i&&this._observable.notify(),i}entries(){return Ft(this._observable),this._set.entries()}forEach(e,i){Ft(this._observable),this._set.forEach((r,s)=>e.call(i,r,s,this),i)}has(e){return Ft(this._observable),this._set.has(e)}keys(){return Ft(this._observable),this._set.keys()}values(){return Ft(this._observable),this._set.values()}[Symbol.iterator](){return Ft(this._observable),this._set[Symbol.iterator]()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}};var c2;(function(t){t[t.size=22]="size",t[t.lineWidth=50]="lineWidth",t[t.maxSize=120]="maxSize",t[t.maxOutlineSize=80]="maxOutlineSize",t[t.tallSymbolWidth=20]="tallSymbolWidth"})(c2||(c2={}));const Mwe=le("android");le("chrome")||Mwe&&Mwe>=4;IY();c2.size;c2.maxSize;c2.maxOutlineSize;c2.lineWidth;c2.tallSymbolWidth;function SBe(t){return t&&"opacity"in t?t.opacity*SBe(t.parent):1}async function Awe(t,e){var x;if(!t)return;const i=t.sourceLayer,r=(e!=null&&e.useSourceLayer?i:t.layer)??i,s=SBe(r);if(t.symbol!=null&&(e==null||e.ignoreGraphicSymbol!==!0)){const S=t.symbol.type==="web-style"?await F2t(t.symbol,{...e,cache:e!=null?e.webStyleCache:null}):t.symbol.clone();return d9(S,null,s),S}const n=(e==null?void 0:e.renderer)??N6t(r);let o=n&&"getSymbolAsync"in n?await n.getSymbolAsync(t,e):null;if(!o)return;if(o=o.type==="web-style"?await o.fetchSymbol({...e,cache:e!=null?e.webStyleCache:null}):o.clone(),!n||!("visualVariables"in n)||!((x=n.visualVariables)!=null&&x.length))return d9(o,null,s),o;if("arcadeRequiredForVisualVariables"in n&&n.arcadeRequiredForVisualVariables&&(e==null?void 0:e.arcade)==null){const S={...e};S.arcade=await ry(),e=S}const{getColor:a,getOpacity:l,getAllSizes:c,getRotationAngle:u}=await ce(()=>Promise.resolve().then(()=>Eoe),void 0),d=[],f=[],m=[],g=[];for(const S of n.visualVariables)switch(S.type){case"color":d.push(S);break;case"opacity":f.push(S);break;case"rotation":g.push(S);break;case"size":S.target||m.push(S)}const y=!!d.length&&d[d.length-1],v=y?a(y,t,e):null,b=!!f.length&&f[f.length-1];let w=b?l(b,t,e):null;if(s!=null&&(w=w!=null?w*s:s),d9(o,v,w),m.length){const S=c(m,t,e);await D2t(o,S)}for(const S of g)N2t(o,u(S,t,e),S.axis);return o}function N6t(t){if(t)return"renderer"in t?t.renderer:void 0}const xS=st.ofType({key:"type",defaultKeyValue:"button",base:kG,typeMap:{button:QP,toggle:xse}}),WT=new QP({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:k0.zoomInMagnifyingGlass}),Pwe=new QP({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:k0.trash}),NM=new QP({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:k0.zoomInMagnifyingGlass}),L1=new xse({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:k0.table,value:!1}),F6t="esri.widgets.Popup.PopupViewModel",mj=()=>se.getLogger(F6t),k6t=t=>{const{event:e,view:i,viewModel:r}=t,{action:s}=e;if(!s)return Promise.reject(new G("trigger-action:missing-arguments","Event has no action"));const{disabled:n,id:o}=s;if(!o)return Promise.reject(new G("trigger-action:invalid-action","action.id is missing"));if(n)return Promise.reject(new G("trigger-action:invalid-action","Action is disabled"));if(o===WT.id)return V6t(r).catch(RW);if(o===NM.id)return z6t(r);if(o===L1.id)return r.browseClusterEnabled=!r.browseClusterEnabled,r.featureMenuOpen=r.browseClusterEnabled,Promise.resolve();if(o===Pwe.id){r.visible=!1;const{selectedFeature:a}=r;if(!a)return Promise.reject(new G(`trigger-action:${Pwe.id}`,"selectedFeature is required",{selectedFeature:a}));const{sourceLayer:l}=a;return l?l.remove(a):i==null||i.graphics.remove(a),Promise.resolve()}return Promise.resolve()};function EBe(t){const{selectedFeature:e,location:i,view:r}=t;return r?e??i??null:null}function RT(t){var e,i;return!!t&&t.isAggregate&&((i=(e=t.sourceLayer)==null?void 0:e.featureReduction)==null?void 0:i.type)==="cluster"}async function U6t(t,e){if((e==null?void 0:e.type)!=="3d"||!t||t.declaredClass!=="esri.Graphic")return!0;const i=e.getViewForGraphic(t);if(i&&"whenGraphicBounds"in i){let r=null;try{r=await i.whenGraphicBounds(t,{useViewElevation:!0})}catch{}return!r||!r.boundingBox||r.boundingBox[0]===r.boundingBox[3]&&r.boundingBox[1]===r.boundingBox[4]&&r.boundingBox[2]===r.boundingBox[5]}return!0}async function V6t(t){var u;const{location:e,selectedFeature:i,view:r,zoomFactor:s}=t,n=EBe(t);if(!r||!n){const d=new G("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:n,view:r});throw mj().error(d),d}const o=r.scale/s,a=(u=t.selectedFeature)==null?void 0:u.geometry,l=a??e,c=l!=null&&l.type==="point"&&await U6t(i,r);WT.active=!0,WT.disabled=!0;try{await t.zoomTo({target:{target:n,scale:c?o:void 0}})}catch{const f=new G("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:i});mj().error(f)}finally{WT.active=!1,WT.disabled=!1,t.zoomToLocation=null,c&&(t.location=l)}}async function z6t(t){const{selectedFeature:e,view:i}=t;if((i==null?void 0:i.type)!=="2d"){const o=new G("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw mj().error(o),o}if(!e||!RT(e)){const o=new G("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:e});throw mj().error(o),o}const[r,s]=await Sle(i,e);NM.active=!0,NM.disabled=!0;const{extent:n}=await r.queryExtent(s);n&&await t.zoomTo({target:n}),NM.active=!1,NM.disabled=!1}async function B6t(t){const{view:e,selectedFeature:i}=t;if(!e||!i)return;const[r,s]=await Sle(e,i),{extent:n}=await r.queryExtent(s);t.selectedClusterBoundaryFeature.geometry=n,e.graphics.add(t.selectedClusterBoundaryFeature)}async function j6t(t){const{selectedFeature:e,view:i}=t;if(!i||!e)return;const[r,s]=await Sle(i,e);L1.active=!0,L1.disabled=!0;const{features:n}=await r.queryFeatures(s);L1.active=!1,L1.disabled=!1,L1.value=!0,t==null||t.open({features:[e].concat(n),featureMenuOpen:!0})}async function Sle(t,e){const i=await t.whenLayerView(e.sourceLayer),r=i.createQuery(),s=e.getObjectId();return r.aggregateIds=s!=null?[s]:[],[i,r]}function G6t(t){L1.value=!1;const e=t.features.filter(i=>RT(i));e.length&&(t.features=e)}const lW="location-scale-handle",H6t=()=>[WT.clone()],q6t=()=>[NM.clone(),L1.clone()];let j5=null;function W6t(t,e){return t==="building-scene"||e==="2d"&&(t==="map-image"||t==="tile"||t==="imagery"||t==="imagery-tile")}let zi=class extends Jae(xBe){constructor(t){super(t),this._pendingPromises=new D6t,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this.actions=new xS,this.activeFeature=null,this.autoCloseEnabled=!1,this.browseClusterEnabled=!1,this.content=null,this.defaultPopupTemplateEnabled=!1,this.featurePage=null,this.featuresPerPage=20,this.featureMenuOpen=!1,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new ca({symbol:new E_({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null,this._debouncedLocationUpdate=q0(async e=>{var n,o,a,l;const{spatialReference:i}=this,r=(o=(n=this.selectedFeature)==null?void 0:n.geometry)==null?void 0:o.type,s=this.location??e;if(r&&r!=="mesh"&&i&&s&&this.selectedFeature)if(r!=="point")try{const c=this.selectedFeature;let u=c.geometry;const d=this._getHighlightLayer(c),f=c.getObjectId();if(!d||!this.view)return;if(f){const m=(a=this.view)==null?void 0:a.allLayerViews.find(v=>v.layer.uid===d.uid);if(!m||!("queryFeatures"in m))return;const g=m.createQuery();g.outSpatialReference=i,g.objectIds=[f],g.returnGeometry=!0;const{features:y}=await m.queryFeatures(g);u=(l=y[0])==null?void 0:l.geometry}if(!u||u.type==="mesh")return;if(u=b_(u,i),j5||(j5=await ce(()=>import("./geometryEngineAsync-9PneDjPe.js"),[])),!await j5.intersects(u,s)){const m=(await j5.nearestCoordinate(u,s)).coordinate??s;this.selectedFeature===c&&(this.location=m)}}catch(c){os(c)||se.getLogger(this).error(c)}else this.location=fee(this.selectedFeature.geometry)??s})}initialize(){this.addHandles([this.on("view-change",()=>this._autoClose()),te(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),te(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),te(()=>{var t,e;return(e=(t=this.view)==null?void 0:t.animation)==null?void 0:e.state},t=>this._animationStateChange(t)),te(()=>this.location,t=>this._locationChange(t)),te(()=>this.selectedFeature,t=>this._selectedFeatureChange(t)),te(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),te(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),te(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",t=>k6t({event:t,viewModel:this,view:this.view})),No(()=>!this.waitingForResult,()=>this._waitingForResultChange(),or),te(()=>[this.features,this.map,this.spatialReference,this.timeZone],()=>this._updateFeatureVMs()),te(()=>{var t;return(t=this.view)==null?void 0:t.scale},()=>this._viewScaleChange()),No(()=>!this.visible,()=>this.browseClusterEnabled=!1),te(()=>this.browseClusterEnabled,t=>t?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null,this.map=null,this.spatialReference=null,this.timeZone=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const t=this._get("allActions")||new xS;t.removeAll();const{actions:e,defaultActions:i,defaultPopupTemplateEnabled:r,includeDefaultActions:s,selectedFeature:n}=this,o=s?i.concat(e):e,a=n&&(typeof n.getEffectivePopupTemplate=="function"&&n.getEffectivePopupTemplate(r)||n.popupTemplate),l=a==null?void 0:a.actions,c=a!=null&&a.overwriteActions?l:(l==null?void 0:l.concat(o))??o;return c==null||c.filter(Boolean).forEach(u=>t.add(u)),t}get defaultActions(){const t=this._get("defaultActions")||new xS;return t.removeAll(),t.addMany(RT(this.selectedFeature)?q6t():H6t()),t}get featureCount(){return this.features.length}set features(t){const e=t||[];this._set("features",e);const{pendingPromisesCount:i,promiseCount:r,selectedFeatureIndex:s}=this,n=r&&e.length;n&&i&&s===-1?this.selectedFeatureIndex=0:n&&s!==-1||(this.selectedFeatureIndex=e.length?0:-1)}set location(t){var s,n;let e=t;const i=(s=this.spatialReference)==null?void 0:s.isWebMercator;((n=t==null?void 0:t.spatialReference)==null?void 0:n.isWGS84)&&i&&(e=kg(t)),this._set("location",e)}get map(){var t;return((t=this.view)==null?void 0:t.map)??null}set map(t){this._override("map",t)}get pendingPromisesCount(){return this._pendingPromises.size}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(t){this._pendingPromises.clear(),this.features=[],Array.isArray(t)&&t.length?(this._set("promises",t),(t=t.slice(0)).forEach(e=>this._pendingPromises.add(e)),t.reduce((e,i)=>e.finally(()=>i.then(r=>{this._pendingPromises.has(i)&&this._updateFeatures(r)}).finally(()=>this._pendingPromises.delete(i)).catch(()=>{})),Promise.resolve())):this._set("promises",[])}get selectedFeature(){const{features:t,selectedFeatureIndex:e}=this;return e===-1?null:t[e]||null}get selectedFeatureIndex(){const t=this._get("selectedFeatureIndex");return typeof t=="number"?t:-1}set selectedFeatureIndex(t){const{featureCount:e}=this;t=isNaN(t)||t<-1||!e?-1:(t+e)%e,this.activeFeature=null,this._set("selectedFeatureIndex",t)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get spatialReference(){var t;return((t=this.view)==null?void 0:t.spatialReference)??null}set spatialReference(t){this._override("spatialReference",t)}get state(){const{view:t,map:e}=this;return t?t.ready?"ready":"disabled":e?"ready":"disabled"}get timeZone(){var t;return((t=this.view)==null?void 0:t.timeZone)??Kd}set timeZone(t){this._overrideIfSome("timeZone",t)}get waitingForContents(){return this.featureViewModels.some(t=>t.waitingForContent)}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}centerAtLocation(){const{view:t}=this,e=EBe(this);return e&&t?this.callGoTo({target:{target:e,scale:t.scale}}):Promise.reject(new G("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:e,view:t}))}zoomTo(t){return this.callGoTo(t)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(t,e){var r;const{view:i}=this;if(!i||!t)throw new G("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:t,view:i});return i.fetchPopupFeatures(t,{pointerType:(r=e==null?void 0:e.event)==null?void 0:r.pointerType,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:e==null?void 0:e.signal})}open(t){const e={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...t,visible:!0},{fetchFeatures:i}=e;delete e.fetchFeatures,i&&this._setFetchFeaturesPromises(e.location);const r=["actionsMenuOpen","collapsed"];for(const s of r)delete e[s];this.set(e)}triggerAction(t){const e=this.allActions.at(t);e&&!e.disabled&&this.emit("trigger-action",{action:e})}next(){return this.selectedFeatureIndex++,this}previous(){return this.selectedFeatureIndex--,this}disableClusterBrowsing(){G6t(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:t,selectedFeature:e}=this;(t==null?void 0:t.type)==="2d"?RT(e)?(await B6t(this),await j6t(this)):se.getLogger(this).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",e):se.getLogger(this).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",e)}handleViewClick(t){this._fetchFeaturesAndOpen(t)}_animationStateChange(t){this.zoomToLocation||(WT.disabled=t==="waiting-for-target")}_clearBrowsedClusterGraphics(){var e,i;const t=[this.selectedClusterBoundaryFeature,this._selectedClusterFeature].filter(op);(i=(e=this.view)==null?void 0:e.graphics)==null||i.removeMany(t),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(RT(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(t){const{selectedFeature:e,updateLocationEnabled:i,view:r}=this;r&&i&&t&&(!e||e.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:t,featureCount:e,featurePage:i,featuresPerPage:r,featureViewModels:s}=this;if(i===null)return;const n=((i-1)*r+e)%e,o=n+r;s.slice(n,o).forEach((a,l)=>{a&&(a.graphic??(a.graphic=t[n+l]))})}async _selectedFeatureChange(t){var n,o;const{location:e,updateLocationEnabled:i,view:r}=this;if(!t||!r)return;if(this.browseClusterEnabled)return this._selectedClusterFeature&&(r.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),RT(t)?void 0:(t.symbol=await Awe(t),this._selectedClusterFeature=t,void r.graphics.add(this._selectedClusterFeature));const s=(n=t.sourceLayer)==null?void 0:n.type;if(s!=="map-image"&&s!=="imagery"&&s!=="imagery-tile"||(t.symbol=await Awe(t)),!i&&e||!t.geometry){if(i&&!t.geometry){await this.centerAtLocation();const a=(o=r.center)==null?void 0:o.clone();a&&(this.location=a)}}else this.location=fee(t.geometry)}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}async _setFetchFeaturesPromises(t){const{pendingFeatures:e}=await this._fetchFeaturesWithController({mapPoint:t});this.promises=e}_destroyFeatureVMs(){this.featureViewModels.forEach(t=>t&&!t.destroyed&&t.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:t,features:e,featureViewModels:i,view:r,spatialReference:s,map:n,timeZone:o,location:a}=this;if(RT(t)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!(e!=null&&e.length))return;const l=i.slice(0),c=[];e.forEach((u,d)=>{if(!u)return;let f=null;if(l.some((m,g)=>(m&&m.graphic===u&&(f=m,l.splice(g,1)),!!f)),f)c[d]=f;else{const m=new Tle({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:s,graphic:u===t?u:null,location:a,map:n,view:r,timeZone:o});c[d]=m}}),l.forEach(u=>u&&!u.destroyed&&u.destroy()),this._set("featureViewModels",c)}async _getScreenPoint(t,e){const{spatialReference:i,view:r}=this;if(!r)return null;await(r==null?void 0:r.when());const s=t==null?void 0:t.spatialReference;return s&&i?(await qP(s,i,null,e),r.toScreen(t)):null}_cancelFetchingFeatures(){const t=this._fetchFeaturesController;t&&t.abort(),this._fetchFeaturesController=null}async _projectScreenPointAndFetchFeatures({mapPoint:t,screenPoint:e,event:i,signal:r}){return this.fetchFeatures(e??await this._getScreenPoint(t??this.location,{signal:r}),{signal:r,event:i})}_fetchFeaturesWithController({mapPoint:t,screenPoint:e,event:i}){this._cancelFetchingFeatures();const r=new AbortController,{signal:s}=r;this._fetchFeaturesController=r;const n=this._projectScreenPointAndFetchFeatures({mapPoint:t,screenPoint:e,signal:s,event:i});return n.catch(()=>{}).then(()=>{this._fetchFeaturesController=null}),n}async _fetchFeaturesAndOpen(t){const{mapPoint:e,screenPoint:i}=t,{view:r}=this;this.removeHandles(lW),this.addHandles([te(()=>{var n;return(n=this.view)==null?void 0:n.scale},()=>this._debouncedLocationUpdate(e).catch(n=>{os(n)||se.getLogger(this).error(n)})),No(()=>!this.visible,()=>{this.removeHandles(lW)},{once:!0})],lW);const{pendingFeatures:s}=await this._fetchFeaturesWithController({mapPoint:e,screenPoint:i,event:t});r!=null&&r.popup&&"open"in r.popup&&r.popup.open({location:e??void 0,promises:s})}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}async _getLayerView(t,e){return await t.when(),t.whenLayerView(e)}_getHighlightLayer(t){const{layer:e,sourceLayer:i}=t;return i&&"layer"in i&&i.layer?i.layer:(i==null?void 0:i.type)==="map-notes"||(i==null?void 0:i.type)==="subtype-group"?i:e}_getHighlightTarget(t,e,i){if(W6t(e.type,i))return t;const r=t.getObjectId();if(r!=null)return r;const s=e.type==="imagery"?void 0:"objectIdField"in e?e.objectIdField||F5e:null,n=t.attributes;return n&&s&&n[s]||t}_mapIncludesLayer(t){var e,i;return!!((i=(e=this.map)==null?void 0:e.allLayers)!=null&&i.includes(t))}async _highlightActiveFeature(){const t="highlight-active-feature";this.removeHandles(t);const{highlightEnabled:e,view:i,activeFeature:r,visible:s}=this;if(!(r&&i&&e&&s))return;const n=this._getHighlightLayer(r);if(!(n&&n instanceof lL&&this._mapIncludesLayer(n)))return;const o=this._getLayerView(i,n);this._highlightActiveFeaturePromise=o;const a=await o;if(!(a&&C1e(a)&&this._highlightActiveFeaturePromise===o&&this.activeFeature&&this.highlightEnabled))return;const l=a.highlight(this._getHighlightTarget(r,n,i.type));this.addHandles(l,t)}async _highlightSelectedFeature(){const t="highlight-selected-feature";this.removeHandles(t);const{selectedFeature:e,highlightEnabled:i,view:r,visible:s}=this;if(!(e&&r&&i&&s))return;const n=this._getHighlightLayer(e);if(!(n&&n instanceof lL&&this._mapIncludesLayer(n)))return;const o=this._getLayerView(r,n);this._highlightSelectedFeaturePromise=o;const a=await o;if(!(a&&C1e(a)&&this._highlightSelectedFeaturePromise===o&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const l=a.highlight(this._getHighlightTarget(e,n,r.type));this.addHandles(l,t)}_updateFeatures(t){const{features:e}=this,i=t.filter(r=>!e.includes(r));i!=null&&i.length&&(this.features=e.concat(i))}};h([p()],zi.prototype,"_fetchFeaturesController",void 0),h([p({type:xS})],zi.prototype,"actions",void 0),h([p({readOnly:!0})],zi.prototype,"active",null),h([p()],zi.prototype,"activeFeature",void 0),h([p({readOnly:!0})],zi.prototype,"allActions",null),h([p()],zi.prototype,"autoCloseEnabled",void 0),h([p()],zi.prototype,"browseClusterEnabled",void 0),h([p()],zi.prototype,"content",void 0),h([p({type:xS,readOnly:!0})],zi.prototype,"defaultActions",null),h([p({type:Boolean})],zi.prototype,"defaultPopupTemplateEnabled",void 0),h([p({readOnly:!0})],zi.prototype,"featureCount",null),h([p()],zi.prototype,"featurePage",void 0),h([p({value:[]})],zi.prototype,"features",null),h([p()],zi.prototype,"featuresPerPage",void 0),h([p()],zi.prototype,"featureMenuOpen",void 0),h([p()],zi.prototype,"featureViewModelAbilities",void 0),h([p({readOnly:!0})],zi.prototype,"featureViewModels",void 0),h([p()],zi.prototype,"highlightEnabled",void 0),h([p()],zi.prototype,"includeDefaultActions",void 0),h([p({type:bt})],zi.prototype,"location",null),h([p()],zi.prototype,"map",null),h([p({readOnly:!0})],zi.prototype,"pendingPromisesCount",null),h([p({readOnly:!0})],zi.prototype,"promiseCount",null),h([p()],zi.prototype,"promises",null),h([p({readOnly:!0})],zi.prototype,"selectedClusterBoundaryFeature",void 0),h([p({value:null,readOnly:!0})],zi.prototype,"selectedFeature",null),h([p({value:-1})],zi.prototype,"selectedFeatureIndex",null),h([p({readOnly:!0})],zi.prototype,"selectedFeatureViewModel",null),h([p({readOnly:!0})],zi.prototype,"state",null),h([p()],zi.prototype,"timeZone",null),h([p()],zi.prototype,"title",void 0),h([p()],zi.prototype,"updateLocationEnabled",void 0),h([p()],zi.prototype,"view",void 0),h([p()],zi.prototype,"visible",void 0),h([p({readOnly:!0})],zi.prototype,"waitingForContents",null),h([p({readOnly:!0})],zi.prototype,"waitingForResult",null),h([p()],zi.prototype,"zoomFactor",void 0),h([p()],zi.prototype,"zoomToLocation",void 0),h([p()],zi.prototype,"centerAtLocation",null),zi=h([I("esri.widgets.Features.FeaturesViewModel")],zi);const Ele=zi;let Jp=class extends Ue{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!1,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.flow=!0,this.heading=!0,this.spinner=!0}};h([p({type:Boolean,nonNullable:!0})],Jp.prototype,"actionBar",void 0),h([p({type:Boolean,nonNullable:!0})],Jp.prototype,"closeButton",void 0),h([p({type:Boolean,nonNullable:!0})],Jp.prototype,"collapseButton",void 0),h([p({type:Boolean,nonNullable:!0})],Jp.prototype,"featureNavigation",void 0),h([p({type:Boolean,nonNullable:!0})],Jp.prototype,"featureListLayerTitle",void 0),h([p({type:Boolean,nonNullable:!0})],Jp.prototype,"flow",void 0),h([p({type:Boolean,nonNullable:!0})],Jp.prototype,"heading",void 0),h([p({type:Boolean,nonNullable:!0})],Jp.prototype,"spinner",void 0),Jp=h([I("esri.widgets.Features.FeaturesVisibleElements")],Jp);const CBe=Jp,Owe="selected-index",Z6t=0,Rwe="features-spinner",Y6t=50;function $we(t){return(t==null?void 0:t.declaredClass.startsWith("esri.layers."))??!1}let pr=class extends wBe(Ua){constructor(e,i){super(e,i),this._featureMenuIntersectionObserverCallback=([r])=>{r!=null&&r.isIntersecting&&this.viewModel.featurePage!=null&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._featureMenuIntersectionObserverNode=null,this._focusOn=null,this._spinner=null,this._feature=null,this._relatedRecordsFlowItems=new st,this._relatedRecordsWidget=new L6t({flowItems:this._relatedRecordsFlowItems}),this._rootFlowItemNode=null,this._featureMenuViewportNode=null,this._actionBarMenuNode=null,this.collapsed=!1,this.featureNavigationTop=!1,this.headerActions=new xS,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new Ele,this.visibleElements=new CBe,this._renderAction=(r,s)=>{const n=this._getActionTitle(r),{type:o,active:a,uid:l,disabled:c,indicator:u}=r;return r.visible?ge("calcite-action",{active:o==="toggle"&&r.value,appearance:"solid",bind:this,"data-action-uid":l,disabled:c,icon:this._getActionIcon(r),indicator:u,key:`action-${s}`,loading:a,onclick:this._triggerAction,scale:"s",text:n,title:this._hideActionText?n:void 0},this._getFallbackIcon(r)):null},this._openFeatureMenu=()=>{this.featureMenuOpen=!0,this._focusOn="menu-flow-item"},this._previousFeature=()=>{this.viewModel.selectedFeatureIndex--},this._nextFeature=()=>{this.viewModel.selectedFeatureIndex++},this._handleFeatureMenuBack=()=>{this.featureMenuOpen&&(this._focusOn="root-flow-item",this.featureMenuOpen=!1)},this._focusFlowItemNode=r=>{this._focusOn===r&&requestAnimationFrame(async()=>{var s,n;switch(r){case"menu-flow-item":await((s=this._featureMenuViewportNode)==null?void 0:s.setFocus());break;case"root-flow-item":await((n=this._rootFlowItemNode)==null?void 0:n.setFocus())}this._focusOn=null})},this._focusFlowItemNodeThrottled=hj(this._focusFlowItemNode,Y6t),this._displaySpinnerThrottled=hj(()=>this._displaySpinner(),Z6t),this._addSelectedFeatureIndexHandle(),this.addHandles([this._displaySpinnerThrottled,this._focusFlowItemNodeThrottled,te(()=>{var r;return(r=this.viewModel)==null?void 0:r.active},()=>this._toggleScreenLocationEnabled()),te(()=>{var r;return(r=this.viewModel)==null?void 0:r.active},r=>this._relatedRecordsWidget.closed=!r),te(()=>{var r;return(r=this.visibleElements)==null?void 0:r.closeButton},r=>this._relatedRecordsWidget.closable=r),te(()=>{var r;return(r=this.visibleElements)==null?void 0:r.spinner},r=>this._spinnerEnabledChange(r)),te(()=>{var r;return(r=this.viewModel)==null?void 0:r.view},(r,s)=>this._viewChange(r,s)),te(()=>{var r,s;return(s=(r=this.viewModel)==null?void 0:r.view)==null?void 0:s.ready},(r,s)=>this._viewReadyChange(r??!1,s??!1)),te(()=>{var r,s;return[(r=this.viewModel)==null?void 0:r.waitingForResult,(s=this.viewModel)==null?void 0:s.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),te(()=>{var r;return(r=this.viewModel)==null?void 0:r.screenLocation},()=>this._closeOpenActionMenu()),te(()=>this.selectedFeatureWidget,()=>this._destroyRelatedRecordsFlowItemWidgets()),te(()=>{var s;const r=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel;return[r==null?void 0:r.title,r==null?void 0:r.state]},()=>this._setTitleFromFeatureWidget()),te(()=>{var s;const r=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel;return[r==null?void 0:r.content,r==null?void 0:r.state]},()=>this._setContentFromFeatureWidget()),te(()=>{var r;return(r=this.viewModel)==null?void 0:r.featureViewModels},()=>this._featureMenuViewportScrollTop()),this._relatedRecordsWidget.on("close",()=>this.close()),this._relatedRecordsWidget.on("exit",()=>this._destroyRelatedRecordsFlowItemWidgets()),this._relatedRecordsWidget.on("open-related-feature",({feature:r})=>this._openRelatedFeature(r))])}loadDependencies(){return sm({action:()=>ce(()=>import("./calcite-action-CfqxQbq3.js"),__vite__mapDeps([246,243,198,199,200,203,204,205,206,202,207,208])),"action-bar":()=>ce(()=>import("./calcite-action-bar-Bm77Hsqq.js"),__vite__mapDeps([250,245,206,198,199,203,204,205,251,248,243,200,202,207,208,213,214,249,215,216])),"action-group":()=>ce(()=>import("./calcite-action-group-Dvynrxpt.js"),__vite__mapDeps([252,251,245,206,203,204,198,199,205,248,243,200,202,207,208,213,214,249,215,216])),button:()=>ce(()=>import("./calcite-button-DQc9b2O5.js"),__vite__mapDeps([196,197,198,199,200,201,202,203,204,205,206,207,208])),flow:()=>ce(()=>import("./calcite-flow-BAi_Y6qR.js"),__vite__mapDeps([253,206,203])),"flow-item":()=>ce(()=>import("./calcite-flow-item-CD1QPnN4.js"),__vite__mapDeps([247,198,199,200,203,204,205,206,248,243,202,207,208,213,214,249,215,216,241])),list:()=>ce(()=>import("./calcite-list-6jVkAsuQ.js"),__vite__mapDeps([237,198,199,200,206,238,239,203,204,205,214,207,240,197,201,202,208,241])),"list-item":()=>ce(()=>import("./calcite-list-item-EMXjDwnQ.js"),__vite__mapDeps([242,198,199,200,204,205,206,203,239,238,243,202,207,208])),"list-item-group":()=>ce(()=>import("./calcite-list-item-group-C17IpNSY.js"),__vite__mapDeps([254,200,238])),loader:()=>ce(()=>import("./calcite-loader-DVZXO4Kd.js"),__vite__mapDeps([236,208,199]))})}destroy(){var e,i;this._destroyRelatedRecordsFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._unobserveFeatureMenuObserver(),(e=this._featureMenuIntersectionObserver)==null||e.disconnect(),(i=this._relatedRecordsWidget)==null||i.destroy()}get _hideActionText(){var i;if(!this.responsiveActionsEnabled)return!1;const e=(i=this.view)==null?void 0:i.widthBreakpoint;return e==="xsmall"||e==="small"||e==="medium"}get _featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get _isCollapsed(){return this._collapseEnabled&&this.collapsed}get _collapseEnabled(){return this.visibleElements.collapseButton&&!!this.title&&!!this.content}get active(){return this.viewModel.active}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get icon(){return null}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(e){this.viewModel.featureMenuOpen=e}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){const{_feature:e,headingLevel:i,_relatedRecordsFlowItems:r,timeZone:s,spatialReference:n,map:o}=this,{selectedFeatureViewModel:a}=this.viewModel,l={title:!1};return a?(e?(e.viewModel=a,e.visibleElements=l):this._feature=new $6t({flowItems:r,headingLevel:i+1,timeZone:s,spatialReference:n,map:o,viewModel:a,visibleElements:l}),this._feature):null}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}blur(){var i;const{active:e}=this.viewModel;e?(i=this._rootFlowItemNode)==null||i.blur():se.getLogger(this).warn("Features can only be blurred when currently active.")}clear(){return this.viewModel.clear()}close(){this.viewModel.visible=!1}fetchFeatures(e,i){return this.viewModel.fetchFeatures(e,i)}focus(){const{active:e}=this.viewModel;e?this._setFocusOn():se.getLogger(this).warn("Features can only be focused when currently active.")}next(){return this.viewModel.next()}open(e){this.removeHandles(Owe);const i={collapsed:(e==null?void 0:e.collapsed)??!1};this.set(i),this.viewModel.open(e),this.addHandles(No(()=>!this.viewModel.waitingForResult,()=>this._addSelectedFeatureIndexHandle(),{once:!0}))}previous(){return this.viewModel.previous()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){return ge("div",{bind:this,class:this.classes(xa.base,ni.widget,ni.panel),onkeydown:this._onMainKeydown},this._renderHeader(),this._renderContentContainer())}_renderFeatureNavigation(){return[this._renderPagination(),this._renderFeatureMenuButton()]}_renderHeader(){return!this.featureMenuOpen&&this.featureNavigationTop&&this._featureNavigationVisible?ge("div",{class:xa.header,key:"header-actions"},this._renderFeatureNavigation()):null}_renderFooter(){return this.featureMenuOpen||this.featureNavigationTop||!this._featureNavigationVisible?null:ge("div",{class:xa.footer,key:"footer-actions",slot:"footer"},this._renderFeatureNavigation())}_renderFeatureMenuButton(){const{messages:e,viewModel:i}=this,{featureCount:r,selectedFeatureIndex:s,pendingPromisesCount:n}=i;return ge("calcite-action",{appearance:"solid",bind:this,icon:"list",key:"feature-menu-button",label:e.selectFeature,loading:n>0,onclick:this._openFeatureMenu,scale:"s",text:dg(e.pageText,{index:Xl(s+1),total:Xl(r)}),textEnabled:!0,title:e.selectFeature})}_renderPagination(){const{previous:e,next:i}=this.messagesCommon.pagination;return ge("calcite-action-bar",{class:xa.paginationActionBar,expandDisabled:!0,key:"pagination-action-bar",layout:"horizontal",overflowActionsDisabled:!0,scale:"s"},ge("calcite-action-group",{scale:"s"},ge("calcite-action",{appearance:"solid",class:xa.paginationPrevious,icon:"chevron-left",iconFlipRtl:!0,label:e,onclick:this._previousFeature,scale:"s",text:e,title:e}),ge("calcite-action",{appearance:"solid",icon:"chevron-right",iconFlipRtl:!0,label:i,onclick:this._nextFeature,scale:"s",text:i,title:i})))}_renderFeatureMenuItem(e){const{selectedFeatureViewModel:i,featureViewModels:r}=this.viewModel,s=e===i,n=r.indexOf(e);return ge("calcite-list-item",{bind:this,"data-feature-index":n,key:`feature-menu-item-${e.uid}`,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onmouseleave:this._removeActiveFeature,onmouseover:this._setActiveFeature,selected:s,onCalciteListItemSelect:this._selectFeature},ge("span",{innerHTML:e.title||this.messagesCommon.untitled,slot:"content"}))}_groupResultsByLayer(){const{featureViewModels:e}=this.viewModel,i=new Map;return e.forEach(r=>{const s=r==null?void 0:r.graphic;if(!s)return;const{layer:n,sourceLayer:o}=s,a=($we(n)?n:null)||($we(o)?o:null),l=i.get(a)??[];i.set(a,[...l,r])}),i}_renderFeatureMenu(){const{featureViewModels:e}=this.viewModel,i=this._groupResultsByLayer();return e.length?ge("calcite-list",{selectionAppearance:"icon",selectionMode:"single"},Array.from(i.keys(),r=>{var o;const s=(o=i.get(r))==null?void 0:o.map(a=>this._renderFeatureMenuItem(a)),n=r?r.title??this.messagesCommon.untitled:null;return this.visibleElements.featureListLayerTitle&&n!==null?ge("calcite-list-item-group",{heading:n,key:(r==null?void 0:r.uid)||"map-graphics"},s):s})):null}_renderHeaderAction(e,i){const r=e.title||"";return e.visible?ge("calcite-action",{active:e.type==="toggle"&&e.value,appearance:"solid",bind:this,"data-action-uid":e.uid,disabled:e.disabled,icon:e.icon??void 0,indicator:e.indicator,key:`header-action-${i}`,loading:e.active,onclick:this._triggerHeaderAction,slot:"header-actions-end",text:r,title:r}):null}_renderHeaderActions(){return this.headerActions.map((e,i)=>this._renderHeaderAction(e,i)).toArray()}_renderContentFeature(){const{headingLevel:e,visibleElements:i,_isCollapsed:r,_collapseEnabled:s,featureNavigationTop:n}=this,{title:o,active:a}=this.viewModel,l=i.heading&&o?o:"";return ge("calcite-flow-item",{afterCreate:this._storeRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,class:this.classes({[xa.contentFeature]:!0,[xa.flowItemCollapsed]:r}),closable:i.closeButton,closed:!a,collapsed:r,collapseDirection:n?"down":"up",collapsible:s,headingLevel:e,key:"root-flow-item",onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},l?ge(sle,{class:this.classes(xa.featuresHeading,ni.heading),innerHTML:l,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),r?null:ge("div",{class:this.classes(xa.container,xa.contentContainer)},this._renderContent()),this._renderFooter())}_renderFeatureMenuContainer(){const{viewModel:e,featureMenuOpen:i,messages:r,messagesCommon:s}=this,{active:n,featureViewModels:o,pendingPromisesCount:a}=e;return i?ge("calcite-flow-item",{afterCreate:this._storeFeatureMenuFlowItemNode,afterUpdate:this._focusFeatureMenuFlowItemNode,bind:this,closable:!1,closed:!n,description:dg(r.total,{total:o.length}),heading:r.selectFeature,key:"feature-menu",loading:e.waitingForContents,onCalciteFlowItemBack:l=>{l.preventDefault(),this._handleFeatureMenuBack()}},a>0?ge("calcite-loader",{class:xa.loader,inline:!0,key:"feature-menu-loader",label:s.loading,slot:"header-actions-end"}):null,ge("div",{class:xa.container},this._renderFeatureMenu()),ge("div",{afterCreate:this._featureMenuIntersectionObserverCreated,bind:this,class:xa.featureMenuObserver}),ge("calcite-button",{appearance:"transparent",onclick:this._handleFeatureMenuBack,slot:"footer-actions",width:"full"},s.back)):null}_renderContentContainer(){const e=[this._renderContentFeature(),this._renderFeatureMenuContainer(),this._relatedRecordsWidget.render()];return this.visibleElements.flow?ge("calcite-flow",{key:"content-container"},e):e}_getFallbackIcon(e){const{className:i,icon:r}=e;if(r)return null;const s=GUt({action:e,feature:this.selectedFeature}),n={[xa.icon]:!!i,[xa.actionImage]:!!s};return i&&(n[i]=!0),s||i?ge("span",{"aria-hidden":"true",class:this.classes(xa.icon,n),key:"icon",styles:jUt(s)}):null}_renderActionBar(){var e;return!this._isCollapsed&&this.visibleElements.actionBar&&((e=this.viewModel.allActions)!=null&&e.length)?ge("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},ge("calcite-action-group",{afterCreate:i=>this._actionBarMenuNode=i,overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map(this._renderAction)}_renderContent(){var i;const e=(i=this.viewModel)==null?void 0:i.content;return e?typeof e=="string"?ge("div",{class:Fn.contentNode,innerHTML:e,key:e}):this.renderNodeContent(e):null}_setFocusOn(){this.renderNow(),requestAnimationFrame(()=>{this._focusOn=this.featureMenuOpen?"menu-flow-item":"root-flow-item"})}_handleCollapseToggle(){this.collapsed=!this.collapsed}async _openRelatedFeature(e){await e.viewModel.updateGeometry();const i=e.graphic,r=i==null?void 0:i.geometry;if(r==null||i==null)return;this._destroyRelatedRecordsFlowItemWidgets(),await this.viewModel.zoomTo({target:r});const s=fee(r);this.open({features:[i],location:s??void 0})}_focusRootFlowItemNode(){this._focusFlowItemNodeThrottled("root-flow-item")}_focusFeatureMenuFlowItemNode(){this._focusFlowItemNodeThrottled("menu-flow-item")}_storeRootFlowItemNode(e){this._rootFlowItemNode=e,this._focusFlowItemNodeThrottled("root-flow-item")}_storeFeatureMenuFlowItemNode(e){this._featureMenuViewportNode=e,this._focusFlowItemNodeThrottled("menu-flow-item")}_setActiveFeature(e){var s;const{viewModel:i}=this,r=e.currentTarget["data-feature-index"];i.activeFeature=((s=i.features)==null?void 0:s[r])||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_selectFeature(e){const i=e.currentTarget["data-feature-index"];isNaN(i)||(this.viewModel.selectedFeatureIndex=i),this._handleFeatureMenuBack()}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_getActionIcon(e){return e.icon?e.icon:e.image||e.className?void 0:"question"}_getActionTitle(e){const{messages:i,selectedFeature:r,messagesCommon:s}=this,{id:n}=e,o=r==null?void 0:r.attributes,a=e.title??"",l=n==="zoom-to-feature"?dg(a,{messages:i}):n==="remove-selected-feature"?dg(a,{messages:s}):n==="zoom-to-clustered-features"||n==="browse-clustered-features"?dg(a,{messages:i}):e.title;return l&&o?dg(l,o):l??""}_onMainKeydown(e){const{key:i}=e;i==="ArrowLeft"&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.previous()),i==="ArrowRight"&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.next())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&this._featureMenuViewportNode.scrollContentTo({top:0})}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:e,messagesCommon:i}=this,r=e==null?void 0:e.viewModel;e&&(this.viewModel.title=(r==null?void 0:r.state)==="error"?i==null?void 0:i.errorMessage:(r==null?void 0:r.title)||"")}_addSelectedFeatureIndexHandle(){const e=te(()=>{var i;return(i=this.viewModel)==null?void 0:i.selectedFeatureIndex},(i,r)=>this._selectedFeatureIndexUpdated(i,r));this.addHandles(e,Owe)}_selectedFeatureIndexUpdated(e,i){const{featureCount:r}=this.viewModel;r&&e!==i&&e!==-1&&(this._destroyRelatedRecordsFlowItemWidgets(),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_triggerHeaderAction(e){const i=e.currentTarget;if(i.disabled)return;const r=i.dataset.actionUid,s=this.headerActions.find(({uid:n})=>n===r);s&&!s.disabled&&((s==null?void 0:s.type)==="toggle"&&(s.value=!s.value),this.emit("trigger-header-action",{action:s}))}_triggerAction(e){const i=e.currentTarget;if(i.disabled)return;const r=i.dataset.actionUid,{allActions:s}=this.viewModel,n=s.findIndex(a=>a.uid===r),o=s.at(n);o&&o.type==="toggle"&&(o.value=!o.value),this.viewModel.triggerAction(n)}_createSpinner(e){e&&(this._spinner=new I6t({view:e}),e.ui.add(this._spinner,{key:Rwe,position:"manual",internal:!0}))}_wireUpView(e){var i;this._destroySpinner(),e&&((i=this.visibleElements)!=null&&i.spinner)&&this._createSpinner(e)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_viewReadyChange(e,i){var r;e?this._wireUpView((r=this.viewModel)==null?void 0:r.view):i&&this.viewModel.clear()}_viewChange(e,i){e&&i&&this.viewModel.clear()}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,!e.destroyed&&e.destroy()),this._feature=null}_closeOpenActionMenu(){const{_actionBarMenuNode:e}=this;e&&(e.menuOpen=!1)}_destroyRelatedRecordsFlowItemWidgets(){this._relatedRecordsFlowItems.drain(e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()})}_toggleScreenLocationEnabled(){const{viewModel:e}=this;e&&(e.screenLocationEnabled=e.active)}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:i,waitingForResult:r}=this.viewModel;r&&i?e.show({location:i}):e.hide()}_destroySpinner(){var r;const{_spinner:e,view:i}=this;e&&((r=i==null?void 0:i.ui)==null||r.remove(e,Rwe),e.destroy(),this._spinner=null)}_spinnerEnabledChange(e){var i;this._destroySpinner(),e&&this._createSpinner((i=this.viewModel)==null?void 0:i.view)}};h([p()],pr.prototype,"_focusOn",void 0),h([p()],pr.prototype,"_relatedRecordsFlowItems",void 0),h([p()],pr.prototype,"_hideActionText",null),h([p()],pr.prototype,"_featureNavigationVisible",null),h([p()],pr.prototype,"_isCollapsed",null),h([p()],pr.prototype,"_collapseEnabled",null),h([p({readOnly:!0})],pr.prototype,"active",null),h([p()],pr.prototype,"collapsed",void 0),h([p()],pr.prototype,"content",null),h([p()],pr.prototype,"icon",null),h([p()],pr.prototype,"featureMenuOpen",null),h([p()],pr.prototype,"featureNavigationTop",void 0),h([p()],pr.prototype,"features",null),h([p()],pr.prototype,"goToOverride",null),h([p({type:xS})],pr.prototype,"headerActions",void 0),h([p()],pr.prototype,"headingLevel",void 0),h([p()],pr.prototype,"location",null),h([p()],pr.prototype,"label",null),h([p()],pr.prototype,"map",null),h([p(),Fa("esri/widgets/Features/t9n/Features")],pr.prototype,"messages",void 0),h([p(),Fa("esri/t9n/common")],pr.prototype,"messagesCommon",void 0),h([p()],pr.prototype,"promises",null),h([p()],pr.prototype,"responsiveActionsEnabled",void 0),h([p({readOnly:!0})],pr.prototype,"selectedFeature",null),h([p()],pr.prototype,"selectedFeatureIndex",null),h([p({readOnly:!0})],pr.prototype,"selectedFeatureWidget",null),h([p()],pr.prototype,"spatialReference",null),h([p()],pr.prototype,"title",null),h([p()],pr.prototype,"timeZone",null),h([p()],pr.prototype,"updateLocationEnabled",null),h([p()],pr.prototype,"view",null),h([p({type:Ele}),Qae(["triggerAction","trigger-action"])],pr.prototype,"viewModel",void 0),h([p({type:CBe,nonNullable:!0})],pr.prototype,"visibleElements",void 0),h([p()],pr.prototype,"visible",null),pr=h([I("esri.widgets.Features")],pr);const X6t=pr,oh="esri-popup",nx=`${oh}--is-docked`,Qn={base:oh,baseHidden:`${oh}--hidden`,main:`${oh}__main-container`,shadow:`${oh}--shadow`,isDocked:nx,isDockedTopLeft:`${nx}-top-left`,isDockedTopCenter:`${nx}-top-center`,isDockedTopRight:`${nx}-top-right`,isDockedBottomLeft:`${nx}-bottom-left`,isDockedBottomCenter:`${nx}-bottom-center`,isDockedBottomRight:`${nx}-bottom-right`,alignTopCenter:`${oh}--aligned-top-center`,alignBottomCenter:`${oh}--aligned-bottom-center`,alignTopLeft:`${oh}--aligned-top-left`,alignBottomLeft:`${oh}--aligned-bottom-left`,alignTopRight:`${oh}--aligned-top-right`,alignBottomRight:`${oh}--aligned-bottom-right`,pointer:`${oh}__pointer`,pointerDirection:`${oh}__pointer-direction`};let Fte=class extends Ele{constructor(t){super(t)}};Fte=h([I("esri.widgets.Popup.PopupViewModel")],Fte);const MBe=Fte;let ig=class extends Ue{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!0,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.heading=!0,this.spinner=!0}};h([p({type:Boolean,nonNullable:!0})],ig.prototype,"actionBar",void 0),h([p({type:Boolean,nonNullable:!0})],ig.prototype,"closeButton",void 0),h([p({type:Boolean,nonNullable:!0})],ig.prototype,"collapseButton",void 0),h([p({type:Boolean,nonNullable:!0})],ig.prototype,"featureNavigation",void 0),h([p({type:Boolean,nonNullable:!0})],ig.prototype,"featureListLayerTitle",void 0),h([p({type:Boolean,nonNullable:!0})],ig.prototype,"heading",void 0),h([p({type:Boolean,nonNullable:!0})],ig.prototype,"spinner",void 0),ig=h([I("esri.widgets.Popup.PopupVisibleElements")],ig);const kte=ig,Iwe={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};let fr=class extends Ua{constructor(t,e){super(t,e),this._dockAction=new QP({id:"popup-dock-action"}),this._featuresWidget=new X6t({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this.alignment="auto",this.dockEnabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new MBe,this.visibleElements=new kte}initialize(){this.addHandles([te(()=>{var t,e;return[(e=(t=this.viewModel)==null?void 0:t.view)==null?void 0:e.widthBreakpoint,this.dockEnabled]},()=>this._handleDockIcon(),$t),te(()=>{var t,e;return[this.dockEnabled,(t=this.messages)==null?void 0:t.undock,(e=this.messages)==null?void 0:e.dock]},()=>this._handleDockEnabled(),$t),te(()=>this.dockOptions,t=>{const{_dockAction:e}=this,i=this._featuresWidget.headerActions;i.remove(e),t.buttonEnabled&&i.add(e)},$t),te(()=>{var t;return(t=this.viewModel)==null?void 0:t.screenLocation},()=>this._positionContainer()),te(()=>{var t;return[(t=this.viewModel)==null?void 0:t.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),te(()=>{var t,e,i,r,s,n,o;return[(t=this.viewModel)==null?void 0:t.screenLocation,(i=(e=this.viewModel)==null?void 0:e.view)==null?void 0:i.padding,(s=(r=this.viewModel)==null?void 0:r.view)==null?void 0:s.size,(n=this.viewModel)==null?void 0:n.active,(o=this.viewModel)==null?void 0:o.location,this.alignment]},()=>this.reposition()),te(()=>{var t,e;return(e=(t=this.viewModel)==null?void 0:t.view)==null?void 0:e.size},(t,e)=>this._updateDockEnabledForViewSize(t,e)),te(()=>{var t;return(t=this.viewModel)==null?void 0:t.view},(t,e)=>this._viewChange(t,e)),te(()=>{var t,e;return(e=(t=this.viewModel)==null?void 0:t.view)==null?void 0:e.ready},(t,e)=>this._viewReadyChange(t??!1,e??!1)),te(()=>this.viewModel,()=>this._featuresWidget.viewModel=this.viewModel,$t),te(()=>this._featureNavigationTop,t=>this._featuresWidget.featureNavigationTop=t,$t),te(()=>this.headingLevel,t=>this._featuresWidget.headingLevel=t,$t),te(()=>this.visibleElements.actionBar,t=>this._featuresWidget.visibleElements.actionBar=!!t,$t),te(()=>this.visibleElements.closeButton,t=>this._featuresWidget.visibleElements.closeButton=!!t,$t),te(()=>this.visibleElements.collapseButton,t=>this._featuresWidget.visibleElements.collapseButton=!!t,$t),te(()=>this.visibleElements.heading,t=>this._featuresWidget.visibleElements.heading=!!t,$t),te(()=>this.visibleElements.spinner,t=>this._featuresWidget.visibleElements.spinner=!!t,$t),te(()=>this.visibleElements.featureNavigation,t=>this._featuresWidget.visibleElements.featureNavigation=!!t,$t),te(()=>this.visibleElements.featureListLayerTitle,t=>this._featuresWidget.visibleElements.featureListLayerTitle=!!t,$t),Ks(()=>this._featuresWidget,"trigger-header-action",t=>{t.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)})])}normalizeCtorArgs(t){const e={...t};return(t==null?void 0:t.visibleElements)!=null&&(e.visibleElements=new kte(t.visibleElements),t.collapseEnabled!=null&&(e.visibleElements.collapseButton=t.collapseEnabled),t.spinnerEnabled!=null&&(e.visibleElements.spinner=t.spinnerEnabled)),e}destroy(){var t;this._dockAction.destroy(),(t=this._featuresWidget)==null||t.destroy()}get _featureNavigationTop(){const{currentAlignment:t,currentDockPosition:e}=this;return t==="bottom-left"||t==="bottom-center"||t==="bottom-right"||e==="top-left"||e==="top-center"||e==="top-right"}get actions(){return this.viewModel.actions}set actions(t){this.viewModel.actions=t}get active(){return this.viewModel.active}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(t){this.viewModel.autoCloseEnabled=t}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(t){this.viewModel.defaultPopupTemplateEnabled=t}get content(){return this.viewModel.content}set content(t){this.viewModel.content=t}get collapsed(){return this._featuresWidget.collapsed}set collapsed(t){this._featuresWidget.collapsed=t}get collapseEnabled(){return DR(se.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton}set collapseEnabled(t){DR(se.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton=t}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||Iwe}set dockOptions(t){var a,l;const e={...Iwe},i=(l=(a=this.viewModel)==null?void 0:a.view)==null?void 0:l.breakpoints,r={};i&&(r.width=i.xsmall,r.height=i.xsmall);const s={...e,...t},n={...e.breakpoint,...r},{breakpoint:o}=s;typeof o=="object"?s.breakpoint={...n,...o}:o&&(s.breakpoint=n),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(t){this.viewModel.featureMenuOpen=t}get features(){return this.viewModel.features}set features(t){this.viewModel.features=t}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(t){this.viewModel.goToOverride=t}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(t){this.viewModel.highlightEnabled=t}get icon(){return"popup"}set icon(t){this._overrideIfSome("icon",t)}get location(){return this.viewModel.location}set location(t){this.viewModel.location=t}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get promises(){return this.viewModel.promises}set promises(t){this.viewModel.promises=t}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(t){this.viewModel.selectedFeatureIndex=t}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get spinnerEnabled(){return DR(se.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner}set spinnerEnabled(t){DR(se.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner=t}get title(){return this.viewModel.title}set title(t){this.viewModel.title=t}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(t){this.viewModel.updateLocationEnabled=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}get visible(){return this.viewModel.visible}set visible(t){this.viewModel.visible=t}blur(){const{active:t}=this.viewModel;t||se.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(t,e){return this.viewModel.fetchFeatures(t,e)}focus(){const{active:t}=this.viewModel;t||se.getLogger(this).warn("Popup can only be focused when currently active."),this.reposition(),requestAnimationFrame(()=>{this._featuresWidget.focus()})}next(){return this.viewModel.next()}open(t){const e=!!t&&!!t.featureMenuOpen,i={collapsed:!!t&&!!t.collapsed,featureMenuOpen:e};this.set(i),this.viewModel.open(t),this._shouldFocus(t)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(t){return this.viewModel.triggerAction(t)}render(){var u,d,f,m;const{dockEnabled:t,currentAlignment:e,currentDockPosition:i}=this,{active:r,screenLocation:s}=this.viewModel,n=r&&t,o=r&&!t,a=(d=(u=this.selectedFeature)==null?void 0:u.layer)==null?void 0:d.title,l=(m=(f=this.selectedFeature)==null?void 0:f.layer)==null?void 0:m.id,c={[Qn.alignTopCenter]:e==="top-center",[Qn.alignBottomCenter]:e==="bottom-center",[Qn.alignTopLeft]:e==="top-left",[Qn.alignBottomLeft]:e==="bottom-left",[Qn.alignTopRight]:e==="top-right",[Qn.alignBottomRight]:e==="bottom-right",[Qn.isDocked]:n,[Qn.shadow]:o,[Qn.isDockedTopLeft]:i==="top-left",[Qn.isDockedTopCenter]:i==="top-center",[Qn.isDockedTopRight]:i==="top-right",[Qn.isDockedBottomLeft]:i==="bottom-left",[Qn.isDockedBottomCenter]:i==="bottom-center",[Qn.isDockedBottomRight]:i==="bottom-right"};return ge("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,bind:this,class:this.classes(Qn.base,c,{[Qn.baseHidden]:!s&&!t}),"data-layer-id":l,"data-layer-title":a,role:"presentation"},r?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:ge("div",{class:Qn.pointer,key:"popup-pointer",role:"presentation"},ge("div",{class:this.classes(Qn.pointerDirection,Qn.shadow)}))}_renderMainContainer(){const{dockEnabled:t}=this,e={[Qn.shadow]:t};return ge("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(Qn.main,ni.widget,e)},this._featuresWidget.render())}async _shouldFocus(t){t!=null&&t.shouldFocus&&(await VS(()=>{var e;return((e=this.viewModel)==null?void 0:e.active)===!0}),this.focus())}_isOutsideView(t){const{popupHeight:e,popupWidth:i,screenLocation:r,side:s,view:n}=t;if(isNaN(i)||isNaN(e)||!n||!r)return!1;const o=n.padding;return s==="right"&&r.x+i/2>n.width-o.right||s==="left"&&r.x-i/2<o.left||s==="top"&&r.y-e<o.top||s==="bottom"&&r.y+e>n.height-o.bottom}_calculateAutoAlignment(t){if(t!=="auto")return t;const{_pointerOffsetInPx:e,_containerNode:i,_mainContainerNode:r,viewModel:s}=this,{screenLocation:n,view:o}=s;if(n==null||!o||!i)return"top-center";function a(x){return parseInt(x.replaceAll(/[^-\d.]/g,""),10)}const l=r?window.getComputedStyle(r,null):null,c=l?a(l.getPropertyValue("max-height")):0,u=l?a(l.getPropertyValue("height")):0,{height:d,width:f}=i.getBoundingClientRect(),m=f+e,g=Math.max(d,c,u)+e,y=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"right",view:o}),v=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"left",view:o}),b=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"top",view:o}),w=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"bottom",view:o});return v?b?"bottom-right":"top-right":y?b?"bottom-left":"top-left":b?w?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(t){return typeof t=="function"?t.call(this):t}_getCurrentAlignment(){const{alignment:t,dockEnabled:e}=this;return e||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(t)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(t){const e=["left","right"];return Cb(this.container)&&e.reverse(),t==null?void 0:t.replace(/leading/gi,e[0]).replaceAll(/trailing/gi,e[1])}_callDockPosition(t){return typeof t=="function"?t.call(this):t}_getDockPosition(){var t;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((t=this.dockOptions)==null?void 0:t.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(t){var o;if(t!=="auto")return t;const e=(o=this.viewModel)==null?void 0:o.view,i=Cb(this.container)?"top-left":"top-right";if(!e)return i;const r=e.padding||{left:0,right:0,top:0,bottom:0},s=e.width-r.left-r.right,{breakpoints:n}=e;return n&&s<=n.xsmall?"bottom-center":i}_getDockIcon(){const t=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(t){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){var t,e;this._dockAction.title=this.dockEnabled?(t=this.messages)==null?void 0:t.undock:(e=this.messages)==null?void 0:e.dock}_setMainContainerNode(t){this._mainContainerNode=t}_positionContainer(t=this._containerNode){if(t&&(this._containerNode=t),!this._containerNode)return;const{screenLocation:e}=this.viewModel,{width:i}=this._containerNode.getBoundingClientRect(),r=this._calculatePositionStyle(e,i);r&&Object.assign(this._containerNode.style,r)}_calculateFullWidth(t){const{currentAlignment:e,_pointerOffsetInPx:i}=this;return e==="top-left"||e==="bottom-left"||e==="top-right"||e==="bottom-right"?t+i:t}_calculateAlignmentPosition(t,e,i,r){const{currentAlignment:s,_pointerOffsetInPx:n}=this;if(!i)return;const{padding:o}=i,a=r/2,l=i.height-e,c=i.width-t;return s==="bottom-center"?{top:e+n-o.top,left:t-a-o.left}:s==="top-left"?{bottom:l+n-o.bottom,right:c+n-o.right}:s==="bottom-left"?{top:e+n-o.top,right:c+n-o.right}:s==="top-right"?{bottom:l+n-o.bottom,left:t+n-o.left}:s==="bottom-right"?{top:e+n-o.top,left:t+n-o.left}:s==="top-center"?{bottom:l+n-o.bottom,left:t-a-o.left}:void 0}_calculatePositionStyle(t,e){const{dockEnabled:i,view:r}=this;if(!r)return;if(i)return{left:"",top:"",right:"",bottom:""};if(t==null||!e)return;const s=this._calculateFullWidth(e),n=this._calculateAlignmentPosition(t.x,t.y,r,s);return n?{top:n.top!==void 0?`${n.top}px`:"auto",left:n.left!==void 0?`${n.left}px`:"auto",bottom:n.bottom!==void 0?`${n.bottom}px`:"auto",right:n.right!==void 0?`${n.right}px`:"auto"}:void 0}_viewChange(t,e){t&&e&&(this.close(),this.clear())}_viewReadyChange(t,e){t?this._wireUpView():e&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(t,e,i){const[r,s]=t,[n,o]=e,{width:a=0,height:l=0}=i??{};return r<=a&&n>a||r>a&&n<=a||s<=l&&o>l||s>l&&o<=l}_updateDockEnabledForViewSize(t,e){var c,u;if(!t||!e)return;const i=((u=(c=this.viewModel)==null?void 0:c.view)==null?void 0:u.padding)||{left:0,right:0,top:0,bottom:0},r=i.left+i.right,s=i.top+i.bottom,n=[],o=[];n[0]=t[0]-r,n[1]=t[1]-s,o[0]=e[0]-r,o[1]=e[1]-s;const{dockOptions:a}=this,l=a.breakpoint;this._dockingThresholdCrossed(n,o,l)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){const{dockEnabled:t,viewModel:e}=this;if(!e)return;const i=e.active&&!t;e.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(t){var a,l;const e=t.breakpoint,i=(l=(a=this.viewModel)==null?void 0:a.view)==null?void 0:l.ui;if(!i)return!1;const{width:r,height:s}=i;if(isNaN(r)||isNaN(s)||!e)return!1;const n=e.hasOwnProperty("width")&&r<=(e.width??0),o=e.hasOwnProperty("height")&&s<=(e.height??0);return n||o}_setDockEnabledForViewSize(t){t.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(t))}};h([p({readOnly:!0})],fr.prototype,"_featureNavigationTop",null),h([p()],fr.prototype,"actions",null),h([p({readOnly:!0})],fr.prototype,"active",null),h([p()],fr.prototype,"alignment",void 0),h([p()],fr.prototype,"autoCloseEnabled",null),h([p()],fr.prototype,"defaultPopupTemplateEnabled",null),h([p()],fr.prototype,"content",null),h([p()],fr.prototype,"collapsed",null),h([p()],fr.prototype,"collapseEnabled",null),h([p({readOnly:!0})],fr.prototype,"currentAlignment",null),h([p({readOnly:!0})],fr.prototype,"currentDockPosition",null),h([p()],fr.prototype,"dockOptions",null),h([p()],fr.prototype,"dockEnabled",void 0),h([p({readOnly:!0})],fr.prototype,"featureCount",null),h([p()],fr.prototype,"featureMenuOpen",null),h([p()],fr.prototype,"features",null),h([p()],fr.prototype,"goToOverride",null),h([p()],fr.prototype,"headingLevel",void 0),h([p()],fr.prototype,"highlightEnabled",null),h([p()],fr.prototype,"icon",null),h([p()],fr.prototype,"location",null),h([p()],fr.prototype,"label",null),h([p(),Fa("esri/widgets/Popup/t9n/Popup")],fr.prototype,"messages",void 0),h([p()],fr.prototype,"promises",null),h([p({readOnly:!0})],fr.prototype,"selectedFeature",null),h([p()],fr.prototype,"selectedFeatureIndex",null),h([p({readOnly:!0})],fr.prototype,"selectedFeatureWidget",null),h([p()],fr.prototype,"spinnerEnabled",null),h([p()],fr.prototype,"title",null),h([p()],fr.prototype,"updateLocationEnabled",null),h([p()],fr.prototype,"view",null),h([p({type:MBe}),Qae(["triggerAction","trigger-action"])],fr.prototype,"viewModel",void 0),h([p()],fr.prototype,"visible",null),h([p({type:kte,nonNullable:!0})],fr.prototype,"visibleElements",void 0),fr=h([I("esri.widgets.Popup")],fr);const ABe=fr,Lwe=Object.freeze(Object.defineProperty({__proto__:null,default:ABe},Symbol.toStringTag,{value:"Module"}));let J6t=class{constructor(e,i){mw(this,"spatialReference",{spatialReference_EPSG3111:{name:"",spatialReferenceObj:new Ze({wkid:3111})},spatialReference_EPSG28355:{name:"",spatialReferenceObj:new Ze({wkid:28355})},spatialReference_EPSG4326:{name:"",spatialReferenceObj:new Ze({wkid:3857})},spatialReference_EPSG3857:{name:"",spatialReferenceObj:Ze.WGS84},spatialReference_EPSG7844:{name:"",spatialReferenceObj:new Ze({wkid:7844})}});mw(this,"view",null);mw(this,"map",null);console.debug(e),console.debug(i)}addDefaultTools(e){$6e("en-GB"),this.setProjectionName(this.spatialReference);const i=this.view;i.ui.remove("navigation-toggle"),i.ui.move(["zoom","compass"],"bottom-right");let r=new QVe;r.view=i;var s=new BUt;s.view=i,i.ui.add(s,"bottom-right"),e()}setProjectionName(e){for(let i in e){let r=e[i],s=`https://epsg.io/${r.spatialReferenceObj.wkid}.json`,n=new Request(s);fetch(n).then(function(o){if(console.debug(o),o.status===200)o.json().then(function(a){r.name=a.name,console.debug(a)});else throw new Error("Something went wrong on API server!")}).catch(function(o){console.error(o)}),console.log(i)}}};class Q6t extends J6t{constructor(i,r){super(i,r);mw(this,"view",new Q1e);mw(this,"map",new Lhe);this.initialiseMap(i,r)}initialiseMap(i,r){let s=null;const n="./map/MelbourneDigitalTwin.json",o=new Request(n);fetch(o).then(a=>{if(console.debug(a),a.status===200)a.json().then(l=>{console.debug(l),s=Lhe.fromJSON(l),this.map=s,this.setWebMap(s,i,r)});else throw new Error(`Request Error: ${n}`)})}setWebMap(i,r,s){const n=new Q1e({container:r,map:i,popupEnabled:!0,popup:new ABe});this.view=n,n.when().then(()=>{this.addDefaultTools(()=>{this.add3DWidgets(this)}),s()})}add3DWidgets(i){console.debug(i)}}const T1=class T1{static getInstance(){return T1.instance||(T1.instance=new T1,T1.instance.initialise()),T1.instance}initialise(){console.log("Initialise Map");const e="map3D",i=new Q6t(e,this.postMapInitialise);console.debug(i)}postMapInitialise(){const e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href","./style/arcgis.css"),document.head.appendChild(e)}};mw(T1,"instance");let Ute=T1;const K6t={data(){return{panel:{id:{PANEL_MAP:""},visible:{left:!0},obj:{resize:null,left:null,map:null}}}},created(){},mounted(){const t=document.querySelector("#mapPanel");this.panel.id.PANEL_MAP=t?t.id:"";const e=Ute.getInstance();console.debug(e)}},eHt=(t,e)=>{const i=t.__vccOpts||t;for(const[r,s]of e)i[r]=s;return i},tHt=t=>(Cje("data-v-0baa71e9"),t=t(),Mje(),t),iHt={id:"leftPanel"},rHt=tHt(()=>H3("div",{id:"map3D"},null,-1)),sHt=[rHt];function nHt(t,e,i,r,s,n){return wGe(),SGe(ug,null,[Pje(H3("div",iHt,null,512),[[HGe,s.panel.visible.left]]),H3("div",{id:"mapPanel",class:vj([{mapPanel:s.panel.visible.left,mapFull:!s.panel.visible.left}])},sHt,2)],64)}const oHt=eHt(K6t,[["render",nHt],["__scopeId","data-v-0baa71e9"]]);c6e(oHt).mount("#app");const aHt=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:tA,build:FRe},Symbol.toStringTag,{value:"Module"})),lHt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:Hse,build:r$e},Symbol.toStringTag,{value:"Module"})),cHt=Object.freeze(Object.defineProperty({__proto__:null,build:l$e},Symbol.toStringTag,{value:"Module"})),uHt=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:Qse,build:m$e},Symbol.toStringTag,{value:"Module"})),hHt=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:Kse,build:_$e},Symbol.toStringTag,{value:"Module"})),dHt=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:tne,build:D$e},Symbol.toStringTag,{value:"Module"})),pHt=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:sne,SimpleAtmospherePassParameters:JG,build:j$e},Symbol.toStringTag,{value:"Module"})),fHt=Object.freeze(Object.defineProperty({__proto__:null,build:fIe},Symbol.toStringTag,{value:"Module"})),mHt=Object.freeze(Object.defineProperty({__proto__:null,build:yIe},Symbol.toStringTag,{value:"Module"})),gHt=Object.freeze(Object.defineProperty({__proto__:null,build:Q3e,calculateAnchorPosForRendering:PL},Symbol.toStringTag,{value:"Module"})),yHt=Object.freeze(Object.defineProperty({__proto__:null,build:JLe},Symbol.toStringTag,{value:"Module"})),_Ht=Object.freeze(Object.defineProperty({__proto__:null,build:eDe,getRadius:A6},Symbol.toStringTag,{value:"Module"})),vHt=Object.freeze(Object.defineProperty({__proto__:null,build:sDe},Symbol.toStringTag,{value:"Module"})),bHt=Object.freeze(Object.defineProperty({__proto__:null,build:oDe},Symbol.toStringTag,{value:"Module"})),wHt=Object.freeze(Object.defineProperty({__proto__:null,build:TDe},Symbol.toStringTag,{value:"Module"})),xHt=Object.freeze(Object.defineProperty({__proto__:null,build:RNe,ribbonlineNumRoundJoinSubdivisions:LL},Symbol.toStringTag,{value:"Module"})),THt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:Coe,build:oNe},Symbol.toStringTag,{value:"Module"})),SHt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:Doe,build:GNe},Symbol.toStringTag,{value:"Module"})),EHt=Object.freeze(Object.defineProperty({__proto__:null,build:l4e},Symbol.toStringTag,{value:"Module"})),CHt=Object.freeze(Object.defineProperty({__proto__:null,build:x4e},Symbol.toStringTag,{value:"Module"})),MHt=Object.freeze(Object.defineProperty({__proto__:null,build:r5e},Symbol.toStringTag,{value:"Module"})),AHt=Object.freeze(Object.defineProperty({__proto__:null,build:u5e},Symbol.toStringTag,{value:"Module"})),PHt=Object.freeze(Object.defineProperty({__proto__:null,build:p5e},Symbol.toStringTag,{value:"Module"})),OHt=Object.freeze(Object.defineProperty({__proto__:null,build:S5e},Symbol.toStringTag,{value:"Module"})),RHt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:Tae,build:bke},Symbol.toStringTag,{value:"Module"})),$Ht=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return zb},build:Hke},Symbol.toStringTag,{value:"Module"})),IHt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:Xke,ColorizerStretchUniforms:Yke,ColorizerUniforms:eH,build:Jke},Symbol.toStringTag,{value:"Module"})),LHt=Object.freeze(Object.defineProperty({__proto__:null,build:cUe},Symbol.toStringTag,{value:"Module"})),DHt=Object.freeze(Object.defineProperty({__proto__:null,build:vUe},Symbol.toStringTag,{value:"Module"})),NHt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:Nae,build:xUe},Symbol.toStringTag,{value:"Module"})),FHt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:Lae,blurSize:Dae,build:_Ue,gridCellPixelSize:rf,outlineSize:qL},Symbol.toStringTag,{value:"Module"})),kHt=Object.freeze(Object.defineProperty({__proto__:null,build:AUe},Symbol.toStringTag,{value:"Module"})),UHt=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:kae,build:RUe},Symbol.toStringTag,{value:"Module"})),VHt=Object.freeze(Object.defineProperty({__proto__:null,build:LUe},Symbol.toStringTag,{value:"Module"})),zHt=Object.freeze(Object.defineProperty({__proto__:null,build:FUe},Symbol.toStringTag,{value:"Module"})),BHt=Object.freeze(Object.defineProperty({__proto__:null,build:VUe},Symbol.toStringTag,{value:"Module"})),jHt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:tH,build:jUe},Symbol.toStringTag,{value:"Module"})),GHt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:Vae,build:HUe},Symbol.toStringTag,{value:"Module"})),HHt=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:zae,build:ZUe},Symbol.toStringTag,{value:"Module"})),qHt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:jae,build:iVe},Symbol.toStringTag,{value:"Module"})),WHt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:uN,build:tVe},Symbol.toStringTag,{value:"Module"})),ZHt=Object.freeze(Object.defineProperty({__proto__:null,ViewshedPassParameters:Gae,build:lVe},Symbol.toStringTag,{value:"Module"}));export{Wn as $,ra as A,se as B,No as C,ab as D,roi as E,Hie as F,te as G,vui as H,or as I,Bc as J,Kg as K,le as L,Woi as M,YQ as N,uui as O,$t as P,ca as Q,TIt as R,Ue as S,hr as T,yr as U,st as V,uy as W,Jl as X,WP as Y,iS as Z,ce as _,I as a,ie as a$,Bi as a0,E_ as a1,Qe as a2,Ag as a3,Ise as a4,BOe as a5,Hot as a6,M2 as a7,tO as a8,Bt as a9,ur as aA,Ze as aB,Ik as aC,Gce as aD,uKe as aE,Vxe as aF,SJe as aG,VS as aH,g9t as aI,joi as aJ,$5t as aK,hui as aL,gae as aM,ki as aN,ndi as aO,dD as aP,Us as aQ,Ks as aR,Fi as aS,mD as aT,n$t as aU,Jg as aV,hWe as aW,Ot as aX,Se as aY,We as aZ,dJe as a_,y3 as aa,$Bt as ab,os as ac,yei as ad,_ei as ae,Syt as af,Gi as ag,d_ as ah,Lh as ai,GQt as aj,Kii as ak,rWt as al,yse as am,ai as an,wW as ao,kxe as ap,zD as aq,Eui as ar,zVe as as,xui as at,pkt as au,gui as av,bui as aw,bt as ax,Ef as ay,jP as az,PVe as b,wK as b$,YB as b0,mAe as b1,ii as b2,qSe as b3,Uj as b4,sre as b5,kS as b6,eL as b7,jXe as b8,F1 as b9,ke as bA,kEe as bB,qh as bC,db as bD,yWe as bE,Fg as bF,HKt as bG,Phi as bH,lhe as bI,aOe as bJ,JUt as bK,ry as bL,wn as bM,Ohi as bN,Ji as bO,_ri as bP,Wr as bQ,Rqt as bR,Gvt as bS,sa as bT,Gh as bU,$h as bV,ZEt as bW,gr as bX,_D as bY,Mb as bZ,Ub as b_,Oh as ba,yZe as bb,MA as bc,_Ze as bd,pBe as be,dG as bf,Uh as bg,H8t as bh,R7e as bi,Tqt as bj,nle as bk,cD as bl,Nri as bm,cEe as bn,E as bo,zl as bp,jct as bq,Ge as br,P8 as bs,hn as bt,dYt as bu,pYt as bv,Nz as bw,$pe as bx,AYe as by,Zn as bz,wui as c,kri as c$,xK as c0,JEt as c1,YEt as c2,QEt as c3,XEt as c4,y4e as c5,O6 as c6,v4e as c7,Rue as c8,Vr as c9,Tze as cA,cXe as cB,HT as cC,Bst as cD,ES as cE,ib as cF,vg as cG,of as cH,Fse as cI,blt as cJ,mt as cK,zn as cL,MRe as cM,bh as cN,Q7t as cO,eot as cP,aJt as cQ,AL as cR,lJt as cS,Zr as cT,Fo as cU,Yf as cV,ft as cW,Ce as cX,de as cY,oL as cZ,D6t as c_,Yr as ca,pl as cb,Re as cc,nt as cd,Ug as ce,Lr as cf,rk as cg,Xn as ch,op as ci,CWt as cj,uei as ck,oi as cl,hs as cm,X1 as cn,zh as co,int as cp,c7t as cq,JV as cr,Hf as cs,M5 as ct,BA as cu,sS as cv,_f as cw,ol as cx,vf as cy,SXe as cz,Tkt as d,_B as d$,It as d0,xjt as d1,HP as d2,HA as d3,b_ as d4,ec as d5,rZ as d6,on as d7,iZ as d8,nZ as d9,o7t as dA,Ab as dB,rs as dC,ZG as dD,im as dE,er as dF,KMe as dG,$o as dH,YM as dI,Hd as dJ,wM as dK,TP as dL,vXt as dM,dS as dN,gut as dO,OYt as dP,AYt as dQ,PYt as dR,R as dS,Noe as dT,Z9t as dU,Ebt as dV,Cbt as dW,yP as dX,Ne as dY,Mh as dZ,Gyt as d_,oz as da,zCe as db,CZe as dc,Tb as dd,Mg as de,ip as df,oa as dg,lo as dh,yf as di,Fqt as dj,H9t as dk,Ane as dl,v2 as dm,hni as dn,Ve as dp,ve as dq,Ss as dr,BCe as ds,tr as dt,t7t as du,TD as dv,X9t as dw,Te as dx,he as dy,Ee as dz,h as e,ds as e$,it as e0,mQ as e1,Poe as e2,Cr as e3,i_e as e4,On as e5,g2 as e6,Tn as e7,ht as e8,Zb as e9,Rnt as eA,nWt as eB,Yg as eC,Ivt as eD,Lvt as eE,GP as eF,GDe as eG,sei as eH,rei as eI,o_ as eJ,mnt as eK,DG as eL,i2 as eM,gl as eN,qnt as eO,lWt as eP,jnt as eQ,_se as eR,aWt as eS,Sf as eT,cYe as eU,Tu as eV,LH as eW,nei as eX,LDe as eY,$R as eZ,nPe as e_,uni as ea,kt as eb,sG as ec,yui as ed,ty as ee,gJe as ef,W8t as eg,un as eh,Cqt as ei,TSt as ej,SSt as ek,ESt as el,Ou as em,s8t as en,Fli as eo,LNt as ep,SNt as eq,fUe as er,Uli as es,NNt as et,lht as eu,uXt as ev,NEt as ew,U2e as ex,Fze as ey,Ore as ez,VGt as f,sXe as f$,wJ as f0,tb as f1,fu as f2,wu as f3,h8t as f4,x7e as f5,CA as f6,Vie as f7,_qe as f8,qP as f9,PZe as fA,mb as fB,E9t as fC,Eze as fD,oWt as fE,pD as fF,y9t as fG,c6t as fH,nMe as fI,hae as fJ,t$t as fK,i$t as fL,OS as fM,hD as fN,Jr as fO,mjt as fP,KGt as fQ,e6t as fR,rr as fS,$jt as fT,Pjt as fU,_l as fV,Wh as fW,$D as fX,py as fY,UXe as fZ,kXe as f_,GG as fa,vCe as fb,f9t as fc,mr as fd,Zg as fe,cie as ff,u8t as fg,x8t as fh,_Be as fi,KFe as fj,Hk as fk,Oot as fl,fhe as fm,bW as fn,v9t as fo,AJe as fp,VZ as fq,bhe as fr,Mqt as fs,MJe as ft,vhe as fu,KJe as fv,The as fw,Whi as fx,qhi as fy,aa as fz,HGt as g,yXt as g$,q0 as g0,Gue as g1,C9t as g2,Zie as g3,Cg as g4,hl as g5,IJe as g6,gjt as g7,hjt as g8,La as g9,QCe as gA,Kt as gB,p2 as gC,OYe as gD,fni as gE,Sie as gF,$W as gG,Qii as gH,q3 as gI,kXt as gJ,Gb as gK,Fu as gL,X6 as gM,dae as gN,rM as gO,kg as gP,id as gQ,j8t as gR,X8t as gS,XUt as gT,Cze as gU,A5 as gV,See as gW,XJe as gX,H0 as gY,nl as gZ,Lc as g_,B2e as ga,yEe as gb,_Ee as gc,Ii as gd,_ni as ge,mni as gf,yni as gg,Ojt as gh,UV as gi,yb as gj,r6t as gk,l7t as gl,PA as gm,$a as gn,l6t as go,NV as gp,Xi as gq,Q1 as gr,UCe as gs,rS as gt,CZ as gu,ia as gv,n3 as gw,Cjt as gx,vY as gy,df as gz,Z0 as h,ght as h$,oG as h0,co as h1,Es as h2,jj as h3,Nr as h4,Ra as h5,l_ as h6,fs as h7,Vb as h8,Mi as h9,ue as hA,BR as hB,nS as hC,lr as hD,WH as hE,BQt as hF,zQt as hG,ani as hH,Cz as hI,Nb as hJ,WD as hK,ta as hL,x2 as hM,Li as hN,QA as hO,Mit as hP,rse as hQ,rCe as hR,Jat as hS,bP as hT,CIe as hU,fqt as hV,Pn as hW,il as hX,XKe as hY,sl as hZ,r7t as h_,Vh as ha,Mn as hb,SZ as hc,_r as hd,N0t as he,aie as hf,lie as hg,JHt as hh,XHt as hi,E0t as hj,qn as hk,D0t as hl,gre as hm,Rrt as hn,Let as ho,Zhi as hp,$Z as hq,ey as hr,u6t as hs,NBt as ht,mle as hu,PD as hv,s6t as hw,Ere as hx,QXe as hy,Is as hz,wre as i,Ejt as i$,$r as i0,lG as i1,Id as i2,zS as i3,SIt as i4,D7t as i5,Fj as i6,Lst as i7,nhe as i8,iM as i9,Hx as iA,cJe as iB,XI as iC,Z8t as iD,iGt as iE,ajt as iF,Hhi as iG,_jt as iH,Ghi as iI,yjt as iJ,MS as iK,G6 as iL,V7 as iM,ghi as iN,nf as iO,Mzt as iP,mhi as iQ,fhi as iR,phi as iS,yJe as iT,Mre as iU,vJe as iV,bJe as iW,JJe as iX,_b as iY,GGt as iZ,kGt as i_,kZ as ia,YKt as ib,NCe as ic,mvt as id,Wme as ie,$qt as ig,qKt as ih,Ph as ii,wzt as ij,bii as ik,iK as il,rK as im,dn as io,Of as ip,W9t as iq,Bet as ir,PS as is,N5e as it,hri as iu,Cxt as iv,Kti as iw,EM as ix,u9 as iy,ySt as iz,Wf as j,Eh as j$,Vde as j0,eOe as j1,gle as j2,cH as j3,iW as j4,Cte as j5,lH as j6,Mjt as j7,ble as j8,ZS as j9,rGt as jA,Ujt as jB,Vjt as jC,zjt as jD,jjt as jE,Gjt as jF,Hjt as jG,qjt as jH,Wjt as jI,Zjt as jJ,Yjt as jK,Xjt as jL,Jjt as jM,gBe as jN,jf as jO,Rjt as jP,_ui as jQ,E2e as jR,RP as jS,Fh as jT,pb as jU,GL as jV,Yqe as jW,FEt as jX,dXt as jY,fz as jZ,wP as j_,xWt as ja,I5e as jb,sZe as jc,ahe as jd,yBe as je,eS as jf,M7e as jg,Qg as jh,Zd as ji,Xg as jj,JL as jk,_le as jl,Ljt as jm,Ijt as jn,VP as jo,gO as jp,Qjt as jq,ojt as jr,D_ as js,dle as jt,Nze as ju,jFe as jv,Boe as jw,BFe as jx,TGt as jy,wjt as jz,G as k,yee as k$,kqt as k0,aIe as k1,XWe as k2,IA as k3,QKt as k4,F5e as k5,MD as k6,ly as k7,ARe as k8,bL as k9,f$t as kA,Xe as kB,itt as kC,j1 as kD,Ys as kE,ose as kF,Tni as kG,Kk as kH,fBe as kI,oGt as kJ,h2e as kK,g2e as kL,vr as kM,Uo as kN,VCe as kO,qde as kP,Wqt as kQ,oP as kR,MWt as kS,Qs as kT,n8t as kU,ZP as kV,_9t as kW,oBe as kX,Aie as kY,YS as kZ,gC as k_,MEe as ka,Pa as kb,xr as kc,Q9t as kd,ZKe as ke,xn as kf,dNe as kg,ow as kh,xD as ki,nri as kj,_K as kk,CB as kl,Fs as km,nqe as kn,a_ as ko,fLe as kp,xie as kq,bz as kr,mne as ks,Pe as kt,br as ku,Pf as kv,bs as kw,bCe as kx,_t as ky,Tr as kz,djt as l,Er as l$,cdi as l0,cGt as l1,uGt as l2,yi as l3,ll as l4,m9t as l5,t7e as l6,tTe as l7,Ci as l8,Rr as l9,X$e as lA,s6 as lB,i6 as lC,z2e as lD,fD as lE,rG as lF,qH as lG,Cse as lH,aH as lI,IP as lJ,kh as lK,vz as lL,KXe as lM,eJe as lN,yhe as lO,xIt as lP,a9t as lQ,c9t as lR,l9t as lS,ep as lT,pni as lU,Y0 as lV,fl as lW,Xr as lX,xt as lY,Ht as lZ,di as l_,Br as la,ZD as lb,Eni as lc,Mui as ld,dUt as le,Aui as lf,lp as lg,ED as lh,_2 as li,dl as lj,mz as lk,fKe as ll,vs as lm,cNt as ln,Fgt as lo,oo as lp,wli as lq,X0 as lr,Kf as ls,ml as lt,kD as lu,ho as lv,t6 as lw,r6 as lx,O2 as ly,Mti as lz,jl as m,b2 as m$,jS as m0,Ut as m1,eH as m2,I5t as m3,mqt as m4,fO as m5,Qat as m6,Gui as m7,qui as m8,Zui as m9,WCt as mA,BCt as mB,jCt as mC,qEt as mD,qCt as mE,jvt as mF,GCt as mG,rp as mH,mA as mI,wE as mJ,RSe as mK,T8t as mL,y2 as mM,rtt as mN,WS as mO,JTt as mP,Slt as mQ,Hn as mR,uWe as mS,Njt as mT,sWt as mU,tWt as mV,RW as mW,Szt as mX,T_ as mY,nD as mZ,Gm as m_,Xui as ma,ehi as mb,thi as mc,rH as md,Hui as me,Wui as mf,Qui as mg,Yui as mh,Jui as mi,Kui as mj,Sui as mk,qpe as ml,R4e as mm,I4e as mn,yri as mo,E3 as mp,C3 as mq,g4e as mr,yMt as ms,DEt as mt,Bvt as mu,WDe as mv,Hvt as mw,HCt as mx,GEt as my,HEt as mz,Dt as n,TQe as n$,nJt as n0,c_ as n1,Or as n2,Gre as n3,Du as n4,Nre as n5,AEe as n6,Rh as n7,uri as n8,mui as n9,Bxe as nA,b6e as nB,jqt as nC,fN as nD,JKt as nE,nLe as nF,Tjt as nG,K7t as nH,eWt as nI,iWt as nJ,Fc as nK,Knt as nL,fvt as nM,fse as nN,Eb as nO,Uhi as nP,pjt as nQ,fjt as nR,Sjt as nS,CGt as nT,jGt as nU,i6t as nV,rAe as nW,met as nX,R5t as nY,Oc as nZ,SZe as n_,F as na,cqt as nb,tD as nc,Sb as nd,e8t as ne,Fa as nf,Ua as ng,sm as nh,ge as ni,dg as nj,z5t as nk,S6e as nl,Lie as nm,G8t as nn,kP as no,n7e as np,Bj as nq,Y8t as nr,LSe as ns,P8t as nt,A8t as nu,hhi as nv,aei as nw,oei as nx,e9e as ny,Kqe as nz,hhe as o,kA as o$,KI as o0,Mlt as o1,Nd as o2,Ei as o3,Oqt as o4,Yj as o5,Jqt as o6,cy as o7,q8t as o8,mSe as o9,Ehi as oA,mBt as oB,b4e as oC,$Oe as oD,fb as oE,WEt as oF,Fie as oG,M_ as oH,mri as oI,PYe as oJ,V0 as oK,$Ee as oL,XZe as oM,uYt as oN,Lre as oO,gri as oP,hYt as oQ,bei as oR,_Se as oS,wZt as oT,SZt as oU,vL as oV,bXt as oW,wXt as oX,rpe as oY,OEe as oZ,Fht as o_,_Oe as oa,qA as ob,nGt as oc,gni as od,hb as oe,nwe as of,FA as og,zXt as oh,jXt as oi,AIe as oj,VRt as ok,URt as ol,TZt as om,lLe as on,dL as oo,gXt as op,ZA as oq,Myt as or,Wxe as os,y_ as ot,_2e as ou,zie as ov,B8t as ow,V2e as ox,yue as oy,sEe as oz,Tui as p,UG as p$,_Xt as p0,Xpe as p1,Y1 as p2,xZt as p3,J7t as p4,J8t as p5,Met as p6,edi as p7,Kl as p8,vA as p9,Qit as pA,hei as pB,iei as pC,VDe as pD,BDe as pE,kDe as pF,qme as pG,cei as pH,qj as pI,ok as pJ,Gnt as pK,Hnt as pL,Qme as pM,Wvt as pN,GKt as pO,yCe as pP,Zqt as pQ,eCe as pR,zqt as pS,tZe as pT,lZe as pU,jDe as pV,ire as pW,_qt as pX,zNe as pY,lwt as pZ,kj as p_,VVt as pa,fS as pb,US as pc,n7t as pd,uo as pe,Y6 as pf,Oz as pg,zRt as ph,twt as pi,Mni as pj,FRt as pk,Pni as pl,Ani as pm,fG as pn,Hqt as po,Gqt as pp,MZt as pq,spe as pr,ipe as ps,cni as pt,dni as pu,bOe as pv,Yhi as pw,St as px,lrt as py,pKe as pz,ze as q,sTe as q$,Eu as q0,uie as q1,kl as q2,vEe as q3,fYe as q4,EYe as q5,PEe as q6,vt as q7,aL as q8,eAe as q9,wb as qA,VQt as qB,S$e as qC,oPe as qD,MKe as qE,iL as qF,B1 as qG,$et as qH,T$e as qI,Sg as qJ,xQe as qK,R5e as qL,g$t as qM,k_e as qN,Xl as qO,Fjt as qP,zxe as qQ,nie as qR,MIe as qS,pqt as qT,dqt as qU,ys as qV,Odt as qW,Lbt as qX,tp as qY,_Et as qZ,r2 as q_,xhe as qa,vb as qb,YWt as qc,ret as qd,Jx as qe,ZE as qf,lRe as qg,BLe as qh,aoe as qi,Nct as qj,w4e as qk,C2e as ql,fAe as qm,KQ as qn,Fri as qo,qS as qp,jet as qq,hKt as qr,C6 as qs,gB as qt,nqt as qu,oD as qv,l8t as qw,wL as qx,ci as qy,$S as qz,qb as r,RKt as r$,gSe as r0,Qxe as r1,g6e as r2,Mde as r3,wni as r4,lae as r5,W4 as r6,_Ne as r7,ku as r8,u9t as r9,koi as rA,joe as rB,tj as rC,Fii as rD,Vii as rE,GFe as rF,kii as rG,gu as rH,vu as rI,qK as rJ,ej as rK,WK as rL,HK as rM,Bii as rN,txt as rO,Gii as rP,Tee as rQ,Ixt as rR,Fti as rS,G_e as rT,TE as rU,JMt as rV,pOt as rW,K_t as rX,J_t as rY,Ult as rZ,$Kt as r_,pXt as ra,jg as rb,YA as rc,_s as rd,eO as re,vh as rf,JDe as rg,QDe as rh,HQt as ri,eb as rj,Xf as rk,jii as rl,bZt as rm,LD as rn,plt as ro,cf as rp,j_e as rq,Zii as rr,Hii as rs,qii as rt,Wii as ru,GK as rv,Pp as rw,gf as rx,Ka as ry,Uii as rz,bD as s,Xj as s$,u_ as s0,fei as s1,Ro as s2,Aa as s3,Ini as s4,NNe as s5,na as s6,I8t as s7,Cf as s8,yh as s9,aIt as sA,_Je as sB,DR as sC,I6e as sD,lqt as sE,mO as sF,lle as sG,Qzt as sH,Kzt as sI,cle as sJ,Ize as sK,D2t as sL,s1t as sM,N2t as sN,KDe as sO,fj as sP,F8t as sQ,Pze as sR,F3 as sS,LWt as sT,DWt as sU,NWt as sV,Df as sW,qZe as sX,RG as sY,Yqt as sZ,hz as s_,D5 as sa,tei as sb,_he as sc,ZKt as sd,c0t as se,VG as sf,Uri as sg,P2 as sh,fOt as si,Xne as sj,cn as sk,OOt as sl,Ob as sm,PMe as sn,Da as so,RRe as sp,gG as sq,HS as sr,v_ as ss,zre as st,K1 as su,yG as sv,QMe as sw,i7t as sx,Olt as sy,Vqt as sz,hi as t,oZ as t$,Kne as t0,Eoi as t1,zoi as t2,eIt as t3,bS as t4,wii as t5,Sr as t6,cr as t7,Jf as t8,Tii as t9,Oet as tA,Jre as tB,ORe as tC,Xqt as tD,Eqt as tE,Lqt as tF,Alt as tG,yKe as tH,HG as tI,elt as tJ,bb as tK,VXe as tL,Kat as tM,EA as tN,UWe as tO,kWe as tP,gqt as tQ,pat as tR,M9e as tS,_Z as tT,dJ as tU,$We as tV,sg as tW,gEt as tX,mEt as tY,L2e as tZ,I2e as t_,Aqt as ta,$1 as tb,gDe as tc,LK as td,pg as te,xii as tf,R1 as tg,Be as th,HIt as ti,qIt as tj,dlt as tk,JT as tl,VR as tm,cz as tn,p7t as to,D5e as tp,Do as tq,$lt as tr,s7t as ts,WKe as tt,dz as tu,ZMe as tv,Fet as tw,qf as tx,jz as ty,DA as tz,qe as u,k9t as u$,r8t as u0,Q2e as u1,RWe as u2,qTt as u3,urt as u4,Jit as u5,Uqt as u6,uXe as u7,X2e as u8,Y2e as u9,nG as uA,NRt as uB,GXt as uC,mZt as uD,Ire as uE,Jii as uF,Au as uG,kht as uH,jh as uI,oet as uJ,UA as uK,Idt as uL,vG as uM,iYe as uN,ylt as uO,_lt as uP,fZt as uQ,lni as uR,Nii as uS,Pii as uT,Oii as uU,xf as uV,cSt as uW,NFe as uX,pSt as uY,XTt as uZ,ZTt as u_,pZt as ua,yZt as ub,gZt as uc,_Zt as ud,K2e as ue,vZt as uf,HXt as ug,Rdt as uh,bUt as ui,kAe as uj,pRe as uk,Xqe as ul,M8t as um,oze as un,AWe as uo,uqt as up,hqt as uq,B5t as ur,Cb as us,FSe as ut,LRt as uu,IRt as uv,O6e as uw,i8t as ux,DRt as uy,EWt as uz,J3 as v,Qi as v$,yii as v0,Yii as v1,FTt as v2,Nxt as v3,Yn as v4,vD as v5,Wd as v6,Ig as v7,Eii as v8,Sii as v9,Jie as vA,Evt as vB,Cii as vC,Hye as vD,nce as vE,uzt as vF,mzt as vG,Ezt as vH,lei as vI,XQe as vJ,Dhi as vK,Lhi as vL,dat as vM,Hi as vN,Nc as vO,al as vP,T as vQ,bn as vR,xy as vS,wt as vT,et as vU,pt as vV,by as vW,j as vX,qi as vY,Hh as vZ,B as v_,zii as va,Zi as vb,U4t as vc,c8t as vd,kTt as ve,eii as vf,Rii as vg,$ii as vh,Aii as vi,Mii as vj,_ii as vk,vii as vl,L8t as vm,Qge as vn,GTt as vo,QPe as vp,$yt as vq,jyt as vr,Sot as vs,Kd as vt,CS as vu,$Tt as vv,gvt as vw,dei as vx,Nq as vy,Fq as vz,Ajt as w,kQt as w$,Ki as w0,Jt as w1,$_ as w2,WG as w3,sw as w4,Nu as w5,_6 as w6,I_ as w7,ui as w8,oy as w9,rw as wA,Ai as wB,no as wC,wIe as wD,nb as wE,POe as wF,Ese as wG,_y as wH,vni as wI,sni as wJ,PK as wK,sRe as wL,w$ as wM,JMe as wN,K9t as wO,e7t as wP,J9t as wQ,BXt as wR,ji as wS,ua as wT,ew as wU,OWe as wV,PWe as wW,ere as wX,Qie as wY,Pqt as wZ,Dr as w_,kb as wa,nw as wb,w6 as wc,Uc as wd,sae as we,mS as wf,Q0 as wg,v6 as wh,hCt as wi,Zse as wj,lO as wk,QG as wl,CQt as wm,zne as wn,TWt as wo,Tot as wp,eB as wq,Fr as wr,AWt as ws,MQt as wt,U$e as wu,us as wv,XLe as ww,jr as wx,Dh as wy,rm as wz,lL as x,rBt as x$,Fre as x0,Dqt as x1,Y9t as x2,hy as x3,Sre as x4,ePe as x5,Qf as x6,uP as x7,Wt as x8,ea as x9,HLe as xA,oKt as xB,zg as xC,nKt as xD,Vs as xE,Rli as xF,h_ as xG,sr as xH,pUe as xI,vNt as xJ,VNt as xK,Rme as xL,Z6 as xM,P0t as xN,Oli as xO,tee as xP,iee as xQ,KKt as xR,qqt as xS,KHt as xT,sai as xU,Bqt as xV,eei as xW,bu as xX,Kb as xY,C2 as xZ,a8t as x_,Ru as xa,b6 as xb,iw as xc,N8 as xd,RLe as xe,As as xf,j3e as xg,Bne as xh,SWt as xi,CZt as xj,_L as xk,EZt as xl,bst as xm,ase as xn,tc as xo,pL as xp,Nqt as xq,wft as xr,Hre as xs,XMe as xt,vet as xu,TKe as xv,iht as xw,rht as xx,cp as xy,_P as xz,p as y,ka as y0,e_t as y1,ah as y2,wy as y3,vy as y4,zr as y5,J0 as y6,Ahi as y7,R2 as y8,iz as y9,fy as ya,XD as yb,Pu as yc,fne as yd,q9t as ye,Igt as yf,EKe as yg,h9t as yh,p9t as yi,Eoe as yj,vri as yk,Dri as yl,yhi as ym,udi as yn,pse as z};
