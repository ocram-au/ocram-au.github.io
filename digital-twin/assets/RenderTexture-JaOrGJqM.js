import{jD as p,jE as x,jF as i,jG as l,ay as A,jH as I,jI as h,eh as j,cj as m,co as E}from"./index-BGUxYM9l.js";function L(t,u,e,r){if(u==null||r==null)return!1;const s=p(u,r);if((s==null?void 0:s.projector)==null)return!1;if(s.projector===x)return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],!0;const{source:n,dest:o,projector:R}=s;if(o.spatialReferenceId===i.WEB_MERCATOR){const a=l[n.spatialReferenceId][i.WGS84];return a!=null&&(a(t,0,f,0),I(f,0,e,0),e[3]=_(f[1],t[2],t[3],h.radius),!0)}if(n.spatialReferenceId!==i.WGS84&&n.spatialReferenceId!==i.CGCS2000||o.spatialReferenceId!==i.PLATE_CARREE){R(t,0,e,0);const a=n.metersPerUnit??1,c=o.metersPerUnit??1;e[3]=t[3]*a/c}else{const a=l[n.spatialReferenceId][i.SPHERICAL_ECEF],c=l[i.SPHERICAL_ECEF][i.PLATE_CARREE];let d=t[3];a!=null&&c!=null&&(d=_(t[1],t[2],t[3],h.radius)),R(t,0,e,0),e[3]=d}return!0}function _(t,u,e,r){const s=r+u;if(s<r/2||e>s)return Number.MAX_VALUE;const n=Math.abs(C*t)+Math.asin(e/s);return n>=Math.PI/2?Number.MAX_VALUE:e/Math.cos(n)}const f=A(),C=j(1);class M{constructor(u,e){this._textures=u,this.loadPromise=null,this._disposed=!1;const r=this._textures.acquire(e);m(r)?(r.then(s=>{this._disposed?E(s):this._textureRef=s}),this.loadPromise=r):this._textureRef=r}dispose(){this._textureRef=E(this._textureRef),this._disposed=!0}get glTexture(){return this._textureRef!=null?this._textureRef.glTexture:null}}export{L as l,M as s};
