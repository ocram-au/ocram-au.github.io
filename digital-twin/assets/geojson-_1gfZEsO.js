import{t as I}from"./date-M6n_RqpC.js";import{t as P,fd as C,fM as k,fN as E,fO as x,fP as D}from"./index-CfKBUdWV.js";const J={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function b(t){return J[t]}function*G(t){switch(t.type){case"Feature":yield t;break;case"FeatureCollection":for(const n of t.features)n&&(yield n)}}function*R(t){if(t)switch(t.type){case"Point":yield t.coordinates;break;case"LineString":case"MultiPoint":yield*t.coordinates;break;case"MultiLineString":case"Polygon":for(const n of t.coordinates)yield*n;break;case"MultiPolygon":for(const n of t.coordinates)for(const e of n)yield*e}}function*v(t,n={}){const{geometryType:e,objectIdField:o}=n;for(const r of t){const{geometry:s,properties:p,id:i}=r;if(s&&b(s.type)!==e)continue;const l=p||{};let c;o&&(c=l[o],i==null||c||(l[o]=c=i)),yield new x(s?q(new D,s,n):null,l,null,c??void 0)}}function A(t){for(const n of t)if(n.length>2)return!0;return!1}function Z(t){return!T(t)}function H(t){return T(t)}function T(t){let n=0;for(let e=0;e<t.length;e++){const o=t[e],r=t[(e+1)%t.length];n+=o[0]*r[1]-r[0]*o[1]}return n<=0}function L(t){const n=t[0],e=t[t.length-1];return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]||t.push(n),t}function q(t,n,e){switch(n.type){case"LineString":return z(t,n,e);case"MultiLineString":return B(t,n,e);case"MultiPoint":return K(t,n,e);case"MultiPolygon":return Q(t,n,e);case"Point":return U(t,n,e);case"Polygon":return V(t,n,e)}}function z(t,n,e){return g(t,n.coordinates,e),t}function B(t,n,e){for(const o of n.coordinates)g(t,o,e);return t}function K(t,n,e){return g(t,n.coordinates,e),t}function Q(t,n,e){for(const o of n.coordinates){O(t,o[0],e);for(let r=1;r<o.length;r++)N(t,o[r],e)}return t}function U(t,n,e){return S(t,n.coordinates,e),t}function V(t,n,e){const o=n.coordinates;O(t,o[0],e);for(let r=1;r<o.length;r++)N(t,o[r],e);return t}function O(t,n,e){const o=L(n);Z(o)?$(t,o,e):g(t,o,e)}function N(t,n,e){const o=L(n);H(o)?$(t,o,e):g(t,o,e)}function g(t,n,e){for(const o of n)S(t,o,e);t.lengths.push(n.length)}function $(t,n,e){for(let o=n.length-1;o>=0;o--)S(t,n[o],e);t.lengths.push(n.length)}function S(t,n,e){const[o,r,s]=n;t.coords.push(o,r),e.hasZ&&t.coords.push(s||0)}function W(t){switch(typeof t){case"string":return I(t)?"esriFieldTypeDate":"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function _(t,n=4326){if(!t)throw new P("geojson-layer:empty","GeoJSON data is empty");if(t.type!=="Feature"&&t.type!=="FeatureCollection")throw new P("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:t});const{crs:e}=t;if(!e)return;const o=typeof e=="string"?e:e.type==="name"?e.properties.name:e.type==="EPSG"?e.properties.code:null,r=C({wkid:n})?new RegExp(".*(CRS84H?|4326)$","i"):new RegExp(`.*(${n})$`,"i");if(!o||!r.test(o))throw new P("geojson:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:e})}function tt(t,n={}){const e=[],o=new Set,r=new Set;let s,p=!1,i=null,l=!1,{geometryType:c=null}=n,m=!1;for(const d of G(t)){const{geometry:h,properties:u,id:a}=d;if((!h||(c||(c=b(h.type)),b(h.type)===c))&&(p||(p=A(R(h))),l||(l=a!=null,l&&(s=typeof a,u&&(i=Object.keys(u).filter(y=>u[y]===a)))),u&&i&&l&&a!=null&&(i.length>1?i=i.filter(y=>u[y]===a):i.length===1&&(i=u[i[0]]===a?i:[])),!m&&u)){let y=!0;for(const f in u){if(o.has(f))continue;const F=u[f];if(F==null){y=!1,r.add(f);continue}const M=W(F);if(M==="unknown"){r.add(f);continue}r.delete(f),o.add(f);const j=k(f);j&&e.push({name:j,alias:f,type:M})}m=y}}const w=k((i==null?void 0:i.length)===1&&i[0]||null)??void 0;if(w){for(const d of e)if(d.name===w&&E(d)){d.type="esriFieldTypeOID";break}}return{fields:e,geometryType:c,hasZ:p,objectIdFieldName:w,objectIdFieldType:s,unknownFields:Array.from(r)}}function nt(t,n){return Array.from(v(G(t),n))}export{_ as E,tt as I,nt as N,b as u};
