import{bt as G,oN as Ve,y1 as Ze,y6 as Je,bq as K,y0 as Oe,y7 as we,x$ as Ke,yT as Qe,ye as et,yf as tt,z1 as st,yg as rt,yi as at,mu as it,zi as nt,wc as X,yp as ot,bY as ct,yH as dt,mt as lt,y2 as ut,zq as gt,yN as ht,yL as ft,bb as $,yv as pt,be as Ie,iX as bt,o$ as De,p0 as mt,mA as We,af as _t,e9 as $t,b3 as M,bC as l,gG as Tt,pG as Ae,zr as je,zs as de,p4 as Ot,eL as Ce,aM as f,vs as wt,n as It,zt as At,s4 as re,aG as Q,aH as b,r9 as fe,p8 as F,bK as Ge,d5 as k,aF as P,b2 as ke,aS as Ct,b0 as w,aK as H,p6 as Et,wQ as vt,aI as S,zu as le,zv as Rt,zw as Pt,cF as Mt,rb as Fe,aJ as C,eA as St,bf as j,f as pe,P as be,F as E,ba as R,bh as N,r8 as _,eN as yt,eM as ze,bM as Lt,bN as Ee,bG as q,jR as Y,al as ee,tA as ve,nP as Re,bJ as oe,hX as Pe,pH as Me,zx as Se,rd as ye,wL as Nt}from"./index-BR4NftXd.js";import{j as Ut,g as xt,u as Le,v as Ht,C as J,e as Vt,i as Ne,b as Dt,d as Ue,s as Wt,k as jt,q as Gt,n as Be,x as ue,U as kt,S as Ft,l as zt,a as Bt,c as Xt}from"./sliceToolConfig-ClWevB0k.js";import{O as qt,e as me,c as Yt,a as m,j as Xe}from"./ShadedColorMaterial.glsl-Dmf0Y2bl.js";import{g as Zt}from"./ImageMaterial.glsl-BMHUnAt8.js";import{r as Jt}from"./projectionUtils-0DRZt92j.js";import{f as Kt}from"./LineVisualElement-B7rInqX4.js";import{a as Qt}from"./Object3DVisualElement-W-KcI-KX.js";const es=G(0,0,0,.04);function ts({accentColor:e}){return Ve(e,.5)}function ss({accentColor:e}){return Ve(e,.7)}function qe(e){const t=new Ze,{vertex:n,fragment:r,attributes:a,varyings:i}=t;return Je(n,e),a.add(K.POSITION,"vec3"),a.add(K.UV0,"vec2"),i.add("vUV","vec2"),n.code.add(Oe`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),r.uniforms.add(new we("backgroundColor",s=>s.backgroundColor),new we("gridColor",s=>s.gridColor),new Ke("gridWidth",s=>s.gridWidth)),r.code.add(Oe`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),t}const rs=Object.freeze(Object.defineProperty({__proto__:null,build:qe},Symbol.toStringTag,{value:"Module"}));class as extends Qe{constructor(){super(...arguments),this.backgroundColor=G(1,0,0,.5),this.gridColor=G(0,1,0,.5),this.gridWidth=4}}class ae extends et{initializeProgram(t){return new tt(t.rctx,ae.shader.get().build(this.configuration),st)}initializePipeline(){return rt({blending:nt(X.ONE,X.ONE,X.ONE_MINUS_SRC_ALPHA,X.ONE_MINUS_SRC_ALPHA),depthTest:{func:it.LESS},colorWrite:at})}}ae.shader=new ot(rs,()=>ct(()=>Promise.resolve().then(()=>$s),void 0));let is=class extends dt{constructor(t){super(t,new os),this.produces=new Map([[lt.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,n=>n===ut.Color]]),this._configuration=new gt}createBufferWriter(){return new ht(ft)}createGLMaterial(t){return new ns(t)}getConfiguration(){return this._configuration}};class ns extends pt{constructor(t){super(t),this.ensureTechnique(ae,null)}beginSlot(){return this.technique}}class os extends as{constructor(){super(...arguments),this.renderOccluded=$.Occlude,this.isDecoration=!1}}class cs extends Qt{constructor(t){super(t),this._material=null,this._renderOccluded=$.OccludeAndTransparent,this._gridWidth=1,this._gridColor=G(1,0,0,1),this._backgroundColor=G(1,0,0,1),this.applyProperties(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(t){this._gridWidth!==t&&(this._gridWidth=t,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(t){Ie(this._gridColor,t),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){Ie(this._backgroundColor,t),this._updateMaterial()}createExternalResources(){this._material=new is(this._materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(t){this._material!=null&&t(this._material)}createGeometries(t){if(this._material!=null){const n=bt(this._material);t.addGeometry(n)}}get _materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this._material!=null&&this._material.setParameters(this._materialParameters)}}function Rs(e,t,n,r,a,i,s,o){return ds(t,s.worldUpAtPosition(e,l.get()),a,i,o.basis1,o.basis2),f(o.basis1,o.basis1,n),f(o.basis2,o.basis2,r),P(o.origin,e),je(o.basis2,o.basis1,o.origin,o.plane),o}function ds(e,t,n,r,a,i){const s=H(e,t),o=l.get(),u=l.get();switch(r===v.HORIZONTAL_OR_VERTICAL?Math.abs(s)>Vt?v.HORIZONTAL:v.VERTICAL:r){case v.VERTICAL:{const c=Math.abs(s)<=Ne?e:n.viewUp;C(o,c,t),P(u,t);break}case v.HORIZONTAL:C(o,n.viewUp,t),C(u,t,o);break;case v.TILTED:{const c=Math.abs(s)<=Ne?t:n.viewUp;C(o,c,e),C(u,e,o);break}}const d=C(l.get(),o,u);H(d,n.viewForward)>0&&f(u,u,-1),S(a,o),S(i,u)}function ls(e,t,n){const r=t.worldUpAtPosition(e.origin,l.get()),a=e.basis1,i=Te(e,r),s=Math.round(i/V)*V;return de(e,s-i,a,n)}function Ps(e,t,n,r,a,i){const s=P(l.get(),a.origin);b(s,s,f(l.get(),a.basis1,e.direction[0]<0?1:-1)),b(s,s,f(l.get(),a.basis2,e.direction[1]<0?1:-1));const o=M(a.basis1),u=M(a.basis2),d=w(l.get(),n,s),c=w(l.get(),t,s);let g=0,h=0;if($e(e)){const ie=ge(a),D=ge(i);g=o-.5*e.direction[0]*H(a.basis1,c)/o,h=u-.5*e.direction[1]*H(a.basis2,c)/u;const z=D/ie;g*=z,h*=z}const p=g+.5*e.direction[0]*H(a.basis1,d)/o,O=h+.5*e.direction[1]*H(a.basis2,d)/u,U=f(l.get(),a.basis1,p/o),y=f(l.get(),a.basis2,O/u);(p<=0||xe(i.origin,U,r)<=Le)&&P(U,i.basis1),(O<=0||xe(i.origin,y,r)<=Le)&&P(y,i.basis2);const T=P(l.get(),s);return b(T,T,f(l.get(),U,e.direction[0]<0?-1:1)),b(T,T,f(l.get(),y,e.direction[1]<0?-1:1)),Et(T,U,y,i)}function Ms(e,t){return Ht*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}function Ss(e,t,n,r){const a=C(l.get(),t,n);return C(a,a,t),ke(e,a,r)}function ys(e,t){return qt(e.basis1,e.basis2,e.origin,t)}function Ls(e,t,n,r){const a=t.worldUpAtPosition(e.origin,l.get()),i=l.get();switch(n){case te.HEADING:P(i,a);break;case te.TILT:P(i,e.basis1)}return ke(e.origin,i,r)}function Ns(e,t,n,r){const a=_e(n,I.NEGATIVE_X),i=F.get();vt(i,t,a.edge*Math.PI/2);const s=S(l.get(),a.basis);let o=f(l.get(),s,a.direction*r.computeScreenPixelSizeAt(a.position)*J);b(o,o,a.position);const u=r.projectToRenderScreen(o,le(l.get())),d=us(r,u);Rt(r,u,Z),S(Z.direction,Z.direction);const c=l.get();!d&&Pt(n,Z,c)&&(o=c),i[12]=0,i[13]=0,i[14]=0,e.modelTransform=i,e.renderLocation=Mt(o),d?e.state|=se:e.state&=~se}function us(e,t){const[n,r,a,i]=e.viewport,s=Math.min(a,i)/16;let o=!0;return t[0]<n+s?(t[0]=n+s,o=!1):t[0]>n+a-s&&(t[0]=n+a-s,o=!1),t[1]<r+s?(t[1]=r+s,o=!1):t[1]>r+i-s&&(t[1]=r+i-s,o=!1),o}function Us(e,t,n,r){const a=M(r.basis1),i=M(r.basis2),s=Ye(r),o=ge(r),u=Q(l.get(),0,0,0);b(u,f(l.get(),r.basis1,t.direction[0]),f(l.get(),r.basis2,t.direction[1])),b(u,r.origin,u);let d=0,c=1;if($e(t))t.direction[0]===1&&t.direction[1]===-1?d=V:t.direction[0]===1&&t.direction[1]===1?d=Math.PI:t.direction[0]===-1&&t.direction[1]===1&&(d=3*Math.PI/2),c=o;else{const h=t.direction[0]!==0?1:2;d=h===1?V:0,c=(h===1?i:a)-s}const g=fe(F.get(),d);Ge(g,g,Q(l.get(),c,c,c)),k(g,n,g),g[12]=0,g[13]=0,g[14]=0,e.modelTransform=g,e.renderLocation=u}function xs(e,t,n,r){const a=r.worldUpAtPosition(n.origin,l.get()),i=_e(n,I.POSITIVE_X),s=fe(F.get(),i.edge*Math.PI/2);Fe(s,s,-Te(n,a)),k(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=i.position}function Hs(e,t,n){const r=_e(n,I.POSITIVE_Y),a=fe(F.get(),r.edge*Math.PI/2);Fe(a,a,V),k(a,t,a),a[12]=0,a[13]=0,a[14]=0,e.modelTransform=a,e.renderLocation=r.position}var I;function _e(e,t){switch(t){case I.POSITIVE_X:return{basis:e.basis1,direction:1,position:b(l.get(),e.origin,e.basis1),edge:t};case I.POSITIVE_Y:return{basis:e.basis2,direction:1,position:b(l.get(),e.origin,e.basis2),edge:t};case I.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:w(l.get(),e.origin,e.basis1),edge:t};case I.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:w(l.get(),e.origin,e.basis2),edge:t}}}function xe(e,t,n){const r=n.projectToRenderScreen(b(l.get(),e,t),le(l.get())),a=n.projectToRenderScreen(w(l.get(),e,t),le(l.get()));return St(w(r,r,a))}function Ye(e){const t=M(e.basis1),n=M(e.basis2);return xt*Math.min(t,n)}function ge(e){return Ye(e)}function $e(e){return e.direction[0]!==0&&e.direction[1]!==0}function Vs(e){const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]];return new Kt({view:e,attached:!1,color:ss(e.effectiveTheme),width:Ut,renderOccluded:$.OccludeAndTransparent,geometry:[t],isDecoration:!0})}function Ds(e){return new cs({view:e,attached:!1,backgroundColor:es,gridColor:ts(e.effectiveTheme),gridWidth:4,renderOccluded:$.OccludeAndTransparent,isDecoration:!0})}function Ws(e,t,n,r=new mt){if(e==null)return null;const{renderCoordsHelper:a}=t,i=a.fromRenderCoords(e.origin,new _t({spatialReference:t.spatialReference}));if(i==null)return null;const s=$t(i,n);if(s==null)return null;r.position=s;const o=2*M(e.basis1),u=2*M(e.basis2),d=We.renderUnitScaleFactor(t.spatialReference,n);r.width=o*d,r.height=u*d;const c=a.worldUpAtPosition(e.origin,l.get());return r.tilt=Tt(Te(e,c)),r.heading=a.headingAtPosition(e.origin,e.basis1)-90,r}function Te(e,t){return At(t,e.basis2,e.basis1)+V}function gs(e,t,n,r,a,i,s=De()){return i.toRenderCoords(e,s.origin)?(i.worldBasisAtPosition(s.origin,Ae.X,s.basis1),i.worldBasisAtPosition(s.origin,Ae.Y,s.basis2),je(s.basis2,s.basis1,s.origin,s.plane),de(s,-Ce(t),Ot(s),s),de(s,Ce(n),s.basis1,s),f(s.basis1,s.basis1,r/2),f(s.basis2,s.basis2,a/2),wt(s),s):(It.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function js(e,t){if((e==null?void 0:e.position)==null)return null;const n=Jt(e.position,t.spatialReference,t.elevationProvider);if(n==null)return null;const r=We.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference),a=e.width*r,i=e.height*r;return{position:n,heading:e.heading,tilt:e.tilt,renderWidth:a,renderHeight:i}}function Gs(e,t,n,r=De()){if(e==null)return null;const a=gs(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,r);return n.tiltEnabled||a==null||ls(a,t.renderCoordsHelper,a),a}(function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"})(I||(I={}));const A=re.Custom1;var te,v;(function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"})(te||(te={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(v||(v={}));const se=re.Custom2,Z=Ct(),V=Math.PI/2,ce=re.Custom1,hs=re.Custom2;function ks(e){return(e.type==="building-scene-3d"?e:null)!=null}class Fs extends me{constructor(t,n){const r=$e(n),a=r?Dt:Ue,i=a*Wt,s=Ue,o={renderOccluded:$.OccludeAndTransparent,isDecoration:!0},u=new j({...o,width:a}),d=new j({...o,width:i}),c=new j({...o,width:s});super({view:t,...Yt,...fs({isCorner:r,unfocusedMaterial:u,focusedMaterial:d,outlineMaterial:c})}),this._themeHandle=pe(()=>t.effectiveTheme.accentColor,g=>{const h=E.toUnitRGBA(g);u.setParameters({color:h}),d.setParameters({color:h}),c.setParameters({color:h})},be)}destroy(){this._themeHandle.remove(),super.destroy()}}function fs({isCorner:e,unfocusedMaterial:t,focusedMaterial:n,outlineMaterial:r}){const a=e?[R(1,0,0),R(0,0,0),R(0,1,0)]:[R(1,0,0),R(-1,0,0)];return{renderObjects:[new m(N(t,a),_.Unfocused|ce),new m(N(n,a),_.Focused|ce),new m(N(r,a),hs)],collisionType:{type:"line",paths:[a]},radius:e?jt:Gt,state:ce}}class zs extends me{constructor(t,n){const r=new Zt({transparent:!0,writeDepth:!1,renderOccluded:$.Opaque,isDecoration:!0}),a=Xe.calloutWidth,i=new j({width:a,renderOccluded:$.OccludeAndTransparent,isDecoration:!0});super({view:t,...ps({imageMaterial:r,calloutMaterial:i})}),this._currentTexture=null,this._themeHandle=pe(()=>t.effectiveTheme.accentColor,s=>{const o=yt(s,.5),u=ze(s),d=this._currentTexture,c=n(o,u);r.setParameters({textureId:c.texture.id}),i.setParameters({color:E.toUnitRGBA(s)}),this._currentTexture=c,d==null||d.release()},be)}destroy(){var t;this._themeHandle.remove(),(t=this._currentTexture)==null||t.release(),super.destroy()}}function ps({imageMaterial:e,calloutMaterial:t}){const{focusMultiplier:n,calloutLength:r,discRadius:a}=Xe,i=a*n,s=(c,g)=>{const h=[0,1,2,2,3,0];return new Lt(g,[[K.POSITION,new Ee([r-c,-c,0,r+c,-c,0,r+c,c,0,r-c,c,0],h,3,!0)],[K.UV0,new Ee([0,0,1,0,1,1,0,1],h,2,!0)]])},o=N(t,[[0,0,0],[r-a,0,0]]),u=N(t,[[0,0,0],[r-i,0,0]]),d=A;return{autoScaleRenderObjects:!1,collisionPriority:1,collisionType:{type:"disc",direction:[0,0,1],offset:[r,0,0]},focusMultiplier:n,radius:a,renderObjects:[new m(s(a,e),_.Unfocused|d),new m(o,_.Unfocused|d),new m(s(i,e),_.Focused|d),new m(u,_.Focused|d)],state:d}}var he;(function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"})(he||(he={}));class Bs extends me{constructor(t,n){const r=new j({width:1,renderOccluded:$.OccludeAndTransparent,isDecoration:!0}),a=new q({cullFace:Y.Back,renderOccluded:$.Opaque,isDecoration:!0}),i=new q({cullFace:Y.Back,renderOccluded:$.Opaque,isDecoration:!0}),s=new q({cullFace:Y.Back,renderOccluded:$.Opaque,isDecoration:!0}),o=new q({writeDepth:!1,cullFace:Y.Front,renderOccluded:$.Transparent,isDecoration:!0});super({view:t,...bs({offsetMode:n,tubeMaterial:a,tipMaterial:i,capMaterial:s,outlineMaterial:o,calloutMaterial:r})}),this._themeHandle=pe(()=>t.effectiveTheme.accentColor,u=>{const d=ze(u),c=E.toUnitRGBA(u),g=E.toUnitRGBA(d),h=E.toUnitRGBA(E.blendColors(d,u,.4)),p=E.toUnitRGBA(E.blendColors(d,u,.14));r.setParameters({color:c}),a.setParameters({color:p}),i.setParameters({color:g}),s.setParameters({color:h}),o.setParameters({color:c})},be)}destroy(){this._themeHandle.remove(),super.destroy()}}function bs({offsetMode:e,tubeMaterial:t,tipMaterial:n,capMaterial:r,outlineMaterial:a,calloutMaterial:i}){const s=e===he.CENTER_ON_CALLOUT?J:0,o=[R(s,0,-48/2),R(s,0,Ft/2)],u=_s(o),d=He({vertices:o,padding:0,materials:{tube:t,tip:n,cap:r}}),c=He({vertices:o,padding:kt,materials:{tube:a,tip:a,cap:a}}),g=N(i,[[s,0,0],[s-J,0,0]]),h=N(i,[[s,0,0],[s-J,0,0]]);return{renderObjects:[...d.normal.map(p=>new m(p,_.Unfocused|A)),...c.normal.map(p=>new m(p,_.Unfocused|A)),new m(g,_.Unfocused|A|se),...d.focused.map(p=>new m(p,_.Focused|A)),...c.focused.map(p=>new m(p,_.Focused|A)),new m(h,_.Focused|A|se)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[u]},collisionPriority:1,radius:Be,state:A}}function He({vertices:e,padding:t,materials:n}){const r=a=>{const i=e.slice(0),s=w(l.get(),i[0],i[1]);S(s,s);const o=w(l.get(),i[i.length-1],i[i.length-2]);if(S(o,o),t>0){const W=f(ee(),o,-t);i[i.length-1]=b(W,W,i[i.length-1]);const x=f(ee(),s,-t);i[0]=b(x,x,i[0])}const u=a?Xt:1,d=ue*u,c=Be*u,g=ve(F.get());if(t>0){const W=d/4,x=Q(l.get(),0,W,0),B=1+t/W;Re(g,g,x),Ge(g,g,Q(l.get(),B,B,B)),Re(g,g,f(x,x,-1/B))}const h=ve(oe()),p=R(0,1,0),O=Pe(oe(),Me(Se.get(),p,o));O[12]=i[i.length-1][0],O[13]=i[i.length-1][1],O[14]=i[i.length-1][2],k(O,O,g);const U=n.tube,y=ms(zt*(a?Bt:1)+t,i,U);y.transformation=h;const T=[y],ie=n.tip,D=ye(ie,d,c,24,!1,!1,!0);D.transformation=O,T.push(D);const z=n.cap,ne=ye(z,d,c,24,!1,!0,!1);ne.transformation=O,T.push(ne);const L=Pe(oe(),Me(Se.get(),p,s));return L[12]=i[0][0],L[13]=i[0][1],L[14]=i[0][2],k(L,L,g),T.push(D.instantiate({transformation:L})),T.push(ne.instantiate({transformation:L})),T};return{normal:r(!1),focused:r(!0)}}function ms(e,t,n){const r=[];for(let i=0;i<12;i++){const s=i/12*2*Math.PI;r.push([Math.cos(s)*e,Math.sin(s)*e])}return Nt(n,r,t,[],[],!1)}function _s(e,t){const n=w(ee(),e[e.length-1],e[e.length-2]);S(n,n),f(n,n,ue),b(n,n,e[e.length-1]);{const r=w(ee(),e[0],e[1]);return S(r,r),f(r,r,ue),b(r,r,e[0]),[r,...e,n]}}const $s=Object.freeze(Object.defineProperty({__proto__:null,build:qe},Symbol.toStringTag,{value:"Module"}));export{Vs as A,A as C,$e as E,he as H,Bs as I,js as L,v as M,Ws as R,se as S,hs as U,Gs as V,te as _,Us as a,ss as b,ys as c,Ss as d,Rs as e,ts as f,zs as g,ge as h,ce as i,Ds as j,Ls as l,xs as m,Hs as p,Ps as r,Ms as s,es as t,Ns as u,Fs as v,ks as x};
