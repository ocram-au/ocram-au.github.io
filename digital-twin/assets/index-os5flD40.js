const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ElevationLayer-DS3RXAU1.js","assets/ArcGISCachedService-BGpqSK-t.js","assets/TileInfoTilemapCache-B5QzaA9w.js","assets/TilemapCache-C5u4Iv5n.js","assets/LercDecoder-BeMnY26Z.js","assets/WorkerHandle-DHilbf9d.js","assets/layersCreator-CirDWEZ0.js","assets/portalLayers-Cxdpj3nC.js","assets/associatedFeatureServiceUtils-DtX_VGO6.js","assets/fetchService-B20nMKmt.js","assets/arcgisLayers-phWRn0kH.js","assets/statsWorker-DMYGFZ63.js","assets/utils-D1CP9sU1.js","assets/utils-DBN7A_tY.js","assets/ClassBreaksDefinition-BrXlD5qO.js","assets/geometryEngineWorker-BHmWvPIm.js","assets/geometryEngineJSON-C7R8ki81.js","assets/geometryEngineBase-CCMH6bZ-.js","assets/json-Wa8cmqdu.js","assets/CSVSourceWorker-BsBWPtmx.js","assets/date-M6n_RqpC.js","assets/FeatureStore-ChMSdjPL.js","assets/BoundsStore-Dpz0NhiX.js","assets/PooledRBush-CdicRrWI.js","assets/quickselect-DrLLJyeR.js","assets/QueryEngine-CaE0LBLl.js","assets/WhereClause-D8vJ2G6A.js","assets/TimeOnly-DaIcEFlC.js","assets/QueryEngineCapabilities-CTDe3LlQ.js","assets/optimizedFeatureQueryEngineAdapter-BBp9J6NJ.js","assets/number-_A54gQnW.js","assets/clientSideDefaults-BBKIx7K7.js","assets/EdgeProcessingWorker-CTb44O9x.js","assets/workerHelper-DY6ZgPNk.js","assets/ElevationSamplerWorker-9CmApRTG.js","assets/vertexSpaceConversion-CoF6tY4a.js","assets/FeatureServiceSnappingSourceWorker-DmuXWQ_E.js","assets/symbologySnappingCandidates-C-c--Iu9.js","assets/GeoJSONSourceWorker-uumldrIr.js","assets/geojson-BGfvfIuu.js","assets/sourceUtils-BHpPVPWc.js","assets/MemorySourceWorker-DUOZmL34.js","assets/objectIdUtils-4dd1rf9p.js","assets/FeaturePipelineWorker-XUDfO8SO.js","assets/TurboLine-BcqxuL17.js","assets/constants-D5zmR9t2.js","assets/Rect-BAnET0xx.js","assets/ogcFeatureUtils-Bv7sHnD3.js","assets/StreamFeatureManager-CxO6MW6f.js","assets/createConnection-C62-2wCw.js","assets/PointCloudWorker-zyf0lYsa.js","assets/PointCloudWorkerUtil-KP9-nHX7.js","assets/PointCloudUniqueValueRenderer-jGak-GzH.js","assets/I3SBinaryReader-BA_fs1gt.js","assets/RasterWorker-BGWCl8pT.js","assets/dataUtils-JUEJlJCw.js","assets/pixelRangeUtils-DR2RxTkt.js","assets/PolynomialTransform-D8QAxrdb.js","assets/rasterProjectionHelper-Di5VIoFP.js","assets/SceneLayerWorker-BYGZXe0f.js","assets/I3SNode-EHMW0nYD.js","assets/I3SUtil-C-Vb3oTA.js","assets/WFSSourceWorker-miUZDZL9.js","assets/wfsUtils-CrdatciE.js","assets/xmlUtils-CtUoQO7q.js","assets/WorkerTileHandler-BzTuT9GY.js","assets/StyleRepository-DIEcvHgU.js","assets/Lyr3DWorker-CQNsV537.js","assets/ILyr3DWasmPerSceneView-vPx4somd.js","assets/Lyr3DModule-BlT0fbif.js","assets/arcadeUtils-C13sLc9r.js","assets/ImmutableArray-BPVd6ESQ.js","assets/hash-CcEbRgUF.js","assets/TileLayerView3D-DKrGK8F5.js","assets/LayerView3D-C4KZt2OF.js","assets/TiledLayerView3D-DRAr6-Rj.js","assets/fetchTile-DKtIkKcC.js","assets/LayerView-DSYFlAGH.js","assets/RefreshableLayerView-jE7rUYdn.js","assets/MapServiceLayerViewHelper-BEiN8FBY.js","assets/floorFilterUtils-DZ5C6FQv.js","assets/drapedUtils-DuDNtWPW.js","assets/sublayerUtils-DStkHzTp.js","assets/popupUtils-DKO8t5Xl.js","assets/ElevationLayerView3D-CJBO-Rw9.js","assets/BaseDynamicLayerView3D-BT7qvJ6g.js","assets/DynamicLayerView3D-D_H-Xtun.js","assets/projectExtentUtils-BpzbQ-ac.js","assets/ImageMaterial.glsl-BCEuNf0A.js","assets/BuildingSceneLayerView3D-CcD3Z1LX.js","assets/BuildingGroupSublayer-DCQewUwU.js","assets/BuildingComponentSublayer-BkZ7X6YT.js","assets/capabilities-CAweHQni.js","assets/I3SIndexInfo-zPcmNQy_.js","assets/I3SLayerDefinitions-DZAuq1b2.js","assets/I3SMeshView3D-BG22sA9B.js","assets/Transform-bRyKcWPf.js","assets/RenderTexture-D5dhwZdw.js","assets/I3SOverrides-BreukWWr.js","assets/meshFeatureSet-5gc3ywNQ.js","assets/Mesh-8Rxbsd2F.js","assets/MeshTransform-CUGIHROx.js","assets/External-DXhGHBeN.js","assets/infoFor3D-DsOdlPuA.js","assets/FeatureLayerView3D-BrE5ODgc.js","assets/FeatureLayerViewBase3D-x2Ppzmsx.js","assets/HeatmapDensity.glsl-Do5RQCvI.js","assets/timeSupport-fnyqrcLT.js","assets/dehydratedFeatureComparison-Bo9fDj4w.js","assets/queryForSymbologySnapping-16UvYKZd.js","assets/Graphics3DObjectStates-D7nS6_CR.js","assets/rendererConversion-DLS6cD-z.js","assets/EventedSet-DTUNI7Hp.js","assets/SceneModification-DAxArih9.js","assets/persistable-BD-R8WMH.js","assets/resourceExtension-XfH8rSK0.js","assets/makeScheduleFunction-CggzEh3c.js","assets/I3SQueryFeatureStore-D8gkkkEt.js","assets/TemporalSceneLayerView-B6fx5zbf.js","assets/CatalogLayerView3D-B9HwRA5o.js","assets/CatalogDynamicGroupLayerView3D-BtLTCOVl.js","assets/CatalogFootprintLayerView3D-_d6Iza29.js","assets/CSVLayerView3D-RA9GcXAs.js","assets/DimensionLayerView3D-DZp92uoi.js","assets/GeoJSONLayerView3D-yKhmtrRn.js","assets/GraphicsLayerView3D-DR1mxRK_.js","assets/GraphicsProcessor-I9CRUh3r.js","assets/GroupLayerView-BS7FRsxo.js","assets/ImageryLayerView3D-TAPRUDQk.js","assets/IntegratedMeshLayerView3D-C5ZVBigS.js","assets/IntegratedMesh3DTilesLayerView3D-9vMZKfbW.js","assets/LineOfSightLayerView3D-CMhjFV2-.js","assets/MapImageLayerView3D-CeZba1Gt.js","assets/ExportImageParameters-DB4s5Xeq.js","assets/MediaLayerView3D-vpjNPUsG.js","assets/MediaElementView-jR9kZdS2.js","assets/normalizeUtilsSync-CyPtJlmy.js","assets/keybindings-DzGq-ayx.js","assets/SnappingManagerPool-C4IYb6Jq.js","assets/geodesicLengthMeasurementUtils-CcQEe0pw.js","assets/geometryEngine-CP1y0HdF.js","assets/hydrated-qM2oOR9l.js","assets/geometry2dUtils-1g5BaozH.js","assets/OGCFeatureLayerView3D-CqHnybnL.js","assets/PointCloudLayerView3D-DUjDVY4D.js","assets/PopupSceneLayerView-DJWNcPyV.js","assets/VoxelLayerView3D-BPxig9Ek.js","assets/RouteLayerView3D-zzUahcDq.js","assets/Stop-SIZM7nu2.js","assets/SceneLayerView3D-Q0rRrQsP.js","assets/SceneLayerView-OCUJjumO.js","assets/SceneLayerGraphicsView3D-DSHslhm4.js","assets/StreamLayerView3D-BhKtYqL6.js","assets/ImageryTileLayerView3D-D31I1aPj.js","assets/VectorTileLayerView3D-DkZ0cWJk.js","assets/vec4f32-CjrfB-0a.js","assets/WFSLayerView3D-ChKjZjXJ.js","assets/WMSLayerView3D-C69qr5oF.js","assets/ExportWMSImageParameters-TRws0n_Q.js","assets/WMTSLayerView3D-0enyxpSd.js","assets/AreaMeasurementAnalysisView3D-Bpq_R2RB.js","assets/interfaces-CzLjGKWc.js","assets/TextOverlayItem-CjGoHFZD.js","assets/AnalysisView3D-Cx6Wu0Pp.js","assets/euclideanAreaMeasurementUtils--dIm4b_5.js","assets/projectionUtils-D0Fg-GdI.js","assets/EditGeometryOperations-CwWNavwB.js","assets/Segment-b4zz4m2O.js","assets/LineVisualElement-BNX9t_x2.js","assets/DimensionAnalysisView3D-2UYE7Ww2.js","assets/LengthDimension-DHlRgMZ5.js","assets/SnappingOperation-CIYjuWdB.js","assets/ExtendedLineVisualElement-bRaSEyS7.js","assets/EngineVisualElement-BgZN6VkP.js","assets/Laserlines.glsl-B0_2pBNi.js","assets/PointVisualElement-DslVJqfV.js","assets/RightAngleQuadVisualElement-AzkZBFsr.js","assets/PointSnappingHint-wwIiyjnx.js","assets/ShadedColorMaterial.glsl-BRIWgvq_.js","assets/dragEventPipeline3D-BgsHjJxg.js","assets/memoize-DsJmrG76.js","assets/Factory-C_0b9z_u.js","assets/analysisViewUtils-CHc4X1aG.js","assets/ToolIntersector-BoVSE7q4.js","assets/DirectLineMeasurementAnalysisView3D-CsV-XZtf.js","assets/LineOfSightAnalysisView3D-CoCJuoJH.js","assets/LineOfSightAnalysisTarget-BSEldZt5.js","assets/manipulatorUtils-DJrCiFdl.js","assets/SliceAnalysisView3D-4ZgduRaH.js","assets/SlicePlaneMaterial.glsl-CGIxFd_m.js","assets/sliceToolConfig-DOTAEwou.js","assets/ViewshedAnalysisView3D-kJKgxSo5.js","assets/MoveManipulation-BK0NuELY.js","assets/TerrainTileTree3DDebugger-Cg08msqA.js","assets/TileTreeDebugger-B63NORdS.js","assets/EdgeView-UddiXFbZ.js","assets/EdgeWorkerHandle-DvXeMpMa.js","assets/Lyr3DWasmPerSceneView-D135v_d6.js","assets/calcite-button-wzbJSjju.js","assets/form-BJ34_e7G.js","assets/dom-Rtouz73S.js","assets/guid-DP-7rFCR.js","assets/interactive-CWgqNlsC.js","assets/label-UneFJgqI.js","assets/component-thCpPSLC.js","assets/loadable-eUqeJk8a.js","assets/t9n-xVJjFAUV.js","assets/key-Dalt3dqL.js","assets/observers-BPIbJdZT.js","assets/icon-dcAZsWjZ.js","assets/loader-DOXtJc1f.js","assets/calcite-icon-eob-Ctv5.js","assets/FeatureTileTree3DDebugger-BEIdKzph.js","assets/GraphicsView3D-HJTXYTRZ.js","assets/calcite-tooltip-BQEWocaS.js","assets/floating-ui-CL3xRw0l.js","assets/debounce-BXUnv6U0.js","assets/openCloseComponent-OSTvlJ3x.js","assets/FloatingArrow-BVJjTzJU.js","assets/chartUtilsAm5-Cs1TIBZA.js","assets/Theme-DwldTEMP.js","assets/Tooltip-DOyCycIC.js","assets/DefaultTheme-BqX14vwE.js","assets/chartCommon-73TzNfEX.js","assets/Button-BEaAiumc.js","assets/ColorSet-OWc_dyuo.js","assets/pieChart-Yx89CjWe.js","assets/Tick-BNEwLmfm.js","assets/xyChart-BLQ1eQtR.js","assets/editingSupport-CM8xZqh_.js","assets/layersLoader-D9iTedwj.js","assets/featureLayerUtils-C4C-OlQV.js","assets/utils-BHCgC0TK.js","assets/FeatureLayerSource-CtSSYK5X.js","assets/QueryTask-CFTIJBvl.js","assets/executeForIds-tbjz-gE9.js","assets/executeQueryPBF-CCxzRbrS.js","assets/arcade-CZ_NVpYn.js","assets/calcite-loader-DzbGa04d.js","assets/calcite-list-CjOh8dex.js","assets/resources4-Bma3eAHE.js","assets/utils3-Bep3NDfG.js","assets/input2-CG2-3z5K.js","assets/scrim-BvcwoNuk.js","assets/calcite-list-item-uP1R-DBp.js","assets/action-DtybBIJ1.js","assets/calcite-notice-DUqL5bU5.js","assets/conditionalSlot-B8HPABTo.js","assets/calcite-action-Dhk8OhY7.js","assets/calcite-flow-item-f0hju3wh.js","assets/action-menu-DMzc-WO6.js","assets/focusTrapComponent-DPNwEC8u.js","assets/previewCIMSymbol-DA6mZqPI.js","assets/CIMSymbolRasterizer-l_nPs_TF.js","assets/calcite-action-bar-D6GZm2Cn.js","assets/action-group-DTH5f5qu.js","assets/calcite-action-group-C3SKU4KD.js","assets/calcite-flow-LTs5LM2h.js","assets/calcite-list-item-group-Cdc0vdwT.js","assets/Legend-aSZ3Y5CP.js","assets/calcite-action-menu-DkzMeh6a.js"])))=>i.map(i=>d[i]);
var wGe=Object.defineProperty;var xGe=(t,e,i)=>e in t?wGe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var Pp=(t,e,i)=>xGe(t,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();/**
* @vue/shared v3.4.38
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Fie(t,e){const i=new Set(t.split(","));return r=>i.has(r)}const En={},pA=[],tp=()=>{},TGe=()=>!1,Jj=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),kie=t=>t.startsWith("onUpdate:"),Qc=Object.assign,Uie=(t,e)=>{const i=t.indexOf(e);i>-1&&t.splice(i,1)},SGe=Object.prototype.hasOwnProperty,zr=(t,e)=>SGe.call(t,e),Xi=Array.isArray,p3=t=>Qj(t)==="[object Map]",EGe=t=>Qj(t)==="[object Set]",sr=t=>typeof t=="function",vl=t=>typeof t=="string",lO=t=>typeof t=="symbol",Ho=t=>t!==null&&typeof t=="object",sTe=t=>(Ho(t)||sr(t))&&sr(t.then)&&sr(t.catch),CGe=Object.prototype.toString,Qj=t=>CGe.call(t),MGe=t=>Qj(t).slice(8,-1),AGe=t=>Qj(t)==="[object Object]",Vie=t=>vl(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,f3=Fie(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Kj=t=>{const e=Object.create(null);return i=>e[i]||(e[i]=t(i))},PGe=/-(\w)/g,YS=Kj(t=>t.replace(PGe,(e,i)=>i?i.toUpperCase():"")),OGe=/\B([A-Z])/g,L2=Kj(t=>t.replace(OGe,"-$1").toLowerCase()),nTe=Kj(t=>t.charAt(0).toUpperCase()+t.slice(1)),Q8=Kj(t=>t?`on${nTe(t)}`:""),XS=(t,e)=>!Object.is(t,e),K8=(t,...e)=>{for(let i=0;i<t.length;i++)t[i](...e)},oTe=(t,e,i,r=!1)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:r,value:i})},$Ge=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let Rce;const aTe=()=>Rce||(Rce=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function zie(t){if(Xi(t)){const e={};for(let i=0;i<t.length;i++){const r=t[i],s=vl(r)?DGe(r):zie(r);if(s)for(const n in s)e[n]=s[n]}return e}else if(vl(t)||Ho(t))return t}const RGe=/;(?![^(]*\))/g,IGe=/:([^]+)/,LGe=/\/\*[^]*?\*\//g;function DGe(t){const e={};return t.replace(LGe,"").split(RGe).forEach(i=>{if(i){const r=i.split(IGe);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function eG(t){let e="";if(vl(t))e=t;else if(Xi(t))for(let i=0;i<t.length;i++){const r=eG(t[i]);r&&(e+=r+" ")}else if(Ho(t))for(const i in t)t[i]&&(e+=i+" ");return e.trim()}const NGe="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",FGe=Fie(NGe);function lTe(t){return!!t||t===""}/**
* @vue/reactivity v3.4.38
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let gf;class kGe{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this.parent=gf,!e&&gf&&(this.index=(gf.scopes||(gf.scopes=[])).push(this)-1)}get active(){return this._active}run(e){if(this._active){const i=gf;try{return gf=this,e()}finally{gf=i}}}on(){gf=this}off(){gf=this.parent}stop(e){if(this._active){let i,r;for(i=0,r=this.effects.length;i<r;i++)this.effects[i].stop();for(i=0,r=this.cleanups.length;i<r;i++)this.cleanups[i]();if(this.scopes)for(i=0,r=this.scopes.length;i<r;i++)this.scopes[i].stop(!0);if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0,this._active=!1}}}function UGe(t,e=gf){e&&e.active&&e.effects.push(t)}function VGe(){return gf}let bS;class Bie{constructor(e,i,r,s){this.fn=e,this.trigger=i,this.scheduler=r,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,UGe(this,s)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,hw();for(let e=0;e<this._depsLength;e++){const i=this.deps[e];if(i.computed&&(zGe(i.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),dw()}return this._dirtyLevel>=4}set dirty(e){this._dirtyLevel=e?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let e=fb,i=bS;try{return fb=!0,bS=this,this._runnings++,Ice(this),this.fn()}finally{Lce(this),this._runnings--,bS=i,fb=e}}stop(){this.active&&(Ice(this),Lce(this),this.onStop&&this.onStop(),this.active=!1)}}function zGe(t){return t.value}function Ice(t){t._trackId++,t._depsLength=0}function Lce(t){if(t.deps.length>t._depsLength){for(let e=t._depsLength;e<t.deps.length;e++)cTe(t.deps[e],t);t.deps.length=t._depsLength}}function cTe(t,e){const i=t.get(e);i!==void 0&&e._trackId!==i&&(t.delete(e),t.size===0&&t.cleanup())}let fb=!0,QW=0;const uTe=[];function hw(){uTe.push(fb),fb=!1}function dw(){const t=uTe.pop();fb=t===void 0?!0:t}function jie(){QW++}function Gie(){for(QW--;!QW&&KW.length;)KW.shift()()}function hTe(t,e,i){if(e.get(t)!==t._trackId){e.set(t,t._trackId);const r=t.deps[t._depsLength];r!==e?(r&&cTe(r,t),t.deps[t._depsLength++]=e):t._depsLength++}}const KW=[];function dTe(t,e,i){jie();for(const r of t.keys()){let s;r._dirtyLevel<e&&(s??(s=t.get(r)===r._trackId))&&(r._shouldSchedule||(r._shouldSchedule=r._dirtyLevel===0),r._dirtyLevel=e),r._shouldSchedule&&(s??(s=t.get(r)===r._trackId))&&(r.trigger(),(!r._runnings||r.allowRecurse)&&r._dirtyLevel!==2&&(r._shouldSchedule=!1,r.scheduler&&KW.push(r.scheduler)))}Gie()}const pTe=(t,e)=>{const i=new Map;return i.cleanup=t,i.computed=e,i},eZ=new WeakMap,wS=Symbol(""),tZ=Symbol("");function Gu(t,e,i){if(fb&&bS){let r=eZ.get(t);r||eZ.set(t,r=new Map);let s=r.get(i);s||r.set(i,s=pTe(()=>r.delete(i))),hTe(bS,s)}}function u_(t,e,i,r,s,n){const o=eZ.get(t);if(!o)return;let a=[];if(e==="clear")a=[...o.values()];else if(i==="length"&&Xi(t)){const l=Number(r);o.forEach((c,u)=>{(u==="length"||!lO(u)&&u>=l)&&a.push(c)})}else switch(i!==void 0&&a.push(o.get(i)),e){case"add":Xi(t)?Vie(i)&&a.push(o.get("length")):(a.push(o.get(wS)),p3(t)&&a.push(o.get(tZ)));break;case"delete":Xi(t)||(a.push(o.get(wS)),p3(t)&&a.push(o.get(tZ)));break;case"set":p3(t)&&a.push(o.get(wS));break}jie();for(const l of a)l&&dTe(l,4);Gie()}const BGe=Fie("__proto__,__v_isRef,__isVue"),fTe=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(lO)),Dce=jGe();function jGe(){const t={};return["includes","indexOf","lastIndexOf"].forEach(e=>{t[e]=function(...i){const r=Is(this);for(let n=0,o=this.length;n<o;n++)Gu(r,"get",n+"");const s=r[e](...i);return s===-1||s===!1?r[e](...i.map(Is)):s}}),["push","pop","shift","unshift","splice"].forEach(e=>{t[e]=function(...i){hw(),jie();const r=Is(this)[e].apply(this,i);return Gie(),dw(),r}}),t}function GGe(t){lO(t)||(t=String(t));const e=Is(this);return Gu(e,"has",t),e.hasOwnProperty(t)}class mTe{constructor(e=!1,i=!1){this._isReadonly=e,this._isShallow=i}get(e,i,r){const s=this._isReadonly,n=this._isShallow;if(i==="__v_isReactive")return!s;if(i==="__v_isReadonly")return s;if(i==="__v_isShallow")return n;if(i==="__v_raw")return r===(s?n?r6e:vTe:n?_Te:yTe).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=Xi(e);if(!s){if(o&&zr(Dce,i))return Reflect.get(Dce,i,r);if(i==="hasOwnProperty")return GGe}const a=Reflect.get(e,i,r);return(lO(i)?fTe.has(i):BGe(i))||(s||Gu(e,"get",i),n)?a:Zh(a)?o&&Vie(i)?a:a.value:Ho(a)?s?bTe(a):Wie(a):a}}class gTe extends mTe{constructor(e=!1){super(!1,e)}set(e,i,r,s){let n=e[i];if(!this._isShallow){const l=QA(n);if(!_L(r)&&!QA(r)&&(n=Is(n),r=Is(r)),!Xi(e)&&Zh(n)&&!Zh(r))return l?!1:(n.value=r,!0)}const o=Xi(e)&&Vie(i)?Number(i)<e.length:zr(e,i),a=Reflect.set(e,i,r,s);return e===Is(s)&&(o?XS(r,n)&&u_(e,"set",i,r):u_(e,"add",i,r)),a}deleteProperty(e,i){const r=zr(e,i);e[i];const s=Reflect.deleteProperty(e,i);return s&&r&&u_(e,"delete",i,void 0),s}has(e,i){const r=Reflect.has(e,i);return(!lO(i)||!fTe.has(i))&&Gu(e,"has",i),r}ownKeys(e){return Gu(e,"iterate",Xi(e)?"length":wS),Reflect.ownKeys(e)}}class HGe extends mTe{constructor(e=!1){super(!0,e)}set(e,i){return!0}deleteProperty(e,i){return!0}}const qGe=new gTe,WGe=new HGe,ZGe=new gTe(!0);const Hie=t=>t,tG=t=>Reflect.getPrototypeOf(t);function ZN(t,e,i=!1,r=!1){t=t.__v_raw;const s=Is(t),n=Is(e);i||(XS(e,n)&&Gu(s,"get",e),Gu(s,"get",n));const{has:o}=tG(s),a=r?Hie:i?Xie:Yie;if(o.call(s,e))return a(t.get(e));if(o.call(s,n))return a(t.get(n));t!==s&&t.get(e)}function YN(t,e=!1){const i=this.__v_raw,r=Is(i),s=Is(t);return e||(XS(t,s)&&Gu(r,"has",t),Gu(r,"has",s)),t===s?i.has(t):i.has(t)||i.has(s)}function XN(t,e=!1){return t=t.__v_raw,!e&&Gu(Is(t),"iterate",wS),Reflect.get(t,"size",t)}function Nce(t,e=!1){!e&&!_L(t)&&!QA(t)&&(t=Is(t));const i=Is(this);return tG(i).has.call(i,t)||(i.add(t),u_(i,"add",t,t)),this}function Fce(t,e,i=!1){!i&&!_L(e)&&!QA(e)&&(e=Is(e));const r=Is(this),{has:s,get:n}=tG(r);let o=s.call(r,t);o||(t=Is(t),o=s.call(r,t));const a=n.call(r,t);return r.set(t,e),o?XS(e,a)&&u_(r,"set",t,e):u_(r,"add",t,e),this}function kce(t){const e=Is(this),{has:i,get:r}=tG(e);let s=i.call(e,t);s||(t=Is(t),s=i.call(e,t)),r&&r.call(e,t);const n=e.delete(t);return s&&u_(e,"delete",t,void 0),n}function Uce(){const t=Is(this),e=t.size!==0,i=t.clear();return e&&u_(t,"clear",void 0,void 0),i}function JN(t,e){return function(r,s){const n=this,o=n.__v_raw,a=Is(o),l=e?Hie:t?Xie:Yie;return!t&&Gu(a,"iterate",wS),o.forEach((c,u)=>r.call(s,l(c),l(u),n))}}function QN(t,e,i){return function(...r){const s=this.__v_raw,n=Is(s),o=p3(n),a=t==="entries"||t===Symbol.iterator&&o,l=t==="keys"&&o,c=s[t](...r),u=i?Hie:e?Xie:Yie;return!e&&Gu(n,"iterate",l?tZ:wS),{next(){const{value:d,done:f}=c.next();return f?{value:d,done:f}:{value:a?[u(d[0]),u(d[1])]:u(d),done:f}},[Symbol.iterator](){return this}}}}function av(t){return function(...e){return t==="delete"?!1:t==="clear"?void 0:this}}function YGe(){const t={get(n){return ZN(this,n)},get size(){return XN(this)},has:YN,add:Nce,set:Fce,delete:kce,clear:Uce,forEach:JN(!1,!1)},e={get(n){return ZN(this,n,!1,!0)},get size(){return XN(this)},has:YN,add(n){return Nce.call(this,n,!0)},set(n,o){return Fce.call(this,n,o,!0)},delete:kce,clear:Uce,forEach:JN(!1,!0)},i={get(n){return ZN(this,n,!0)},get size(){return XN(this,!0)},has(n){return YN.call(this,n,!0)},add:av("add"),set:av("set"),delete:av("delete"),clear:av("clear"),forEach:JN(!0,!1)},r={get(n){return ZN(this,n,!0,!0)},get size(){return XN(this,!0)},has(n){return YN.call(this,n,!0)},add:av("add"),set:av("set"),delete:av("delete"),clear:av("clear"),forEach:JN(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(n=>{t[n]=QN(n,!1,!1),i[n]=QN(n,!0,!1),e[n]=QN(n,!1,!0),r[n]=QN(n,!0,!0)}),[t,i,e,r]}const[XGe,JGe,QGe,KGe]=YGe();function qie(t,e){const i=e?t?KGe:QGe:t?JGe:XGe;return(r,s,n)=>s==="__v_isReactive"?!t:s==="__v_isReadonly"?t:s==="__v_raw"?r:Reflect.get(zr(i,s)&&s in r?i:r,s,n)}const e6e={get:qie(!1,!1)},t6e={get:qie(!1,!0)},i6e={get:qie(!0,!1)};const yTe=new WeakMap,_Te=new WeakMap,vTe=new WeakMap,r6e=new WeakMap;function s6e(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function n6e(t){return t.__v_skip||!Object.isExtensible(t)?0:s6e(MGe(t))}function Wie(t){return QA(t)?t:Zie(t,!1,qGe,e6e,yTe)}function o6e(t){return Zie(t,!1,ZGe,t6e,_Te)}function bTe(t){return Zie(t,!0,WGe,i6e,vTe)}function Zie(t,e,i,r,s){if(!Ho(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const n=s.get(t);if(n)return n;const o=n6e(t);if(o===0)return t;const a=new Proxy(t,o===2?r:i);return s.set(t,a),a}function m3(t){return QA(t)?m3(t.__v_raw):!!(t&&t.__v_isReactive)}function QA(t){return!!(t&&t.__v_isReadonly)}function _L(t){return!!(t&&t.__v_isShallow)}function wTe(t){return t?!!t.__v_raw:!1}function Is(t){const e=t&&t.__v_raw;return e?Is(e):t}function a6e(t){return Object.isExtensible(t)&&oTe(t,"__v_skip",!0),t}const Yie=t=>Ho(t)?Wie(t):t,Xie=t=>Ho(t)?bTe(t):t;class xTe{constructor(e,i,r,s){this.getter=e,this._setter=i,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new Bie(()=>e(this._value),()=>eH(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!s,this.__v_isReadonly=r}get value(){const e=Is(this);return(!e._cacheable||e.effect.dirty)&&XS(e._value,e._value=e.effect.run())&&eH(e,4),c6e(e),e.effect._dirtyLevel>=2&&eH(e,2),e._value}set value(e){this._setter(e)}get _dirty(){return this.effect.dirty}set _dirty(e){this.effect.dirty=e}}function l6e(t,e,i=!1){let r,s;const n=sr(t);return n?(r=t,s=tp):(r=t.get,s=t.set),new xTe(r,s,n||!s,i)}function c6e(t){var e;fb&&bS&&(t=Is(t),hTe(bS,(e=t.dep)!=null?e:t.dep=pTe(()=>t.dep=void 0,t instanceof xTe?t:void 0)))}function eH(t,e=4,i,r){t=Is(t);const s=t.dep;s&&dTe(s,e)}function Zh(t){return!!(t&&t.__v_isRef===!0)}function u6e(t){return Zh(t)?t.value:t}const h6e={get:(t,e,i)=>u6e(Reflect.get(t,e,i)),set:(t,e,i,r)=>{const s=t[e];return Zh(s)&&!Zh(i)?(s.value=i,!0):Reflect.set(t,e,i,r)}};function TTe(t){return m3(t)?t:new Proxy(t,h6e)}/**
* @vue/runtime-core v3.4.38
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function mb(t,e,i,r){try{return r?t(...r):t()}catch(s){iG(s,e,i)}}function Jf(t,e,i,r){if(sr(t)){const s=mb(t,e,i,r);return s&&sTe(s)&&s.catch(n=>{iG(n,e,i)}),s}if(Xi(t)){const s=[];for(let n=0;n<t.length;n++)s.push(Jf(t[n],e,i,r));return s}}function iG(t,e,i,r=!0){const s=e?e.vnode:null;if(e){let n=e.parent;const o=e.proxy,a=`https://vuejs.org/error-reference/#runtime-${i}`;for(;n;){const c=n.ec;if(c){for(let u=0;u<c.length;u++)if(c[u](t,o,a)===!1)return}n=n.parent}const l=e.appContext.config.errorHandler;if(l){hw(),mb(l,null,10,[t,o,a]),dw();return}}d6e(t,i,s,r)}function d6e(t,e,i,r=!0){console.error(t)}let vL=!1,iZ=!1;const ec=[];let Rg=0;const fA=[];let O1=null,FT=0;const STe=Promise.resolve();let Jie=null;function p6e(t){const e=Jie||STe;return t?e.then(this?t.bind(this):t):e}function f6e(t){let e=Rg+1,i=ec.length;for(;e<i;){const r=e+i>>>1,s=ec[r],n=bL(s);n<t||n===t&&s.pre?e=r+1:i=r}return e}function Qie(t){(!ec.length||!ec.includes(t,vL&&t.allowRecurse?Rg+1:Rg))&&(t.id==null?ec.push(t):ec.splice(f6e(t.id),0,t),ETe())}function ETe(){!vL&&!iZ&&(iZ=!0,Jie=STe.then(MTe))}function m6e(t){const e=ec.indexOf(t);e>Rg&&ec.splice(e,1)}function g6e(t){Xi(t)?fA.push(...t):(!O1||!O1.includes(t,t.allowRecurse?FT+1:FT))&&fA.push(t),ETe()}function Vce(t,e,i=vL?Rg+1:0){for(;i<ec.length;i++){const r=ec[i];if(r&&r.pre){if(t&&r.id!==t.uid)continue;ec.splice(i,1),i--,r()}}}function CTe(t){if(fA.length){const e=[...new Set(fA)].sort((i,r)=>bL(i)-bL(r));if(fA.length=0,O1){O1.push(...e);return}for(O1=e,FT=0;FT<O1.length;FT++){const i=O1[FT];i.active!==!1&&i()}O1=null,FT=0}}const bL=t=>t.id==null?1/0:t.id,y6e=(t,e)=>{const i=bL(t)-bL(e);if(i===0){if(t.pre&&!e.pre)return-1;if(e.pre&&!t.pre)return 1}return i};function MTe(t){iZ=!1,vL=!0,ec.sort(y6e);try{for(Rg=0;Rg<ec.length;Rg++){const e=ec[Rg];e&&e.active!==!1&&mb(e,e.i,e.i?15:14)}}finally{Rg=0,ec.length=0,CTe(),vL=!1,Jie=null,(ec.length||fA.length)&&MTe()}}let ip=null,rG=null;function nz(t){const e=ip;return ip=t,rG=t&&t.type.__scopeId||null,e}function _6e(t){rG=t}function v6e(){rG=null}function b6e(t,e=ip,i){if(!e||t._n)return t;const r=(...s)=>{r._d&&Zce(-1);const n=nz(e);let o;try{o=t(...s)}finally{nz(n),r._d&&Zce(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function Gy(t,e){if(ip===null)return t;const i=lG(ip),r=t.dirs||(t.dirs=[]);for(let s=0;s<e.length;s++){let[n,o,a,l=En]=e[s];n&&(sr(n)&&(n={mounted:n,updated:n}),n.deep&&H1(o),r.push({dir:n,instance:i,value:o,oldValue:void 0,arg:a,modifiers:l}))}return t}function Uw(t,e,i,r){const s=t.dirs,n=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];n&&(a.oldValue=n[o].value);let l=a.dir[r];l&&(hw(),Jf(l,i,8,[t.el,a,t,e]),dw())}}function ATe(t,e){t.shapeFlag&6&&t.component?ATe(t.component.subTree,e):t.shapeFlag&128?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}const xk=t=>!!t.type.__asyncLoader,PTe=t=>t.type.__isKeepAlive;function w6e(t,e){OTe(t,"a",e)}function x6e(t,e){OTe(t,"da",e)}function OTe(t,e,i=jc){const r=t.__wdc||(t.__wdc=()=>{let s=i;for(;s;){if(s.isDeactivated)return;s=s.parent}return t()});if(sG(e,r,i),i){let s=i.parent;for(;s&&s.parent;)PTe(s.parent.vnode)&&T6e(r,e,i,s),s=s.parent}}function T6e(t,e,i,r){const s=sG(e,t,r,!0);$Te(()=>{Uie(r[e],s)},i)}function sG(t,e,i=jc,r=!1){if(i){const s=i[t]||(i[t]=[]),n=e.__weh||(e.__weh=(...o)=>{hw();const a=PD(i),l=Jf(e,i,t,o);return a(),dw(),l});return r?s.unshift(n):s.push(n),n}}const k_=t=>(e,i=jc)=>{(!aG||t==="sp")&&sG(t,(...r)=>e(...r),i)},S6e=k_("bm"),E6e=k_("m"),C6e=k_("bu"),M6e=k_("u"),A6e=k_("bum"),$Te=k_("um"),P6e=k_("sp"),O6e=k_("rtg"),$6e=k_("rtc");function R6e(t,e=jc){sG("ec",t,e)}const I6e=Symbol.for("v-ndc"),rZ=t=>t?YTe(t)?lG(t):rZ(t.parent):null,g3=Qc(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>rZ(t.parent),$root:t=>rZ(t.root),$emit:t=>t.emit,$options:t=>Kie(t),$forceUpdate:t=>t.f||(t.f=()=>{t.effect.dirty=!0,Qie(t.update)}),$nextTick:t=>t.n||(t.n=p6e.bind(t.proxy)),$watch:t=>r8e.bind(t)}),tH=(t,e)=>t!==En&&!t.__isScriptSetup&&zr(t,e),L6e={get({_:t},e){if(e==="__v_skip")return!0;const{ctx:i,setupState:r,data:s,props:n,accessCache:o,type:a,appContext:l}=t;let c;if(e[0]!=="$"){const m=o[e];if(m!==void 0)switch(m){case 1:return r[e];case 2:return s[e];case 4:return i[e];case 3:return n[e]}else{if(tH(r,e))return o[e]=1,r[e];if(s!==En&&zr(s,e))return o[e]=2,s[e];if((c=t.propsOptions[0])&&zr(c,e))return o[e]=3,n[e];if(i!==En&&zr(i,e))return o[e]=4,i[e];sZ&&(o[e]=0)}}const u=g3[e];let d,f;if(u)return e==="$attrs"&&Gu(t.attrs,"get",""),u(t);if((d=a.__cssModules)&&(d=d[e]))return d;if(i!==En&&zr(i,e))return o[e]=4,i[e];if(f=l.config.globalProperties,zr(f,e))return f[e]},set({_:t},e,i){const{data:r,setupState:s,ctx:n}=t;return tH(s,e)?(s[e]=i,!0):r!==En&&zr(r,e)?(r[e]=i,!0):zr(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(n[e]=i,!0)},has({_:{data:t,setupState:e,accessCache:i,ctx:r,appContext:s,propsOptions:n}},o){let a;return!!i[o]||t!==En&&zr(t,o)||tH(e,o)||(a=n[0])&&zr(a,o)||zr(r,o)||zr(g3,o)||zr(s.config.globalProperties,o)},defineProperty(t,e,i){return i.get!=null?t._.accessCache[e]=0:zr(i,"value")&&this.set(t,e,i.value,null),Reflect.defineProperty(t,e,i)}};function zce(t){return Xi(t)?t.reduce((e,i)=>(e[i]=null,e),{}):t}let sZ=!0;function D6e(t){const e=Kie(t),i=t.proxy,r=t.ctx;sZ=!1,e.beforeCreate&&Bce(e.beforeCreate,t,"bc");const{data:s,computed:n,methods:o,watch:a,provide:l,inject:c,created:u,beforeMount:d,mounted:f,beforeUpdate:m,updated:g,activated:y,deactivated:v,beforeDestroy:b,beforeUnmount:w,destroyed:x,unmounted:T,render:E,renderTracked:M,renderTriggered:O,errorCaptured:D,serverPrefetch:U,expose:k,inheritAttrs:H,components:V,directives:X,filters:q}=e;if(c&&N6e(c,r,null),o)for(const L in o){const N=o[L];sr(N)&&(r[L]=N.bind(i))}if(s){const L=s.call(i,i);Ho(L)&&(t.data=Wie(L))}if(sZ=!0,n)for(const L in n){const N=n[L],z=sr(N)?N.bind(i,i):sr(N.get)?N.get.bind(i,i):tp,W=!sr(N)&&sr(N.set)?N.set.bind(i):tp,J=P8e({get:z,set:W});Object.defineProperty(r,L,{enumerable:!0,configurable:!0,get:()=>J.value,set:ee=>J.value=ee})}if(a)for(const L in a)RTe(a[L],r,i,L);if(l){const L=sr(l)?l.call(i):l;Reflect.ownKeys(L).forEach(N=>{B6e(N,L[N])})}u&&Bce(u,t,"c");function ye(L,N){Xi(N)?N.forEach(z=>L(z.bind(i))):N&&L(N.bind(i))}if(ye(S6e,d),ye(E6e,f),ye(C6e,m),ye(M6e,g),ye(w6e,y),ye(x6e,v),ye(R6e,D),ye($6e,M),ye(O6e,O),ye(A6e,w),ye($Te,T),ye(P6e,U),Xi(k))if(k.length){const L=t.exposed||(t.exposed={});k.forEach(N=>{Object.defineProperty(L,N,{get:()=>i[N],set:z=>i[N]=z})})}else t.exposed||(t.exposed={});E&&t.render===tp&&(t.render=E),H!=null&&(t.inheritAttrs=H),V&&(t.components=V),X&&(t.directives=X)}function N6e(t,e,i=tp){Xi(t)&&(t=nZ(t));for(const r in t){const s=t[r];let n;Ho(s)?"default"in s?n=Tk(s.from||r,s.default,!0):n=Tk(s.from||r):n=Tk(s),Zh(n)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>n.value,set:o=>n.value=o}):e[r]=n}}function Bce(t,e,i){Jf(Xi(t)?t.map(r=>r.bind(e.proxy)):t.bind(e.proxy),e,i)}function RTe(t,e,i,r){const s=r.includes(".")?qTe(i,r):()=>i[r];if(vl(t)){const n=e[t];sr(n)&&rH(s,n)}else if(sr(t))rH(s,t.bind(i));else if(Ho(t))if(Xi(t))t.forEach(n=>RTe(n,e,i,r));else{const n=sr(t.handler)?t.handler.bind(i):e[t.handler];sr(n)&&rH(s,n,t)}}function Kie(t){const e=t.type,{mixins:i,extends:r}=e,{mixins:s,optionsCache:n,config:{optionMergeStrategies:o}}=t.appContext,a=n.get(e);let l;return a?l=a:!s.length&&!i&&!r?l=e:(l={},s.length&&s.forEach(c=>oz(l,c,o,!0)),oz(l,e,o)),Ho(e)&&n.set(e,l),l}function oz(t,e,i,r=!1){const{mixins:s,extends:n}=e;n&&oz(t,n,i,!0),s&&s.forEach(o=>oz(t,o,i,!0));for(const o in e)if(!(r&&o==="expose")){const a=F6e[o]||i&&i[o];t[o]=a?a(t[o],e[o]):e[o]}return t}const F6e={data:jce,props:Gce,emits:Gce,methods:aR,computed:aR,beforeCreate:Ec,created:Ec,beforeMount:Ec,mounted:Ec,beforeUpdate:Ec,updated:Ec,beforeDestroy:Ec,beforeUnmount:Ec,destroyed:Ec,unmounted:Ec,activated:Ec,deactivated:Ec,errorCaptured:Ec,serverPrefetch:Ec,components:aR,directives:aR,watch:U6e,provide:jce,inject:k6e};function jce(t,e){return e?t?function(){return Qc(sr(t)?t.call(this,this):t,sr(e)?e.call(this,this):e)}:e:t}function k6e(t,e){return aR(nZ(t),nZ(e))}function nZ(t){if(Xi(t)){const e={};for(let i=0;i<t.length;i++)e[t[i]]=t[i];return e}return t}function Ec(t,e){return t?[...new Set([].concat(t,e))]:e}function aR(t,e){return t?Qc(Object.create(null),t,e):e}function Gce(t,e){return t?Xi(t)&&Xi(e)?[...new Set([...t,...e])]:Qc(Object.create(null),zce(t),zce(e??{})):e}function U6e(t,e){if(!t)return e;if(!e)return t;const i=Qc(Object.create(null),t);for(const r in e)i[r]=Ec(t[r],e[r]);return i}function ITe(){return{app:null,config:{isNativeTag:TGe,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let V6e=0;function z6e(t,e){return function(r,s=null){sr(r)||(r=Qc({},r)),s!=null&&!Ho(s)&&(s=null);const n=ITe(),o=new WeakSet;let a=!1;const l=n.app={_uid:V6e++,_component:r,_props:s,_container:null,_context:n,_instance:null,version:O8e,get config(){return n.config},set config(c){},use(c,...u){return o.has(c)||(c&&sr(c.install)?(o.add(c),c.install(l,...u)):sr(c)&&(o.add(c),c(l,...u))),l},mixin(c){return n.mixins.includes(c)||n.mixins.push(c),l},component(c,u){return u?(n.components[c]=u,l):n.components[c]},directive(c,u){return u?(n.directives[c]=u,l):n.directives[c]},mount(c,u,d){if(!a){const f=xS(r,s);return f.appContext=n,d===!0?d="svg":d===!1&&(d=void 0),u&&e?e(f,c):t(f,c,d),a=!0,l._container=c,c.__vue_app__=l,lG(f.component)}},unmount(){a&&(t(null,l._container),delete l._container.__vue_app__)},provide(c,u){return n.provides[c]=u,l},runWithContext(c){const u=mA;mA=l;try{return c()}finally{mA=u}}};return l}}let mA=null;function B6e(t,e){if(jc){let i=jc.provides;const r=jc.parent&&jc.parent.provides;r===i&&(i=jc.provides=Object.create(r)),i[t]=e}}function Tk(t,e,i=!1){const r=jc||ip;if(r||mA){const s=mA?mA._context.provides:r?r.parent==null?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&t in s)return s[t];if(arguments.length>1)return i&&sr(e)?e.call(r&&r.proxy):e}}const LTe={},DTe=()=>Object.create(LTe),NTe=t=>Object.getPrototypeOf(t)===LTe;function j6e(t,e,i,r=!1){const s={},n=DTe();t.propsDefaults=Object.create(null),FTe(t,e,s,n);for(const o in t.propsOptions[0])o in s||(s[o]=void 0);i?t.props=r?s:o6e(s):t.type.props?t.props=s:t.props=n,t.attrs=n}function G6e(t,e,i,r){const{props:s,attrs:n,vnode:{patchFlag:o}}=t,a=Is(s),[l]=t.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const u=t.vnode.dynamicProps;for(let d=0;d<u.length;d++){let f=u[d];if(nG(t.emitsOptions,f))continue;const m=e[f];if(l)if(zr(n,f))m!==n[f]&&(n[f]=m,c=!0);else{const g=YS(f);s[g]=oZ(l,a,g,m,t,!1)}else m!==n[f]&&(n[f]=m,c=!0)}}}else{FTe(t,e,s,n)&&(c=!0);let u;for(const d in a)(!e||!zr(e,d)&&((u=L2(d))===d||!zr(e,u)))&&(l?i&&(i[d]!==void 0||i[u]!==void 0)&&(s[d]=oZ(l,a,d,void 0,t,!0)):delete s[d]);if(n!==a)for(const d in n)(!e||!zr(e,d))&&(delete n[d],c=!0)}c&&u_(t.attrs,"set","")}function FTe(t,e,i,r){const[s,n]=t.propsOptions;let o=!1,a;if(e)for(let l in e){if(f3(l))continue;const c=e[l];let u;s&&zr(s,u=YS(l))?!n||!n.includes(u)?i[u]=c:(a||(a={}))[u]=c:nG(t.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(n){const l=Is(i),c=a||En;for(let u=0;u<n.length;u++){const d=n[u];i[d]=oZ(s,l,d,c[d],t,!zr(c,d))}}return o}function oZ(t,e,i,r,s,n){const o=t[i];if(o!=null){const a=zr(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&sr(l)){const{propsDefaults:c}=s;if(i in c)r=c[i];else{const u=PD(s);r=c[i]=l.call(null,e),u()}}else r=l}o[0]&&(n&&!a?r=!1:o[1]&&(r===""||r===L2(i))&&(r=!0))}return r}const H6e=new WeakMap;function kTe(t,e,i=!1){const r=i?H6e:e.propsCache,s=r.get(t);if(s)return s;const n=t.props,o={},a=[];let l=!1;if(!sr(t)){const u=d=>{l=!0;const[f,m]=kTe(d,e,!0);Qc(o,f),m&&a.push(...m)};!i&&e.mixins.length&&e.mixins.forEach(u),t.extends&&u(t.extends),t.mixins&&t.mixins.forEach(u)}if(!n&&!l)return Ho(t)&&r.set(t,pA),pA;if(Xi(n))for(let u=0;u<n.length;u++){const d=YS(n[u]);Hce(d)&&(o[d]=En)}else if(n)for(const u in n){const d=YS(u);if(Hce(d)){const f=n[u],m=o[d]=Xi(f)||sr(f)?{type:f}:Qc({},f),g=m.type;let y=!1,v=!0;if(Xi(g))for(let b=0;b<g.length;++b){const w=g[b],x=sr(w)&&w.name;if(x==="Boolean"){y=!0;break}else x==="String"&&(v=!1)}else y=sr(g)&&g.name==="Boolean";m[0]=y,m[1]=v,(y||zr(m,"default"))&&a.push(d)}}const c=[o,a];return Ho(t)&&r.set(t,c),c}function Hce(t){return t[0]!=="$"&&!f3(t)}const UTe=t=>t[0]==="_"||t==="$stable",ere=t=>Xi(t)?t.map(Ag):[Ag(t)],q6e=(t,e,i)=>{if(e._n)return e;const r=b6e((...s)=>ere(e(...s)),i);return r._c=!1,r},VTe=(t,e,i)=>{const r=t._ctx;for(const s in t){if(UTe(s))continue;const n=t[s];if(sr(n))e[s]=q6e(s,n,r);else if(n!=null){const o=ere(n);e[s]=()=>o}}},zTe=(t,e)=>{const i=ere(e);t.slots.default=()=>i},BTe=(t,e,i)=>{for(const r in e)(i||r!=="_")&&(t[r]=e[r])},W6e=(t,e,i)=>{const r=t.slots=DTe();if(t.vnode.shapeFlag&32){const s=e._;s?(BTe(r,e,i),i&&oTe(r,"_",s,!0)):VTe(e,r)}else e&&zTe(t,e)},Z6e=(t,e,i)=>{const{vnode:r,slots:s}=t;let n=!0,o=En;if(r.shapeFlag&32){const a=e._;a?i&&a===1?n=!1:BTe(s,e,i):(n=!e.$stable,VTe(e,s)),o=e}else e&&(zTe(t,e),o={default:1});if(n)for(const a in s)!UTe(a)&&o[a]==null&&delete s[a]};function aZ(t,e,i,r,s=!1){if(Xi(t)){t.forEach((f,m)=>aZ(f,e&&(Xi(e)?e[m]:e),i,r,s));return}if(xk(r)&&!s)return;const n=r.shapeFlag&4?lG(r.component):r.el,o=s?null:n,{i:a,r:l}=t,c=e&&e.r,u=a.refs===En?a.refs={}:a.refs,d=a.setupState;if(c!=null&&c!==l&&(vl(c)?(u[c]=null,zr(d,c)&&(d[c]=null)):Zh(c)&&(c.value=null)),sr(l))mb(l,a,12,[o,u]);else{const f=vl(l),m=Zh(l);if(f||m){const g=()=>{if(t.f){const y=f?zr(d,l)?d[l]:u[l]:l.value;s?Xi(y)&&Uie(y,n):Xi(y)?y.includes(n)||y.push(n):f?(u[l]=[n],zr(d,l)&&(d[l]=u[l])):(l.value=[n],t.k&&(u[t.k]=l.value))}else f?(u[l]=o,zr(d,l)&&(d[l]=o)):m&&(l.value=o,t.k&&(u[t.k]=o))};o?(g.id=-1,bu(g,i)):g()}}}const Y6e=Symbol("_vte"),X6e=t=>t.__isTeleport,bu=h8e;function J6e(t){return Q6e(t)}function Q6e(t,e){const i=aTe();i.__VUE__=!0;const{insert:r,remove:s,patchProp:n,createElement:o,createText:a,createComment:l,setText:c,setElementText:u,parentNode:d,nextSibling:f,setScopeId:m=tp,insertStaticContent:g}=t,y=(Y,ie,se,Ae=null,ce=null,me=null,Me=void 0,Oe=null,be=!!ie.dynamicChildren)=>{if(Y===ie)return;Y&&!YO(Y,ie)&&(Ae=ut(Y),ee(Y,ce,me,!0),Y=null),ie.patchFlag===-2&&(be=!1,ie.dynamicChildren=null);const{type:xe,ref:_e,shapeFlag:Le}=ie;switch(xe){case oG:v(Y,ie,se,Ae);break;case wL:b(Y,ie,se,Ae);break;case nH:Y==null&&w(ie,se,Ae,Me);break;case Mg:V(Y,ie,se,Ae,ce,me,Me,Oe,be);break;default:Le&1?E(Y,ie,se,Ae,ce,me,Me,Oe,be):Le&6?X(Y,ie,se,Ae,ce,me,Me,Oe,be):(Le&64||Le&128)&&xe.process(Y,ie,se,Ae,ce,me,Me,Oe,be,it)}_e!=null&&ce&&aZ(_e,Y&&Y.ref,me,ie||Y,!ie)},v=(Y,ie,se,Ae)=>{if(Y==null)r(ie.el=a(ie.children),se,Ae);else{const ce=ie.el=Y.el;ie.children!==Y.children&&c(ce,ie.children)}},b=(Y,ie,se,Ae)=>{Y==null?r(ie.el=l(ie.children||""),se,Ae):ie.el=Y.el},w=(Y,ie,se,Ae)=>{[Y.el,Y.anchor]=g(Y.children,ie,se,Ae,Y.el,Y.anchor)},x=({el:Y,anchor:ie},se,Ae)=>{let ce;for(;Y&&Y!==ie;)ce=f(Y),r(Y,se,Ae),Y=ce;r(ie,se,Ae)},T=({el:Y,anchor:ie})=>{let se;for(;Y&&Y!==ie;)se=f(Y),s(Y),Y=se;s(ie)},E=(Y,ie,se,Ae,ce,me,Me,Oe,be)=>{ie.type==="svg"?Me="svg":ie.type==="math"&&(Me="mathml"),Y==null?M(ie,se,Ae,ce,me,Me,Oe,be):U(Y,ie,ce,me,Me,Oe,be)},M=(Y,ie,se,Ae,ce,me,Me,Oe)=>{let be,xe;const{props:_e,shapeFlag:Le,transition:Fe,dirs:lt}=Y;if(be=Y.el=o(Y.type,me,_e&&_e.is,_e),Le&8?u(be,Y.children):Le&16&&D(Y.children,be,null,Ae,ce,iH(Y,me),Me,Oe),lt&&Uw(Y,null,Ae,"created"),O(be,Y,Y.scopeId,Me,Ae),_e){for(const Vt in _e)Vt!=="value"&&!f3(Vt)&&n(be,Vt,null,_e[Vt],me,Ae);"value"in _e&&n(be,"value",null,_e.value,me),(xe=_e.onVnodeBeforeMount)&&wm(xe,Ae,Y)}lt&&Uw(Y,null,Ae,"beforeMount");const ct=K6e(ce,Fe);ct&&Fe.beforeEnter(be),r(be,ie,se),((xe=_e&&_e.onVnodeMounted)||ct||lt)&&bu(()=>{xe&&wm(xe,Ae,Y),ct&&Fe.enter(be),lt&&Uw(Y,null,Ae,"mounted")},ce)},O=(Y,ie,se,Ae,ce)=>{if(se&&m(Y,se),Ae)for(let me=0;me<Ae.length;me++)m(Y,Ae[me]);if(ce){let me=ce.subTree;if(ie===me){const Me=ce.vnode;O(Y,Me,Me.scopeId,Me.slotScopeIds,ce.parent)}}},D=(Y,ie,se,Ae,ce,me,Me,Oe,be=0)=>{for(let xe=be;xe<Y.length;xe++){const _e=Y[xe]=Oe?$1(Y[xe]):Ag(Y[xe]);y(null,_e,ie,se,Ae,ce,me,Me,Oe)}},U=(Y,ie,se,Ae,ce,me,Me)=>{const Oe=ie.el=Y.el;let{patchFlag:be,dynamicChildren:xe,dirs:_e}=ie;be|=Y.patchFlag&16;const Le=Y.props||En,Fe=ie.props||En;let lt;if(se&&Vw(se,!1),(lt=Fe.onVnodeBeforeUpdate)&&wm(lt,se,ie,Y),_e&&Uw(ie,Y,se,"beforeUpdate"),se&&Vw(se,!0),(Le.innerHTML&&Fe.innerHTML==null||Le.textContent&&Fe.textContent==null)&&u(Oe,""),xe?k(Y.dynamicChildren,xe,Oe,se,Ae,iH(ie,ce),me):Me||N(Y,ie,Oe,null,se,Ae,iH(ie,ce),me,!1),be>0){if(be&16)H(Oe,Le,Fe,se,ce);else if(be&2&&Le.class!==Fe.class&&n(Oe,"class",null,Fe.class,ce),be&4&&n(Oe,"style",Le.style,Fe.style,ce),be&8){const ct=ie.dynamicProps;for(let Vt=0;Vt<ct.length;Vt++){const Mt=ct[Vt],Zt=Le[Mt],Xt=Fe[Mt];(Xt!==Zt||Mt==="value")&&n(Oe,Mt,Zt,Xt,ce,se)}}be&1&&Y.children!==ie.children&&u(Oe,ie.children)}else!Me&&xe==null&&H(Oe,Le,Fe,se,ce);((lt=Fe.onVnodeUpdated)||_e)&&bu(()=>{lt&&wm(lt,se,ie,Y),_e&&Uw(ie,Y,se,"updated")},Ae)},k=(Y,ie,se,Ae,ce,me,Me)=>{for(let Oe=0;Oe<ie.length;Oe++){const be=Y[Oe],xe=ie[Oe],_e=be.el&&(be.type===Mg||!YO(be,xe)||be.shapeFlag&70)?d(be.el):se;y(be,xe,_e,null,Ae,ce,me,Me,!0)}},H=(Y,ie,se,Ae,ce)=>{if(ie!==se){if(ie!==En)for(const me in ie)!f3(me)&&!(me in se)&&n(Y,me,ie[me],null,ce,Ae);for(const me in se){if(f3(me))continue;const Me=se[me],Oe=ie[me];Me!==Oe&&me!=="value"&&n(Y,me,Oe,Me,ce,Ae)}"value"in se&&n(Y,"value",ie.value,se.value,ce)}},V=(Y,ie,se,Ae,ce,me,Me,Oe,be)=>{const xe=ie.el=Y?Y.el:a(""),_e=ie.anchor=Y?Y.anchor:a("");let{patchFlag:Le,dynamicChildren:Fe,slotScopeIds:lt}=ie;lt&&(Oe=Oe?Oe.concat(lt):lt),Y==null?(r(xe,se,Ae),r(_e,se,Ae),D(ie.children||[],se,_e,ce,me,Me,Oe,be)):Le>0&&Le&64&&Fe&&Y.dynamicChildren?(k(Y.dynamicChildren,Fe,se,ce,me,Me,Oe),(ie.key!=null||ce&&ie===ce.subTree)&&jTe(Y,ie,!0)):N(Y,ie,se,_e,ce,me,Me,Oe,be)},X=(Y,ie,se,Ae,ce,me,Me,Oe,be)=>{ie.slotScopeIds=Oe,Y==null?ie.shapeFlag&512?ce.ctx.activate(ie,se,Ae,Me,be):q(ie,se,Ae,ce,me,Me,be):Z(Y,ie,be)},q=(Y,ie,se,Ae,ce,me,Me)=>{const Oe=Y.component=T8e(Y,Ae,ce);if(PTe(Y)&&(Oe.ctx.renderer=it),S8e(Oe,!1,Me),Oe.asyncDep){if(ce&&ce.registerDep(Oe,ye,Me),!Y.el){const be=Oe.subTree=xS(wL);b(null,be,ie,se)}}else ye(Oe,Y,ie,se,ce,me,Me)},Z=(Y,ie,se)=>{const Ae=ie.component=Y.component;if(l8e(Y,ie,se))if(Ae.asyncDep&&!Ae.asyncResolved){L(Ae,ie,se);return}else Ae.next=ie,m6e(Ae.update),Ae.effect.dirty=!0,Ae.update();else ie.el=Y.el,Ae.vnode=ie},ye=(Y,ie,se,Ae,ce,me,Me)=>{const Oe=()=>{if(Y.isMounted){let{next:_e,bu:Le,u:Fe,parent:lt,vnode:ct}=Y;{const vi=GTe(Y);if(vi){_e&&(_e.el=ct.el,L(Y,_e,Me)),vi.asyncDep.then(()=>{Y.isUnmounted||Oe()});return}}let Vt=_e,Mt;Vw(Y,!1),_e?(_e.el=ct.el,L(Y,_e,Me)):_e=ct,Le&&K8(Le),(Mt=_e.props&&_e.props.onVnodeBeforeUpdate)&&wm(Mt,lt,_e,ct),Vw(Y,!0);const Zt=sH(Y),Xt=Y.subTree;Y.subTree=Zt,y(Xt,Zt,d(Xt.el),ut(Xt),Y,ce,me),_e.el=Zt.el,Vt===null&&c8e(Y,Zt.el),Fe&&bu(Fe,ce),(Mt=_e.props&&_e.props.onVnodeUpdated)&&bu(()=>wm(Mt,lt,_e,ct),ce)}else{let _e;const{el:Le,props:Fe}=ie,{bm:lt,m:ct,parent:Vt}=Y,Mt=xk(ie);if(Vw(Y,!1),lt&&K8(lt),!Mt&&(_e=Fe&&Fe.onVnodeBeforeMount)&&wm(_e,Vt,ie),Vw(Y,!0),Le&&li){const Zt=()=>{Y.subTree=sH(Y),li(Le,Y.subTree,Y,ce,null)};Mt?ie.type.__asyncLoader().then(()=>!Y.isUnmounted&&Zt()):Zt()}else{const Zt=Y.subTree=sH(Y);y(null,Zt,se,Ae,Y,ce,me),ie.el=Zt.el}if(ct&&bu(ct,ce),!Mt&&(_e=Fe&&Fe.onVnodeMounted)){const Zt=ie;bu(()=>wm(_e,Vt,Zt),ce)}(ie.shapeFlag&256||Vt&&xk(Vt.vnode)&&Vt.vnode.shapeFlag&256)&&Y.a&&bu(Y.a,ce),Y.isMounted=!0,ie=se=Ae=null}},be=Y.effect=new Bie(Oe,tp,()=>Qie(xe),Y.scope),xe=Y.update=()=>{be.dirty&&be.run()};xe.i=Y,xe.id=Y.uid,Vw(Y,!0),xe()},L=(Y,ie,se)=>{ie.component=Y;const Ae=Y.vnode.props;Y.vnode=ie,Y.next=null,G6e(Y,ie.props,Ae,se),Z6e(Y,ie.children,se),hw(),Vce(Y),dw()},N=(Y,ie,se,Ae,ce,me,Me,Oe,be=!1)=>{const xe=Y&&Y.children,_e=Y?Y.shapeFlag:0,Le=ie.children,{patchFlag:Fe,shapeFlag:lt}=ie;if(Fe>0){if(Fe&128){W(xe,Le,se,Ae,ce,me,Me,Oe,be);return}else if(Fe&256){z(xe,Le,se,Ae,ce,me,Me,Oe,be);return}}lt&8?(_e&16&&Ge(xe,ce,me),Le!==xe&&u(se,Le)):_e&16?lt&16?W(xe,Le,se,Ae,ce,me,Me,Oe,be):Ge(xe,ce,me,!0):(_e&8&&u(se,""),lt&16&&D(Le,se,Ae,ce,me,Me,Oe,be))},z=(Y,ie,se,Ae,ce,me,Me,Oe,be)=>{Y=Y||pA,ie=ie||pA;const xe=Y.length,_e=ie.length,Le=Math.min(xe,_e);let Fe;for(Fe=0;Fe<Le;Fe++){const lt=ie[Fe]=be?$1(ie[Fe]):Ag(ie[Fe]);y(Y[Fe],lt,se,null,ce,me,Me,Oe,be)}xe>_e?Ge(Y,ce,me,!0,!1,Le):D(ie,se,Ae,ce,me,Me,Oe,be,Le)},W=(Y,ie,se,Ae,ce,me,Me,Oe,be)=>{let xe=0;const _e=ie.length;let Le=Y.length-1,Fe=_e-1;for(;xe<=Le&&xe<=Fe;){const lt=Y[xe],ct=ie[xe]=be?$1(ie[xe]):Ag(ie[xe]);if(YO(lt,ct))y(lt,ct,se,null,ce,me,Me,Oe,be);else break;xe++}for(;xe<=Le&&xe<=Fe;){const lt=Y[Le],ct=ie[Fe]=be?$1(ie[Fe]):Ag(ie[Fe]);if(YO(lt,ct))y(lt,ct,se,null,ce,me,Me,Oe,be);else break;Le--,Fe--}if(xe>Le){if(xe<=Fe){const lt=Fe+1,ct=lt<_e?ie[lt].el:Ae;for(;xe<=Fe;)y(null,ie[xe]=be?$1(ie[xe]):Ag(ie[xe]),se,ct,ce,me,Me,Oe,be),xe++}}else if(xe>Fe)for(;xe<=Le;)ee(Y[xe],ce,me,!0),xe++;else{const lt=xe,ct=xe,Vt=new Map;for(xe=ct;xe<=Fe;xe++){const jt=ie[xe]=be?$1(ie[xe]):Ag(ie[xe]);jt.key!=null&&Vt.set(jt.key,xe)}let Mt,Zt=0;const Xt=Fe-ct+1;let vi=!1,xi=0;const Ni=new Array(Xt);for(xe=0;xe<Xt;xe++)Ni[xe]=0;for(xe=lt;xe<=Le;xe++){const jt=Y[xe];if(Zt>=Xt){ee(jt,ce,me,!0);continue}let ti;if(jt.key!=null)ti=Vt.get(jt.key);else for(Mt=ct;Mt<=Fe;Mt++)if(Ni[Mt-ct]===0&&YO(jt,ie[Mt])){ti=Mt;break}ti===void 0?ee(jt,ce,me,!0):(Ni[ti-ct]=xe+1,ti>=xi?xi=ti:vi=!0,y(jt,ie[ti],se,null,ce,me,Me,Oe,be),Zt++)}const Nt=vi?e8e(Ni):pA;for(Mt=Nt.length-1,xe=Xt-1;xe>=0;xe--){const jt=ct+xe,ti=ie[jt],gr=jt+1<_e?ie[jt+1].el:Ae;Ni[xe]===0?y(null,ti,se,gr,ce,me,Me,Oe,be):vi&&(Mt<0||xe!==Nt[Mt]?J(ti,se,gr,2):Mt--)}}},J=(Y,ie,se,Ae,ce=null)=>{const{el:me,type:Me,transition:Oe,children:be,shapeFlag:xe}=Y;if(xe&6){J(Y.component.subTree,ie,se,Ae);return}if(xe&128){Y.suspense.move(ie,se,Ae);return}if(xe&64){Me.move(Y,ie,se,it);return}if(Me===Mg){r(me,ie,se);for(let Le=0;Le<be.length;Le++)J(be[Le],ie,se,Ae);r(Y.anchor,ie,se);return}if(Me===nH){x(Y,ie,se);return}if(Ae!==2&&xe&1&&Oe)if(Ae===0)Oe.beforeEnter(me),r(me,ie,se),bu(()=>Oe.enter(me),ce);else{const{leave:Le,delayLeave:Fe,afterLeave:lt}=Oe,ct=()=>r(me,ie,se),Vt=()=>{Le(me,()=>{ct(),lt&&lt()})};Fe?Fe(me,ct,Vt):Vt()}else r(me,ie,se)},ee=(Y,ie,se,Ae=!1,ce=!1)=>{const{type:me,props:Me,ref:Oe,children:be,dynamicChildren:xe,shapeFlag:_e,patchFlag:Le,dirs:Fe,cacheIndex:lt}=Y;if(Le===-2&&(ce=!1),Oe!=null&&aZ(Oe,null,se,Y,!0),lt!=null&&(ie.renderCache[lt]=void 0),_e&256){ie.ctx.deactivate(Y);return}const ct=_e&1&&Fe,Vt=!xk(Y);let Mt;if(Vt&&(Mt=Me&&Me.onVnodeBeforeUnmount)&&wm(Mt,ie,Y),_e&6)Ie(Y.component,se,Ae);else{if(_e&128){Y.suspense.unmount(se,Ae);return}ct&&Uw(Y,null,ie,"beforeUnmount"),_e&64?Y.type.remove(Y,ie,se,it,Ae):xe&&!xe.hasOnce&&(me!==Mg||Le>0&&Le&64)?Ge(xe,ie,se,!1,!0):(me===Mg&&Le&384||!ce&&_e&16)&&Ge(be,ie,se),Ae&&ae(Y)}(Vt&&(Mt=Me&&Me.onVnodeUnmounted)||ct)&&bu(()=>{Mt&&wm(Mt,ie,Y),ct&&Uw(Y,null,ie,"unmounted")},se)},ae=Y=>{const{type:ie,el:se,anchor:Ae,transition:ce}=Y;if(ie===Mg){we(se,Ae);return}if(ie===nH){T(Y);return}const me=()=>{s(se),ce&&!ce.persisted&&ce.afterLeave&&ce.afterLeave()};if(Y.shapeFlag&1&&ce&&!ce.persisted){const{leave:Me,delayLeave:Oe}=ce,be=()=>Me(se,me);Oe?Oe(Y.el,me,be):be()}else me()},we=(Y,ie)=>{let se;for(;Y!==ie;)se=f(Y),s(Y),Y=se;s(ie)},Ie=(Y,ie,se)=>{const{bum:Ae,scope:ce,update:me,subTree:Me,um:Oe,m:be,a:xe}=Y;qce(be),qce(xe),Ae&&K8(Ae),ce.stop(),me&&(me.active=!1,ee(Me,Y,ie,se)),Oe&&bu(Oe,ie),bu(()=>{Y.isUnmounted=!0},ie),ie&&ie.pendingBranch&&!ie.isUnmounted&&Y.asyncDep&&!Y.asyncResolved&&Y.suspenseId===ie.pendingId&&(ie.deps--,ie.deps===0&&ie.resolve())},Ge=(Y,ie,se,Ae=!1,ce=!1,me=0)=>{for(let Me=me;Me<Y.length;Me++)ee(Y[Me],ie,se,Ae,ce)},ut=Y=>{if(Y.shapeFlag&6)return ut(Y.component.subTree);if(Y.shapeFlag&128)return Y.suspense.next();const ie=f(Y.anchor||Y.el),se=ie&&ie[Y6e];return se?f(se):ie};let ot=!1;const at=(Y,ie,se)=>{Y==null?ie._vnode&&ee(ie._vnode,null,null,!0):y(ie._vnode||null,Y,ie,null,null,null,se),ie._vnode=Y,ot||(ot=!0,Vce(),CTe(),ot=!1)},it={p:y,um:ee,m:J,r:ae,mt:q,mc:D,pc:N,pbc:k,n:ut,o:t};let st,li;return{render:at,hydrate:st,createApp:z6e(at,st)}}function iH({type:t,props:e},i){return i==="svg"&&t==="foreignObject"||i==="mathml"&&t==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:i}function Vw({effect:t,update:e},i){t.allowRecurse=e.allowRecurse=i}function K6e(t,e){return(!t||t&&!t.pendingBranch)&&e&&!e.persisted}function jTe(t,e,i=!1){const r=t.children,s=e.children;if(Xi(r)&&Xi(s))for(let n=0;n<r.length;n++){const o=r[n];let a=s[n];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[n]=$1(s[n]),a.el=o.el),!i&&a.patchFlag!==-2&&jTe(o,a)),a.type===oG&&(a.el=o.el)}}function e8e(t){const e=t.slice(),i=[0];let r,s,n,o,a;const l=t.length;for(r=0;r<l;r++){const c=t[r];if(c!==0){if(s=i[i.length-1],t[s]<c){e[r]=s,i.push(r);continue}for(n=0,o=i.length-1;n<o;)a=n+o>>1,t[i[a]]<c?n=a+1:o=a;c<t[i[n]]&&(n>0&&(e[r]=i[n-1]),i[n]=r)}}for(n=i.length,o=i[n-1];n-- >0;)i[n]=o,o=e[o];return i}function GTe(t){const e=t.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:GTe(e)}function qce(t){if(t)for(let e=0;e<t.length;e++)t[e].active=!1}const t8e=Symbol.for("v-scx"),i8e=()=>Tk(t8e),KN={};function rH(t,e,i){return HTe(t,e,i)}function HTe(t,e,{immediate:i,deep:r,flush:s,once:n,onTrack:o,onTrigger:a}=En){if(e&&n){const M=e;e=(...O)=>{M(...O),E()}}const l=jc,c=M=>r===!0?M:H1(M,r===!1?1:void 0);let u,d=!1,f=!1;if(Zh(t)?(u=()=>t.value,d=_L(t)):m3(t)?(u=()=>c(t),d=!0):Xi(t)?(f=!0,d=t.some(M=>m3(M)||_L(M)),u=()=>t.map(M=>{if(Zh(M))return M.value;if(m3(M))return c(M);if(sr(M))return mb(M,l,2)})):sr(t)?e?u=()=>mb(t,l,2):u=()=>(m&&m(),Jf(t,l,3,[g])):u=tp,e&&r){const M=u;u=()=>H1(M())}let m,g=M=>{m=x.onStop=()=>{mb(M,l,4),m=x.onStop=void 0}},y;if(aG)if(g=tp,e?i&&Jf(e,l,3,[u(),f?[]:void 0,g]):u(),s==="sync"){const M=i8e();y=M.__watcherHandles||(M.__watcherHandles=[])}else return tp;let v=f?new Array(t.length).fill(KN):KN;const b=()=>{if(!(!x.active||!x.dirty))if(e){const M=x.run();(r||d||(f?M.some((O,D)=>XS(O,v[D])):XS(M,v)))&&(m&&m(),Jf(e,l,3,[M,v===KN?void 0:f&&v[0]===KN?[]:v,g]),v=M)}else x.run()};b.allowRecurse=!!e;let w;s==="sync"?w=b:s==="post"?w=()=>bu(b,l&&l.suspense):(b.pre=!0,l&&(b.id=l.uid),w=()=>Qie(b));const x=new Bie(u,tp,w),T=VGe(),E=()=>{x.stop(),T&&Uie(T.effects,x)};return e?i?b():v=x.run():s==="post"?bu(x.run.bind(x),l&&l.suspense):x.run(),y&&y.push(E),E}function r8e(t,e,i){const r=this.proxy,s=vl(t)?t.includes(".")?qTe(r,t):()=>r[t]:t.bind(r,r);let n;sr(e)?n=e:(n=e.handler,i=e);const o=PD(this),a=HTe(s,n.bind(r),i);return o(),a}function qTe(t,e){const i=e.split(".");return()=>{let r=t;for(let s=0;s<i.length&&r;s++)r=r[i[s]];return r}}function H1(t,e=1/0,i){if(e<=0||!Ho(t)||t.__v_skip||(i=i||new Set,i.has(t)))return t;if(i.add(t),e--,Zh(t))H1(t.value,e,i);else if(Xi(t))for(let r=0;r<t.length;r++)H1(t[r],e,i);else if(EGe(t)||p3(t))t.forEach(r=>{H1(r,e,i)});else if(AGe(t)){for(const r in t)H1(t[r],e,i);for(const r of Object.getOwnPropertySymbols(t))Object.prototype.propertyIsEnumerable.call(t,r)&&H1(t[r],e,i)}return t}const s8e=(t,e)=>e==="modelValue"||e==="model-value"?t.modelModifiers:t[`${e}Modifiers`]||t[`${YS(e)}Modifiers`]||t[`${L2(e)}Modifiers`];function n8e(t,e,...i){if(t.isUnmounted)return;const r=t.vnode.props||En;let s=i;const n=e.startsWith("update:"),o=n&&s8e(r,e.slice(7));o&&(o.trim&&(s=i.map(u=>vl(u)?u.trim():u)),o.number&&(s=i.map($Ge)));let a,l=r[a=Q8(e)]||r[a=Q8(YS(e))];!l&&n&&(l=r[a=Q8(L2(e))]),l&&Jf(l,t,6,s);const c=r[a+"Once"];if(c){if(!t.emitted)t.emitted={};else if(t.emitted[a])return;t.emitted[a]=!0,Jf(c,t,6,s)}}function WTe(t,e,i=!1){const r=e.emitsCache,s=r.get(t);if(s!==void 0)return s;const n=t.emits;let o={},a=!1;if(!sr(t)){const l=c=>{const u=WTe(c,e,!0);u&&(a=!0,Qc(o,u))};!i&&e.mixins.length&&e.mixins.forEach(l),t.extends&&l(t.extends),t.mixins&&t.mixins.forEach(l)}return!n&&!a?(Ho(t)&&r.set(t,null),null):(Xi(n)?n.forEach(l=>o[l]=null):Qc(o,n),Ho(t)&&r.set(t,o),o)}function nG(t,e){return!t||!Jj(e)?!1:(e=e.slice(2).replace(/Once$/,""),zr(t,e[0].toLowerCase()+e.slice(1))||zr(t,L2(e))||zr(t,e))}function sH(t){const{type:e,vnode:i,proxy:r,withProxy:s,propsOptions:[n],slots:o,attrs:a,emit:l,render:c,renderCache:u,props:d,data:f,setupState:m,ctx:g,inheritAttrs:y}=t,v=nz(t);let b,w;try{if(i.shapeFlag&4){const T=s||r,E=T;b=Ag(c.call(E,T,u,d,m,f,g)),w=a}else{const T=e;b=Ag(T.length>1?T(d,{attrs:a,slots:o,emit:l}):T(d,null)),w=e.props?a:o8e(a)}}catch(T){y3.length=0,iG(T,t,1),b=xS(wL)}let x=b;if(w&&y!==!1){const T=Object.keys(w),{shapeFlag:E}=x;T.length&&E&7&&(n&&T.some(kie)&&(w=a8e(w,n)),x=KA(x,w,!1,!0))}return i.dirs&&(x=KA(x,null,!1,!0),x.dirs=x.dirs?x.dirs.concat(i.dirs):i.dirs),i.transition&&(x.transition=i.transition),b=x,nz(v),b}const o8e=t=>{let e;for(const i in t)(i==="class"||i==="style"||Jj(i))&&((e||(e={}))[i]=t[i]);return e},a8e=(t,e)=>{const i={};for(const r in t)(!kie(r)||!(r.slice(9)in e))&&(i[r]=t[r]);return i};function l8e(t,e,i){const{props:r,children:s,component:n}=t,{props:o,children:a,patchFlag:l}=e,c=n.emitsOptions;if(e.dirs||e.transition)return!0;if(i&&l>=0){if(l&1024)return!0;if(l&16)return r?Wce(r,o,c):!!o;if(l&8){const u=e.dynamicProps;for(let d=0;d<u.length;d++){const f=u[d];if(o[f]!==r[f]&&!nG(c,f))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?Wce(r,o,c):!0:!!o;return!1}function Wce(t,e,i){const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!0;for(let s=0;s<r.length;s++){const n=r[s];if(e[n]!==t[n]&&!nG(i,n))return!0}return!1}function c8e({vnode:t,parent:e},i){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===t&&(r.el=t.el),r===t)(t=e.vnode).el=i,e=e.parent;else break}}const u8e=t=>t.__isSuspense;function h8e(t,e){e&&e.pendingBranch?Xi(t)?e.effects.push(...t):e.effects.push(t):g6e(t)}const Mg=Symbol.for("v-fgt"),oG=Symbol.for("v-txt"),wL=Symbol.for("v-cmt"),nH=Symbol.for("v-stc"),y3=[];let Nh=null;function d8e(t=!1){y3.push(Nh=t?null:[])}function p8e(){y3.pop(),Nh=y3[y3.length-1]||null}let xL=1;function Zce(t){xL+=t,t<0&&Nh&&(Nh.hasOnce=!0)}function f8e(t){return t.dynamicChildren=xL>0?Nh||pA:null,p8e(),xL>0&&Nh&&Nh.push(t),t}function m8e(t,e,i,r,s,n){return f8e(ol(t,e,i,r,s,n,!0))}function g8e(t){return t?t.__v_isVNode===!0:!1}function YO(t,e){return t.type===e.type&&t.key===e.key}const ZTe=({key:t})=>t??null,Sk=({ref:t,ref_key:e,ref_for:i})=>(typeof t=="number"&&(t=""+t),t!=null?vl(t)||Zh(t)||sr(t)?{i:ip,r:t,k:e,f:!!i}:t:null);function ol(t,e=null,i=null,r=0,s=null,n=t===Mg?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&ZTe(e),ref:e&&Sk(e),scopeId:rG,slotScopeIds:null,children:i,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:n,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:ip};return a?(tre(l,i),n&128&&t.normalize(l)):i&&(l.shapeFlag|=vl(i)?8:16),xL>0&&!o&&Nh&&(l.patchFlag>0||n&6)&&l.patchFlag!==32&&Nh.push(l),l}const xS=y8e;function y8e(t,e=null,i=null,r=0,s=null,n=!1){if((!t||t===I6e)&&(t=wL),g8e(t)){const a=KA(t,e,!0);return i&&tre(a,i),xL>0&&!n&&Nh&&(a.shapeFlag&6?Nh[Nh.indexOf(t)]=a:Nh.push(a)),a.patchFlag=-2,a}if(A8e(t)&&(t=t.__vccOpts),e){e=_8e(e);let{class:a,style:l}=e;a&&!vl(a)&&(e.class=eG(a)),Ho(l)&&(wTe(l)&&!Xi(l)&&(l=Qc({},l)),e.style=zie(l))}const o=vl(t)?1:u8e(t)?128:X6e(t)?64:Ho(t)?4:sr(t)?2:0;return ol(t,e,i,r,s,o,n,!0)}function _8e(t){return t?wTe(t)||NTe(t)?Qc({},t):t:null}function KA(t,e,i=!1,r=!1){const{props:s,ref:n,patchFlag:o,children:a,transition:l}=t,c=e?b8e(s||{},e):s,u={__v_isVNode:!0,__v_skip:!0,type:t.type,props:c,key:c&&ZTe(c),ref:e&&e.ref?i&&n?Xi(n)?n.concat(Sk(e)):[n,Sk(e)]:Sk(e):n,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:a,target:t.target,targetStart:t.targetStart,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==Mg?o===-1?16:o|16:o,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:l,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&KA(t.ssContent),ssFallback:t.ssFallback&&KA(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce};return l&&r&&ATe(u,l.clone(u)),u}function v8e(t=" ",e=0){return xS(oG,null,t,e)}function Ag(t){return t==null||typeof t=="boolean"?xS(wL):Xi(t)?xS(Mg,null,t.slice()):typeof t=="object"?$1(t):xS(oG,null,String(t))}function $1(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:KA(t)}function tre(t,e){let i=0;const{shapeFlag:r}=t;if(e==null)e=null;else if(Xi(e))i=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),tre(t,s()),s._c&&(s._d=!0));return}else{i=32;const s=e._;!s&&!NTe(e)?e._ctx=ip:s===3&&ip&&(ip.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else sr(e)?(e={default:e,_ctx:ip},i=32):(e=String(e),r&64?(i=16,e=[v8e(e)]):i=8);t.children=e,t.shapeFlag|=i}function b8e(...t){const e={};for(let i=0;i<t.length;i++){const r=t[i];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=eG([e.class,r.class]));else if(s==="style")e.style=zie([e.style,r.style]);else if(Jj(s)){const n=e[s],o=r[s];o&&n!==o&&!(Xi(n)&&n.includes(o))&&(e[s]=n?[].concat(n,o):o)}else s!==""&&(e[s]=r[s])}return e}function wm(t,e,i,r=null){Jf(t,e,7,[i,r])}const w8e=ITe();let x8e=0;function T8e(t,e,i){const r=t.type,s=(e?e.appContext:t.appContext)||w8e,n={uid:x8e++,vnode:t,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,scope:new kGe(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:kTe(r,s),emitsOptions:WTe(r,s),emit:null,emitted:null,propsDefaults:En,inheritAttrs:r.inheritAttrs,ctx:En,data:En,props:En,attrs:En,slots:En,refs:En,setupState:En,setupContext:null,suspense:i,suspenseId:i?i.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return n.ctx={_:n},n.root=e?e.root:n,n.emit=n8e.bind(null,n),t.ce&&t.ce(n),n}let jc=null,az,lZ;{const t=aTe(),e=(i,r)=>{let s;return(s=t[i])||(s=t[i]=[]),s.push(r),n=>{s.length>1?s.forEach(o=>o(n)):s[0](n)}};az=e("__VUE_INSTANCE_SETTERS__",i=>jc=i),lZ=e("__VUE_SSR_SETTERS__",i=>aG=i)}const PD=t=>{const e=jc;return az(t),t.scope.on(),()=>{t.scope.off(),az(e)}},Yce=()=>{jc&&jc.scope.off(),az(null)};function YTe(t){return t.vnode.shapeFlag&4}let aG=!1;function S8e(t,e=!1,i=!1){e&&lZ(e);const{props:r,children:s}=t.vnode,n=YTe(t);j6e(t,r,n,e),W6e(t,s,i);const o=n?E8e(t,e):void 0;return e&&lZ(!1),o}function E8e(t,e){const i=t.type;t.accessCache=Object.create(null),t.proxy=new Proxy(t.ctx,L6e);const{setup:r}=i;if(r){const s=t.setupContext=r.length>1?M8e(t):null,n=PD(t);hw();const o=mb(r,t,0,[t.props,s]);if(dw(),n(),sTe(o)){if(o.then(Yce,Yce),e)return o.then(a=>{Xce(t,a,e)}).catch(a=>{iG(a,t,0)});t.asyncDep=o}else Xce(t,o,e)}else XTe(t,e)}function Xce(t,e,i){sr(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:Ho(e)&&(t.setupState=TTe(e)),XTe(t,i)}let Jce;function XTe(t,e,i){const r=t.type;if(!t.render){if(!e&&Jce&&!r.render){const s=r.template||Kie(t).template;if(s){const{isCustomElement:n,compilerOptions:o}=t.appContext.config,{delimiters:a,compilerOptions:l}=r,c=Qc(Qc({isCustomElement:n,delimiters:a},o),l);r.render=Jce(s,c)}}t.render=r.render||tp}{const s=PD(t);hw();try{D6e(t)}finally{dw(),s()}}}const C8e={get(t,e){return Gu(t,"get",""),t[e]}};function M8e(t){const e=i=>{t.exposed=i||{}};return{attrs:new Proxy(t.attrs,C8e),slots:t.slots,emit:t.emit,expose:e}}function lG(t){return t.exposed?t.exposeProxy||(t.exposeProxy=new Proxy(TTe(a6e(t.exposed)),{get(e,i){if(i in e)return e[i];if(i in g3)return g3[i](t)},has(e,i){return i in e||i in g3}})):t.proxy}function A8e(t){return sr(t)&&"__vccOpts"in t}const P8e=(t,e)=>l6e(t,e,aG),O8e="3.4.38";/**
* @vue/runtime-dom v3.4.38
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const $8e="http://www.w3.org/2000/svg",R8e="http://www.w3.org/1998/Math/MathML",z0=typeof document<"u"?document:null,Qce=z0&&z0.createElement("template"),I8e={insert:(t,e,i)=>{e.insertBefore(t,i||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,i,r)=>{const s=e==="svg"?z0.createElementNS($8e,t):e==="mathml"?z0.createElementNS(R8e,t):i?z0.createElement(t,{is:i}):z0.createElement(t);return t==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:t=>z0.createTextNode(t),createComment:t=>z0.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>z0.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,i,r,s,n){const o=i?i.previousSibling:e.lastChild;if(s&&(s===n||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),i),!(s===n||!(s=s.nextSibling)););else{Qce.innerHTML=r==="svg"?`<svg>${t}</svg>`:r==="mathml"?`<math>${t}</math>`:t;const a=Qce.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,i)}return[o?o.nextSibling:e.firstChild,i?i.previousSibling:e.lastChild]}},L8e=Symbol("_vtc");function D8e(t,e,i){const r=t[L8e];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?t.removeAttribute("class"):i?t.setAttribute("class",e):t.className=e}const lz=Symbol("_vod"),JTe=Symbol("_vsh"),Hy={beforeMount(t,{value:e},{transition:i}){t[lz]=t.style.display==="none"?"":t.style.display,i&&e?i.beforeEnter(t):XO(t,e)},mounted(t,{value:e},{transition:i}){i&&e&&i.enter(t)},updated(t,{value:e,oldValue:i},{transition:r}){!e!=!i&&(r?e?(r.beforeEnter(t),XO(t,!0),r.enter(t)):r.leave(t,()=>{XO(t,!1)}):XO(t,e))},beforeUnmount(t,{value:e}){XO(t,e)}};function XO(t,e){t.style.display=e?t[lz]:"none",t[JTe]=!e}const N8e=Symbol(""),F8e=/(^|;)\s*display\s*:/;function k8e(t,e,i){const r=t.style,s=vl(i);let n=!1;if(i&&!s){if(e)if(vl(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();i[a]==null&&Ek(r,a,"")}else for(const o in e)i[o]==null&&Ek(r,o,"");for(const o in i)o==="display"&&(n=!0),Ek(r,o,i[o])}else if(s){if(e!==i){const o=r[N8e];o&&(i+=";"+o),r.cssText=i,n=F8e.test(i)}}else e&&t.removeAttribute("style");lz in t&&(t[lz]=n?r.display:"",t[JTe]&&(r.display="none"))}const Kce=/\s*!important$/;function Ek(t,e,i){if(Xi(i))i.forEach(r=>Ek(t,e,r));else if(i==null&&(i=""),e.startsWith("--"))t.setProperty(e,i);else{const r=U8e(t,e);Kce.test(i)?t.setProperty(L2(r),i.replace(Kce,""),"important"):t[r]=i}}const eue=["Webkit","Moz","ms"],oH={};function U8e(t,e){const i=oH[e];if(i)return i;let r=YS(e);if(r!=="filter"&&r in t)return oH[e]=r;r=nTe(r);for(let s=0;s<eue.length;s++){const n=eue[s]+r;if(n in t)return oH[e]=n}return e}const tue="http://www.w3.org/1999/xlink";function iue(t,e,i,r,s,n=FGe(e)){r&&e.startsWith("xlink:")?i==null?t.removeAttributeNS(tue,e.slice(6,e.length)):t.setAttributeNS(tue,e,i):i==null||n&&!lTe(i)?t.removeAttribute(e):t.setAttribute(e,n?"":lO(i)?String(i):i)}function V8e(t,e,i,r){if(e==="innerHTML"||e==="textContent"){if(i==null)return;t[e]=i;return}const s=t.tagName;if(e==="value"&&s!=="PROGRESS"&&!s.includes("-")){const o=s==="OPTION"?t.getAttribute("value")||"":t.value,a=i==null?"":String(i);(o!==a||!("_value"in t))&&(t.value=a),i==null&&t.removeAttribute(e),t._value=i;return}let n=!1;if(i===""||i==null){const o=typeof t[e];o==="boolean"?i=lTe(i):i==null&&o==="string"?(i="",n=!0):o==="number"&&(i=0,n=!0)}try{t[e]=i}catch{}n&&t.removeAttribute(e)}function z8e(t,e,i,r){t.addEventListener(e,i,r)}function B8e(t,e,i,r){t.removeEventListener(e,i,r)}const rue=Symbol("_vei");function j8e(t,e,i,r,s=null){const n=t[rue]||(t[rue]={}),o=n[e];if(r&&o)o.value=r;else{const[a,l]=G8e(e);if(r){const c=n[e]=W8e(r,s);z8e(t,a,c,l)}else o&&(B8e(t,a,o,l),n[e]=void 0)}}const sue=/(?:Once|Passive|Capture)$/;function G8e(t){let e;if(sue.test(t)){e={};let r;for(;r=t.match(sue);)t=t.slice(0,t.length-r[0].length),e[r[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):L2(t.slice(2)),e]}let aH=0;const H8e=Promise.resolve(),q8e=()=>aH||(H8e.then(()=>aH=0),aH=Date.now());function W8e(t,e){const i=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=i.attached)return;Jf(Z8e(r,i.value),e,5,[r])};return i.value=t,i.attached=q8e(),i}function Z8e(t,e){if(Xi(e)){const i=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{i.call(t),t._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const nue=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123,Y8e=(t,e,i,r,s,n)=>{const o=s==="svg";e==="class"?D8e(t,r,o):e==="style"?k8e(t,i,r):Jj(e)?kie(e)||j8e(t,e,i,r,n):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):X8e(t,e,r,o))?(V8e(t,e,r),!t.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&iue(t,e,r,o,n,e!=="value")):(e==="true-value"?t._trueValue=r:e==="false-value"&&(t._falseValue=r),iue(t,e,r,o))};function X8e(t,e,i,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in t&&nue(e)&&sr(i));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=t.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return nue(e)&&vl(i)?!1:e in t}const J8e=Qc({patchProp:Y8e},I8e);let oue;function Q8e(){return oue||(oue=J6e(J8e))}const K8e=(...t)=>{const e=Q8e().createApp(...t),{mount:i}=e;return e.mount=r=>{const s=tHe(r);if(!s)return;const n=e._component;!sr(n)&&!n.render&&!n.template&&(n.template=s.innerHTML),s.innerHTML="";const o=i(s,!1,eHe(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function eHe(t){if(t instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&t instanceof MathMLElement)return"mathml"}function tHe(t){return vl(t)?document.querySelector(t):t}let TS=class Px{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*Px._m}getInt(){return this._seed=(Px._a*this._seed+Px._c)%Px._m,this._seed}getFloat(){return this.getInt()/(Px._m-1)}getIntRange(e,i){return Math.round(this.getFloatRange(e,i))}getFloatRange(e,i){const r=i-e;return e+this.getInt()/Px._m*r}};TS._m=2147483647,TS._a=48271,TS._c=0;const cG=1.5,iHe=1/cG,rHe=.5;function D2(t,e){return e?t.filter((i,r,s)=>s.findIndex(e.bind(null,i))===r):Array.from(new Set(t))}function Lb(t,e,i){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function QTe(t,e){let i=t.length!==e.length;i&&(t.length=e.length);for(let r=0;r<e.length;++r)t[r]!==e[r]&&(t[r]=e[r],i=!0);return i}function cZ(t,e,i){let r,s;return i?(r=e.filter(n=>!t.some(o=>i(o,n))),s=t.filter(n=>!e.some(o=>i(o,n)))):(r=e.filter(n=>!t.includes(n)),s=t.filter(n=>!e.includes(n))),{added:r,removed:s}}function sHe(t){return t&&typeof t.length=="number"}function s7t(t,e){const i=t.length;if(i===0)return[];const r=[];for(let s=0;s<i;s+=e)r.push(t.slice(s,s+e));return r}function n7t(t,e,i){const r=t.length;let s=0,n=r-1;for(;s<n;){const a=s+Math.floor((n-s)/2);e>t[a]?s=a+1:n=a}const o=t[s];return i?e>=t[r-1]?-1:o===e?s:s-1:o===e?s:-1}let KTe=class{constructor(){this.last=0}};const eSe=new KTe;function uZ(t,e,i,r){r=r||eSe;const s=Math.max(0,r.last-10);for(let o=s;o<i;++o)if(t[o]===e)return r.last=o,o;const n=Math.min(s,i);for(let o=0;o<n;++o)if(t[o]===e)return r.last=o,o;return-1}function TL(t,e,i,r){const s=t.length,n=uZ(t,e,s,r);if(n!==-1)return t[n]=t[s-1],t.pop(),e}const Op=new Set;function nHe(t,e,i=t.length,r=e.length,s,n){if(r===0||i===0)return i;Op.clear();for(let a=0;a<r;++a)Op.add(e[a]);s=s||eSe;const o=Math.max(0,s.last-10);for(let a=o;a<i;++a)if(Op.has(t[a])&&(n==null||n.push(t[a]),Op.delete(t[a]),t[a]=t[i-1],--i,--a,Op.size===0||i===0))return Op.clear(),i;for(let a=0;a<o;++a)if(Op.has(t[a])&&(n==null||n.push(t[a]),Op.delete(t[a]),t[a]=t[i-1],--i,--a,Op.size===0||i===0))return Op.clear(),i;return Op.clear(),i}function oHe(t,e){let i=0;for(let r=0;r<t.length;++r){const s=t[r];e(s,r)&&(t[i]=s,i++)}t.length=i}function aHe(t){return aue.seed=t,()=>aue.getFloat()}function a7t(t,e){const i=aHe(e);for(let r=t.length-1;r>0;r--){const s=Math.floor(i()*(r+1)),n=t[r];t[r]=t[s],t[s]=n}return t}const aue=new TS;function tSe(t,e){const i=t.indexOf(e);return i!==-1?(t.splice(i,1),e):null}function l7t(t,e){const i=new Map,r=t.length;for(let s=0;s<r;s++){const n=t[s],o=e(n,s,t),a=i.get(o);a?a.push(n):i.set(o,[n])}return i}function sd(t,e){return t!=null}const lHe=[];function iSe(t){return 32+t.length}function ire(){return 16}function rSe(t){if(!t)return 0;let e=oSe;for(const i in t)if(t.hasOwnProperty(i)){const r=t[i];switch(typeof r){case"string":e+=iSe(r);break;case"number":e+=ire();break;case"boolean":e+=4}}return e}function sSe(t){if(!t)return 0;if(Array.isArray(t))return cHe(t);let e=oSe;for(const i in t)t.hasOwnProperty(i)&&(e+=nSe(t[i]));return e}function cHe(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let i=aSe;for(let r=0;r<e;r++)i+=nSe(t[r]);return i}function nSe(t){switch(typeof t){case"object":return sSe(t);case"string":return iSe(t);case"number":return ire();case"boolean":return 4;default:return 8}}function uHe(t,e){return aSe+t.length*e}const oSe=32,aSe=16;let ib;function ue(t){return typeof ib[t]=="function"?ib[t]=ib[t](globalThis):ib[t]}var Xxe,Jxe,Qxe,Kxe;ib=(Xxe=globalThis.dojoConfig)!=null&&Xxe.has||(Jxe=globalThis.esriConfig)!=null&&Jxe.has?{...(Qxe=globalThis.dojoConfig)==null?void 0:Qxe.has,...(Kxe=globalThis.esriConfig)==null?void 0:Kxe.has}:{},ue.add=(t,e,i,r)=>((r||ib[t]===void 0)&&(ib[t]=e),i&&ue(t)),ue.cache=ib,ue.add("big-integer-warning-enabled",!0),ue.add("esri-deprecation-warnings",!0),ue.add("esri-tests-disable-screenshots",!1),ue.add("esri-tests-use-full-window",!1),ue.add("esri-tests-post-to-influx",!0),(()=>{var e;ue.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(ue.add("host-browser",t),ue.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),ue.add("dom",t),ue("host-browser")){const i=navigator,r=i.userAgent,s=i.appVersion,n=parseFloat(s);if(ue.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),ue.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),ue.add("khtml",s.includes("Konqueror")?n:void 0),ue.add("edge",parseFloat(r.split("Edge/")[1])||void 0),ue.add("opr",parseFloat(r.split("OPR/")[1])||void 0),ue.add("webkit",!ue("wp")&&!ue("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),ue.add("chrome",!ue("edge")&&!ue("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),ue.add("android",!ue("wp")&&parseFloat(r.split("Android ")[1])||void 0),ue.add("safari",!s.includes("Safari")||ue("wp")||ue("chrome")||ue("android")||ue("edge")||ue("opr")?void 0:parseFloat(s.split("Version/")[1])),ue.add("mac",s.includes("Macintosh")),!ue("wp")&&/(iPhone|iPod|iPad)/.test(r)){const o=RegExp.$1.replace(/P/,"p"),a=/OS ([\d_]+)/.test(r)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replaceAll("_",""));ue.add(o,l),ue.add("ios",l)}ue("webkit")||(!r.includes("Gecko")||ue("wp")||ue("khtml")||ue("edge")||ue.add("mozilla",n),ue("mozilla")&&ue.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),i=/iPhone/i.test(t);e&&ue.add("esri-mobile",e),i&&ue.add("esri-iPhone",i),ue.add("esri-geolocation",!!navigator.geolocation)}ue.add("esri-wasm","WebAssembly"in globalThis),ue.add("esri-performance-mode-frames-between-render",20),ue.add("esri-force-performance-mode",!1),ue.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),ue.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),ue.add("esri-atomics","Atomics"in globalThis),ue.add("esri-workers","Worker"in globalThis),ue.add("web-feat:cache","caches"in globalThis),ue.add("esri-workers-arraybuffer-transfer",!ue("safari")||Number(ue("safari"))>=12),ue.add("workers-pool-size",8),ue.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),ue.add("featurelayer-simplify-payload-size-factors",[1,1,4]),ue.add("featurelayer-fast-triangulation-enabled",!0),ue.add("featurelayer-animation-enabled",!0),ue.add("featurelayer-snapshot-enabled",!0),ue.add("featurelayer-snapshot-point-min-threshold",8e4),ue.add("featurelayer-snapshot-point-max-threshold",4e5),ue.add("featurelayer-snapshot-point-coverage",.1),ue.add("featurelayer-query-max-depth",4),ue.add("featurelayer-query-pausing-enabled",!1),ue.add("featurelayer-advanced-symbols",!1),ue.add("featurelayer-pbf",!0),ue.add("featurelayer-pbf-statistics",!1),ue.add("feature-layers-workers",!0),ue.add("feature-polyline-generalization-factor",1),ue.add("mapview-transitions-duration",200),ue.add("mapview-essential-goto-duration",200),ue.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),ue.add("mapserver-pbf-version-support",10.81),ue.add("mapservice-popup-identify-max-tolerance",20),ue("host-webworker")||ue("host-browser")&&(ue.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),ue.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{ue.add("esri-image-decode",!0,!0,!0)}).catch(()=>{ue.add("esri-image-decode",!1,!0,!0)})}return!1}),ue.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();function lR(t){return t instanceof ArrayBuffer}function rre(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int8Array"}function rb(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8Array"}function lSe(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8ClampedArray"}function sre(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int16Array"}function uG(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint16Array"}function nre(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int32Array"}function ore(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint32Array"}function OD(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float32Array"}function $D(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float64Array"}function hy(t){return!("buffer"in t)}function Db(...t){return t.reduce((e,i)=>e+(i?hy(i)?uHe(i,ire()):i.byteLength+cSe:0),0)}const cSe=145,Yh=1024;function hHe(t){return $D(t)||OD(t)||nre(t)||sre(t)||rre(t)}function dHe(t){return $D(t)||OD(t)}function pHe(t){return $D(t)?179769e303:OD(t)?3402823e32:ore(t)?4294967295:uG(t)?65535:rb(t)||lSe(t)?255:nre(t)?2147483647:sre(t)?32767:rre(t)?127:256}function fHe(t,e){let i;for(i in t)t.hasOwnProperty(i)&&t[i]===void 0&&delete t[i];return t}function re(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=dSe(t);if(e!=null)return e;if(cz(t))return t.clone();if(uSe(t))return t.map(re);if(hSe(t))return t.clone();const i={};for(const r of Object.getOwnPropertyNames(t))i[r]=re(t[r]);return i}function hZ(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=dSe(t);if(e!=null)return e;if(uSe(t)){let i=!0;const r=t.map(s=>{const n=hZ(s);return s!=null&&n==null&&(i=!1),n});return i?r:null}if(cz(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(!hSe(t)){const i=new(Object.getPrototypeOf(t)).constructor;for(const r of Object.getOwnPropertyNames(t)){const s=t[r],n=hZ(s);if(s!=null&&n==null)return null;i[r]=n}return i}return null}function cz(t){return typeof t.clone=="function"}function uSe(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function hSe(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function lue(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function dSe(t){if(rre(t)||rb(t)||lSe(t)||sre(t)||uG(t)||nre(t)||ore(t)||OD(t)||$D(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[i,r]of t)e.set(i,re(r));return e}if(t instanceof Set){const e=new Set;for(const i of t)e.add(re(i));return e}return null}function are(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t==null?void 0:t.getTime)=="function"&&typeof(e==null?void 0:e.getTime)=="function"&&t.getTime()===e.getTime()||!1}function pSe(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&Lb(t,e):t instanceof Set?e instanceof Set&&gHe(t,e):t instanceof Map?e instanceof Map&&yHe(t,e):!!lue(t)&&lue(e)&&mHe(t,e))}function mHe(t,e){if(t===null||e===null)return!1;const i=Object.keys(t);if(e===null||Object.keys(e).length!==i.length)return!1;for(const r of i)if(t[r]!==e[r]||!Object.prototype.hasOwnProperty.call(e,r))return!1;return!0}function gHe(t,e){if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function yHe(t,e){if(t.size!==e.size)return!1;for(const[i,r]of t){const s=e.get(i);if(s!==r||s===void 0&&!e.has(i))return!1}return!0}function lre(t,e,i=!1){return mSe(t,e,i)}function RD(t,e){if(e!=null)return e[t]||fSe(t.split("."),!1,e)}function ua(t,e,i){const r=t.split("."),s=r.pop(),n=fSe(r,!0,i);n&&s&&(n[s]=e)}function cue(t,e){if(t==null&&e==null)return!1;if(t==null||e==null)return!0;if(typeof t=="object"){if(Array.isArray(t)){const i=e;if(t.length!==i.length)return!0;for(let r=0;r<t.length;r++)if(cue(t[r],i[r]))return!0;return!1}if(Object.keys(t).length!==Object.keys(e).length)return!0;for(const i in t)if(cue(t[i],e[i]))return!0;return!1}return t!==e}function fSe(t,e,i){let r=i;for(const s of t){if(r==null)return;if(!(s in r)){if(!e)return;r[s]={}}r=r[s]}return r}function mSe(t,e,i){return e?Object.keys(e).reduce((r,s)=>{let n=r[s],o=e[s];return n===o?r:n===void 0?(r[s]=re(o),r):(Array.isArray(o)||Array.isArray(r)?(n=n?Array.isArray(n)?r[s]=n.concat():r[s]=[n]:r[s]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach(a=>{n.includes(a)||n.push(a)}):r[s]=o.concat())):o&&typeof o=="object"?r[s]=mSe(n,o,i):r.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(r[s]=o),r)},t||{}):t}let Qi=class{constructor(e,i={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=i,this.apiValues=[],this.jsonValues=[],this._apiToJSON=_He(e),this.apiValues=uue(this._apiToJSON),this.jsonValues=uue(this._jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,s,n)=>{const o=this.toJSON(r);o!==void 0&&ua(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const i=this._apiToJSON[e];return this._options.useNumericKeys?+i:i}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}};function _He(t){const e={};for(const i in t)e[t[i]]=i;return e}function uue(t){const e=[];for(const i in t)e.push(i);return e.sort(),e}function lc(){return function(t,e){return new Qi(t,{ignoreUnknown:!0,...e})}}const vHe={remove:()=>{}};function Gi(t){return t?{remove(){t&&(t(),t=void 0)}}:vHe}function bHe(t){t.forEach(e=>e==null?void 0:e.remove())}function JS(t){return Gi(()=>bHe(t))}function u7t(t){return Gi(()=>{var e;return(e=t())==null?void 0:e.remove()})}function gSe(t){return Gi(t!=null?()=>t.destroy():void 0)}let ySe,_3;var eTe,tTe;const wHe=((eTe=globalThis.esriConfig)==null?void 0:eTe.locale)??((tTe=globalThis.dojoConfig)==null?void 0:tTe.locale);function _Se(){var t;return wHe??((t=globalThis.navigator)==null?void 0:t.language)??"en"}function zu(){return _3===void 0&&(_3=_Se()),_3}function xHe(t){ySe=t,bSe()}function THe(t=zu()){const e=/^([a-zA-Z]{2,3})(?:[_-]\w+)*$/.exec(t);return e==null?void 0:e[1].toLowerCase()}const Ck=[];function vSe(t){return Ck.push(t),Gi(()=>Ck.splice(Ck.indexOf(t),1))}const Mk=[];function cre(t){return Mk.push(t),Gi(()=>Mk.splice(Mk.indexOf(t),1))}function bSe(){const t=ySe??_Se();_3!==t&&([...Mk].forEach(e=>e(t)),_3=t,[...Ck].forEach(e=>e(t)))}var iTe;(iTe=globalThis.addEventListener)==null||iTe.call(globalThis,"languagechange",bSe);const hue=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Bishkek"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class N2 extends Error{}class SHe extends N2{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class EHe extends N2{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class CHe extends N2{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class PM extends N2{}class wSe extends N2{constructor(e){super(`Invalid unit ${e}`)}}class Au extends N2{}class lv extends N2{constructor(){super("Zone is an abstract class")}}const yt="numeric",sm="short",Vh="long",uz={year:yt,month:yt,day:yt},xSe={year:yt,month:sm,day:yt},MHe={year:yt,month:sm,day:yt,weekday:sm},TSe={year:yt,month:Vh,day:yt},SSe={year:yt,month:Vh,day:yt,weekday:Vh},ESe={hour:yt,minute:yt},CSe={hour:yt,minute:yt,second:yt},MSe={hour:yt,minute:yt,second:yt,timeZoneName:sm},ASe={hour:yt,minute:yt,second:yt,timeZoneName:Vh},PSe={hour:yt,minute:yt,hourCycle:"h23"},OSe={hour:yt,minute:yt,second:yt,hourCycle:"h23"},$Se={hour:yt,minute:yt,second:yt,hourCycle:"h23",timeZoneName:sm},RSe={hour:yt,minute:yt,second:yt,hourCycle:"h23",timeZoneName:Vh},ISe={year:yt,month:yt,day:yt,hour:yt,minute:yt},LSe={year:yt,month:yt,day:yt,hour:yt,minute:yt,second:yt},DSe={year:yt,month:sm,day:yt,hour:yt,minute:yt},NSe={year:yt,month:sm,day:yt,hour:yt,minute:yt,second:yt},AHe={year:yt,month:sm,day:yt,weekday:sm,hour:yt,minute:yt},FSe={year:yt,month:Vh,day:yt,hour:yt,minute:yt,timeZoneName:sm},kSe={year:yt,month:Vh,day:yt,hour:yt,minute:yt,second:yt,timeZoneName:sm},USe={year:yt,month:Vh,day:yt,weekday:Vh,hour:yt,minute:yt,timeZoneName:Vh},VSe={year:yt,month:Vh,day:yt,weekday:Vh,hour:yt,minute:yt,second:yt,timeZoneName:Vh};class cO{get type(){throw new lv}get name(){throw new lv}get ianaName(){return this.name}get isUniversal(){throw new lv}offsetName(e,i){throw new lv}formatOffset(e,i){throw new lv}offset(e){throw new lv}equals(e){throw new lv}get isValid(){throw new lv}}let lH=null;class hG extends cO{static get instance(){return lH===null&&(lH=new hG),lH}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return YSe(e,i,r)}formatOffset(e,i){return v3(this.offset(e),i)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let Ak={};function PHe(t){return Ak[t]||(Ak[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),Ak[t]}const OHe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function $He(t,e){const i=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,s,n,o,a,l,c,u]=r;return[o,s,n,a,l,c,u]}function RHe(t,e){const i=t.formatToParts(e),r=[];for(let s=0;s<i.length;s++){const{type:n,value:o}=i[s],a=OHe[n];n==="era"?r[a]=o:Ri(a)||(r[a]=parseInt(o,10))}return r}let eF={};class Xh extends cO{static create(e){return eF[e]||(eF[e]=new Xh(e)),eF[e]}static resetCache(){eF={},Ak={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=Xh.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return YSe(e,i,r,this.name)}formatOffset(e,i){return v3(this.offset(e),i)}offset(e){const i=new Date(e);if(isNaN(i))return NaN;const r=PHe(this.name);let[s,n,o,a,l,c,u]=r.formatToParts?RHe(r,i):$He(r,i);a==="BC"&&(s=-Math.abs(s)+1);const f=pG({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:u,millisecond:0});let m=+i;const g=m%1e3;return m-=g>=0?g:1e3+g,(f-m)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let due={};function IHe(t,e={}){const i=JSON.stringify([t,e]);let r=due[i];return r||(r=new Intl.ListFormat(t,e),due[i]=r),r}let dZ={};function pZ(t,e={}){const i=JSON.stringify([t,e]);let r=dZ[i];return r||(r=new Intl.DateTimeFormat(t,e),dZ[i]=r),r}let fZ={};function LHe(t,e={}){const i=JSON.stringify([t,e]);let r=fZ[i];return r||(r=new Intl.NumberFormat(t,e),fZ[i]=r),r}let mZ={};function DHe(t,e={}){const{base:i,...r}=e,s=JSON.stringify([t,r]);let n=mZ[s];return n||(n=new Intl.RelativeTimeFormat(t,e),mZ[s]=n),n}let cR=null;function NHe(){return cR||(cR=new Intl.DateTimeFormat().resolvedOptions().locale,cR)}let pue={};function FHe(t){let e=pue[t];if(!e){const i=new Intl.Locale(t);e="getWeekInfo"in i?i.getWeekInfo():i.weekInfo,pue[t]=e}return e}function kHe(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const i=t.indexOf("-u-");if(i===-1)return[t];{let r,s;try{r=pZ(t).resolvedOptions(),s=t}catch{const l=t.substring(0,i);r=pZ(l).resolvedOptions(),s=l}const{numberingSystem:n,calendar:o}=r;return[s,n,o]}}function UHe(t,e,i){return(i||e)&&(t.includes("-u-")||(t+="-u"),i&&(t+=`-ca-${i}`),e&&(t+=`-nu-${e}`)),t}function VHe(t){const e=[];for(let i=1;i<=12;i++){const r=yi.utc(2009,i,1);e.push(t(r))}return e}function zHe(t){const e=[];for(let i=1;i<=7;i++){const r=yi.utc(2016,11,13+i);e.push(t(r))}return e}function tF(t,e,i,r){const s=t.listingMode();return s==="error"?null:s==="en"?i(e):r(e)}function BHe(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class jHe{constructor(e,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:s,floor:n,...o}=r;if(!i||Object.keys(o).length>0){const a={useGrouping:!1,...r};r.padTo>0&&(a.minimumIntegerDigits=r.padTo),this.inf=LHe(e,a)}}format(e){if(this.inf){const i=this.floor?Math.floor(e):e;return this.inf.format(i)}else{const i=this.floor?Math.floor(e):pre(e,3);return No(i,this.padTo)}}}class GHe{constructor(e,i,r){this.opts=r,this.originalZone=void 0;let s;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&Xh.create(a).valid?(s=a,this.dt=e):(s="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,s=e.zone.name):(s="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const n={...this.opts};n.timeZone=n.timeZone||s,this.dtf=pZ(i,n)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(i=>{if(i.type==="timeZoneName"){const r=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...i,value:r}}else return i}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class HHe{constructor(e,i,r){this.opts={style:"long",...r},!i&&WSe()&&(this.rtf=DHe(e,r))}format(e,i){return this.rtf?this.rtf.format(e,i):hqe(i,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,i){return this.rtf?this.rtf.formatToParts(e,i):[]}}const qHe={firstDay:1,minimalDays:4,weekend:[6,7]};class As{static fromOpts(e){return As.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,i,r,s,n=!1){const o=e||co.defaultLocale,a=o||(n?"en-US":NHe()),l=i||co.defaultNumberingSystem,c=r||co.defaultOutputCalendar,u=gZ(s)||co.defaultWeekSettings;return new As(a,l,c,u,o)}static resetCache(){cR=null,dZ={},fZ={},mZ={}}static fromObject({locale:e,numberingSystem:i,outputCalendar:r,weekSettings:s}={}){return As.create(e,i,r,s)}constructor(e,i,r,s,n){const[o,a,l]=kHe(e);this.locale=o,this.numberingSystem=i||a||null,this.outputCalendar=r||l||null,this.weekSettings=s,this.intl=UHe(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=BHe(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&i?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:As.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,gZ(e.weekSettings)||this.weekSettings,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,i=!1){return tF(this,e,QSe,()=>{const r=i?{month:e,day:"numeric"}:{month:e},s=i?"format":"standalone";return this.monthsCache[s][e]||(this.monthsCache[s][e]=VHe(n=>this.extract(n,r,"month"))),this.monthsCache[s][e]})}weekdays(e,i=!1){return tF(this,e,t2e,()=>{const r=i?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},s=i?"format":"standalone";return this.weekdaysCache[s][e]||(this.weekdaysCache[s][e]=zHe(n=>this.extract(n,r,"weekday"))),this.weekdaysCache[s][e]})}meridiems(){return tF(this,void 0,()=>i2e,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[yi.utc(2016,11,13,9),yi.utc(2016,11,13,19)].map(i=>this.extract(i,e,"dayperiod"))}return this.meridiemCache})}eras(e){return tF(this,e,r2e,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[yi.utc(-40,1,1),yi.utc(2017,1,1)].map(r=>this.extract(r,i,"era"))),this.eraCache[e]})}extract(e,i,r){const s=this.dtFormatter(e,i),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===r);return o?o.value:null}numberFormatter(e={}){return new jHe(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,i={}){return new GHe(e,this.intl,i)}relFormatter(e={}){return new HHe(this.intl,this.isEnglish(),e)}listFormatter(e={}){return IHe(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:ZSe()?FHe(this.locale):qHe}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let cH=null;class yl extends cO{static get utcInstance(){return cH===null&&(cH=new yl(0)),cH}static instance(e){return e===0?yl.utcInstance:new yl(e)}static parseSpecifier(e){if(e){const i=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new yl(fG(i[1],i[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${v3(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${v3(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,i){return v3(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class WHe extends cO{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function q1(t,e){if(Ri(t)||t===null)return e;if(t instanceof cO)return t;if(XHe(t)){const i=t.toLowerCase();return i==="default"?e:i==="local"||i==="system"?hG.instance:i==="utc"||i==="gmt"?yl.utcInstance:yl.parseSpecifier(i)||Xh.create(t)}else return SS(t)?yl.instance(t):typeof t=="object"&&"offset"in t&&typeof t.offset=="function"?t:new WHe(t)}let fue=()=>Date.now(),mue="system",gue=null,yue=null,_ue=null,vue=60,bue,wue=null;class co{static get now(){return fue}static set now(e){fue=e}static set defaultZone(e){mue=e}static get defaultZone(){return q1(mue,hG.instance)}static get defaultLocale(){return gue}static set defaultLocale(e){gue=e}static get defaultNumberingSystem(){return yue}static set defaultNumberingSystem(e){yue=e}static get defaultOutputCalendar(){return _ue}static set defaultOutputCalendar(e){_ue=e}static get defaultWeekSettings(){return wue}static set defaultWeekSettings(e){wue=gZ(e)}static get twoDigitCutoffYear(){return vue}static set twoDigitCutoffYear(e){vue=e%100}static get throwOnInvalid(){return bue}static set throwOnInvalid(e){bue=e}static resetCaches(){As.resetCache(),Xh.resetCache()}}class Vf{constructor(e,i){this.reason=e,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const zSe=[0,31,59,90,120,151,181,212,243,273,304,334],BSe=[0,31,60,91,121,152,182,213,244,274,305,335];function rp(t,e){return new Vf("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function ure(t,e,i){const r=new Date(Date.UTC(t,e-1,i));t<100&&t>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const s=r.getUTCDay();return s===0?7:s}function jSe(t,e,i){return i+(ID(t)?BSe:zSe)[e-1]}function GSe(t,e){const i=ID(t)?BSe:zSe,r=i.findIndex(n=>n<e),s=e-i[r];return{month:r+1,day:s}}function hre(t,e){return(t-e+7)%7+1}function hz(t,e=4,i=1){const{year:r,month:s,day:n}=t,o=jSe(r,s,n),a=hre(ure(r,s,n),i);let l=Math.floor((o-a+14-e)/7),c;return l<1?(c=r-1,l=SL(c,e,i)):l>SL(r,e,i)?(c=r+1,l=1):c=r,{weekYear:c,weekNumber:l,weekday:a,...mG(t)}}function xue(t,e=4,i=1){const{weekYear:r,weekNumber:s,weekday:n}=t,o=hre(ure(r,1,e),i),a=gA(r);let l=s*7+n-o-7+e,c;l<1?(c=r-1,l+=gA(c)):l>a?(c=r+1,l-=gA(r)):c=r;const{month:u,day:d}=GSe(c,l);return{year:c,month:u,day:d,...mG(t)}}function uH(t){const{year:e,month:i,day:r}=t,s=jSe(e,i,r);return{year:e,ordinal:s,...mG(t)}}function Tue(t){const{year:e,ordinal:i}=t,{month:r,day:s}=GSe(e,i);return{year:e,month:r,day:s,...mG(t)}}function Sue(t,e){if(!Ri(t.localWeekday)||!Ri(t.localWeekNumber)||!Ri(t.localWeekYear)){if(!Ri(t.weekday)||!Ri(t.weekNumber)||!Ri(t.weekYear))throw new PM("Cannot mix locale-based week fields with ISO-based week fields");return Ri(t.localWeekday)||(t.weekday=t.localWeekday),Ri(t.localWeekNumber)||(t.weekNumber=t.localWeekNumber),Ri(t.localWeekYear)||(t.weekYear=t.localWeekYear),delete t.localWeekday,delete t.localWeekNumber,delete t.localWeekYear,{minDaysInFirstWeek:e.getMinDaysInFirstWeek(),startOfWeek:e.getStartOfWeek()}}else return{minDaysInFirstWeek:4,startOfWeek:1}}function ZHe(t,e=4,i=1){const r=dG(t.weekYear),s=sp(t.weekNumber,1,SL(t.weekYear,e,i)),n=sp(t.weekday,1,7);return r?s?n?!1:rp("weekday",t.weekday):rp("week",t.weekNumber):rp("weekYear",t.weekYear)}function YHe(t){const e=dG(t.year),i=sp(t.ordinal,1,gA(t.year));return e?i?!1:rp("ordinal",t.ordinal):rp("year",t.year)}function HSe(t){const e=dG(t.year),i=sp(t.month,1,12),r=sp(t.day,1,dz(t.year,t.month));return e?i?r?!1:rp("day",t.day):rp("month",t.month):rp("year",t.year)}function qSe(t){const{hour:e,minute:i,second:r,millisecond:s}=t,n=sp(e,0,23)||e===24&&i===0&&r===0&&s===0,o=sp(i,0,59),a=sp(r,0,59),l=sp(s,0,999);return n?o?a?l?!1:rp("millisecond",s):rp("second",r):rp("minute",i):rp("hour",e)}function Ri(t){return typeof t>"u"}function SS(t){return typeof t=="number"}function dG(t){return typeof t=="number"&&t%1===0}function XHe(t){return typeof t=="string"}function JHe(t){return Object.prototype.toString.call(t)==="[object Date]"}function WSe(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function ZSe(){try{return typeof Intl<"u"&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch{return!1}}function QHe(t){return Array.isArray(t)?t:[t]}function Eue(t,e,i){if(t.length!==0)return t.reduce((r,s)=>{const n=[e(s),s];return r&&i(r[0],n[0])===r[0]?r:n},null)[1]}function KHe(t,e){return e.reduce((i,r)=>(i[r]=t[r],i),{})}function eP(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function gZ(t){if(t==null)return null;if(typeof t!="object")throw new Au("Week settings must be an object");if(!sp(t.firstDay,1,7)||!sp(t.minimalDays,1,7)||!Array.isArray(t.weekend)||t.weekend.some(e=>!sp(e,1,7)))throw new Au("Invalid week settings");return{firstDay:t.firstDay,minimalDays:t.minimalDays,weekend:Array.from(t.weekend)}}function sp(t,e,i){return dG(t)&&t>=e&&t<=i}function eqe(t,e){return t-e*Math.floor(t/e)}function No(t,e=2){const i=t<0;let r;return i?r="-"+(""+-t).padStart(e,"0"):r=(""+t).padStart(e,"0"),r}function R1(t){if(!(Ri(t)||t===null||t===""))return parseInt(t,10)}function zw(t){if(!(Ri(t)||t===null||t===""))return parseFloat(t)}function dre(t){if(!(Ri(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function pre(t,e,i=!1){const r=10**e;return(i?Math.trunc:Math.round)(t*r)/r}function ID(t){return t%4===0&&(t%100!==0||t%400===0)}function gA(t){return ID(t)?366:365}function dz(t,e){const i=eqe(e-1,12)+1,r=t+(e-i)/12;return i===2?ID(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function pG(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function Cue(t,e,i){return-hre(ure(t,1,e),i)+e-1}function SL(t,e=4,i=1){const r=Cue(t,e,i),s=Cue(t+1,e,i);return(gA(t)-r+s)/7}function yZ(t){return t>99?t:t>co.twoDigitCutoffYear?1900+t:2e3+t}function YSe(t,e,i,r=null){const s=new Date(t),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(n.timeZone=r);const o={timeZoneName:e,...n},a=new Intl.DateTimeFormat(i,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function fG(t,e){let i=parseInt(t,10);Number.isNaN(i)&&(i=0);const r=parseInt(e,10)||0,s=i<0||Object.is(i,-0)?-r:r;return i*60+s}function XSe(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new Au(`Invalid unit value ${t}`);return e}function pz(t,e){const i={};for(const r in t)if(eP(t,r)){const s=t[r];if(s==null)continue;i[e(r)]=XSe(s)}return i}function v3(t,e){const i=Math.trunc(Math.abs(t/60)),r=Math.trunc(Math.abs(t%60)),s=t>=0?"+":"-";switch(e){case"short":return`${s}${No(i,2)}:${No(r,2)}`;case"narrow":return`${s}${i}${r>0?`:${r}`:""}`;case"techie":return`${s}${No(i,2)}${No(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function mG(t){return KHe(t,["hour","minute","second","millisecond"])}const tqe=["January","February","March","April","May","June","July","August","September","October","November","December"],JSe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],iqe=["J","F","M","A","M","J","J","A","S","O","N","D"];function QSe(t){switch(t){case"narrow":return[...iqe];case"short":return[...JSe];case"long":return[...tqe];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const KSe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],e2e=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],rqe=["M","T","W","T","F","S","S"];function t2e(t){switch(t){case"narrow":return[...rqe];case"short":return[...e2e];case"long":return[...KSe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const i2e=["AM","PM"],sqe=["Before Christ","Anno Domini"],nqe=["BC","AD"],oqe=["B","A"];function r2e(t){switch(t){case"narrow":return[...oqe];case"short":return[...nqe];case"long":return[...sqe];default:return null}}function aqe(t){return i2e[t.hour<12?0:1]}function lqe(t,e){return t2e(e)[t.weekday-1]}function cqe(t,e){return QSe(e)[t.month-1]}function uqe(t,e){return r2e(e)[t.year<0?0:1]}function hqe(t,e,i="always",r=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(t)===-1;if(i==="auto"&&n){const d=t==="days";switch(e){case 1:return d?"tomorrow":`next ${s[t][0]}`;case-1:return d?"yesterday":`last ${s[t][0]}`;case 0:return d?"today":`this ${s[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=s[t],u=r?l?c[1]:c[2]||c[1]:l?s[t][0]:t;return o?`${a} ${u} ago`:`in ${a} ${u}`}function Mue(t,e){let i="";for(const r of t)r.literal?i+=r.val:i+=e(r.val);return i}const dqe={D:uz,DD:xSe,DDD:TSe,DDDD:SSe,t:ESe,tt:CSe,ttt:MSe,tttt:ASe,T:PSe,TT:OSe,TTT:$Se,TTTT:RSe,f:ISe,ff:DSe,fff:FSe,ffff:USe,F:LSe,FF:NSe,FFF:kSe,FFFF:VSe};class tc{static create(e,i={}){return new tc(e,i)}static parseFormat(e){let i=null,r="",s=!1;const n=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(r.length>0&&n.push({literal:s||/^\s+$/.test(r),val:r}),i=null,r="",s=!s):s||a===i?r+=a:(r.length>0&&n.push({literal:/^\s+$/.test(r),val:r}),r=a,i=a)}return r.length>0&&n.push({literal:s||/^\s+$/.test(r),val:r}),n}static macroTokenToFormatOpts(e){return dqe[e]}constructor(e,i){this.opts=i,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...i}).format()}dtFormatter(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i})}formatDateTime(e,i){return this.dtFormatter(e,i).format()}formatDateTimeParts(e,i){return this.dtFormatter(e,i).formatToParts()}formatInterval(e,i){return this.dtFormatter(e.start,i).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,i){return this.dtFormatter(e,i).resolvedOptions()}num(e,i=0){if(this.opts.forceSimple)return No(e,i);const r={...this.opts};return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,i){const r=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(m,g)=>this.loc.extract(e,m,g),o=m=>e.isOffsetFixed&&e.offset===0&&m.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,m.format):"",a=()=>r?aqe(e):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,g)=>r?cqe(e,m):n(g?{month:m}:{month:m,day:"numeric"},"month"),c=(m,g)=>r?lqe(e,m):n(g?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),u=m=>{const g=tc.macroTokenToFormatOpts(m);return g?this.formatWithSystemDefault(e,g):m},d=m=>r?uqe(e,m):n({era:m},"era"),f=m=>{switch(m){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(e.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(e.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(e.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(e.year,6);case"G":return d("short");case"GG":return d("long");case"GGGGG":return d("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return u(m)}};return Mue(tc.parseFormat(i),f)}formatDurationFromString(e,i){const r=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const u=r(c);return u?this.num(l.get(u),c.length):c},n=tc.parseFormat(i),o=n.reduce((l,{literal:c,val:u})=>c?l:l.concat(u),[]),a=e.shiftTo(...o.map(r).filter(l=>l));return Mue(n,s(a))}}const s2e=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function uO(...t){const e=t.reduce((i,r)=>i+r.source,"");return RegExp(`^${e}$`)}function hO(...t){return e=>t.reduce(([i,r,s],n)=>{const[o,a,l]=n(e,s);return[{...i,...o},a||r,l]},[{},null,1]).slice(0,2)}function dO(t,...e){if(t==null)return[null,null];for(const[i,r]of e){const s=i.exec(t);if(s)return r(s)}return[null,null]}function n2e(...t){return(e,i)=>{const r={};let s;for(s=0;s<t.length;s++)r[t[s]]=R1(e[i+s]);return[r,null,i+s]}}const o2e=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,pqe=`(?:${o2e.source}?(?:\\[(${s2e.source})\\])?)?`,fre=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,a2e=RegExp(`${fre.source}${pqe}`),mre=RegExp(`(?:T${a2e.source})?`),fqe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,mqe=/(\d{4})-?W(\d\d)(?:-?(\d))?/,gqe=/(\d{4})-?(\d{3})/,yqe=n2e("weekYear","weekNumber","weekDay"),_qe=n2e("year","ordinal"),vqe=/(\d{4})-(\d\d)-(\d\d)/,l2e=RegExp(`${fre.source} ?(?:${o2e.source}|(${s2e.source}))?`),bqe=RegExp(`(?: ${l2e.source})?`);function yA(t,e,i){const r=t[e];return Ri(r)?i:R1(r)}function wqe(t,e){return[{year:yA(t,e),month:yA(t,e+1,1),day:yA(t,e+2,1)},null,e+3]}function pO(t,e){return[{hours:yA(t,e,0),minutes:yA(t,e+1,0),seconds:yA(t,e+2,0),milliseconds:dre(t[e+3])},null,e+4]}function LD(t,e){const i=!t[e]&&!t[e+1],r=fG(t[e+1],t[e+2]),s=i?null:yl.instance(r);return[{},s,e+3]}function DD(t,e){const i=t[e]?Xh.create(t[e]):null;return[{},i,e+1]}const xqe=RegExp(`^T?${fre.source}$`),Tqe=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function Sqe(t){const[e,i,r,s,n,o,a,l,c]=t,u=e[0]==="-",d=l&&l[0]==="-",f=(m,g=!1)=>m!==void 0&&(g||m&&u)?-m:m;return[{years:f(zw(i)),months:f(zw(r)),weeks:f(zw(s)),days:f(zw(n)),hours:f(zw(o)),minutes:f(zw(a)),seconds:f(zw(l),l==="-0"),milliseconds:f(dre(c),d)}]}const Eqe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function gre(t,e,i,r,s,n,o){const a={year:e.length===2?yZ(R1(e)):R1(e),month:JSe.indexOf(i)+1,day:R1(r),hour:R1(s),minute:R1(n)};return o&&(a.second=R1(o)),t&&(a.weekday=t.length>3?KSe.indexOf(t)+1:e2e.indexOf(t)+1),a}const Cqe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Mqe(t){const[,e,i,r,s,n,o,a,l,c,u,d]=t,f=gre(e,s,r,i,n,o,a);let m;return l?m=Eqe[l]:c?m=0:m=fG(u,d),[f,new yl(m)]}function Aqe(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const Pqe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Oqe=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,$qe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Aue(t){const[,e,i,r,s,n,o,a]=t;return[gre(e,s,r,i,n,o,a),yl.utcInstance]}function Rqe(t){const[,e,i,r,s,n,o,a]=t;return[gre(e,a,i,r,s,n,o),yl.utcInstance]}const Iqe=uO(fqe,mre),Lqe=uO(mqe,mre),Dqe=uO(gqe,mre),Nqe=uO(a2e),c2e=hO(wqe,pO,LD,DD),Fqe=hO(yqe,pO,LD,DD),kqe=hO(_qe,pO,LD,DD),Uqe=hO(pO,LD,DD);function Vqe(t){return dO(t,[Iqe,c2e],[Lqe,Fqe],[Dqe,kqe],[Nqe,Uqe])}function zqe(t){return dO(Aqe(t),[Cqe,Mqe])}function Bqe(t){return dO(t,[Pqe,Aue],[Oqe,Aue],[$qe,Rqe])}function jqe(t){return dO(t,[Tqe,Sqe])}const Gqe=hO(pO);function Hqe(t){return dO(t,[xqe,Gqe])}const qqe=uO(vqe,bqe),Wqe=uO(l2e),Zqe=hO(pO,LD,DD);function Yqe(t){return dO(t,[qqe,c2e],[Wqe,Zqe])}const Pue="Invalid Duration",u2e={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},Xqe={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...u2e},od=146097/400,hE=146097/4800,Jqe={years:{quarters:4,months:12,weeks:od/7,days:od,hours:od*24,minutes:od*24*60,seconds:od*24*60*60,milliseconds:od*24*60*60*1e3},quarters:{months:3,weeks:od/28,days:od/4,hours:od*24/4,minutes:od*24*60/4,seconds:od*24*60*60/4,milliseconds:od*24*60*60*1e3/4},months:{weeks:hE/7,days:hE,hours:hE*24,minutes:hE*24*60,seconds:hE*24*60*60,milliseconds:hE*24*60*60*1e3},...u2e},sS=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],Qqe=sS.slice(0).reverse();function cv(t,e,i=!1){const r={values:i?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new Vr(r)}function h2e(t,e){let i=e.milliseconds??0;for(const r of Qqe.slice(1))e[r]&&(i+=e[r]*t[r].milliseconds);return i}function Oue(t,e){const i=h2e(t,e)<0?-1:1;sS.reduceRight((r,s)=>{if(Ri(e[s]))return r;if(r){const n=e[r]*i,o=t[s][r],a=Math.floor(n/o);e[s]+=a*i,e[r]-=a*o*i}return s},null),sS.reduce((r,s)=>{if(Ri(e[s]))return r;if(r){const n=e[r]%1;e[r]-=n,e[s]+=n*t[r][s]}return s},null)}function Kqe(t){const e={};for(const[i,r]of Object.entries(t))r!==0&&(e[i]=r);return e}class Vr{constructor(e){const i=e.conversionAccuracy==="longterm"||!1;let r=i?Jqe:Xqe;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||As.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,i){return Vr.fromObject({milliseconds:e},i)}static fromObject(e,i={}){if(e==null||typeof e!="object")throw new Au(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Vr({values:pz(e,Vr.normalizeUnit),loc:As.fromObject(i),conversionAccuracy:i.conversionAccuracy,matrix:i.matrix})}static fromDurationLike(e){if(SS(e))return Vr.fromMillis(e);if(Vr.isDuration(e))return e;if(typeof e=="object")return Vr.fromObject(e);throw new Au(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,i){const[r]=jqe(e);return r?Vr.fromObject(r,i):Vr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,i){const[r]=Hqe(e);return r?Vr.fromObject(r,i):Vr.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,i=null){if(!e)throw new Au("need to specify a reason the Duration is invalid");const r=e instanceof Vf?e:new Vf(e,i);if(co.throwOnInvalid)throw new CHe(r);return new Vr({invalid:r})}static normalizeUnit(e){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!i)throw new wSe(e);return i}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,i={}){const r={...i,floor:i.round!==!1&&i.floor!==!1};return this.isValid?tc.create(this.loc,r).formatDurationFromString(this,e):Pue}toHuman(e={}){if(!this.isValid)return Pue;const i=sS.map(r=>{const s=this.values[r];return Ri(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:r.slice(0,-1)}).format(s)}).filter(r=>r);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(i)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=pre(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const i=this.toMillis();return i<0||i>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},yi.fromMillis(i,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?h2e(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const i=Vr.fromDurationLike(e),r={};for(const s of sS)(eP(i.values,s)||eP(this.values,s))&&(r[s]=i.get(s)+this.get(s));return cv(this,{values:r},!0)}minus(e){if(!this.isValid)return this;const i=Vr.fromDurationLike(e);return this.plus(i.negate())}mapUnits(e){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=XSe(e(this.values[r],r));return cv(this,{values:i},!0)}get(e){return this[Vr.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const i={...this.values,...pz(e,Vr.normalizeUnit)};return cv(this,{values:i})}reconfigure({locale:e,numberingSystem:i,conversionAccuracy:r,matrix:s}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:i}),matrix:s,conversionAccuracy:r};return cv(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return Oue(this.matrix,e),cv(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=Kqe(this.normalize().shiftToAll().toObject());return cv(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>Vr.normalizeUnit(o));const i={},r={},s=this.toObject();let n;for(const o of sS)if(e.indexOf(o)>=0){n=o;let a=0;for(const c in r)a+=this.matrix[c][o]*r[c],r[c]=0;SS(s[o])&&(a+=s[o]);const l=Math.trunc(a);i[o]=l,r[o]=(a*1e3-l*1e3)/1e3}else SS(s[o])&&(r[o]=s[o]);for(const o in r)r[o]!==0&&(i[n]+=o===n?r[o]:r[o]/this.matrix[n][o]);return Oue(this.matrix,i),cv(this,{values:i},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const i of Object.keys(this.values))e[i]=this.values[i]===0?0:-this.values[i];return cv(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function i(r,s){return r===void 0||r===0?s===void 0||s===0:r===s}for(const r of sS)if(!i(this.values[r],e.values[r]))return!1;return!0}}const dE="Invalid Interval";function e9e(t,e){return!t||!t.isValid?Gn.invalid("missing or invalid start"):!e||!e.isValid?Gn.invalid("missing or invalid end"):e<t?Gn.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class Gn{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,i=null){if(!e)throw new Au("need to specify a reason the Interval is invalid");const r=e instanceof Vf?e:new Vf(e,i);if(co.throwOnInvalid)throw new EHe(r);return new Gn({invalid:r})}static fromDateTimes(e,i){const r=QO(e),s=QO(i),n=e9e(r,s);return n??new Gn({start:r,end:s})}static after(e,i){const r=Vr.fromDurationLike(i),s=QO(e);return Gn.fromDateTimes(s,s.plus(r))}static before(e,i){const r=Vr.fromDurationLike(i),s=QO(e);return Gn.fromDateTimes(s.minus(r),s)}static fromISO(e,i){const[r,s]=(e||"").split("/",2);if(r&&s){let n,o;try{n=yi.fromISO(r,i),o=n.isValid}catch{o=!1}let a,l;try{a=yi.fromISO(s,i),l=a.isValid}catch{l=!1}if(o&&l)return Gn.fromDateTimes(n,a);if(o){const c=Vr.fromISO(s,i);if(c.isValid)return Gn.after(n,c)}else if(l){const c=Vr.fromISO(r,i);if(c.isValid)return Gn.before(a,c)}}return Gn.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",i){if(!this.isValid)return NaN;const r=this.start.startOf(e,i);let s;return i!=null&&i.useLocaleWeeks?s=this.end.reconfigure({locale:r.locale}):s=this.end,s=s.startOf(e,i),Math.floor(s.diff(r,e).get(e))+(s.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:i}={}){return this.isValid?Gn.fromDateTimes(e||this.s,i||this.e):this}splitAt(...e){if(!this.isValid)return[];const i=e.map(QO).filter(o=>this.contains(o)).sort((o,a)=>o.toMillis()-a.toMillis()),r=[];let{s}=this,n=0;for(;s<this.e;){const o=i[n]||this.e,a=+o>+this.e?this.e:o;r.push(Gn.fromDateTimes(s,a)),s=a,n+=1}return r}splitBy(e){const i=Vr.fromDurationLike(e);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,s=1,n;const o=[];for(;r<this.e;){const a=this.start.plus(i.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(Gn.fromDateTimes(r,n)),r=n,s+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const i=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return i>=r?null:Gn.fromDateTimes(i,r)}union(e){if(!this.isValid)return this;const i=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return Gn.fromDateTimes(i,r)}static merge(e){const[i,r]=e.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return r&&i.push(r),i}static xor(e){let i=null,r=0;const s=[],n=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&s.push(Gn.fromDateTimes(i,l.time)),i=null);return Gn.merge(s)}difference(...e){return Gn.xor([this].concat(e)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:dE}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=uz,i={}){return this.isValid?tc.create(this.s.loc.clone(i),e).formatInterval(this):dE}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:dE}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:dE}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:dE}toFormat(e,{separator:i=" – "}={}){return this.isValid?`${this.s.toFormat(e)}${i}${this.e.toFormat(e)}`:dE}toDuration(e,i){return this.isValid?this.e.diff(this.s,e,i):Vr.invalid(this.invalidReason)}mapEndpoints(e){return Gn.fromDateTimes(e(this.s),e(this.e))}}class iF{static hasDST(e=co.defaultZone){const i=yi.now().setZone(e).set({month:12});return!e.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(e){return Xh.isValidZone(e)}static normalizeZone(e){return q1(e,co.defaultZone)}static getStartOfWeek({locale:e=null,locObj:i=null}={}){return(i||As.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:i=null}={}){return(i||As.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:i=null}={}){return(i||As.create(e)).getWeekendDays().slice()}static months(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||As.create(i,r,n)).months(e)}static monthsFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||As.create(i,r,n)).months(e,!0)}static weekdays(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||As.create(i,r,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||As.create(i,r,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return As.create(e).meridiems()}static eras(e="short",{locale:i=null}={}){return As.create(i,null,"gregory").eras(e)}static features(){return{relative:WSe(),localeWeek:ZSe()}}}function $ue(t,e){const i=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(e)-i(t);return Math.floor(Vr.fromMillis(r).as("days"))}function t9e(t,e,i){const r=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const u=$ue(l,c);return(u-u%7)/7}],["days",$ue]],s={},n=t;let o,a;for(const[l,c]of r)i.indexOf(l)>=0&&(o=l,s[l]=c(t,e),a=n.plus(s),a>e?(s[l]--,t=n.plus(s),t>e&&(a=t,s[l]--,t=n.plus(s))):t=a);return[t,s,a,o]}function i9e(t,e,i,r){let[s,n,o,a]=t9e(t,e,i);const l=e-s,c=i.filter(d=>["hours","minutes","seconds","milliseconds"].indexOf(d)>=0);c.length===0&&(o<e&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const u=Vr.fromObject(n,r);return c.length>0?Vr.fromMillis(l,r).shiftTo(...c).plus(u):u}const yre={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},Rue={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},r9e=yre.hanidec.replace(/[\[|\]]/g,"").split("");function s9e(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);if(t[i].search(yre.hanidec)!==-1)e+=r9e.indexOf(t[i]);else for(const s in Rue){const[n,o]=Rue[s];r>=n&&r<=o&&(e+=r-n)}}return parseInt(e,10)}else return e}function $p({numberingSystem:t},e=""){return new RegExp(`${yre[t||"latn"]}${e}`)}const n9e="missing Intl.DateTimeFormat.formatToParts support";function rs(t,e=i=>i){return{regex:t,deser:([i])=>e(s9e(i))}}const o9e=" ",d2e=`[ ${o9e}]`,p2e=new RegExp(d2e,"g");function a9e(t){return t.replace(/\./g,"\\.?").replace(p2e,d2e)}function Iue(t){return t.replace(/\./g,"").replace(p2e," ").toLowerCase()}function Rp(t,e){return t===null?null:{regex:RegExp(t.map(a9e).join("|")),deser:([i])=>t.findIndex(r=>Iue(i)===Iue(r))+e}}function Lue(t,e){return{regex:t,deser:([,i,r])=>fG(i,r),groups:e}}function rF(t){return{regex:t,deser:([e])=>e}}function l9e(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function c9e(t,e){const i=$p(e),r=$p(e,"{2}"),s=$p(e,"{3}"),n=$p(e,"{4}"),o=$p(e,"{6}"),a=$p(e,"{1,2}"),l=$p(e,"{1,3}"),c=$p(e,"{1,6}"),u=$p(e,"{1,9}"),d=$p(e,"{2,4}"),f=$p(e,"{4,6}"),m=v=>({regex:RegExp(l9e(v.val)),deser:([b])=>b,literal:!0}),y=(v=>{if(t.literal)return m(v);switch(v.val){case"G":return Rp(e.eras("short"),0);case"GG":return Rp(e.eras("long"),0);case"y":return rs(c);case"yy":return rs(d,yZ);case"yyyy":return rs(n);case"yyyyy":return rs(f);case"yyyyyy":return rs(o);case"M":return rs(a);case"MM":return rs(r);case"MMM":return Rp(e.months("short",!0),1);case"MMMM":return Rp(e.months("long",!0),1);case"L":return rs(a);case"LL":return rs(r);case"LLL":return Rp(e.months("short",!1),1);case"LLLL":return Rp(e.months("long",!1),1);case"d":return rs(a);case"dd":return rs(r);case"o":return rs(l);case"ooo":return rs(s);case"HH":return rs(r);case"H":return rs(a);case"hh":return rs(r);case"h":return rs(a);case"mm":return rs(r);case"m":return rs(a);case"q":return rs(a);case"qq":return rs(r);case"s":return rs(a);case"ss":return rs(r);case"S":return rs(l);case"SSS":return rs(s);case"u":return rF(u);case"uu":return rF(a);case"uuu":return rs(i);case"a":return Rp(e.meridiems(),0);case"kkkk":return rs(n);case"kk":return rs(d,yZ);case"W":return rs(a);case"WW":return rs(r);case"E":case"c":return rs(i);case"EEE":return Rp(e.weekdays("short",!1),1);case"EEEE":return Rp(e.weekdays("long",!1),1);case"ccc":return Rp(e.weekdays("short",!0),1);case"cccc":return Rp(e.weekdays("long",!0),1);case"Z":case"ZZ":return Lue(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return Lue(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return rF(/[a-z_+-/]{1,256}?/i);case" ":return rF(/[^\S\n\r]/);default:return m(v)}})(t)||{invalidReason:n9e};return y.token=t,y}const u9e={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function h9e(t,e,i){const{type:r,value:s}=t;if(r==="literal"){const l=/^\s+$/.test(s);return{literal:!l,val:l?" ":s}}const n=e[r];let o=r;r==="hour"&&(e.hour12!=null?o=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?o="hour12":o="hour24":o=i.hour12?"hour12":"hour24");let a=u9e[o];if(typeof a=="object"&&(a=a[n]),a)return{literal:!1,val:a}}function d9e(t){return[`^${t.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,t]}function p9e(t,e,i){const r=t.match(e);if(r){const s={};let n=1;for(const o in i)if(eP(i,o)){const a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(r.slice(n,n+l))),n+=l}return[r,s]}else return[r,{}]}function f9e(t){const e=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return Ri(t.z)||(i=Xh.create(t.z)),Ri(t.Z)||(i||(i=new yl(t.Z)),r=t.Z),Ri(t.q)||(t.M=(t.q-1)*3+1),Ri(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),Ri(t.u)||(t.S=dre(t.u)),[Object.keys(t).reduce((n,o)=>{const a=e(o);return a&&(n[a]=t[o]),n},{}),i,r]}let hH=null;function m9e(){return hH||(hH=yi.fromMillis(1555555555555)),hH}function g9e(t,e){if(t.literal)return t;const i=tc.macroTokenToFormatOpts(t.val),r=g2e(i,e);return r==null||r.includes(void 0)?t:r}function f2e(t,e){return Array.prototype.concat(...t.map(i=>g9e(i,e)))}function m2e(t,e,i){const r=f2e(tc.parseFormat(i),t),s=r.map(o=>c9e(o,t)),n=s.find(o=>o.invalidReason);if(n)return{input:e,tokens:r,invalidReason:n.invalidReason};{const[o,a]=d9e(s),l=RegExp(o,"i"),[c,u]=p9e(e,l,a),[d,f,m]=u?f9e(u):[null,null,void 0];if(eP(u,"a")&&eP(u,"H"))throw new PM("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:r,regex:l,rawMatches:c,matches:u,result:d,zone:f,specificOffset:m}}}function y9e(t,e,i){const{result:r,zone:s,specificOffset:n,invalidReason:o}=m2e(t,e,i);return[r,s,n,o]}function g2e(t,e){if(!t)return null;const r=tc.create(e,t).dtFormatter(m9e()),s=r.formatToParts(),n=r.resolvedOptions();return s.map(o=>h9e(o,t,n))}const dH="Invalid DateTime",Due=864e13;function sF(t){return new Vf("unsupported zone",`the zone "${t.name}" is not supported`)}function pH(t){return t.weekData===null&&(t.weekData=hz(t.c)),t.weekData}function fH(t){return t.localWeekData===null&&(t.localWeekData=hz(t.c,t.loc.getMinDaysInFirstWeek(),t.loc.getStartOfWeek())),t.localWeekData}function Bw(t,e){const i={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new yi({...i,...e,old:i})}function y2e(t,e,i){let r=t-e*60*1e3;const s=i.offset(r);if(e===s)return[r,e];r-=(s-e)*60*1e3;const n=i.offset(r);return s===n?[r,s]:[t-Math.min(s,n)*60*1e3,Math.max(s,n)]}function nF(t,e){t+=e*60*1e3;const i=new Date(t);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function Pk(t,e,i){return y2e(pG(t),e,i)}function Nue(t,e){const i=t.o,r=t.c.year+Math.trunc(e.years),s=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,n={...t.c,year:r,month:s,day:Math.min(t.c.day,dz(r,s))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=Vr.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=pG(n);let[l,c]=y2e(a,i,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function JO(t,e,i,r,s,n){const{setZone:o,zone:a}=i;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=yi.fromObject(t,{...i,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return yi.invalid(new Vf("unparsable",`the input "${s}" can't be parsed as ${r}`))}function oF(t,e,i=!0){return t.isValid?tc.create(As.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(t,e):null}function mH(t,e){const i=t.c.year>9999||t.c.year<0;let r="";return i&&t.c.year>=0&&(r+="+"),r+=No(t.c.year,i?6:4),e?(r+="-",r+=No(t.c.month),r+="-",r+=No(t.c.day)):(r+=No(t.c.month),r+=No(t.c.day)),r}function Fue(t,e,i,r,s,n){let o=No(t.c.hour);return e?(o+=":",o+=No(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!i)&&(o+=":")):o+=No(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!i)&&(o+=No(t.c.second),(t.c.millisecond!==0||!r)&&(o+=".",o+=No(t.c.millisecond,3))),s&&(t.isOffsetFixed&&t.offset===0&&!n?o+="Z":t.o<0?(o+="-",o+=No(Math.trunc(-t.o/60)),o+=":",o+=No(Math.trunc(-t.o%60))):(o+="+",o+=No(Math.trunc(t.o/60)),o+=":",o+=No(Math.trunc(t.o%60)))),n&&(o+="["+t.zone.ianaName+"]"),o}const _2e={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},_9e={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},v9e={ordinal:1,hour:0,minute:0,second:0,millisecond:0},v2e=["year","month","day","hour","minute","second","millisecond"],b9e=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],w9e=["year","ordinal","hour","minute","second","millisecond"];function x9e(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new wSe(t);return e}function kue(t){switch(t.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return x9e(t)}}function Uue(t,e){const i=q1(e.zone,co.defaultZone),r=As.fromObject(e),s=co.now();let n,o;if(Ri(t.year))n=s;else{for(const c of v2e)Ri(t[c])&&(t[c]=_2e[c]);const a=HSe(t)||qSe(t);if(a)return yi.invalid(a);const l=i.offset(s);[n,o]=Pk(t,l,i)}return new yi({ts:n,zone:i,loc:r,o})}function Vue(t,e,i){const r=Ri(i.round)?!0:i.round,s=(o,a)=>(o=pre(o,r||i.calendary?0:2,!0),e.loc.clone(i).relFormatter(i).format(o,a)),n=o=>i.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(i.unit)return s(n(i.unit),i.unit);for(const o of i.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(t>e?-0:0,i.units[i.units.length-1])}function zue(t){let e={},i;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],i=Array.from(t).slice(0,t.length-1)):i=Array.from(t),[e,i]}class yi{constructor(e){const i=e.zone||co.defaultZone;let r=e.invalid||(Number.isNaN(e.ts)?new Vf("invalid input"):null)||(i.isValid?null:sF(i));this.ts=Ri(e.ts)?co.now():e.ts;let s=null,n=null;if(!r)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(i))[s,n]=[e.old.c,e.old.o];else{const a=i.offset(this.ts);s=nF(this.ts,a),r=Number.isNaN(s.year)?new Vf("invalid input"):null,s=r?null:s,n=r?null:a}this._zone=i,this.loc=e.loc||As.create(),this.invalid=r,this.weekData=null,this.localWeekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new yi({})}static local(){const[e,i]=zue(arguments),[r,s,n,o,a,l,c]=i;return Uue({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,i]=zue(arguments),[r,s,n,o,a,l,c]=i;return e.zone=yl.utcInstance,Uue({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,i={}){const r=JHe(e)?e.valueOf():NaN;if(Number.isNaN(r))return yi.invalid("invalid input");const s=q1(i.zone,co.defaultZone);return s.isValid?new yi({ts:r,zone:s,loc:As.fromObject(i)}):yi.invalid(sF(s))}static fromMillis(e,i={}){if(SS(e))return e<-Due||e>Due?yi.invalid("Timestamp out of range"):new yi({ts:e,zone:q1(i.zone,co.defaultZone),loc:As.fromObject(i)});throw new Au(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,i={}){if(SS(e))return new yi({ts:e*1e3,zone:q1(i.zone,co.defaultZone),loc:As.fromObject(i)});throw new Au("fromSeconds requires a numerical input")}static fromObject(e,i={}){e=e||{};const r=q1(i.zone,co.defaultZone);if(!r.isValid)return yi.invalid(sF(r));const s=As.fromObject(i),n=pz(e,kue),{minDaysInFirstWeek:o,startOfWeek:a}=Sue(n,s),l=co.now(),c=Ri(i.specificOffset)?r.offset(l):i.specificOffset,u=!Ri(n.ordinal),d=!Ri(n.year),f=!Ri(n.month)||!Ri(n.day),m=d||f,g=n.weekYear||n.weekNumber;if((m||u)&&g)throw new PM("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(f&&u)throw new PM("Can't mix ordinal dates with month/day");const y=g||n.weekday&&!m;let v,b,w=nF(l,c);y?(v=b9e,b=_9e,w=hz(w,o,a)):u?(v=w9e,b=v9e,w=uH(w)):(v=v2e,b=_2e);let x=!1;for(const k of v){const H=n[k];Ri(H)?x?n[k]=b[k]:n[k]=w[k]:x=!0}const T=y?ZHe(n,o,a):u?YHe(n):HSe(n),E=T||qSe(n);if(E)return yi.invalid(E);const M=y?xue(n,o,a):u?Tue(n):n,[O,D]=Pk(M,c,r),U=new yi({ts:O,zone:r,o:D,loc:s});return n.weekday&&m&&e.weekday!==U.weekday?yi.invalid("mismatched weekday",`you can't specify both a weekday of ${n.weekday} and a date of ${U.toISO()}`):U}static fromISO(e,i={}){const[r,s]=Vqe(e);return JO(r,s,i,"ISO 8601",e)}static fromRFC2822(e,i={}){const[r,s]=zqe(e);return JO(r,s,i,"RFC 2822",e)}static fromHTTP(e,i={}){const[r,s]=Bqe(e);return JO(r,s,i,"HTTP",i)}static fromFormat(e,i,r={}){if(Ri(e)||Ri(i))throw new Au("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=r,o=As.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,u]=y9e(o,e,i);return u?yi.invalid(u):JO(a,l,r,`format ${i}`,e,c)}static fromString(e,i,r={}){return yi.fromFormat(e,i,r)}static fromSQL(e,i={}){const[r,s]=Yqe(e);return JO(r,s,i,"SQL",e)}static invalid(e,i=null){if(!e)throw new Au("need to specify a reason the DateTime is invalid");const r=e instanceof Vf?e:new Vf(e,i);if(co.throwOnInvalid)throw new SHe(r);return new yi({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,i={}){const r=g2e(e,As.fromObject(i));return r?r.map(s=>s?s.val:null).join(""):null}static expandFormat(e,i={}){return f2e(tc.parseFormat(e),As.fromObject(i)).map(s=>s.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?pH(this).weekYear:NaN}get weekNumber(){return this.isValid?pH(this).weekNumber:NaN}get weekday(){return this.isValid?pH(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?fH(this).weekday:NaN}get localWeekNumber(){return this.isValid?fH(this).weekNumber:NaN}get localWeekYear(){return this.isValid?fH(this).weekYear:NaN}get ordinal(){return this.isValid?uH(this.c).ordinal:NaN}get monthShort(){return this.isValid?iF.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?iF.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?iF.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?iF.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,i=6e4,r=pG(this.c),s=this.zone.offset(r-e),n=this.zone.offset(r+e),o=this.zone.offset(r-s*i),a=this.zone.offset(r-n*i);if(o===a)return[this];const l=r-o*i,c=r-a*i,u=nF(l,o),d=nF(c,a);return u.hour===d.hour&&u.minute===d.minute&&u.second===d.second&&u.millisecond===d.millisecond?[Bw(this,{ts:l}),Bw(this,{ts:c})]:[this]}get isInLeapYear(){return ID(this.year)}get daysInMonth(){return dz(this.year,this.month)}get daysInYear(){return this.isValid?gA(this.year):NaN}get weeksInWeekYear(){return this.isValid?SL(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?SL(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:i,numberingSystem:r,calendar:s}=tc.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:s}}toUTC(e=0,i={}){return this.setZone(yl.instance(e),i)}toLocal(){return this.setZone(co.defaultZone)}setZone(e,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(e=q1(e,co.defaultZone),e.equals(this.zone))return this;if(e.isValid){let s=this.ts;if(i||r){const n=e.offset(this.ts),o=this.toObject();[s]=Pk(o,n,e)}return Bw(this,{ts:s,zone:e})}else return yi.invalid(sF(e))}reconfigure({locale:e,numberingSystem:i,outputCalendar:r}={}){const s=this.loc.clone({locale:e,numberingSystem:i,outputCalendar:r});return Bw(this,{loc:s})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const i=pz(e,kue),{minDaysInFirstWeek:r,startOfWeek:s}=Sue(i,this.loc),n=!Ri(i.weekYear)||!Ri(i.weekNumber)||!Ri(i.weekday),o=!Ri(i.ordinal),a=!Ri(i.year),l=!Ri(i.month)||!Ri(i.day),c=a||l,u=i.weekYear||i.weekNumber;if((c||o)&&u)throw new PM("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&o)throw new PM("Can't mix ordinal dates with month/day");let d;n?d=xue({...hz(this.c,r,s),...i},r,s):Ri(i.ordinal)?(d={...this.toObject(),...i},Ri(i.day)&&(d.day=Math.min(dz(d.year,d.month),d.day))):d=Tue({...uH(this.c),...i});const[f,m]=Pk(d,this.o,this.zone);return Bw(this,{ts:f,o:m})}plus(e){if(!this.isValid)return this;const i=Vr.fromDurationLike(e);return Bw(this,Nue(this,i))}minus(e){if(!this.isValid)return this;const i=Vr.fromDurationLike(e).negate();return Bw(this,Nue(this,i))}startOf(e,{useLocaleWeeks:i=!1}={}){if(!this.isValid)return this;const r={},s=Vr.normalizeUnit(e);switch(s){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(s==="weeks")if(i){const n=this.loc.getStartOfWeek(),{weekday:o}=this;o<n&&(r.weekNumber=this.weekNumber-1),r.weekday=n}else r.weekday=1;if(s==="quarters"){const n=Math.ceil(this.month/3);r.month=(n-1)*3+1}return this.set(r)}endOf(e,i){return this.isValid?this.plus({[e]:1}).startOf(e,i).minus(1):this}toFormat(e,i={}){return this.isValid?tc.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,e):dH}toLocaleString(e=uz,i={}){return this.isValid?tc.create(this.loc.clone(i),e).formatDateTime(this):dH}toLocaleParts(e={}){return this.isValid?tc.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=mH(this,o);return a+="T",a+=Fue(this,o,i,r,s,n),a}toISODate({format:e="extended"}={}){return this.isValid?mH(this,e==="extended"):null}toISOWeekDate(){return oF(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+Fue(this,o==="extended",i,e,r,n):null}toRFC2822(){return oF(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return oF(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?mH(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let s="HH:mm:ss.SSS";return(i||e)&&(r&&(s+=" "),i?s+="z":e&&(s+="ZZ")),oF(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():dH}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const i={...this.c};return e.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,i="milliseconds",r={}){if(!this.isValid||!e.isValid)return Vr.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...r},n=QHe(i).map(Vr.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=i9e(a,l,n,s);return o?c.negate():c}diffNow(e="milliseconds",i={}){return this.diff(yi.now(),e,i)}until(e){return this.isValid?Gn.fromDateTimes(this,e):this}hasSame(e,i,r){if(!this.isValid)return!1;const s=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(i,r)<=s&&s<=n.endOf(i,r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const i=e.base||yi.fromObject({},{zone:this.zone}),r=e.padding?this<i?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=e.unit;return Array.isArray(e.unit)&&(s=e.unit,n=void 0),Vue(i,this.plus(r),{...e,numeric:"always",units:s,unit:n})}toRelativeCalendar(e={}){return this.isValid?Vue(e.base||yi.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(yi.isDateTime))throw new Au("min requires all arguments be DateTimes");return Eue(e,i=>i.valueOf(),Math.min)}static max(...e){if(!e.every(yi.isDateTime))throw new Au("max requires all arguments be DateTimes");return Eue(e,i=>i.valueOf(),Math.max)}static fromFormatExplain(e,i,r={}){const{locale:s=null,numberingSystem:n=null}=r,o=As.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return m2e(o,e,i)}static fromStringExplain(e,i,r={}){return yi.fromFormatExplain(e,i,r)}static get DATE_SHORT(){return uz}static get DATE_MED(){return xSe}static get DATE_MED_WITH_WEEKDAY(){return MHe}static get DATE_FULL(){return TSe}static get DATE_HUGE(){return SSe}static get TIME_SIMPLE(){return ESe}static get TIME_WITH_SECONDS(){return CSe}static get TIME_WITH_SHORT_OFFSET(){return MSe}static get TIME_WITH_LONG_OFFSET(){return ASe}static get TIME_24_SIMPLE(){return PSe}static get TIME_24_WITH_SECONDS(){return OSe}static get TIME_24_WITH_SHORT_OFFSET(){return $Se}static get TIME_24_WITH_LONG_OFFSET(){return RSe}static get DATETIME_SHORT(){return ISe}static get DATETIME_SHORT_WITH_SECONDS(){return LSe}static get DATETIME_MED(){return DSe}static get DATETIME_MED_WITH_SECONDS(){return NSe}static get DATETIME_MED_WITH_WEEKDAY(){return AHe}static get DATETIME_FULL(){return FSe}static get DATETIME_FULL_WITH_SECONDS(){return kSe}static get DATETIME_HUGE(){return USe}static get DATETIME_HUGE_WITH_SECONDS(){return VSe}}function QO(t){if(yi.isDateTime(t))return t;if(t&&t.valueOf&&SS(t.valueOf()))return yi.fromJSDate(t);if(t&&typeof t=="object")return yi.fromObject(t);throw new Au(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const pp="system",QS="unknown",dy="UTC",T9e=Intl.DateTimeFormat().resolvedOptions().timeZone,S9e="shortOffset";function E9e(t){return"timeZoneIANA"in t}function C9e(t){return t.startsWith("UTC")}function fz(t,e=!1){return{json:{read:{source:t,reader:(i,r)=>r[t]?Ok(r[t]):null},write:!!e&&{allowNull:!0,writer(i,r){r[t]=i?M9e(i):null}}}}}function Ok(t,e=pp){return t?E9e(t)?t.timeZoneIANA:A9e(t,e):e}function M9e(t){return{timeZoneIANA:t}}function A9e(t,e=pp){if(!t||!hue.has(t.timeZone))return e;const i=hue.get(t.timeZone);return C9e(t.timeZone)||t.respectsDaylightSaving?i:P9e(i)}function P9e(t){const e=yi.local().setZone(t),i=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return i===0?"Etc/UTC":`Etc/GMT${yl.instance(-i).formatOffset(0,"narrow")}`}function b2e(t,e,i,r,s){if(e&&s==="date")return{timeZone:dy,timeZoneName:void 0};const n=r.timeStyle||r.hour,o=i===QS;return{timeZone:o?s==="timestamp-offset"?void 0:t??dy:i,timeZoneName:o&&n?S9e:void 0}}const O9e={year:void 0,month:void 0,day:void 0,weekday:void 0},$9e={hour:void 0,minute:void 0,second:void 0},w2e={timeZone:dy},xm={year:"numeric",month:"numeric",day:"numeric"},KO={year:"numeric",month:"long",day:"numeric"},e$={year:"numeric",month:"short",day:"numeric"},t$={year:"numeric",month:"long",weekday:"long",day:"numeric"},I1={hour:"numeric",minute:"numeric"},Ox={...I1,second:"numeric"},x2e={hourCycle:"h23"},i$={...I1,...x2e},r$={...Ox,...x2e},T2e={"short-date":xm,"short-date-short-time":{...xm,...I1},"short-date-short-time-24":{...xm,...i$},"short-date-long-time":{...xm,...Ox},"short-date-long-time-24":{...xm,...r$},"short-date-le":xm,"short-date-le-short-time":{...xm,...I1},"short-date-le-short-time-24":{...xm,...i$},"short-date-le-long-time":{...xm,...Ox},"short-date-le-long-time-24":{...xm,...r$},"long-month-day-year":KO,"long-month-day-year-short-time":{...KO,...I1},"long-month-day-year-short-time-24":{...KO,...i$},"long-month-day-year-long-time":{...KO,...Ox},"long-month-day-year-long-time-24":{...KO,...r$},"day-short-month-year":e$,"day-short-month-year-short-time":{...e$,...I1},"day-short-month-year-short-time-24":{...e$,...i$},"day-short-month-year-long-time":{...e$,...Ox},"day-short-month-year-long-time-24":{...e$,...r$},"long-date":t$,"long-date-short-time":{...t$,...I1},"long-date-short-time-24":{...t$,...i$},"long-date-long-time":{...t$,...Ox},"long-date-long-time-24":{...t$,...r$},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":I1,"long-time":Ox},R9e=lc()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),S2e={ar:"ar-u-nu-latn-ca-gregory"};let _Z=new WeakMap;const gG=T2e["short-date-short-time"];function I9e(t){let e=_Z.get(t);if(!e){const i=zu(),r=S2e[i]||i,s=_re(t.timeZone??pp),n={...t,timeZone:s};e=new Intl.DateTimeFormat(r,n),_Z.set(t,e)}return e}function W1(t){return T2e[t]}function ku(t,e=gG){return I9e(e).format(t)}function L9e(t,e=gG){return ku(new Date(t),{...e,...w2e,...$9e})}function D9e(t,e=gG){return ku(new Date(`1970-01-01T${t}Z`),{...e,...w2e,...O9e})}function N9e(t,e=gG){if(e.timeZone)return ku(new Date(t),e);const i=yi.fromISO(t,{setZone:!0}),r=zu(),s=S2e[r]??r,n=i.offset===0?dy:e.timeZone,o={...e,timeZone:n};return i.toLocaleString(o,{locale:s})}function _re(t){switch(t){case pp:return T9e;case QS:return dy;default:return t}}cre(()=>{_Z=new WeakMap});const F9e={ar:"ar-u-nu-latn"};let $k=new WeakMap,E2e={};function vZ(t){const e=t||E2e;if(!$k.has(e)){const i=zu(),r=F9e[zu()]||i;$k.set(e,new Intl.NumberFormat(r,t))}return $k.get(e)}function mz(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function nc(t,e){return Object.is(t,-0)&&(t=0),vZ(e).format(t)}function h7t(t,e=zu()){var r,s;if(!t)return null;let i=Bue.get(e);if(!i){const n=vZ().formatToParts(12345.6),o=[...vZ({useGrouping:!1}).format(9876543210)].reverse(),a=new Map(o.map((m,g)=>[m,g])),l=new RegExp(`[${(r=n.find(m=>m.type==="group"))==null?void 0:r.value}]`,"g"),c=new RegExp(`[${(s=n.find(m=>m.type==="decimal"))==null?void 0:s.value}]`),u=new RegExp(`[${o.join("")}]`,"g"),d=/[\u200E\u200F\u202A\u202B\u202C\u202D\u202E\u2066\u2067\u2068\u2069\u061C]/g,f=/[-\u2212\u2013\u2014\u2015]/g;i=m=>{if((m=m.trim().replaceAll(l,"").replace(c,".").replace(u,y=>String(a.get(y))).replaceAll(d,"").replaceAll(f,"-"))==="")return null;const g=Number(m);return isNaN(g)?null:g},Bue.set(e,i)}return i(t)}cre(()=>{$k=new WeakMap,E2e={}});const Bue=new Map;var rTe;const nr={apiKey:void 0,applicationName:"",applicationUrl:(rTe=globalThis.location)==null?void 0:rTe.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!0,portalUrl:"https://www.arcgis.com",respectPrefersReducedMotion:!0,routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],internalInterceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(lre(nr,globalThis.esriConfig,!0),delete nr.has),!nr.assetsPath){{const t="4.30";nr.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}nr.defaultAssetsPath=nr.assetsPath}const k9e=/\{([^}]+)\}/g;function jue(t){return t??""}function py(t,e){return e?t.replaceAll(k9e,typeof e=="object"?(i,r)=>jue(RD(r,e)):(i,r)=>jue(e(r))):t}function d7t(t,e){return t.replaceAll(/([.$?*|{}()[\]\\/+\-^])/g,i=>e!=null&&e.includes(i)?i:`\\${i}`)}function vre(t){let e=0;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}let Gue;function p7t(t){return Gue??(Gue=new DOMParser),Gue.parseFromString(t||"","text/html").body.innerText||""}function Hue(t,e){return new RegExp(`{${e}}`,"ig").test(t)}function U9e(t,...e){let i=t[0];for(let r=0;r<e.length;++r)i+=e[r]+t[r+1];return i}const que={info:0,warn:1,error:2,none:3};let ne=class ah{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,ah._loggers.set(this.module,this);const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=ah.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){}static get test(){}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,ah._loggers.get(e)||new ah({module:e})}_log(e,i,...r){if(this._matchLevel(e)){if(i!=="always"&&!ah._throttlingDisabled){const s=z9e(r),n=this._loggedMessages[e].get(s);if(i==="once"&&n!=null||i==="oncePerTick"&&n&&n>=ah._tickCounter)return;this._loggedMessages[e].set(s,ah._tickCounter),ah._scheduleTickCounterIncrement()}for(const s of nr.log.interceptors)if(s(e,this.module,...r))return;this._inheritedWriter()(e,this.module,...r)}}_parentWithMember(e,i){let r=this;for(;r!=null;){const s=r[e];if(s!=null)return s;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",V9e)}_matchLevel(e){const i=nr.log.level||"warn";return que[this._parentWithMember("level",i)]<=que[e]}static _scheduleTickCounterIncrement(){ah._tickCounterScheduled||(ah._tickCounterScheduled=!0,Promise.resolve().then(()=>{ah._tickCounter++,ah._tickCounterScheduled=!1}))}};function V9e(t,e,...i){console[t](`[${e}]`,...i)}function z9e(...t){return vre(JSON.stringify(t,(i,r)=>typeof r!="object"||Array.isArray(r)?r:"[Object]"))}ne._loggers=new Map,ne._tickCounter=0,ne._tickCounterScheduled=!1,ne._throttlingDisabled=!1;const C2e=()=>ne.getLogger("esri.intl.substitute");function Pg(t,e,i={}){const{format:r={}}=i;return py(t,s=>B9e(s,e,r))}function B9e(t,e,i){let r,s;const n=t.indexOf(":");if(n===-1?r=t.trim():(r=t.slice(0,n).trim(),s=t.slice(n+1).trim()),!r)return"";const o=RD(r,e);if(o==null)return"";const a=(s?i==null?void 0:i[s]:null)??(i==null?void 0:i[r]);return a?j9e(o,a):s?G9e(o,s):bre(o)}function j9e(t,e){switch(e.type){case"date":return ku(t,e.intlOptions);case"number":return nc(t,e.intlOptions);default:return C2e().warn("missing format descriptor for key {key}"),bre(t)}}function G9e(t,e){switch(e.toLowerCase()){case"dateformat":return ku(t);case"numberformat":return nc(t);default:return C2e().warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?ku(t):/^numberformat/i.test(e)?nc(t):bre(t)}}function bre(t){switch(typeof t){case"string":return t;case"number":return nc(t);case"boolean":return""+t;default:return t instanceof Date?ku(t):""}}function H9e(t,e){return t.replaceAll(/\$\{([^\s:}]*)(?::([^\s:}]+))?\}/g,(i,r)=>r===""?"$":(RD(r,e)??"").toString())}let M2e=class{constructor(e,i,r=void 0){this.name=e,this.details=r,this.message=(i&&H9e(i,r))??""}toString(){return"["+this.name+"]: "+this.message}},B=class A2e extends M2e{constructor(e,i,r){super(e,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return re(i)}catch{return"[object]"}}))}}catch(e){throw ne.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new A2e(e.name,e.message,e.details)}};B.prototype.type="error";function q9e(t){return{setTimeout:(e,i)=>{const r=t.setTimeout(e,i);return Gi(()=>t.clearTimeout(r))}}}const ND=q9e(globalThis);function yG(t){return W9e(t)||P2e(t)}function W9e(t){return t!=null&&typeof t=="object"&&"on"in t&&typeof t.on=="function"}function P2e(t){return t!=null&&typeof t=="object"&&"addEventListener"in t&&typeof t.addEventListener=="function"}function fO(t,e,i){if(!yG(t))throw new TypeError("target is not a Evented or EventTarget object");return P2e(t)?Z9e(t,e,i):t.on(e,i)}function Z9e(t,e,i,r){if(Array.isArray(e)){const s=e.slice();for(const n of s)t.addEventListener(n,i,r);return Gi(()=>{for(const n of s)t.removeEventListener(n,i,r)})}return t.addEventListener(e,i,r),Gi(()=>t.removeEventListener(e,i,r))}function O2e(t,e,i){if(!yG(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,i);const r=fO(t,e,s=>{r.remove(),i.call(t,s)});return r}function F2(t,e){if(t==null)throw new Error(e??"value is None")}function He(t){return t==null||t.destroy(),null}function Ut(t){return t==null||t.dispose(),null}function Lr(t){return t==null||t.remove(),null}function oc(t){return t==null||t.abort(),null}function hi(t){return t==null||t.release(),null}function Y9e(t,e,i){return t!=null&&e!=null?i!=null?i(t,e):t.equals(e):t===e}function Wue(t,e){return t==null?void 0:t[e]}function X9e(t,e){let i;return t.some((r,s)=>(i=e(r,s),i!=null)),i??void 0}function Ui(t="Aborted"){return new B("AbortError",t)}function Dt(t,e="Aborted"){if(ha(t))throw Ui(e)}function _G(t){return t instanceof AbortSignal?t:t==null?void 0:t.signal}function ha(t){const e=_G(t);return e!=null&&e.aborted}function Ql(t){if(us(t))throw t}function bZ(t){if(!us(t))throw t}function Va(t,e){const i=_G(t);if(i!=null){if(!i.aborted)return O2e(i,"abort",()=>e());e()}}function FD(t,e){const i=_G(t);if(i!=null)return Dt(i),O2e(i,"abort",()=>e(Ui()))}function wre(t,e){return _G(e)==null?t:new Promise((i,r)=>{let s=Va(e,()=>r(Ui()));const n=()=>{s=Lr(s)};t.then(n,n),t.then(i,r)})}function us(t){return(t==null?void 0:t.name)==="AbortError"}async function h_(t){try{return await t}catch(e){if(!us(e))throw e;return}}async function m7t(t,e=ne.getLogger("esri")){try{return await t}catch(i){us(i)||e.error(i)}}async function nm(t){if(!t)return;if(typeof t.forEach!="function"){const i=Object.keys(t),r=i.map(o=>t[o]),s=await nm(r),n={};return i.map((o,a)=>n[o]=s[a]),n}const e=t;return Promise.allSettled(e).then(i=>Array.from(e,(r,s)=>{const n=i[s];return n.status==="fulfilled"?{promise:r,value:n.value}:{promise:r,error:n.reason}}))}async function wZ(t){return(await Promise.allSettled(t)).filter(e=>e.status==="fulfilled").map(e=>e.value)}async function J9e(t){return(await Promise.allSettled(t)).filter(e=>e.status==="rejected").map(e=>e.reason)}function KS(t,e=void 0,i){const r=new AbortController;return Va(i,()=>r.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(e)},t);Va(r,()=>{o&&(clearTimeout(o),n(Ui()))})})}function Q9e(t,e){const i=new AbortController,r=setTimeout(()=>i.abort(),e);return Va(t,()=>{i.abort(),clearTimeout(r)}),{...t,signal:i.signal}}function Zu(t){return t&&typeof t.then=="function"}function xZ(t){return Zu(t)?t:Promise.resolve(t)}function d_(t,e=-1){let i,r,s,n,o=null;const a=(...l)=>{if(i){r=l,n&&n.reject(Ui()),n=ma();const f=n.promise;if(o){const m=o;o=null,m.abort()}return f}if(s=n||ma(),n=null,e>0){const f=new AbortController;i=xZ(t(...l,f.signal));const m=i;KS(e).then(()=>{i===m&&(n?f.abort():o=f)})}else i=1,i=xZ(t(...l));const c=()=>{const f=r;r=s=i=o=null,f!=null&&a(...f)},u=i,d=s;return u.then(c,c),u.then(d.resolve,d.reject),d.promise};return a}function ma(){let t,e;const i=new Promise((s,n)=>{t=s,e=n}),r=s=>{t(s)};return r.resolve=s=>t(s),r.reject=s=>e(s),r.timeout=(s,n)=>ND.setTimeout(()=>r.reject(n),s),r.promise=i,r}function g7t(t,e){return t.then(e,e)}async function Zue(t){await Promise.resolve(),Dt(t)}const Yue=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,K9e={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function Xue(t){return t in K9e}const uR=[],_A=new Map;function Jue(t){for(const e of _A.keys())R2e(t.pattern,e)&&_A.delete(e)}function e7e(t){return uR.includes(t)||(Jue(t),uR.unshift(t)),Gi(()=>{const e=uR.indexOf(t);e>-1&&(uR.splice(e,1),Jue(t))})}async function $2e(t){const e=zu();_A.has(t)||_A.set(t,i7e(t,e));const i=_A.get(t);return i&&await r7e.add(i),i}function t7e(t){if(!Yue.test(t))return null;const e=Yue.exec(t);if(e===null)return null;const[,i,r]=e,s=i+(r?"-"+r.toUpperCase():"");return Xue(s)?s:Xue(i)?i:null}async function i7e(t,e){const i=[];for(const r of uR)if(R2e(r.pattern,t))try{return await r.fetchMessageBundle(t,e)}catch(s){i.push(s)}throw i.length?new B("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:i}):new B("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function R2e(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}cre(()=>{_A.clear()});const r7e=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=ma())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}},s7e="modulepreload",n7e=function(t){return"/digital-twin/"+t},Que={},oe=function(e,i,r){let s=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),o=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));s=Promise.all(i.map(a=>{if(a=n7e(a),a in Que)return;Que[a]=!0;const l=a.endsWith(".css"),c=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${c}`))return;const u=document.createElement("link");if(u.rel=l?"stylesheet":s7e,l||(u.as="script",u.crossOrigin=""),u.href=a,o&&u.setAttribute("nonce",o),document.head.appendChild(u),l)return new Promise((d,f)=>{u.addEventListener("load",d),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${a}`)))})}))}return s.then(()=>e()).catch(n=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n})};function h(t,e,i,r){var s,n=arguments.length,o=n<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(n<3?s(o):n>3?s(e,i,o):s(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o}function y7t(t,e){return function(i,r){e(i,r,t)}}function _7t(t,e,i,r){function s(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?n(u.value):s(u.value).then(a,l)}c((r=r.apply(t,[])).next())})}const Kue=new WeakMap;function o7e(t,e,i=!1){const r=`🛑 DEPRECATED - ${e}`;if(!i)return void t.warn(r);let s=Kue.get(t);s||(s=new Set,Kue.set(t,s)),s.has(e)||(s.add(e),t.warn(r))}function I2e(t,e,i={}){if(ue("esri-deprecation-warnings")){const{moduleName:r}=i;Nb(t,`Function: ${(r?r+"::":"")+e+"()"}`,i)}}function s_(t,e,i={}){if(ue("esri-deprecation-warnings")){const{moduleName:r}=i;Nb(t,`Property: ${(r?r+"::":"")+e}`,i)}}function a7e(t,e,i={}){ue("esri-deprecation-warnings")&&Nb(t,`Multiple argument constructor: ${e}`,{warnOnce:!0,replacement:`new ${e}({ <your properties here> })`,...i})}function Nb(t,e,i={}){if(ue("esri-deprecation-warnings")){const{replacement:r,version:s,see:n,warnOnce:o}=i;let a=e;r&&(a+=`
	🛠️ Replacement: ${r}`),s&&(a+=`
	⚙️ Version: ${s}`),n&&(a+=`
	🔗 See ${n} for more details.`),o7e(t,a,o)}}function v7t(t){const e=[];return function*(){yield*e;for(const i of t)e.push(i),yield i}}function l7e(t,e){for(const i of t)if(i!=null&&e(i))return i}function TZ(t){return t!=null&&typeof t[Symbol.iterator]=="function"}let Ey=class{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(i=>{e+=i.length}),e}add(e,i){if(TZ(e)){const r=this._getOrCreateGroup(i);for(const s of e)the(s)&&r.push(s)}else the(e)&&this._getOrCreateGroup(i).push(e);return this}forEach(e,i){if(typeof e=="function")this._groups.forEach(r=>r.forEach(e));else{const r=this._getGroup(e);r&&i&&r.forEach(i)}}has(e){return this._groups.has(aF(e))}remove(e){if(typeof e!="string"&&TZ(e)){for(const i of e)this.remove(i);return this}return this.has(e)?(ehe(this._getGroup(e)),this._groups.delete(aF(e)),this):this}removeAll(){return this._groups.forEach(ehe),this._groups.clear(),this}removeReference(e){return this._groups.delete(e),this}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const i=[];return this._groups.set(aF(e),i),i}_getGroup(e){return this._groups.get(aF(e))}};function aF(t){return t||"_default_"}function ehe(t){for(const e of t)e instanceof Ey?e.removeAll():e.remove()}function the(t){return t!=null&&(!!t.remove||t instanceof Ey)}const L2e=Symbol("Accessor-beforeDestroy");function bl(t){return t.__accessor__??null}function c7e(t,e){var i;return((i=t==null?void 0:t.metadata)==null?void 0:i[e])!=null}function Rk(t,e,i){return i?gz(t,e,{policy:i,path:""}):gz(t,e,null)}function gz(t,e,i){return e?Object.keys(e).reduce((r,s)=>{const n=s;let o=null,a="merge";if(i&&(o=i.path?`${i.path}.${s}`:s,a=i.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(r[n]))return r[n]=e[n],r;if(r[n]===void 0)return r[n]=re(e[n]),r;let l=r[n],c=e[n];if(l===c)return r;if(Array.isArray(c)||Array.isArray(r))l=l?Array.isArray(l)?r[n]=l.concat():r[n]=[l]:r[n]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(u=>{l.includes(u)||l.push(u)}));else if(c&&typeof c=="object")if(i){const u=i.path;i.path=o,r[n]=gz(l,c,i),i.path=u}else r[n]=gz(l,c,null);else r.hasOwnProperty(s)&&!e.hasOwnProperty(s)||(r[n]=c);return r},t||{}):t}function D2e(t){return Array.isArray(t)?t:t.split(".")}function ihe(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function u7e(t){if(Array.isArray(t)){const e=[];for(const i of t)e.push(...ihe(i));return e}return ihe(t)}function N2e(t,e,i,r){const s=u7e(e);if(s.length!==1){const n=s.map(o=>r(t,o,i));return JS(n)}return r(t,s[0],i)}function F2e(t,e){const i=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(e)?e[s]:e.at(s)}const r=bl(e);return c7e(r,i)?r.get(i):e[i]}function k2e(t,e,i){if(t==null)return t;const r=F2e(e[i],t);return!r&&i<e.length-1?void 0:i===e.length-1?r:k2e(r,e,i+1)}function kD(t,e,i=0){return typeof e!="string"||e.includes(".")?k2e(t,D2e(e),i):F2e(e,t)}function Gc(t,e){return kD(t,e)}function rhe(t,e){return kD(e,t)!==void 0}var Pu;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED",t[t.DESTROYED=3]="DESTROYED"})(Pu||(Pu={}));function UD(t){let e=t.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!i){e=Object.create(e);for(const r in e)e[r]=re(e[r]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function vG(t,e){const i=UD(t);let r=i[e];return r||(r=i[e]={}),r}function h7e(t,e){return Rk(t,e,p7e)}const d7e=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function p7e(t){return d7e.test(t)?"replace":"merge"}function f7e(t){return(t==null?void 0:t.release)&&typeof t.release=="function"}function m7e(t){return(t==null?void 0:t.acquire)&&typeof t.acquire=="function"}let ga=class SZ{constructor(e,i,r,s=1,n=0){if(this._ctor=e,this._acquireFunction=i,this._releaseFunction=r,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this._ctor)for(let o=0;o<n;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...e){let i;if(SZ.test.disabled)i=new this._ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let s=0;s<r;s++)this._pool[s]=new this._ctor}i=this._pool.pop()}return this._acquireFunction?this._acquireFunction(i,...e):m7e(i)&&i.acquire(...e),i}release(e){e&&!SZ.test.disabled&&(this._releaseFunction?this._releaseFunction(e):f7e(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let i=e;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};ga.test={disabled:!1};let g7e=class{constructor(e,i){this._observers=e,this._observer=i}remove(){tSe(this._observers,this._observer)}},U2e=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return y7e;this._observers==null&&(this._observers=[]);const i=this._observers;let r=!1,s=!1;const n=i.length;for(let o=0;o<n;++o){const a=i[o];if(a.destroyed)s=!0;else if(a===e){r=!0;break}}return r||(i.push(e),s&&this._removeDestroyedObservers()),new g7e(i,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const i=e.length;let r=0;for(let s=0;s<i;++s){for(;s+r<i&&e[s+r].destroyed;)++r;if(r>0){if(!(s+r<i))break;e[s]=e[s+r]}}e.length=i-r}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const i of e)i.onCommitted();this._observers=null}}};const y7e=Gi();var ki;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(ki||(ki={}));const EZ=ki.USER+1;function sb(t){switch(t){case"defaults":return ki.DEFAULTS;case"service":return ki.SERVICE;case"portal-item":return ki.PORTAL_ITEM;case"web-scene":return ki.WEB_SCENE;case"web-map":return ki.WEB_MAP;case"link-chart":return ki.LINK_CHART;case"user":return ki.USER;default:return null}}function yz(t){switch(t){case ki.DEFAULTS:return"defaults";case ki.SERVICE:return"service";case ki.PORTAL_ITEM:return"portal-item";case ki.WEB_SCENE:return"web-scene";case ki.WEB_MAP:return"web-map";case ki.LINK_CHART:return"link-chart";case ki.USER:return"user"}}function _7e(t){return yz(t)}var ps;(function(t){t[t.Dirty=1]="Dirty",t[t.Overridden=2]="Overridden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(ps||(ps={}));const _z={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},hR=[];let b3=_z;function Ft(t){b3.onObservableAccessed(t)}let Ik=!1,Lk=!1;function S_(t,e,i){if(Ik)return xre(t,e,i);V2e(t);const r=e.call(i);return z2e(),r}function v7e(t,e){return S_(_z,t,e)}function xre(t,e,i){const r=Ik;Ik=!0,V2e(t);let s=null;try{s=e.call(i)}catch(n){Lk&&ne.getLogger("esri.core.accessorSupport.tracking").error(n)}return z2e(),Ik=r,s}function V2e(t){b3=t,hR.push(t)}function z2e(){const t=hR.length;if(t>1){const e=hR.pop();b3=hR[t-2],e.onTrackingEnd()}else if(t===1){const e=hR.pop();b3=_z,e.onTrackingEnd()}else b3=_z}function B2e(t,e){if(e.flags&ps.DepTrackingInitialized)return;const i=Lk;Lk=!1,e.flags&ps.AutoTracked?xre(e,e.metadata.get,t):j2e(t,e),Lk=i}const b7e=[];function j2e(t,e){e.flags&ps.ExplicitlyTracking||(e.flags|=ps.ExplicitlyTracking,xre(e,()=>{const i=e.metadata.dependsOn||b7e;for(const r of i)if(typeof r!="string"||r.includes(".")){const s=D2e(r);for(let n=0,o=t;n<s.length&&o!=null&&typeof o=="object";++n)o=she(o,s[n],n!==s.length-1)}else she(t,r,!1)}),e.flags&=~ps.ExplicitlyTracking)}function she(t,e,i){const r=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const n=parseInt(r,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.at(n)}const s=bl(t);if(s){const n=s.propertiesByName.get(r);n&&(Ft(n),B2e(t,n))}return i?t[r]:void 0}let nhe=class extends U2e{constructor(e,i){super(),this.propertyName=e,this.metadata=i,this._accessed=null,this._handles=null,this.flags=0,this.flags=ps.Dirty|(i.nonNullable?ps.NonNullable:0)|(i.hasOwnProperty("value")?ps.HasDefaultValue:0)|(i.get===void 0?ps.DepTrackingInitialized:0)|(i.dependsOn===void 0?ps.AutoTracked:0)}destroy(){this.flags&ps.Dirty&&this.onCommitted(),super.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(e){Ft(this);const i=e.store,r=this.propertyName,s=this.flags,n=i.get(r);if(s&ps.Computing||~s&ps.Dirty&&i.has(r))return n;this.flags|=ps.Computing;const o=e.host;let a;s&ps.AutoTracked?a=S_(this,this.metadata.get,o):(j2e(o,this),a=this.metadata.get.call(o)),i.set(r,a,ki.COMPUTED);const l=i.get(r);return l===n?this.flags&=~ps.Dirty:v7e(this.commit,this),this.flags&=~ps.Computing,l}onObservableAccessed(e){e!==this&&(this._accessed??(this._accessed=new Set),this._accessed.add(e))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=ps.DepTrackingInitialized,this._accessed!=null&&(this._handles??(this._handles=[]),this._accessed.forEach(e=>{this._handles.push(e.observe(this))}),this._accessed.clear())}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=~ps.Dirty,this.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let i=0;i<e.length;++i)e[i].remove();e.length=0}}onInvalidated(){~this.flags&ps.Overridden&&(this.flags|=ps.Dirty);const e=this._observers;if(e&&e.length>0)for(const i of e)i.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onCommitted()}}},w7e=class G2e{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new G2e;return this._values.forEach((r,s)=>{e&&e.has(s)||i.set(s,re(r))}),i}get(e){return this._values.get(e)}originOf(){return ki.USER}keys(){return[...this._values.keys()]}set(e,i){this._values.set(e,i)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function lF(t,e,i){return t!==void 0}function ohe(t,e,i,r){return t!==void 0&&(!(i==null&&t.flags&ps.NonNullable)||(r.lifecycle,Pu.INITIALIZING,!1))}let x7e=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.lifecycle=Pu.INITIALIZING,this.store=new w7e,this._origin=ki.USER;const i=this.host.constructor.__accessorMetadata__;for(const r in i){const s=new nhe(r,i[r]);this.propertiesByName.set(r,s)}this.metadata=i}initialize(){this.lifecycle=Pu.CONSTRUCTING}constructed(){this.lifecycle=Pu.CONSTRUCTED}destroy(){this.lifecycle=Pu.DESTROYED,this.propertiesByName.forEach(e=>e.destroy())}get initialized(){return this.lifecycle!==Pu.INITIALIZING}get(e){const i=this.propertiesByName.get(e);if(i.metadata.get)return i.getComputed(this);Ft(i);const r=this.store;return r.has(e)?r.get(e):i.metadata.value}originOf(e){const i=this.store.originOf(e);if(i===void 0){const r=this.propertiesByName.get(e);if(r!==void 0&&r.flags&ps.HasDefaultValue)return"defaults"}return yz(i)}has(e){return this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const i=this.propertiesByName.get(e);if(lF(i))return this.store.has(e)?this.store.get(e):i.metadata.value}internalSet(e,i){const r=this.propertiesByName.get(e);lF(r)&&this._internalSet(r,i)}getDependsInfo(e,i,r){const s=this.propertiesByName.get(i);if(!lF(s))return"";const n=new Set,o=S_({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=s.metadata.get)==null?void 0:l.call(e)});let a=`${r}${e.declaredClass.split(".").pop()}.${i}: ${o}
`;if(n.size===0)return a;r+="  ";for(const l of n)l instanceof nhe&&(a+=`${r}${l.propertyName}: undefined
`);return a}setAtOrigin(e,i,r){const s=this.propertiesByName.get(e);if(lF(s))return this._setAtOrigin(s,i,r)}isOverridden(e){const i=this.propertiesByName.get(e);return i!==void 0&&!!(i.flags&ps.Overridden)}clearOverride(e){const i=this.propertiesByName.get(e);i&&i.flags&ps.Overridden&&(i.flags&=~ps.Overridden,i.notifyChange())}override(e,i){const r=this.propertiesByName.get(e);if(!ohe(r,e,i,this))return;const s=r.metadata.cast;if(s){const n=this._cast(s,i),{valid:o,value:a}=n;if(gH.release(n),!o)return;i=a}r.flags|=ps.Overridden,this._internalSet(r,i)}set(e,i){const r=this.propertiesByName.get(e);if(!ohe(r,e,i,this))return;const s=r.metadata.cast;if(s){const o=this._cast(s,i),{valid:a,value:l}=o;if(gH.release(o),!a)return;i=l}const n=r.metadata.set;n?n.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(e){this._origin=sb(e)}getDefaultOrigin(){return yz(this._origin)}notifyChange(e){const i=this.propertiesByName.get(e);i!==void 0&&i.notifyChange()}invalidate(e){const i=this.propertiesByName.get(e);i!==void 0&&i.invalidate()}commit(e){const i=this.propertiesByName.get(e);i!==void 0&&i.commit()}_internalSet(e,i){const r=this.lifecycle!==Pu.INITIALIZING?this._origin:ki.DEFAULTS;this._setAtOrigin(e,i,r)}_setAtOrigin(e,i,r){const s=this.store,n=e.propertyName;s.has(n,r)&&are(i,s.get(n))&&~e.flags&ps.Overridden&&r===s.originOf(n)||(e.invalidate(),s.set(n,i,r),e.commit(),B2e(this.host,e))}_cast(e,i){const r=gH.acquire();return r.valid=!0,r.value=i,e&&(r.value=e.call(this.host,i,r)),r}},T7e=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const gH=new ga(T7e);function vz(t,e,i){if(t&&e)if(typeof e=="object")for(const r of Object.getOwnPropertyNames(e))vz(t,r,e[r]);else{if(e.includes(".")){const s=e.split("."),n=s.splice(-1,1)[0];return void vz(Gc(t,s),n,i)}const r=t.__accessor__;r!=null&&S7e(e,r),t[e]=i}}function S7e(t,e){if(ue("esri-unknown-property-errors")&&!E7e(t,e))throw new B("set:unknown-property",C7e(t,e))}function E7e(t,e){return e.metadata[t]!=null}function C7e(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let M7e;function A7e(){return M7e}var ahe;(function(t){t[t.Ignore=0]="Ignore",t[t.Destroy=1]="Destroy",t[t.ThrowError=2]="ThrowError"})(ahe||(ahe={}));function P7e(t){t.length=0}let Ou=class{constructor(e=50,i=50){this._pool=new ga(Array,void 0,P7e,i,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return yH.acquire()}static release(e){return yH.release(e)}static prune(){yH.prune()}};const yH=new Ou(100);let H2e=class extends ga{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(...e){const i=super.acquire(...e);return this._set.delete(i),i}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const cF=[];function tP(t){cF.push(t),cF.length===1&&queueMicrotask(()=>{const e=cF.slice();cF.length=0;for(const i of e)i()})}let n_=class{constructor(e,i=30){this.name=e,this._counter=0,this._samples=new Array(i)}record(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,i)=>e-i)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,i)=>e+i,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var CZ;(function(t){const e=(n,o,a,l)=>{let c=o,u=o;const d=a>>>1,f=n[c-1];for(;u<=d;){u=c<<1,u<a&&l(n[u-1],n[u])<0&&++u;const m=n[u-1];if(l(m,f)<=0)break;n[c-1]=m,c=u}n[c-1]=f},i=(n,o)=>n<o?-1:n>o?1:0;function r(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let u=a>>>1;u>o;u--)e(n,u,a,l);const c=o+1;for(let u=a-1;u>o;u--){const d=n[o];n[o]=n[u],n[u]=d,e(n,c,u,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let u=a>>>1;u>o;u--)e(n,u,a,l),yield;const c=o+1;for(let u=a-1;u>o;u--){const d=n[o];n[o]=n[u],n[u]=d,e(n,c,u,l),yield}}t.sort=r,t.iterableSort=s})(CZ||(CZ={}));const lhe=CZ,O7e=1.5,$7e=1.1;let ai=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new KTe,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>che(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const i=new Array;for(let r=0;r<this._length;r++){const s=this.data[r];e(s)&&i.push(s)}return i}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,i){const r=this.data.indexOf(e,i);return r!==-1&&r<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let i=e;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,i=e.length){for(let r=0;r<i;r++)this.data[this._length++]=e[r]}fill(e,i){for(let r=0;r<i;r++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,che(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const i=uZ(this.data,e,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(uZ(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,i=e.length,r){this.length=nHe(this.data,e,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,i){if(e>=this.length||i>=this.length||e===i)return;const r=this.data[e];this.data[e]=this.data[i],this.data[i]=r}sort(e){lhe.sort(this.data,0,this.length,e)}iterableSort(e){return lhe.iterableSort(this.data,0,this.length,e)}some(e,i){for(let r=0;r<this.length;++r)if(e.call(i,this.data[r],r,this.data))return!0;return!1}find(e,i){for(let r=0;r<this.length;++r){const s=this.data[r];if(e.call(i,s,r))return s}}filterInPlace(e,i){let r=0;for(let s=0;s<this._length;++s){const n=this.data[s];e.call(i,n,s,this.data)&&(this.data[s]=this.data[r],this.data[r]=n,r++)}if(this._deallocator)for(let s=r;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=r,this._shrink(),this}forAll(e,i){const{data:r,length:s}=this;for(let n=0;n<s;++n)e.call(i,r[n],n,r)}forEach(e,i){this.data.slice(0,this.length).forEach(e,i)}map(e,i){const r=new Array(this.length);for(let s=0;s<this.length;++s)r[s]=e.call(i,this.data[s],s,this.data);return r}reduce(e,i){let r=i;for(let s=0;s<this.length;++s)r=e(r,this.data[s],s,this.data);return r}has(e){const i=this.length,r=this.data;for(let s=0;s<i;++s)if(r[s]===e)return!0;return!1}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.data[e]}};function che(t){t.data.length>O7e*t.length&&(t.data.length=Math.floor(t.length*$7e))}function O7t(t){return t}function q2e(t){return 1e3*t}function $7t(t){return t}function Tre(t){return .001*t}let R7e=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},I7e=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},MZ=0,AZ=0;const s$={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},PZ=["prepare","preRender","render","postRender","update","finish"],OZ=[],e2=new ai;let L7e=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};function D7e(){ES!=null&&(cancelAnimationFrame(ES),ES=requestAnimationFrame(Sre))}const bz={frameTasks:e2,willDispatch:!1,clearFrameTasks:N7e,dispatch:Z2e,executeFrameTasks:k7e,reschedule:D7e};function k2(t){const e=new I7e(t);return OZ.push(e),bz.willDispatch||(bz.willDispatch=!0,tP(Z2e)),e}function t2(t){const e=new R7e(t);return e2.push(e),ES==null&&(MZ=performance.now(),ES=requestAnimationFrame(Sre)),new L7e(e)}let ES=null;function N7e(t=!1){e2.forAll(e=>{e.removed=!0}),t&&W2e()}function F7e(t){AZ=Math.max(0,t)}function Sre(){const t=performance.now();ES=null,ES=e2.length>0?requestAnimationFrame(Sre):null,bz.executeFrameTasks(t)}function k7e(t){const e=t-MZ;MZ=t;const i=AZ>0?AZ:1e3/60,r=Math.max(0,e-i);s$.time=t,s$.frameDuration=i-r;for(let s=0;s<PZ.length;s++){const n=performance.now(),o=PZ[s];e2.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(s$.elapsedFrameTime=performance.now()-t,s$.deltaTime=a.ticks===0?0:e,(l=a.phases[o])==null||l.call(a,s$)))}),z7e[s].record(performance.now()-n)}W2e(),B7e.record(performance.now()-t)}const uF=new ai;function W2e(){e2.forAll(t=>{t.removed&&uF.push(t)}),e2.removeUnorderedMany(uF.data,uF.length),uF.clear()}function Z2e(){for(;OZ.length;){const t=OZ.shift();t.isActive&&t.callback()}bz.willDispatch=!1}function U7e(t=1,e){const i=ma(),r=()=>{ha(e)?i.reject(Ui()):t===0?i():(--t,tP(()=>r()))};return r(),i.promise}function V7e(t){return U7e(1,t)}async function D7t(){await V7e(),await new Promise(t=>requestAnimationFrame(t))}const z7e=PZ.map(t=>new n_(t)),B7e=new n_("total");function Dk(t,e){for(const i of t.entries())if(e(i[0]))return!0;return!1}function wz(t,e){if(!e)return t;for(const i of e)i!=null&&t.add(i);return t}function uhe(t,e){return e!=null&&t.add(e),t}function Y2e(t,e){const i=new Set;return wz(i,t),wz(i,e),i}function j7e(t,e){const i=new Set;for(const r of e)t.has(r)&&i.add(r);return i}function N7t(t,e){if(!t||!e)return!1;if(t===e)return!0;for(const i of t)if(!e.has(i))return!1;return!0}function F7t(t,e){if(t==null&&e==null)return!0;if(t==null||e==null||t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function G7e(t,e){const i=new Set(t);for(const r of e)i.delete(r);return i}function H7e(t,e){return G7e(Y2e(t,e),j7e(t,e))}let q7e=0;const W7e=0;function zh(){return++q7e}let bG=class{constructor(e){this._accessed=new Set,this._handles=[],this._observerObject=new Z7e(e),hhe.register(this,new WeakRef(this._observerObject),this)}destroy(){var e;hhe.unregister(this._observerObject),this._accessed.clear(),(e=this._observerObject)==null||e.destroy(),this.clear()}onObservableAccessed(e){this._accessed.add(e)}onTrackingEnd(){const e=this._handles,i=this._observerObject;this._accessed.forEach(r=>{e.push(r.observe(i))}),this._accessed.clear()}clear(){const e=this._handles;for(let i=0;i<e.length;++i)e[i].remove();e.length=0}},Z7e=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=Y7e}};const hhe=new FinalizationRegistry(t=>{var e;(e=t.deref())==null||e.destroy()});function Y7e(){}let vA=!1;const xz=[];function X2e(t,e){let i=new bG(n),r=null,s=!1;function n(){if(!i||s)return;if(vA)return void K2e(n);const a=r;i.clear(),vA=!0,s=!0,r=S_(i,t),s=!1,vA=!1,e(r,a),eEe()}function o(){i&&(i.destroy(),i=null,r=null)}return s=!0,r=S_(i,t),s=!1,Gi(o)}function J2e(t,e){let i=new bG(s),r=null;function s(){e(r,o)}function n(){i&&(i.destroy(),i=null),r=null}function o(){return i?(i.clear(),r=S_(i,t),r):null}return o(),Gi(n)}function Q2e(t){let e=new bG(r),i=!1;function r(){e&&!i&&(vA?K2e(r):(e.clear(),vA=!0,i=!0,S_(e,t),i=!1,vA=!1,eEe()))}function s(){e&&(e.destroy(),e=null)}return i=!0,S_(e,t),i=!1,Gi(s)}function K2e(t){xz.includes(t)||xz.unshift(t)}function eEe(){for(;xz.length;)xz.pop()()}var w3;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(w3||(w3={}));let EL=class{constructor(){this.uid=zh(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,i,r,s,n){return this.pool.acquire(w3.Untracked,e,i,r,s,n,are)}static acquireTracked(e,i,r,s){return this.pool.acquire(w3.Tracked,e,i,r,null,null,s)}notify(e,i){this.type===w3.Untracked?this.callback.call(this.target,e,i,this.path,this.target):this.callback.call(null,e,i,void 0,void 0)}acquire(e,i,r,s,n,o,a){this.uid=zh(),this.removed=!1,this.type=e,this.oldValue=i,this.callback=r,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=zh(),this.removed=!0}};EL.pool=new H2e(EL);const Nk=new Ou,p_=new Set;let Tz;function Sz(t){p_.delete(t),p_.add(t),Tz||(Tz=k2(Q7e))}function X7e(t){if(t.removed)return;const e=t.oldValue,i=t.getValue();t.equals(e,i)||(t.oldValue=i,t.notify(i,e))}function J7e(t){for(const e of p_.values())e.target===t&&(e.removed=!0)}function Q7e(){let t=10;for(;Tz&&t--;){Tz=null;const e=K7e(),i=Nk.acquire();for(const r of e){const s=r.uid;X7e(r),s===r.uid&&r.removed&&i.push(r)}for(const r of p_)r.removed&&(i.push(r),p_.delete(r));for(const r of i)EL.pool.release(r);Nk.release(i),Nk.release(e),$Z.forEach(r=>r())}}function K7e(){const t=Nk.acquire();t.length=p_.size;let e=0;for(const i of p_)t[e]=i,++e;return p_.clear(),t}const $Z=new Set;function tEe(t){return $Z.add(t),Gi(()=>$Z.delete(t))}function eWe(t,e,i){let r=N2e(t,e,i,(s,n,o)=>{let a,l,c=J2e(()=>kD(s,n),(u,d)=>{var f;((f=s.__accessor__)==null?void 0:f.lifecycle)===Pu.DESTROYED||a&&a.uid!==l?r.remove():(a||(a=EL.acquireUntracked(u,o,d,s,n),l=a.uid),Sz(a))});return Gi(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,Sz(a)),a=null),r=c=null})});return r}function tWe(t,e,i){const r=N2e(t,e,i,(s,n,o)=>{let a=!1;return X2e(()=>kD(s,n),(l,c)=>{s.__accessor__.lifecycle!==Pu.DESTROYED?a||(a=!0,are(c,l)||o.call(s,l,c,n,s),a=!1):r.remove()})});return r}function iWe(t,e,i,r=!1){return t.__accessor__&&t.__accessor__.lifecycle!==Pu.DESTROYED?r?tWe(t,e,i):eWe(t,e,i):Gi()}function rWe(t,e,i){let r,s,n=J2e(t,(o,a)=>{r&&r.uid!==s?n.remove():(r||(r=EL.acquireTracked(o,e,a,i),s=r.uid),Sz(r))});return Gi(()=>{n.remove(),r&&(r.uid!==s||r.removed||(r.removed=!0,Sz(r)),r=null),n=null})}function sWe(t,e,i){let r=!1;return X2e(t,(s,n)=>{r||(r=!0,i(n,s)||e(s,n),r=!1)})}function nWe(t,e,i=!1,r=pSe){return i?sWe(t,e,r):rWe(t,e,r)}function dhe(t){return Dk(p_,e=>e.oldValue===t)}function Fh(t,e){for(const[i,r]of t)if(e(r,i))return!0;return!1}function z7t(t,e){for(const[i,r]of t)if(e(r,i))return r;return null}function VD(t,e,i){const r=t.get(e);if(r!==void 0)return r;const s=i();return t.set(e,s),s}function B7t(t){const e=new Map;return i=>(e.has(i)||e.set(i,t(i)),e.get(i))}const bA=()=>ne.getLogger("esri.core.accessorSupport.ensureTypes");function oWe(t){return t==null?t:new Date(t)}function aWe(t){return t==null?t:!!t}function zD(t){return t==null?t:t.toString()}function Wd(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function Ere(t){return t==null?t:Math.round(parseFloat(t))}function lWe(t){return null}function iEe(t){return(t==null?void 0:t.constructor)&&t.constructor.__accessorMetadata__!==void 0}function Ez(t,e){return e!=null&&t&&!(e instanceof t)}function rEe(t){return t&&"isCollection"in t}function phe(t){return t!=null&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function cWe(t,e){if(!(e!=null&&e.constructor)||!rEe(e.constructor))return RZ(t,e)?e:new t(e);const i=phe(t.prototype.itemType),r=phe(e.constructor.prototype.itemType);return i?r?i===r?e:i.prototype.isPrototypeOf(r.prototype)?new t(e):(RZ(t,e),e):new t(e):e}function RZ(t,e){return!!iEe(e)&&(bA().error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+wG(t)+"'"),!0)}function i2(t,e){return e==null?e:rEe(t)?cWe(t,e):Ez(t,e)?RZ(t,e)?e:new t(e):e}function wG(t){var e;return((e=t==null?void 0:t.prototype)==null?void 0:e.declaredClass)||"unknown"}const uWe=new WeakMap;function hWe(t){switch(t){case Number:return Wd;case Ji:return Ere;case Boolean:return aWe;case String:return zD;case Date:return oWe;case mO:return lWe;default:return VD(uWe,t,()=>i2.bind(null,t))}}function nn(t,e){const i=hWe(t);return arguments.length===1?i:i(e)}function CL(t,e,i){return arguments.length===1?CL.bind(null,t):e&&(Array.isArray(e)?e.map(r=>t(r,i)):[t(e,i)])}function dWe(t,e){return arguments.length===1?CL(i=>nn(t,i)):CL(i=>nn(t,i),e)}function sEe(t,e,i){return e!==0&&Array.isArray(i)?i.map(r=>sEe(t,e-1,r)):t(i)}function Cz(t,e,i){if(arguments.length===2)return n=>Cz(t,e,n);if(!i)return i;i=sEe(t,e,i);let r=e,s=i;for(;r>0&&Array.isArray(s);)r--,s=s[0];if(s!==void 0)for(let n=0;n<r;n++)i=[i];return i}function pWe(t,e,i){return arguments.length===2?Cz(r=>nn(t,r),e):Cz(r=>nn(t,r),e,i)}function nEe(t){return!!Array.isArray(t)&&!t.some(e=>{const i=typeof e;return!(i==="string"||i==="number"||i==="function"&&t.length>1)})}function IZ(t,e){if(arguments.length===2)return IZ(t).call(null,e);const i=new Set,r=t.filter(a=>typeof a!="function"),s=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||i.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,u=c==="string"||c==="number";return u&&(i.has(a)||s.some(d=>c==="string"&&d===String||c==="number"&&d===Number))||c==="object"&&s.some(d=>!Ez(a,d))?a:(u&&r.length?(n||(n=r.map(d=>typeof d=="string"?`'${d}'`:`${d}`).join(", ")),bA().error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(d=>wG(d)).join(", ")),bA().error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):bA().error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function om(t,e){if(arguments.length===2)return om(t).call(null,e);const i={},r=[],s=[];for(const l in t.typeMap){const c=t.typeMap[l];i[l]=nn(c),r.push(wG(c)),s.push(l)}const n=()=>`'${r.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!Ez(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,u=i[c];if(!u)return bA().error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!Ez(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!iEe(l)){const d={};for(const f in l)f!==t.key&&(d[f]=l[f]);return u(d)}return u(l)}}let Ji=class{},mO=class{};const H7t={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function fWe(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function oEe(t){switch(t.type){case"native":return nn(t.value);case"array":return CL(oEe(t.value));case"one-of":return mWe(t);default:return null}}function mWe(t){let e=null;return(i,r)=>DZ(i,t)?i:(e==null&&(e=LZ(t)),bA().error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),r&&(r.valid=!1),null)}function LZ(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Ji:return"integer";case Date:return"date";case mO:return"null";default:return wG(t.value)}case"array":return`array of ${LZ(t.value)}`;case"one-of":{const e=t.values.map(i=>LZ(i));return`one of ${e.slice(0,-1)} or ${e[e.length-1]}`}}return"unknown"}function DZ(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case Ji:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string";case mO:return t===null}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(i=>!DZ(i,e.value));case"one-of":return e.values.some(i=>DZ(t,i))}}function p(t={}){return(e,i)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(e,i),s=vG(e,i);r&&(r.get||r.set?(s.get=r.get||s.get,s.set=r.set||s.set):"value"in r&&("value"in t&&ne.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${e.constructor.name}" already defined in the metadata`,t),s.value=t.value=r.value)),t.readOnly!=null&&(s.readOnly=t.readOnly);const n=t.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let u;s.dependsOn=[l],s.get=function(){let d=Gc(this,l);if(typeof d=="function"){u||(u=l.split(".").slice(0,-1).join("."));const f=Gc(this,u);f&&(d=d.bind(f))}return d},s.readOnly||(s.set=c?function(d){this._override(i,d)}:function(d){vz(this,l,d)})}const o=t.type,a=t.types;s.cast||(o?s.cast=gWe(o):a&&(Array.isArray(a)?s.cast=CL(om(a[0])):s.cast=om(a))),h7e(s,t),t.range&&(s.cast=yWe(s.cast,t.range))}}function aEe(t,e,i){const r=vG(t,i);r.json||(r.json={});let s=r.json;return e!==void 0&&(s.origins||(s.origins={}),s.origins[e]||(s.origins[e]={}),s=s.origins[e]),s}function gWe(t){let e=0,i=t;if(fWe(t))return oEe(t);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],e++;const r=i;if(nEe(r))return e===0?IZ(r):Cz(IZ(r),e);if(e===1)return dWe(r);if(e>1)return pWe(r,e);const s=t;return s.from?s.from:nn(s)}function yWe(t,e){return i=>{let r=+t(i);return e.step!=null&&(r=Math.round(r/e.step)*e.step),e.min!=null&&(r=Math.max(e.min,r)),e.max!=null&&(r=Math.min(e.max,r)),r}}function _We(t){if(t.json&&t.json.origins){const e=t.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(e[r]){const s=e[r];i[r].forEach(n=>{e[n]=s}),delete e[r]}}}let fy=class extends M2e{constructor(e,i,r){super(e,i,r)}};fy.prototype.type="warning";function lEe(t){var e;return!!t&&((e=t.prototype)==null?void 0:e.declaredClass)&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const NZ=()=>ne.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function fhe(t,e,i){var r,s;t&&(!i&&!e.read||(r=e.read)!=null&&r.reader||((s=e.read)==null?void 0:s.enabled)===!1||wWe(t)&&ua("read.reader",gO(t),e))}function gO(t){var i,r;const e=t.ndimArray??0;if(e>1)return bWe(t);if(e===1)return mhe(t);if("type"in t&&uEe(t.type)){const s=(r=(i=t.type.prototype)==null?void 0:i.itemType)==null?void 0:r.Type,n=mhe(typeof s=="function"?{type:s}:{types:s});return(o,a,l)=>{const c=n(o,a,l);return c&&new t.type(c)}}return Cre(t)}function Cre(t){return"type"in t?vWe(t.type):xWe(t.types)}function vWe(t){return t.prototype.read?(e,i,r)=>{if(e==null)return e;const s=typeof e;if(s!=="object")return void NZ().error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${s}'`);const n=new t;return n.read(e,r),n}:t.fromJSON}function cEe(t,e,i,r){return r!==0&&Array.isArray(e)?e.map(s=>cEe(t,s,i,r-1)):t(e,void 0,i)}function bWe(t){const e=Cre(t),i=cEe.bind(null,e),r=t.ndimArray??0;return(s,n,o)=>{if(s==null)return s;s=i(s,o,r);let a=r,l=s;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)s=[s];return s}}function mhe(t){const e=Cre(t);return(i,r,s)=>{if(i==null)return i;if(Array.isArray(i)){const o=[];for(const a of i){const l=e(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=e(i,void 0,s);return n!==void 0?[n]:void 0}}function uEe(t){if(!lEe(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?Mre(e.Type):hEe(e.Type))}function wWe(t){return"types"in t?hEe(t.types):Mre(t.type)}function Mre(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||uEe(t))}function hEe(t){for(const e in t.typeMap)if(!Mre(t.typeMap[e]))return!1;return!0}function xWe(t){let e=null;const i=t.errorContext??"type",r=t.validate;return(s,n,o)=>{if(s==null)return s;const a=typeof s;if(a!=="object")return void NZ().error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);e||(e=TWe(t));const l=t.key;if(typeof l!="string")return;const c=s[l],u=c?e[c]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!u){const f=`Type '${c||"unknown"}' is not supported`;return o!=null&&o.messages&&s&&o.messages.push(new fy(`${i}:unsupported`,f,{definition:s,context:o})),void NZ().error(f)}const d=new u;return d.read(s,o),r?r(d):d}}function TWe(t){var i,r;const e={};for(const s in t.typeMap){const n=t.typeMap[s],o=UD(n.prototype);if(typeof t.key=="function")continue;const a=o[t.key];if(!a)continue;if((i=a.json)!=null&&i.type&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"){e[a.json.type[0]]=n;continue}const l=(r=a.json)==null?void 0:r.write;if(!(l!=null&&l.writer)){e[s]=n;continue}const c=l.target,u=typeof c=="string"?c:t.key,d={};l.writer(s,d,u),d[u]&&(e[d[u]]=n)}return e}function SWe(t){if(t.json||(t.json={}),yhe(t.json),_he(t.json),ghe(t.json),t.json.origins)for(const e in t.json.origins)yhe(t.json.origins[e]),_he(t.json.origins[e]),ghe(t.json.origins[e]);return!0}function ghe(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function yhe(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function _he(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function vhe(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const i=(t==null?void 0:t.ndimArray)??0;t&&(i===1||"type"in t&&lEe(t.type))?e.write.writer=MWe:i>1?e.write.writer=AWe(i):e.types?Array.isArray(e.types)?e.write.writer=CWe(e.types[0]):e.write.writer=EWe(e.types):e.write.writer=ML}function EWe(t){return(e,i,r,s)=>e?dEe(e,t,s)?ML(e,i,r,s):void 0:ML(e,i,r,s)}function dEe(t,e,i){for(const r in e.typeMap)if(t instanceof e.typeMap[r])return!0;if(i!=null&&i.messages){const r=e.errorContext??"type",s=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;i&&i.messages&&t&&i.messages.push(new B(`${r}:unsupported`,s,{definition:t,context:i})),ne.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function CWe(t){return(e,i,r,s)=>!e||!Array.isArray(e)?ML(e,i,r,s):ML(e.filter(n=>dEe(n,t,s)),i,r,s)}function ML(t,e,i,r){ua(i,Mz(t,r),e)}function Mz(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?Az(t):t}function Az(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function MWe(t,e,i,r){let s;t===null?s=null:t&&typeof t.map=="function"?(s=t.map(n=>Mz(n,r)),typeof s.toArray=="function"&&(s=s.toArray())):s=[Mz(t,r)],ua(i,s,e)}function pEe(t,e,i){return i!==0&&Array.isArray(t)?t.map(r=>pEe(r,e,i-1)):Mz(t,e)}function AWe(t){return(e,i,r,s)=>{let n;if(e===null)n=null;else{n=pEe(e,s,t);let o=t,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}ua(r,n,i)}}function PWe(t,e){return Are(t,"any",e==null?void 0:e.origin)}function FZ(t,e){return Are(t,"read",e==null?void 0:e.origin)}function fEe(t,e){return Are(t,"write",e==null?void 0:e.origin)}function Are(t,e,i){let r=t==null?void 0:t.json;if(r!=null&&r.origins&&i){let s;s=i==="link-chart"?r.origins[i]&&(e==="any"||e in r.origins[i])?r.origins[i]:r.origins["web-map"]:r.origins[i],s&&(e==="any"||e in s)&&(r=s)}return r}function OWe(t){var i;const e=$We(t);if(t.json.origins)for(const r in t.json.origins){const s=t.json.origins[r],n=s.types?RWe(s):e;fhe(n,s,!1),s.types&&!s.write&&((i=t.json.write)!=null&&i.enabled)&&(s.write={...t.json.write}),vhe(n,s)}fhe(e,t.json,!0),vhe(e,t.json)}function $We(t){return t.json.types?kZ(t.json):t.type?mEe(t):kZ(t)}function RWe(t){return t.type?mEe(t):kZ(t)}function mEe(t){if(!t.type)return;let e=0,i=t.type;for(;Array.isArray(i)&&!nEe(i);)i=i[0],e++;return{type:i,ndimArray:e}}function kZ(t){if(!t.types)return;let e=0,i=t.types;for(;Array.isArray(i);)i=i[0],e++;return{types:i,ndimArray:e}}function IWe(t){SWe(t)&&(_We(t),OWe(t))}const _H=new Set,vH=new Set;function I(t){return e=>{t??(t="esri.core.Accessor"),e.prototype.declaredClass=t,DWe(e);const i=[],r=[];let s=e.prototype;for(;s;)s.hasOwnProperty("initialize")&&!_H.has(s.initialize)&&(_H.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!vH.has(s.destroy)&&(vH.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);_H.clear(),vH.clear();const n=class extends e{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;const c=this[L2e];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let u=0;u<r.length;u++)r[u].call(this)}}})}Object.defineProperty(this,Symbol.dispose,{enumerable:!1,configurable:!0,value(){this.destroy()}}),this.postscript()}}};n.__accessorMetadata__=UD(e.prototype),n.prototype.declaredClass=t;const o=(t||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(n,"name",{value:o,configurable:!0}),n}}function LWe(t,e){return e.get==null?function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r===void 0)return;Ft(r);const s=i.store;return s.has(t)?s.get(t):r.metadata.value}:function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r!==void 0)return r.getComputed(i)}}function DWe(t){const e=t.prototype,i=UD(e),r={};for(const s of Object.getOwnPropertyNames(i)){const n=i[s];IWe(n),r[s]={enumerable:!0,configurable:!0,get:LWe(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this))return a.initialized&&n.readOnly?bhe("read-only",s):a.lifecycle===Pu.CONSTRUCTED&&n.constructOnly?bhe("construct-only",s):void a.set(s,o)}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,r)}const bhe=(t,e)=>{ne.getLogger("esri.core.Accessor").error(`cannot assign to ${t} property '${e}'`)};var gEe,yEe;function NWe(t){var e;if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return(e=t.constructor)!=null&&e.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const qm=Symbol("Accessor-Handles"),UZ=Symbol("Accessor-Initialized");let Ue=class _Ee{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:s}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}UD(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const u=this.inherited;let d;this.inherited=function(...f){if(n.prototype[a])return n.prototype[a].apply(this,f)};try{d=l.apply(this,c)}catch(f){throw this.inherited=u,f}return this.inherited=u,d}:e[a]}for(const a in i){const l=NWe(i[a]);p(l)(o.prototype,a)}return I(r)(o)}constructor(...e){var r;if(this[gEe]=null,this[yEe]=!1,this.constructor===_Ee)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const i=new x7e(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:i}),e.length>0&&(i.ctorArgs=((r=this.normalizeCtorArgs)==null?void 0:r.apply(this,e))??e[0])}postscript(){const e=this.__accessor__,i=e.ctorArgs;e.initialize(),i&&(this.set(i),e.ctorArgs=null),e.constructed(),this.initialize(),this[UZ]=!0}initialize(){}[L2e](){this[qm]=He(this[qm])}destroy(){var e;this.destroyed||(J7e(this),this.__accessor__.destroy(),(e=A7e())==null||e.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[UZ]}get destroyed(){var e;return((e=this.__accessor__)==null?void 0:e.lifecycle)===Pu.DESTROYED||!1}commitProperty(e){Gc(this,e)}get(e){return I2e(ne.getLogger(this),"`Accessor.get` is deprecated in favor of using optional chaining",{version:"4.28",see:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining"}),Gc(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,i){return vz(this,e,i),this}watch(e,i,r){return iWe(this,e,i,r)}addHandles(e,i){if(this.destroyed){const r=Array.isArray(e)?e:[e];for(const s of r)s.remove();return}(this[qm]??(this[qm]=new Ey)).add(e,i)}removeHandles(e){var i;(i=this[qm])==null||i.remove(e)}removeAllHandles(){var e;(e=this[qm])==null||e.removeAll()}removeHandlesReference(e){var i;(i=this[qm])==null||i.removeReference(e)}hasHandles(e){var i;return((i=this[qm])==null?void 0:i.has(e))===!0}_override(e,i){i===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,i){i==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,i){return this.__accessor__.internalSet(e,i),this}};gEe=qm,yEe=UZ;let FWe=class vEe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new vEe;return this._values.forEach((r,s)=>{e&&e.has(s)||i.set(s,re(r.value),r.origin)}),i}get(e,i){i=this._normalizeOrigin(i);const r=this._values.get(e);return i==null||(r==null?void 0:r.origin)===i?r==null?void 0:r.value:void 0}originOf(e){var i;return((i=this._values.get(e))==null?void 0:i.origin)??ki.USER}keys(e){e=this._normalizeOrigin(e);const i=[...this._values.keys()];return e==null?i:i.filter(r=>{var s;return((s=this._values.get(r))==null?void 0:s.origin)===e})}set(e,i,r){if((r=this._normalizeOrigin(r))===ki.DEFAULTS){const s=this._values.get(e);if((s==null?void 0:s.origin)!=null&&s.origin>r)return}this._values.set(e,new kWe(i,r))}delete(e,i){var r;(i=this._normalizeOrigin(i))!=null&&((r=this._values.get(e))==null?void 0:r.origin)!==i||this._values.delete(e)}has(e,i){var r;return(i=this._normalizeOrigin(i))!=null?((r=this._values.get(e))==null?void 0:r.origin)===i:this._values.has(e)}forEach(e){this._values.forEach(({value:i},r)=>e(i,r))}_normalizeOrigin(e){if(e!=null)return e===ki.DEFAULTS?e:ki.USER}},kWe=class{constructor(e,i){this.value=e,this.origin=i}};function bEe(t,e,i){e.keys().forEach(s=>{i.set(s,e.get(s),ki.DEFAULTS)});const r=t.metadata;Object.keys(r).forEach(s=>{t.internalGet(s)&&i.set(s,t.internalGet(s),ki.DEFAULTS)})}function UWe(t,e,i){if(!(t!=null&&t.read)||t.read.enabled===!1||!t.read.source)return!1;const r=t.read.source;if(typeof r=="string"){if(r===e||r.includes(".")&&r.indexOf(e)===0&&rhe(r,i))return!0}else for(const s of r)if(s===e||s.includes(".")&&s.indexOf(e)===0&&rhe(s,i))return!0;return!1}function VWe(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function zWe(t,e,i,r,s){let n=FZ(e[i],s);VWe(n)&&(t[i]=!0);for(const o of Object.getOwnPropertyNames(e))n=FZ(e[o],s),UWe(n,i,r)&&(t[o]=!0)}function BWe(t,e,i,r){const s=i.metadata,n=PWe(s[e],r),o=n==null?void 0:n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,r):o;a!==void 0&&i.set(e,a)}const wEe={origin:"service"};function xEe(t,e,i=wEe){if(!e||typeof e!="object")return;const r=bl(t),s=r.metadata,n={};for(const o of Object.getOwnPropertyNames(e))zWe(n,s,o,e,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(n)){const a=FZ(s[o],i).read,l=a==null?void 0:a.source;let c;c=l&&typeof l=="string"?kD(e,l):e[o],a!=null&&a.reader&&(c=a.reader.call(t,c,e,i)),c!==void 0&&r.set(o,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||BWe(t,o,r,i)}r.setDefaultOrigin("user")}function TEe(t,e,i,r=wEe){var n;const s={...r,messages:[]};i(s),(n=s.messages)==null||n.forEach(o=>{o.type!=="warning"||t.loaded?r!=null&&r.messages&&r.messages.push(o):t.loadWarnings.push(o)})}function jWe(t,e,i,r,s){var o,a;const n={};return(a=(o=e.write)==null?void 0:o.writer)==null||a.call(t,r,n,i,s),n}function SEe(t,e,i,r,s,n){if(!(r!=null&&r.write))return!1;const o=Gc(t,i);if(!s&&r.write.overridePolicy){const a=r.write.overridePolicy.call(t,o,i,n??void 0);a!==void 0&&(s=a)}if(s||(s=r.write),!s||s.enabled===!1||s.layerContainerTypes&&(n!=null&&n.layerContainerType)&&!s.layerContainerTypes.includes(n.layerContainerType))return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new B("web-document-write:property-required",`Missing value for required property '${i}' on '${t.declaredClass}'`,{propertyName:i,target:t});return a&&(n!=null&&n.messages)?n.messages.push(a):a&&!n&&ne.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||!s.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(i)===ki.DEFAULTS)&&GWe(t,i,n,r,o)||!s.ignoreOrigin&&(n!=null&&n.origin)&&e.store.multipleOriginsSupported&&e.store.originOf(i)<sb(n.origin))}function GWe(t,e,i,r,s){const n=r.default;if(n===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(t,e,i??void 0);return Lb(o,s)}return!1}return n===s}function HWe(t,e,i,r){const s=bl(t),n=s.metadata,o=fEe(n[e],r);return!!o&&SEe(t,s,e,o,i,r)}function EEe(t,e,i){var n,o;if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return Rk(e,t.toJSON(i));const r=bl(t),s=r.metadata;for(const a in s){const l=fEe(s[a],i);if(!SEe(t,r,a,l,void 0,i))continue;const c=Gc(t,a),u=jWe(t,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,i);Object.keys(u).length>0&&(e=Rk(e,u),(o=(n=i==null?void 0:i.resources)==null?void 0:n.pendingOperations)!=null&&o.length&&i.resources.pendingOperations.push(Promise.all(i.resources.pendingOperations).then(()=>Rk(e,u,()=>"replace-arrays"))),i!=null&&i.writtenProperties&&i.writtenProperties.push({target:t,propName:a,oldOrigin:_7e(r.store.originOf(a)),newOrigin:i.origin}))}return e}const BD=t=>{let e=class extends t{constructor(...i){super(...i);const r=bl(this),s=r.store,n=new FWe;r.store=n,bEe(r,s,n)}read(i,r){xEe(this,i,r)}write(i,r){return EEe(this,i??{},r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return qWe.call(this,i,r)}};return e=h([I("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function qWe(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(t,e),i}function Pz(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}let Se=class extends BD(Ue){};Se=h([I("esri.core.JSONSupport")],Se);const WWe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,ZWe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function whe(t){const e=t==null?void 0:t.match(WWe);if(!e)return null;const[,i,r,s]=e;if(!i)return null;let n=null,o=null,a=null;const{devext:l,qaext:c,www:u}=ZWe;if(r)if(n=i,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=u);else switch(i.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=u);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:n}}function YWe(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function CEe(t){const e=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,i=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,r=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return e.test(t)?t=t.replace(e,"https://www.arcgis.com"):i.test(t)?t=t.replace(i,"https://devext.arcgis.com"):r.test(t)&&(t=t.replace(r,"https://qaext.arcgis.com")),t}function MEe(t){const e=atob(t),i=new Uint8Array(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return i.buffer}function XWe(t){const e=new Uint8Array(t);let i="";for(let r=0;r<e.length;r++)i+=String.fromCharCode(e[r]);return btoa(i)}const JWe=()=>ne.getLogger("esri.core.urlUtils"),yO=nr.request,xhe="esri/config: esriConfig.request.proxyUrl is not set.",AEe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,PEe=/^\s*http:/i,QWe=/^\s*https:/i,KWe=/^\s*file:/i,eZe=/:\d+$/,tZe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,iZe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),rZe=new RegExp("^((([^[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^[:]*))(:([0-9]+))?$");let CS=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(iZe);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(rZe),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}};const hF={},sZe=new CS(nr.applicationUrl);let ic=sZe;const nZe=oZe();let Pre=nZe;const Ore=()=>ic,X7t=()=>Pre;function oZe(){const t=ic.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${ic.scheme}://${ic.host}${ic.port!=null?`:${ic.port}`:""}`}${e}`}function gn(t){if(!t)return null;const e={path:null,query:null},i=new CS(t),r=t.indexOf("?");return i.query===null?e.path=t:(e.path=t.substring(0,r),e.query=$re(i.query)),i.fragment&&(e.hash=i.fragment,i.query===null&&(e.path=e.path.substring(0,e.path.length-(i.fragment.length+1)))),e}function $re(t){const e=t.split("&"),i={};for(const r of e){if(!r)continue;const s=r.indexOf("=");let n,o;s<0?(n=decodeURIComponent(r),o=""):(n=decodeURIComponent(r.slice(0,s)),o=decodeURIComponent(r.slice(s+1)));let a=i[n];typeof a=="string"&&(a=i[n]=[a]),Array.isArray(a)?a.push(o):i[n]=o}return i}function AL(t,e){return t?Object.keys(t).map(i=>{const r=t[i];if(r==null)return"";const s=encodeURIComponent(i)+"=",n=e==null?void 0:e[i];return n?s+encodeURIComponent(n(r)):Array.isArray(r)?r.map(o=>Pz(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):Pz(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function aZe(t=!1){let e,i=yO.proxyUrl;if(typeof t=="string"){e=dZe(t);const r=xG(t);r&&(i=r.proxyUrl)}else e=!!t;if(!i)throw JWe().warn(xhe),new B("urlUtils:proxy-not-set",xhe);return e&&zZ()&&(i=Fre(i)),gn(i)}function J7t(t){const e=xG(t);let i,r;if(e){const s=Rre(e.proxyUrl);i=s.path,r=s.query?$re(s.query):null}if(i){const s=gn(t);t=i+"?"+s.path;const n=AL({...r,...s.query});n&&(t=`${t}?${n}`)}return t}const n$={path:"",query:""};function Rre(t){const e=t.indexOf("?");return e!==-1?(n$.path=t.slice(0,e),n$.query=t.slice(e+1)):(n$.path=t,n$.query=null),n$}function OEe(t){return t=(t=$z(t=yZe(t=Rre(t).path),!0)).toLowerCase()}function lZe(t){const e={proxyUrl:t.proxyUrl,urlPrefix:OEe(t.urlPrefix)},i=yO.proxyRules,r=e.urlPrefix;let s=i.length;for(let n=0;n<i.length;n++){const o=i[n].urlPrefix;if(r.indexOf(o)===0){if(r.length===o.length)return-1;s=n;break}o.indexOf(r)===0&&(s=n+1)}return i.splice(s,0,e),s}function xG(t){const e=yO.proxyRules,i=OEe(t);for(let r=0;r<e.length;r++)if(i.indexOf(e[r].urlPrefix)===0)return e[r]}function cZe(t,e){if(!t||!e)return!1;t=Oz(t),e=Oz(e);const i=whe(t),r=whe(e);return i!=null&&r!=null?i.portalHostname===r.portalHostname:i==null&&r==null&&iP(t,e,!0)}function $Ee(t,e){return t=Oz(t),e=Oz(e),$z(t)===$z(e)}function Oz(t){const e=(t=lp(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function VZ(t,e=yO.interceptors){const i=r=>r==null||r instanceof RegExp&&r.test(t)||typeof r=="string"&&t.startsWith(r);if(e){for(const r of e)if(Array.isArray(r.urls)){if(r.urls.some(i))return r}else if(i(r.urls))return r}return null}function iP(t,e,i=!1){if(!t||!e)return!1;const r=jZ(t),s=jZ(e);return!(!i&&r.scheme!==s.scheme)&&r.host!=null&&s.host!=null&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function Ire(t){if(typeof t=="string"){if(!Bh(t))return!0;t=jZ(t)}if(iP(t,ic))return!0;const e=yO.trustedServers||[];for(let i=0;i<e.length;i++){const r=uZe(e[i]);for(let s=0;s<r.length;s++)if(iP(t,r[s]))return!0}return!1}function uZe(t){return hF[t]||(Nre(t)||my(t)?hF[t]=[new CS(Lu(t))]:hF[t]=[new CS(`http://${t}`),new CS(`https://${t}`)]),hF[t]}function Lu(t,e=Pre,i){return my(t)?i!=null&&i.preserveProtocolRelative?t:ic.scheme==="http"&&ic.authority===cp(t).slice(2)?`http:${t}`:`https:${t}`:Nre(t)?t:Jh(t[0]==="/"?gZe(e):e,t)}function Lre(t,e=Pre,i){if(t==null||!Bh(t))return t;const r=lp(t),s=r.toLowerCase(),n=lp(e).toLowerCase().replace(/\/+$/,""),o=i?lp(i).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return t;const a=(d,f,m)=>(m=d.indexOf(f,m))===-1?d.length:m;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return t;t=r.slice(c);const u=n.slice(c-1).replaceAll(/[^/]+/g,"").length;if(u>0)for(let d=0;d<u;d++)t=`../${t}`;else t=`./${t}`;return t}function lp(t){return t=bZe(t=vZe(t=_Ze(t=Lu(t=t.trim()))))}function Jh(...t){const e=t.filter(sd);if(!(e!=null&&e.length))return;const i=[];if(Bh(e[0])){const s=e[0],n=s.indexOf("//");n!==-1&&(i.push(s.slice(0,n+1)),fZe(e[0])&&(i[0]+="/"),e[0]=s.slice(n+2))}else e[0][0]==="/"&&i.push("");const r=e.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<r.length;s++){const n=r[s];n===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!n&&s===r.length-1||n&&(n!=="."||i.length===0))&&i.push(n)}return i.join("/")}function cp(t,e=!1){if(t==null||rP(t)||Cy(t))return null;let i=t.indexOf("://");if(i===-1&&my(t))i=2;else{if(i===-1)return null;i+=3}const r=t.indexOf("/",i);return r!==-1&&(t=t.slice(0,r)),e&&(t=$z(t,!0)),t}function Bh(t){return my(t)||Nre(t)}function rP(t){return t!=null&&t.slice(0,5)==="blob:"}function Cy(t){return t!=null&&t.slice(0,5)==="data:"}function Dre(t){const e=Fb(t);return e!=null&&e.isBase64?MEe(e.data):null}function Q7t(t){return XWe(t).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const hZe=/^data:(.*?)(;base64)?,(.*)$/;function Fb(t){const e=t.match(hZe);if(!e)return null;const[,i,r,s]=e;return{mediaType:i,isBase64:!!r,data:s}}function REe(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}async function K7t(t){return(await fetch(t)).blob()}function eWt(t){const e=Dre(t);if(!e)return null;const i=Fb(t);return new Blob([e],{type:i.mediaType})}function my(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function Nre(t){return t!=null&&AEe.test(t)}function dZe(t){return t!=null&&QWe.test(t)||ic.scheme==="https"&&my(t)}function pZe(t){return t!=null&&PEe.test(t)||ic.scheme==="http"&&my(t)}function fZe(t){return t!=null&&KWe.test(t)}function Fre(t){return my(t)?`https:${t}`:t.replace(PEe,"https:")}function mZe(){return ic.scheme==="http"}function zZ(){return ic.scheme==="https"}function $z(t,e=!1){return my(t)?t.slice(2):(t=t.replace(AEe,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function gZe(t){const e=t.indexOf("//"),i=t.indexOf("/",e+2);return i===-1?t:t.slice(0,i)}function kre(t){let e=0;if(Bh(t)){const r=t.indexOf("//");r!==-1&&(e=r+2)}const i=t.lastIndexOf("/");return i<e?t:t.slice(0,i+1)}function tWt(t,e){if(!t)return"";const i=gn(t).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(!(e!=null&&e.length))return r;const s=new RegExp(`\\.(${e.join("|")})$`,"i");return r.replace(s,"")}function yZe(t){return t.endsWith("/")?t:`${t}/`}function IEe(t){return t.replace(/\/+$/,"")}function _Ze(t){if(/^https?:\/\//i.test(t)){const e=Rre(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function vZe(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function bZe(t){const e=yO.httpsDomains;if(!pZe(t))return t;const i=t.indexOf("/",7);let r;if(r=i===-1?t:t.slice(0,i),r=r.toLowerCase().slice(7),eZe.test(r)){if(!r.endsWith(":80"))return t;r=r.slice(0,-3),t=t.replace(":80","")}return mZe()&&r===ic.authority&&!tZe.test(t)||(zZ()&&r===ic.authority||e&&e.some(s=>r===s||r.endsWith(`.${s}`))||zZ()&&!xG(t))&&(t=Fre(t)),t}function BZ(t,e,i){if(!(e&&i&&t&&Bh(t)))return t;const r=t.indexOf("//"),s=t.indexOf("/",r+2),n=t.indexOf(":",r+2),o=Math.min(s<0?t.length:s,n<0?t.length:n);return t.slice(r+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,r+2)}${i}${t.slice(o)}`}function jZ(t){return typeof t=="string"?new CS(Lu(t)):(t.scheme||(t.scheme=ic.scheme),t)}function LEe(t){return xZe.test(t)}function DEe(t,e){const i=gn(t),r=Object.keys(i.query||{});return r.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function NEe(t,e,i){const r=gn(t),s=r.query||{};return s[e]=String(i),`${r.path}?${AL(s)}`}function bH(t,e){if(!e)return t;const i=gn(t),r=i.query||{};for(const[n,o]of Object.entries(e))o!=null&&(r[n]=o);const s=AL(r);return s?`${i.path}?${s}`:i.path}function wZe(t){if(t==null)return null;const e=t.match(FEe);return e?e[2]:null}function The(t){if(t==null)return null;const e=t.match(FEe);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function iWt(t){return typeof t=="string"?Fb(t)??{data:t}:new Promise((e,i)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>e(Fb(r.result)),r.onerror=s=>i(s)})}const FEe=/([^.]*)\.([^/]*)$/,xZe=/(^data:image\/svg|\.svg$)/i,kEe="20240724",UEe="ac51c09e1d17be02f839eb2e22bd05fd7a16c2d3";Symbol.dispose??(Symbol.dispose=Symbol("Symbol.dispose")),Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("Symbol.asyncDispose"));const VEe="4.30";let Ci,Ure=VEe;Ure="4.30.9";function rWt(t){Ci=t}function sWt(t){const e=Ci==null?void 0:Ci.findCredential(t);return e!=null&&e.token?NEe(t,"token",e.token):t}ue("host-webworker");const TZe=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function Vre(t){const e=cp(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!TZe.has(e)&&!t.endsWith("/sharing/rest/generateToken")}function zEe(t,e,i=!1,r){return new Promise((s,n)=>{if(ha(r))return void n(She());let o=()=>{c(),n(new Error(`Unable to load ${e}`))},a=()=>{const u=t;c(),s(u)},l=()=>{if(!t)return;const u=t;c(),u.src="",n(She())};const c=()=>{ue("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,r!=null&&r.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(e)};r!=null&&r.addEventListener("abort",l),ue("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function She(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const BEe="Timeout exceeded";function SZe(){return new Error(BEe)}function nWt(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===BEe}function EZe(t){nr.request.crossOriginNoCorsDomains||(nr.request.crossOriginNoCorsDomains={});const e=nr.request.crossOriginNoCorsDomains;for(let i of t)i=i.toLowerCase(),/^https?:\/\//.test(i)?e[cp(i)??""]=0:(e[cp("http://"+i)??""]=0,e[cp("https://"+i)??""]=0)}function CZe(t){const e=nr.request.crossOriginNoCorsDomains;if(e){let i=cp(t);if(i)return i=i.toLowerCase(),!iP(i,Ore())&&e[i]<Date.now()-36e5}return!1}async function MZe(t){var s;const e=nr.request.crossOriginNoCorsDomains,i=cp(t);e&&i&&(e[i.toLowerCase()]=Date.now());const r=gn(t);t=r.path,((s=r.query)==null?void 0:s.f)==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function fr(t,e){var f;t instanceof URL&&(t=t.toString()),(e==null?void 0:e.query)instanceof URLSearchParams&&(e.query=$re(e.query.toString().replaceAll("+"," ")));const i=Cy(t),r=rP(t);r||i||(t=lp(t));const s={url:t,requestOptions:{...e}},n=m=>({data:m,getAllHeaders:sP,getHeader:sP,httpStatus:200,requestOptions:s.requestOptions,url:s.url}),o=VZ(t,Gd.internalInterceptors);if(o){const m=await Che(o,s);if(m!=null)return n(m)}let a=VZ(t);if(a){const m=await Che(a,s);if(m!=null)return n(m);a.after||a.error||(a=null)}if(t=s.url,(e=s.requestOptions).responseType==="image"&&(ue("host-webworker")||ue("host-node")))throw Kg("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s);if(e.method==="head"){if(e.body)throw Kg("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(i||r)throw Kg("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await RZe(),Rz)return Rz.execute(t,e);const l=new AbortController,c=Va(e,()=>l.abort()),u={controller:l,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:a,params:s,redoRequest:!1,useIdentity:Gd.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},d=await NZe(u).finally(()=>c==null?void 0:c.remove());return(f=a==null?void 0:a.after)==null||f.call(a,d),d}let Rz;const Gd=nr.request,jEe="FormData"in globalThis,AZe=new Set([499,498,403,401]),PZe=new Set(["COM_0056","COM_0057","SB_0008"]),OZe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],sP=()=>null,Iz=Symbol();function $Ze(t){const e=cp(t);e&&!fr._corsServers.includes(e)&&fr._corsServers.push(e)}function Ehe(t){const e=cp(t);return!e||e.endsWith(".arcgis.com")||fr._corsServers.includes(e)||Ire(e)}function Kg(t,e,i,r){let s="Error";const n={url:i.url,requestOptions:i.requestOptions,getAllHeaders:sP,getHeader:sP,ssl:!1};if(e instanceof B)return e.details?(e.details=re(e.details),e.details.url=i.url,e.details.requestOptions=i.requestOptions):e.details=n,e;if(e){const o=r&&(()=>Array.from(r.headers)),a=r&&(u=>r.headers.get(u)),l=r==null?void 0:r.status,c=e.message;c&&(s=c),o&&a&&(n.getAllHeaders=o,n.getHeader=a),n.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||l||0,n.subCode=e.subcode,n.messageCode=e.messageCode,typeof e.details=="string"?n.messages=[e.details]:n.messages=e.details,n.raw=Iz in e?e[Iz]:e}return us(e)?Ui():new B(t,s,n)}async function RZe(){ue("host-webworker")&&!Rz&&(Rz=await oe(()=>import("./request-DWj94lBi.js"),[]))}async function GZ(){Ci||await oe(()=>import("./IdentityManager-BrdpUt3Z.js"),[])}async function IZe(t){var a;const e=t.params.url,i=t.params.requestOptions,r=t.controller.signal,s=i.body;let n=null,o=null;if(jEe&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),t.fetchOptions={cache:i.cacheBust?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:Gd.priority,redirect:"follow",signal:r},(n||o)&&(t.fetchOptions.body=n||o),i.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||(a=i.query)!=null&&a.token||n!=null&&n.get("token")),!t.hasToken&&nr.apiKey&&Vre(e)&&(i.query||(i.query={}),i.query.token=nr.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!GEe(e)&&!ha(r)){let l;i.authMode==="immediate"?(await GZ(),l=await Ci.getCredential(e,{signal:r}),t.credential=l):i.authMode==="no-prompt"?(await GZ(),l=await Ci.getCredential(e,{prompt:!1,signal:r}).catch(()=>{}),t.credential=l):Ci&&(l=Ci.findCredential(e)),l&&(t.credentialToken=l.token,t.useSSL=!!l.ssl)}}function GEe(t){return OZe.some(e=>e.test(t))}async function LZe(t){let e=t.params.url;const i=t.params.requestOptions,r=t.fetchOptions??{},s=rP(e)||Cy(e),n=i.responseType||"json",o=s?0:i.timeout!=null?i.timeout:Gd.timeout;let a=!1;if(!s){t.useSSL&&(e=Fre(e));let f={...i.query};t.credentialToken&&(f.token=t.credentialToken);let m=AL(f);ue("esri-url-encodes-apostrophe")&&(m=m.replaceAll("'","%27"));const g=e.length+1+m.length;let y;a=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||g>Gd.maxUrlLength;const v=i.useProxy||!!xG(e);if(v){const b=aZe(e);y=b.path,!a&&y.length+1+g>Gd.maxUrlLength&&(a=!0),b.query&&(f={...b.query,...f})}if(r.method==="HEAD"&&(a||v)){if(a)throw g>Gd.maxUrlLength?Kg("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):Kg("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(v)throw Kg("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}if(a?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?e=bH(e,f):(r.body=AL(f),r.headers||(r.headers={}),r.headers["Content-Type"]="application/x-www-form-urlencoded")):e=bH(e,f),v&&(t.useProxy=!0,e=`${y}?${e}`),f.token&&jEe&&r.body instanceof FormData&&!YWe(e)&&r.body.set("token",f.token),i.hasOwnProperty("withCredentials"))t.withCredentials=i.withCredentials;else if(!iP(e,Ore())){if(Ire(e))t.withCredentials=!0;else if(Ci){const b=Ci.findServerInfo(e);b!=null&&b.webTierAuth&&(t.withCredentials=!0)}}t.withCredentials&&(r.credentials="include",CZe(e)&&await MZe(a?bH(e,f):e))}let l,c,u=0,d=!1;o>0&&(u=setTimeout(()=>{d=!0,t.controller.abort()},o));try{if(i.responseType==="native-request-init")c=r,c.url=e;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||a||DZe(i.headers)||!s&&!t.useProxy&&Gd.proxyUrl&&!Ehe(e)){if(fr._beforeFetch&&await fr._beforeFetch(e,r),l=await fetch(e,r),fr._afterFetch&&await fr._afterFetch(l),t.useProxy||$Ze(e),i.responseType==="native")c=l;else if(r.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(u&&(clearTimeout(u),u=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=Mhe(c,"application/xml");break;case"document":c=Mhe(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const f=l.headers.get("Content-Type");if(f&&/application\/json|text\/plain/i.test(f)&&c[n==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}n==="image"&&c instanceof Blob&&(c=await Ahe(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await Ahe(e,t)}catch(f){if(f.name==="AbortError")throw d?SZe():Ui("Request canceled");if(!(!l&&f instanceof TypeError&&Gd.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||t.useProxy||Ehe(e))throw f;t.redoRequest=!0,lZe({proxyUrl:Gd.proxyUrl,urlPrefix:cp(e)??""})}finally{u&&clearTimeout(u)}return[l,c]}async function Che(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let i,r;try{r=await t.before(e)}catch(s){i=Kg("request:interceptor",s,e)}if((r instanceof Error||r instanceof B)&&(i=Kg("request:interceptor",r,e)),i)throw t.error&&t.error(i),i;return r}}function DZe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function Mhe(t,e){let i;try{i=new DOMParser().parseFromString(t,e)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function NZe(t){var n,o;let e,i;await IZe(t);try{do[e,i]=await LZe(t);while(!await FZe(t,e,i))}catch(a){const l=Kg("request:server",a,t.params,e);throw l.details.ssl=t.useSSL,(n=t.interceptor)!=null&&n.error&&t.interceptor.error(l),l}const r=t.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!t.hasToken&&!t.credentialToken&&((o=i.user)!=null&&o.username)&&!Ire(r)){const a=cp(r,!0);a&&Gd.trustedServers.push(a)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&EZe(i.authorizedCrossOriginNoCorsDomains)}const s=t.credential;if(s&&Ci){const a=Ci.findServerInfo(s.server);let l=a==null?void 0:a.owningSystemUrl;if(l){l=l.replace(/\/?$/,"/sharing");const c=Ci.findCredential(l,s.userId);c&&Ci._getIdenticalSvcIdx(l,c)===-1&&c.resources.unshift(l)}}return{data:i,getAllHeaders:e?()=>Array.from(e.headers):sP,getHeader:e?a=>e.headers.get(a):sP,httpStatus:(e==null?void 0:e.status)??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function FZe(t,e,i){var c;if(t.redoRequest)return t.redoRequest=!1,!1;const r=t.params.requestOptions;if(!e||r.responseType==="native"||r.responseType==="native-request-init")return!0;let s,n;if(i&&(i.error&&typeof i.error=="object"?s=i.error:i.status==="error"&&Array.isArray(i.messages)&&(s={...i},s[Iz]=i,s.details=i.messages)),!s&&!e.ok)throw s=new Error(`Unable to load ${e.url} status: ${e.status}`),s[Iz]=i,s;let o,a=null;s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,o=s.messageCode,o=o==null?void 0:o.toUpperCase());const l=r.authMode;if(n===403&&(a===4||(c=s.message)!=null&&c.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&AZe.has(n)&&!GEe(t.params.url)&&(n!==403||(!o||!PZe.has(o))&&(a==null||a===2&&t.credentialToken))){await GZ();try{const u=await Ci.getCredential(t.params.url,{error:Kg("request:server",s,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=u,t.credentialToken=u.token,t.useSSL=t.useSSL||u.ssl,!1}catch(u){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;s=u}}if(s)throw s;return!0}function Ahe(t,e,i=!1){const r=e.controller.signal,s=new Image;return e.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=Gd.priority,s.src=t,zEe(s,t,i,r)}fr._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],fr._beforeFetch=void 0,fr._afterFetch=void 0;async function kZe(t,e,i,r){const s=e.exec(i);if(!s)throw new B("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${e}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=t7e(r),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let u;try{u=await Phe(t(c))}catch(d){if(c===l)throw new B("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:d});try{u=await Phe(t(l))}catch(f){throw new B("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:f})}}return u}async function Phe(t){if(Ohe.fetchBundleAsset!=null)return Ohe.fetchBundleAsset(t);const e=await fr(t,{responseType:"text"});return JSON.parse(e.data)}let UZe=class{constructor({base:e="",pattern:i,location:r=new URL(window.location.href)}){let s;s=typeof r=="string"?n=>new URL(n,new URL(r,window.location.href)).href:r instanceof URL?n=>new URL(n,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=s,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)\\/)?(.*)$`)}fetchMessageBundle(e,i){return kZe(this.getAssetUrl,this.matcher,e,i)}};function VZe(t){return new UZe(t)}const Ohe={};function zZe(t,e){return fr(tr(t),e)}function tr(t){if(!nr.assetsPath)throw ne.getLogger("esri.assets").errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new B("assets:path-not-set","config.assetsPath is not set");return Jh(nr.assetsPath,t)}e7e(VZe({pattern:"esri/",location:tr}));let Fk=class HEe{constructor(){this._emitter=new HEe.EventEmitter(this)}emit(e,i){return this._emitter.emit(e,i)}on(e,i){return this._emitter.on(e,i)}once(e,i){return this._emitter.once(e,i)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(s=null){this._target=s,this._listenersMap=null}clear(){var s;(s=this._listenersMap)==null||s.clear(),this._listenersMap=null}destroy(){this.clear()}emit(s,n){var c;let o=(c=this._listenersMap)==null?void 0:c.get(s);if(!o)return!1;const a=this._target||this;let l=!1;for(const u of o.slice()){const d="deref"in u?u.deref():u;d?d==null||d.call(a,n):l=!0}return l&&(o=o.filter(u=>!("deref"in u)||u.deref()!=null),this._listenersMap.set(s,o)),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return JS(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),Gi(()=>{var c;const a=(c=this._listenersMap)==null?void 0:c.get(s),l=(a==null?void 0:a.indexOf(n))??-1;l>=0&&a.splice(l,1)})}once(s,n){const o=this.on(s,a=>{o.remove();const l="deref"in n?n.deref():n;l==null||l.call(null,a)});return o}hasEventListener(s){var o;const n=(o=this._listenersMap)==null?void 0:o.get(s);return n!=null&&n.length>0}}t.EventEmitter=e,t.EventedMixin=r=>{let s=class extends r{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=h([I("esri.core.Evented")],s),s};let i=class extends Ue{constructor(){super(...arguments),this._emitter=new Fk.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,s){return this._emitter.emit(r,s)}on(r,s){return this._emitter.on(r,s)}once(r,s){return this._emitter.once(r,s)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=h([I("esri.core.Evented.EventedAccessor")],i),t.EventedAccessor=i})(Fk||(Fk={}));const Ls=Fk;var Nr;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(Nr||(Nr={}));function zre(t){return(e,i)=>{e[i]=t}}let _O=class extends U2e{notify(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onInvalidated(),r.onCommitted()}}};var Y0;let BZe=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},jZe=class{constructor(e,i,r,s,n){this.target=e,this.added=i,this.removed=r,this.start=s,this.deleteCount=n}};const ad=new ga(BZe,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1});function $he(t){t&&typeof t=="object"&&"destroy"in t&&typeof t.destroy=="function"&&t.destroy()}function wH(t){return t?t instanceof B0?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function xH(t){if(t!=null&&t.length)return t[0]}function GZe(t,e,i,r){const s=Math.min(t.length-i,e.length-r);let n=0;for(;n<s&&t[i+n]===e[r+n];)n++;return n}function qEe(t,e,i,r){e&&e.forEach((s,n,o)=>{t.push(s),qEe(t,i.call(r,s,n,o),i,r)})}const uv=new Set,hv=new Set,dv=new Set,TH=new Map;let HZe=0,B0=Y0=class extends Ls.EventedAccessor{static isCollection(t){return t!=null&&t instanceof Y0}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new _O,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:HZe++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof Y0?{items:t}:t:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),this._emitter.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return Ft(this._observable),this._items}set items(t){this._emitBeforeChanges(Nr.ADD)||(this._splice(0,this.length,wH(t)),this._emitAfterChanges(Nr.ADD))}hasEventListener(t){return!this.destroyed&&(t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t))}on(t,e){if(this.destroyed)return Gi();if(t==="change"){const i=this._chgListeners,r={removed:!1,callback:e};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),Gi(()=>{r.removed=!0,i.splice(i.indexOf(r),1)})}return this._emitter.on(t,e)}once(t,e){const i="deref"in e?()=>e.deref():()=>e,r=this.on(t,s=>{var n;(n=i())==null||n.call(null,s),r.remove()});return r}add(t,e){if(Ft(this._observable),this._emitBeforeChanges(Nr.ADD))return this;const i=this.getNextIndex(e??null);return this._splice(i,0,[t]),this._emitAfterChanges(Nr.ADD),this}addMany(t,e=this._items.length){if(Ft(this._observable),!(t!=null&&t.length))return this;if(this._emitBeforeChanges(Nr.ADD))return this;const i=this.getNextIndex(e);return this._splice(i,0,wH(t)),this._emitAfterChanges(Nr.ADD),this}at(t){if(Ft(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(Ft(this._observable),!this.length||this._emitBeforeChanges(Nr.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(Nr.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return Ft(this._observable),this._createNewInstance({items:this._items.map(re)})}concat(...t){Ft(this._observable);const e=t.map(wH);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(Ft(this._observable),!this.length||this._emitBeforeChanges(Nr.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let s=0;s<r;s++)t.call(e,i[s],s,i);this._emitAfterChanges(Nr.REMOVE)}destroyAll(){this.drain($he)}destroyMany(t){const e=this.removeMany(t);return e.forEach($he),e}every(t,e){return Ft(this._observable),this._items.every(t,e)}filter(t,e){let i;return Ft(this._observable),i=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:i})}find(t,e){return Ft(this._observable),this._items.find(t,e)}findIndex(t,e){return Ft(this._observable),this._items.findIndex(t,e)}flatten(t,e){Ft(this._observable);const i=[];return qEe(i,this,t,e),new Y0(i)}forEach(t,e){return Ft(this._observable),this._items.forEach(t,e)}getItemAt(t){return Ft(this._observable),this._items[t]}getNextIndex(t){Ft(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return Ft(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return Ft(this._observable),this._items.indexOf(t,e)}join(t=","){return Ft(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return Ft(this._observable),this._items.lastIndexOf(t,e)}map(t,e){Ft(this._observable);const i=this._items.map(t,e);return new Y0({items:i})}reorder(t,e=this.length-1){Ft(this._observable);const i=this.indexOf(t);if(i!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),i!==e){if(this._emitBeforeChanges(Nr.MOVE))return t;this._splice(i,1),this._splice(e,0,[t]),this._emitAfterChanges(Nr.MOVE)}return t}}pop(){if(Ft(this._observable),!this.length||this._emitBeforeChanges(Nr.REMOVE))return;const t=xH(this._splice(this.length-1,1));return this._emitAfterChanges(Nr.REMOVE),t}push(...t){return Ft(this._observable),this._emitBeforeChanges(Nr.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(Nr.ADD)),this.length}reduce(t,e){Ft(this._observable);const i=this._items;return arguments.length===2?i.reduce(t,e):i.reduce(t)}reduceRight(t,e){Ft(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(t,e):i.reduceRight(t)}remove(t){return Ft(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(Ft(this._observable),t<0||t>=this.length||this._emitBeforeChanges(Nr.REMOVE))return;const e=xH(this._splice(t,1));return this._emitAfterChanges(Nr.REMOVE),e}removeMany(t){if(Ft(this._observable),!(t!=null&&t.length)||this._emitBeforeChanges(Nr.REMOVE))return[];const e=t instanceof Y0?t.toArray():t,i=this._items,r=[],s=e.length;for(let n=0;n<s;n++){const o=e[n],a=i.indexOf(o);if(a>-1){const l=1+GZe(e,i,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&r.push.apply(r,c),n+=l-1}}return this._emitAfterChanges(Nr.REMOVE),r}reverse(){if(Ft(this._observable),this._emitBeforeChanges(Nr.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(Nr.MOVE),this}shift(){if(Ft(this._observable),!this.length||this._emitBeforeChanges(Nr.REMOVE))return;const t=xH(this._splice(0,1));return this._emitAfterChanges(Nr.REMOVE),t}slice(t=0,e=this.length){return Ft(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return Ft(this._observable),this._items.some(t,e)}sort(t){if(Ft(this._observable),!this.length||this._emitBeforeChanges(Nr.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(Nr.MOVE),this}splice(t,e,...i){Ft(this._observable);const r=(e?Nr.REMOVE:0)|(i.length?Nr.ADD:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(t,e,i)||[];return this._emitAfterChanges(r),s}toArray(){return Ft(this._observable),this._items.slice()}toJSON(){return Ft(this._observable),this.toArray()}toLocaleString(){return Ft(this._observable),this._items.toLocaleString()}toString(){return Ft(this._observable),this._items.toString()}unshift(...t){return Ft(this._observable),!t.length||this._emitBeforeChanges(Nr.ADD)||(this._splice(0,0,t),this._emitAfterChanges(Nr.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,i){const r=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=k2(()=>this._dispatchChange())),t<0&&(t+=this.length),e){if(o=r.splice(t,e),this.hasEventListener("before-remove")){const a=ad.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),r.splice(t,0,n),t+=1,l-=1,c-=1);ad.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=ad.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);ad.release(a)}}if(i!=null&&i.length){if(s){const u=[];for(const d of i){const f=s.ensureType(d);f==null&&d!=null||u.push(f)}i=u}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const u=ad.acquire();u.target=this,u.cancellable=!0;const d=ad.acquire();d.target=this,d.cancellable=!1;for(const f of i)a?(u.reset(f),this.emit("before-add",u),u.defaultPrevented||(c?r.push(f):r.splice(t++,0,f),this._set("length",r.length),l&&(d.reset(f),this.emit("after-add",d)))):(c?r.push(f):r.splice(t++,0,f),this._set("length",r.length),d.reset(f),this.emit("after-add",d));ad.release(d),ad.release(u)}else{if(c)for(const u of i)r.push(u);else r.splice(t,0,...i);this._set("length",r.length)}}if((i!=null&&i.length||o!=null&&o.length)&&this._notifyChangeEvent(i,o),this.hasEventListener("after-splice")){const a=new jZe(this,i,o,t,e);this.emit("after-splice",a)}return o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const i=ad.acquire();i.target=this,i.cancellable=!0,i.type=t,this.emit("before-changes",i),e=i.defaultPrevented,ad.release(i)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=ad.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),ad.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const i=e.changes;uv.clear(),hv.clear(),dv.clear();for(const{added:l,removed:c}of i){if(l)if(dv.size===0&&hv.size===0)for(const u of l)uv.add(u);else for(const u of l)hv.has(u)?(dv.add(u),hv.delete(u)):dv.has(u)||uv.add(u);if(c)if(dv.size===0&&uv.size===0)for(const u of c)hv.add(u);else for(const u of c)uv.has(u)?uv.delete(u):(dv.delete(u),hv.add(u))}const r=Ou.acquire();uv.forEach(l=>{r.push(l)});const s=Ou.acquire();hv.forEach(l=>{s.push(l)});const n=this._items,o=e.items,a=Ou.acquire();if(dv.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),e.listeners&&(r.length||s.length||a.length)){const l={target:this,added:r,removed:s,moved:a},c=e.listeners.length;for(let u=0;u<c;u++){const d=e.listeners[u];d.removed||d.callback.call(this,l)}}Ou.release(r),Ou.release(s),Ou.release(a)}uv.clear(),hv.clear(),dv.clear()}};B0.ofType=t=>{if(!t)return Y0;if(TH.has(t))return TH.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const r in t.typeMap){const s=t.typeMap[r].prototype.declaredClass;e?e+=` | ${s}`:e=s}let i=class extends Y0{};return h([zre({Type:t,ensureType:typeof t=="function"?nn(t):om(t)})],i.prototype,"itemType",void 0),i=h([I(`esri.core.Collection<${e}>`)],i),TH.set(t,i),i},h([p()],B0.prototype,"_updating",void 0),h([p()],B0.prototype,"length",void 0),h([p()],B0.prototype,"items",null),h([p({readOnly:!0})],B0.prototype,"updating",null),B0=Y0=h([I("esri.core.Collection")],B0);const Ke=B0;function gy(t,e,i=Ke){return e||(e=new i),e===t||(e.removeAll(),qZe(t)?e.addMany(t):t&&e.add(t)),e}function Bre(t){return t}function qZe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}var L1;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(L1||(L1={}));let WZe=class{constructor(){this._resolver=ma(),this._status=L1.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=L1.RESOLVED,this._cleanUp()},()=>{this._status=L1.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===L1.RESOLVED}isRejected(){return this._status===L1.REJECTED}isFulfilled(){return this._status!==L1.PENDING}abort(){this._resolver.reject(Ui())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=ma(),i=[...this._resolvingPromises,e.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve()},s=>{this.isFulfilled()||this._allPromise!==r||us(s)||this._resolver.reject(s)}),e.resolve()}};const jD=t=>{let e=class extends t{constructor(...i){super(...i),this._promiseProps=new WZe,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return this._promiseProps.promise.then(()=>this).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return e=h([I("esri.core.Promise")],e),e};let Lz=class extends jD(Ue){};Lz=h([I("esri.core.Promise")],Lz);const ZZe="not-loaded",YZe="loading",XZe="failed",Rhe="loaded",WEe=t=>{let e=class extends t{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=FD(n,l);this.destroyed&&l(new B("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===ZZe){this._set("loadStatus",YZe);const a=this._loadController=new AbortController;s({signal:a.signal})}return r(),o}})),this.when(()=>{this._set("loadStatus",Rhe),this._loadController=null},r=>{this._set("loadStatus",XZe),this._set("loadError",r),this._loadController=null})}destroy(){this._loadController&&(this._loadController=oc(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===Rhe}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var i;return this.isFulfilled()||(this._set("loadError",new B("load:cancelled","Cancelled")),(i=this._loadController)==null||i.abort(),this._promiseProps.abort()),this}};return h([p({readOnly:!0})],e.prototype,"loaded",null),h([p({readOnly:!0})],e.prototype,"loadError",void 0),h([p({clonable:!1})],e.prototype,"loadStatus",void 0),h([p({type:[fy],readOnly:!0})],e.prototype,"loadWarnings",null),e=h([I("esri.core.Loadable")],e),e};let dR=class extends WEe(Lz){};dR=h([I("esri.core.Loadable")],dR),function(t){function e(i){return!(!i||!i.load)}t.LoadableMixin=WEe,t.isLoadable=e}(dR||(dR={}));const yy=dR;function TG(t,e,i){return nm(t.map((r,s)=>e.apply(i,[r,s])))}async function JZe(t,e,i){return(await nm(t.map((r,s)=>e.apply(i,[r,s])))).map(r=>r.value)}function jre(t){return{ok:!0,value:t}}function Gre(t){return{ok:!1,error:t}}function QZe(t){return t!=null&&t.ok===!0?t.value:null}function KZe(t){return t!=null&&t.ok===!1?t.error:null}async function Qh(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return jre(await t)}catch(e){return Gre(e)}}async function eYe(t){try{return jre(await t)}catch(e){return Ql(e),Gre(e)}}function pWt(t){if(t.ok===!0)return t.value;throw t.error}function My(t,e){return new qv(t,e)}let qv=class extends Ue{get value(){return QZe(this._result)}get error(){return KZe(this._result)}get finished(){return this._result!=null}constructor(e,i){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=oc(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(s=>{this._result=jre(s),this._cleanup()},s=>{this._result=Gre(s),this._cleanup()}),this._abortHandle=Va(i,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=Lr(this._abortHandle),this._abortController=null}};h([p()],qv.prototype,"value",null),h([p()],qv.prototype,"error",null),h([p()],qv.prototype,"finished",null),h([p()],qv.prototype,"promise",void 0),h([p()],qv.prototype,"_result",void 0),qv=h([I("esri.core.asyncUtils.ReactiveTask")],qv);async function Hre(t,e){return await t.load(),tYe(t,e)}async function tYe(t,e){const i=[],r=(...n)=>{for(const o of n)o!=null&&(Array.isArray(o)?r(...o):Ke.isCollection(o)?o.forEach(a=>r(a)):yy.isLoadable(o)&&i.push(o))};e(r);let s=null;if(await JZe(i,async n=>{const o=await Qh(iYe(n)?n.loadAll():n.load());o.ok!==!1||s||(s=o)}),s)throw s.error;return t}function iYe(t){return"loadAll"in t&&typeof t.loadAll=="function"}function Ze(t,e,i){let r,s;return e===void 0?(s=t,r=[void 0]):typeof e!="string"?(s=t,r=[void 0],i=e):(s=e,r=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;for(const l of r){const c=aEe(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=a[o]}}}let qre=class{constructor(e,i,r,s){this.semiMajorAxis=e,this.flattening=i,this.outerAtmosphereRimWidth=r;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const ur=new qre(6378137,1/298.257223563,3e5,.006694379990137799),Qf=new qre(3396190,1/169.8944472236118,23e4),E_=new qre(1737400,0,0);let SH,fe=null;function ZEe(){return!!fe}function rYe(){return!!ue("esri-wasm")}function YEe(){return SH||(SH=oe(()=>import("./pe-wasm-Bwz0qnL9.js"),[]).then(t=>t.p).then(({default:t})=>t({locateFile:e=>tr(`esri/geometry/support/${e}`)})).then(t=>{JEe(t)}),SH)}var HZ,dn,qZ;(function(t){function e(n,o,a){fe.ensureCache.prepare();const l=kT(a),c=a===l,u=fe.ensureFloat64(l),d=fe._pe_geog_to_proj(fe.getPointer(n),o,u);return d&&Z1(a,o,u,c),d}function i(n,o,a,l){switch(l){case dn.PE_TRANSFORM_P_TO_G:return r(n,o,a);case dn.PE_TRANSFORM_G_TO_P:return e(n,o,a)}return 0}function r(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){fe.ensureCache.prepare();const c=kT(a),u=a===c,d=fe.ensureFloat64(c),f=fe._pe_proj_to_geog_center(fe.getPointer(n),o,d,l);return f&&Z1(a,o,d,u),f}t.geogToProj=e,t.projGeog=i,t.projToGeog=r,t.projToGeogCenter=s})(HZ||(HZ={})),function(t){function e(){t.PE_BUFFER_MAX=fe.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=fe.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=fe.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=fe.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=fe.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=fe.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=fe.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=fe.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=fe.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=fe.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=fe.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=fe.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=fe.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=fe.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=fe.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=fe.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=fe.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=fe.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=fe.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=fe.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_STR_FMT_WKT=fe.PeDefs.prototype.PE_STR_FMT_WKT,t.PE_STR_FMT_WKT2=fe.PeDefs.prototype.PE_STR_FMT_WKT2,t.PE_PARM_X0=fe.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=fe.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=fe.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=fe.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=fe.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=fe.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=fe.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=fe.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=fe.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=fe.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(dn||(dn={})),function(t){const e={},i={},r=m=>{if(m){const g=m.getType();switch(g){case dn.PE_TYPE_GEOGCS:m=fe.castObject(m,fe.PeGeogcs);break;case dn.PE_TYPE_PROJCS:m=fe.castObject(m,fe.PeProjcs);break;case dn.PE_TYPE_GEOGTRAN:m=fe.castObject(m,fe.PeGeogtran);break;default:g&dn.PE_TYPE_UNIT&&(m=fe.castObject(m,fe.PeUnit))}}return m};function s(){fe.PeFactory.prototype.initialize(null)}function n(m){return o(dn.PE_TYPE_COORDSYS,m)}function o(m,g){let y=null,v=e[m];if(v||(v={},e[m]=v),v.hasOwnProperty(String(g)))y=v[g];else{const b=fe.PeFactory.prototype.factoryByType(m,g);fe.compare(b,fe.NULL)||(y=b,v[g]=y)}return y=r(y),y}function a(m,g){let y=null,v=i[m];if(v||(v={},i[m]=v),v.hasOwnProperty(g))y=v[g];else{const b=fe.PeFactory.prototype.fromString(m,g);fe.compare(b,fe.NULL)||(y=b,v[g]=y)}return y=r(y),y}function l(m){return o(dn.PE_TYPE_GEOGCS,m)}function c(m){return o(dn.PE_TYPE_GEOGTRAN,m)}function u(m){return fe.PeFactory.prototype.getCode(m)}function d(m){return o(dn.PE_TYPE_PROJCS,m)}function f(m){return o(dn.PE_TYPE_UNIT,m)}t.initialize=s,t.coordsys=n,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=u,t.projcs=d,t.unit=f}(qZ||(qZ={}));let XEe=null;var Dz,WZ,ZZ,YZ,Nz,XZ,Fz,kz,JZ;function JEe(t){function e(n,o,a){n[o]=a(n[o])}fe=t,dn.init(),Dz.init(),Nz.init(),Fz.init(),kz.init(),XEe=class extends fe.PeGCSExtent{destroy(){fe.destroy(this)}};const i=[fe.PeDatum,fe.PeGeogcs,fe.PeGeogtran,fe.PeObject,fe.PeParameter,fe.PePrimem,fe.PeProjcs,fe.PeSpheroid,fe.PeUnit];for(const n of i)e(n.prototype,"getName",o=>function(){return o.call(this,new Array(dn.PE_NAME_MAX))});for(const n of[fe.PeGeogtran,fe.PeProjcs])e(n.prototype,"getParameters",o=>function(){const a=new Array(dn.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const u=fe.getValue(l,"*");a[c]=u?fe.wrapPointer(u,fe.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(fe.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return Z1(a,o,n.call(this)),a}),e(fe.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=fe._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!fe.compare(l,fe.NULL)){a=[l];const c=this.getSteps();if(c>1){const u=fe.getPointer(l);for(let d=1;d<c;d++)a.push(fe.wrapPointer(u+o*d,fe.PeGTlistExtendedGTs))}}return a}});const r=fe._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!fe.compare(l,fe.NULL)){a=[l];const c=l.getNump();if(c>1){const u=fe.getPointer(l);for(let d=1;d<c;d++)a.push(fe.wrapPointer(u+r*d,fe.PeHorizon))}}return o.set(n,a),a};e(fe.PeProjcs.prototype,"horizonGcsGenerate",s),e(fe.PeProjcs.prototype,"horizonPcsGenerate",s),fe.PeObject.prototype.toString=function(n=dn.PE_STR_OPTS_NONE){fe.ensureCache.prepare();const o=fe.getPointer(this),a=fe.ensureInt8(new Array(dn.PE_BUFFER_MAX));return fe.UTF8ToString(fe._pe_object_to_string_ext(o,n,a))}}function qy(t){if(!t)return;const e=fe.getClass(t);if(!e)return;const i=fe.getCache(e);if(!i)return;const r=fe.getPointer(t);r&&delete i[r]}function dF(t,e){const i=[],r=new Array(e);for(let s=0;s<t;s++)i.push(fe.ensureInt8(r));return i}function kT(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(i=>{e.push(i[0],i[1])})):e=t,e}function Z1(t,e,i,r=!1){if(r)for(let s=0;s<2*e;s++)t[s]=fe.getValue(i+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=t.length===0;for(let n=0;n<e;n++)s&&(t[n]=new Array(2)),t[n][0]=fe.getValue(i,"double"),t[n][1]=fe.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function i(){t.PE_GTLIST_OPTS_COMMON=fe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=fe._pe_getPeGTlistExtendedEntrySize()}function r(s,n,o,a,l,c){let u=null;const d=new fe.PeInteger(c);try{const f=fe.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,d);if((c=d.val)&&(u=[f],c>1)){const m=fe.getPointer(f);for(let g=1;g<c;g++)u.push(fe.wrapPointer(m+e*g,fe.PeGTlistExtendedEntry))}}finally{fe.destroy(d)}return u}t.init=i,t.getGTlist=r})(Dz||(Dz={})),function(t){function e(i){if(i!=null&&i.length){for(const r of i)qy(r),r.getEntries().forEach(s=>{qy(s);const n=s.getGeogtran();qy(n),n.getParameters().forEach(qy),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{qy(o);const a=o.getDatum();qy(a),qy(a.getSpheroid()),qy(o.getPrimem()),qy(o.getUnit())})});fe.PeGTlistExtendedEntry.prototype.Delete(i[0])}}t.destroy=e}(WZ||(WZ={})),function(t){function e(i,r,s,n,o){fe.ensureCache.prepare();const a=kT(s),l=s===a,c=fe.ensureFloat64(a);let u=0;n&&(u=fe.ensureFloat64(n));const d=fe._pe_geog_to_geog(fe.getPointer(i),r,c,u,o);return d&&Z1(s,r,c,l),d}t.geogToGeog=e}(ZZ||(ZZ={})),function(t){const e=(c,u,d,f,m,g)=>{let y,v;switch(fe.ensureCache.prepare(),c){case"dd":y=fe._pe_geog_to_dd,v=dn.PE_DD_MAX;break;case"ddm":y=fe._pe_geog_to_ddm,v=dn.PE_DDM_MAX;break;case"dms":y=fe._pe_geog_to_dms,v=dn.PE_DMS_MAX}let b=0;u&&(b=fe.getPointer(u));const w=kT(f),x=fe.ensureFloat64(w),T=dF(d,v),E=y(b,d,x,m,fe.ensureInt32(T));if(E)for(let M=0;M<d;M++)g[M]=fe.UTF8ToString(T[M]);return E},i=(c,u,d,f,m)=>{let g;switch(fe.ensureCache.prepare(),c){case"dd":g=fe._pe_dd_to_geog;break;case"ddm":g=fe._pe_ddm_to_geog;break;case"dms":g=fe._pe_dms_to_geog}let y=0;u&&(y=fe.getPointer(u));const v=f.map(T=>fe.ensureString(T)),b=fe.ensureInt32(v),w=fe.ensureFloat64(new Array(2*d)),x=g(y,d,b,w);return x&&Z1(m,d,w),x};function r(c,u,d,f,m){return e("dms",c,u,d,f,m)}function s(c,u,d,f){return i("dms",c,u,d,f)}function n(c,u,d,f,m){return e("ddm",c,u,d,f,m)}function o(c,u,d,f){return i("ddm",c,u,d,f)}function a(c,u,d,f,m){return e("dd",c,u,d,f,m)}function l(c,u,d,f){return i("dd",c,u,d,f)}t.geogToDms=r,t.dmsToGeog=s,t.geogToDdm=n,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(YZ||(YZ={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=fe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=fe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=fe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=fe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=fe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(s,n,o,a,l,c,u){fe.ensureCache.prepare();let d=0;s&&(d=fe.getPointer(s));const f=kT(o),m=fe.ensureFloat64(f),g=dF(n,dn.PE_MGRS_MAX),y=fe.ensureInt32(g),v=fe._pe_geog_to_mgrs_extended(d,n,m,a,l,c,y);if(v)for(let b=0;b<n;b++)u[b]=fe.UTF8ToString(g[b]);return v}function r(s,n,o,a,l){fe.ensureCache.prepare();let c=0;s&&(c=fe.getPointer(s));const u=o.map(g=>fe.ensureString(g)),d=fe.ensureInt32(u),f=fe.ensureFloat64(new Array(2*n)),m=fe._pe_mgrs_to_geog_extended(c,n,d,a,f);return m&&Z1(l,n,f),m}t.init=e,t.geogToMgrsExtended=i,t.mgrsToGeogExtended=r}(Nz||(Nz={})),function(t){function e(r,s,n,o,a,l,c){fe.ensureCache.prepare();let u=0;r&&(u=fe.getPointer(r));const d=kT(n),f=fe.ensureFloat64(d),m=dF(s,dn.PE_MGRS_MAX),g=fe.ensureInt32(m),y=fe._pe_geog_to_usng(u,s,f,o,a,l,g);if(y)for(let v=0;v<s;v++)c[v]=fe.UTF8ToString(m[v]);return y}function i(r,s,n,o){fe.ensureCache.prepare();let a=0;r&&(a=fe.getPointer(r));const l=n.map(f=>fe.ensureString(f)),c=fe.ensureInt32(l),u=fe.ensureFloat64(new Array(2*s)),d=fe._pe_usng_to_geog(a,s,c,u);return d&&Z1(o,s,u),d}t.geogToUsng=e,t.usngToGeog=i}(XZ||(XZ={})),function(t){function e(){t.PE_UTM_OPTS_NONE=fe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=fe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=fe.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(s,n,o,a,l){fe.ensureCache.prepare();let c=0;s&&(c=fe.getPointer(s));const u=kT(o),d=fe.ensureFloat64(u),f=dF(n,dn.PE_UTM_MAX),m=fe.ensureInt32(f),g=fe._pe_geog_to_utm(c,n,d,a,m);if(g)for(let y=0;y<n;y++)l[y]=fe.UTF8ToString(f[y]);return g}function r(s,n,o,a,l){fe.ensureCache.prepare();let c=0;s&&(c=fe.getPointer(s));const u=o.map(g=>fe.ensureString(g)),d=fe.ensureInt32(u),f=fe.ensureFloat64(new Array(2*n)),m=fe._pe_utm_to_geog(c,n,d,a,f);return m&&Z1(l,n,f),m}t.init=e,t.geogToUtm=i,t.utmToGeog=r}(Fz||(Fz={})),function(t){const e=new Map;function i(){t.PE_PCSINFO_OPTION_NONE=fe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=fe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=fe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=fe.PePCSInfo.prototype.PE_POLE_POINT}function r(s,n=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(s)&&(a=e.get(s),a[n]&&(o=a[n])),o||(o=fe.PePCSInfo.prototype.generate(s,n),a||(a=[],e.set(s,a)),a[n]=o),o}t.init=i,t.generate=r}(kz||(kz={})),function(t){function e(){return fe.PeVersion.prototype.version_string()}t.versionString=e}(JZ||(JZ={}));const sYe=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return HZ},get PeDefs(){return dn},get PeFactory(){return qZ},get PeGCSExtent(){return XEe},get PeGTTransformations(){return ZZ},get PeGTlistExtended(){return Dz},get PeGTlistExtendedEntry(){return WZ},get PeNotationDms(){return YZ},get PeNotationMgrs(){return Nz},get PeNotationUsng(){return XZ},get PeNotationUtm(){return Fz},get PePCSInfo(){return kz},get PeVersion(){return JZ},_init:JEe,get _pe(){return fe},isLoaded:ZEe,isSupported:rYe,load:YEe},Symbol.toStringTag,{value:"Module"}));var Du;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(Du||(Du={}));let _;const F={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9895:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,10160:0,10183:0,10188:0,10194:0,10199:0,10207:0,10212:0,10217:0,10222:0,10227:0,10235:0,10240:0,10250:0,10254:0,10270:0,10275:0,10280:0,10306:0,10329:0,10471:0,10477:0,10481:2,10516:2,20002:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2,103897:1};for(_=2e3;_<=2045;_++)F[_]=0;for(_=2056;_<=2065;_++)F[_]=0;for(_=2067;_<=2135;_++)F[_]=0;for(_=2137;_<=2154;_++)F[_]=0;for(_=2161;_<=2170;_++)F[_]=0;for(_=2172;_<=2193;_++)F[_]=0;for(_=2195;_<=2198;_++)F[_]=0;for(_=2200;_<=2203;_++)F[_]=0;for(_=2205;_<=2217;_++)F[_]=0;for(_=2222;_<=2224;_++)F[_]=1;for(_=2225;_<=2250;_++)F[_]=2;for(_=2251;_<=2253;_++)F[_]=1;for(_=2257;_<=2264;_++)F[_]=2;for(_=2274;_<=2279;_++)F[_]=2;for(_=2280;_<=2282;_++)F[_]=1;for(_=2283;_<=2289;_++)F[_]=2;for(_=2290;_<=2292;_++)F[_]=0;for(_=2308;_<=2313;_++)F[_]=0;for(_=2315;_<=2491;_++)F[_]=0;for(_=2494;_<=2866;_++)F[_]=0;for(_=2867;_<=2869;_++)F[_]=1;for(_=2870;_<=2888;_++)F[_]=2;for(_=2891;_<=2895;_++)F[_]=2;for(_=2896;_<=2898;_++)F[_]=1;for(_=2902;_<=2908;_++)F[_]=2;for(_=2915;_<=2920;_++)F[_]=2;for(_=2921;_<=2923;_++)F[_]=1;for(_=2924;_<=2930;_++)F[_]=2;for(_=2931;_<=2962;_++)F[_]=0;for(_=2964;_<=2968;_++)F[_]=2;for(_=2969;_<=2973;_++)F[_]=0;for(_=2975;_<=2991;_++)F[_]=0;for(_=2995;_<=3051;_++)F[_]=0;for(_=3054;_<=3079;_++)F[_]=0;for(_=3081;_<=3088;_++)F[_]=0;for(_=3092;_<=3101;_++)F[_]=0;for(_=3106;_<=3138;_++)F[_]=0;for(_=3146;_<=3151;_++)F[_]=0;for(_=3153;_<=3166;_++)F[_]=0;for(_=3168;_<=3172;_++)F[_]=0;for(_=3174;_<=3203;_++)F[_]=0;for(_=3294;_<=3358;_++)F[_]=0;for(_=3367;_<=3403;_++)F[_]=0;for(_=3408;_<=3416;_++)F[_]=0;for(_=3417;_<=3438;_++)F[_]=2;for(_=3441;_<=3446;_++)F[_]=2;for(_=3447;_<=3450;_++)F[_]=0;for(_=3451;_<=3459;_++)F[_]=2;for(_=3460;_<=3478;_++)F[_]=0;for(_=3554;_<=3559;_++)F[_]=0;for(_=3560;_<=3570;_++)F[_]=2;for(_=3571;_<=3581;_++)F[_]=0;for(_=3594;_<=3597;_++)F[_]=0;for(_=3601;_<=3604;_++)F[_]=0;for(_=3637;_<=3639;_++)F[_]=0;for(_=3665;_<=3667;_++)F[_]=0;for(_=3693;_<=3695;_++)F[_]=0;for(_=3701;_<=3727;_++)F[_]=0;for(_=3728;_<=3739;_++)F[_]=2;for(_=3740;_<=3751;_++)F[_]=0;for(_=3753;_<=3760;_++)F[_]=2;for(_=3761;_<=3773;_++)F[_]=0;for(_=3775;_<=3777;_++)F[_]=0;for(_=3779;_<=3781;_++)F[_]=0;for(_=3783;_<=3785;_++)F[_]=0;for(_=3788;_<=3791;_++)F[_]=0;for(_=3797;_<=3802;_++)F[_]=0;for(_=3814;_<=3816;_++)F[_]=0;for(_=3825;_<=3829;_++)F[_]=0;for(_=3832;_<=3841;_++)F[_]=0;for(_=3844;_<=3852;_++)F[_]=0;for(_=3873;_<=3885;_++)F[_]=0;for(_=3890;_<=3893;_++)F[_]=0;for(_=3907;_<=3912;_++)F[_]=0;for(_=3942;_<=3950;_++)F[_]=0;for(_=3968;_<=3970;_++)F[_]=0;for(_=3973;_<=3976;_++)F[_]=0;for(_=3986;_<=3989;_++)F[_]=0;for(_=3994;_<=3997;_++)F[_]=0;for(_=4048;_<=4051;_++)F[_]=0;for(_=4056;_<=4063;_++)F[_]=0;for(_=4093;_<=4096;_++)F[_]=0;for(_=4390;_<=4398;_++)F[_]=0;for(_=4399;_<=4413;_++)F[_]=2;for(_=4418;_<=4433;_++)F[_]=2;for(_=4455;_<=4457;_++)F[_]=2;for(_=4484;_<=4489;_++)F[_]=0;for(_=4491;_<=4554;_++)F[_]=0;for(_=4568;_<=4589;_++)F[_]=0;for(_=4652;_<=4656;_++)F[_]=0;for(_=4766;_<=4800;_++)F[_]=0;for(_=5014;_<=5016;_++)F[_]=0;for(_=5069;_<=5072;_++)F[_]=0;for(_=5105;_<=5130;_++)F[_]=0;for(_=5167;_<=5188;_++)F[_]=0;for(_=5253;_<=5259;_++)F[_]=0;for(_=5269;_<=5275;_++)F[_]=0;for(_=5292;_<=5311;_++)F[_]=0;for(_=5329;_<=5331;_++)F[_]=0;for(_=5343;_<=5349;_++)F[_]=0;for(_=5355;_<=5357;_++)F[_]=0;for(_=5387;_<=5389;_++)F[_]=0;for(_=5459;_<=5463;_++)F[_]=0;for(_=5479;_<=5482;_++)F[_]=0;for(_=5518;_<=5520;_++)F[_]=0;for(_=5530;_<=5539;_++)F[_]=0;for(_=5550;_<=5552;_++)F[_]=0;for(_=5562;_<=5583;_++)F[_]=0;for(_=5623;_<=5625;_++)F[_]=2;for(_=5631;_<=5639;_++)F[_]=0;for(_=5649;_<=5653;_++)F[_]=0;for(_=5663;_<=5680;_++)F[_]=0;for(_=5682;_<=5685;_++)F[_]=0;for(_=5875;_<=5877;_++)F[_]=0;for(_=5896;_<=5899;_++)F[_]=0;for(_=5921;_<=5940;_++)F[_]=0;for(_=6050;_<=6125;_++)F[_]=0;for(_=6244;_<=6275;_++)F[_]=0;for(_=6328;_<=6348;_++)F[_]=0;for(_=6350;_<=6356;_++)F[_]=0;for(_=6366;_<=6372;_++)F[_]=0;for(_=6381;_<=6387;_++)F[_]=0;for(_=6393;_<=6404;_++)F[_]=0;for(_=6480;_<=6483;_++)F[_]=0;for(_=6511;_<=6514;_++)F[_]=0;for(_=6579;_<=6581;_++)F[_]=0;for(_=6619;_<=6624;_++)F[_]=0;for(_=6625;_<=6627;_++)F[_]=2;for(_=6628;_<=6632;_++)F[_]=0;for(_=6634;_<=6637;_++)F[_]=0;for(_=6669;_<=6692;_++)F[_]=0;for(_=6707;_<=6709;_++)F[_]=0;for(_=6720;_<=6723;_++)F[_]=0;for(_=6732;_<=6738;_++)F[_]=0;for(_=6931;_<=6933;_++)F[_]=0;for(_=6956;_<=6959;_++)F[_]=0;for(_=7005;_<=7007;_++)F[_]=0;for(_=7057;_<=7070;_++)F[_]=2;for(_=7074;_<=7082;_++)F[_]=0;for(_=7109;_<=7118;_++)F[_]=0;for(_=7119;_<=7127;_++)F[_]=1;for(_=7374;_<=7376;_++)F[_]=0;for(_=7528;_<=7586;_++)F[_]=0;for(_=7587;_<=7645;_++)F[_]=2;for(_=7692;_<=7696;_++)F[_]=0;for(_=7755;_<=7787;_++)F[_]=0;for(_=7791;_<=7795;_++)F[_]=0;for(_=7799;_<=7801;_++)F[_]=0;for(_=7803;_<=7805;_++)F[_]=0;for(_=7825;_<=7831;_++)F[_]=0;for(_=7845;_<=7859;_++)F[_]=0;for(_=8013;_<=8032;_++)F[_]=0;for(_=8065;_<=8068;_++)F[_]=1;for(_=8518;_<=8529;_++)F[_]=2;for(_=8533;_<=8536;_++)F[_]=2;for(_=8538;_<=8540;_++)F[_]=2;for(_=8677;_<=8679;_++)F[_]=0;for(_=8836;_<=8840;_++)F[_]=0;for(_=8857;_<=8859;_++)F[_]=0;for(_=8908;_<=8910;_++)F[_]=0;for(_=9154;_<=9159;_++)F[_]=0;for(_=9205;_<=9218;_++)F[_]=0;for(_=9271;_<=9273;_++)F[_]=0;for(_=9295;_<=9297;_++)F[_]=0;for(_=9356;_<=9360;_++)F[_]=0;for(_=9404;_<=9407;_++)F[_]=0;for(_=9476;_<=9482;_++)F[_]=0;for(_=9487;_<=9494;_++)F[_]=0;for(_=9697;_<=9699;_++)F[_]=0;for(_=9821;_<=9865;_++)F[_]=0;for(_=10285;_<=10291;_++)F[_]=0;for(_=10314;_<=10317;_++)F[_]=0;for(_=10448;_<=10465;_++)F[_]=0;for(_=10731;_<=10733;_++)F[_]=0;for(_=11114;_<=11118;_++)F[_]=0;for(_=20004;_<=20032;_++)F[_]=0;for(_=20047;_<=20049;_++)F[_]=0;for(_=20062;_<=20092;_++)F[_]=0;for(_=20135;_<=20138;_++)F[_]=0;for(_=20248;_<=20258;_++)F[_]=0;for(_=20348;_<=20358;_++)F[_]=0;for(_=20436;_<=20440;_++)F[_]=0;for(_=20822;_<=20824;_++)F[_]=0;for(_=20904;_<=20932;_++)F[_]=0;for(_=20934;_<=20936;_++)F[_]=0;for(_=21004;_<=21032;_++)F[_]=0;for(_=21035;_<=21037;_++)F[_]=0;for(_=21095;_<=21097;_++)F[_]=0;for(_=21148;_<=21150;_++)F[_]=0;for(_=21207;_<=21264;_++)F[_]=0;for(_=21307;_<=21364;_++)F[_]=0;for(_=21413;_<=21423;_++)F[_]=0;for(_=21453;_<=21463;_++)F[_]=0;for(_=21473;_<=21483;_++)F[_]=0;for(_=21780;_<=21782;_++)F[_]=0;for(_=21891;_<=21894;_++)F[_]=0;for(_=21896;_<=21899;_++)F[_]=0;for(_=22171;_<=22177;_++)F[_]=0;for(_=22181;_<=22187;_++)F[_]=0;for(_=22191;_<=22197;_++)F[_]=0;for(_=22207;_<=22222;_++)F[_]=0;for(_=22229;_<=22232;_++)F[_]=0;for(_=22234;_<=22236;_++)F[_]=0;for(_=22243;_<=22250;_++)F[_]=0;for(_=22262;_<=22265;_++)F[_]=0;for(_=22307;_<=22322;_++)F[_]=0;for(_=22348;_<=22357;_++)F[_]=0;for(_=22407;_<=22422;_++)F[_]=0;for(_=22462;_<=22465;_++)F[_]=0;for(_=22521;_<=22525;_++)F[_]=0;for(_=22607;_<=22622;_++)F[_]=0;for(_=22641;_<=22646;_++)F[_]=0;for(_=22648;_<=22657;_++)F[_]=0;for(_=22707;_<=22722;_++)F[_]=0;for(_=22762;_<=22765;_++)F[_]=0;for(_=22807;_<=22822;_++)F[_]=0;for(_=22991;_<=22994;_++)F[_]=0;for(_=23028;_<=23038;_++)F[_]=0;for(_=23301;_<=23333;_++)F[_]=2;for(_=23830;_<=23853;_++)F[_]=0;for(_=23866;_<=23872;_++)F[_]=0;for(_=23877;_<=23884;_++)F[_]=0;for(_=23886;_<=23894;_++)F[_]=0;for(_=23946;_<=23948;_++)F[_]=0;for(_=24311;_<=24313;_++)F[_]=0;for(_=24342;_<=24347;_++)F[_]=0;for(_=24370;_<=24374;_++)F[_]=10;for(_=24375;_<=24381;_++)F[_]=0;for(_=24718;_<=24721;_++)F[_]=0;for(_=24817;_<=24821;_++)F[_]=0;for(_=24877;_<=24882;_++)F[_]=0;for(_=24891;_<=24893;_++)F[_]=0;for(_=25391;_<=25395;_++)F[_]=0;for(_=25828;_<=25838;_++)F[_]=0;for(_=26191;_<=26195;_++)F[_]=0;for(_=26391;_<=26393;_++)F[_]=0;for(_=26701;_<=26722;_++)F[_]=0;for(_=26729;_<=26799;_++)F[_]=2;for(_=26801;_<=26803;_++)F[_]=2;for(_=26811;_<=26813;_++)F[_]=2;for(_=26847;_<=26870;_++)F[_]=2;for(_=26891;_<=26899;_++)F[_]=0;for(_=26901;_<=26923;_++)F[_]=0;for(_=26929;_<=26946;_++)F[_]=0;for(_=26948;_<=26998;_++)F[_]=0;for(_=27037;_<=27040;_++)F[_]=0;for(_=27205;_<=27232;_++)F[_]=0;for(_=27258;_<=27260;_++)F[_]=0;for(_=27391;_<=27398;_++)F[_]=0;for(_=27561;_<=27564;_++)F[_]=0;for(_=27571;_<=27574;_++)F[_]=0;for(_=27581;_<=27584;_++)F[_]=0;for(_=27591;_<=27594;_++)F[_]=0;for(_=27700;_<=27707;_++)F[_]=0;for(_=28191;_<=28193;_++)F[_]=0;for(_=28348;_<=28358;_++)F[_]=0;for(_=28402;_<=28432;_++)F[_]=0;for(_=28462;_<=28492;_++)F[_]=0;for(_=29118;_<=29122;_++)F[_]=0;for(_=29168;_<=29172;_++)F[_]=0;for(_=29177;_<=29185;_++)F[_]=0;for(_=29187;_<=29195;_++)F[_]=0;for(_=29900;_<=29903;_++)F[_]=0;for(_=30161;_<=30179;_++)F[_]=0;for(_=30491;_<=30494;_++)F[_]=0;for(_=30729;_<=30732;_++)F[_]=0;for(_=31251;_<=31259;_++)F[_]=0;for(_=31265;_<=31268;_++)F[_]=0;for(_=31275;_<=31279;_++)F[_]=0;for(_=31281;_<=31297;_++)F[_]=0;for(_=31461;_<=31469;_++)F[_]=0;for(_=31491;_<=31495;_++)F[_]=0;for(_=31917;_<=31922;_++)F[_]=0;for(_=31965;_<=32e3;_++)F[_]=0;for(_=32001;_<=32003;_++)F[_]=2;for(_=32005;_<=32031;_++)F[_]=2;for(_=32033;_<=32060;_++)F[_]=2;for(_=32064;_<=32067;_++)F[_]=2;for(_=32074;_<=32077;_++)F[_]=2;for(_=32081;_<=32086;_++)F[_]=0;for(_=32107;_<=32130;_++)F[_]=0;for(_=32133;_<=32159;_++)F[_]=0;for(_=32164;_<=32167;_++)F[_]=2;for(_=32180;_<=32199;_++)F[_]=0;for(_=32201;_<=32260;_++)F[_]=0;for(_=32301;_<=32360;_++)F[_]=0;for(_=32401;_<=32460;_++)F[_]=0;for(_=32501;_<=32560;_++)F[_]=0;for(_=32601;_<=32662;_++)F[_]=0;for(_=32664;_<=32667;_++)F[_]=2;for(_=32701;_<=32761;_++)F[_]=0;for(_=53001;_<=53004;_++)F[_]=0;for(_=53008;_<=53019;_++)F[_]=0;for(_=53021;_<=53032;_++)F[_]=0;for(_=53034;_<=53037;_++)F[_]=0;for(_=53042;_<=53046;_++)F[_]=0;for(_=53074;_<=53080;_++)F[_]=0;for(_=54001;_<=54004;_++)F[_]=0;for(_=54008;_<=54019;_++)F[_]=0;for(_=54021;_<=54032;_++)F[_]=0;for(_=54034;_<=54037;_++)F[_]=0;for(_=54042;_<=54046;_++)F[_]=0;for(_=54048;_<=54053;_++)F[_]=0;for(_=54074;_<=54080;_++)F[_]=0;for(_=54098;_<=54101;_++)F[_]=0;for(_=102001;_<=102040;_++)F[_]=0;for(_=102042;_<=102063;_++)F[_]=0;for(_=102065;_<=102067;_++)F[_]=0;for(_=102070;_<=102117;_++)F[_]=0;for(_=102122;_<=102216;_++)F[_]=0;for(_=102221;_<=102377;_++)F[_]=0;for(_=102382;_<=102388;_++)F[_]=0;for(_=102389;_<=102398;_++)F[_]=2;for(_=102399;_<=102444;_++)F[_]=0;for(_=102445;_<=102447;_++)F[_]=2;for(_=102448;_<=102458;_++)F[_]=0;for(_=102459;_<=102468;_++)F[_]=2;for(_=102469;_<=102499;_++)F[_]=0;for(_=102500;_<=102519;_++)F[_]=1;for(_=102520;_<=102524;_++)F[_]=0;for(_=102525;_<=102529;_++)F[_]=2;for(_=102530;_<=102588;_++)F[_]=0;for(_=102590;_<=102598;_++)F[_]=0;for(_=102601;_<=102603;_++)F[_]=0;for(_=102605;_<=102628;_++)F[_]=0;for(_=102629;_<=102646;_++)F[_]=2;for(_=102648;_<=102700;_++)F[_]=2;for(_=102701;_<=102703;_++)F[_]=0;for(_=102707;_<=102730;_++)F[_]=2;for(_=102733;_<=102758;_++)F[_]=2;for(_=102767;_<=102900;_++)F[_]=0;for(_=102901;_<=102933;_++)F[_]=2;for(_=102934;_<=102950;_++)F[_]=13;for(_=102951;_<=102963;_++)F[_]=0;for(_=102965;_<=102969;_++)F[_]=0;for(_=102971;_<=102973;_++)F[_]=0;for(_=102975;_<=102989;_++)F[_]=0;for(_=102990;_<=102992;_++)F[_]=1;for(_=102997;_<=103002;_++)F[_]=0;for(_=103003;_<=103008;_++)F[_]=2;for(_=103009;_<=103011;_++)F[_]=0;for(_=103012;_<=103014;_++)F[_]=2;for(_=103019;_<=103021;_++)F[_]=0;for(_=103022;_<=103024;_++)F[_]=2;for(_=103029;_<=103031;_++)F[_]=0;for(_=103032;_<=103034;_++)F[_]=2;for(_=103065;_<=103068;_++)F[_]=0;for(_=103074;_<=103076;_++)F[_]=0;for(_=103077;_<=103079;_++)F[_]=1;for(_=103080;_<=103082;_++)F[_]=0;for(_=103083;_<=103085;_++)F[_]=2;for(_=103090;_<=103093;_++)F[_]=0;for(_=103097;_<=103099;_++)F[_]=0;for(_=103100;_<=103102;_++)F[_]=2;for(_=103107;_<=103109;_++)F[_]=0;for(_=103110;_<=103112;_++)F[_]=2;for(_=103113;_<=103116;_++)F[_]=0;for(_=103117;_<=103120;_++)F[_]=2;for(_=103153;_<=103157;_++)F[_]=0;for(_=103158;_<=103162;_++)F[_]=2;for(_=103163;_<=103165;_++)F[_]=0;for(_=103166;_<=103168;_++)F[_]=1;for(_=103169;_<=103171;_++)F[_]=2;for(_=103186;_<=103188;_++)F[_]=0;for(_=103189;_<=103191;_++)F[_]=2;for(_=103192;_<=103195;_++)F[_]=0;for(_=103196;_<=103199;_++)F[_]=2;for(_=103200;_<=103224;_++)F[_]=0;for(_=103225;_<=103227;_++)F[_]=1;for(_=103232;_<=103237;_++)F[_]=0;for(_=103238;_<=103243;_++)F[_]=2;for(_=103244;_<=103246;_++)F[_]=0;for(_=103247;_<=103249;_++)F[_]=2;for(_=103254;_<=103256;_++)F[_]=0;for(_=103257;_<=103259;_++)F[_]=2;for(_=103264;_<=103266;_++)F[_]=0;for(_=103267;_<=103269;_++)F[_]=2;for(_=103300;_<=103375;_++)F[_]=0;for(_=103381;_<=103383;_++)F[_]=0;for(_=103384;_<=103386;_++)F[_]=1;for(_=103387;_<=103389;_++)F[_]=0;for(_=103390;_<=103392;_++)F[_]=2;for(_=103397;_<=103399;_++)F[_]=0;for(_=103400;_<=103471;_++)F[_]=2;for(_=103476;_<=103478;_++)F[_]=0;for(_=103479;_<=103481;_++)F[_]=2;for(_=103486;_<=103488;_++)F[_]=0;for(_=103489;_<=103491;_++)F[_]=2;for(_=103492;_<=103495;_++)F[_]=0;for(_=103496;_<=103499;_++)F[_]=2;for(_=103528;_<=103543;_++)F[_]=0;for(_=103544;_<=103548;_++)F[_]=2;for(_=103549;_<=103551;_++)F[_]=0;for(_=103552;_<=103554;_++)F[_]=1;for(_=103555;_<=103557;_++)F[_]=2;for(_=103558;_<=103560;_++)F[_]=0;for(_=103571;_<=103573;_++)F[_]=0;for(_=103574;_<=103576;_++)F[_]=2;for(_=103577;_<=103580;_++)F[_]=0;for(_=103581;_<=103583;_++)F[_]=2;for(_=103595;_<=103694;_++)F[_]=0;for(_=103696;_<=103699;_++)F[_]=0;for(_=103700;_<=103793;_++)F[_]=2;for(_=103794;_<=103890;_++)F[_]=0;for(_=103891;_<=103896;_++)F[_]=2;for(_=103900;_<=103971;_++)F[_]=2;for(_=103972;_<=103977;_++)F[_]=0;for(_=112e3;_<=112101;_++)F[_]=0;const QEe=[102100,102113,3857,3785],nYe=[104905,104971],oYe=[4326,...QEe,...nYe],Ihe='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',pF=[-20037508342788905e-9,20037508342788905e-9],fF=[-20037508342787e-6,20037508342787e-6],KEe={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:pF,origin:fF,dx:1e-5},102100:{wkTemplate:Ihe,valid:pF,origin:fF,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:pF,origin:fF,dx:1e-5},3857:{wkTemplate:Ihe,valid:pF,origin:fF,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function ms(t,e){if(t===e)return!0;if(t==null||e==null)return!1;const i=t.wkid,r=e.wkid;if(i!=null||r!=null){if(i===r||am(t)&&am(e))return!0;const o=t.latestWkid;if(o!=null&&r===o)return!0;const a=e.latestWkid;return a!=null&&i===a}let s,n;return t.wkt2&&e.wkt2?(s=t.wkt2,n=e.wkt2):t.wkt&&e.wkt&&(s=t.wkt,n=e.wkt),!(!s||!n)&&s.toUpperCase()===n.toUpperCase()}function ey(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&KEe[e]||null}function nP(t){if(!t)return;const{wkid:e,vcsWkid:i}=t;if(e)return i?JSON.stringify({wkid:e,vcsWkid:i}):String(e);const r=t.wkt||t.wkt2;return JSON.stringify(r?i?{wkt:r,vcsWkid:i}:{wkt:r}:{})}function GD(t){if(!zf(t))return!1;const{wkid:e}=t;if(e)return F[e]==null;const i=t.wkt2||t.wkt;return!!i&&/^\s*(?:GEOGCS|GEOGCRS|GEOGRAPHICCRS)/i.test(i)}function r2(t){return!(U2(t)||V2(t))}function C_(t){return(t==null?void 0:t.wkid)===4326}function gWt(t){return/^\s*(?:GEOD|GEODETIC|GEOG|GEOGRAPHIC|PROJ|PROJECTED|VERT|VERTICAL|ENG|ENGINEERING|PARAMETRIC|TIME|DERIVEDPROJ|COMPOUND|BOUND)CRS/i.test(t)}function oP(t){return(t==null?void 0:t.wkid)===Du.CGCS2000}function am(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&QEe.includes(e)}function s2(t){return(t==null?void 0:t.wkid)===32662}function aP(t){return t===Du.GCSMARS2000||t===Du.GCSMARS2000_SPHERE}function U2(t){return aP(t==null?void 0:t.wkid)}function lP(t){return t===Du.GCSMOON2000}function V2(t){return lP(t==null?void 0:t.wkid)}function aYe(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&oYe.includes(e)}function zf(t){if(t==null)return!1;const e=t.wkid;return e!=null&&e>=2e3||t.wkt2!=null||t.wkt!=null}const eCe={wkid:4326,wkt:py(KEe[4326].wkTemplate,{Central_Meridian:"0.0"})},tCe={wkid:102100,latestWkid:3857},lYe={wkid:32662};function Wre(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const iCe=Wre(ur),SG=Wre(Qf),EG=Wre(E_),rCe={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${ur.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`},cYe=SG.wkt.toUpperCase(),uYe=EG.wkt.toUpperCase();function br(t){if(t!=null&&zf(t)){const e=t.wkid,i=t.wkt2??t.wkt;if(aP(e))return Qf;const r=i==null?void 0:i.toUpperCase();if(i&&r===cYe)return Qf;if(lP(e)||r&&r===uYe)return E_}return ur}function yWt(t){return aP(t)?Qf:lP(t)?E_:ur}function PL(t){return ms(t,iCe)}function kb(t){return PL(t)||ms(t,SG)||ms(t,EG)}const Zre=39.37,hYe=ur.radius*Math.PI/200,sCe=/(?:LENGTH)?UNIT\[([^\]]+)]]$/i,MS=F,nCe=/UNIT\[([^\]]+)]/i,dYe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),pYe=lc()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Tm=t=>t*t,pv=t=>t*t*t,OL={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Tm(.001)},"square-centimeters":{inBaseUnits:Tm(.01)},"square-decimeters":{inBaseUnits:Tm(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Tm(1e3)},"square-inches":{inBaseUnits:Tm(.0254)},"square-feet":{inBaseUnits:Tm(.3048)},"square-yards":{inBaseUnits:Tm(.9144)},"square-miles":{inBaseUnits:Tm(1609.344)},"square-us-feet":{inBaseUnits:Tm(1200/3937)},acres:{inBaseUnits:.0015625*Tm(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*pv(.001)},"cubic-centimeters":{inBaseUnits:1e3*pv(.01)},"cubic-decimeters":{inBaseUnits:1e3*pv(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*pv(1e3)},"cubic-inches":{inBaseUnits:1e3*pv(.0254)},"cubic-feet":{inBaseUnits:1e3*pv(.3048)},"cubic-yards":{inBaseUnits:1e3*pv(.9144)},"cubic-miles":{inBaseUnits:1e3*pv(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},fYe=(()=>{const t={};for(const e in OL)for(const i in OL[e].units)t[i]=e;return t})();function mYe(t,e,i){return t*OL[i].units[e].inBaseUnits}function gYe(t,e,i){return t/OL[i].units[e].inBaseUnits}const oCe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"],yYe=new Map([["meters","square-meters"],["feet","square-feet"],["us-feet","square-us-feet"]]);function n2(t){const e=fYe[t];if(!e)throw new Error("unknown type");return e}function Lhe(t,e=null){return e=e||n2(t),OL[e].baseUnit===t}function Br(t,e,i){if(e===i)return t;const r=n2(e);if(r!==n2(i))throw new Error("incompatible units");const s=Lhe(e,r)?t:mYe(t,e,r);return Lhe(i,r)?s:gYe(s,i,r)}function _Ye(t){switch(t){case"metric":return"meters";case"imperial":return"feet";default:return t}}function _Wt(t){return _Ye(t)}function vWt(t){switch(t){case"metric":return"square-meters";case"imperial":return"square-feet";default:return t}}function bWt(t,e,i){switch(i){case"metric":return Yre(t,e);case"imperial":return Jre(t,e);default:return i}}function wWt(t,e,i){switch(i){case"metric":return Xre(t,e);case"imperial":return Qre(t,e);default:return i}}function Yre(t,e){const i=Br(t,e,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function Xre(t,e){const i=Br(t,e,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function Jre(t,e){const i=Br(t,e,"feet");return Math.abs(i)<1e3?"feet":"miles"}function Qre(t,e){const i=Br(t,e,"feet");return Math.abs(i)<1e5?"feet":"miles"}function vYe(t,e){const i=Br(t,e,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function bYe(t,e){const i=Br(t,e,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function wYe(t,e,i){return Br(t,e,"meters")/(i*Math.PI/180)}function aCe(t){return pYe.fromJSON(t.toLowerCase())||null}function M_(t){if(t!=null&&!r2(t))return 1;const e=cc(t);return e>1e5?1:e}function lCe(t){return cc(t)>=br(t).metersPerDegree?"meters":HD(t)}function cc(t,e=ur.metersPerDegree){return xYe(t,!0)??e}function xYe(t,e=!1){const i=(t==null?void 0:t.wkid)??null,r=(t==null?void 0:t.wkt2)??(t==null?void 0:t.wkt)??null;let s=null;if(i){if(aP(i))return Qf.metersPerDegree;if(lP(i))return E_.metersPerDegree;s=MS.values[MS[i]],!s&&e&&dYe.has(i)&&(s=hYe)}else r&&(pCe(r)?s=Nhe(sCe.exec(r),s):dCe(r)&&(s=Nhe(nCe.exec(r),s)));return s}function Dhe(t){return GD(t)?1:cc(t)}function Nhe(t,e){return t!=null&&t[1]?cCe(t[1]):e}function cCe(t){return parseFloat(t.split(",")[1])}function HD(t){const e=(t==null?void 0:t.wkid)??null,i=(t==null?void 0:t.wkt2)??(t==null?void 0:t.wkt)??null;let r=null;if(e)r=MS.units[MS[e]];else if(i){const s=pCe(i)?sCe:dCe(i)?nCe:null;if(s){const n=s.exec(i);n!=null&&n[1]&&(r=SYe(n[1]))}}return r!=null?aCe(r):null}function uCe(t){const e=HD(t);return e!=null&&oCe.includes(e)?e:null}function hCe(t){const e=lCe(t);return e!=null&&oCe.includes(e)?e:null}function xWt(t){const e=HD(t);return e==null?null:yYe.get(e)}function dCe(t){return/^GEOCCS/i.test(t)}function pCe(t){return/^\s*(?:PROJCS|PROJCRS|PROJECTEDCRS)/i.test(t)}const TYe=1e-7;function SYe(t){const e=/[\\"']{1}([^\\"']+)/.exec(t);let i=e==null?void 0:e[1];if(!i||!MS.units.includes(i)){const r=cCe(t);i=null;const s=MS.values;for(let n=0;n<s.length;++n)if(Math.abs(r-s[n])<TYe){i=MS.units[n];break}}return i}function TWt(t){const e=HD(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const EYe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},CYe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},MYe={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},AYe=lc()(EYe),PYe=lc()(CYe),SWt=lc()(MYe);var Wm;let Dr=Wm=class extends Se{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return Wm.WebMercator;if(t.wkid===4326)return Wm.WGS84}const e=new Wm;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.wkt2=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return C_(this)}get isWebMercator(){return am(this)}get isGeographic(){return GD(this)}get isWrappable(){return aYe(this)}get metersPerUnit(){return cc(this)}get unit(){return HD(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===Wm.WGS84)return new Wm(eCe);if(this===Wm.WebMercator)return new Wm(tCe);const t=new Wm;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):(this.wkt!=null&&(t.wkt=this.wkt),this.wkt2!=null&&(t.wkt2=this.wkt2)),this.imageCoordinateSystem&&(t.imageCoordinateSystem=re(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:i}=t.imageCoordinateSystem,{geodataXform:r}=t.imageCoordinateSystem,s=this.imageCoordinateSystem;return e==null||r?JSON.stringify(s)===JSON.stringify(t.imageCoordinateSystem):i?s.id===e&&s.referenceServiceName===i:s.id===e}return ms(this,t)}toJSON(t){return this.write(void 0,t)}};Dr.GCS_NAD_1927=null,Dr.WGS84=null,Dr.WebMercator=null,Dr.PlateCarree=null,h([p({readOnly:!0})],Dr.prototype,"isWGS84",null),h([p({readOnly:!0})],Dr.prototype,"isWebMercator",null),h([p({readOnly:!0})],Dr.prototype,"isGeographic",null),h([p({readOnly:!0})],Dr.prototype,"isWrappable",null),h([p({type:Ji,json:{write:!0}})],Dr.prototype,"latestWkid",void 0),h([p({readOnly:!0})],Dr.prototype,"metersPerUnit",null),h([p({readOnly:!0})],Dr.prototype,"unit",null),h([p({type:Ji,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],Dr.prototype,"wkid",void 0),h([p({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],Dr.prototype,"wkt",void 0),h([Ze("wkt"),Ze("web-scene","wkt")],Dr.prototype,"writeWkt",null),h([p({type:String,json:{write:!1}})],Dr.prototype,"wkt2",void 0),h([p({type:Ji,json:{write:!0}})],Dr.prototype,"vcsWkid",void 0),h([p({type:Ji,json:{write:!0}})],Dr.prototype,"latestVcsWkid",void 0),h([p()],Dr.prototype,"imageCoordinateSystem",void 0),Dr=Wm=h([I("esri.geometry.SpatialReference")],Dr),Dr.prototype.toJSON.isDefaultToJSON=!0,Dr.GCS_NAD_1927=new Dr({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Dr.WGS84=new Dr(eCe),Dr.WebMercator=new Dr(tCe),Dr.PlateCarree=new Dr(lYe),Object.freeze&&(Object.freeze(Dr.GCS_NAD_1927),Object.freeze(Dr.WGS84),Object.freeze(Dr.WebMercator),Object.freeze(Dr.PlateCarree));const Ye=Dr;function ze(t,e,i){let r,s;return e===void 0||Array.isArray(e)?(s=t,i=e,r=[void 0]):(s=e,r=Array.isArray(t)?t:[t]),(n,o)=>{const a=n.constructor.prototype;r.forEach(l=>{const c=aEe(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],i&&(c.read.source=(c.read.source||[]).concat(i))})}}let Zm=class extends Se{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Ye.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,i){if(e instanceof Ye)return e;if(e!=null){const r=new Ye;return r.read(e,i),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,i){this.cache[e]=i}};h([p()],Zm.prototype,"type",void 0),h([p({readOnly:!0})],Zm.prototype,"cache",null),h([p({readOnly:!0})],Zm.prototype,"extent",null),h([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Zm.prototype,"hasM",void 0),h([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Zm.prototype,"hasZ",void 0),h([p({type:Ye,json:{write:!0},value:Ye.WGS84})],Zm.prototype,"spatialReference",void 0),h([ze("spatialReference")],Zm.prototype,"readSpatialReference",null),Zm=h([I("esri.geometry.Geometry")],Zm);const pw=Zm,OYe=Object.prototype.toString;function $Ye(t){const e="__accessorMetadata__"in t?nn(t):t;return function(...i){if(i.push(e),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return RYe.apply(this,i)}}function RYe(t,e,i,r){vG(t,e).cast=r}function IYe(t){return(e,i)=>{vG(e,t).cast=e[i]}}function Qt(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&OYe.call(t[0])==="[object Function]"?$Ye(t[0]):t.length===1&&typeof t[0]=="string"?IYe(t[0]):void 0}const LYe=57.29577951308232,DYe=.017453292519943;function Fhe(t){return t*LYe}function khe(t){return t*DYe}function Uhe(t){return t/ur.radius}function Uz(t){return Math.PI/2-2*Math.atan(Math.exp(-t/ur.radius))}function QZ(t){return t.wkid!=null||t.wkt!=null}const EH=[0,0];function Vz(t,e,i,r,s){const n=t,o=s;if(o.spatialReference=i,"x"in n&&"x"in o)[o.x,o.y]=e(n.x,n.y,EH,r);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=e(n.xmin,n.ymin,EH,r),[o.xmax,o.ymax]=e(n.xmax,n.ymax,EH,r);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let u=0;u<a.length;u++){const d=a[u];c=[],l.push(c);for(let f=0;f<d.length;f++)c.push(e(d[f][0],d[f][1],[0,0],r)),d[f].length>2&&c[f].push(d[f][2]),d[f].length>3&&c[f].push(d[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],r),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function kk(t,e){const i=t&&(QZ(t)?t:t.spatialReference),r=e&&(QZ(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!i||!r)&&(!!ms(r,i)||am(r)&&C_(i)||am(i)&&C_(r))}function qD(t,e){if(t==null)return null;const i=t.spatialReference,r=e&&(QZ(e)?e:e.spatialReference);return kk(i,r)?ms(i,r)?re(t):am(r)?Vz(t,OM,Ye.WebMercator,!1,re(t)):C_(r)?Vz(t,CG,Ye.WGS84,!1,re(t)):null:null}function OM(t,e,i=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const r=khe(e);return i[0]=khe(t)*ur.radius,i[1]=ur.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function CG(t,e,i=[0,0],r=!1){const s=Fhe(t/ur.radius);return i[0]=r?s:s-360*Math.floor((s+180)/360),i[1]=Fhe(Math.PI/2-2*Math.atan(Math.exp(-e/ur.radius))),i}function ty(t,e=!1,i=re(t)){return Vz(t,OM,Ye.WebMercator,e,i)}function $M(t,e=!1,i=re(t)){return Vz(t,CG,Ye.WGS84,e,i)}function NYe(t,e){const i=t.x-e.x,r=t.y-e.y,s=t.z!=null&&e.z!=null?t.z-e.z:0;return Math.sqrt(i*i+r*r+s*s)}function FYe(t){var e;return((e=fCe(t,mCe))==null?void 0:e[0])??null}function kYe(t){var e;return((e=fCe(t,mCe))==null?void 0:e[1])??null}function fCe({x:t,y:e,spatialReference:i},r=[0,0]){if(i){if(am(i))return CG(t,e,r);if(GD(i))return r[0]=t,r[1]=e,r}return null}const mCe=[0,0];var Uk;const CH=[0,0];function Vhe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Cc=Uk=class extends pw{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const i=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(i)?i:i.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,i,r,s){let n;if(Array.isArray(t))n=t,s=e,t=n[0],e=n[1],i=n[2],r=n[3];else if(t&&typeof t=="object"){if(n=t,t=n.x!=null?n.x:n.longitude,e=n.y!=null?n.y:n.latitude,i=n.z,r=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new Ye(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)ne.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)ne.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&(s!=null&&s.isWebMercator)){const a=OM(n.longitude,n.latitude,CH);t=a[0],e=a[1]}}}else Vhe(i)?(s=i,i=null):Vhe(r)&&(s=r,r=null);const o={x:t,y:e};return o.x==null&&o.y!=null?ne.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&ne.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),i!=null&&(o.z=i),r!=null&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){return kYe(this)}set latitude(t){const{spatialReference:e,x:i}=this;t!=null&&e&&(e.isWebMercator?this._set("y",OM(i,t,CH)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){return FYe(this)}set longitude(t){const{y:e,spatialReference:i}=this;t!=null&&i&&(i.isWebMercator?this._set("x",OM(t,e,CH)[0]):i.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,i){e[i]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new Uk;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return Uk.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:i,z:r,m:s,spatialReference:n}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:u}=t;if(!n.equals(u))if(n.isWebMercator&&u.isWGS84)[l,c]=OM(l,c),u=n;else{if(!n.isWGS84||!u.isWebMercator)return!1;[l,c]=CG(l,c),u=n}return e===l&&i===c&&r===o&&s===a&&n.wkid===u.wkid}offset(t,e,i){return this.x+=t,this.y+=e,i!=null&&(this.z=(this.z??0)+i),this}normalize(){if(!this.spatialReference)return this;const t=ey(this.spatialReference);if(!t)return this;let e=this.x;const[i,r]=t.valid,s=2*r;let n;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s),this._set("x",e),this}distance(t){return NYe(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};h([p({readOnly:!0})],Cc.prototype,"cache",null),h([p({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Cc.prototype,"hasM",null),h([p({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Cc.prototype,"hasZ",null),h([p({type:Number})],Cc.prototype,"latitude",null),h([p({type:Number})],Cc.prototype,"longitude",null),h([p({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),Qt(t=>isNaN(t)?t:Wd(t))],Cc.prototype,"x",void 0),h([Ze("x")],Cc.prototype,"writeX",null),h([ze("x")],Cc.prototype,"readX",null),h([p({type:Number,json:{write:!0}})],Cc.prototype,"y",void 0),h([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Cc.prototype,"z",void 0),h([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Cc.prototype,"m",void 0),Cc=Uk=h([I("esri.geometry.Point")],Cc),Cc.prototype.toJSON.isDefaultToJSON=!0;const wt=Cc,MH=[0,0];function Kre(t,e){return e!=null&&ql(t,e.x,e.y,e.z)}function CWt(t,e){if(!e.points||e.points.length)return!1;for(const i of e.points)if(!cP(t,i))return!1;return!0}function UYe(t,e){const{xmin:i,ymin:r,zmin:s,xmax:n,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?ql(t,i,r,s)&&ql(t,i,o,s)&&ql(t,n,o,s)&&ql(t,n,r,s)&&ql(t,i,r,a)&&ql(t,i,o,a)&&ql(t,n,o,a)&&ql(t,n,r,a):ql(t,i,r)&&ql(t,i,o)&&ql(t,n,o)&&ql(t,n,r)}function cP(t,e){return ql(t,e[0],e[1])}function VYe(t,e){return ql(t,e[0],e[1],e[2])}function ql(t,e,i,r){return e>=t.xmin&&e<=t.xmax&&i>=t.ymin&&i<=t.ymax&&(r==null||!t.hasZ||r>=t.zmin&&r<=t.zmax)}function zYe(t,e){return MH[1]=e.y,MH[0]=e.x,BYe(t,MH)}function BYe(t,e){return gCe(t.rings,e)}function gCe(t,e){if(!t)return!1;if(jYe(t))return zhe(!1,t,e);let i=!1;for(let r=0,s=t.length;r<s;r++)i=zhe(i,t[r],e);return i}function jYe(t){return!Array.isArray(t[0][0])}function zhe(t,e,i){const[r,s]=i;let n=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,u]=e[a],[d,f]=e[o];(u<s&&f>=s||f<s&&u>=s)&&c+(s-u)/(f-u)*(d-c)<r&&(n=!n)}return n}function GYe(t,e){return Kre(t,e)}function HYe(t,e){const i=t.hasZ&&e.hasZ;let r,s,n;if(t.xmin<=e.xmin){if(r=e.xmin,t.xmax<r)return!1}else if(r=t.xmin,e.xmax<r)return!1;if(t.ymin<=e.ymin){if(s=e.ymin,t.ymax<s)return!1}else if(s=t.ymin,e.ymax<s)return!1;if(i&&e.hasZ){if(t.zmin<=e.zmin){if(n=e.zmin,t.zmax<n)return!1}else if(n=t.zmin,e.zmax<n)return!1}return!0}function qYe(t,e){const{points:i,hasZ:r}=e,s=r?VYe:cP;for(const n of i)if(s(t,n))return!0;return!1}const o2=[0,0],a2=[0,0],l2=[0,0],c2=[0,0],WYe=[o2,a2,l2,c2],yCe=[[l2,o2],[o2,a2],[a2,c2],[c2,l2]];function ZYe(t,e){return YYe(t,e.rings)}function YYe(t,e){o2[0]=t.xmin,o2[1]=t.ymax,a2[0]=t.xmax,a2[1]=t.ymax,l2[0]=t.xmin,l2[1]=t.ymin,c2[0]=t.xmax,c2[1]=t.ymin;for(const i of WYe)if(gCe(e,i))return!0;for(const i of e){if(!i.length)continue;let r=i[0];if(cP(t,r))return!0;for(let s=1;s<i.length;s++){const n=i[s];if(cP(t,n)||_Ce(r,n,yCe))return!0;r=n}}return!1}function XYe(t,e){o2[0]=t.xmin,o2[1]=t.ymax,a2[0]=t.xmax,a2[1]=t.ymax,l2[0]=t.xmin,l2[1]=t.ymin,c2[0]=t.xmax,c2[1]=t.ymin;const i=e.paths;for(const r of i){if(!i.length)continue;let s=r[0];if(cP(t,s))return!0;for(let n=1;n<r.length;n++){const o=r[n];if(cP(t,o)||_Ce(s,o,yCe))return!0;s=o}}return!1}const wa=[0,0];function JYe(t){for(let e=0;e<t.length;e++){const i=t[e];for(let s=0;s<i.length-1;s++){const n=i[s],o=i[s+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],u=t[a][l+1];if(zz(n,o,c,u,wa)&&!(wa[0]===n[0]&&wa[1]===n[1]||wa[0]===c[0]&&wa[1]===c[1]||wa[0]===o[0]&&wa[1]===o[1]||wa[0]===u[0]&&wa[1]===u[1]))return!0}}const r=i.length;if(!(r<=4))for(let s=0;s<r-3;s++){let n=r-1;s===0&&(n=r-2);const o=i[s],a=i[s+1];for(let l=s+2;l<n;l++){const c=i[l],u=i[l+1];if(zz(o,a,c,u,wa)&&!(wa[0]===o[0]&&wa[1]===o[1]||wa[0]===c[0]&&wa[1]===c[1]||wa[0]===a[0]&&wa[1]===a[1]||wa[0]===u[0]&&wa[1]===u[1]))return!0}}}return!1}function _Ce(t,e,i){for(let r=0;r<i.length;r++)if(zz(t,e,i[r][0],i[r][1]))return!0;return!1}function zz(t,e,i,r,s){const[n,o]=t,[a,l]=e,[c,u]=i,[d,f]=r,m=d-c,g=n-c,y=a-n,v=f-u,b=o-u,w=l-o,x=v*y-m*w;if(x===0)return!1;const T=(m*b-v*g)/x,E=(y*b-w*g)/x;return T>=0&&T<=1&&E>=0&&E<=1&&(s&&(s[0]=n+T*(a-n),s[1]=o+T*(l-o)),!0)}function QYe(t){switch(t){case"esriGeometryEnvelope":case"extent":return HYe;case"esriGeometryMultipoint":case"multipoint":return qYe;case"esriGeometryPoint":case"point":return GYe;case"esriGeometryPolygon":case"polygon":return ZYe;case"esriGeometryPolyline":case"polyline":return XYe}}var _d;function KYe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function fv(t,e,i){return e==null?i:i==null?e:t(e,i)}let Qo=_d=class extends pw{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,i,r,s){return KYe(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?Ye.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:i,ymax:r,spatialReference:s??Ye.WGS84}}static fromBounds(t,e){return new _d({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new _d({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new wt({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new _d;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&kk(e,i)&&(t=e.isWebMercator?ty(t):$M(t,!0)),t.type==="point"?Kre(this,t):t.type==="extent"&&UYe(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&kk(e,i)&&(t=e.isWebMercator?ty(t):$M(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),i=this.width*e,r=this.height*e;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const s=(this.zmax-this.zmin)*e;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*e;this.mmin+=s,this.mmax-=s}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,i=t.spatialReference;return e&&i&&!ms(e,i)&&kk(e,i)&&(t=e.isWebMercator?ty(t):$M(t,!0)),QYe(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,i){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=fv(Math.min,this.zmin,t.zmin),this.zmax=fv(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=fv(Math.min,this.mmin,t.mmin),this.mmax=fv(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=fv(Math.max,this.zmin,t.zmin),this.zmax=fv(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=fv(Math.max,this.mmin,t.mmin),this.mmax=fv(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=ey(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,i=this._getCM(t);if(i){const r=e.isWebMercator?$M(i):i;this.xmin-=i.x,this.xmax-=i.x,e.isWebMercator||(r.x=AH(r.x,t).x),this.spatialReference=new Ye(py((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(t){let e=null;const[i,r]=t.valid,s=this.xmin,n=this.xmax;return s>=i&&s<=r&&n>=i&&n<=r||(e=this.center),e}_normalize(t,e,i){const r=this.spatialReference;if(!r)return this;const s=i??ey(r);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return t?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(t)return this._shiftCM(s);if(e)return n;let o=!0,a=!0;return n.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const u=(l.zmax-l.zmin)/2;for(let d=0;d<c.length;d++)c[d].push(u)}if(a){const u=(l.mmax-l.mmin)/2;for(let d=0;d<c.length;d++)c[d].push(u)}return c}),hasZ:o,hasM:a,spatialReference:r}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let u;t=t||ey(o);const[d,f]=t.valid;u=AH(this.xmin,t);const m=u.x,g=u.frameId;u=AH(this.xmax,t);const y=u.x,v=u.frameId,b=m===y&&a>0;if(a>2*f){const w=new _d(l<c?m:y,s,f,n,o),x=new _d(d,s,l<c?y:m,n,o),T=new _d(0,s,f,n,o),E=new _d(d,s,0,n,o),M=[],O=[];w.contains(T)&&M.push(g),w.contains(E)&&O.push(g),x.contains(T)&&M.push(v),x.contains(E)&&O.push(v);for(let D=g+1;D<v;D++)M.push(D),O.push(D);e.push({extent:w,frameIds:[g]},{extent:x,frameIds:[v]},{extent:T,frameIds:M},{extent:E,frameIds:O})}else m>y||b?e.push({extent:new _d(m,s,f,n,o),frameIds:[g]},{extent:new _d(d,s,y,n,o),frameIds:[v]}):e.push({extent:new _d(m,s,y,n,o),frameIds:[g]});this.cache._parts=e}const i=this.hasZ,r=this.hasM;if(i||r){const s={};i&&(s.zmin=this.zmin,s.zmax=this.zmax),r&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<e.length;n++)e[n].extent.set(s)}return e}};function AH(t,e){const[i,r]=e.valid,s=2*r;let n,o=0;return t>r?(n=Math.ceil(Math.abs(t-r)/s),t-=n*s,o=n):t<i&&(n=Math.ceil(Math.abs(t-i)/s),t+=n*s,o=-n),{x:t,frameId:o}}h([p({readOnly:!0})],Qo.prototype,"cache",null),h([p({readOnly:!0})],Qo.prototype,"center",null),h([p({readOnly:!0})],Qo.prototype,"extent",null),h([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Qo.prototype,"hasM",null),h([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Qo.prototype,"hasZ",null),h([p({readOnly:!0})],Qo.prototype,"height",null),h([p({readOnly:!0})],Qo.prototype,"width",null),h([p({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Qo.prototype,"xmin",void 0),h([p({type:Number,json:{write:!0}})],Qo.prototype,"ymin",void 0),h([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Qo.prototype,"mmin",void 0),h([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Qo.prototype,"zmin",void 0),h([p({type:Number,json:{write:!0}})],Qo.prototype,"xmax",void 0),h([p({type:Number,json:{write:!0}})],Qo.prototype,"ymax",void 0),h([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Qo.prototype,"mmax",void 0),h([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Qo.prototype,"zmax",void 0),Qo=_d=h([I("esri.geometry.Extent")],Qo),Qo.prototype.toJSON.isDefaultToJSON=!0;const dr=Qo;let mF;function eXe(t){return mF&&!mF.destroyed||(mF=t()),mF}var KZ;const tXe=new Qi({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let vd=KZ=class extends Ue{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new KZ({categories:this.categories?re(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let i=[];this.categories&&(i=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let r="";if(this.extent){const o=qD(this.extent,Ye.WGS84);o!=null&&(r=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&t.extraQuery&&(s="("+s+")"+t.extraQuery);const n={categories:i,bbox:r,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>tXe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...e,...n}}}};h([p()],vd.prototype,"categories",void 0),h([p()],vd.prototype,"disableExtraQuery",void 0),h([p({type:dr})],vd.prototype,"extent",void 0),h([p()],vd.prototype,"filter",void 0),h([p()],vd.prototype,"num",void 0),h([p()],vd.prototype,"query",void 0),h([p()],vd.prototype,"sortField",void 0),h([p()],vd.prototype,"sortOrder",null),h([p()],vd.prototype,"start",void 0),vd=KZ=h([I("esri.portal.PortalQueryParams")],vd);const Ig=vd;var eY;let Co=eY=class extends Se{constructor(t){super(t),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){var i;const t=this.url,e=this.thumbnail;return t&&e&&this.portal?(i=this.portal)==null?void 0:i.normalizeUrl(`${t}/info/${e}?f=json`):null}get url(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?t+"/community/groups/"+this.id:null}fetchCategorySchema(t){return this.portal.request(this.url+"/categorySchema",t).then(e=>{const i=e.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",t):i})}fetchMembers(t){return this.portal.request(this.url+"/users",t)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}toJSON(){throw new B("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new eY({sourceJSON:t});return e.read(t),e}queryItems(t,e){let i=nn(Ig,t);const r=this.portal;return parseFloat(r.currentVersion)>5?(i=i||new Ig,r.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",e)):(i=i?i.clone():new Ig,i.query="group:"+this.id+(i.query?" "+i.query:""),r.queryItems(i,e))}_fetchCategorySchemaSet(t,e){const i=this.portal;return i.fetchSelf(i.authMode,!0,e).then(r=>{const s=r.contentCategorySetsGroupQuery;if(s){const n=new Ig({disableExtraQuery:!0,num:1,query:s});return i.queryGroups(n,e)}throw new B("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(r=>{if(r.total){const s=r.results[0],n=new Ig({num:1,query:`typekeywords:"${t}"`});return s.queryItems(n,e)}throw new B("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(r=>r.total?r.results[0].fetchData("json",e).then(s=>{const n=s==null?void 0:s.categorySchema;return n!=null&&n.length?n:[]}):[])}};h([p()],Co.prototype,"access",void 0),h([p({type:Date})],Co.prototype,"created",void 0),h([p()],Co.prototype,"description",void 0),h([p()],Co.prototype,"id",void 0),h([p()],Co.prototype,"isInvitationOnly",void 0),h([p({type:Date})],Co.prototype,"modified",void 0),h([p()],Co.prototype,"owner",void 0),h([p()],Co.prototype,"portal",void 0),h([p()],Co.prototype,"snippet",void 0),h([p()],Co.prototype,"sortField",void 0),h([p()],Co.prototype,"sortOrder",void 0),h([p()],Co.prototype,"sourceJSON",void 0),h([p()],Co.prototype,"tags",void 0),h([p()],Co.prototype,"thumbnail",void 0),h([p({readOnly:!0})],Co.prototype,"thumbnailUrl",null),h([p()],Co.prototype,"title",void 0),h([p({readOnly:!0})],Co.prototype,"url",null),Co=eY=h([I("esri.portal.PortalGroup")],Co);const tY=Co;let $x=class extends Ue{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};h([p()],$x.prototype,"nextQueryParams",void 0),h([p()],$x.prototype,"queryParams",void 0),h([p()],$x.prototype,"results",void 0),h([p()],$x.prototype,"total",void 0),$x=h([I("esri.portal.PortalQueryResult")],$x);const iXe=$x;let p0=class extends Se{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){var i;const e=(i=this.portal)==null?void 0:i.restUrl;return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new B("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};h([p({type:Date})],p0.prototype,"created",void 0),h([p()],p0.prototype,"id",void 0),h([p()],p0.prototype,"portal",void 0),h([p()],p0.prototype,"title",void 0),h([p({readOnly:!0})],p0.prototype,"url",null),h([p()],p0.prototype,"username",void 0),p0=h([I("esri.portal.PortalFolder")],p0);const rXe=p0;var iY;let Fs=iY=class extends Se{constructor(t){super(t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userLicenseTypeId=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?`${t}/content/users/${this.username}`:null}get url(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,i=t==null?void 0:t.data,r=t==null?void 0:t.folder,s={method:"post"};e&&(s.query=e.createPostQuery(),i!=null&&(typeof i=="string"?s.query.text=i:typeof i=="object"&&(s.query.text=JSON.stringify(i))));let n=this.userContentUrl;return r&&(n+="/"+(typeof r=="string"?r:r.id)),this.portal.request(n+"/addItem",s).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}async deleteItem(t,e=!1){let i=this.userContentUrl;t.ownerFolder&&(i+="/"+t.ownerFolder);const r=e?{permanentDelete:!0}:{};await this.portal.request(i+`/items/${t.id}/delete`,{method:"post",query:r}),t.id=null,t.portal=null}async deleteItems(t,e=!1){t=t.concat();const i=this.userContentUrl+"/deleteItems",r=[],s=t.map(n=>n.id);if(s.length){const n={method:"post",query:{items:s.join(","),permanentDelete:e}},o=await this.portal.request(i,n);for(const a of o.results){const l=t.find(d=>a.itemId===d.id),c=a.success;let u=null;c?(l.id=null,l.portal=null):a.error&&(u=new B("portal:delete-item-failed",a.error.message,a.error)),r.push({item:l,success:c,error:u})}}return r}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let i;return i=e&&e.folders?e.folders.map(r=>{const s=rXe.fromJSON(r);return s.portal=this.portal,s}):[],i})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(i=>{const r=tY.fromJSON(i);return r.portal=this.portal,r}):[],e})}async fetchItems(t){t??(t={});let e=this.userContentUrl??"";t.folder&&(e+="/"+t.folder.id);const{default:i}=await oe(()=>Promise.resolve().then(()=>wCe),void 0),r={folders:!1,inRecycleBin:!!t.inRecycleBin||null,foldersContent:!(t.folder||!t.includeSubfolderItems)||null,num:t.num||10,start:t.start||1,sortField:t.sortField||"created",sortOrder:t.sortOrder||"asc"},s=await this.portal.request(e,{query:r});let n;return s!=null&&s.items?(n=s.items.map(o=>{const a=i.fromJSON(o);return a.portal=this.portal,a}),await Promise.all(n.map(o=>o.load())),{items:n,nextStart:s.nextStart,total:s.total}):{items:[],nextStart:-1,total:0}}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new tY({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new B("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}async restoreItem(t,e){const i=this.userContentUrl,r=e?{folderID:typeof e=="string"?e:e.id}:null;await this.portal.request(i+`/items/${t.id}/restore`,{method:"post",query:r})}toJSON(){throw new B("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new iY({sourceJSON:t});return e.read(t),e}};h([p()],Fs.prototype,"access",void 0),h([p({type:Date})],Fs.prototype,"created",void 0),h([p()],Fs.prototype,"culture",void 0),h([p()],Fs.prototype,"description",void 0),h([p()],Fs.prototype,"email",void 0),h([p()],Fs.prototype,"favGroupId",void 0),h([p()],Fs.prototype,"fullName",void 0),h([p({type:Date})],Fs.prototype,"modified",void 0),h([p()],Fs.prototype,"orgId",void 0),h([p()],Fs.prototype,"portal",void 0),h([p()],Fs.prototype,"preferredView",void 0),h([p()],Fs.prototype,"privileges",void 0),h([p()],Fs.prototype,"region",void 0),h([p()],Fs.prototype,"role",void 0),h([p()],Fs.prototype,"roleId",void 0),h([p()],Fs.prototype,"sourceJSON",void 0),h([p()],Fs.prototype,"thumbnail",void 0),h([p({readOnly:!0})],Fs.prototype,"thumbnailUrl",null),h([p()],Fs.prototype,"units",void 0),h([p({readOnly:!0})],Fs.prototype,"userContentUrl",null),h([p({readOnly:!0})],Fs.prototype,"url",null),h([p()],Fs.prototype,"username",void 0),h([p()],Fs.prototype,"userLicenseTypeId",void 0),h([p()],Fs.prototype,"userType",void 0),Fs=iY=h([I("esri.portal.PortalUser")],Fs);const ese=Fs;var lh;let gF;const Bhe={PortalGroup:()=>Promise.resolve({default:tY}),PortalItem:()=>oe(()=>Promise.resolve().then(()=>wCe),void 0),PortalUser:()=>Promise.resolve({default:ese})};let et=lh=class extends BD(yy){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.layoutGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.recycleBinEnabled=!1,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=nr.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){jhe.unregister(this),this.defaultBasemap=He(this.defaultBasemap),this.defaultDevBasemap=He(this.defaultDevBasemap),this.defaultVectorBasemap=He(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=Lr(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)nr.request.trustedServers.includes(e)||nr.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){var i;const t=(i=this.user)==null?void 0:i.orgId,e=!t||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=ese.fromJSON(t),e.portal=this),e}load(t){const e=oe(()=>Promise.resolve().then(()=>PXe),void 0).then(({default:i})=>{Dt(t),gF=i}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(i=>{var r;if(Ci){const s=Ci;this.credential=s.findCredential(this.restUrl),this.credential||this.authMode!==lh.AUTH_MODE_AUTO&&this.authMode!==lh.AUTH_MODE_NO_PROMPT||((r=this._esriIdCredentialCreateHandle)==null||r.remove(),this._esriIdCredentialCreateHandle=s.on("credential-create",sXe(new WeakRef(this))),jhe.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await oe(async()=>{const{default:i}=await import("./ElevationLayer-DS3RXAU1.js");return{default:i}},__vite__mapDeps([0,1,2,3,4,5]))).default;return t?t.map(i=>new e({id:i.id,url:i.url})):[]}async fetchBasemaps(t,e){const i=await this._fetchBasemaps(t,e);if((e==null?void 0:e.include3d)===!0&&this.use3dBasemaps!==!1){const r=await this._fetchBasemaps3D(t,e);i.unshift(...r)}return i}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):ha(t)?Promise.reject(Ui()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,i=new Ig({num:100,sortField:"title"});if(e!=null&&e.length){const r=[];for(const s of e)r.push(`(title:"${s.title}" AND owner:${s.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,t).then(s=>s.results)}return ha(t)?Promise.reject(Ui()):Promise.resolve([])}fetchRegions(t){var i;const e=((i=this.user)==null?void 0:i.culture)||this.culture||zu();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){var i;const e=((i=this.user)==null?void 0:i.culture)||this.culture||zu();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return eXe(()=>new lh)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,i){const r=this.restUrl+"/portals/self",s={authMode:t,query:{culture:zu().toLowerCase()},withCredentials:!0,...i};return s.authMode==="auto"&&(s.authMode="no-prompt"),e&&(s.query.default=!0),this.request(r,s)}queryPortal(t,e,i,r){const s=nn(Ig,e),n=o=>this.request(this.restUrl+t,{...s.toRequestOptions(this),...r}).then(a=>{const l=s.clone();return l.start=a.nextStart,new iXe({nextQueryParams:l,queryParams:s,total:a.total,results:lh._resultsToTypedArray(o,{portal:this},a,r)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(Ql(l),a)));return i&&Bhe[i]?Bhe[i]().then(({default:o})=>(Dt(r),n(o))):n()}signIn(){if(this.authMode===lh.AUTH_MODE_ANONYMOUS||this.authMode===lh.AUTH_MODE_NO_PROMPT&&!Ci)return Promise.reject(new B("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return Ci?Ci.getCredential(this.restUrl,{prompt:this.authMode!==lh.AUTH_MODE_NO_PROMPT}).then(e=>t(e)):t(this.credential)}normalizeUrl(t){var i;const e=(i=this.credential)==null?void 0:i.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,i){return this.request(t,e).then(r=>{const s=lh._resultsToTypedArray(i,{portal:this},r);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():r)).then(()=>s,()=>s)})}request(t,e={}){const i={f:"json",...e.query},{authMode:r=this.authMode===lh.AUTH_MODE_ANONYMOUS||this.authMode===lh.AUTH_MODE_NO_PROMPT?this.authMode:"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:r,body:s,cacheBust:n,method:o,query:i,responseType:a,timeout:0,signal:l};return e.withCredentials&&(c.withCredentials=!0),fr(this._normalizeSSL(t),c).then(u=>u.data)}toJSON(){throw new B("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new lh({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new B("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const i=new Ig;i.query=t||(nr.apiKey&&Vre(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0;const r=await this.queryGroups(i,e);if(!r.total)return[];const s=r.results[0];i.num=100,i.query='type:"Web Map" -type:"Web Application"',i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc";const n=await s.queryItems(i,e);return n.total?n.results.filter(o=>o.type==="Web Map").map(o=>new gF({portalItem:o})):[]}async _fetchBasemaps3D(t,e){const i=t||this.basemapGalleryGroupQuery3D;if(!i)return[];const r=new Ig({query:i,disableExtraQuery:!0}),s=await this.queryGroups(r,e);if(!s.total)return[];const n=s.results[0];r.num=100,r.query='type:"Web Scene"',r.sortField=n.sortField||"name",r.sortOrder=n.sortOrder||"desc";const o=await n.queryItems(r,e);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new gF({portalItem:a})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=gF.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,i,r){let s;if(i){const n=r!=null?r.signal:null;s=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(t||e)&&(s=s.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};et.AUTH_MODE_ANONYMOUS="anonymous",et.AUTH_MODE_AUTO="auto",et.AUTH_MODE_IMMEDIATE="immediate",et.AUTH_MODE_NO_PROMPT="no-prompt",h([p()],et.prototype,"access",void 0),h([p()],et.prototype,"allSSL",void 0),h([p()],et.prototype,"authMode",void 0),h([p()],et.prototype,"authorizedCrossOriginDomains",void 0),h([ze("authorizedCrossOriginDomains")],et.prototype,"readAuthorizedCrossOriginDomains",null),h([p()],et.prototype,"basemapGalleryGroupQuery",void 0),h([p({json:{name:"3DBasemapGalleryGroupQuery"}})],et.prototype,"basemapGalleryGroupQuery3D",void 0),h([p()],et.prototype,"bingKey",void 0),h([p()],et.prototype,"canListApps",void 0),h([p()],et.prototype,"canListData",void 0),h([p()],et.prototype,"canListPreProvisionedItems",void 0),h([p()],et.prototype,"canProvisionDirectPurchase",void 0),h([p()],et.prototype,"canSearchPublic",void 0),h([p()],et.prototype,"canShareBingPublic",void 0),h([p()],et.prototype,"canSharePublic",void 0),h([p()],et.prototype,"canSignInArcGIS",void 0),h([p()],et.prototype,"canSignInIDP",void 0),h([p()],et.prototype,"colorSetsGroupQuery",void 0),h([p()],et.prototype,"commentsEnabled",void 0),h([p({type:Date})],et.prototype,"created",void 0),h([p()],et.prototype,"credential",void 0),h([p()],et.prototype,"culture",void 0),h([p()],et.prototype,"currentVersion",void 0),h([p()],et.prototype,"customBaseUrl",void 0),h([p()],et.prototype,"defaultBasemap",void 0),h([ze("defaultBasemap")],et.prototype,"readDefaultBasemap",null),h([p()],et.prototype,"defaultDevBasemap",void 0),h([ze("defaultDevBasemap")],et.prototype,"readDefaultDevBasemap",null),h([p({type:dr})],et.prototype,"defaultExtent",void 0),h([p()],et.prototype,"defaultVectorBasemap",void 0),h([ze("defaultVectorBasemap")],et.prototype,"readDefaultVectorBasemap",null),h([p()],et.prototype,"description",void 0),h([p()],et.prototype,"devBasemapGalleryGroupQuery",void 0),h([p()],et.prototype,"eueiEnabled",void 0),h([p({readOnly:!0})],et.prototype,"extraQuery",null),h([p()],et.prototype,"featuredGroups",void 0),h([p()],et.prototype,"featuredItemsGroupQuery",void 0),h([p()],et.prototype,"galleryTemplatesGroupQuery",void 0),h([p()],et.prototype,"layoutGroupQuery",void 0),h([p()],et.prototype,"livingAtlasGroupQuery",void 0),h([p()],et.prototype,"hasCategorySchema",void 0),h([p()],et.prototype,"helpBase",void 0),h([p()],et.prototype,"helperServices",void 0),h([p()],et.prototype,"helpMap",void 0),h([p()],et.prototype,"homePageFeaturedContent",void 0),h([p()],et.prototype,"homePageFeaturedContentCount",void 0),h([p()],et.prototype,"httpPort",void 0),h([p()],et.prototype,"httpsPort",void 0),h([p()],et.prototype,"id",void 0),h([p()],et.prototype,"ipCntryCode",void 0),h([p({readOnly:!0})],et.prototype,"isOrganization",null),h([p()],et.prototype,"isPortal",void 0),h([p()],et.prototype,"isReadOnly",void 0),h([p({readOnly:!0})],et.prototype,"itemPageUrl",null),h([p()],et.prototype,"layerTemplatesGroupQuery",void 0),h([p()],et.prototype,"maxTokenExpirationMinutes",void 0),h([p({type:Date})],et.prototype,"modified",void 0),h([p()],et.prototype,"name",void 0),h([p()],et.prototype,"portalHostname",void 0),h([p()],et.prototype,"portalMode",void 0),h([p()],et.prototype,"portalProperties",void 0),h([p()],et.prototype,"region",void 0),h([p()],et.prototype,"recycleBinEnabled",void 0),h([p({readOnly:!0})],et.prototype,"restUrl",null),h([p()],et.prototype,"rotatorPanels",void 0),h([p()],et.prototype,"showHomePageDescription",void 0),h([p()],et.prototype,"sourceJSON",void 0),h([p()],et.prototype,"staticImagesUrl",void 0),h([p({json:{name:"2DStylesGroupQuery"}})],et.prototype,"stylesGroupQuery2d",void 0),h([p({json:{name:"stylesGroupQuery"}})],et.prototype,"stylesGroupQuery3d",void 0),h([p()],et.prototype,"supportsHostedServices",void 0),h([p()],et.prototype,"symbolSetsGroupQuery",void 0),h([p()],et.prototype,"templatesGroupQuery",void 0),h([p()],et.prototype,"thumbnail",void 0),h([p({readOnly:!0})],et.prototype,"thumbnailUrl",null),h([p()],et.prototype,"units",void 0),h([p()],et.prototype,"url",void 0),h([p()],et.prototype,"urlKey",void 0),h([ze("urlKey")],et.prototype,"readUrlKey",null),h([p()],et.prototype,"user",void 0),h([ze("user")],et.prototype,"readUser",null),h([p()],et.prototype,"use3dBasemaps",void 0),h([p()],et.prototype,"useStandardizedQuery",void 0),h([p()],et.prototype,"useVectorBasemaps",void 0),h([p()],et.prototype,"vectorBasemapGalleryGroupQuery",void 0),et=lh=h([I("esri.portal.Portal")],et);const Kn=et,jhe=new FinalizationRegistry(t=>{t.remove()});function sXe(t){const e=Ci;return()=>{const i=t.deref();i&&e.findCredential(i.restUrl)&&i.signIn().catch(()=>{})}}let f0=class extends Ue{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e!=null&&e.portalItem&&e.path?{...e,path:Ghe(e.path,e.portalItem)}:e}set path(e){e!=null&&Bh(e)?ne.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return Ghe(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",i){const r=this.cdnUrl;if(r==null)throw new B("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey},signal:i==null?void 0:i.signal})}async update(e,i){const{addOrUpdateResources:r}=await oe(()=>Promise.resolve().then(()=>RM),void 0);return await r(this.portalItem,[{resource:this,content:e,compress:i==null?void 0:i.compress,access:i==null?void 0:i.access}],"update",i),this}hasPath(){return this.path!=null}};function Ghe(t,e){return t==null?t:(t=t.replace(/^\/+/,""),e!=null&&Bh(t)&&(t=Lre(t,e.itemUrl)),t==null?void 0:t.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}h([p()],f0.prototype,"portalItem",void 0),h([p({type:String,value:null})],f0.prototype,"path",null),h([Qt("path")],f0.prototype,"_castPath",null),h([p({type:String,readOnly:!0})],f0.prototype,"url",null),h([p({type:String,readOnly:!0})],f0.prototype,"cdnUrl",null),h([p({type:String,readOnly:!0})],f0.prototype,"itemRelativeUrl",null),f0=h([I("esri.portal.PortalItemResource")],f0);const nXe=f0;let pR=class extends Ue{constructor(e){super(e),this.created=null,this.rating=null}};h([p()],pR.prototype,"created",void 0),h([p()],pR.prototype,"rating",void 0),pR=h([I("esri.portal.PortalRating")],pR);const PH=pR;function Ub(t,e){var r;const i=(r=e==null?void 0:e.url)==null?void 0:r.path;if(t&&i&&(t=Lu(t,i,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const s=Lre(t,e.portalItem.itemUrl);s!=null&&oXe.test(s)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(s).path)}return(t=rY(t,e==null?void 0:e.portal))&&MG.test(t)?ise(t):t}function u2(t,e,i=$L.YES){var s,n;if((t=t&&MG.test(t)?bCe(t):t)==null)return t;!Bh(t)&&(e!=null&&e.blockedRelativeUrls)&&e.blockedRelativeUrls.push(t);let r=Lu(t);if(e){const o=((s=e.verifyItemRelativeUrls)==null?void 0:s.rootPath)||((n=e.url)==null?void 0:n.path);if(o){const a=rY(o,e.portal),l=rY(r,e.portal);r=Lre(l,a,a),r!=null&&r!==l&&r!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=vCe(r,e==null?void 0:e.portal),Bh(r)&&(r=lp(r)),e!=null&&e.resources&&(e!=null&&e.portalItem)&&!Bh(r)&&!Cy(r)&&i===$L.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(r),compress:!1}),r}function tse(t,e,i){return Ub(t,i)}function Vb(t,e,i,r){const s=u2(t,r);s!==void 0&&(e[i]=s)}const MG=/\/items\/([^/]+)\/resources\/(.*)/,oXe=/^\.\/resources\//;function aXe(t){const e=(t==null?void 0:t.match(MG))??null;return(e==null?void 0:e[1])??null}function lXe(t){const e=(t==null?void 0:t.match(MG))??null;if(e==null)return null;const i=e[2],r=i.lastIndexOf("/");if(r===-1){const{path:o,extension:a}=The(i);return{prefix:null,filename:o,extension:a}}const{path:s,extension:n}=The(i.slice(r+1));return{prefix:i.slice(0,r),filename:s,extension:n}}function vCe(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?BZ(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function rY(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const i=`${e.urlKey}.${e.customBaseUrl}`,r=Ore();return iP(r,`${r.scheme}://${i}`)?BZ(t,e.portalHostname,i):BZ(t,i,e.portalHostname)}function ise(t){if(!t)return t||null;let e=t;return e&&Ci&&!Ci.findCredential(e)&&(e=CEe(e),e=e.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),e=e.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),e=e.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),e}function bCe(t){if(!t)return t||null;let e=t;return e=e.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com"),e=e.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com"),e=e.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"),e&&Ci&&!Ci.findCredential(e)&&(e=CEe(e)),e}var $L;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})($L||($L={}));const $Wt=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return $L},ensureMainOnlineDomain:vCe,fromCDNUrl:bCe,fromJSON:Ub,itemIdFromResourceUrl:aXe,prefixAndFilenameFromResourceUrl:lXe,read:tse,toCDNUrl:ise,toJSON:u2,write:Vb},Symbol.toStringTag,{value:"Module"}));var Rx;const cXe=new Set(["3DTiles Service","CSV","Feature Collection","Feature Service","Feed","GeoJson","Group Layer","Image Service","KML","Map Service","Media Layer","Scene Service","Stream Service","Vector Tile Service","WFS","WMS","WMTS"]),uXe=new Set(["KML","GeoJson","CSV"]);let Ti=Rx=class extends BD(yy){static from(t){return i2(Rx,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let i=t;return t==="Feature Service"||t==="Feature Collection"?i=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?i=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?i="Scene Layer":t==="Video Service"?i="Video Layer":t==="Scene Package"?i="Scene Layer Package":t==="Stream Service"?i="Feature Layer":t==="Geoprocessing Service"?i=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geoenrichment Service"?i="GeoEnrichment Service":t==="Geocoding Service"?i="Locator":t==="Microsoft Powerpoint"?i="Microsoft PowerPoint":t==="GeoJson"?i="GeoJSON":t==="Globe Service"?i="Globe Layer":t==="Vector Tile Service"?i="Tile Layer":t==="netCDF"?i="NetCDF":t==="Map Service"?i=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t!=null&&t.toLowerCase().includes("add in")?i=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?i="Big Data File Share":t==="Compact Tile Package"?i="Tile Package (tpkx)":t==="Raster function template"?i="Raster Function Template":t==="OGCFeatureServer"?i="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?i="Instant App":t==="Insights Page"?i="Insights Report":t==="Excalibur Imagery Project"?i="Excalibur Project":t==="3DTiles Service"?i="3D tiles layer":t==="3DTiles Package"&&(i="3D tiles package"),i}readExtent(t){return t&&t.length?new dr(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){var m;const t=((m=this.type)==null?void 0:m.toLowerCase())||"",e=this.typeKeywords||[],i="esri/images/portal/",r="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,u=!1,d=!1,f=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(n=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),u=e.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":u?"utilitynetwork":n?"featureshosted":"features"):t==="map service"||t==="wms"||t==="wmts"?(c=e.includes("Spatiotemporal"),d=e.includes("Relational"),s=c||d?"mapimages":n||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages"):s=t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":t==="3dtiles service"?e.includes("3DObject")?"3dobjecttileslayer":e.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):t==="web map"||t==="cityengine web scene"?s="maps":t==="web scene"?s=e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?s="instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?s="apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?s="mapsgray":t==="service definition"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?s="datafiles":t==="360 vr experience"?s="360vr":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?s="appsgray":t==="arcgis pro add in"||t==="arcgis pro configuration"?s="addindesktop":t==="pdf"?s="pdf":t==="microsoft word"?s="word":t==="microsoft excel"?s="excel":t==="microsoft powerpoint"?s="ppt":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?s="datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?s="toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?s="layersgray":t==="analysis model"?s="analysismodel":t==="scene package"?s="scenepackage":t==="3dtiles package"?s="3dtileslayerpackage":t==="3dtiles service"?s="3dtileslayer":t==="mobile scene package"?s="mobilescenepackage":t==="tile package"||t==="compact tile package"?s="tilepackage":t==="task file"?s="taskfile":t==="report template"?s="report-template":t==="statistical data collection"?s="statisticaldatacollection":t==="insights workbook"?s="workbook":t==="insights model"?s="insightsmodel":t==="insights page"?s="insightspage":t==="insights theme"?s="insightstheme":t==="hub initiative"?s="hubinitiative":t==="hub page"?s="hubpage":t==="hub site application"?s="hubsite":t==="hub event"?s="hubevent":t==="hub project"?s="hubproject":t==="relational database connection"?s="relationaldatabaseconnection":t==="big data file share"?s="datastorecollection":t==="image collection"?s="imagecollection":t==="desktop style"?s="desktopstyle":t==="style"?s=e.includes("Dictionary")?"dictionarystyle":"style":t==="dashboard"?s="dashboard":t==="raster function template"?s="rasterprocessingtemplate":t==="vector tile package"?s="vectortilepackage":t==="ortho mapping project"?s="orthomappingproject":t==="ortho mapping template"?s="orthomappingtemplate":t==="solution"?s="solutions":t==="geopackage"?s="geopackage":t==="deep learning package"?s="deeplearningpackage":t==="real time analytic"?s="realtimeanalytics":t==="big data analytic"?s="bigdataanalytics":t==="feed"?s="feed":t==="excalibur imagery project"?s="excaliburimageryproject":t==="notebook"?s="notebook":t==="storymap"?s="storymap":t==="survey123 add in"?s="survey123addin":t==="mission"?s="mission":t==="mission report"?s="missionreport":t==="mission template"?s="missiontemplate":t==="quickcapture project"?s="quickcaptureproject":t==="pro report"?s="proreport":t==="pro report template"?s="proreporttemplate":t==="urban model"?s="urbanmodel":t==="web experience"?s="experiencebuilder":t==="web experience template"?s="webexperiencetemplate":t==="experience builder widget"?s="experiencebuilderwidget":t==="experience builder widget package"?s="experiencebuilderwidgetpackage":t==="workflow"?s="workflow":t==="kernel gateway connection"?s="kernelgatewayconnection":t==="insights script"?s="insightsscript":t==="hub initiative template"?s="hubinitiativetemplate":t==="storymap theme"?s="storymaptheme":t==="knowledge graph"?s="knowledgegraph":t==="knowledge graph layer"?s="knowledgegraphlayer":t==="knowledge studio project"?s="knowledgestudio":t==="native application"?s="nativeapp":t==="native application installer"?s="nativeappinstaller":t==="web link chart"?s="linkchart":t==="knowledge graph web investigation"?s="investigation":t==="ogcfeatureserver"?s="features":t==="pro project"?s="proproject":t==="insights workbook package"?s="insightsworkbookpackage":t==="apache parquet"?s="apacheparquet":t==="notebook code snippet library"?s="notebookcodesnippets":t==="suitability model"?s="suitabilitymodel":t==="esri classifier definition"?s="classifierdefinition":t==="esri classification schema"?s="classificationschema":t==="insights data engineering workbook"?s="dataengineeringworkbook":t==="insights data engineering model"?s="dataengineeringmodel":t==="deep learning studio project"?s="deeplearningproject":t==="discussion"?s="discussion":t==="allsource project"?s="allsourceproject":t==="api key"?s="apikey":t==="data pipeline"?s="datapipelines":t==="group layer"?(f=e.includes("Map"),s=f?"layergroup2d":"layergroup"):s=t==="media layer"?"onlinemedialayer":t==="form"?e.includes("Survey123")?"survey":"datafilesgray":t==="csv"?"csv":t==="image"?"image":"maps",s?tr(i+s+r+".png"):null}get isLayer(){return this.type!=null&&cXe.has(this.type)}get itemCdnUrl(){return ise(this.itemUrl)}get itemPageUrl(){var e;const t=(e=this.portal)==null?void 0:e.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){var i;const t=this.itemUrl,e=this.thumbnail;return t&&e?((i=this.portal)==null?void 0:i.normalizeUrl(`${t}/info/${e}?f=json`))??null:null}get userItemUrl(){var i,r,s;const t=(i=this.portal)==null?void 0:i.restUrl;if(!t)return null;const e=this.owner||((s=(r=this.portal)==null?void 0:r.user)==null?void 0:s.username);return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=Kn.getDefault()),i=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(r=>{this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(i),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof PH&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new PH({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:re(this.applicationProxies),avgRating:this.avgRating,categories:re(this.categories),created:re(this.created),culture:this.culture,description:this.description,extent:re(this.extent),groupCategories:re(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:re(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:re(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:re(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:re(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new Rx({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){var i;const t=this.toJSON();for(const r of["tags","typeKeywords","categories"])t[r]=(i=t[r])==null?void 0:i.join(", ");const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return this.portal.request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new PH(e)):null}fetchRelatedItems(t,e){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},Rx)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t==null?void 0:t.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?i.query.text=e:typeof e=="object"&&(i.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new B("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new B("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:i}=this;await e.signIn();const{copyResources:r,folder:s,tags:n,title:o}=t||{},a={method:"post",query:{copyPrivateResources:r==="all",folder:typeof s=="string"?s:s==null?void 0:s.id,includeResources:!!r,tags:n==null?void 0:n.join(","),title:o}},{itemId:l}=await e.request(`${i}/copy`,a);return new Rx({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,i=t.filename,r={method:"post"};if(typeof e=="string")Cy(e)?r.query={data:e}:r.query={url:Lu(e)},i!=null&&(r.query.filename=i);else{const s=new FormData;i!=null?s.append("file",e,i):s.append("file",e),r.body=s}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new B("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:i}=await oe(()=>Promise.resolve().then(()=>RM),void 0);return i(this,t,e)}async addResource(t,e,i){const{addOrUpdateResources:r}=await oe(()=>Promise.resolve().then(()=>RM),void 0);return t.portalItem=this,await r(this,[{resource:t,content:e,compress:i==null?void 0:i.compress,access:i==null?void 0:i.access}],"add",i),t}async removeResource(t,e){const{removeResource:i}=await oe(()=>Promise.resolve().then(()=>RM),void 0);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new B("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await oe(()=>Promise.resolve().then(()=>RM),void 0);return e(this,t)}resourceFromPath(t){return new nXe({portalItem:this,path:t})}toJSON(){var i,r;const t=this.extent,e={accessInformation:this.accessInformation,categories:re(this.categories),created:(i=this.created)==null?void 0:i.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:(r=this.modified)==null?void 0:r.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:re(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:re(this.typeKeywords),url:this.url};return fHe(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Rx({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};h([p({type:["private","shared","org","public"]})],Ti.prototype,"access",void 0),h([p()],Ti.prototype,"accessInformation",void 0),h([p({type:String})],Ti.prototype,"apiKey",void 0),h([p({json:{read:{source:"appProxies"}}})],Ti.prototype,"applicationProxies",void 0),h([p()],Ti.prototype,"avgRating",void 0),h([p()],Ti.prototype,"categories",void 0),h([p({type:Date})],Ti.prototype,"created",void 0),h([p()],Ti.prototype,"culture",void 0),h([p()],Ti.prototype,"description",void 0),h([p({readOnly:!0})],Ti.prototype,"displayName",null),h([p({type:dr})],Ti.prototype,"extent",void 0),h([ze("extent")],Ti.prototype,"readExtent",null),h([p()],Ti.prototype,"groupCategories",void 0),h([p({readOnly:!0})],Ti.prototype,"iconUrl",null),h([p()],Ti.prototype,"id",void 0),h([p({readOnly:!0})],Ti.prototype,"isLayer",null),h([p({type:Boolean,readOnly:!0})],Ti.prototype,"isOrgItem",void 0),h([p()],Ti.prototype,"itemControl",void 0),h([p({readOnly:!0})],Ti.prototype,"itemPageUrl",null),h([p({readOnly:!0})],Ti.prototype,"itemUrl",null),h([p()],Ti.prototype,"licenseInfo",void 0),h([p({type:Date})],Ti.prototype,"modified",void 0),h([p()],Ti.prototype,"name",void 0),h([p()],Ti.prototype,"numComments",void 0),h([p()],Ti.prototype,"numRatings",void 0),h([p()],Ti.prototype,"numViews",void 0),h([p()],Ti.prototype,"owner",void 0),h([p()],Ti.prototype,"ownerFolder",void 0),h([p({type:Kn})],Ti.prototype,"portal",void 0),h([p()],Ti.prototype,"screenshots",void 0),h([p()],Ti.prototype,"size",void 0),h([p()],Ti.prototype,"snippet",void 0),h([p()],Ti.prototype,"sourceJSON",void 0),h([p({type:String})],Ti.prototype,"sourceUrl",void 0),h([p({type:String})],Ti.prototype,"spatialReference",void 0),h([p()],Ti.prototype,"tags",void 0),h([p()],Ti.prototype,"thumbnail",void 0),h([p({readOnly:!0})],Ti.prototype,"thumbnailUrl",null),h([p()],Ti.prototype,"title",void 0),h([p()],Ti.prototype,"type",void 0),h([p()],Ti.prototype,"typeKeywords",void 0),h([p({type:String,json:{read(t,e){var i;if(uXe.has(e.type)){const r=(i=this.portal)==null?void 0:i.restUrl;t||(t=r&&this.id?`${r}/content/items/${this.id}/data`:null)}return t}}})],Ti.prototype,"url",void 0),h([p({readOnly:!0})],Ti.prototype,"userItemUrl",null),Ti=Rx=h([I("esri.portal.PortalItem")],Ti);const AS=Ti,wCe=Object.freeze(Object.defineProperty({__proto__:null,default:AS},Symbol.toStringTag,{value:"Module"}));async function hXe(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t.includes("-3d")?t.slice(0,t.indexOf("-3d")):t,i=await $2e("esri/t9n/basemaps");return i[t]||i[e]}const sY={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return tr("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return tr("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return tr("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return tr("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return tr("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return tr("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return tr("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return tr("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return tr("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return tr("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return tr("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return tr("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return tr("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return tr("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return tr("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}},dXe=new Set(["ar","bs","ca","hr","cs","da","nl","en","et","fi","fr","de","el","he","hu","id","it","ja","ko","lv","lt","nb","pl","ro","ru","sr","es","sv","th","tr","uk","vi"]);let Wv=class extends Ue{constructor(e){super(e),this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps",this.worldview=null}getLanguageParamValue(){if(this.language)return this.language;const e=zu().toLowerCase();switch(e){case"pt-br":return"pt-BR";case"pt-pt":return"pt-PT";case"zh-cn":return"zh-CN";case"zh-hk":return"zh-HK";case"zh-tw":return"zh-TW"}const i=THe(e);return i==="pt"?"pt-BR":i&&dXe.has(i)?i:"global"}};h([p()],Wv.prototype,"id",void 0),h([p()],Wv.prototype,"language",void 0),h([p()],Wv.prototype,"places",void 0),h([p()],Wv.prototype,"serviceUrl",void 0),h([p()],Wv.prototype,"worldview",void 0),Wv=h([I("esri.support.BasemapStyle")],Wv);const pXe=Wv;function IWt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function fXe(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="subtype-group"&&"sublayers"in t}function Ix(t){return(t==null?void 0:t.type)==="subtype-sublayer"}function x3(t){const e=t==null?void 0:t.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function uP(t){return t!=null&&"type"in t&&t.type==="group"}const LWt={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function xCe(t){const e=t==null?void 0:t.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function mXe(t){return t==="IntegratedMeshLayer"||t==="IntegratedMesh3DTilesLayer"}function RL(t){return t==="integrated-mesh"||t==="integrated-mesh-3dtiles"}function Hhe(t){return(t==null?void 0:t.type)==="voxel"}function qhe(t){return(t==null?void 0:t.type)==="imagery-tile"}function Vk(t){return(t==null?void 0:t.parent)!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function AG(t){var e;return(t==null?void 0:t.type)==="feature"&&!t.url&&((e=t.source)==null?void 0:e.type)==="memory"}function DWt(t){var e;return((t==null?void 0:t.type)==="feature"||(t==null?void 0:t.type)==="subtype-group")&&((e=t.source)==null?void 0:e.type)==="feature-layer"}function gXe(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const i=t.activeLayer.tileMatrixSets;if(i)return i}return null}async function TCe(t,e){const i=Ci==null?void 0:Ci.findServerInfo(t);if((i==null?void 0:i.currentVersion)!=null)return i.owningSystemUrl||null;const r=t.toLowerCase().indexOf("/rest/services");if(r===-1)return null;const s=`${t.substring(0,r)}/rest/info`,n=e!=null?e.signal:null,{data:o}=await fr(s,{query:{f:"json"},responseType:"json",signal:n});return(o==null?void 0:o.owningSystemUrl)||null}function yXe(t){if(!("capabilities"in t))return!1;switch(t.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"sublayer":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function SCe(t){return yXe(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function _Xe(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function vXe(t){return!!_Xe(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const bXe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),wXe=new Set(["catalog","csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","knowledge-graph","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function xXe(t){return t.layerContainerType==="basemap"?bXe:t.layerContainerType==="operational-layers"?wXe:null}function TXe(t,e){if(e.restrictedWebMapWriting){const i=xXe(e);return i==null||i.has(t.type)&&!AG(t)}return!0}function SXe(t,e){var i;if(e)if(AG(t)){const r=RD("featureCollection.layers",e),s=(i=r==null?void 0:r[0])==null?void 0:i.layerDefinition;s&&Whe(t,s)}else t.type!=="group"&&Whe(t,e)}function Whe(t,e){"maxScale"in t&&(e.maxScale=Az(t.maxScale)??void 0),"minScale"in t&&(e.minScale=Az(t.minScale)??void 0)}function EXe(t,e){if(SXe(t,e),e&&(e.id=t.id,"blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=Az(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(AG(t)){const i=e.featureCollection;i&&(i.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function Zhe(t,e,i){if(!t.persistenceEnabled)return null;if(!("write"in t)||!t.write)return i!=null&&i.messages&&i.messages.push(new B("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(AG(t)&&!t.isTable)e=t.resourceInfo;else if(TXe(t,i)){const r={};return t.write(r,i)?r:null}return e!=null&&EXe(t,e=re(e)),e}var fR;let CXe=0,ch=fR=class extends BD(yy){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+CXe++,this.baseLayers=new Ke,this.referenceLayers=new Ke;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&ne.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.addHandles([this.baseLayers.on("after-add",r=>e(r.item)),this.referenceLayers.on("after-add",r=>e(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{ne.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.baseLayers.toArray();for(const i of t)i.destroy();const e=this.referenceLayers.toArray();for(const i of e)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=He(this.portalItem)}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",gy(t,this._get("baseLayers")))}_writeBaseLayers(t,e,i){const r=[];t&&(i={...i,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=Zhe(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);n!=null&&r.push(n)}),this.referenceLayers.forEach(s=>{const n=Zhe(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);n!=null&&(s.type!=="scene"&&(n.isReference=!0),r.push(n))})),e.baseMapLayers=r}set referenceLayers(t){this._set("referenceLayers",gy(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return Hre(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>cz(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>cz(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new fR({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){var i;return t=t||{},e!=null&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&((i=this.resourceInfo)!=null&&i.data.baseMapLayers)&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const s=re(r);return s.url&&my(s.url)&&(s.url=`https:${s.url}`),s.templateUrl&&my(s.templateUrl)&&(s.templateUrl=`https:${s.templateUrl}`),s})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:i,style:r}=this;Dt(t);const s=[];if(e){const n=e.context?e.context.url:null;if(s.push(this._loadLayersFromJSON(e.data,n,t)),e.data.id&&!e.data.title){const o=e.data.id;s.push(hXe(o).then(a=>{a&&this.read({title:a},e.context)}))}}else i?s.push(this._loadFromItem(i,t)):r&&s.push(this._loadFromStylesService(r,t));await Promise.all(s)}async _loadLayersFromJSON(t,e,i){var l,c;const r=(l=this.resourceInfo)==null?void 0:l.context,s=((c=this.portalItem)==null?void 0:c.portal)||(r==null?void 0:r.portal)||null,n=AXe[(r==null?void 0:r.origin)||""]??"web-map",{populateOperationalLayers:o}=await oe(async()=>{const{populateOperationalLayers:u}=await import("./layersCreator-CirDWEZ0.js");return{populateOperationalLayers:u}},__vite__mapDeps([6,7,8,9])),a=[];if(Dt(i),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const u={context:{...r,origin:n,url:e,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},d=g=>n==="web-scene"&&g.layerType==="ArcGISSceneServiceLayer"||g.isReference,f=o(this.baseLayers,t.baseMapLayers.filter(g=>!d(g)),u);a.push(f);const m=o(this.referenceLayers,t.baseMapLayers.filter(d),u);a.push(m)}await Promise.allSettled(a)}async _loadFromItem(t,e){const i=await t.load(e),r=await i.fetchData("json",e),s=gn(t.itemUrl??"");return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:MXe[t.type||""]??"web-map",portal:t.portal||Kn.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||Kn.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}async _loadFromStylesService(t,e){const i=`${t.serviceUrl}/${t.id}`,r=(await fr(i,{query:{language:t.getLanguageParamValue(),places:t.places,worldview:t.worldview},signal:e==null?void 0:e.signal})).data,s=gn(i);return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:"web-map",url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this._loadLayersFromJSON(this.resourceInfo.data,s,e)}static fromId(t){const e=sY[t];return e?e.itemId?new fR({portalItem:{id:e.itemId,portal:{url:"https://www.arcgis.com"}}}):fR.fromJSON(e,{origin:e.is3d?"web-scene":"web-map"}):null}};h([p({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,i,r){this._writeBaseLayers(t,e,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:Ke}},writer(t,e,i,r){this._writeBaseLayers(t,e,r)}}}}}})],ch.prototype,"baseLayers",null),h([p({type:String,json:{origins:{"web-scene":{write:!0}}}})],ch.prototype,"id",void 0),h([p({type:AS})],ch.prototype,"portalItem",void 0),h([p()],ch.prototype,"referenceLayers",null),h([p({readOnly:!0})],ch.prototype,"resourceInfo",void 0),h([p({type:Ye})],ch.prototype,"spatialReference",void 0),h([p({type:pXe})],ch.prototype,"style",void 0),h([p()],ch.prototype,"thumbnailUrl",void 0),h([p({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],ch.prototype,"title",void 0),h([Ze("title")],ch.prototype,"writeTitle",null),ch=fR=h([I("esri.Basemap")],ch);const MXe={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},AXe={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},wA=ch,PXe=Object.freeze(Object.defineProperty({__proto__:null,default:wA},Symbol.toStringTag,{value:"Module"})),Bz={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function ECe(t){return!!Bz[t]||!!Bz[t.toLowerCase()]}function rse(t){return Bz[t]??Bz[t.toLowerCase()]}function OXe(t){return[...rse(t)]}function OH(t,e,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?t+(e-t)*r:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}function CCe(t,e,i,r=1){const s=(t%360+360)%360/360,n=i<=.5?i*(e+1):i+e-i*e,o=2*i-n;return[Math.round(255*OH(o,n,s+1/3)),Math.round(255*OH(o,n,s)),Math.round(255*OH(o,n,s-1/3)),r]}function $Xe(t){const e=t.length>5,i=e?8:4,r=(1<<i)-1,s=e?1:17,n=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&r,o>>=i,a[3]=s*l/255),l=o&r,o>>=i,a[2]=s*l,l=o&r,o>>=i,a[1]=s*l,l=o&r,o>>=i,a[0]=s*l,a}function C(){return[0,0,0]}function yn(t){return[t[0],t[1],t[2]]}function qe(t,e,i){return[t,e,i]}function Xl(t,e=C()){const i=Math.min(3,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function RXe(t,e){return new Float64Array(t,e,3)}function sse(){return C()}function MCe(){return qe(1,1,1)}function ACe(){return qe(1,0,0)}function PCe(){return qe(0,1,0)}function nse(){return qe(0,0,1)}const Nn=sse(),o_=MCe(),ose=ACe(),ase=PCe(),hP=nse();Object.freeze(Object.defineProperty({__proto__:null,ONES:o_,UNIT_X:ose,UNIT_Y:ase,UNIT_Z:hP,ZEROS:Nn,clone:yn,create:C,createView:RXe,fromArray:Xl,fromValues:qe,ones:MCe,unitX:ACe,unitY:PCe,unitZ:nse,zeros:sse},Symbol.toStringTag,{value:"Module"}));let lse=1e-6;function Bo(){return lse}function IXe(t){lse=t}const WD=Math.random,LXe=Math.PI/180,DXe=180/Math.PI;function PG(t){return t*LXe}function NXe(t){return t*DXe}function FXe(t,e){return Math.abs(t-e)<=lse*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:WD,equals:FXe,getEpsilon:Bo,setEpsilon:IXe,toDegree:NXe,toRadian:PG},Symbol.toStringTag,{value:"Module"}));function Ve(t){const e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function ve(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function pe(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}function Ee(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function $e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function OG(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function jz(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function kXe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function OCe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function dP(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function $Ce(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function RCe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function ICe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function UXe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function de(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Dn(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function Ar(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}function yo(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}function pl(t){const e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function da(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function VXe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Ce(t,e){const i=e[0],r=e[1],s=e[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t}function Te(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function mt(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2];return t[0]=s*l-n*a,t[1]=n*o-r*l,t[2]=r*a-s*o,t}function Sr(t,e,i,r){const s=e[0],n=e[1],o=e[2];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=o+r*(i[2]-o),t}function zXe(t,e,i,r,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),u=o*(3-2*n);return t[0]=e[0]*a+i[0]*l+r[0]*c+s[0]*u,t[1]=e[1]*a+i[1]*l+r[1]*c+s[1]*u,t[2]=e[2]*a+i[2]*l+r[2]*c+s[2]*u,t}function BXe(t,e,i,r,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,u=3*n*a,d=3*l*o,f=l*n;return t[0]=e[0]*c+i[0]*u+r[0]*d+s[0]*f,t[1]=e[1]*c+i[1]*u+r[1]*d+s[1]*f,t[2]=e[2]*c+i[2]*u+r[2]*d+s[2]*f,t}function jXe(t,e){e=e||1;const i=WD,r=2*i()*Math.PI,s=2*i()-1,n=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=s*e,t}function nt(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12],t[1]=i[1]*r+i[5]*s+i[9]*n+i[13],t[2]=i[2]*r+i[6]*s+i[10]*n+i[14],t}function ca(t,e,i){const r=e[0],s=e[1],n=e[2];return t[0]=r*i[0]+s*i[3]+n*i[6],t[1]=r*i[1]+s*i[4]+n*i[7],t[2]=r*i[2]+s*i[5]+n*i[8],t}function Eu(t,e,i){const r=i[0],s=i[1],n=i[2],o=i[3],a=e[0],l=e[1],c=e[2],u=s*c-n*l,d=n*a-r*c,f=r*l-s*a,m=s*f-n*d,g=n*u-r*f,y=r*d-s*u,v=2*o;return t[0]=a+u*v+2*m,t[1]=l+d*v+2*g,t[2]=c+f*v+2*y,t}function GXe(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function HXe(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function qXe(t,e,i,r){const s=[],n=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function LCe(t,e){Ce(Yhe,t),Ce(Xhe,e);const i=Te(Yhe,Xhe);return i>1?0:i<-1?Math.PI:Math.acos(i)}const Yhe=C(),Xhe=C();function WXe(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Uo(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function h2(t,e){if(t===e)return!0;const i=t[0],r=t[1],s=t[2],n=e[0],o=e[1],a=e[2],l=Bo();return Math.abs(i-n)<=l*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=l*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-a)<=l*Math.max(1,Math.abs(s),Math.abs(a))}function U_(t,e,i){const r=i[0]-e[0],s=i[1]-e[1],n=i[2]-e[2];let o=r*r+s*s+n*n;return o>0?(o=1/Math.sqrt(o),t[0]=r*o,t[1]=s*o,t[2]=n*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const Li=$e,ZXe=OG,YXe=jz,gb=Ar,IL=yo,Wl=Ve,Gz=pl,Jhe=Object.freeze(Object.defineProperty({__proto__:null,abs:dP,add:Ee,angle:LCe,bezier:BXe,ceil:kXe,copy:ve,cross:mt,direction:U_,dist:gb,distance:Ar,div:YXe,divide:jz,dot:Te,equals:h2,exactEquals:Uo,floor:OCe,hermite:zXe,inverse:VXe,len:Wl,length:Ve,lerp:Sr,max:ICe,min:RCe,mul:ZXe,multiply:OG,negate:da,normalize:Ce,random:jXe,rotateX:GXe,rotateY:HXe,rotateZ:qXe,round:UXe,scale:de,scaleAndAdd:Dn,set:pe,sign:$Ce,sqrDist:IL,sqrLen:Gz,squaredDistance:yo,squaredLength:pl,str:WXe,sub:Li,subtract:$e,transformMat3:ca,transformMat4:nt,transformQuat:Eu},Symbol.toStringTag,{value:"Module"})),Qhe=new Float32Array(1);function DCe(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function Ne(t,e,i){return Math.min(Math.max(t,e),i)}function LL(t){return!(t&t-1)}function NWt(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function FWt(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function Bt(t,e,i){return t+(e-t)*i}function kWt(t,e,i,r,s){return Bt(r,s,(t-e)/(i-e))}function kt(t){return t*Math.PI/180}function ja(t){return 180*t/Math.PI}function nY(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function vo(t){return Math.acos(Ne(t,-1,1))}function lm(t){return Math.asin(Ne(t,-1,1))}function yb(t,e,i=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=i}const Hz=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function oY(t){return Hz.setFloat64(0,t),Hz.getBigInt64(0)}function XXe(t){return Hz.setBigInt64(0,t),Hz.getFloat64(0)}const zk=BigInt("1000000"),JXe=NCe(1);function NCe(t){const e=oY(t=Math.abs(t)),i=XXe(e<=zk?zk:e-zk);return Math.abs(t-i)}function UWt(t,e,i=JXe){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(i!=null&&NCe(Math.min(Math.abs(t),Math.abs(e)))<i)return Math.abs(t-e)<=i;const r=oY(t),s=oY(e);return r<0!=s<0?!1:!((r<s?s-r:r-s)>zk)}function QXe(t,e,i=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const r=Math.abs(t-e),s=Math.abs(t),n=Math.abs(e);if(t===0||e===0||s<1e-12&&n<1e-12){if(r>.01*i)return!1}else if(r/(s+n)>i)return!1;return!0}function KXe(t){return FCe(Math.max(-aY,Math.min(t,aY)))}function FCe(t){return Qhe[0]=t,Qhe[0]}function DL(t,e,i){const r=Ne((i-t)/(e-t),0,1);return r*r*(3-2*r)}function Khe(t,e){const i=Ve(t),r=lm(t[2]/i),s=Math.atan2(t[1]/i,t[0]/i);return pe(e,i,r,s),e}function qz(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],r=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(yb(e,1)&&yb(i,1)&&yb(r,1))}function eJe(t,e){return(t%e+e)%e}const aY=FCe(34028234663852886e22);function yF(t){return Ne(Ere(t),0,255)}function _F(t,e,i){return t=Number(t),isNaN(t)?i:t<e?e:t>i?i:t}function vF(t,e){const i=t.toString(16).padStart(2,"0");return e?i.substring(0,1):i}let Bk=class Ko{static blendColors(e,i,r,s=new Ko){return s.r=Math.round(e.r+(i.r-e.r)*r),s.g=Math.round(e.g+(i.g-e.g)*r),s.b=Math.round(e.b+(i.b-e.b)*r),s.a=e.a+(i.a-e.a)*r,s._sanitize()}static fromRgb(e,i){const r=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s.\-,%0-9]+)\)/);if(r){const s=r[2].split(/\s*,\s*/),n=r[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),Ko.fromArray(a,i)}return Ko.fromArray(s.map(a=>parseFloat(a)),i)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return Ko.fromArray(CCe(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),i)}return null}static fromHex(e,i=new Ko){if(e[0]!=="#"||isNaN(+`0x${e.substring(1)}`))return null;switch(e.length){case 4:case 5:{const r=parseInt(e.substring(1,2),16),s=parseInt(e.substring(2,3),16),n=parseInt(e.substring(3,4),16),o=e.length===5?15:parseInt(e.substring(4),16);return Ko.fromArray([r+16*r,s+16*s,n+16*n,(o+16*o)/255],i)}case 7:case 9:{const r=parseInt(e.substring(1,3),16),s=parseInt(e.substring(3,5),16),n=parseInt(e.substring(5,7),16),o=e.length===7?255:parseInt(e.substring(7),16);return Ko.fromArray([r,s,n,o/255],i)}default:return null}}static fromArray(e,i=new Ko){return i._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(e,i){const r=ECe(e)?rse(e):null;return r&&Ko.fromArray(r,i)||Ko.fromRgb(e,i)||Ko.fromHex(e,i)}static fromJSON(e){return e!=null?new Ko([e[0],e[1],e[2],(e[3]??255)/255]):void 0}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?Ko.fromString(e,this):Array.isArray(e)?Ko.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof Ko||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(e){const i=(e==null?void 0:e.capitalize)??!1,r=(e==null?void 0:e.digits)??6,s=r===3||r===4,n=r===4||r===8,o=`#${vF(this.r,s)}${vF(this.g,s)}${vF(this.b,s)}${n?vF(Math.round(255*this.a),s):""}`;return i?o.toUpperCase():o}toCss(e=!1){const i=this.r+", "+this.g+", "+this.b;return e?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=Ko.AlphaMode.ALWAYS){const i=yF(this.r),r=yF(this.g),s=yF(this.b);return e===Ko.AlphaMode.ALWAYS||this.a!==1?[i,r,s,yF(255*this.a)]:[i,r,s]}clone(){return new Ko(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(_F(this.r,0,255)),this.g=Math.round(_F(this.g,0,255)),this.b=Math.round(_F(this.b,0,255)),this.a=_F(this.a,0,1),this}_set(e,i,r,s){this.r=e,this.g=i,this.b=r,this.a=s}};Bk.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(Bk||(Bk={}));const je=Bk;function VWt(t){}function tJe(t){return()=>t}function $t(t,e={}){const i=t instanceof Qi?t:new Qi(t,e),r={type:(e==null?void 0:e.ignoreUnknown)??1?i.apiValues:String,json:{type:i.jsonValues,read:!(e!=null&&e.readOnly)&&{reader:i.read},write:{writer:i.write}}};return(e==null?void 0:e.readOnly)!==void 0&&(r.readOnly=!!e.readOnly),(e==null?void 0:e.default)!==void 0&&(r.json.default=e.default),(e==null?void 0:e.name)!==void 0&&(r.json.name=e.name),(e==null?void 0:e.nonNullable)!==void 0&&(r.nonNullable=e.nonNullable),p(r)}var lY;let jk=lY=class extends Se{constructor(t){super(t),this.type="none"}clone(){return new lY({type:this.type})}};h([$t({none:"none",stayAbove:"stay-above"})],jk.prototype,"type",void 0),jk=lY=h([I("esri.ground.NavigationConstraint")],jk);function ZD(t){const e=Ere(100*(1-t));return Math.max(0,Math.min(e,100))}function pP(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var cY;let m0=cY=class extends BD(yy){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new Ke;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&ne.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>e(r.item)),this.layers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{us(t)||ne.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)He(e);this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",gy(t,this._get("layers")))}writeLayers(t,e,i,r){const s=[];t&&(r={...r,layerContainerType:"ground"},t.forEach(n=>{if("write"in n){const o={};tJe(n)().write(o,r)&&s.push(o)}else r!=null&&r.messages&&r.messages.push(new B("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),e.layers=s}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return Hre(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:i}=await oe(()=>import("./ElevationQuery-CkLcfnNV.js"),[]);Dt(e);const r=new i,s=this.layers.filter(ede).toArray();return r.queryAll(s,t,e)}async createElevationSampler(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:i}=await oe(()=>import("./ElevationQuery-CkLcfnNV.js"),[]);Dt(e);const r=new i,s=this.layers.filter(ede).toArray();return r.createSamplerAll(s,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:re(this.surfaceColor),navigationConstraint:re(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new cY({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}async _loadLayersFromJSON(t,e,i){const r=(e==null?void 0:e.origin)||"web-scene",s=(e==null?void 0:e.portal)||null,n=(e==null?void 0:e.url)||null,{populateOperationalLayers:o}=await oe(async()=>{const{populateOperationalLayers:l}=await import("./layersCreator-CirDWEZ0.js");return{populateOperationalLayers:l}},__vite__mapDeps([6,7,8,9]));Dt(i);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}await Promise.allSettled(a)}};function iJe(t){return t&&"createElevationSampler"in t}function ede(t){return t.type==="elevation"||iJe(t)}h([p({json:{read:!1}})],m0.prototype,"layers",null),h([Ze("layers")],m0.prototype,"writeLayers",null),h([p({readOnly:!0})],m0.prototype,"resourceInfo",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Ji,read:{reader:pP,source:"transparency"},write:{writer:(t,e)=>{e.transparency=ZD(t)},target:"transparency"}}})],m0.prototype,"opacity",void 0),h([p({type:je,json:{type:[Ji],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],m0.prototype,"surfaceColor",void 0),h([p({type:jk,json:{write:!0}})],m0.prototype,"navigationConstraint",void 0),m0=cY=h([I("esri.Ground")],m0);const NL=m0;let TC=class extends Ke{constructor(e){super(e),this.getCollections=null}initialize(){this.addHandles(Q2e(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let i=0;for(const r of e)r!=null&&(i=this._processCollection(i,r));this.splice(i,this.length)}_createNewInstance(e){return new Ke(e)}_processCollection(e,i){if(!i)return e;const r=this.itemFilterFunction??(s=>!!s);for(const s of i)if(s){if(r(s)){const n=this.indexOf(s,e);n>=0?n!==e&&this.reorder(s,e):this.add(s,e),++e}if(this.getChildrenFunction){const n=this.getChildrenFunction(s);if(Array.isArray(n))for(const o of n)e=this._processCollection(e,o);else e=this._processCollection(e,n)}}return e}};h([p()],TC.prototype,"getCollections",void 0),h([p()],TC.prototype,"getChildrenFunction",void 0),h([p()],TC.prototype,"itemFilterFunction",void 0),TC=h([I("esri.core.CollectionFlattener")],TC);const FL=TC;function te(t,e,i={}){return cse(t,e,i,kCe)}function jo(t,e,i={}){return cse(t,e,i,UCe)}function cse(t,e,i={},r){let s=null;const n=i.once?(o,a)=>{r(o)&&(Lr(s),e(o,a))}:(o,a)=>{r(o)&&e(o,a)};if(s=nWe(t,n,i.sync,i.equals),i.initial){const o=t();n(o,o)}return s}function on(t,e,i,r={}){let s=null,n=null,o=null;function a(){var u;s&&n&&(n.remove(),(u=r.onListenerRemove)==null||u.call(r,s),s=null,n=null)}function l(u){r.once&&r.once&&Lr(o),i(u)}const c=te(t,(u,d)=>{var f;a(),yG(u)&&(s=u,n=fO(u,e,l),(f=r.onListenerAdd)==null||f.call(r,u))},{sync:r.sync,initial:!0});return o=Gi(()=>{c.remove(),a()}),o}function d2(t,e){return rJe(t,UCe,e)}function rJe(t,e,i){if(ha(i))return Promise.reject(Ui());const r=t();if(e!=null&&e(r))return Promise.resolve(r);let s=null;function n(){s=Lr(s)}return new Promise((o,a)=>{s=JS([Va(i,()=>{n(),a(Ui())}),cse(t,l=>{n(),o(l)},{sync:!1,once:!0},e??kCe)])})}function kCe(t){return!0}function UCe(t){return!!t}function sJe(t,e){const i=new Ke,r=on(t,"after-splice",({added:s,start:n,deleteCount:o})=>{const a=i.splice(n,o);for(const l of a)l.remove();if(s!=null&&s.length){const l=s.map(e);i.addMany(l,n)}},{sync:!0,onListenerRemove:()=>i.drain(s=>s.remove()),onListenerAdd:s=>i.addMany(s.items.map(e))});return i.addHandles(r),i}function BWt(t,e){const i=new Ke,r=sJe(t,a=>My(async l=>{const c=await e(a,l);if(ha(l))throw c.remove(),Ui();return c})),s=()=>null,n=async a=>{const l=await a.promise,c=r.indexOf(a);c<0||i.splice(c,1,l)};i.addMany(r.items.map(s));for(const a of r)h_(n(a));const o=r.on("after-splice",({added:a,start:l,deleteCount:c})=>{const u=i.splice(l,c);for(const d of u)d==null||d.remove();if(a!=null&&a.length){i.addMany(a.map(s),l);for(const d of a)h_(n(d))}});return i.addHandles([gSe(r),o]),i}const lr={sync:!0},pt={initial:!0},pr={sync:!0,initial:!0},bF=new WeakMap;function VCe(t){return!t.destroyed&&(bF.has(t)||t.addHandles([te(()=>{const e=t.parent;return!(!e||!("type"in e))&&(e.type==="catalog-dynamic-group"||VCe(e))},e=>bF.set(t,e),pr),Gi(()=>bF.delete(t))]),bF.get(t))}function nJe(t){return typeof t=="object"&&t!=null&&"loaded"in t&&t.loaded===!0&&"type"in t}function oJe(t){var e,i;return!(!nJe(t)||!((i=(e=SCe(t))==null?void 0:e.operations)!=null&&i.supportsEditing)||"editingEnabled"in t&&!vXe(t)||VCe(t))}const aJe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,lJe="screenUtils.toPt: input not recognized!",zCe=96;function mr(t){return t?t/72*zCe:0}function bo(t){return t?72*t/zCe:0}function wr(t){if(typeof t=="string"){const e=t.match(aJe);if(e){const i=Number(e[1]),r=e[3]&&e[3].toLowerCase(),s=t.charAt(0)==="-",n=r==="px"?bo(i):i;return s?-n:n}return console.warn(lJe),null}return t}function fp(t=0,e=0){return{x:t,y:e}}function Os(t=0,e=0){return[t,e]}function BCe(t=0,e=0){return[t,e]}function ka(t=0,e=0,i=0){return[t,e,i]}function jWt(t){return t}function GWt(t){return t}function HWt(t){return t}function Lf(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function $G(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function cJe(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function uJe(t,e,i,r,s,n,o,a,l,c,u,d,f,m,g,y){const v=new Float32Array(16);return v[0]=t,v[1]=e,v[2]=i,v[3]=r,v[4]=s,v[5]=n,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=u,v[11]=d,v[12]=f,v[13]=m,v[14]=g,v[15]=y,v}function hJe(t,e){return new Float32Array(t,e,16)}const dJe=$G();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:dJe,clone:cJe,create:$G,createView:hJe,fromValues:uJe},Symbol.toStringTag,{value:"Module"}));function An(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ay(t,e,i,r,s,n,o,a,l,c,u,d,f,m,g,y,v){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=u,t[10]=d,t[11]=f,t[12]=m,t[13]=g,t[14]=y,t[15]=v,t}function mp(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Hu(t,e){if(t===e){const i=e[1],r=e[2],s=e[3],n=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=n,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function fw(t,e){return eo(t,e)||mp(t),t}function eo(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],f=e[10],m=e[11],g=e[12],y=e[13],v=e[14],b=e[15],w=i*a-r*o,x=i*l-s*o,T=i*c-n*o,E=r*l-s*a,M=r*c-n*a,O=s*c-n*l,D=u*y-d*g,U=u*v-f*g,k=u*b-m*g,H=d*v-f*y,V=d*b-m*y,X=f*b-m*v;let q=w*X-x*V+T*H+E*k-M*U+O*D;return q?(q=1/q,t[0]=(a*X-l*V+c*H)*q,t[1]=(s*V-r*X-n*H)*q,t[2]=(y*O-v*M+b*E)*q,t[3]=(f*M-d*O-m*E)*q,t[4]=(l*k-o*X-c*U)*q,t[5]=(i*X-s*k+n*U)*q,t[6]=(v*T-g*O-b*x)*q,t[7]=(u*O-f*T+m*x)*q,t[8]=(o*V-a*k+c*D)*q,t[9]=(r*k-i*V-n*D)*q,t[10]=(g*M-y*T+b*w)*q,t[11]=(d*T-u*M-m*w)*q,t[12]=(a*U-o*H-l*D)*q,t[13]=(i*H-r*U+s*D)*q,t[14]=(y*x-g*E-v*w)*q,t[15]=(u*E-d*x+f*w)*q,t):null}function pJe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],f=e[10],m=e[11],g=e[12],y=e[13],v=e[14],b=e[15];return t[0]=a*(f*b-m*v)-d*(l*b-c*v)+y*(l*m-c*f),t[1]=-(r*(f*b-m*v)-d*(s*b-n*v)+y*(s*m-n*f)),t[2]=r*(l*b-c*v)-a*(s*b-n*v)+y*(s*c-n*l),t[3]=-(r*(l*m-c*f)-a*(s*m-n*f)+d*(s*c-n*l)),t[4]=-(o*(f*b-m*v)-u*(l*b-c*v)+g*(l*m-c*f)),t[5]=i*(f*b-m*v)-u*(s*b-n*v)+g*(s*m-n*f),t[6]=-(i*(l*b-c*v)-o*(s*b-n*v)+g*(s*c-n*l)),t[7]=i*(l*m-c*f)-o*(s*m-n*f)+u*(s*c-n*l),t[8]=o*(d*b-m*y)-u*(a*b-c*y)+g*(a*m-c*d),t[9]=-(i*(d*b-m*y)-u*(r*b-n*y)+g*(r*m-n*d)),t[10]=i*(a*b-c*y)-o*(r*b-n*y)+g*(r*c-n*a),t[11]=-(i*(a*m-c*d)-o*(r*m-n*d)+u*(r*c-n*a)),t[12]=-(o*(d*v-f*y)-u*(a*v-l*y)+g*(a*f-l*d)),t[13]=i*(d*v-f*y)-u*(r*v-s*y)+g*(r*f-s*d),t[14]=-(i*(a*v-l*y)-o*(r*v-s*y)+g*(r*l-s*a)),t[15]=i*(a*f-l*d)-o*(r*f-s*d)+u*(r*l-s*a),t}function fJe(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],d=t[10],f=t[11],m=t[12],g=t[13],y=t[14],v=t[15];return(e*o-i*n)*(d*v-f*y)-(e*a-r*n)*(u*v-f*g)+(e*l-s*n)*(u*y-d*g)+(i*a-r*o)*(c*v-f*m)-(i*l-s*o)*(c*y-d*m)+(r*l-s*a)*(c*g-u*m)}function vr(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],f=e[9],m=e[10],g=e[11],y=e[12],v=e[13],b=e[14],w=e[15];let x=i[0],T=i[1],E=i[2],M=i[3];return t[0]=x*r+T*a+E*d+M*y,t[1]=x*s+T*l+E*f+M*v,t[2]=x*n+T*c+E*m+M*b,t[3]=x*o+T*u+E*g+M*w,x=i[4],T=i[5],E=i[6],M=i[7],t[4]=x*r+T*a+E*d+M*y,t[5]=x*s+T*l+E*f+M*v,t[6]=x*n+T*c+E*m+M*b,t[7]=x*o+T*u+E*g+M*w,x=i[8],T=i[9],E=i[10],M=i[11],t[8]=x*r+T*a+E*d+M*y,t[9]=x*s+T*l+E*f+M*v,t[10]=x*n+T*c+E*m+M*b,t[11]=x*o+T*u+E*g+M*w,x=i[12],T=i[13],E=i[14],M=i[15],t[12]=x*r+T*a+E*d+M*y,t[13]=x*s+T*l+E*f+M*v,t[14]=x*n+T*c+E*m+M*b,t[15]=x*o+T*u+E*g+M*w,t}function wl(t,e,i){const r=i[0],s=i[1],n=i[2];if(e===t)t[12]=e[0]*r+e[4]*s+e[8]*n+e[12],t[13]=e[1]*r+e[5]*s+e[9]*n+e[13],t[14]=e[2]*r+e[6]*s+e[10]*n+e[14],t[15]=e[3]*r+e[7]*s+e[11]*n+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],d=e[5],f=e[6],m=e[7],g=e[8],y=e[9],v=e[10],b=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=d,t[6]=f,t[7]=m,t[8]=g,t[9]=y,t[10]=v,t[11]=b,t[12]=o*r+u*s+g*n+e[12],t[13]=a*r+d*s+y*n+e[13],t[14]=l*r+f*s+v*n+e[14],t[15]=c*r+m*s+b*n+e[15]}return t}function YD(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Uu(t,e,i,r){let s,n,o,a,l,c,u,d,f,m,g,y,v,b,w,x,T,E,M,O,D,U,k,H,V=r[0],X=r[1],q=r[2],Z=Math.sqrt(V*V+X*X+q*q);return Z<Bo()?null:(Z=1/Z,V*=Z,X*=Z,q*=Z,s=Math.sin(i),n=Math.cos(i),o=1-n,a=e[0],l=e[1],c=e[2],u=e[3],d=e[4],f=e[5],m=e[6],g=e[7],y=e[8],v=e[9],b=e[10],w=e[11],x=V*V*o+n,T=X*V*o+q*s,E=q*V*o-X*s,M=V*X*o-q*s,O=X*X*o+n,D=q*X*o+V*s,U=V*q*o+X*s,k=X*q*o-V*s,H=q*q*o+n,t[0]=a*x+d*T+y*E,t[1]=l*x+f*T+v*E,t[2]=c*x+m*T+b*E,t[3]=u*x+g*T+w*E,t[4]=a*M+d*O+y*D,t[5]=l*M+f*O+v*D,t[6]=c*M+m*O+b*D,t[7]=u*M+g*O+w*D,t[8]=a*U+d*k+y*H,t[9]=l*U+f*k+v*H,t[10]=c*U+m*k+b*H,t[11]=u*U+g*k+w*H,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function fP(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],d=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+c*r,t[5]=o*s+u*r,t[6]=a*s+d*r,t[7]=l*s+f*r,t[8]=c*s-n*r,t[9]=u*s-o*r,t[10]=d*s-a*r,t[11]=f*s-l*r,t}function RG(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],d=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-c*r,t[1]=o*s-u*r,t[2]=a*s-d*r,t[3]=l*s-f*r,t[8]=n*r+c*s,t[9]=o*r+u*s,t[10]=a*r+d*s,t[11]=l*r+f*s,t}function mP(t,e,i){const r=Math.sin(i),s=Math.cos(i),n=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],d=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+c*r,t[1]=o*s+u*r,t[2]=a*s+d*r,t[3]=l*s+f*r,t[4]=c*s-n*r,t[5]=u*s-o*r,t[6]=d*s-a*r,t[7]=f*s-l*r,t}function z2(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function jCe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function qu(t,e,i){if(e===0)return mp(t);let r,s,n,o=i[0],a=i[1],l=i[2],c=Math.sqrt(o*o+a*a+l*l);return c<Bo()?null:(c=1/c,o*=c,a*=c,l*=c,r=Math.sin(e),s=Math.cos(e),n=1-s,t[0]=o*o*n+s,t[1]=a*o*n+l*r,t[2]=l*o*n-a*r,t[3]=0,t[4]=o*a*n-l*r,t[5]=a*a*n+s,t[6]=l*a*n+o*r,t[7]=0,t[8]=o*l*n+a*r,t[9]=a*l*n-o*r,t[10]=l*l*n+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function GCe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function mJe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function HCe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function qCe(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=r+r,l=s+s,c=n+n,u=r*a,d=r*l,f=r*c,m=s*l,g=s*c,y=n*c,v=o*a,b=o*l,w=o*c;return t[0]=1-(m+y),t[1]=d+w,t[2]=f-b,t[3]=0,t[4]=d-w,t[5]=1-(u+y),t[6]=g+v,t[7]=0,t[8]=f+b,t[9]=g-v,t[10]=1-(u+m),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function gJe(t,e){const i=yJe,r=-e[0],s=-e[1],n=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=r*r+s*s+n*n+o*o;return d>0?(i[0]=2*(a*o+u*r+l*n-c*s)/d,i[1]=2*(l*o+u*s+c*r-a*n)/d,i[2]=2*(c*o+u*n+a*s-l*r)/d):(i[0]=2*(a*o+u*r+l*n-c*s),i[1]=2*(l*o+u*s+c*r-a*n),i[2]=2*(c*o+u*n+a*s-l*r)),qCe(t,e,i),t}const yJe=C();function Wz(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function WCe(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.sqrt(i*i+r*r+s*s),t[1]=Math.sqrt(n*n+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+u*u),t}function ZCe(t,e){const i=e[0]+e[5]+e[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t}function _Je(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3],l=s+s,c=n+n,u=o+o,d=s*l,f=s*c,m=s*u,g=n*c,y=n*u,v=o*u,b=a*l,w=a*c,x=a*u,T=r[0],E=r[1],M=r[2];return t[0]=(1-(g+v))*T,t[1]=(f+x)*T,t[2]=(m-w)*T,t[3]=0,t[4]=(f-x)*E,t[5]=(1-(d+v))*E,t[6]=(y+b)*E,t[7]=0,t[8]=(m+w)*M,t[9]=(y-b)*M,t[10]=(1-(d+g))*M,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function vJe(t,e,i,r,s){const n=e[0],o=e[1],a=e[2],l=e[3],c=n+n,u=o+o,d=a+a,f=n*c,m=n*u,g=n*d,y=o*u,v=o*d,b=a*d,w=l*c,x=l*u,T=l*d,E=r[0],M=r[1],O=r[2],D=s[0],U=s[1],k=s[2],H=(1-(y+b))*E,V=(m+T)*E,X=(g-x)*E,q=(m-T)*M,Z=(1-(f+b))*M,ye=(v+w)*M,L=(g+x)*O,N=(v-w)*O,z=(1-(f+y))*O;return t[0]=H,t[1]=V,t[2]=X,t[3]=0,t[4]=q,t[5]=Z,t[6]=ye,t[7]=0,t[8]=L,t[9]=N,t[10]=z,t[11]=0,t[12]=i[0]+D-(H*D+q*U+L*k),t[13]=i[1]+U-(V*D+Z*U+N*k),t[14]=i[2]+k-(X*D+ye*U+z*k),t[15]=1,t}function bJe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i+i,a=r+r,l=s+s,c=i*o,u=r*o,d=r*a,f=s*o,m=s*a,g=s*l,y=n*o,v=n*a,b=n*l;return t[0]=1-d-g,t[1]=u+b,t[2]=f-v,t[3]=0,t[4]=u-b,t[5]=1-c-g,t[6]=m+y,t[7]=0,t[8]=f+v,t[9]=m-y,t[10]=1-c-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function YCe(t,e,i,r,s,n,o){const a=1/(i-e),l=1/(s-r),c=1/(n-o);return t[0]=2*n*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*l,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(s+r)*l,t[10]=(o+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n*2*c,t[15]=0,t}function wJe(t,e,i,r,s){const n=1/Math.tan(e/2);let o;return t[0]=n/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(o=1/(r-s),t[10]=(s+r)*o,t[14]=2*s*r*o):(t[10]=-1,t[14]=-2*r),t}function xJe(t,e,i,r){const s=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(s-n)*c*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t}function XCe(t,e,i,r,s,n,o){const a=1/(e-i),l=1/(r-s),c=1/(n-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(s+r)*l,t[14]=(o+n)*c,t[15]=1,t}function IG(t,e,i,r){const s=e[0],n=e[1],o=e[2];let a=s-i[0],l=n-i[1],c=o-i[2];const u=Bo();if(Math.abs(a)<u&&Math.abs(l)<u&&Math.abs(c)<u)return void mp(t);let d=1/Math.sqrt(a*a+l*l+c*c);a*=d,l*=d,c*=d;const f=r[0],m=r[1],g=r[2];let y=m*c-g*l,v=g*a-f*c,b=f*l-m*a;d=Math.sqrt(y*y+v*v+b*b),d?(d=1/d,y*=d,v*=d,b*=d):(y=0,v=0,b=0);let w=l*b-c*v,x=c*y-a*b,T=a*v-l*y;d=Math.sqrt(w*w+x*x+T*T),d?(d=1/d,w*=d,x*=d,T*=d):(w=0,x=0,T=0),t[0]=y,t[1]=w,t[2]=a,t[3]=0,t[4]=v,t[5]=x,t[6]=l,t[7]=0,t[8]=b,t[9]=T,t[10]=c,t[11]=0,t[12]=-(y*s+v*n+b*o),t[13]=-(w*s+x*n+T*o),t[14]=-(a*s+l*n+c*o),t[15]=1}function JCe(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=r[0],l=r[1],c=r[2];let u=s-i[0],d=n-i[1],f=o-i[2],m=u*u+d*d+f*f;m>0&&(m=1/Math.sqrt(m),u*=m,d*=m,f*=m);let g=l*f-c*d,y=c*u-a*f,v=a*d-l*u;return m=g*g+y*y+v*v,m>0&&(m=1/Math.sqrt(m),g*=m,y*=m,v*=m),t[0]=g,t[1]=y,t[2]=v,t[3]=0,t[4]=d*v-f*y,t[5]=f*g-u*v,t[6]=u*y-d*g,t[7]=0,t[8]=u,t[9]=d,t[10]=f,t[11]=0,t[12]=s,t[13]=n,t[14]=o,t[15]=1,t}function TJe(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function SJe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function EJe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t}function QCe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}function CJe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t}function MJe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t}function KCe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function LG(t,e){if(t===e)return!0;const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],f=t[10],m=t[11],g=t[12],y=t[13],v=t[14],b=t[15],w=e[0],x=e[1],T=e[2],E=e[3],M=e[4],O=e[5],D=e[6],U=e[7],k=e[8],H=e[9],V=e[10],X=e[11],q=e[12],Z=e[13],ye=e[14],L=e[15],N=Bo();return Math.abs(i-w)<=N*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(r-x)<=N*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(s-T)<=N*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(n-E)<=N*Math.max(1,Math.abs(n),Math.abs(E))&&Math.abs(o-M)<=N*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(a-O)<=N*Math.max(1,Math.abs(a),Math.abs(O))&&Math.abs(l-D)<=N*Math.max(1,Math.abs(l),Math.abs(D))&&Math.abs(c-U)<=N*Math.max(1,Math.abs(c),Math.abs(U))&&Math.abs(u-k)<=N*Math.max(1,Math.abs(u),Math.abs(k))&&Math.abs(d-H)<=N*Math.max(1,Math.abs(d),Math.abs(H))&&Math.abs(f-V)<=N*Math.max(1,Math.abs(f),Math.abs(V))&&Math.abs(m-X)<=N*Math.max(1,Math.abs(m),Math.abs(X))&&Math.abs(g-q)<=N*Math.max(1,Math.abs(g),Math.abs(q))&&Math.abs(y-Z)<=N*Math.max(1,Math.abs(y),Math.abs(Z))&&Math.abs(v-ye)<=N*Math.max(1,Math.abs(v),Math.abs(ye))&&Math.abs(b-L)<=N*Math.max(1,Math.abs(b),Math.abs(L))}function use(t){const e=Bo(),i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return Math.abs(1-(i*i+n*n+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+u*u))<=e}function DG(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const kL=vr,AJe=QCe;Object.freeze(Object.defineProperty({__proto__:null,add:EJe,adjoint:pJe,copy:An,determinant:fJe,equals:LG,exactEquals:KCe,frob:SJe,fromQuat:bJe,fromQuat2:gJe,fromRotation:qu,fromRotationTranslation:qCe,fromRotationTranslationScale:_Je,fromRotationTranslationScaleOrigin:vJe,fromScaling:jCe,fromTranslation:z2,fromXRotation:GCe,fromYRotation:mJe,fromZRotation:HCe,frustum:YCe,getRotation:ZCe,getScaling:WCe,getTranslation:Wz,hasIdentityRotation:DG,identity:mp,invert:eo,invertOrIdentity:fw,isOrthoNormal:use,lookAt:IG,mul:kL,multiply:vr,multiplyScalar:CJe,multiplyScalarAndAdd:MJe,ortho:XCe,perspective:wJe,perspectiveFromFieldOfView:xJe,rotate:Uu,rotateX:fP,rotateY:RG,rotateZ:mP,scale:YD,set:Ay,str:TJe,sub:AJe,subtract:QCe,targetTo:JCe,translate:wl,transpose:Hu},Symbol.toStringTag,{value:"Module"}));const PJe=(t,e)=>{const i=Ay(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return Hu(i,i)},OJe=(t,e)=>{const i=Ay(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return Hu(i,i)},$Je=(t,e)=>{const i=1-e,r=Ay(t,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return Hu(r,r)},RJe=(t,e)=>{const i=Math.sin(e*Math.PI/180),r=Math.cos(e*Math.PI/180),s=Ay(t,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return Hu(s,s)},IJe=(t,e)=>{const i=1-2*e,r=Ay(t,i,0,0,e,0,i,0,e,0,0,i,e,0,0,0,1);return Hu(r,r)},LJe=(t,e)=>{const i=Ay(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return Hu(i,i)},DJe=(t,e)=>{const i=1-e,r=Ay(t,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return Hu(r,r)};let eMe=class tMe{constructor(e,i,r){this.strength=e,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(e,i,r){this.strength=Cu(e.strength,i.strength,r),this.radius=Cu(e.radius,i.radius,r),this.threshold=Cu(e.threshold,i.threshold,r)}clone(){return new tMe(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:T3(this.radius),strength:this.strength,threshold:this.threshold}}},iMe=class rMe{constructor(e){this.radius=e,this.type="blur"}interpolate(e,i,r){this.radius=Math.round(Cu(e.radius,i.radius,r))}clone(){return new rMe(this.radius)}toJSON(){return{type:"blur",radius:T3(this.radius)}}},uY=class sMe{constructor(e,i){this.type=e,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.amount=Cu(e.amount,i.amount,r),this._updateMatrix()}clone(){return new sMe(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||$G();switch(this.type){case"brightness":this._colorMatrix=PJe(e,this.amount);break;case"contrast":this._colorMatrix=OJe(e,this.amount);break;case"grayscale":this._colorMatrix=$Je(e,this.amount);break;case"invert":this._colorMatrix=IJe(e,this.amount);break;case"saturate":this._colorMatrix=LJe(e,this.amount);break;case"sepia":this._colorMatrix=DJe(e,this.amount)}}},nMe=class oMe{constructor(e,i,r,s){this.offsetX=e,this.offsetY=i,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(e,i,r){this.offsetX=Cu(e.offsetX,i.offsetX,r),this.offsetY=Cu(e.offsetY,i.offsetY,r),this.blurRadius=Cu(e.blurRadius,i.blurRadius,r),this.color[0]=Math.round(Cu(e.color[0],i.color[0],r)),this.color[1]=Math.round(Cu(e.color[1],i.color[1],r)),this.color[2]=Math.round(Cu(e.color[2],i.color[2],r)),this.color[3]=Cu(e.color[3],i.color[3],r)}clone(){return new oMe(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:T3(this.offsetX),yoffset:T3(this.offsetY),blurRadius:T3(this.blurRadius),color:e}}},aMe=class lMe{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.angle=Cu(e.angle,i.angle,r),this._updateMatrix()}clone(){return new lMe(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||$G();this._colorMatrix=RJe(e,this.angle)}},cMe=class uMe{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,i,r){this.amount=Cu(e.amount,i.amount,r)}clone(){return new uMe(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function Cu(t,e,i){return t+(e-t)*i}function T3(t){return Math.round(1e3*bo(t))/1e3}function NJe(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new uY(t.type,0);case"saturate":case"brightness":case"contrast":return new uY(t.type,1);case"opacity":return new cMe(1);case"hue-rotate":return new aMe(0);case"blur":return new iMe(0);case"drop-shadow":return new nMe(0,0,0,[...rse("transparent")]);case"bloom":return new eMe(0,0,1)}}function FJe(t,e){const i=t.length>e.length?t:e;return(t.length>e.length?e:t).every((r,s)=>r.type===i[s].type)}function kJe(t,e){const i=t.length>e.length?t:e,r=t.length>e.length?e:t;for(let s=r.length;s<i.length;s++)r.push(NJe(i[s]))}function UJe(t){const e=t[0];return!!e&&"type"in e}function VJe(t,e){return JSON.stringify(t??null)===JSON.stringify(e??null)}const tde=()=>ne.getLogger("esri.support.basemapUtils");function zJe(){return{}}function BJe(t){for(const e in t){const i=t[e];He(i),delete t[e]}}function hse(t,e){let i;if(typeof t=="string"){const r=t in sY,s=!r&&t.includes("/");if(!r&&!s){const n=Object.entries(sY).filter(([o,a])=>nr.apiKey&&!a.classic||!nr.apiKey&&(a.classic||a.is3d)).map(([o])=>`"${o}"`).sort().join(", ");return tde().warn(`Unable to find basemap definition for: ${t}. Try one of these: ${n}`),null}e&&(i=e[t]),i||(i=r?wA.fromId(t):new wA({style:{id:t}}),e&&(e[t]=i))}else i=nn(wA,t);return i!=null&&i.destroyed&&(tde().warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function qWt(t,e){var i,r,s,n;return((r=(i=t.basemap)==null?void 0:i.referenceLayers)==null?void 0:r.some(o=>o.uid===e))||((n=(s=t.basemap)==null?void 0:s.baseLayers)==null?void 0:n.some(o=>o.uid===e))}function jJe(t,e=null){const i=hse(t);if(!i)return null;const r=i.clone();return e&&(r.baseLayers=ide(r.baseLayers,e.baseLayers),r.referenceLayers=ide(r.referenceLayers,e.referenceLayers)),r}function ide(t,e){const i=new Ke;return t.forEach(r=>{const s=e.find(n=>n.type!=="scene"&&qJe(nde(r),nde(n)))||r;i.includes(s)?i.push(r):i.push(s)}),i}function rde(t){return!!(t!=null&&t.baseLayers.concat(t.referenceLayers).some(GJe))}function GJe(t){if(sde(t.url))return!0;if(t.type==="vector-tile")for(const e in t.sourceNameToSource){const i=t.sourceNameToSource[e];if(sde(i==null?void 0:i.sourceUrl))return!0}return!1}const HJe=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function sde(t){if(!t)return!1;const e=new CS(Lu(t));return!!e.authority&&HJe.test(e.authority)}function nde(t){var e,i;return{type:t.type,effect:"effect"in t?t.effect:void 0,url:WJe("urlTemplate"in t&&t.urlTemplate||t.url||"styleUrl"in t&&t.styleUrl||""),minScale:"minScale"in t&&t.minScale!=null?t.minScale:0,maxScale:"maxScale"in t&&t.maxScale!=null?t.maxScale:0,opacity:t.opacity!=null?t.opacity:1,visible:t.visible==null||!!t.visible,sublayers:t.type!=="map-image"&&t.type!=="wms"||t.sublayers==null||(e=t.sublayers)==null?void 0:e.map(r=>({id:r.id,visible:r.visible})),activeLayerId:t.type==="wmts"?(i=t.activeLayer)==null?void 0:i.id:void 0}}function qJe(t,e){if(t.type!==e.type||t.url!==e.url||t.minScale!==e.minScale||t.maxScale!==e.maxScale||t.visible!==e.visible||t.opacity!==e.opacity||!VJe(t.effect,e.effect))return!1;if(t.activeLayerId!=null||e.activeLayerId!=null)return t.activeLayerId===e.activeLayerId;if(t.sublayers!=null||e.sublayers!=null){if(t.sublayers==null||e.sublayers==null||t.sublayers.length!==e.sublayers.length)return!1;for(let i=0;i<t.sublayers.length;i++){const r=t.sublayers.at(i),s=e.sublayers.at(i);if((r==null?void 0:r.id)!==(s==null?void 0:s.id)||(r==null?void 0:r.visible)!==(s==null?void 0:s.visible))return!1}}return!0}function WJe(t){return t?lp(t).replace(/^\s*https?:/i,"").toLowerCase():""}function ZJe(t){return new FL({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const i=[];return"tables"in e&&i.push(e.tables),"layers"in e&&i.push(e.layers),i},itemFilterFunction:e=>{const i=e.parent;return!!i&&"tables"in i&&i.tables.includes(e)}})}function $H(t){for(const e of t.values())e==null||e.destroy();t.clear()}const ode={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function YJe(t){let e=null;if(typeof t=="string")if(t in ode){const i=ode[t];e=new NL({resourceInfo:{data:{layers:[i]}}})}else ne.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=nn(NL,t);return e}function gP(t,e,i=!1){let{hasM:r,hasZ:s}=t;Array.isArray(e)?e.length!==4||r||s?e.length===3&&i&&!r?(s=!0,r=!1):e.length===3&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&e.hasZ&&(!r||e.hasM),r=!r&&e.hasM&&(!s||e.hasZ)),t.hasZ=s,t.hasM=r}var hY;function ade(t){return(e,i)=>e==null?i:i==null?e:t(e,i)}function XJe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Zv=hY=class extends pw{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){var s;if(!t&&!e)return{};const i={};Array.isArray(t)?(i.points=t,i.spatialReference=e):XJe(t)?i.spatialReference=t:(t.points&&(i.points=t.points),t.spatialReference&&(i.spatialReference=t.spatialReference),t.hasZ&&(i.hasZ=t.hasZ),t.hasM&&(i.hasM=t.hasM));const r=(s=i.points)==null?void 0:s[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new dr,i=this.hasZ,r=this.hasM,s=i?3:2,n=t[0],o=ade(Math.min),a=ade(Math.max);let l,c,u,d,[f,m]=n,[g,y]=n;for(let v=0,b=t.length;v<b;v++){const w=t[v],[x,T]=w;if(f=o(f,x),m=o(m,T),g=a(g,x),y=a(y,T),i&&w.length>2){const E=w[2];l=o(l,E),u=a(u,E)}if(r&&w.length>s){const E=w[s];c=o(c,E),d=a(d,E)}}return e.xmin=f,e.ymin=m,e.xmax=g,e.ymax=y,e.spatialReference=this.spatialReference,i?(e.zmin=l,e.zmax=u):(e.zmin=void 0,e.zmax=void 0),r?(e.mmin=c,e.mmax=d):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=re(this.points)}addPoint(t){return gP(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:re(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new hY(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],i={x:e[0],y:e[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=e[2],r=3),this.hasM&&(i.m=e[r]),new wt(i)}removePoint(t){if(!this._validateInputs(t))return null;const e=new wt(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(gP(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};h([p({readOnly:!0})],Zv.prototype,"cache",null),h([p()],Zv.prototype,"extent",null),h([p({type:[[Number]],json:{write:{isRequired:!0}}})],Zv.prototype,"points",void 0),h([Ze("points")],Zv.prototype,"writePoints",null),Zv=hY=h([I("esri.geometry.Multipoint")],Zv),Zv.prototype.toJSON.isDefaultToJSON=!0;const vO=Zv;function XD(t){const e=[];for(t.reset();t.nextPath();){const i=[];for(;t.nextPoint();)i.push([t.x,t.y]);e.push(i)}return t.reset(),e}function _b(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}var Ts;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(Ts||(Ts={}));function NG(t,e){const i=e[0]-t[0],r=e[1]-t[1];if(t.length>2&&e.length>2){const s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function hMe(t,e,i){const r=t[0]+i*(e[0]-t[0]),s=t[1]+i*(e[1]-t[1]);return t.length>2&&e.length>2?[r,s,t[2]+i*(e[2]-t[2])]:[r,s]}function JJe(t,e,i,r){const[s,n]=e,[o,a]=i,[l,c]=r,u=l-o,d=c-a,f=u*u+d*d,m=(s-o)*u+(n-a)*d,g=Math.min(1,Math.max(0,m/f));return t[0]=o+u*g,t[1]=a+d*g,t}function QJe(t,e,i,r,s,n){let o=i,a=r,l=s-o,c=n-a;if(l!==0||c!==0){const u=((t-o)*l+(e-a)*c)/(l*l+c*c);u>1?(o=s,a=n):u>0&&(o+=l*u,a+=c*u)}return l=t-o,c=e-a,l*l+c*c}function dMe(t,e){return hMe(t,e,.5)}function dse(t){const e=t.length;let i=0;for(let r=0;r<e-1;++r)i+=NG(t[r],t[r+1]);return i}function pMe(t,e){if(e<=0)return t[0];const i=t.length;let r=0;for(let s=0;s<i-1;++s){const n=NG(t[s],t[s+1]);if(e-r<n){const o=(e-r)/n;return hMe(t[s],t[s+1],o)}r+=n}return t[i-1]}function mR(t,e=Ts.X,i=Ts.Y){let r=0;const s=t.length;let n=t[0];for(let o=1;o<s;o++){const a=t[o];r+=(a[e]-n[e])*(a[i]+n[i]),n=a}if(!fMe(t)){const o=t[0];r+=(o[e]-n[e])*(o[i]+n[i])}return r>=0}function fMe(t){const e=t.length;return e<3||Lb(t[0],t[e-1])}function KJe(t){if(!("rings"in t))return!1;let e=!1;for(const i of t.rings)fMe(i)||(i.push(i[0].slice()),e=!0);return e}function WWt(t){return t.type!=="polygon"&&t.type!=="polyline"||eQe(t.type==="polygon"?t.rings:t.paths,t.spatialReference),t}function eQe(t,e){const i=ey(e);if(!i)return;const r=i.valid[0],s=i.valid[1],n=s-r;for(const o of t){let a=1/0,l=-1/0;for(const u of o){const d=tQe(u[0],r,s);a=Math.min(a,d),l=Math.max(l,d),u[0]=d}const c=l-a;n-c<c&&o.forEach(u=>{u[0]<0&&(u[0]+=n)})}}function tQe(t,e,i){const r=i-e;return t<e?i-(e-t)%r:t>i?e+(t-e)%r:t}function ZWt(t,e){if(t===e)return!0;if(t.type!==e.type)return!1;if(t.type==="point"||t.type==="mesh"||t.type==="extent")return!0;if(t.type==="multipoint")return t.points.length===e.points.length;const[i,r]=t.type==="polyline"?[t.paths,e.paths]:[t.rings,e.rings];return i.length===r.length&&i.every((s,n)=>s.length===r[n].length)}function YWt(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function mMe(t){return t?gMe(t.rings,t.hasZ??!1):null}function gMe(t,e){if(!(t!=null&&t.length))return null;const i=[],r=[],s=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=t.length;n<o;n++){const a=yMe(t[n],e,s);a&&r.push(a)}if(r.sort((n,o)=>{let a=n[2]-o[2];return a===0&&e&&(a=n[4]-o[4]),a}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],e&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||e&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const n=t[0]&&t[0].length?rQe(t[0],e):null;if(!n)return null;i[0]=n[0],i[1]=n[1],e&&n.length>2&&(i[2]=n[2])}return i}function yMe(t,e,i){let r=0,s=0,n=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,u=t.length&&e?t[0][2]:0;for(let f=0;f<t.length;f++){const m=t[f],g=t[(f+1)%t.length],[y,v,b]=m,w=y-l,x=v-c,[T,E,M]=g,O=T-l,D=E-c,U=w*D-O*x;if(o+=U,r+=(w+O)*U,s+=(x+D)*U,e&&m.length>2&&g.length>2){const k=b-u,H=M-u,V=w*H-O*k;n+=(k+H)*V,a+=V}y<i[0]&&(i[0]=y),y>i[1]&&(i[1]=y),v<i[2]&&(i[2]=v),v>i[3]&&(i[3]=v),e&&(b<i[4]&&(i[4]=b),b>i[5]&&(i[5]=b))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const d=[r/(6*o)+l,s/(6*o)+c,o];return e&&(i[4]===i[5]||a===0?(d[3]=(i[4]+i[5])/2,d[4]=0):(d[3]=n/(6*a)+u,d[4]=a)),d}function iQe(t,e){let i=0,r=0,s=0;t.nextPoint();const n=t.pathSize?t.x:0,o=t.pathSize?t.y:0;for(let a=0;a<t.pathSize;a++){t.seekInPath(a);const l=[t.x,t.y];t.seekInPath((a+1)%t.pathSize);const c=[t.x,t.y],[u,d]=l,f=u-n,m=d-o,[g,y]=c,v=g-n,b=y-o,w=f*b-v*m;s+=w,i+=(f+v)*w,r+=(m+b)*w,u<e[0]&&(e[0]=u),u>e[1]&&(e[1]=u),d<e[2]&&(e[2]=d),d>e[3]&&(e[3]=d)}return s>0&&(s*=-1),s?(s*=.5,[i/(6*s)+n,r/(6*s)+o,s]):null}function rQe(t,e){const i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const u=t[l],d=t[l+1];if(u&&d){i[0]=u[0],i[1]=u[1],r[0]=d[0],r[1]=d[1],e&&u.length>2&&d.length>2&&(i[2]=u[2],r[2]=d[2]);const f=NG(i,r);if(f){s+=f;const m=dMe(u,d);n+=f*m[0],o+=f*m[1],e&&m.length>2&&(a+=f*m[2])}}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.length?t[0]:null}function sQe(t){const{hasZ:e,totalSize:i}=t;if(i===0)return null;const r=[],s=[],n=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=yMe(_b(t),t.hasZ,n);o&&s.push(o)}if(s.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),s.length&&(r[0]=s[0][0],r[1]=s[0][1],e&&(r[2]=s[0][3]),(r[0]<n[0]||r[0]>n[1]||r[1]<n[2]||r[1]>n[3]||e&&(r[2]<n[4]||r[2]>n[5]))&&(r.length=0)),!r.length){t.reset(),t.nextPath();const o=t.pathSize?nQe(t):null;if(!o)return null;r[0]=o[0],r[1]=o[1],e&&o.length>2&&(r[2]=o[2])}return r}function nQe(t){const{hasZ:e}=t,i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,u=t.z;for(;t.nextPoint();){const d=t.x,f=t.y,m=t.z;i[0]=l,i[1]=c,r[0]=d,r[1]=f,e&&(i[2]=u,r[2]=m);const g=NG(i,r);if(g){s+=g;const y=dMe(i,r);n+=g*y[0],o+=g*y[1],e&&y.length>2&&(a+=g*y[2])}l=d,c=f,u=m}}return s>0?e?[n/s,o/s,a/s]:[n/s,o/s]:t.pathSize?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const oQe=1e-6;function aQe(t){let e=0;for(t.reset();t.nextPath();)e+=t.getCurrentRingArea();if(e<oQe){const s=sQe(t);return s?[s[0],s[1]]:null}const i=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const r=[t.x,t.y];for(t.reset();t.nextPath();)cQe(i,r,t);return i[0]*=1/e,i[1]*=1/e,i[0]+=r[0],i[1]+=r[1],i}const lQe=1/3;function cQe(t,e,i){if(!t||!i||i.pathSize<3)return null;i.nextPoint();const r=i.x,s=i.y;i.nextPoint();let n,o=i.x-r,a=i.y-s,l=0,c=0;for(;i.nextPoint();)l=i.x-r,c=i.y-s,n=.5*lQe*(l*a-c*o),t[0]+=n*(o+l),t[1]+=n*(a+c),o=l,a=c;const u=i.getCurrentRingArea(),d=[r,s];return d[0]-=e[0],d[1]-=e[1],d[0]*=u,d[1]*=u,t[0]+=d[0],t[1]+=d[1],t}function oi(t=pQe){return[t[0],t[1],t[2],t[3]]}function XWt(t){return[t[0],t[1],t[2],t[3]]}function A_(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function FG(t,e,i,r,s=oi()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function _Me(t,e=oi()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function kG(t,e){return new dr({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function pse(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function vb(t,e,i){if(e!=null)if("length"in e)fY(e)?(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[2]),i[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[0]),i[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":i[0]=Math.min(t[0],e.xmin),i[1]=Math.min(t[1],e.ymin),i[2]=Math.max(t[2],e.xmax),i[3]=Math.max(t[3],e.ymax);break;case"point":i[0]=Math.min(t[0],e.x),i[1]=Math.min(t[1],e.y),i[2]=Math.max(t[2],e.x),i[3]=Math.max(t[3],e.y)}else A_(i,t)}function RH(t,e,i=t){const r=e.length;let s=t[0],n=t[1],o=t[2],a=t[3];for(let l=0;l<r;l++){const c=e[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return i[0]=s,i[1]=n,i[2]=o,i[3]=a,i}function dY(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function fl(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function Hc(t){return t==null||t[1]>=t[3]?0:t[3]-t[1]}function JWt(t){return fl(t)*Hc(t)}function Zz(t){return fl(t)>0&&Hc(t)>0}function fse(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function vMe(t,e){return UG(t,e[0],e[1])}function lde(t,e){const i=e[3],r=.5*(t[0]+t[2]),s=Math.abs(e[0]-r),n=.5*(t[2]-t[0]);if(s>i+n)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>i+a)return!1;if(s<n||l<a)return!0;const c=s-n,u=l-a;return c*c+u*u<=i*i}function QWt(t,e,i){const r=t[0],s=t[1],n=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:u}=i,d=(v,b)=>(u-l)*v+(a-c)*b+(c*l-a*u)<0,f=d(r,o),m=d(n,o),g=d(n,s),y=d(r,s);return!(f===m&&m===g&&g===y&&y===f||a<r&&c<r||a>n&&c>n||l>o&&u>o||l<s&&u<s)}function KWt(t,e){return UG(t,e.x,e.y)}function UG(t,e,i){return e>=t[0]&&i>=t[1]&&e<=t[2]&&i<=t[3]}function uQe(t,e,i){return e[0]>=t[0]-i&&e[1]>=t[1]-i&&e[0]<=t[2]+i&&e[1]<=t[3]+i}function VG(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function cde(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function pY(t,e,i){if(e==null)return A_(i,t);const r=e[0],s=e[1],n=e[2],o=e[3];return i[0]=Ne(t[0],r,n),i[1]=Ne(t[1],s,o),i[2]=Ne(t[2],r,n),i[3]=Ne(t[3],s,o),i}function hQe(t,e){const i=(t[0]+t[2])/2,r=(t[1]+t[3])/2,s=Math.max(Math.abs(e[0]-i)-fl(t)/2,0),n=Math.max(Math.abs(e[1]-r)-Hc(t)/2,0);return Math.sqrt(s*s+n*n)}function Yz(t,e,i,r=t){return r[0]=t[0]+e,r[1]=t[1]+i,r[2]=t[2]+e,r[3]=t[3]+i,r}function Kh(t){return t?A_(t,mY):oi(mY)}function fY(t){return t!=null&&t.length===4}function dQe(t){return!(fl(t)!==0&&isFinite(t[0])||Hc(t)!==0&&isFinite(t[1]))}function PS(t,e){return fY(t)&&fY(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const eZt=[-1/0,-1/0,1/0,1/0],mY=[1/0,1/0,-1/0,-1/0],pQe=[0,0,0,0];function bMe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function wMe(t){return t.points!==void 0}function xMe(t){return t.x!==void 0&&t.y!==void 0}function TMe(t){return t.paths!==void 0}function SMe(t){return t.rings!==void 0}function EMe(t){function e(i,r){return i==null?r:r==null?i:t(i,r)}return e}const nb=EMe(Math.min),ob=EMe(Math.max);function fQe(t,e){return TMe(e)?yP(t,e.paths,!1,!1):SMe(e)?yP(t,e.rings,!1,!1):wMe(e)?mse(t,e.points,!1,!1,!1,!1):bMe(e)?MMe(t,e):(xMe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function zG(t){let e,i,r,s;for(t.reset(),e=r=1/0,i=s=-1/0;t.nextPath();){const n=CMe(t);e=Math.min(n[0],e),r=Math.min(n[1],r),i=Math.max(n[2],i),s=Math.max(n[3],s)}return oi([e,r,i,s])}function CMe(t){let e,i,r,s;for(e=r=1/0,i=s=-1/0;t.nextPoint();)e=Math.min(t.x,e),r=Math.min(t.y,r),i=Math.max(t.x,i),s=Math.max(t.y,s);return oi([e,r,i,s])}function tZt(t,e){return TMe(e)?yP(t,e.paths,!0,!1):SMe(e)?yP(t,e.rings,!0,!1):wMe(e)?mse(t,e.points,!0,!1,!0,!1):bMe(e)?MMe(t,e,!0,!1,!0,!1):(xMe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function yP(t,e,i,r){const s=i?3:2;if(!e.length||!e[0].length)return null;let n,o,a,l,[c,u]=e[0][0],[d,f]=e[0][0];for(let m=0;m<e.length;m++){const g=e[m];for(let y=0;y<g.length;y++){const v=g[y],[b,w]=v;if(c=nb(c,b),u=nb(u,w),d=ob(d,b),f=ob(f,w),i&&v.length>2){const x=v[2];n=nb(n,x),o=ob(o,x)}if(r&&v.length>s){const x=v[s];a=nb(n,x),l=ob(o,x)}}}return i?r?(t[0]=c,t[1]=u,t[2]=n,t[3]=a,t[4]=d,t[5]=f,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=u,t[2]=n,t[3]=d,t[4]=f,t[5]=o,t.length=6,t):r?(t[0]=c,t[1]=u,t[2]=a,t[3]=d,t[4]=f,t[5]=l,t.length=6,t):(t[0]=c,t[1]=u,t[2]=d,t[3]=f,t.length=4,t)}function MMe(t,e,i,r,s,n){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let u=e.zmin,d=e.zmax,f=e.mmin,m=e.mmax;return s?(u=u||0,d=d||0,n?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=u,t[3]=f,t[4]=a,t[5]=c,t[6]=d,t[7]=m,t):(t[0]=o,t[1]=l,t[2]=u,t[3]=a,t[4]=c,t[5]=d,t)):n?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=f,t[3]=a,t[4]=c,t[5]=m,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function mse(t,e,i,r,s,n){const o=i?3:2,a=r&&n,l=i&&s;if(!e.length||!e[0].length)return null;let c,u,d,f,[m,g]=e[0],[y,v]=e[0];for(let b=0;b<e.length;b++){const w=e[b],[x,T]=w;if(m=nb(m,x),g=nb(g,T),y=ob(y,x),v=ob(v,T),l&&w.length>2){const E=w[2];c=nb(c,E),u=ob(u,E)}if(a&&w.length>o){const E=w[o];d=nb(c,E),f=ob(u,E)}}return s?(c=c||0,u=u||0,n?(d=d||0,f=f||0,t[0]=m,t[1]=g,t[2]=c,t[3]=d,t[4]=y,t[5]=v,t[6]=u,t[7]=f,t):(t[0]=m,t[1]=g,t[2]=c,t[3]=y,t[4]=v,t[5]=u,t)):n?(d=d||0,f=f||0,t[0]=m,t[1]=g,t[2]=d,t[3]=y,t[4]=v,t[5]=f,t):(t[0]=m,t[1]=g,t[2]=y,t[3]=v,t)}function mQe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function gQe(t){return t.points!==void 0}function yQe(t){return t.x!==void 0&&t.y!==void 0}function _Qe(t){return t.paths!==void 0}function vQe(t){return t.rings!==void 0}const gse=[];function AMe(t,e,i,r){return{xmin:t,ymin:e,xmax:i,ymax:r}}function PMe(t,e,i,r,s,n){return{xmin:t,ymin:e,zmin:i,xmax:r,ymax:s,zmax:n}}function OMe(t,e,i,r,s,n){return{xmin:t,ymin:e,mmin:i,xmax:r,ymax:s,mmax:n}}function $Me(t,e,i,r,s,n,o,a){return{xmin:t,ymin:e,zmin:i,mmin:r,xmax:s,ymax:n,zmax:o,mmax:a}}function yse(t,e=!1,i=!1){return e?i?$Me(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):PMe(t[0],t[1],t[2],t[3],t[4],t[5]):i?OMe(t[0],t[1],t[2],t[3],t[4],t[5]):AMe(t[0],t[1],t[2],t[3])}function iZt(t){return t?mQe(t)?t:yQe(t)?wQe(t):vQe(t)?RMe(t):_Qe(t)?IMe(t):gQe(t)?bQe(t):null:null}function bQe(t){const{hasZ:e,hasM:i,points:r}=t;return yse(mse(gse,r,e??!1,i??!1),e,i)}function wQe(t){const{x:e,y:i,z:r,m:s}=t,n=s!=null;return r!=null?n?$Me(e,i,r,s,e,i,r,s):PMe(e,i,r,e,i,r):n?OMe(e,i,s,e,i,s):AMe(e,i,e,i)}function RMe(t){const{hasZ:e,hasM:i,rings:r}=t,s=yP(gse,r,e??!1,i??!1);return s?yse(s,e,i):null}function IMe(t){const{hasZ:e,hasM:i,paths:r}=t,s=yP(gse,r,e??!1,i??!1);return s?yse(s,e,i):null}var Gk;function ude(t){return!Array.isArray(t[0])}let Ym=Gk=class extends pw{static fromExtent(t){const e=t.clone().normalize(),i=t.spatialReference;let r=!1,s=!1;for(const o of e)o.hasZ&&(r=!0),o.hasM&&(s=!0);const n={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(r&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:i};return r&&(n.hasZ=!0),s&&(n.hasM=!0),new Gk(n)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){var o,a;let i,r,s=null,n=null;return t&&!Array.isArray(t)?(s=t.rings??null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),i=t.hasZ,r=t.hasM):s=t,s=s||[],e=e||Ye.WGS84,s.length&&((o=s[0])==null?void 0:o[0])!=null&&typeof s[0][0]=="number"&&(s=[s]),n=(a=s[0])==null?void 0:a[0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=n.length>3):i===void 0?i=r?n.length>3:n.length>2:r===void 0&&(r=i?n.length>3:n.length>2)),{rings:s,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=mMe(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new wt;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=RMe(this);if(!e)return null;const i=new dr(e);return i.spatialReference=t,i}get isSelfIntersecting(){return JYe(this.rings)}writeRings(t,e){e.rings=re(this.rings)}addRing(t){if(!t)return;const e=this.rings,i=e.length;if(ude(t)){const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new Gk;return t.spatialReference=this.spatialReference,t.rings=re(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;if(e!=null!=(i!=null)||e!=null&&i!=null&&!e.equals(i)||this.rings.length!==t.rings.length)return!1;const r=([s,n,o,a],[l,c,u,d])=>s===l&&n===c&&(o==null&&u==null||o===u)&&(a==null&&d==null||a===d);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=t.rings[s];if(!Lb(n,o,r))return!1}return!0}contains(t){if(!t)return!1;const e=qD(t,this.spatialReference);return zYe(this,e??t)}isClockwise(t){const e=ude(t)?t.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):t;return mR(e)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.rings[t][e],r=this.hasZ,s=this.hasM;return r&&!s?new wt(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new wt(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new wt(i[0],i[1],i[2],i[3],this.spatialReference):new wt(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(gP(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t].splice(e,0,i),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new wt(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],i=this.spatialReference,r=e.map(s=>new wt(s,i));return this.notifyChange("rings"),r}setPoint(t,e,i){return this._validateInputs(t,e)?(gP(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t][e]=i,this.notifyChange("rings"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const r=this.rings[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};h([p({readOnly:!0})],Ym.prototype,"cache",null),h([p({readOnly:!0})],Ym.prototype,"centroid",null),h([p({readOnly:!0})],Ym.prototype,"extent",null),h([p({readOnly:!0})],Ym.prototype,"isSelfIntersecting",null),h([p({type:[[[Number]]],json:{write:{isRequired:!0}}})],Ym.prototype,"rings",void 0),h([Ze("rings")],Ym.prototype,"writeRings",null),Ym=Gk=h([I("esri.geometry.Polygon")],Ym),Ym.prototype.toJSON.isDefaultToJSON=!0;const cm=Ym;var gY;function xQe(t){return!Array.isArray(t[0])}let Yv=gY=class extends pw{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){var o,a;let i,r,s=null,n=null;return t&&!Array.isArray(t)?(s=t.paths??null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),i=t.hasZ,r=t.hasM):s=t,s=s||[],e=e||Ye.WGS84,s.length&&((o=s[0])==null?void 0:o[0])!=null&&typeof s[0][0]=="number"&&(s=[s]),n=(a=s[0])==null?void 0:a[0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=!1):i===void 0?i=!r&&n.length>3:r===void 0&&(r=!i&&n.length>3)),{paths:s,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=IMe(this);if(!e)return null;const i=new dr(e);return i.spatialReference=t,i}writePaths(t,e){e.paths=re(this.paths)}addPath(t){if(!t)return;const e=this.paths,i=e.length;if(xQe(t)){const r=[];for(let s=0,n=t.length;s<n;s++)r[s]=t[s].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new gY;return t.spatialReference=this.spatialReference,t.paths=re(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.paths[t][e],r=this.hasZ,s=this.hasM;return r&&!s?new wt(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new wt(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new wt(i[0],i[1],i[2],i[3],this.spatialReference):new wt(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(gP(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t].splice(e,0,i),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],i=this.spatialReference,r=e.map(s=>new wt(s,i));return this.notifyChange("paths"),r}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new wt(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(t,e,i){return this._validateInputs(t,e)?(gP(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t][e]=i,this.notifyChange("paths"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const r=this.paths[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};h([p({readOnly:!0})],Yv.prototype,"cache",null),h([p({readOnly:!0})],Yv.prototype,"extent",null),h([p({type:[[[Number]]],json:{write:{isRequired:!0}}})],Yv.prototype,"paths",void 0),h([Ze("paths")],Yv.prototype,"writePaths",null),Yv=gY=h([I("esri.geometry.Polyline")],Yv),Yv.prototype.toJSON.isDefaultToJSON=!0;const Bf=Yv,LMe=lc()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),hde=lc()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function Df(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function OS(t){return t.points!==void 0}function _P(t){return t.x!==void 0&&t.y!==void 0}function Nf(t){return t.paths!==void 0}function ml(t){return t.rings!==void 0}function _y(t){return t==null?null:t instanceof pw?t:_P(t)?wt.fromJSON(t):Nf(t)?Bf.fromJSON(t):ml(t)?cm.fromJSON(t):OS(t)?vO.fromJSON(t):Df(t)?dr.fromJSON(t):null}function bO(t){return t?_P(t)?"esriGeometryPoint":Nf(t)?"esriGeometryPolyline":ml(t)?"esriGeometryPolygon":Df(t)?"esriGeometryEnvelope":OS(t)?"esriGeometryMultipoint":null:null}const TQe={esriGeometryPoint:wt,esriGeometryPolyline:Bf,esriGeometryPolygon:cm,esriGeometryEnvelope:dr,esriGeometryMultipoint:vO};function SQe(t){return t&&TQe[t]||null}const B2={base:pw,key:"type",typeMap:{extent:dr,multipoint:vO,point:wt,polyline:Bf,polygon:cm}};om(B2);const yY={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8};function IH(t,e,i,r=pp){const s=new Xh(_re(r)),n=yi.fromJSDate(t,{zone:s}),o=i==="decades"||i==="centuries"?"year":NMe(i);return i==="decades"&&(e*=10),i==="centuries"&&(e*=100),n.plus({[o]:e}).toJSDate()}function rZt(t,e,i="milliseconds"){const r=t.getTime(),s=DMe(e,i,"milliseconds");return new Date(r+s)}function dde(t,e,i=pp){const r=new Xh(_re(i)),s=yi.fromJSDate(t,{zone:r});if(e==="decades"||e==="centuries"){const o=s.startOf("year"),{year:a}=o,l=a-a%(e==="decades"?10:100);return o.set({year:l}).toJSDate()}const n=NMe(e);return s.startOf(n).toJSDate()}function DMe(t,e,i){return t===0?0:t*yY[e]/yY[i]}function sZt(t,e){return t&&e?t.intersection(e):t||e}function NMe(t){switch(t){case"milliseconds":return"millisecond";case"seconds":return"second";case"minutes":return"minute";case"hours":return"hour";case"days":return"day";case"weeks":return"week";case"months":return"month";case"years":return"year"}}var bd;let xh=bd=class extends Se{static get allTime(){return pde}static get empty(){return EQe}static fromArray(t){return new bd({start:t[0]!=null?new Date(t[0]):t[0],end:t[1]!=null?new Date(t[1]):t[1]})}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=(t==null?void 0:t.getTime())??null}get isAllTime(){return this.equals(bd.allTime)}get isEmpty(){return this.equals(bd.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=(t==null?void 0:t.getTime())??null}clone(){return new bd({end:this.end,start:this.start})}equals(t){var n,o,a,l;if(!t)return!1;const e=((n=this.start)==null?void 0:n.getTime())??this.start,i=((o=this.end)==null?void 0:o.getTime())??this.end,r=((a=t.start)==null?void 0:a.getTime())??t.start,s=((l=t.end)==null?void 0:l.getTime())??t.end;return e===r&&i===s}expandTo(t,e=pp){if(this.isEmpty||this.isAllTime)return this.clone();let i=this.start;i&&(i=dde(i,t,e));let r=this.end;if(r){const s=dde(r,t,e);r=r.getTime()===s.getTime()?s:IH(s,1,t,e)}return new bd({start:i,end:r})}intersection(t){var a,l,c,u;if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return bd.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=((a=this.start)==null?void 0:a.getTime())??-1/0,i=((l=this.end)==null?void 0:l.getTime())??1/0,r=((c=t.start)==null?void 0:c.getTime())??-1/0,s=((u=t.end)==null?void 0:u.getTime())??1/0;let n,o;return r>=e&&r<=i?n=r:e>=r&&e<=s&&(n=e),i>=r&&i<=s?o=i:s>=e&&s<=i&&(o=s),n==null||o==null||isNaN(n)||isNaN(o)?bd.empty:new bd({start:n===-1/0?null:new Date(n),end:o===1/0?null:new Date(o)})}offset(t,e,i=pp){if(this.isEmpty||this.isAllTime)return this.clone();const r=new bd,{start:s,end:n}=this;return s!=null&&(r.start=IH(s,t,e,i)),n!=null&&(r.end=IH(n,t,e,i)),r}toArray(){var t,e;return this.isEmpty?[void 0,void 0]:[((t=this.start)==null?void 0:t.getTime())??null,((e=this.end)==null?void 0:e.getTime())??null]}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return pde.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,i=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new bd({start:e,end:i})}};h([p({type:Date,json:{write:{allowNull:!0}}})],xh.prototype,"end",void 0),h([ze("end")],xh.prototype,"readEnd",null),h([Ze("end")],xh.prototype,"writeEnd",null),h([p({readOnly:!0,json:{read:!1}})],xh.prototype,"isAllTime",null),h([p({readOnly:!0,json:{read:!1}})],xh.prototype,"isEmpty",null),h([p({type:Date,json:{write:{allowNull:!0}}})],xh.prototype,"start",void 0),h([ze("start")],xh.prototype,"readStart",null),h([Ze("start")],xh.prototype,"writeStart",null),xh=bd=h([I("esri.TimeExtent")],xh);const pde=new xh,EQe=new xh({start:void 0,end:void 0}),za=xh;let FMe=0;const mw=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+FMe++})}};return e=h([I("esri.core.Identifiable")],e),e},nZt=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:FMe++})}};return e=h([I("esri.core.Identifiable.NumericIdentifiable")],e),e};let fde=class extends mw(class{}){};fde=h([I("esri.core.Identifiable")],fde);async function CQe(t){var r;const e="portalItem"in t?t:{portalItem:t},{fromItem:i}=await oe(async()=>{const{fromItem:s}=await import("./portalLayers-Cxdpj3nC.js").then(n=>n.p);return{fromItem:s}},__vite__mapDeps([7,8,9]));try{return await i(e)}catch(s){const n=e==null?void 0:e.portalItem,o=(n==null?void 0:n.id)||"unset",a=((r=n==null?void 0:n.portal)==null?void 0:r.url)||nr.portalUrl;throw ne.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+a+"', id: '"+o+"')",s),s}}let MQe=0,no=class extends Ls.EventedMixin(mw(yy)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new dr(-180,-90,180,90,Ye.WGS84),this.id=Date.now().toString(16)+"-layer-"+MQe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.persistenceEnabled=!1,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Ye.WGS84,this.title=null,this.type=null,this.url=null,this.visibilityTimeExtent=null,this.visible=!0}static async fromArcGISServerUrl(e){const i=typeof e=="string"?{url:e}:e;return(await oe(async()=>{const{fromUrl:r}=await import("./arcgisLayers-phWRn0kH.js");return{fromUrl:r}},__vite__mapDeps([10,8,9]))).fromUrl(i)}static fromPortalItem(e){return CQe(e)}initialize(){this.when().catch(e=>{us(e)||ne.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){const e=this.parent;if(e){const i=this;"layers"in e&&e.layers.includes(i)?e.layers.remove(i):"tables"in e&&e.tables.includes(i)?e.tables.remove(i):"baseLayers"in e&&e.baseLayers.includes(i)?e.baseLayers.remove(i):"referenceLayers"in e&&e.referenceLayers.includes(i)&&e.referenceLayers.remove(i),this._set("parent",null)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return gn(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await fr(e,{query:{f:"json"},responseType:"json"})).data;throw new B("layer:no-attribution-data","Layer does not have attribution data")}};h([p({type:String})],no.prototype,"attributionDataUrl",void 0),h([p({type:dr})],no.prototype,"fullExtent",void 0),h([p({readOnly:!0})],no.prototype,"hasAttributionData",null),h([p({type:String,clonable:!1})],no.prototype,"id",void 0),h([p({type:Boolean,nonNullable:!0})],no.prototype,"legendEnabled",void 0),h([p({type:["show","hide","hide-children"]})],no.prototype,"listMode",void 0),h([p({type:Number,range:{min:0,max:1},nonNullable:!0})],no.prototype,"opacity",void 0),h([p({clonable:!1})],no.prototype,"parent",void 0),h([p({readOnly:!0})],no.prototype,"parsedUrl",null),h([p({type:Boolean,readOnly:!0})],no.prototype,"persistenceEnabled",void 0),h([p({type:Boolean})],no.prototype,"popupEnabled",void 0),h([p({type:Boolean})],no.prototype,"attributionVisible",void 0),h([p({type:Ye})],no.prototype,"spatialReference",void 0),h([p({type:String})],no.prototype,"title",void 0),h([p({readOnly:!0,json:{read:!1}})],no.prototype,"type",void 0),h([p()],no.prototype,"url",void 0),h([p({type:za})],no.prototype,"visibilityTimeExtent",void 0),h([p({type:Boolean,nonNullable:!0})],no.prototype,"visible",void 0),no=h([I("esri.layers.Layer")],no);const UL=no;function _Y(t,e,i){let r,s;if(t)for(let n=0,o=t.length;n<o;n++){if(r=t.at(n),(r==null?void 0:r[e])===i)return r;if((r==null?void 0:r.type)==="group"&&(s=_Y(r.layers,e,i),s))return s}}const AQe=t=>{let e=class extends t{constructor(...i){super(...i),this.layers=new Ke;const r=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||ne.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>{if(o.item===this)return o.preventDefault(),void ne.getLogger(this).error("#add()","Cannot add layer to itself.");r(o.item)}),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))])}destroy(){const i=this.layers.toArray();for(const r of i)r.destroy();this.layers.destroy()}set layers(i){this._set("layers",gy(i,this._get("layers")))}add(i,r){const s=this.layers;if(r=s.getNextIndex(r),i instanceof UL){const n=i;n.parent===this?this.reorder(n,r):s.add(n,r)}else Zu(i)?i.then(n=>{this.destroyed||this.add(n,r)}):ne.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const s=this.layers;let n=s.getNextIndex(r);i.slice().forEach(o=>{o.parent!==this?(s.add(o,n),n+=1):this.reorder(o,n)})}findLayerById(i){return _Y(this.layers,"id",i)}findLayerByUid(i){return _Y(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return h([p()],e.prototype,"layers",null),e=h([I("esri.support.LayersMixin")],e),e};function vY(t,e,i){if(t)for(let r=0,s=t.length;r<s;r++){const n=t.at(r);if(n[e]===i)return n;if((n==null?void 0:n.type)==="group"){const o=vY(n.tables,e,i);if(o)return o}}}const PQe=t=>{let e=class extends t{constructor(...i){super(...i),this.tables=new Ke,this.addHandles([this.tables.on("after-add",r=>{const s=r.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&ne.getLogger(this).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})])}destroy(){const i=this.tables.toArray();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",gy(i,this._get("tables")))}findTableById(i){return vY(this.tables,"id",i)}findTableByUid(i){return vY(this.tables,"uid",i)}};return h([p()],e.prototype,"tables",null),e=h([I("esri.support.TablesMixin")],e),e};let Zp=class extends PQe(AQe(Ls.EventedMixin(Ue))){constructor(e){super(e),this.allLayers=new FL({getCollections:()=>{var i,r,s;return[(i=this.basemap)==null?void 0:i.baseLayers,(r=this.ground)==null?void 0:r.layers,this.layers,(s=this.basemap)==null?void 0:s.referenceLayers]},getChildrenFunction:i=>"layers"in i?i.layers:null}),this.allTables=ZJe(this),this.basemap=null,this.editableLayers=new FL({getCollections:()=>[this.allLayers],itemFilterFunction:oJe}),this.ground=new NL,this._basemapCache=zJe()}destroy(){BJe(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=He(this.basemap),He(this.ground),this._set("ground",null)}castBasemap(e){return hse(e,this._basemapCache)}castGround(e){return YJe(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(i=>i.id===e)}findTableById(e){return this.allTables.find(i=>i.id===e)}};h([p({readOnly:!0,dependsOn:[]})],Zp.prototype,"allLayers",void 0),h([p({readOnly:!0})],Zp.prototype,"allTables",void 0),h([p({type:wA,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Zp.prototype,"basemap",void 0),h([Qt("basemap")],Zp.prototype,"castBasemap",null),h([p({readOnly:!0})],Zp.prototype,"editableLayers",void 0),h([p({type:NL,nonNullable:!0})],Zp.prototype,"ground",void 0),h([Qt("ground")],Zp.prototype,"castGround",null),h([p()],Zp.prototype,"undoRedo",void 0),Zp=h([I("esri.Map")],Zp);const kMe=Zp,ts=t=>{let e=class extends t{clone(){var l;const i=bl(this);F2(i,"unable to clone instance of non-accessor class");const r=i.metadata,s=i.store,n={},o=new Map;for(const c in r){const u=r[c],d=s==null?void 0:s.originOf(c),f=u.clonable;if(u.readOnly||f===!1||d!==ki.USER&&d!==ki.DEFAULTS&&d!==ki.WEB_MAP&&d!==ki.WEB_SCENE)continue;const m=this[c];let g=null;g=typeof f=="function"?f(m):f==="reference"?m:hZ(m),m!=null&&g==null||(d===ki.DEFAULTS?o.set(c,g):n[c]=g)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const c=(l=bl(a))==null?void 0:l.store;if(c)for(const[u,d]of o)c.set(u,d,ki.DEFAULTS)}return a}};return e=h([I("esri.core.Clonable")],e),e};let p2=class extends ts(Ue){};p2=h([I("esri.core.Clonable")],p2);let Lx=class extends p2{constructor(e){super(e),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(e){return e!=null&&this.row===e.row&&this.rows===e.rows&&this.column===e.column&&this.columns===e.columns}};h([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Lx.prototype,"row",void 0),h([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Lx.prototype,"column",void 0),h([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Lx.prototype,"rows",void 0),h([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Lx.prototype,"columns",void 0),Lx=h([I("esri.CameraLayout")],Lx);const UMe=Lx;let zb=class{constructor(e,i){this.min=e,this.max=i,this.range=i-e}normalize(e,i=0,r=!1){return mde(this.range,this.min,this.max,e,i,r)}clamp(e,i=0){return Ne(e-i,this.min,this.max)+i}monotonic(e,i,r){return e<i?i:i+bY(this.range,e-i,r)}minimalMonotonic(e,i,r){return mde(this.range,e,e+this.range,i,r)}center(e,i,r){return i=this.monotonic(e,i,r),this.normalize((e+i)/2,r)}diff(e,i,r){return this.monotonic(e,i,r)-e}shortestSignedDiff(e,i){e=this.normalize(e);const r=(i=this.normalize(i))-e,s=i<e?this.minimalMonotonic(e,i)-e:i-this.minimalMonotonic(i,e);return Math.abs(r)<Math.abs(s)?r:s}contains(e,i,r){return i=this.minimalMonotonic(e,i),(r=this.minimalMonotonic(e,r))>e&&r<i}};function mde(t,e,i,r,s=0,n=!1){return(r-=s)<e?r+=bY(t,e-r):r>i&&(r-=bY(t,r-i)),n&&r===i&&(r=e),r+s}function bY(t,e,i=0){return Math.ceil((e-i)/t)*t+i}const OQe=new zb(0,2*Math.PI),Bb=new zb(-Math.PI,Math.PI),BG=new zb(0,360);let Xm=class extends ts(Se){constructor(...e){super(...e),this.position=new wt([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new UMe}normalizeCtorArgs(e,i,r,s){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const n={position:e};return i!=null&&(n.heading=i),r!=null&&(n.tilt=r),s!=null&&(n.fov=s),n}return e}writePosition(e,i,r,s){const n=e.clone();n.x=Wd(e.x||0),n.y=Wd(e.y||0),n.z=e.hasZ?Wd(e.z||0):e.z,i[r]=n.write({},s)}readPosition(e,i){const r=new wt;return r.read(e,i),r.x=Wd(r.x||0),r.y=Wd(r.y||0),r.z=r.hasZ?Wd(r.z||0):r.z,r}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)&&this.layout.equals(e.layout)}};h([p({type:wt,json:{write:{isRequired:!0}}})],Xm.prototype,"position",void 0),h([Ze("position")],Xm.prototype,"writePosition",null),h([ze("position")],Xm.prototype,"readPosition",null),h([p({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Qt(t=>BG.normalize(Wd(t)))],Xm.prototype,"heading",void 0),h([p({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Qt(t=>Ne(Wd(t),-180,180))],Xm.prototype,"tilt",void 0),h([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Xm.prototype,"fov",void 0),h([p({type:UMe,nonNullable:!0,json:{read:!1,write:!1}})],Xm.prototype,"layout",void 0),Xm=h([I("esri.Camera")],Xm);const ed=Xm;var wY;let Xv=wY=class extends Se{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new wY({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};h([p({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:LH}}}}})],Xv.prototype,"rotation",void 0),h([Qt("rotation")],Xv.prototype,"castRotation",null),h([p({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:LH}}}}})],Xv.prototype,"scale",void 0),h([p({types:B2,json:{read:_y,write:!0,origins:{"web-scene":{read:_y,write:{overridePolicy:LH}}}}})],Xv.prototype,"targetGeometry",void 0),h([p({type:ed,json:{write:!0}})],Xv.prototype,"camera",void 0),Xv=wY=h([I("esri.Viewpoint")],Xv);const um=Xv;function LH(){return{enabled:!this.camera}}let $Qe=class VMe{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(EZ),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const i=new VMe,r=this._originStores[ki.DEFAULTS];r&&r.forEach((s,n)=>{i.set(n,re(s),ki.DEFAULTS)});for(let s=ki.SERVICE;s<EZ;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{e&&e.has(a)||i.set(a,re(o),s)})}return i}get(e,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(e):void 0}keys(e){const i=e==null?this._values:this._originStores[e];return i?[...i.keys()]:[]}set(e,i,r=ki.USER){let s=this._originStores[r];if(s||(s=new Map,this._originStores[r]=s),s.set(e,i),!this._values.has(e)||this._propertyOriginMap.get(e)<=r){const n=this._values.get(e);return this._values.set(e,i),this._propertyOriginMap.set(e,r),n!==i}return!1}delete(e,i=ki.USER){const r=this._originStores[i];if(!r)return;const s=r.get(e);if(r.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===i){this._values.delete(e);for(let n=i-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,n);break}}}return s}has(e,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(e)}revert(e,i){for(;i>0&&!this.has(e,i);)--i;const r=this._originStores[i],s=r==null?void 0:r.get(e),n=this._values.get(e);return this._values.set(e,s),this._propertyOriginMap.set(e,i),n!==s}originOf(e){return this._propertyOriginMap.get(e)||ki.DEFAULTS}forEach(e){this._values.forEach(e)}};const zMe=t=>{let e=class extends t{constructor(...i){super(...i);const r=bl(this),s=r.store,n=new $Qe;r.store=n,bEe(r,s,n)}read(i,r){xEe(this,i,r)}getAtOrigin(i,r){const s=DH(this),n=sb(r);if(typeof i=="string")return s.get(i,n);const o={};return i.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(i){return yz(this.originIdOf(i))}originIdOf(i){return DH(this).originOf(i)}revert(i,r){const s=DH(this),n=sb(r),o=bl(this);let a;a=typeof i=="string"?i==="*"?s.keys(n):[i]:i,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return e=h([I("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function DH(t){return bl(t).store}let gde=class extends zMe(Ue){};gde=h([I("esri.core.ReadOnlyMultiOriginJSONSupport")],gde);const RQe=t=>{let e=class extends t{constructor(...i){super(...i)}clear(i,r="user"){return NH(this).delete(i,sb(r))}write(i,r){return EEe(this,i=i||{},r),i}setAtOrigin(i,r,s){bl(this).setAtOrigin(i,r,sb(s))}removeOrigin(i){const r=NH(this),s=sb(i),n=r.keys(s);for(const o of n)r.originOf(o)===s&&r.set(o,r.get(o,s),ki.USER)}updateOrigin(i,r){const s=NH(this),n=sb(r),o=Gc(this,i);for(let a=n+1;a<EZ;++a)s.delete(i,a);s.set(i,o,n)}toJSON(i){return this.write({},i)}};return e=h([I("esri.core.MultiOriginJSONSupport.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function NH(t){return bl(t).store}const _se=t=>{let e=class extends RQe(zMe(t)){constructor(...i){super(...i)}};return e=h([I("esri.core.MultiOriginJSONSupport")],e),e};let xY=class extends _se(Ue){};xY=h([I("esri.core.MultiOriginJSONSupport")],xY);function IQe(t){return t&&"getAtOrigin"in t&&"originOf"in t}function yde(t){t!=null&&t.writtenProperties&&t.writtenProperties.forEach(({target:e,propName:i,newOrigin:r})=>{IQe(e)&&r&&e.originOf(i)!==r&&e.updateOrigin(i,r)})}var gR;const Xz=lc()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),BMe=Xz.jsonValues.slice();TL(BMe,"orthometric");const S3=lc()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Yp=gR=class extends Se{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,i){return Xz.write(t,e,i)}readHeightModel(t,e,i){return Xz.read(t)||(i!=null&&i.messages&&i.messages.push(LQe(t,{context:i})),null)}readHeightUnit(t,e,i){return S3.read(t)||(i!=null&&i.messages&&i.messages.push(_de(t,{context:i})),null)}readHeightUnitService(t,e,i){return aCe(t)||S3.read(t)||(i!=null&&i.messages&&i.messages.push(_de(t,{context:i})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new gR({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const i=lCe(e);return new gR({heightModel:t.heightModel,heightUnit:i??void 0,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new gR;return e.read(t,{origin:"web-scene"}),e}};function _de(t,e){return new fy("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function LQe(t,e){return new fy("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}h([p({type:Xz.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:BMe,default:"ellipsoidal"}}}})],Yp.prototype,"heightModel",void 0),h([Ze("web-scene","heightModel")],Yp.prototype,"writeHeightModel",null),h([ze(["web-scene","service"],"heightModel")],Yp.prototype,"readHeightModel",null),h([p({type:S3.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:S3.jsonValues,write:S3.write}}}})],Yp.prototype,"heightUnit",void 0),h([ze("web-scene","heightUnit")],Yp.prototype,"readHeightUnit",null),h([ze("service","heightUnit")],Yp.prototype,"readHeightUnitService",null),h([p({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Yp.prototype,"vertCRS",void 0),h([ze("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Yp.prototype,"readVertCRS",null),Yp=gR=h([I("esri.geometry.HeightModelInfo")],Yp);const gw=Yp,mZt=Math.PI/180,gZt=/(?:SPHEROID|ELLIPSOID)\[([^\]]+)]/i,mv=ur.radius,Ip=ur.eccentricitySquared,DQe={a1:mv*Ip,a2:mv*Ip*mv*Ip,a3:mv*Ip*Ip/2,a4:mv*Ip*mv*Ip*2.5,a5:mv*Ip+mv*Ip*Ip/2,a6:1-Ip},yZt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:ur.radius,f:ur.flattening},4490:{a:6378137,f:1/298.257222101},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:E_.radius,f:E_.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:Qf.radius,f:Qf.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:Qf.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};var he;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.SPHERICAL_MARS_PCPF=6]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=7]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=8]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=9]="GCSMOON2000",t[t.LON_LAT=10]="LON_LAT",t[t.PLATE_CARREE=11]="PLATE_CARREE"})(he||(he={}));const yR={[he.WGS84]:{[he.CGCS2000]:Vs,[he.GCSMARS2000]:null,[he.GCSMOON2000]:null,[he.LON_LAT]:Vs,[he.SPHERICAL_ECEF]:SA,[he.SPHERICAL_MARS_PCPF]:null,[he.SPHERICAL_MOON_PCPF]:null,[he.UNKNOWN]:null,[he.WEB_MERCATOR]:$S,[he.PLATE_CARREE]:RS,[he.WGS84]:Vs,[he.WGS84_ECEF]:LS},[he.CGCS2000]:{[he.CGCS2000]:Vs,[he.GCSMARS2000]:null,[he.GCSMOON2000]:null,[he.LON_LAT]:Vs,[he.SPHERICAL_ECEF]:SA,[he.SPHERICAL_MARS_PCPF]:null,[he.SPHERICAL_MOON_PCPF]:null,[he.UNKNOWN]:null,[he.WEB_MERCATOR]:$S,[he.PLATE_CARREE]:RS,[he.WGS84]:Vs,[he.WGS84_ECEF]:LS},[he.GCSMARS2000]:{[he.CGCS2000]:null,[he.GCSMARS2000]:Vs,[he.GCSMOON2000]:null,[he.LON_LAT]:Vs,[he.SPHERICAL_ECEF]:null,[he.SPHERICAL_MARS_PCPF]:SY,[he.SPHERICAL_MOON_PCPF]:null,[he.UNKNOWN]:null,[he.WEB_MERCATOR]:null,[he.PLATE_CARREE]:null,[he.WGS84]:null,[he.WGS84_ECEF]:null},[he.GCSMOON2000]:{[he.CGCS2000]:null,[he.GCSMARS2000]:null,[he.GCSMOON2000]:Vs,[he.LON_LAT]:Vs,[he.SPHERICAL_ECEF]:null,[he.SPHERICAL_MARS_PCPF]:null,[he.SPHERICAL_MOON_PCPF]:TY,[he.UNKNOWN]:null,[he.WEB_MERCATOR]:null,[he.PLATE_CARREE]:null,[he.WGS84]:null,[he.WGS84_ECEF]:null},[he.WEB_MERCATOR]:{[he.CGCS2000]:xA,[he.GCSMARS2000]:null,[he.GCSMOON2000]:null,[he.LON_LAT]:xA,[he.SPHERICAL_ECEF]:jMe,[he.SPHERICAL_MARS_PCPF]:null,[he.SPHERICAL_MOON_PCPF]:null,[he.UNKNOWN]:null,[he.WEB_MERCATOR]:Vs,[he.PLATE_CARREE]:HMe,[he.WGS84]:xA,[he.WGS84_ECEF]:GMe},[he.WGS84_ECEF]:{[he.CGCS2000]:DS,[he.GCSMARS2000]:null,[he.GCSMOON2000]:null,[he.LON_LAT]:DS,[he.SPHERICAL_ECEF]:ZMe,[he.SPHERICAL_MARS_PCPF]:null,[he.SPHERICAL_MOON_PCPF]:null,[he.UNKNOWN]:null,[he.WEB_MERCATOR]:YMe,[he.PLATE_CARREE]:NQe,[he.WGS84]:DS,[he.WGS84_ECEF]:Vs},[he.SPHERICAL_ECEF]:{[he.CGCS2000]:IS,[he.GCSMARS2000]:null,[he.GCSMOON2000]:null,[he.LON_LAT]:IS,[he.SPHERICAL_ECEF]:Vs,[he.SPHERICAL_MARS_PCPF]:null,[he.SPHERICAL_MOON_PCPF]:null,[he.UNKNOWN]:null,[he.WEB_MERCATOR]:qMe,[he.PLATE_CARREE]:FQe,[he.WGS84]:IS,[he.WGS84_ECEF]:WMe},[he.SPHERICAL_MARS_PCPF]:{[he.CGCS2000]:null,[he.GCSMARS2000]:CY,[he.GCSMOON2000]:null,[he.LON_LAT]:CY,[he.SPHERICAL_ECEF]:null,[he.SPHERICAL_MARS_PCPF]:Vs,[he.SPHERICAL_MOON_PCPF]:null,[he.UNKNOWN]:null,[he.WEB_MERCATOR]:null,[he.PLATE_CARREE]:null,[he.WGS84]:null,[he.WGS84_ECEF]:null},[he.SPHERICAL_MOON_PCPF]:{[he.CGCS2000]:null,[he.GCSMARS2000]:null,[he.GCSMOON2000]:EY,[he.LON_LAT]:EY,[he.SPHERICAL_ECEF]:null,[he.SPHERICAL_MARS_PCPF]:null,[he.SPHERICAL_MOON_PCPF]:Vs,[he.UNKNOWN]:null,[he.WEB_MERCATOR]:null,[he.PLATE_CARREE]:null,[he.WGS84]:null,[he.WGS84_ECEF]:null},[he.UNKNOWN]:{[he.CGCS2000]:null,[he.GCSMARS2000]:null,[he.GCSMOON2000]:null,[he.LON_LAT]:null,[he.SPHERICAL_ECEF]:null,[he.SPHERICAL_MARS_PCPF]:null,[he.SPHERICAL_MOON_PCPF]:null,[he.UNKNOWN]:Vs,[he.WEB_MERCATOR]:null,[he.PLATE_CARREE]:null,[he.WGS84]:null,[he.WGS84_ECEF]:null},[he.LON_LAT]:{[he.CGCS2000]:Vs,[he.GCSMARS2000]:Vs,[he.GCSMOON2000]:Vs,[he.LON_LAT]:Vs,[he.SPHERICAL_ECEF]:SA,[he.SPHERICAL_MARS_PCPF]:SY,[he.SPHERICAL_MOON_PCPF]:TY,[he.UNKNOWN]:null,[he.WEB_MERCATOR]:$S,[he.PLATE_CARREE]:RS,[he.WGS84]:Vs,[he.WGS84_ECEF]:LS},[he.PLATE_CARREE]:{[he.CGCS2000]:TA,[he.GCSMARS2000]:null,[he.GCSMOON2000]:null,[he.LON_LAT]:TA,[he.SPHERICAL_ECEF]:kQe,[he.SPHERICAL_MARS_PCPF]:null,[he.SPHERICAL_MOON_PCPF]:null,[he.UNKNOWN]:null,[he.WEB_MERCATOR]:UQe,[he.PLATE_CARREE]:Vs,[he.WGS84]:TA,[he.WGS84_ECEF]:VQe}};function jb(t,e,i=xse()){return t==null||e==null?null:BQe(t,e,i).projector}function _Zt(t,e){switch(jb(t,e,jG)){case Vs:return"copy3";case SA:return"wgs84ToSphericalECEF";case $S:return"wgs84ToWebMercator";case RS:return"wgs84ToPlateCarree";case LS:return"wgs84ToWGS84ECEF";case xA:return"webMercatorToWGS84";case jMe:return"webMercatorToSphericalECEF";case GMe:return"webMercatorToWGS84ECEF";case HMe:return"webMercatorToPlateCarree";case DS:return"wgs84ECEFToWGS84";case ZMe:return"wgs84ECEFToSphericalECEF";case YMe:return"wgs84ECEFToWebMercator";case IS:return"sphericalECEFToWGS84";case qMe:return"sphericalECEFToWebMercator";case CY:return"sphericalMarsPCPFToMars2000";case EY:return"sphericalMoonPCPFToMoon2000";case WMe:return"sphericalECEFToWGS84ECEF";case SY:return"mars2000ToSphericalPCPF";case TY:return"moon2000ToSphericalPCPF";default:return null}}function Jz(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=cc(t,1)),PL(t)?e.spatialReferenceId=he.SPHERICAL_ECEF:C_(t)?e.spatialReferenceId=he.WGS84:am(t)?e.spatialReferenceId=he.WEB_MERCATOR:s2(t)?e.spatialReferenceId=he.PLATE_CARREE:t.wkt===rCe.wkt?e.spatialReferenceId=he.WGS84_ECEF:t.wkid===Du.CGCS2000?e.spatialReferenceId=he.CGCS2000:t.wkt===SG.wkt?e.spatialReferenceId=he.SPHERICAL_MARS_PCPF:t.wkt===EG.wkt?e.spatialReferenceId=he.SPHERICAL_MOON_PCPF:U2(t)?e.spatialReferenceId=he.GCSMARS2000:V2(t)?e.spatialReferenceId=he.GCSMOON2000:e.spatialReferenceId=he.UNKNOWN):he.UNKNOWN}function Vs(t,e,i,r){t!==i&&(i[r++]=t[e++],i[r++]=t[e++],i[r]=t[e])}function xA(t,e,i,r){i[r]=bP*(t[e]/NS),i[r+1]=bP*(XMe-2*Math.atan(Math.exp(-t[e+1]/NS))),i[r+2]=t[e+2]}function jMe(t,e,i,r){const s=t[e]/NS,n=XMe-2*Math.atan(Math.exp(-t[e+1]/NS)),o=NS+t[e+2],a=Math.cos(n)*o;i[r]=Math.cos(s)*a,i[r+1]=Math.sin(s)*a,i[r+2]=Math.sin(n)*o}function GMe(t,e,i,r){xA(t,e,i,r),LS(i,r,i,r)}function vse(t,e,i,r,s){const n=.4999999*GG,o=Ne(vP*t[e+1],-n,n),a=Math.sin(o);i[r++]=vP*t[e]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=t[e+2]}function $S(t,e,i,r){vse(t,e,i,r,ur)}function RS(t,e,i,r){i[r]=t[e]*vde,i[r+1]=t[e+1]*vde,i[r+2]=t[e+2]}function TA(t,e,i,r){i[r]=t[e]*bde,i[r+1]=t[e+1]*bde,i[r+2]=t[e+2]}function HMe(t,e,i,r){xA(t,e,i,r),RS(i,r,i,r)}function NQe(t,e,i,r){DS(t,e,i,r),RS(i,r,i,r)}function FQe(t,e,i,r){IS(t,e,i,r),RS(i,r,i,r)}function kQe(t,e,i,r){TA(t,e,i,r),SA(i,r,i,r)}function UQe(t,e,i,r){TA(t,e,i,r),$S(i,r,i,r)}function VQe(t,e,i,r){TA(t,e,i,r),LS(i,r,i,r)}function bse(t,e,i,r,s){const n=s+t[e+2],o=vP*t[e+1],a=vP*t[e],l=Math.cos(o)*n;i[r]=Math.cos(a)*l,i[r+1]=Math.sin(a)*l,i[r+2]=Math.sin(o)*n}function TY(t,e,i,r){bse(t,e,i,r,E_.radius)}function SY(t,e,i,r){bse(t,e,i,r,Qf.radius)}function SA(t,e,i,r){bse(t,e,i,r,ur.radius)}function wse(t,e,i,r,s){const n=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(n*n+o*o+a*a),c=lm(a/(l===0?1:l)),u=Math.atan2(o,n);i[r++]=bP*u,i[r++]=bP*c,i[r]=l-s}function EY(t,e,i,r){wse(t,e,i,r,E_.radius)}function CY(t,e,i,r){wse(t,e,i,r,Qf.radius)}function IS(t,e,i,r){wse(t,e,i,r,ur.radius)}function qMe(t,e,i,r){IS(t,e,i,r),$S(i,r,i,r)}function WMe(t,e,i,r){IS(t,e,i,r),LS(i,r,i,r)}function zQe(t,e,i,r,s){const n=vP*t[e],o=vP*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),u=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);i[r++]=(u+a)*c*Math.cos(n),i[r++]=(u+a)*c*Math.sin(n),i[r++]=(u*(1-s.eccentricitySquared)+a)*l}function LS(t,e,i,r){zQe(t,e,i,r,ur)}function DS(t,e,i,r){const s=DQe,n=t[e],o=t[e+1],a=t[e+2];let l,c,u,d,f,m,g,y,v,b,w,x,T,E,M,O,D,U,k,H,V;l=Math.abs(a),c=n*n+o*o,u=Math.sqrt(c),d=c+a*a,f=Math.sqrt(d),H=Math.atan2(o,n),m=a*a/d,g=c/d,E=s.a2/f,M=s.a3-s.a4/f,g>.3?(y=l/f*(1+g*(s.a1+E+m*M)/f),k=Math.asin(y),b=y*y,v=Math.sqrt(1-b)):(v=u/f*(1-m*(s.a5-E-g*M)/f),k=Math.acos(v),b=1-v*v,y=Math.sqrt(b)),w=1-ur.eccentricitySquared*b,x=ur.radius/Math.sqrt(w),T=s.a6*x,E=u-x*v,M=l-T*y,D=v*E+y*M,O=v*M-y*E,U=O/(T/w+D),k+=U,V=D+O*U/2,a<0&&(k=-k),i[r++]=bP*H,i[r++]=bP*k,i[r]=V}function ZMe(t,e,i,r){DS(t,e,i,r),SA(i,r,i,r)}function YMe(t,e,i,r){DS(t,e,i,r),$S(i,r,i,r)}function BQe(t,e,i){if(t==null||e==null||i.source.spatialReference===t&&i.dest.spatialReference===e)return i;const r=Jz(t,i.source),s=Jz(e,i.dest);return r===he.UNKNOWN&&s===he.UNKNOWN?ms(t,e)?i.projector=Vs:i.projector=null:i.projector=yR[r][s],i}function xse(){return{source:{spatialReference:null,spatialReferenceId:he.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:he.UNKNOWN,metersPerUnit:1},projector:Vs}}const jQe={spatialReference:null,spatialReferenceId:he.UNKNOWN},GQe={spatialReference:null,spatialReferenceId:he.UNKNOWN},jG=xse(),vP=kt(1),bP=ja(1),GG=Math.PI,XMe=.5*GG,NS=ur.radius,vde=NS*GG/180,bde=180/(NS*GG);function gs(t,e,i,r,s,n,o=1){const a=jb(e,s,jG);if(a==null)return!1;if(a===Vs){if(t===r&&i===n)return!0;const c=i+3*o;for(let u=i,d=n;u<c;u++,d++)r[d]=t[u];return!0}const l=i+3*o;for(let c=i,u=n;c<l;c+=3,u+=3)a(t,c,r,u);return!0}const vZt=Object.freeze(Object.defineProperty({__proto__:null,projectBuffer:gs},Symbol.toStringTag,{value:"Module"}));function wde(t,e,i,r,s,n){return wF[0]=t,wF[1]=e,wF[2]=i,gs(wF,r,0,s,n,0,1)}const wF=C();let xF=0,FH=class MY{static fromGE(e){const i=new MY;return i._wkt=e.wkt,i._wkid=e.wkid,i._isInverse=e.isInverse,i}constructor(e){this.uid=xF++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=xF++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=xF++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=xF++}getInverse(){const e=new MY;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},Qz=class _R{static cacheKey(e,i){var r,s,n,o,a,l;return[((r=e.wkid)==null?void 0:r.toString())??"-1",((s=e.wkt)==null?void 0:s.toString())??"",((n=e.wkt2)==null?void 0:n.toString())??"",((o=i.wkid)==null?void 0:o.toString())??"-1",((a=i.wkt)==null?void 0:a.toString())??"",((l=i.wkt2)==null?void 0:l.toString())??""].join()}static fromGE(e){const i=new _R;let r="";for(const s of e.steps){const n=FH.fromGE(s);i.steps.push(n),r+=n.uid.toString()+","}return i._cachedProjection={},i._gtlistentry=null,i._chain=r,i}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e==null?void 0:e.steps)for(const i of e.steps)i instanceof FH?this.steps.push(i):this.steps.push(new FH({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}getInverse(){const e=new _R;e.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];e.steps.push(r.getInverse())}return e}getGTListEntry(){let e="";for(const i of this.steps)e+=i.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,i,r){this._cachedProjection[_R.cacheKey(e,i)]=r}getCachedGeTransformation(e,i){let r="";for(const n of this.steps)r+=n.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=r);const s=this._cachedProjection[_R.cacheKey(e,i)];return s===void 0?null:s}};function JMe(t,e,i){if(e==null||i==null||i.vcsWkid||ms(e,i)||kb(e)||kb(i))return null;const r=M_(e)/M_(i);if(r===1)return null;switch(t){case"point":case"esriGeometryPoint":return s=>HQe(s,r);case"polyline":case"esriGeometryPolyline":return s=>WQe(s,r);case"polygon":case"esriGeometryPolygon":return s=>qQe(s,r);case"multipoint":case"esriGeometryMultipoint":return s=>ZQe(s,r);case"extent":case"esriGeometryEnvelope":return s=>YQe(s,r);default:return null}}function HQe(t,e){(t==null?void 0:t.z)!=null&&(t.z*=e)}function qQe(t,e){if(t)for(const i of t.rings)for(const r of i)r.length>2&&(r[2]*=e)}function WQe(t,e){if(t)for(const i of t.paths)for(const r of i)r.length>2&&(r[2]*=e)}function ZQe(t,e){if(t)for(const i of t.points)i.length>2&&(i[2]*=e)}function YQe(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let Kf=null,Gb=null,E3=null,Hk={};const Tse=new _O;function wO(){return!!Kf&&ZEe()}function QMe(){return!!wO()||(Ft(Tse),wP(),!1)}function SC(t,e){return!t||!e||Kc(t,e)||QMe()}function KMe(t,e){return!Kc(t,e)&&!wO()}function wP(t){return E3==null&&(E3=Promise.all([YEe(),oe(()=>import("./geometryEngineBase-CCMH6bZ-.js"),[]).then(e=>e.g),oe(()=>import("./hydrated-qM2oOR9l.js"),[])])),E3.then(([,e,{hydratedAdapter:i}])=>{Dt(t),Gb=i,Kf=e.default,Kf._enableProjection(sYe),Tse.notify()})}function V_(t,e,i=null,r=null){return Array.isArray(t)?t.length===0?[]:AY(Gb,t,t[0].spatialReference,e,i,r):AY(Gb,[t],t.spatialReference,e,i,r)[0]}function AY(t,e,i,r,s=null,n=null){if(i==null||r==null)return e;if(Kc(i,r,s))return e.map(o=>C3(o,i,r));if(s==null&&PL(i))return e.map(o=>C3(o,i,Ye.WGS84)).map(o=>Hb(o,r));if(s==null&&PL(r))return e.map(o=>Hb(o,Ye.WGS84)).map(o=>C3(o,Ye.WGS84,r));if(s==null){const o=Qz.cacheKey(i,r);Hk[o]!==void 0?s=Hk[o]:((s=iAe(i,r,void 0))==null&&(s=new Qz),Hk[o]=s)}if(Kf==null||t==null)throw new HG;return n!=null?Kf._project(t,e,i,r,s,n):Kf._project(t,e,i,r,s)}function eAe(t,e){const i=tAe([t],e);return i.pending!=null?{pending:i.pending,geometry:null}:i.geometries!=null?{pending:null,geometry:i.geometries[0]}:{pending:null,geometry:null}}function tAe(t,e){if(!wO()){for(const i of t)if(i!=null&&!ms(i.spatialReference,e)&&zf(i.spatialReference)&&zf(e)&&!Kc(i.spatialReference,e))return Ft(Tse),{pending:wP(),geometries:null}}return{pending:null,geometries:t.map(i=>i==null?null:ms(i.spatialReference,e)?i:zf(i.spatialReference)&&zf(e)?Hb(i,e):null)}}function iAe(t,e,i=null){if(t==null||e==null)return null;if(Kf==null||Gb==null)throw new HG;const r=Kf._getTransformation(Gb,t,e,i,i==null?void 0:i.spatialReference);return r!==null?Qz.fromGE(r):null}function XQe(t,e,i=null){if(Kf==null||Gb==null)throw new HG;const r=Kf._getTransformationBySuitability(Gb,t,e,i,i==null?void 0:i.spatialReference);if(r!==null){const s=[];for(const n of r)s.push(Qz.fromGE(n));return s}return[]}let HG=class extends B{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}};function JQe(){Kf=null,Gb=null,E3=null,Hk={}}const QQe={get loadPromise(){return E3}};function Hb(t,e){try{const i=V_(t,e);if(i==null)return null;"xmin"in t&&"xmin"in i&&(i.zmin=t.zmin,i.zmax=t.zmax);const r=JMe(i.type,t.spatialReference,e);return r!=null&&r(i),i}catch(i){if(!(i instanceof HG))throw i;return null}}async function qb(t,e,i){const r=t.spatialReference;return r!=null&&e!=null&&await xO(r,e,null,i),Hb(t,e)}function Kc(t,e,i){return!i&&(!!ms(t,e)||zf(t)&&zf(e)&&!!jb(t,e,jG))}function KQe(t,e){if(ms(t,e))return!0;if(!zf(t)||!zf(e))return!1;const i=C_(t)||am(t)||oP(t),r=C_(e)||am(e)||oP(e);return i&&r}async function xO(t,e,i,r){if(wO())return Zue(r);if(Array.isArray(t)){for(const{source:s,dest:n,geographicTransformation:o}of t)if(s&&n&&!Kc(s,n,o))return wP(r)}else if(t&&e&&!Kc(t,e,i))return wP(r);return Zue(r)}function C3(t,e,i){return t?"x"in t?sAe(t,e,new wt,i,0):"xmin"in t?lAe(t,e,new dr,i,0):"rings"in t?aAe(t,e,new cm,i,0):"paths"in t?oAe(t,e,new Bf,i,0):"points"in t?nAe(t,e,new vO,i,0):null:null}function rAe(t,e,i=e.spatialReference,r=0){return i!=null&&t.spatialReference!=null&&sAe(t,t.spatialReference,e,i,r)!=null}function sAe(t,e,i,r,s){Zl[0]=t.x,Zl[1]=t.y;const n=t.z;return Zl[2]=n!==void 0?n:s,gs(Zl,e,0,Zl,r,0,1)?(i.x=Zl[0],i.y=Zl[1],i.spatialReference=r,n!==void 0||kb(r)?(i.z=Zl[2],i.hasZ=!0):(i.z=void 0,i.hasZ=!1),t.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=t.m,i.hasM=!0),i):null}function eKe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&nAe(t,t.spatialReference,e,i,r)!=null}function nAe(t,e,i,r,s){const{points:n,hasZ:o,hasM:a}=t,l=[],c=n.length,u=[];for(const f of n)u.push(f[0],f[1],o?f[2]:s);if(!gs(u,e,0,u,r,0,c))return null;const d=o||kb(r);for(let f=0;f<c;++f){const m=3*f,g=u[m],y=u[m+1];d&&a?l.push([g,y,u[m+2],n[f][3]]):d?l.push([g,y,u[m+2]]):a?l.push([g,y,n[f][2]]):l.push([g,y])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function tKe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&oAe(t,t.spatialReference,e,i,r)!=null}function oAe(t,e,i,r,s){const{paths:n,hasZ:o,hasM:a}=t,l=[];if(!cAe(n,o??!1,a??!1,e,l,r,s))return null;const c=o||kb(r);return i.paths=l,i.spatialReference=r,i.hasZ=c,i.hasM=a,i}function iKe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&aAe(t,t.spatialReference,e,i,r)!=null}function aAe(t,e,i,r,s){const{rings:n,hasZ:o,hasM:a}=t,l=[];if(!cAe(n,o??!1,a??!1,e,l,r,s))return null;const c=o||kb(r);return i.rings=l,i.spatialReference=r,i.hasZ=c,i.hasM=a,i}function rKe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&lAe(t,t.spatialReference,e,i,r)!=null}function lAe(t,e,i,r,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:u}=t,d=c?t.zmin:s;if(!wde(n,o,d,e,Zl,r))return null;const f=c||kb(r);i.xmin=Zl[0],i.ymin=Zl[1],f&&(i.zmin=Zl[2]);const m=c?t.zmax:s;return wde(a,l,m,e,Zl,r)?(i.xmax=Zl[0],i.ymax=Zl[1],f&&(i.zmax=Zl[2]),u&&(i.mmin=t.mmin,i.mmax=t.mmax),i.spatialReference=r,i):null}function cAe(t,e,i,r,s,n,o=0){const a=new Array;for(const u of t)for(const d of u)a.push(d[0],d[1],e?d[2]:o);if(!gs(a,r,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;const c=e||kb(n);for(const u of t){const d=new Array;for(const f of u)c&&i?d.push([a[l++],a[l++],a[l++],f[3]]):c?d.push([a[l++],a[l++],a[l++]]):i?(d.push([a[l++],a[l++],f[2]]),l++):(d.push([a[l++],a[l++]]),l++);s.push(d)}return!0}const Zl=C(),wZt=Object.freeze(Object.defineProperty({__proto__:null,canProjectWithoutEngine:Kc,getTransformation:iAe,getTransformations:XQe,initializeProjection:xO,isEqualBaseGCS:KQe,isLoaded:wO,isLoadedOrLoad:QMe,isLoadedOrLoadFor:SC,load:wP,project:V_,projectExtent:rKe,projectMany:AY,projectMultipoint:eKe,projectOrLoad:eAe,projectOrLoadMany:tAe,projectPoint:rAe,projectPolygon:iKe,projectPolyline:tKe,projectWithZConversion:qb,projectWithoutEngine:C3,requiresLoad:KMe,test:QQe,tryProjectWithZConversion:Hb,unload:JQe},Symbol.toStringTag,{value:"Module"})),uAe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",knowledgegraphserver:"KnowledgeGraphServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer",videoserver:"VideoServer"},hAe=Object.values(uAe),dAe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${hAe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),sKe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^/\\n]+)\\/(${hAe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),nKe=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function xZt(t){return dAe.test(t)}function TO(t){if(t==null)return null;const e=gn(t),i=(e==null?void 0:e.path.match(dAe))||(e==null?void 0:e.path.match(sKe));if(!i)return null;const[,r,s,n,o]=i,a=s.indexOf("/");return{title:Sse(a!==-1?s.slice(a+1):s),serverType:uAe[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:r}}}function oKe(t){const e=gn(t).path.match(nKe);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function Sse(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function aKe(t,e){const i=[];if(t){const r=TO(t);r!=null&&r.title&&i.push(r.title)}if(e){const r=Sse(e);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function pAe(t){let e=cp(t,!0);return!!e&&(e=e.toLowerCase(),e.endsWith(".arcgis.com")&&(e.startsWith("services")||e.startsWith("tiles")||e.startsWith("features")))}function lKe(t,e){return t&&IEe(DEe(t,e))}function cKe(t){let{url:e}=t;if(!e)return{url:e};e=DEe(e,t.logger);const i=gn(e),r=TO(i.path);let s;if(r!=null)r.sublayer!=null&&t.layer.layerId==null&&(s=r.sublayer),e=r.url.path;else if(t.nonStandardUrlAllowed){const n=oKe(i.path);n!=null&&(e=n.serviceUrl,s=n.sublayerId)}return{url:IEe(e),layerId:s}}function uKe(t,e,i,r,s){Vb(e,r,"url",s),r.url&&t.layerId!=null&&(r.url=Jh(r.url,i,t.layerId.toString()))}function TZt(t){if(!t)return!1;const e=t.toLowerCase(),i=e.includes("/services/"),r=e.includes("/mapserver/wmsserver"),s=e.includes("/imageserver/wmsserver"),n=e.includes("/wmsserver");return i&&(r||s||n)}function hKe(t,e){if(!t)return null;if(!PY(t))return new B("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:t});const i=t.heightUnit,r=gw.deriveUnitFromSR(t,e).heightUnit;return i!==r?new B("webscene:incompatible-height-unit",`The vertical units of the scene (${i}) must match the horizontal units of the scene (${r})`,{verticalUnit:i,horizontalUnit:r}):null}function SZt(t,e,i){const r=fAe(t),s=e,n=dKe(r,s,i);if(r){const o=gw.deriveUnitFromSR(r,t.spatialReference).heightUnit;if(!i&&o!==r.heightUnit){const a=new B("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new B("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:a})}}if(!pKe(t)||n===Tu.Unsupported)return new B("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(n){case Tu.Units:{const o=(r==null?void 0:r.heightUnit)||"unknown",a=(s==null?void 0:s.heightUnit)||"unknown",l=new B("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new B("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case Tu.HeightModel:{const o=(r==null?void 0:r.heightModel)||"unknown",a=(s==null?void 0:s.heightModel)||"unknown",l=new B("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new B("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case Tu.CRS:{const o=(r==null?void 0:r.vertCRS)||"unknown",a=(s==null?void 0:s.vertCRS)||"unknown",l=new B("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new B("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}}return null}function dKe(t,e,i){if(!PY(t)||!PY(e))return Tu.Unsupported;if(t==null||e==null)return Tu.Ok;if(!i&&t.heightUnit!==e.heightUnit)return Tu.Units;if(t.heightModel!==e.heightModel)return Tu.HeightModel;switch(t.heightModel){case"gravity-related-height":return Tu.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?Tu.Ok:Tu.CRS;default:return Tu.Unsupported}}var Tu;function PY(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function pKe(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!yAe(t)}function fAe(t){var r;if(t.type==="integrated-mesh-3dtiles")return null;const e=t.url?TO(t.url):void 0;return!(((r=t.spatialReference)==null?void 0:r.vcsWkid)==null&&e!=null&&e.serverType==="ImageServer")&&mAe(t)&&t.heightModelInfo?t.heightModelInfo:yAe(t)?gw.deriveUnitFromSR(mKe,t.spatialReference):null}function mAe(t){return"heightModelInfo"in t}function gAe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function yAe(t){return gAe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):_Ae(t)}function fKe(t){return t.layers!=null||_Ae(t)||gAe(t)||mAe(t)}function _Ae(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(Tu||(Tu={}));const mKe=new gw({heightModel:"gravity-related-height"});function EZt(t,e){return{...vAe(t,e),readResourcePaths:[]}}function xde(t,e,i){const r=gn(t.itemUrl);return{...vAe(t,e),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:r?{rootPath:r.path,writtenUrls:[]}:null,resources:i?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function vAe(t,e){return{origin:e,url:gn(t.itemUrl),portal:t.portal||Kn.getDefault(),portalItem:t}}async function gKe(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return $M(t);const i=Ye.WGS84;return await xO(e,i),V_(t,i)}function yKe(t,e){if(!bAe(t,e)){const i=t.typeKeywords;i?i.push(e):t.typeKeywords=[e]}}function bAe(t,e){var i;return!!((i=t.typeKeywords)!=null&&i.includes(e))}function CZt(t){return bAe(t,OY.HOSTED_SERVICE)}function _Ke(t,e){const i=t.typeKeywords;if(i){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}function Tde(t,e,i){i?yKe(t,e):_Ke(t,e)}async function MZt(t){const e=t.clone().normalize();let i;if(e.length>1)for(const r of e)i?r.width>i.width&&(i=r):i=r;else i=e[0];return gKe(i)}const OY={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service",LOCAL_SCENE:"ViewingMode-Local",TILED_IMAGERY:"Tiled Imagery",GROUP_LAYER_MAP:"Map"};function Sde(t){var l;const{portal:e,isOrgItem:i,itemControl:r}=t,s=(l=e.user)==null?void 0:l.privileges;let n=!s||s.includes("features:user:edit"),o=!!i&&!!(s!=null&&s.includes("features:user:fullEdit"));const a=r==="update"||r==="admin";return a?o=n=!0:o&&(n=!0),{features:{edit:n,fullEdit:o},content:{updateItem:a}}}let Jv=class extends Se{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};h([p({type:String,json:{write:!0}})],Jv.prototype,"facilityIdField",void 0),h([p({type:String,json:{write:!0}})],Jv.prototype,"layerId",void 0),h([p({type:String,json:{write:!0}})],Jv.prototype,"nameField",void 0),h([p({type:String,json:{write:!0}})],Jv.prototype,"siteIdField",void 0),h([p({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Jv.prototype,"sublayerId",void 0),Jv=h([I("esri.layers.support.FacilityLayerInfo")],Jv);const vKe=Jv;let Xp=class extends Se{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};h([p({type:String,json:{write:!0}})],Xp.prototype,"facilityIdField",void 0),h([p({type:String,json:{write:!0}})],Xp.prototype,"layerId",void 0),h([p({type:String,json:{write:!0}})],Xp.prototype,"levelIdField",void 0),h([p({type:String,json:{write:!0}})],Xp.prototype,"levelNumberField",void 0),h([p({type:String,json:{write:!0}})],Xp.prototype,"longNameField",void 0),h([p({type:String,json:{write:!0}})],Xp.prototype,"shortNameField",void 0),h([p({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Xp.prototype,"sublayerId",void 0),h([p({type:String,json:{write:!0}})],Xp.prototype,"verticalOrderField",void 0),Xp=h([I("esri.layers.support.LevelLayerInfo")],Xp);const bKe=Xp;let Dx=class extends Se{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};h([p({type:String,json:{write:!0}})],Dx.prototype,"layerId",void 0),h([p({type:String,json:{write:!0}})],Dx.prototype,"nameField",void 0),h([p({type:String,json:{write:!0}})],Dx.prototype,"siteIdField",void 0),h([p({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Dx.prototype,"sublayerId",void 0),Dx=h([I("esri.layers.support.SiteLayerInfo")],Dx);const wKe=Dx;let EC=class extends Se{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};h([p({type:bKe,json:{write:!0}})],EC.prototype,"levelLayer",void 0),h([p({type:vKe,json:{write:!0}})],EC.prototype,"facilityLayer",void 0),h([p({type:wKe,json:{write:!0}})],EC.prototype,"siteLayer",void 0),EC=h([I("esri.support.MapFloorInfo")],EC);const xKe=EC,TKe=Symbol("WebScene"),SKe="webscene:failed-to-copy-embedded-resources",EKe="webscene:schema-validation";function CKe(){return new B(SKe,"Copying of embedded resources is currently not supported")}function MKe(t){return new B(EKe,"Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:t})}var Je;function Ede(t){return t==="global"?Je.Global:Je.Local}function kH(t){return t===Je.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(Je||(Je={}));function VL(t,e){return t!=null&&(e==null||(e===Je.Local?!t.isGeographic||t.isWGS84||t.wkid===Du.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===Du.CGCS2000||t.wkid===Du.GCSMARS2000||t.wkid===Du.GCSMARS2000_SPHERE||t.wkid===Du.GCSMOON2000))}var jg;(function(t){t[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"})(jg||(jg={}));var $Y;let Jm=$Y=class extends Se{constructor(t){super(t),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null}clone(){return new $Y(re({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};h([p({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],Jm.prototype,"enabled",void 0),h([p({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],Jm.prototype,"longNames",void 0),h([p({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],Jm.prototype,"minimized",void 0),h([p({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],Jm.prototype,"pinnedLevels",void 0),h([p({type:String,json:{read:{source:"site"},write:{target:"site"}}})],Jm.prototype,"site",void 0),h([p({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],Jm.prototype,"facility",void 0),h([p({type:String,json:{read:{source:"level"},write:{target:"level"}}})],Jm.prototype,"level",void 0),Jm=$Y=h([I("esri.webdoc.widgets.FloorFilter")],Jm);const AKe=Jm;var RY;const TF=new Qi({slider:"slider",picker:"picker"});let CC=RY=class extends Se{constructor(t){super(t),this.interactionMode=null,this.numStops=null,this.stopInterval=null}clone(){return new RY({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};h([p({type:TF.apiValues,nonNullable:!0,json:{type:TF.jsonValues,default:null,read:{reader:TF.read},write:{isRequired:!0,writer:TF.write}}})],CC.prototype,"interactionMode",void 0),h([p({type:Ji,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const t=this.stopInterval!=null;return{enabled:!t,isRequired:!t}}}}})],CC.prototype,"numStops",void 0),h([p({type:Number,json:{write:{overridePolicy(){return{isRequired:this.numStops==null}}}}})],CC.prototype,"stopInterval",void 0),CC=RY=h([I("esri.webdoc.widgets.Range")],CC);const PKe=CC,Ese=lc()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let vR=class extends ts(Se){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return DMe(this.value,this.unit,"milliseconds")}};h([$t(Ese,{nonNullable:!0})],vR.prototype,"unit",void 0),h([p({type:Number,json:{write:!0},nonNullable:!0})],vR.prototype,"value",void 0),vR=h([I("esri.TimeInterval")],vR);const xP=vR;var IY;let ea=IY=class extends Se{constructor(t){super(t),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null}readCurrentTimeExtent(t){if(!t)return;const e=t[0]!=null?new Date(t[0]):null,i=t[1]!=null?new Date(t[1]):null;return new za({start:e,end:i})}writeCurrentTimeExtent(t,e,i){t&&ua(i,[t.start!=null?t.start.getTime():null,t.end!=null?t.end.getTime():null],e)}readFullTimeExtent(t,e){const i=e.properties;if(!i)return;const r=i.endTime!=null?new Date(i.endTime):null,s=i.startTime!=null?new Date(i.startTime):null;return new za({start:s,end:r})}writeFullTimeExtent(t,e){if(!t)return;const i=e.properties=e.properties||{},r=t.end,s=t.start;r&&(i.endTime=r!=null?r.getTime():null),s&&(i.startTime=s!=null?s.getTime():null)}readStopInterval(t,e,i){return t?xP.fromJSON({value:t.interval,unit:t.units},i):null}writeStopInterval(t,e,i,r){if(!t)return;const s=t.toJSON(r);ua("properties.timeStopInterval",{interval:s.value,units:s.unit},e)}readStops(t){return t!=null&&t.length?t.map(e=>new Date(e)):null}writeStops(t,e,i){t!=null&&t.length&&ua(i,t.map(r=>r.getTime()),e)}clone(){return new IY(re({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};h([p({type:za,json:{type:[[Ji,mO]],read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],ea.prototype,"currentTimeExtent",void 0),h([ze("currentTimeExtent")],ea.prototype,"readCurrentTimeExtent",null),h([Ze("currentTimeExtent")],ea.prototype,"writeCurrentTimeExtent",null),h([p({type:za,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],ea.prototype,"fullTimeExtent",void 0),h([ze("fullTimeExtent")],ea.prototype,"readFullTimeExtent",null),h([Ze("fullTimeExtent")],ea.prototype,"writeFullTimeExtent",null),h([p({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],ea.prototype,"loop",void 0),h([p({type:Ji,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){var r;const t=!!this.stopInterval,e=!!((r=this.stops)!=null&&r.length),i=!(t||e);return{enabled:i,isRequired:i}}}}})],ea.prototype,"numStops",void 0),h([p({type:[1,2],nonNullable:!0,json:{type:Ji,read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],ea.prototype,"numThumbs",void 0),h([p({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],ea.prototype,"stopDelay",void 0),h([p({type:xP,json:{read:{source:"properties.timeStopInterval"},write:{target:{"properties.timeStopInterval.interval":{type:Number},"properties.timeStopInterval.units":{type:Ese.jsonValues.filter(t=>t!=="esriTimeUnitsUnknown")}},overridePolicy(){var i;const t=this.numStops!=null,e=!!((i=this.stops)!=null&&i.length);return{enabled:!e,isRequired:!(t||e)}}}}})],ea.prototype,"stopInterval",void 0),h([ze("stopInterval")],ea.prototype,"readStopInterval",null),h([Ze("stopInterval")],ea.prototype,"writeStopInterval",null),h([p({type:[Date],json:{type:[Ji],read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return{isRequired:this.numStops==null&&!this.stopInterval}}}}})],ea.prototype,"stops",void 0),h([ze("stops")],ea.prototype,"readStops",null),h([Ze("stops")],ea.prototype,"writeStops",null),ea=IY=h([I("esri.webdoc.widgets.TimeSlider")],ea);const OKe=ea;var LY;let MC=LY=class extends Se{constructor(t){super(t),this.range=null,this.timeSlider=null,this.floorFilter=null}clone(){return new LY(re({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};h([p({type:PKe,json:{write:!0}})],MC.prototype,"range",void 0),h([p({type:OKe,json:{write:!0}})],MC.prototype,"timeSlider",void 0),h([p({type:AKe,json:{write:!0}})],MC.prototype,"floorFilter",void 0),MC=LY=h([I("esri.webdoc.Widgets")],MC);const $Ke=MC,RKe="randomUUID"in crypto;function qG(){if(RKe)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=i=>t[i].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function IZt(){return`{${qG().toUpperCase()}}`}function IKe(){return`{${qG()}}`}async function LKe(t,e={},i){await t.load(i);const r=Jh(t.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:o="asc",sortField:a="resource"}=e,l={query:{start:s,num:n,sortOrder:o,sortField:a,token:t.apiKey},signal:i==null?void 0:i.signal},c=await t.portal.request(r,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:u,size:d,resource:f})=>({created:new Date(u),size:d,resource:t.resourceFromPath(f)}))}}async function DKe(t,e,i,r){const s=new Map;for(const{resource:o,content:a,compress:l,access:c}of e){if(!o.hasPath())throw new B(`portal-item-resource-${i}:invalid-path`,"Resource does not have a valid path");const[u,d]=wAe(o.path),f=`${u}/${l??""}/${c??""}`;s.has(f)||s.set(f,{prefix:u,compress:l,access:c,files:[]}),s.get(f).files.push({fileName:d,content:a})}await t.load(r);const n=Jh(t.userItemUrl,i==="add"?"addResources":"updateResources");for(const{prefix:o,compress:a,access:l,files:c}of s.values())for(let d=0;d<c.length;d+=25){const f=c.slice(d,d+25),m=new FormData;o&&o!=="."&&m.append("resourcesPrefix",o),a&&m.append("compress","true"),l&&m.append("access",l);let g=0;for(const{fileName:y,content:v}of f)m.append("file"+ ++g,v,y);m.append("f","json"),await t.portal.request(n,{method:"post",body:m,signal:r==null?void 0:r.signal})}}async function NKe(t,e,i){if(!e.hasPath())throw new B("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await t.load(i);const r=Jh(t.userItemUrl,"removeResources");await t.portal.request(r,{method:"post",query:{resource:e.path},signal:i==null?void 0:i.signal}),e.portalItem=null}async function FKe(t,e){await t.load(e);const i=Jh(t.userItemUrl,"removeResources");return t.portal.request(i,{method:"post",query:{deleteAll:!0},signal:e==null?void 0:e.signal})}function wAe(t){const e=t.lastIndexOf("/");return e===-1?[".",t]:[t.slice(0,e),t.slice(e+1)]}function Cse(t){const[e,i]=kKe(t),[r,s]=wAe(e);return[r,s,i]}function kKe(t){const e=wZe(t);return e==null?[t,""]:[t.slice(0,t.length-e.length-1),`.${e}`]}async function qk(t){return t.type==="blob"?t.blob:t.type==="json"?new Blob([t.jsonString],{type:"application/json"}):(await fr(t.url,{responseType:"blob"})).data}function UKe(t,e){if(!t.hasPath())return null;const[i,,r]=Cse(t.path);return t.portalItem.resourceFromPath(Jh(i,e+r))}function xAe(t,e){if(!t.hasPath())return null;const[i,,r]=Cse(t.path);return t.portalItem.resourceFromPath(Jh(i,e+r))}const RM=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResources:DKe,contentToBlob:qk,fetchResources:LKe,getSiblingOfSameType:UKe,getSiblingOfSameTypeI:xAe,removeAllResources:FKe,removeResource:NKe,splitPrefixFileNameAndExtension:Cse},Symbol.toStringTag,{value:"Module"}));async function VKe(t,e,i){const r=await TAe(t,e,i);await SAe(r,e,i)}async function zKe(t,e,i,r,s){const n=await TAe(i,r,s);await t.update({data:e}),await SAe(n,r,s)}async function TAe(t,e,i){if(!(e!=null&&e.resources))return;const r=e.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=e.portalItem;const s=new Set(e.resources.toKeep.map(d=>d.resource.path)),n=new Set,o=[];s.forEach(d=>{r.delete(d),t.paths.push(d)});const a=[],l=[],c=[];for(const d of e.resources.toUpdate)if(r.delete(d.resource.path),s.has(d.resource.path)||n.has(d.resource.path)){const{resource:f,content:m,finish:g}=d,y=xAe(f,qG());t.paths.push(y.path),a.push({resource:y,content:await qk(m),compress:d.compress}),g&&c.push(()=>g(y))}else{t.paths.push(d.resource.path),l.push({resource:d.resource,content:await qk(d.content),compress:d.compress});const f=d.finish;f&&c.push(()=>f(d.resource)),n.add(d.resource.path)}for(const d of e.resources.toAdd)if(t.paths.push(d.resource.path),r.has(d.resource.path))r.delete(d.resource.path);else{a.push({resource:d.resource,content:await qk(d.content),compress:d.compress});const f=d.finish;f&&c.push(()=>f(d.resource))}if(a.length||l.length){const{addOrUpdateResources:d}=await oe(()=>Promise.resolve().then(()=>RM),void 0);await d(e.portalItem,a,"add",i),await d(e.portalItem,l,"update",i)}if(c.forEach(d=>d()),o.length===0)return r;const u=await J9e(o);if(Dt(i),u.length>0)throw new B("save:resources","Failed to save one or more resources",{errors:u});return r}async function SAe(t,e,i){if(!t||!e.portalItem)return;const r=[];for(const s of t){const n=e.portalItem.resourceFromPath(s);r.push(n.portalItem.removeResource(n,i))}await nm(r)}function Cde(t){if(nr.apiKey&&Vre(t.portal.url))throw new B("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${t.portal.url} when using an api key`)}async function LZt(t){const e=[];for(const i of t.allLayers)if("beforeSave"in i&&typeof i.beforeSave=="function"){const r=i.beforeSave();r&&e.push(r)}await Promise.allSettled(e)}const BKe=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function jKe(t,e,i){let r=(t.messages??[]).filter(({type:s})=>s==="error").map(({name:s,message:n,details:o})=>new B(s,n,o));if(t.blockedRelativeUrls&&(r=r.concat(t.blockedRelativeUrls.map(s=>new B("url:unsupported",`Relative url '${s}' is not supported`)))),i){const{ignoreUnsupported:s,supplementalUnsupportedErrors:n=[],requiredPropertyChecksDisabled:o}=i;s&&(r=r.filter(({name:a})=>!(BKe.has(a)||n.includes(a)))),o&&(r=r.filter(a=>a.name!=="web-document-write:property-required"))}if(r.length>0)throw new B(e.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:r})}const GKe={width:600,height:400},SF=1.5;function HKe(t,e){e=e||GKe;let{width:i,height:r}=e;const s=i/r;return s<SF?r=i/SF:s>SF&&(i=r*SF),i>t.width&&(r*=t.width/i,i=t.width),r>t.height&&(i*=t.height/r,r=t.height),{width:Math.round(i),height:Math.round(r)}}function Mde(t){return{enabled:!!(t!=null&&t.length)}}const Mse=new Qi({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var DY;let AC=DY=class extends Se{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new DY({exactMatch:this.exactMatch,type:this.type,name:this.name})}};h([p({type:Boolean,json:{write:!0}})],AC.prototype,"exactMatch",void 0),h([p({type:String,json:{write:!0}})],AC.prototype,"name",void 0),h([$t(Mse)],AC.prototype,"type",void 0),AC=DY=h([I("esri.webdoc.applicationProperties.SearchLayerField")],AC);const qKe=AC;var NY;let PC=NY=class extends Se{constructor(t){super(t),this.field=null,this.id=null,this.subLayer=null}clone(){return new NY(re({field:this.field,id:this.id,subLayer:this.subLayer}))}};h([p({type:qKe,json:{write:{isRequired:!0}}})],PC.prototype,"field",void 0),h([p({type:String,json:{write:{isRequired:!0}}})],PC.prototype,"id",void 0),h([p({type:Ji,json:{write:!0}})],PC.prototype,"subLayer",void 0),PC=NY=h([I("esri.webdoc.applicationProperties.SearchLayer")],PC);const WKe=PC;var FY;let OC=FY=class extends Se{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new FY({exactMatch:this.exactMatch,type:this.type,name:this.name})}};h([p({type:Boolean,json:{write:!0}})],OC.prototype,"exactMatch",void 0),h([p({type:String,json:{write:!0}})],OC.prototype,"name",void 0),h([$t(Mse)],OC.prototype,"type",void 0),OC=FY=h([I("esri.webdoc.applicationProperties.SearchTableField")],OC);const ZKe=OC;var kY;let bR=kY=class extends Se{constructor(t){super(t),this.field=null,this.id=null}clone(){return new kY(re({field:this.field,id:this.id}))}};h([p({type:ZKe,json:{write:{isRequired:!0}}})],bR.prototype,"field",void 0),h([p({type:String,json:{write:{isRequired:!0}}})],bR.prototype,"id",void 0),bR=kY=h([I("esri.webdoc.applicationProperties.SearchTable")],bR);const YKe=bR;var UY;const EAe=Ke.ofType(WKe),CAe=Ke.ofType(YKe);let Qm=UY=class extends Se{constructor(t){super(t),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new EAe,this.tables=new CAe}readAddressSearchEnabled(t){return!t}writeAddressSearchEnabled(t,e,i){e[i]=!t}clone(){return new UY(re({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};h([p({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],Qm.prototype,"addressSearchEnabled",void 0),h([ze("addressSearchEnabled")],Qm.prototype,"readAddressSearchEnabled",null),h([Ze("addressSearchEnabled")],Qm.prototype,"writeAddressSearchEnabled",null),h([p({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],Qm.prototype,"enabled",void 0),h([p({type:String,json:{write:!0}})],Qm.prototype,"hintText",void 0),h([p({type:EAe,json:{write:{overridePolicy:Mde},origins:{"web-scene":{write:{isRequired:!0}}}}})],Qm.prototype,"layers",void 0),h([p({type:CAe,json:{read:!0,write:{overridePolicy:Mde}}})],Qm.prototype,"tables",void 0),Qm=UY=h([I("esri.webdoc.applicationProperties.Search")],Qm);const XKe=Qm;var VY;let Wk=VY=class extends Se{constructor(t){super(t),this.search=null}clone(){return new VY(re({search:this.search}))}};h([p({type:XKe,json:{write:!0}})],Wk.prototype,"search",void 0),Wk=VY=h([I("esri.webdoc.applicationProperties.Viewing")],Wk);const JKe=Wk;var zY;let Zk=zY=class extends Se{constructor(t){super(t),this.viewing=null}clone(){var t;return new zY({viewing:((t=this.viewing)==null?void 0:t.clone())??null})}};h([p({type:JKe,json:{write:!0}})],Zk.prototype,"viewing",void 0),Zk=zY=h([I("esri.webscene.ApplicationProperties")],Zk);const QKe=Zk;var BY;let wR=BY=class extends Se{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new BY({cloudCover:this.cloudCover})}};h([$t({sunny:"sunny"})],wR.prototype,"type",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],wR.prototype,"cloudCover",void 0),wR=BY=h([I("esri.views.3d.environment.SunnyWeather")],wR);const Kz=wR;var jY;let xR=jY=class extends Se{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new jY({cloudCover:this.cloudCover})}};h([$t({cloudy:"cloudy"})],xR.prototype,"type",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],xR.prototype,"cloudCover",void 0),xR=jY=h([I("esri.views.3d.environment.CloudyWeather")],xR);const KKe=xR;var GY;let TR=GY=class extends Se{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new GY({fogStrength:this.fogStrength})}};h([$t({foggy:"foggy"})],TR.prototype,"type",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],TR.prototype,"fogStrength",void 0),TR=GY=h([I("esri.views.3d.environment.FoggyWeather")],TR);const eet=TR;var HY;let $C=HY=class extends Se{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new HY({cloudCover:this.cloudCover,precipitation:this.precipitation})}};h([$t({rainy:"rainy"})],$C.prototype,"type",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],$C.prototype,"cloudCover",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],$C.prototype,"precipitation",void 0),$C=HY=h([I("esri.views.3d.environment.RainyWeather")],$C);const tet=$C;var qY;let Nx=qY=class extends Se{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new qY({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};h([$t({snowy:"snowy"})],Nx.prototype,"type",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Nx.prototype,"cloudCover",void 0),h([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Nx.prototype,"precipitation",void 0),h([p({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],Nx.prototype,"snowCover",void 0),Nx=qY=h([I("esri.views.3d.environment.SnowyWeather")],Nx);const iet=Nx,Ase={key:"type",base:Kz,typeMap:{sunny:Kz,cloudy:KKe,rainy:tet,snowy:iet,foggy:eet}},ret=Object.keys(Ase.typeMap);function set(t,e){return!!ret.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const X0=1e4,net=1e5;var WY;let wd=WY=class extends Se{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,i){e[i]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,i){t&&(e[i]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new WY(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};h([p({readOnly:!0,type:["sun"],json:{write:!0}})],wd.prototype,"type",void 0),h([p({type:Date,json:{type:Number,write:{target:"datetime"}}})],wd.prototype,"date",void 0),h([ze("date",["datetime"])],wd.prototype,"readDate",null),h([Ze("date")],wd.prototype,"writeDate",null),h([p({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],wd.prototype,"directShadowsEnabled",void 0),h([ze("directShadowsEnabled",["directShadows"])],wd.prototype,"readDirectShadowsEnabled",null),h([Ze("directShadowsEnabled")],wd.prototype,"writedirectShadowsEnabled",null),h([p({type:Number,json:{write:!0}})],wd.prototype,"displayUTCOffset",void 0),h([Ze("displayUTCOffset")],wd.prototype,"writeDisplayUTCOffset",null),wd=WY=h([I("esri.webscene.SunLighting")],wd);const f2=wd;var ZY;let SR=ZY=class extends Se{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new ZY(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};h([p({readOnly:!0,type:["virtual"],json:{write:!0}})],SR.prototype,"type",void 0),h([p({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],SR.prototype,"directShadowsEnabled",void 0),SR=ZY=h([I("esri.webscene.VirtualLighting")],SR);const JD=SR,MAe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:f2,virtual:JD}};let Yk=class extends Se{constructor(e){super(e)}clone(){throw new Error("Subclasses of Background should implement their own clone method.")}};h([p({readOnly:!0,json:{read:!1}})],Yk.prototype,"type",void 0),Yk=h([I("esri.webscene.background.Background")],Yk);const AAe=Yk;function oet(t,e){const i=e.transparency!=null?pP(e.transparency):1,r=e.color;return r&&Array.isArray(r)?new je([r[0]||0,r[1]||0,r[2]||0,i]):null}function aet(t,e){e.color=t.toJSON().slice(0,3);const i=ZD(t.a);i!==0&&(e.transparency=i)}const z_={type:je,json:{type:[Ji],default:null,read:{source:["color","transparency"],reader:oet},write:{target:{color:{type:[Ji]},transparency:{type:Ji}},writer:aet}}},vy={type:Number,cast:wr,json:{write:!0}};var YY;const cet={...z_,nonNullable:!0};let ER=YY=class extends AAe{constructor(t){super(t),this.type="color",this.color=new je([0,0,0,1])}clone(){return new YY(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};h([$t({color:"color"},{readOnly:!0})],ER.prototype,"type",void 0),h([p(cet)],ER.prototype,"color",void 0),ER=YY=h([I("esri.webscene.background.ColorBackground")],ER);const PAe=ER,Ade={base:AAe,key:"type",typeMap:{color:PAe}};function uet(t){return(e,i,r)=>{if(!e)return e;for(const s in t.typeMap)if(e.type===s){const n=new t.typeMap[s];return n.read(e,r),n}}}const het={types:Ade,json:{read:uet(Ade),write:{overridePolicy:(t,e,i)=>({enabled:!(i!=null&&i.isPresentation)})}}};var XY;const Pde=(t,e,i)=>({enabled:!(i!=null&&i.isPresentation)});let Qv=XY=class extends Se{constructor(t){super(t),this.lighting=new f2,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){set(t==null?void 0:t.type,ne.getLogger(this))&&this._set("weather",t)}clone(){return new XY(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?JD.prototype.clone.call(this.lighting):f2.prototype.clone.call(this.lighting),background:re(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};h([p({types:MAe,nonNullable:!0,json:{write:!0}})],Qv.prototype,"lighting",void 0),h([p(het)],Qv.prototype,"background",void 0),h([p({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Pde}}})],Qv.prototype,"atmosphereEnabled",void 0),h([p({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Pde}}})],Qv.prototype,"starsEnabled",void 0),h([p({types:Ase,nonNullable:!0,json:{write:!0},value:new Kz})],Qv.prototype,"weather",null),Qv=XY=h([I("esri.webscene.Environment")],Qv);const TP=Qv,OAe={type:za,json:{read:{source:"timeExtent",reader:t=>t?Array.isArray(t)?za.fromArray(t):za.fromJSON(t):null},write:{writer:(t,e,i,r)=>{t&&(t.isEmpty?r!=null&&r.messages&&r.messages.push(new B("invalid-timeExtent","TimeExtent cannot be empty")):e[i]=t.toArray())},target:{timeExtent:{type:[[Ji,mO]]}}}}};var JY;let Kv=JY=class extends Se{constructor(t){super(t),this.environment=new TP,this.spatialReference=null,this.viewpoint=null,this.timeExtent=null}set viewingMode(t){this._set("viewingMode",t)}clone(){var t,e,i;return new JY({environment:this.environment.clone(),spatialReference:((t=this.spatialReference)==null?void 0:t.clone())??null,viewingMode:this.viewingMode,viewpoint:((e=this.viewpoint)==null?void 0:e.clone())??null,timeExtent:((i=this.timeExtent)==null?void 0:i.clone())??null})}};h([p({type:TP,json:{write:{isRequired:!0}}})],Kv.prototype,"environment",void 0),h([p({type:Ye})],Kv.prototype,"spatialReference",void 0),h([p({type:["local","global"]})],Kv.prototype,"viewingMode",null),h([p({type:um,json:{write:{isRequired:!0}}})],Kv.prototype,"viewpoint",void 0),h([p(OAe)],Kv.prototype,"timeExtent",void 0),Kv=JY=h([I("esri.webscene.InitialViewProperties")],Kv);const eB=Kv;let det=class{constructor(e,i){this._observable=new _O,this._value=e,this._equalityFunction=i}get value(){return Ft(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function iy(t,e=pSe){return new det(t,e)}const pa=Symbol("Yield");let pet=class{constructor(){this._tasks=new Array,this._runningTasks=iy(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(this.length===0)return pa;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,i,r){return++this._runningTasks.value,new Promise((s,n)=>this._tasks.push(new Ode(s,n,e,i,r))).finally(()=>--this._runningTasks.value)}unshift(e,i,r){return++this._runningTasks.value,new Promise((s,n)=>this._tasks.unshift(new Ode(s,n,e,i,r))).finally(()=>--this._runningTasks.value)}_process(e){var r;if(this._tasks.length===0)return!1;const i=this._tasks.shift();try{const s=ha(i.signal);if(s&&!i.abortCallback)i.reject(Ui());else{const n=s?(r=i.abortCallback)==null?void 0:r.call(i,Ui()):i.callback(e);Zu(n)?n.then(i.resolve,i.reject):i.resolve(n)}}catch(s){i.reject(s)}return!0}cancelAll(){const e=Ui();for(const i of this._tasks)if(i.abortCallback){const r=i.abortCallback(e);i.resolve(r)}else i.reject(e);this._tasks.length=0}},Ode=class{constructor(e,i,r,s=void 0,n=void 0){this.resolve=e,this.reject=i,this.callback=r,this.signal=s,this.abortCallback=n}},CR=class extends Ue{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};h([p()],CR.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),h([p()],CR.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),CR=h([I("esri.views.support.debugFlags")],CR);const fet=new CR;var Ii;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(Ii||(Ii={}));function met(){return new tB.Scheduler}var It;(function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"})(It||(It={}));const Eg=0,$de=new Map([[It.RESOURCE_CONTROLLER_IMMEDIATE,Eg],[It.RESOURCE_CONTROLLER,4],[It.SLIDE,Eg],[It.STREAM_DATA_LOADER,Eg],[It.ELEVATION_QUERY,Eg],[It.TERRAIN_SURFACE,1],[It.SURFACE_GEOMETRY_UPDATES,1],[It.LOD_RENDERER,2],[It.GRAPHICS_CORE,2],[It.I3S_CONTROLLER,2],[It.POINT_CLOUD_LAYER,2],[It.FEATURE_TILE_FETCHER,2],[It.OVERLAY,4],[It.STAGE,4],[It.GRAPHICS_DECONFLICTOR,4],[It.FILTER_VISIBILITY,4],[It.SCALE_VISIBILITY,4],[It.FRUSTUM_VISIBILITY,4],[It.CLOUDS_GENERATOR,4],[It.POINT_OF_INTEREST_FREQUENT,6],[It.POINT_OF_INTEREST_INFREQUENT,30],[It.LABELER,8],[It.FEATURE_QUERY_ENGINE,8],[It.FEATURE_TILE_TREE,16],[It.FEATURE_TILE_TREE_ACTIVE,Eg],[It.ELEVATION_ALIGNMENT,12],[It.ELEVATION_ALIGNMENT_SCENE,14],[It.TEXT_TEXTURE_ATLAS,12],[It.TEXTURE_UNLOAD,12],[It.LINE_OF_SIGHT_TOOL,16],[It.LINE_OF_SIGHT_TOOL_INTERACTIVE,Eg],[It.SNAPPING,Eg],[It.SHADOW_ACCUMULATOR,30]]);function Rde(t){return $de.has(t)?$de.get(t):typeof t=="number"?t:1}const get=6.5,Ide=1,yet=30,_et=1e3/30,vet=100,Lde=.9;var tB,jw;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(n=>n.needsUpdate)}constructor(){this._updating=iy(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new n_("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=Ii.INTERACTING,this._tasks=new ai,this._runQueue=new ai,this._load=0,this._idleStateCallbacks=new ai,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=te(()=>fet.SCHEDULER_LOG_SLOW_TASKS,n=>this._debug=n,pt);for(const n of Object.keys(It))this.performanceInfo.tasks.set(It[n],new n_(It[n]))}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),Lr(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(n){this._updatingChanged(),n&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(n,o){const a=new i(this,n,o);return this._tasks.push(a),this._updatingChanged(),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new n_(n)),a}registerIdleStateCallbacks(n,o){const a={idleBegin:n,idleEnd:o};this._idleStateCallbacks.push(a),this.state===Ii.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===Ii.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==Ii.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(n){++this._frameNumber;let o=get,a=n.frameDuration,l=Ide;switch(this.state){case Ii.IDLE:o=0,a=Math.max(vet,n.frameDuration),l=yet;break;case Ii.INTERACTING:a=Math.max(_et,n.frameDuration);case Ii.ANIMATING:}return a=a-n.elapsedFrameTime-o,this.state!==Ii.IDLE&&a<Ide&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Ii.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case Ii.INTERACTING:this._runInteracting();break;default:this._runAnimating()}}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n),this._updatingChanged()}_updateTask(n){this._tasks.forAll(o=>{o.name===n&&o.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return jw.SCHEDULED;let o=jw.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?o=jw.READY:o!==jw.READY&&(o=jw.WAITING))}),o}_getRuntime(n){let o=0;return this._tasks.forAll(a=>{a.name===n&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let o="";return n.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*Lde+n*(1-Lde)}_schedule(){for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===Eg&&n.needsUpdate&&!this._runQueue.includes(n)&&n.blockFrame!==this._frameNumber&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==Eg&&a.blockFrame!==this._frameNumber&&(n=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===pa&&(a.blockFrame=this._frameNumber)}catch(c){ne.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c),a.blockFrame=this._frameNumber}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,It.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-n)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(It))this._frameTaskTimes.set(It[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(n)}get test(){}}t.Scheduler=e;class i{get task(){return this._task.value}get updating(){return this._queue.running}constructor(n,o,a){this._scheduler=n,this.name=o,this.blockFrame=0,this.runtime=0,this._queue=new pet,this._handles=new Ey,this._basePriority=Rde(o),this.schedulePriority=this._basePriority,this._task=iy(a??this._queue),this._handles.add(jo(()=>this.task.running,l=>n.taskRunningChanged(l)))}remove(){this.processQueue(Nu),this._scheduler.removeTask(this),this.schedule=SP.schedule,this.reschedule=SP.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){if(this.name===n)return;this.name=n;const o=Rde(n);this._basePriority!==Eg&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,o,a){return this._queue.push(n,o,a)}reschedule(n,o,a){return this._queue.unshift(n,o,a)}processQueue(n){return this._queue.runTask(n)}}class r{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Ii.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=r})(tB||(tB={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(jw||(jw={}));const Nu=(()=>{const t=new tB.Budget;return t.enabled=!1,t})();let bet=class{remove(){}processQueue(){}schedule(e,i,r){try{if(ha(i)){const s=Ui();return r?Promise.resolve(r(s)):Promise.reject(s)}return xZ(e(Nu))}catch(s){return Promise.reject(s)}}reschedule(e,i,r){return this.schedule(e,i,r)}};const SP=new bet;function wet(t){return!!t&&/^https:\/\/.*/i.test(t)}function xet(t){return!!t&&/data:([-\w]+\/[-+\w.]+)?(;?\w+=[-\w]+)*(;base64)?,.*/gu.test(t)}var QY;let Ff=QY=class extends Se{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}get isSecureUrl(){return wet(this.url)}get isDataURI(){return xet(this.url)}clone(){return new QY({url:this.url})}};h([p({type:String,json:{write:{isRequired:!0}}})],Ff.prototype,"url",void 0),h([p()],Ff.prototype,"isSecureUrl",null),h([p()],Ff.prototype,"isDataURI",null),Ff=QY=h([I("esri.webdoc.support.SlideThumbnail")],Ff);var KY;let Xk=KY=class extends Se{constructor(){super(...arguments),this.text=""}clone(){return new KY({text:this.text})}};h([p({type:String,json:{write:!0}})],Xk.prototype,"text",void 0),Xk=KY=h([I("esri.webscene.support.Description")],Xk);const Jk=Xk;var eX;let IM=eX=class extends Se{constructor(){super(...arguments),this.lighting=new f2,this.weather=new Kz}clone(){return new eX({lighting:re(this.lighting),weather:re(this.weather)})}};h([p({types:MAe,json:{write:!0}})],IM.prototype,"lighting",void 0),h([p({types:Ase,json:{write:!0}})],IM.prototype,"weather",void 0),IM=eX=h([I("esri.webscene.Environment")],IM);var Qk;let Kk=Qk=class extends Se{constructor(){super(...arguments),this.opacity=null}clone(){return new Qk({opacity:this.opacity})}cloneAndApplyTo(t){return this.opacity==null||((t=(t==null?void 0:t.clone())??new NL).opacity=this.opacity),t}static fromGround(t){return new Qk({opacity:t.opacity})}};h([p({type:Number,json:{type:Ji,read:{reader:pP,source:"transparency"},write:{writer:(t,e)=>{e.transparency=ZD(t)},target:"transparency"}}})],Kk.prototype,"opacity",void 0),Kk=Qk=h([I("esri.webscene.support.SlideGround")],Kk);const $Ae=Kk;var tX;let LM=tX=class extends Se{constructor(t){super(t),this.id="",this.sublayerIds=null}clone(){return new tX({id:this.id,sublayerIds:re(this.sublayerIds)})}};h([p({type:String,json:{write:!0}})],LM.prototype,"id",void 0),h([p({type:[Ji],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],LM.prototype,"sublayerIds",void 0),LM=tX=h([I("esri.webscene.support.SlideVisibleLayer")],LM);var iX;let eU=iX=class extends Se{constructor(){super(...arguments),this.text=""}clone(){return new iX({text:this.text})}};h([p({type:String,json:{write:{isRequired:!0}}})],eU.prototype,"text",void 0),eU=iX=h([I("esri.webscene.support.Title")],eU);const M3=eU;let Tet=0;const rX=Ke.ofType(LM);let ta=class extends Se{constructor(e){super(e),this.id=Date.now().toString(16)+"-slide-"+Tet++,this.title=new M3,this.description=new Jk,this.hidden=!1,this.thumbnail=new Ff,this.viewpoint=null,this.basemap=null,this.ground=null,this.environment=new IM,this.timeExtent=null,this.visibleLayers=new rX}destroy(){this.visibleLayers.removeAll(),this.basemap=null,this.thumbnail=He(this.thumbnail),this.description=null,this.title=null,this.thumbnail=null}castTitle(e){return typeof e=="string"?new M3({text:e}):nn(M3,e)}castDescription(e){return typeof e=="string"?new Jk({text:e}):nn(Jk,e)}castThumbnail(e){return typeof e=="string"?new Ff({url:e}):nn(Ff,e)}castBasemap(e){return hse(e)}set visibleLayers(e){this._set("visibleLayers",gy(e,this._get("visibleLayers"),rX))}castVisibleLayers(e){return e&&typeof e.map=="function"?e.map(i=>{if(typeof i=="string")return{id:i};if(i instanceof UL){const r=Dde(i);return{id:i.id,sublayerIds:r}}return i.id?{id:i.id,sublayerIds:"sublayerIds"in i?i.sublayerIds:void 0}:(ne.getLogger(this).warn('Invalid visible layer, expected { id }, Layer or "id"'),i)}):null}clone(){var e,i,r;return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:((e=this.basemap)==null?void 0:e.clone())||null,ground:((i=this.ground)==null?void 0:i.clone())||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null,hidden:this.hidden,timeExtent:((r=this.timeExtent)==null?void 0:r.clone())??null})}async _updateVisibleLayersFrom(e){const i=[];await Promise.allSettled(this._getLayers(e.map).map(r=>e.whenLayerView(r).then(s=>{if(s.visible){const n=Dde(r);i.push(new LM({id:s.layer.id,sublayerIds:n}))}})).toArray()),this.visibleLayers.removeAll(),this.visibleLayers.addMany(i)}updateFrom(e,i){const r={format:"png",quality:80,width:120,height:75,disableDecorations:!0,...i==null?void 0:i.screenshot};return e.when(()=>{var s;return this.viewpoint=e.viewpoint.clone(),this.environment.lighting=e.environment.lighting.type==="virtual"?JD.prototype.clone.apply(e.environment.lighting):f2.prototype.clone.apply(e.environment.lighting),this.environment.weather=e.environment.weather.clone(),this.basemap=e.map.basemap&&e.map.basemap.clone()||null,this.ground=e.map.ground?$Ae.fromGround(e.map.ground):null,this.timeExtent=((s=e.timeExtent)==null?void 0:s.clone())??null,this._updateVisibleLayersFrom(e)}).then(()=>e.takeScreenshot(r)).then(s=>(this.thumbnail=new Ff({url:s.dataUrl}),this))}async applyTo(e,i){this._applyToController!=null&&this._applyToController.abort();let r=new AbortController;this._applyToController=r;const s=FD(i,()=>r==null?void 0:r.abort()),n=()=>{this._applyToController===r&&(this._applyToController=null),r=null,s==null||s.remove()};try{await d2(()=>e.ready,r.signal)}catch(d){throw n(),d}if(r.signal.aborted)throw n(),Ui();const o=e.resourceController.scheduler.registerTask(It.SLIDE);let a=!1;const l={animate:!0,...i,signal:this._applyToController.signal},c=async()=>{await Promise.all([o.schedule(async()=>a=await this._setViewpointOfInterest(e,l)),o.schedule(()=>this._applyBasemap(e,l),l.signal)]),await this._loadLayersWithSublayerVisibility(e),await Promise.all([o.schedule(()=>this._applyLayerVisibility(e),l.signal),o.schedule(()=>this._applyGround(e),l.signal),o.schedule(()=>this._applyViewpoint(e,l),l.signal),o.schedule(()=>{var d;return e.timeExtent=((d=this.timeExtent)==null?void 0:d.clone())??null},l.signal)]),await o.schedule(()=>e.environment.weather=this.environment.weather.clone())},u=await Qh(e.addUpdatingPromise(c()));if(a&&(e.contentCamera=null),o.remove(),n(),u.ok===!1)throw u.error;return this}async _applyBasemap(e,i){if(this.basemap){try{await this.basemap.load(i)}catch(r){if(us(r))throw r}e.map.basemap=jJe(this.basemap,e.map.basemap)}}_applyGround(e){this.ground&&(e.map.ground=this.ground.cloneAndApplyTo(e.map.ground))}_getLayers(e){const i=new Ke;return this._collectLayers(e,i),this._collectLayers(e.ground,i),i}_collectLayers(e,i){e.layers.forEach(r=>{r.persistenceEnabled&&(i.add(r),"layers"in r&&this._collectLayers(r,i))})}async _loadLayersWithSublayerVisibility(e){this.visibleLayers&&await Promise.allSettled(this._getLayers(e.map).items.map(i=>{var s;return((s=this.visibleLayers.find(n=>n.id===i.id))==null?void 0:s.sublayerIds)?i.load():null}))}_applyLayerVisibility(e){this.visibleLayers&&this._getLayers(e.map).forEach(i=>{const r=this.visibleLayers.find(o=>o.id===i.id);i.visible=r!=null;const s=r==null?void 0:r.sublayerIds,n=RAe(i);s&&n&&n.forEach(o=>o.visible=s.includes(o.id))})}async _setViewpointOfInterest(e,i){if(e.state.fixedContentCamera||!this.viewpoint||i!=null&&i.ignoreViewpoint||!(i!=null&&i.useDestinationCamera))return!1;const{toCameraAsync:r}=await oe(()=>Promise.resolve().then(()=>eyt),void 0),s=await r(e,this.viewpoint);return e.contentCamera=s,s!=null}async _applyViewpoint(e,i){if(this._applyCachedCameraTrackingEnabled(e),this.viewpoint&&!i.ignoreViewpoint){this.viewpoint.camera!=null&&(this.viewpoint.camera.fov=e.camera.fov);const r=this.environment.lighting;if(i.animate&&r.type==="sun"&&r.date)return this._animateToLighting(e,i);i.animate&&(e.environment.applyLighting(r.clone()),await e.goTo(this.viewpoint,i)),e.viewpoint=this.viewpoint}e.environment.applyLighting(this.environment.lighting.clone())}async _animateToLighting(e,i){let r=null;return e.environment.lighting.type!=="virtual"&&this.environment.lighting.type!=="virtual"&&(e.viewingMode==="global"&&(r=this._animateLightingWithCamera(e,e.environment.lighting,this.environment.lighting)),e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1),e.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled,this.environment.lighting.type==="virtual"||e.environment.lighting.type==="virtual"?(e.environment.applyLighting(this.environment.lighting.clone()),e.environment.lighting.type!=="virtual"&&(e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1)):this.environment.lighting.displayUTCOffset!=null&&(e.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset),e.goTo(this.viewpoint,i).then(()=>{this._applyCachedCameraTrackingEnabled(e),e.environment.applyLighting(this.environment.lighting.clone())}).catch(s=>{throw e.animation==null&&this._applyCachedCameraTrackingEnabled(e),s}).finally(()=>{Lr(r)})}_applyCachedCameraTrackingEnabled(e){e.environment.cachedCameraTrackingEnabled!=null&&(e.environment.lighting.cameraTrackingEnabled=e.environment.cachedCameraTrackingEnabled,e.environment.cachedCameraTrackingEnabled=null)}_getTime(e){return[e.getTime(),3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds()]}_setTime(e,i,r){return e.setTime(i),e.setUTCHours(r/3600),e.setUTCMinutes(r%3600/60),e.setUTCSeconds(r%3600%60),e}_animateLightingWithCamera(e,i,r){const s=new Date(i.date.toString()),[n,o]=this._getTime(s),[a,l]=this._getTime(r.date),c=Cet(o,l),u=e.renderCoordsHelper,d=C();u.toRenderCoords(e.camera.position,d);const f=C(),m=C();this.viewpoint.camera!=null&&u.toRenderCoords(this.viewpoint.camera.position,f);const g=new Date;return jo(()=>e.camera,y=>{u.toRenderCoords(y.position,m);const v=yo(d,m),b=yo(f,m);let w=0;v+b!==0&&(w=v/(v+b));const x=n+(a-n)*w,T=Met(o,c*w);i.date=this._setTime(g,x,T)})}static createFrom(e,i){return new this().updateFrom(e,i)}};h([p({type:String,json:{write:{isRequired:!0}}})],ta.prototype,"id",void 0),h([p({type:M3,json:{default:()=>new M3({text:""}),write:{isRequired:!0}}})],ta.prototype,"title",void 0),h([Qt("title")],ta.prototype,"castTitle",null),h([p({type:Jk,json:{write:{overridePolicy:t=>({enabled:!(!t||!t.text)})}}})],ta.prototype,"description",void 0),h([Qt("description")],ta.prototype,"castDescription",null),h([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!1}})],ta.prototype,"hidden",void 0),h([p({type:Ff,json:{default:()=>new Ff({url:""}),write:{isRequired:!0}}})],ta.prototype,"thumbnail",void 0),h([Qt("thumbnail")],ta.prototype,"castThumbnail",null),h([p({type:um,nonNullable:!0,json:{write:{isRequired:!0}}})],ta.prototype,"viewpoint",void 0),h([p({type:wA,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],ta.prototype,"basemap",void 0),h([Qt("basemap")],ta.prototype,"castBasemap",null),h([p({type:$Ae,json:{write:!0}})],ta.prototype,"ground",void 0),h([p({type:rX,json:{write:{isRequired:!0}}})],ta.prototype,"visibleLayers",null),h([Qt("visibleLayers")],ta.prototype,"castVisibleLayers",null),h([p({type:IM,json:{write:!0}})],ta.prototype,"environment",void 0),h([p(OAe)],ta.prototype,"timeExtent",void 0),ta=h([I("esri.webscene.Slide")],ta);const Eet=ta;function RAe(t){if(t.type==="building-scene"||t.type==="map-image")return t.allSublayers.toArray()}function Dde(t){const e=RAe(t);if(e)return e.filter(i=>i.visible).map(i=>i.id)}const sX=86400,Nde=43200;function Cet(t,e){let i=e-t;return i>Nde&&(i-=sX),i<-Nde&&(i+=sX),i}function Met(t,e){return eJe(t+e,sX)}const nX=Ke.ofType(Eet);let tU=class extends Se{constructor(e){super(e),this.slides=new nX}destroy(){this.slides.forEach(e=>e.destroy()),this.slides.removeAll()}set slides(e){e&&(e=e.filter(i=>!!i.viewpoint)),this._set("slides",gy(e,this._get("slides"),nX))}clone(){return new this.constructor({slides:this.slides.clone()})}};h([p({type:nX,nonNullable:!0,json:{write:!0}}),Qt(Bre)],tU.prototype,"slides",null),tU=h([I("esri.webscene.Presentation")],tU);const IAe=tU;var oX;let RC=oX=class extends Se{constructor(t){super(t)}clone(){return new oX({name:this.name,path:this.path,title:this.title})}};h([p({type:String,json:{write:!0}})],RC.prototype,"name",void 0),h([p({type:String,json:{write:!0}})],RC.prototype,"path",void 0),h([p({type:String,json:{write:!0}})],RC.prototype,"title",void 0),RC=oX=h([I("esri.webscene.TransportationNetwork")],RC);const Aet=RC;let SO=class aX{constructor(e,i,r=""){this.major=e,this.minor=i,this._context=r}lessThan(e,i){return this.major<e||e===this.major&&this.minor<i}since(e,i){return!this.lessThan(e,i)}validate(e){if(this.major!==e.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new B(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new aX(this.major,this.minor,this._context)}static parse(e,i=""){const[r,s]=e.split("."),n=/^\s*\d+\s*$/;if(!(r!=null&&r.match)||!n.test(r))throw new B((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!(s!=null&&s.match)||!n.test(s))throw new B((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(r,10),a=parseInt(s,10);return new aX(o,a,i)}},iB=class extends SO{constructor(e,i){super(e,i,"webscene")}get supportsGround(){return this.since(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}},Pet=null;function Oet(){return Pet}var LAe;const FS=new iB(1,34),$et=()=>{const e=[],i=FS.major;for(let r=8;r<=FS.minor;r++)e.push(`${i}.${r}`);return e},UH="Web Scene";let Or=class extends yy.LoadableMixin(jD(_se(kMe))){constructor(e){super(e),this[LAe]=!0,this._layersIdGCTimeoutId=void 0,this._updateFromPromise=null,this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.floorInfo=null,this.heightModelInfo=void 0,this.sourceVersion=null,this.transportationNetworks=null,this.presentation=new IAe,this.initialViewProperties=new eB,this.portalItem=null,this.resourceInfo=null,this.widgets=null,this._debouncedSaveOperations=d_(async(i,r,s)=>{switch(i){case jg.SAVE:return this._saveImpl(r);case jg.SAVE_AS:return this._saveAsImpl(s,r)}}),this._resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch(e=>{ne.getLogger(this).error("#load()","Failed to load web scene",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(i){return void this.addResolvingPromise(Promise.reject(i))}this.read(e),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this.addHandles(on(()=>this.allLayers,"change",()=>this._scheduleLayersIdGC()))}destroy(){this._unscheduleLayersIdGC(),this.presentation&&this.presentation.destroy(),this.portalItem=He(this.portalItem)}writeClippingArea(e,i){i.clippingArea||(i.clippingArea={}),i.clippingArea.geometry=e.toJSON()}readClippingEnabled(e,i){return!!i.clippingArea&&!!i.clippingArea.clip}writeClippingEnabled(e,i){this.clippingArea&&(i.clippingArea||(i.clippingArea={}),i.clippingArea.clip=e)}writeLayers(e,i,r,s){i[r]=this._layersToJSON(e,"operational-layers",s)}readSourceVersion(e,i){const[r,s]=i.version.split(".");return new iB(parseInt(r,10),parseInt(s,10))}writeSourceVersion(e,i,r){i[r]=`${FS.major}.${FS.minor}`}writeTables(e,i,r,s){const n=this._layersToJSON(e,"tables",s);n.length&&(i[r]=n)}get thumbnailUrl(){var e;return((e=this.portalItem)==null?void 0:e.thumbnailUrl)??null}set thumbnailUrl(e){e?this._override("thumbnailUrl",e):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,i){e&&this._isAuthoringAppSetByUser?i.authoringApp=e:i.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,i){e&&this._isAuthoringAppVersionSetByUser?i.authoringAppVersion=e:i.authoringAppVersion=VEe}writeGround(e,i,r,s){i[r]=e?e.write({},s):{transparency:0,layers:[]}}readInitialViewProperties(e,i){var n,o,a;const r={};(n=i.initialState)!=null&&n.environment&&(r.environment=TP.fromJSON(i.initialState.environment)),r.spatialReference=i.spatialReference?Ye.fromJSON(i.spatialReference):Ye.WebMercator,r.viewingMode=i.viewingMode??"global",(o=i.initialState)!=null&&o.viewpoint&&(r.viewpoint=um.fromJSON(i.initialState.viewpoint));const s=(a=i.initialState)==null?void 0:a.timeExtent;return s!=null&&(r.timeExtent=za.fromArray(s)),new eB(r)}get spatialReference(){var e;return((e=this.initialViewProperties)==null?void 0:e.spatialReference)??Ye.WebMercator}get viewingMode(){var e;return((e=this.initialViewProperties)==null?void 0:e.viewingMode)??"global"}load(e){const i=this.ground;return this.addResolvingPromise(this._loadFromSource().then(()=>{i&&i!==this.ground&&i.destroy()})),Promise.resolve(this)}loadAll(){return Hre(this,e=>{const i=this.presentation&&this.presentation.slides;e(this.ground,this.basemap,this.layers,i&&i.map(r=>r.basemap),this.tables)})}read(e,i){var n;i={...i,origin:"web-scene"};const r=this._isAuthoringAppVersionSetByUser,s=this._isAuthoringAppSetByUser;if(TEe(this,e,o=>super.read(e,o),i),s||(this._isAuthoringAppSetByUser=!1),r||(this._isAuthoringAppVersionSetByUser=!1),e.baseMap&&Array.isArray(e.baseMap.elevationLayers)&&((n=this.sourceVersion)==null?void 0:n.supportsVisibleElevationLayersInSlides)){const o=e.baseMap.elevationLayers.map(u=>({id:u.id})),a=this.presentation.slides,l=(u,d)=>u.visibleLayers.some(f=>f.id===d),c=o.filter(u=>!a.some(d=>l(d,u.id)));a.forEach(u=>{u.visibleLayers.addMany(c)})}}_writeBasemapElevationLayers(e){var r;const i=(r=e.ground)==null?void 0:r.layers;!e.baseMap&&(i!=null&&i.length)&&(e.baseMap={title:"Basemap",baseMapLayers:[]}),e.baseMap&&(e.baseMap.elevationLayers=re(i))}_layersToJSON(e,i,r){const s={...r,layerContainerType:i};return e.map(n=>this._verifyWritableLayer(n,r)?n.write({},s):null).filter(n=>!!n).toArray()}_verifyWritableLayer(e,i){return!!e.persistenceEnabled&&("write"in e||(i!=null&&i.messages&&i.messages.push(new B("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in web scenes`,{layer:e})),!1))}write(e,i){var n;if(this.loadStatus!=="loaded"){const o=new B("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw ne.getLogger(this).error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),o}this._runLayersIdGC();const r=!(i!=null&&i.messages);i={messages:[],...i,origin:"web-scene"};const s=super.write(e,i);if(r){const o=((n=i.messages)==null?void 0:n.filter(a=>a.name==="web-document-write:property-required"))??[];if(o.length){const a=new B("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:o});throw ne.getLogger(this).error("#toJSON()","One or more properties that are required in the webscene JSON are missing",o),a}}return this._writeBasemapElevationLayers(s),s}async save(e){return this._debouncedSaveOperations(jg.SAVE,e)}async _saveImpl(e){var n;if(!this.portalItem)throw new B("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene");if(Cde(this.portalItem),((n=this.portalItem)==null?void 0:n.type)!==UH)throw new B("webscene:portal-item-wrong-type",`Portal item needs to have type "${UH}"`);const i=this._updateFromPromise;await this._ensureLoadBeforeSave();const r=this._enableVerifyItemRelativeUrls(xde(this.portalItem,"web-scene",!0)),s=this.write({},r);return await Promise.all(r.resources.pendingOperations),await this._verifySave(s,r,e),this._updateTypeKeywords(this.portalItem),await zKe(this.portalItem,s,this._resourceReferences,r),yde(r),i&&await i,await this._saveThumbnail(),this.portalItem}async saveAs(e,i){return this._debouncedSaveOperations(jg.SAVE_AS,i,e)}async _saveAsImpl(e,i){let r=AS.from(e);if(!r)throw new B("webscene:portal-item-required","saveAs requires a portal item to save to");Cde(r),r.id&&(r=r.clone(),r.id=null);const s=r.portal||Kn.getDefault();await this._ensureLoadBeforeSave(),r.type=UH,r.portal=s;const n=this._enableVerifyItemRelativeUrls(xde(r,"web-scene",!0)),o=this.write({},n);await Promise.all(n.resources.pendingOperations),await this._verifySaveAs(o,n,i);const a=this.thumbnailUrl,l=!this._isOverridden("thumbnailUrl");if(this._updateTypeKeywords(r),await s.signIn(),!s.user)throw new B("webscene:user-not-signed-in","saveAs requires a user to be signed in to the portal");return await s.user.addItem({item:r,folder:i==null?void 0:i.folder,data:o}),await VKe(this._resourceReferences,n),this.portalItem=r,xY.prototype.read.call(this,{version:o.version,authoringApp:o.authoringApp,authoringAppVersion:o.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:r.itemUrl?gn(r.itemUrl):void 0}),yde(n),a&&(this.thumbnailUrl=l?NEe(a,"w","8192"):a),n.portalItem=r,await this._saveThumbnail(),r}async _saveThumbnail(){var e;this._isOverridden("thumbnailUrl")&&(await((e=this.portalItem)==null?void 0:e.updateThumbnail({thumbnail:this.thumbnailUrl})),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}async _verifySave(e,i,r,s=!1){if(!r2(this.spatialReference))throw new B("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently.");const{ignoreUnsupported:n,requiredPropertyChecksDisabled:o,strictSchemaValidationEnabled:a}=r||{};jKe(i,{errorName:"webscene:save"},{ignoreUnsupported:n,supplementalUnsupportedErrors:["scenemodification:unsupported"],requiredPropertyChecksDisabled:o});const l=Oet();if(a&&l){const c=(await l()).validate(e);if(!c.length)return;const u=`webscene did not validate:
${c.join(`
`)}`;ne.getLogger(this).error(`${s?"saveAs":"save"}(): ${u}`);const d=c.map(f=>new B("webscene:schema-validation",f));throw MKe(d)}}_verifySaveAs(e,i,r){return this.canNotSaveAs(i)?Promise.reject(CKe()):this._verifySave(e,i,r,!0)}verifySaveAs(e){const i=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),r=this.write({},i);return this._verifySaveAs(r,i,e)}canNotSaveAs(e){var i,r;return e||(e=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write({},e)),(((r=(i=e.verifyItemRelativeUrls)==null?void 0:i.writtenUrls)==null?void 0:r.length)??0)>0}async updateFrom(e,i={}){const r=this._updateFrom(e,i);this._updateFromPromise=r,await r,this._updateFromPromise===r&&(this._updateFromPromise=null)}async _updateFrom(e,i={}){var r;if(await e.whenReady(),!i.environmentExcluded&&e.environment&&(this.initialViewProperties.environment=TP.prototype.clone.apply(e.environment)),!i.viewpointExcluded&&e.viewpoint&&(this.initialViewProperties.viewpoint=e.viewpoint.clone()),this.initialViewProperties.spatialReference=e.spatialReference.clone(),this.initialViewProperties.viewingMode=e.viewingMode,this.initialViewProperties.timeExtent=((r=e.timeExtent)==null?void 0:r.clone())??null,e.clippingArea!=null?e.clippingArea!==this.clippingArea&&(this.clippingArea=e.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,e.heightModelInfo&&(this.heightModelInfo=e.heightModelInfo.clone()),e.map===this)for(const s of e.allLayerViews){const n="visible";n in s&&n in s.layer&&s._isOverridden(n)&&(s.layer[n]=s[n])}if(!i.widgetsExcluded)for(const s of e.persistableViewModels)s.updateWebDocument(this);(i.thumbnailExcluded===!1||i.thumbnailExcluded==null&&!i.viewpointExcluded)&&await this._updateFromThumbnail(e,i.thumbnailSize??void 0)}async _updateFromThumbnail(e,i){const r=HKe(e,i),s=await e.takeScreenshot({format:"jpg",width:r.width,height:r.height,disableDecorations:!0});this.thumbnailUrl=s.dataUrl}_loadFromSource(){var e;return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):(e=this.portalItem)!=null&&e.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()}_readAndLoadFromJSON(e,i){const r=this._validateJSON(e);return this.read(r,i),this._loadFromJSON(r,i)}_extractOperationalLayers(e){var n;const i=[];if(!((n=this.sourceVersion)!=null&&n.supportsGround)&&e.baseMap&&Array.isArray(e.baseMap.elevationLayers))for(const o of e.baseMap.elevationLayers)i.push(o);const r=[],s=o=>{var a;return o.layers&&(o.layers=o.layers.filter(s)),o.layerType!=="ArcGISTiledElevationServiceLayer"||((a=this.sourceVersion)!=null&&a.supportsGround||r.push(o),!1)};return{operationalLayers:e.operationalLayers?e.operationalLayers.filter(s):[],operationalElevationLayers:r,basemapElevationLayers:i}}async _loadFromJSON(e,i){var u;const r=new Ke;await this._validateSpatialReference(),await this._validateHeightModelInfo();const{populateOperationalLayers:s}=await oe(()=>import("./layersCreator-CirDWEZ0.js"),__vite__mapDeps([6,7,8,9])),{operationalLayers:n,operationalElevationLayers:o,basemapElevationLayers:a}=this._extractOperationalLayers(e),l=[],c={context:{...i,layerContainerType:"operational-layers"}};if(this.portalItem&&(c.context.portal=this.portalItem.portal||Kn.getDefault()),a.length>0){const d={...c,context:{...c.context,layerContainerType:"ground"}};d.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(s(this.ground.layers,a,d))}if(o.length>0){const d={...c,context:{...c.context,layerContainerType:"ground"}};d.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(s(r,o,d))}n&&n.length>0&&l.push(s(this.layers,n,c)),(u=e.tables)!=null&&u.length&&l.push(s(this.tables,e.tables,{...c,context:{...c.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"})),await Promise.allSettled(l),await this._loadObjectsWithLayers(),this.ground.layers.addMany(r.filter(d=>d.type==="base-elevation"||d.type==="elevation"))}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const e=[],i=[...this.allLayers.items];for(const{basemap:r}of this.presentation.slides.items)r&&(i.push(...r.baseLayers.items),i.push(...r.referenceLayers.items));for(const r of i)if("beforeSave"in r&&typeof r.beforeSave=="function"){const s=r.beforeSave();s&&e.push(s)}await Promise.allSettled(e)}async _loadObjectsWithLayers(){const e=[];this.ground&&e.push(this.ground.load()),this.basemap&&e.push(this.basemap.load()),this.presentation.slides.forEach(i=>{i.basemap&&e.push(i.basemap.load())}),await Promise.allSettled(e)}async _loadFromItem(e){if(await e.load().catch(s=>{throw new B("webscene:load-portal-item","Failed to load portal item",{error:s})}),e.type!=="Web Scene")throw new B("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:e.type});const i=await e.fetchData();this.resourceInfo=i;const r={origin:"web-scene",url:gn(e.itemUrl),portal:e.portal||Kn.getDefault(),portalItem:e,readResourcePaths:[]};await this._readAndLoadFromJSON(i,r),this._resourceReferences={portalItem:e,paths:r.readResourcePaths??[]}}_validateSpatialReference(){const e=this.initialViewProperties,i=this._sceneSpatialReference;let r;if(e.viewingMode!=="local"){if(!VL(i,Je.Global))return Promise.reject(new B("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:i,viewingMode:e.viewingMode}));r=l=>!l||Kc(l,i)}else{if(!VL(i,Je.Local))return Promise.reject(new B("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:i,viewingMode:e.viewingMode}));r=l=>!l||l.equals(i)}const s=l=>{var c,u;return((c=l==null?void 0:l.camera)==null?void 0:c.position.spatialReference)??((u=l==null?void 0:l.targetGeometry)==null?void 0:u.spatialReference)},n=e.viewpoint,o=s(n);if(o&&!r(o))return Promise.reject(new B("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:o,sceneSpatialReference:i,viewingMode:e.viewingMode}));const a=this.presentation.slides.find(l=>!r(s(l.viewpoint)));if(a){const l=s(a.viewpoint);return Promise.reject(new B("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:l,sceneSpatialReference:i,viewingMode:e.viewingMode}))}return Promise.resolve()}_validateHeightModelInfo(){const e=this._sceneSpatialReference,i=hKe(this.heightModelInfo,e);return i?Promise.reject(i):Promise.resolve()}_validateJSON(e){const i=iB.parse(e.version||"","webscene");return FS.validate(i),e.version=`${i.major}.${i.minor}`,i.major===1&&i.minor<=2&&(e.spatialReference=Ye.WebMercator.toJSON()),e}_updateTypeKeywords(e){Tde(e,OY.LOCAL_SCENE,this.initialViewProperties.viewingMode==="local"),Tde(e,OY.DEVELOPER_BASEMAP,rde(this.basemap)||this.presentation.slides.some(({basemap:i})=>!!i&&rde(i))),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((i,r,s)=>s.indexOf(i)===r))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||Ye.WebMercator}get _verifyItemRelativeRootPath(){var e;return(e=this.portalItem)!=null&&e.itemUrl?gn(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(e){const i=this._verifyItemRelativeRootPath;return i&&(e.verifyItemRelativeUrls={rootPath:i,writtenUrls:[]}),e}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout(()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()},3e3)}_runLayersIdGC(){var s,n;this._unscheduleLayersIdGC();const e=(n=(s=this.applicationProperties)==null?void 0:s.viewing)==null?void 0:n.search,i=o=>this.allLayers.some(a=>a.id===o&&a.persistenceEnabled);e!=null&&e.layers&&(e.layers=e.layers.filter(o=>i(o.id)));const r=this.presentation&&this.presentation.slides;r&&r.forEach(o=>{o.visibleLayers&&(o.visibleLayers=o.visibleLayers.filter(a=>i(a.id)))})}static fromJSON(e){if(!e)throw new B("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}};LAe=TKe,Or.version=`${FS.major}.${FS.minor}`,h([p({type:QKe,json:{write:!0}})],Or.prototype,"applicationProperties",void 0),h([p({type:dr,json:{read:{source:"clippingArea.geometry",reader:_y},write:{target:"clippingArea.geometry"}}})],Or.prototype,"clippingArea",void 0),h([Ze("clippingArea")],Or.prototype,"writeClippingArea",null),h([p({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],Or.prototype,"clippingEnabled",void 0),h([ze("clippingEnabled",["clippingArea"])],Or.prototype,"readClippingEnabled",null),h([Ze("clippingEnabled")],Or.prototype,"writeClippingEnabled",null),h([p({type:xKe,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],Or.prototype,"floorInfo",void 0),h([p({type:gw,json:{write:!0}})],Or.prototype,"heightModelInfo",void 0),h([p({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],Or.prototype,"layers",void 0),h([Ze("layers")],Or.prototype,"writeLayers",null),h([p({readOnly:!0,type:iB,json:{type:$et(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],Or.prototype,"sourceVersion",void 0),h([ze("sourceVersion",["version"])],Or.prototype,"readSourceVersion",null),h([Ze("sourceVersion")],Or.prototype,"writeSourceVersion",null),h([p({json:{read:!1,write:{enabled:!0,ignoreOrigin:!0}}})],Or.prototype,"tables",void 0),h([Ze("tables")],Or.prototype,"writeTables",null),h([p()],Or.prototype,"thumbnailUrl",null),h([p({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],Or.prototype,"authoringApp",null),h([Ze("authoringApp")],Or.prototype,"writeAuthoringApp",null),h([p({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],Or.prototype,"authoringAppVersion",null),h([Ze("authoringAppVersion")],Or.prototype,"writeAuthoringAppVersion",null),h([p({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],Or.prototype,"ground",void 0),h([Ze("ground")],Or.prototype,"writeGround",null),h([p({type:Ke.ofType(Aet),json:{write:!0}})],Or.prototype,"transportationNetworks",void 0),h([p({type:IAe,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(t,e,i,r)=>{if(t.slides&&t.slides.length>0){const s={...r,isPresentation:!0};e.presentation=t.write({},s)}}}}})],Or.prototype,"presentation",void 0),h([p({type:eB,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new eB({viewingMode:"global",spatialReference:Ye.WebMercator})}})],Or.prototype,"initialViewProperties",void 0),h([ze("initialViewProperties",["initialState.timeExtent","initialState.environment","initialState.viewpoint","spatialReference","viewingMode"])],Or.prototype,"readInitialViewProperties",null),h([p({type:Ye,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],Or.prototype,"spatialReference",null),h([p({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],Or.prototype,"viewingMode",null),h([p({type:AS})],Or.prototype,"portalItem",void 0),h([p()],Or.prototype,"resourceInfo",void 0),h([p({type:$Ke,json:{write:!0}})],Or.prototype,"widgets",void 0),Or=h([I("esri.WebScene")],Or);const Fde=Or;function WG(t){return typeof t=="string"?document.getElementById(t):t??null}function DAe(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function kde(t,e){const i=e.parentNode;i&&i.insertBefore(t,e)}function Ude(t,e){for(;;){const i=t.firstChild;if(!i)break;e.appendChild(i)}}let rB=class{constructor(e=i=>i.values().next().value){this._peeker=e,this._observable=new _O,this._items=new Set}get length(){return Ft(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return Ft(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const i=this.length;return this._items.forEach(r=>{e(r)||this._items.delete(r)}),i!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){Ft(this._observable),yield*this._items}};const NAe=new FinalizationRegistry(t=>{t.close()});function Ret(t,e){NAe.register(t,e,e)}function Iet(t){NAe.unregister(t)}function FAe(t,e){return new Proxy({},{get:(i,r,s)=>(...n)=>{let o,a;const l=n[n.length-1];return Let(l)&&(o=l.signal,a=l.transferList,n.pop()),t.apply(e?`${e}.${r.toString()}`:r.toString(),n,{transferList:a,signal:o})}})}function Let(t){return typeof t=="object"&&!Array.isArray(t)&&t!=null&&("signal"in t||"transferList"in t||Object.keys(t).length===0)}const Det={statsWorker:()=>oe(()=>import("./statsWorker-DMYGFZ63.js"),__vite__mapDeps([11,12,13,14])),geometryEngineWorker:()=>oe(()=>import("./geometryEngineWorker-BHmWvPIm.js"),__vite__mapDeps([15,16,17,18])),CSVSourceWorker:()=>oe(()=>import("./CSVSourceWorker-BsBWPtmx.js"),__vite__mapDeps([19,20,18,21,22,23,24,25,26,27,28,12,13,14,29,30,31])),EdgeProcessingWorker:()=>oe(()=>import("./EdgeProcessingWorker-CTb44O9x.js"),__vite__mapDeps([32,33])),ElevationSamplerWorker:()=>oe(()=>import("./ElevationSamplerWorker-9CmApRTG.js"),__vite__mapDeps([34,23,24,35])),FeatureServiceSnappingSourceWorker:()=>oe(()=>import("./FeatureServiceSnappingSourceWorker-DmuXWQ_E.js"),__vite__mapDeps([36,21,22,23,24,25,26,27,18,28,12,13,14,29,37])),GeoJSONSourceWorker:()=>oe(()=>import("./GeoJSONSourceWorker-uumldrIr.js"),__vite__mapDeps([38,21,22,23,24,25,26,27,18,28,12,13,14,29,39,20,31,40])),LercWorker:()=>oe(()=>import("./LercWorker-CgAPRQBN.js"),[]),MemorySourceWorker:()=>oe(()=>import("./MemorySourceWorker-DUOZmL34.js"),__vite__mapDeps([41,42,21,22,23,24,25,26,27,18,28,12,13,14,29,31,40,20])),PBFDecoderWorker:()=>oe(()=>import("./PBFDecoderWorker-D4rUCpIA.js"),[]),FeaturePipelineWorker:()=>oe(()=>import("./FeaturePipelineWorker-XUDfO8SO.js"),__vite__mapDeps([43,44,45,46,25,26,27,18,28,12,13,14,29,24,47,39,20,31,40,48,49])),PointCloudWorker:()=>oe(()=>import("./PointCloudWorker-zyf0lYsa.js"),__vite__mapDeps([50,51,52,53])),RasterWorker:()=>oe(()=>import("./RasterWorker-BGWCl8pT.js"),__vite__mapDeps([54,55,56,57,58])),SceneLayerSnappingSourceWorker:()=>oe(()=>import("./SceneLayerSnappingSourceWorker-DgTzsEkm.js"),[]),SceneLayerWorker:()=>oe(()=>import("./SceneLayerWorker-BYGZXe0f.js").then(t=>t.S),__vite__mapDeps([59,60,61,53])),WFSSourceWorker:()=>oe(()=>import("./WFSSourceWorker-miUZDZL9.js"),__vite__mapDeps([62,21,22,23,24,25,26,27,18,28,12,13,14,29,39,20,40,63,64])),WorkerTileHandler:()=>oe(()=>import("./WorkerTileHandler-BzTuT9GY.js"),__vite__mapDeps([65,46,44,66])),Lyr3DWorker:()=>oe(()=>import("./Lyr3DWorker-CQNsV537.js"),__vite__mapDeps([67,68,69]))},kAe="worker:port-closed";var Da;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(Da||(Da={}));let Net=0;function UAe(){return Net++}function Fet(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function zL(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function Pse(t,e,i,r){if(e.type===Da.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==Da.INVOKE&&e.type!==Da.RESPONSE)return void t.postMessage(e);let s;if(Fet(i)?(s=Vde(i.transferList),e.data=i.result):(s=Vde(r),e.data=i),s){if(ue("ff")){for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case Da.INVOKE:throw o;case Da.RESPONSE:return void Pse(t,{type:Da.RESPONSE,jobId:e.jobId,error:zL(o)})}}}t.postMessage(e,s)}else t.postMessage(e)}function BL(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function Vde(t){if(!(t!=null&&t.length))return null;if(ue("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(i=>!ket(i));return e.length?e:null}function ket(t){var e;return t instanceof ArrayBuffer||((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="ArrayBuffer"}async function qZt(t){try{return await t}catch(e){const i=(e==null?void 0:e.name)===kAe;if(!(us(e)||i))throw e;return}}const{CLOSE:zde,ABORT:Bde,INVOKE:jde,RESPONSE:o$,OPEN_PORT:Gde,ON:Uet}=Da,Vet=2;let zet=class{constructor(e){this._invoke=e,this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._timer=null,this._process=this._process.bind(this)}push(e){e.type===Da.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},Wb=class IC{static connect(e,i){const r=new MessageChannel;let s;s=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const n=new IC(r.port1,{channel:r,client:s,schedule:i});return typeof s=="object"&&"remoteClient"in s&&(s.remoteClient=n),IC.clients.set(n,s),r.port2}static loadWorker(e){const i=Det[e];return i?i():Promise.resolve(null)}constructor(e,i,r){this._port=e,this._jobQueue=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new zet(s=>this._onInvokeMessage(s)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:zde}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,i,r){return this.apply(e,[i],r)}apply(e,i,r){const s=r==null?void 0:r.signal,n=r==null?void 0:r.transferList;if(!this._port)return Promise.reject(new B(kAe,`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:i}));const o=UAe();return new Promise((a,l)=>{if(ha(s))return this._processWork(),void l(Ui());const c=Va(s,()=>{const d=this._outJobs.get(o);d&&(this._outJobs.delete(o),this._processWork(),Lr(d.abortHandle),this._post({type:Bde,jobId:o}),l(Ui()))}),u={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,u),this._post({type:jde,jobId:o,methodName:e,abortable:s!=null},i,n)})}createInvokeProxy(e){return FAe(this,e)}on(e,i){const r=new MessageChannel;function s(n){i(n.data)}return this._port.postMessage({type:Da.ON,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",s),r.port1.start(),Gi(()=>{r.port1.postMessage({type:Da.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",s)})}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:Gde,port:e.port2}),e.port1}_processWork(){var o;if(this._outJobs.size>=Vet)return;const e=(o=this._jobQueue)==null?void 0:o.pop();if(!e)return;const{methodName:i,data:r,invokeOptions:s,resolver:n}=e;this.apply(i,r,s).then(a=>n.resolve(a)).catch(a=>n.reject(a))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{Lr(e.abortHandle),e.reject(Ui(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e,!0)):this._processMessage(e,!1)}_processMessage(e,i){const r=BL(e);if(r)switch(r.type){case o$:this._onResponseMessage(r);break;case jde:i?this._onInvokeMessage(r):this._invokeQueue.push(r);break;case Bde:this._onAbortMessage(r);break;case zde:this._onCloseMessage();break;case Gde:this._onOpenPortMessage(r);break;case Uet:this._onOnMessage(r)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,s=i.get(r);this._invokeQueue.push(e),s&&(s.controller&&s.controller.abort(),i.delete(r))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&IC.clients.get(this)===e&&e.destroy(),IC.clients.delete(this),e!=null&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:i,jobId:r,data:s=[],abortable:n}=e,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,u=c[i];try{if(!u&&i&&i.includes(".")){const d=i.split(".");for(let f=0;f<d.length-1;f++)c=c[d[f]],u=c[d[f+1]]}if(typeof u!="function")throw new TypeError(`${i} is not a function`);s.push({client:this,signal:o?o.signal:null}),l=u.apply(c,s)}catch(d){return void this._post({type:o$,jobId:r,error:zL(d)})}Zu(l)?(a.set(r,{controller:o,promise:l}),l.then(d=>{a.has(r)&&(a.delete(r),this._post({type:o$,jobId:r},d))},d=>{a.has(r)&&(a.delete(r),us(d)||this._post({type:o$,jobId:r,error:zL(d||{message:`Error encountered at method ${i}`})}))})):this._post({type:o$,jobId:r},l)}_onOpenPortMessage(e){new IC(e.port,{client:this._client})}_onOnMessage(e){const{port:i}=e,r=this._client.on(e.eventType,n=>{i.postMessage(n)}),s=fO(e.port,"message",n=>{const o=BL(n);(o==null?void 0:o.type)===Da.CLOSE&&(s.remove(),r.remove(),i.close())})}_onResponseMessage(e){const{jobId:i,error:r,data:s}=e,n=this._outJobs;if(!n.has(i))return;const o=n.get(i);n.delete(i),this._processWork(),Lr(o.abortHandle),r?o.reject(B.fromJSON(JSON.parse(r))):o.resolve(s)}_post(e,i,r){return Pse(this._port,e,i,r)}};Wb.kernelInfo={buildDate:kEe,fullVersion:Ure,revision:UEe},Wb.clients=new Map;let Bet=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new rB}destroy(){this.close()}get closed(){var e;return!((e=this._clients)!=null&&e.length)}open(e,i){return new Promise((r,s)=>{let n=!0;const o=a=>{Dt(i.signal),n&&(n=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];Zu(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new Wb(c,i,this._ongoingJobsQueue),o(r),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new Wb(l,i,this._ongoingJobsQueue),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}})}broadcast(e,i,r){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a==null?void 0:a.invoke(e,i,r))}return s}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(Ui(`Worker closing, aborting job calling '${e.methodName}'`));for(const i of this._clientPromises)i.then(r=>r==null?void 0:r.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,Iet(this)}invoke(e,i,r){return this.apply(e,[i],r)}apply(e,i,r){const s=ma();this._ongoingJobsQueue.push({methodName:e,data:i,invokeOptions:r,resolver:s});for(let n=0;n<this._clientPromises.length;n++){const o=this._clients[n];o?o.jobAdded():this._clientPromises[n].then(a=>a==null?void 0:a.jobAdded())}return s.promise}createInvokeProxy(e){return FAe(this,e)}on(e,i){return Promise.all(this._clientPromises).then(()=>JS(this._clients.map(r=>r.on(e,i))))}openPorts(){return new Promise(e=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(i[s]=n.openPort()),--r==0&&e(i)})})}get test(){}};const jet={async request(t,e){var o,a;const i=t.options,r=i.responseType;i.signal=e==null?void 0:e.signal,i.responseType=r==="native"||r==="native-request-init"?"native-request-init":r&&["blob","json","text"].includes(r)&&((o=VZ(t.url))!=null&&o.after)?r:"array-buffer";const s=await fr(t.url,i),n={data:s.data,httpStatus:s.httpStatus,ssl:s.ssl};switch((a=s.requestOptions)==null?void 0:a.responseType){case"native-request-init":return delete n.data.signal,n;case"blob":n.data=await n.data.arrayBuffer();break;case"json":n.data=new TextEncoder().encode(JSON.stringify(n.data)).buffer;break;case"text":n.data=new TextEncoder().encode(n.data).buffer}return{result:n,transferList:[n.data]}}},Hde={};function Get(t){var i;const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:((i=t.packages)==null?void 0:i.concat())||[],paths:{...Hde.paths,...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=Hde.baseUrl),e}let Het=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>e[i](...r)})}},iU=class{constructor(){this._dispatcher=new Het,this._workerPostMessage({type:Da.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){tP(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,i,r){this._dispatcher.addEventListener(e,i,r)}removeEventListener(e,i,r){this._dispatcher.removeEventListener(e,i,r)}_workerPostMessage(e){tP(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const i=BL(e);if(i&&i.type===Da.OPEN){const{modulePath:r,jobId:s}=i;let n=await Wb.loadWorker(r);n||(n=await import(r));const o=Wb.connect(n);this._workerPostMessage({type:Da.OPENED,jobId:s,data:o})}}};const lX=()=>ne.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:qet}=Da,Wet='let globalId=0;const outgoing=new Map,configuration={CONFIGURATION};self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;let s=null;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());s=()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))},t.addEventListener("abort",s)}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})})).finally((()=>{t&&t.removeEventListener("abort",s)}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\nModules version: ${r}\nAssets version: ${n??s}\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let EF,CF;const qde="Failed to create Worker. Fallback to execute module in main thread";async function Zet(){if(!ue("esri-workers"))return Wde(new iU);if(!EF&&!CF)try{const e=Wet.split("{CONFIGURATION}").join(Yet());EF=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){CF=e||{}}let t;if(EF)try{t=new Worker(EF,{name:"esri-worker-"+Xet++})}catch{lX().warn(qde,CF),t=new iU}else lX().warn(qde,CF),t=new iU;return Wde(t)}async function Wde(t){return new Promise(e=>{function i(s){const n=BL(s);n&&n.type===qet&&(t.removeEventListener("message",i),t.removeEventListener("error",r),e(t))}function r(s){s.preventDefault(),t.removeEventListener("message",i),t.removeEventListener("error",r),lX().warn("Failed to create Worker. Fallback to execute module in main thread",s),(t=new iU).addEventListener("message",i),t.addEventListener("error",r)}t.addEventListener("message",i),t.addEventListener("error",r)})}function Yet(){let t;if(nr.default!=null){const s={...nr};delete s.default,t=JSON.parse(JSON.stringify(s))}else t=JSON.parse(JSON.stringify(nr));t.assetsPath=Lu(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?Lu(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=zu(),t.has={"esri-csp-restrictions":ue("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":ue("esri-2d-update-debug"),"esri-2d-log-updating":ue("esri-2d-log-updating"),"featurelayer-pbf":ue("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":ue("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":ue("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":ue("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":ue("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":ue("featurelayer-query-max-depth"),"featurelayer-query-pausing-enabled":ue("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-enabled":ue("featurelayer-snapshot-enabled"),"esri-atomics":ue("esri-atomics"),"esri-shared-array-buffer":ue("esri-shared-array-buffer"),"esri-tiles-debug":ue("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":ue("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":ue("feature-polyline-generalization-factor"),"host-webworker":1},t.workers.loaderUrl&&(t.workers.loaderUrl=Lu(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=Lu(t.workers.workerPath):t.workers.workerPath=Lu(tr("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=nr.workers.loaderConfig,i=Get({baseUrl:e==null?void 0:e.baseUrl,locale:zu(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:t,loaderConfig:i,kernelInfo:{buildDate:kEe,fullVersion:Ure,revision:UEe}})}let Xet=0;const{ABORT:Zde,INVOKE:Jet,OPEN:Qet,OPENED:Ket,RESPONSE:a$}=Da;let ett=class VAe{static async create(e){const i=await Zet();return new VAe(i,e)}constructor(e,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=i,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",r=>{r.preventDefault(),ne.getLogger("esri.core.workers.WorkerOwner").error(r)})}terminate(){this.worker.terminate()}async open(e,i={}){const{signal:r}=i,s=UAe();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:FD(r,()=>{this._outJobs.delete(s),this._post({type:Zde,jobId:s})})};this._outJobs.set(s,a),this._post({type:Qet,jobId:s,modulePath:e})})}_onMessage(e){const i=BL(e);if(i)switch(i.type){case Ket:this._onOpenedMessage(i);break;case a$:this._onResponseMessage(i);break;case Zde:this._onAbortMessage(i);break;case Jet:this._onInvokeMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,s=i.get(r);s&&(s.controller&&s.controller.abort(),i.delete(r))}_onInvokeMessage(e){const{methodName:i,jobId:r,data:s,abortable:n}=e,o=n?new AbortController:null,a=this._inJobs,l=jet[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(u){return void this._post({type:a$,jobId:r,error:zL(u)})}Zu(c)?(a.set(r,{controller:o,promise:c}),c.then(u=>{a.has(r)&&(a.delete(r),this._post({type:a$,jobId:r},u))},u=>{a.has(r)&&(a.delete(r),u||(u={message:"Error encountered at method"+i}),us(u)||this._post({type:a$,jobId:r,error:zL(u||{message:`Error encountered at method ${i}`})}))})):this._post({type:a$,jobId:r},c)}_onOpenedMessage(e){const{jobId:i,data:r}=e,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),Lr(s.abortHandle),s.resolve(r))}_onResponseMessage(e){const{jobId:i,error:r,data:s}=e,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),Lr(n.abortHandle),r?n.reject(B.fromJSON(JSON.parse(r))):n.resolve(s))}_post(e,i,r){return Pse(this.worker,e,i,r)}};const Yde=ue("host-browser")?Math.min(navigator.hardwareConcurrency-1,ue("workers-pool-size")):0;let nS=ue("esri-mobile")?Math.min(Yde,3):Yde;nS||(nS=ue("safari")&&ue("mac")?7:2);let Xde=0;const rU=[];function ttt(){zAe()}async function MF(t,e){const i=new Bet,{registryTarget:r,...s}=e;return await i.open(t,s),r&&Ret(r,i),i}async function itt(t,e={}){if(typeof t!="string")throw new B("workers:undefined-module","modulePath is missing");let i=e.strategy||"distributed";if(ue("host-webworker")&&!ue("esri-workers")&&(i="local"),i==="local"){let r=await Wb.loadWorker(t);r||(r=await import(t)),Dt(e.signal);const s=e.client||r;return MF([Wb.connect(r,e.schedule)],{...e,client:s})}if(await zAe(),Dt(e.signal),i==="dedicated"){const r=Xde++%nS;return MF([await rU[r].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const r=Math.min(e.maxNumWorkers,nS);if(r<nS){const s=new Array(r);for(let n=0;n<r;++n){const o=Xde++%nS;s[n]=rU[o].open(t,e)}return MF(s,e)}}return MF(rU.map(r=>r.open(t,e)),e)}let AF=null;async function zAe(){if(AF)return AF;new AbortController;const t=[];for(let e=0;e<nS;e++){const i=ett.create(e).then(r=>(rU[e]=r,r));t.push(i)}return AF=Promise.all(t),AF}function BAe(t,e){const i=bl(t),r=bl(e),s=i.store,n=r.store,o=r.metadata;for(const a in o){const l=o[a],c=s.originOf(a),u=n.originOf(a);if(!l.readOnly&&u!==ki.DEFAULTS)if(c===ki.DEFAULTS)t.set(a,n.get(a));else{const d=s.get(a),f=n.get(a);d&&f&&f instanceof Ue&&d instanceof Ue&&d instanceof f.constructor&&BAe(d,f)}}}let A3=class extends Ke{constructor(e){super(e),this.addHandles([this.on("before-add",i=>{i.item==null&&i.preventDefault()}),this.on("after-add",i=>this._own(i.item)),this.on("after-remove",i=>this._release(i.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(Ke.ofType(this.itemType.Type))(e):new Ke(e)}};function cX(t,e){return{type:t,cast:Bre,set(i){const r=gy(i,this._get(e),t);r.owner=this,this._set(e,r)}}}h([p()],A3.prototype,"owner",null),A3=h([I("esri.core.support.OwningCollection")],A3);function ZG(t,e,i,r){return t!=null&&(ms(e,r)?(A_(i,t),!0):(iu[0]=t[0],iu[1]=t[1],iu[2]=0,!!gs(iu,e,0,iu,r,0,1)&&(i[0]=iu[0],i[1]=iu[1],iu[0]=t[2],iu[1]=t[3],iu[2]=0,!!gs(iu,e,0,iu,r,0,1)&&(i[2]=iu[0],i[3]=iu[1],!0))))}const iu=C();function xl(t,e,i,r){if(Kc(t.spatialReference,i)){PF[0]=t.x,PF[1]=t.y;const n=t.z;return PF[2]=n??r??0,gs(PF,t.spatialReference,0,e,i,0,1)}const s=Hb(t,i);return!!s&&(e[0]=s==null?void 0:s.x,e[1]=s==null?void 0:s.y,e[2]=(s==null?void 0:s.z)??r??0,!0)}async function sB(t,e,i,r,s){return await xO(t.spatialReference,i,null,s),xl(t,e,i,r)}const PF=C();let B_=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&tP(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*Jde);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,Jde));e++)this._items.push(this._allocator())}};const Jde=1024;function ke(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function EP(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function Ose(t,e,i,r,s,n,o,a,l,c,u,d,f,m,g,y){return[t,e,i,r,s,n,o,a,l,c,u,d,f,m,g,y]}function rtt(t,e){return new Float64Array(t,e,16)}const Jr=ke();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Jr,clone:EP,create:ke,createView:rtt,fromValues:Ose},Symbol.toStringTag,{value:"Module"}));function Kr(){return[1,0,0,0,1,0,0,0,1]}function jAe(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function P3(t,e,i,r,s,n,o,a,l){return[t,e,i,r,s,n,o,a,l]}function stt(t,e){return new Float64Array(t,e,9)}const j2=Kr();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:j2,clone:jAe,create:Kr,createView:stt,fromValues:P3},Symbol.toStringTag,{value:"Module"}));function nd(){return[0,0,0,1]}function ntt(t){return[t[0],t[1],t[2],t[3]]}function ott(t,e,i,r){return[t,e,i,r]}function att(t,e){return new Float64Array(t,e,4)}const $se=nd();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:$se,clone:ntt,create:nd,createView:att,fromValues:ott},Symbol.toStringTag,{value:"Module"}));function gt(){return[0,0]}function MR(t){return[t[0],t[1]]}function Ei(t,e){return[t,e]}function GAe(t,e=gt()){const i=Math.min(2,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function ltt(t,e){return new Float64Array(t,e,2)}function HAe(){return gt()}function qAe(){return Ei(1,1)}function WAe(){return Ei(1,0)}function ZAe(){return Ei(0,1)}const m2=HAe(),YG=qAe(),YAe=WAe(),ctt=ZAe();Object.freeze(Object.defineProperty({__proto__:null,ONES:YG,UNIT_X:YAe,UNIT_Y:ctt,ZEROS:m2,clone:MR,create:gt,createView:ltt,fromArray:GAe,fromValues:Ei,ones:qAe,unitX:WAe,unitY:ZAe,zeros:HAe},Symbol.toStringTag,{value:"Module"}));function ci(){return[0,0,0,0]}function QD(t){return[t[0],t[1],t[2],t[3]]}function ri(t,e,i,r){return[t,e,i,r]}function jL(t,e=ci()){const i=Math.min(4,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function utt(t,e){return new Float64Array(t,e,4)}function XAe(){return ci()}function JAe(){return ri(1,1,1,1)}function QAe(){return ri(1,0,0,0)}function KAe(){return ri(0,1,0,0)}function ePe(){return ri(0,0,1,0)}function tPe(){return ri(0,0,0,1)}const jh=XAe(),Kd=JAe(),htt=QAe(),dtt=KAe(),ptt=ePe(),ftt=tPe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Kd,UNIT_W:ftt,UNIT_X:htt,UNIT_Y:dtt,UNIT_Z:ptt,ZEROS:jh,clone:QD,create:ci,createView:utt,fromArray:jL,fromValues:ri,ones:JAe,unitW:tPe,unitX:QAe,unitY:KAe,unitZ:ePe,zeros:XAe},Symbol.toStringTag,{value:"Module"}));let EO=class Fx{constructor(e){this._create=e,this._items=new Array,this._itemsPtr=0}get(){return this._itemsPtr===0&&tP(()=>this._reset()),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const e=2*this._itemsPtr;this._items.length>e&&(this._items.length=e),this._itemsPtr=0}static createVec2f64(){return new Fx(gt)}static createVec3f64(){return new Fx(C)}static createVec4f64(){return new Fx(ci)}static createMat3f64(){return new Fx(Kr)}static createMat4f64(){return new Fx(ke)}static createQuatf64(){return new Fx(nd)}get test(){}};const KZt=EO.createVec2f64(),rt=EO.createVec3f64(),Rse=EO.createVec4f64();EO.createMat3f64();const Ise=EO.createMat4f64(),mtt=EO.createQuatf64();function _m(t){return t?{origin:yn(t.origin),vector:yn(t.vector)}:{origin:C(),vector:C()}}function gtt(t,e){const i=_tt.get();return i.origin=t,i.vector=e,i}function eYt(t,e=_m()){return ytt(t.origin,t.vector,e)}function ytt(t,e,i=_m()){return ve(i.origin,t),ve(i.vector,e),i}function kS(t,e,i=_m()){return ve(i.origin,t),$e(i.vector,e,t),i}function Lse(t,e){const i=$e(rt.get(),e,t.origin),r=Te(t.vector,i),s=Te(t.vector,t.vector),n=Ne(r/s,0,1),o=$e(rt.get(),de(rt.get(),t.vector,n),i);return Te(o,o)}function tYt(t,e,i){return uX(t,e,0,1,i)}function iYt(t,e,i){return Ee(i,t.origin,de(i,t.vector,e))}function uX(t,e,i,r,s){const{vector:n,origin:o}=t,a=$e(rt.get(),e,o),l=Te(n,a)/pl(n);return de(s,n,Ne(l,i,r)),Ee(s,s,t.origin)}function rYt(t,e){if(rPe(t,gtt(e.origin,e.direction),!1,nB)){const{tA:i,pB:r,distance2:s}=nB;if(i>=0&&i<=1)return s;if(i<0)return yo(t.origin,r);if(i>1)return yo(Ee(rt.get(),t.origin,t.vector),r)}return null}function iPe(t,e,i){return!!rPe(t,e,!0,nB)&&(ve(i,nB.pA),!0)}function rPe(t,e,i,r){const n=t.origin,o=Ee(rt.get(),n,t.vector),a=e.origin,l=Ee(rt.get(),a,e.vector),c=rt.get(),u=rt.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],u[0]=l[0]-a[0],u[1]=l[1]-a[1],u[2]=l[2]-a[2],Math.abs(u[0])<1e-6&&Math.abs(u[1])<1e-6&&Math.abs(u[2])<1e-6)return!1;const d=rt.get();if(d[0]=o[0]-n[0],d[1]=o[1]-n[1],d[2]=o[2]-n[2],Math.abs(d[0])<1e-6&&Math.abs(d[1])<1e-6&&Math.abs(d[2])<1e-6)return!1;const f=c[0]*u[0]+c[1]*u[1]+c[2]*u[2],m=u[0]*d[0]+u[1]*d[1]+u[2]*d[2],g=c[0]*d[0]+c[1]*d[1]+c[2]*d[2],y=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],v=(d[0]*d[0]+d[1]*d[1]+d[2]*d[2])*y-m*m;if(Math.abs(v)<1e-6)return!1;let b=(f*m-g*y)/v,w=(f+m*b)/y;i&&(b=Ne(b,0,1),w=Ne(w,0,1));const x=rt.get(),T=rt.get();return x[0]=n[0]+b*d[0],x[1]=n[1]+b*d[1],x[2]=n[2]+b*d[2],T[0]=a[0]+w*u[0],T[1]=a[1]+w*u[1],T[2]=a[2]+w*u[2],r.tA=b,r.tB=w,r.pA=x,r.pB=T,r.distance2=yo(x,T),!0}const nB={tA:0,tB:0,pA:C(),pB:C(),distance2:0},_tt=new B_(()=>_m());function np(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function vtt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ss(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function Dse(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function sPe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function nPe(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function oPe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function btt(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function wtt(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function xtt(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t}function Ttt(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t}function Stt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function g2(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Ett(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}function aPe(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(i*i+r*r+s*s+n*n)}function oB(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2],n=e[3]-t[3];return i*i+r*r+s*s+n*n}function Nse(t){const e=t[0],i=t[1],r=t[2],s=t[3];return Math.sqrt(e*e+i*i+r*r+s*s)}function Fse(t){const e=t[0],i=t[1],r=t[2],s=t[3];return e*e+i*i+r*r+s*s}function Ctt(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function Mtt(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function lPe(t,e){const i=e[0],r=e[1],s=e[2],n=e[3];let o=i*i+r*r+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),t[0]=i*o,t[1]=r*o,t[2]=s*o,t[3]=n*o),t}function cPe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function XG(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=o+r*(i[2]-o),t[3]=a+r*(i[3]-a),t}function Att(t,e){const i=WD;let r,s,n,o,a,l;e=e||1;do r=2*i()-1,s=2*i()-1,a=r*r+s*s;while(a>=1);do n=2*i()-1,o=2*i()-1,l=n*n+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*r,t[1]=e*s,t[2]=e*n*c,t[3]=e*o*c,t}function Vu(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3];return t[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*o,t[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*o,t[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*o,t[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*o,t}function Ptt(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2],c=i[3],u=c*r+a*n-l*s,d=c*s+l*r-o*n,f=c*n+o*s-a*r,m=-o*r-a*s-l*n;return t[0]=u*c+m*-o+d*-l-f*-a,t[1]=d*c+m*-a+f*-o-u*-l,t[2]=f*c+m*-l+u*-a-d*-o,t[3]=e[3],t}function Ott(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function EA(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function y2(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=Bo();return Math.abs(i-o)<=u*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=u*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=u*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=u*Math.max(1,Math.abs(n),Math.abs(c))}const $tt=sPe,Rtt=nPe,Itt=oPe,Ltt=aPe,Dtt=oB,Ntt=Nse,Ftt=Fse,uPe=Object.freeze(Object.defineProperty({__proto__:null,add:Dse,ceil:btt,copy:np,copyVec3:vtt,dist:Ltt,distance:aPe,div:Itt,divide:oPe,dot:cPe,equals:y2,exactEquals:EA,floor:wtt,inverse:Mtt,len:Ntt,length:Nse,lerp:XG,max:Ttt,min:xtt,mul:Rtt,multiply:nPe,negate:Ctt,normalize:lPe,random:Att,round:Stt,scale:g2,scaleAndAdd:Ett,set:Ss,sqrDist:Dtt,sqrLen:Ftt,squaredDistance:oB,squaredLength:Fse,str:Ott,sub:$tt,subtract:sPe,transformMat4:Vu,transformQuat:Ptt},Symbol.toStringTag,{value:"Module"}));function sYt(t,e,i){const r=Te(t,e)/Te(t,t);return de(i,t,r)}function bb(t,e){return Te(t,e)/Ve(t)}function kse(t,e){const i=Te(t,e)/(Ve(t)*Ve(e));return-vo(i)}function hPe(t,e,i){Ce(OF,t),Ce(VH,e);const r=Te(OF,VH),s=vo(r),n=mt(OF,OF,VH);return Te(n,i)<0?2*Math.PI-s:s}const OF=C(),VH=C();function CP(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],i=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],r=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}function ktt(t,e){const i=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),r=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),s=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return pe(t,i,r,s),t}function nYt(t,e,i){i=i||t;const r=Te(t,e);pe(i,t[0]-r*e[0],t[1]-r*e[1],t[2]-r*e[2]),Ce(i,i)}function Utt(t,e,i){Math.abs(t[0])>Math.abs(t[1])?pe(e,0,1,0):pe(e,1,0,0),mt(i,t,e),mt(e,i,t),Ce(i,i),Ce(e,e)}function $F(t,e,i,r,s,n){const o=t+(e-t)*s;return o+(i+(r-i)*s-o)*n}function Vtt(t,e,i,r=C()){const s=Ve(t),n=Ve(e),o=Te(t,e)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*s+i*n)/Math.sin(a),c=l/s*Math.sin((1-i)*a),u=l/n*Math.sin(i*a);return de(oS,t,c),de(aS,e,u),Ee(r,oS,aS)}return Sr(r,t,e,i)}function oYt(t,e,i,r=C(),s=C()){const n=Ve(t),o=Ve(e),a=Te(t,e)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),u=Math.sin(i*l),d=Math.sin((1-i)*l),f=(1-i)*n+i*o;{const m=f/c,g=m/o*u;de(oS,t,m/n*d),de(aS,e,g),Ee(r,oS,aS)}{const m=1/n*(-Math.cos((1-i)*l)*l*f+d*(-n+o));de(oS,t,m);const g=1/o*(Math.cos(i*l)*l*f+u*(-n+o));de(aS,e,g),Ee(s,oS,aS),de(s,s,1/c)}return s}return Sr(r,t,e,i),$e(s,e,t),Ce(s,s),s}function aB(t,e,i){t=Ce(oS,t),e=Ce(aS,e);const r=vo(Te(t,e));if(i){const s=mt(ztt,t,e);if(Te(s,i)<0)return-r}return r}function sU(t){const e=t.length;return i=>{if(i<=t[0][0])return t[0][1];if(i>=t[e-1][0])return t[e-1][1];let r=1;for(;i>t[r][0];)r++;const s=t[r-1][0],n=t[r][0],o=(n-i)/(n-s);return o*t[r-1][1]+(1-o)*t[r][1]}}function aYt(t,e,i,r){$e(Qde,e,t),$e(Kde,i,t),mt(r,Qde,Kde),Ce(r,r),r[3]=-Te(t,r)}function lYt(t,e){if(pe(e,0,0,0),t.length>0){for(let i=0;i<t.length;++i)Ee(e,e,t[i]);de(e,e,1/t.length)}}const Qde=C(),Kde=C(),ztt=C(),oS=C(),aS=C();function rr(t=AR){return[t[0],t[1],t[2],t[3]]}function Btt(t=AR[0],e=AR[1],i=AR[2],r=AR[3]){return Use(t,e,i,r,Rse.get())}function JG(t,e){return Use(e[0],e[1],e[2],e[3],t)}function cYt(t){return t}function Use(t,e,i,r,s=rr()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function dPe(t,e,i){return ve(i,t),i[3]=e,i}function KD(t,e,i){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function hl(t,e,i,r=rr()){const s=i[0]-e[0],n=i[1]-e[1],o=i[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],u=n*c-o*l,d=o*a-s*c,f=s*l-n*a,m=u*u+d*d+f*f,g=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return r[0]=u*g,r[1]=d*g,r[2]=f*g,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function Vse(t,e,i,r=0,s=Math.floor(i*(1/3)),n=Math.floor(i*(2/3))){if(i<3)return!1;e(l$,r);let o=s,a=!1;for(;o<i-1&&!a;)e(pE,o),o++,a=!Uo(l$,pE);if(!a)return!1;for(o=Math.max(o,n),a=!1;o<i&&!a;)e(UT,o),o++,$e(RF,l$,pE),Ce(RF,RF),$e(IF,pE,UT),Ce(IF,IF),a=!Uo(l$,UT)&&!Uo(pE,UT)&&Math.abs(Te(RF,IF))<Gtt;return a?(hl(l$,pE,UT,t),!0):(r!==0||s!==1||n!==2)&&Vse(t,e,i,0,1,2)}function jtt(t,e,i=!0){const r=e.length/3;return Vse(t,(s,n)=>pe(s,e[3*n+0],e[3*n+1],e[3*n+2]),i?r-1:r)}const Gtt=.99619469809,l$=C(),pE=C(),UT=C(),RF=C(),IF=C();function hX(t,e,i){return e!==t&&JG(t,e),t[3]=-Te(t,i),t}function dX(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function GL(t,e,i,r){return mt(UT,e,t),KD(i,UT,r)}function uYt(t,e,i,r){return QG(t,e,$e(rt.get(),i,e),Xtt,r)}function G2(t,e,i){return e!=null&&QG(t,e.origin,e.direction,Jtt,i)}function Htt(t,e,i){return QG(t,e.origin,e.vector,ry.NONE,i)}function qtt(t,e,i){return QG(t,e.origin,e.vector,ry.CLAMP,i)}function pPe(t,e){return Rr(t,e)>=0}function Wtt(t,e){const i=Te(t,e.ray.direction),r=-Rr(t,e.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const s=r/i;return i>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function Ztt(t,e){const i=Te(t,e.ray.direction),r=-Rr(t,e.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const s=r/i;return i>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1}function Ytt(t,e,i){const r=de(rt.get(),t,-t[3]),s=pX(t,$e(rt.get(),e,r),rt.get());return Ee(i,s,r),i}function hYt(t,e,i,r){const s=t,n=rt.get(),o=rt.get();Utt(s,n,o);const a=$e(rt.get(),i,e),l=bb(n,a),c=bb(o,a),u=bb(s,a);return pe(r,l,c,u)}function pX(t,e,i){const r=de(rt.get(),t,Te(t,e));return $e(i,e,r),i}function dYt(t,e){return Math.abs(Rr(t,e))}function Rr(t,e){return Te(t,e)+t[3]}function QG(t,e,i,r,s){const n=Te(t,i);if(n===0)return!1;let o=-(Te(t,e)+t[3])/n;return r&ry.CLAMP&&(o=Ne(o,0,1)),!(!(r&ry.INFINITE_MIN)&&o<0||!(r&ry.INFINITE_MAX)&&o>1)&&(Ee(s,e,de(s,i,o)),!0)}const AR=[0,0,1,0];var ry;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(ry||(ry={}));const Xtt=ry.INFINITE_MIN|ry.INFINITE_MAX,Jtt=ry.INFINITE_MAX;function mo(t){return t?epe(yn(t.origin),yn(t.direction)):epe(C(),C())}function epe(t,e){return{origin:t,direction:e}}function pYt(t,e){return Lb(t.origin,e.origin)&&Lb(t.direction,e.direction)}function td(t,e){const i=eit.get();return i.origin=t,i.direction=e,i}function lB(t,e=mo()){return mPe(t.origin,t.direction,e)}function fPe(t,e,i=mo()){return ve(i.origin,t),$e(i.direction,e,t),i}function mPe(t,e,i=mo()){return ve(i.origin,t),ve(i.direction,e),i}function Qtt(t,e){const i=mt(rt.get(),Ce(rt.get(),t.direction),$e(rt.get(),e,t.origin));return Te(i,i)}function Ktt(t,e,i){const r=Te(t.direction,$e(i,e,t.origin));return Ee(i,t.origin,de(i,t.direction,r)),i}function fYt(t,e,i,r){const s=t.direction,n=e.direction,o=Li(zH,e.origin,t.origin),a=Te(s,n),l=Te(n,o),c=Te(s,o),u=Te(s,s),d=Te(n,n),f=(a*l+c*d)/(u*d-a*a),m=(a*c-l*u)/(u*d-a*a);return Ee(i,t.origin,de(zH,s,f)),Ee(r,e.origin,de(zH,n,m)),[i,r]}const eit=new B_(()=>mo()),zH=C(),BH=()=>ne.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let tit=class{constructor(){this.plane=rr(),this.origin=C(),this.basis1=C(),this.basis2=C()}};const gPe=tit;function j_(t=MPe){return{plane:rr(t.plane),origin:yn(t.origin),basis1:yn(t.basis1),basis2:yn(t.basis2)}}function iit(t,e,i){const r=fit.get();return r.origin=t,r.basis1=e,r.basis2=i,r.plane=Btt(0,0,0,0),KG(r),r}function H2(t,e=j_()){return zse(t.origin,t.basis1,t.basis2,e)}function rit(t,e){ve(e.origin,t.origin),ve(e.basis1,t.basis1),ve(e.basis2,t.basis2),JG(e.plane,t.plane)}function zse(t,e,i,r=j_()){return ve(r.origin,t),ve(r.basis1,e),ve(r.basis2,i),KG(r),dit(r,"fromValues()"),r}function KG(t){GL(t.basis2,t.basis1,t.origin,t.plane)}function yPe(t,e,i){t!==i&&H2(t,i);const r=de(rt.get(),P_(t),e);return Ee(i.origin,i.origin,r),i.plane[3]-=e,i}function sit(t,e,i){return _Pe(e,i),yPe(i,Hse(t,t.origin),i),i}function _Pe(t,e=j_()){const i=(t[2]-t[0])/2,r=(t[3]-t[1])/2;return pe(e.origin,t[0]+i,t[1]+r,0),pe(e.basis1,i,0,0),pe(e.basis2,0,r,0),Use(0,0,1,0,e.plane),e}function Bse(t,e,i){return!!G2(t.plane,e,i)&&EPe(t,i)}function nit(t,e,i){if(Bse(t,e,i))return i;const r=vPe(t,e,rt.get());return Ee(i,e.origin,de(rt.get(),e.direction,Ar(e.origin,r)/Ve(e.direction))),i}function vPe(t,e,i){const r=cB.get();CPe(t,e,r,cB.get());let s=Number.POSITIVE_INFINITY;for(const n of Wse){const o=qse(t,n,e6.get()),a=rt.get();if(Htt(r,o,a)){const l=U_(rt.get(),e.origin,a),c=Math.abs(vo(Te(e.direction,l)));c<s&&(s=c,ve(i,a))}}return s===Number.POSITIVE_INFINITY?bPe(t,e,i):i}function bPe(t,e,i){if(Bse(t,e,i))return i;const r=cB.get(),s=cB.get();CPe(t,e,r,s);let n=Number.POSITIVE_INFINITY;for(const o of Wse){const a=qse(t,o,e6.get()),l=rt.get();if(qtt(r,a,l)){const c=Qtt(e,l);if(!pPe(s,l))continue;c<n&&(n=c,ve(i,l))}}return jse(t,e.origin)<n&&wPe(t,e.origin,i),i}function wPe(t,e,i){const r=Ytt(t.plane,e,rt.get()),s=uX(tpe(t,t.basis1),r,-1,1,rt.get()),n=uX(tpe(t,t.basis2),r,-1,1,rt.get());return $e(i,Ee(rt.get(),s,n),t.origin),i}function xPe(t,e,i){const{origin:r,basis1:s,basis2:n}=t,o=$e(rt.get(),e,r),a=bb(s,o),l=bb(n,o),c=bb(P_(t),o);return pe(i,a,l,c)}function jse(t,e){const i=xPe(t,e,rt.get()),{basis1:r,basis2:s}=t,n=Ve(r),o=Ve(s),a=Math.max(Math.abs(i[0])-n,0),l=Math.max(Math.abs(i[1])-o,0),c=i[2];return a*a+l*l+c*c}function oit(t,e){return Math.sqrt(jse(t,e))}function ait(t,e){let i=Number.NEGATIVE_INFINITY;for(const r of Wse){const s=qse(t,r,e6.get()),n=Lse(s,e);n>i&&(i=n)}return Math.sqrt(i)}function Gse(t,e){return pPe(t.plane,e)&&EPe(t,e)}function lit(t,e,i,r){return hit(t,i,r)}function Hse(t,e){const i=-t.plane[3];return bb(P_(t),e)-i}function cit(t,e,i,r){const s=Hse(t,e),n=de(pit,P_(t),i-s);return Ee(r,e,n),r}function TPe(t,e){return Uo(t.basis1,e.basis1)&&Uo(t.basis2,e.basis2)&&Uo(t.origin,e.origin)}function SPe(t,e,i){return t!==i&&H2(t,i),eo(fE,e),Hu(fE,fE),nt(i.basis1,t.basis1,fE),nt(i.basis2,t.basis2,fE),nt(i.plane,t.plane,fE),nt(i.origin,t.origin,e),hX(i.plane,i.plane,i.origin),i}function uit(t,e,i,r){return t!==r&&H2(t,r),qu(jH,e,i),nt(r.basis1,t.basis1,jH),nt(r.basis2,t.basis2,jH),KG(r),r}function P_(t){return t.plane}function hit(t,e,i){switch(e){case Ts.X:ve(i,t.basis1),Ce(i,i);break;case Ts.Y:ve(i,t.basis2),Ce(i,i);break;case Ts.Z:ve(i,P_(t))}return i}function EPe(t,e){const i=$e(rt.get(),e,t.origin),r=pl(t.basis1),s=pl(t.basis2),n=Te(t.basis1,i),o=Te(t.basis2,i);return-n-r<0&&n-r<0&&-o-s<0&&o-s<0}function tpe(t,e){const i=e6.get();return ve(i.origin,t.origin),ve(i.vector,e),i}function qse(t,e,i){const{basis1:r,basis2:s,origin:n}=t,o=de(rt.get(),r,e.origin[0]),a=de(rt.get(),s,e.origin[1]);Ee(i.origin,o,a),Ee(i.origin,i.origin,n);const l=de(rt.get(),r,e.direction[0]),c=de(rt.get(),s,e.direction[1]);return de(i.vector,Ee(l,l,c),2),i}function dit(t,e){Math.abs(Te(t.basis1,t.basis2)/(Ve(t.basis1)*Ve(t.basis2)))>1e-6&&BH().warn(e,"Provided basis vectors are not perpendicular"),Math.abs(Te(t.basis1,P_(t)))>1e-6&&BH().warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Te(P_(t),t.origin)-t.plane[3])>1e-6&&BH().warn(e,"Plane offset is not consistent with plane origin")}function CPe(t,e,i,r){const s=P_(t);GL(s,e.direction,e.origin,i),GL(i,s,e.origin,r)}const MPe={plane:rr(),origin:qe(0,0,0),basis1:qe(1,0,0),basis2:qe(0,1,0)},cB=new B_(rr),e6=new B_(_m),pit=C(),fit=new B_(()=>j_()),Wse=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],fE=ke(),jH=ke(),mit=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:gPe,altitudeAt:Hse,axisAt:lit,closestPoint:bPe,closestPointOnSilhouette:vPe,copy:H2,copyWithoutVerify:rit,create:j_,distance:oit,distance2:jse,distanceToSilhouette:ait,elevate:yPe,equals:TPe,extrusionContainsPoint:Gse,fromAABoundingRect:_Pe,fromValues:zse,intersectRay:Bse,intersectRayClosestSilhouette:nit,normal:P_,projectPoint:wPe,projectPointLocal:xPe,rotate:uit,setAltitudeAt:cit,setExtent:sit,transform:SPe,up:MPe,updateUnboundedPlane:KG,wrap:iit},Symbol.toStringTag,{value:"Module"})),git=new Ye(iCe),DM=new Ye(SG),NM=new Ye(EG),yit=new Ye(rCe);function id(t){const e=ipe.get(t);if(e)return e;let i=git;if(t)if(t===DM)i=DM;else if(t===NM)i=NM;else{const r=t.wkid,s=t.latestWkid;if(r!=null||s!=null)aP(r)||aP(s)?i=DM:(lP(r)||lP(s))&&(i=NM);else{const n=t.wkt2??t.wkt;if(n){const o=n.toUpperCase();o===_it?i=DM:o===vit&&(i=NM)}}}return ipe.set(t,i),i}const ipe=new Map,_it=DM.wkt.toUpperCase(),vit=NM.wkt.toUpperCase(),APe=_n();function _n(){return ci()}const bit=y2,wit=y2;function _2(t,e){return np(e,t)}function PPe(t,e){return ri(t[0],t[1],t[2],e)}function xit(t){return t}function Tit(t){t[0]=t[1]=t[2]=t[3]=0}function t6(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function wb(t){return t[3]}function Sit(t){return t}function OPe(t,e,i,r){return ri(t,e,i,r)}function Eit(t,e,i){return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),i[3]=t[3]+e,i}function Cit(t,e,i){return t!==i&&_2(t,i),i}function yw(t,e,i){if(e==null||!$Pe(t,e,uB))return!1;let{t0:r,t1:s}=uB;if((r<0||s<r&&s>0)&&(r=s),r<0)return!1;if(i){const{origin:n,direction:o}=e;i[0]=n[0]+o[0]*r,i[1]=n[1]+o[1]*r,i[2]=n[2]+o[2]*r}return!0}function Mit(t,e,i){const r=fPe(e,i);if(!$Pe(t,r,uB))return[];const{origin:s,direction:n}=r,{t0:o,t1:a}=uB,l=c=>{const u=C();return Dn(u,s,n,c),Zse(t,u,u)};return Math.abs(o-a)<Bo()?[l(o)]:[l(o),l(a)]}const uB={t0:0,t1:0};function $Pe(t,e,i){const{origin:r,direction:s}=e,n=Ait;n[0]=r[0]-t[0],n[1]=r[1]-t[1],n[2]=r[2]-t[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(o===0)return!1;const a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);return i.t0=(-a-c)/(2*o),i.t1=(-a+c)/(2*o),!0}const Ait=C();function fX(t,e){return yw(t,e,null)}function Pit(t,e,i){if(yw(t,e,i))return i;const r=CO(t,e,rt.get());return Ee(i,e.origin,de(rt.get(),e.direction,Ar(e.origin,r)/Ve(e.direction))),i}function CO(t,e,i){const r=rt.get(),s=Ise.get();mt(r,e.origin,e.direction);const n=wb(t);mt(i,r,e.origin),de(i,i,1/Ve(i)*n);const o=IPe(t,e.origin),a=kse(e.origin,i);return qu(s,a+o,r),nt(i,i,s),i}function Oit(t,e,i){return yw(t,e,i)?i:(Ktt(e,t,i),Zse(t,i,i))}function Zse(t,e,i){const r=$e(rt.get(),e,t),s=de(rt.get(),r,t[3]/Ve(r));return Ee(i,s,t)}function RPe(t,e){const i=$e(rt.get(),e,t),r=pl(i),s=t[3]*t[3];return Math.sqrt(Math.abs(r-s))}function IPe(t,e){const i=$e(rt.get(),e,t),r=Ve(i),s=wb(t),n=s+Math.abs(s-r);return vo(s/n)}const GH=C();function LPe(t,e,i,r){const s=$e(GH,e,t);switch(i){case Ts.X:{const n=Khe(s,GH)[2];return pe(r,-Math.sin(n),Math.cos(n),0)}case Ts.Y:{const n=Khe(s,GH),o=n[1],a=n[2],l=Math.sin(o);return pe(r,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case Ts.Z:return Ce(r,s);default:return}}function DPe(t,e){const i=$e(mX,e,t);return Ve(i)-t[3]}function $it(t,e,i,r){const s=DPe(t,e),n=LPe(t,e,Ts.Z,mX),o=de(mX,n,i-s);return Ee(r,e,o)}function Rit(t,e){const i=yo(t,e),r=wb(t);return i<=r*r}function Iit(t,e,i=ci()){const r=Ar(t,e),s=t[3],n=e[3];return r+n<s?(np(i,t),i):r+s<n?(np(i,e),i):(Sr(i,t,e,(r+n-s)/(2*r)),i[3]=(r+s+n)/2,i)}const mX=C(),i6=_n(),Lit=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:APe,altitudeAt:DPe,angleToSilhouette:IPe,axisAt:LPe,clear:Tit,closestPoint:Oit,closestPointOnSilhouette:CO,containsPoint:Rit,copy:_2,create:_n,distanceToSilhouette:RPe,elevate:Eit,equals:wit,exactEquals:bit,fromCenterAndRadius:PPe,fromRadius:t6,fromValues:OPe,getCenter:Sit,getRadius:wb,intersectLine:Mit,intersectRay:yw,intersectRayClosestSilhouette:Pit,intersectsRay:fX,projectPoint:Zse,setAltitudeAt:$it,setExtent:Cit,tmpSphere:i6,union:Iit,wrap:xit},Symbol.toStringTag,{value:"Module"}));function Dit(t){const{value:e,operations:i}=t;return{operations:i,value:i.create(e)}}function Nit(t,e,i){return t.operations.setExtent(t.value,e,i.value),i}function Fit(t){return{operations:t,value:t.create()}}function NPe(t,e,i=Fit(t)){return i.operations=t,t.copy(e,i.value),i}function kit(t){return NPe(Lit,OPe(0,0,0,br(t).radius))}const rpe=2**50;function Uit(){return NPe(mit,zse([0,0,0],[rpe,0,0],[0,rpe,0]))}function Vit(t,e,i){return t.operations.axisAt(t.value,e,Ts.Z,i)}function zit(t,e,i,r){return t.operations.axisAt(t.value,e,i,r)}function Bit(t,e,i){return t.operations.intersectRay(t.value,e,i)}function jit(t,e,i){return t.operations.intersectRayClosestSilhouette(t.value,e,i)}function Git(t,e){return t.operations.altitudeAt(t.value,e)}function FPe(t,e,i,r){return t.operations.setAltitudeAt(t.value,e,i,r)}function Hit(t,e,i,r){return e!==r&&An(r,e),pe(mE,r[12],r[13],r[14]),FPe(t,mE,i,mE),r[12]=mE[0],r[13]=mE[1],r[14]=mE[2],r}function HH(t,e,i){return t.operations.elevate(t.value,e,i.value)}const mE=C();function spe(t,e,i,r,s){return s[0]=Te(t,e),s[1]=Te(t,i),s[2]=Te(t,r),s}function gX(t,e,i,r,s){ve(i,t),ve(LF,e),Ce(LF,LF),mt(r,LF,i),mt(s,r,i)}function qit(t,e){return t?id(e):e.isGeographic?Ye.PlateCarree:e}const LF=C(),Yse=96;function gYt(t,e){const i=t.extent,r=t.width,s=cc(i==null?void 0:i.spatialReference);return i&&r?i.width/r*s*Zre*Yse:0}function Wit(t,e){return t/(cc(e)*Zre*Yse)}function Zit(t){return t/(Zre*Yse)}function yYt(t,e,i){return Yit(t,e)&&Xit(t,i)}function Yit(t,e){return e===0||yb(t,e)||t<e}function Xit(t,e){return e===0||yb(t,e)||t>e}let MP=class extends A3{constructor(e){super(e),this.addHandles(this.on("before-add",i=>{i.item!=null&&i.item.parent===this.owner&&(ne.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),i.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};MP=h([I("esri.support.AnalysesCollection")],MP);const nU={widthBreakpoint:{getValue(t){const e=t.viewSize[0],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,i=e[0],r=e[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},qH={xsmall:544,small:768,medium:992,large:1200};function Jit(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function WH(t,e){return e?nU[t].valueToClassName[e].split(" "):[]}const Qit=t=>{let e=class extends t{constructor(...i){super(...i),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=qH}initialize(){this.addHandles(te(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),pt))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(i){if(i!==this._get("breakpoints")){if(!Jit(i)){const r=JSON.stringify(qH,null,2);console.warn("provided breakpoints are not valid, using defaults:"+r),i=qH}this._set("breakpoints",{...i})}}_updateClassNames(){if(!this.container)return;const i=Ou.acquire(),r=Ou.acquire();let s,n=!1;for(s in nU){const o=this[s],a=nU[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,WH(s,o).forEach(l=>r.push(l)),WH(s,a).forEach(l=>i.push(l)))}n&&(this._applyClassNameChanges(i,r),Ou.release(i),Ou.release(r))}_applyClassNameChanges(i,r){const s=this.container;s&&(r.forEach(n=>s.classList.remove(n)),i.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in nU)WH(r,this[r]).forEach(s=>i.classList.remove(s))}};return h([p()],e.prototype,"breakpoints",null),h([p()],e.prototype,"orientation",void 0),h([p()],e.prototype,"widthBreakpoint",void 0),h([p()],e.prototype,"heightBreakpoint",void 0),e=h([I("esri.views.BreakpointsOwner")],e),e};let f_=class extends Ue{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,i,r={}){return this._installWatch(e,i,r,te)}addWhen(e,i,r={}){return this._installWatch(e,i,r,jo)}addOnCollectionChange(e,i,{initial:r=!1,final:s=!1}={}){const n=++this._handleId;return this.addHandles([on(e,"after-changes",this._createSyncUpdatingCallback(),lr),on(e,"change",i,{onListenerAdd:r?o=>i({added:o.toArray(),removed:[]}):void 0,onListenerRemove:s?o=>i({added:[],removed:o.toArray()}):void 0})],n),Gi(()=>this.removeHandles(n))}addPromise(e){if(e==null)return e;const i=++this._handleId;this.addHandles(Gi(()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this.hasHandles(DF)||this._set("updating",!1))}),i),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this.removeHandles(i);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,i,r={},s){const n=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,n);const o=s(e,i,r);return this.addHandles(o,n),Gi(()=>this.removeHandles(n))}_installSyncUpdatingWatch(e,i){const r=this._createSyncUpdatingCallback(),s=te(e,r,{sync:!0,equals:()=>!1});return this.addHandles(s,i),s}_createSyncUpdatingCallback(){return()=>{this.removeHandles(DF),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles(k2(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(DF))}),DF)}}};h([p({readOnly:!0})],f_.prototype,"updating",void 0),f_=h([I("esri.core.support.UpdatingHandles")],f_);const DF=-42;/*!
 * @esri/arcgis-html-sanitizer - v4.0.3 - Wed Jul 03 2024 17:50:35 GMT-0400 (Eastern Daylight Time)
 * Copyright (c) 2024 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var hB=function(){return hB=Object.assign||function(e){for(var i,r=1,s=arguments.length;r<s;r++){i=arguments[r];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},hB.apply(this,arguments)},yX={exports:{}},Fn={},_X={exports:{}},q2={};function kPe(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function Kit(t,e,i){}function ert(t,e,i){}var trt=/javascript\s*\:/img;function irt(t,e){return trt.test(e)?"":e}q2.whiteList=kPe();q2.getDefaultWhiteList=kPe;q2.onAttr=Kit;q2.onIgnoreAttr=ert;q2.safeAttrValue=irt;var rrt={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},c$=rrt;function srt(t,e){t=c$.trimRight(t),t[t.length-1]!==";"&&(t+=";");var i=t.length,r=!1,s=0,n=0,o="";function a(){if(!r){var u=c$.trim(t.slice(s,n)),d=u.indexOf(":");if(d!==-1){var f=c$.trim(u.slice(0,d)),m=c$.trim(u.slice(d+1));if(f){var g=e(s,o.length,f,m,u);g&&(o+=g+"; ")}}}s=n+1}for(;n<i;n++){var l=t[n];if(l==="/"&&t[n+1]==="*"){var c=t.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return c$.trim(o)}var nrt=srt,NF=q2,ort=nrt;function npe(t){return t==null}function art(t){var e={};for(var i in t)e[i]=t[i];return e}function UPe(t){t=art(t||{}),t.whiteList=t.whiteList||NF.whiteList,t.onAttr=t.onAttr||NF.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||NF.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||NF.safeAttrValue,this.options=t}UPe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,s=i.onAttr,n=i.onIgnoreAttr,o=i.safeAttrValue,a=ort(t,function(l,c,u,d,f){var m=r[u],g=!1;if(m===!0?g=m:typeof m=="function"?g=m(d):m instanceof RegExp&&(g=m.test(d)),g!==!0&&(g=!1),d=o(u,d),!!d){var y={position:c,sourcePosition:l,source:f,isWhite:g};if(g){var v=s(u,d,y);return npe(v)?u+":"+d:v}else{var v=n(u,d,y);if(!npe(v))return v}}});return a};var lrt=UPe;(function(t,e){var i=q2,r=lrt;function s(o,a){var l=new r(a);return l.process(o)}e=t.exports=s,e.FilterCSS=r;for(var n in i)e[n]=i[n]})(_X,_X.exports);var Xse=_X.exports,Jse={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,s;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,s=t.length;r<s;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,i=e.exec(t);return i?i.index:-1}},crt=Xse.FilterCSS,urt=Xse.getDefaultWhiteList,dB=Jse;function VPe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var zPe=new crt;function hrt(t,e,i){}function drt(t,e,i){}function prt(t,e,i){}function frt(t,e,i){}function BPe(t){return t.replace(grt,"&lt;").replace(yrt,"&gt;")}function mrt(t,e,i,r){if(i=ZPe(i),e==="href"||e==="src"){if(i=dB.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(e==="background"){if(FF.lastIndex=0,FF.test(i))return""}else if(e==="style"){if(ope.lastIndex=0,ope.test(i)||(ape.lastIndex=0,ape.test(i)&&(FF.lastIndex=0,FF.test(i))))return"";r!==!1&&(r=r||zPe,i=r.process(i))}return i=YPe(i),i}var grt=/</g,yrt=/>/g,_rt=/"/g,vrt=/&quot;/g,brt=/&#([a-zA-Z0-9]*);?/gim,wrt=/&colon;?/gim,xrt=/&newline;?/gim,FF=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,ope=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,ape=/u\s*r\s*l\s*\(.*/gi;function jPe(t){return t.replace(_rt,"&quot;")}function GPe(t){return t.replace(vrt,'"')}function HPe(t){return t.replace(brt,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function qPe(t){return t.replace(wrt,":").replace(xrt," ")}function WPe(t){for(var e="",i=0,r=t.length;i<r;i++)e+=t.charCodeAt(i)<32?" ":t.charAt(i);return dB.trim(e)}function ZPe(t){return t=GPe(t),t=HPe(t),t=qPe(t),t=WPe(t),t}function YPe(t){return t=jPe(t),t=BPe(t),t}function Trt(){return""}function Srt(t,e){typeof e!="function"&&(e=function(){});var i=!Array.isArray(t);function r(o){return i?!0:dB.indexOf(t,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(r(o))if(l.isClosing){var c="[/removed]",u=l.position+c.length;return s.push([n!==!1?n:l.position,u]),n=!1,c}else return n||(n=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return dB.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function Ert(t){for(var e="",i=0;i<t.length;){var r=t.indexOf("<!--",i);if(r===-1){e+=t.slice(i);break}e+=t.slice(i,r);var s=t.indexOf("-->",r);if(s===-1)break;i=s+3}return e}function Crt(t){var e=t.split("");return e=e.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),e.join("")}Fn.whiteList=VPe();Fn.getDefaultWhiteList=VPe;Fn.onTag=hrt;Fn.onIgnoreTag=drt;Fn.onTagAttr=prt;Fn.onIgnoreTagAttr=frt;Fn.safeAttrValue=mrt;Fn.escapeHtml=BPe;Fn.escapeQuote=jPe;Fn.unescapeQuote=GPe;Fn.escapeHtmlEntities=HPe;Fn.escapeDangerHtml5Entities=qPe;Fn.clearNonPrintableCharacter=WPe;Fn.friendlyAttrValue=ZPe;Fn.escapeAttrValue=YPe;Fn.onIgnoreTagStripAll=Trt;Fn.StripTagBody=Srt;Fn.stripCommentTag=Ert;Fn.stripBlankChar=Crt;Fn.cssFilter=zPe;Fn.getDefaultCSSWhiteList=urt;var r6={},D1=Jse;function Mrt(t){var e=D1.spaceIndex(t),i;return e===-1?i=t.slice(1,-1):i=t.slice(1,e+1),i=D1.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function Art(t){return t.slice(0,2)==="</"}function Prt(t,e,i){var r="",s=0,n=!1,o=!1,a=0,l=t.length,c="",u="";e:for(a=0;a<l;a++){var d=t.charAt(a);if(n===!1){if(d==="<"){n=a;continue}}else if(o===!1){if(d==="<"){r+=i(t.slice(s,a)),n=a,s=a;continue}if(d===">"){r+=i(t.slice(s,n)),u=t.slice(n,a+1),c=Mrt(u),r+=e(n,r.length,c,u,Art(u)),s=a+1,n=!1;continue}if(d==='"'||d==="'")for(var f=1,m=t.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=d;continue e}m=t.charAt(a-++f)}}else if(d===o){o=!1;continue}}return s<t.length&&(r+=i(t.substr(s))),r}var Ort=/[^a-zA-Z0-9\\_:.-]/gim;function $rt(t,e){var i=0,r=0,s=[],n=!1,o=t.length;function a(f,m){if(f=D1.trim(f),f=f.replace(Ort,"").toLowerCase(),!(f.length<1)){var g=e(f,m||"");g&&s.push(g)}}for(var l=0;l<o;l++){var c=t.charAt(l),u,d;if(n===!1&&c==="="){n=t.slice(i,l),i=l+1,r=t.charAt(i)==='"'||t.charAt(i)==="'"?i:Irt(t,l+1);continue}if(n!==!1&&l===r){if(d=t.indexOf(c,l+1),d===-1)break;u=D1.trim(t.slice(r+1,d)),a(n,u),n=!1,l=d,i=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),n===!1)if(d=Rrt(t,l),d===-1){u=D1.trim(t.slice(i,l)),a(u),n=!1,i=l+1;continue}else{l=d-1;continue}else if(d=Lrt(t,l-1),d===-1){u=D1.trim(t.slice(i,l)),u=lpe(u),a(n,u),n=!1,i=l+1;continue}else continue}return i<t.length&&(n===!1?a(t.slice(i)):a(n,lpe(D1.trim(t.slice(i))))),D1.trim(s.join(" "))}function Rrt(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="="?e:-1}}function Irt(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="'"||i==='"'?e:-1}}function Lrt(t,e){for(;e>0;e--){var i=t[e];if(i!==" ")return i==="="?e:-1}}function Drt(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function lpe(t){return Drt(t)?t.substr(1,t.length-2):t}r6.parseTag=Prt;r6.parseAttr=$rt;var Nrt=Xse.FilterCSS,vf=Fn,XPe=r6,Frt=XPe.parseTag,krt=XPe.parseAttr,oU=Jse;function kF(t){return t==null}function Urt(t){var e=oU.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=oU.trim(t.slice(e+1,-1));var i=t[t.length-1]==="/";return i&&(t=oU.trim(t.slice(0,-1))),{html:t,closing:i}}function Vrt(t){var e={};for(var i in t)e[i]=t[i];return e}function zrt(t){var e={};for(var i in t)Array.isArray(t[i])?e[i.toLowerCase()]=t[i].map(function(r){return r.toLowerCase()}):e[i.toLowerCase()]=t[i];return e}function JPe(t){t=Vrt(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=vf.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=zrt(t.whiteList||t.allowList):t.whiteList=vf.whiteList,t.onTag=t.onTag||vf.onTag,t.onTagAttr=t.onTagAttr||vf.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||vf.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||vf.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||vf.safeAttrValue,t.escapeHtml=t.escapeHtml||vf.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new Nrt(t.css))}JPe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,s=i.onTag,n=i.onIgnoreTag,o=i.onTagAttr,a=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,u=e.cssFilter;i.stripBlankChar&&(t=vf.stripBlankChar(t)),i.allowCommentTag||(t=vf.stripCommentTag(t));var d=!1;i.stripIgnoreTagBody&&(d=vf.StripTagBody(i.stripIgnoreTagBody,n),n=d.onIgnoreTag);var f=Frt(t,function(m,g,y,v,b){var w={sourcePosition:m,position:g,isClosing:b,isWhite:Object.prototype.hasOwnProperty.call(r,y)},x=s(y,v,w);if(!kF(x))return x;if(w.isWhite){if(w.isClosing)return"</"+y+">";var T=Urt(v),E=r[y],M=krt(T.html,function(O,D){var U=oU.indexOf(E,O)!==-1,k=o(y,O,D,U);return kF(k)?U?(D=l(y,O,D,u),D?O+'="'+D+'"':O):(k=a(y,O,D,U),kF(k)?void 0:k):k});return v="<"+y,M&&(v+=" "+M),T.closing&&(v+=" /"),v+=">",v}else return x=n(y,v,w),kF(x)?c(v):x},c);return d&&(f=d.remove(f)),f};var Brt=JPe;(function(t,e){var i=Fn,r=r6,s=Brt;function n(a,l){var c=new s(l);return c.process(a)}e=t.exports=n,e.filterXSS=n,e.FilterXSS=s,function(){for(var a in i)e[a]=i[a];for(var l in r)e[l]=r[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(yX,yX.exports);var gE=yX.exports,jrt=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},Grt=function(){function t(e,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],article:["style"],aside:["style"],audio:["autoplay","controls","loop","muted","preload"],b:[],blockquote:["style"],br:[],code:["style"],dd:["style"],details:["style"],div:["align","style","aria-label","aria-hidden"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],footer:["style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],header:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],main:["style"],mark:["style"],nav:["style"],ol:[],p:["style"],pre:["style"],section:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],summary:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],time:["style"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.arcgisCSSWhiteList=hB(hB({},gE.getDefaultCSSWhiteList()),{flex:!0,"flex-basis":!0,"flex-direction":!0,"flex-flow":!0,"flex-grow":!0,"flex-shrink":!0,"flex-wrap":!0,"line-height":!0,"justify-content":!0,overflow:!0}),this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?r.sanitizeUrl(a):gE.safeAttrValue(n,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;e&&!i?s=e:e&&i?(s=Object.create(this.arcgisFilterOptions),s.css={whiteList:this.arcgisCSSWhiteList},Object.keys(e).forEach(function(n){if(n==="whiteList")s.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,e.whiteList||{}]);else if(n==="css"){var o=e.css.whiteList;o!=null&&e.css instanceof Object&&Object.keys(o).forEach(function(a){return s.css.whiteList[a]=o[a]})}else s[n]=e[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList,s.css={whiteList:this.arcgisCSSWhiteList}),this.xssFilterOptions=s,this._xssFilter=new gE.FilterXSS(s)}return t.prototype.sanitize=function(e,i){switch(i===void 0&&(i={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,i);default:return i.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,i){var r=(i??{}).isProtocolRequired,s=r===void 0?!0:r,n=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?gE.escapeAttrValue(e):!n&&!s?gE.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,i,r,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,i,r,s):gE.safeAttrValue(e,i,r,s)},t.prototype.validate=function(e,i){i===void 0&&(i={});var r=this.sanitize(e,i);return{isValid:e===r,sanitized:r}},t.prototype.encodeHTML=function(e){var i=this;return String(e).replace(/[&<>"'\/]/g,function(r){return i._entityMap[r]})},t.prototype.encodeAttrValue=function(e){var i=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(r,s){return i.test(r)?r:"&#x".concat(Number(e.charCodeAt(s)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var i={};return e.forEach(function(r){Object.keys(r).forEach(function(s){Array.isArray(r[s])&&Array.isArray(i[s])?i[s]=i[s].concat(r[s]):i[s]=r[s]})}),i},t.prototype._iterateOverObject=function(e,i){var r=this;i===void 0&&(i={});try{var s=!1,n=void 0;if(Array.isArray(e))n=e.reduce(function(a,l){var c=r.validate(l,i);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(jrt(e)){var o=Object.keys(e);n=o.reduce(function(a,l){var c=e[l],u=r.validate(c,i);return u.isValid?a[l]=c:(s=!0,a[l]=u.sanitized),a},{})}else return i.allowUndefined&&typeof e>"u"?void 0:null;return s?n:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const s6=new Map;function QPe(){s6.clear()}function Hrt(t){return s6.get(t)}function qrt(t,e){s6.set(t,e)}function ZH(t){s6.delete(t)}function KPe(...t){const e=Ou.acquire();for(let r=0;r<t.length;r++){const s=t[r],n=typeof s;if(n==="string")e.push(s);else if(Array.isArray(s))e.push.apply(e,s);else if(n==="object")for(const o in s)s[o]&&e.push(o)}const i=e.join(" ");return Ou.release(e),i}(()=>{const t=new Map,e=new ResizeObserver(r=>{var s;QPe();for(const n of r)(s=t.get(n.target))==null||s(n)}),i=(r,s,n)=>(t.set(r,s),e.observe(r,n),Gi(()=>{e.unobserve(r),t.delete(r)}));return(r,s,n)=>{let o=null;return JS([te(()=>typeof r=="function"?r():r,a=>{o==null||o.remove(),a&&(o=i(a,s,n))},pr),Gi(()=>o==null?void 0:o.remove())])}})();function Zb(t){const e=t==null?void 0:t.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function cpe(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function upe(t){const e="data-node-ref";this[t.getAttribute(e)]=t}const Wrt=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],Zrt=Wrt.reduce((t,e)=>(t[e]=[],t),{}),Yrt=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],eOe=new Grt({whiteList:Zrt,onTagAttr:(t,e,i)=>{const r=`${e}="${i}"`;if(Yrt.includes(e))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function Xrt(t){return t==="Enter"||t===" "}const tOe="http://www.w3.org/",n6=`${tOe}2000/svg`,iOe=`${tOe}1999/xlink`;let hpe=[],Qse=(t,e)=>{let i={};return Object.keys(t).forEach(r=>{i[r]=t[r]}),e&&Object.keys(e).forEach(r=>{i[r]=e[r]}),i},Kse=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),rOe=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},Jrt=(t,e,i)=>{if(e.vnodeSelector!==""){for(let r=i;r<t.length;r++)if(Kse(t[r],e))return r}return-1},YH=(t,e,i,r)=>{let s=t[e];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(Kse(a,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},Qrt=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},vX=[],bX=!1,sOe=t=>{(t.children||[]).forEach(sOe),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},dpe=()=>{bX=!1,vX.forEach(sOe),vX.length=0},ppe=t=>{vX.push(t),bX||(bX=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(dpe,{timeout:16}):setTimeout(dpe,16))},fpe=t=>{let e=t.domNode;if(t.properties){let i=t.properties.exitAnimation;if(i)return e.style.pointerEvents="none",void i(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),ppe(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),ppe(t))},Krt=(t,e,i)=>{if(!e)return;let r=i.eventHandlerInterceptor,s=Object.keys(e),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")xX(t,l,!0);else if(a==="classes"){let c=Object.keys(l),u=c.length;for(let d=0;d<u;d++){let f=c[d];l[f]&&t.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),u=c.length;for(let d=0;d<u;d++){let f=c[d],m=l[f];m&&(rOe(m),i.styleApplyer(t,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(r&&(l=r(a,l,t,e)),a==="oninput"&&function(){let u=l;l=function(d){u.apply(this,[d]),d.target["oninput-value"]=d.target.value}}()),t[a]=l):i.namespace===n6?a==="href"?t.setAttributeNS(iOe,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=eOe.sanitize(l):wX(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function wX(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let pB,est=(t,e,i)=>{if(e)for(let r of e)FM(r,t,void 0,i)},nOe=(t,e,i)=>{est(t,e.children,i),e.text&&(t.textContent=e.text),Krt(t,e.properties,i),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,i,e.vnodeSelector,e.properties,e.children])},FM=(t,e,i,r)=>{let s,n=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")s=t.domNode=a.createTextNode(t.text),i!==void 0?e.insertBefore(s,i):e.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let u=o.charAt(n-1),d=o.slice(n,l);u==="."?s.classList.add(d):u==="#"?s.id=d:(d==="svg"&&(r=Qse(r,{namespace:n6})),r.namespace!==void 0?s=t.domNode=a.createElementNS(r.namespace,d):(s=t.domNode=t.domNode||a.createElement(d),d==="input"&&t.properties&&t.properties.type!==void 0&&s.setAttribute("type",t.properties.type)),i!==void 0?e.insertBefore(s,i):s.parentNode!==e&&e.appendChild(s)),n=l+1}}nOe(s,t,r)}},xX=(t,e,i)=>{e&&e.split(" ").forEach(r=>{r&&t.classList.toggle(r,i)})},tst=(t,e,i,r)=>{if(!i)return;let s=!1,n=Object.keys(i),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=i[l],u=e[l];if(l==="class")u!==c&&(xX(t,u,!1),xX(t,c,!0));else if(l==="classes"){let d=t.classList,f=Object.keys(c),m=f.length;for(let g=0;g<m;g++){let y=f[g],v=!!c[y];v!==!!u[y]&&(s=!0,v?d.add(y):d.remove(y))}}else if(l==="styles"){let d=Object.keys(c),f=d.length;for(let m=0;m<f;m++){let g=d[m],y=c[g];y!==u[g]&&(s=!0,y?(rOe(y),r.styleApplyer(t,g,y)):r.styleApplyer(t,g,""))}}else if(c||typeof u!="string"||(c=""),l!=="value"||wX(t)){if(c!==u){let d=typeof c;d==="function"&&r.eventHandlerInterceptor||(r.namespace===n6?l==="href"?t.setAttributeNS(iOe,l,c):t.setAttribute(l,c):d==="string"?l==="innerHTML"?t[l]=eOe.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):wX(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),s=!0)}}else{let d=t[l];d!==c&&(t["oninput-value"]?d===t["oninput-value"]:c!==u)&&(t[l]=c,t["oninput-value"]=void 0),c!==u&&(s=!0)}}return s},ist=(t,e,i,r,s)=>{if(i===r)return!1;r=r||hpe;let n,o=(i=i||hpe).length,a=r.length,l=0,c=0,u=!1;for(;c<a;){let d=l<o?i[l]:void 0,f=r[c];if(d!==void 0&&Kse(d,f))u=pB(d,f,s)||u,l++;else{let m=Jrt(i,f,l+1);if(m>=0){for(n=l;n<m;n++)fpe(i[n]),YH(i,n,t,"removed");u=pB(i[m],f,s)||u,l=m+1}else FM(f,e,l<o?i[l].domNode:void 0,s),Qrt(f),YH(r,c,t,"added")}c++}if(o>l)for(n=l;n<o;n++)fpe(i[n]),YH(i,n,t,"removed");return u};pB=(t,e,i)=>{let r=t.domNode,s=!1;if(t===e)return!1;let n=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=r.ownerDocument.createTextNode(e.text);return r.parentNode.replaceChild(o,r),e.domNode=o,s=!0,s}e.domNode=r}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(i=Qse(i,{namespace:n6})),t.text!==e.text&&(n=!0,e.text===void 0?r.removeChild(r.firstChild):r.textContent=e.text),e.domNode=r,n=ist(e,r,t.children,e.children,i)||n,n=tst(r,t.properties,e.properties,i)||n,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[r,i,e.vnodeSelector,e.properties,e.children]);return n&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(r,e.properties,t.properties),s};let u$=(t,e)=>({getLastRender:()=>t,update:i=>{if(t.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=t;t=i,pB(r,i,e)},domNode:t.domNode});const rst={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}};let LC=t=>Qse(rst,t),ab={create:(t,e)=>(e=LC(e),FM(t,document.createElement("div"),void 0,e),u$(t,e)),append:(t,e,i)=>(i=LC(i),FM(e,t,void 0,i),u$(e,i)),insertBefore:(t,e,i)=>(i=LC(i),FM(e,t.parentNode,t,i),u$(e,i)),merge:(t,e,i)=>(i=LC(i),e.domNode=t,nOe(t,e,i),u$(e,i)),replace:(t,e,i)=>(i=LC(i),FM(e,t.parentNode,t,i),t.parentNode.removeChild(t),u$(e,i))},oOe,sst=(t,e)=>{let i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i};oOe=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let nst=(t,e)=>{let i=t;return e.forEach(r=>{i=i&&i.children?oOe(i.children,s=>s.domNode===r):void 0}),i},ost=(t,e,i)=>{let r=function(s){i("domEvent",s);let n=e(),o=sst(s.currentTarget,n.domNode);o.reverse();let a,l=nst(n.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",s),a};return(s,n,o,a)=>r},TX=t=>{let e,i,r=LC(t),s=r.performanceLogger,n=!0,o=!1,a=[],l=[],c=(d,f,m)=>{let g,y=()=>g;r.eventHandlerInterceptor=ost(e,y,s),g=d(f,m(),r),a.push(g),l.push(m)},u=()=>{if(i=void 0,n){n=!1,s("renderStart",void 0);for(let d=0;d<a.length;d++){let f=l[d]();s("rendered",void 0),a[d].update(f),s("patched",void 0)}s("renderDone",void 0),n=!0}};return e={renderNow:u,scheduleRender:()=>{i||o||(i=requestAnimationFrame(u))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,n=!0,e.scheduleRender()},append:(d,f)=>{c(ab.append,d,f)},insertBefore:(d,f)=>{c(ab.insertBefore,d,f)},merge:(d,f)=>{c(ab.merge,d,f)},replace:(d,f)=>{c(ab.replace,d,f)},detach:d=>{for(let f=0;f<l.length;f++)if(l[f]===d)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},e},e1=class extends Ue{constructor(){super(...arguments),this.items=new Ke,this._watchUpdatingTracking=new f_,this._callbacks=new Map,this._projector=TX(),this._hiddenProjector=TX()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,i=>{for(const r of i.added){const s=()=>r.render();this._callbacks.set(r,s),this._projector.append(this.surface,s)}for(const r of i.removed){const s=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(s.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const i=this._hiddenSurface,r=this._hiddenProjector;let s;const n=()=>(s=e.render(),s);r.append(i,n),r.renderNow();const o={left:0,top:0,right:0,bottom:0};if(s!=null&&s.domNode){const a=s.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(r.detach(n);i.firstChild;)i.removeChild(i.firstChild);return o}overlaps(e,i){const r=this.computeBoundingRect(e),s=this.computeBoundingRect(i);return Math.max(r.left,s.left)<=Math.min(r.right,s.right)&&Math.max(r.top,s.top)<=Math.min(r.bottom,s.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,i){const r=!!(i!=null&&i.disableDecorations);if(!this.items.some(n=>n.visible&&!(r&&n.isDecoration)))return;const s=e.getContext("2d");s.save(),s.font=this._fontString(),this.items.forEach(n=>{r&&n.isDecoration||(s.save(),n.renderCanvas(s),s.restore())}),s.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};h([p({readOnly:!0})],e1.prototype,"surface",void 0),h([p({readOnly:!0})],e1.prototype,"items",void 0),h([p({readOnly:!0})],e1.prototype,"needsRender",null),h([p({readOnly:!0})],e1.prototype,"_watchUpdatingTracking",void 0),h([p({readOnly:!0})],e1.prototype,"updating",null),e1=h([I("esri.views.overlay.ViewOverlay")],e1);const mpe=e1,XH=[0,0];function ast(t){const e=(t.ownerDocument||window.document).defaultView,i=t.getBoundingClientRect();return XH[0]=i.left+((e==null?void 0:e.pageXOffset)??0),XH[1]=i.top+((e==null?void 0:e.pageYOffset)??0),XH}function gpe(t){t&&(DAe(t),t.parentNode&&t.parentNode.removeChild(t))}function lst(t){const e=document.createElement("div");return t.appendChild(e),e}const h$=16,UF=750,cst=512,ust=2,hst=t=>{let e=class extends t{constructor(...i){super(...i),this._freqInfo={freq:h$,time:UF},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([te(()=>this.cursor,r=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",r)}),te(()=>this.navigating,r=>{const{surface:s}=this;s&&s.setAttribute("data-navigating",r.toString())})])}initialize(){this.addHandles([te(()=>this.ui,(i,r)=>this._handleUIChange(i,r),pt),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=He(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(i){const r=this._get("container"),s=WG(i);if(s||typeof i!="string"||ne.getLogger(this).error("#container",`element with id '${i}' not found`),r===s)return;if(this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(gpe(this.root),this._set("root",null)),this.userContent&&(Ude(this.userContent,r),gpe(this.userContent),this._set("userContent",null))),!s)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);s.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",Ude(s,n),s.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",s.insertBefore(o,s.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new mpe;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(te(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=t2({render:()=>{var u;return(u=this.overlay)==null?void 0:u.render()}}):this._overlayRenderTaskHandle=Lr(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",s),this._startMeasuring()}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get size(){return[this.width,this.height]}blur(){var i;(i=this.surface)==null||i.blur()}focus(){var i;(i=this.surface)==null||i.focus()}pageToContainer(i,r,s){const n=this.position;return i-=n?n[0]:0,r-=n?n[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}containerToPage(i,r,s){const n=this.position;return i+=n?n[0]:0,r+=n?n[1]:0,s?(s[0]=i,s[1]=r):s=[i,r],s}_handleUIChange(i,r){this.removeHandles("ui"),r&&r!==i&&r.destroy(),i&&(i.view=this,this.addHandles(te(()=>this.root,s=>{i.container=s?lst(s):null},pt),"ui")),this._set("ui",i)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=h$,i.time=UF,this.addHandles([fO(window,"resize",()=>{i.freq=h$,i.time=UF}),t2({prepare:r=>{const s=this._measure(),n=this._freqInfo;if(n.time+=r.deltaTime,s&&(n.freq=h$,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?h$:Math.min(UF,n.freq*ust),!s&&n.freq>=cst&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,s=i?i.clientHeight:0;if(r===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return r===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:r,height:s}),!0)}_position(){const i=this.container,r=this.position,s=i&&ast(i);return!!s&&(!r||s[0]!==r[0]||s[1]!==r[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return h([p()],e.prototype,"container",null),h([p({readOnly:!0})],e.prototype,"focused",null),h([p({readOnly:!0})],e.prototype,"height",void 0),h([p()],e.prototype,"messagesCommon",void 0),h([p({type:mpe})],e.prototype,"overlay",void 0),h([p({readOnly:!0})],e.prototype,"position",void 0),h([p({readOnly:!0})],e.prototype,"resizing",void 0),h([p({readOnly:!0})],e.prototype,"root",void 0),h([p({value:null,readOnly:!0})],e.prototype,"size",null),h([p({readOnly:!0})],e.prototype,"surface",void 0),h([p({readOnly:!0})],e.prototype,"suspended",void 0),h([p()],e.prototype,"ui",void 0),h([p({readOnly:!0})],e.prototype,"userContent",void 0),h([p({readOnly:!0})],e.prototype,"width",void 0),h([p()],e.prototype,"widthBreakpoint",void 0),e=h([I("esri.views.DOMContainer")],e),e};function _w(t,e,i,r){return{x:t,y:e,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function wYt(t,e,i,r,s){t.x=e,t.y=i,t.z=r,t.hasZ=r!=null,t.spatialReference=s}function Go(t,e,i,r,s){return!(e==null||r==null||t.length<2)&&(d$.x=t[0],d$.y=t[1],d$.z=t[2],d$.spatialReference=e,xl(d$,i,r,s))}const d$=_w(0,0,0,Ye.WGS84);function vw(t,e,i){return!!Go(t,e,VF,i.spatialReference)&&(i.x=VF[0],i.y=VF[1],i.z=VF[2],!0)}async function aOe(t,e,i,r){return await xO(e,i.spatialReference,null,r),vw(t,e,i)}const VF=C();function dst(t){return ms(t,DM)||U2(t)?{wkid:Du.GCSMARS2000}:ms(t,NM)||V2(t)?{wkid:Du.GCSMOON2000}:Ye.WGS84}var as,fa;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL",t[t.TILES3D=8]="TILES3D"})(as||(as={}));let pst=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=fa.ALL,this.normalRequired=!0}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(fa||(fa={}));let fst=class{constructor(e,i,r){this.object=e,this.geometryId=i,this.triangleNr=r}},mst=class extends fst{constructor(e,i,r,s){super(e,i,r),this.center=s!=null?yn(s):null}},lOe=class{constructor(e){this.layerUid=e}},eN=class extends lOe{constructor(e,i){super(e),this.graphicUid=i}};function bp(t){return(t==null?void 0:t.dist)!=null}function ype(t){return(e,i,r)=>(Sr(_pe,e,i,r),!Gse(t,_pe))}function o6(t){return bp(t)&&t.intersector===as.OBJECT&&!!t.target}function a6(t){return bp(t)&&t.intersector===as.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const _pe=C();function wp(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function gst(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function ene(t,e,i,r,s,n,o,a,l,c){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function l6(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function W2(t,e){if(t===e){const i=e[1],r=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function tN(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=u*o-a*c,f=-u*n+a*l,m=c*n-o*l;let g=i*d+r*f+s*m;return g?(g=1/g,t[0]=d*g,t[1]=(-u*r+s*c)*g,t[2]=(a*r-s*o)*g,t[3]=f*g,t[4]=(u*i-s*l)*g,t[5]=(-a*i+s*n)*g,t[6]=m*g,t[7]=(-c*i+r*l)*g,t[8]=(o*i-r*n)*g,t):null}function yst(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t[0]=o*u-a*c,t[1]=s*c-r*u,t[2]=r*a-s*o,t[3]=a*l-n*u,t[4]=i*u-s*l,t[5]=s*n-i*a,t[6]=n*c-o*l,t[7]=r*l-i*c,t[8]=i*o-r*n,t}function _st(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*n-o*l)+i*(-c*s+o*a)+r*(l*s-n*a)}function AP(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],f=i[0],m=i[1],g=i[2],y=i[3],v=i[4],b=i[5],w=i[6],x=i[7],T=i[8];return t[0]=f*r+m*o+g*c,t[1]=f*s+m*a+g*u,t[2]=f*n+m*l+g*d,t[3]=y*r+v*o+b*c,t[4]=y*s+v*a+b*u,t[5]=y*n+v*l+b*d,t[6]=w*r+x*o+T*c,t[7]=w*s+x*a+T*u,t[8]=w*n+x*l+T*d,t}function PP(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],f=i[0],m=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=o,t[4]=a,t[5]=l,t[6]=f*r+m*o+c,t[7]=f*s+m*a+u,t[8]=f*n+m*l+d,t}function c6(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],f=Math.sin(i),m=Math.cos(i);return t[0]=m*r+f*o,t[1]=m*s+f*a,t[2]=m*n+f*l,t[3]=m*o-f*r,t[4]=m*a-f*s,t[5]=m*l-f*n,t[6]=c,t[7]=u,t[8]=d,t}function iN(t,e,i){const r=i[0],s=i[1],n=i[2];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=n*e[6],t[7]=n*e[7],t[8]=n*e[8],t}function vst(t,e,i){const r=i[0],s=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t}function bst(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function wst(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function xst(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Tst(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function HL(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i+i,a=r+r,l=s+s,c=i*o,u=r*o,d=r*a,f=s*o,m=s*a,g=s*l,y=n*o,v=n*a,b=n*l;return t[0]=1-d-g,t[3]=u-b,t[6]=f+v,t[1]=u+b,t[4]=1-c-g,t[7]=m-y,t[2]=f-v,t[5]=m+y,t[8]=1-c-d,t}function cOe(t,e){const i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10],d=u*o-a*c,f=-u*n+a*l,m=c*n-o*l,g=i*d+r*f+s*m;if(!g)return null;const y=1/g;return t[0]=d*y,t[1]=(-u*r+s*c)*y,t[2]=(a*r-s*o)*y,t[3]=f*y,t[4]=(u*i-s*l)*y,t[5]=(-a*i+s*n)*y,t[6]=m*y,t[7]=(-c*i+r*l)*y,t[8]=(o*i-r*n)*y,t}function Yb(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],f=e[10],m=e[11],g=e[12],y=e[13],v=e[14],b=e[15],w=i*a-r*o,x=i*l-s*o,T=i*c-n*o,E=r*l-s*a,M=r*c-n*a,O=s*c-n*l,D=u*y-d*g,U=u*v-f*g,k=u*b-m*g,H=d*v-f*y,V=d*b-m*y,X=f*b-m*v;let q=w*X-x*V+T*H+E*k-M*U+O*D;return q?(q=1/q,t[0]=(a*X-l*V+c*H)*q,t[1]=(l*k-o*X-c*U)*q,t[2]=(o*V-a*k+c*D)*q,t[3]=(s*V-r*X-n*H)*q,t[4]=(i*X-s*k+n*U)*q,t[5]=(r*k-i*V-n*D)*q,t[6]=(y*O-v*M+b*E)*q,t[7]=(v*T-g*O-b*x)*q,t[8]=(g*M-y*T+b*w)*q,t):null}function Sst(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function Est(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Cst(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function Mst(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t}function uOe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}function Ast(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t}function Pst(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t}function Ost(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function $st(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=e[0],f=e[1],m=e[2],g=e[3],y=e[4],v=e[5],b=e[6],w=e[7],x=e[8],T=Bo();return Math.abs(i-d)<=T*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(r-f)<=T*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-m)<=T*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(n-g)<=T*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(o-y)<=T*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(a-v)<=T*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-b)<=T*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-w)<=T*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(u-x)<=T*Math.max(1,Math.abs(u),Math.abs(x))}function Rst(t){const e=Bo(),i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return Math.abs(1-(i*i+n*n+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(s*s+a*a+u*u))<=e}const Ist=AP,Lst=uOe;Object.freeze(Object.defineProperty({__proto__:null,add:Mst,adjoint:yst,copy:gst,determinant:_st,equals:$st,exactEquals:Ost,frob:Cst,fromMat2d:Tst,fromMat4:wp,fromQuat:HL,fromRotation:wst,fromScaling:xst,fromTranslation:bst,identity:l6,invert:tN,isOrthoNormal:Rst,mul:Ist,multiply:AP,multiplyScalar:Ast,multiplyScalarAndAdd:Pst,normalFromMat4:Yb,normalFromMat4Legacy:cOe,projection:Sst,rotate:c6,scale:iN,scaleByVec2:vst,set:ene,str:Est,sub:Lst,subtract:uOe,translate:PP,transpose:W2},Symbol.toStringTag,{value:"Module"}));function Dst(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function fB(t,e,i){i*=.5;const r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function u6(t,e){const i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>Bo()?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i}function h6(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=r*u+o*a+s*c-n*l,t[1]=s*u+o*l+n*a-r*c,t[2]=n*u+o*c+r*l-s*a,t[3]=o*u-r*a-s*l-n*c,t}function Nst(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+o*a,t[1]=s*l+n*a,t[2]=n*l-s*a,t[3]=o*l-r*a,t}function Fst(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l-n*a,t[1]=s*l+o*a,t[2]=n*l+r*a,t[3]=o*l-s*a,t}function kst(t,e,i){i*=.5;const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+s*a,t[1]=s*l-r*a,t[2]=n*l+o*a,t[3]=o*l-n*a,t}function Ust(t,e){const i=e[0],r=e[1],s=e[2];return t[0]=i,t[1]=r,t[2]=s,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),t}function aU(t,e,i,r){const s=e[0],n=e[1],o=e[2],a=e[3];let l,c,u,d,f,m=i[0],g=i[1],y=i[2],v=i[3];return c=s*m+n*g+o*y+a*v,c<0&&(c=-c,m=-m,g=-g,y=-y,v=-v),1-c>Bo()?(l=Math.acos(c),u=Math.sin(l),d=Math.sin((1-r)*l)/u,f=Math.sin(r*l)/u):(d=1-r,f=r),t[0]=d*s+f*m,t[1]=d*n+f*g,t[2]=d*o+f*y,t[3]=d*a+f*v,t}function Vst(t){const e=WD,i=e(),r=e(),s=e(),n=Math.sqrt(1-i),o=Math.sqrt(i);return t[0]=n*Math.sin(2*Math.PI*r),t[1]=n*Math.cos(2*Math.PI*r),t[2]=o*Math.sin(2*Math.PI*s),t[3]=o*Math.cos(2*Math.PI*s),t}function zst(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=i*i+r*r+s*s+n*n,a=o?1/o:0;return t[0]=-i*a,t[1]=-r*a,t[2]=-s*a,t[3]=n*a,t}function xb(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function hOe(t,e){const i=e[0]+e[4]+e[8];let r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;r=Math.sqrt(e[3*s+s]-e[3*n+n]-e[3*o+o]+1),t[s]=.5*r,r=.5/r,t[3]=(e[3*n+o]-e[3*o+n])*r,t[n]=(e[3*n+s]+e[3*s+n])*r,t[o]=(e[3*o+s]+e[3*s+o])*r}return t}function Bst(t,e,i,r){const s=.5*Math.PI/180;e*=s,i*=s,r*=s;const n=Math.sin(e),o=Math.cos(e),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),u=Math.cos(r);return t[0]=n*l*u-o*a*c,t[1]=o*a*u+n*l*c,t[2]=o*l*c-n*a*u,t[3]=o*l*u+n*a*c,t}function jst(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const Gst=np,dOe=Ss,Hst=Dse,qst=h6,Wst=g2,Zst=cPe,Yst=XG,pOe=Nse,Xst=pOe,fOe=Fse,Jst=fOe,tne=lPe,Qst=EA,Kst=y2;function ent(t,e,i){const r=Te(e,i);return r<-.999999?(mt(Sm,tnt,e),Wl(Sm)<1e-6&&mt(Sm,int,e),Ce(Sm,Sm),fB(t,Sm,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(mt(Sm,e,i),t[0]=Sm[0],t[1]=Sm[1],t[2]=Sm[2],t[3]=1+r,tne(t,t))}const Sm=C(),tnt=qe(1,0,0),int=qe(0,1,0);function rnt(t,e,i,r,s,n){return aU(vpe,e,s,n),aU(bpe,i,r,n),aU(t,vpe,bpe,2*n*(1-n)),t}const vpe=nd(),bpe=nd();function snt(t,e,i,r){const s=nnt;return s[0]=i[0],s[3]=i[1],s[6]=i[2],s[1]=r[0],s[4]=r[1],s[7]=r[2],s[2]=-e[0],s[5]=-e[1],s[8]=-e[2],tne(t,hOe(t,s))}const nnt=Kr();Object.freeze(Object.defineProperty({__proto__:null,add:Hst,calculateW:Ust,conjugate:xb,copy:Gst,dot:Zst,equals:Kst,exactEquals:Qst,fromEuler:Bst,fromMat3:hOe,getAxisAngle:u6,identity:Dst,invert:zst,len:Xst,length:pOe,lerp:Yst,mul:qst,multiply:h6,normalize:tne,random:Vst,rotateX:Nst,rotateY:Fst,rotateZ:kst,rotationTo:ent,scale:Wst,set:dOe,setAxes:snt,setAxisAngle:fB,slerp:aU,sqlerp:rnt,sqrLen:Jst,squaredLength:fOe,str:jst},Symbol.toStringTag,{value:"Module"}));function mOe(t,e,i){const r=Math.sin(t),s=Math.cos(t),n=Math.sin(e),o=Math.cos(e),a=i;return a[0]=-r,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function ont(t,e,i){return mOe(t,e,i),Hu(i,i),i}function Gh(t,e,i,r){if(t==null||r==null)return!1;const s=Jz(t,jQe),n=Jz(r,GQe);if(s===n&&!wpe(n)&&(s!==he.UNKNOWN||ms(t,r)))return z2(i,e),!0;if(wpe(n)){const o=yR[s][he.LON_LAT],a=yR[he.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,gv,0),a(gv,0,yv,0),mOe(zF*gv[0],zF*gv[1],i),i[12]=yv[0],i[13]=yv[1],i[14]=yv[2],!0)}if(!(n!==he.WEB_MERCATOR&&n!==he.PLATE_CARREE&&n!==he.WGS84&&n!==he.CGCS2000||s!==he.WGS84&&s!==he.SPHERICAL_ECEF&&s!==he.WEB_MERCATOR&&s!==he.CGCS2000)){const o=yR[s][he.LON_LAT],a=yR[he.LON_LAT][n];return o!=null&&a!=null&&(o(e,0,gv,0),a(gv,0,yv,0),s===he.SPHERICAL_ECEF?ont(zF*gv[0],zF*gv[1],i):mp(i),i[12]=yv[0],i[13]=yv[1],i[14]=yv[2],!0)}return!1}function wpe(t){return t===he.SPHERICAL_ECEF||t===he.SPHERICAL_MARS_PCPF||t===he.SPHERICAL_MOON_PCPF}const zF=kt(1),gv=C(),yv=C();let rN=class{constructor(e,i,r=i){this.data=e,this.size=i,this.stride=r}},ht=class extends rN{constructor(e,i,r,s=!1,n=r){super(e,r,n),this.indices=i,this.exclusive=s}};const OP=1e-6,p$=C(),BF=C();function ant(t,e){const{data:i,size:r}=t,s=i.length/r;if(s<=0)return;const n=new ynt(t);EX(p$,n.minProj,n.maxProj),PR(p$,p$,.5),Zd(BF,n.maxProj,n.minProj);const o=SX(BF),a=new _nt;a.quality=o,s<14&&(t=new rN(new Float64Array(n.buffer,112,42),3));const l=C(),c=C(),u=C(),d=C(),f=C(),m=C(),g=C();switch(lnt(n,t,g,l,c,u,d,f,m,a)){case 1:return void Epe(p$,BF,e);case 2:return void mnt(t,d,e)}cnt(t,g,l,c,u,d,f,m,a),gOe(t,a.b0,a.b1,a.b2,MA,AA);const y=C();Zd(y,AA,MA),a.quality=SX(y),a.quality<o?yOe(a.b0,a.b1,a.b2,MA,AA,y,e):Epe(p$,BF,e)}function lnt(t,e,i,r,s,n,o,a,l,c){return unt(t,r,s),CX(r,s)<OP?1:(Zd(o,r,s),Ra(o,o),hnt(e,r,o,n)<OP?2:(Zd(a,s,n),Ra(a,a),Zd(l,n,r),Ra(l,l),Yd(i,a,o),Ra(i,i),kx(e,i,o,a,l,c),0))}const f$=C(),m$=C(),ld=C(),cd=C(),ud=C(),_v=C(),vv=C(),bv=C();function cnt(t,e,i,r,s,n,o,a,l){dnt(t,e,i,f$,m$),f$[0]!==void 0&&(Zd(ld,f$,i),Ra(ld,ld),Zd(cd,f$,r),Ra(cd,cd),Zd(ud,f$,s),Ra(ud,ud),Yd(_v,cd,n),Ra(_v,_v),Yd(vv,ud,o),Ra(vv,vv),Yd(bv,ld,a),Ra(bv,bv),kx(t,_v,n,cd,ld,l),kx(t,vv,o,ud,cd,l),kx(t,bv,a,ld,ud,l)),m$[0]!==void 0&&(Zd(ld,m$,i),Ra(ld,ld),Zd(cd,m$,r),Ra(cd,cd),Zd(ud,m$,s),Ra(ud,ud),Yd(_v,cd,n),Ra(_v,_v),Yd(vv,ud,o),Ra(vv,vv),Yd(bv,ld,a),Ra(bv,bv),kx(t,_v,n,cd,ld,l),kx(t,vv,o,ud,cd,l),kx(t,bv,a,ld,ud,l))}function unt(t,e,i){let r=CX(t.maxVert[0],t.minVert[0]),s=0;for(let n=1;n<7;++n){const o=CX(t.maxVert[n],t.minVert[n]);o>r&&(r=o,s=n)}kh(e,t.minVert[s]),kh(i,t.maxVert[s])}const hd=[0,0,0];function hnt(t,e,i,r){const{data:s,size:n}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){hd[0]=s[l]-e[0],hd[1]=s[l+1]-e[1],hd[2]=s[l+2]-e[2];const c=i[0]*hd[0]+i[1]*hd[1]+i[2]*hd[2],u=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],d=hd[0]*hd[0]+hd[1]*hd[1]+hd[2]*hd[2]-c*c/u;d>o&&(o=d,a=l)}return kh(r,s,a),o}const uo=gt();function dnt(t,e,i,r,s){fnt(t,e,uo,s,r);const n=vOe(i,e);uo[1]-OP<=n&&(r[0]=void 0),uo[0]+OP>=n&&(s[0]=void 0)}const xpe=C(),Tpe=C(),Spe=C(),yE=C(),_E=C(),jF=C();function kx(t,e,i,r,s,n){if(_Oe(e)<OP)return;Yd(xpe,i,e),Yd(Tpe,r,e),Yd(Spe,s,e),CA(t,e,uo),_E[1]=uo[0],yE[1]=uo[1],jF[1]=yE[1]-_E[1];const o=[i,r,s],a=[xpe,Tpe,Spe];for(let l=0;l<3;++l){CA(t,o[l],uo),_E[0]=uo[0],yE[0]=uo[1],CA(t,a[l],uo),_E[2]=uo[0],yE[2]=uo[1],jF[0]=yE[0]-_E[0],jF[2]=yE[2]-_E[2];const c=SX(jF);c<n.quality&&(kh(n.b0,o[l]),kh(n.b1,e),kh(n.b2,a[l]),n.quality=c)}}const pnt=C();function CA(t,e,i){const{data:r,size:s}=t;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<r.length;n+=s){const o=r[n]*e[0]+r[n+1]*e[1]+r[n+2]*e[2];i[0]=Math.min(i[0],o),i[1]=Math.max(i[1],o)}}function fnt(t,e,i,r,s){const{data:n,size:o}=t;kh(r,n),kh(s,r),i[0]=vOe(pnt,e),i[1]=i[0];for(let a=o;a<n.length;a+=o){const l=n[a]*e[0]+n[a+1]*e[1]+n[a+2]*e[2];l<i[0]&&(i[0]=l,kh(r,n,a)),l>i[1]&&(i[1]=l,kh(s,n,a))}}function Epe(t,e,i){i.center=t,i.halfSize=de(e,e,.5),i.quaternion=$se}const Wy=C(),vE=C(),g$=C(),MA=C(),AA=C(),Cpe=C();function mnt(t,e,i){kh(Wy,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?Wy[0]=0:Math.abs(e[1])>Math.abs(e[2])?Wy[1]=0:Wy[2]=0,_Oe(Wy)<OP&&(Wy[0]=Wy[1]=Wy[2]=1),Yd(vE,e,Wy),Ra(vE,vE),Yd(g$,e,vE),Ra(g$,g$),gOe(t,e,vE,g$,MA,AA),Zd(Cpe,AA,MA),yOe(e,vE,g$,MA,AA,Cpe,i)}function gOe(t,e,i,r,s,n){CA(t,e,uo),s[0]=uo[0],n[0]=uo[1],CA(t,i,uo),s[1]=uo[0],n[1]=uo[1],CA(t,r,uo),s[2]=uo[0],n[2]=uo[1]}const Gw=C(),y$=C(),GF=C(),Em=P3(1,0,0,0,1,0,0,0,1),gnt=nd();function yOe(t,e,i,r,s,n,o){Em[0]=t[0],Em[1]=t[1],Em[2]=t[2],Em[3]=e[0],Em[4]=e[1],Em[5]=e[2],Em[6]=i[0],Em[7]=i[1],Em[8]=i[2],o.quaternion=vnt(gnt,Em),EX(Gw,r,s),PR(Gw,Gw,.5),PR(y$,t,Gw[0]),PR(GF,e,Gw[1]),EX(y$,y$,GF),PR(GF,i,Gw[2]),o.center=Ee(y$,y$,GF),o.halfSize=de(Gw,n,.5)}const Ju=7;let ynt=class{constructor(e){this.minVert=new Array(Ju),this.maxVert=new Array(Ju);const i=64*Ju;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,Ju),r+=8*Ju,this.maxProj=new Float64Array(this.buffer,r,Ju),r+=8*Ju;for(let l=0;l<Ju;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Ju;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Ju;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(Ju),n=new Array(Ju),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<Ju;++l){let c=s[l];kh(this.minVert[l],o,c),c=n[l],kh(this.maxVert[l],o,c)}}},_nt=class{constructor(){this.b0=qe(1,0,0),this.b1=qe(0,1,0),this.b2=qe(0,0,1),this.quality=0}};function SX(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function EX(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}function Zd(t,e,i){t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2]}function PR(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}function kh(t,e,i=0){t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2]}function Yd(t,e,i){const r=e[0],s=e[1],n=e[2],o=i[0],a=i[1],l=i[2];t[0]=s*l-n*a,t[1]=n*o-r*l,t[2]=r*a-s*o}function Ra(t,e){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(i>0){const r=1/Math.sqrt(i);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}}function _Oe(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function CX(t,e){const i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}function vOe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function vnt(t,e){const i=e[0]+e[4]+e[8];if(i>0){let r=Math.sqrt(i+1);t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r}else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);const s=(r+1)%3,n=(r+2)%3;let o=Math.sqrt(e[3*r+r]-e[3*s+s]-e[3*n+n]+1);t[r]=.5*o,o=.5/o,t[3]=(e[3*s+n]-e[3*n+s])*o,t[s]=(e[3*s+r]+e[3*r+s])*o,t[n]=(e[3*n+r]+e[3*r+n])*o}return t}let bOe=class lU{constructor(e=Nn,i=Pnt,r=$se){this._data=[e[0],e[1],e[2],i[0],i[1],i[2],r[0],r[1],r[2],r[3]]}clone(){const e=new lU;return e._data=this._data.slice(),e}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const i=new lU;return i._data=e.slice(),i}static fromJSON(e){return new lU(e.center,e.halfSize,e.quaternion)}copy(e){this._data=e.data.slice()}get center(){return pe(rt.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,i,r){this._data[0]=e,this._data[1]=i,this._data[2]=r}get halfSize(){return pe(rt.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return dOe(mtt.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const i=ws,r=this._data;i[0]=r[6],i[1]=r[7],i[2]=r[8],i[3]=r[9];for(let s=0;s<8;++s){const n=e[s];n[0]=(1&s?-1:1)*r[3],n[1]=(2&s?-1:1)*r[4],n[2]=(4&s?-1:1)*r[5],Eu(n,n,i),n[0]+=r[0],n[1]+=r[1],n[2]+=r[2]}}doesIntersectFrustumConservativeApproximation(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],i=this._data[4],r=this._data[5];return Math.sqrt(e*e+i*i+r*r)}intersectSphere(e){bi[0]=this._data[0]-e[0],bi[1]=this._data[1]-e[1],bi[2]=this._data[2]-e[2];const i=this.getQuaternion(K0);return xb(ws,i),Eu(bi,bi,ws),dP(bi,bi),Zy[0]=Math.min(bi[0],this._data[3]),Zy[1]=Math.min(bi[1],this._data[4]),Zy[2]=Math.min(bi[2],this._data[5]),IL(Zy,bi)<e[3]*e[3]}intersectSphereWithMBS(e,i=this.radius){const r=this._data;bi[0]=r[0]-e[0],bi[1]=r[1]-e[1],bi[2]=r[2]-e[2];const s=e[3],n=s+i;return!(Gz(bi)>n*n)&&(ws[0]=-r[6],ws[1]=-r[7],ws[2]=-r[8],ws[3]=r[9],Eu(bi,bi,ws),dP(bi,bi),Zy[0]=Math.min(bi[0],r[3]),Zy[1]=Math.min(bi[1],r[4]),Zy[2]=Math.min(bi[2],r[5]),IL(Zy,bi)<s*s)}intersectPlane(e){const i=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],r=this.projectedRadius(e);return i>r?1:i<-r?-1:0}intersectRay(e,i,r=0){const s=this._data,n=ws;n[0]=-s[6],n[1]=-s[7],n[2]=-s[8],n[3]=s[9],bi[0]=e[0]-s[0],bi[1]=e[1]-s[1],bi[2]=e[2]-s[2];const o=Eu(bi,bi,ws),a=Eu(Zy,i,ws);let l=-1/0,c=1/0;const u=this.getHalfSize(PA);for(let d=0;d<3;d++){const f=o[d],m=a[d],g=u[d]+r;if(Math.abs(m)>1e-6){const y=(g-f)/m,v=(-g-f)/m;l=Math.max(l,Math.min(y,v)),c=Math.min(c,Math.max(y,v))}else if(f>g||f<-g)return!1}return l<=c}projectedArea(e,i,r,s){const n=this.getQuaternion(K0);xb(ws,n),bi[0]=e[0]-this._data[0],bi[1]=e[1]-this._data[1],bi[2]=e[2]-this._data[2],Eu(bi,bi,ws);const o=this.getHalfSize(PA),a=bi[0]<-o[0]?-1:bi[0]>o[0]?1:0,l=bi[1]<-o[1]?-1:bi[1]>o[1]?1:0,c=bi[2]<-o[2]?-1:bi[2]>o[2]?1:0,u=Math.abs(a)+Math.abs(l)+Math.abs(c);if(u===0)return 1/0;const d=u===1?4:6,f=6*(a+3*l+9*c+13);HL(DC,n),iN(DC,DC,o);const m=this.getCenter(kf);for(let v=0;v<d;v++){const b=xnt[f+v];pe(bi,((1&b)<<1)-1,(2&b)-1,((4&b)>>1)-1),ca(bi,bi,DC),Ee(Hw,m,bi),Hw[3]=1,Vu(Hw,Hw,i);const w=1/Math.max(1e-6,Hw[3]);Lp[2*v]=Hw[0]*w,Lp[2*v+1]=Hw[1]*w}const g=2*d-2;let y=Lp[0]*(Lp[3]-Lp[g+1])+Lp[g]*(Lp[1]-Lp[g-1]);for(let v=2;v<g;v+=2)y+=Lp[v]*(Lp[v+3]-Lp[v-1]);return Math.abs(y)*r*s*.125}projectedRadius(e){const i=this.getQuaternion(K0);return xb(ws,i),Eu(bi,e,ws),Math.abs(bi[0]*this._data[3])+Math.abs(bi[1]*this._data[4])+Math.abs(bi[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius(e)}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius(e)}toAaBoundingBox(e){const i=this.getQuaternion(K0),r=HL(DC,i),s=this._data[3]*Math.abs(r[0])+this._data[4]*Math.abs(r[3])+this._data[5]*Math.abs(r[6]),n=this._data[3]*Math.abs(r[1])+this._data[4]*Math.abs(r[4])+this._data[5]*Math.abs(r[7]),o=this._data[3]*Math.abs(r[2])+this._data[4]*Math.abs(r[5])+this._data[5]*Math.abs(r[8]);e[0]=this._data[0]-s,e[1]=this._data[1]-n,e[2]=this._data[2]-o,e[3]=this._data[0]+s,e[4]=this._data[1]+n,e[5]=this._data[2]+o}transform(e,i,r,s=0,n=id(r),o=id(i),a=jb(i,o)){if(r===n)i.isGeographic?Cnt(this,e,i,s,o):Ent(this,e,i,s,o,a);else if(i.isWGS84&&(r.isWebMercator||s2(r)))Tnt(i,this,r,e,s);else if(i.isWebMercator&&s2(r))Snt(i,this,r,e,s);else{const l=this.getCenter(kf);l[2]+=s,gs(l,i,0,l,r,0,1),e.center=l,this!==e&&(e.quaternion=this.getQuaternion(K0),e.halfSize=this.getHalfSize(PA))}}};const ws=nd(),K0=nd(),bnt=nd(),bi=C(),Zy=C(),Hw=ci();function wnt(t,e=new bOe){return ant(t,e),e}const Lp=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],xnt=(()=>{const t=new Int8Array(162);let e=0;const i=r=>{for(let s=0;s<r.length;s++)t[e+s]=r[s];e+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),t})();function wOe(t,e,i,r,s){const n=t.getQuaternion(K0);s.quaternion=n,xb(ws,n);const o=t.getCenter(kf),a=t.getHalfSize(PA);if(r===Je.Global){Eu(Xr,o,ws),dP(wf,Xr),RCe(Ku,wf,a),Li(Ku,wf,Ku);const l=Ve(Ku);Ee(Ku,wf,a);const c=Ve(Ku);if(l<i)s.center=o,pe(Xr,i,i,i),s.halfSize=Ee(Xr,a,Xr);else{const u=c>0?1+e/c:1,d=l>0?1+i/l:1,f=(d+u)/2,m=(d-u)/2;de(Ku,wf,m),s.halfSize=Dn(Ku,Ku,a,f),de(Ku,wf,f),Dn(Ku,Ku,a,m),$Ce(Xr,Xr),OG(Xr,Ku,Xr);const g=t.getQuaternion(bnt);s.center=Eu(Xr,Xr,g)}}else{s.center=Dn(Xr,o,hP,(i+e)/2);const l=Eu(Xr,hP,ws);dP(l,l),s.halfSize=Dn(wf,a,l,(i-e)/2)}return s}function Tnt(t,e,i,r,s){e.getCenter(kf),kf[2]+=s;const n=id(i);gs(kf,t,0,kf,n,0,1),xOe(n,e,kf,i,r)}function Snt(t,e,i,r,s){e.getCenter(kf),kf[2]+=s,xOe(t,e,kf,i,r)}function xOe(t,e,i,r,s){const n=e.getQuaternion(K0),o=HL(DC,n),a=e.getHalfSize(PA);for(let l=0;l<8;++l){for(let c=0;c<3;++c)Lg[c]=a[c]*(l&1<<c?-1:1);for(let c=0;c<3;++c){let u=i[c];for(let d=0;d<3;++d)u+=Lg[d]*o[3*d+c];cU[3*l+c]=u}}gs(cU,t,0,cU,r,0,8),wnt(Mnt,s)}function Ent(t,e,i,r,s=id(i),n=jb(i,s)){t.getCorners(Mpe),t.getCenter(Lg),Lg[2]+=r,Gh(i,Lg,Qu,s),e.setCenter(Qu[12],Qu[13],Qu[14]);const o=2*Math.sqrt(1+Qu[0]+Qu[5]+Qu[10]);ws[0]=(Qu[6]-Qu[9])/o,ws[1]=(Qu[8]-Qu[2])/o,ws[2]=(Qu[1]-Qu[4])/o,ws[3]=.25*o;const a=t.getQuaternion(K0);e.quaternion=h6(ws,ws,a),xb(ws,ws),pe(wf,0,0,0);const l=e.getCenter(Ant);for(const c of Mpe)c[2]+=r,n(c,0,c,0),Li(Xr,c,l),Eu(Xr,Xr,ws),dP(Xr,Xr),ICe(wf,wf,Xr);e.halfSize=wf}function Cnt(t,e,i,r,s=id(i)){const n=br(i),o=1+Math.max(0,r)/(n.radius+t.centerZ);t.getCenter(Lg),Lg[2]+=r,gs(Lg,i,0,Lg,s,0,1),e.center=Lg;const a=t.getQuaternion(K0);e.quaternion=a,xb(ws,a),pe(Xr,0,0,1),Eu(Xr,Xr,ws);const l=t.getHalfSize(PA);pe(Xr,l[0]*Math.abs(Xr[0]),l[1]*Math.abs(Xr[1]),l[2]*Math.abs(Xr[2])),de(Xr,Xr,n.inverseFlattening),Ee(Xr,l,Xr),e.halfSize=de(Xr,Xr,o)}const cU=new Array(24),Mnt=new rN(cU,3),Lg=C(),kf=C(),Ant=C(),PA=C(),DC=Kr(),Qu=ke(),Mpe=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Xr=C(),wf=C(),Ku=C(),Pnt=qe(-1,-1,-1);let Ont=class{constructor(){this._transform=ke(),this._transformInverse=new HF({value:this._transform},eo,ke),this._transformInverseTranspose=new HF(this._transformInverse,Hu,ke),this._transformTranspose=new HF({value:this._transform},Hu,ke),this._transformInverseRotation=new HF({value:this._transform},cOe,Kr)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){An(this._transform,e)}multiplyTransform(e){vr(this._transform,this._transform,e)}set(e){An(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,i){this.setTransformMatrix(e),this.multiplyTransform(i),this._invalidateLazyTransforms()}},HF=class{constructor(e,i,r){this._original=e,this._update=i,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},$nt=class{constructor(e=0){this.offset=e,this.tmpVertex=C()}applyToVertex(e,i,r){const s=pe(ine,e,i,r),n=Ee(TOe,s,this.localOrigin),o=this.offset/Ve(n);return Dn(this.tmpVertex,s,n,o),this.tmpVertex}applyToAabb(e){const i=Dnt,r=Nnt,s=Fnt;for(let l=0;l<3;++l)i[l]=e[0+l]+this.localOrigin[l],r[l]=e[3+l]+this.localOrigin[l],s[l]=i[l];const n=this.applyToVertex(i[0],i[1],i[2]);for(let l=0;l<3;++l)e[l]=n[l],e[l+3]=n[l];const o=l=>{const c=this.applyToVertex(l[0],l[1],l[2]);for(let u=0;u<3;++u)e[u]=Math.min(e[u],c[u]),e[u+3]=Math.max(e[u+3],c[u])};for(let l=1;l<8;++l){for(let c=0;c<3;++c)s[c]=l&1<<c?r[c]:i[c];o(s)}let a=0;for(let l=0;l<3;++l)i[l]*r[l]<0&&(a|=1<<l);if(a!==0&&a!==7){for(let l=0;l<8;++l)if(!(a&l)){for(let c=0;c<3;++c)s[c]=a&1<<c?0:l&1<<c?i[c]:r[c];o(s)}}for(let l=0;l<3;++l)e[l]-=this.localOrigin[l],e[l+3]-=this.localOrigin[l];return e}},Rnt=class{constructor(e=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=C(),this._tmpMbs=_n(),this._tmpObb=new bOe,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Ve(e)}applyToVertex(e,i,r){const s=pe(ine,e,i,r),n=pe(TOe,e,i,r+this.componentLocalOriginLength),o=this._totalOffset/Ve(n);return Dn(this._tmpVertex,s,n,o),this._tmpVertex}applyToAabb(e){const i=this.componentLocalOriginLength,r=e[0],s=e[1],n=e[2]+i,o=e[3],a=e[4],l=e[5]+i,c=Math.abs(r),u=Math.abs(s),d=Math.abs(n),f=Math.abs(o),m=Math.abs(a),g=Math.abs(l),y=.5*(1+Math.sign(r*o))*Math.min(c,f),v=.5*(1+Math.sign(s*a))*Math.min(u,m),b=.5*(1+Math.sign(n*l))*Math.min(d,g),w=Math.max(c,f),x=Math.max(u,m),T=Math.max(d,g),E=Math.sqrt(y*y+v*v+b*b),M=Math.sign(c+r),O=Math.sign(u+s),D=Math.sign(d+n),U=Math.sign(f+o),k=Math.sign(m+a),H=Math.sign(g+l),V=this._totalOffset;if(E<V)return e[0]-=(1-M)*V,e[1]-=(1-O)*V,e[2]-=(1-D)*V,e[3]+=U*V,e[4]+=k*V,e[5]+=H*V,e;const X=V/Math.sqrt(w*w+x*x+T*T),q=V/E,Z=q-X,ye=-Z;return e[0]+=r*(M*ye+q),e[1]+=s*(O*ye+q),e[2]+=n*(D*ye+q),e[3]+=o*(U*Z+X),e[4]+=a*(k*Z+X),e[5]+=l*(H*Z+X),e}applyToMbs(e){const i=Ve(e),r=this._totalOffset/i;return Dn(this._tmpMbs,e,e,r),this._tmpMbs[3]=e[3]+e[3]*this._totalOffset/i,this._tmpMbs}applyToObb(e){return wOe(e,this._totalOffset,this._totalOffset,Je.Global,this._tmpObb),this._tmpObb}},Int=class{constructor(e=0){this.offset=e,this.sphere=_n(),this.tmpVertex=C()}applyToVertex(e,i,r){const s=this.objectTransform.transform,n=pe(ine,e,i,r),o=nt(n,n,s),a=this.offset/Ve(o);Dn(o,o,o,a);const l=this.objectTransform.inverse;return nt(this.tmpVertex,o,l),this.tmpVertex}applyToMinMax(e,i){const r=this.offset/Ve(e);Dn(e,e,e,r);const s=this.offset/Ve(i);Dn(i,i,i,s)}applyToAabb(e){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const i=Ve(e),r=this.offset/i;return Dn(this.sphere,e,e,r),this.sphere[3]=e[3]+e[3]*this.offset/i,this.sphere}};const Ape=new Int;function MX(t){return t!=null?(Ape.offset=t,Ape):null}const Ppe=new Rnt;function Ope(t){return t!=null?(Ppe.offset=t,Ppe):null}const $pe=new $nt;function Lnt(t){return t!=null?($pe.offset=t,$pe):null}const Xb="terrain",ine=C(),TOe=C(),Dnt=C(),Nnt=C(),Fnt=C(),$P=1e-5;let knt=class{constructor(e){this.options=new pst,this._results=new Unt,this.transform=new Ont,this.tolerance=$P,this.verticalOffset=null,this._ray=mo(),this._rayEnd=C(),this._rayBeginTransformed=C(),this._rayEndTransformed=C(),this.viewingMode=e??Je.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,i,r){this.resetWithRay(fPe(e,i,this._ray),r)}resetWithRay(e,i){this.camera=i,e!==this._ray&&lB(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===Je.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,Ee(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,i,r,s,n){var a;this.point=i,this.filterPredicate=s,this.tolerance=r??$P;const o=MX(this.verticalOffset);if(e&&e.length>0){const l=n?c=>{n(c)&&this.intersectObject(c)}:c=>{this.intersectObject(c)};for(const c of e){const u=(a=c.getSpatialQueryAccelerator)==null?void 0:a.call(c);u!=null?(o!=null?u.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,l,o):u.forEachAlongRay(this._ray.origin,this._ray.direction,l),this.options.selectionMode&&this.options.hud&&u.forEachDegenerateObject(l)):c.objects.forAll(d=>l(d))}}this.sortResults()}intersectObject(e){const i=e.geometries;if(!i)return;const r=e.effectiveTransformation,s=MX(this.verticalOffset);for(const n of i){if(!n.visible)continue;const{material:o,id:a}=n;this.transform.setAndInvalidateLazyTransforms(r,n.transformation),nt(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),nt(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;s!=null&&(s.objectTransform=this.transform),o.intersect(n,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,u,d,f,m,g)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const y=f?this._results.hud:this._results,v=f?b=>{const w=new mst(e,a,d,g);b.set(as.HUD,w,c,u,Jr,m)}:b=>b.set(as.OBJECT,{object:e,geometryId:a,triangleNr:d},c,u,l,m);if((y.min.drapedLayerOrder==null||m>=y.min.drapedLayerOrder)&&(y.min.dist==null||c<y.min.dist)&&v(y.min),this.options.store!==fa.MIN&&(y.max.drapedLayerOrder==null||m<y.max.drapedLayerOrder)&&(y.max.dist==null||c>y.max.dist)&&v(y.max),this.options.store===fa.ALL)if(f){const b=new AX(this._ray);v(b),this._results.hud.all.push(b)}else{const b=new OA(this._ray);v(b),this._results.all.push(b)}}})}}sortResults(e=this._results.all){e.sort((i,r)=>i.dist!==r.dist?(i.dist??0)-(r.dist??0):i.drapedLayerOrder!==r.drapedLayerOrder?Rpe(i.drapedLayerOrder,r.drapedLayerOrder):Rpe(i.drapedLayerGraphicOrder,r.drapedLayerGraphicOrder))}};function Rpe(t,e){return(e??-Number.MAX_VALUE)-(t??-Number.MAX_VALUE)}function gp(t){return new knt(t)}let Unt=class{constructor(){this.min=new OA(mo()),this.max=new OA(mo()),this.hud={min:new AX(mo()),max:new AX(mo()),all:new Array},this.ground=new OA(mo()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},OA=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(de(qF,this.ray.direction,this.dist),Ve(qF)):null}getIntersectionPoint(e){return!!bp(this)&&(de(qF,this.ray.direction,this.dist),Ee(e,this.ray.origin,qF),!0)}getTransformedNormal(e){return ve(_$,this.normal),_$[3]=0,Vu(_$,_$,this.transformation),ve(e,_$),Ce(e,e)}constructor(e){this.intersector=as.OBJECT,this.normal=C(),this.transformation=ke(),this._ray=mo(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=as.OBJECT,lB(e,this._ray)}set(e,i,r,s,n,o,a){this.intersector=e,this.dist=r,ve(this.normal,s??hP),An(this.transformation,n??Jr),this.target=i,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){lB(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,ve(this.normal,e.normal),An(this.transformation,e.transformation)}},AX=class extends OA{constructor(){super(...arguments),this.intersector=as.HUD}};function rne(t){return new OA(t)}const qF=C(),_$=ci();function SOe(t,e,i,r){return t.renderCoordsHelper.fromRenderCoords(e.eye,mB,r)!=null&&vMe(i,mB)}function d6(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function Z2(t,e,i,r){const s=t.state.camera.clone();e&&i&&r&&(s.eye=e,s.center=i,s.up=r),Vnt(t,s.ray,wv)||ve(wv,s.center);const n=t.state.constraints,o=n.minimumPoiDistance;if(yo(s.eye,wv)<o){const a=n.collision.enabled;ve(qw,s.viewForward),de(qw,qw,o),a?s.eye=$e(mB,wv,qw):Ee(wv,s.eye,qw);const l=t.renderCoordsHelper,c=l.getAltitude(s.eye),u=n.collision.elevationMargin;a&&c<u&&($e(qw,wv,s.eye),s.eye=l.setAltitude(mB,u,s.eye),Ee(wv,s.eye,qw))}return s.center=wv,s}function Ipe(t,e,i){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const r=d6(t,e),s=t.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(e,i,t.renderDataExtent,r,Bnt),o=n*n;return yo(e,i)>o}function Vnt(t,e,i){let r=Lpe[t.viewingMode];r||(r=gp(t.state.viewingMode),r.options.backfacesTerrain=!t.state.isGlobal,r.options.invisibleTerrain=!0,Lpe[t.viewingMode]=r);const{isGlobal:s}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,r,i)||Ipe(t,e.origin,i))||!(!t.renderCoordsHelper.intersectManifold(e,0,i)||Ipe(t,e.origin,i))||!!s&&znt(e,i,br(t.spatialReference).radius)}function znt(t,e,i){const r=Te(t.origin,t.origin)-i*i,s=r>0?Math.sqrt(r)/3:1;return de(e,t.direction,s/Ve(t.direction)),Ee(e,e,t.origin),!0}const Lpe={},mB=C(),wv=C(),qw=C(),Bnt={near:0,far:0},jnt=C(),WF=C();function sne(){return{direction:C(),up:C()}}function EOe(t,e,i,r,s){let n=Ce(jnt,t),o=Te(n,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(Te(e,r)),o<.99?(ve(n,e),a&&de(n,n,-1)):n=null);let l=0;if(n){de(WF,r,Te(r,n)),$e(n,n,WF);const u=Te(n,s)/(Ve(n)*Ve(s));mt(WF,n,s),l=(Te(WF,r)>0?1:-1)*ja(vo(u))}const c=ja(vo(-Te(r,t)/Ve(t)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}const COe=qe(0,1,0),MOe=qe(0,0,1),v$=ke(),Yy=C(),Xy=C();function AOe(t,e,i,r=sne()){const{direction:s,up:n}=r;return HCe(v$,-kt(e)),fP(v$,v$,kt(i)),nt(s,MOe,v$),de(s,s,-1),nt(n,COe,v$),r}function Gnt(t,e,i,r){return EOe(e,i,r,MOe,COe)}function Hnt(t,e,i,r){const s=AOe(t,i,r),n=C();return de(n,s.direction,-e),Ee(n,n,t),{up:s.up,eye:n,heading:i,tilt:r}}function qnt(t){return ja(t)}function Wnt(t){return kt(t)}function POe(t,e,i,r,s){const n=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return xl(e,Yy,n),xl(e,Xy,n),Yy[0]-=i/2,Xy[0]+=i/2,Yy[1]-=r/2,Xy[1]+=r/2,Go(Yy,n,Yy,o),Go(Xy,n,Xy,o),s?(s.xmin=Yy[0],s.ymin=Yy[1],s.xmax=Xy[0],s.ymax=Xy[1],s.spatialReference=o):s=new dr(Yy[0],Yy[1],Xy[0],Xy[1],o),s}const Znt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Gnt,eyeForCenterWithHeadingTilt:Hnt,eyeTiltToLookAtTilt:Wnt,headingTiltToDirectionUp:AOe,lookAtTiltToEyeTilt:qnt,toExtent:POe},Symbol.toStringTag,{value:"Module"}));function Dpe(t,e,i){if(e.longitude==null||e.latitude==null||i.longitude==null||i.latitude==null)throw new Error("Invalid points: no lon/lat");return Ynt(t,e.longitude,e.latitude,i.longitude,i.latitude)}function Ynt(t,e,i,r,s){const n=kt(i),o=kt(s),a=n-o,l=kt(e)-kt(r),c=Math.sin(a/2),u=Math.sin(l/2),d=2*lm(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*u*u))*t;return Math.round(1e4*d)/1e4}function Xnt(t,e,i){const r=e.spatialReference,s=br(r),n=new wt(e.x,t.y,r),o=new wt(i.x,t.y,r),a=new wt(t.x,e.y,r),l=new wt(t.x,i.y,r);return{lon:Dpe(s.radius,n,o),lat:Dpe(s.radius,a,l)}}function Jnt(t,e,i){const r=e/i,s=kt(t),n=Math.sin(r/2),o=Math.cos(s),a=2*lm(Math.sqrt(n*n/(o*o)));return ja(a)}function Qnt(t,e){return t/15}function Npe(t,e){const i=t==null?void 0:t[0];if(i==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=Qnt(i);const r=e.hours%1;e.hours-=r,e.minutes=60*r;const s=e.minutes%1;return e.minutes-=s,e.seconds=Math.round(60*s),e}const OOe=qe(0,0,1),$Oe=Ce(C(),qe(1,1,1)),Knt=new zb(-180,180),b$=ke(),N1=C(),bE=C();function ROe(t,e,i,r=sne()){mt(N1,t,OOe),Te(N1,N1)===0&&mt(N1,t,$Oe),qu(b$,-kt(e),t),Uu(b$,b$,-kt(i),N1);const{up:s,direction:n}=r;return mt(s,N1,t),Ce(s,s),nt(s,s,b$),Ce(n,t),da(n,n),nt(n,n,b$),r}function eot(t,e,i,r){const s=N1,n=bE;return Ce(s,t),mt(bE,s,OOe),Te(bE,bE)===0&&mt(bE,s,$Oe),mt(n,bE,s),EOe(e,i,r,s,n)}function tot(t,e,i,r){const s={eye:C(),up:null,tilt:r,heading:i},n=N1;n[0]=t[0],n[1]=t[2],n[2]=-t[1];const o=e,a=kt(i),l=kt(r),c=Math.sin(a),u=Math.cos(a),d=Math.sin(l),f=Math.cos(l),m=Ve(n);let g;if(Math.abs(l)<1e-8)g=o+m;else{const ye=m/d,L=lm(o/ye),N=Math.PI-l-L;g=ye*Math.sin(N)}const y=f*o,v=o*o*(d*d),b=u*u*v,w=g-y,x=w*w,T=b*(b+x-n[1]*n[1]);if(T<0)return de(s.eye,n,g/m),s.tilt=0,ZF(s,t);const E=Math.sqrt(T),M=n[1]*w,O=b+x;let D;if(D=u>0?-E+M:E+M,Math.abs(O)<1e-8)return m<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):de(s.eye,n,g/m),s.tilt=0,JH(s.eye),ZF(s,t);s.eye[1]=D/O;const U=c*c*v,k=d*o,H=u*k*s.eye[1],V=s.eye[1]*s.eye[1],X=1-V,q=Math.sqrt(X),Z=b*V+U-2*H*q*w+X*x;return Math.abs(Z)<1e-8?(de(s.eye,n,g/m),s.tilt=0,JH(s.eye),ZF(s,t)):(s.eye[0]=(X*(g*n[0]-y*n[0])-k*q*(n[0]*s.eye[1]*u+n[2]*c))/Z,s.eye[2]=(X*(g*n[2]-y*n[2])-k*q*(n[2]*s.eye[1]*u-n[0]*c))/Z,de(s.eye,s.eye,g),JH(s.eye),ZF(s,t))}function JH(t){const e=t[1];t[1]=-t[2],t[2]=e}function ZF(t,e){const i=ROe(e,t.heading,t.tilt);return t.up=i.up,t}function iot(t,e,i){const r=Ve(e),s=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-t)),n=lm(i/(s/Math.sin(t)));return ja(t-n)}function rot(t,e,i){const r=kt(t),s=Ve(e);return lm(i/(s/Math.sin(r)))+r}function IOe(t,e,i,r,s){let n,o,a,l;const c=e.latitude,u=br(t.spatialReference).radius,d=e.longitude,f=Jnt(c,i,u)/2;n=d-f,o=d+f;const m=kt(c),g=(1+Math.sin(m))/(1-Math.sin(m)),y=(g+1)*Math.tan(r/u/2),v=y*y;function b(x){const T=Math.PI/2;return(x=OQe.normalize(x,-T))>T&&(x=Math.PI-x),x}if(a=1.5*Math.PI-2*Math.atan(.5*(y+Math.sqrt(4*g+v))),l=a+r/u,a=b(a),l=b(l),l<a){const x=l;l=a,a=x}if(a=Math.max(ja(a),-90),l=Math.min(ja(l),90),o=Knt.monotonic(n,o),o-n>180){const x=(o-n-180)/2;n+=x,o-=x}const w=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:Ye.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=w):s=new dr(n,a,o,l,w),t.spatialReference&&t.spatialReference.isWebMercator&&ty(s,!1,s),s}const sot=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:eot,eyeForCenterWithHeadingTilt:tot,eyeTiltToLookAtTilt:rot,headingTiltToDirectionUp:ROe,lookAtTiltToEyeTilt:iot,toExtent:IOe},Symbol.toStringTag,{value:"Module"}));function gB(t){return t.type==="point"}let nne=class{constructor(e,i=null,r=0){this.array=e,this.spatialReference=i,this.offset=r}};function LOe(t){return"array"in t}function Gg(t,e,i="ground"){if(gB(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,i);if(LOe(e)){let r=e.offset;return t.getElevation(e.array[r++],e.array[r++],e.array[r]||0,e.spatialReference??t.spatialReference,i)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,i)}const DOe=()=>ne.getLogger("esri.views.3d.support.cameraUtils"),NOe=39.37,FOe=96,PX=1,not=8,oot=5,kOe=1,Fpe=C(),aot={heading:0,tilt:0},O3=C(),lot=new zb(-20037508342788905e-9,20037508342788905e-9),cot=new zb(-180,180);var Ua;function bw(t){return t.spatialReference??Ye.WGS84}function MO(t){return t.viewingMode==="global"?sot:Znt}function uot(t,e,i,r,s){return MO(t).headingTiltToDirectionUp(e,i,r,s)}function j0(t,e){if(e==null)return null;const i=t.renderSpatialReference,r=MO(t).headingTiltToDirectionUp,s=C();if(!xl(e.position,s,i))return null;const n=r(s,e.heading,e.tilt);de(n.direction,n.direction,t.state.camera.distance),Ee(n.direction,n.direction,s);const o=Z2(t,s,n.direction,n.up);return o.fov=kt(e.fov),o.row=e.layout.row,o.rows=e.layout.rows,o.column=e.layout.column,o.columns=e.layout.columns,o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(Ua||(Ua={}));const wE=C();function RP(t,e,i){const r=t.renderSpatialReference,s=f6(t,e.eye,e.viewForward,e.up,aot);let n=bw(t);return Go(e.eye,r,wE,n)||(n=Ye.WGS84,Go(e.eye,r,wE,n)),i==null?i=new ed(new wt(wE,n),s.heading,s.tilt,ja(e.fov)):(i.position.x=wE[0],i.position.y=wE[1],i.position.z=wE[2],i.position.spatialReference=n,i.heading=s.heading,i.tilt=s.tilt,i.fov=ja(e.fov)),i.layout.row=e.row,i.layout.rows=e.rows,i.layout.column=e.column,i.layout.columns=e.columns,i}function p6(t,e,i){const r=t.state.camera,s=r.width/2/r.pixelRatio;return t.renderCoordsHelper.viewingMode===Je.Global&&i!=null&&(e*=Math.cos(kt(i))),e/=t.renderCoordsHelper.unitInMeters,s/(FOe*NOe/e)/Math.tan(r.fovX/2)}function Jb(t,e,i){const r=t.state.camera,s=e*Math.tan(r.fovX/2),n=r.width/2/r.pixelRatio;let o=FOe*NOe/(n/s);return t.renderCoordsHelper.viewingMode===Je.Global&&i!=null&&(o/=Math.cos(kt(i))),o*t.renderCoordsHelper.unitInMeters}async function UOe(t,e,i,r,s,n){return VOe(t,e,p6(t,i,e.latitude),r,s,n)}function hot(t,e,i,r,s,n){return e$e(t,one(t,r.heading,r.tilt,e,i,s),r.fov,n)}async function VOe(t,e,i,r,s,n){const o=await BOe(t,r.heading,r.tilt,e,i,s,n);return Dt(n),t$e(t,o,r.fov,n)}function f6(t,e,i,r,s){return MO(t).directionToHeadingTilt(e,i,r,s)}function zOe(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,O3,t.spatialReference)&&t.elevationProvider&&(Gg(t.elevationProvider,O3)??0)>O3[2]-kOe)}async function dot(t,e,i){if(zOe(t,e))return!0;const{elevationProvider:r,spatialReference:s,renderCoordsHelper:n}=t;if(r==null||!n.fromRenderCoords(e,O3,s))return!1;const[o,a,l]=O3,c=await r.queryElevation(o,a,l,s,"ground",i)??0;return Dt(i),c>l-kOe}async function pot(t,e,i){const r=C();if(e==null)return ve(r,t.state.camera.center);if(e instanceof wt){const{renderSpatialReference:s,basemapTerrain:n,elevationProvider:o}=t,a=e.spatialReference;if(await sB(e,r,s,0,{signal:i}),Dt(i),e.z==null&&n!=null&&o!=null){const l=await o.queryElevation(e.x,e.y,e.z??0,a,"ground",i);Dt(i),l!=null&&t.renderCoordsHelper.setAltitude(r,l)}return r}return ve(r,e)}function fot(t,e){const i=C();if(e==null)return ve(i,t.state.camera.center);if(e instanceof wt){if(!xl(e,i,t.renderSpatialReference))return null;const{basemapTerrain:r,elevationProvider:s}=t;if(e.z==null&&r!=null&&s!=null){const n=Gg(s,e);n!=null&&t.renderCoordsHelper.setAltitude(i,n)}return i}return ve(i,e)}function one(t,e,i,r,s,n){return jOe(t,e,i,r instanceof wt?r:null,fot(t,r),s,n)}async function BOe(t,e,i,r,s,n,o){const a=r instanceof wt?r:null,l=await pot(t,r,o);return Dt(o),GOe(t,e,i,a,l,s,n,o)}function jOe(t,e,i,r,s,n,o){if(s==null||!r&&(r=new wt({spatialReference:bw(t)}),!vw(s,t.renderSpatialReference,r)))return null;const a=HOe(t,e,i,s,n,o);if(qOe(t,i,o)&&zOe(t,a.eye)){const{tilt:l,mode:c}=WOe(t,i,s,n);return jOe(t,e,l,r,s,n,c)}return ZOe(a,s)}async function GOe(t,e,i,r,s,n,o,a){r||(r=new wt({spatialReference:bw(t)}),await aOe(s,t.renderSpatialReference,r,{signal:a})||(r=null)),Dt(a);const l=HOe(t,e,i,s,n,o);if(qOe(t,i,o)&&await dot(t,l.eye,a)){Dt(a);const{tilt:c,mode:u}=WOe(t,i,s,n);return GOe(t,e,c,r,s,n,u,a)}return ZOe(l,s)}function HOe(t,e,i,r,s,n){const o=got(t,e,i,r,s=Math.max(s,t.state.constraints.minimumPoiDistance),n);return(0,MO(t).eyeForCenterWithHeadingTilt)(r,s,o.heading,o.tilt)}function qOe(t,e,i){const r=t.map.ground.navigationConstraint;return i===Ua.ADJUST&&t.viewingMode==="global"&&e>0&&(r==null||r.type==="stay-above")}function WOe(t,e,i,r){const s=KOe(t,i,r,_ot(t,r,e,i));return{tilt:s,mode:e-s<1?Ua.LOCKED:Ua.ADJUST}}function ZOe(t,e){return{...t,center:yn(e)}}function YOe(t,e){const{state:i,spatialReference:r}=t,s=e.spatialReference;return i.isGlobal&&VL(s,Je.Global)||i.isLocal&&r.equals(s)}function XOe(t,e){let i,r,s;if(t.state.isGlobal){const u=new wt(e.xmin,e.ymin,e.spatialReference),d=new wt(e.xmax,e.ymax,e.spatialReference),f=e.spatialReference.isGeographic?cot:lot;i=new wt({x:f.center(u.x,d.x),y:(d.y+u.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const m=br(e.spatialReference),g=Xnt(i,u,d);r=g.lon,s=g.lat,f.diff(u.x,d.x)>f.range/2&&(r+=m.halfCircumference),r=Math.min(r,m.halfCircumference),s=Math.min(s,m.halfCircumference)}else{const u=t.renderSpatialReference??e.spatialReference;u.equals(e.spatialReference)||(e=V_(e,u)),r=e.xmax-e.xmin,s=e.ymax-e.ymin;const d=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;i=new wt({x:e.xmin+.5*r,y:e.ymin+.5*s,z:d,spatialReference:u})}const n=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,o=t.state.camera,a=1/Math.tan(o.fovX/2),l=1/Math.tan(o.fovY/2),c=1/Math.tan(o.fov/2);return{center:i,distance:Math.max(.5*r*a,.5*s*l,.5*n*c)/PX}}async function JOe(t,e,i,r,s,n){const o=YOe(t,e)?e:await qb(e,t.spatialReference,{signal:n});Dt(n);const{center:a,distance:l}=XOe(t,o),c=await BOe(t,i,r,a,l,s,n);return Dt(n),t$e(t,c,t.camera.fov,n)}function uU(t,e,i,r,s,n){let o;try{o=YOe(t,e)?e:V_(e,t.spatialReference)}catch{return null}const{center:a,distance:l}=XOe(t,o),c=one(t,i,r,a,l,s);return c==null?null:e$e(t,c,t.camera.fov,n)}function QOe(t,e,i){const r=t.renderSpatialReference,s=new wt({spatialReference:bw(t)});if(!vw(i,r,s))return null;const n=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=gb(e.eye,i),l=2*a*n*PX,c=2*a*o*PX;return t.viewingMode==="global"?IOe(t,s,l,c):POe(t,s,l,c)}function mot(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>not)return!0;const s=e,n=t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;return Ar(s,n)/(Math.tan(.5*t.state.camera.fov)*r)>oot}function got(t,e,i,r,s,n){let o=0;return n===Ua.ADJUST&&mot(t,r,s)?(e=0,o=yot(t,s,i,r)):o=ane(t,r,s,i),o=t.state.constraints.clampTilt(s,o),{heading:e,tilt:i=KOe(t,r,s,o)}}const yB=.7;function yot(t,e,i,r){const s=ane(t,r,e,i);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);n.max=Math.min(n.max,.5*Math.PI);const o=n.min*(1-yB)+n.max*yB;return Math.min(s,o)}function _ot(t,e,i,r){let s=ane(t,r,e,i);if(!t.state.constraints.tilt)return s;const n=t.state.constraints.tilt(e);return s=Math.min(s,.5*Math.PI),n.min*(1-yB)+s*yB}function KOe(t,e,i,r){return MO(t).lookAtTiltToEyeTilt(r,e,i)}function ane(t,e,i,r){return MO(t).eyeTiltToLookAtTilt(r,e,i)}function e$e(t,e,i,r){if(e==null)return null;const s=t.renderSpatialReference,n=new wt({spatialReference:bw(t)});return vw(e.eye,s,n)?(r??(r=new ed),r.position=n,r.heading=e.heading,r.tilt=e.tilt,r.fov=i,r):null}async function t$e(t,e,i,r){const s=t.renderSpatialReference,n=new wt({spatialReference:bw(t)});return await aOe(e.eye,s,n,{signal:r}),Dt(r),new ed(n,e.heading,e.tilt,i)}function vot(t,e){var r;const i=(r=t.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.levelAtScale(e);DOe().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function i$e(t,e){var r;const i=(r=t.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.scaleAtLevel(e);DOe().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function r$e(t,e){const{renderSpatialReference:i}=t,r=dst(i);let s=null;try{Go(e.center,i,Fpe,r)&&(s=Fpe[1])}catch{}return Jb(t,e.distance,s)}const lne=()=>ne.getLogger("esri.layers.support.ElevationSampler");let s$e=class{queryElevation(e){return n$e(e.clone(),this)}on(){return Gi()}projectIfRequired(e,i){return o$e(e,i)}},bot=class extends s$e{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){super(),this.tile=e,this.noDataValue=r;const s=e.tile.extent;this.extent=kG(s,i.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=s;const n=cc(i.spatialReference),o=i.lodAt(e.tile.level).resolution*n;this.demResolution={min:o,max:o}}contains(e){const i=this.projectIfRequired(e,this.spatialReference);return i!=null&&this.containsAt(i.x,i.y)}containsAt(e,i){return UG(this._aaExtent,e,i)}elevationAt(e,i){if(!this.containsAt(e,i)){const r=this.extent,s=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return lne().warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return this.tile.sample(e,i)??this.noDataValue}},jYt=class extends s$e{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){let s;super(),typeof i=="number"?(this.noDataValue=i,s=null):(s=i,this.noDataValue=r),this.samplers=s?e.map(o=>new bot(o,s,this.noDataValue)):e;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=kG(oi(),s.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,i){let r,s=!1;for(const n of this.samplers)if(n.containsAt(e,i)&&(s=!0,r=n.elevationAt(e,i),r!==n.noDataValue))return r;return r??(s||lne().warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler`),this.noDataValue)}};function n$e(t,e){const i=o$e(t,e.spatialReference);if(!i)return null;switch(t.type){case"point":wot(t,i,e);break;case"polyline":xot(t,i,e);break;case"multipoint":Tot(t,i,e)}return t}function o$e(t,e){if(t==null)return null;const i=t.spatialReference;if(i.equals(e))return t;const r=qD(t,e);return r||lne().error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),r}function wot(t,e,i){t.z=i.elevationAt(e.x,e.y)}function xot(t,e,i){Dg.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s],o=e.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];Dg.x=c[0],Dg.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(Dg.x,Dg.y)}}t.hasZ=!0}function Tot(t,e,i){Dg.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let s=0;s<t.points.length;s++){const n=t.points[s],o=e.points[s];Dg.x=o[0],Dg.y=o[1],r&&(n[3]=n[2]),n[2]=i.elevationAt(Dg.x,Dg.y)}t.hasZ=!0}const Dg=new wt;var OX;let Km=OX=class extends Se{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new OX({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};h([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Km.prototype,"cols",void 0),h([p({type:Ji,json:{write:!0}})],Km.prototype,"level",void 0),h([p({type:String,json:{write:!0}})],Km.prototype,"levelValue",void 0),h([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Km.prototype,"origin",void 0),h([p({type:Number,json:{write:!0}})],Km.prototype,"resolution",void 0),h([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Km.prototype,"rows",void 0),h([p({type:Number,json:{write:!0}})],Km.prototype,"scale",void 0),Km=OX=h([I("esri.layers.support.LOD")],Km);const Pf=Km;let Sot=class{constructor(e,i,r,s,n=void 0){this.id=e,this.level=i,this.row=r,this.col=s,this.extent=n}};var t1;const kpe=new Qi({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Qa=t1=class extends Se{static create(t={}){const{resolutionFactor:e=1,scales:i,size:r=256,spatialReference:s=Ye.WebMercator,numLODs:n=24}=t;if(!zf(s)){const d=[];if(i)for(let f=0;f<i.length;f++){const m=i[f];d.push(new Pf({level:f,scale:m,resolution:m}))}else{let f=5e-4;for(let m=n-1;m>=0;m--)d.unshift(new Pf({level:m,scale:f,resolution:f})),f*=2}return new t1({dpi:96,lods:d,origin:new wt(0,0,s),size:[r,r],spatialReference:s})}const o=ey(s),a=t.origin?new wt({x:t.origin.x,y:t.origin.y,spatialReference:s}):new wt(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(cc(s)*39.37*l),u=[];if(i)for(let d=0;d<i.length;d++){const f=i[d],m=f*c;u.push(new Pf({level:d,scale:f,resolution:m}))}else{let d=GD(s)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const f=Math.ceil(n/e);u.push(new Pf({level:0,scale:d,resolution:d*c}));for(let m=1;m<f;m++){const g=d/2**e,y=g*c;u.push(new Pf({level:m,scale:g,resolution:y})),d=g}}return new t1({dpi:l,lods:u,origin:a,size:[r,r],spatialReference:s})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const i=ey(t);return t.isWrappable&&!!i&&Math.abs(i.origin[0]-e.x)<=i.dx}return!1}readOrigin(t,e){return wt.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,i=0;const r=[],s=this._levelToLOD={};t&&(e=-1/0,i=1/0,t.forEach(n=>{r.push(n.scale),e=n.scale>e?n.scale:e,i=n.scale<i?n.scale:i,s[n.level]=n})),this._set("scales",r),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const i=Math.floor(t),r=i+1;return e[i]/(e[i]/e[r])**(t-i)}scaleToZoom(t){const e=this.scales,i=e.length-1;let r=0;for(;r<i;r++){const s=e[r],n=e[r+1];if(s<=t)return r;if(n===t)return r+1;if(s>t&&n<t)return r+Math.log(s/t)/Math.log(s/n)}return r}tileAt(t,e,i,r){const s=this.lodAt(t);if(!s)return null;let n,o;if(typeof e=="number")n=e,o=i;else if(ms(e.spatialReference,this.spatialReference))n=e.x,o=e.y,r=i;else{const c=qD(e,this.spatialReference);if(c==null)return null;n=c.x,o=c.y,r=i}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return r||(r=new Sot(null,0,0,0,oi())),r.level=t,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(t,e=t1.ExtrapolateOptions.NONE){let i=this.lodAt(t.level);if(!i&&e===t1.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(i=o)}if(!i)return;const r=t.level-i.level,s=i.resolution*this.size[0]/2**r,n=i.resolution*this.size[1]/2**r;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=oi()),t.extent[0]=this.origin.x+t.col*s,t.extent[1]=this.origin.y-(t.row+1)*n,t.extent[2]=t.extent[0]+s,t.extent[3]=t.extent[1]+n}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const i=this.lodAt(e.level);if(i==null)return null;const{resolution:r}=i,s=r*this.size[0],n=r*this.size[1];return t[0]=this.origin.x+e.col*s,t[1]=this.origin.y-(e.row+1)*n,t[2]=t[0]+s,t[3]=t[1]+n,t}lodAt(t){var e;return((e=this._levelToLOD)==null?void 0:e[t])??null}clone(){return t1.fromJSON(this.write({}))}getCompatibleForVTL(t){if(this.size[0]!==this.size[1]||this.size[0]===256&&t===512)return null;const e=(this.size[0]===512&&t===256?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===t&&e===0)return this;const i=[],r=this.lods.length-e;for(let s=0;s<r;s++){const n=s+e,{scale:o,resolution:a}=n>=0?this.lods[n]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};i.push(new Pf({level:s,scale:o,resolution:a}))}return new t1({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let i=0;i<t.length;i++){const r=t[i];this._upsampleLevels[r.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/r.resolution:0},e=r}}};h([p({type:Number,json:{write:!0}})],Qa.prototype,"compressionQuality",void 0),h([p({type:Number,json:{write:!0}})],Qa.prototype,"dpi",void 0),h([p({type:String,json:{read:kpe.read,write:kpe.write,origins:{"web-scene":{read:!1,write:!1}}}})],Qa.prototype,"format",void 0),h([p({readOnly:!0})],Qa.prototype,"isWrappable",null),h([p({type:wt,json:{write:!0}})],Qa.prototype,"origin",void 0),h([ze("origin")],Qa.prototype,"readOrigin",null),h([p({type:[Pf],value:null,json:{write:!0}})],Qa.prototype,"lods",null),h([p({readOnly:!0})],Qa.prototype,"scales",void 0),h([p({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],Qa.prototype,"size",void 0),h([ze("size",["rows","cols"])],Qa.prototype,"readSize",null),h([Ze("size",{cols:{type:Ji},rows:{type:Ji}})],Qa.prototype,"writeSize",null),h([p({type:Ye,json:{write:!0}})],Qa.prototype,"spatialReference",void 0),Qa=t1=h([I("esri.layers.support.TileInfo")],Qa),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(Qa||(Qa={}));const hU=Qa,Eot=12;let $u=class uu{constructor(e){const i=uu.checkUnsupported(e);if(i!=null)throw i;const r=e;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=GD(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const s=r.lods.reduce((c,u)=>(u.level<c.minLod.level&&(c.minLod=u),c.max=Math.max(c.max,u.level),c),{minLod:r.lods[0],max:-1/0}),n=s.minLod,o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,l/=2}clone(){return new uu(this.toTileInfo())}toTileInfo(){return new hU({dpi:this.dpi,origin:new wt({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,i)=>new Pf({level:i,scale:e.scale,resolution:e.resolution}))})}getExtent(e,i,r,s){const n=this.levels[e],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+r*o,s[2]=this.origin[0]+(r+1)*o,s[3]=this.origin[1]-i*a,s[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(e,i){this._isWebMercator?(i[0]=Uhe(e[0]),i[1]=Uz(e[1]),i[2]=Uhe(e[2]),i[3]=Uz(e[3])):this._isGCS&&(i[0]=kt(e[0]),i[1]=kt(e[1]),i[2]=kt(e[2]),i[3]=kt(e[3]))}getExtentGeometry(e,i,r,s=new dr){return this.getExtent(e,i,r,Cm),s.spatialReference=this.spatialReference,s.xmin=Cm[0],s.ymin=Cm[1],s.xmax=Cm[2],s.ymax=Cm[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(e){if(e==null)return!1;let i=!1;for(;this.levels.length<=e;){const{resolution:r,scale:s}=this.levels[this.levels.length-1],n=r/2*this.pixelSize;this.levels.push({resolution:r/2,scale:s/2,tileSize:[n,n]}),i=!0}return i}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const i=this.levels[0].scale;return e>=i?0:Math.log(i/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e,i=1/0){if(uu.checkUnsupported(e))return!1;const r=new uu(e);if(!r.spatialReference.equals(this.spatialReference)||r.pixelSize!==this.pixelSize)return!1;const s=Math.min(this.levels.length-1,r.levels.length-1,i),n=this.levels[s].resolution;let o=.5*n;return!yb(r.origin[0],this.origin[0],o)||!yb(r.origin[1],this.origin[1],o)?!1:(o=.5*n/2**s/this.pixelSize*Eot,yb(n,r.levels[s].resolution,o))}rootTilesInExtent(e,i=null,r=1/0){const s=new Array,n=this.levels[0].tileSize;if(e==null||n[0]===0||n[1]===0)return s;uu.computeRowColExtent(e,n,this.origin,Cm);let o=Cm[1],a=Cm[3],l=Cm[0],c=Cm[2];const u=c-l,d=a-o;if(u*d>r){const f=Math.floor(Math.sqrt(r));d>f&&(o=o+Math.floor(.5*d)-Math.floor(.5*f),a=o+f),u>f&&(l=l+Math.floor(.5*u)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)s.push([0,f,m]);return i!=null&&(i[0]=this.origin[0]+l*n[0],i[1]=this.origin[1]-a*n[1],i[2]=this.origin[0]+c*n[0],i[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(e,i,r,s){const n=.001*(e[2]-e[0]+(e[3]-e[1]));s[0]=Math.max(0,Math.floor((e[0]+n-r[0])/i[0])),s[2]=Math.max(0,Math.ceil((e[2]-n-r[0])/i[0])),s[1]=Math.max(0,Math.floor((r[1]-e[3]+n)/i[1])),s[3]=Math.max(0,Math.ceil((r[1]-e[1]-n)/i[1]))}static isPowerOfTwo(e){const i=e.lods,r=i[0].resolution*2**i[0].level;return!i.some(s=>!QXe(s.resolution,r/2**s.level))}static hasGapInLevels(e){const i=e.lods.map(r=>r.level);i.sort((r,s)=>r-s);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(e){const i=e.size[1];return i===e.size[0]&&!(i&i-1)&&i>=128&&i<=512}static hasOriginPerLODs(e){const i=e.origin;return e.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new B("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?cne():e.lods.length<1?new B("tilingscheme:generic","Tiling scheme must have at least one level"):uu.isPowerOfTwo(e)?uu.hasGapInLevels(e)?new B("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):uu.tileSizeSupported(e)?uu.hasOriginPerLODs(e)?new B("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new B("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new B("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,i){const r=e[2]-e[0],s=e[3]-e[1],n=cc(i),o=1.2*Math.max(r,s),a=256,l=o/a,c=l*n*(96/.0254),u=new uu(new hU({size:[a,a],origin:new wt({x:e[0]-.5*(o-r),y:e[3]+.5*(o-s)}),lods:[new Pf({level:0,resolution:l,scale:c})],spatialReference:i}));return u.ensureMaxLod(20),u}static makeWebMercatorAuxiliarySphere(e){const i=new uu(uu.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(e),i}static makeGCSWithTileSize(e,i=256,r=16){const s=256/i,n=new uu(new hU({size:[i,i],origin:new wt({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new Pf({level:0,resolution:.703125*s,scale:295497598570834e-6*s})]}));return n.ensureMaxLod(r),n}get test(){}};function cne(){return new B("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}$u.WebMercatorAuxiliarySphereTileInfo=new hU({size:[256,256],origin:new wt({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Ye.WebMercator}),spatialReference:Ye.WebMercator,lods:[new Pf({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),$u.WebMercatorAuxiliarySphere=$u.makeWebMercatorAuxiliarySphere(19);const Cm=oi(),kM=64,OR=512,Cot=2.5,une=KXe(aY/10),a$e=2,l$e=oi();$u.WebMercatorAuxiliarySphere.getExtent(0,0,0,l$e);const Mot=oi([-180,-90,180,90]),Aot="Cannot extend surface to encompass all layers because it would result in too many root tiles.",Pot="Surface extent is too large for tile resolution at level 0.",qn=4;let i1=class extends Ls.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=une}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if((e==null?void 0:e.extent)==null||e.spatialReference==null)return null;const i=kG(e.extent,e.spatialReference);return i.zmin=e.visibleElevationBounds.min,i.zmax=e.visibleElevationBounds.max,i}get spatialReference(){var e;return((e=this.view.basemapTerrain)==null?void 0:e.spatialReference)??Ye.WGS84}elevationAt(e,i){var r;if(this.extent==null||!ql(this.extent,e,i)){const s=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return ne.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return((r=this.view.elevationProvider)==null?void 0:r.getElevation(e,i,0,this.spatialReference,"ground"))??this.noDataValue}queryElevation(e){return n$e(e.clone(),this)}};h([p({readOnly:!0})],i1.prototype,"demResolution",void 0),h([p({readOnly:!0})],i1.prototype,"extent",null),h([p({readOnly:!0})],i1.prototype,"noDataValue",void 0),h([p()],i1.prototype,"spatialReference",null),h([p({constructOnly:!0})],i1.prototype,"view",void 0),i1=h([I("esri.views.support.GroundViewElevationSampler")],i1);const Oot=i1;let g0=class extends Ue{constructor(e){super(e),this.view=null,this.layerViews=new Ke}initialize(){this.addHandles(jo(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.ground},e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new Oot({view:this.view}):null:null}get extent(){const e=this.view;return e&&e.type!=="2d"&&e.ready?QOe(e,e.state.camera,e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>te(()=>e.updating,()=>this._updateUpdating(),lr)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};h([p({readOnly:!0})],g0.prototype,"elevationSampler",null),h([p({readOnly:!0})],g0.prototype,"extent",null),h([p({type:Boolean,readOnly:!0})],g0.prototype,"updating",null),h([p({constructOnly:!0})],g0.prototype,"view",void 0),h([p({type:Ke,readOnly:!0})],g0.prototype,"layerViews",void 0),h([p({readOnly:!0})],g0.prototype,"suspended",null),g0=h([I("esri.views.GroundView")],g0);const $ot=g0;let O_=class{constructor(e,i){this._owner=i,this._properties={},this._afterDispatchHandle=null;for(const r in e){const s=e[r],n=new H2e(s,void 0,void 0,2,2);this._properties[r]={pool:n,acquired:[]}}this._afterDispatchHandle=tEe(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const i=this._properties[e];for(const r of i.acquired)dhe(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this._properties=null,this._owner=null}get(e){const i=this._owner._get(e),r=this._properties[e];let s=r.pool.acquire();for(r.acquired.push(s);s===i;)r.acquired.push(s),s=r.pool.acquire();return s}_release(){for(const e in this._properties){const i=this._properties[e];let r=0;for(const s of i.acquired)dhe(s)?i.acquired[r++]=s:i.pool.release(s);i.acquired.length=r}}};const Rot=ue("mac")?"Meta":"Control",Iot=new Set(["Alt","Control","Meta","Shift","Ctrl","Primary"]),Lot=t=>Iot.has(t);let Dot=class{constructor(e,i=[]){this.eventType=e,this.keyModifiers=i}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=e.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}},ba=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const i=this._incoming[e];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager||(e.setEventCallback(i=>this._handleEvent(i)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,i,r){let s;typeof i=="function"?(r=i,s=[]):s=i||[];const n=typeof e=="string"?new Dot(e,s):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=u=>{const d=this._incoming[u.match.eventType];if(d){const f=d.indexOf(u);d.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new Not(n,r,{onPause:a,onRemove:a,onResume:u=>{const d=this._incoming[u.match.eventType];d&&!d.includes(u)&&(d.push(u),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const i=new Fot(e,{onEmit:(r,s,n,o)=>{var a;(a=this._manager)==null||a.emit(r.eventType,s,n,o)},onRemove:r=>{var s;delete this._outgoing[r.eventType],(s=this._manager)==null||s.updateDependencies()}});return this._outgoing[e]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(e){var i;(i=this._manager)==null||i.setPointerCapture(e,!0)}stopCapturingPointer(e){var i;(i=this._manager)==null||i.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager&&(this.onUninstall(),this._manager=null)}_handleEvent(e){var r;const i=this._incoming[e.type];if(i){for(const s of i)if(s.match.matches(e)&&((r=s.callback)==null||r.call(s,e),e.shouldStopPropagation()))break}}},Not=class{constructor(e,i,r){this.match=e,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},Fot=class{constructor(e,i){this.eventType=e,this._removed=!1,this._handler=i}emit(e,i,r){this._removed||this._handler.onEmit(this,e,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}},kot=class extends ba{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>{this._update(i.data)})}_update(e){const i=e.native.pointerType==="touch"?"touch":"mouse",{x:r,y:s}=e;i===this._value&&this._x===r&&this._y===s||(this._value=i,this._x=r,this._y=s,this._onChange(i,r,s))}},Uot=class extends ba{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=iy(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},xd=class extends Ue{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=Rot,this._latestPointerType="mouse",this._propertiesPool=new O_({latestPointerLocation:Bot},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const i of e)this.uninstallHandlers(i);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,i,r=Tb.INTERNAL){if(this._nameToGroup[e]||i.length===0)return;const s={name:e,handlers:i.map(n=>({handler:n,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=s;for(let n=s.handlers.length-1;n>=0;n--){const o=s.handlers[n];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,u,d)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,d,u)},setPointerCapture:(a,l)=>{this._setPointerCapture(s,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const i=this._nameToGroup[e];i?(i.handlers.forEach(r=>{var s;r.removed=!0,(s=r.uninstallCallback)==null||s.call(r)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):ne.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}isModifierKeyDown(e){return this._activeKeyModifiers&&this._activeKeyModifiers.has(e)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,i=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const s=this._handlers[r];s.priorityIndex=r,this._handlersPriority.push(s)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const s=this._handlersPriority[r];s.priorityIndex=r;let n=s.handler.hasSideEffects;if(!n){for(const o of s.handler.outgoingEventTypes)if(e.has(o)){n=!0;break}}if(n)for(const o of s.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)Lot(a)||i.add(a)}s.active=n}this._sourceEvents=e,this._keyModifiers=i,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,i,r){this._latestPointerType=e;const s=this._get("latestPointerLocation");if(s==null||s.x!==i||s.y!==r){const n=this._propertiesPool.get("latestPointerLocation");n.x=i,n.y=r,this._set("latestPointerLocation",n)}}_onEventReceived(e,i){if(e==="pointer-capture-lost"){const n=i;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,i);const r=this.test.timestamp!=null?this.test.timestamp:i.native?i.native.timestamp:void 0,s=i.native?i.native.cancelable:void 0;this._emitInputEventFromSource(e,i,r,s)}_updateKeyModifiers(e,i){if(!i)return;let r=!1;const s=()=>{if(!r){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,r=!0}},n=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(s(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(s(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=i.key;this._keyModifiers.has(a)&&n(a,e==="key-down")}const o=i.native;n("Alt",!(!o||!o.altKey)),n("Control",!(!o||!o.ctrlKey)),n("Ctrl",!(!o||!o.ctrlKey)),n("Shift",!(!o||!o.shiftKey)),n("Meta",!(!o||!o.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new kot((e,i,r)=>this._setLatestPointer(e,i,r)),this._multiTouchHandler=new Uot,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],Tb.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Tb.INTERNAL)}_setPointerCapture(e,i,r,s){const n=e.name+"-"+i.priorityIndex,o=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,o),s?(o.add(n),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):o.has(n)&&(o.delete(n),o.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,i,r,s){this._emitInputEvent(0,e,i,r,s)}_emitInputEvent(e,i,r,s,n,o){const a=s!==void 0?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=n!==void 0&&n,c={event:new Vot(i,r,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new rB,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var i,r,s;this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:n,priorityIndex:o}=e.events.pop(),a=(i=n.data)==null?void 0:i.eventId;if(!(a!=null&&this._stoppedPropagationEventIds.has(a)))for(e.currentHandler=this._handlersPriority[o];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!n.shouldStopPropagation()&&((s=(r=e.currentHandler).eventCallback)==null||s.call(r,n)),n.shouldStopPropagation()){a!=null&&this._stoppedPropagationEventIds.add(a);break}if(n.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:n,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const i=new rB;i.push(e);const r=this._currentPropagation;if(r){for(;r.events.length;)i.push(r.events.pop());r.events=i,r.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,i){if(e.handler.hasSideEffects!==i.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==i.groupPriority)return e.groupPriority>i.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const s of i.handler.incomingEventMatches){if(r.eventType!==s.eventType)continue;const n=r.keyModifiers.filter(o=>s.keyModifiers.includes(o));if(n.length===r.keyModifiers.length!=(n.length===s.keyModifiers.length))return r.keyModifiers.length>s.keyModifiers.length?-1:1}return e.priorityIndex>i.priorityIndex?-1:1}_sortHandlersPriority(e){const i=[];for(const r of e){let s=0;for(;s<i.length&&this._compareHandlerPriority(r,i[s])>=0;)s++;i.splice(s,0,r)}return i}get debug(){const e=i=>{const r=this._setPointerCapture;this._setPointerCapture=()=>{},i(),this._setPointerCapture=r};return{injectEvent:(i,r)=>{e(()=>{this._onEventReceived(i,r)})},disablePointerCapture:e}}};h([p({readOnly:!0})],xd.prototype,"hasPendingInputs",null),h([p({constructOnly:!0})],xd.prototype,"eventSource",void 0),h([p({constructOnly:!0})],xd.prototype,"recognizers",void 0),h([p()],xd.prototype,"_latestPointerType",void 0),h([p()],xd.prototype,"latestPointerType",null),h([p()],xd.prototype,"multiTouchActive",null),h([p({readOnly:!0})],xd.prototype,"latestPointerLocation",void 0),h([p()],xd.prototype,"_paused",void 0),h([p({readOnly:!0})],xd.prototype,"updating",null),xd=h([I("esri.views.input.InputManager")],xd);let Vot=class{constructor(e,i,r,s,n){this.type=e,this.data=i,this.timestamp=r,this.modifiers=s,this.cancelable=n,this._propagationState=F1.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=F1.STOPPED}shouldStopPropagation(){return!!(this._propagationState&F1.STOPPED)}async(e){this._propagationState|=F1.PAUSED;const i=(r,s)=>{this._propagationState&=~F1.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw r;return r};return(typeof e=="function"?e():e).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(e){return!!(this._propagationState&F1.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var F1;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(F1||(F1={}));const Tb={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let zot=class{};const Bot=zot;function Jy(t){return t!=null&&"open"in t&&"declaredClass"in t}function Upe(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const jot=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([te(()=>[this.ui,this.popup],([i,r],s)=>{const n="popup",o="manual";if(s){const[a,l]=s;a&&Jy(l)&&(l.view=null,Upe(l)&&a.remove(l,n))}i&&Jy(r)&&(r.view=this,Upe(r)&&i.add(r,{key:n,position:o,internal:!0}))},pt),this.on("click",i=>{this.popup&&this.popupEnabled&&(i.pointerType!=="mouse"||i.button===0)&&(Jy(this.popup)?this.popup.viewModel.handleViewClick(i):i.async(async()=>{await this.setupPopup(),Jy(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(i)}))},Tb.WIDGET)]),d2(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{oe(()=>Promise.resolve().then(()=>Wxe),[])})}destroy(){this.destroyed||this.closePopup()}async openPopup(i){if(Jy(this.popup))return this.popup.open(i);try{if(await this.setupPopup(),!this.popup)return void ne.getLogger(this).error(new B("view:null-popup","Popup is null and can't be opened"));this.popup.open(i)}catch{}}closePopup(){var i;(i=this._popupSetupTask)==null||i.abort(),Jy(this.popup)&&this.popup.close()}async fetchPopupFeatures(i,r){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(i,r),r)}async setupPopup(){var i;if((i=this._popupSetupTask)==null||i.abort(),this.popup&&!Jy(this.popup))return this._popupSetupTask=My(async r=>{const{default:s}=await oe(()=>Promise.resolve().then(()=>Wxe),void 0);if(Dt(r),!this.popup||Jy(this.popup))return;const n=this.popup;delete n.open,delete n.close,this.popup=new s(n)}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:i,hits:r},s){const n=[],o=[];let a=!1;const l=Q9e(s,ue("popup-view-fetch-timeout")??Hot),c=f=>{const m=new Got(f);return o.push(m),n.push(m.promise),m},u=f=>{const m=o.at(-1);return m&&m.layerView===f&&!a?m:c(f)};for(const f of r)"graphic"in f?(u(f.layerView).graphics.push(f.graphic),a=!1):(n.push(f.layerView.fetchPopupFeaturesAtLocation(f.mapPoint,l)),a=!0);o.map(f=>f.resolve(l));const d=wZ(n).then(f=>f.filter(m=>!!m).flat());return{pendingFeatures:n,allGraphicsPromise:d,location:i}}async _getPopupHits(i,r){const{hits:s,location:n}=await this.popupHitTest(i);Dt(r);const o=[];for(const a of s)if("graphic"in a){if(this._isValidPopupGraphic(a.graphic,r)){const l=this._isValidPopupGraphicsLayerView(a.layerView)?a.layerView:void 0;o.push({graphic:a.graphic,layerView:l})}}else this._isValidPopupLocationLayerView(a.layerView)&&o.push({mapPoint:a.mapPoint,layerView:a.layerView});return{hits:o,location:n}}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(r==null?void 0:r.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(i){return!i||(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesFromGraphics"in i}_isValidPopupLocationLayerView(i){return(!("layer"in i)||!i.suspended)&&"fetchPopupFeaturesAtLocation"in i}};return h([p({cast(i){return!i||Jy(i)||typeof i=="object"&&(i.open=r=>(Nb(ne.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(r)),i.close=()=>(Nb(ne.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),i}})],e.prototype,"popup",void 0),h([p()],e.prototype,"popupEnabled",void 0),e=h([I("esri.views.PopupView")],e),e};let Got=class{constructor(e){this.layerView=e,this._resolver=ma(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(e){const{layerView:i,graphics:r,_resolver:s}=this;if(!i)return s.resolve(r),s.promise;let n;return i.fetchPopupFeaturesFromGraphics(r,e).catch(o=>(n=o,null)).then(o=>{o?s.resolve(o):s.reject(n)}),s.promise}};const Hot=5e3;async function hne(t,e){const{WhereClause:i}=await oe(()=>import("./WhereClause-D8vJ2G6A.js").then(r=>r.W),__vite__mapDeps([26,27]));return i.create(t,e)}function qot(t,e){return t==="1=1"?e??t:e==="1=1"?t??e:t!=null&&t!==""?e!=null&&e!==""?`(${t}) AND (${e})`:t:e}function nXt(t){return typeof t=="number"}function dne(t){return typeof t=="string"||t instanceof String}const Wot="yyyy-MM-dd",Zot="TT";var $3;(function(t){t.HM="HH:mm",t.HMS="HH:mm:ss",t.HMS_MS="HH:mm:ss.SSS"})($3||($3={}));const Yot=[$3.HMS_MS,$3.HMS,$3.HM,Zot];function Vpe(t){if(!t||!dne(t))return null;const e=yi.fromFormat(t,Wot);return e.isValid?e:null}function zpe(t){return t&&dne(t)?X9e(Yot,e=>{const i=yi.fromFormat(t,e);return i.isValid?i:null})??null:null}function Bpe(t){if(!t||!dne(t))return null;const e=yi.fromISO(t);return e.isValid?e:null}var IP;(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(IP||(IP={}));const Xot=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function Jot(t){return t!=null&&Xot.has(t.type)}function c$e(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function u$e(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function h$e(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function Qot(t,e,i){const r=t==null?void 0:t.domain;if(!r)return null;switch(r.type){case"range":{const{min:s,max:n}=d$e(t);if(s!=null&&+e<s||n!=null&&+e>n)return IP.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(r.codedValues==null||r.codedValues.every(s=>s==null||s.code!==e))return IP.INVALID_CODED_VALUE}return null}function d$e(t,e){const i=t==null?void 0:t.domain;if(!i||i.type!=="range")return;const r="range"in i?i.range[0]:i.minValue,s="range"in i?i.range[1]:i.maxValue,n=Jot(t);return c$e(t)||h$e(t)||u$e(t)?{...Kot(t,s,r),isInteger:n}:{min:r!=null&&typeof r=="number"?r:null,max:s!=null&&typeof s=="number"?s:null,rawMin:r,rawMax:s,isInteger:n}}function Kot(t,e,i){var r,s,n,o,a,l;return c$e(t)?{min:(r=Vpe(i))==null?void 0:r.toMillis(),max:(s=Vpe(e))==null?void 0:s.toMillis(),rawMin:i,rawMax:e}:h$e(t)?{min:(n=zpe(i))==null?void 0:n.toMillis(),max:(o=zpe(e))==null?void 0:o.toMillis(),rawMin:i,rawMax:e}:u$e(t)?{min:(a=Bpe(i))==null?void 0:a.toMillis(),max:(l=Bpe(e))==null?void 0:l.toMillis(),rawMin:i,rawMax:e}:{max:null,min:null}}const eat=()=>ne.getLogger("esri.support.arcadeOnDemand");let QH;function by(){return QH||(QH=(async()=>{const t=await oe(()=>import("./arcadeUtils-C13sLc9r.js").then(e=>e.aN),__vite__mapDeps([70,27,71,30,72]));return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),QH}const tat=(t,e,i)=>pne.create(t,e,i,null,["$feature","$view"],[]),p$e=(t,e,i)=>pne.create(t,e,i,null,["$feature","$view"],[]),iat=(t,e,i,r)=>pne.create(t,e,i,r,["$feature","$view"],[]);let pne=class f$e{constructor(e,i,r,s,n,o,a){this.services=null,this.script=e,this.evaluate=s;const l=Array.isArray(o)?o:o==null?void 0:o.fields;this.fields=l??[],this._syntaxTree=r,this._arcade=i,this._arcadeFeature=n,this._spatialReference=a,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,i,r,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await by(),u=Ye.fromJSON(i);let d;try{d=a.parseScript(e,o)}catch(D){return eat().error(new B("arcade-bad-expression","Failed to parse arcade script",{script:e,error:D})),null}const f=n.reduce((D,U)=>({...D,[U]:null}),{});let m=null;s!=null&&(m=new c(s),m.immutable=!0,f.$config=null);const g=a.scriptUsesGeometryEngine(d),y=g&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(d)&&a.enableFeatureSetSupport(),b=a.scriptIsAsync(d),w=b&&a.enableAsyncSupport(),x={vars:f,spatialReference:u,useAsync:!!w};await Promise.all([y,v,w]);const T=new Set;await a.loadDependentModules(T,d,null,b,g);const E=new c;E.immutable=!1,E.setField("scale",0);const M=a.compileScript(d,x),O=(D,U)=>{var H;const k=(H=D.$view)==null?void 0:H.timeZone;return"$view"in D&&D.$view&&(E.setField("scale",typeof D.$view=="object"&&"scale"in D.$view?D.$view.scale:void 0),D.$view=E),m&&(D.$config=m),M({vars:D,spatialReference:u,services:U,timeZone:k})};return new f$e(e,a,d,O,new l,r,u)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const rat=/^([0-9_])/,sat=/[^a-z0-9_\u0080-\uffff]+/gi;function nat(t){return t==null?null:t.trim().replaceAll(sat,"_").replace(rat,"F$1")||null}const oat=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],aat=["field","normalizationField"];function jpe(t,e){if(t!=null&&e!=null){for(const i of Array.isArray(t)?t:[t])if(Gpe(oat,i,e),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)Gpe(aat,r,e)}}function Gpe(t,e,i){if(t)for(const r of t){const s=RD(r,e),n=s&&typeof s!="function"&&i.get(s);n&&ua(r,n.name,e)}}function m$e(t,e){var i;if(t!=null&&((i=e==null?void 0:e.fields)!=null&&i.length))if("startField"in t){const r=e.get(t.startField),s=e.get(t.endField);t.startField=(r==null?void 0:r.name)??null,t.endField=(s==null?void 0:s.name)??null}else{const r=e.get(t.startTimeField),s=e.get(t.endTimeField);t.startTimeField=(r==null?void 0:r.name)??null,t.endTimeField=(s==null?void 0:s.name)??null}}const KH=new Set;function fne(t,e){return t&&e?(KH.clear(),v2(KH,t,e),Array.from(KH).sort()):[]}function v2(t,e,i){var r;if(i)if((r=e==null?void 0:e.fields)!=null&&r.length)if(i.includes("*"))for(const{name:s}of e.fields)t.add(s);else for(const s of i)Zc(t,e,s);else{if(i.includes("*"))return t.clear(),void t.add("*");for(const s of i)s!=null&&t.add(s)}}function Zc(t,e,i){if(typeof i=="string")if(e){const r=e.get(i);r&&t.add(r.name)}else t.add(i)}function oXt(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(i=>i.name):e}async function ac(t,e,i){var n;if(!i)return;const{arcadeUtils:r}=await by(),s=r.extractFieldNames(i,(n=e==null?void 0:e.fields)==null?void 0:n.map(o=>o.name));for(const o of s)Zc(t,e,o)}async function g$e(t,e,i){if(i&&i!=="1=1"){const r=await hne(i,e);if(!r.isStandardized)throw new B("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});v2(t,e,r.fieldNames)}}function lat({displayField:t,fields:e}){return t||(e!=null&&e.length?eq(e,"name-or-title")||eq(e,"unique-identifier")||eq(e,"type-or-category")||cat(e):null)}function cat(t){for(const e of t){if(!(e!=null&&e.name))continue;const i=e.name.toLowerCase();if(i.includes("name")||i.includes("title"))return e.name}return null}function eq(t,e){for(const i of t)if(i!=null&&i.valueType&&i.valueType===e)return i.name;return null}async function aXt(t,e){var r;if(!e)return;const i=(r=e.elevationInfo)==null?void 0:r.featureExpressionInfo;return i?i.collectRequiredFields(t,e.fieldsIndex):void 0}function uat(t,e,i){i.onStatisticExpression?ac(t,e,i.onStatisticExpression.expression):t.add(i.onStatisticField)}async function lXt(t,e,i){if(!e||!i||!("fields"in i))return;const r=[],s=i.popupTemplate;r.push(hat(t,e,s)),i.fields&&r.push(...i.fields.map(async n=>uat(t,e.fieldsIndex,n))),await Promise.all(r)}async function hat(t,e,i){const r=[];i!=null&&i.expressionInfos&&r.push(...i.expressionInfos.map(n=>ac(t,e.fieldsIndex,n.expression)));const s=i==null?void 0:i.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&r.push(ac(t,e.fieldsIndex,n.expressionInfo.expression));await Promise.all(r)}async function cXt(t,e,i){e&&(e.timeInfo&&(i!=null&&i.timeExtent)&&v2(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&v2(t,e.fieldsIndex,[e.floorInfo.floorField]),(i==null?void 0:i.where)!=null&&await g$e(t,e.fieldsIndex,i.where))}async function uXt(t,e,i){e&&i&&await Promise.all(i.map(r=>dat(t,e,r)))}async function dat(t,e,i){e&&i&&(i.valueExpression?await ac(t,e.fieldsIndex,i.valueExpression):i.field&&Zc(t,e.fieldsIndex,i.field))}function hXt(t){return t?fne(t.fieldsIndex,y$e(t)):[]}function pat(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?fne(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}const fat=new Set(["oid","global-id","guid"]),mat=new Set(["oid","global-id"]),gat=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/perimeter/i,/objectid/i,/_i$/i];function yat(t){const e=new Set;_$e(t).forEach(r=>e.add(r)),pat(t).forEach(r=>e.add(r.toLowerCase()));const i=t&&"infoFor3D"in t?t.infoFor3D:void 0;return i&&(Object.values(i.assetMapFieldRoles).forEach(r=>e.add(r.toLowerCase())),Object.values(i.transformFieldRoles).forEach(r=>e.add(r.toLowerCase()))),Array.from(e)}function y$e(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:i,creatorField:r,editDateField:s,editorField:n}=e;return[i,r,s,n].filter(Boolean)}function _$e(t){return y$e(t).map(e=>e.toLowerCase())}function _at(t,e){var i;return t.editable&&!fat.has(t.type)&&!_$e(e).includes(((i=t.name)==null?void 0:i.toLowerCase())??"")}function vat(t,e){var r;const i=((r=t.name)==null?void 0:r.toLowerCase())??"";return!((e==null?void 0:e.objectIdField)!=null&&i===e.objectIdField.toLowerCase()||(e==null?void 0:e.globalIdField)!=null&&i===e.globalIdField.toLowerCase()||yat(e).includes(i)||mat.has(t.type)||gat.some(s=>s.test(i)))}async function dXt(t,e){const{labelingInfo:i,fieldsIndex:r}=e;i!=null&&i.length&&await Promise.all(i.map(s=>bat(t,r,s)))}async function bat(t,e,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if(r.type==="arcade")await ac(t,e,r.expression);else{const n=r.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{Zc(t,e,o.slice(1,-1))})}await g$e(t,e,s)}function wat(t){const e=t.defaultValue;return e!==void 0&&w$e(t,e)?e:t.nullable?null:void 0}function pXt(t){const e=typeof t=="string"?{type:t}:t;return Iat(e)?255:e.type==="esriFieldTypeDate"||e.type==="date"?8:void 0}function v$e(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function xat(t){return t===null||v$e(t)}function Tat(t){return t===null||Number.isInteger(t)}function b$e(t){return t!=null&&typeof t=="string"}function Sat(t){return t===null||b$e(t)}function Eat(){return!0}function w$e(t,e){let i;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":i=t.nullable?Tat:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=t.nullable?xat:v$e;break;case"string":case"esriFieldTypeString":i=t.nullable?Sat:b$e;break;default:i=Eat}return arguments.length===1?i:i(e)}const Cat=["integer","small-integer","big-integer"],Mat=["single","double"],Aat=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],Pat=["esriFieldTypeSingle","esriFieldTypeDouble"],Oat=new Set([...Cat,...Aat]),$at=new Set([...Mat,...Pat]),Rat=Y2e(Oat,$at);function m6(t){return t!=null&&Rat.has(t.type)}function Iat(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function mne(t){return t!=null&&(t.type==="date"||t.type==="esriFieldTypeDate")}function Lat(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function Dat(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function gne(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function Hpe(t){return t!=null&&(t.type==="oid"||t.type==="esriFieldTypeOID")}function qpe(t){return t!=null&&(t.type==="global-id"||t.type==="esriFieldTypeGlobalID")}function fXt(t,e){return Nat(t,e)===null}var _B,vB;function mXt(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function Nat(t,e){return t==null||t.nullable&&e===null?null:m6(t)&&!Fat(t.type,Number(e))?_B.OUT_OF_RANGE:w$e(t,e)?t.domain?Qot(t,e):null:vB.INVALID_TYPE}function Fat(t,e){const i=typeof t=="string"?x$e(t):t;if(!i)return!1;const r=i.min,s=i.max;return i.isInteger?Number.isInteger(e)&&e>=r&&e<=s:e>=r&&e<=s}function x$e(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return kat;case"esriFieldTypeInteger":case"integer":return Uat;case"esriFieldTypeBigInteger":case"big-integer":return Vat;case"esriFieldTypeSingle":case"single":return zat;case"esriFieldTypeDouble":case"double":return Bat}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(_B||(_B={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(vB||(vB={}));const kat={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},Uat={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},Vat={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},zat={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},Bat={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function gXt(t,e,i){switch(t){case IP.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case IP.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case vB.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case _B.OUT_OF_RANGE:{const{min:r,max:s}=x$e(e.type);return`Value ${i} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${r} to ${s}`}}}function jat(t,e){return!Gat(t,e,null)}function Gat(t,e,i){if(!(e!=null&&e.attributes)||!t){if(i!=null)for(const n of t??[])i.add(n);return!0}const r=new Set(Object.keys(e.attributes));let s=!1;for(const n of t)if(!r.has(n)){if(s=!0,i==null)break;i.add(n)}return s}function $X(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}function T$e(t){const e=t==null?void 0:t.match(/{[^}]+}/g);return e?e.map(i=>i.slice(1,-1).split(":")[0].trim()):[]}let dU=class extends Se{constructor(e){super(e),this.type=null}};h([p({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],dU.prototype,"type",void 0),dU=h([I("esri.popup.content.Content")],dU);const ww=dU;var RX;let Ux=RX=class extends ww{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new RX({description:this.description,displayType:this.displayType,title:this.title})}};h([p({type:String,json:{write:!0}})],Ux.prototype,"description",void 0),h([p({type:["auto","preview","list"],json:{write:!0}})],Ux.prototype,"displayType",void 0),h([p({type:String,json:{write:!0}})],Ux.prototype,"title",void 0),h([p({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],Ux.prototype,"type",void 0),Ux=RX=h([I("esri.popup.content.AttachmentsContent")],Ux);const qL=Ux;var IX;let Vx=IX=class extends ww{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new IX({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?re(this.outFields):null})}};h([p()],Vx.prototype,"creator",void 0),h([p()],Vx.prototype,"destroyer",void 0),h([p()],Vx.prototype,"outFields",void 0),h([p({type:["custom"],readOnly:!0})],Vx.prototype,"type",void 0),Vx=IX=h([I("esri.popup.content.CustomContent")],Vx);const Hat=Vx;var LX;let NC=LX=class extends Se{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new LX({title:this.title,expression:this.expression})}};h([p({type:String,json:{write:!0}})],NC.prototype,"title",void 0),h([p({type:String,json:{write:!0}})],NC.prototype,"expression",void 0),h([p({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],NC.prototype,"returnType",void 0),NC=LX=h([I("esri.popup.ElementExpressionInfo")],NC);const S$e=NC;var DX;let $R=DX=class extends ww{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new DX({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};h([p({type:S$e,json:{write:!0}})],$R.prototype,"expressionInfo",void 0),h([p({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],$R.prototype,"type",void 0),$R=DX=h([I("esri.popup.content.ExpressionContent")],$R);const yne=$R;let FC=class extends ts(Se){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};h([$t(R9e)],FC.prototype,"dateFormat",void 0),h([p({type:Boolean,json:{write:!0}})],FC.prototype,"digitSeparator",void 0),h([p({type:Ji,json:{write:!0}})],FC.prototype,"places",void 0),FC=h([I("esri.popup.support.FieldInfoFormat")],FC);const pU=FC;var NX;let Jp=NX=class extends Se{constructor(t){super(t),this.fieldName=null,this.format=void 0,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){var t;return new NX({fieldName:this.fieldName,format:(t=this.format)==null?void 0:t.clone(),isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};h([p({type:String,json:{write:!0}})],Jp.prototype,"fieldName",void 0),h([p({type:pU,json:{write:!0}})],Jp.prototype,"format",void 0),h([p({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],Jp.prototype,"isEditable",void 0),h([p({type:String,json:{write:!0}})],Jp.prototype,"label",void 0),h([$t(new Qi({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],Jp.prototype,"stringFieldOption",void 0),h([p({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],Jp.prototype,"statisticType",void 0),h([p({type:String,json:{write:!0}})],Jp.prototype,"tooltip",void 0),h([p({type:Boolean,json:{write:!0}})],Jp.prototype,"visible",void 0),Jp=NX=h([I("esri.popup.FieldInfo")],Jp);const sN=Jp;var FX;let y0=FX=class extends ww{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(i=>i.toJSON())}clone(){return new FX(re({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};h([p({type:Object,json:{write:!0}})],y0.prototype,"attributes",void 0),h([p({type:String,json:{write:!0}})],y0.prototype,"description",void 0),h([p({type:[sN]})],y0.prototype,"fieldInfos",void 0),h([Ze("fieldInfos")],y0.prototype,"writeFieldInfos",null),h([p({type:String,json:{write:!0}})],y0.prototype,"title",void 0),h([p({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],y0.prototype,"type",void 0),y0=FX=h([I("esri.popup.content.FieldsContent")],y0);const LP=y0;let zx=class extends Se{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};h([p({type:String,json:{write:!0}})],zx.prototype,"altText",void 0),h([p({type:String,json:{write:!0}})],zx.prototype,"caption",void 0),h([p({type:String,json:{write:!0}})],zx.prototype,"title",void 0),h([p({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],zx.prototype,"type",void 0),zx=h([I("esri.popup.content.mixins.MediaInfo")],zx);const _ne=zx;var kX;let Bx=kX=class extends Ue{constructor(t){super(t),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){var t;return new kX({color:(t=this.color)==null?void 0:t.clone(),fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};h([p()],Bx.prototype,"color",void 0),h([p()],Bx.prototype,"fieldName",void 0),h([p()],Bx.prototype,"tooltip",void 0),h([p()],Bx.prototype,"value",void 0),Bx=kX=h([I("esri.popup.content.support.ChartMediaInfoValueSeries")],Bx);const E$e=Bx;var UX;let r1=UX=class extends Se{constructor(t){super(t),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new UX({colors:re(this.colors),fields:re(this.fields),normalizeField:this.normalizeField,series:re(this.series),tooltipField:this.tooltipField})}};h([p({type:[je],json:{type:[[Ji]],write:!0}})],r1.prototype,"colors",void 0),h([p({type:[String],json:{write:!0}})],r1.prototype,"fields",void 0),h([p({type:String,json:{write:!0}})],r1.prototype,"normalizeField",void 0),h([p({type:[E$e],json:{read:!1}})],r1.prototype,"series",void 0),h([p({type:String,json:{write:!0}})],r1.prototype,"tooltipField",void 0),r1=UX=h([I("esri.popup.content.support.ChartMediaInfoValue")],r1);const qat=r1;let RR=class extends _ne{constructor(e){super(e),this.type=null,this.value=void 0}};h([p({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],RR.prototype,"type",void 0),h([p({type:qat,json:{write:!0}})],RR.prototype,"value",void 0),RR=h([I("esri.popup.content.mixins.ChartMediaInfo")],RR);const g6=RR,y6=lc()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var VX;let fU=VX=class extends g6{constructor(t){super(t),this.type="bar-chart"}clone(){var t;return new VX({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};h([p({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:y6.write}})],fU.prototype,"type",void 0),fU=VX=h([I("esri.popup.content.BarChartMediaInfo")],fU);const C$e=fU;var zX;let mU=zX=class extends g6{constructor(t){super(t),this.type="column-chart"}clone(){var t;return new zX({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};h([p({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:y6.write}})],mU.prototype,"type",void 0),mU=zX=h([I("esri.popup.content.ColumnChartMediaInfo")],mU);const M$e=mU;var BX;let IR=BX=class extends Se{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new BX({linkURL:this.linkURL,sourceURL:this.sourceURL})}};h([p({type:String,json:{write:!0}})],IR.prototype,"linkURL",void 0),h([p({type:String,json:{write:!0}})],IR.prototype,"sourceURL",void 0),IR=BX=h([I("esri.popup.content.support.ImageMediaInfoValue")],IR);const Wat=IR;var jX;let kC=jX=class extends _ne{constructor(t){super(t),this.refreshInterval=0,this.type="image",this.value=void 0}clone(){var t;return new jX({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:(t=this.value)==null?void 0:t.clone()})}};h([p({type:Number,json:{write:!0}})],kC.prototype,"refreshInterval",void 0),h([p({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],kC.prototype,"type",void 0),h([p({type:Wat,json:{write:!0}})],kC.prototype,"value",void 0),kC=jX=h([I("esri.popup.content.ImageMediaInfo")],kC);const A$e=kC;var GX;let gU=GX=class extends g6{constructor(t){super(t),this.type="line-chart"}clone(){var t;return new GX({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};h([p({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:y6.write}})],gU.prototype,"type",void 0),gU=GX=h([I("esri.popup.content.LineChartMediaInfo")],gU);const P$e=gU;var HX;let yU=HX=class extends g6{constructor(t){super(t),this.type="pie-chart"}clone(){var t;return new HX({altText:this.altText,title:this.title,caption:this.caption,value:(t=this.value)==null?void 0:t.clone()})}};h([p({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:y6.write}})],yU.prototype,"type",void 0),yU=HX=h([I("esri.popup.content.PieChartMediaInfo")],yU);const O$e=yU,$$e={base:_ne,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":C$e,"column-chart":M$e,"line-chart":P$e,"pie-chart":O$e,image:A$e}};var qX;let Qp=qX=class extends ww{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?A$e.fromJSON(e):e.type==="barchart"?C$e.fromJSON(e):e.type==="columnchart"?M$e.fromJSON(e):e.type==="linechart"?P$e.fromJSON(e):e.type==="piechart"?O$e.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(i=>i.toJSON())}clone(){return new qX(re({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};h([p()],Qp.prototype,"activeMediaInfoIndex",void 0),h([p({type:Object,json:{write:!0}})],Qp.prototype,"attributes",void 0),h([p({type:String,json:{write:!0}})],Qp.prototype,"description",void 0),h([p({types:[$$e]})],Qp.prototype,"mediaInfos",void 0),h([ze("mediaInfos")],Qp.prototype,"readMediaInfos",null),h([Ze("mediaInfos")],Qp.prototype,"writeMediaInfos",null),h([p({type:String,json:{write:!0}})],Qp.prototype,"title",void 0),h([p({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Qp.prototype,"type",void 0),Qp=qX=h([I("esri.popup.content.MediaContent")],Qp);const WL=Qp;var WX;let LR=WX=class extends Se{constructor(t){super(t),this.field=null,this.order=null}clone(){return new WX({field:this.field,order:this.order})}};h([p({type:String,json:{write:!0}})],LR.prototype,"field",void 0),h([p({type:["asc","desc"],json:{write:!0}})],LR.prototype,"order",void 0),LR=WX=h([I("esri.popup.support.RelatedRecordsInfoFieldOrder")],LR);const vne=LR;let eg=class extends ts(ww){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};h([p({type:String,json:{write:!0}})],eg.prototype,"description",void 0),h([p({type:Number,json:{type:Ji,write:!0}})],eg.prototype,"displayCount",void 0),h([p({type:["list"],json:{write:!0}})],eg.prototype,"displayType",void 0),h([p({type:[vne],json:{write:!0}})],eg.prototype,"orderByFields",void 0),h([p({type:Number,json:{type:Ji,write:!0}})],eg.prototype,"relationshipId",void 0),h([p({type:String,json:{write:!0}})],eg.prototype,"title",void 0),h([p({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],eg.prototype,"type",void 0),eg=h([I("esri.popup.content.RelationshipContent")],eg);const bB=eg;var ZX;let DR=ZX=class extends ww{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new ZX({text:this.text})}};h([p({type:String,json:{write:!0}})],DR.prototype,"text",void 0),h([p({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],DR.prototype,"type",void 0),DR=ZX=h([I("esri.popup.content.TextContent")],DR);const DP=DR,Zat={base:null,key:"type",typeMap:{attachment:qL,media:WL,text:DP,expression:yne,field:LP,relationship:bB}};var YX;let jx=YX=class extends Se{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new YX({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};h([p({type:String,json:{write:!0}})],jx.prototype,"name",void 0),h([p({type:String,json:{write:!0}})],jx.prototype,"title",void 0),h([p({type:String,json:{write:!0}})],jx.prototype,"expression",void 0),h([p({type:["string","number"],json:{write:!0}})],jx.prototype,"returnType",void 0),jx=YX=h([I("esri.popup.ExpressionInfo")],jx);const R$e=jx;var XX;let NR=XX=class extends Se{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new XX({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};h([p({type:Boolean,json:{write:!0}})],NR.prototype,"returnTopmostRaster",void 0),h([p({type:Boolean,json:{write:!0}})],NR.prototype,"showNoDataRecords",void 0),NR=XX=h([I("esri.popup.LayerOptions")],NR);const Yat=NR;var JX;let FR=JX=class extends Se{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new JX({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?re(this.orderByFields):null})}};h([p({type:Boolean,json:{write:!0}})],FR.prototype,"showRelatedRecords",void 0),h([p({type:[vne],json:{write:!0}})],FR.prototype,"orderByFields",void 0),FR=JX=h([I("esri.popup.RelatedRecordsInfo")],FR);const Xat=FR;var QX;let Td=QX=class extends mw(Ue){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new QX({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};h([p()],Td.prototype,"active",void 0),h([p()],Td.prototype,"className",void 0),h([p()],Td.prototype,"disabled",void 0),h([p()],Td.prototype,"icon",void 0),h([p()],Td.prototype,"id",void 0),h([p()],Td.prototype,"indicator",void 0),h([p()],Td.prototype,"title",void 0),h([p()],Td.prototype,"type",void 0),h([p()],Td.prototype,"visible",void 0),Td=QX=h([I("esri.support.actions.ActionBase")],Td);const AO=Td;var KX;let _U=KX=class extends AO{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new KX({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};h([p()],_U.prototype,"image",void 0),_U=KX=h([I("esri.support.actions.ActionButton")],_U);const Y2=_U;var eJ;let kR=eJ=class extends AO{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new eJ({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};h([p()],kR.prototype,"image",void 0),h([p()],kR.prototype,"value",void 0),kR=eJ=h([I("esri.support.actions.ActionToggle")],kR);const _6=kR,w$="relationships/",Wpe="expression/",Jat=Ke.ofType({key:"type",defaultKeyValue:"button",base:AO,typeMap:{button:Y2,toggle:_6}}),Qat={base:ww,key:"type",typeMap:{media:WL,custom:Hat,text:DP,attachments:qL,fields:LP,expression:yne,relationship:bB}},Kat=new Set(["attachments","fields","media","text","expression","relationship"]);let ia=class extends ts(Se){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(i=>om(Qat,i)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Zu(e)?e:(ne.getLogger(this).error("content error","unsupported content value",{value:e}),null)}readContent(e,i){const{popupElements:r}=i;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(i.description,i.mediaInfos,r):this._readPopupInfo(i)}writeContent(e,i,r,s){typeof e!="string"?Array.isArray(e)&&(i.popupElements=e.filter(n=>Kat.has(n.type)).map(n=>n==null?void 0:n.toJSON(s)),i.popupElements.forEach(n=>{n.type==="attachments"?this._writeAttachmentContent(i):n.type==="media"?this._writeMediaContent(n,i):n.type==="text"?this._writeTextContent(n,i):n.type==="relationship"&&this._writeRelationshipContent(n,i)})):i.description=e}writeFieldInfos(e,i,r,s){const{content:n}=this,o=Array.isArray(n)?n:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>{var u;return(u=c.fieldInfos)==null?void 0:u.length});i.fieldInfos=e.filter(Boolean).map(c=>{const u=c.toJSON(s);return l&&(u.visible=!1),u})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,i)}writeLayerOptions(e,i,r,s){i[r]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(s)}writeTitle(e,i){i.title=e||""}async collectRequiredFields(e,i){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,i,[...r,...this._getContentExpressionInfos(this.content,r)]),v2(e,i,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const i=new Set;return await this.collectRequiredFields(i,e),[...i].sort()}_writeFieldsContent(e,i){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=re(e.fieldInfos);Array.isArray(i.fieldInfos)?r.forEach(s=>{const n=i.fieldInfos.find(o=>{var a,l;return((a=o.fieldName)==null?void 0:a.toLowerCase())===((l=s.fieldName)==null?void 0:l.toLowerCase())});n?n.visible=!0:i.fieldInfos.push(s)}):i.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,i){var n,o;const r=((n=e.orderByFields)==null?void 0:n.map(a=>this._toFieldOrderJSON(a,e.relationshipId)))||[],s=[...((o=i.relatedRecordsInfo)==null?void 0:o.orderByFields)||[],...r];i.relatedRecordsInfo={showRelatedRecords:!0,...(s==null?void 0:s.length)&&{orderByFields:s}}}_writeTextContent(e,i){!i.description&&e.text&&(i.description=e.text)}_writeMediaContent(e,i){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=re(e.mediaInfos);Array.isArray(i.mediaInfos)?i.mediaInfos=[...i.mediaInfos,...r]:i.mediaInfos=r}_readPopupInfoElements(e,i,r){const s={description:!1,mediaInfos:!1};return r.map(n=>n.type==="media"?(n.mediaInfos||!i||s.mediaInfos||(n.mediaInfos=i,s.mediaInfos=!0),WL.fromJSON(n)):n.type==="text"?(n.text||!e||s.description||(n.text=e,s.description=!0),DP.fromJSON(n)):n.type==="attachments"?qL.fromJSON(n):n.type==="fields"?LP.fromJSON(n):n.type==="expression"?yne.fromJSON(n):n.type==="relationship"?bB.fromJSON(n):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:i,order:r}=e;if(!(i!=null&&i.startsWith(w$)))return null;const s=i.replace(w$,"").split("/");if(s.length!==2)return null;const n=parseInt(s[0],10),o=s[1];return typeof n=="number"&&o?bB.fromJSON({relationshipId:n,orderByFields:[{field:o,order:r}]}):null}_toFieldOrderJSON(e,i){const{order:r,field:s}=e;return{field:`${w$}${i}/${s}`,order:r}}_readPopupInfo({description:e,mediaInfos:i,showAttachments:r,relatedRecordsInfo:s={showRelatedRecords:!1}}){const n=[];e?n.push(new DP({text:e})):n.push(new LP),Array.isArray(i)&&i.length&&n.push(WL.fromJSON({mediaInfos:i})),r&&n.push(qL.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=s;return o&&(a!=null&&a.length)&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&n.push(c)}),n.length?n:e}_getContentElementFields(e){const i=e==null?void 0:e.type;if(i==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(i==="custom")return e.outFields||[];if(i==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(i==="media"){const r=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...r.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return i==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:i,title:r,value:s}=e,n=s||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:u}=n,d=[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(c),...this._extractFieldNames(u),...o??[]];return a&&d.push(a),l&&d.push(l),d}_getContentExpressionInfos(e,i){return Array.isArray(e)?e.reduce((r,s)=>[...r,...s.type==="expression"&&s.expressionInfo?[s.expressionInfo]:[]],i):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((i,r)=>[...i,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(e,i,r){r&&await Promise.all(r.map(s=>ac(e,i,s.expression)))}_getFieldInfoFields(e){return e?e.filter(({fieldName:i,visible:r})=>!(r!==void 0&&!r||!i||i.startsWith(w$)||i.startsWith(Wpe))).map(i=>i.fieldName):[]}_getActionsFields(e){return e?e.toArray().reduce((i,r)=>[...i,...this._getActionFields(r)],[]):[]}_getActionFields(e){const{className:i,title:r,type:s}=e,n=s==="button"||s==="toggle"?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){return T$e(e).filter(i=>!(i.indexOf(w$)===0||i.indexOf(Wpe)===0))}};h([p({type:Jat})],ia.prototype,"actions",void 0),h([p()],ia.prototype,"content",void 0),h([Qt("content")],ia.prototype,"castContent",null),h([ze("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],ia.prototype,"readContent",null),h([Ze("content",{popupElements:{type:Ke.ofType(Zat)},showAttachments:{type:Boolean},mediaInfos:{type:Ke.ofType($$e)},description:{type:String},relatedRecordsInfo:{type:Xat}})],ia.prototype,"writeContent",null),h([p({type:[R$e],json:{write:!0}})],ia.prototype,"expressionInfos",void 0),h([p({type:[sN]})],ia.prototype,"fieldInfos",void 0),h([Ze("fieldInfos")],ia.prototype,"writeFieldInfos",null),h([p({type:Yat})],ia.prototype,"layerOptions",void 0),h([Ze("layerOptions")],ia.prototype,"writeLayerOptions",null),h([p({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],ia.prototype,"lastEditInfoEnabled",void 0),h([p()],ia.prototype,"outFields",void 0),h([p()],ia.prototype,"overwriteActions",void 0),h([p()],ia.prototype,"returnGeometry",void 0),h([p({json:{type:String}})],ia.prototype,"title",void 0),h([Ze("title")],ia.prototype,"writeTitle",null),ia=h([I("esri.PopupTemplate")],ia);const nN=ia,Zpe=new Qi({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let elt=0,UC=class extends Se{constructor(e){super(e),this.id="sym"+elt++,this.type=null,this.color=new je([0,0,0,1])}readColor(e){return(e==null?void 0:e[0])!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,i){}hash(){return JSON.stringify(this.toJSON())}clone(){}};h([p({type:Zpe.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:Zpe.write}}})],UC.prototype,"type",void 0),h([p({type:je,json:{write:{allowNull:!0}}})],UC.prototype,"color",void 0),h([ze("color")],UC.prototype,"readColor",null),UC=h([I("esri.symbols.Symbol")],UC);const Ml=UC;var tJ;let s1=tJ=class extends Ml{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){var i;if(((i=this.data)==null?void 0:i.type)==="CIMSymbolReference"){const r=this.data.primitiveOverrides;if(r){const s=r.map(n=>{const o=n.valueExpressionInfo;return o?ac(t,e,o.expression):null});await Promise.all(s)}}}clone(){return new tJ({data:re(this.data)})}hash(){return vre(JSON.stringify(this.data)).toString()}};h([p({json:{write:!1}})],s1.prototype,"color",void 0),h([p({json:{write:!0}})],s1.prototype,"data",void 0),h([ze("data",["symbol"])],s1.prototype,"readData",null),h([Ze("data",{})],s1.prototype,"writeData",null),h([$t({CIMSymbolReference:"cim"},{readOnly:!0})],s1.prototype,"type",void 0),s1=tJ=h([I("esri.symbols.CIMSymbol")],s1);const G_=s1;let VC=class extends Se{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,i,r){e||(i[r]=e)}};h([p({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],VC.prototype,"enabled",void 0),h([Ze("enabled")],VC.prototype,"writeEnabled",null),h([p({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],VC.prototype,"type",void 0),VC=h([I("esri.symbols.Symbol3DLayer")],VC);const Py=VC;let Gx=class extends Se{constructor(e){super(e),this.color=new je([0,0,0,1]),this.extensionLength=0,this.size=bo(1)}clone(){}cloneProperties(){return{color:re(this.color),size:this.size,extensionLength:this.extensionLength}}};h([p({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Gx.prototype,"type",void 0),h([p(z_)],Gx.prototype,"color",void 0),h([p({...vy,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],Gx.prototype,"extensionLength",void 0),h([p(vy)],Gx.prototype,"size",void 0),Gx=h([I("esri.symbols.edges.Edges3D")],Gx);const bne=Gx;var iJ;let vU=iJ=class extends bne{constructor(t){super(t),this.type="sketch"}clone(){return new iJ(this.cloneProperties())}};h([$t({sketch:"sketch"},{readOnly:!0})],vU.prototype,"type",void 0),vU=iJ=h([I("esri.symbols.edges.SketchEdges3D")],vU);const tlt=vU;var rJ;let bU=rJ=class extends bne{constructor(t){super(t),this.type="solid"}clone(){return new rJ(this.cloneProperties())}};h([$t({solid:"solid"},{readOnly:!0})],bU.prototype,"type",void 0),bU=rJ=h([I("esri.symbols.edges.SolidEdges3D")],bU);const I$e=bU,L$e={types:{key:"type",base:bne,typeMap:{solid:I$e,sketch:tlt}},json:{write:!0}};var sJ;let Hh=sJ=class extends Se{constructor(t){super(t),this.color=null}clone(){const t={color:this.color!=null?this.color.clone():null};return new sJ(t)}};h([p(z_)],Hh.prototype,"color",void 0),Hh=sJ=h([I("esri.symbols.support.Symbol3DMaterial")],Hh);var nJ;let n1=nJ=class extends Py{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){var t,e;return new nJ({edges:(t=this.edges)==null?void 0:t.clone(),enabled:this.enabled,material:(e=this.material)==null?void 0:e.clone(),castShadows:this.castShadows,size:this.size})}};h([$t({Extrude:"extrude"},{readOnly:!0})],n1.prototype,"type",void 0),h([p({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],n1.prototype,"size",void 0),h([p({type:Hh,json:{write:!0}})],n1.prototype,"material",void 0),h([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],n1.prototype,"castShadows",void 0),h([p(L$e)],n1.prototype,"edges",void 0),n1=nJ=h([I("esri.symbols.ExtrudeSymbol3DLayer")],n1);const D$e=n1;let UR=class extends Ml{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};h([$t({esriSLS:"simple-line"},{readOnly:!0})],UR.prototype,"type",void 0),h([p({type:Number,cast:wr,json:{write:!0}})],UR.prototype,"width",void 0),UR=h([I("esri.symbols.LineSymbol")],UR);const ilt=UR,rlt=["begin","end","begin-end"],N$e=["arrow","circle","square","diamond","cross","x"];var oJ;let tg=oJ=class extends Se{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,i,r){e[i]=(r==null?void 0:r.origin)==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return(t==null?void 0:t[0])!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,i,r){(r==null?void 0:r.origin)==="web-map"||(e[i]=t)}clone(){return new oJ({color:re(this.color),placement:this.placement,style:this.style})}hash(){var t;return`${this.placement}.${(t=this.color)==null?void 0:t.hash()}.${this.style}`}};h([p({type:["begin","end","begin-end"],json:{write:!0}})],tg.prototype,"placement",void 0),h([$t({"line-marker":"line-marker"},{readOnly:!0}),p({json:{origins:{"web-map":{write:!1}}}})],tg.prototype,"type",void 0),h([p({type:N$e})],tg.prototype,"style",void 0),h([Ze("style")],tg.prototype,"writeStyle",null),h([p({type:je,value:null,json:{write:{allowNull:!0}}})],tg.prototype,"color",null),h([ze("color")],tg.prototype,"readColor",null),h([Ze("color")],tg.prototype,"writeColor",null),tg=oJ=h([I("esri.symbols.LineSymbolMarker")],tg);const slt=tg;var aJ;const tq=new Qi({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let _0=aJ=class extends ilt{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,i,r,s,n){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),i!=null&&(o.width=wr(i)),r!=null&&(o.cap=r),s!=null&&(o.join=s),n!=null&&(o.miterLimit=wr(n)),o}clone(){var t;return new aJ({color:re(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(t=this.marker)==null?void 0:t.clone()})}hash(){var t,e;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(e=this.marker)==null?void 0:e.hash()}`}};h([$t({esriSLS:"simple-line"},{readOnly:!0})],_0.prototype,"type",void 0),h([p({type:tq.apiValues,json:{read:tq.read,write:tq.write}})],_0.prototype,"style",void 0),h([p({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&(i==null?void 0:i.origin)==null})}}})],_0.prototype,"cap",void 0),h([p({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&(i==null?void 0:i.origin)==null})}}})],_0.prototype,"join",void 0),h([p({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":slt}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],_0.prototype,"marker",void 0),h([p({type:Number,json:{read:!1,write:!1}})],_0.prototype,"miterLimit",void 0),_0=aJ=h([I("esri.symbols.SimpleLineSymbol")],_0);const Yu=_0;let VR=class extends Ml{constructor(e){super(e),this.outline=null,this.type=null}hash(){var e;return`${this.type}.${(e=this.outline)==null?void 0:e.hash()}`}};h([p({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Yu}},json:{default:null,write:!0}})],VR.prototype,"outline",void 0),h([p({type:["simple-fill","picture-fill"],readOnly:!0})],VR.prototype,"type",void 0),VR=h([I("esri.symbols.FillSymbol")],VR);const F$e=VR;let wU=class extends Se{constructor(e){super(e)}clone(){throw new Error("Subclasses of LinePattern3D should implement their own clone method.")}};h([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],wU.prototype,"type",void 0),wU=h([I("esri.symbols.patterns.LinePattern3D")],wU);const k$e=wU,nlt=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var lJ;const olt=lc()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let zR=lJ=class extends k$e{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new lJ(t)}};h([p({type:["style"]})],zR.prototype,"type",void 0),h([$t(olt),p({type:nlt})],zR.prototype,"style",void 0),zR=lJ=h([I("esri.symbols.patterns.LineStylePattern3D")],zR);const wne=zR;let xU=class extends Se{constructor(e){super(e),this.type="style"}clone(){throw new Error("Subclasses of Pattern3D should implement their own clone method.")}};h([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],xU.prototype,"type",void 0),xU=h([I("esri.symbols.patterns.Pattern3D")],xU);const U$e=xU,alt=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var cJ;let BR=cJ=class extends U$e{constructor(t){super(t),this.type="style",this.style="solid"}clone(){return new cJ({style:this.style})}};h([p({type:["style"]})],BR.prototype,"type",void 0),h([p({type:alt,json:{read:!0,write:!0}})],BR.prototype,"style",void 0),BR=cJ=h([I("esri.symbols.patterns.StylePattern3D")],BR);const V$e=BR,llt={types:{key:"type",base:U$e,typeMap:{style:V$e}},json:{write:!0}},z$e={types:{key:"type",base:k$e,typeMap:{style:wne}},json:{write:!0}},R3=new je("white");new je("black");const clt=new je([255,255,255,0]);function ult(t){return t.r===0&&t.g===0&&t.b===0}var uJ;let I3=uJ=class extends Hh{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new uJ(t)}};h([$t({multiply:"multiply",replace:"replace",tint:"tint"})],I3.prototype,"colorMixMode",void 0),I3=uJ=h([I("esri.symbols.support.Symbol3DFillMaterial")],I3);function io(t=q$e){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function b2(t,e,i,r,s,n,o=io()){return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function OXt(t,e){const i=isFinite(t[2])||isFinite(t[5]);return new dr(i?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function NP(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function hlt(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function hm(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function Uh(t,e,i=0,r=e.length/3){let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let u=0;u<r;u++)s=Math.min(s,e[i+3*u]),n=Math.min(n,e[i+3*u+1]),o=Math.min(o,e[i+3*u+2]),a=Math.max(a,e[i+3*u]),l=Math.max(l,e[i+3*u+1]),c=Math.max(c,e[i+3*u+2]);t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function iq(t,e,i){const r=e.length;let s=t[0],n=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(i)for(let u=0;u<r;u++){const d=e[u];s=Math.min(s,d[0]),n=Math.min(n,d[1]),o=Math.min(o,d[2]),a=Math.max(a,d[0]),l=Math.max(l,d[1]),c=Math.max(c,d[2])}else for(let u=0;u<r;u++){const d=e[u];s=Math.min(s,d[0]),n=Math.min(n,d[1]),a=Math.max(a,d[0]),l=Math.max(l,d[1])}t[0]=s,t[1]=n,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function dlt(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function X2(t){return t[0]>=t[3]?0:t[3]-t[0]}function J2(t){return t[1]>=t[4]?0:t[4]-t[1]}function xw(t){return t[2]>=t[5]?0:t[5]-t[2]}function B$e(t){const e=X2(t),i=xw(t),r=J2(t);return Math.sqrt(e*e+i*i+r*r)}function jf(t,e=[0,0,0]){return e[0]=t[0]+X2(t)/2,e[1]=t[1]+J2(t)/2,e[2]=t[2]+xw(t)/2,e}function TU(t,e=[0,0,0]){return e[0]=X2(t),e[1]=J2(t),e[2]=xw(t),e}function xne(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function $Xt(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function plt(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function Gf(t,e){return e==null||plt(t,e)}function j$e(t,e,i,r,s=t){return s[0]=t[0]+e,s[1]=t[1]+i,s[2]=t[2]+r,s[3]=t[3]+e,s[4]=t[4]+i,s[5]=t[5]+r,s}function RXt(t,e,i=t){const r=t[0]+X2(t)/2,s=t[1]+J2(t)/2,n=t[2]+xw(t)/2;return i[0]=r+(t[0]-r)*e,i[1]=s+(t[1]-s)*e,i[2]=n+(t[2]-n)*e,i[3]=r+(t[3]-r)*e,i[4]=s+(t[4]-s)*e,i[5]=n+(t[5]-n)*e,i}function IXt(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function G$e(t,e,i=t){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i!==t&&(i[3]=t[3],i[4]=t[4],i[5]=t[5]),i}function H$e(t,e,i=t){return i[3]=e[0],i[4]=e[1],i[5]=e[2],i!==t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),t}function v6(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Qr(t){return t?v6(t,Ype):io(Ype)}function Tne(t,e){return e||(e=oi()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function LXt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function flt(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=Number.NEGATIVE_INFINITY,t[3]=r,t[4]=s,t[5]=Number.POSITIVE_INFINITY,t}function hJ(t){return t.length===6}function Sne(t){return X2(t)===0&&J2(t)===0&&xw(t)===0}function DXt(t,e,i){if(t==null||e==null)return t===e;if(!hJ(t)||!hJ(e))return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function mlt(t,e,i,r,s,n){return b2(t,e,i,r,s,n,glt)}const NXt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],Ype=[1/0,1/0,1/0,-1/0,-1/0,-1/0],q$e=[0,0,0,0,0,0],glt=io();function rq(t,{isPrimitive:e,width:i,depth:r,height:s}){const n=e?10:1;if(i==null&&s==null&&r==null)return[n*t[0],n*t[1],n*t[2]];const o=qe(i,r,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const ylt=b2(-.5,-.5,-.5,.5,.5,.5),_lt=b2(-.5,-.5,0,.5,.5,1),vlt=b2(-.5,-.5,0,.5,.5,.5);function blt(t){switch(t){case"sphere":case"cube":case"diamond":return ylt;case"cylinder":case"cone":case"inverted-cone":return _lt;case"tetrahedron":return vlt;default:return}}const Ene=["butt","square","round"],wlt=[...Ene,"none"],W$e=["miter","bevel","round"];var dJ;let Hx=dJ=class extends Se{constructor(t){super(t),this.color=new je([0,0,0,1]),this.size=bo(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new dJ(t)}};h([p(z_)],Hx.prototype,"color",void 0),h([p(vy)],Hx.prototype,"size",void 0),h([p(z$e)],Hx.prototype,"pattern",void 0),h([p({type:Ene,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],Hx.prototype,"patternCap",void 0),Hx=dJ=h([I("esri.symbols.support.Symbol3DOutline")],Hx);var SU;let v0=SU=class extends Py{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new SU(t)}static fromSimpleFillSymbol(t){var r,s,n;const e=t.outline&&t.outline.style&&t.outline.style!=="solid"?new wne({style:t.outline.style}):null,i={size:((r=t.outline)==null?void 0:r.width)??0,color:(((s=t.outline)==null?void 0:s.color)??R3).clone(),pattern:e};return e&&((n=t.outline)!=null&&n.cap)&&(i.patternCap=t.outline.cap),new SU({material:new I3({color:(t.color??clt).clone()}),pattern:t.style&&t.style!=="solid"?new V$e({style:t.style}):null,outline:i})}};h([$t({Fill:"fill"},{readOnly:!0})],v0.prototype,"type",void 0),h([p({type:I3,json:{write:!0}})],v0.prototype,"material",void 0),h([p(llt)],v0.prototype,"pattern",void 0),h([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],v0.prototype,"castShadows",void 0),h([p({type:Hx,json:{write:!0}})],v0.prototype,"outline",void 0),h([p(L$e)],v0.prototype,"edges",void 0),v0=SU=h([I("esri.symbols.FillSymbol3DLayer")],v0);const Q2=v0,xlt=["none","underline","line-through"],Tlt=["normal","italic","oblique"],Slt=["normal","lighter","bold","bolder"],Z$e={type:Number,cast:t=>{const e=Wd(t);return e===0?1:Ne(e,.1,4)},nonNullable:!0},Elt=["left","right","center"],Clt=["baseline","top","middle","bottom"],Y$e={type:Elt,nonNullable:!0},X$e={type:Clt,nonNullable:!0},Mlt=8;var pJ;let b0=pJ=class extends Se{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return wr(t)}clone(){return new pJ({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};h([p({type:xlt,json:{default:"none",write:!0}})],b0.prototype,"decoration",void 0),h([p({type:String,json:{write:!0}})],b0.prototype,"family",void 0),h([p({type:Number,json:{write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.textSymbol3D})}}})],b0.prototype,"size",void 0),h([Qt("size")],b0.prototype,"castSize",null),h([p({type:Tlt,json:{default:"normal",write:!0}})],b0.prototype,"style",void 0),h([p({type:Slt,json:{default:"normal",write:!0}})],b0.prototype,"weight",void 0),b0=pJ=h([I("esri.symbols.Font")],b0);const oN=b0;var fJ;const Alt=lc()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let qx=fJ=class extends Se{constructor(t){super(t)}readHref(t,e,i){return t?Ub(t,i):e.dataURI}writeHref(t,e,i,r){t&&(Cy(t)?e.dataURI=t:(e.href=u2(t,r),Bh(e.href)&&(e.href=lp(e.href))))}clone(){return new fJ({href:this.href,primitive:this.primitive})}};h([p({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],qx.prototype,"href",void 0),h([ze("href")],qx.prototype,"readHref",null),h([Ze("href",{href:{type:String},dataURI:{type:String}})],qx.prototype,"writeHref",null),h([$t(Alt)],qx.prototype,"primitive",void 0),qx=fJ=h([I("esri.symbols.support.IconSymbol3DLayerResource")],qx);const J$e="circle";var mJ;let lS=mJ=class extends Ue{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new mJ({x:this.x,y:this.y})}};h([p({type:Number})],lS.prototype,"x",void 0),h([p({type:Number})],lS.prototype,"y",void 0),lS=mJ=h([I("esri.symbols.support.Symbol3DAnchorPosition2D")],lS);var gJ;let jR=gJ=class extends Se{constructor(t){super(t),this.color=new je([0,0,0,1]),this.size=bo(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new gJ(t)}};h([p(z_)],jR.prototype,"color",void 0),h([p(vy)],jR.prototype,"size",void 0),jR=gJ=h([I("esri.symbols.support.Symbol3DIconOutline")],jR);var zC;const Q$e="esri.symbols.IconSymbol3DLayer";let ig=zC=class extends Py{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new zC({anchor:this.anchor,anchorPosition:re(this.anchorPosition),enabled:this.enabled,material:re(this.material),outline:re(this.outline),resource:re(this.resource),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||R3,i=Xpe(t),r=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||R3).clone()}:null;return new zC({size:t.size,resource:{primitive:Olt(t.style)},material:{color:e},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(t){const e=!t.color||ult(t.color)?R3:t.color,i=Xpe(t);return new zC({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(t){return new zC({resource:{href:REe({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};h([p({type:Hh,json:{write:!0}})],ig.prototype,"material",void 0),h([p({type:qx,json:{write:!0}})],ig.prototype,"resource",void 0),h([$t({Icon:"icon"},{readOnly:!0})],ig.prototype,"type",void 0),h([p(vy)],ig.prototype,"size",void 0),h([$t({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),p({json:{default:"center"}})],ig.prototype,"anchor",void 0),h([p({type:lS,json:{type:[Number],read:{reader:t=>new lS({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],ig.prototype,"anchorPosition",void 0),h([p({type:jR,json:{write:!0}})],ig.prototype,"outline",void 0),ig=zC=h([I(Q$e)],ig);const lb=ig;function Xpe(t){const e="width"in t?t.width:t.size,i="height"in t?t.height:t.size,r=Jpe(t.xoffset),s=Jpe(t.yoffset);return(r||s)&&e&&i?{x:-r/e,y:s/i}:null}function Jpe(t){return isFinite(t)?t:0}const Plt={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function Olt(t){return Plt[t]||(ne.getLogger(Q$e).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}let Wx=class extends ts(Se){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};h([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Wx.prototype,"type",void 0),h([p({type:rlt,json:{default:"begin-end",write:!0}})],Wx.prototype,"placement",void 0),h([p({type:N$e,json:{default:"arrow",write:!0}})],Wx.prototype,"style",void 0),h([p({type:je,json:{type:[Ji],default:null,write:!0}})],Wx.prototype,"color",void 0),Wx=h([I("esri.symbols.LineStyleMarker3D")],Wx);const yJ=Wx;var EU;let rg=EU=class extends Py{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=bo(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new EU(t)}static fromSimpleLineSymbol(t){var i;const e={enabled:!0,size:t.width??bo(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style?new wne({style:t.style}):null,material:new Hh({color:(t.color||R3).clone()}),marker:t.marker?new yJ({placement:t.marker.placement,style:t.marker.style,color:((i=t.marker.color)==null?void 0:i.clone())??null}):null};return new EU(e)}};h([p({type:Hh,json:{write:!0}})],rg.prototype,"material",void 0),h([$t({Line:"line"},{readOnly:!0})],rg.prototype,"type",void 0),h([p({type:W$e,json:{write:!0,default:"miter"}})],rg.prototype,"join",void 0),h([p({type:Ene,json:{write:!0,default:"butt"}})],rg.prototype,"cap",void 0),h([p(vy)],rg.prototype,"size",void 0),h([p(z$e)],rg.prototype,"pattern",void 0),h([p({types:{key:"type",base:yJ,typeMap:{style:yJ}},json:{write:!0}})],rg.prototype,"marker",void 0),rg=EU=h([I("esri.symbols.LineSymbol3DLayer")],rg);const PO=rg;var _J;const $lt=lc()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let GR=_J=class extends Se{clone(){return new _J({href:this.href,primitive:this.primitive})}};h([p({type:String,json:{read:tse,write:Vb}})],GR.prototype,"href",void 0),h([$t($lt)],GR.prototype,"primitive",void 0),GR=_J=h([I("esri.symbols.support.ObjectSymbol3DLayerResource")],GR);const Cne="sphere";var vJ;let VT=vJ=class extends Ue{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new vJ({x:this.x,y:this.y,z:this.z})}};h([p({type:Number})],VT.prototype,"x",void 0),h([p({type:Number})],VT.prototype,"y",void 0),h([p({type:Number})],VT.prototype,"z",void 0),VT=vJ=h([I("esri.symbols.support.Symbol3DAnchorPosition3D")],VT);var bJ;let Ul=bJ=class extends Py{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){var t,e,i;return new bJ({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:(t=this.anchorPosition)==null?void 0:t.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:((e=this.material)==null?void 0:e.clone())??null,castShadows:this.castShadows,resource:(i=this.resource)==null?void 0:i.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};h([p({type:Hh,json:{write:!0}})],Ul.prototype,"material",void 0),h([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Ul.prototype,"castShadows",void 0),h([p({type:GR,json:{write:!0}})],Ul.prototype,"resource",void 0),h([$t({Object:"object"},{readOnly:!0})],Ul.prototype,"type",void 0),h([p({type:Number,json:{write:!0}})],Ul.prototype,"width",void 0),h([p({type:Number,json:{write:!0}})],Ul.prototype,"height",void 0),h([p({type:Number,json:{write:!0}})],Ul.prototype,"depth",void 0),h([$t({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),p({json:{default:"origin"}})],Ul.prototype,"anchor",void 0),h([p({type:VT,json:{type:[Number],read:{reader:t=>new VT({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Ul.prototype,"anchorPosition",void 0),h([p({type:Number,json:{write:!0}})],Ul.prototype,"heading",void 0),h([p({type:Number,json:{write:!0}})],Ul.prototype,"tilt",void 0),h([p({type:Number,json:{write:!0}})],Ul.prototype,"roll",void 0),h([p({readOnly:!0})],Ul.prototype,"isPrimitive",null),Ul=bJ=h([I("esri.symbols.ObjectSymbol3DLayer")],Ul);const Mne=Ul;var wJ;let Mc=wJ=class extends Py{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new wJ({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};h([p({type:Hh,json:{write:!0}})],Mc.prototype,"material",void 0),h([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Mc.prototype,"castShadows",void 0),h([$t({Path:"path"},{readOnly:!0})],Mc.prototype,"type",void 0),h([p({type:["circle","quad"],json:{write:!0,default:"circle"}})],Mc.prototype,"profile",void 0),h([p({type:W$e,json:{write:!0,default:"miter"}})],Mc.prototype,"join",void 0),h([p({type:wlt,json:{write:!0,default:"butt"}})],Mc.prototype,"cap",void 0),h([p({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],Mc.prototype,"width",void 0),h([ze("width",["width","size","height"])],Mc.prototype,"readWidth",null),h([p({type:Number,json:{write:!0}})],Mc.prototype,"height",void 0),h([ze("height",["height","size","width"])],Mc.prototype,"readHeight",null),h([p({type:["center","bottom","top"],json:{write:!0,default:"center"}})],Mc.prototype,"anchor",void 0),h([p({type:["heading","all"],json:{write:!0,default:"all"}})],Mc.prototype,"profileRotation",void 0),Mc=wJ=h([I("esri.symbols.PathSymbol3DLayer")],Mc);const Ane=Mc;var xJ;let UM=xJ=class extends Se{constructor(){super(...arguments),this.color=new je([0,0,0,1]),this.size=0}clone(){const t={color:re(this.color),size:this.size};return new xJ(t)}};h([p(z_)],UM.prototype,"color",void 0),h([p(vy)],UM.prototype,"size",void 0),UM=xJ=h([I("esri.symbols.support.Symbol3DHalo")],UM);let L3=class extends ts(Se){constructor(e){super(e),this.color=null}};h([p(z_)],L3.prototype,"color",void 0),L3=h([I("esri.symbols.support.Symbol3DTextBackground")],L3);var CU;let hu=CU=class extends Py{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,i,r){const s={...r,textSymbol3D:!0};e.font=t.write({},s),delete e.font.size}get size(){var t;return this._userSize!=null?this._userSize:((t=this.font)==null?void 0:t.size)!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new CU({enabled:this.enabled,font:this.font&&re(this.font),halo:this.halo&&re(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:re(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new CU({font:t.font!=null?t.font.clone():new oN,halo:Rlt(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new Hh({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new L3({color:t.backgroundColor.clone()}):null})}};function Rlt(t,e){return t&&e!=null&&e>0?new UM({color:re(t),size:e}):null}h([p({type:oN,json:{write:!0}})],hu.prototype,"font",null),h([Ze("font")],hu.prototype,"writeFont",null),h([p({type:UM,json:{write:!0}})],hu.prototype,"halo",void 0),h([p({...Y$e,json:{default:"center",write:!0}})],hu.prototype,"horizontalAlignment",void 0),h([p({...Z$e,json:{default:1,write:!0}})],hu.prototype,"lineHeight",void 0),h([p({type:Hh,json:{write:!0}})],hu.prototype,"material",void 0),h([p({type:L3,json:{write:!0}})],hu.prototype,"background",void 0),h([p(vy)],hu.prototype,"size",null),h([p({type:String,json:{write:!0}})],hu.prototype,"text",void 0),h([$t({Text:"text"},{readOnly:!0})],hu.prototype,"type",void 0),h([p({...X$e,json:{default:"baseline",write:!0}})],hu.prototype,"verticalAlignment",void 0),hu=CU=h([I("esri.symbols.TextSymbol3DLayer")],hu);const K2=hu;var TJ;let o1=TJ=class extends Py{constructor(t){super(t),this.color=SJ.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new TJ({color:re(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};h([p({type:je,nonNullable:!0,json:{type:[Ji],write:(t,e,i)=>e[i]=t.toArray(je.AlphaMode.UNLESS_OPAQUE),default:()=>SJ.clone(),defaultEquals:t=>t.toCss(!0)===SJ.toCss(!0)}})],o1.prototype,"color",void 0),h([$t({Water:"water"},{readOnly:!0})],o1.prototype,"type",void 0),h([p({type:["small","medium","large"],json:{write:!0,default:"medium"}})],o1.prototype,"waterbodySize",void 0),h([p({type:Number,json:{write:!0,default:null}})],o1.prototype,"waveDirection",void 0),h([p({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],o1.prototype,"waveStrength",void 0),o1=TJ=h([I("esri.symbols.WaterSymbol3DLayer")],o1);const K$e=o1,SJ=new je([0,119,190]);var EJ;let Zx=EJ=class extends Ue{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new EJ({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};h([p({type:String})],Zx.prototype,"name",void 0),h([p({type:String})],Zx.prototype,"styleUrl",void 0),h([p({type:String})],Zx.prototype,"styleName",void 0),h([p({type:Kn})],Zx.prototype,"portal",void 0),Zx=EJ=h([I("esri.symbols.support.StyleOrigin")],Zx);const ZL=Zx;var CJ;let US=CJ=class extends Ue{constructor(){super(...arguments),this.url=""}clone(){return new CJ({url:this.url})}};h([p({type:String})],US.prototype,"url",void 0),US=CJ=h([I("esri.symbols.support.Thumbnail")],US);const eRe={icon:lb,object:Mne,line:PO,path:Ane,fill:Q2,extrude:D$e,text:K2,water:K$e},Ilt=Ke.ofType({base:Py,key:"type",typeMap:eRe,errorContext:"symbol-layer"});let sg=class extends Ml{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const i=this.__accessor__&&this.__accessor__.metadata&&this.__accessor__.metadata.symbolLayers,r=i==null?void 0:i.type,s=r||Ke;this._set("symbolLayers",new s)}get color(){return null}set color(e){this.constructed&&ne.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){gy(e,this._get("symbolLayers"))}readStyleOrigin(e,i,r){if(e.styleUrl&&e.name){const s=Ub(e.styleUrl,r);return new ZL({styleUrl:s,name:e.name})}if(e.styleName&&e.name)return new ZL({portal:(r==null?void 0:r.portal)||Kn.getDefault(),styleName:e.styleName,name:e.name});r!=null&&r.messages&&r.messages.push(new fy("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,i,r,s){if(e.styleUrl&&e.name){let n=u2(e.styleUrl,s);Bh(n)&&(n=lp(n)),i.styleOrigin={styleUrl:n,name:e.name}}else e.styleName&&e.name&&(e.portal&&(s!=null&&s.portal)&&!$Ee(e.portal.restUrl,s.portal.restUrl)?s!=null&&s.messages&&s.messages.push(new fy("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):i.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof Py||e&&eRe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};h([p({json:{read:!1,write:!1}})],sg.prototype,"color",null),h([p({type:Ilt,nonNullable:!0,json:{write:!0}}),Qt(Bre)],sg.prototype,"symbolLayers",null),h([p({type:ZL})],sg.prototype,"styleOrigin",void 0),h([ze("styleOrigin")],sg.prototype,"readStyleOrigin",null),h([Ze("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],sg.prototype,"writeStyleOrigin",null),h([p({type:US,json:{read:!1}})],sg.prototype,"thumbnail",void 0),h([p({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],sg.prototype,"type",void 0),sg=h([I("esri.symbols.Symbol3D")],sg);const OO=sg;let HR=class extends Se{constructor(e){super(e),this.visible=!0}clone(){throw new Error("Subclasses of Callout3D should implement their own clone method.")}};h([p({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],HR.prototype,"type",void 0),h([p({readOnly:!0})],HR.prototype,"visible",void 0),HR=h([I("esri.symbols.callouts.Callout3D")],HR);const tRe=HR;var MJ;let MU=MJ=class extends Se{constructor(t){super(t),this.color=new je("white")}clone(){return new MJ({color:re(this.color)})}};h([p(z_)],MU.prototype,"color",void 0),MU=MJ=h([I("esri.symbols.callouts.LineCallout3DBorder")],MU);const Llt=MU;var AJ;let a1=AJ=class extends tRe{constructor(t){super(t),this.type="line",this.color=new je([0,0,0,1]),this.size=bo(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new AJ({color:re(this.color),size:this.size,border:re(this.border)})}};h([$t({line:"line"})],a1.prototype,"type",void 0),h([p(z_)],a1.prototype,"color",void 0),h([p(vy)],a1.prototype,"size",void 0),h([p({type:Llt,json:{write:!0}})],a1.prototype,"border",void 0),h([p({readOnly:!0})],a1.prototype,"visible",null),a1=AJ=h([I("esri.symbols.callouts.LineCallout3D")],a1);const iRe=a1;function Pne(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function rRe(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!Pne(t)}function One(t){return t.type==="point-3d"||t.type==="label-3d"}function sRe(t){return t.horizontalAlignment==="center"}const nRe={types:{key:"type",base:tRe,typeMap:{line:iRe}},json:{write:!0}};var PJ;let BC=PJ=class extends Se{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new PJ({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};h([p(vy)],BC.prototype,"screenLength",void 0),h([p({type:Number,nonNullable:!0,json:{write:!0,default:0}})],BC.prototype,"minWorldLength",void 0),h([p({type:Number,json:{write:!0}})],BC.prototype,"maxWorldLength",void 0),BC=PJ=h([I("esri.symbols.support.Symbol3DVerticalOffset")],BC);const $ne=BC;var AU;const oRe=Ke.ofType({base:null,key:"type",typeMap:{text:K2}});let l1=AU=class extends OO{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new oRe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return rRe(this)}hasVisibleVerticalOffset(){return Pne(this)}clone(){return new AU({styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail),callout:re(this.callout),verticalOffset:re(this.verticalOffset)})}static fromTextSymbol(t){return new AU({symbolLayers:new Ke([K2.fromTextSymbol(t)])})}};h([p({type:$ne,json:{write:!0}})],l1.prototype,"verticalOffset",void 0),h([p(nRe)],l1.prototype,"callout",void 0),h([p({json:{read:!1,write:!1}})],l1.prototype,"styleOrigin",void 0),h([p({type:oRe})],l1.prototype,"symbolLayers",void 0),h([$t({LabelSymbol3D:"label-3d"},{readOnly:!0})],l1.prototype,"type",void 0),l1=AU=h([I("esri.symbols.LabelSymbol3D")],l1);const b6=l1;var PU;const aRe=Ke.ofType({base:null,key:"type",typeMap:{line:PO,path:Ane}}),Dlt=Ke.ofType({base:null,key:"type",typeMap:{line:PO,path:Ane}});let qR=PU=class extends OO{constructor(t){super(t),this.symbolLayers=new aRe,this.type="line-3d"}clone(){return new PU({styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail)})}static fromSimpleLineSymbol(t){return new PU({symbolLayers:new Ke([PO.fromSimpleLineSymbol(t)])})}};h([p({type:aRe,json:{type:Dlt}})],qR.prototype,"symbolLayers",void 0),h([$t({LineSymbol3D:"line-3d"},{readOnly:!0})],qR.prototype,"type",void 0),qR=PU=h([I("esri.symbols.LineSymbol3D")],qR);const eE=qR;let c1=class extends Ml{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};h([p({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],c1.prototype,"angle",void 0),h([p({type:["simple-marker","picture-marker"],readOnly:!0})],c1.prototype,"type",void 0),h([p({type:Number,cast:wr,json:{write:!0}})],c1.prototype,"xoffset",void 0),h([p({type:Number,cast:wr,json:{write:!0}})],c1.prototype,"yoffset",void 0),h([p({type:Number,cast:t=>t==="auto"?t:wr(t),json:{write:!0}})],c1.prototype,"size",void 0),c1=h([I("esri.symbols.MarkerSymbol")],c1);const lRe=c1;var OU;const cRe=Ke.ofType({base:null,key:"type",typeMap:{fill:Q2}});let WR=OU=class extends OO{constructor(t){super(t),this.symbolLayers=new cRe,this.type="mesh-3d"}clone(){return new OU({styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail)})}static fromSimpleFillSymbol(t){return new OU({symbolLayers:new Ke([Q2.fromSimpleFillSymbol(t)])})}};h([p({type:cRe})],WR.prototype,"symbolLayers",void 0),h([$t({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],WR.prototype,"type",void 0),WR=OU=h([I("esri.symbols.MeshSymbol3D")],WR);const aN=WR;function Nlt(t,e,i){return e.imageData?REe({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):uRe(e.url,i)}function uRe(t,e){if(!Bh(t)){const i=klt(e);if(i)return Jh(i,"images",t)}return Ub(t,e)}function Flt(t,e,i,r){if(Cy(t)){const s=Fb(t);if(!s)return;e.contentType=s.mediaType,e.imageData=s.data,i&&i.imageData===e.imageData&&i.url&&Vb(i.url,e,"url",r)}else Vb(t,e,"url",r)}const hRe={json:{read:{source:["imageData","url"],reader:Nlt},write:{writer(t,e,i,r){Flt(t,e,this.source,r)}}}},dRe={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,i){const r={};return e.imageData&&(r.imageData=e.imageData),e.contentType&&(r.contentType=e.contentType),e.url&&(r.url=uRe(e.url,i)),r}}}};function klt(t){var s,n;if(!t)return null;const{origin:e,layer:i}=t;if(e!=="service"&&e!=="portal-item")return null;const r=i==null?void 0:i.type;return r==="feature"||r==="stream"?(s=i.parsedUrl)==null?void 0:s.path:r==="map-image"||r==="tile"?(n=t.url)==null?void 0:n.path:null}var OJ;let Sd=OJ=class extends F$e{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const s={};return t&&(s.url=t),e&&(s.outline=e),i!=null&&(s.width=wr(i)),r!=null&&(s.height=wr(r)),s}clone(){const t=new OJ({color:re(this.color),height:this.height,outline:re(this.outline),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",re(this.source)),t}hash(){var t;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};h([$t({esriPFS:"picture-fill"},{readOnly:!0})],Sd.prototype,"type",void 0),h([p(hRe)],Sd.prototype,"url",void 0),h([p({type:Number,json:{write:!0}})],Sd.prototype,"xscale",void 0),h([p({type:Number,json:{write:!0}})],Sd.prototype,"yscale",void 0),h([p({type:Number,cast:wr,json:{write:!0}})],Sd.prototype,"width",void 0),h([p({type:Number,cast:wr,json:{write:!0}})],Sd.prototype,"height",void 0),h([p({type:Number,cast:wr,json:{write:!0}})],Sd.prototype,"xoffset",void 0),h([p({type:Number,cast:wr,json:{write:!0}})],Sd.prototype,"yoffset",void 0),h([p(dRe)],Sd.prototype,"source",void 0),Sd=OJ=h([I("esri.symbols.PictureFillSymbol")],Sd);const Rne=Sd;var $J;let Kp=$J=class extends lRe{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const r={};return t&&(r.url=t),e!=null&&(r.width=wr(e)),i!=null&&(r.height=wr(i)),r}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new $J({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",re(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};h([p({json:{write:!1}})],Kp.prototype,"color",void 0),h([$t({esriPMS:"picture-marker"},{readOnly:!0})],Kp.prototype,"type",void 0),h([p(hRe)],Kp.prototype,"url",void 0),h([p(dRe)],Kp.prototype,"source",void 0),h([p({type:Number,cast:wr,json:{write:!0}})],Kp.prototype,"height",void 0),h([ze("height",["height","size"])],Kp.prototype,"readHeight",null),h([p({type:Number,cast:wr,json:{write:!0}})],Kp.prototype,"width",void 0),h([p({json:{write:!1}})],Kp.prototype,"size",void 0),Kp=$J=h([I("esri.symbols.PictureMarkerSymbol")],Kp);const lN=Kp;var Yx;const pRe=Ke.ofType({base:null,key:"type",typeMap:{icon:lb,object:Mne,text:K2}});let Xx=Yx=class extends OO{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new pRe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return rRe(this)}hasVisibleVerticalOffset(){return Pne(this)}clone(){return new Yx({verticalOffset:re(this.verticalOffset),callout:re(this.callout),styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new Yx({symbolLayers:new Ke([lb.fromSimpleMarkerSymbol(t)])})}static fromPictureMarkerSymbol(t){return new Yx({symbolLayers:new Ke([lb.fromPictureMarkerSymbol(t)])})}static fromCIMSymbol(t){var r,s;if(((s=(r=t.data)==null?void 0:r.symbol)==null?void 0:s.type)!=="CIMPointSymbol")return null;const i=t.data.symbol;return new Yx(i!=null&&i.callout?{symbolLayers:new Ke([lb.fromCIMSymbol(t)]),callout:new iRe({size:.5,color:new je([0,0,0])}),verticalOffset:new $ne({screenLength:40})}:{symbolLayers:new Ke([lb.fromCIMSymbol(t)])})}static fromTextSymbol(t){return new Yx({symbolLayers:new Ke([K2.fromTextSymbol(t)])})}};h([p({type:$ne,json:{write:!0}})],Xx.prototype,"verticalOffset",void 0),h([p(nRe)],Xx.prototype,"callout",void 0),h([p({type:pRe,json:{origins:{"web-scene":{write:!0}}}})],Xx.prototype,"symbolLayers",void 0),h([$t({PointSymbol3D:"point-3d"},{readOnly:!0})],Xx.prototype,"type",void 0),Xx=Yx=h([I("esri.symbols.PointSymbol3D")],Xx);const Hg=Xx;var ZR;const fRe=Ke.ofType({base:null,key:"type",typeMap:{extrude:D$e,fill:Q2,icon:lb,line:PO,object:Mne,text:K2,water:K$e}});let YR=ZR=class extends OO{constructor(t){super(t),this.symbolLayers=new fRe,this.type="polygon-3d"}initialize(){const t=e=>{e.type==="line"&&Nb(ne.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),e.type==="text"&&Nb(ne.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const e of this.symbolLayers)t(e);this.addHandles(on(()=>this.symbolLayers,"after-add",({item:e})=>t(e),lr))}clone(){return new ZR({styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail)})}static fromJSON(t){var i;const e=new ZR;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const r=e.symbolLayers.at(0),s=e.symbolLayers.at(1);!s.enabled||(i=t.symbolLayers)!=null&&i[1]&&t.symbolLayers[1].enable===!1||(r.outline={size:s.size,color:s.material!=null?s.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new ZR({symbolLayers:new Ke([Q2.fromSimpleFillSymbol(t)])})}};h([p({type:fRe,json:{write:!0}})],YR.prototype,"symbolLayers",void 0),h([$t({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],YR.prototype,"type",void 0),YR=ZR=h([I("esri.symbols.PolygonSymbol3D")],YR);const Tw=YR;var RJ;const sq=new Qi({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let Jx=RJ=class extends F$e{constructor(...t){super(...t),this.color=new je([0,0,0,.25]),this.outline=new Yu,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.style=t),e&&(r.outline=e),i&&(r.color=i),r}clone(){return new RJ({color:re(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};h([p()],Jx.prototype,"color",void 0),h([p()],Jx.prototype,"outline",void 0),h([$t({esriSFS:"simple-fill"},{readOnly:!0})],Jx.prototype,"type",void 0),h([p({type:sq.apiValues,json:{read:sq.read,write:sq.write}})],Jx.prototype,"style",void 0),Jx=RJ=h([I("esri.symbols.SimpleFillSymbol")],Jx);const H_=Jx;var IJ;const nq=new Qi({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let ng=IJ=class extends lRe{constructor(...t){super(...t),this.color=new je([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Yu}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string")return t;const s={};return t&&(s.style=t),e!=null&&(s.size=wr(e)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new IJ({angle:this.angle,color:re(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(t=this.outline)==null?void 0:t.hash()}`}};h([p()],ng.prototype,"color",void 0),h([Ze("color")],ng.prototype,"writeColor",null),h([$t({esriSMS:"simple-marker"},{readOnly:!0})],ng.prototype,"type",void 0),h([p()],ng.prototype,"size",void 0),h([p({type:nq.apiValues,json:{read:nq.read,write:nq.write}})],ng.prototype,"style",void 0),h([p({type:String,json:{write:!0}})],ng.prototype,"path",null),h([p({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Yu}},json:{default:null,write:!0}})],ng.prototype,"outline",void 0),ng=IJ=h([I("esri.symbols.SimpleMarkerSymbol")],ng);const Oy=ng;var LJ;let ln=LJ=class extends Ml{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new oN,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.text=t),e&&(r.font=e),i&&(r.color=i),r}writeLineWidth(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}castLineWidth(t){return wr(t)}writeLineHeight(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}clone(){return new LJ({angle:this.angle,backgroundColor:re(this.backgroundColor),borderLineColor:re(this.borderLineColor),borderLineSize:this.borderLineSize,color:re(this.color),font:this.font&&this.font.clone(),haloColor:re(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t,e,i;return`${(t=this.backgroundColor)==null?void 0:t.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(e=this.color)==null?void 0:e.hash()}.${this.font&&this.font.hash()}.${(i=this.haloColor)==null?void 0:i.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};h([p({type:je,json:{write:!0}})],ln.prototype,"backgroundColor",void 0),h([p({type:je,json:{write:!0}})],ln.prototype,"borderLineColor",void 0),h([p({type:Number,json:{write:!0},cast:wr})],ln.prototype,"borderLineSize",void 0),h([p({type:oN,json:{write:!0}})],ln.prototype,"font",void 0),h([p({...Y$e,json:{write:!0}})],ln.prototype,"horizontalAlignment",void 0),h([p({type:Boolean,json:{write:!0}})],ln.prototype,"kerning",void 0),h([p({type:je,json:{write:!0}})],ln.prototype,"haloColor",void 0),h([p({type:Number,cast:wr,json:{write:!0}})],ln.prototype,"haloSize",void 0),h([p({type:Boolean,json:{write:!0}})],ln.prototype,"rightToLeft",void 0),h([p({type:Boolean,json:{write:!0}})],ln.prototype,"rotated",void 0),h([p({type:String,json:{write:!0}})],ln.prototype,"text",void 0),h([$t({esriTS:"text"},{readOnly:!0})],ln.prototype,"type",void 0),h([p({...X$e,json:{write:!0}})],ln.prototype,"verticalAlignment",void 0),h([p({type:Number,cast:wr,json:{write:!0}})],ln.prototype,"xoffset",void 0),h([p({type:Number,cast:wr,json:{write:!0}})],ln.prototype,"yoffset",void 0),h([p({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],ln.prototype,"angle",void 0),h([p({type:Number,json:{write:!0}})],ln.prototype,"width",void 0),h([p({type:Number})],ln.prototype,"lineWidth",void 0),h([Ze("lineWidth")],ln.prototype,"writeLineWidth",null),h([Qt("lineWidth")],ln.prototype,"castLineWidth",null),h([p(Z$e)],ln.prototype,"lineHeight",void 0),h([Ze("lineHeight")],ln.prototype,"writeLineHeight",null),ln=LJ=h([I("esri.symbols.TextSymbol")],ln);const $O=ln;var DJ;let ef=DJ=class extends Ml{constructor(t){super(t),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:Kn.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e==null?void 0:e.portal,super.read(t,e)}clone(){return new DJ({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const i=e!=null?e.cache:null,r=i?this._fetchCacheKey:null;if(i!=null){const a=r&&i.get(r);if(a)return a.clone()}const{resolveWebStyleSymbol:s}=await oe(()=>Promise.resolve().then(()=>UPt),void 0);Dt(e);const n=s(this,{portal:this.portal},t,e);n.catch(a=>{ne.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(i!=null&&i.set(r,o.clone()),o):null}};h([p({json:{write:!1}})],ef.prototype,"color",void 0),h([p({type:String,json:{write:!0}})],ef.prototype,"styleName",void 0),h([p({type:Kn,json:{write:!1}})],ef.prototype,"portal",void 0),h([p({type:String,json:{read:tse,write:Vb}})],ef.prototype,"styleUrl",void 0),h([p({type:US,json:{read:!1}})],ef.prototype,"thumbnail",void 0),h([p({type:String,json:{write:!0}})],ef.prototype,"name",void 0),h([$t({styleSymbolReference:"web-style"},{readOnly:!0})],ef.prototype,"type",void 0),h([p()],ef.prototype,"_fetchCacheKey",null),ef=DJ=h([I("esri.symbols.WebStyleSymbol")],ef);const tE=ef;function w6(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function Qb(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const VS={base:Ml,key:"type",typeMap:{"simple-fill":H_,"picture-fill":Rne,"picture-marker":lN,"simple-line":Yu,"simple-marker":Oy,text:$O,"label-3d":b6,"line-3d":eE,"mesh-3d":aN,"point-3d":Hg,"polygon-3d":Tw,"web-style":tE,cim:G_},errorContext:"symbol"},BXt={base:Ml,key:"type",typeMap:{"picture-marker":lN,"simple-marker":Oy,"point-3d":Hg,cim:G_},errorContext:"symbol"},jXt={base:Ml,key:"type",typeMap:{"simple-line":Yu,"line-3d":eE,cim:G_},errorContext:"symbol"},GXt={base:Ml,key:"type",typeMap:{"simple-fill":H_,"picture-fill":Rne,"polygon-3d":Tw,cim:G_},errorContext:"symbol"},Ult={base:Ml,key:"type",typeMap:{"picture-marker":lN,"simple-marker":Oy,text:$O,"web-style":tE,cim:G_},errorContext:"symbol"},Vlt=gO({types:VS}),mRe={base:Ml,key:"type",typeMap:{"simple-fill":H_,"picture-fill":Rne,"picture-marker":lN,"simple-line":Yu,"simple-marker":Oy,text:$O,"line-3d":eE,"mesh-3d":aN,"point-3d":Hg,"polygon-3d":Tw,"web-style":tE,cim:G_},errorContext:"symbol"},zlt={base:Ml,key:"type",typeMap:{text:$O,"label-3d":b6},errorContext:"symbol"},Qpe={base:Ml,key:"type",typeMap:{"line-3d":eE,"mesh-3d":aN,"point-3d":Hg,"polygon-3d":Tw,"web-style":tE,cim:G_},errorContext:"symbol"},Blt={base:Ml,key:"type",typeMap:{"label-3d":b6},errorContext:"symbol"},gRe=om(VS);var NJ;function jlt(t){if(!t)return null;const e={};for(const i in t){const r=_y(t[i]);r&&(e[i]=r)}return Object.keys(e).length!==0?e:null}function Glt(t){if(t==null)return null;const e={};for(const i in t){const r=t[i];r&&(e[i]=r.toJSON())}return Object.keys(e).length!==0?e:null}let Ac=NJ=class extends ts(Se){constructor(t){super(t),this.isAggregate=!1,this.layer=null,this.origin=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:zh(),configurable:!0}),Object.defineProperty(this,"_lastMeshTransform",{value:{},configurable:!0,writable:!0,enumerable:!1}),arguments.length>1&&a7e(ne.getLogger(this),"Graphic",{version:"4.30"})}initialize(){this._watchMeshGeometryChanges()}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),(t==null?void 0:t.type)!=="mesh"&&this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new NJ({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible,origin:this.origin})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;const e=this.origin&&"layer"in this.origin?this.origin.layer:null;for(const i of[e,this.sourceLayer,this.layer])if(i){if("popupTemplate"in i&&i.popupTemplate)return i.popupTemplate;if(t&&"defaultPopupTemplate"in i&&i.defaultPopupTemplate!=null)return i.defaultPopupTemplate}return null}getAttribute(t){var e;return(e=this.attributes)==null?void 0:e[t]}setAttribute(t,e){if(this.attributes){const i=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",i,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){var t;return{aggregateGeometries:Glt(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:Pz(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:((t=this.popupTemplate)==null?void 0:t.toJSON())??null}}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if((e==null?void 0:e.type)==="mesh"){const i={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",i,i,t.action)}}_notifyLayer(t,e,i,r){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:t,oldValue:e,newValue:i};t==="origin-transform"&&(s.action=r),t==="attributes"&&(s.attributeName=r),this.layer.graphicChanged(s)}_watchMeshGeometryChanges(){this.addHandles([jo(()=>{var t,e;return((t=this.geometry)==null?void 0:t.type)==="mesh"&&this.geometry.vertexSpace.origin?{localMatrix:(e=this.geometry.transform)==null?void 0:e.localMatrix,origin:this.geometry.vertexSpace.origin}:void 0},({localMatrix:t,origin:e})=>{this._lastMeshTransform.localMatrix===t&&this._lastMeshTransform.origin===e||(this._lastMeshTransform.localMatrix=t,this._lastMeshTransform.origin=e,this.notifyMeshTransformChanged())}),jo(()=>{var t;return((t=this.geometry)==null?void 0:t.type)==="mesh"?{vertexAttributes:this.geometry.vertexAttributes}:void 0},()=>{var e;const t=this.geometry;(t==null?void 0:t.type)==="mesh"&&t.vertexSpace.origin?(this._lastMeshTransform.localMatrix=(e=t.transform)==null?void 0:e.localMatrix,this._lastMeshTransform.origin=t.vertexSpace.origin):(this._lastMeshTransform.localMatrix=void 0,this._lastMeshTransform.origin=void 0),this._notifyLayer("geometry",this.geometry,this.geometry)},{equals:(t,e)=>t===e,sync:!0})])}};h([p({value:null,json:{read:jlt}})],Ac.prototype,"aggregateGeometries",null),h([p({value:null})],Ac.prototype,"attributes",null),h([p({value:null,types:B2,json:{read:_y}})],Ac.prototype,"geometry",null),h([p({type:Boolean})],Ac.prototype,"isAggregate",void 0),h([p({clonable:"reference"})],Ac.prototype,"layer",void 0),h([p({clonable:"reference"})],Ac.prototype,"origin",void 0),h([p({type:nN})],Ac.prototype,"popupTemplate",void 0),h([p({clonable:"reference"})],Ac.prototype,"sourceLayer",void 0),h([p({value:null,types:VS})],Ac.prototype,"symbol",null),h([p({type:Boolean,value:!0})],Ac.prototype,"visible",null),Ac=NJ=h([I("esri.Graphic")],Ac),function(t){t.generateUID=zh}(Ac||(Ac={}));const ya=Ac;let D3=class extends A3{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};h([zre({Type:ya,ensureType:nn(ya)})],D3.prototype,"itemType",void 0),D3=h([I("esri.support.GraphicsCollection")],D3);let u1=class extends Ue{constructor(e){super(e),this.view=null,this.baseLayerViews=new Ke,this.referenceLayerViews=new Ke,this._loadingHandle=te(()=>{var i,r;return(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.basemap},i=>{i&&i.load().catch(()=>{})},pt)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){var i,r,s;if((i=this.view)!=null&&i.suspended)return!1;const e=(s=(r=this.view)==null?void 0:r.map)==null?void 0:s.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(n=>n.updating)||this.referenceLayerViews.some(n=>n.updating))}};h([p({constructOnly:!0})],u1.prototype,"view",void 0),h([p({readOnly:!0})],u1.prototype,"baseLayerViews",void 0),h([p({readOnly:!0})],u1.prototype,"referenceLayerViews",void 0),h([p({readOnly:!0})],u1.prototype,"suspended",null),h([p({type:Boolean,readOnly:!0})],u1.prototype,"updating",null),u1=h([I("esri.views.BasemapView")],u1);function Hlt(t){return"tryRecycleWith"in t}function qlt(t){return t!=null&&typeof t=="object"&&"layerViews"in t}let Wlt=class{constructor(e,i,r){this.layer=e,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=ma(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,Va(this._controller.signal,()=>{const s=new B("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(s)})}tryRecycle(e){if(!this.done||!this.layerView||!Hlt(this.layerView))return null;const i=this.layer.type,r=this._controller.signal;for(let s=0;s<e.length;s++){const n=e[s];if(n.type!==i)continue;const o=this.layerView.tryRecycleWith(n,{signal:r});if(o){e.splice(s,1),this.layer=n;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(Dt(this._controller.signal),n.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),n.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,u)=>Va(this._controller.signal,()=>u(Ui())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:e}),r.emit("layerview-destroy",{layer:i,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){var s,n;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:i,view:r}=this;this._map=r.map;try{let o,a;if(await i.load({signal:e}),i.prefetchResources&&await i.prefetchResources({signal:e}),Ylt(i))o=await i.createLayerView(r,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new B("layer:view-not-supported","No layerview implementation was found");const u=await this.layerViewImporter.importLayerView(i);Dt(e),o="default"in u?new u.default({layer:i,view:r}):new u({layer:i,view:r})}const l=()=>{a=Lr(a),o.destroyed||o.destroy(),o.layer=null,o.parent=null,o.view=null,this.done=!0};a=Va(e,l),Dt(e);try{await o.when()}catch(u){throw l(),u}if(!((n=(s=this._map)==null?void 0:s.allLayers)==null?void 0:n.includes(i)))return l(),void this._deferred.reject(new B("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=o,i.emit("layerview-create",{view:r,layerView:o}),r.emit("layerview-create",{layer:i,layerView:o}),this.done=!0,this._deferred.resolve(o)}catch(o){i.emit("layerview-create-error",{view:r,error:o}),r.emit("layerview-create-error",{layer:i,error:o}),this.done=!0,this._deferred.reject(new B("layerview:create-error","layerview creation failed",{layer:i,error:o}))}}},Ed=class extends Ue{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new f_,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var r;const i=(r=this.view.map)==null?void 0:r.allLayers;if(i)for(const s of i)this.layerViewImporter.hasLayerViewModule(s)&&this.layerViewImporter.importLayerView(s)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=ma(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(k2(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var l,c,u;if(this.destroyed)return;const i=this.view.map;if(this._map!==i&&(this.clear(),this._map=i),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const r=new Set,s=[],n=this.view.ready,o=d=>{if(d!=null){for(const f of d)if(f){r.add(f);const m=this._layerLayerViewInfoMap.get(f);m&&n?m.start():m||this._recyclingInfoMap.has(f)||s.push(f),"layers"in f&&f.layers&&o(f.layers)}}};for(const d of this._rootCollectionNames)o(Gc(this,d));for(const[d,f]of this._layerLayerViewInfoMap)if(!r.has(d)){this._layerLayerViewInfoMap.delete(f.layer);const m=f.tryRecycle(s);m?(this.notifyChange("updating"),this._recyclingInfoMap.set(f.layer,f),m.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(f.layer),this._layerLayerViewInfoMap.set(f.layer,f),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(f.layer),f.destroy(),this._reschedule()})):f.destroy()}for(const[d,f]of this._recyclingInfoMap)r.has(d)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(f.layer),f.destroy());for(const d of s)this._createLayerView(d);this._refreshCollections();const a=[(l=i==null?void 0:i.ground)==null?void 0:l.layers,(c=i==null?void 0:i.basemap)==null?void 0:c.baseLayers,(u=i==null?void 0:i.basemap)==null?void 0:u.referenceLayers,i==null?void 0:i.layers].filter(d=>!!d);r.forEach(d=>"layers"in d&&a.push(d.layers)),this.addHandles(a.map(d=>this._watchUpdatingTracking.addOnCollectionChange(()=>d,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([on(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),te(()=>{const e=this.view,i=e==null?void 0:e.map;return[i==null?void 0:i.basemap,i==null?void 0:i.ground,i==null?void 0:i.layers,e==null?void 0:e.ready]},()=>this._reschedule(),pr)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),$H(this._recyclingInfoMap),$H(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(Ui()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||Fh(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const i of this._layerLayerViewInfoMap.values())i.done||++e;return e}clear(){this.destroyed||($H(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new B("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}isCreatingLayerViewsForLayer(e,i){var n;this.commitProperty("updatingRemaining");const r=this._layerLayerViewInfoMap.get(e);if(!(r!=null&&r.done))return!0;const s=r.layerView;return!(!s||!i||s.parent===i)||!!(r.done&&s&&"layers"in e&&((n=e.layers)!=null&&n.length))&&e.layers.some(o=>this.isCreatingLayerViewsForLayer(o,s))}_refreshCollections(){for(const[e,i]of this._layersToLayerViews)this._populateLayerViewsOwners(Gc(this,e),Gc(this,i),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,i,r){if(!e||!i)return void(i&&i.removeAll());let s=0;for(const n of e){const o=this._layerLayerViewInfoMap.get(n);if(!(o!=null&&o.layerView))continue;const a=o.layerView;a.layer=n,a.parent=r,i.at(s)!==a&&i.splice(s,0,a),"layers"in n&&qlt(a)&&this._populateLayerViewsOwners(n.layers,a.layerViews,a),s+=1}s<i.length&&i.splice(s,i.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const i=new Wlt(e,this.view,this.layerViewImporter);i.promise.then(()=>this._refreshCollections(),r=>{r&&(us(r)||r.name==="cancelled:layerview-create")||ne.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,i),this.view.ready&&i.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};h([p()],Ed.prototype,"_workPromise",void 0),h([p({readOnly:!0})],Ed.prototype,"_watchUpdatingTracking",void 0),h([p({readOnly:!0})],Ed.prototype,"_layersToLayerViews",null),h([p({readOnly:!0})],Ed.prototype,"_rootCollectionNames",null),h([p()],Ed.prototype,"layerViewImporter",void 0),h([p()],Ed.prototype,"supportsGround",void 0),h([p({readOnly:!0})],Ed.prototype,"updating",null),h([p({readOnly:!0})],Ed.prototype,"updatingRemaining",null),h([p({constructOnly:!0})],Ed.prototype,"view",void 0),Ed=h([I("esri.views.LayerViewManager")],Ed);const Zlt=Ed;function Ylt(t){return"createLayerView"in t&&t.createLayerView!=null}let uh=class extends Ue{constructor(e){super(e),this.factor=1.5,this.offset=fp(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};h([p({type:Number})],uh.prototype,"factor",void 0),h([p({nonNullable:!0})],uh.prototype,"offset",void 0),h([p()],uh.prototype,"position",void 0),h([p({type:Number,range:{min:0}})],uh.prototype,"size",void 0),h([p()],uh.prototype,"maskUrl",void 0),h([p()],uh.prototype,"maskEnabled",void 0),h([p()],uh.prototype,"overlayUrl",void 0),h([p()],uh.prototype,"overlayEnabled",void 0),h([p({readOnly:!0})],uh.prototype,"version",null),h([p({type:Boolean})],uh.prototype,"visible",void 0),uh=h([I("esri.views.Magnifier")],uh);const yRe=uh;let N3=class{constructor(e){this._observable=new _O,this._map=new Map(e)}get size(){return Ft(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const i=this._map.delete(e);return i&&this._observable.notify(),i}entries(){return Ft(this._observable),this._map.entries()}forEach(e,i){Ft(this._observable),this._map.forEach((r,s)=>e.call(i,r,s,this),i)}get(e){return Ft(this._observable),this._map.get(e)}has(e){return Ft(this._observable),this._map.has(e)}keys(){return Ft(this._observable),this._map.keys()}set(e,i){return this._map.set(e,i),this._observable.notify(),this}values(){return Ft(this._observable),this._map.values()}[Symbol.iterator](){return Ft(this._observable),this._map[Symbol.iterator]()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}};var FJ;let XR=FJ=class extends Se{constructor(t){super(t),this.name=null,this.code=null}clone(){return new FJ({name:this.name,code:this.code})}};h([p({type:String,json:{write:!0}})],XR.prototype,"name",void 0),h([p({type:[String,Number],json:{write:!0}})],XR.prototype,"code",void 0),XR=FJ=h([I("esri.layers.support.CodedValue")],XR);const Xlt=new Qi({inherited:"inherited",codedValue:"coded-value",range:"range"});let JR=class extends Se{constructor(e){super(e),this.name=null,this.type=null}};h([p({type:String,json:{write:!0}})],JR.prototype,"name",void 0),h([$t(Xlt)],JR.prototype,"type",void 0),JR=h([I("esri.layers.support.Domain")],JR);const x6=JR;var kJ;let QR=kJ=class extends x6{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const i=String(t);this.codedValues.some(r=>(String(r.code)===i&&(e=r.name),!!e))}return e}clone(){return new kJ({codedValues:re(this.codedValues),name:this.name})}};h([p({type:[XR],json:{write:!0}})],QR.prototype,"codedValues",void 0),h([$t({codedValue:"coded-value"})],QR.prototype,"type",void 0),QR=kJ=h([I("esri.layers.support.CodedValueDomain")],QR);const _Re=QR;var UJ;let $U=UJ=class extends x6{constructor(t){super(t),this.type="inherited"}clone(){return new UJ}};h([$t({inherited:"inherited"})],$U.prototype,"type",void 0),$U=UJ=h([I("esri.layers.support.InheritedDomain")],$U);const vRe=$U;var VJ;let jC=VJ=class extends x6{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new VJ({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};h([p({json:{type:[Number],read:{source:"range",reader:(t,e)=>{var i;return(i=e.range)==null?void 0:i[1]}},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,i){e[i]=[this.minValue||0,t]}}}})],jC.prototype,"maxValue",void 0),h([p({json:{type:[Number],read:{source:"range",reader:(t,e)=>{var i;return(i=e.range)==null?void 0:i[0]}},write:{target:"range",writer(t,e,i){e[i]=[t,this.maxValue||0]}}}})],jC.prototype,"minValue",void 0),h([$t({range:"range"})],jC.prototype,"type",void 0),jC=VJ=h([I("esri.layers.support.RangeDomain")],jC);const bRe=jC,wRe={key:"type",base:x6,typeMap:{range:bRe,"coded-value":_Re,inherited:vRe}};function T6(t){if(!(t!=null&&t.type))return null;switch(t.type){case"range":return bRe.fromJSON(t);case"codedValue":return _Re.fromJSON(t);case"inherited":return vRe.fromJSON(t)}return null}var zJ;const Jlt=new Qi({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Vl=zJ=class extends Se{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return(i==null?void 0:i.value)??null}readValueType(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return i?Jlt.fromJSON(i.fieldValueType):null}clone(){var t;return new zJ({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:((t=this.domain)==null?void 0:t.clone())??null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};h([p({type:String,json:{write:!0}})],Vl.prototype,"alias",void 0),h([p({type:[String,Number],json:{write:{allowNull:!0}}})],Vl.prototype,"defaultValue",void 0),h([p()],Vl.prototype,"description",void 0),h([ze("description")],Vl.prototype,"readDescription",null),h([p({types:wRe,json:{read:{reader:T6},write:!0}})],Vl.prototype,"domain",void 0),h([p({type:Boolean,json:{write:!0}})],Vl.prototype,"editable",void 0),h([p({type:Ji,json:{write:{overridePolicy:t=>({enabled:Number.isFinite(t)})}}})],Vl.prototype,"length",void 0),h([p({type:String,json:{write:!0}})],Vl.prototype,"name",void 0),h([p({type:Boolean,json:{write:!0}})],Vl.prototype,"nullable",void 0),h([$t(Mse)],Vl.prototype,"type",void 0),h([p()],Vl.prototype,"valueType",void 0),h([ze("valueType",["description"])],Vl.prototype,"readValueType",null),h([p({type:Boolean,json:{read:!1}})],Vl.prototype,"visible",void 0),Vl=zJ=h([I("esri.layers.support.Field")],Vl);const S6=Vl;var BJ;let GC=BJ=class extends Se{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new BJ({mapLayerId:t,gdbVersion:e})}};h([$t({mapLayer:"map-layer"})],GC.prototype,"type",void 0),h([p({type:Ji,json:{write:!0}})],GC.prototype,"mapLayerId",void 0),h([p({type:String,json:{write:!0}})],GC.prototype,"gdbVersion",void 0),GC=BJ=h([I("esri.layers.support.source.MapLayerSource")],GC);var jJ;let w0=jJ=class extends Se{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:i,spatialReference:r,geometryType:s}=this,n={workspaceId:t,query:e,oidFields:i,spatialReference:(r==null?void 0:r.clone())??void 0,geometryType:s};return new jJ(n)}};h([$t({queryTable:"query-table"})],w0.prototype,"type",void 0),h([p({type:String,json:{write:!0}})],w0.prototype,"workspaceId",void 0),h([p({type:String,json:{write:!0}})],w0.prototype,"query",void 0),h([p({type:String,json:{write:!0}})],w0.prototype,"oidFields",void 0),h([p({type:Ye,json:{write:!0}})],w0.prototype,"spatialReference",void 0),h([$t(LMe)],w0.prototype,"geometryType",void 0),w0=jJ=h([I("esri.layers.support.source.QueryTableDataSource")],w0);var GJ;let HC=GJ=class extends Se{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new GJ({workspaceId:t,dataSourceName:e})}};h([$t({raster:"raster"})],HC.prototype,"type",void 0),h([p({type:String,json:{write:!0}})],HC.prototype,"dataSourceName",void 0),h([p({type:String,json:{write:!0}})],HC.prototype,"workspaceId",void 0),HC=GJ=h([I("esri.layers.support.source.RasterDataSource")],HC);var HJ;let Qx=HJ=class extends Se{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:i}=this;return new HJ({workspaceId:t,gdbVersion:e,dataSourceName:i})}};h([$t({table:"table"})],Qx.prototype,"type",void 0),h([p({type:String,json:{write:!0}})],Qx.prototype,"workspaceId",void 0),h([p({type:String,json:{write:!0}})],Qx.prototype,"gdbVersion",void 0),h([p({type:String,json:{write:!0}})],Qx.prototype,"dataSourceName",void 0),Qx=HJ=h([I("esri.layers.support.source.TableDataSource")],Qx);var qJ,WJ;const Qlt=lc()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let hh=qJ=class extends Se{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,i){return Kpe()(t,e,i)}castLeftTableSource(t){return om(ZJ(),t)}readRightTableSource(t,e,i){return Kpe()(t,e,i)}castRightTableSource(t){return om(ZJ(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:i,rightTableSource:r,joinType:s}=this,n={leftTableKey:t,rightTableKey:e,leftTableSource:(i==null?void 0:i.clone())??void 0,rightTableSource:(r==null?void 0:r.clone())??void 0,joinType:s};return new qJ(n)}};h([$t({joinTable:"join-table"})],hh.prototype,"type",void 0),h([p({type:String,json:{write:!0}})],hh.prototype,"leftTableKey",void 0),h([p({type:String,json:{write:!0}})],hh.prototype,"rightTableKey",void 0),h([p({json:{write:!0}})],hh.prototype,"leftTableSource",void 0),h([ze("leftTableSource")],hh.prototype,"readLeftTableSource",null),h([Qt("leftTableSource")],hh.prototype,"castLeftTableSource",null),h([p({json:{write:!0}})],hh.prototype,"rightTableSource",void 0),h([ze("rightTableSource")],hh.prototype,"readRightTableSource",null),h([Qt("rightTableSource")],hh.prototype,"castRightTableSource",null),h([$t(Qlt)],hh.prototype,"joinType",void 0),hh=qJ=h([I("esri.layers.support.source.JoinTableDataSource")],hh);let oq=null;function Kpe(){return oq||(oq=gO({types:ZJ()})),oq}let aq=null;function ZJ(){return aq||(aq={key:"type",base:null,typeMap:{"data-layer":xf,"map-layer":GC}}),aq}const Klt={key:"type",base:null,typeMap:{"join-table":hh,"query-table":w0,raster:HC,table:Qx}};let xf=WJ=class extends Se{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new WJ({fields:t,dataSource:e})}};h([$t({dataLayer:"data-layer"})],xf.prototype,"type",void 0),h([p({type:[S6],json:{write:!0}})],xf.prototype,"fields",void 0),h([p({types:Klt,json:{write:!0}})],xf.prototype,"dataSource",void 0),xf=WJ=h([I("esri.layers.support.source.DataLayerSource")],xf),xf.from=nn(xf);let Kx=class extends ts(Se){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};h([p({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.onFields!=null&&this.onFields.length>0}}}}})],Kx.prototype,"onFields",void 0),h([p({type:String,json:{write:!0}})],Kx.prototype,"operator",void 0),h([p({type:String,json:{write:!0}})],Kx.prototype,"searchTerm",void 0),h([p({type:String,json:{write:!0}})],Kx.prototype,"searchType",void 0),Kx=h([I("esri.rest.support.FullTextSearch")],Kx);const ect=Kx;var YJ;const efe=new Qi({upperLeft:"upper-left",lowerLeft:"lower-left"});let eT=YJ=class extends Se{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new YJ(re({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};h([p({type:dr,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],eT.prototype,"extent",void 0),h([p({type:["view","edit"],json:{write:!0}})],eT.prototype,"mode",void 0),h([p({type:String,json:{read:efe.read,write:efe.write}})],eT.prototype,"originPosition",void 0),h([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],eT.prototype,"tolerance",void 0),eT=YJ=h([I("esri.rest.support.QuantizationParameters")],eT);const tct=eT,ict=new Qi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});var XJ;const tfe=new Qi({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let tf=XJ=class extends Se{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=re(t))}clone(){return new XJ({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:re(this.statisticParameters)})}};h([p({type:Number,json:{write:!0}})],tf.prototype,"maxPointCount",void 0),h([p({type:Number,json:{write:!0}})],tf.prototype,"maxRecordCount",void 0),h([p({type:Number,json:{write:!0}})],tf.prototype,"maxVertexCount",void 0),h([p({type:String,json:{write:!0}})],tf.prototype,"onStatisticField",void 0),h([p({type:String,json:{write:!0}})],tf.prototype,"outStatisticFieldName",void 0),h([p({type:String,json:{read:{source:"statisticType",reader:tfe.read},write:{target:"statisticType",writer:tfe.write}}})],tf.prototype,"statisticType",void 0),h([p({type:Object})],tf.prototype,"statisticParameters",void 0),h([Ze("statisticParameters")],tf.prototype,"writeStatisticParameters",null),tf=XJ=h([I("esri.rest.support.StatisticDefinition")],tf);const xRe=tf;var RU;const rct=new Qi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Yt=RU=class extends Se{static from(t){return i2(RU,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const i={};for(const r in t){const s=t[r];Array.isArray(s)?i[r]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?i[r]=s.getTime():i[r]=s}e.parameterValues=i}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new RU(re({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment!=null?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};Yt.MAX_MAX_RECORD_COUNT_FACTOR=5,h([p({json:{write:!0}})],Yt.prototype,"aggregateIds",void 0),h([p({type:Boolean,json:{write:!0}})],Yt.prototype,"cacheHint",void 0),h([p({type:Boolean,json:{default:!1,write:!0}})],Yt.prototype,"compactGeometryEnabled",void 0),h([p({json:{write:!0}})],Yt.prototype,"datumTransformation",void 0),h([Qt("datumTransformation")],Yt.prototype,"castDatumTransformation",null),h([p({type:Boolean,json:{default:!1,write:!0}})],Yt.prototype,"defaultSpatialReferenceEnabled",void 0),h([p({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],Yt.prototype,"distance",void 0),h([p({type:xf,json:{write:!0}})],Yt.prototype,"dynamicDataSource",void 0),h([p({type:String,json:{write:!0}})],Yt.prototype,"formatOf3DObjects",void 0),h([p({type:[ect],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.fullText!=null&&this.fullText.length>0}}}}})],Yt.prototype,"fullText",void 0),h([p({type:String,json:{write:!0}})],Yt.prototype,"gdbVersion",void 0),h([p({types:B2,json:{read:_y,write:!0}})],Yt.prototype,"geometry",void 0),h([p({type:Number,json:{write:!0}})],Yt.prototype,"geometryPrecision",void 0),h([p({type:[String],json:{write:!0}})],Yt.prototype,"groupByFieldsForStatistics",void 0),h([p({type:String,json:{write:!0}})],Yt.prototype,"having",void 0),h([p({type:Date})],Yt.prototype,"historicMoment",void 0),h([Ze("historicMoment")],Yt.prototype,"writeHistoricMoment",null),h([p({type:Number,json:{write:!0}})],Yt.prototype,"maxAllowableOffset",void 0),h([p({type:Number,cast:t=>t<1?1:t>Yt.MAX_MAX_RECORD_COUNT_FACTOR?Yt.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],Yt.prototype,"maxRecordCountFactor",void 0),h([p({type:["xyFootprint"],json:{write:!0}})],Yt.prototype,"multipatchOption",void 0),h([p({type:Number,json:{read:{source:"resultRecordCount"}}})],Yt.prototype,"num",void 0),h([p({json:{write:!0}})],Yt.prototype,"objectIds",void 0),h([p({type:[String],json:{write:!0}})],Yt.prototype,"orderByFields",void 0),h([p({type:[String],json:{write:!0}})],Yt.prototype,"outFields",void 0),h([p({type:Ye,json:{name:"outSR",write:!0}})],Yt.prototype,"outSpatialReference",void 0),h([p({type:[xRe],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.outStatistics!=null&&this.outStatistics.length>0}}}}})],Yt.prototype,"outStatistics",void 0),h([p({json:{write:!0}})],Yt.prototype,"parameterValues",void 0),h([Ze("parameterValues")],Yt.prototype,"writeParameterValues",null),h([p({type:wt,json:{write:!0}})],Yt.prototype,"pixelSize",void 0),h([p({type:tct,json:{write:!0}})],Yt.prototype,"quantizationParameters",void 0),h([p({type:[Object],json:{write:!0}})],Yt.prototype,"rangeValues",void 0),h([p({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],Yt.prototype,"relationParameter",void 0),h([p({type:String,json:{write:!0}})],Yt.prototype,"resultType",void 0),h([p({type:Boolean,json:{default:!1,write:!0}})],Yt.prototype,"returnCentroid",void 0),h([p({type:Boolean,json:{default:!1,write:!0}})],Yt.prototype,"returnDistinctValues",void 0),h([p({type:Boolean,json:{default:!0,write:!0}})],Yt.prototype,"returnExceededLimitFeatures",void 0),h([p({type:Boolean,json:{write:!0}})],Yt.prototype,"returnGeometry",void 0),h([p({type:Boolean,json:{default:!1,write:!0}})],Yt.prototype,"returnQueryGeometry",void 0),h([p({type:Boolean,json:{default:!1,write:!0}})],Yt.prototype,"returnM",void 0),h([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Yt.prototype,"returnZ",void 0),h([p({type:Ye,json:{write:!0}})],Yt.prototype,"sourceSpatialReference",void 0),h([$t(ict,{ignoreUnknown:!1,name:"spatialRel"})],Yt.prototype,"spatialRelationship",void 0),h([p({type:Number,json:{read:{source:"resultOffset"}}})],Yt.prototype,"start",void 0),h([Ze("start"),Ze("num")],Yt.prototype,"writeStart",null),h([p({type:String,json:{write:!0}})],Yt.prototype,"sqlFormat",void 0),h([p({type:String,json:{write:!0}})],Yt.prototype,"text",void 0),h([p({type:za,json:{write:!0}})],Yt.prototype,"timeExtent",void 0),h([p({type:Boolean,json:{default:!1,write:!0}})],Yt.prototype,"timeReferenceUnknownClient",void 0),h([$t(rct,{ignoreUnknown:!1}),p({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],Yt.prototype,"units",void 0),h([p({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],Yt.prototype,"where",void 0),h([Ze("where")],Yt.prototype,"writeWhere",null),Yt=RU=h([I("esri.rest.support.Query")],Yt);const qh=Yt;function YF(t){return!!(t!=null&&typeof t=="object"&&"createQuery"in t&&t.createQuery&&"on"in t&&t.on)}let x0=class extends Ls.EventedAccessor{constructor(e){super(e),this._selectionMap=new N3,this._sources=new Ke,this._trashCan=[],this._layerEditHandles=new Ke,this._vizTaskId=0,this.showHighlight=!0}initialize(){this.addHandles([te(()=>[this.view,this.showHighlight],()=>this._refreshVisualization()),on(()=>this.sources,"change",i=>{const r=this._selectionMap;for(const s of i.removed)r.delete(s);this._refreshListeners(),this._refreshVisualization()},{onListenerAdd:()=>this._refreshListeners()})]);const e=new Ke;this.view.when().then(()=>{this.view.map&&(this.view.map.allLayers.flatten(i=>"sublayers"in i&&i.sublayers?i.sublayers:null).forEach(i=>{(YF(i)&&!fXe(i)||Ix(i))&&e.add(i)}),this.sources=e)})}destroy(){this._layerEditHandles.drain(Lr)}get selections(){return Array.from(this._selectionMap.entries()).map(e=>{const[i,r]=e;return{layer:i,selection:[...r.selection]}})}get count(){let e=0;for(const i of this._selectionMap.values())e+=i.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._sources}set sources(e){gy(e,this._sources)}async getSelectedFeatures(e,i={},r="layerView"){const{view:s,selections:n}=this,o=(e!==void 0?n.filter(a=>e.includes(a.layer)):n).filter(a=>a.selection.length>0).map(async a=>{const{layer:l,selection:c}=a,u=Ix(l)?l.parent:l;if(u==null||!rfe(u))return null;if(r==="layer")return sfe(u,c,i);if(ife(u))return null;const d=await s.whenLayerView(u).catch(()=>null);return d?sfe(d,c,i):null});return(await Promise.all(o)).filter(a=>a!=null)}updateSelection(e){const i=new Map;for(const[n,o]of this._selectionMap)i.set(n,[...o.selection]);let r=!1;const s=e.current.concat(e.added);for(const n of s){const o=n.sourceLayer,a=n.getObjectId();if(this.sources.includes(o)&&(YF(o)||Ix(o))&&a!==null){const l=VD(i,o,()=>[]);l.includes(a)||(l.push(a),r=!0)}}for(const n of e.removed){const o=n.sourceLayer,a=n.getObjectId();if(this.sources.includes(o)&&(YF(o)||Ix(o))&&a!==null){const l=i.get(o),c=l==null?void 0:l.indexOf(a);c!==void 0&&c>=0&&(l==null||l.splice(c,1),r=!0)}}if(r){const{_selectionMap:n,_trashCan:o}=this,a=[];for(const[l,c]of i){const u=n.get(l);u!==void 0&&o.push(u),n.set(l,{selection:c}),a.push({layer:l,selection:c,...cZ(u!==void 0?u.selection:[],c)})}this._onSelectionChange(a)}}setSelection(e,i){this._setSelection(e,i)}getSelection(e){const i=this._selectionMap.get(e);return i==null?void 0:i.selection}appendToSelection(e,i){const r=this._selectionMap.get(e),s=r!==void 0?[...r.selection]:[];for(const n of i)s.includes(n)||s.push(n);this._setSelection(e,s)}removeFromSelection(e,i){const r=this._selectionMap.get(e);if(!r)return;const s=[];for(const n of r.selection)i.includes(n)||s.push(n);this._setSelection(e,s)}toggleInSelection(e,i){const r=this._selectionMap.get(e);if(!r||r.selection.length===0)return void this._setSelection(e,i);const s=new Set(r.selection),n=new Set(i),o=H7e(s,n);this._setSelection(e,Array.from(o))}clear(){const e=this._selectionMap.values();this._trashCan.push(...e);const i=[];for(const[r,s]of this._selectionMap.entries())i.push({layer:r,added:[],removed:[...s.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(i)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){var o;if(this.view==null||this.sources==null)return;for(this._vizTaskId++;this._trashCan.length>0;){const a=this._trashCan.pop();(o=a==null?void 0:a.highlightHandle)==null||o.remove()}const{sources:e,view:i,_selectionMap:r,showHighlight:s}=this,n=this._vizTaskId;for(const a of e){const l=r.get(a),c=Ix(a)?a.parent:a;if(c!=null&&rfe(c)){if(ife(c))continue;i.whenLayerView(c).then(u=>{var d;(d=l==null?void 0:l.highlightHandle)==null||d.remove(),l!=null&&s&&n===this._vizTaskId&&"highlight"in u&&typeof u.highlight=="function"&&l.selection.length>0&&(l.highlightHandle=u.highlight(l.selection,"selection"))}).catch(()=>{var u;(u=l==null?void 0:l.highlightHandle)==null||u.remove()})}}}_refreshListeners(){this._layerEditHandles.drain(Lr);for(const e of this.sources){const i=Ix(e)?e.parent:e;if(i!=null&&YF(i)){const r=i.on("edits",s=>{this._handleEditChanges(s,e)});this._layerEditHandles.push(r)}}}_handleEditChanges(e,i){if(e.deletedFeatures!==void 0&&e.deletedFeatures.length>0&&this._selectionMap.has(i)){const r=e.deletedFeatures.filter(s=>s.error==null).map(s=>s.objectId).filter(sd);this.removeFromSelection(i,r)}}_setSelection(e,i){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);const r=this._selectionMap.get(e);if(r===void 0||!nct(r,{selection:i})){r!==void 0&&this._trashCan.push(r),this._selectionMap.set(e,{selection:[...i]});const s={layer:e,selection:[...i],...cZ(r!==void 0?r.selection:[],i)};this._onSelectionChange([s])}}};h([p({readOnly:!0,nonNullable:!0})],x0.prototype,"selections",null),h([p({readOnly:!0,nonNullable:!0})],x0.prototype,"count",null),h([p({constructOnly:!0,nonNullable:!0})],x0.prototype,"view",void 0),h([p({readOnly:!0,nonNullable:!0})],x0.prototype,"hasSelection",null),h([p()],x0.prototype,"showHighlight",void 0),h([p()],x0.prototype,"sources",null),x0=h([I("esri.views.SelectionManager")],x0);const ife=t=>{var e;return Ix(t)?((e=t.parent)==null?void 0:e.isTable)===!0:t.isTable},sct=t=>t.layer!==void 0,rfe=t=>(t==null?void 0:t.when)!==void 0,nct=(t,e)=>{if(t==null&&e==null)return!0;if(t!=null&&e==null||t==null&&e!=null)return!1;if(t!=null&&e!=null&&t.selection!=null&&e.selection!=null){const i=[...t.selection],r=[...e.selection];if(i.length!==r.length)return!1;i.sort(),r.sort();for(let s=0;s<i.length;s++)if(i[s]!==r[s])return!1}return!0},sfe=async(t,e,i={})=>{let r;if(sct(t)){const s=t;r=s===void 0?null:await s.queryFeatures(new qh({...i,objectIds:e})).then(n=>({data:n,layer:t.layer}))}else{const s=t;r=s===void 0?null:await s.queryFeatures(new qh({...i,objectIds:e})).then(n=>({data:n,layer:s}))}return r},oct=x0;let KR=class extends ts(Ue){constructor(e){super(e),this.accentColor=new je([255,127,0]),this.textColor=new je([255,255,255])}};h([p({type:je,nonNullable:!0})],KR.prototype,"accentColor",void 0),h([p({type:je,nonNullable:!0})],KR.prototype,"textColor",void 0),KR=h([I("esri.views.Theme")],KR);const JJ=KR;var nfe;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(nfe||(nfe={}));const TRe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],SRe={};function ERe(t){return!!SRe[t]}function act(t){for(const e of t)if(!ERe(e))return!1;return!0}TRe.forEach(t=>{SRe[t]=!0});let lct=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:i,priority:r},s)=>{var n;return(n=this.inputManager)==null?void 0:n.installHandlers(s,[i],r)})}disconnect(){this.inputManager&&this._handlers.forEach((e,i)=>{var r;return(r=this.inputManager)==null?void 0:r.uninstallHandlers(i)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,i,r,s){const n=Array.isArray(e)?e:e.split(",");if(!act(n))return n.some(ERe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(i)?a=i:(o=i,a=[]),typeof r=="function"?o=r:s=r,s=s??Tb.DEFAULT;const l=this._createUniqueGroupName(),c=new cct(this.view,n,a,o);this._handlers.set(l,{handler:c,priority:s});for(const u of n){const d=this._handlerCounts.get(u)||0;this._handlerCounts.set(u,d+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),Gi(()=>this._removeHandler(l,n))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,i){if(this._handlers.has(e)){this._handlers.delete(e);for(const r of i){const s=this._handlerCounts.get(r);s===void 0||(s===1?this._handlerCounts.delete(r):this._handlerCounts.set(r,s-1))}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},cct=class extends ba{constructor(e,i,r,s){super(!0),this._latestDragStart=void 0,this.view=e;for(const n of i)switch(n){case"click":this.registerIncoming("click",r,o=>s(dct(e,o)));break;case"double-click":this.registerIncoming("double-click",r,o=>s(pct(e,o)));break;case"immediate-click":this.registerIncoming("immediate-click",r,o=>s(fct(e,o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,o=>s(mct(e,o)));break;case"hold":this.registerIncoming("hold",r,o=>s(gct(e,o)));break;case"drag":this.registerIncoming("drag",r,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",r,o=>s(yct(o)));break;case"key-up":this.registerIncoming("key-up",r,o=>s(_ct(o)));break;case"pointer-down":this.registerIncoming("pointer-down",r,o=>s(x$(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,o=>s(x$(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,o=>s(x$(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,o=>s(vct(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,o=>s(bct(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,o=>s(x$(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,o=>s(x$(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,o=>{s(wct(o))});break;case"focus":this.registerIncoming("focus",r,o=>{s(uct(o))});break;case"blur":this.registerIncoming("blur",r,o=>{s(hct(o))})}}_wrapDrag(e){const i=e.data,{x:r,y:s}=i.center,{action:n,pointerType:o,button:a}=i;if(n==="start"&&(this._latestDragStart=i),!this._latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:u,timestamp:d}=e,f={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:r,y:s,origin:f,pointerType:o,button:a,buttons:c,radius:i.radius,angle:ja(i.angle),native:l,timestamp:d,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}};function uct(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function hct(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}function dct(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:u,screenPoint:fp(n,o),mapPoint:cN(t,n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}function pct(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"double-click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:u,mapPoint:cN(t,n,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}function fct(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:d}=e;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:cN(t,n,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}function mct(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:d}=e;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:cN(t,n,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}function gct(t,e){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:cN(t,n,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}function cN(t,e,i){return t.toMap(fp(e,i),{exclude:[]})}function yct(t){const{key:e,repeat:i,native:r}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-down",key:e,repeat:i,native:r,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}function _ct(t){const{key:e,native:i}=t.data,{cancelable:r,timestamp:s}=t;return{type:"key-up",key:e,native:i,timestamp:s,cancelable:r,stopPropagation:()=>t.stopPropagation(),async:n=>t.async(n),preventDefault:()=>t.preventDefault()}}function x$(t,e){const{x:i,y:r,button:s,buttons:n,native:o,eventId:a}=t.data,l=o.pointerId,c=o.pointerType,{cancelable:u,timestamp:d}=t;return{type:e,x:i,y:r,pointerId:l,pointerType:c,button:s,buttons:n,native:o,timestamp:d,eventId:a,cancelable:u,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}function vct(t){const{x:e,y:i,buttons:r,native:s,eventId:n}=t.data.currentEvent,{button:o}=t.data.startEvent,a=t.data.startEvent.native.pointerId,l=t.data.startEvent.native.pointerType,c=t.data.action,u={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:d,timestamp:f}=t;return{type:"pointer-drag",x:e,y:i,pointerId:a,pointerType:l,button:o,buttons:r,action:c,origin:u,native:s,timestamp:f,eventId:n,cancelable:d,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}function bct(t){const{cancelable:e,data:i,timestamp:r}=t,{x:s,y:n,deltaY:o,native:a}=i;return{type:"mouse-wheel",x:s,y:n,deltaY:o,native:a,timestamp:r,cancelable:e,stopPropagation:()=>t.stopPropagation(),async:l=>t.async(l),preventDefault:()=>t.preventDefault()}}function wct(t){const{action:e,state:i,device:r}=t.data,{cancelable:s,timestamp:n}=t,{buttons:o,axes:a}=i;return{type:"gamepad",device:r,timestamp:n,action:e,buttons:o,axes:a,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:l=>t.async(l),preventDefault:()=>t.preventDefault()}}var YL,ofe,afe;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(YL||(YL={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(ofe||(ofe={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(afe||(afe={}));function xct(t){return[t.on("before-add",e=>{const i=e.item;if(i==null||t.includes(i))return ne.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();i.onAdd()}),t.on("after-remove",e=>{const i=e.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function QJ(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(YL.USER)&&t.getEditableFlag(YL.MANAGER)}function og(t){return fp(t.x,t.y)}function rJt(t){return Os(t.x,t.y)}function CRe(t,e){var r;const i=(r=t instanceof HTMLElement?t:t.surface)==null?void 0:r.getBoundingClientRect();return i?fp(e.clientX-i.left,e.clientY-i.top):fp(0,0)}function lfe(t,e){return e instanceof Event?CRe(t,e):og(e)}function cfe(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let Tct=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,i){const r=()=>e.stopPropagation();switch(e.type){case"pointer-move":hfe(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!dfe(e))break;const s=og(e),n=xE(s,e.pointerType,i.forEachTool);if(n==null)break;const o=n.manipulator,a=n.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._releaseManipulatorBeforeDragging(o,e,i),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:s,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&i.activeTool==null&&(this._revertToNullActiveTool=!0,i.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:s}),r());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,i);break;case"pointer-drag":{if(!dfe(e))break;const s=this._grabbedManipulators.get(e.pointerId),n=s==null?void 0:s.manipulator,o=s==null?void 0:s.tool;if(n==null||o==null)break;const a=og(e);a.x=Ne(a.x,0,i.view.width),a.y=Ne(a.y,0,i.view.height);const l=s.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,i)}r();break}case"immediate-click":{const s=og(e),n=xE(s,e.pointerType,i.forEachTool);if(Sct(e)||i.forEachTool(c=>{if((n==null||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let u=!1;c.manipulators.forEach(({manipulator:d})=>{d.selected&&(d.selected=!1,u=!0)}),u&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),n==null)break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:r}),lq(o,r);break}case"click":{const s=og(e),n=xE(s,e.pointerType,i.forEachTool),o=n==null?void 0:n.manipulator;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a}),r();break}case"double-click":{const s=og(e),n=xE(s,e.pointerType,i.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r}),lq(o,r);break}case"immediate-double-click":{const s=og(e),n=xE(s,e.pointerType,i.forEachTool),o=n!=null?n.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r}),lq(o,r);break}}this._onFocusChange(i.forEachTool)}_releaseManipulatorBeforeDragging(e,i,r){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:og(i)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===e&&this._grabbedManipulators.delete(n)}),this._afterManipulatorRelease(r.setActiveTool)}_handlePointerEnd(e,i){var s;const r=(s=this._grabbedManipulators.get(e.pointerId))==null?void 0:s.manipulator;r!=null&&r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:og(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorRelease(i.setActiveTool))}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=ufe(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=ufe(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const i=new Set,r=new Set;this._grabbedManipulators.forEach(({tool:s})=>{i.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{r.add(s)}),e(s=>{s.hasGrabbedManipulators=i.has(s),s.hasHoveredManipulators=r.has(s);const n=this._grabbedManipulators.values(),o=l7e(n,({tool:a})=>a===s);s.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:i,setActiveTool:r},s=!0,n){const o=(a,l)=>a===e&&(n==null||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},u)=>{o(a,l)&&(this._grabbedManipulators.delete(u),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorRelease(r),this._onFocusChange(i)}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(fp(i.x,i.y),r,i.pointerType,e)})}handleHoverEvent(e,i){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!hfe(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(og(e),e.pointerId,e.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(e,i,r,s){var a;let n=xE(e,r,s);const o=(a=this._hoveredManipulators.get(i))==null?void 0:a.manipulator;n==null||n.manipulator.interactive||(n=null),n!=null&&o===n.manipulator||(o!=null&&(o.hovering=!1),n!=null?(n.manipulator.hovering=!0,this._hoveredManipulators.set(i,n)):this._hoveredManipulators.delete(i),this._onFocusChange(s))}_afterManipulatorRelease(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function ufe(t){let e=null;return Fh(t,({manipulator:i})=>!(i==null||!i.interactive)&&(i.grabbing&&i.grabCursor?(e=i.grabCursor,!0):!!i.cursor&&(e=i.cursor,!0))),e}function xE(t,e,i){let r=null;return i(s=>{if(s.manipulators==null||!QJ(s))return!1;const n=s.manipulators.intersect(t,e);return n!=null&&(r={tool:s,manipulator:n},!0)}),r}function hfe(t){return t==="mouse"}function dfe(t){return t.pointerType!=="mouse"||t.button===0}function Sct(t){return!!t.native.shiftKey}function lq(t,e){t!=null&&t.consumesClicks&&e()}const pfe="attached",cq="tools",Ect=1e3;let ag=class extends Ue{constructor(e){super(e),this._updatingHandles=new f_,this._clock=ND,this._manipulatorState=new Tct,this.tools=new Ke,this.cursor=null,this._interacting=!1,this._interactingTimeout=Ect,this._interactingTimeoutHandle=null,this._forEachTool=i=>{for(const r of this.tools.items)if(i(r))return}}initialize(){this.addHandles([this.view.on(TRe,e=>{this._handleInputEvent(e)},Tb.TOOL),...xct(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void ne.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const i=this.activeTool;this._set("activeTool",e),i!=null&&i.deactivate(),e!=null&&e.activate(),this._removeIncompleteTools(e);for(const r of this.tools){this._updateToolEditableFlag(r);const s=QJ(r);this.activeTool!=null&&s||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!s)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=Lr(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){var e;this.view.type==="3d"?this.addHandles([te(()=>{const{state:i}=this.view;return"camera"in i&&i.camera},()=>this._forEachManipulator(i=>i.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",i=>this._forEachManipulator(r=>r.onElevationChange(i)))],pfe):this.addHandles(te(()=>this.view.extent,()=>this._forEachManipulator(i=>i.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(pfe),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(i=>{i.manipulators&&i.manipulators.forEach(({manipulator:r})=>e(r,i))})}_handleInputEvent(e){let i=!1;const r={...e,stopPropagation:()=>{i=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool(s=>{!i&&s.visible&&s.handleInputEvent(r)}),!i&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),i||this.activeTool==null||this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(cq),this._forEachTool(e=>{if(e instanceof Ue){const i=te(()=>[e.cursor,e.visible,e.editable],()=>{QJ(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(i,cq)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",i=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,i.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],cq)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var i;(i=e.setEditableFlag)==null||i.call(e,YL.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(i=>!(i.cursor==null||!i.visible)&&(e=i.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(i=>(e==null||i!==e)&&!i.created&&i.removeIncompleteOnCancel).forEach(i=>{this.tools.remove(i)})}get test(){}};h([p({constructOnly:!0,nonNullable:!0})],ag.prototype,"view",void 0),h([p({value:null})],ag.prototype,"activeTool",null),h([p({readOnly:!0,type:Ke})],ag.prototype,"tools",void 0),h([p({readOnly:!0})],ag.prototype,"cursor",void 0),h([p({readOnly:!0})],ag.prototype,"updating",null),h([p()],ag.prototype,"_interacting",void 0),h([p({readOnly:!0})],ag.prototype,"interacting",null),ag=h([I("esri.views.ToolViewManager")],ag);let qC=class extends Ue{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":Cct.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Mct[this.deviceType]}};h([p({nonNullable:!0,readOnly:!0})],qC.prototype,"nativeIndex",void 0),h([p({type:String,readOnly:!0})],qC.prototype,"deviceType",null),h([p({type:Number,readOnly:!0})],qC.prototype,"axisThreshold",null),qC=h([I("esri.views.input.gamepad.GamepadInputDevice")],qC);const Ine=qC,Cct=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Mct={standard:.15,spacemouse:.025,unknown:0};let eI=class extends Ue{constructor(...e){super(...e),this.devices=new Ke,this.enabledFocusMode="document"}};h([p({type:Ke.ofType(Ine),readOnly:!0})],eI.prototype,"devices",void 0),h([p({type:["document","view","none"]})],eI.prototype,"enabledFocusMode",void 0),eI=h([I("esri.views.input.gamepad.GamepadSettings")],eI);const Act=eI;let IU=class extends Ue{constructor(){super(...arguments),this.gamepad=new Act}};h([p({readOnly:!0})],IU.prototype,"gamepad",void 0),IU=h([I("esri.views.input.Input")],IU);const Pct=IU,MRe=()=>nr.respectPrefersReducedMotion&&window.matchMedia("(prefers-reduced-motion: reduce)").matches;let h1=class extends Ue{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};h([p({type:Boolean,nonNullable:!0})],h1.prototype,"enabled",void 0),h([p({type:Ine})],h1.prototype,"device",void 0),h([p({type:["pan","zoom"],nonNullable:!0})],h1.prototype,"mode",void 0),h([p({type:["forward-down","forward-up"],nonNullable:!0})],h1.prototype,"tiltDirection",void 0),h([p({type:Number,nonNullable:!0})],h1.prototype,"velocityFactor",void 0),h1=h([I("esri.views.navigation.gamepad.GamepadSettings")],h1);const ARe=h1;let tT=class extends Ue{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new ARe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}get effectiveMomentumEnabled(){return this.momentumEnabled&&!MRe()}};h([p({type:Boolean})],tT.prototype,"browserTouchPanEnabled",void 0),h([p({type:ARe,nonNullable:!0})],tT.prototype,"gamepad",void 0),h([p({type:Boolean})],tT.prototype,"momentumEnabled",void 0),h([p({type:Boolean})],tT.prototype,"mouseWheelZoomEnabled",void 0),tT=h([I("esri.views.navigation.Navigation")],tT);const PRe=tT;let KJ,uq=null;async function Oct(t){uq||(uq=oe(()=>Promise.resolve().then(()=>HIt),void 0).then(e=>KJ=e)),await uq,Dt(t)}async function ORe(t,e,i,r){if(!t)return null;const s=t.spatialReference;return wO()||Kc(s,e)?V_(t,e):KJ?KJ.projectGeometry(t,e,i,r):(await Promise.race([Oct(r),wP(r)]),ORe(t,e,i,r))}let _s=class extends Ue{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=oc(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference??this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var r,s,n,o;const e=(r=this.map)==null?void 0:r.call(this),i=[];return this.priorityCollection!=null&&i.push(this.priorityCollection),i.push({parent:e==null?void 0:e.basemap,layers:(s=e==null?void 0:e.basemap)==null?void 0:s.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(n=e==null?void 0:e.ground)==null?void 0:n.layers},{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.referenceLayers}),i}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;let r=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(r,o);a!=null&&(r=a)}if(r!=null&&r.length===1)break}if(i&&(r==null||r.length!==1))return{updating:!0};const s=this._pickSpatialReferenceCandidate(r);return{spatialReference:(s==null?void 0:s.spatialReference)??null,viewingMode:(s==null?void 0:s.viewingMode)??null,updating:!1}}get _tileInfoTask(){var r,s,n,o,a,l,c;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:i}=this._collectLayers([{parent:(s=(r=this.map)==null?void 0:r.call(this))==null?void 0:s.basemap,layers:(a=(o=(n=this.map)==null?void 0:n.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const u=e[0].tileInfo;return{tileInfo:u!=null&&u.spatialReference.equals(this.spatialReference)?u:null,updating:!1}}return{updating:i}}get _heightModelInfoTask(){var r,s,n;if(!this.required.heightModelInfo||this.suspended&&((r=this._get("_heightModelInfoTask"))!=null&&r.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;for(const o of e)if(fKe(o)){const a=fAe(o);if(a)return{heightModelInfo:a,vcsWkid:(s=o.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=o.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:i}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,i=e.updating,r=[];for(const s of e.layers){const n="fullExtents"in s&&s.fullExtents||(s.fullExtent!=null?[s.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:n[0],a=n.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0)for(const l of n)r.push({extent:l,layer:s})}return{candidates:r,updating:i}}get _extentTask(){const{candidates:e,updating:i}=this._extentCandidatesTask;if(i)return{updating:i};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),s=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=oc(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:s.clone(),task:My(async n=>{try{const o=await ORe(r.extent,s,"portalItem"in r.layer?r.layer.portalItem:void 0,n);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(ha(n))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,i){if(e==null)return i;const r=new Array;for(const s of e)for(const n of i){if(!s.spatialReference.equals(n.spatialReference))continue;const o=Rct(s.viewingMode,n.viewingMode);if(o!==!1){r.push({spatialReference:s.spatialReference,viewingMode:o});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const i=this.defaultSpatialReference;return e==null||e.length<1?i?{spatialReference:i,viewingMode:null}:null:(i!=null&&e.length>1&&e.some(({spatialReference:r})=>r.equals(i))&&(e=e.filter(({spatialReference:r})=>r.equals(i))),e.length>1&&e.some(({viewingMode:r})=>r!==Je.Local)&&(e=e.filter(({viewingMode:r})=>r!==Je.Local)),e[0])}_getSupportedSpatialReferences(e){const i="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(i.length===0)return[];const r=[];for(const s of i){const n=this.getSpatialReferenceSupport(s,e);if(n!=null){const o=n.constraints??[{spatialReference:s,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||r.push({spatialReference:a,viewingMode:l})}}return r}_pickExtentCandidate(e){const i=this.spatialReference;return e.find(({extent:r})=>i.equals(r.spatialReference))||e[0]}_collectLayers(e){var r;if(this._loadMaybe((r=this.map)==null?void 0:r.call(this))!=="loaded")return{layers:[],updating:!0};const i=new $ct;for(const s of e)if(this._collectCollection(s,i),i.preloading===this.sourcePreloadCount)break;return{layers:i.layers,updating:i.updating}}_collectCollection(e,i){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return i.updating=!0,void++i.preloading;case"failed":return}for(const r of e.layers){switch(this._loadMaybe(r)){case"failed":continue;case"loading":i.updating=!0,++i.preloading;break;case"loaded":i.updating||i.layers.push(r),"layers"in r&&this._collectCollection({layers:r.layers},i)}if(i.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(i=>{us(i)||console.log(i)}),"loading"):e.loadStatus:"loaded"}};h([p()],_s.prototype,"required",void 0),h([p({constructOnly:!0})],_s.prototype,"map",void 0),h([p({constructOnly:!0})],_s.prototype,"getSpatialReferenceSupport",void 0),h([p()],_s.prototype,"defaultSpatialReference",void 0),h([p()],_s.prototype,"userSpatialReference",void 0),h([p()],_s.prototype,"sourcePreloadCount",void 0),h([p()],_s.prototype,"priorityCollection",void 0),h([p()],_s.prototype,"requiresExtentInSpatialReference",void 0),h([p()],_s.prototype,"suspended",void 0),h([p({readOnly:!0})],_s.prototype,"ready",null),h([p({readOnly:!0})],_s.prototype,"heightModelInfoReady",null),h([p({readOnly:!0})],_s.prototype,"spatialReference",null),h([p({readOnly:!0})],_s.prototype,"extent",null),h([p({readOnly:!0})],_s.prototype,"heightModelInfo",null),h([p({readOnly:!0})],_s.prototype,"vcsWkid",null),h([p({readOnly:!0})],_s.prototype,"latestVcsWkid",null),h([p({readOnly:!0})],_s.prototype,"viewingMode",null),h([p({readOnly:!0})],_s.prototype,"tileInfo",null),h([p({readOnly:!0})],_s.prototype,"mapCollections",null),h([p({readOnly:!0})],_s.prototype,"_allLayers",null),h([p({readOnly:!0})],_s.prototype,"_spatialReferenceTask",null),h([p({readOnly:!0})],_s.prototype,"_tileInfoTask",null),h([p({readOnly:!0})],_s.prototype,"_heightModelInfoTask",null),h([p({readOnly:!0})],_s.prototype,"_extentCandidatesTask",null),h([p()],_s.prototype,"_extentTask",null),h([p()],_s.prototype,"_projectExtentTask",void 0),_s=h([I("esri.views.support.DefaultsFromMap")],_s);let $ct=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};function Rct(t,e){return t!=null?e!=null?t===e&&t:t:e}var tI;let zt=tI=class extends Ls.EventedMixin(jD(Ue)){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.handles=new Ey,this.updatingHandles=new f_,this.allLayerViews=new FL({getCollections:()=>{var e,i,r;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(i=this.groundView)==null?void 0:i.layerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:Lct}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new D3,this.analyses=new MP,this.typeSpecificPreconditionsReady=!0,this.layerViews=new Ke,this.magnifier=new yRe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Pct,this.navigation=new PRe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new lct(this),this.persistableViewModels=new Ke,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this.theme=null,this.handles.add(te(()=>this.preconditionsReady,e=>{var r,s;const i=this.ready;if(e?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,tI.views.add(this)):(this._lockedSpatialReference=null,tI.views.remove(this)),this.notifyChange("spatialReference"),!e&&i)(r=this.toolViewManager)==null||r.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),(s=this.layerViewManager)==null||s.clear(),this._teardown();else if(e&&!i){try{this._startup()}catch(n){return void queueMicrotask(()=>{this.fatalError=new B("startup-error",null,n)})}this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach()}},lr))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,d2(()=>this.ready)))),this.basemapView=new u1({view:this}),this.layerViewManager=new Zlt({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new ag({view:this}),this._setupSpatialReferenceLogger(),this.selectionManager=new oct({view:this}),this.addHandles([te(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},pr),te(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},lr),te(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},pr)])}_setupSpatialReferenceLogger(){let t=null;this.addHandles([te(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var r;const i=((r=this.map)==null?void 0:r.allLayers.length)>0;if(e&&!this.spatialReference&&i){if(t!=null)return;const s=Gi(()=>t=oc(t));t=My(async n=>{try{await KS(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{t=null}ne.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.addHandles(s,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")},{sync:!0})])}destroy(){var t,e;this.destroyed||(tI.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=He(this.graphics),this.analyses=He(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),He(this.analysisViewManager),this.toolViewManager=He(this.toolViewManager),this.layerViewManager=He(this.layerViewManager),this.selectionManager=He(this.selectionManager),this.basemapView=He(this.basemapView),(t=this.groundView)==null||t.destroy(),(e=this.layerViews)==null||e.forEach(i=>i.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=He(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return ne.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new _s({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:(t,e)=>this.getSpatialReferenceSupport(t,e),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||yy.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&(ne.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),yy.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",t))}get spatialReference(){var e,i;const t=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(t&&((i=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&i.heightModelInfo)){const r=t.clone();return r.vcsWkid=this.defaultsFromMap.vcsWkid,r.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,r}return t}set spatialReference(t){const e=!ms(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??pp}set timeZone(t){const e=new Set(["etc/utc","etc/gmt","gmt"]),i=new Set(Intl.supportedValuesOf("timeZone").map(r=>r.toLowerCase()));this._userTimeZone=t,t===pp||t===QS||e.has(t.toLowerCase())||i.has(t.toLowerCase())||ne.getLogger(this).warn("#timeZone",`the parsed value '${t}' may not be a valid IANA time zone`)}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){var t;return((t=this.toolViewManager)==null?void 0:t.cursor)??this._cursor??"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new JJ}whenLayerView(t){var e;return((e=this.layerViewManager)==null?void 0:e.whenLayerView(t))??Promise.reject()}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}getDefaultTimeZone(){return null}importLayerView(t){throw new B("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport(t)!=null}when(t,e){return this.isResolved()&&!this.ready&&ne.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(jo(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};zt.views=new Ke,h([p()],zt.prototype,"_userSpatialReference",void 0),h([p()],zt.prototype,"activeTool",null),h([p({readOnly:!0})],zt.prototype,"allLayerViews",void 0),h([p()],zt.prototype,"groundView",void 0),h([p()],zt.prototype,"animation",null),h([p()],zt.prototype,"basemapView",void 0),h([p()],zt.prototype,"center",null),h([p({readOnly:!0})],zt.prototype,"_defaultsFromMapSettings",null),h([p()],zt.prototype,"defaultsFromMap",null),h([p()],zt.prototype,"fatalError",void 0),h([p({type:dr})],zt.prototype,"extent",null),h([p(cX(D3,"graphics"))],zt.prototype,"graphics",void 0),h([p(cX(MP,"analyses"))],zt.prototype,"analyses",void 0),h([p({readOnly:!0,type:gw})],zt.prototype,"heightModelInfo",null),h([p({readOnly:!0})],zt.prototype,"interacting",null),h([p({readOnly:!0})],zt.prototype,"navigating",null),h([p({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],zt.prototype,"preconditionsReady",null),h([p({readOnly:!0})],zt.prototype,"typeSpecificPreconditionsReady",void 0),h([p({type:Ke,readOnly:!0})],zt.prototype,"layerViews",void 0),h([p()],zt.prototype,"resolution",null),h([p({type:yRe})],zt.prototype,"magnifier",void 0),h([p({value:null,type:kMe})],zt.prototype,"map",null),h([p()],zt.prototype,"padding",void 0),h([p({readOnly:!0})],zt.prototype,"ready",void 0),h([p({type:Ye})],zt.prototype,"spatialReference",null),h([p()],zt.prototype,"spatialReferenceWarningDelay",void 0),h([p()],zt.prototype,"stationary",null),h([p({readOnly:!0})],zt.prototype,"supportsGround",void 0),h([p({type:za})],zt.prototype,"timeExtent",void 0),h([p({type:String,nonNullable:!0})],zt.prototype,"timeZone",null),h([p()],zt.prototype,"tools",null),h([p()],zt.prototype,"toolViewManager",void 0),h([p({readOnly:!0})],zt.prototype,"type",void 0),h([p({type:Number})],zt.prototype,"scale",void 0),h([p({readOnly:!0})],zt.prototype,"updating",void 0),h([p({readOnly:!0})],zt.prototype,"initialExtentRequired",void 0),h([p({readOnly:!0})],zt.prototype,"initialExtent",null),h([p()],zt.prototype,"cursor",null),h([p({readOnly:!0})],zt.prototype,"input",void 0),h([p({type:PRe,nonNullable:!0})],zt.prototype,"navigation",void 0),h([p()],zt.prototype,"layerViewManager",void 0),h([p()],zt.prototype,"analysisViewManager",void 0),h([p()],zt.prototype,"selectionManager",void 0),h([p()],zt.prototype,"width",void 0),h([p()],zt.prototype,"height",void 0),h([p({readOnly:!0})],zt.prototype,"resizing",void 0),h([p({value:null,readOnly:!0})],zt.prototype,"size",null),h([p({readOnly:!0})],zt.prototype,"suspended",void 0),h([p({readOnly:!0})],zt.prototype,"viewEvents",void 0),h([p({readOnly:!0})],zt.prototype,"persistableViewModels",void 0),h([p()],zt.prototype,"_isValid",void 0),h([p()],zt.prototype,"_readyCycleForced",void 0),h([p()],zt.prototype,"_lockedSpatialReference",void 0),h([p()],zt.prototype,"_userTimeZone",void 0),h([p()],zt.prototype,"_lockedTimeZone",void 0),h([p({type:JJ})],zt.prototype,"theme",void 0),h([p({readOnly:!0,type:JJ})],zt.prototype,"effectiveTheme",null),zt=tI=h([I("esri.views.View")],zt);const Ict=zt;function Lct(t){return t.layerViews}let d1=class extends Lz{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=ma(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._resolver)==null||e.reject(new B("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._resolver)==null||e.resolve())}update(e,i){i||(i=Zu(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",i)}};h([p({readOnly:!0})],d1.prototype,"done",null),h([p({readOnly:!0,type:String})],d1.prototype,"state",void 0),h([p()],d1.prototype,"target",void 0),d1=h([I("esri.views.ViewAnimation")],d1),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(d1||(d1={}));const FP=d1,T$=()=>oe(()=>import("./TileLayerView3D-DKrGK8F5.js"),__vite__mapDeps([73,74,75,76,77,78,79,80,81,82,83])),ffe=()=>oe(()=>import("./ElevationLayerView3D-CJBO-Rw9.js"),__vite__mapDeps([84,4,5,74,75,77])),mfe={"base-dynamic":()=>oe(()=>import("./BaseDynamicLayerView3D-BT7qvJ6g.js"),__vite__mapDeps([85,86,74,87,88,77,78])),"base-elevation":ffe,"base-tile":T$,"bing-maps":T$,"building-scene":()=>oe(()=>import("./BuildingSceneLayerView3D-CcD3Z1LX.js"),__vite__mapDeps([89,90,91,92,93,94,61,53,83,26,27,95,96,97,98,60,99,100,101,35,102,103,104,105,106,107,87,108,109,72,110,111,29,23,24,80,25,18,28,12,13,14,21,22,74,5,112,77,78,113,114,115,59,116,117,118])),catalog:()=>oe(()=>import("./CatalogLayerView3D-B9HwRA5o.js"),__vite__mapDeps([119,74,77])),"catalog-dynamic-group":()=>oe(()=>import("./CatalogDynamicGroupLayerView3D-BtLTCOVl.js"),__vite__mapDeps([120,74,77])),"catalog-footprint":()=>oe(()=>import("./CatalogFootprintLayerView3D-_d6Iza29.js"),__vite__mapDeps([121,105,106,107,87,108,109,72,110,111,29,23,24,83,80,25,26,27,18,28,12,13,14,21,22,74,5,112,77,78])),csv:()=>oe(()=>import("./CSVLayerView3D-RA9GcXAs.js"),__vite__mapDeps([122,105,106,107,87,108,109,72,110,111,29,23,24,83,80,25,26,27,18,28,12,13,14,21,22,74,5,112,77,78])),dimension:()=>oe(()=>import("./DimensionLayerView3D-DZp92uoi.js"),__vite__mapDeps([123,74,77])),elevation:ffe,feature:()=>oe(()=>import("./FeatureLayerView3D-BrE5ODgc.js"),__vite__mapDeps([104,105,106,107,87,108,109,72,110,111,29,23,24,83,80,25,26,27,18,28,12,13,14,21,22,74,5,112,77,78])),geojson:()=>oe(()=>import("./GeoJSONLayerView3D-yKhmtrRn.js"),__vite__mapDeps([124,105,106,107,87,108,109,72,110,111,29,23,24,83,80,25,26,27,18,28,12,13,14,21,22,74,5,112,77,78])),graphics:()=>oe(()=>import("./GraphicsLayerView3D-DR1mxRK_.js"),__vite__mapDeps([125,74,109,126,110,111,29,23,24,83,87,77])),group:()=>oe(()=>import("./GroupLayerView-BS7FRsxo.js"),__vite__mapDeps([127,77])),imagery:()=>oe(()=>import("./ImageryLayerView3D-TAPRUDQk.js"),__vite__mapDeps([128,86,74,87,88,77,78,107,83])),"integrated-mesh":()=>oe(()=>import("./IntegratedMeshLayerView3D-C5ZVBigS.js"),__vite__mapDeps([129,95,96,97,98,60,61,53,99,100,101,35,102,103,104,105,106,107,87,108,109,72,110,111,29,23,24,83,80,25,26,27,18,28,12,13,14,21,22,74,5,112,77,78,113,114,115,59,116])),"integrated-mesh-3dtiles":()=>oe(()=>import("./IntegratedMesh3DTilesLayerView3D-9vMZKfbW.js"),__vite__mapDeps([130,96,97,68,74,77])),"line-of-sight":()=>oe(()=>import("./LineOfSightLayerView3D-CMhjFV2-.js"),__vite__mapDeps([131,74,77])),"map-image":()=>oe(()=>import("./MapImageLayerView3D-CeZba1Gt.js"),__vite__mapDeps([132,86,74,87,88,77,78,133,80,82,107,79,81,83])),media:()=>oe(()=>import("./MediaLayerView3D-vpjNPUsG.js").then(t=>t.M),__vite__mapDeps([134,135,136,74,137,138,139,140,17,141,142,80,88,77])),"ogc-feature":()=>oe(()=>import("./OGCFeatureLayerView3D-CqHnybnL.js"),__vite__mapDeps([143,105,106,107,87,108,109,72,110,111,29,23,24,83,80,25,26,27,18,28,12,13,14,21,22,74,5,112,77,78])),"open-street-map":T$,"oriented-imagery":()=>oe(()=>import("./FeatureLayerView3D-BrE5ODgc.js"),__vite__mapDeps([104,105,106,107,87,108,109,72,110,111,29,23,24,83,80,25,26,27,18,28,12,13,14,21,22,74,5,112,77,78])),"point-cloud":()=>oe(()=>import("./PointCloudLayerView3D-DUjDVY4D.js"),__vite__mapDeps([144,74,5,61,53,51,52,145,83,77])),voxel:()=>oe(()=>import("./VoxelLayerView3D-BPxig9Ek.js"),__vite__mapDeps([146,74,145,83,77])),route:()=>oe(()=>import("./RouteLayerView3D-zzUahcDq.js"),__vite__mapDeps([147,148,74,126,110,111,29,23,24,83,87,112,77])),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?oe(()=>import("./SceneLayerView3D-Q0rRrQsP.js"),__vite__mapDeps([149,26,27,80,95,96,97,98,60,61,53,99,100,101,35,102,103,104,105,106,107,87,108,109,72,110,111,29,23,24,83,25,18,28,12,13,14,21,22,74,5,112,77,78,113,114,115,59,116,150,118,117,145])):oe(()=>import("./SceneLayerGraphicsView3D-DSHslhm4.js"),__vite__mapDeps([151,98,97,60,61,53,99,100,101,35,102,103,104,105,106,107,87,108,109,72,110,111,29,23,24,83,80,25,26,27,18,28,12,13,14,21,22,74,5,112,77,78,150,118,145])),stream:()=>oe(()=>import("./StreamLayerView3D-BhKtYqL6.js"),__vite__mapDeps([152,48,49,112,106,107,87,108,109,72,110,111,29,23,24,83,80,25,26,27,18,28,12,13,14,21,22,74,77])),tile:T$,"imagery-tile":()=>oe(()=>import("./ImageryTileLayerView3D-D31I1aPj.js"),__vite__mapDeps([153,58,74,75,107,83,77,78,81])),"vector-tile":()=>oe(()=>import("./VectorTileLayerView3D-DkZ0cWJk.js"),__vite__mapDeps([154,46,45,155,66,74,75,77])),wcs:()=>oe(()=>import("./ImageryTileLayerView3D-D31I1aPj.js"),__vite__mapDeps([153,58,74,75,107,83,77,78,81])),"web-tile":T$,wfs:()=>oe(()=>import("./WFSLayerView3D-ChKjZjXJ.js"),__vite__mapDeps([156,105,106,107,87,108,109,72,110,111,29,23,24,83,80,25,26,27,18,28,12,13,14,21,22,74,5,112,77,78])),wms:()=>oe(()=>import("./WMSLayerView3D-C69qr5oF.js"),__vite__mapDeps([157,86,74,87,88,77,78,158,107])),wmts:()=>oe(()=>import("./WMTSLayerView3D-0enyxpSd.js"),__vite__mapDeps([159,74,75,76,77,78])),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function Dct(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new B(`${i}:view-not-supported`,`${e} is not supported in 3D`)}const gfe={hasLayerViewModule:t=>mfe[t.type]!=null,importLayerView:t=>{const e=mfe[t.type];if(e==null)throw Dct(t);return e(t)}},yfe="analyses-owner-handles";var VM,zT;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(VM||(VM={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(zT||(zT={}));let iT=class extends Ue{constructor(e){super(e),this._allAnalysisViews=new Ke,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=_fe(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null},viewshed:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(Ui("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(Ui()),this._attachedToViewResolver=_fe()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const i=this._items.get(e);if(i==null||i.state.list===zT.REMOVED)throw new B("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return i.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),yfe)}_disconnectOwners(){this.removeHandles(yfe),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const s of e)this._addAnalysis(s);const i=e.on("after-add",s=>this._addAnalysis(s.item)),r=e.on("after-remove",s=>this._removeAnalysis(s.item));return Gi(()=>{i.remove(),r.remove();for(const s of e)this._removeAnalysis(s)})}_addAnalysis(e){const i=this._items.get(e);if(i==null){const r={state:{view:VM.PENDING,list:zT.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=My(s=>this._createAnalysisViewPromise(r,s))}else i.state.list=zT.ADDED}_removeAnalysis(e){const i=this._items.get(e);i!=null?(i.state.list=zT.REMOVED,this._scheduleUpdate()):ne.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=k2(()=>this._update()))}_update(){this._scheduledUpdateHandle=Lr(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===zT.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case VM.PENDING:e.createAnalysisViewTask=oc(e.createAnalysisViewTask);break;case VM.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=He(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,i){const r=e.analysis,s=r.type,n=this._analysisModules[s];if(this._creatingViewCount+=1,n.module==null)try{n.module=await this._loadAnalysisModule(s)}catch(a){throw this._creatingViewCount-=1,a}if(ha(i))throw this._creatingViewCount-=1,Ui("AnalysisView creation aborted");const o=new n.module.default({analysis:r,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(ha(i))throw this._creatingViewCount-=1,o.destroy(),Ui("AnalysisView creation aborted");return e.view=o,e.state.view=VM.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return oe(()=>import("./AreaMeasurementAnalysisView3D-Bpq_R2RB.js"),__vite__mapDeps([160,161,162,163,164,140,17,141,139,165,166,142,167,168]));case"dimension":return oe(()=>import("./DimensionAnalysisView3D-2UYE7Ww2.js"),__vite__mapDeps([169,163,170,162,167,168,139,140,17,141,171,172,155,173,174,175,176,138,142,80,137,177,178,166,108,179,88,180,181,182,183,165]));case"direct-line-measurement":return oe(()=>import("./DirectLineMeasurementAnalysisView3D-CsV-XZtf.js"),__vite__mapDeps([184,161,162,163,165,139,140,17,141,167,168,176,173]));case"line-of-sight":return oe(()=>import("./LineOfSightAnalysisView3D-CoCJuoJH.js"),__vite__mapDeps([185,163,186,114,115,165,178,166,142,187,174,168,182,175]));case"slice":return oe(()=>import("./SliceAnalysisView3D-4ZgduRaH.js"),__vite__mapDeps([188,163,189,190,178,166,142,88,114,115,165,168,91,92,93,94,61,53,83,181,179,182,183]));case"viewshed":return oe(()=>import("./ViewshedAnalysisView3D-kJKgxSo5.js"),__vite__mapDeps([191,163,140,17,141,178,166,142,179,168,190,192,172,155,173,174,182,137,183]))}}};function _fe(){const t=ma();return t.promise.catch(()=>{}),t}h([p()],iT.prototype,"updating",null),h([p({constructOnly:!0})],iT.prototype,"view",void 0),h([p()],iT.prototype,"_allAnalysisViews",void 0),h([p()],iT.prototype,"_creatingViewCount",void 0),iT=h([I("esri.views.3d.analysis.AnalysisViewManager3D")],iT);const Nct=iT;let T0=class extends Ue{constructor(e){super(e),this.collision=new iI,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Je.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Je.Local?this._set("altitude",e):ne.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?Ne(e,this.altitude.min,this.altitude.max):e}clampTilt(e,i){if(!this.tilt)return i;const r=this.tilt(e);return Ne(i,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Je.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(i,r=hq)=>(r.min=Ia.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?sU([[4e3,Ia.max],[1e4,kt(88)],[6e6,kt(88)]]):()=>Ia.max;return(i,r=hq)=>(r.min=Ia.min,r.max=e(i),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?sU([[4e3,Ia.max],[5e4,kt(88)],[6e6,kt(88)],[2e7,Ia.min]]):sU([[3e5,Ia.max],[3e6,kt(88)],[6e6,kt(88)],[2e7,Ia.min]]);return(i,r=hq)=>(r.min=Ia.min,r.max=e(i),r)}};function Fct(t){return{min:-2e5,max:4*t.radius}}h([p()],T0.prototype,"altitude",null),h([p({readOnly:!0})],T0.prototype,"collision",void 0),h([p()],T0.prototype,"distance",void 0),h([p({readOnly:!0})],T0.prototype,"minimumPoiDistance",void 0),h([p()],T0.prototype,"tilt",void 0),h([p({constructOnly:!0})],T0.prototype,"mode",void 0),T0=h([I("esri.views.3d.state.Constraints")],T0);const vfe=Fct(ur),Ia={min:kt(.5),max:kt(179.5)},hq={min:0,max:0};let iI=class extends Ue{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};h([p({type:Boolean})],iI.prototype,"enabled",void 0),h([p({type:Number})],iI.prototype,"elevationMargin",void 0),iI=h([I("esri.views.3d.state.Constraints.CollisionConstraint")],iI);let zM=class extends p2{constructor(){super(...arguments),this.min=vfe.min,this.max=vfe.max}};h([p({type:Number})],zM.prototype,"min",void 0),h([p({type:Number})],zM.prototype,"max",void 0),zM=h([I("esri.views.3d.constraints.AltitudeConstraint")],zM);let G0=class extends p2{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,i){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==i&&this._set("far",i))}};h([p({type:Number,value:1e-8})],G0.prototype,"near",null),h([Qt("near")],G0.prototype,"castNear",null),h([p({type:Number,value:1e-8})],G0.prototype,"far",null),h([Qt("far")],G0.prototype,"castFar",null),h([p({type:["auto","manual"]})],G0.prototype,"mode",void 0),G0=h([I("esri.views.3d.constraints.ClipDistanceConstraint")],G0);const eQ={min:ja(Ia.min),max:ja(Ia.max)};let BT=class extends p2{constructor(e){super(e),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return Ne(e,eQ.min,eQ.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};h([p({type:["auto","manual"]})],BT.prototype,"mode",void 0),h([p({type:Number,value:eQ.max})],BT.prototype,"max",null),h([Qt("max")],BT.prototype,"castMax",null),BT=h([I("esri.views.3d.constraints.TiltConstraint")],BT);let jT=class extends p2{constructor(){super(...arguments),this.tilt=new BT,this.altitude=new zM,this.clipDistance=new G0}};h([p({type:BT})],jT.prototype,"tilt",void 0),h([p({type:zM})],jT.prototype,"altitude",void 0),h([p({type:G0})],jT.prototype,"clipDistance",void 0),jT=h([I("esri.views.3d.constraints.Constraints")],jT);var WC;let p1=WC=class extends Ls.EventedMixin(f2){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),i=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new WC(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const i=WC.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let r=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const s=WC.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==s&&(XF.target=this,XF.timezoneOffset=s,this.emit("timezone-will-change",XF),XF.target=null),t!=null)return isNaN(t.getTime())||r!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new WC({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};h([p({type:Boolean})],p1.prototype,"cameraTrackingEnabled",void 0),h([p({type:Date})],p1.prototype,"defaultDate",null),h([p({type:Date})],p1.prototype,"date",null),p1=WC=h([I("esri.views.3d.environment.SunLighting")],p1),function(t){function e({hours:i,minutes:r,seconds:s}){return Math.round(i+r/60+s/3600)}t.calculateTimezoneOffset=e}(p1||(p1={}));const XF={target:null,timezoneOffset:0},rT=p1;var LU;let DU=LU=class extends Ls.EventedMixin(JD){constructor(t){super(t),this.cameraTrackingEnabled=!0}clone(){return new LU({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new LU(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};h([p({type:Boolean})],DU.prototype,"cameraTrackingEnabled",void 0),DU=LU=h([I("esri.views.3d.environment.VirtualLighting")],DU);const rI=DU,kct={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:rT,virtual:rI}};var tQ;let F3=tQ=class extends Ue{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new tQ({quality:this.quality})}};h([p({type:["low","high"],value:"low"})],F3.prototype,"quality",null),F3=tQ=h([I("esri.views.3d.environment.SceneViewAtmosphere")],F3);var sI;let ZC=sI=class extends TP{constructor(t){super(t),this.atmosphere=new F3,this.lighting=this.castLighting(),this.cachedCameraTrackingEnabled=null}destroy(){this.atmosphere.destroy()}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new sI({...e,lighting:e.lighting?e.lighting.type==="virtual"?rI.fromWebsceneLighting(e.lighting):rT.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLightingWithDestroy(t)}applyLighting(t){this.lighting=this._convertLightingWithDestroy(t)}_convertLightingWithDestroy(t){const e=this._convertLighting(t);return e!==t&&this.addHandles(gSe(e)),e}_convertLighting(t){var e,i;return t?t instanceof rT||t instanceof rI?t:t instanceof f2?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new rT({...t.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):t instanceof JD?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new rI({...t.cloneConstructProperties(),...(i=this.lighting)==null?void 0:i.cloneNonPersistentConstructProperties()}):om(kct,t):new rT}clone(){return new sI({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:re(this.background)})}cloneWithWebsceneEnvironment(t){return new sI({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:re(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):rT.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):rI.fromWebsceneLighting(t.lighting);default:return t.lighting,rT.fromWebsceneLighting(t.lighting)}}};h([p({type:F3,json:{read:!1},nonNullable:!0})],ZC.prototype,"atmosphere",void 0),h([p({nonNullable:!0})],ZC.prototype,"lighting",void 0),h([Qt("lighting")],ZC.prototype,"castLighting",null),ZC=sI=h([I("esri.views.3d.environment.SceneViewEnvironment")],ZC);const YC=ZC;function Uct(t,e){return{type:n2(e),value:t,unit:e}}function wJt(t){return{value:t}}function m_(t,e){return{type:n2(e),value:t,unit:e}}function Vct(t,e){return{type:n2(e),value:t,unit:e}}function E6(t,e,i="arithmetic"){return{type:n2(e),value:t,unit:e,rotationType:i}}function zct(t,e){const i=Bct(t,e);return t.type==="angle"?E6(i,e,t.rotationType):Uct(i,e)}function Bct(t,e){return Br(t.value,t.unit,e)}function xJt(t,e){return t==null?e:e==null||t.value>Br(e.value,e.unit,t.unit)?t:e}function TJt(t,e){return t==null?null:{...t,value:t.value*e}}function jct(t,e,i){if(e===i)return t;switch(i){case"arithmetic":case"geographic":return 90-t}}const SJt=m_(0,"meters"),EJt=Vct(0,"square-meters");E6(0,"radians");const CJt=E6(0,"degrees"),MJt=E6(0,"degrees","geographic");var rl;(function(t){t[t.Realistic=0]="Realistic",t[t.Local=1]="Local",t[t.Mars=2]="Mars",t[t.None=3]="None"})(rl||(rl={}));function $Re(t){return"r"in t&&"g"in t&&"b"in t}function RRe(t){return"h"in t&&"s"in t&&"v"in t}function IRe(t){return"l"in t&&"a"in t&&"b"in t}function LRe(t){return"l"in t&&"c"in t&&"h"in t}function Gct(t){return"x"in t&&"y"in t&&"z"in t}const Hct=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],qct=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function DRe(t,e){const i=[];let r,s;if(t[0].length!==e.length)throw new Error("dimensions do not match");const n=t.length,o=t[0].length;let a=0;for(r=0;r<n;r++){for(a=0,s=0;s<o;s++)a+=t[r][s]*e[s];i.push(a)}return i}function NRe(t){const e=[t.r/255,t.g/255,t.b/255].map(r=>r<=.04045?r/12.92:((r+.055)/1.055)**2.4),i=DRe(Hct,e);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function Lne(t){const e=DRe(qct,[t.x/100,t.y/100,t.z/100]).map(i=>{const r=i<=.0031308?12.92*i:1.055*i**.4166666666666667-.055;return Math.min(1,Math.max(r,0))});return{r:Math.round(255*e[0]),g:Math.round(255*e[1]),b:Math.round(255*e[2])}}function FRe(t){const e=[t.x/95.047,t.y/100,t.z/108.883].map(i=>i>.008856451679035631?i**.3333333333333333:7.787037037037035*i+.13793103448275862);return{l:116*e[1]-16,a:500*(e[0]-e[1]),b:200*(e[1]-e[2])}}function kRe(t){const e=t.l,i=[(e+16)/116+t.a/500,(e+16)/116,(e+16)/116-t.b/200].map(r=>r>6/29?r**3:3*(6/29)**2*(r-4/29));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function Wct(t){const e=t.l,i=t.a,r=t.b,s=Math.sqrt(i*i+r*r);let n=Math.atan2(r,i);return n=n>0?n:n+2*Math.PI,{l:e,c:s,h:n}}function Zct(t){const e=t.l,i=t.c,r=t.h;return{l:e,a:i*Math.cos(r),b:i*Math.sin(r)}}function Yct(t){return FRe(NRe(t))}function Xct(t){return Lne(kRe(t))}function Jct(t){return Wct(FRe(NRe(t)))}function Qct(t){return Lne(kRe(Zct(t)))}function Kct(t){const e=t.r,i=t.g,r=t.b,s=Math.max(e,i,r),n=s-Math.min(e,i,r);let o=s,a=n===0?0:s===e?(i-r)/n%6:s===i?(r-e)/n+2:(e-i)/n+4,l=n===0?0:n/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}function eut(t){const e=(t.h+360)%360/60,i=t.s/100,r=t.v/100*255,s=r*i,n=s*(1-Math.abs(e%2-1));let o;switch(Math.floor(e)){case 0:o={r:s,g:n,b:0};break;case 1:o={r:n,g:s,b:0};break;case 2:o={r:0,g:s,b:n};break;case 3:o={r:0,g:n,b:s};break;case 4:o={r:n,g:0,b:s};break;case 5:case 6:o={r:s,g:0,b:n};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+r-s),o.g=Math.round(o.g+r-s),o.b=Math.round(o.b+r-s),o}function iE(t){return $Re(t)?t:LRe(t)?Qct(t):IRe(t)?Xct(t):Gct(t)?Lne(t):RRe(t)?eut(t):t}function C6(t){return RRe(t)?t:Kct(iE(t))}function tut(t){return IRe(t)?t:Yct(iE(t))}function AJt(t){return LRe(t)?t:Jct(iE(t))}function iut(t){let{r:e,g:i,b:r,a:s}=t;return s<1&&(e=Math.round(s*e+255*(1-s)),i=Math.round(s*i+255*(1-s)),r=Math.round(s*r+255*(1-s))),new je({r:e,g:i,b:r})}function rut(t,e){const{r:i,g:r,b:s}=e!=null&&e.ignoreAlpha?t:iut(t);return .2126*i+.7152*r+.0722*s}var iQ;function PJt(t,e=iQ.High){return rut(t,{ignoreAlpha:!0})>e?new je([0,0,0,t.a]):new je([255,255,255,t.a])}function OJt(t,e){const i=tut(t);i.l*=1-e;const r=iE(i),s=t.clone();return s.setColor(r),s.a=t.a,s}function $Jt(t,e){const i=t.clone();return i.a*=e,i}function RJt(t,e){const i=C6(t);i.s*=e;const r=iE(i),s=t.clone();return s.setColor(r),s.a=t.a,s}function XL(t){return je.toUnitRGBA(t)}function IJt(t,e){return t===e||t!=null&&e!=null&&y2(t,e)}function LJt(t){return ri(t[0],t[1],t[2],t.length>3?t[3]:1)}function DJt(t,e){const i=je.toUnitRGBA(t);return i[3]*=e,i}(function(t){t[t.Low=160]="Low",t[t.High=225]="High"})(iQ||(iQ={}));function Ga(t,e){return t[0]=e[0],t[1]=e[1],t}function Di(t,e,i){return t[0]=e,t[1]=i,t}function Tf(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function Ng(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function URe(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function VRe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function sut(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function nut(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function out(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t}function aut(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t}function lut(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Rh(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function cut(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t}function Kb(t,e){const i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)}function wB(t,e){const i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function Dne(t){const e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function zRe(t){const e=t[0],i=t[1];return e*e+i*i}function BRe(t,e){return t[0]=-e[0],t[1]=-e[1],t}function uut(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function JL(t,e){const i=e[0],r=e[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t}function Wn(t,e){return t[0]*e[0]+t[1]*e[1]}function hut(t,e,i){const r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t}function Xd(t,e,i,r){const s=e[0],n=e[1];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t}function dut(t,e){e=e||1;const i=2*WD()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t}function jRe(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s,t[1]=i[1]*r+i[3]*s,t}function put(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s+i[4],t[1]=i[1]*r+i[3]*s+i[5],t}function fut(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[3]*s+i[6],t[1]=i[1]*r+i[4]*s+i[7],t}function mut(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[4]*s+i[12],t[1]=i[1]*r+i[5]*s+i[13],t}function gut(t,e,i,r){const s=e[0]-i[0],n=e[1]-i[1],o=Math.sin(r),a=Math.cos(r);return t[0]=s*a-n*o+i[0],t[1]=s*o+n*a+i[1],t}function yut(t,e){const i=t[0],r=t[1],s=e[0],n=e[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(i*s+r*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function _ut(t){return"vec2("+t[0]+", "+t[1]+")"}function GRe(t,e){return t[0]===e[0]&&t[1]===e[1]}function HRe(t,e){const i=t[0],r=t[1],s=e[0],n=e[1],o=Bo();return Math.abs(i-s)<=o*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-n)<=o*Math.max(1,Math.abs(r),Math.abs(n))}function vut(t,e,i,r,s){let n=e[0]-i[0],o=e[1]-i[1];const a=(r[0]*n+r[1]*o)*(s-1);return n=r[0]*a,o=r[1]*a,t[0]=e[0]+n,t[1]=e[1]+o,t}const but=Dne,wut=Ng,xut=URe,Tut=VRe,qRe=Kb,Sut=wB,Eut=zRe;Object.freeze(Object.defineProperty({__proto__:null,add:Tf,angle:yut,ceil:sut,copy:Ga,cross:hut,dist:qRe,distance:Kb,div:Tut,divide:VRe,dot:Wn,equals:HRe,exactEquals:GRe,floor:nut,inverse:uut,len:but,length:Dne,lerp:Xd,max:aut,min:out,mul:xut,multiply:URe,negate:BRe,normalize:JL,projectAndScale:vut,random:dut,rotate:gut,round:lut,scale:Rh,scaleAndAdd:cut,set:Di,sqrDist:Sut,sqrLen:Eut,squaredDistance:wB,squaredLength:zRe,str:_ut,sub:wut,subtract:Ng,transformMat2:jRe,transformMat2d:put,transformMat3:fut,transformMat4:mut},Symbol.toStringTag,{value:"Module"}));function Nne(t){return Ne((t-1e5)/9e5,0,1)}const rQ=1e4,Cut=.085,k1=1e5;let Mut=class{};const Ur=Mut;function S(t,...e){let i="";for(let r=0;r<e.length;r++)i+=t[r]+e[r];return i+=t[t.length-1],i}(function(t){function e(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}t.int=e,t.float=i})(S||(S={}));var $;function Aut(t){return t===$.POSITION}(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.PERSPECTIVEDIVIDE="perspectiveDivide",t.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance",t.LENGTH="length",t.PREVPOSITION="prevPosition",t.NEXTPOSITION="nextPosition",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.INSTANCEMODELORIGINHI="instanceModelOriginHi",t.INSTANCEMODELORIGINLO="instanceModelOriginLo",t.INSTANCEMODEL="instanceModel",t.INSTANCEMODELNORMAL="instanceModelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMAL2COMPRESSED="normal2Compressed",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})($||($={}));var Es;function Hf(t,e){switch(e.textureCoordinateType){case Es.Default:return t.attributes.add($.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(S`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case Es.Compressed:return t.attributes.add($.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(S`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case Es.Atlas:return t.attributes.add($.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add($.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(S`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case Es.None:return void t.vertex.code.add(S`void forwardTextureCoordinates() {}`);case Es.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(Es||(Es={}));function vm(t){t.code.add(S`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}var Yi;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(Yi||(Yi={}));let qs=class{constructor(e,i,r,s,n=null){if(this.name=e,this.type=i,this.arraySize=n,this.bind={[Yi.Pass]:null,[Yi.Draw]:null},s)switch(r){case Yi.Pass:this.bind[Yi.Pass]=s;break;case Yi.Draw:this.bind[Yi.Draw]=s}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},Hr=class extends qs{constructor(e,i){super(e,"vec2",Yi.Pass,(r,s,n)=>r.setUniform2fv(e,i(s,n)))}};function Fne(t){t.include(vm),t.code.add(S`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromRGBA(vec4 depth, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(depth), nearFar);
}
float linearDepthFromTexture(sampler2D depthTexture, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
return linearDepthFromRGBA(texelFetch(depthTexture, iuv, 0), nearFar);
}`)}function $y(t){t.uniforms.add(new Hr("zProjectionMap",(e,i)=>Put(i.camera))),t.code.add(S`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`),t.code.add(S`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`),t.code.add(S`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)}function Put(t){const e=t.projectionMatrix;return Di(Out,e[14],e[10])}const Out=gt();function M6(t){t.fragment.code.add(S`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}let Wt=class extends qs{constructor(e,i){super(e,"vec3",Yi.Pass,(r,s,n)=>r.setUniform3fv(e,i(s,n)))}};function q_(t){t.uniforms.add(new Wt("mainLightDirection",(e,i)=>i.lighting.mainLight.direction))}function Ry(t){t.uniforms.add(new Wt("mainLightIntensity",(e,i)=>i.lighting.mainLight.intensity))}function xB(t){q_(t.fragment),Ry(t.fragment),t.fragment.code.add(S`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let ji=class extends qs{constructor(e,i){super(e,"vec4",Yi.Pass,(r,s,n)=>r.setUniform4fv(e,i(s,n)))}},tt=class extends qs{constructor(e,i){super(e,"float",Yi.Pass,(r,s,n)=>r.setUniform1f(e,i(s,n)))}},fs=class extends qs{constructor(e,i){super(e,"mat4",Yi.Pass,(r,s,n)=>r.setUniformMatrix4fv(e,i(s,n)))}};const Rl=ci();let $ut=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function bt(t,e){if(!t){e=e||"Assertion";const i=new Error(e).stack;throw new $ut(`${e} at ${i}`)}}function TE(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function WRe(t,e,i,r){let s,n=(i[0]-t[0])/e[0],o=(r[0]-t[0])/e[0];n>o&&(s=n,n=o,o=s);let a=(i[1]-t[1])/e[1],l=(r[1]-t[1])/e[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(i[2]-t[2])/e[2],u=(r[2]-t[2])/e[2];return c>u&&(s=c,c=u,u=s),!(n>u||c>o)&&(u<o&&(o=u),!(o<0))}function JF(t,e,i,r,s,n=gt()){const o=(r[s]-i[s])*(e[0]-t[0])-(r[0]-i[0])*(e[s]-t[s]),a=(r[0]-i[0])*(t[s]-i[s])-(r[s]-i[s])*(t[0]-i[0]);if(o===0)return!1;const l=a/o;return n[0]=t[0]+l*(e[0]-t[0]),n[1]=t[s]+l*(e[s]-t[s]),!0}function bfe(t,e,i,r,s){Rl[0]=t[0],Rl[1]=t[1],Rl[2]=t[2],Rl[3]=1,Vu(Rl,Rl,e),s.length>2&&(s[2]=-Rl[2]),Vu(Rl,Rl,i),bt(Rl[3]!==0),s[0]=Rl[0]/Rl[3],s[1]=Rl[1]/Rl[3],s[2]=Rl[2]/Rl[3],s[0]=(.5*s[0]+.5)*r[2]+r[0],s[1]=(.5*s[1]+.5)*r[3]+r[1]}function Rut(t,e){return Math.log(t)/Math.log(e)}function Iut(t,e,i,r){t[12]=e,t[13]=i,t[14]=r}function ZRe(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}const Lut=()=>ne.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let YRe=class{constructor(){this._includedModules=new Map}include(e,i){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,i),e(this.builder,i))}},Hi=class extends YRe{constructor(){super(...arguments),this.vertex=new wfe,this.fragment=new wfe,this.attributes=new Fut,this.varyings=new kut,this.extensions=new sQ,this.constants=new XRe,this.outputs=new oQ}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const i=this.extensions.generateSource(e),r=this.attributes.generateSource(e),s=this.varyings.generateSource(e),n=e==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=e==="vertex"?Vut:Uut,c=this.constants.generateSource().concat(n.constants.generateSource()),u=this.outputs.generateSource(e);return`#version 300 es
${i.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${r.join(`
`)}

${s.join(`
`)}

${u.join(`
`)}

${a.join(`
`)}`}generateBindPass(e){const i=new Map;this.vertex.uniforms.entries.forEach(n=>{const o=n.bind[Yi.Pass];o&&i.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{const o=n.bind[Yi.Pass];o&&i.set(n.name,o)});const r=Array.from(i.values()),s=r.length;return(n,o)=>{for(let a=0;a<s;++a)r[a](e,n,o)}}generateBindDraw(e){const i=new Map;this.vertex.uniforms.entries.forEach(n=>{const o=n.bind[Yi.Draw];o&&i.set(n.name,o)}),this.fragment.uniforms.entries.forEach(n=>{const o=n.bind[Yi.Draw];o&&i.set(n.name,o)});const r=Array.from(i.values()),s=r.length;return(n,o,a)=>{for(let l=0;l<s;++l)r[l](e,n,o,a)}}},Dut=class{constructor(e){this._stage=e,this._entries=new Map}add(...e){for(const i of e)this._add(i);return this._stage}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new B(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else Lut().error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},Nut=class{constructor(e){this._stage=e,this._entries=new Array}add(e){return this._entries.push(e),this._stage}generateSource(){return this._entries}},wfe=class extends YRe{constructor(){super(...arguments),this.uniforms=new Dut(this),this.code=new Nut(this),this.constants=new XRe}get builder(){return this}},Fut=class{constructor(){this._entries=new Array}add(e,i){this._entries.push([e,i])}generateSource(e){return e==="fragment"?[]:this._entries.map(i=>`in ${i[1]} ${i[0]};`)}},kut=class{constructor(){this._entries=new Map}add(e,i){this._entries.has(e)&&bt(this._entries.get(e)===i),this._entries.set(e,i)}generateSource(e){const i=new Array;return this._entries.forEach((r,s)=>i.push(e==="vertex"?`out ${r} ${s};`:`in ${r} ${s};`)),i}},sQ=class nQ{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const i=e==="vertex"?nQ.ALLOWLIST_VERTEX:nQ.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}};sQ.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],sQ.ALLOWLIST_VERTEX=[];let oQ=class aQ{constructor(){this._entries=new Map}add(e,i,r=0){const s=this._entries.get(r);s?bt(s.name===e&&s.type===i,`Fragment shader output location ${r} occupied`):this._entries.set(r,{name:e,type:i})}generateSource(e){if(e==="vertex")return[];this._entries.size===0&&this._entries.set(0,{name:aQ.DEFAULT_NAME,type:aQ.DEFAULT_TYPE});const i=new Array;return this._entries.forEach((r,s)=>i.push(`layout(location = ${s}) out ${r.type} ${r.name};`)),i}};oQ.DEFAULT_TYPE="vec4",oQ.DEFAULT_NAME="fragColor";let XRe=class Un{constructor(){this._entries=new Set}add(e,i,r){let s="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":s=Un._numberToFloatStr(r);break;case"int":s=Un._numberToIntStr(r);break;case"bool":s=r.toString();break;case"vec2":s=`vec2(${Un._numberToFloatStr(r[0])},                            ${Un._numberToFloatStr(r[1])})`;break;case"vec3":s=`vec3(${Un._numberToFloatStr(r[0])},                            ${Un._numberToFloatStr(r[1])},                            ${Un._numberToFloatStr(r[2])})`;break;case"vec4":s=`vec4(${Un._numberToFloatStr(r[0])},                            ${Un._numberToFloatStr(r[1])},                            ${Un._numberToFloatStr(r[2])},                            ${Un._numberToFloatStr(r[3])})`;break;case"ivec2":s=`ivec2(${Un._numberToIntStr(r[0])},                             ${Un._numberToIntStr(r[1])})`;break;case"ivec3":s=`ivec3(${Un._numberToIntStr(r[0])},                             ${Un._numberToIntStr(r[1])},                             ${Un._numberToIntStr(r[2])})`;break;case"ivec4":s=`ivec4(${Un._numberToIntStr(r[0])},                             ${Un._numberToIntStr(r[1])},                             ${Un._numberToIntStr(r[2])},                             ${Un._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${i}(${Array.prototype.map.call(r,n=>Un._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${i} ${e} = ${s};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const Uut=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,Vut=`precision highp float;
precision highp sampler2D;`;let xt=class extends qs{constructor(e,i){super(e,"sampler2D",Yi.Pass,(r,s,n)=>r.bindTexture(e,i(s,n)))}};const $A=qe(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),dq=3,pq=qe(dq*parseFloat(65e-8.toFixed(6)),dq*parseFloat(1881e-9.toFixed(6)),dq*parseFloat(85e-9.toFixed(6))),zut=3996e-9,But=qe(parseFloat(Number($A[0]+pq[0]).toFixed(6)),parseFloat(Number($A[1]+pq[1]).toFixed(6)),parseFloat(Number($A[2]+pq[2]).toFixed(6)));function JRe(t){const e=new Hi;e.attributes.add($.POSITION,"vec2"),e.include(Hf,{textureCoordinateType:Es.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=e;return i.uniforms.add(new fs("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new fs("inverseViewMatrix",(s,n)=>fw(jut,n.camera.viewMatrix))),i.code.add(S`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Wt("backgroundColor",s=>s.backgroundColor),new Hr("radii",s=>s.radii),new Wt("cameraPosition",(s,n)=>n.camera.eye),new ji("heightParameters",s=>s.heightParameters),new tt("innerFadeDistance",s=>s.innerFadeDistance),new tt("altitudeFade",s=>s.altitudeFade),new xt("depthTexture",s=>s.depthTexture),new tt("hazeStrength",s=>s.hazeStrength)),r.constants.add("betaRayleigh","vec3",$A),r.constants.add("betaCombined","vec3",But),r.constants.add("betaMie","float",zut),r.constants.add("scaleHeight","float",Cut*k1),q_(r),e.include(M6),t.haze&&r.include($y),r.code.add(S`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(S`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),r.code.add(S`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),r.code.add(S`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?S`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?"":S`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":S`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?S`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:S`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${t.haze?"":S`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${t.haze&&t.reduced?S`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?S`
          float depthSample = texture(depthTexture, vuv0).r;
          if (depthSample != 1.0) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${t.reduced?S`cameraSpaceRay *= -textureBilinear(vuv0);`:S`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:S`${t.reduced?"":S`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${t.haze?S`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != 1.0){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:S`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":S`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),e}const jut=ke(),Gut=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:$A,build:JRe},Symbol.toStringTag,{value:"Module"}));let qi=class{constructor(e,i){this._module=e,this._loadModule=i}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var jr,Mi,Be,$_,Rt,qf,kP,Et,xr,Cs,di,Ai,js,Ht,Tt,Tl,La,hr,Oh,al;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(jr||(jr={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Mi||(Mi={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Be||(Be={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}($_||($_={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER"}(Rt||(Rt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(qf||(qf={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(kP||(kP={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=5131]="HALF_FLOAT"}(Et||(Et={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(xr||(xr={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(Cs||(Cs={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(di||(di={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Ai||(Ai={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(js||(js={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(Ht||(Ht={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(Tt||(Tt={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Tl||(Tl={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(La||(La={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(hr||(hr={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(Oh||(Oh={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(al||(al={}));const fq=33984;var pn,Xn,ho;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.TransformFeedback=7]="TransformFeedback",t[t.Sync=8]="Sync",t[t.UNCOUNTED=9]="UNCOUNTED",t[t.LinesOfCode=9]="LinesOfCode",t[t.Uniform=10]="Uniform",t[t.COUNT=11]="COUNT"})(pn||(pn={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(Xn||(Xn={})),function(t){t[t.NONE=0]="NONE",t[t.BACK=1029]="BACK"}(ho||(ho={}));const UP=33306;var en,xfe,Tfe,Sfe,TB,lQ,Efe;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(en||(en={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(xfe||(xfe={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(Tfe||(Tfe={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(Sfe||(Sfe={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(TB||(TB={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(lQ||(lQ={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(Efe||(Efe={}));let Ki=class{constructor(e,i,r){this.release=r,this.initializeConfiguration(e,i),this._configuration=i.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}destroy(){this._program=Ut(this._program),this._pipeline=this._configuration=null}reload(e){Ut(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return Mi.TRIANGLES}getPipeline(e,i,r){return this._pipeline}initializeConfiguration(e,i){}};const Pi=new Map([[$.POSITION,0],[$.NORMAL,1],[$.NORMALCOMPRESSED,1],[$.UV0,2],[$.COLOR,3],[$.COLORFEATUREATTRIBUTE,3],[$.SIZE,4],[$.TANGENT,4],[$.CENTEROFFSETANDDISTANCE,5],[$.SYMBOLCOLOR,5],[$.FEATUREATTRIBUTE,6],[$.INSTANCEFEATUREATTRIBUTE,6],[$.INSTANCECOLOR,7],[$.OBJECTANDLAYERIDCOLOR,7],[$.INSTANCEOBJECTANDLAYERIDCOLOR,7],[$.INSTANCEMODEL,8],[$.INSTANCEMODELNORMAL,12],[$.INSTANCEMODELORIGINHI,11],[$.INSTANCEMODELORIGINLO,15]]),Hut=()=>ne.getLogger("esri.views.webgl.checkWebGLError");function qut(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const SB=!!ue("enable-feature:webgl-debug");function Sf(){return SB}function cQ(){return SB}function Fg(t){if(Sf()){const e=t.getError();if(e){const i=qut(t,e),r=new Error().stack;Hut().error(new B("webgl-error","WebGL error occurred",{message:i,stack:r}))}}}let er=class{constructor(e,i,r){this._context=e,this._locations=r,this._textures=new Map,this._freeTextureUnits=new ai({deallocator:null}),this._glProgram=e.programCache.acquire(i.generate("vertex"),i.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=i.generateBindPass(this),this.bindDraw=i.generateBindDraw(this),this._fragmentUniforms=Sf()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,i){this._glProgram.setUniform1i(e,i?1:0)}setUniform1i(e,i){this._glProgram.setUniform1i(e,i)}setUniform1f(e,i){this._glProgram.setUniform1f(e,i)}setUniform2fv(e,i){this._glProgram.setUniform2fv(e,i)}setUniform3fv(e,i){this._glProgram.setUniform3fv(e,i)}setUniform4fv(e,i){this._glProgram.setUniform4fv(e,i)}setUniformMatrix3fv(e,i){this._glProgram.setUniformMatrix3fv(e,i)}setUniformMatrix4fv(e,i){this._glProgram.setUniformMatrix4fv(e,i)}setUniform1fv(e,i){this._glProgram.setUniform1fv(e,i)}setUniform1iv(e,i){this._glProgram.setUniform1iv(e,i)}setUniform2iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform3iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform4iv(e,i){this._glProgram.setUniform4iv(e,i)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,i){if((i==null?void 0:i.glName)==null){const s=this._textures.get(e);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(e)),null}let r=this._textures.get(e);return r==null?(r=this._allocTextureUnit(i),this._textures.set(e,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){var e;this._context.useProgram(this),this._textures.forEach((i,r)=>{this._context.bindTexture(i.texture,i.unit),this.setUniform1i(r,i.unit)}),(e=this._fragmentUniforms)==null||e.forEach(i=>{i.type!=="sampler2D"&&i.type!=="samplerCube"||this._textures.has(i.name)||console.error(`Texture sampler ${i.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var Gr,w2,cr,ew,Yc,R_,Ir,rc,g_;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(Gr||(Gr={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(w2||(w2={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(cr||(cr={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(ew||(ew={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Yc||(Yc={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(R_||(R_={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(Ir||(Ir={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(rc||(rc={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(g_||(g_={}));function rd(t,e,i=$_.ADD,r=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function _a(t,e,i,r,s=$_.ADD,n=$_.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:i,dstAlpha:r,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const kne={face:qf.BACK,mode:kP.CCW},QRe={face:qf.FRONT,mode:kP.CCW},A6=t=>t===Gr.Back?kne:t===Gr.Front?QRe:null,Wu={zNear:0,zFar:1},ui={r:!0,g:!0,b:!0,a:!0};function Wut(t){return iht.intern(t)}function Zut(t){return rht.intern(t)}function Yut(t){return sht.intern(t)}function Xut(t){return nht.intern(t)}function Jut(t){return oht.intern(t)}function Qut(t){return aht.intern(t)}function Kut(t){return lht.intern(t)}function eht(t){return cht.intern(t)}function tht(t){return uht.intern(t)}function Kt(t){return hht.intern(t)}let Iy=class{constructor(e,i){this._makeKey=e,this._makeRef=i,this._interns=new Map}intern(e){if(!e)return null;const i=this._makeKey(e),r=this._interns;return r.has(i)||r.set(i,this._makeRef(e)),r.get(i)??null}};function Ly(t){return"["+t.join(",")+"]"}const iht=new Iy(KRe,t=>({__tag:"Blending",...t}));function KRe(t){return t?Ly([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const rht=new Iy(eIe,t=>({__tag:"Culling",...t}));function eIe(t){return t?Ly([t.face,t.mode]):null}const sht=new Iy(tIe,t=>({__tag:"PolygonOffset",...t}));function tIe(t){return t?Ly([t.factor,t.units]):null}const nht=new Iy(iIe,t=>({__tag:"DepthTest",...t}));function iIe(t){return t?Ly([t.func]):null}const oht=new Iy(rIe,t=>({__tag:"StencilTest",...t}));function rIe(t){return t?Ly([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const aht=new Iy(sIe,t=>({__tag:"DepthWrite",...t}));function sIe(t){return t?Ly([t.zNear,t.zFar]):null}const lht=new Iy(nIe,t=>({__tag:"ColorWrite",...t}));function nIe(t){return t?Ly([t.r,t.g,t.b,t.a]):null}const cht=new Iy(oIe,t=>({__tag:"StencilWrite",...t}));function oIe(t){return t?Ly([t.mask]):null}const uht=new Iy(aIe,t=>({__tag:"DrawBuffers",...t}));function aIe(t){return t?Ly(t.buffers):null}const hht=new Iy(dht,t=>({blending:Wut(t.blending),culling:Zut(t.culling),polygonOffset:Yut(t.polygonOffset),depthTest:Xut(t.depthTest),stencilTest:Jut(t.stencilTest),depthWrite:Qut(t.depthWrite),colorWrite:Kut(t.colorWrite),stencilWrite:eht(t.stencilWrite),drawBuffers:tht(t.drawBuffers)}));function dht(t){return t?Ly([KRe(t.blending),eIe(t.culling),tIe(t.polygonOffset),iIe(t.depthTest),rIe(t.stencilTest),sIe(t.depthWrite),nIe(t.colorWrite),oIe(t.stencilWrite),aIe(t.drawBuffers)]):null}let pht=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,i,r,s){return(r||e!==i)&&(s(e),this._pipelineInvalid=!0),e}},fht=class extends Ur{constructor(){super(...arguments),this.heightParameters=ci(),this.radii=gt(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=gt(),this.backgroundColor=C()}},nI=class lIe extends Ki{initializeProgram(e){return new er(e.rctx,lIe.shader.get().build(this.configuration),Pi)}initializePipeline(){return this.configuration.reduced?Kt({blending:rd(Be.ONE,Be.ZERO),depthTest:{func:xr.ALWAYS},colorWrite:ui}):this.configuration.haze?Kt({blending:_a(Be.ONE,Be.ZERO,Be.ONE_MINUS_SRC_COLOR,Be.ONE),colorWrite:ui}):Kt({blending:rd(Be.SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),depthTest:{func:xr.LEQUAL},colorWrite:ui})}};nI.shader=new qi(Gut,()=>oe(()=>Promise.resolve().then(()=>m9t),void 0));let uc=class extends Ur{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,i={key:this.key};for(const r of e)i[r]=this[r];return i}};function j(t={}){return(e,i)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(i),t.constValue!=null)Object.defineProperty(e,i,{get:()=>t.constValue});else{const r=e._parameterNames.length-1,s=t.count||2,n=Math.ceil(Math.log2(s)),o=e._parameterBits??[0];let a=0;for(;o[a]+n>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<n)-1<<l;o[a]+=n,Object.defineProperty(e,i,{get(){return this[r]},set(u){if(this[r]!==u&&(this[r]=u,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+u<<l&c,typeof u!="number"&&typeof u!="boolean"))throw new Error("Configuration value for "+i+" must be boolean or number, got "+typeof u)}})}}}let cIe=class extends uc{constructor(){super(...arguments),this.haze=!1}};h([j()],cIe.prototype,"haze",void 0);let uIe=class extends cIe{constructor(){super(...arguments),this.reduced=!1}};h([j()],uIe.prototype,"reduced",void 0);var ls,Fo;(function(t){t[t.RED=0]="RED",t[t.RG=1]="RG",t[t.RGBA4=2]="RGBA4",t[t.RGBA=3]="RGBA",t[t.RGBA_MIPMAP=4]="RGBA_MIPMAP",t[t.R16F=5]="R16F",t[t.RGBA16F=6]="RGBA16F"})(ls||(ls={})),function(t){t[t.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",t[t.DEPTH16_BUFFER=1]="DEPTH16_BUFFER"}(Fo||(Fo={}));let dm=class{constructor(e,i,r,s,n,o=!1,a=0){this.name=e,this.count=i,this.type=r,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}};new dm($.POSITION,3,Et.FLOAT,0,12);const Une=[new dm($.POSITION,2,Et.FLOAT,0,8)],uN=[new dm($.POSITION,2,Et.FLOAT,0,16),new dm($.UV0,2,Et.FLOAT,8,16)];function mht(t){switch(t){case Et.BYTE:case Et.UNSIGNED_BYTE:return 1;case Et.SHORT:case Et.UNSIGNED_SHORT:case Et.HALF_FLOAT:return 2;case Et.FLOAT:case Et.INT:case Et.UNSIGNED_INT:return 4}}function hIe(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function y_(t,e){return t.vertexBuffers[e].usedMemory/ght(t.layout[e])}function ght(t){return t[0].stride}function Vne(t,e,i,r,s=0){var o;const n=t.gl;t.bindBuffer(i);for(const a of r){const l=e.get(a.name);if(l===void 0){console.warn(`There is no location for vertex attribute '${a.name}' defined.`);continue}const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&t.gl.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let u=0;u<3;u++)n.vertexAttribPointer(l+u,3,a.type,a.normalized,a.stride,a.offset+12*u+c),n.enableVertexAttribArray(l+u),a.divisor>0&&t.gl.vertexAttribDivisor(l+u,a.divisor);else if(a.count===16)for(let u=0;u<4;u++)n.vertexAttribPointer(l+u,4,a.type,a.normalized,a.stride,a.offset+16*u+c),n.enableVertexAttribArray(l+u),a.divisor>0&&((o=t.gl)==null||o.vertexAttribDivisor(l+u,a.divisor));else console.error("Unsupported vertex attribute element count: "+a.count);if(Sf()){const u=hIe(t),d=mht(a.type),f=a.offset,m=Math.round(d/f)!==d/f?`. Offset not a multiple of stride. DataType requires ${d} bytes, but descriptor has an offset of ${f}`:"";u&&console.error(`Unable to bind vertex attribute "${a.name}" with baseInstanceOffset ${c}${m}:`,u,a)}}}function dIe(t,e,i,r){var n,o,a;const s=t.gl;t.bindBuffer(i);for(const l of r){const c=e.get(l.name);if(l.count<=4)s.disableVertexAttribArray(c),l.divisor&&l.divisor>0&&((n=t.gl)==null||n.vertexAttribDivisor(c,0));else if(l.count===9)for(let u=0;u<3;u++)s.disableVertexAttribArray(c+u),l.divisor&&l.divisor>0&&((o=t.gl)==null||o.vertexAttribDivisor(c+u,0));else if(l.count===16)for(let u=0;u<4;u++)s.disableVertexAttribArray(c+u),l.divisor&&l.divisor>0&&((a=t.gl)==null||a.vertexAttribDivisor(c+u,0));else console.error("Unsupported vertex attribute element count: "+l.count)}t.unbindBuffer(Rt.ARRAY_BUFFER)}function zne(t){switch(t){case Ht.ALPHA:case Ht.LUMINANCE:case Ht.RED:case Ht.RED_INTEGER:case Tt.R8:case Tt.R8I:case Tt.R8UI:case Tt.R8_SNORM:case La.STENCIL_INDEX8:return 1;case Ht.LUMINANCE_ALPHA:case Ht.RG:case Ht.RG_INTEGER:case Tt.RGBA4:case Tt.R16F:case Tt.R16I:case Tt.R16UI:case Tt.RG8:case Tt.RG8I:case Tt.RG8UI:case Tt.RG8_SNORM:case Tt.RGB565:case Tt.RGB5_A1:case La.DEPTH_COMPONENT16:return 2;case Ht.DEPTH_COMPONENT:case Ht.RGB:case Ht.RGB_INTEGER:case Tt.RGB8:case Tt.RGB8I:case Tt.RGB8UI:case Tt.RGB8_SNORM:case Tt.SRGB8:case La.DEPTH_COMPONENT24:return 3;case Ht.DEPTH_STENCIL:case Ht.DEPTH24_STENCIL8:case Ht.RGBA:case Ht.RGBA_INTEGER:case Tt.RGBA8:case Tt.R32F:case Tt.R11F_G11F_B10F:case Tt.RG16F:case Tt.R32I:case Tt.R32UI:case Tt.RG16I:case Tt.RG16UI:case Tt.RGBA8I:case Tt.RGBA8UI:case Tt.RGBA8_SNORM:case Tt.SRGB8_ALPHA8:case Tt.RGB9_E5:case Tt.RGB10_A2UI:case Tt.RGB10_A2:case La.DEPTH_STENCIL:case La.DEPTH_COMPONENT32F:case La.DEPTH24_STENCIL8:return 4;case La.DEPTH32F_STENCIL8:return 5;case Tt.RGB16F:case Tt.RGB16I:case Tt.RGB16UI:return 6;case Tt.RG32F:case Tt.RG32I:case Tt.RG32UI:case Tt.RGBA16F:case Tt.RGBA16I:case Tt.RGBA16UI:return 8;case Tt.RGB32F:case Tt.RGB32I:case Tt.RGB32UI:return 12;case Tt.RGBA32F:case Tt.RGBA32I:case Tt.RGBA32UI:return 16;case en.COMPRESSED_RGB_S3TC_DXT1_EXT:case en.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case en.COMPRESSED_RGBA_S3TC_DXT3_EXT:case en.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case en.COMPRESSED_R11_EAC:case en.COMPRESSED_SIGNED_R11_EAC:case en.COMPRESSED_RGB8_ETC2:case en.COMPRESSED_SRGB8_ETC2:case en.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case en.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case en.COMPRESSED_RG11_EAC:case en.COMPRESSED_SIGNED_RG11_EAC:case en.COMPRESSED_RGBA8_ETC2_EAC:case en.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}const QF=()=>ne.getLogger("esri.views.webgl.VertexArrayObject");let pm=class{constructor(e,i,r,s,n=null){this._context=e,this._locations=i,this._layout=r,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,i)=>e+this._buffers[i].usedMemory,this._indexBuffer!=null?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*cSe}dispose(){var e;if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const i in this._buffers)(e=this._buffers[i])==null||e.dispose(),delete this._buffers[i];this._indexBuffer=Ut(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&QF().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(pn.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,i=e.createVertexArray();e.bindVertexArray(i),this._bindLayout(),e.bindVertexArray(null),this._glName=i,this._context.instanceCounter.increment(pn.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:i,_indexBuffer:r}=this;e||QF().error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in e){const o=e[n];o||QF().error("Vertex buffer is uninitialized!");const a=i[n];a||QF().error("Vertex element descriptor is empty!"),Vne(this._context,this._locations,o,a)}r!=null&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}},Dy=class extends pm{};const Cfe=()=>ne.getLogger("esri.views.webgl.BufferObject");let Cr=class sT{static createIndex(e,i,r){return new sT(e,Rt.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(e,i,r){return new sT(e,Rt.ARRAY_BUFFER,i,r)}static createUniform(e,i,r){return new sT(e,Rt.UNIFORM_BUFFER,i,r)}static createPixelPack(e,i=hr.STREAM_READ,r){const s=new sT(e,Rt.PIXEL_PACK_BUFFER,i);return r&&s.setSize(r),s}static createPixelUnpack(e,i=hr.STREAM_DRAW,r){return new sT(e,Rt.PIXEL_UNPACK_BUFFER,i,r)}static createTransformFeedback(e,i=hr.STATIC_DRAW,r){const s=new sT(e,Rt.TRANSFORM_FEEDBACK_BUFFER,i);return s.setSize(r),s}constructor(e,i,r,s){this._context=e,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(pn.BufferObject,this),this._glName=this._context.gl.createBuffer(),Fg(this._context.gl),s&&this.setData(s)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){return this.bufferType===Rt.ELEMENT_ARRAY_BUFFER?this._indexType===Et.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===Rt.ELEMENT_ARRAY_BUFFER||this.bufferType===Rt.ARRAY_BUFFER}dispose(){var e;(e=this._context)!=null&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(pn.BufferObject,this),this._context=null):this._glName&&Cfe().warn("Leaked WebGL buffer object")}setSize(e,i=null){if(this.bufferType===Rt.ELEMENT_ARRAY_BUFFER&&i!=null)switch(this._indexType=i,i){case Et.UNSIGNED_SHORT:e*=2;break;case Et.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let i=e.byteLength;this.bufferType===Rt.ELEMENT_ARRAY_BUFFER&&(uG(e)&&(i/=2,this._indexType=Et.UNSIGNED_SHORT),ore(e)&&(i/=4,this._indexType=Et.UNSIGNED_INT)),this._setBufferData(i,e)}_setBufferData(e,i=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;i!=null?s.bufferData(this.bufferType,i,this.usage):s.bufferData(this.bufferType,e,this.usage),Fg(s),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,i,r,s){if(!e)return;const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:o}=this._context;o.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,e,r,s-r),Fg(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(e,i=0,r,s){if(r<0||s<0)return;const n=yht(e)?e.BYTES_PER_ELEMENT:1;if(n*((r??0)+(s??0))>e.byteLength)return;i+n*(s??0)>this.usedMemory&&Cfe().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===Rt.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,Rt.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(Rt.TRANSFORM_FEEDBACK_BUFFER,i,e,r,s),this._context.unbindBuffer(Rt.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,Rt.COPY_READ_BUFFER),o.getBufferSubData(Rt.COPY_READ_BUFFER,i,e,r,s),this._context.unbindBuffer(Rt.COPY_READ_BUFFER))}async getSubDataAsync(e,i=0,r,s){await this._context.clientWaitAsync(),this.getSubData(e,i,r,s)}};function yht(t){return sHe(t)}var I_;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(I_||(I_={}));let es=class{constructor(e=0,i=e){this.width=e,this.height=i,this.target=js.TEXTURE_2D,this.pixelFormat=Ht.RGBA,this.dataType=Tl.UNSIGNED_BYTE,this.samplingMode=di.LINEAR,this.wrapMode=Ai.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}};function _ht(t){return t.width<=0||t.height<=0?0:Math.round(t.width*t.height*(t.hasMipmap?4/3:1)*(t.internalFormat==null?4:zne(t.internalFormat)))}let vht=class pIe extends es{constructor(e,i){switch(super(),this.context=e,Object.assign(this,i),this.internalFormat){case Tt.R16F:case Tt.R16I:case Tt.R16UI:case Tt.R32F:case Tt.R32I:case Tt.R32UI:case Tt.R8_SNORM:case Tt.R8:case Tt.R8I:case Tt.R8UI:this.pixelFormat=Ht.RED}}static validate(e,i){return new pIe(e,i)}};const Mfe=4;let Mr=class Cd{constructor(e,i=null,r=null){if(this.type=I_.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,r=i;else{const s=vht.validate(e,i);if(!s)throw new B("Texture descriptor invalid");this._descriptor=s}this._descriptor.target===js.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return _ht(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(pn.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,i){const r=this._descriptor;if(r.width!==e||r.height!==i){if(this._wasImmutablyAllocated)throw new B("Immutable textures can't be resized!");r.width=e,r.height=i,this._descriptor.target===js.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let i=js.TEXTURE_CUBE_MAP_POSITIVE_X;i<=js.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(e,i)}setData(e){this._setData(e)}_setData(e,i){var c;if(!((c=this._descriptor.context)!=null&&c.gl))return;const r=this._descriptor.context.gl;Fg(r),this._glName||(this._glName=r.createTexture(),this._glName&&this._descriptor.context.instanceCounter.increment(pn.Texture,this)),e===void 0&&(e=null);const s=this._descriptor,n=i??s.target,o=S$(n);e===null&&(s.width=s.width||Mfe,s.height=s.height||Mfe,o&&(s.depth=s.depth??1));const a=this._descriptor.context.bindTexture(this,Cd.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Cd.TEXTURE_UNIT_FOR_UPDATES),KF(s),this._configurePixelStorage(),Fg(r);const l=this._deriveInternalFormat();if(Ofe(e)){let u="width"in e?e.width:e.codedWidth,d="height"in e?e.height:e.codedHeight;const f=1;e instanceof HTMLVideoElement&&(u=e.videoWidth,d=e.videoHeight),s.width&&s.height,o&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,u,d,f),this._texImage(n,0,l,u,d,f,e),Fg(r),s.hasMipmap&&this.generateMipmap(),s.width||(s.width=u),s.height||(s.height=d),o&&!s.depth&&(s.depth=f)}else{const{width:u,height:d,depth:f}=s;if(u==null||d==null)throw new B("Width and height must be specified!");if(o&&f==null)throw new B("Depth must be specified!");if(s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,l,s.hasMipmap,u,d,f),NU(e)){const m=e.levels,g=$fe(n,u,d,f),y=Math.min(g-1,m.length-1);r.texParameteri(s.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,y);const v=l;if(!xht(v))throw new B("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((b,w,x,T)=>{const E=m[Math.min(b,m.length-1)];this._compressedTexImage(n,b,v,w,x,T,E)},y)}else this._texImage(n,0,l,u,d,f,e),Fg(r),s.hasMipmap&&this.generateMipmap()}Afe(r,this._descriptor),Pfe(r,this._descriptor),bht(this._descriptor.context,this._descriptor),Fg(r),this._descriptor.context.bindTexture(a,Cd.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,i,r,s,n,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._descriptor,c=this._deriveInternalFormat(),{context:u,pixelFormat:d,dataType:f,target:m,isImmutable:g}=l;if(g&&!this._wasImmutablyAllocated)throw new B("Cannot update immutable texture before allocation!");const y=u.bindTexture(this,Cd.TEXTURE_UNIT_FOR_UPDATES,!0);(i<0||r<0||i+s>l.width||r+n>l.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:v}=u;a&&v.pixelStorei(v.UNPACK_SKIP_ROWS,a),Ofe(o)?v.texSubImage2D(m,e,i,r,s,n,d,f,o):NU(o)?v.compressedTexSubImage2D(m,e,i,r,s,n,c,o.levels[e]):v.texSubImage2D(m,e,i,r,s,n,d,f,o),a&&v.pixelStorei(v.UNPACK_SKIP_ROWS,0),u.bindTexture(y,Cd.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,i,r,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor,u=this._deriveInternalFormat(),{context:d,pixelFormat:f,dataType:m,isImmutable:g,target:y}=c;if(g&&!this._wasImmutablyAllocated)throw new B("Cannot update immutable texture before allocation!");S$(y)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=d.bindTexture(this,Cd.TEXTURE_UNIT_FOR_UPDATES);d.setActiveTexture(Cd.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||s<0||i+n>c.width||r+o>c.height||s+a>c.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:b}=d;if(NU(l))l=l.levels[e],b.compressedTexSubImage3D(y,e,i,r,s,n,o,a,u,l);else{const w=l;b.texSubImage3D(y,e,i,r,s,n,o,a,f,m,w)}d.bindTexture(v,Cd.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new B("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,KF(e)}e.samplingMode===di.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=di.LINEAR_MIPMAP_NEAREST):e.samplingMode===di.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=di.NEAREST_MIPMAP_NEAREST);const i=this._descriptor.context.bindTexture(this,Cd.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Cd.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(i,Cd.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new B("Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,KF(e)}e.samplingMode===di.LINEAR_MIPMAP_NEAREST?(this._samplingModeDirty=!0,e.samplingMode=di.LINEAR):e.samplingMode===di.NEAREST_MIPMAP_NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=di.NEAREST)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,KF(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor,i=e.context.gl;this._samplingModeDirty&&(Afe(i,e),this._samplingModeDirty=!1),this._wrapModeDirty&&(Pfe(i,e),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(this._descriptor.internalFormat!=null)return this._descriptor.internalFormat===Ht.DEPTH_STENCIL&&(this._descriptor.internalFormat=Ht.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case Tl.FLOAT:switch(this._descriptor.pixelFormat){case Ht.RGBA:return this._descriptor.internalFormat=Tt.RGBA32F;case Ht.RGB:return this._descriptor.internalFormat=Tt.RGB32F;default:throw new B("Unable to derive format")}case Tl.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case Ht.RGBA:return this._descriptor.internalFormat=Tt.RGBA8;case Ht.RGB:return this._descriptor.internalFormat=Tt.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===Ht.DEPTH_STENCIL?Ht.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:s}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(e,i,r,s,n,o){const{gl:a}=this._descriptor.context;if(!wht(i))throw new B("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?$fe(e,s,n,o):1;if(S$(e)){if(o==null)throw new B("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,i,s,n,o)}else a.texStorage2D(e,l,i,s,n);this._wasImmutablyAllocated=!0}_texImage(e,i,r,s,n,o,a){const l=this._descriptor.context.gl,c=S$(e),{isImmutable:u,pixelFormat:d,dataType:f}=this._descriptor;if(u){if(a!=null){const m=a;if(c){if(o==null)throw new B("Missing depth dimension for 3D texture upload");l.texSubImage3D(e,i,0,0,0,s,n,o,d,f,m)}else l.texSubImage2D(e,i,0,0,s,n,d,f,m)}}else{const m=a;if(c){if(o==null)throw new B("Missing depth dimension for 3D texture upload");l.texImage3D(e,i,r,s,n,o,0,d,f,m)}else l.texImage2D(e,i,r,s,n,0,d,f,m)}}_compressedTexImage(e,i,r,s,n,o,a){const l=this._descriptor.context.gl,c=S$(e);if(this._descriptor.isImmutable){if(a!=null)if(c){if(o==null)throw new B("Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,i,0,0,0,s,n,o,r,a)}else l.compressedTexSubImage2D(e,i,0,0,s,n,r,a)}else if(c){if(o==null)throw new B("Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,i,r,s,n,o,0,a)}else l.compressedTexImage2D(e,i,r,s,n,0,a)}_forEachMipmapLevel(e,i=1/0){let{width:r,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===js.TEXTURE_3D;if(r==null||s==null||l&&n==null)throw new B("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,r,s,n),o&&(r!==1||s!==1||l&&n!==1)&&!(c>=i);++c)r=Math.max(1,r>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}};function KF(t){(t.width!=null&&t.width<0||t.height!=null&&t.height<0||t.depth!=null&&t.depth<0)&&console.error("Negative dimension parameters are not allowed!")}function Afe(t,e){let i=e.samplingMode,r=e.samplingMode;i===di.LINEAR_MIPMAP_NEAREST||i===di.LINEAR_MIPMAP_LINEAR?(i=di.LINEAR,e.hasMipmap||(r=di.LINEAR)):i!==di.NEAREST_MIPMAP_NEAREST&&i!==di.NEAREST_MIPMAP_LINEAR||(i=di.NEAREST,e.hasMipmap||(r=di.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,i),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,r)}function Pfe(t,e){typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function bht(t,e){const i=t.capabilities.textureFilterAnisotropic;i&&t.gl.texParameterf(e.target,i.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}function wht(t){return t in Tt}function xht(t){return t in en}function NU(t){return t!=null&&"type"in t&&t.type==="compressed"}function Tht(t){return t!=null&&"byteLength"in t}function Ofe(t){return t!=null&&!NU(t)&&!Tht(t)}function S$(t){return t===js.TEXTURE_3D||t===js.TEXTURE_2D_ARRAY}function $fe(t,e,i,r=1){let s=Math.max(e,i);return t===js.TEXTURE_3D&&(s=Math.max(s,r)),Math.round(Math.log(s)/Math.LN2)+1}Mr.TEXTURE_UNIT_FOR_UPDATES=0;function Ny(t,e=Une,i=Pi,r=-1,s=1){let n=null;return e===uN?n=new Float32Array([r,r,0,0,s,r,1,0,r,s,0,1,s,s,1,1]):n=new Float32Array([r,r,s,r,r,s,s,s]),new Dy(t,i,{geometry:e},{geometry:Cr.createVertex(t,hr.STATIC_DRAW,n)})}const Sht=4;function fIe(t){const e=new es(Sht);return e.samplingMode=di.NEAREST,new Mr(t,e)}const EB=16;function Sb(t){return Math.ceil(t/EB)*EB}function mIe(t){return Math.floor(t/EB)*EB}function Eht(t,e){let n=t.width*t.height;if(n<4096)return t instanceof ImageData?gIe(t):t;let o=t.width,a=t.height;do o=Math.ceil(o/2),a=Math.ceil(a/2),n=o*a;while(n>1048576||e!=null&&(o>e||a>e));return Bne(t,o,a)}function Cht(t,e){const i=Math.max(t.width,t.height);if(i<=e)return t;const r=e/i;return Bne(t,Math.round(t.width*r),Math.round(t.height*r))}function Bne(t,e,i){if(t instanceof ImageData)return Bne(gIe(t),e,i);const r=document.createElement("canvas");return r.width=e,r.height=i,r.getContext("2d").drawImage(t,0,0,r.width,r.height),r}function gIe(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");if(i==null)throw new B("Failed to create 2d context from HTMLCanvasElement");return i.putImageData(t,0,0),e}function qa(t,e=!0){t.attributes.add($.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(S`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?S`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let jne=class extends Ur{};function yIe(t){const e=new Hi;e.include(qa),e.fragment.uniforms.add(new xt("colorTexture",r=>r.color),new xt("depthTexture",r=>r.depth));const i=t.haze;return e.fragment.code.add(S`
    void main() {
      float depthSample = texture(depthTexture, uv).r;
      if (depthSample ${i?S`== 1.0`:S`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(colorTexture, uv);
    }
    `),e}const Mht=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:jne,build:yIe},Symbol.toStringTag,{value:"Module"}));let uQ=class _Ie extends Ki{initializeProgram(e){return new er(e.rctx,_Ie.shader.get().build(this.configuration),Pi)}initializePipeline(){return this.configuration.haze?Kt({blending:_a(Be.ONE,Be.ZERO,Be.ONE_MINUS_SRC_COLOR,Be.ONE),depthTest:{func:xr.ALWAYS},colorWrite:ui}):Kt({blending:rd(Be.SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),depthTest:{func:xr.ALWAYS},colorWrite:ui})}};uQ.shader=new qi(Mht,()=>oe(()=>Promise.resolve().then(()=>g9t),void 0));let Aht=class{constructor(e,i){this._view=e,this._context=i,this.type=rl.Realistic,this._handles=new Ey,this._compositingPassParameters=new jne,this._passParameters=new fht,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=ur.radius,this._fadeHaze=0,this._updateRadius(ur.radius);const r=this._context.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([te(()=>{var n,o;return(o=(n=this._view)==null?void 0:n.basemapTerrain)==null?void 0:o.rootTileElevationBounds},()=>{var n;return(n=this._view)!=null&&n.basemapTerrain?this._updateRootTileElevationBounds():null}),te(()=>{var n,o;return(o=(n=this._view)==null?void 0:n.basemapTerrain)==null?void 0:o.visibleElevationBounds},()=>{var n;return(n=this._view)!=null&&n.basemapTerrain?this._updateVisibleElevationBounds():null}),te(()=>{var n;return(n=this._view)==null?void 0:n.environment.background},n=>{const o=n instanceof PAe?XL(n.color):jh;pe(this._passParameters.backgroundColor,o[0]*o[3],o[1]*o[3],o[2]*o[3])},pr)]);const s=new uIe;s.haze=!1,this._atmosphereTechnique=this._context.techniques.acquire(nI,s),this._compositingTechnique=this._context.techniques.acquire(uQ,s),s.haze=!0,this._atmosphereHazeTechnique=this._context.techniques.acquire(nI,s),this._compositingHazeTechnique=this._context.techniques.acquire(uQ,s),s.reduced=!0,s.haze=!1,this._atmosphereReducedTechnique=this._context.techniques.acquire(nI,s),s.haze=!0,this._atmosphereHazeReducedTechnique=this._context.techniques.acquire(nI,s),this._vao=Ny(r,uN)}destroy(){this._handles.destroy(),this._compositingTechnique.release(),this._compositingHazeTechnique.release(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,i){this._render(e,i?this._atmosphereTechnique:this._atmosphereReducedTechnique,i,!1)}renderHaze(e,i,r){this._fadeHaze=i,this._render(e,r?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,r,!0)}_render(e,i,r,s){const n=e.bindParameters.mainDepth;if(!n)return;this._update(e.bindParameters.camera),this._passParameters.depthTexture=n;const o=e.rctx.bindTechnique(i,e.bindParameters,this._passParameters),a=e.offscreenRenderingHelper;if(r)a.renderDepthDetached(()=>this._renderCommon(o,e));else{const l=e.rctx.getViewport(),c=Ve(e.bindParameters.camera.eye)-ur.radius;let u;if(c<k1){const y=Math.min(1,Math.max(0,c/k1));u=s?Bt(.4,.5,y):Bt(.2,.3,y)}else{const y=Math.min(1,Math.max(0,(c-k1)/(15*k1)));u=s?Bt(.5,1,y):Bt(.3,.6,y)}const d=Sb(Math.round(u*e.bindParameters.camera.fullViewport[2])),f=Sb(Math.round(u*e.bindParameters.camera.fullViewport[3]));e.rctx.setViewport(0,0,d,f);const m=a.renderToCachedFBO(null,s?"chapman haze":"chapman",()=>this._renderCommon(o,e),[0,0,0,1],ls.RGBA,null,d,f);e.rctx.setViewport(l.x,l.y,l.width,l.height),this._compositingPassParameters.color=m.getTexture(),this._compositingPassParameters.depth=n;const g=s?this._compositingHazeTechnique:this._compositingTechnique;e.rctx.bindTechnique(g,e.bindParameters,this._compositingPassParameters),a.renderDepthDetached(()=>e.rctx.screen.draw()),m.release()}}_renderCommon(e,i){this._vao!=null&&(i.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.rctx.drawArrays(Mi.TRIANGLE_STRIP,0,4))}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=ur.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=Pht(ur.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,Di(this._passParameters.radii,e,e+k1),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-rQ)*rQ)}_update(e){if(!e)return;const i=pl(e.eye),r=Math.sqrt(i),s=i-this._passParameters.radii[1]*this._passParameters.radii[1],n=Ne((r-this._passParameters.radii[0])/k1,0,1);Ss(this._passParameters.heightParameters,r,i,s,n),this._passParameters.altitudeFade=Nne(r-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=Bt(Bt(.6,1,DL(9500,10500,r-ur.radius)),1,this._fadeHaze)}};function Pht(t){return t*Math.cos(Math.PI/16/16)}function Gne(t){t.fragment.code.add(S`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function Hne(t,e){switch(t.include(Hf,e),e.textureCoordinateType){case Es.Default:case Es.Compressed:return void t.fragment.code.add(S`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case Es.Atlas:return t.include(Gne),void t.fragment.code.add(S`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:e.textureCoordinateType;case Es.None:case Es.COUNT:return}}let Wh=class extends qs{constructor(e,i){super(e,"vec3",Yi.Draw,(r,s,n,o)=>r.setUniform3fv(e,i(s,n,o)))}},sy=class extends qs{constructor(e,i){super(e,"sampler2D",Yi.Draw,(r,s,n)=>r.bindTexture(e,i(s,n)))}},Sw=class{constructor(e){this._material=e.material,this._techniques=e.techniques,this._output=e.output}dispose(){this._techniques.release(this._technique)}get technique(){return this._technique}get _stippleTextures(){return this._techniques.constructionContext.stippleTextures}get _markerTextures(){return this._techniques.constructionContext.markerTextures}ensureTechnique(e,i){return this._technique=this._techniques.releaseAndAcquire(e,this._material.getConfiguration(this._output,i),this._technique),this._technique}ensureResources(e){return ew.LOADED}},qne=class extends Sw{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textures=e.textures,this._textureId=e.textureId,this._acquire(e.textureId,i=>this._texture=i),this._acquire(e.normalTextureId,i=>this._textureNormal=i),this._acquire(e.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(e.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(e.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){this._texture=hi(this._texture),this._textureNormal=hi(this._textureNormal),this._textureEmissive=hi(this._textureEmissive),this._textureOcclusion=hi(this._textureOcclusion),this._textureMetallicRoughness=hi(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?ew.LOADED:ew.LOADING}get textureBindParameters(){return new vIe(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=hi(this._texture),this._textureId=e,this._acquire(this._textureId,i=>this._texture=i))}_acquire(e,i){if(e==null)return void i(null);const r=this._textures.acquire(e);if(Zu(r))return++this._numLoading,void r.then(s=>{if(this._disposed)return hi(s),void i(null);i(s)}).finally(()=>--this._numLoading);i(r)}},vIe=class extends Ur{constructor(e=null,i=null,r=null,s=null,n=null,o,a){super(),this.texture=e,this.textureNormal=i,this.textureEmissive=r,this.textureOcclusion=s,this.textureMetallicRoughness=n,this.scale=o,this.normalTextureTransformMatrix=a}};var Pt;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Simplified=5]="Simplified",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(Pt||(Pt={}));function Wne(t,e){const i=t.fragment,r=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===Pt.Normal&&r&&t.include(Hne,e),e.pbrMode!==Pt.Schematic)if(e.pbrMode!==Pt.Disabled){if(e.pbrMode===Pt.Normal){i.code.add(S`vec3 mrr;
vec3 emission;
float occlusion;`);const s=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(i.uniforms.add(s===Yi.Pass?new xt("texMetallicRoughness",n=>n.textureMetallicRoughness):new sy("texMetallicRoughness",n=>n.textureMetallicRoughness)),i.code.add(S`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(i.uniforms.add(s===Yi.Pass?new xt("texEmission",n=>n.textureEmissive):new sy("texEmission",n=>n.textureEmissive)),i.code.add(S`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),e.hasOcclusionTexture?(i.uniforms.add(s===Yi.Pass?new xt("texOcclusion",n=>n.textureOcclusion):new sy("texOcclusion",n=>n.textureOcclusion)),i.code.add(S`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(S`float getBakedOcclusion() { return 1.0; }`),s===Yi.Pass?i.uniforms.add(new Wt("emissionFactor",n=>n.emissiveFactor),new Wt("mrrFactors",n=>n.mrrFactors)):i.uniforms.add(new Wh("emissionFactor",n=>n.emissiveFactor),new Wh("mrrFactors",n=>n.mrrFactors)),i.code.add(S`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${e.hasMetallicRoughnessTexture?S`applyMetallnessAndRoughness(${e.hasMetallicRoughnessTextureTransform?S`metallicRoughnessUV`:"vuv0"});`:""}

      ${e.hasEmissionTexture?S`applyEmission(${e.hasEmissiveTextureTransform?S`emissiveUV`:"vuv0"});`:""}

      ${e.hasOcclusionTexture?S`applyOcclusion(${e.hasOcclusionTextureTransform?S`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else i.code.add(S`float getBakedOcclusion() { return 1.0; }`);else i.code.add(S`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function Zne(t,e){const i=t.fragment,r=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new Wt("lightingAmbientSH0",(s,n)=>pe(Rfe,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),i.code.add(S`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add(new ji("lightingAmbientSH_R",(s,n)=>Ss(Qy,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new ji("lightingAmbientSH_G",(s,n)=>Ss(Qy,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new ji("lightingAmbientSH_B",(s,n)=>Ss(Qy,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))),i.code.add(S`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add(new Wt("lightingAmbientSH0",(s,n)=>pe(Rfe,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new ji("lightingAmbientSH_R1",(s,n)=>Ss(Qy,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new ji("lightingAmbientSH_G1",(s,n)=>Ss(Qy,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new ji("lightingAmbientSH_B1",(s,n)=>Ss(Qy,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new ji("lightingAmbientSH_R2",(s,n)=>Ss(Qy,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new ji("lightingAmbientSH_G2",(s,n)=>Ss(Qy,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new ji("lightingAmbientSH_B2",(s,n)=>Ss(Qy,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))),i.code.add(S`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==Pt.Normal&&e.pbrMode!==Pt.Schematic||i.code.add(S`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Rfe=C(),Qy=ci();function hN(t){t.vertex.code.add(S`const float PI = 3.141592653589793;`),t.fragment.code.add(S`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var qg,x2;function Oht(t){return(t==null?void 0:t.cubeMap)!=null}function $ht(t){return t!=null&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FADING=1]="FADING",t[t.FINISHED=2]="FINISHED"})(qg||(qg={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(x2||(x2={}));function W_(t=Rht){return[t[0],t[1],t[2],t[3]]}function mq(t,e,i=W_()){return ve(i,t),i[3]=e,i}function Ife(t,e,i=ci()){return mt(i,t,e),Ce(i,i),i[3]=-LCe(t,e),i}function _Qt(t,e=W_()){const i=ZCe(oI,t);return bIe(e,ja(u6(e,i))),e}function Lfe(t,e,i=W_()){return fB(oI,t,Dfe(t)),fB(Nfe,e,Dfe(e)),h6(oI,Nfe,oI),bIe(i,ja(u6(i,oI)))}function vQt(t,e,i,r=W_()){return mq(ose,t,e4),mq(ase,e,Ffe),mq(hP,i,kfe),Lfe(e4,Ffe,e4),Lfe(e4,kfe,r),r}function bQt(t){return t}function wQt(t){return t[3]}function Dfe(t){return kt(t[3])}function bIe(t,e){return t[3]=e,t}const Rht=[0,0,1,0],oI=nd(),Nfe=nd();W_();const e4=W_(),Ffe=W_(),kfe=W_();let Iht=class{constructor(){this.readChannels=x2.RG,this.renderingStage=qg.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=C(),this.parallax=new Ufe,this.parallaxNew=new Ufe,this.pointOnGround=C(),this.fadeMode=Zr.HIDE,this.fadeFactor=0,this.opacity=0}updateParallax(e){const i=this.parallax,r=Ve(e.eye);if(i.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(r*r-ur.radius*ur.radius,0))/r,Ife(Vfe,i.anchorPointClouds,SE),Uu(i.transform,Jr,SE[3],SE),this.fadeMode===Zr.CROSS_FADE){const s=this.parallaxNew;Ife(Vfe,s.anchorPointClouds,SE),Uu(s.transform,Jr,SE[3],SE)}}updateFading(e,i,r,s){this.isFading&&this._advanceFading(r,s),this._evaluateFading(e,i,r)}_evaluateFading(e,i,r){const s=e.relativeElevation,n=this._calculateDistanceToAnchorPoint(e);if((s>1.7*X0||s<-X0||n>kht)&&this.opacity>0)this._setFade(Zr.HIDE,r);else if(!this.isFading){if((s>X0||s<-.35*X0||n>Fht)&&this.opacity>0)this._setFade(Zr.FADE_OUT,r);else if(s<=X0&&s>=-.35*X0&&i===Ii.IDLE&&$ht(this.data)){if(this.opacity===0)return void this._setFade(Zr.FADE_IN,r);(n>Nht||this.renderingStage===qg.FADING)&&this._setFade(Zr.CROSS_FADE,r)}}}_advanceFading(e,i){this._switchReadChannels(),this._updateAnchorPoint(),this._advanceFadingFactorAndOpacity(e,i)}_advanceFadingFactorAndOpacity(e,i){if(this.fadeFactor<1)return this.fadeFactor=i?Ne((e-this.startTime)/(Dht*i),0,1):1,this.fadeMode===Zr.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===Zr.FADE_IN&&(this.opacity=this.fadeFactor),void(this.fadeMode===Zr.CROSS_FADE&&(this.opacity=1));this.fadeFactor=0,this.fadeMode===Zr.FADE_OUT&&(this.opacity=0),this.fadeMode===Zr.FADE_IN&&(this.opacity=1),this.fadeMode===Zr.CROSS_FADE&&(this.opacity=1),this.fadeMode=Zr.NONE}_switchReadChannels(){const e=this.fadeMode===Zr.CROSS_FADE&&this.fadeFactor===1,i=this.fadeMode===Zr.FADE_IN&&this.fadeFactor===0;this.renderingStage===qg.FADING&&(e||i)&&(this.readChannels=1-this.readChannels,this.renderingStage=qg.FINISHED)}_calculateDistanceToAnchorPoint(e){return Ce(this.pointOnGround,e.eye),de(this.pointOnGround,this.pointOnGround,ur.radius),Ve($e(Lht,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===Zr.CROSS_FADE&&(this.fadeFactor===0&&ve(this.parallaxNew.anchorPointClouds,this.pointOnGround),this.fadeFactor===1&&ve(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds)),this.fadeMode===Zr.FADE_IN&&this.fadeFactor===0&&ve(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(e,i){switch(e){case Zr.HIDE:this.opacity=0;break;case Zr.FADE_OUT:this.opacity=1;break;case Zr.FADE_IN:this.opacity=0;break;case Zr.CROSS_FADE:this.opacity=1}this.fadeMode=e,this.fadeFactor=0,this.startTime=i}get isFading(){return this.fadeMode===Zr.FADE_OUT||this.fadeMode===Zr.FADE_IN||this.fadeMode===Zr.CROSS_FADE}};var Zr;(function(t){t[t.NONE=0]="NONE",t[t.HIDE=1]="HIDE",t[t.FADE_OUT=2]="FADE_OUT",t[t.FADE_IN=3]="FADE_IN",t[t.CROSS_FADE=4]="CROSS_FADE"})(Zr||(Zr={}));let Ufe=class{constructor(){this.anchorPointClouds=C(),this.radiusCurvatureCorrectionFactor=0,this.transform=ke()}};const Vfe=qe(0,0,1),SE=W_(),Lht=C(),Dht=1.25,Nht=34e3,Fht=64e3,kht=2e5;let ny=class extends qs{constructor(e,i){super(e,"bool",Yi.Pass,(r,s,n)=>r.setUniform1b(e,i(s,n)))}},Uht=class extends qs{constructor(e,i){super(e,"samplerCube",Yi.Pass,(r,s,n)=>r.bindTexture(e,i(s,n)))}};function wIe(t){const e=t.fragment;e.uniforms.add(new fs("rotationMatrixClouds",(i,r)=>r.cloudsFade.parallax.transform),new fs("rotationMatrixCloudsCrossFade",(i,r)=>r.cloudsFade.parallaxNew.transform),new Wt("anchorPosition",(i,r)=>r.cloudsFade.parallax.anchorPointClouds),new Wt("anchorPositionCrossFade",(i,r)=>r.cloudsFade.parallaxNew.anchorPointClouds),new tt("cloudsHeight",()=>net),new tt("radiusCurvatureCorrectionFactor",(i,r)=>r.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new tt("totalFadeInOut",(i,r)=>1-r.cloudsFade.opacity),new tt("crossFadeAnchorFactor",(i,r)=>Ne(r.cloudsFade.fadeFactor,0,1)),new Uht("cubeMap",(i,r)=>{var s,n;return((n=(s=r.cloudsFade.data)==null?void 0:s.cubeMap)==null?void 0:n.colorTexture)??null}),new ny("crossFade",(i,r)=>r.cloudsFade.fadeMode===Zr.CROSS_FADE),new ny("readChannelsRG",(i,r)=>r.cloudsFade.readChannels===x2.RG),new ny("fadeTextureChannels",(i,r)=>r.cloudsFade.renderingStage===qg.FADING)),e.constants.add("planetRadius","float",ur.radius),e.code.add(S`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(S`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(S`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),q_(e),Ry(e),e.code.add(S`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(S`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(S`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(S`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(S`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function Fy(t){t.code.add(S`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function xIe(){const t=new Hi,{attributes:e,varyings:i,vertex:r,fragment:s}=t;return e.add($.POSITION,"vec2"),i.add("worldRay","vec3"),r.uniforms.add(new fs("inverseProjectionMatrix",(n,o)=>o.camera.inverseProjectionMatrix),new fs("inverseViewMatrix",(n,o)=>fw(Vht,o.camera.viewMatrix))),r.code.add(S`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),s.include(Fy),s.include(vm),t.include(Zne,{pbrMode:Pt.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(hN),t.include(M6),t.include(xB),t.include(wIe),s.uniforms.add(new Wt("cameraPosition",(n,o)=>o.camera.eye)),s.code.add(S`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const Vht=ke(),zht=Object.freeze(Object.defineProperty({__proto__:null,build:xIe},Symbol.toStringTag,{value:"Module"}));let TIe=class SIe extends Ki{constructor(e){super(e,new uc,()=>this.destroy())}initializeProgram(e){return new er(e.rctx,SIe.shader.get().build(),Pi)}initializePipeline(){return Kt({blending:_a(Be.ONE,Be.ZERO,Be.SRC_ALPHA,Be.ONE),depthTest:{func:xr.LEQUAL},colorWrite:ui})}};TIe.shader=new qi(zht,()=>oe(()=>Promise.resolve().then(()=>y9t),void 0));let nT=class extends Ue{constructor(e){super(e),this._technique=new TIe(e),this._vao=Ny(e.rctx)}destroy(){this._technique=hi(this._technique),this._vao=Ut(this._vao)}render(e){if(!this._technique.compiled)return void this.requestRender();const i=e.bindParameters.cloudsFade;if(this._vao==null||i.data==null)return;const r=e.rctx.bindTechnique(this._technique,e.bindParameters,Bht);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Mi.TRIANGLE_STRIP,0,4)}};h([p({constructOnly:!0})],nT.prototype,"rctx",void 0),h([p({constructOnly:!0})],nT.prototype,"viewingMode",void 0),h([p({constructOnly:!0})],nT.prototype,"planetRadius",void 0),h([p({constructOnly:!0})],nT.prototype,"requestRender",void 0),nT=h([I("esri.views.3d.environment.CloudsComposition")],nT);const Bht=new Ur;function Ru(){return new Float32Array(3)}function hQ(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function $r(t,e,i){const r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=i,r}function jht(t,e){return new Float32Array(t,e,3)}function Yne(){return Ru()}function EIe(){return $r(1,1,1)}function CIe(){return $r(1,0,0)}function MIe(){return $r(0,1,0)}function AIe(){return $r(0,0,1)}const Ght=Yne(),Hht=EIe(),qht=CIe(),Wht=MIe(),Zht=AIe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Hht,UNIT_X:qht,UNIT_Y:Wht,UNIT_Z:Zht,ZEROS:Ght,clone:hQ,create:Ru,createView:jht,fromValues:$r,ones:EIe,unitX:CIe,unitY:MIe,unitZ:AIe,zeros:Yne},Symbol.toStringTag,{value:"Module"}));var qc;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(qc||(qc={}));let FU=class extends uc{constructor(){super(...arguments),this.steps=qc.SIXTEEN,this.writeTextureChannels=x2.RG}};h([j({count:qc.COUNT})],FU.prototype,"steps",void 0),h([j({constValue:ue("esri-mobile")?1024:2048})],FU.prototype,"cubeMapSize",void 0),h([j()],FU.prototype,"writeTextureChannels",void 0);let aI=class{constructor(e,i,r,s,n,o,a,l,c=.5){this.coverage=e,this.density=i,this.absorption=r,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const zfe=new aI([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],qc.SIXTEEN),il={sunny:zfe,cloudy:new aI([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],qc.TWOHUNDRED,.6),rainy:new aI([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],qc.TWOHUNDRED,.4),snowy:new aI([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],qc.HUNDRED,.65),foggy:new aI([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],qc.SIXTEEN),default:zfe},Hd=ue("esri-mobile")?64:128,Yht=Hd/128,yf=Math.ceil(Math.sqrt(Hd)),Eb=(Hd+2)*yf,Xht=1e5,gq=128,Jht=Eb/1560;let xp=class extends qs{constructor(e,i){super(e,"mat3",Yi.Pass,(r,s,n)=>r.setUniformMatrix3fv(e,i(s,n)))}},Xne=class extends Ur{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=il.default.raymarchingSteps,this.weatherTile=gt(),this.viewMatrix=Kr()}};function PIe(t){const e=new Hi;e.include(qa,!1);const i=e.fragment;return i.uniforms.add(new tt("cloudRadius",r=>r.cloudRadius),new tt("power",r=>Bt(35,120,r.absorption)),new tt("sigmaE",r=>1+r.absorption),new tt("density",r=>Bt(0,.3,r.density)),new tt("cloudSize",r=>Bt(0,.02,Math.max(.01,1-r.cloudSize))),new tt("detailSize",r=>Bt(0,.2,Math.max(.01,1-r.detailSize))),new tt("smoothness",r=>Bt(0,.5,1-r.smoothness)),new tt("cloudHeight",r=>Bt(0,1500,r.cloudHeight)),new tt("coverage",r=>r.coverage),new xp("view",r=>r.viewMatrix),new xt("cloudShapeTexture",r=>r.noiseTexture!=null?r.noiseTexture.textureAtlas:null),new Hr("cloudVariables",r=>Di(Qht,r.coverage,r.absorption))),i.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),i.code.add(S`
    const int STEPS = ${t.steps===qc.SIXTEEN?S`16`:t.steps===qc.HUNDRED?S`100`:S`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),i.code.add(S`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${S.float(Eb)};
      const float dataWidth = ${S.float(Eb)};
      const float tileRows = ${S.float(yf)};
      const vec3 atlasDimensions = vec3(${S.float(Hd)}, ${S.float(Hd)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${S.float(Yht)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${S.float(Jht)} * p) / ${S.float(Eb)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),i.code.add(S`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),i.code.add(S`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),i.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),i.code.add(S`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),i.code.add(S`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),i.code.add(S`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const Qht=gt(),Kht=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:Xne,build:PIe},Symbol.toStringTag,{value:"Module"}));let OIe=class $Ie extends Ki{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new er(e.rctx,$Ie.shader.get().build(this.configuration),Pi)}initializePipeline(){return Kt({blending:rd(Be.CONSTANT_COLOR,Be.ONE_MINUS_CONSTANT_COLOR,$_.ADD,this.configuration.writeTextureChannels===x2.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:xr.LEQUAL},colorWrite:ui})}};OIe.shader=new qi(Kht,()=>oe(()=>Promise.resolve().then(()=>_9t),void 0));var Ih;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(Ih||(Ih={}));let dQ=class extends uc{constructor(){super(...arguments),this.mode=Ih.Full}};h([j({count:Ih.COUNT})],dQ.prototype,"mode",void 0);let Jne=class extends Ur{constructor(){super(...arguments),this.weatherTile=Ei(0,0)}};function RIe(t){const e=new Hi;return e.include(qa,!1),e.fragment.code.add(S`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===Ih.Full&&e.fragment.code.add(S`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${S.float(yf)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${S.float(8)});

      float worley0 = worley(p, ${S.float(2)} * 2.0);
      float worley1 = worley(p, ${S.float(2)} * 8.0);
      float worley2 = worley(p, ${S.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${S.float(2)});
      float worley1 = worley(p, ${S.float(2)} * 2.0);
      float worley2 = worley(p, ${S.float(2)} * 4.0);
      float worley3 = worley(p, ${S.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new Hr("weatherTile",i=>i.weatherTile)),e.fragment.code.add(S`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${S.float(gq)});

      // Get global coordinates of p
      p += weatherTile * ${S.float(gq)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${S.float(Xht)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(S`void main() {`),t.mode===Ih.Full&&e.fragment.code.add(S`
        float padWidth = 1.0;
        float paddedSize = ${S.float(Hd)} + 2.0 * padWidth;
        float tileCount = ${S.float(yf)} * ${S.float(yf)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${S.float(Hd)};
          }

          if (startPadY) {
            pixel.y += ${S.float(Hd)};
          }

          if (endPadX) {
            pixel.x -= ${S.float(Hd)};
          }

          if (endPadY) {
            pixel.y -= ${S.float(Hd)};
          }

          uv = vec2(pixel.xy / ${S.float(Hd)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${S.float(Hd)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${S.float(yf)} * ${S.float(yf)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${S.float(yf)} * ${S.float(yf)});
        p = p_;
        p.z /= (${S.float(yf)} * ${S.float(yf)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(S`
      vec2 mapUV = ${S.float(gq)} * (gl_FragCoord.xy / ${S.float(Eb)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===Ih.Full?S`fragColor.ba = vec2(0.0, map);`:S`fragColor = vec4(map);`};
    }
  `),e}const edt=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:Jne,build:RIe},Symbol.toStringTag,{value:"Module"}));let pQ=class IIe extends Ki{initializeProgram(e){return new er(e.rctx,IIe.shader.get().build(this.configuration),Pi)}initializePipeline(){return Kt({blending:this.configuration.mode===Ih.Full?rd(Be.ONE,Be.ZERO):_a(Be.ZERO,Be.ONE,Be.ONE,Be.ZERO),depthTest:{func:xr.ALWAYS},colorWrite:ui})}};pQ.shader=new qi(edt,()=>oe(()=>Promise.resolve().then(()=>v9t),void 0));let LIe=class{constructor(e,i,r=i){this.internalFormat=e,this.width=i,this.height=r,this.multisampled=!1,this.samples=1}};function tdt(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*zne(t.internalFormat)}let DIe=class{constructor(e,i){this._context=e,this._descriptor=i,this.type=I_.RenderBuffer,this._context.instanceCounter.increment(pn.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=i;a?r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,s,n):r.renderbufferStorage(r.RENDERBUFFER,o,s,n),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,i=this._context.parameters.maxSamples;return e?Math.min(e,i):i}get usedMemory(){return tdt(this._descriptor)}resize(e,i){const r=this._descriptor;if(r.width===e&&r.height===i)return;r.width=e,r.height=i;const s=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):s.renderbufferStorage(s.RENDERBUFFER,r.internalFormat,r.width,r.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(pn.Renderbuffer,this),this._context=null)}};const idt=()=>ne.getLogger("esri.views.webgl.FramebufferObject");let ky=class lI{constructor(e,i,r=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(pn.FramebufferObject,this);const s=kU(i)?i:new Mr(this._context,i);if(this._colorAttachments.set(Xn.COLOR_ATTACHMENT0,s),this._validateTextureDescriptor(s.descriptor),this._validateColorAttachmentPoint(Xn.COLOR_ATTACHMENT0),r!=null)if(sdt(r))this._depthStencilTexture=kU(r)?r:new Mr(this._context,r),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const n=rdt(r)?r:new DIe(this._context,r);this._depthStencilBuffer=n,this._validateRenderBufferDescriptor(n.descriptor)}}dispose(){var i,r;if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((s,n)=>{var o;return(o=this.detachColorTexture(n))==null?void 0:o.dispose()}),(i=this.detachDepthStencilBuffer())==null||i.dispose(),(r=this.detachDepthStencilTexture())==null||r.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(pn.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(Xn.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){var i;const e=this._colorAttachments.get(Xn.COLOR_ATTACHMENT0);return((i=e==null?void 0:e.descriptor)==null?void 0:i.width)??0}get height(){var i;const e=this._colorAttachments.get(Xn.COLOR_ATTACHMENT0);return((i=e==null?void 0:e.descriptor)==null?void 0:i.height)??0}get usedMemory(){var e;return[...this._colorAttachments].reduce((i,[r,s])=>i+s.usedMemory,((e=this.depthStencil)==null?void 0:e.usedMemory)??0)}getColorTexture(e){const i=this._colorAttachments.get(e);return i&&kU(i)?i:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,i=Xn.COLOR_ATTACHMENT0){var s;if(!e)return;this._validateColorAttachmentPoint(i);const r=e.descriptor;this._validateTextureDescriptor(r),(s=this.detachColorTexture(i))==null||s.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,i)),this._colorAttachments.set(i,e)}detachColorTexture(e=Xn.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(e);if(i){if(this._initialized){const r=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e),this._context.bindFramebuffer(r)}return this._colorAttachments.delete(e),i}}setColorTextureTarget(e,i=Xn.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);r&&this._framebufferTexture2D(r.glName,i,e)}attachDepthStencil(e){if(e)switch(e.type){case I_.Texture:return this._attachDepthStencilTexture(e);case I_.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){var r;if(e==null)return;const i=e.descriptor;i.pixelFormat!==Ht.DEPTH_STENCIL&&i.pixelFormat!==Ht.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==Tl.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._validateTextureDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,UP)),(r=this._depthStencilTexture)==null||r.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;if(e&&this._initialized){const i=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,UP),this._context.bindFramebuffer(i)}return this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(e==null)return;const i=e.descriptor;if(this._validateRenderBufferDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,s=this._getGLAttachmentPoint(i);r.framebufferRenderbuffer(al.FRAMEBUFFER,s,r.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){const i=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);const r=this._context.gl,s=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(al.FRAMEBUFFER,s,r.RENDERBUFFER,null),this._context.bindFramebuffer(i)}return this._depthStencilBuffer=null,e}copyToTexture(e,i,r,s,n,o,a){(e<0||i<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==js.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||e+r>this.width||i+s>this.height||n+r>l.width||o+s>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,u=c.bindTexture(a,Mr.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(Mr.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(js.TEXTURE_2D,0,n,o,e,i,r,s),c.bindTexture(u,Mr.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,i,r,s,n,o,a){(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,i,r,s,n,o,a)}async readPixelsAsync(e,i,r,s,n,o,a){const{gl:l}=this._context,c=Cr.createPixelPack(this._context,hr.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,i,r,s,n,o,0),this._context.unbindBuffer(Rt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,i){var s,n;if(this.width===e&&this.height===i)return;const r={width:e,height:i};cS(r,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(o=>o.resize(r.width,r.height)),(s=this._depthStencilTexture)==null||s.resize(r.width,r.height),this._initialized&&(cS(r,this._context.parameters.maxRenderbufferSize),(n=this._depthStencilBuffer)==null||n.resize(r.width,r.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=al.FRAMEBUFFER){const i=this._context.gl;if(this._initialized)return void i.bindFramebuffer(e,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=i.createFramebuffer();if(i.bindFramebuffer(e,r),this._colorAttachments.forEach((s,n)=>this._framebufferTexture2D(s.glName,n,Bfe(s),e)),this._depthStencilBuffer){const s=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);i.framebufferRenderbuffer(e,s,i.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,i.DEPTH_STENCIL_ATTACHMENT,Bfe(this._depthStencilTexture),e);Sf()&&i.checkFramebufferStatus(e)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=r,this._initialized=!0}_framebufferTexture2D(e,i=Xn.COLOR_ATTACHMENT0,r=js.TEXTURE_2D,s=al.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,i,r,e,n)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const i=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(al.FRAMEBUFFER,i,e.RENDERBUFFER,null)}this._depthStencilBuffer=Ut(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=Ut(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==js.TEXTURE_2D&&e.target!==js.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),cS(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){cS(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case La.DEPTH_COMPONENT16:case La.DEPTH_COMPONENT24:case La.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case La.DEPTH24_STENCIL8:case La.DEPTH32F_STENCIL8:case La.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case La.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(lI._MAX_COLOR_ATTACHMENTS===-1){const{gl:r}=this._context;lI._MAX_COLOR_ATTACHMENTS=r.getParameter(r.MAX_COLOR_ATTACHMENTS)}const i=e-Xn.COLOR_ATTACHMENT0;i+1>lI._MAX_COLOR_ATTACHMENTS&&ne.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${lI._MAX_COLOR_ATTACHMENTS} color attachments`)}};function kU(t){return t!=null&&"type"in t&&t.type===I_.Texture}function rdt(t){return t!=null&&"type"in t&&t.type===I_.RenderBuffer}function sdt(t){return kU(t)||t!=null&&"pixelFormat"in t}function cS(t,e){const i=Math.max(t.width,t.height);if(i>e){idt().warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const r=e/i;return t.width=Math.round(t.width*r),t.height=Math.round(t.height*r),!1}return!0}function Bfe(t){return t.descriptor.target===js.TEXTURE_CUBE_MAP?js.TEXTURE_CUBE_MAP_POSITIVE_X:js.TEXTURE_2D}ky._MAX_COLOR_ATTACHMENTS=-1;let cI=class extends Ue{constructor(e){super(e),this._needsRender=!0,this._passParameters=new Jne,this._fbo=new ky(e.context.renderContext.rctx,new es(Eb)),this._vao=Ny(e.context.renderContext.rctx)}get _techniques(){return this.context.techniques}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(Ih.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render(Ih.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(Ga(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=hi(this._fullTechniqueCached),this._weatherMapTechniqueCached=hi(this._weatherMapTechniqueCached),this._fbo=Ut(this._fbo),this._vao=Ut(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new dQ;e.mode=Ih.Full,this._fullTechniqueCached=this._techniques.acquire(pQ,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new dQ;e.mode=Ih.WeatherMap,this._weatherMapTechniqueCached=this._techniques.acquire(pQ,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._fbo==null)return null;const i=e===Ih.Full?this._fullTechnique:this._weatherMapTechnique,r=this.context.renderContext.rctx,s=r.getViewport();r.setViewport(0,0,Eb,Eb),r.bindFramebuffer(this._fbo);const n=r.bindTechnique(i,null,this._passParameters);return r.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._fbo.colorTexture}};h([p({constructOnly:!0})],cI.prototype,"context",void 0),h([p({readOnly:!0})],cI.prototype,"_techniques",null),cI=h([I("esri.views.3d.environment.NoiseTextureAtlas")],cI);function P6(t){return t?{ray:mo(t.ray),c0:t.c0,c1:t.c1}:{ray:mo(),c0:0,c1:Number.MAX_VALUE}}function ndt(t,e=P6()){return lB(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function odt(t,e,i=P6()){const r=Ve(t.vector);return mPe(t.origin,e,i.ray),i.c0=0,i.c1=r,i}function NQt(t,e){return NIe(t,t.c0,e)}function FQt(t,e){return NIe(t,t.c1,e)}function NIe(t,e,i){return Ee(i,t.ray.origin,de(i,t.ray.direction,e))}new B_(()=>P6());function QL(t){return t?[rr(t[0]),rr(t[1]),rr(t[2]),rr(t[3]),rr(t[4]),rr(t[5])]:[rr(),rr(),rr(),rr(),rr(),rr()]}function FIe(){return[C(),C(),C(),C(),C(),C(),C(),C()]}function CB(t,e){for(let i=0;i<RO;i++)JG(t[i],e[i]);return t}function kIe(t,e,i,r=ddt){const s=vr(Ise.get(),e,t);eo(s,s);for(let n=0;n<udt;++n){const o=Vu(Rse.get(),hdt[n],s);pe(r[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}UIe(i,r)}function UIe(t,e){hl(e[vt.FAR_BOTTOM_LEFT],e[vt.NEAR_BOTTOM_LEFT],e[vt.NEAR_TOP_LEFT],t[Er.LEFT]),hl(e[vt.NEAR_BOTTOM_RIGHT],e[vt.FAR_BOTTOM_RIGHT],e[vt.FAR_TOP_RIGHT],t[Er.RIGHT]),hl(e[vt.FAR_BOTTOM_LEFT],e[vt.FAR_BOTTOM_RIGHT],e[vt.NEAR_BOTTOM_RIGHT],t[Er.BOTTOM]),hl(e[vt.NEAR_TOP_LEFT],e[vt.NEAR_TOP_RIGHT],e[vt.FAR_TOP_RIGHT],t[Er.TOP]),hl(e[vt.NEAR_BOTTOM_LEFT],e[vt.NEAR_BOTTOM_RIGHT],e[vt.NEAR_TOP_RIGHT],t[Er.NEAR]),hl(e[vt.FAR_BOTTOM_RIGHT],e[vt.FAR_BOTTOM_LEFT],e[vt.FAR_TOP_LEFT],t[Er.FAR])}function cb(t,e){for(let i=0;i<RO;i++){const r=t[i];if(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=e[3])return!1}return!0}function adt(t,e){return zIe(t,ndt(e,BIe.get()))}function kQt(t,e){for(let i=0;i<RO;i++){const r=t[i];if(!Ztt(r,e))return!1}return!0}function ldt(t,e,i){return zIe(t,odt(e,i,BIe.get()))}function VIe(t,e){for(let i=0;i<RO;i++)if(Rr(t[i],e)>0)return!1;return!0}function zIe(t,e){for(let i=0;i<RO;i++)if(!Wtt(t[i],e))return!1;return!0}var Er,vt;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(Er||(Er={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(vt||(vt={}));const cdt={bottom:[vt.FAR_BOTTOM_RIGHT,vt.NEAR_BOTTOM_RIGHT,vt.NEAR_BOTTOM_LEFT,vt.FAR_BOTTOM_LEFT],near:[vt.NEAR_BOTTOM_LEFT,vt.NEAR_BOTTOM_RIGHT,vt.NEAR_TOP_RIGHT,vt.NEAR_TOP_LEFT],far:[vt.FAR_BOTTOM_RIGHT,vt.FAR_BOTTOM_LEFT,vt.FAR_TOP_LEFT,vt.FAR_TOP_RIGHT],right:[vt.NEAR_BOTTOM_RIGHT,vt.FAR_BOTTOM_RIGHT,vt.FAR_TOP_RIGHT,vt.NEAR_TOP_RIGHT],left:[vt.FAR_BOTTOM_LEFT,vt.NEAR_BOTTOM_LEFT,vt.NEAR_TOP_LEFT,vt.FAR_TOP_LEFT],top:[vt.FAR_TOP_LEFT,vt.NEAR_TOP_LEFT,vt.NEAR_TOP_RIGHT,vt.FAR_TOP_RIGHT]},RO=6,udt=8,hdt=[ri(-1,-1,-1,1),ri(1,-1,-1,1),ri(1,1,-1,1),ri(-1,1,-1,1),ri(-1,-1,1,1),ri(1,-1,1,1),ri(1,1,1,1),ri(-1,1,1,1)],BIe=new B_(P6),ddt=FIe();function pdt(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}function fdt(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}function mdt(t,e,i){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}function gdt(t,e,i){return 2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}let fQ=class{constructor(){this.adds=new ai,this.removes=new ai,this.updates=new ai({allocator:e=>e||new ydt,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},ydt=class{},_dt=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var Of,gi;function jIe(t){const e=new Map,i=r=>{let s=e.get(r);return s||(s=new _dt,e.set(r,s)),s};return t.removes.forAll(r=>{yq(r)&&i(r.material).removes.push(r)}),t.adds.forAll(r=>{yq(r)&&i(r.material).adds.push(r)}),t.updates.forAll(r=>{yq(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),e}function yq(t){return t.geometry.indexCount>=1}(function(t){t[t.Default=0]="Default",t[t.Screenshot=1]="Screenshot",t[t.ObjectAndLayerID=2]="ObjectAndLayerID"})(Of||(Of={})),function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"}(gi||(gi={}));var mQ;let mi=mQ=class extends Ue{constructor(t){super(t),this._ray=mo(),this._viewport=ri(0,0,1,1),this._padding=ri(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Ei(1,1e3),this._viewDirty=!0,this._viewMatrix=ke(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=ke(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=ke(),this._frustumDirty=!0,this._frustum=QL(),this._fullViewport=ci(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=C(),this._up=C(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get rows(){return this._rows}set rows(t){this._rows=Math.max(1,t)}get columns(){return this._columns}set columns(t){this._columns=Math.max(1,t)}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return $e(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){An(this._viewMatrix,t),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),pe(C(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),pe(C(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),pe(C(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=g2(ci(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&y2(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=g2(ci(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&y2(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[gi.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[gi.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[gi.RIGHT]+this._padding[gi.LEFT]}set fullWidth(t){this.width=t-(this._padding[gi.RIGHT]+this._padding[gi.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[gi.TOP]+this._padding[gi.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[gi.TOP]+this._padding[gi.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[gi.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[gi.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){EA(this._padding,t)||(this._viewport[0]+=t[gi.LEFT]-this._padding[gi.LEFT],this._viewport[1]+=t[gi.BOTTOM]-this._padding[gi.BOTTOM],this._viewport[2]-=t[gi.RIGHT]+t[gi.LEFT]-(this._padding[gi.RIGHT]+this._padding[gi.LEFT]),this._viewport[3]-=t[gi.TOP]+t[gi.BOTTOM]-(this._padding[gi.TOP]+this._padding[gi.BOTTOM]),np(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(vr(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return eo(ke(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||ke()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return mdt(this._fov,this.width,this.height)}set fovX(t){this._fov=pdt(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return gdt(this._fov,this.width,this.height)}set fovY(t){this._fov=fdt(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Ar(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(eo(this._viewInverseTransposeMatrix,this.viewMatrix),Hu(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}get _projectionMatrixInternal(){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2)*2,r=i*this._aspect,s=i/this.rows,n=r/this.columns,o=-r/2+this.column*n,a=o+n,l=-i/2+this.row*s,c=l+s,u=YCe(ke(),o*(1+2*this._padding[gi.LEFT]/t),a*(1+2*this._padding[gi.RIGHT]/t),l*(1+2*this._padding[gi.BOTTOM]/e),c*(1+2*this._padding[gi.TOP]/e),this.near,this.far),d=this._get("projectionMatrix");return d&&LG(d,u)?d:u}copyFrom(t){ve(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,np(this._viewport,t.viewport),this.notifyChange("_viewport"),np(this._padding,t.padding),this.notifyChange("_padding"),Ga(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.row=t.row,this.column=t.column,this.rows=t.rows,this.columns=t.columns,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(An(this._viewMatrix,t.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(CB(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(An(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),np(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new mQ().copyFrom(this)}equals(t){return Uo(this.eye,t.eye)&&Uo(this.center,t.center)&&Uo(this.up,t.up)&&EA(this._viewport,t.viewport)&&EA(this._padding,t.padding)&&GRe(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation&&this.row===t.row&&this.column===t.column&&this.rows===t.rows&&this.columns===t.columns}almostEquals(t){const e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||oB(t.screenPadding,this.screenPadding)>=e||oB(this.screenViewport,t.screenViewport)>=e||this.row!==t.row||this.column!==t.column||this.rows!==t.rows||this.columns!==t.columns)return!1;Li(Wa,t.eye,t.center),Li(_q,this.eye,this.center);const i=Te(Wa,_q),r=Gz(Wa),s=Gz(_q),n=5e-4;return i*i>=(1-1e-10)*r*s&&IL(t.eye,this.eye)<Math.max(r,s)*n*n}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(bb(this.viewForward,$e(Wa,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=Os()){return t[0]=(this.padding[gi.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[gi.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t[0]=this.padding[gi.LEFT]+this.width*e,t[1]=this.padding[gi.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==Vi&&ve(Vi,t),Vi[3]=1,Vu(Vi,Vi,this.projectionMatrix);const i=Math.abs(Vi[3]);de(Vi,Vi,1/i);const r=this.fullViewport;e[0]=Bt(0,r[0]+r[2],.5+.5*Vi[0]),e[1]=Bt(0,r[1]+r[3],.5+.5*Vi[1]),e[2]=.5*(Vi[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;Vi[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],Vi[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],Vi[2]=(2*t[2]-1)*t[3],Vi[3]=t[3],this.inverseProjectionMatrix!=null&&(Vu(Vi,Vi,this.inverseProjectionMatrix),e[0]=Vi[0],e[1]=Vi[1],e[2]=Vi[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,vq),this.renderToScreen(vq,e),e}projectToRenderScreen(t,e){if(Vi[0]=t[0],Vi[1]=t[1],Vi[2]=t[2],Vi[3]=1,Vu(Vi,Vi,this.viewProjectionMatrix),Vi[3]===0)return null;const i=Vi;de(i,i,1/Math.abs(Vi[3]));const r=this.fullViewport,s=Bt(0,r[0]+r[2],.5+.5*i[0]),n=Bt(0,r[1]+r[3],.5+.5*i[1]);return"x"in e?(e.x=s,e.y=n):(e[0]=s,e[1]=n,e.length>2&&(e[2]=.5*(i[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,vq),e)}unprojectFromRenderScreen(t,e){if(vr(t4,this.projectionMatrix,this.viewMatrix),!eo(t4,t4))return null;const i=this.fullViewport;return Vi[0]=2*(t[0]-i[0])/i[2]-1,Vi[1]=2*(t[1]-i[1])/i[3]-1,Vi[2]=2*t[2]-1,Vi[3]=1,Vu(Vi,Vi,t4),Vi[3]===0?null:(e[0]=Vi[0]/Vi[3],e[1]=Vi[1]/Vi[3],e[2]=Vi[2]/Vi[3],e)}constrainWindowSize(t,e,i,r){const s=t*this.pixelRatio,n=e*this.pixelRatio,o=Math.max(s-i/2,0),a=Math.max(this.fullHeight-n-r/2,0),l=-Math.min(s-i/2,0),c=-Math.min(this.fullHeight-n-r/2,0),u=i-l- -Math.min(this.fullWidth-s-i/2,0),d=r-c- -Math.min(n-r/2,0);return[Math.round(o),Math.round(a),Math.round(u),Math.round(d)]}computeUp(t){t===Je.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=r}_computeUpGlobal(){$e(Wa,this.center,this.eye);const t=Ve(this.center);t<1?(pe(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(Te(Wa,this.center))>.9999*Ve(Wa)*t||(mt(this._up,Wa,this.center),mt(this._up,this._up,Wa),Ce(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){U_(Wa,this.eye,this.center),Math.abs(Wa[2])<=.9999&&(de(Wa,Wa,Wa[2]),pe(this._up,-Wa[0],-Wa[1],1-Wa[2]),Ce(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,i=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?Uo(t,e)||(ve(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):ne.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(kIe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(IG(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};h([p()],mi.prototype,"_viewport",void 0),h([p()],mi.prototype,"_padding",void 0),h([p()],mi.prototype,"_fov",void 0),h([p()],mi.prototype,"_nearFar",void 0),h([p()],mi.prototype,"_viewDirty",void 0),h([p()],mi.prototype,"_viewMatrix",void 0),h([p()],mi.prototype,"_pixelRatio",void 0),h([p()],mi.prototype,"pixelRatio",null),h([p()],mi.prototype,"row",void 0),h([p()],mi.prototype,"column",void 0),h([p()],mi.prototype,"_rows",void 0),h([p()],mi.prototype,"rows",null),h([p()],mi.prototype,"_columns",void 0),h([p()],mi.prototype,"columns",null),h([p()],mi.prototype,"eye",null),h([p()],mi.prototype,"center",null),h([p()],mi.prototype,"_center",void 0),h([p()],mi.prototype,"up",null),h([p()],mi.prototype,"_up",void 0),h([p()],mi.prototype,"viewMatrix",null),h([p({readOnly:!0})],mi.prototype,"viewForward",null),h([p({readOnly:!0})],mi.prototype,"viewUp",null),h([p({readOnly:!0})],mi.prototype,"viewRight",null),h([p({readOnly:!0})],mi.prototype,"nearFar",null),h([p()],mi.prototype,"near",null),h([p()],mi.prototype,"far",null),h([p()],mi.prototype,"viewport",null),h([p({readOnly:!0})],mi.prototype,"screenViewport",null),h([p({readOnly:!0})],mi.prototype,"screenPadding",null),h([p()],mi.prototype,"x",null),h([p()],mi.prototype,"y",null),h([p()],mi.prototype,"width",null),h([p()],mi.prototype,"height",null),h([p()],mi.prototype,"fullWidth",null),h([p()],mi.prototype,"fullHeight",null),h([p({readOnly:!0})],mi.prototype,"_aspect",null),h([p()],mi.prototype,"padding",null),h([p({readOnly:!0})],mi.prototype,"projectionMatrix",null),h([p({readOnly:!0})],mi.prototype,"inverseProjectionMatrix",null),h([p()],mi.prototype,"fov",null),h([p()],mi.prototype,"fovX",null),h([p()],mi.prototype,"fovY",null),h([p()],mi.prototype,"viewInverseTransposeMatrix",null),h([p({readOnly:!0})],mi.prototype,"_projectionMatrixInternal",null),h([p()],mi.prototype,"relativeElevation",void 0),mi=mQ=h([I("esri.views.3d.webgl.RenderCamera")],mi);const Fr=mi,Vi=ci(),t4=ke(),Wa=C(),_q=C(),vq=ka();var Uc;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(Uc||(Uc={}));function vdt(t){t.include($y),t.uniforms.add(new xt("geometryDepthTexture",(e,i)=>{var r;return(r=i.multipassGeometry.depth)==null?void 0:r.attachment})),t.code.add(S`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);
return (elementDepth < (geometryDepth - 1.0));
}`)}let bdt=class{};function Uy(t,e){if(!e.multipassEnabled)return;t.fragment.include($y),t.fragment.uniforms.add(new xt("terrainDepthTexture",(r,s)=>{var n;return(n=s.multipassTerrain.depth)==null?void 0:n.attachment}));const i=e.occlusionPass;t.fragment.code.add(S`
   ${i?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${i?S`return fragmentDepth < linearDepth && depth < 1.0;`:S`
          if(fragmentDepth ${e.cullAboveGround?">":"<="} linearDepth){
            discard;
          }`}
    }`)}let wdt=class{constructor(){this.cullAboveGround=!1}};var Pe;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.OPAQUE_NO_SSAO_DEPTH=3]="OPAQUE_NO_SSAO_DEPTH",t[t.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_NO_SSAO_DEPTH=5]="TRANSPARENT_NO_SSAO_DEPTH",t[t.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=7]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",t[t.OPAQUE_ENVIRONMENT=12]="OPAQUE_ENVIRONMENT",t[t.TRANSPARENT_ENVIRONMENT=13]="TRANSPARENT_ENVIRONMENT",t[t.LASERLINES=14]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=15]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=16]="HUD_MATERIAL",t[t.LABEL_MATERIAL=17]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=18]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=19]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=20]="DRAPED_MATERIAL",t[t.DRAPED_WATER=21]="DRAPED_WATER",t[t.VIEWSHED=22]="VIEWSHED",t[t.VOXEL=23]="VOXEL",t[t.MAX_SLOTS=24]="MAX_SLOTS"})(Pe||(Pe={}));var ft;(function(t){t[t.ColorAlpha=0]="ColorAlpha",t[t.FrontFace=1]="FrontFace",t[t.NONE=2]="NONE",t[t.COUNT=3]="COUNT"})(ft||(ft={}));let Qne=class{constructor(e=C()){this.intensity=e}},GIe=class{constructor(e=C(),i=qe(.57735,.57735,.57735)){this.intensity=e,this.direction=i}},MB=class{constructor(e=C(),i=qe(.57735,.57735,.57735),r=!0,s=1,n=1){this.intensity=e,this.direction=i,this.castShadows=r,this.specularStrength=s,this.environmentStrength=n}},HIe=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function xdt(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e[r];return i}function bq(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e;return i}function RA(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]+e[r];return i}function qIe(t){return(t+1)*(t+1)}function Tdt(t){return Ne(Math.floor(Math.sqrt(t)-1),0,2)}function WIe(t,e,i){const r=t[0],s=t[1],n=t[2],o=i||[];return o.length=qIe(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*n,o[3]=.4886025119*s),e>=2&&(o[4]=1.09254843059*r*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*r*n,o[8]=.54627421529*(r*r-s*s)),o}function Sdt(t,e){const i=qIe(t),r=e||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let s=0;s<i;s++)r.r[s]=r.g[s]=r.b[s]=0;return r}function Edt(t,e){const i=Tdt(e.r.length);for(const r of t)da(gQ,r.direction),WIe(gQ,i,e_),xdt(e_,UU),bq(e_,r.intensity[0],EE),RA(e.r,EE),bq(e_,r.intensity[1],EE),RA(e.g,EE),bq(e_,r.intensity[2],EE),RA(e.b,EE);return e}function Cdt(t,e){WIe(gQ,0,e_);for(const i of t)e.r[0]+=e_[0]*UU[0]*i.intensity[0]*4*Math.PI,e.g[0]+=e_[0]*UU[0]*i.intensity[1]*4*Math.PI,e.b[0]+=e_[0]*UU[0]*i.intensity[2]*4*Math.PI;return e}function Mdt(t,e,i,r){Sdt(e,r),pe(i.intensity,0,0,0);let s=!1;const n=Adt,o=Pdt,a=Odt;n.length=0,o.length=0,a.length=0;for(const l of t)l instanceof MB&&!s?(ve(i.direction,l.direction),ve(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,s=!0):l instanceof MB||l instanceof GIe?n.push(l):l instanceof Qne?o.push(l):l instanceof HIe&&a.push(l);Edt(n,r),Cdt(o,r);for(const l of a)RA(r.r,l.r),RA(r.g,l.g),RA(r.b,l.b)}const Adt=[],Pdt=[],Odt=[],e_=[0],EE=[0],gQ=C(),UU=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let jfe=class{constructor(){this.color=C(),this.intensity=1}},$dt=class{constructor(){this.direction=C(),this.ambient=new jfe,this.diffuse=new jfe}};const ZIe=.4;let wq=class{constructor(){this._shOrder=2,this._legacy=new $dt,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new HIe,this._mainLight=new MB(C(),qe(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){Mdt(e,this._shOrder,this._mainLight,this._sphericalHarmonics),ve(this._legacy.direction,this._mainLight.direction);const i=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,de(this._legacy.diffuse.color,this._mainLight.intensity,i),ve(i4,this._legacy.diffuse.color),de(i4,i4,ZIe*this.globalFactor),Ee(this._legacy.ambient.color,this._legacy.ambient.color,i4)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),ve(this._mainLight.direction,e.mainLight.direction),ve(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,i,r){if(Sr(this._mainLight.intensity,e.mainLight.intensity,i.mainLight.intensity,r),this._mainLight.environmentStrength=Bt(e.mainLight.environmentStrength,i.mainLight.environmentStrength,r),this._mainLight.specularStrength=Bt(e.mainLight.specularStrength,i.mainLight.specularStrength,r),ve(this._mainLight.direction,i.mainLight.direction),this._mainLight.castShadows=i.mainLight.castShadows,this.globalFactor=Bt(e.globalFactor,i.globalFactor,r),this.noonFactor=Bt(e.noonFactor,i.noonFactor,r),e.sh.r.length===i.sh.r.length)for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=Bt(e.sh.r[s],i.sh.r[s],r),this._sphericalHarmonics.g[s]=Bt(e.sh.g[s],i.sh.g[s],r),this._sphericalHarmonics.b[s]=Bt(e.sh.b[s],i.sh.b[s],r);else for(let s=0;s<i.sh.r.length;s++)this._sphericalHarmonics.r[s]=i.sh.r[s],this._sphericalHarmonics.g[s]=i.sh.g[s],this._sphericalHarmonics.b[s]=i.sh.b[s]}};const i4=C();let O6=class{constructor(e,i){this.shadowMap=e,this.slicePlane=i,this.slot=Pe.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=ft.NONE,this.alignPixelEnabled=!1,this.decorations=rc.ON,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new Fr,this._inverseViewport=gt(),this.oldLighting=new wq,this.newLighting=new wq,this._fadedLighting=new wq,this._lighting=this.newLighting,this.ssr=new Rdt,this.multipassEnabled=!1,this.multipassTerrain=new wdt,this.multipassGeometry=new bdt,this.hudRenderStyle=Uc.Occluded,this.cloudsFade=new Iht,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:i,newLighting:r}=this;e>=1?this._lighting=r:(this._fadedLighting.lerpLighting(i,r,e),this._lighting=this._fadedLighting)}},Rdt=class{constructor(){this.fadeFactor=1,this.reprojectionMatrix=ke()}},Pc=class extends Ue{constructor(e){super(e),this._techniques=new Array,this._techniqueConfiguration=new FU,this._bindParameters=new O6(null,null),this._passParameters=new Xne,this._weatherTile=gt(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=Bt(il.default.coverage[0],il.default.coverage[1],.5),this.density=Bt(il.default.density[0],il.default.density[1],.5),this.absorption=Bt(il.default.absorption[0],il.default.absorption[1],.5),this.cloudSize=Bt(il.default.cloudSize[0],il.default.cloudSize[1],.5),this.detailSize=Bt(il.default.detailSize[0],il.default.detailSize[1],.5),this.smoothness=Bt(il.default.smoothness[0],il.default.smoothness[1],.5),this.cloudHeight=Bt(il.default.cloudHeight[0],il.default.cloudHeight[1],.5),this.raymarchingSteps=il.default.raymarchingSteps,this._viewMatrix=ke(),this._dirty=!1,this.running=!1,this._vao=Ny(e.context.renderContext.rctx)}_getTechnique(e){const i=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,r=i===x2.RG?2*e:2*e+1;return this._techniques[r]||(this._techniqueConfiguration.writeTextureChannels=i,this._techniqueConfiguration.steps=e,this._techniques[r]=new OIe({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[r])}updateWeatherTile(){const e=this.view.camera.position.latitude,i=this.view.camera.position.longitude;if(e==null||i==null)return;Di(this._weatherTile,(e+90)/180,(i+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-r)*this._weatherTile[1]);let s=0,n=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+s)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+n%100)%(4*this._weatherTileCount),HRe(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=br(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this.addHandles([this.view.resourceController.scheduler.registerTask(It.CLOUDS_GENERATOR,this),te(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),pt)])}destroy(){this._techniques.forEach(e=>hi(e)),this._frameBufferCube=Ut(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=He(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case qc.SIXTEEN:return 1;case qc.HUNDRED:return 4;case qc.COUNT:case qc.TWOHUNDRED:return 8}}get usedMemory(){var e,i,r;return(((e=this._frameBufferCube)==null?void 0:e.usedMemory)??0)+(((r=(i=this._passParameters.noiseTexture)==null?void 0:i.textureAtlas)==null?void 0:r.usedMemory)??0)}_ensureNoiseTexture(){var e;return(e=this._passParameters).noiseTexture??(e.noiseTexture=new cI({context:this.context})),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile),this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const i=new es(e);i.target=js.TEXTURE_CUBE_MAP,i.wrapMode=Ai.CLAMP_TO_EDGE,this._frameBufferCube=new ky(this.context.renderContext.rctx,i)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=Ut(this._frameBufferCube)}applyPreset(e,i){const r=e.median,s=n=>{const o=Bt(n[0],n[1],r);return i<.5?Bt(n[0],o,2*i):Bt(o,n[1],2*(i-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),Ga(this._passParameters.weatherTile,this._weatherTile));const i=this._getTechnique(this._passParameters.raymarchingSteps);if(!i.compiled||this.context.renderContext.bindParameters.cloudsFade.fadeMode===Zr.CROSS_FADE||!this._ensureNoiseTexture())return pa;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=qg.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const r=Idt[this._faceIndex],s=Ldt[this._faceIndex];JCe(this._viewMatrix,Ddt,r,s),wp(this._passParameters.viewMatrix,this._viewMatrix);const n=this.context.renderContext.rctx,o=n.bindTechnique(i,this._bindParameters,this._passParameters);n.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao);const a=n.getViewport(),l=i.configuration.cubeMapSize,c=l/this._tilesPerFace,u=this._tileIndex*c;n.setViewport(0,u,l,c);const d=this._ensureFrameBufferCube(l);n.bindFramebuffer(d);const f=js.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return d.setColorTextureTarget(f),n.gl.drawArrays(n.gl.TRIANGLE_STRIP,0,4),n.gl.flush(),n.setViewport(a.x,a.y,a.width,a.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.running||(this.context.renderContext.bindParameters.cloudsFade.renderingStage=qg.FADING)):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),pa}};h([p({constructOnly:!0})],Pc.prototype,"context",void 0),h([p({constructOnly:!0})],Pc.prototype,"view",void 0),h([p({constructOnly:!0})],Pc.prototype,"requestRender",void 0),h([p()],Pc.prototype,"coverage",void 0),h([p()],Pc.prototype,"density",void 0),h([p()],Pc.prototype,"absorption",void 0),h([p()],Pc.prototype,"cloudSize",void 0),h([p()],Pc.prototype,"detailSize",void 0),h([p()],Pc.prototype,"smoothness",void 0),h([p()],Pc.prototype,"cloudHeight",void 0),h([p()],Pc.prototype,"raymarchingSteps",void 0),h([p()],Pc.prototype,"running",void 0),Pc=h([I("esri.views.3d.environment.CloudsGenerator")],Pc);const Idt=[$r(1,0,0),$r(-1,0,0),$r(0,1,0),$r(0,-1,0),$r(0,0,1)],Ldt=[$r(0,1,0),$r(0,1,0),$r(0,0,-1),$r(0,0,1),$r(0,1,0)],Ddt=Yne();let Kne=class extends Ur{constructor(){super(...arguments),this.fogColor=C(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function YIe(){const t=new Hi;t.attributes.add($.POSITION,"vec2"),t.include(Hf,{textureCoordinateType:Es.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:e,fragment:i}=t;return e.uniforms.add(new fs("inverseProjectionMatrix",(r,s)=>s.camera.inverseProjectionMatrix),new fs("inverseViewMatrix",(r,s)=>fw(Ndt,s.camera.viewMatrix))),e.code.add(S`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new tt("atmosphereC",r=>r.atmosphereC),new Wt("cameraPosition",(r,s)=>s.camera.eye),new Hr("nearFar",(r,s)=>s.camera.nearFar),new xt("depthTexture",r=>r.depthTexture),new tt("fogStrength",r=>r.fogStrength),new tt("fogAmount",r=>r.fogAmount),new Wt("fogColor",r=>r.fogColor)),t.include(M6),i.include(Fne),i.code.add(S`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(S`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),i.code.add(S`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),t}const Ndt=ke(),Fdt=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:Kne,build:YIe},Symbol.toStringTag,{value:"Module"}));let XIe=class JIe extends Ki{constructor(e){super(e,new uc,()=>this.destroy())}initializeProgram(e){return new er(e.rctx,JIe.shader.get().build(),Pi)}initializePipeline(){return Kt({blending:_a(Be.SRC_ALPHA,Be.ZERO,Be.ONE_MINUS_SRC_ALPHA,Be.ONE),colorWrite:ui})}};XIe.shader=new qi(Fdt,()=>oe(()=>Promise.resolve().then(()=>b9t),void 0));const kdt=.95,Udt=1;let oT=class extends Ue{constructor(e){super(e),this._passParameters=new Kne;const i=e.context.renderContext.rctx;this._vao=Ny(i,uN),this._technique=new XIe(e);const r=br(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+k1}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,i){if(this._update(e,i),this._passParameters.fogAmount<=0)return;const r=this._technique;if(!r.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper;s.renderDepthDetached(()=>{this._passParameters.depthTexture=s.depthTexture;const n=e.rctx.bindTechnique(r,e.bindParameters,this._passParameters);this._renderFog(n,e)})}_renderFog(e,i){const r=i.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Mi.TRIANGLE_STRIP,0,4)}_update(e,i){const r=e.bindParameters.camera;Ce(Gfe,r.eye);const s=Math.max(0,Te(Gfe,e.bindParameters.lighting.mainLight.direction)),n=i.color;de(Hfe,n,.1),Sr(this._passParameters.fogColor,Hfe,n,s);const o=Ve(r.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-DL(kdt*X0,Udt*X0,Math.abs(o-this._planetRadius)))*i.amount,this._passParameters.fogStrength=i.strength}};h([p({constructOnly:!0})],oT.prototype,"context",void 0),h([p({constructOnly:!0})],oT.prototype,"view",void 0),h([p({constructOnly:!0})],oT.prototype,"rctx",void 0),h([p({constructOnly:!0})],oT.prototype,"viewingMode",void 0),oT=h([I("esri.views.3d.environment.Fog")],oT);let Vdt=class{constructor(){this.color=C(),this.strength=0,this.amount=0}};const Gfe=C(),Hfe=C();var G;function zdt(t){return IA(t)||t===G.Depth||t===G.Normal||t===G.ObjectAndLayerIdColor}function IA(t){return t===G.Shadow||t===G.ShadowHighlight||t===G.ShadowExcludeHighlight||t===G.ViewshedShadow}function k3(t){return yQ(t)||t===G.Normal}function zS(t){return t===G.Highlight||t===G.ObjectAndLayerIdColor}function QIe(t){return t===G.Color||zS(t)}function __(t){return t===G.Color}function xq(t){return __(t)||t===G.ObjectAndLayerIdColor}function Bdt(t){return __(t)||t===G.Highlight}function qfe(t){return Bdt(t)||Cb(t)}function VU(t){return __(t)||zS(t)}function yQ(t){return VU(t)||Cb(t)}function Cb(t){return t===G.Depth}(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.ViewshedShadow=6]="ViewshedShadow",t[t.Highlight=7]="Highlight",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.COUNT=9]="COUNT"})(G||(G={}));function eoe({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(S`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(S`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let KIe=class extends qs{constructor(e,i){super(e,"mat4",Yi.Draw,(r,s,n)=>r.setUniformMatrix4fv(e,i(s,n)))}};function fm(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",Nn):t.uniforms.add(new Wh("cameraPosition",(i,r)=>pe(e3e,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function Wc(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new fs("proj",(r,s)=>s.camera.projectionMatrix),new KIe("view",(r,s)=>wl(Wfe,s.camera.viewMatrix,r.origin)),new Wh("localOrigin",r=>r.origin));const i=r=>pe(e3e,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]);t.uniforms.add(new fs("proj",(r,s)=>s.camera.projectionMatrix),new fs("view",(r,s)=>wl(Wfe,s.camera.viewMatrix,i(s))),new Wt("localOrigin",(r,s)=>i(s)))}const Wfe=ke(),e3e=C();function VP(t){t.uniforms.add(new fs("viewNormal",(e,i)=>i.camera.viewInverseTransposeMatrix))}function IO(t){t.uniforms.add(new tt("pixelRatio",(e,i)=>i.camera.pixelRatio/i.overlayStretch))}function _Q(t,e,i){for(let r=0;r<i;++r)e[2*r]=t[r],e[2*r+1]=t[r]-e[2*r]}function jdt(t,e){const i=t.length;for(let r=0;r<i;++r)BM[0]=t[r],e[r]=BM[0];return e}function Gdt(t,e){const i=t.length;for(let r=0;r<i;++r)BM[0]=t[r],BM[1]=t[r]-BM[0],e[r]=BM[1];return e}const BM=new Float32Array(2);let vQ=class extends uc{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}};h([j()],vQ.prototype,"instancedDoublePrecision",void 0),h([j()],vQ.prototype,"hasModelTransformation",void 0);const Zfe=Kr();function t3e(t,e){const i=e.hasModelTransformation,r=e.instancedDoublePrecision;i&&(t.vertex.uniforms.add(new fs("model",n=>n.modelTransformation??Jr)),t.vertex.uniforms.add(new xp("normalLocalOriginFromModel",n=>(Yb(Zfe,n.modelTransformation??Jr),Zfe)))),e.instanced&&r&&(t.attributes.add($.INSTANCEMODELORIGINHI,"vec3"),t.attributes.add($.INSTANCEMODELORIGINLO,"vec3"),t.attributes.add($.INSTANCEMODEL,"mat3"),t.attributes.add($.INSTANCEMODELNORMAL,"mat3"));const s=t.vertex;r&&(s.include(eoe,e),s.uniforms.add(new Wh("viewOriginHi",(n,o)=>jdt(pe(r4,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),r4)),new Wh("viewOriginLo",(n,o)=>Gdt(pe(r4,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),r4)))),s.code.add(S`
    vec3 getVertexInLocalOriginSpace() {
      return ${i?r?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":r?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${r?S`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),s.code.add(S`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${i?r?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":r?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),e.output===G.Normal&&(VP(s),s.code.add(S`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${i?r?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":r?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),e.hasVertexTangents&&s.code.add(S`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${i?r?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":r?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const r4=C();let Xc=class extends vQ{};h([j({constValue:!0})],Xc.prototype,"hasSliceHighlight",void 0),h([j({constValue:!1})],Xc.prototype,"hasSliceInVertexProgram",void 0),h([j({constValue:Yi.Pass})],Xc.prototype,"pbrTextureBindType",void 0);var wy;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(wy||(wy={}));let toe=class extends Xc{constructor(){super(...arguments),this.geometry=wy.Cone}};h([j({count:wy.COUNT})],toe.prototype,"geometry",void 0);function dN(t){t.attributes.add($.POSITION,"vec3"),t.vertex.code.add(S`vec3 positionModel() { return position; }`)}let AB=class extends qs{constructor(e,i){super(e,"mat3",Yi.Draw,(r,s,n)=>r.setUniformMatrix3fv(e,i(s,n)))}};function LA(t,e){t.include(dN);const i=t.vertex;i.include(eoe,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),i.uniforms.add(new Wt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH),new Wt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new xp("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new fs("transformProjFromView",r=>r.transformProjFromView),new AB("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Wh("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Wh("transformWorldFromModelTL",r=>r.transformWorldFromModelTL)),i.code.add(S`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(S`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?S`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:S`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new Wt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL)),i.code.add(S`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(S`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let Hdt=class extends Ur{constructor(){super(...arguments),this.transformWorldFromViewTH=C(),this.transformWorldFromViewTL=C(),this.transformViewFromCameraRelativeRS=Kr(),this.transformProjFromView=ke()}},qdt=class extends Ur{constructor(){super(...arguments),this.transformWorldFromModelRS=Kr(),this.transformWorldFromModelTH=C(),this.transformWorldFromModelTL=C()}};function bQ(t){t.varyings.add("linearDepth","float")}function $6(t){t.vertex.uniforms.add(new Hr("nearFar",(e,i)=>i.camera.nearFar))}function i3e(t){t.vertex.code.add(S`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function LO(t,e){const{vertex:i}=t;switch(e.output){case G.Color:if(e.receiveShadows)return bQ(t),void i.code.add(S`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case G.Shadow:case G.ShadowHighlight:case G.ShadowExcludeHighlight:case G.ViewshedShadow:return t.include(LA,e),bQ(t),$6(t),i3e(t),void i.code.add(S`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}i.code.add(S`void forwardLinearDepth() {}`)}function gl(t){i3e(t),t.vertex.code.add(S`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(S`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let R6=class extends Ur{constructor(){super(...arguments),this.texV=gt(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new ioe}},ioe=class{constructor(){this.center=C(),this.v1=C(),this.v2=C()}};function r3e(t){const e=new Hi,{vertex:i,fragment:r}=e;if(q_(i),t.geometry===wy.Underground)e.attributes.add($.POSITION,"vec2"),e.varyings.add("color","vec4"),i.uniforms.add(new Wt("cameraPosition",(s,n)=>n.camera.eye),new tt("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)),i.code.add(S`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),r.code.add(S`void main() {
fragColor = color;
}`);else{e.include(gl,t),e.attributes.add($.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const s=t.geometry===wy.Cylinder;i.uniforms.add(new fs("proj",(a,l)=>l.camera.projectionMatrix),new fs("view",(a,l)=>l.camera.viewMatrix)),s||(e.varyings.add("innerFactor","float"),i.uniforms.add(new Wt("silCircleCenter",a=>a.silhouette.center)),i.uniforms.add(new Wt("silCircleV1",a=>a.silhouette.v1)),i.uniforms.add(new Wt("silCircleV2",a=>a.silhouette.v2)),i.uniforms.add(new Hr("texV",a=>a.texV)),i.uniforms.add(new tt("innerScale",a=>a.innerScale)));const n=6.2831853,o=1/128;i.code.add(S`
		void main(void) {
      ${s?S`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:S`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${S.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${S.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),r.uniforms.add(new xt("tex",a=>a.texture)),s||r.uniforms.add(new tt("altitudeFade",a=>a.altitudeFade)),r.code.add(S`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${s?S`fragColor = atmosphereColor;`:S`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const Wdt=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:ioe,SimpleAtmospherePassParameters:R6,build:r3e},Symbol.toStringTag,{value:"Module"}));let PB=class s3e extends Ki{initializeProgram(e){return new er(e.rctx,s3e.shader.get().build(this.configuration),Pi)}initializePipeline(){return this.configuration.geometry===wy.Cylinder?Kt({blending:_a(Be.SRC_ALPHA,Be.ONE,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),culling:kne,depthTest:{func:xr.LEQUAL},colorWrite:ui}):Kt({blending:_a(Be.SRC_ALPHA,Be.ONE,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),depthTest:{func:xr.LEQUAL},colorWrite:ui})}};PB.shader=new qi(Wdt,()=>oe(()=>Promise.resolve().then(()=>w9t),void 0));const Zdt=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function Xu(t,e=0){const i=t.stride;return Array.from(t.fields.keys()).map(r=>{var c;const s=t.fields.get(r),n=s.constructor.ElementCount,o=Ydt(s.constructor.ElementType),a=s.offset,l=((c=s.optional)==null?void 0:c.glNormalized)??!1;return new dm(r,n,o,a,i,l,e)})}function Ydt(t){const e=Xdt[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const Xdt={u8:Et.UNSIGNED_BYTE,u16:Et.UNSIGNED_SHORT,u32:Et.UNSIGNED_INT,i8:Et.BYTE,i16:Et.SHORT,i32:Et.INT,f32:Et.FLOAT};let roe=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<9;s++)i[s]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[r++]=i[s]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};roe.ElementCount=9;let soe=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<16;s++)i[s]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[r++]=i[s]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}};soe.ElementCount=16;let Z_=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,i){this.typedBuffer[e*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}};Z_.ElementCount=1;let Y_=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,Di(i,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e]=i[1]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};Y_.ElementCount=2;let X_=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,pe(i,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e]=i[2]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,s){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=s}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};X_.ElementCount=3;let J_=class{constructor(e,i,r=0,s,n){this.TypedArrayConstructor=e,this.start=r,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,s,this.stride,s+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,Ss(i,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e++]=i[2],this.typedBuffer[e]=i[3]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,s,n){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e++]=s,this.typedBuffer[e]=n}copyFrom(e,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}};J_.ElementCount=4;let I6=class n3e extends Z_{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}static fromTypedArray(e,i){return new n3e(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};I6.ElementType="f32";let rE=class wQ extends Y_{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(wQ,e,i)}static fromTypedArray(e,i){return new wQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};rE.ElementType="f32";let _o=class xQ extends X_{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(xQ,e,i)}static fromTypedArray(e,i){return new xQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};_o.ElementType="f32";let mm=class TQ extends J_{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(TQ,e,i)}static fromTypedArray(e,i){return new TQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};mm.ElementType="f32";let tw=class SQ extends roe{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(SQ,e,i)}static fromTypedArray(e,i){return new SQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};tw.ElementType="f32";let noe=class EQ extends roe{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(EQ,e,i)}static fromTypedArray(e,i){return new EQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};noe.ElementType="f64";let ooe=class CQ extends soe{constructor(e,i=0,r,s){super(Float32Array,e,i,r,s),this.elementType="f32"}slice(e,i){return this.sliceBuffer(CQ,e,i)}static fromTypedArray(e,i){return new CQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ooe.ElementType="f32";let KL=class MQ extends soe{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(MQ,e,i)}static fromTypedArray(e,i){return new MQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};KL.ElementType="f64";let aoe=class AQ extends Z_{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(AQ,e,i)}static fromTypedArray(e,i){return new AQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};aoe.ElementType="f64";let loe=class PQ extends Y_{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(PQ,e,i)}static fromTypedArray(e,i){return new PQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};loe.ElementType="f64";let yp=class OQ extends X_{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer(OQ,e,i)}static fromTypedArray(e,i){return new OQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};yp.ElementType="f64";let L6=class $Q extends J_{constructor(e,i=0,r,s){super(Float64Array,e,i,r,s),this.elementType="f64"}slice(e,i){return this.sliceBuffer($Q,e,i)}static fromTypedArray(e,i){return new $Q(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};L6.ElementType="f64";let zP=class RQ extends Z_{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(RQ,e,i)}static fromTypedArray(e,i){return new RQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};zP.ElementType="u8";let D6=class IQ extends Y_{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(IQ,e,i)}static fromTypedArray(e,i){return new IQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};D6.ElementType="u8";let N6=class LQ extends X_{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(LQ,e,i)}static fromTypedArray(e,i){return new LQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};N6.ElementType="u8";let Sl=class DQ extends J_{constructor(e,i=0,r,s){super(Uint8Array,e,i,r,s),this.elementType="u8"}slice(e,i){return this.sliceBuffer(DQ,e,i)}static fromTypedArray(e,i){return new DQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Sl.ElementType="u8";let F6=class NQ extends Z_{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(NQ,e,i)}static fromTypedArray(e,i){return new NQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};F6.ElementType="u16";let coe=class FQ extends Y_{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(FQ,e,i)}static fromTypedArray(e,i){return new FQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};coe.ElementType="u16";let k6=class kQ extends X_{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(kQ,e,i)}static fromTypedArray(e,i){return new kQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};k6.ElementType="u16";let pN=class UQ extends J_{constructor(e,i=0,r,s){super(Uint16Array,e,i,r,s),this.elementType="u16"}slice(e,i){return this.sliceBuffer(UQ,e,i)}static fromTypedArray(e,i){return new UQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};pN.ElementType="u16";let U6=class VQ extends Z_{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(VQ,e,i)}static fromTypedArray(e,i){return new VQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};U6.ElementType="u32";let uoe=class zQ extends Y_{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(zQ,e,i)}static fromTypedArray(e,i){return new zQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};uoe.ElementType="u32";let o3e=class BQ extends X_{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(BQ,e,i)}static fromTypedArray(e,i){return new BQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};o3e.ElementType="u32";let a3e=class jQ extends J_{constructor(e,i=0,r,s){super(Uint32Array,e,i,r,s),this.elementType="u32"}slice(e,i){return this.sliceBuffer(jQ,e,i)}static fromTypedArray(e,i){return new jQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};a3e.ElementType="u32";let hoe=class GQ extends Z_{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(GQ,e,i)}static fromTypedArray(e,i){return new GQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};hoe.ElementType="i8";let V6=class HQ extends Y_{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(HQ,e,i)}static fromTypedArray(e,i){return new HQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};V6.ElementType="i8";let l3e=class qQ extends X_{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(qQ,e,i)}static fromTypedArray(e,i){return new qQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};l3e.ElementType="i8";let c3e=class WQ extends J_{constructor(e,i=0,r,s){super(Int8Array,e,i,r,s),this.elementType="i8"}slice(e,i){return this.sliceBuffer(WQ,e,i)}static fromTypedArray(e,i){return new WQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};c3e.ElementType="i8";let u3e=class ZQ extends Z_{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(ZQ,e,i)}static fromTypedArray(e,i){return new ZQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};u3e.ElementType="i16";let fN=class YQ extends Y_{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(YQ,e,i)}static fromTypedArray(e,i){return new YQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};fN.ElementType="i16";let h3e=class XQ extends X_{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(XQ,e,i)}static fromTypedArray(e,i){return new XQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};h3e.ElementType="i16";let d3e=class JQ extends J_{constructor(e,i=0,r,s){super(Int16Array,e,i,r,s),this.elementType="i16"}slice(e,i){return this.sliceBuffer(JQ,e,i)}static fromTypedArray(e,i){return new JQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};d3e.ElementType="i16";let p3e=class QQ extends Z_{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(QQ,e,i)}static fromTypedArray(e,i){return new QQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};p3e.ElementType="i32";let f3e=class KQ extends Y_{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(KQ,e,i)}static fromTypedArray(e,i){return new KQ(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};f3e.ElementType="i32";let m3e=class eK extends X_{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(eK,e,i)}static fromTypedArray(e,i){return new eK(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};m3e.ElementType="i32";let g3e=class tK extends J_{constructor(e,i=0,r,s){super(Int32Array,e,i,r,s),this.elementType="i32"}slice(e,i){return this.sliceBuffer(tK,e,i)}static fromTypedArray(e,i){return new tK(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};g3e.ElementType="i32";function Yfe(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let Xfe=class y3e{constructor(e,i){this.layout=e,this.buffer=typeof i=="number"?new ArrayBuffer(i*e.stride):i;for(const r of e.fields.keys()){const s=e.fields.get(r);this[r]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,i){const r=this[e];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(e,i){return new y3e(this.layout,this.buffer.slice(e*this.stride,i*this.stride))}copyFrom(e,i=0,r=0,s=e.count){const n=this.stride;if(n%4==0){const o=new Uint32Array(e.buffer,i*n,s*n/4);new Uint32Array(this.buffer,r*n,s*n/4).set(o)}else{const o=new Uint8Array(e.buffer,i*n,s*n);new Uint8Array(this.buffer,r*n,s*n).set(o)}return this}get usedMemory(){return this.byteLength}dispose(){}},Jdt=class _3e{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(i=>this._fields.set(i[0],{...i[1],constructor:Kdt(i[1].constructor)})))}freeze(){return this}vec2f(e,i){return this._appendField(e,rE,i),this}vec2f64(e,i){return this._appendField(e,loe,i),this}vec3f(e,i){return this._appendField(e,_o,i),this}vec3f64(e,i){return this._appendField(e,yp,i),this}vec4f(e,i){return this._appendField(e,mm,i),this}vec4f64(e,i){return this._appendField(e,L6,i),this}mat3f(e,i){return this._appendField(e,tw,i),this}mat3f64(e,i){return this._appendField(e,noe,i),this}mat4f(e,i){return this._appendField(e,ooe,i),this}mat4f64(e,i){return this._appendField(e,KL,i),this}vec4u8(e,i){return this._appendField(e,Sl,i),this}f32(e,i){return this._appendField(e,I6,i),this}f64(e,i){return this._appendField(e,aoe,i),this}u8(e,i){return this._appendField(e,zP,i),this}u16(e,i){return this._appendField(e,F6,i),this}i8(e,i){return this._appendField(e,hoe,i),this}vec2i8(e,i){return this._appendField(e,V6,i),this}vec2i16(e,i){return this._appendField(e,fN,i),this}vec2u8(e,i){return this._appendField(e,D6,i),this}vec4u16(e,i){return this._appendField(e,pN,i),this}u32(e,i){return this._appendField(e,U6,i),this}_appendField(e,i,r){if(this._fields.has(e))return void bt(!1,`${e} already added to vertex buffer layout`);const s=i.ElementCount*Yfe(i.ElementType),n=this._stride;this._stride+=s,this._fields.set(e,{size:s,constructor:i,offset:n,optional:r})}createBuffer(e){return new Xfe(this,e)}createView(e){return new Xfe(this,e)}clone(){const e=new _3e;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((i,r)=>e._fields.set(r,i)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(i=>e=Math.max(e,Yfe(i.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function Ds(){return new Jdt}let _Kt=class{constructor(e){this.fields=new Array,e.fields.forEach((i,r)=>{const s={...i,constructor:v3e(i.constructor)};this.fields.push([r,s])}),this.stride=e.stride}};const Qdt=[I6,rE,_o,mm,tw,ooe,aoe,loe,yp,L6,noe,KL,zP,D6,N6,Sl,F6,coe,k6,pN,U6,uoe,o3e,a3e,hoe,V6,l3e,c3e,u3e,fN,h3e,d3e,p3e,f3e,m3e,g3e];function v3e(t){return`${t.ElementType}_${t.ElementCount}`}function Kdt(t){return b3e.get(t)}const b3e=new Map;Qdt.forEach(t=>b3e.set(v3e(t),t));function go(t,e=!1){return t<=Yh?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function w3e(t){return(hy(t)?t.length:t.byteLength/8)<=Yh?Array.from(t):new Float64Array(t)}function up(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function ept(t,e){for(let i=0;i<e.length;++i)t[i]=e[i];return t}function bKt(t){return Array.isArray(t)?new Float64Array(t):t}function $s(t,e=!1){return t<=Yh?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function wKt(t){return hy(t)?t.length<Yh?t:new Float32Array(t):t.length<Yh?Array.from(t):t}function Jfe(t){return(hy(t)?t.length:t.byteLength/8)<=Yh?Array.from(t):new Float32Array(t)}function OB(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function oy(t){if(hy(t)){if(t.length<Yh)return t}else if(t.length<Yh)return Array.from(t);let e=!0,i=!0;return t.some((r,s)=>(e=e&&r===0,i=i&&r===s,!e&&!i)),e?Ew(t.length):i?sE(t.length):hy(t)||t.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?tpt(t):t}function tpt(t){let e=!0;for(const i of t){if(i>=65536)return hy(t)?new Uint32Array(t):t;i>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function $B(t){return t<=Yh?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function ipt(t){return t<=Yh?new Array(t):new Uint32Array(t)}let CE=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const x3e=[0],Tq=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function sE(t){if(t===1)return x3e;if(t<Yh)return Array.from(new Uint16Array(Tq.buffer,0,t));if(t<Tq.length)return new Uint16Array(Tq.buffer,0,t);if(t>CE.length){const e=Math.max(2*CE.length,t);CE=new Uint32Array(e);for(let i=0;i<CE.length;i++)CE[i]=i}return new Uint32Array(CE.buffer,0,t)}let s4=new Uint8Array(65536);function Ew(t){if(t===1)return x3e;if(t<Yh)return new Array(t).fill(0);if(t>s4.length){const e=Math.max(2*s4.length,t);s4=new Uint8Array(e)}return new Uint8Array(s4.buffer,0,t)}var iK;(function(t){function e(o,a){const l=o[a],c=o[a+1],u=o[a+2];return Math.sqrt(l*l+c*c+u*u)}function i(o,a){const l=o[a],c=o[a+1],u=o[a+2],d=1/Math.sqrt(l*l+c*c+u*u);o[a]*=d,o[a+1]*=d,o[a+2]*=d}function r(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,u,d=a){(u=u||o)[d]=o[a]+l[c],u[d+1]=o[a+1]+l[c+1],u[d+2]=o[a+2]+l[c+2]}function n(o,a,l,c,u,d=a){(u=u||o)[d]=o[a]-l[c],u[d+1]=o[a+1]-l[c+1],u[d+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=i,t.scale=r,t.add=s,t.subtract=n})(iK||(iK={}));var Gs;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(Gs||(Gs={}));function rpt(t){if(t.length<Yh)return Array.from(t);if(hy(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return uG(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let T3e=class S3e{constructor(e,i,r){this.primitiveIndices=e,this._numIndexPerPrimitive=i,this.position=r,this._children=void 0,bt(e.length>=1),bt(r.size===3||r.size===4);const{data:s,size:n,indices:o}=r;bt(o.length%this._numIndexPerPrimitive==0),bt(o.length>=e.length*this._numIndexPerPrimitive);const a=e.length;let l=n*o[this._numIndexPerPrimitive*e[0]];Ww.clear(),Ww.push(l);const c=qe(s[l],s[l+1],s[l+2]),u=yn(c);for(let m=0;m<a;++m){const g=this._numIndexPerPrimitive*e[m];for(let y=0;y<this._numIndexPerPrimitive;++y){l=n*o[g+y],Ww.push(l);let v=s[l];c[0]=Math.min(v,c[0]),u[0]=Math.max(v,u[0]),v=s[l+1],c[1]=Math.min(v,c[1]),u[1]=Math.max(v,u[1]),v=s[l+2],c[2]=Math.min(v,c[2]),u[2]=Math.max(v,u[2])}}this.bbMin=c,this.bbMax=u;const d=Sr(C(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(u[0]-c[0],u[1]-c[1]),u[2]-c[2]);let f=this.radius*this.radius;for(let m=0;m<Ww.length;++m){l=Ww.at(m);const g=s[l]-d[0],y=s[l+1]-d[1],v=s[l+2]-d[2],b=g*g+y*y+v*v;if(b<=f)continue;const w=Math.sqrt(b),x=.5*(w-this.radius);this.radius=this.radius+x,f=this.radius*this.radius;const T=x/w;d[0]+=g*T,d[1]+=y*T,d[2]+=v*T}this.center=d,Ww.clear()}getChildren(){if(this._children||yo(this.bbMin,this.bbMax)<=1)return this._children;const e=Sr(C(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),s=new Array(8);for(let u=0;u<8;++u)s[u]=0;const{data:n,size:o,indices:a}=this.position;for(let u=0;u<i;++u){let d=0;const f=this._numIndexPerPrimitive*this.primitiveIndices[u];let m=o*a[f],g=n[m],y=n[m+1],v=n[m+2];for(let b=1;b<this._numIndexPerPrimitive;++b){m=o*a[f+b];const w=n[m],x=n[m+1],T=n[m+2];w<g&&(g=w),x<y&&(y=x),T<v&&(v=T)}g<e[0]&&(d|=1),y<e[1]&&(d|=2),v<e[2]&&(d|=4),r[u]=d,++s[d]}let l=0;for(let u=0;u<8;++u)s[u]>0&&++l;if(l<2)return;const c=new Array(8);for(let u=0;u<8;++u)c[u]=s[u]>0?new Uint32Array(s[u]):void 0;for(let u=0;u<8;++u)s[u]=0;for(let u=0;u<i;++u){const d=r[u];c[d][s[d]++]=this.primitiveIndices[u]}this._children=new Array;for(let u=0;u<8;++u)c[u]!==void 0&&this._children.push(new S3e(c[u],this._numIndexPerPrimitive,this.position));return this._children}static prune(){Ww.prune()}};const Ww=new ai({deallocator:null});let mN=class{constructor(){this.id=zh()}};function spt(t){return t?{p0:yn(t.p0),p1:yn(t.p1),p2:yn(t.p2)}:{p0:C(),p1:C(),p2:C()}}function npt(t,e,i){const r=e[0]-t[0],s=e[1]-t[1],n=i[0]-t[0],o=i[1]-t[1];return .5*Math.abs(r*o-s*n)}function opt(t,e,i){return $e(Sq,e,t),$e(Qfe,i,t),.5*Ve(mt(Sq,Sq,Qfe))}new B_(_m);new B_(()=>spt());const Sq=C(),Qfe=C();function apt(t,e){if(!t)return!1;const{size:i,data:r,indices:s}=t;pe(e,0,0,0),pe(Vd,0,0,0);let n=0,o=0;for(let a=0;a<s.length-2;a+=3){const l=s[a]*i,c=s[a+1]*i,u=s[a+2]*i;pe(Do,r[l],r[l+1],r[l+2]),pe(t_,r[c],r[c+1],r[c+2]),pe(n4,r[u],r[u+1],r[u+2]);const d=opt(Do,t_,n4);d?(Ee(Do,Do,t_),Ee(Do,Do,n4),de(Do,Do,1/3*d),Ee(e,e,Do),n+=d):(Ee(Vd,Vd,Do),Ee(Vd,Vd,t_),Ee(Vd,Vd,n4),o+=3)}return(o!==0||n!==0)&&(n!==0?(de(e,e,1/n),!0):o!==0&&(de(e,Vd,1/o),!0))}function lpt(t,e){if(!t)return!1;const{size:i,data:r,indices:s}=t;pe(e,0,0,0);let n=-1,o=0;for(let a=0;a<s.length;a++){const l=s[a]*i;n!==l&&(e[0]+=r[l],e[1]+=r[l+1],e[2]+=r[l+2],o++),n=l}return o>1&&de(e,e,1/o),o>0}function cpt(t,e,i){if(!t)return!1;pe(i,0,0,0),pe(Vd,0,0,0);let r=0,s=0;const{size:n,data:o,indices:a}=t,l=a.length-1,c=l+(e?2:0);for(let u=0;u<c;u+=2){const d=u<l?u+1:0,f=a[u<l?u:l]*n,m=a[d]*n;Do[0]=o[f],Do[1]=o[f+1],Do[2]=o[f+2],t_[0]=o[m],t_[1]=o[m+1],t_[2]=o[m+2],de(Do,Ee(Do,Do,t_),.5);const g=gb(Do,t_);g>0?(Ee(i,i,de(Do,Do,g)),r+=g):r===0&&(Ee(Vd,Vd,Do),s++)}return r!==0?(de(i,i,1/r),!0):s!==0&&(de(i,Vd,1/s),!0)}const Do=C(),t_=C(),n4=C(),Vd=C();let RB=class{constructor(e){this.channel=e,this.id=zh()}};function rK(t,e){return t==null&&(t=[]),t.push(e),t}function sK(t,e){if(t==null)return null;const i=t.filter(r=>r!==e);return i.length===0?null:i}function upt(t,e,i,r,s){o4[0]=t.get(e,0),o4[1]=t.get(e,1),o4[2]=t.get(e,2),_Q(o4,Zw,3),i.set(s,0,Zw[0]),r.set(s,0,Zw[1]),i.set(s,1,Zw[2]),r.set(s,1,Zw[3]),i.set(s,2,Zw[4]),r.set(s,2,Zw[5])}const o4=C(),Zw=new Float32Array(6);let Pn=class E3e extends mN{constructor(e,i,r=null,s=Gs.Mesh,n=null,o=-1){super(),this.material=e,this.mapPositions=r,this.type=s,this.objectAndLayerIdColor=n,this.edgeIndicesLength=o,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[a,l]of i)this._attributes.set(a,{...l,indices:oy(l.indices)}),a===$.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(a).indices.length:this.edgeIndicesLength)}instantiate(e={}){const i=new E3e(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((r,s)=>{r.exclusive=!1,i._attributes.set(s,r)}),i._boundingInfo=this._boundingInfo,i.transformation=e.transformation||this.transformation,i}get attributes(){return this._attributes}getMutableAttribute(e){let i=this._attributes.get(e);return i&&!i.exclusive&&(i={...i,exclusive:!0,data:rpt(i.data)},this._attributes.set(e,i)),i}setAttributeData(e,i){const r=this._attributes.get(e);r&&this._attributes.set(e,{...r,exclusive:!0,data:i})}get indexCount(){const e=this._attributes.values().next().value.indices;return(e==null?void 0:e.length)??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===Gs.Mesh?this._computeAttachmentOriginTriangles(e):this.type===Gs.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&nt(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const i=this.attributes.get($.POSITION);return apt(i,e)}_computeAttachmentOriginLines(e){const i=this.attributes.get($.POSITION);return cpt(i,hpt(this.material.parameters,i),e)}_computeAttachmentOriginPoints(e){const i=this.attributes.get($.POSITION);return lpt(i,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get($.POSITION);if(!e||e.indices.length===0)return null;const i=this.type===Gs.Mesh?3:1;bt(e.indices.length%i==0,"Indexing error: "+e.indices.length+" not divisible by "+i);const r=sE(e.indices.length/i);return new T3e(r,i,e)}get transformation(){return this._transformation??Jr}set transformation(e){this._transformation=e&&e!==Jr?EP(e):null}addHighlight(){const e=new RB(R_.Highlight);return this.highlights=rK(this.highlights,e),e}removeHighlight(e){this.highlights=sK(this.highlights,e)}};function hpt(t,e){return!(!("isClosed"in t)||!t.isClosed)&&e.indices.length>2}const ME=iK,Eq=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],dpt=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],ppt=[0,0,1,0,1,1,0,1],fpt=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],C3e=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)C3e[6*t+e]=t;const aT=new Array(36);for(let t=0;t<6;t++)aT[6*t]=0,aT[6*t+1]=1,aT[6*t+2]=2,aT[6*t+3]=2,aT[6*t+4]=3,aT[6*t+5]=0;function mpt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(24);for(let r=0;r<8;r++)i[3*r]=Eq[r][0]*e[0],i[3*r+1]=Eq[r][1]*e[1],i[3*r+2]=Eq[r][2]*e[2];return new Pn(t,[[$.POSITION,new ht(i,fpt,3,!0)],[$.NORMAL,new ht(dpt,C3e,3)],[$.UV0,new ht(ppt,aT,2)]])}const Cq=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],gpt=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],ypt=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],_pt=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function vpt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(18);for(let r=0;r<6;r++)i[3*r]=Cq[r][0]*e[0],i[3*r+1]=Cq[r][1]*e[1],i[3*r+2]=Cq[r][2]*e[2];return new Pn(t,[[$.POSITION,new ht(i,ypt,3,!0)],[$.NORMAL,new ht(gpt,_pt,3)]])}const zU=$r(-.5,0,-.5),BU=$r(.5,0,-.5),jU=$r(0,0,.5),GU=$r(0,.5,0),AE=Ru(),PE=Ru(),DA=Ru(),NA=Ru(),FA=Ru();$e(AE,zU,GU),$e(PE,zU,BU),mt(DA,AE,PE),Ce(DA,DA),$e(AE,BU,GU),$e(PE,BU,jU),mt(NA,AE,PE),Ce(NA,NA),$e(AE,jU,GU),$e(PE,jU,zU),mt(FA,AE,PE),Ce(FA,FA);const Mq=[zU,BU,jU,GU],bpt=[0,-1,0,DA[0],DA[1],DA[2],NA[0],NA[1],NA[2],FA[0],FA[1],FA[2]],wpt=[0,1,2,3,1,0,3,2,1,3,0,2],xpt=[0,0,0,1,1,1,2,2,2,3,3,3];function Tpt(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(12);for(let r=0;r<4;r++)i[3*r]=Mq[r][0]*e[0],i[3*r+1]=Mq[r][1]*e[1],i[3*r+2]=Mq[r][2]*e[2];return new Pn(t,[[$.POSITION,new ht(i,wpt,3,!0)],[$.NORMAL,new ht(bpt,xpt,3)]])}function SKt(t,e,i,r,s={uv:!0}){const n=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(i)),u=Math.max(2,Math.floor(r)),d=(c+1)*(u+1),f=$s(3*d),m=$s(3*d),g=$s(2*d),y=[];let v=0;for(let x=0;x<=u;x++){const T=[],E=x/u,M=a+E*l,O=Math.cos(M);for(let D=0;D<=c;D++){const U=D/c,k=n+U*o,H=Math.cos(k)*O,V=Math.sin(M),X=-Math.sin(k)*O;f[3*v]=H*e,f[3*v+1]=V*e,f[3*v+2]=X*e,m[3*v]=H,m[3*v+1]=V,m[3*v+2]=X,g[2*v]=U,g[2*v+1]=E,T.push(v),++v}y.push(T)}const b=new Array;for(let x=0;x<u;x++)for(let T=0;T<c;T++){const E=y[x][T],M=y[x][T+1],O=y[x+1][T+1],D=y[x+1][T];x===0?(b.push(E),b.push(O),b.push(D)):x===u-1?(b.push(E),b.push(M),b.push(O)):(b.push(E),b.push(M),b.push(O),b.push(O),b.push(D),b.push(E))}const w=[[$.POSITION,new ht(f,b,3,!0)],[$.NORMAL,new ht(m,b,3,!0)]];return s.uv&&w.push([$.UV0,new ht(g,b,2,!0)]),s.offset&&(w[0][0]=$.OFFSET,w.push([$.POSITION,new ht(Float64Array.from(s.offset),Ew(b.length),3,!0)])),new Pn(t,w)}function Spt(t,e,i,r){const s=M3e(e,i,r);return new Pn(t,s)}function M3e(t,e,i){const r=t;let s,n;if(i)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const c=r*(1+Math.sqrt(5))/2;s=[-r,c,0,r,c,0,-r,-c,0,r,-c,0,0,-r,c,0,r,c,0,-r,-c,0,r,-c,c,0,-r,c,0,r,-c,0,-r,-c,0,r],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let c=0;c<s.length;c+=3)ME.scale(s,c,t/ME.length(s,c));let o={};function a(c,u){c>u&&([c,u]=[u,c]);const d=c.toString()+"."+u.toString();if(o[d])return o[d];let f=s.length;return s.length+=3,ME.add(s,3*c,s,3*u,s,f),ME.scale(s,f,t/ME.length(s,f)),f/=3,o[d]=f,f}for(let c=0;c<e;c++){const u=n.length,d=new Array(4*u);for(let f=0;f<u;f+=3){const m=n[f],g=n[f+1],y=n[f+2],v=a(m,g),b=a(g,y),w=a(y,m),x=4*f;d[x]=m,d[x+1]=v,d[x+2]=w,d[x+3]=g,d[x+4]=b,d[x+5]=v,d[x+6]=y,d[x+7]=w,d[x+8]=b,d[x+9]=v,d[x+10]=b,d[x+11]=w}n=d,o={}}const l=Jfe(s);for(let c=0;c<l.length;c+=3)ME.normalize(l,c);return[[$.POSITION,new ht(Jfe(s),n,3,!0)],[$.NORMAL,new ht(l,n,3,!0)]]}function nK(t,e,i,r,s,n,o,a,l=null){const c=i?yn(i):C(),u=e?yn(e):qe(0,0,1);o??(o=gt());const d=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],f=s!=null&&s.length===2?s:[1,1],m=Ew(1),g=[[$.POSITION,new ht(c,m,3,!0)],[$.NORMAL,new ht(u,m,3,!0)],[$.UV0,new ht(o,m,o.length)],[$.COLOR,new ht(d,m,4,!0)],[$.SIZE,new ht(f,m,2)]];if(n!=null&&(n=[n[0],n[1],n[2],n[3]],g.push([$.CENTEROFFSETANDDISTANCE,new ht(n,m,4)])),a){const y=[a[0],a[1],a[2],a[3]];g.push([$.FEATUREATTRIBUTE,new ht(y,m,4)])}return new Pn(t,g,null,Gs.Point,l)}const Ept=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function EKt(t,e=Ept){const i=new Array(12);for(let c=0;c<4;c++)for(let u=0;u<3;u++)i[3*c+u]=e[c][u];const r=[0,1,2,2,3,0],s=[0,0,1],n=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[$.POSITION,new ht(i,r,3,!0)],[$.NORMAL,new ht(s,n,3,!0)],[$.UV0,new ht(o,r,2,!0)],[$.COLOR,new ht(a,n,4,!0)]];return new Pn(t,l)}function Kfe(t,e,i,r,s,n=!0,o=!0){let a=0;const l=i,c=e;let u=$r(0,a,0),d=$r(0,a+c,0),f=$r(0,-1,0),m=$r(0,1,0);s&&(a=c,d=$r(0,0,0),u=$r(0,a,0),f=$r(0,1,0),m=$r(0,-1,0));const g=[d,u],y=[f,m],v=r+2,b=Math.sqrt(c*c+l*l);if(s)for(let O=r-1;O>=0;O--){const D=O*(2*Math.PI/r),U=$r(Math.cos(D)*l,a,Math.sin(D)*l);g.push(U);const k=$r(c*Math.cos(D)/b,-l/b,c*Math.sin(D)/b);y.push(k)}else for(let O=0;O<r;O++){const D=O*(2*Math.PI/r),U=$r(Math.cos(D)*l,a,Math.sin(D)*l);g.push(U);const k=$r(c*Math.cos(D)/b,l/b,c*Math.sin(D)/b);y.push(k)}const w=new Array,x=new Array;if(n){for(let O=3;O<g.length;O++)w.push(1),w.push(O-1),w.push(O),x.push(0),x.push(0),x.push(0);w.push(g.length-1),w.push(2),w.push(1),x.push(0),x.push(0),x.push(0)}if(o){for(let O=3;O<g.length;O++)w.push(O),w.push(O-1),w.push(0),x.push(O),x.push(O-1),x.push(1);w.push(0),w.push(2),w.push(g.length-1),x.push(1),x.push(2),x.push(y.length-1)}const T=$s(3*v);for(let O=0;O<v;O++)T[3*O]=g[O][0],T[3*O+1]=g[O][1],T[3*O+2]=g[O][2];const E=$s(3*v);for(let O=0;O<v;O++)E[3*O]=y[O][0],E[3*O+1]=y[O][1],E[3*O+2]=y[O][2];const M=[[$.POSITION,new ht(T,w,3,!0)],[$.NORMAL,new ht(E,x,3,!0)]];return new Pn(t,M)}function Cpt(t,e,i,r,s,n,o){const a=s?hQ(s):$r(1,0,0),l=n?hQ(n):$r(0,0,0);o??(o=!0);const c=Ru();Ce(c,a);const u=Ru();de(u,c,Math.abs(e));const d=Ru();de(d,u,-.5),Ee(d,d,l);const f=$r(0,1,0);Math.abs(1-Te(c,f))<.2&&pe(f,0,0,1);const m=Ru();mt(m,c,f),Ce(m,m),mt(f,m,c);const g=2*r+(o?2:0),y=r+(o?2:0),v=$s(3*g),b=$s(3*y),w=$s(2*g),x=new Array(3*r*(o?4:2)),T=new Array(3*r*(o?4:2));o&&(v[3*(g-2)]=d[0],v[3*(g-2)+1]=d[1],v[3*(g-2)+2]=d[2],w[2*(g-2)]=0,w[2*(g-2)+1]=0,v[3*(g-1)]=v[3*(g-2)]+u[0],v[3*(g-1)+1]=v[3*(g-2)+1]+u[1],v[3*(g-1)+2]=v[3*(g-2)+2]+u[2],w[2*(g-1)]=1,w[2*(g-1)+1]=1,b[3*(y-2)]=-c[0],b[3*(y-2)+1]=-c[1],b[3*(y-2)+2]=-c[2],b[3*(y-1)]=c[0],b[3*(y-1)+1]=c[1],b[3*(y-1)+2]=c[2]);const E=(k,H,V)=>{x[k]=H,T[k]=V};let M=0;const O=Ru(),D=Ru();for(let k=0;k<r;k++){const H=k*(2*Math.PI/r);de(O,f,Math.sin(H)),de(D,m,Math.cos(H)),Ee(O,O,D),b[3*k]=O[0],b[3*k+1]=O[1],b[3*k+2]=O[2],de(O,O,i),Ee(O,O,d),v[3*k]=O[0],v[3*k+1]=O[1],v[3*k+2]=O[2],w[2*k]=k/r,w[2*k+1]=0,v[3*(k+r)]=v[3*k]+u[0],v[3*(k+r)+1]=v[3*k+1]+u[1],v[3*(k+r)+2]=v[3*k+2]+u[2],w[2*(k+r)]=k/r,w[2*k+1]=1;const V=(k+1)%r;E(M++,k,k),E(M++,k+r,k),E(M++,V,V),E(M++,V,V),E(M++,k+r,k),E(M++,V+r,V)}if(o){for(let k=0;k<r;k++){const H=(k+1)%r;E(M++,g-2,y-2),E(M++,k,y-2),E(M++,H,y-2)}for(let k=0;k<r;k++){const H=(k+1)%r;E(M++,k+r,y-1),E(M++,g-1,y-1),E(M++,H+r,y-1)}}const U=[[$.POSITION,new ht(v,x,3,!0)],[$.NORMAL,new ht(b,T,3,!0)],[$.UV0,new ht(w,x,2,!0)]];return new Pn(t,U)}function CKt(t,e,i,r,s,n){r=r||10,s=s==null||s,bt(e.length>1);const o=[[0,0,0]],a=[],l=[];for(let c=0;c<r;c++){a.push([0,-c-1,-(c+1)%r-1]);const u=c/r*2*Math.PI;l.push([Math.cos(u)*i,Math.sin(u)*i])}return Mpt(t,l,e,o,a,s,n)}function Mpt(t,e,i,r,s,n,o=$r(0,0,0)){const a=e.length,l=$s(i.length*a*3+(6*r.length||0)),c=$s(i.length*a*3+(r?6:0)),u=new Array,d=new Array;let f=0,m=0;const g=C(),y=C(),v=C(),b=C(),w=C(),x=C(),T=C(),E=C(),M=C(),O=C(),D=C(),U=C(),k=C(),H=rr();pe(M,0,1,0),$e(y,i[1],i[0]),Ce(y,y),n?(Ee(E,i[0],o),Ce(v,E)):pe(v,0,0,1),IB(y,v,M,M,w,v,eme),ve(b,v),ve(U,w);for(let N=0;N<r.length;N++)de(x,w,r[N][0]),de(E,v,r[N][2]),Ee(x,x,E),Ee(x,x,i[0]),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2];c[m++]=-y[0],c[m++]=-y[1],c[m++]=-y[2];for(let N=0;N<s.length;N++)u.push(s[N][0]>0?s[N][0]:-s[N][0]-1+r.length),u.push(s[N][1]>0?s[N][1]:-s[N][1]-1+r.length),u.push(s[N][2]>0?s[N][2]:-s[N][2]-1+r.length),d.push(0),d.push(0),d.push(0);let V=r.length;const X=r.length-1;for(let N=0;N<i.length;N++){let z=!1;N>0&&(ve(g,y),N<i.length-1?($e(y,i[N+1],i[N]),Ce(y,y)):z=!0,Ee(O,g,y),Ce(O,O),Ee(D,i[N-1],b),KD(i[N],O,H),G2(H,td(D,g),E)?($e(E,E,i[N]),Ce(v,E),mt(w,O,v),Ce(w,w)):IB(O,b,U,M,w,v,eme),ve(b,v),ve(U,w)),n&&(Ee(E,i[N],o),Ce(k,E));for(let W=0;W<a;W++)if(de(x,w,e[W][0]),de(E,v,e[W][1]),Ee(x,x,E),Ce(T,x),c[m++]=T[0],c[m++]=T[1],c[m++]=T[2],Ee(x,x,i[N]),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2],!z){const J=(W+1)%a;u.push(V+W),u.push(V+a+W),u.push(V+J),u.push(V+J),u.push(V+a+W),u.push(V+a+J);for(let ee=0;ee<6;ee++){const ae=u.length-6;d.push(u[ae+ee]-X)}}V+=a}const q=i[i.length-1];for(let N=0;N<r.length;N++)de(x,w,r[N][0]),de(E,v,r[N][1]),Ee(x,x,E),Ee(x,x,q),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2];const Z=m/3;c[m++]=y[0],c[m++]=y[1],c[m++]=y[2];const ye=V-a;for(let N=0;N<s.length;N++)u.push(s[N][0]>=0?V+s[N][0]:-s[N][0]-1+ye),u.push(s[N][2]>=0?V+s[N][2]:-s[N][2]-1+ye),u.push(s[N][1]>=0?V+s[N][1]:-s[N][1]-1+ye),d.push(Z),d.push(Z),d.push(Z);const L=[[$.POSITION,new ht(l,u,3,!0)],[$.NORMAL,new ht(c,d,3,!0)]];return new Pn(t,L)}function MKt(t,e,i,r){bt(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),bt(e[0].length===3,"createPolylineGeometry(): malformed vertex"),bt(i==null||i.length===e.length,"createPolylineGeometry: need same number of points and normals"),bt(i==null||i[0].length===3,"createPolylineGeometry(): malformed normal");const s=go(3*e.length),n=new Array(2*(e.length-1));let o=0,a=0;for(let c=0;c<e.length;c++){for(let u=0;u<3;u++)s[o++]=e[c][u];c>0&&(n[a++]=c-1,n[a++]=c)}const l=[[$.POSITION,new ht(s,n,3,!0)]];if(i){const c=$s(3*i.length);let u=0;for(let d=0;d<e.length;d++)for(let f=0;f<3;f++)c[u++]=i[d][f];l.push([$.NORMAL,new ht(c,n,3,!0)])}return r&&l.push([$.COLOR,new ht(r,sE(r.length/4),4)]),new Pn(t,l,null,Gs.Line)}function AKt(t,e,i,r,s,n=0){const o=new Array(18),a=[[-i,n,s/2],[r,n,s/2],[0,e+n,s/2],[-i,n,-s/2],[r,n,-s/2],[0,e+n,-s/2]],l=[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5];for(let c=0;c<6;c++)o[3*c]=a[c][0],o[3*c+1]=a[c][1],o[3*c+2]=a[c][2];return new Pn(t,[[$.POSITION,new ht(o,l,3,!0)]])}function PKt(t,e){const i=t.getMutableAttribute($.POSITION).data;for(let r=0;r<i.length;r+=3){const s=i[r],n=i[r+1],o=i[r+2];pe(OE,s,n,o),nt(OE,OE,e),i[r]=OE[0],i[r+1]=OE[1],i[r+2]=OE[2]}}function Apt(t,e=t){const i=t.attributes,r=i.get($.POSITION).data,s=i.get($.NORMAL).data;if(s){const n=e.getMutableAttribute($.NORMAL).data;for(let o=0;o<s.length;o+=3){const a=s[o+1];n[o+1]=-s[o+2],n[o+2]=a}}if(r){const n=e.getMutableAttribute($.POSITION).data;for(let o=0;o<r.length;o+=3){const a=r[o+1];n[o+1]=-r[o+2],n[o+2]=a}}}function Aq(t,e,i,r,s){return!(Math.abs(Te(e,t))>s)&&(mt(i,t,e),Ce(i,i),mt(r,i,t),Ce(r,r),!0)}function IB(t,e,i,r,s,n,o){return Aq(t,e,s,n,o)||Aq(t,i,s,n,o)||Aq(t,r,s,n,o)}const eme=.99619469809,OE=C();let Ppt=class{constructor(e,i){this.type=rl.Local,this._configuration=new toe,this._passParameters=new R6,this._configuration.geometry=wy.Cylinder,this._technique=i.techniques.acquire(PB,this._configuration);const r=i.renderContext.rctx;this._vao=Opt(r),this._vaoCount=y_(this._vao,"geometry");const s=new es;s.wrapMode=Ai.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new Mr(r,s,Zdt)}destroy(){this._passParameters.texture=Ut(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const i=e.rctx,r=i.bindTechnique(this._technique,e.bindParameters,this._passParameters);$pt(tme,e.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",tme),i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Mi.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}};function Opt(t){const e=M3e(1,2,!1),{data:i,indices:r}=e[0][1],s=ime.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o%3==0?o+2:o%3==2?o-2:o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new Dy(t,Pi,{geometry:Xu(ime)},{geometry:Cr.createVertex(t,hr.STATIC_DRAW,s.buffer)})}function $pt(t,e){An(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const tme=ke(),ime=Ds().vec3f($.POSITION),Rpt=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),a4=128,rme=-rQ,sme=0,Pq=50,Ipt=()=>1-511/512,Lpt=sU([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let Dpt=class{constructor(e,i){this.view=e,this.type=rl.Mars,this._passParameters=new R6,this._vaoCount=0,this._texV1=1;const r=br(e.spatialReference);this._planetRadius=r.radius,this._outerRimWidth=r.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+rme)/this._planetRadius,this._middleRimFactor=(this._planetRadius+sme)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=sme/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniques=i.techniques;const s=i.renderContext.rctx;this._cameraChangeHandle=te(()=>{var a;return(a=this.view.state)==null?void 0:a.camera},()=>i.requestRender(),pr),this._vao=this._createRibbon(s),this._vaoCount=y_(this._vao,"geometry"),this._fadeVao=Ny(s),this._fadeVaoCount=y_(this._fadeVao,"geometry");const n=new es;n.wrapMode=Ai.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new Mr(s,n,Rpt);const o=new toe;o.geometry=wy.Cone,this._coneTechnique=this._techniques.acquire(PB,o),o.geometry=wy.Underground,this._undergroundTechnique=this._techniques.acquire(PB,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=Ut(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const i=e.bindParameters.camera;this._update(i);const r=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(r.bindTechnique(this._coneTechnique,e.bindParameters,this._passParameters),r.bindVAO(this._vao),r.drawArrays(Mi.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(r.bindTechnique(this._undergroundTechnique,e.bindParameters,this._passParameters),r.bindVAO(this._fadeVao),r.drawArrays(Mi.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const i=C(),r=this._planetRadius,s=Ve(e.eye),n=s-r;if(n<0){const m=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=m}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(Pq,n),a=r+rme;this._passParameters.innerScale=Npt(r+o,r,a)-1,this._passParameters.altitudeFade=Nne(n),de(i,e.eye,(r+Pq)/s),nme(i,e.center,e.up,r,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,i,e.up,this._passParameters.silhouette),c=Ipt(),u=Lpt(n);let d=this._texV0+c*this._texVScale,f=this._texV0+l*u*this._texVScale;if(n>Pq){nme(e.eye,e.center,e.up,r,this._passParameters.silhouette);const m=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),g=Ne((m-1.5)/(l-1.5),0,1);d=this._texV0+g*c*this._texVScale,f=this._texV0+Bt(this._texV1,l*u,g)*this._texVScale}Di(this._passParameters.texV,d,f)}_createRibbon(e){const i=$s(3+3*a4*3),r=new Uint32Array(3*a4*5);i[0]=0,i[1]=0,i[2]=-1;for(let o=0;o<a4;o++){const a=9*o+3;i[a]=o,i[a+1]=this._innerRimFactor,i[a+2]=-1,i[a+3]=o,i[a+4]=this._middleRimFactor,i[a+5]=0,i[a+6]=o,i[a+7]=this._outerRimFactor,i[a+8]=1;const l=3*o+1,c=o===a4-1?1:l+3,u=15*o;r[u]=l,r[u+1]=l+1,r[u+2]=c+1,r[u+3]=c+1,r[u+4]=c,r[u+5]=l,r[u+6]=l+1,r[u+7]=l+2,r[u+8]=c+2,r[u+9]=c+2,r[u+10]=c+1,r[u+11]=l+1,r[u+12]=l,r[u+13]=c,r[u+14]=0}const s=ome.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new Dy(e,Pi,{geometry:Xu(ome)},{geometry:Cr.createVertex(e,hr.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(e,i,r,s){return Ee($E,s.center,s.v2),de(l4,$E,this._outerRimFactor),IG(Oq,i,$E,r),bfe($E,Oq,e.projectionMatrix,e.viewport,$E),bfe(l4,Oq,e.projectionMatrix,e.viewport,l4),Ar($E,l4)/e.height}};function nme(t,e,i,r,s){const n=Ve(t),o=r*Math.sqrt(n*n-r*r)/n,a=Math.sqrt(r*r-o*o),l=s.v1,c=s.v2;return de(s.center,t,a/n),mt(l,t,e),pl(l)<1&&mt(l,t,i),de(l,l,o/Ve(l)),mt(c,l,t),de(c,c,o/Ve(c)),o}const Oq=ke(),$E=C(),l4=C();function Npt(t,e,i){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-i*i)+e*i)}const ome=Ds().vec3f($.POSITION);var L_;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(L_||(L_={}));let oK=class extends uc{constructor(){super(...arguments),this.type=L_.Rain}};h([j({count:L_.COUNT})],oK.prototype,"type",void 0);function A3e(t){const e=new Hi;return e.attributes.add($.POSITION,"vec3"),e.attributes.add($.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new Wt("cameraPosition",(i,r)=>r.camera.eye)),e.vertex.uniforms.add(new Wt("offset",(i,r)=>Fpt(i,r))),e.vertex.uniforms.add(new tt("width",i=>i.width)),e.vertex.uniforms.add(new fs("proj",(i,r)=>r.camera.projectionMatrix)),e.vertex.uniforms.add(new fs("view",(i,r)=>r.camera.viewMatrix)),e.vertex.uniforms.add(new tt("time",i=>i.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(S`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===L_.Rain?S`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:S`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add(new tt("opacity",i=>i.opacity),new Wt("particleColor",(i,r)=>kpt(r,t))),e.fragment.code.add(S`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===L_.Rain?S`d = 0.35 * smoothstep(0.5, 0.0, d);`:S`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function Fpt(t,e){const i=e.camera.eye,r=.5*t.width,s=1/t.width,n=OCe(aK,pe(aK,(i[0]+r)*s,(i[1]+r)*s,(i[2]+r)*s));return Li(n,i,de(n,n,t.width))}function kpt(t,e){const i=e.type===L_.Rain?Vpt:Upt,r=de(aK,i,zpt),s=t.camera.eye;Ce(ame,s);const n=Math.max(0,Te(ame,t.lighting.mainLight.direction));return Sr(r,r,i,n)}const aK=C(),ame=C(),Upt=qe(1,1,1),Vpt=qe(.85,.85,.85),zpt=.7,Bpt=Object.freeze(Object.defineProperty({__proto__:null,build:A3e},Symbol.toStringTag,{value:"Module"}));let jpt=class extends Ur{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},lK=class P3e extends Ki{initializeProgram(e){return new er(e.rctx,P3e.shader.get().build(this.configuration),LB)}initializePipeline(){return Kt({blending:_a(Be.ONE,Be.ONE,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),depthTest:{func:xr.LEQUAL},colorWrite:ui})}};lK.shader=new qi(Bpt,()=>oe(()=>Promise.resolve().then(()=>x9t),void 0));const LB=new Map([[$.POSITION,0],[$.INSTANCEFEATUREATTRIBUTE,1]]);let O3e=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:i}){return i!=null?this._time!==i&&(this._time=i,!0):(this._time=this._time+e,e!==0)}},Gpt=class{constructor(e,i){this.deltaTime=e,this.fixedTime=i}},uI=class extends Ue{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new jpt,this._animation=new O3e,this._passParameters.time=0,this._passParameters.radius=br(e.view.spatialReference).radius,this._techniques=e.context.techniques}destroy(){this._numParticles=0,this._snowTechniqueCached=hi(this._snowTechniqueCached),this._rainTechniqueCached=hi(this._rainTechniqueCached),this._vao=Ut(this._vao),this._instanceIdBuffer=Ut(this._instanceIdBuffer)}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new oK;e.type=L_.Rain,this._rainTechniqueCached=this._techniques.acquire(lK,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new oK;e.type=L_.Snow,this._snowTechniqueCached=this._techniques.acquire(lK,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,i,r){const s=r==="rainy"?this._rainTechnique:this._snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),s==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=e.bindParameters.cloudsFade.opacity),this._passParameters.opacity<=0))return;const o=.35;i=i<.5?Bt(0,o,2*i):Bt(o,1,2*(i-.5)),this._passParameters.time=(r==="rainy"?this._rainSpeed:this._snowSpeed)*Tre(this._animation.time)%1e5;const a=n.bindTechnique(s,e.bindParameters,this._passParameters);n.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),Vne(n,LB,this._instanceIdBuffer,lme,0),n.drawArraysInstanced(Mi.TRIANGLES,0,3,this._numParticles*i),dIe(n,LB,this._instanceIdBuffer,lme)}_ensureResources(e){this._vao==null&&(this._vao=Hpt(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const i=[];for(let r=0;r<this._numParticles;r++)i.push(r);return Cr.createVertex(e,hr.STATIC_DRAW,new Float32Array(i))}};function Hpt(t){const e=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Dy(t,LB,{geometry:Xu(qpt)},{geometry:Cr.createVertex(t,hr.STATIC_DRAW,e)})}h([p({constructOnly:!0})],uI.prototype,"context",void 0),h([p({constructOnly:!0})],uI.prototype,"view",void 0),uI=h([I("esri.views.3d.environment.Precipitation")],uI);const qpt=Ds().vec3f($.POSITION),lme=Xu(Ds().f32($.INSTANCEFEATUREATTRIBUTE),1);function $3e(){const t=new Hi;return t.attributes.add($.POSITION,"vec3"),t.attributes.add($.COLOR,"vec4"),t.attributes.add($.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new fs("transform",(e,i)=>Wpt(e,i)),new ji("viewport",(e,i)=>i.camera.fullViewport),new tt("pixelRatio",(e,i)=>i.camera.pixelRatio)),t.vertex.code.add(S`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(S`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),t}function Wpt(t,e){return An(xv,e.camera.projectionMatrix),xv[10]=24e-8-1,xv[11]=-1,xv[14]=(24e-8-2)*e.camera.near,vr(xv,xv,e.camera.viewMatrix),vr(xv,xv,t.modelMatrix)}const xv=ke(),Zpt=Object.freeze(Object.defineProperty({__proto__:null,build:$3e},Symbol.toStringTag,{value:"Module"}));let Ypt=class extends Ur{constructor(){super(...arguments),this.modelMatrix=ke()}},R3e=class I3e extends Ki{constructor(e){super(e,new uc,()=>this.destroy())}initializeProgram(e){return new er(e.rctx,I3e.shader.get().build(),Pi)}initializePipeline(){return Kt({blending:_a(Be.SRC_ALPHA,Be.ONE,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),depthTest:{func:xr.LEQUAL},colorWrite:ui})}};R3e.shader=new qi(Zpt,()=>oe(()=>Promise.resolve().then(()=>T9t),void 0));let f1=class extends Ue{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._passParameters=new Ypt,this._updatingTracking=new f_}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=oc(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=hi(this._technique),this._vao=Ut(this._vao),Yw=null}render(e){const{rctx:i}=e;if(this._ensureResources(i),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const r=i.bindTechnique(this._technique,e.bindParameters,this._passParameters);i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Mi.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||Yw==null)return;this._technique=new R3e({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=Yw.byteLength/L3e;const i=new Float32Array(Yw,0,2*this._numPoints),r=new Uint8Array(Yw,2*this._numPoints*4,this._numPoints);this._vao=Xpt(e,i,r,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,s=>this._update(s),pt)}_update(e){if(!e)return;const i=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*Jpt(e),s=An(this._passParameters.modelMatrix,rft);mP(s,s,-r*Math.PI),vr(s,ift,s),mP(s,s,-i*Math.PI),this.requestRender()}_createLoadDataTask(){if(Yw!=null)return null;const e=My(async i=>{const{data:r}=await zZe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:i});Qpt(r),Yw=r});return e.promise.catch(i=>{us(i)||ne.getLogger(this).error(i)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}};function Xpt(t,e,i,r){const s=cme.createBuffer(r),n=s.position,o=s.color,a=s.size;for(let l=0;l<r;l++){const c=e[2*l],u=e[2*l+1];n.set(l,0,-Math.cos(c)*Math.sin(u)),n.set(l,1,-Math.sin(c)*Math.sin(u)),n.set(l,2,-Math.cos(u));const d=eft(i[l]),f=Kpt(tft[d[1]]);o.set(l,0,255*f[0]),o.set(l,1,255*f[1]),o.set(l,2,255*f[2]),o.set(l,3,255),a.set(l,d[0])}return new Dy(t,Pi,{geometry:Xu(cme)},{geometry:Cr.createVertex(t,hr.STATIC_DRAW,s.buffer)})}function Jpt(t){const e=t,i=new Date(t.getFullYear(),0,1,11,58,56);return(+e-+i)/(+new Date(t.getFullYear()+1,0,1,11,58,55)-+i)}function Qpt(t){if(!t)throw new B("stars:no-data-received","Failed to create stars because star catalogue is missing");const e=t.byteLength/L3e;if(e%1!=0||e>5e4||e<5e3)throw new B("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}function Kpt(t){return[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)]}function eft(t){return t>=192?[2.9,t-192]:t>=160?[2.5,t-160]:t>=128?[2,t-128]:t>=96?[1.5,t-96]:t>=64?[1,t-64]:t>=32?[.7,t-32]:[.4,t]}h([p({constructOnly:!0})],f1.prototype,"view",void 0),h([p({constructOnly:!0})],f1.prototype,"requestRender",void 0),h([p({readOnly:!0})],f1.prototype,"updating",null),h([p()],f1.prototype,"_loadDataTask",void 0),h([p()],f1.prototype,"_updatingTracking",void 0),f1=h([I("esri.views.3d.environment.Stars")],f1);const tft=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],ift=Ose(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),rft=Ose(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),L3e=9,cme=Ds().vec3f($.POSITION).vec4u8($.COLOR).f32($.SIZE);let Yw=null;const z6={required:[]},doe={required:[G.Depth]};let B6=class extends Ue{consumes(){return z6}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}get materialReference(){return null}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}queryRenderOccludedState(e){return!1}},poe=class extends B6{},D3e=class extends B6{constructor(){super(...arguments),this.drapedPriority=0}},sft=class extends B6{},nft=class extends B6{};function cK(t){return"prepareTechnique"in t}function ume(t){return"prepareTechniques"in t}var kA;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(kA||(kA={}));let Ta=class extends poe{constructor(e){super(e),this.produces=new Map([[Pe.OPAQUE_ENVIRONMENT,()=>!(this._atmosphere===null&&this._stars===null)],[Pe.TRANSPARENT_ENVIRONMENT,()=>this._atmosphere!==null]]),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new $q,this._newWeatherParameters=new $q,this._fadedWeatherParameters=new $q,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){var e;this.removeHandles(),this.uninitializeRenderContext(),((e=this.view)==null?void 0:e._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:rl.None}consumes(){return this._atmosphereType===rl.Realistic?doe:z6}updateAnimation(e){return this._precipitation!=null&&this._precipitation.update(e)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return Ve(this.view.state.camera.eye)-br(this.view.spatialReference).radius<=X0}get usedMemory(){var e;return((e=this._clouds)==null?void 0:e.usedMemory)??0}get _stars(){var s;const e=this.view,i=((s=e.environment)==null?void 0:s.starsEnabled)??!1,r=this._get("_stars");return i&&this._context!=null?r??new f1({view:e,requestRender:()=>this._setNeedsRender()}):(He(r),null)}get _precipitation(){const e=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return He(e),null;const i=this.view,r=this._context;return e!=null&&e.context===r?e:(He(e),new uI({context:r,view:i}))}get _clouds(){const e=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return He(e),null;if(e!=null)return e;const i=this.view,r=this._context;return He(e),new Pc({context:r,view:i,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const e=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return He(e),null;const i=this.view.state.viewingMode,r=this._context.renderContext.rctx,s=br(this.view.spatialReference).radius;return e!=null&&e.viewingMode===i&&e.planetRadius===s?e:(He(e),new nT({rctx:r,viewingMode:i,planetRadius:s,requestRender:()=>this._setNeedsRender()}))}get _fog(){const e=this._get("_fog");if(!this.weatherEnabled||this._context==null)return He(e),null;if(e!=null)return e;const i=this.view,r=this._context,s=this._context.renderContext.rctx,n=this.view.state.viewingMode;return new oT({context:r,view:i,rctx:s,viewingMode:n})}get weatherEnabled(){var e,i;return!!((i=(e=this.view)==null?void 0:e.environmentManager)!=null&&i.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(e=null){this._context=e;const i=()=>this._setNeedsRender();this.addHandles([te(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),r=>this._updateAtmosphere(r),pr),te(()=>this._stars,i),te(()=>this._precipitation,i),te(()=>this._clouds,()=>this._updateWeather(),pt),te(()=>this._fog,()=>this._updateFogHaze(),pt),te(()=>this.view.state.mode,()=>this._setNeedsRender(),lr),te(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},pr)])}uninitializeRenderContext(){this._context=null,this._atmosphere=He(this._atmosphere),this._set("_stars",He(this._stars)),this._set("_precipitation",He(this._precipitation)),this._set("_clouds",He(this._clouds)),this._set("_cloudsComposition",He(this._cloudsComposition)),this._set("_fog",He(this._fog))}prepareRender(e){var i;e.bindParameters.cloudsFade.data=Oht(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&((i=e.bindParameters.cloudsFade.data)==null?void 0:i.cubeMap)!=null&&(this._updateWeatherFading(e.bindParameters,e.time),e.bindParameters.cloudsFade.renderingStage===qg.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),e.bindParameters.cloudsFade.data=null))}renderNode(e){var i,r,s,n,o,a,l,c;switch(e.bindParameters.slot){case Pe.OPAQUE_ENVIRONMENT:(i=this._stars)==null||i.render(e),this.atmosphere!=null&&(this.atmosphere.render(e,(n=(s=(r=this.view)==null?void 0:r._stage)==null?void 0:s.renderer)==null?void 0:n.fullResolutionAtmosphere),this._cloudsComposition&&e.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(e)),e.bindParameters.cloudsFade.isFading&&this._context&&((o=e.bindParameters.cloudsFade.data)==null?void 0:o.cubeMap)!=null&&this._context.requestRender());break;case Pe.TRANSPARENT_ENVIRONMENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(e,this._weatherParameters.hazeAmount,(c=(l=(a=this.view)==null?void 0:a._stage)==null?void 0:l.renderer)==null?void 0:c.fullResolutionAtmosphere),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(e,this._weatherParameters.fog),this._precipitation)){const u=this.view.environment.weather;u.type!=="rainy"&&u.type!=="snowy"||this._precipitation.render(e,u.precipitation,u.type)}}}updateLightSources(e,i,r,s){if(this._context!=null){const n=this._context.renderContext;n.bindParameters.oldLighting.copyFrom(n.bindParameters.lighting),n.bindParameters.newLighting.noonFactor=i,n.bindParameters.newLighting.globalFactor=r,n.bindParameters.newLighting.set(e),s===kA.Faded||n.bindParameters.weatherFading?n.bindParameters.fadeLighting(0):n.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return e==null?null:e.type==="rainy"||e.type==="snowy"?{type:e.type,weatherAdjustment:e.cloudCover,effect:e.precipitation}:{type:e.type,weatherAdjustment:e.type==="foggy"?e.fogStrength:e.cloudCover}}_updateWeatherFading(e,i){e.cloudsFade.updateFading(e.camera,this.view.state.mode,i,this.view.qualitySettings.fadeDuration),e.cloudsFade.updateParallax(e.camera),e.weatherFading&&(oft(e),this._updateFogAtmoshpere(e))}_updateFogAtmoshpere(e){e.cloudsFade.fadeMode!==Zr.CROSS_FADE&&e.cloudsFade.fadeMode!==Zr.FADE_IN?this._fadeWeather(0):this._fadeWeather(e.cloudsFade.fadeFactor)}_fadeWeather(e){const{_newWeatherParameters:i,_oldWeatherParameters:r}=this;e>=1?this._weatherParameters=i:(this._fadedWeatherParameters.lerp(r,i,e),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const e=this._weatherUpdateParameters;e!=null&&this._clouds!=null&&(this._clouds.applyPreset(il[e.type],e.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const e=this._weatherUpdateParameters;if(this._fog==null||e==null||this._context==null)return;const i=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),e.type){case"foggy":this._newWeatherParameters.fog.strength=Bt(3e-5,.005,e.weatherAdjustment**3),ve(this._newWeatherParameters.fog.color,hme),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=Bt(4e-6,2e-4,(e.effect??0)**3),ve(this._newWeatherParameters.fog.color,aft),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=Bt(4e-6,2e-4,(e.effect??0)**3),ve(this._newWeatherParameters.fog.color,hme),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}i.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(e){const i=this._selectAtmosphereType(e);if(i!==rl.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==i){this._atmosphere=He(this._atmosphere);const r=this._getAtmosphereClass(i);r&&(this._atmosphere=new r(this.view,this._context))}}else this._atmosphere=He(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(e){switch(e){case rl.Realistic:return Aht;case rl.Local:return Ppt;case rl.Mars:return Dpt;default:case rl.None:return null}}_selectAtmosphereType(e){const{enabled:i,viewingMode:r}=e;return!i||V2(this.view.spatialReference)?rl.None:r===Je.Local?rl.Local:this._context!=null&&r2(this.view.spatialReference)?rl.Realistic:U2(this.view.spatialReference)?rl.Mars:rl.None}get test(){}};h([p({constructOnly:!0})],Ta.prototype,"view",void 0),h([p({readOnly:!0})],Ta.prototype,"atmosphere",null),h([p({readOnly:!0})],Ta.prototype,"_atmosphereType",null),h([p({type:Boolean,readOnly:!0})],Ta.prototype,"updating",null),h([p({readOnly:!0})],Ta.prototype,"weatherVisible",null),h([p()],Ta.prototype,"_context",void 0),h([p()],Ta.prototype,"_atmosphere",void 0),h([p({readOnly:!0})],Ta.prototype,"_stars",null),h([p({readOnly:!0})],Ta.prototype,"_precipitation",null),h([p({readOnly:!0})],Ta.prototype,"_clouds",null),h([p({readOnly:!0})],Ta.prototype,"_cloudsComposition",null),h([p({readOnly:!0})],Ta.prototype,"_fog",null),h([p({readOnly:!0})],Ta.prototype,"weatherEnabled",null),h([p({readOnly:!0})],Ta.prototype,"_precipitationEnabled",null),h([p({readOnly:!0})],Ta.prototype,"_weatherUpdateParameters",null),Ta=h([I("esri.views.3d.environment.EnvironmentRenderer")],Ta);let $q=class{constructor(){this.fog=new Vdt,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,ve(this.fog.color,e.fog.color)}lerp(e,i,r){this.fog.amount=Bt(e.fog.amount,i.fog.amount,r),this.hazeAmount=Bt(e.hazeAmount,i.hazeAmount,r),this.fog.strength=Bt(e.fog.strength,i.fog.strength,r),Sr(this.fog.color,e.fog.color,i.fog.color,r)}};function oft(t){t.cloudsFade.fadeMode!==Zr.CROSS_FADE&&t.cloudsFade.fadeMode!==Zr.FADE_IN?t.fadeLighting(0):t.fadeLighting(t.cloudsFade.fadeFactor)}const aft=qe(.5,.5,.5),hme=qe(1.5,1.5,1.5);var qKt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gN(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var dme,pme,fme,N3e={exports:{}};dme=N3e,pme=function(){var t=Math.PI,e=Math.sin,i=Math.cos,r=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,u=2451545,d={dec:0,ra:0};function f(L){return L.valueOf()/l-.5+c}function m(L){return new Date((L+.5-c)*l)}function g(L){return f(L)-u}var y=23.4397*a;function v(L,N){return n(e(L)*i(y)-r(N)*e(y),i(L))}function b(L,N){return s(e(N)*i(y)+i(N)*e(y)*e(L))}function w(L,N,z){return n(e(L),i(L)*e(N)-r(z)*i(N))}function x(L,N,z){return s(e(N)*e(z)+i(N)*i(z)*i(L))}function T(L,N){return a*(280.16+360.9856235*L)-N}function E(L){return a*(357.5291+.98560028*L)}function M(L){return a*(1.9148*e(L)+.02*e(2*L)+3e-4*e(3*L))}function O(L,N){return L+N+102.9372*a+t}function D(L,N){var z=E(L),W=O(z,M(z));return N||(N={dec:0,ra:0}),N.dec=b(W,0),N.ra=v(W,0),N}var U={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(L,N,z,W){var J=a*-z,ee=a*N,ae=g(L),we=D(ae,d),Ie=T(ae,J)-we.ra;return W||(W={azimuth:0,altitude:0}),W.azimuth=w(Ie,ee,we.dec),W.altitude=x(Ie,ee,we.dec),W}},k=[[-.83,"sunrise","sunset"]];U.addTime=function(L,N,z){k.push([L,N,z])};var H=9e-4;function V(L,N){return Math.round(L-H-N/(2*t))}function X(L,N,z){return H+(L+N)/(2*t)+z}function q(L,N,z){return u+L+.0053*e(N)-.0069*e(2*z)}function Z(L,N,z){return o((e(L)-e(N)*e(z))/(i(N)*i(z)))}function ye(L){var N=a*(134.963+13.064993*L),z=a*(93.272+13.22935*L),W=a*(218.316+13.176396*L)+6.289*a*e(N),J=5.128*a*e(z),ee=385001-20905*i(N);return{ra:v(W,J),dec:b(W,J),dist:ee}}return U.getTimes=function(L,N,z){var W=a*-z,J=a*N,ee=V(g(L),W),ae=X(0,W,ee),we=E(ae),Ie=M(we),Ge=O(we,Ie),ut=b(Ge,0),ot=q(ae,we,Ge);function at(ce){return q(X(Z(ce,J,ut),W,ee),we,Ge)}function it(ce){var me=(e(ce)-e(J)*e(ut))/(i(J)*i(ut));return me<-1?U.PolarException.MIDNIGHT_SUN:me>1?U.PolarException.POLAR_NIGHT:U.PolarException.NORMAL}var st,li,Y,ie,se,Ae={solarNoon:m(ot),nadir:m(ot-.5),polarException:U.PolarException.NORMAL};for(st=0,li=k.length;st<li;st+=1)se=ot-((ie=at((Y=k[st])[0]*a))-ot),Ae[Y[1]]=m(se),Ae[Y[2]]=m(ie);return Ae.polarException=it(k[0][0]*a),Ae},U.getMoonPosition=function(L,N,z){var W=a*-z,J=a*N,ee=g(L),ae=ye(ee),we=T(ee,W)-ae.ra,Ie=x(we,J,ae.dec);return Ie+=.017*a/r(Ie+10.26*a/(Ie+5.1*a)),{azimuth:w(we,J,ae.dec),altitude:Ie,distance:ae.dist}},U.getMoonFraction=function(L){var N=g(L),z=D(N),W=ye(N),J=149598e3,ee=o(e(z.dec)*e(W.dec)+i(z.dec)*i(W.dec)*i(z.ra-W.ra)),ae=n(J*e(ee),W.dist-J*i(ee));return(1+i(ae))/2},U},(fme=pme())!==void 0&&(dme.exports=fme);const T2=gN(N3e.exports),Jl={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let c4=class{constructor(e,i){this.direct=e,this.ambient=i}};function lft(t,e,i,r,s,n){pe(n.ambient.color,1,1,1),n.ambient.intensity=Jl.global.ambient,pe(n.direct.color,1,1,1),n.direct.intensity=Jl.global.direct;const o=e[2],a=Ne((Math.abs(o)-Jl.local.altitude)/(Jl.global.altitude-Jl.local.altitude),0,1);let l;if(n.globalFactor=a,t!=null&&(l=T2.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=mft(t,l,r);else{const u=U3e(r);c={direct:{intensity:Jl.local.directAtNoon*u.direct,color:qe(1,1,1)},ambient:{intensity:Jl.local.ambientAtNoon*u.ambient,color:qe(1,1,1)},timeOfDay:"early afternoon"}}Sr(n.ambient.color,c.ambient.color,n.ambient.color,a),n.ambient.intensity=Bt(c.ambient.intensity,n.ambient.intensity,a),Sr(n.direct.color,c.direct.color,n.direct.color,a),n.direct.intensity=Bt(c.direct.intensity,n.direct.intensity,a),n.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,n.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}n.noonFactor=t!=null?fft(t,l):1,t!=null?cft(t,e,i,n.direct.directionToLightSource):F3e(s,i,n.direct.directionToLightSource)}function F3e(t,e,i){e===Je.Global?Ce(Dq,t.eye):pe(Dq,0,0,1),de(Nq,t.viewForward,-1);const r=aB(Nq,Dq),s=Math.max(r-2*Fq,0),n=.85*s/(s+1),o=Math.max(Fq,r-Fq-n);qu(Eme,-o,t.viewRight),nt(i,Nq,Eme),Ee(i,i,de(gft,t.viewRight,yft)),Ce(i,i)}function cft(t,e,i,r){const s=pft,n=mp(dft);if(i===Je.Global)T2.getPosition(t,0,0,s),pe(r,0,0,-1),fP(n,n,-s.azimuth),RG(n,n,-s.altitude),nt(r,r,n);else{const o=Jl.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=Ne(c,0,1),c<1?(T2.getPosition(t,e[1],e[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),pe(r,0,-1,0),mP(n,n,-s.azimuth),fP(n,n,-s.altitude),nt(r,r,n)}}function uft(t,e){if(e===Je.Global)return!0;const i=Jl.planarDirection;return Math.abs(t)<i.localAltitude}const hft=qe(.5773502691896258,-.5773502691896258,.5773502691896258);let k3e=class{constructor(){this.ambient={color:qe(1,1,1),intensity:.55},this.direct={color:qe(1,1,1),intensity:.55,directionToLightSource:yn(hft)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const dft=ke(),pft={azimuth:0,altitude:0};function fft(t,e){const i=t.valueOf();let r,s;e.polarException===T2.PolarException.MIDNIGHT_SUN?(r=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=r+432e6):e.polarException===T2.PolarException.POLAR_NIGHT?(r=i-2,s=i-1):(r=e.sunrise.valueOf(),s=e.sunset.valueOf());const n=r+(s-r)/2;return 1-Ne(Math.abs(i-n)/432e5,0,1)}function U3e(t){switch(t){case"disabled":case"sunny":case"cloudy":return new c4(1,1);case"rainy":return new c4(.4,1.2);case"snowy":return new c4(.5,1.3);case"foggy":return new c4(.2,1.6)}}function mme(t,e){const i=(t[0]+t[1]+t[2])/3;t[0]+=(i-t[0])*e,t[1]+=(i-t[1])*e,t[2]+=(i-t[2])*e}const Rq=qe(.01,.01,.01),uK=qe(1,.6,.5),hK=qe(1,.98,.98),gme=qe(1,1,1),Iq=qe(.8,.8,1),dK=qe(.8,.8,1),pK=qe(.98,.98,1),yme=qe(1,1,1),Lq=Ei(.01,Jl.local.ambientAtNight),fK=Ei(Jl.local.directAtTwilight,Jl.local.ambientAtTwilight),mK=Ei(.9*Jl.local.directAtNoon,Jl.local.ambientAtNoon),_me=Ei(Jl.local.directAtNoon,Jl.local.ambientAtNoon),vme=mK,bme=hK,wme=pK,xme=fK,Tme=uK,Sme=dK;function mft(t,e,i){const r=t.valueOf();let s,n;e.polarException===T2.PolarException.MIDNIGHT_SUN?(s=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=s+432e6):e.polarException===T2.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=e.sunrise.valueOf(),n=e.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,u=a+l,d=.06*o,f=s-d/2,m=s+d/2,g=n-d/2,y=n+d/2,v=gt(),b=C(),w=C();let x="";if(r<f||r>y)Ga(v,Lq),ve(b,Rq),ve(w,Iq),x="night";else if(r<m){const M=(r-f)/(m-f);Xd(v,Lq,fK,M),Sr(b,Rq,uK,M),Sr(w,Iq,dK,M),x="sun rising"}else if(r<c){const M=(r-m)/(c-m);Xd(v,fK,mK,M),Sr(b,uK,hK,M),Sr(w,dK,pK,M),x="early morning"}else if(r<a){const M=(r-c)/(a-c);Xd(v,mK,_me,M),Sr(b,hK,gme,M),Sr(w,pK,yme,M),x="late morning"}else if(r<u){const M=(r-a)/(u-a);Xd(v,_me,vme,M),Sr(b,gme,bme,M),Sr(w,yme,wme,M),x="early afternoon"}else if(r<g){const M=(r-u)/(g-u);Xd(v,vme,xme,M),Sr(b,bme,Tme,M),Sr(w,wme,Sme,M),x="late afternoon"}else if(r<y){const M=(r-g)/(y-g);Xd(v,xme,Lq,M),Sr(b,Tme,Rq,M),Sr(w,Sme,Iq,M),x="sun setting"}let T=0;switch(i){case"rainy":case"foggy":T=.8;break;case"snowy":T=.5}T>0&&(mme(b,T),mme(w,T));const E=U3e(i);return{direct:{intensity:v[0]*E.direct,color:b},ambient:{intensity:v[1]*E.ambient,color:w},timeOfDay:x}}const Eme=ke(),Dq=C(),Nq=C(),gft=C(),Fq=.25,yft=.2;function V3e(t){return r2(t)?C_(t)||am(t)||oP(t)||PL(t)?yit:t:id(t)}var ay;function YKt(t){return _ft(t,ay.Horizontal)}function _ft(t,e){const{hasZ:i,spatialReference:r}=t,s=V3e(r);let n=0;const o=uCe(s);if(o==null)return null;const a=e===ay.Direct?z3e:B3e;for(const l of t.paths){if(l.length<2)continue;const c=l.length-1;for(let u=0;u<c;++u){const d=l[u];Vo[0]=d[0],Vo[1]=d[1],Vo[2]=i?d[2]:0;const f=l[u+1];zo[0]=f[0],zo[1]=f[1],zo[2]=i?f[2]:0;const m=a(Vo,zo,r);if(m==null)return null;n+=m.value}}return m_(n,o)}function XKt(t,e){const{spatialReference:i}=t;return ms(i,e.spatialReference)?(Vo[0]=t.x,Vo[1]=t.y,Vo[2]=t.hasZ?t.z:0,zo[0]=e.x,zo[1]=e.y,zo[2]=e.hasZ?e.z:0,wft(Vo,zo,i)):null}function vft(t,e){const{spatialReference:i}=t;return ms(i,e.spatialReference)?(Vo[0]=t.x,Vo[1]=t.y,Vo[2]=t.hasZ?t.z:0,zo[0]=e.x,zo[1]=e.y,zo[2]=e.hasZ?e.z:0,z3e(Vo,zo,i)):null}function JKt(t,e){const{spatialReference:i}=t;return ms(i,e.spatialReference)?(Vo[0]=t.x,Vo[1]=t.y,Vo[2]=t.hasZ?t.z:0,zo[0]=e.x,zo[1]=e.y,zo[2]=e.hasZ?e.z:0,B3e(Vo,zo,i)):null}function QKt(t,e){const{spatialReference:i}=t;return ms(i,e.spatialReference)?(Vo[0]=t.x,Vo[1]=t.y,Vo[2]=t.hasZ?t.z:0,zo[0]=e.x,zo[1]=e.y,zo[2]=e.hasZ?e.z:0,xft(Vo,zo,i)):null}function KKt(t){return t!=null?bft(t.hasZ?t.z:0,t.spatialReference):null}function bft(t,e){const i=hCe(e);return i!=null?m_(t??0,i):null}function wft(t,e,i){const r=j6(t,e,i);return r!=null?{direct:m_(r.direct,r.unit),horizontal:m_(r.horizontal,r.unit),vertical:m_(r.vertical,r.unit)}:null}function z3e(t,e,i){const r=j6(t,e,i,ay.Direct);return r!=null?m_(r.direct,r.unit):null}function B3e(t,e,i){const r=j6(t,e,i,ay.Horizontal);return r!=null?m_(r.horizontal,r.unit):null}function xft(t,e,i){const r=j6(t,e,i,ay.Vertical);return r!=null?m_(r.verticalSigned,r.unit):null}function j6(t,e,i,r){const s=V3e(i),n=uCe(s);if(n==null)return null;const o=e[2]-t[2];if(r===ay.Vertical)return{verticalSigned:o,unit:n};if(!Go(t,i,kq,s)||!Go(e,i,u4,s))return null;if(r===ay.Direct)return{direct:Ar(u4,kq),unit:n};if(pe(h4,t[0],t[1],e[2]),!Go(h4,i,h4,s))return null;const a=Ar(h4,u4);return r===ay.Horizontal?{horizontal:a,unit:n}:{direct:Ar(u4,kq),horizontal:a,vertical:Math.abs(o),unit:n}}(function(t){t[t.Direct=0]="Direct",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical"})(ay||(ay={}));const Vo=C(),zo=C(),kq=C(),u4=C(),h4=C();let rf=class extends Ls.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandlesKey="viewHandles",this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new MB,this._ambientLight=new Qne,this._moonLight=new GIe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePositionGeographic=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,i,r;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((r=(i=this._view)==null?void 0:i.state)==null?void 0:r.viewingMode)===Je.Global&&r2(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionGeographic(){return this._referencePositionGeographic}connectView(e){if(this._renderer)return;this._renderer=new Ta({view:e});const i=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this.addHandles([te(()=>e.environment.lighting,s=>this._updateLightingHandler(s),lr),te(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),lr),te(()=>e.stationary,()=>this._interactingStationaryHandler()),te(()=>e.environment.lighting.directShadowsEnabled,i,lr),te(()=>e.qualitySettings.ambientOcclusion,i,lr),te(()=>e.qualitySettings.reflections,i,lr),te(()=>e.spatialReference,()=>this._resetReferencePosition(!0),lr),te(()=>e.environment.weather.type,()=>this._updateLighting(null,kA.Faded),lr),te(()=>this.weatherEnabled,()=>this._updateLighting(null,kA.Faded),lr),te(()=>e.viewingMode,()=>this._resetReferencePosition(!0),pr),te(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),pr),te(()=>e.state.camera,r,pr),te(()=>this.disableQueries,r)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=He(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const i=this._view.environment.lighting;(i==null?void 0:i.type)!=="virtual"&&(i.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const i=this._view.environment.lighting;if((i==null?void 0:i.type)!=="virtual"){if(e){if(!i.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!Kc(r,Ye.WGS84)){const s=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(s))return void this._requestReferencePositionUpdate(s)}if(this._preupdateTracking(e),this._referencePositionGeographic!=null){const s=Npe(this._referencePositionGeographic,Cme);s!=null&&(i.autoUpdate(null,s),this._trackingEnabled&&(i.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const i=this._view;if(!i.ready)return;const r=i.stateManager.camera;r&&(this._cameraHandlerClientSide(r,e)||this._cameraHandlerServerSide(r))}_cameraHandlerClientSide(e,i){const r=r2(this._view.spatialReference);if(r&&!Kc(this._view.spatialReference,Ye.WGS84))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const s=e.position;return this._referencePositionGeographic??(this._referencePositionGeographic=C()),r?xl(s,this._referencePositionGeographic,Ye.WGS84):pe(this._referencePositionGeographic,s.longitude??0,s.latitude??0,s.z??0),this.notifyChange("referencePositionGeographic"),this._autoUpdateTimezone(this._referencePositionGeographic,i)||this._updateLighting(i),!0}_cameraHandlerServerSide(e){const i=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(i))&&this._requestReferencePositionUpdate(i,!0),this._view.mapCoordsHelper&&this._referencePositionGeographic&&(this._referencePositionGeographic[2]=(i.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,i=kA.Immediate){const r=this._view;e=e||(r.environment.lighting.type==="virtual"?null:r.environment.lighting.date);const s=this._referencePositionGeographic,n=s?Tft:Sft,o=this.weatherVisible?r.environment.weather.type:"disabled";s!=null?lft(e,s,r.state.viewingMode,o,r.state.camera,n):r.environment.lighting.type==="virtual"&&F3e(r.state.camera,r.state.viewingMode,n.direct.directionToLightSource);const a=this._mainLight,l=n.direct;de(a.intensity,l.color,l.intensity*Math.PI),ve(a.direction,l.directionToLightSource),a.specularStrength=n.specularStrength,a.environmentStrength=n.environmentStrength;const c=this._ambientLight;de(c.intensity,n.ambient.color,n.ambient.intensity);const u=this._moonLight;Sr(u.intensity,Cft,Mft,n.globalFactor);const d=(1-.5*n.globalFactor)*(1-.4*n.noonFactor*(1-n.globalFactor));de(u.intensity,u.intensity,d),ve(u.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,u],n.noonFactor,n.globalFactor,i),this._updateRenderParameters()}_autoUpdateTimezone(e,i=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const r=Eft;r.setTime((i||this._view.environment.lighting.date).getTime());const s=Npe(e,Cme);if(s==null)return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===s.hours&&n.minutes===s.minutes&&n.seconds===s.seconds)return!1}else n=s;const o=r.getUTCHours()-(s.hours-n.hours),a=r.getUTCMinutes()-(s.minutes-n.minutes),l=r.getUTCSeconds()-(s.seconds-n.seconds);return r.setUTCHours(o),r.setUTCMinutes(a),r.setUTCSeconds(l),!i&&this._view.environment.lighting.autoUpdate(r,s)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const i=this._referencePositionGeographic==null||uft(this._referencePositionGeographic[2],this._view.state.viewingMode);e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&i,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePositionGeographic=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,i=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!i,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const r=this._referencePosUpdateQuery=KS(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===r){const n=()=>this._referencePosUpdateQuery!==r;return this._doReferencePositionUpdateQuery(n)}}).catch(n=>{n.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===r&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),s=this._referencePosUpdateTimer=KS(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===s&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const i=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(i[0])&&!isNaN(i[1])){const r=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePositionGeographic?pe(this._referencePositionGeographic,i[0],i[1],r):this._referencePositionGeographic=qe(i[0],i[1],r),this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePositionGeographic)||this._updateLighting(),this.notifyChange("referencePositionGeographic")}_exceedsReferencePosDistThreshold(e){const i=this._referencePosMapCoords;if(i==null)return!0;const r=vft(i,e);return r==null?!0:zct(r,"meters").value>this._referencePointUpdateDistThreshold}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){}};h([p({type:Boolean,readOnly:!0})],rf.prototype,"updating",null),h([p()],rf.prototype,"disableQueries",void 0),h([p()],rf.prototype,"_disableWeather",void 0),h([p()],rf.prototype,"weatherEnabled",null),h([p()],rf.prototype,"weatherVisible",null),h([p()],rf.prototype,"referencePositionGeographic",null),h([p()],rf.prototype,"_renderer",void 0),h([p()],rf.prototype,"_referencePositionGeographic",void 0),rf=h([I("esri.views.3d.environment.SceneViewEnvironmentManager")],rf);const Tft=new k3e,Sft=new k3e,Eft=new Date,Cme={hours:0,minutes:0,seconds:0},Cft=qe(.22,.22,.33),Mft=qe(.22,.22,.22);var cs;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(cs||(cs={}));var _i;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(_i||(_i={}));var xy;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(xy||(xy={}));let Tp=class{constructor(e=cs.ALL,i=_i.NONE,r=0,s=null,n=null,o=xy.TUMBLE){this.selection=e,this.interactionType=i,this.interactionFactor=r,this.interactionStartCamera=s,this.interactionDirection=n,this.tiltMode=o}};function eD(t,e){return!!(t&e)}function DB(t,e,i,r,s,n){t!==0&&(i?(n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)):r!=null?(n.min-=Math.max(0,(e-n.min)*(1-r)),n.max+=Math.max(0,(e-n.max)*(1-r))):s&&(n.min-=Math.max(0,e-n.min-s),n.max+=Math.max(0,e-n.max-s)))}const nE=new Tp(cs.NONE);function j3e(t,e,i,r){return e=e||t.viewForward,ve(r,e),de(r,r,Math.sign(Te(e,i))),r}function Aft(t,e,i,r){return Ift(t,e,i,$ft(r,e,i,!0))}function Pft(t,e,i,r){const s=Te(i,$e(t,r,e));return Ee(t,e,de(t,i,s))}const Oft={dir:C(),len:0,clip:gt()};function $ft(t,e,i,r){const s=Oft;return t?(i&&r&&(s.len=Ar(e,i)),ve(s.dir,t)):(s.len=Ar(e,i),$e(s.dir,i,e),de(s.dir,s.dir,1/s.len)),s}function Rft(t,e,i){const r=Te(t,i.dir),s=-Rr(t,e);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const n=s/r;return r>0?n<i.clip[1]&&(i.clip[1]=n):n>i.clip[0]&&(i.clip[0]=n),i.clip[0]<=i.clip[1]}function Ift(t,e,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let s=0;s<t.length;s++)if(!Rft(t[s],e,r))return!1;return!0}function Lft(t,e,i=nE){const r=foe(t,e,i);if(r===0)return!1;const s=t.renderCoordsHelper,n=s.getAltitude(e.eye)+r,o=j3e(e,i.interactionDirection,Fft(t,e,Math.sign(r),zft),Vft),a=ve(Bft,e.viewForward),l=s.intersectInfiniteManifold(td(e.eye,o),n,Uq);return e.eye=l??s.setAltitude(Uq,n,e.eye),e.center=Pft(Uq,e.eye,a,e.center),!0}function foe(t,e,i=nE){if(!Dft(t,i)||!t.state.constraints.altitude)return 0;const r=kft(t.state.constraints.altitude,Uft);Nft(t,i,r);const s=t.renderCoordsHelper.getAltitude(e.eye),n=Ne(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}function Dft(t,e){const i=t.state.constraints.altitude;return!(!t.state.isGlobal||!i)&&(e.interactionType!==_i.TUMBLE||!eD(e.selection,cs.TILT))}function Nft(t,e,i){const r=e.interactionType;if(r===_i.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===_i.TUMBLE||r===_i.ZOOM,c=foe(t,o),u=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);i.min=s,i.max=n,DB(c,u,l,a,.05*u,i)}function Fft(t,e,i,r){return t.renderCoordsHelper.worldUpAtPosition(e.eye,r),de(r,r,i),r}function kft(t,e){return e.min=t.min,e.max=t.max,e}const Uft={min:0,max:0},Vft=C(),zft=C(),Bft=C(),Uq=C();function moe(t,e,i=nE){if(!t.state.isLocal)return 0;const r=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;d4.min=0,d4.max=r,Gft(t,i,d4);const s=goe(t,e),n=d4.max-s;return n>=-1e-6?0:n}function jft(t,e,i=nE){const r=moe(t,e,i);if(r===0)return!1;const s=t.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const n=goe(t,e)+r,o=ve(qft,e.eye),a=j3e(e,i.interactionDirection,Hft(e,s.renderLocation,Yft),Zft);if(!yw(PPe(s.renderLocation,n),td(e.eye,a),p4))return!1;e.eye=p4;const l=$e(Wft,e.eye,o);e.center=Ee(p4,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),u=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,p4);return u!=null&&(e.center=u),!0}function Gft(t,e,i){const r=e.interactionType;if(r===_i.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===_i.ZOOM||r===_i.PAN,c=moe(t,o),u=c===0?0:goe(t,o);i.min=s,i.max=n,DB(c,u,l,a,.05*u,i)}function goe(t,e){const i=t.pointsOfInterest.surfaceOrigin;return i.renderLocation?Ar(e.eye,i.renderLocation):0}function Hft(t,e,i){return U_(i,t.eye,e)}const d4={min:0,max:0},qft=C(),Wft=C(),Zft=C(),Yft=C(),p4=C();function DO(t,e,i=op.EYE){const r=t.state.constraints;if(!r.collision.enabled)return!1;const s=d6(t,e.eye),n=t.renderCoordsHelper.getAltitude(e.eye),o=s+r.collision.elevationMargin;if(n>=o)return!1;const a=Ve(e.eye);if($e(f4,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(Xft,o,e.eye),i===op.EYE_AND_CENTER)e.center=Ee(f4,e.eye,f4);else if(i===op.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;e.center=de(f4,e.center,l)}return!0}var op;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(op||(op={}));const f4=C(),Xft=C();function iw(t,e,i){t.worldUpAtPosition(e,Mme),$e(Vq,i,e);const r=Ve(Vq);return r===0?0:vo(Te(Vq,Mme)/r)}const Mme=C(),Vq=C();function G3e(t,e,i,r=!0){E$.eyeCenterDistance=0,E$.requiresTwoSteps=!1;const s=yoe(t,e,i,nE,E$);if(s===0)return!1;switch(qu(m4,-s,e.viewRight),i.tiltMode){case xy.LOOK_AROUND:nt(Tv,e.viewForward,m4),de(Tv,Tv,E$.eyeCenterDistance),e.center=Ee(Y1,e.eye,Tv);break;case xy.TUMBLE:$e(Tv,e.center,e.eye),nt(Tv,Tv,m4),e.eye=$e(Y1,e.center,Tv);break;default:i.tiltMode}return e.up=nt(Y1,e.up,m4),!E$.requiresTwoSteps||!r||G3e(t,e,i,!1)}function yoe(t,e,i,r=nE,s){if(!t.state.constraints.tilt)return 0;const n=e.distance,o=t.state.constraints.tilt(n,omt);return nmt(t,i,o),r.interactionType===_i.TUMBLE&&eD(r.selection,cs.ALTITUDE)&&H3e(t,r.interactionStartCamera,o),i.tiltMode===xy.LOOK_AROUND||r.tiltMode===xy.LOOK_AROUND?Qft(t,e,o,s):Jft(t,e,o)}function Jft(t,e,i){const r=iw(t.renderCoordsHelper,e.center,e.eye),s=r-Ne(r,i.min,i.max);return tD(s)?s:0}function Qft(t,e,i,r){switch(r&&(r.requiresTwoSteps=!1),t.viewingMode){case"global":return emt(t,e,i,r);case"local":return Kft(t,e,i,r)}}function Kft(t,e,i,r){const s=iw(t.renderCoordsHelper,e.center,e.eye),n=Ne(s,i.min,i.max),o=s-n;if(!tD(o))return 0;if(r){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=e.distance}return o}function emt(t,e,i,r){const s=tmt(t,e,amt),n=Ne(s.tiltAtCenter,i.min,i.max);if(!tD(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=imt(s),a=rmt(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=smt(s,o)),r&&(r.eyeCenterDistance=gK(s,o)),a}function tmt(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+br(t.spatialReference).radius,n=t.renderCoordsHelper.intersectManifold(e.ray,r,Y1);return i.eyeCenterDistance=e.distance,i.centerIsOnSurface=!1,n!=null?(i.eyeCenterDistance=Ar(e.eye,n),i.tiltAtCenter=iw(t.renderCoordsHelper,n,e.eye),i.centerIsOnSurface=!0):t.state.isLocal?i.tiltAtCenter=iw(t.renderCoordsHelper,e.center,e.eye):(CO(t6(i6,s),e.ray,Y1),i.eyeCenterDistance=Ar(e.eye,Y1),i.tiltAtCenter=vo(-Te(e.viewForward,Ce(Y1,Y1)))),i.radius=s,i.eyeRadius=Ve(e.eye),i.constraints=t.state.constraints,i}function tD(t){return Math.abs(t)>1e-9}function imt(t){const{constraints:e,eyeCenterDistance:i,tiltAtCenter:r}=t;let s=r,n=e.clampTilt(i,r);const o=gK(t,n);if(e.clampTilt(o,r)===n)return n;let a=0;for(;a<10&&tD(n-s);){const l=(s+n)/2,c=gK(t,l);tD(e.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function gK(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const i=Math.PI-Ne(e,0,Math.PI),r=lm(t.radius/t.eyeRadius*Math.sin(i)),s=Math.PI-i-r,n=Math.sin(s)/Math.sin(i);if(t.eyeRadius<t.radius&&n>1){const o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*t.eyeRadius}return n*t.eyeRadius}function rmt(t,e){const i=lm(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),r=lm(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?i-r:r-i}function smt(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function nmt(t,e,i){if(e.interactionType===_i.NONE)return;const{interactionStartCamera:r,interactionFactor:s}=e;if(!r)return;const{min:n,max:o}=i,a=yoe(t,r,nE,e),l=a===0?0:iw(t.renderCoordsHelper,r.center,r.eye);i.min=n,i.max=o,e.interactionType===_i.TUMBLE?(eD(e.selection,cs.ALTITUDE)&&H3e(t,r,i),DB(a,l,!0,s,Ame,i)):DB(a,l,!1,s,Ame,i)}function H3e(t,e,i){const r=t.state.constraints;if(t.state.isLocal||!r.altitude||!e)return;const s=pl(e.center),n=Math.sqrt(s),o=e.distance,a=br(t.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,u=(l*l-o*o-s)/(-2*n*o),d=(c*c-o*o-s)/(-2*n*o);i.min=Math.max(i.min,Math.min(Math.PI-vo(d),i.max)),i.max=Math.min(i.max,Math.PI-vo(u))}const Tv=C(),m4=ke(),Y1=C(),Ame=kt(5),omt={min:0,max:0},amt={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},E$={eyeCenterDistance:0,requiresTwoSteps:!1},lmt=t=>t,G6=t=>t*t,_oe=t=>1-G6(1-t),cmt=t=>t<.5?G6(2*t)/2:(_oe(2*(t-.5))+1)/2,voe=t=>t*t*t,q3e=t=>1-voe(1-t),W3e=t=>t<.5?voe(2*t)/2:(q3e(2*(t-.5))+1)/2,boe=t=>t*t*t*t,Z3e=t=>1-boe(1-t),umt=t=>t<.5?boe(2*t)/2:(Z3e(2*(t-.5))+1)/2,woe=t=>t*t*t*t*t,Y3e=t=>1-woe(1-t),hmt=t=>t<.5?woe(2*t)/2:(Y3e(2*(t-.5))+1)/2,xoe=t=>1-Math.cos(t*Math.PI/2),X3e=t=>1-xoe(1-t),dmt=t=>t<.5?xoe(2*t)/2:(X3e(2*(t-.5))+1)/2,Toe=t=>2**(10*(t-1)),yN=t=>1-Toe(1-t),pmt=t=>t<.5?Toe(2*t)/2:(yN(2*(t-.5))+1)/2,Soe=t=>-(Math.sqrt(1-t*t)-1),J3e=t=>1-Soe(1-t),fmt=t=>t<.5?Soe(2*t)/2:(J3e(2*(t-.5))+1)/2;function Sp(t){const e=2*(t-Math.sqrt((t-1)*t)),i=e/2/t;return r=>r<i?t*r*r:e*r-e+1}function Ep(t,e){return(i,r)=>i<e?e*t(i/e,r):1-t((1-i)/(1-e),r)*(1-e)}const mmt=Ep(Sp(1),1),gmt=Ep(Sp(1),0),yK=Ep(Sp(1),.5),ymt=Ep(Sp(2),1),_mt=Ep(Sp(2),0),vmt=Ep(Sp(2),.5),bmt=Ep(Sp(3),1),wmt=Ep(Sp(3),0),xmt=Ep(Sp(3),.5),Tmt=Ep(Sp(4),1),Smt=Ep(Sp(4),0),Emt=Ep(Sp(4),.5),Cmt={linear:lmt,"in-quad":G6,"out-quad":_oe,"in-out-quad":cmt,"in-coast-quad":mmt,"out-coast-quad":gmt,"in-out-coast-quad":yK,"in-cubic":voe,"out-cubic":q3e,"in-out-cubic":W3e,"in-coast-cubic":ymt,"out-coast-cubic":_mt,"in-out-coast-cubic":vmt,"in-quart":boe,"out-quart":Z3e,"in-out-quart":umt,"in-coast-quart":bmt,"out-coast-quart":wmt,"in-out-coast-quart":xmt,"in-quint":woe,"out-quint":Y3e,"in-out-quint":hmt,"in-coast-quint":Tmt,"out-coast-quint":Smt,"in-out-coast-quint":Emt,"in-sine":xoe,"out-sine":X3e,"in-out-sine":dmt,"in-expo":Toe,"out-expo":yN,"in-out-expo":pmt,"in-circ":Soe,"out-circ":J3e,"in-out-circ":fmt};function fn(t,e,i=Omt,r=e){r!==e&&r.copyFrom(e),r.computeUp(t.state.viewingMode);let s=!1;for(let a=0;a<$mt;a++){let l=0;for(const c of Pmt)if(eD(i.selection,c.type)){const u=Math.abs(c.error(t,r,i));c.apply(t,r,i)&&(s=!0,l+=u)}if(l===0)break}const n=eD(i.selection,cs.COLLISION),o=Mmt(i.interactionType,t);return n&&DO(t,r,o)&&(s=!0),s&&r.computeUp(t.state.viewingMode),s}function Mmt(t,e){switch(t){case _i.PAN:return op.EYE_AND_CENTER;case _i.ASCEND:return e.state.isGlobal?op.EYE_AND_CENTER_SCALE:op.EYE_AND_CENTER;default:return op.EYE}}function $f(t){const e=Math.min(1,t/150);return W3e(e)}function Amt(t,e,i){return yoe(t,e,i)*e.distance}const Pmt=[{type:cs.TILT,error:Amt,apply:G3e},{type:cs.ALTITUDE,error:foe,apply:Lft},{type:cs.DISTANCE,error:moe,apply:jft}],Omt=new Tp,$mt=5;let Pme=class{get pitch(){return this._pitch}get yaw(){return this._yaw}get distance(){return this._distance}get fov(){return this._fov}get size(){return this._size}constructor(e){this.viewingMode=e,this.center=C(),this._pitch=0,this._yaw=0,this._distance=0,this.direction=yn(Ome),this._fov=55,this._size=1}pixelsPerPanAtZoom(e){return this._size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this._size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this._pitch)),.5);return this._size/2/e}compareTo(e,i){if(this.viewingMode===Je.Global){const n=(Ve(this.center)+Ve(e.center))/2;i.pan=aB(this.center,e.center)*n}else i.pan=Ar(this.center,e.center);let r=Math.abs(e._yaw-this._yaw);r>=Math.PI&&(r=2*Math.PI-r);const s=Math.abs(e._pitch-this._pitch);i.rotate=Math.max(r,s),i.fov=e.fov-this.fov,i.sourceZoom=this._distance,i.targetZoom=e._distance}interpolate(e,i,r){this.viewingMode===Je.Global?Vtt(e.center,i.center,r.pan,this.center):Sr(this.center,e.center,i.center,r.pan),this._distance=isFinite(i.distance)?Bt(e.distance,i.distance+r.zoomOffset,r.zoom):e.distance,this._pitch=Bt(e.pitch,i.pitch,r.rotate);let s=e._yaw;const n=i._yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this._yaw=Bt(s,n,r.rotate),this._fov=Bt(e.fov,i.fov,r.fov)}copyFrom(e){ve(this.center,e.center),this._pitch=e.pitch,this._yaw=e.yaw,this._distance=e.distance,ve(this.direction,e.direction),this._size=e.size,this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const i=this._lookAtOrientation(e.center,$me);ve(this.center,e.center),$e(xa,e.center,e.eye),ca(xa,xa,i),ca(Ev,e.up,i),this._distance=Ve(xa),this._distance!==0&&(xa[0]/=this._distance,xa[1]/=this._distance,xa[2]/=this._distance),this._pitch=this._eyeUpToPitch(xa),this._yaw=Rmt(xa,Ev),this._size=Math.sqrt(e.width*e.width+e.height*e.height),this._fov=e.fov,this._zoomToPanScale=Math.atan(.5*this._fov)}copyToRenderCamera(e){const i=this._lookAtOrientation(this.center,$me);W2(i,i),this._axisAngleVec3(HU,this._pitch-Math.PI/2,Ome,xa),this._axisAngleVec3(GT,this._yaw,xa,xa),this._axisAngleVec3(HU,this._pitch-Math.PI/2,GT,Ev),this._axisAngleVec3(GT,this._yaw,Ev,Ev),de(xa,xa,this._distance),ca(xa,xa,i),ca(Ev,Ev,i),e.center=this.center,e.eye=$e(xa,this.center,xa),e.up=Ev,e.fov=this._fov}_axisAngleVec3(e,i,r,s){const n=Math.cos(i),o=Math.sin(i);return de(eh,r,n),mt(xu,e,r),de(xu,xu,o),de(Sv,e,(1-n)*Te(e,r)),Ee(s,Ee(s,eh,xu),Sv)}_lookAtOrientation(e,i=Kr()){return this._upAtLookAt(e,Sv),mt(eh,this.direction,Sv),Ce(eh,eh),eh[0]===0&&eh[1]===0&&eh[2]===0&&ve(eh,HU),mt(xu,Sv,eh),Ce(xu,xu),i[0]=eh[0],i[1]=xu[0],i[2]=Sv[0],i[3]=eh[1],i[4]=xu[1],i[5]=Sv[1],i[6]=eh[2],i[7]=xu[2],i[8]=Sv[2],i}_upAtLookAt(e,i){return this.viewingMode===Je.Local?ve(i,GT):Ce(i,e)}_eyeUpToPitch(e){return Math.PI-aB(GT,e)}};function Rmt(t,e){const i=Imt;return Math.abs(e[2])<.5?(ve(i,e),t[2]>0&&de(i,i,-1)):ve(i,t),mt(xu,i,GT),Ce(xu,xu),aB(HU,xu,GT)}const eh=C(),xu=C(),Sv=C(),xa=C(),Ev=C(),Imt=C(),GT=hP,Ome=ase,HU=ose,$me=Kr();let Lmt=class{constructor(){this.pan=0,this.rotate=0,this.fov=0,this.sourceZoom=0,this.targetZoom=0}};const NB={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let Dmt=class Q3e{constructor(e){this._createCamera=e,this.compared=new Lmt,this.segmentStart=0,this.segmentEnd=1,this.settings={desiredScreenFlow:NB.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new Q3e(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,i,r){this.source!==e&&this.source.copyFrom(e),this.target!==i&&this.target.copyFrom(i),this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:NB.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const i=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>Bo()}get hasFov(){return Math.abs(this.compared.fov)>Bo()}get hasRotate(){return this.compared.rotate>Bo()}},Nmt=class{constructor(){this.pan=0,this.rotate=0,this.zoom=0,this.fov=0,this.zoomOffset=0}},Fmt=class{constructor(){this.segments=new Array}get time(){return this.segments.reduce((e,i)=>e+i.time,0)}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,s=0;const n=this.definition,o=this.segments.reduce((a,l)=>a||l.definition.hasZoom,!1);for(let a=0;a<this.segments.length;a++){const l=this.segments[a],c=l.definition;if(e<=l.time||a===this.segments.length-1){if(this.segmentInterpolateComponentsAt(l,l.time===0?0:e/l.time,i),n.hasPan&&!isNaN(i.pan)&&isFinite(n.compared.pan)?i.pan=(r+c.compared.pan*i.pan)/n.compared.pan:i.pan=1,n.hasRotate&&!isNaN(i.rotate)&&isFinite(n.compared.rotate)?i.rotate=(s+c.compared.rotate*i.rotate)/n.compared.rotate:i.rotate=1,o&&!isNaN(i.zoom)&&isFinite(c.compared.targetZoom)){const{sourceZoom:u,targetZoom:d}=c.compared,f=i.zoom*(d-u)+u,m=this.segments[0].definition.compared.sourceZoom,g=this.segments[this.segments.length-1].definition.compared.targetZoom,y=Math.abs(d-m)>Math.abs(u-m)?d:u;i.zoomOffset=y-g,i.zoom=(f-m)/(y-m)}else i.zoom=1;return i}e-=l.time,r+=c.compared.pan,s+=c.compared.rotate}}segmentInterpolateComponentsAt(e,i,r){e.interpolateComponentsAt(i,r)}},zq=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,i=e.compared,r=i.sourceZoom,s=i.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=i.pan*e.source.pixelsPerPanAtZoom(r);const n=(e.source.pixelsPerRotateAtZoom(r)+e.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=i.rotate*n}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;r&&(s&&(o=(i/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(e/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,u=1+c;this._panPixelFlow=c/u*l,this._rotatePixelFlow=1/u*l}else s?this._panPixelFlow=l:r?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=this.rotateTime??this.zoomTime??this.panTime??this.fovTime??0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:null}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:null}get fovTime(){return this.definition.hasFov?Math.abs(this.definition.compared.fov)/kmt:null}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=e*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-e-i)/(r-i)}return e}_interpolateComponentsFov(e){if(e===0)return this.definition.segmentStart;if(e===1)return this.definition.segmentEnd;if(this.definition.hasFov){const{segmentStart:i,segmentEnd:r}=this.definition;return i+e*(r-i)}return this.definition.segmentStart}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*e*this._time)-1))/(i*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),i.zoom=this._interpolateComponentsZoom(e),i.pan=this._interpolateComponentsPan(e),i.rotate=this._interpolateComponentsRotate(e),i.zoomOffset=0,i.fov=this._interpolateComponentsFov(e)}};const kmt=kt(90);function Umt(t,e,i){const r=e-t.compared.sourceZoom,s=t.halfWindowPanAtZoom(r);return-t.halfWindowSize*(i.ascensionFactor*Math.LN2*t.compared.pan+s)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*s)}function Vmt(t,e,i){const r=1/e,s=Math.log(t.compared.sourceZoom*r),n=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*r*n*o*l*c-t.halfWindowSize*s*n*o*l+t.halfWindowSize*s*n*o*c/(a*a)}function zmt(t,e,i){const r=e-t.compared.sourceZoom,s=1/r,n=1/e,o=Math.log(t.compared.sourceZoom*n),a=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(r))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function Bmt(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function jmt(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function Gmt(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function Hmt(t,e,i){return-t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function qmt(t,e,i){return t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function Wmt(t,e,i){return-2*t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function Zmt(t,e,i){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function Ymt(t,e,i){const r=Math.log(e/t.compared.targetZoom),s=1/t.desiredPixelFlow,n=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*r*s*n*a+t.halfWindowSize*r*s*n*l/(o*o)+t.halfWindowSize*s*n*a*l/e}function Xmt(t,e,i){const r=e-t.compared.targetZoom,s=1/r,n=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+i.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function Jmt(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function Qmt(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function Kmt(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function egt(t){const e=t.compared.sourceZoom-t.compared.targetZoom;if(e===0)return t.compared.pan*t.halfWindowSize/(t.desiredPixelFlow*t.halfWindowPanAtZoom(t.compared.sourceZoom));const i=Math.LN2*t.compared.pan,r=e,s=t.halfWindowPanAtZoom(r),n=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*s);return t.compared.sourceZoom<=t.compared.targetZoom?n*(i-s):n*(i+s)}function tgt(t,e){let i=igt(t,e);const r={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=r.ascensionFactor===0,n=r.descensionFactor===0,o=s?Bmt:Umt,a=s?jmt:Vmt,l=s?Gmt:zmt,c=n?Jmt:Zmt,u=n?Qmt:Ymt,d=n?Kmt:Xmt,f=T=>o(t,T,r)+Hmt(t,T,r)+c(t,T,r),m=T=>a(t,T,r)+qmt(t,T,r)+u(t,T,r),g=T=>l(t,T,r)+Wmt(t,T,r)+d(t,T,r);let y=f(i);const v=egt(t);let b;const w=e.maximumIterations||20,x=e.maximumDistance!=null?e.maximumDistance:1/0;for(b=0;b<w;b++){const T=e.desiredSlope??1e-6;let E=m(i);Math.abs(E)>T&&(E+=T);const M=E/g(i);if(isNaN(M)||i>=x&&M<0){if(!isFinite(x))return null;i=x,y=f(i);break}if(i-=M,i<t.compared.sourceZoom||i<t.compared.targetZoom)return null;const O=f(i);if(Math.abs(O-y)/y<=.005)break;y=O}return y>v*(1-.3)||i<t.compared.sourceZoom||i<t.compared.targetZoom?null:i}function igt(t,e){const i=Math.max(t.compared.sourceZoom,t.compared.targetZoom),r=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return r<i?e.maximumDistance!=null?i+(e.maximumDistance-i)/2:1.5*i:e.maximumDistance?Math.min(e.maximumDistance,r):r}let rgt=class extends Fmt{constructor(e,i){super(),this._preallocSegments=[new zq,new zq,new zq],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,i)}update(e,i){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();const r=i!=null&&i.apex?tgt(e,i.apex):null;this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r?this._updateWithApex(r,i==null?void 0:i.apex):this._updateWithoutApex()}segmentInterpolateComponentsAt(e,i,r){e.interpolateComponentsAt(i,r),e===this._ascensionSegment?r.zoom=_oe(r.zoom):e===this._descensionSegment&&(r.zoom=G6(r.zoom))}_updateWithApex(e,i){const[r,s,n]=this._preallocSegments,o=(i==null?void 0:i.ascensionFactor)??.5,a=Math.min(1-o,(i==null?void 0:i.ascensionFactor)!=null&&i.descensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.definition.segmentEnd=o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.definition.segmentStart=r.definition.segmentEnd,s.definition.segmentEnd=r.definition.segmentEnd+l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=e,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.definition.segmentStart=o+l,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const sgt=new Nmt;let ngt=class{get time(){return this._time}get isLinear(){return this.path.segments.length===1}constructor(e){this._time=0,this._easing=yK,this.definition=new Dmt(e),this.path=new rgt}update(e,i,r){this.definition.update(e,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(q2e(isFinite(this.path.time)?this.path.time:0),r),this._easing=r.easing??(this._time>=1e3?yK:yN)}cameraAt(e,i){e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,sgt);i.interpolate(this.definition.source,this.definition.target,r)}_normalizedEasing(e){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-i)/(r-i)}_applyTimeSettings(e,i){const r=i.speedFactor!=null?i.speedFactor:1,s=i.minDuration??NB.minDuration/r,n=i.maxDuration??NB.maxDuration/r;return e=i.duration!=null?i.duration:Math.min(Math.max(e/r,s),n)}},ogt=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new ngt(()=>new Pme(e)),this._current=new Pme(e)}update(e,i,r){const{source:s,target:n}=this._animation.definition,o=$e(agt,i.center,e.center),a=Ve(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),ve(s.direction,o),ve(n.direction,o),s.copyFromRenderCamera(e),n.copyFromRenderCamera(i),this._current.copyFrom(s),this._animation.update(s,n,r),this.currentTime=0,e.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(e,i){return this._animation.cameraAt(e,this._current),i=i||new Fr,this._current.copyToRenderCamera(i),i}step(e,i){return this.finished||(this.currentTime=this.currentTime+q2e(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}};const agt=C();var xs;(function(t){t[t.Ready=0]="Ready",t[t.Rejected=1]="Rejected",t[t.Running=2]="Running",t[t.Stopped=3]="Stopped",t[t.Finished=4]="Finished"})(xs||(xs={}));let J0=class extends Ue{constructor(e){super(e),this.state=xs.Ready}get active(){return this.state===xs.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=xs.Stopped,!0)}finishController(){this.state=xs.Finished}get steppingFinished(){return!1}};h([p({constructOnly:!0})],J0.prototype,"view",void 0),h([p({readOnly:!0})],J0.prototype,"active",null),h([p()],J0.prototype,"state",void 0),h([p({readOnly:!0})],J0.prototype,"isInteractive",null),J0=h([I("esri.views.3d.state.controllers.CameraController")],J0);let iD=class extends J0{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(Ui()),this._asyncResult=null),this.state===xs.Finished||this.state===xs.Stopped?(F2(e),this.state===xs.Finished?e.resolve():e.reject(Ui())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=xs.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==xs.Ready&&this.state!==xs.Running||(this.viewAnimation.state===FP.State.FINISHED?this.finish():this.viewAnimation.state===FP.State.STOPPED&&(this.state=xs.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===xs.Finished?this.viewAnimation.finish():this.state===xs.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===xs.Finished?this._asyncResult.resolve():this._asyncResult.reject(Ui()))}finish(){this.finishController()}};iD=h([I("esri.views.3d.state.controllers.AnimationController")],iD);let a_=class extends iD{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new ogt(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new FP}get isInteractive(){return this.mode==="interaction"}begin(e,i){this._hasTarget=!0;const r=this.animationSettings(i);g4.copyFrom(this.view.state.camera);const s=gp(this.view.state.viewingMode);this.intersectionHelper.intersectRay(g4.ray,s,Rme)&&(g4.center=Rme),this.animation.update(g4,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,i){this._hasTarget&&this.animation.step(e,i)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?Cmt[e.easing]:e.easing}}};h([p({constructOnly:!0})],a_.prototype,"mode",void 0),h([p({readOnly:!0})],a_.prototype,"isInteractive",null),a_=h([I("esri.views.3d.state.controllers.PointToPointAnimationController")],a_);const g4=new Fr,Rme=C();function H6(t=cgt){return[t[0],t[1],t[2],t[3]]}function rD(t,e){return lgt(t[0],t[1],t[2],e,Rse.get())}function lgt(t,e,i,r,s=H6()){return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s}function Eoe(t,e,i){return mt(i,t,e),Ce(i,i),i[3]=kse(t,e),i}const cgt=[0,0,1,0];function pei(t,e,i=mo()){return Coe(t,Lf(e),i),Ce(i.direction,i.direction),i}function Coe(t,e,i){return ugt(t,t.screenToRender(e,rt.get()),i)}function ugt(t,e,i){const r=Ga(rt.get(),e);if(r[2]=0,!t.unprojectFromRenderScreen(r,i.origin))return null;const s=Ga(rt.get(),e);s[2]=1;const n=t.unprojectFromRenderScreen(s,rt.get());return n==null?null:($e(i.direction,n,i.origin),i)}function NO(t,e,i){return Moe(t,t.screenToRender(e,rt.get()),i)}function Moe(t,e,i){ve(i.origin,t.eye);const r=pe(rt.get(),e[0],e[1],1),s=t.unprojectFromRenderScreen(r,rt.get());return s==null?null:($e(i.direction,s,i.origin),i)}function Aoe(t,e,i,r){const s=NO(e,i,hgt);return yw(t,s,r)}const hgt=mo();var BP;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(BP||(BP={}));const K3e=30,FB=[1,3e8],q6=80,eLe=8,tLe=200,iLe=1508e5,rLe=5,sLe=50,dgt=5,pgt=10,Bq=90,oE={exclude:new Set([Xb])};function BS(t,e,i){return i[0]=e[0]/(t.fullWidth/t.pixelRatio),i[1]=e[1]/(t.fullHeight/t.pixelRatio),i}function _K(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function rw(t,e,i){const r=qu(Ise.get(),i[3],i);r==null||KCe(r,Jr)||($e(Tr,t.eye,e),nt(Tr,Tr,r),t.eye=Ee(Tr,Tr,e),$e(Tr,t.center,e),nt(Tr,Tr,r),t.center=Ee(Tr,Tr,e),t.up=nt(Tr,t.up,r))}function fgt(t,e,i,r){return G2(t,Coe(e,i,$oe),r)}function vK(t,e,i,r){return G2(t,NO(e,i,$oe),r)}function Poe(t,e,i,r){const s=rt.get();let n=1-i;$e(s,e,t.eye);const o=Ve(s);let a=o*(1-n);n>=0&&a<r&&(a=r,n=-(a-o)/o),Math.abs(o-a)<1e-6||(de(s,s,n),t.eye=Ee(Tr,t.eye,s),t.center=Sr(Tr,t.center,e,n))}function nLe(t,e,i){e.getScreenCenter(Ime),Aoe(t,e,Ime,Tr)&&(e.center=Tr);const r=e.distance,s=r*i;if(Math.abs(r-s)<1e-6)return;const n=de(rt.get(),e.viewForward,s);e.eye=$e(Tr,e.center,n)}const Ime=Os();function jq(t,e){pe(e,0,0,0);for(const i of t)Ee(e,e,i);de(e,e,1/t.length)}function qU(t,e,i,r){return Math.sin(t/Ve(e))*(i+r.radius)}function Lme(t,e,i,r){return qU(Math.PI/2,e,i,r)+(t-Math.PI/2)}var Na;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(Na||(Na={}));const Dme={Elevation:3e4,Angle:kt(16)},y4={Pole:.95,Angle:kt(18),Tilt:45},oLe=kt(80);function aLe(t,e,i,r,s,n){const o=C(),a=_n();let l=!0,c=!0;return t.intersectScreen(i,o,n)?a[3]=Ve(o):(c=!1,e.aboveGround&&s!==BP.Ellipsoid?a[3]=Math.max(Ve(e.center),.9*r.radius):a[3]=Ve(e.eye)-e.relativeElevation,s===BP.Silhouette?sD(a,e,i,o):l=Aoe(a,e,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function _N(t,e,i,r){const s=t.relativeElevation;if(s>Dme.Elevation&&r==="global")return Na.Horizontal;NO(t,e,Hq);const n=Math.sign(s),o=i.worldUpAtPosition(t.eye,Tr);return-n*Te(o,Hq.direction)<Math.sin(Dme.Angle)*Ve(Hq.direction)?Na.Vertical:Na.Horizontal}function lLe(t,e,i){$e(Gq,i,e),t.eye=$e(Tr,t.eye,Gq),t.center=$e(Tr,t.center,Gq)}const Gq=C();function sD(t,e,i,r){const s=NO(e,i,$oe);return s!=null&&(CO(t,s,_4),yw(t,s,r)?!(yo(_4,s.origin)<yo(r,s.origin))||(ve(r,_4),!1):($e(RE,e.eye,e.center),Ce(RE,RE),dPe(RE,-Te(Ce(RE,RE),_4),Nme),G2(Nme,s,r),!1))}const _4=C(),RE=C(),Nme=rr();function cLe(t,e,i,r,s,n){let o=0;if(mt(VB,t,e),$e(x4,t,e),Ve(t)<=s||!r.aboveGround){mt(i,x4,r.eye);const a=Te(t,e)/(Ve(t)*Ve(e));if(a<.9999)o=vo(a);else{const c=Ve(mt(C(),t,e))/(Ve(t)*Ve(e));o=lm(c)}const l=Math.cos(Ne(Bb.normalize(kt(n)),0,oLe));o=-o-Math.max(0,Ve(e)-s)/(l*s)}else $e(Fme,r.eye,r.center),mt(i,x4,Fme),o=-Ve(x4)/s;return Ce(i,i),de(i,i,Ve(VB)),o}const Fme=C();function kme(t,e,i,r){let s,n;const o=Math.cos(Ne(Bb.normalize(kt(r)),0,oLe));return s=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):vo(e/i),n=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):vo(t/i),(n-s)*i}function mgt(t,e,i,r,s,n,o,a,l,c){const u=kme(t[2],e[2],n[3],a),d=l?kme(t[0],e[0],n[3],180):e[0]-t[0],f=Math.sin(o)*d-Math.cos(o)*u,m=Math.cos(o)*d+Math.sin(o)*u;Ce(Tr,s);const g=l?f/Math.sqrt(Math.abs(n[3]**2-Te(i,Tr)**2)):f/n[3],y=m/Math.sqrt(Math.abs(n[3]**2-Te(i,r)**2));Di(c,g,y)}function uLe(t,e,i,r,s,n,o,a,l,c){mt(VB,t,e),gX(n.up,n.eye,v4,b4,w4),gX([0,0,1],n.eye,v_,Mb,fLe),ve(i,Mb),ve(r,v_),Ce(i,i),de(i,i,Ve(VB)),spe(t,Ce(b4,b4),Ce(w4,w4),Ce(v4,v4),Ume),spe(e,b4,w4,v4,Vme),mgt(Ume,Vme,t,v_,Mb,o,a,l,c,s)}function ggt(t,e,i,r,s,n,o){qu(kB,s,r),qu(UB,o,n),vr(jM,kB,UB),$e(e,t,i),nt(e,e,jM),Ee(e,e,i)}function hLe(t,e,i,r,s,n){qu(kB,r,i),qu(UB,n,s),vr(jM,kB,UB),$e(Tr,t.eye,e),nt(Tr,Tr,jM),t.eye=Ee(Tr,Tr,e),$e(Tr,t.center,e),nt(Tr,Tr,jM),t.center=Ee(Tr,Tr,e),$e(Tr,t.up,e),nt(Tr,Tr,jM),t.up=Ee(Tr,Tr,e)}function Ooe(t,e,i,r,s,n){return(Math.abs(r)>Math.PI-y4.Angle||Math.abs(r)<y4.Angle)&&(Math.abs(t[2])<i*y4.Pole||Math.abs(e)>i)&&n.aboveGround&&s<y4.Tilt}function dLe(t,e,i,r,s,n){if(n)Eoe(i,r,zme),rw(e,t,zme);else{const o=cLe(i,r,Bme,e,t[3],s);rw(e,t,rD(Bme,o))}}function pLe(t,e,i,r,s,n,o){const a=o?20:1,l=1e-12;let c,u;ve(Xw,r),T4.copyFrom(e);for(let d=0;d<a&&yo(i,Xw)>l&&(c=yo(i,Xw),uLe(i,Xw,Mb,v_,C$,T4,t,s,n,o),hLe(T4,t,v_,C$[1],Mb,C$[0]),ggt(Xw,Xw,t,v_,C$[1],Mb,C$[0]),u=yo(i,Xw),u<c||d===0);d++)e.copyFrom(T4)}function ygt(t,e,i,r,s,n,o){Ooe(i,Te(e.up,i),t[3],-Bb.normalize(kt(s)),n,e)?pLe(t,e,i,r,-Bb.normalize(kt(s)),n,o):dLe(t,e,i,r,n,o)}function _gt(t,e,i,r,s,n){const{eye:o}=t;gX([0,0,1],o,v_,Mb,fLe);const a=e.translation[0]*i.pan,l=s.mode==="zoom"?0:e.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-Te(t.center,v_)**2/Ve(t.center)**2)),.5),u=(Math.sin(n)*l+Math.cos(n)*a)/c,d=-Math.cos(n)*l+Math.sin(n)*a;switch(Uu(r.pan.matrix,r.pan.matrix,u,v_),r.pan.enabled=!0,s.mode){case"pan":Uu(r.pan.matrix,r.pan.matrix,d,Mb),r.pan.enabled=!0;break;case"zoom":r.zoom=-e.translation[1]*i.zoom}}function vgt(t,e,i,r,s){const{eye:n,viewRight:o}=t,a=mt(rt.get(),o,n),l=e.translation[0]*i.pan;switch(l!==0&&(Uu(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),s.mode){case"pan":{const c=e.translation[1]*i.pan;c!==0&&(Uu(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-e.translation[1]*i.zoom}}function bgt(t,e,i,r,s,n,o,a,l){Ooe(t.center,Te(t.up,t.center),Ve(t.center),-Bb.normalize(kt(n)),o,e)?_gt(e,i,r,a,l,-Bb.normalize(kt(s))):vgt(e,i,r,a,l)}const v_=C(),Mb=C(),fLe=C(),v4=C(),b4=C(),w4=C(),Ume=C(),Vme=C(),C$=gt(),zme=H6(),kB=ke(),UB=ke(),jM=ke(),Xw=C(),Tr=C(),x4=C(),T4=new Fr,VB=C(),Bme=C(),$oe={origin:C(),direction:C()},Hq={origin:C(),direction:C()},jme=.6,qq=4,wgt=60;let zB=class extends a_{constructor(){super(...arguments),this._zoomLocation=C(),this._tmpCamera=new Fr,this._tmpViewDir=C(),this._tmpRayDir={origin:C(),direction:C()},this._targetOnSphere=C(),this._tmpCenter=C(),this._beginCamera=new Fr,this._constraintOptions=new Tp(cs.ALL_EXCEPT_COLLISION,_i.ZOOM,null,this._beginCamera),this._sphere=_n()}initialize(){this._intersector=gp(this.view.state.viewingMode)}zoomStep(e,i){if(!this.active)return;const r=this.view.state;this.animation.finished?this._beginCamera.copyFrom(r.camera):this.animation.cameraAt(1,this._beginCamera);let s=!1,n=!1;this.intersectionHelper.intersectScreen(i,this._zoomLocation,this.view.map.ground.opacity===0?oE:{})&&(s=e>0,n=!0),this._tmpCamera.copyFrom(r.camera),s?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ve(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,i,n),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:yN}}_updateCamera(e,i,r,s,n){const o=_N(e,s,this.view.renderCoordsHelper,this.view.viewingMode),a=Math.abs(this.view.camera.position.z);Ce(E4,e.eye),de(E4,E4,-1),NO(e,s,this._tmpRayDir),Ce(this._tmpRayDir.direction,this._tmpRayDir.direction);const l=Ne(Math.min(eLe,1/Math.abs(Te(E4,this._tmpRayDir.direction)))*a,tLe,iLe);if(o===Na.Horizontal){let c=jme**i;this._sphere[3]=Ve(r),$e(this._tmpViewDir,e.center,e.eye);const u=Math.min(Ve(this._tmpViewDir),l);let d=u*c;if(c<=1&&d<qq&&(d=qq,c=d/u),Math.abs(u-d)<1e-6)return;const f=Ve(e.center);if(this._sphere[3]!==f){const m=this._sphere[3]+c*(f-this._sphere[3]);e.center=de(S4,e.center,m/f)}de(this._tmpViewDir,this._tmpViewDir,-c),e.eye=Ee(S4,e.center,this._tmpViewDir),fn(this.view,e,this._constraintOptions),yo(r,e.center)>1e-12&&Aoe(this._sphere,e,s,this._targetOnSphere)&&ygt(this._sphere,e,r,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let c=jme**Math.abs(i);const u=i>0?1:-1;$e(this._tmpViewDir,r,e.eye);const d=Ve(this._tmpViewDir),f=this.view._stage.renderView.getMinimalDepthForArea(null,s[0],s[1],this.view.state.camera,wgt);let m=f??l;m=n&&i>0?Math.min(m,d):m,de(this._tmpRayDir.direction,this._tmpRayDir.direction,m),Ee(r,this._tmpRayDir.origin,this._tmpRayDir.direction);let g=m*c;const y=Math.max(qq,1.01*e.nearFar[0]);if(i>0&&g<y&&(g=y,c=g/m),Math.abs(m-g)<1e-6)return;de(this._tmpRayDir.direction,this._tmpRayDir.direction,u*(1-c)),e.eye=Ee(S4,e.eye,this._tmpRayDir.direction),e.center=Ee(S4,e.center,this._tmpRayDir.direction)}DO(this.view,e)}};zB=h([I("esri.views.3d.state.controllers.ZoomStepControllerGlobal")],zB);const S4=C(),E4=C();let WU,ZU=null;const UA=new Map;async function mei(t){ZU==null&&(WU==null&&(WU=oe(()=>import("./VoxelWasmPerSceneView-bzxD9iFM.js"),[])),ZU=await WU);const e=t.view;let i=UA.get(e);return i||(i=new ZU.default({view:e}),UA.set(e,i)),i.addVoxelLayer(t)}function nD(t){return UA.get(t)}function gei(t){const e=t.view,i=UA.get(e);i&&i.removeVoxelLayer(t)<1&&(UA.delete(e),UA.size===0&&(WU=null,ZU=null))}const xgt=.6,Tgt=4,Sgt=60;let BB=class extends a_{constructor(){super(...arguments),this._zoomLocation=C(),this._tmpCamera=new Fr,this._tmpRayDir=C(),this._tmpCenter=C(),this._beginCamera=new Fr,this._constraintOptions=new Tp(cs.ALL,_i.ZOOM,null,this._beginCamera)}zoomStep(e,i){if(!this.active)return;const r=this.view.state;this.animation.finished?this._beginCamera.copyFrom(r.camera):this.animation.cameraAt(1,this._beginCamera),this._tmpCamera.copyFrom(r.camera);const s=gp(this.view.state.viewingMode);let n=!1;e>0?(n=this.intersectionHelper.intersectScreenFreePointFallback(i,this._zoomLocation,this.view.map.ground.opacity===0?oE:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ve(this._zoomLocation,this._tmpCamera.center);const o=xgt**e;let a=this.view._stage.renderView.getMinimalDepthForArea(nD(this.view),i[0],i[1],this.view.state.camera,Sgt);$e(C4,this._tmpCamera.eye,this._zoomLocation),Ce(C4,C4);const l=Ne(Math.min(eLe,1/Math.abs(Te(Egt,C4)))*Math.abs(this.view.camera.position.z),tLe,iLe);if(a=a??l,a){const c=C();$e(c,this._zoomLocation,this._tmpCamera.eye),(a<Ve(c)||!n)&&(Ce(c,c),Ee(this._zoomLocation,this._tmpCamera.eye,de(c,c,a)))}this._updateCamera(this._tmpCamera,o,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:yN}}_updateCamera(e,i,r){$e(this._tmpRayDir,r,e.eye);const s=Ve(this._tmpRayDir);let n=s*i;const o=i<=1,a=Math.max(Tgt,1.01*e.nearFar[0]);n!==0&&(o&&n<a&&(n=a,i=n/s),Math.abs(s-n)<1e-6||(de(this._tmpRayDir,this._tmpRayDir,i),e.eye=$e(Gme,r,this._tmpRayDir),e.center=Sr(Gme,e.center,r,1-i),fn(this.view,e,this._constraintOptions)))}};BB=h([I("esri.views.3d.state.controllers.ZoomStepControllerLocal")],BB);const Gme=C(),Egt=qe(0,0,1),C4=C();function Cgt(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function Roe(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let Mgt=class extends ba{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(e){const i=e.data;if(Cgt(i,"primary")){const r=this._view.state.isGlobal?new zB({view:this._view,mode:"animation"}):new BB({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),Os(i.x,i.y)),e.stopPropagation()}}};function Agt(t,e,i){return t===Je.Global?new Ogt(i):new Pgt(e,i)}let Pgt=class{constructor(e,i){this._elevationProvider=e,this._referenceEllipsoid=br(i),this._unitInMeters=cc(i,this._referenceEllipsoid.metersPerDegree)}compute(e,i,r,s,n){var x;n||(n={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-s,c=(x=this._elevationProvider)==null?void 0:x.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const u={x:(r=r??new dr({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},d=Math.max(u.x,u.y,u.z);$e(Jw,i,e),IE[0]=Jw[0]>0?r.xmax:r.xmin,IE[1]=Jw[1]>0?r.ymax:r.ymin,IE[2]=Jw[2]>0?d/2:-d/2,$e(IE,IE,e),Ce(Jw,Jw);const f=1.1*Te(IE,Jw)*this._unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),g=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),y=g*Igt*this._unitInMeters,v=g*Lgt*this._unitInMeters,b=Ne((o-v)/(y-v),0,1)**3,w=Math.min(Bt(m,f,b),m)*Math.max(Math.log(Math.abs(l)),1);return mLe(Math.min(w,Math.max(34064e4,d))/this._unitInMeters,$gt,this._unitInMeters,n)}},Ogt=class{constructor(e){this._referenceEllipsoid=br(e)}compute(e,i,r,s,n){n||(n={near:0,far:0});const o=Ve(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(a-s),u=Math.max(c,Math.abs(a)),d=Math.sqrt(u*(u+2*l)),f=o+this._referenceEllipsoid.radius;return mLe(1.2*Bt(d,f,Nne(u)),Ne(2e4-(Math.log(u)-7.983)/9.011*19900,100,2e4),1,n)}};function mLe(t,e,i,r){const s=Rgt/i;return t/e>s?(r.far=t,r.near=r.far/e):(r.near=s,r.far=r.near*e),r}const $gt=2e4,Rgt=2,Igt=.001,Lgt=1e-4,IE=C(),Jw=C();let YU=class extends Ue{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const i=this.view.state.camera;e.spatialReference!=null&&SOe(this.view,i,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>DO(this.view,e,op.EYE_AND_CENTER))}};h([p({constructOnly:!0})],YU.prototype,"view",void 0),YU=h([I("esri.views.3d.state.SurfaceCollisionConstraint")],YU);let hI=class extends Ue{constructor(e){super(e),this.nearFarHeuristic=Agt(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([te(()=>{var e,i,r,s;return[(i=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:i.near,(s=(r=this.view.constraints)==null?void 0:r.clipDistance)==null?void 0:s.far]},()=>this._clipDistanceNearFarChanged()),te(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:i.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),te(()=>this.view.renderDataExtent,()=>this._updateNearFar(),lr),te(()=>{var e,i,r,s;return[(i=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:i.min,(s=(r=this.view.constraints)==null?void 0:r.altitude)==null?void 0:s.max]},()=>this._updateAltitude(),lr),te(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:i.max},()=>this._updateTiltMax(),lr),te(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:i.mode},()=>this._updateTilt(),lr),te(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),lr),te(()=>{var e,i,r,s,n,o;return[(r=(i=(e=this.view.map)==null?void 0:e.ground)==null?void 0:i.navigationConstraint)==null?void 0:r.type,(o=(n=(s=this.view.state)==null?void 0:s.constraints)==null?void 0:n.collision)==null?void 0:o.enabled]},()=>this._updateCollision(),lr)]),this.view.state.isLocal&&this.addHandles(te(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),pt)),this._updateNearFar(),this.view.state.viewingMode!==Je.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new YU({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var i;const e=(i=this.view.constraints)==null?void 0:i.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(r=>Hme(r,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const i=this.view.constraints&&this.view.constraints.clipDistance;(i?i.mode:"auto")==="manual"?Hme(e,i):this._updateCameraNearFarAuto(e,i)}_updateCameraNearFarAuto(e,i){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,d6(this.view,e.eye),e),i&&i.autoUpdate(e.near,e.far)}_updateCollision(){var s,n,o;const e=(o=(n=(s=this.view.map)==null?void 0:s.ground)==null?void 0:n.navigationConstraint)==null?void 0:o.type,i=!e||e==="stay-above",r=this.view.state.constraints.collision;if(i!==r.enabled){r.enabled=i,i&&this._reapplyConstraints(cs.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Je.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const i=this.view.state.constraints;i.tilt=i.createConstantMaxTilt(kt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const i=this.view.state.constraints;if(i.tilt){const r=i.tilt(this.view.state.camera.distance).max;e.autoUpdate(ja(r))}}_updateLocalSurfaceDistance(e){if(e==null)return;let i=Math.max(e.width,e.height);if(i<=0)return;e.zmax!=null&&e.zmin!=null&&(i=Math.max(i,e.zmax-e.zmin));const r=this.view.state,s=3*i/Math.atan(r.camera.fov/2);s!==r.constraints.distance&&(r.constraints.distance=s)}_reapplyConstraints(e=cs.ALL){this.view.state.updateCamera(i=>fn(this.view,i,new Tp(e,_i.NONE,null)))}};function Hme(t,e){e&&(t.near=e.near,t.far=e.far)}h([p({constructOnly:!0})],hI.prototype,"view",void 0),h([p({readOnly:!0})],hI.prototype,"surfaceCollisionConstraint",void 0),hI=h([I("esri.views.3d.state.ConstraintsManager")],hI);let ub=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(e){this.renderCoordsHelper=e,this.frustum=QL(),this._points=FIe(),this.lines=new Array(12),this._origin=C(),this._direction=C(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:C(),endpoint:null}}update(e){kIe(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),ve(this._origin,e.eye),ve(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let i=0;i<this._points.length;i++)ve(this._points[i],e[i]);UIe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return cb(this.frustum,e)}intersectsRay(e){return adt(this.frustum,e)}intersectsLineSegment(e,i){return ldt(this.frustum,e,i)}intersectsPoint(e){return VIe(this.frustum,e)}_updateLines(){const e=this._points;for(let i=0;i<4;i++){const r=i+4;Wq(this.lines[i],e[i],e[r]),Wq(this.lines[i+4],e[i],i===3?e[0]:e[i+1]),Wq(this.lines[i+8],e[r],i===3?e[4]:e[r+1])}}};function Wq(t,e,i){t.origin=e,t.endpoint=i,U_(t.direction,e,i)}ub.planePointIndices=cdt,ub.nearFarLineIndices=[[vt.NEAR_BOTTOM_LEFT,vt.FAR_BOTTOM_LEFT],[vt.NEAR_BOTTOM_RIGHT,vt.FAR_BOTTOM_RIGHT],[vt.NEAR_TOP_RIGHT,vt.FAR_TOP_RIGHT],[vt.NEAR_TOP_LEFT,vt.FAR_TOP_LEFT]];let U3=class extends J0{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=xs.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||SOe(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),DO(this.view,e,op.EYE_AND_CENTER)||this.constraintEnabled||(this.state=xs.Stopped)})}};h([p({constructOnly:!0})],U3.prototype,"desiredCamera",null),U3=h([I("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],U3);const Dgt=.66;function gLe(t){return 360-BG.normalize(t)}function W6(t){return BG.normalize(360-t)}function yLe(t,e,i){const r=e.camera;if(r!=null)return Ngt(r,bw(t));const{targetGeometry:s}=e;if(s==null)return null;const{camera:n,mode:o}=vLe(t,e.rotation,i);if(s.type==="point")return kgt(t,e,s,n,o);const a=s.extent;return a==null?null:uU(t,a,n.heading,n.tilt,o)}async function _Le(t,e,i,r){const s=e.camera;if(s!=null)return Fgt(s,bw(t),r);const{targetGeometry:n}=e;if(n==null)throw new Error("Viewpoint has no targetGeometry!");const{camera:o,mode:a}=vLe(t,e.rotation,i);if(n.type==="point")return Ugt(t,e,n,o,a,r);const l=n.extent;if(l==null)throw new Error("Target geometry has no extent!");return JOe(t,l,o.heading,o.tilt,a,r)}function Ngt(t,e){const i=t.position;let r;try{r=Hb(i,e)}catch{return null}if(!r)return null;const s=t.clone();return s.position=r.clone(),s}async function Fgt(t,e,i){const r=t.position,s=await qb(r,e,{signal:i});Dt(i);const n=t.clone();return n.position=s.clone(),n}function vLe(t,e,i){const r=RP(t,t.state.camera);let s=Ua.ADJUST;return e!=null&&(r.heading=gLe(e),s=Ua.LOCKED),i!=null&&(r.tilt=i),{camera:r,mode:s}}function kgt(t,e,i,r,s){const n=t.spatialReference;let o;try{o=Hb(i.clone(),n)}catch{return null}if(!o)return null;const a=e.scale!=null?p6(t,e.scale,o.latitude):t.state.camera.distance;return hot(t,o,a,r,s)}async function Ugt(t,e,i,r,s,n){const o=t.spatialReference,a=await qb(i.clone(),o,{signal:n});Dt(n);const l=e.scale!=null?p6(t,e.scale,a.latitude):t.state.camera.distance;return VOe(t,a,l,r,s,n)}function bLe(t,e,i=null){return i==null&&(i=new um),Loe(t,null,e.clone(),i)}async function wLe(t,e,i){const r=Ygt(t,e);if(!r)throw new B("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new ed({fov:t.camera.fov}),n=new um({camera:s});if(r.target instanceof um)return Qw(await Bgt(t,r.target,r,i,n));if(r.target instanceof ed)return Qw(await TLe(t,r.target,i,n));const o=r.scale!=null||r.zoom!=null;if(r.target instanceof dr){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return Qw(o||c?await bK(t,r,r.target.center,s,i,n):await qgt(t,r,r.target,s,i,n))}const a=new Jgt,l=o?Vgt(t,r):void 0;if(await xLe(t,r.target,l,a,i),isFinite(a.boundingBox[0])){let c;if(jf(a.boundingBox,sn),Sh.x=sn[0],Sh.y=sn[1],Sh.z=sn[2],Sh.spatialReference=t.spatialReference,isFinite(Sh.z)&&a.hasZ?c=Sne(a.boundingBox):(Sh.z=void 0,c=dQe(Tne(a.boundingBox,Qgt))),o||c)return Qw(await bK(t,r,Sh,s,i,n));const u=Xgt(t,a.screenSpaceObjects);return Qw(await Zgt(t,r,Sh,a.boundingBox,u,s,i,n))}return r.position?Qw(await Ggt(t,r,s,n,i)):Qw(await Hgt(t,r,s,i,n))}function Ioe(t,e){return e.scale==null&&e.zoom!=null?i$e(t,e.zoom):e.scale}function Vgt(t,e){const i=Ioe(t,e);return i?Zit(i):void 0}function Z6(t,e){let i=!1;return e.heading!=null?(t.heading=e.heading,i=!0):e.rotation!=null&&(t.heading=gLe(e.rotation),i=!0),e.tilt!=null&&(t.tilt=e.tilt,i=!0),e.fov!=null&&(t.fov=e.fov),i}function Loe(t,e,i,r){const s=t.spatialReference||Ye.WGS84;if(e??(e=j0(t,i)),e==null)return r;const n=new wt({spatialReference:s});if(!vw(e.center,t.renderSpatialReference,n))return r;r.targetGeometry=n;const{latitude:o}=n;return r.scale=o!=null?Jb(t,e.distance,o):r$e(t,e),r.rotation=W6(i.heading),r.camera=i,r}async function jB(t,e,i,r){var d;const s=()=>new B("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw s();e.type==="mesh"&&(e=e.extent);const n=t.basemapTerrain.spatialReference;if(!e.hasZ&&t.basemapTerrain){let f;switch(e.type){case"point":f=e;break;case"multipoint":case"polyline":f=(d=e.extent)==null?void 0:d.center;break;case"extent":f=e.center;break;case"polygon":f=e.centroid}f!=null&&n&&t.elevationProvider?(f=await qb(f,n,{signal:r}),sn[2]=Gg(t.elevationProvider,f)??0):sn[2]=0}const o=Kgt[e.type],a=new Array;if(o(e,e.hasZ?f=>{a.push([f[0],f[1],f[2]])}:f=>{a.push([f[0],f[1]])},sn),a.length===0)throw s();const l=e.spatialReference,c=t.spatialReference,u=await qb(new vO({spatialReference:l,hasZ:e.hasZ,hasM:!1,points:a}),c,{signal:r});if(e.hasZ&&(i.hasZ=!0),e.hasZ)for(const[f,m,g]of u.points)sn[0]=f,sn[1]=m,sn[2]=g,hm(i.boundingBox,sn);else for(const[f,m]of u.points)sn[0]=f,sn[1]=m,hm(i.boundingBox,sn)}async function zgt(t,e,i,r,s){const n=await Qh(t.whenViewForGraphic(e));if(n.ok===!1||n.value==null||!("whenGraphicBounds"in n.value))return void await jB(t,e.geometry,r,s);const o=n.value,a=await Qh(o.whenGraphicBounds(e,{minDemResolution:i}));if(a.ok===!1||!a.value)return void await jB(t,e.geometry,r,s);const{screenSpaceObjects:l,boundingBox:c}=a.value;NP(r.boundingBox,c),l&&l.forEach(u=>{r.screenSpaceObjects.push(u)}),isFinite(c[2])&&(r.hasZ=!0)}async function xLe(t,e,i,r,s){var n;if(Array.isArray(e)&&e.length===2){const o=e[0],a=e[1];if(typeof o=="number"&&typeof a=="number")return Sh.x=o,Sh.y=a,Sh.z=void 0,Sh.spatialReference=(n=t.spatialReference)!=null&&n.isGeographic?t.spatialReference:Ye.WGS84,void await jB(t,Sh,r,s)}e&&"map"in e&&typeof e.map=="function"?await Promise.allSettled(e.map(o=>xLe(t,o,i,r,s))):e instanceof pw?await jB(t,e,r,s):e instanceof ya&&await zgt(t,e,i,r,s)}async function Bgt(t,e,i,r,s){if(e.camera)return TLe(t,e.camera,r,s);s.scale=e.scale,s.rotation=e.rotation,s.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,s.camera=null,i.heading!=null?s.rotation=W6(i.heading):i.rotation!=null&&(s.rotation=i.rotation);const n=Ioe(t,i);return n!=null&&(s.scale=n),s.camera=await _Le(t,s,i.tilt,r),s}async function TLe(t,e,i,r){const s=t.spatialReference,n=await qb(e.position,s,{signal:i}),o=e.clone();return o.position=n,Loe(t,null,o,r)}async function jgt(t,e,i,r,s,n,o){const a=t.renderSpatialReference;return await sB(e,Zq,a,0,{signal:o}),await sB(i,A4,a,0,{signal:o}),n.targetGeometry=new wt(e),s.position=new wt(i),$e(GB,Zq,A4),f6(t,A4,GB,r.up,s),n.scale=Jb(t,Ar(A4,Zq),n.targetGeometry.latitude),n.rotation=W6(s.heading),n.camera=s,n}async function bK(t,e,i,r,s,n){n.targetGeometry=i.clone();const o=Z2(t);if(e.position)return jgt(t,n.targetGeometry,e.position,o,r,n,s);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=de(sn,o.viewForward,-l);o.eye=Ee(sn,o.center,c),n.scale=Jb(t,l,i.latitude)}RP(t,o,r);const a=Z6(r,e)?Ua.LOCKED:Ua.ADJUST;if(!e.zoomFactor){const l=Ioe(t,e);l==null?(await sB(i,sn,t.renderSpatialReference,0,{signal:s}),VIe(o.frustum,sn)?n.scale=Jb(t,Ar(o.eye,sn),i.latitude):n.scale=r$e(t,o)):n.scale=l,n.camera=await UOe(t,n.targetGeometry,n.scale,r,a,s)}return n}async function Ggt(t,e,i,r,s){const n=Z2(t);ve(GB,n.viewForward),f6(t,n.eye,GB,n.up,Yq);const o=t.spatialReference,{position:a}=e;if(a){const l=await qb(a,o,{signal:s});i.position=l}else i.position=new wt;return i.heading=e.heading!=null?e.heading:Yq.heading,i.tilt=e.tilt!=null?e.tilt:Yq.tilt,Loe(t,null,i,r)}async function Hgt(t,e,i,r,s){if(e.heading!=null||e.rotation!=null||e.scale!=null||e.tilt!=null||e.zoom!=null||e.zoomFactor!=null){const n=Z2(t),{spatialReference:o,renderSpatialReference:a}=t,l=new wt({spatialReference:o});return vw(n.center,a,l)?bK(t,e,l,i,r,s):s}return s.scale=t.scale,s.camera=t.camera.clone(),Z6(s.camera,e),s}async function qgt(t,e,i,r,s,n){n.targetGeometry=i.clone();const o=Z2(t);RP(t,o,r);const a=Z6(r,e)?Ua.LOCKED:Ua.ADJUST;return n.camera=await JOe(t,i,r.heading,r.tilt,a,s),n}function Wgt(t,e,i,r,s){let n=0;i.z!=null?n=i.z:t.basemapTerrain&&t.elevationProvider&&(n=Gg(t.elevationProvider,i)),pe(sn,i.x,i.y,n),Gh(t.spatialReference,sn,qme,t.renderSpatialReference),wp(M4,qme),W2(M4,M4),Qr(M$);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let g=0;g<o.length;g++){const y=o[g];let v=r[y[2]];isFinite(v)||(v=n),pe(sn,r[y[0]],r[y[1]],v),Go(sn,t.spatialReference,sn,t.renderSpatialReference),hm(M$,ca(sn,sn,M4))}const a=X2(M$),l=xw(M$),c=J2(M$),u=1/Math.tan(e.fovX/2),d=1/Math.tan(e.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(d,u)+.5*l,m=.5*l*d+.5*Math.max(a,c);return Math.max(f,m)/s}async function Zgt(t,e,i,r,s,n,o,a){a.targetGeometry=i.clone();const l=Z2(t),c=Wgt(t,l,i,r,s);RP(t,l,n);const u=Z6(n,e)?Ua.LOCKED:Ua.ADJUST;return a.scale=Jb(t,c,a.targetGeometry.latitude),a.camera=await UOe(t,a.targetGeometry,a.scale,n,u,o),a}function Ygt(t,e){if(!e||!t.spatialReference)return null;const i={target:void 0};return"declaredClass"in e||Array.isArray(e)?i.target=e:(Object.assign(i,e),!i.target&&"center"in e&&e.center&&(i.target=e.center)),i}function Qw(t){return(t==null?void 0:t.camera)!=null&&(t.rotation=W6(t.camera.heading)),t}function Xgt(t,e){const i=Dgt;if(!e.length)return i;let r=Number.NEGATIVE_INFINITY;for(let s=0;s<e.length;s++){const n=e[s].screenSpaceBoundingRect;r=Math.max(r,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return i-r/Math.min(t.width,t.height)*2}class Jgt{constructor(){this.hasZ=!1,this.boundingBox=Qr(),this.screenSpaceObjects=new Array}}const sn=C(),qme=ke(),M4=Kr(),M$=io(),Qgt=oi(),GB=C(),A4=C(),Zq=C(),Yq={heading:0,tilt:0},Sh=new wt,Kgt={point(t,e,i){i[0]=t.x,i[1]=t.y,t.z!=null&&(i[2]=t.z),e(i)},polygon(t,e,i){const r=t.hasZ;for(let s=0;s<t.rings.length;s++){const n=t.rings[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),e(i)}},polyline(t,e,i){const r=t.hasZ;for(let s=0;s<t.paths.length;s++){const n=t.paths[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),e(i)}},multipoint(t,e,i){const r=t.points,s=t.hasZ;for(let n=0;n<r.length;n++)i[0]=r[n][0],i[1]=r[n][1],s&&(i[2]=r[n][2]),e(i)},extent(t,e,i){t.zmin!=null&&t.zmax!=null?(e(pe(i,t.xmin,t.ymin,t.zmin)),e(pe(i,t.xmax,t.ymin,t.zmin)),e(pe(i,t.xmin,t.ymax,t.zmin)),e(pe(i,t.xmax,t.ymax,t.zmin)),e(pe(i,t.xmin,t.ymin,t.zmax)),e(pe(i,t.xmax,t.ymin,t.zmax)),e(pe(i,t.xmin,t.ymax,t.zmax)),e(pe(i,t.xmax,t.ymax,t.zmax))):(e(pe(i,t.xmin,t.ymin,i[2])),e(pe(i,t.xmax,t.ymin,i[2])),e(pe(i,t.xmin,t.ymax,i[2])),e(pe(i,t.xmax,t.ymax,i[2])))}},eyt=Object.freeze(Object.defineProperty({__proto__:null,create:wLe,fromCamera:bLe,toCameraAsync:_Le,toCameraSync:yLe},Symbol.toStringTag,{value:"Module"}));let tyt=class{constructor(e,i,r){this._target=e,this._options=i,this.view=r,this.state="pending",this._animationController=null,this.promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const o=new AbortController;this._options.signal!=null&&Va(this._options.signal,()=>{this.abort()}),this._abortController=o,this._waitForReady()})}_resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}_reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this._reject(Ui())}async _waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await d2(()=>this.view.ready,this._abortController.signal)}catch(e){return this._reject(e)}this._createViewPoint()}async _createViewPoint(){if(this.state!=="finished"){this.state="wait-for-viewpoint",this._animationController=this._options.animate?this._getAnimationController():null;try{const e=await wLe(this.view,this._target,this._abortController.signal);if(this.state==="finished")return;const i=e?this._getCameraFromViewpoint(e):null;if(i==null)return;if(this._options.animate){if(this._animationController==null)return;this._startAnimation(i,this._animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this._resolve()}catch(e){this._reject(e)}}}_getCameraFromViewpoint(e){var n;const i=!!(this._target instanceof um&&this._target.camera||this._target instanceof ed),r=e.camera;if(r==null)return null;if(!this.view.stateManager.isCompatible(r)){const o=r.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(n=this.view.spatialReference)==null?void 0:n.wkid;return this._reject(new B("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:r})),null}const s=j0(this.view,r);return s==null?(this._reject(new B("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:s,isFullySpecified:i}}_startAnimation(e,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(r==null)return void this._reject(new B("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(e.viewpoint,"running"),!i.active||i.viewAnimation==null||i.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==i)return this.abort();let s;e.isFullySpecified?(s=new U3({view:this.view,desiredCamera:e.camera}),DO(this.view,e.camera,op.EYE_AND_CENTER)):fn(this.view,e.camera),i.begin(e.camera,this._options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof a_&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=s):i.viewAnimation!=null&&i.viewAnimation.target===e.viewpoint&&i.state===xs.Finished&&(this.view.state.cameraController=s))},o=a=>{if(this.view.state!=null)switch(i.state){case xs.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._resolve()}break;case xs.Ready:case xs.Rejected:case xs.Running:case xs.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this._reject(a)}}};r.when(n,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,i=null;const r=this.view.state.cameraController;return r instanceof a_&&(r.updateStateFromViewAnimation(),r.active&&(e=r,i=e.viewAnimation)),e!=null||(e=new a_({view:this.view,mode:"animation"}),i=e.viewAnimation,this.view.state.switchCameraController(e))?e:(i!=null&&i.stop(),this._reject(new B("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},sw=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,i){var r;return(r=this._outer.get(e))==null?void 0:r.get(i)}set(e,i,r){const s=this._outer.get(e);s?s.set(i,r):this._outer.set(e,new Map([[i,r]]))}delete(e,i){const r=this._outer.get(e);r&&(r.delete(i),r.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((i,r)=>e(i,r))}};var tn;function Wme(t=!ue("disable-feature:high-quality-idle"),e=null){const i=new sw;return t?(i.set(Ii.IDLE,tn.Antialiasing,e!=="low"),i.set(Ii.IDLE,tn.HighResolutionAtmosphere,e!=="low"),i.set(Ii.IDLE,tn.HighQualityTransparency,!0),i.set(Ii.IDLE,tn.SSAO,!0),i.set(Ii.IDLE,tn.WaterReflection,!0),i.set(Ii.IDLE,tn.PhysicalPixelRendering,!0)):(i.set(Ii.ANIMATING,tn.HighResolutionShadows,!0),i.set(Ii.ANIMATING,tn.HighResolutionViewshed,!0),i.set(Ii.INTERACTING,tn.HighResolutionShadows,!0),i.set(Ii.INTERACTING,tn.HighResolutionViewshed,!0)),i.set(Ii.IDLE,tn.HighResolutionShadows,!0),i.set(Ii.IDLE,tn.HighResolutionViewshed,!0),i.set(Ii.IDLE,tn.HighResolutionVoxel,!0),i}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.HighResolutionViewshed=7]="HighResolutionViewshed",t[t.PhysicalPixelRendering=8]="PhysicalPixelRendering"})(tn||(tn={}));let cn=class extends Ue{constructor(e){super(e),this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=Zme,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:i=>this._devicePixelRatioOverride=i,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return this.renderState!=null},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(i){this.viewStateManager._idleTimeout=i?Zme:0}},this._propertiesPool=new O_({frustum:ub},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new iyt}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([on(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),te(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,i)=>this._cameraChangedHandler(e,i),lr)]),jo(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([t2({prepare:()=>this._prepareFrame()}),te(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(O4)}),on(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=He(this._propertiesPool)}get camera(){const e=this._get("camera");if(!this.ready)return e;const i=RP(this.view,this.view.state.camera,Xq);return i&&e&&i.equals(e)?e:i.clone()}set camera(e){var i,r;this._updatePropertyBeforeReady("camera",e)||((i=this.view.elevationProvider)==null||i.enableCache(!0),this.setStateCamera(j0(this.view,e),{applyConstraints:!1})||ne.getLogger(this).error("#camera=","Invalid camera",e),(r=this.view.elevationProvider)==null||r.enableCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const i=RP(this.view,this.view.state.contentCamera,Xq);return i&&e&&i.equals(e)?e:i.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const i=j0(this.view,e);i!=null?(this._updateElevation(i),this.view.state.contentCamera=i):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(Jq),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const i=this.zoom,r=this.view.state.camera.distance**2,s=Xl(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.addHandles([te(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(Jq),this.test.contentCameraResetState.clear())}),te(()=>this.zoom,o=>{o!==void 0&&i!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-i)/2),Math.abs(o-i)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n))}),te(()=>this.view.state.camera,o=>{const a=yo(s,o.center);this.test.contentCameraResetState.set("camera.center",a/r),a>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],Jq),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var i;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():ne.getLogger(this).error("#center=","Invalid center",e):ne.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e):ne.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,i=QOe(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return i??this._get("extent")}set extent(e){var i;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||ne.getLogger(this).error("#extent=","Invalid extent",e):ne.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e):ne.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get constraintsManager(){return this._constraintsManager}get _initialViewpoint(){var i;const e=this.view.map;return e&&"initialViewProperties"in e?(i=e.initialViewProperties)==null?void 0:i.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return Jb(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||ne.getLogger(this).error("#scale=","Invalid scale",e)}get terrainScale(){if(!this.ready)return this._get("scale");const e=this.view,i=e.basemapTerrain.tilingScheme,r=e.pointsOfInterest.cameraOnSurface.scale;if(!i||!r)return this._get("scale");const s=e.state.contentCamera;let n=f6(e,s.eye,s.viewForward,s.up).tilt;n>90&&(n=180-n);const o=2*(n/90)**2,a=i.levelAtScale(r)-o;return a<0?this._get("scale"):i.scaleAtLevel(a)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,i=e.padding,r=e.pixelRatio,s=this._get("padding"),n=Math.round(i[gi.TOP]/r),o=Math.round(i[gi.RIGHT]/r),a=Math.round(i[gi.BOTTOM]/r),l=Math.round(i[gi.LEFT]/r);return s!=null&&s.top===n&&s.right===o&&s.bottom===a&&s.left===l?s:{top:n,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,P4),this.view.state.updateCamera(i=>i.padding=P4))}_paddingToArray(e,i,r){e?Ss(r,e.top||0,e.right||0,e.bottom||0,e.left||0):Ss(r,0,0,0,0);for(let s=0;s<4;s++)r[s]=Math.round(r[s]*i)}get screenCenter(){const e=this.padding;return fp((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?bLe(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var i;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||ne.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const r=e.camera!=null?e.camera.position:e.targetGeometry,s=r!=null&&r.spatialReference;ne.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(s?s.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e)}else ne.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?vot(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||ne.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){var s;if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),i=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*i),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*i);const r=(s=this.view._stage.renderView.renderingContext)==null?void 0:s.parameters.maxTextureSize;return r&&cS(this._tmpCanvasSize,r),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:i,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,i;return((i=(e=this.view)==null?void 0:e._stage)==null?void 0:i.renderer.isFeatureEnabled(tn.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var i,r;const e=(r=(i=this.view)==null?void 0:i._stage)==null?void 0:r.renderer;return e&&(e.isFeatureEnabled(tn.PhysicalPixelRendering,Ii.IDLE)||e.isFeatureEnabled(tn.PhysicalPixelRendering,Ii.INTERACTING)||e.isFeatureEnabled(tn.PhysicalPixelRendering,Ii.ANIMATING))}preinit(e){var i,r,s;return!(this._isOverridden("center")&&!SC(this.center.spatialReference,e))&&!(this._isOverridden("camera")&&!SC(this.camera.position.spatialReference,e))&&!(this._isOverridden("extent")&&!SC(this.extent.spatialReference,e))&&!!(!this._isOverridden("viewpoint")||SC((i=this.viewpoint.targetGeometry)==null?void 0:i.spatialReference,e)&&SC((s=(r=this.viewpoint.camera)==null?void 0:r.position)==null?void 0:s.spatialReference,e))}init(){this._constraintsManager=new hI({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const i of e)this.set(i.name,i.value);if(!this._cameraSetByUser){const i=this._initialViewpoint||this.view.initialExtent;i&&this.isCompatible(i)?this._setInitialView(i):this.view.state.viewingMode===Je.Local&&this.addHandles(jo(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(O4),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),O4)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(O4),this._constraintsManager=He(this._constraintsManager))}async goTo(e,i){return i={animate:!0,...i},this._gotoOperation!=null&&this._gotoOperation.abort(i.animate),this._gotoOperation=new tyt(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(Z2(this.view),{applyConstraints:!1})}step(e){const i=this.view.state,r=i==null?void 0:i.cameraController;r&&(i.updateCamera(s=>r.stepController(e,s)),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,i=[];for(const{propertyName:r,overrides:s}of syt){const n=e.has(r),o=this._isOverridden(r);!n&&o&&i.push({name:r,value:this._get(r)}),this._clearOverride(r),(n||o)&&s.forEach(a=>e.add(a))}return i}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof ed)return void this.setStateCamera(j0(this.view,e),{applyConstraints:!1});if(e instanceof um){if(e.targetGeometry instanceof dr){const n=uU(this.view,e.targetGeometry,0,.5,Ua.LOCKED);return void(n!=null&&this.setStateCamera(j0(this.view,n),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},s=this._viewpointToCamera(e);return void this.setStateCamera(s,r)}const i=uU(this.view,e,0,.5,Ua.LOCKED);i!=null&&this.setStateCamera(j0(this.view,i),{applyConstraints:!0})}_updatePropertyBeforeReady(e,i){return!this.ready&&(this._override(e,i),i&&ryt.has(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof um?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof ed?this.isCompatible(e.position):e.spatialReference&&!KMe(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=nyt){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,i,r=Cv){const{heading:s,tilt:n}=this._getPreservingHeadingTilt(),o=one(this.view,s,n,e,i,Ua.ADJUST);return o==null?null:(r.copyFrom(this.view.state.camera),r.eye=o.eye,r.center=o.center,r.up=o.up,r)}_centerToCamera(e){const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.distance;return this._centerPointAtDistanceToCamera(e,r)}_extentToCamera(e){const{heading:i,tilt:r}=this._getPreservingHeadingTilt(),s=uU(this.view,e,i,r,Ua.ADJUST,Xq);return s?j0(this.view,s):null}_scaleToCamera(e){if(e==null)return null;const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.renderLocation,s=i.location.latitude,n=p6(this.view,e,s);return this._centerPointAtDistanceToCamera(r,n)}_zoomToCamera(e){return this._scaleToCamera(i$e(this.view,e))}_viewpointToCamera(e){return j0(this.view,yLe(this.view,e))}setStateCamera(e,i){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,i.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{i.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up,r.fov=e.fov):r.copyFrom(e),i.applyConstraints&&fn(this.view,r)}),i.applyConstraints||(this.view.state.cameraController=new U3({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:i}=this.view;if(!e||!i)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._computeCanvasSize();if(r.width!==0&&r.height!==0&&(i.width===r.width&&i.height===r.height||(i.width=r.width,i.height=r.height),this.view.state)){const s=this.view.state.camera;s.fullWidth===r.width&&s.fullHeight===r.height&&s.pixelRatio===r.pixelRatio||(Cv.copyFrom(s),Cv.pixelRatio!==r.pixelRatio&&(this._paddingToArray(this.padding,r.pixelRatio,P4),Cv.padding=P4),Cv.fullWidth=r.width,Cv.fullHeight=r.height,Cv.pixelRatio=r.pixelRatio,this.view.state.camera=Cv),this._updateViewState()}}_updateElevation(e){var n,o;const i=(n=this.view.basemapTerrain)==null?void 0:n.spatialReference,r=((o=this.view.renderCoordsHelper)==null?void 0:o.getAltitude(e.eye))??0,s=i?d6(this.view,e.eye):0;e.relativeElevation=r-s}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Ii.ANIMATING:this.view.interacting?this.view.state.mode=Ii.INTERACTING:(this.view.state.mode===Ii.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=Ii.INTERACTING:this.view.state.mode=Ii.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,i){e&&i&&e.almostEquals(i)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};h([p({type:ed,dependsOn:["view.state.camera","ready"]})],cn.prototype,"camera",null),h([p({type:ed,dependsOn:["view.state.contentCamera","ready"]})],cn.prototype,"contentCamera",null),h([p({type:wt})],cn.prototype,"center",null),h([p({type:dr})],cn.prototype,"extent",null),h([p({readOnly:!0})],cn.prototype,"frustum",null),h([p()],cn.prototype,"_constraintsManager",void 0),h([p({readOnly:!0})],cn.prototype,"constraintsManager",null),h([p()],cn.prototype,"_initialViewpoint",null),h([p({readOnly:!0})],cn.prototype,"hasInitialView",null),h([p({readOnly:!0,type:Boolean})],cn.prototype,"ready",void 0),h([p({type:Number})],cn.prototype,"scale",null),h([p({type:Number})],cn.prototype,"terrainScale",null),h([p()],cn.prototype,"padding",null),h([p({readOnly:!0})],cn.prototype,"screenCenter",null),h([p({constructOnly:!0})],cn.prototype,"view",void 0),h([p({type:um})],cn.prototype,"viewpoint",null),h([p({type:Number})],cn.prototype,"zoom",null),h([p({readOnly:!0})],cn.prototype,"_rasterPixelRatio",null),h([p({readOnly:!0})],cn.prototype,"_usePhysicalPixelRendering",null),h([p({readOnly:!0})],cn.prototype,"_usePhysicalPixelRenderingAny",null),h([p()],cn.prototype,"_windowDevicePixelRatio",void 0),h([p()],cn.prototype,"_devicePixelRatioOverride",void 0),cn=h([I("esri.views.3d.state.ViewStateManager")],cn);let iyt=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const ryt=new Set(["camera","viewpoint","extent","scale","center","zoom"]),syt=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],nyt={heading:0,tilt:0},Xq=new ed,Cv=new Fr,P4=ci(),O4="pending-initial-view",Jq="content-camera-reset",Zme=300,Yme=100;let Wg=class extends J0{constructor(){super(...arguments),this.startCamera=new Fr,this.currentCamera=new Fr,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<Yme}stepController(e,i){i.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(i)}onControllerStart(e){this.state=xs.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),Yme),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};h([p({readOnly:!0})],Wg.prototype,"isInteractive",null),h([p()],Wg.prototype,"_lastInteraction",void 0),Wg=h([I("esri.views.3d.state.controllers.InteractiveController")],Wg);var Su;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(Su||(Su={}));let V3=class extends Wg{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=Su.CENTER,this._rotScale=0,this._lastPoint=gt(),this._tmpWorldUp=C(),this._tmpViewDir=C(),this._tmpRotCurPoint=gt(),this._tmpTransf=ke(),this._tmpAxis=C(),this._tmpPivotPoint=C(),this._pivotPos=C(),this._constraintOptions=new Tp(cs.ALL,_i.TUMBLE,0,this.startCamera)}initialize(){this._rotScale=this.pivot===Su.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case Su.EYE:ve(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=_i.LOOK_AROUND,this._constraintOptions.tiltMode=xy.LOOK_AROUND,this._constraintOptions.selection=cs.NONE;break;case Su.CENTER:{const i=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?oE:{});i||ve(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,i),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=_i.TUMBLE,this._constraintOptions.tiltMode=xy.TUMBLE,this._constraintOptions.selection=cs.ALL&~cs.DISTANCE;break}}BS(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,i){const r=this.startCamera,s=C();$e(s,this._pivotPos,r.eye);const n=Ve(s),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(r.eye,Xme);let a=Math.max(Math.min(dgt,1/Math.abs(Te(Xme,r.viewForward)))*o,pgt);i&&(a=Math.min(n,a));const l=Os(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),c=_N(this.startCamera,l,this.view.renderCoordsHelper,this.view.viewingMode);let u=this.view._stage.renderView.getMinimalDepthForArea(nD(this.view),r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*Bq,Bq),d=this.view._stage.renderView.getMinimalDepthForArea(nD(this.view),e[0],e[1],r,Bq);u==null&&d==null||(u=u??d??0,d=d==null||c===Na.Horizontal?u:d,a=u>d?d:u,a=i?Math.min(a,n):a),Ce(s,s),ve(this._pivotPos,Ee(this._tmpPivotPoint,r.eye,de(this._tmpPivotPoint,s,a)))}update(e){if(this.active){switch(this.pivot){case Su.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case Su.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}fn(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,i,r,s){this.view.renderCoordsHelper.worldUpAtPosition(s,this._tmpWorldUp),BS(e,i,this._tmpRotCurPoint);let n=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;$e(this._tmpViewDir,r,s);const a=Ve(this._tmpViewDir),l=vo(Te(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===Su.EYE){n*=-.5;const c=.5*Math.PI-l,u=.5*Math.PI*.99;n=c-Math.max(-u,Math.min(u,c+n))}return n=Ne(n+l,Ia.min,Ia.max)-l,mt(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===Su.CENTER&&(o=-o),qu(this._tmpTransf,o,this._tmpWorldUp),Uu(this._tmpTransf,this._tmpTransf,n,this._tmpAxis),nt(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=nt(Qq,e.up,this._tmpTransf),Ee(Qq,s,this._tmpViewDir),Ga(this._lastPoint,this._tmpRotCurPoint),Qq}};h([p()],V3.prototype,"pivot",void 0),V3=h([I("esri.views.3d.state.controllers.RotateController")],V3);const Qq=C(),Xme=C();let Kq=class extends ba{constructor(e,i,r,s){super(!0),this._view=e,this.pointerAction=i,this._pivot=r,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!Roe(e.data,this.pointerAction))return;const r=Os(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new V3({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},wK=class extends Wg{constructor(){super(...arguments),this._pickPoint=C(),this._tmpP0=gt(),this._panAxisAngle=H6(),this._tmpRayDir=C(),this._tmpRayDirPick=C(),this._targetOnSphere=C(),this._navMode=Na.Horizontal,this._tmpRay={origin:C(),direction:C()},this.dragBeginPoint=Os(),this._normalizedAnchorPoint=gt(),this._constraintOptions=new Tp(cs.ALL_EXCEPT_COLLISION,_i.ZOOM,0,this.startCamera),this._sphere=_n(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Ga(this.dragBeginPoint,e),BS(this.startCamera,e,this._normalizedAnchorPoint);const i=br(this.view.spatialReference),r=aLe(this._intersectionHelper,this.startCamera,e,i,BP.Ellipsoid,this.view.map.ground.opacity===0?oE:{});if(this._navMode=_N(this.startCamera,e,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===Na.Horizontal)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=r.scenePickPoint??this._pickPoint,this._sphere=r.sphere;else{let s;NO(this.startCamera,e,this._tmpRay),Ce(this._tmpRay.direction,this._tmpRay.direction),r.scenePickPoint!=null&&($e(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),s=Ve(this._tmpRayDirPick));const n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,Jme);let o=Ne(Math.min(K3e,1/Math.abs(Te(Jme,this._tmpRay.direction)))*n,FB[0],FB[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,q6);o=a??o,o=s!=null?Math.min(o,s):o,this._hasPickPoint=!0,de(this._tmpRay.direction,this._tmpRay.direction,o),Ee(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===Na.Horizontal){$e(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const i=Ve(this._tmpRayDir);BS(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=i*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(i-s)<1e-6)return;if(this._hasPickPoint&&s<i){const o=1-(1-s/i)*(1-this._sphere[3]/Ve(this.currentCamera.center));this.currentCamera.center=de($4,this.currentCamera.center,o)}de(this._tmpRayDir,this._tmpRayDir,-s/i),this.currentCamera.eye=Ee($4,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=$f(Kb(this.dragBeginPoint,e)),fn(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(sD(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),Eoe(this._pickPoint,this._targetOnSphere,this._panAxisAngle),rw(this.currentCamera,this._sphere,this._panAxisAngle))}else{const i=Ve(this._tmpRay.direction);BS(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=i*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<n&&(s=n),Math.abs(i-s)<1e-6)return;de(this._tmpRayDir,this._tmpRay.direction,1-s/i),this.currentCamera.eye=Ee($4,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=Ee($4,this.currentCamera.center,this._tmpRayDir)}DO(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};wK=h([I("esri.views.3d.state.controllers.ZoomControllerGlobal")],wK);const $4=C(),Jme=C();let xK=class extends Wg{constructor(){super(...arguments),this._tmpP=C(),this._tmpDir=C(),this._tmpN=C(),this._tmpP0=gt(),this._tmpPoi=C(),this._tmpRayDir=C(),this.dragBeginPoint=Os(),this._normalizedAnchorPoint=gt(),this._constraintOptions=new Tp(cs.ALL,_i.ZOOM,0,this.startCamera,C()),this._plane=rr()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Ga(this.dragBeginPoint,e),BS(this.startCamera,e,this._normalizedAnchorPoint);const i=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?oE:{});$e(this._tmpDir,this._tmpP,this.startCamera.eye);const r=Ve(this._tmpDir);Ce(this._tmpDir,this._tmpDir);const s=Math.abs(this.view.camera.position.z);let n=Ne(Math.min(K3e,1/Math.abs(Te(oyt,this._tmpDir)))*s,FB[0],FB[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(nD(this.view),e[0],e[1],this.view.state.camera,q6);n=o??n,n=i?Math.min(n,r):n,de(this._tmpDir,this._tmpDir,n),Ee(this._tmpP,this.startCamera.eye,this._tmpDir),$e(this._tmpN,this.startCamera.eye,this.startCamera.center),Ce(this._tmpN,this._tmpN),this._tmpN[1]<0&&da(this._tmpN,this._tmpN),KD(this._tmpP,this._tmpN,this._plane)}update(e){if(!this.active)return;fgt(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||ve(this._tmpPoi,this.currentCamera.center),BS(this.currentCamera,e,this._tmpP0);let i=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);Ga(this._normalizedAnchorPoint,this._tmpP0),$e(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=Ve(this._tmpRayDir);let s=r*(1-i);this._constraintOptions.interactionDirection&&(ve(this._constraintOptions.interactionDirection,this._tmpRayDir),de(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(i)/r));const n=this.view.state.constraints.minimumPoiDistance;i>=0&&s<n&&(s=n,i=-(s-r)/r),Math.abs(r-s)<1e-6||(de(this._tmpRayDir,this._tmpRayDir,i),this.currentCamera.eye=Ee(Kw,this.currentCamera.eye,this._tmpRayDir),Sr(Kw,this.currentCamera.center,this._tmpPoi,i),this._tmpPoi[2]>this.startCamera.center[2]?Kw[2]=Math.max(this.startCamera.center[2],Kw[2]):Kw[2]=Math.min(this.startCamera.center[2],Kw[2]),this.currentCamera.center=Kw,this._constraintOptions.interactionFactor=$f(Kb(this.dragBeginPoint,e)),fn(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};xK=h([I("esri.views.3d.state.controllers.ZoomControllerLocal")],xK);const Kw=C(),oyt=qe(0,0,1);let ayt=class extends ba{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!Roe(e.data,this.pointerAction))return;const r=Os(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new wK({view:this._view}):this._cameraController=new xK({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function Dp(t){let e=t*t;return t<0&&(e*=-1),e}function Qme(t,e,i){const r=i,s=t.state,n=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(r.translation[0]=Dp(s.axes[0]),r.translation[1]=Dp(s.axes[1]),r.translation[2]=Dp(s.buttons[7])-Dp(s.buttons[6]),r.heading=Dp(s.axes[2]),r.tilt=Dp(s.axes[3])):n.deviceType==="spacemouse"&&(r.translation[0]=1.2*Dp(s.axes[0]),r.translation[1]=1.2*Dp(s.axes[1]),r.translation[2]=2*-Dp(s.axes[2]),r.heading=1.2*Dp(s.axes[5]),r.tilt=1.2*Dp(s.axes[3])),r.tilt*=o,de(r.translation,r.translation,a),r}function Kme(t,e){const i=e;return i.translation[0]=t[1]-t[0],i.translation[1]=t[3]-t[2],i.translation[2]=t[4]-t[5],i.heading=t[7]-t[6],i.tilt=t[8]-t[9],i.zoom=t[10]-t[11],i}function e9(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let uS=class extends Wg{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new Fr,this._headingStart=0,this._constraintOptions=new Tp(cs.ALL,_i.NONE,0,new Fr,null,xy.LOOK_AROUND)}handleEventGamepad(e){const i=Qme(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||e9(i))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,Kme(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const i=Kme(this._keysButtonState,this._transformation);e9(i)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const i=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this._filteredSurfaceElevation+=r*(i-this._filteredSurfaceElevation)*e}stepController(e,i){var r;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(i),this._updateCameraCenter(),(r=this._constraintOptions.interactionStartCamera)==null||r.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,ex),this._applyDisabledMovementTypes(ex),this._applyPan(ex.pan),this._applyRotate(ex.rotate),this._applyZoom(ex.zoom),this._applyAscend(ex.ascend),this._constraintOptions.interactionType=_i.NONE,this._constraintOptions.selection=cs.COLLISION,fn(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,i)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const i=this.currentCamera;$e(pc,i.center,i.eye),nt(pc,pc,e.matrix),i.center=Ee(pc,pc,i.eye),i.up=nt(pc,i.up,e.matrix),this._constraintOptions.interactionType=_i.LOOK_AROUND,this._constraintOptions.selection=cs.ALL_EXCEPT_COLLISION,fn(this.view,i,this._constraintOptions)}_applyPan(e,i=this.currentCamera){e.enabled&&(i.eye=nt(pc,i.eye,e.matrix),i.center=nt(pc,i.center,e.matrix),this.view.state.isGlobal&&(i.up=nt(pc,i.up,e.matrix)),this._constraintOptions.interactionType=_i.PAN,this._constraintOptions.selection=cs.ALL,fn(this.view,i,this._constraintOptions))}_applyZoom(e){if(!e)return;const i=this.currentCamera.viewForward;this.currentCamera.eye=Ee(pc,this.currentCamera.eye,de(rt.get(),i,e)),ve(A$,i),da(A$,A$),this._constraintOptions.interactionDirection=A$,this._constraintOptions.interactionType=_i.ZOOM,this._constraintOptions.selection=cs.ALL_EXCEPT_COLLISION,fn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const i=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,rt.get());if(this._constraintOptions.interactionDirection=ve(A$,i),this.view.state.isGlobal){const r=Ve(this.currentCamera.eye),s=(r+e)/r;this.currentCamera.eye=de(pc,this.currentCamera.eye,s),this.currentCamera.center=de(pc,this.currentCamera.center,s)}else{const r=de(rt.get(),i,e);this.currentCamera.eye=Ee(pc,this.currentCamera.eye,r),this.currentCamera.center=Ee(pc,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=_i.ASCEND,this._constraintOptions.selection=cs.COLLISION,fn(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=cs.ALL_EXCEPT_COLLISION,fn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,i,r){fyt(r);const s=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(s,i,r):this._calculateControlTransformationGlobal(s,i,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,i=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=i.intersectManifoldClosestSilhouette(r,e,pc)}_calculateControlTransformationLocal(e,i,r){const{viewRight:s,viewForward:n}=i,o=this._transformation,a=this.view.navigation.gamepad,l=pe(rt.get(),n[0],n[1],0);Ce(l,l);const c=o.translation[0]*e.pan;if(c!==0){const y=de(rt.get(),s,c);wl(r.pan.matrix,r.pan.matrix,y),r.pan.enabled=!0}switch(a.mode){case"pan":{const y=-o.translation[1]*e.pan;if(y!==0){const v=de(rt.get(),l,y);wl(r.pan.matrix,r.pan.matrix,v),r.pan.enabled=!0}r.zoom=o.zoom*e.zoom;break}case"zoom":r.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const u=o.translation[2]*e.ascend;r.ascend=u;const d=-o.heading*e.rotate;d!==0&&(Uu(r.rotate.matrix,r.rotate.matrix,d,this.view.renderCoordsHelper.worldUpAtPosition(i.eye,rt.get())),r.rotate.enabled=!0);const f=o.tilt*e.rotate,m=iw(this.view.renderCoordsHelper,i.center,i.eye),g=Ne(m+f,Ia.min,Ia.max)-m;g&&(Uu(r.rotate.matrix,r.rotate.matrix,g,s),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,i,r){const{eye:s,viewRight:n}=i,o=this._transformation,a=this.view.navigation.gamepad,l=mt(rt.get(),n,s);Ce(l,l),da(l,l),bgt(this.startCamera,i,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(ex.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,u=o.translation[2]*e.ascend;r.ascend=u;const d=-o.heading*e.rotate;d!==0&&(Uu(r.rotate.matrix,r.rotate.matrix,d,this._tmpCamera.eye),r.rotate.enabled=!0);const f=o.tilt*e.rotate,m=this._clampTiltDeltaGlobalToValidRange(f,i.ray,c);m!==0&&(Uu(r.rotate.matrix,r.rotate.matrix,m,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,i,r){const s=br(this.view.spatialReference),n=qU(Ia.min,i.origin,r,s);let o=0,a=0;const l=rt.get();if(this.view.renderCoordsHelper.intersectManifold(i,r,l)){const c=iw(this.view.renderCoordsHelper,l,i.origin);o=qU(c,i.origin,r,s),a=qU(Ia.max,i.origin,r,s)}else{CO(t6(i6,r+s.radius),i,l);const c=Math.PI+kse(i.direction,l);o=Lme(c,i.origin,r,s),a=Lme(Ia.max,i.origin,r,s)}return Ne(o+e,n,a)-o}_getPointAbsoluteSurfaceElevation(e,i,r){const{renderCoordsHelper:s}=this.view,n=s.getAltitude(e),o=i+Math.abs(n-i);return s.setAltitude(r,o,e),o}_clampedDistanceToSurface(e,i){const{renderCoordsHelper:r}=this.view,{camera:s}=this.view.state,{direction:n}=uot(this.view,i,0,SLe,pyt),o=r.intersectManifoldClosestSilhouette(td(i,n),e,rt.get()),a=Ar(i,o),l=r.intersectManifoldClosestSilhouette(td(i,U_(rt.get(),i,s.center)),e,rt.get()),c=Ar(i,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:i,state:r}=this.view,{camera:s,isGlobal:n}=r,o=i.intersectManifoldClosestSilhouette(s.ray,this._filteredSurfaceElevation,rt.get());if(n){const a=$e(rt.get(),e,o),l=Ve(a);de(a,a,1/l);const c=Ce(rt.get(),e),u=vo(Te(c,a));return l*Math.sin(Math.min(cyt,u))}{const a=ve(rt.get(),e);return i.setAltitude(a,this._filteredSurfaceElevation),Ar(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:uyt}_computeVelocities(e){const i=this._filteredSurfaceElevation,r=i+br(this.view.spatialReference).radius,{camera:s,isGlobal:n}=this.view.state,o=rt.get(),a=this._getPointAbsoluteSurfaceElevation(s.eye,i,o),l=this._clampedDistanceToSurface(i,o),c=s.width/2,u=ege*s.width,d=ege*s.width,f=l*Math.tan(.5*s.fovX)/c,m=f/r,g=f/this._computeHeadingRotateRadius(o),y=a-i;return{pan:(n?m:f)*u*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(u*e/c)*y-y),zoom:2**(u*e/c)*l-l,rotate:Ne(g*d,hyt,dyt)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&mp(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&mp(e.rotate.matrix))}static activatesFor(e,i){const r=Qme(i,e.navigation.gamepad,lyt);return!(i.action==="end"||e9(r))}};h([p({constructOnly:!0})],uS.prototype,"gamepadDevice",void 0),h([p({constructOnly:!0})],uS.prototype,"disableMovements",void 0),uS=h([I("esri.views.3d.state.controllers.GamepadKeyboardController")],uS);const lyt={translation:[0,0,0],heading:0,tilt:0,zoom:0},SLe=80,cyt=kt(SLe),ege=.75,uyt=5,hyt=kt(30),dyt=kt(80),ex={zoom:0,ascend:0,pan:{enabled:!1,matrix:ke()},rotate:{enabled:!1,matrix:ke()}},pc=C(),A$=C(),pyt=sne();function fyt(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,mp(t.pan.matrix),t.rotate.enabled=!1,mp(t.rotate.matrix)}let myt=class extends ba{constructor(e){super(!0),this._view=e,this._watchHandles=new Ey,this._handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([te(()=>this._view.navigation.gamepad.enabled,i=>{i?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},pt),te(()=>this._view.navigation.gamepad.device,i=>{this._cameraControllerGamepad&&i&&this._cameraControllerGamepad.gamepadDevice!==i&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){var s;const i=this._view.navigation.gamepad.device;if(i&&e.data.device!==i)return;const r=(s=this._cameraControllerGamepad)==null?void 0:s.active;if(r||uS.activatesFor(this._view,e.data)){if(!r){const n=new uS({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(n)&&(this._cameraControllerGamepad=n)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};function gyt(t){const e=()=>t(document.visibilityState==="visible");return document.addEventListener("visibilitychange",e),Gi(()=>document.removeEventListener("visibilitychange",e))}var yu;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(yu||(yu={}));let yyt=class extends ba{constructor(e,i){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Je.Local},this._keyToNumber={[i.left]:yu.LEFT,[i.right]:yu.RIGHT,[i.forward]:yu.FORWARD,[i.backward]:yu.BACKWARD,[i.up]:yu.UP,[i.down]:yu.DOWN,[i.headingLeft]:yu.HEADINGLEFT,[i.headingRight]:yu.HEADINGRIGHT,[i.tiltUp]:yu.TILTUP,[i.tiltDown]:yu.TILTDOWN,[i.zoomIn]:yu.ZOOMIN,[i.zoomOut]:yu.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleStop()),this._visibilityHandle=gyt(r=>r?null:this._handleStop())}onUninstall(){var e;(e=this._visibilityHandle)==null||e.remove(),this._handleStop()}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new uS({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(i),e.stopPropagation()))}_handleStop(){var e;(e=this._cameraControllerKeyboard)!=null&&e.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){var r;if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&((r=this._cameraControllerKeyboard)!=null&&r.active)&&(this._cameraControllerKeyboard.deactivateDirection(i),e.stopPropagation())}},_yt=class extends ba{constructor(e,i){super(!0),this._view=e,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const i=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new zB({view:this._view,mode:"interaction"}):new BB({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*i.deltaY,Os(i.x,i.y)),e.preventDefault(),e.stopPropagation()}},HB=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},S2=class extends iD{constructor(){super(...arguments),this._beginCamera=new Fr,this._elapsedTimeSec=0,this.constraintOptions=new Tp(cs.ALL,_i.PAN,0,this._beginCamera)}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new FP}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),super.onControllerStart(e)}stepController(e,i){i.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,i),fn(this.view,i,this.constraintOptions)}};S2=h([I("esri.views.3d.state.controllers.momentum.MomentumController")],S2);let z3=class extends S2{constructor(e){super(e),this.interactionType=_i.PAN,this._tmpPan=C()}momentumStep(e,i){const r=this.momentum.value(e);de(this._tmpPan,this.momentum.direction,r),i.eye=$e(tge,i.eye,this._tmpPan),i.center=$e(tge,i.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};h([p({constructOnly:!0})],z3.prototype,"momentum",void 0),z3=h([I("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],z3);const tge=C(),vyt=C(),R4=C();let XU=class extends S2{constructor(e){super(e),this.interactionType=_i.PAN}momentumStep(e,i){const r=this.momentum.value1(e),s=this.momentum.value2(e);ve(R4,i.eye),Ce(R4,R4),mt(this.momentum.axis2,R4,this.momentum.axis1),hLe(i,vyt,this.momentum.axis1,r,this.momentum.axis2,s)}};h([p({constructOnly:!0})],XU.prototype,"momentum",void 0),XU=h([I("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],XU);let HT=class extends S2{set center(e){this._set("center",yn(e))}set axis(e){this._set("axis",yn(e))}constructor(e){super(e),this.interactionType=_i.TUMBLE}momentumStep(e,i){const r=this.momentum.value(e);rw(i,this.center,rD(this.axis,r))}};h([p({constructOnly:!0})],HT.prototype,"momentum",void 0),h([p({constructOnly:!0})],HT.prototype,"center",null),h([p({constructOnly:!0})],HT.prototype,"axis",null),HT=h([I("esri.views.3d.state.controllers.momentum.RotationMomentumController")],HT);let GM=class extends S2{set zoomCenter(e){this._set("zoomCenter",yn(e))}constructor(e){super(e),this.interactionType=_i.ZOOM,this.constraintOptions.interactionDirection=C()}momentumStep(e,i){const{interactionDirection:r}=this.constraintOptions;if(!r)return;ve(r,i.eye);const s=this.momentum.valueDelta(0,e);Poe(i,this.zoomCenter,s,this.view.state.constraints.minimumPoiDistance),U_(r,i.eye,r)}};h([p({constructOnly:!0})],GM.prototype,"momentum",void 0),h([p({constructOnly:!0})],GM.prototype,"zoomCenter",null),GM=h([I("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],GM);let lT=class extends S2{set screenCenter(e){this._set("screenCenter",Os(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",yn(e))}constructor(e){super(e),this.interactionType=_i.ZOOM,this.radius=0,this._tmpSceneCenter=C(),this._tmpZoomAxisAngle=H6(),this._sphere=_n()}initialize(){this._sphere[3]=this.radius}momentumStep(e,i){const r=this.momentum.valueDelta(0,e);nLe(this._sphere,i,r),this.constraintOptions.interactionType=_i.ZOOM,fn(this.view,i,this.constraintOptions),sD(this._sphere,i,this.screenCenter,this._tmpSceneCenter),Eoe(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),rw(i,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=_i.PAN}};h([p({constructOnly:!0})],lT.prototype,"momentum",void 0),h([p({constructOnly:!0})],lT.prototype,"screenCenter",null),h([p({constructOnly:!0})],lT.prototype,"sceneCenter",null),h([p({constructOnly:!0})],lT.prototype,"radius",void 0),lT=h([I("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],lT);let Rf=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const i=this.computeDelta(e);this._updateDelta(i)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},Y6=class{constructor(e,i,r){this._initialVelocity=e,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,i){const r=this.value(e);return this.value(e+i)-r}valueFromInitialVelocity(e,i){i=Math.min(i,this.duration);const r=1-this.friction;return e*(r**i-1)/Math.log(r)}},byt=class extends Y6{constructor(e,i,r,s,n){super(e,i,r),this._sceneVelocity=s,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},ELe=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._time=new Rf(.6),this._screen=[new Rf(.4),new Rf(.4)],this._scene=[new Rf(.6),new Rf(.6),new Rf(.6)],this._tmpDirection=C()}add(e,i,r){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(r)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(i[0]),this._scene[1].update(i[1]),this._scene[2].update(i[2]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?0:Math.sqrt(e*e+i*i),s=this._time.filteredDelta,n=s==null||r==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){pe(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const s=Ve(this._tmpDirection);s>0&&de(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new byt(e,i,r,n==null?0:s/n,this._tmpDirection)}},ige=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const rge=1e-5;let wyt=class extends Y6{constructor(e,i,r,s,n,o=0,a){super(e,i,r),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},xyt=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._tmpAxis1=C(),this._tmpAxis2=C(),this._tmpAngles=gt(),this._time=new Rf(.3),this._screen=[new Rf(.4),new Rf(.4)],this._angle1=new ige(.6),this._angle2=new ige(.6),this._axis1=C(),this._axis2=C(),this._lastScene=C()}addMomentumDirectRotation(e,i,r,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let a=cLe(this._lastScene,i,this._tmpAxis2,s,n,o);this._angle2.update(0),pl(this._tmpAxis2)<rge?a=0:Ce(this._axis1,this._tmpAxis2),this._angle1.update(a),ve(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}addMomentumPreserveHeading(e,i,r,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;uLe(this._lastScene,i,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),pl(this._tmpAxis2)<rge?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),Ce(this._axis1,this._tmpAxis1),Ce(this._axis2,this._tmpAxis2)),ve(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?null:Math.sqrt(e*e+i*i),s=this._time.filteredDelta,n=r==null||s==null?0:r/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){const s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new wyt(e,i,r,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}},CLe=class{constructor(e=2.5,i=.01,r=.95,s=12){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this._maxVelocity=s,this.enabled=!0,this.value=new Rf(.8),this.time=new Rf(.3)}add(e,i){if(this.enabled&&i!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta()){const r=this.value.computeDelta(e);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=Ne(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,i,r){return new Y6(e,i,r)}},MLe=class extends CLe{constructor(e=3,i=.01,r=.95,s=12){super(e,i,r,s)}add(e,i){const r=this.value.lastValue;if(r!=null){let s=e-r;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;e=r+s}super.add(e,i)}},Tyt=class extends Y6{constructor(e,i,r){super(e,i,r)}value(e){const i=super.value(e);return Math.exp(i)}valueDelta(e,i){const r=super.value(e),s=super.value(e+i)-r;return Math.exp(s)}},ALe=class extends CLe{constructor(e=2.5,i=.01,r=.95,s=12){super(e,i,r,s)}add(e,i){super.add(Math.log(e),i)}createMomentum(e,i,r){return new Tyt(e,i,r)}},TK=class extends Wg{constructor(){super(...arguments),this._smoothRotation=new HB(.05),this._rotationAxis=C(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=rr(),this._beginRadius=0,this._smoothScaling=new HB(.05),this._zoomCenterScreen=Os(),this._zoomMomentumEstimator=new ALe,this._rotationMomentumEstimator=new MLe,this._panSphericalMomentumEstimator=new xyt,this._panPlanarMomentumEstimator=new ELe,this._adjustedSphere=_n(),this._tmp3d=C(),this._tmpScreenPointArray=Os(),this._beginScreenPoint=Os(),this._beginScenePoint=C(),this._screenPickPoint=Os(),this._scenePickPoint=C(),this._navMode=Na.Horizontal,this._sphere=_n(),this._pointerCount=0,this._tmpInteractionDirection=C(),this._beginCamera=new Fr,this._constraintOptions=new Tp(cs.ALL,_i.NONE,0,this._beginCamera)}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;this._zoomMomentumEstimator.enabled=this._rotationMomentumEstimator.enabled=this._panPlanarMomentumEstimator.enabled=this._panSphericalMomentumEstimator.enabled=this.view.navigation.momentumEnabled,this._beginHeading=-Bb.normalize(kt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),Lf(e.center,this._screenPickPoint),Ga(this._beginScreenPoint,this._screenPickPoint);const i=br(this.view.spatialReference),r=aLe(this._intersectionHelper,this.startCamera,this._screenPickPoint,i,BP.Silhouette,this.view.map.ground.opacity===0?oE:{});r.scenePickPoint!=null&&(this._scenePickPoint=r.scenePickPoint,this._sphere=r.sphere,ve(this._beginScenePoint,this._scenePickPoint),this._navMode=_N(this.startCamera,this._screenPickPoint,this.view.renderCoordsHelper,this.view.viewingMode),this._navMode===Na.Vertical&&this._preparePlanarPanMode(e,r.hasGeometryIntersection),this._beginCamera.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1;this._navMode===Na.Horizontal?(i&&this._zoomSpherical(e),this._panningSpherical(e),i&&this._rotateSpherical(e)):(i&&this._zoomPlanar(e),this._panningPlanar(e),i&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return this._navMode===Na.Horizontal?new lT({view:this.view,momentum:i,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new GM({view:this.view,momentum:i,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new HT({view:this.view,momentum:r,center:this._sphere,axis:this._rotationAxis});if(this._navMode===Na.Horizontal){const s=this._panSphericalMomentumEstimator.evaluateMomentum();if(s)return new XU({view:this.view,momentum:s})}else{const s=this._panPlanarMomentumEstimator.evaluateMomentum();if(s)return new z3({view:this.view,momentum:s})}return null}_preparePlanarPanMode(e,i){const r=da(this._tmp3d,this.startCamera.viewForward);KD(this._scenePickPoint,r,this._panningPlane);const s=Os(this._screenPickPoint[0],0),n=C(),o=Ve(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],sD(this._adjustedSphere,this.startCamera,s,n);const a=ka();this.startCamera.projectToRenderScreen(n,a);const l=C(),c=C(),u=C();$e(l,this._scenePickPoint,this.currentCamera.eye);const d=Ve(l);Ce(l,l);const f=rLe*Math.max(Math.abs(this.view.camera.position.z),sLe),m=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,q6);let g=m??f;g=i?Math.min(g,d):g,ve(u,Ee(c,this.currentCamera.eye,de(c,l,g))),this._panningPlane[3]=-Te(this._panningPlane,u),this.startCamera.center=Ee(c,this.startCamera.eye,de(c,this.startCamera.viewForward,g));const y=Lf(e.center,this._tmpScreenPointArray);vK(this._panningPlane,this.startCamera,y,this._beginScenePoint)}_zoomSpherical(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),nLe(this._sphere,this.currentCamera,this._smoothScaling.value),Lf(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=_i.ZOOM,this._constraintOptions.interactionFactor=$f(e.radius-this._beginRadius),fn(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const i=Lf(e.center,this._tmpScreenPointArray);sD(this._sphere,this.currentCamera,i,this._tmp3d),Ooe(this._beginScenePoint,Te(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(pLe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(dLe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=_i.PAN,this._constraintOptions.interactionFactor=$f(Kb(this._screenPickPoint,i)),fn(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){Ce(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||da(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value,r=i+_K(e.angle-i),s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(r);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),rw(this.currentCamera,this._sphere,rD(this._rotationAxis,n)),this._constraintOptions.interactionType=_i.TUMBLE,this._constraintOptions.interactionFactor=$f(e.radius*r),fn(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const i=Lf(e.center,this._tmpScreenPointArray);vK(this._panningPlane,this.currentCamera,i,this._tmp3d)&&(lLe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(i,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=_i.PAN,this._constraintOptions.interactionFactor=$f(Kb(this._beginScreenPoint,i)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),fn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),Poe(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=_i.ZOOM,this._constraintOptions.interactionFactor=$f(e.radius-this._beginRadius),fn(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){ve(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||da(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value;let r=e.angle-i;r=_K(r);const s=i+r,n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(s);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),rw(this.currentCamera,this._sphere,rD(this._rotationAxis,o)),this._constraintOptions.interactionType=_i.TUMBLE,this._constraintOptions.interactionFactor=$f(e.radius*o),fn(this.view,this.currentCamera,this._constraintOptions)}};TK=h([I("esri.views.3d.state.controllers.PinchAndPanControllerGlobal")],TK);const sge=qe(0,0,1);let SK=class extends Wg{constructor(){super(...arguments),this._rotationValueSmooth=new HB(.05),this._scalingValueSmooth=new HB(.05),this._planeHorizontal=rr(),this._planeVertical=rr(),this._rotationMomentumEstimator=new MLe,this._panMomentumEstimator=new ELe(300,12,.9),this._zoomMomentumEstimator=new ALe,this._beginRadius=0,this._beginCenter=C(),this._beginAngle=0,this._tmpPoints=[],this._navMode=Na.Horizontal,this._beginCenterScreen=Os(),this._tmpCentroid3d=C(),this._tmpCentroid2d=Os(),this._tmp2d=Os(),this._pointerCount=0,this._beginCamera=new Fr,this._constraintOptions=new Tp(cs.ALL,_i.NONE,0,this._beginCamera)}begin(e){if(!this.active)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panMomentumEstimator.enabled=i,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),Lf(e.center,this._beginCenterScreen),dPe(sge,0,this._planeHorizontal);const r=C(),s=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r,this.view.map.ground.opacity===0?oE:{}),n=C();da(n,this.startCamera.viewForward);const o=C();ve(o,sge);const a=Te(n,o);this._navMode=_N(this.startCamera,this._beginCenterScreen,this.view.renderCoordsHelper,this.view.viewingMode);const l=Math.min(rLe,1/Math.abs(Te(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),sLe);hX(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||dX(this._planeHorizontal,this._planeHorizontal);const c=C(),u=C(),d=C();$e(c,r,this.currentCamera.eye);const f=Ve(c);if(Ce(c,c),this._navMode===Na.Vertical){de(o,o,a),$e(this._planeVertical,n,o),Ce(this._planeVertical,this._planeVertical),hX(this._planeVertical,this._planeVertical,r);const m=this.view._stage.renderView.getMinimalDepthForArea(nD(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,q6);let g=m??l;g=s?Math.min(g,f):g,ve(d,Ee(u,this.currentCamera.eye,de(u,c,g))),this._planeVertical[3]=-Te(this._planeVertical,d),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),jq(this._tmpPoints,this._beginCenter)}else{const m=s?f:l;ve(d,Ee(u,this.currentCamera.eye,de(u,c,m))),this._planeHorizontal[3]=-Te(this._planeHorizontal,d),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),jq(this._tmpPoints,this._beginCenter)}this._beginCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1,r=this._navMode===Na.Horizontal?this._planeHorizontal:this._planeVertical,s=this._beginCenter;if(i){const n=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(n),Poe(this.currentCamera,s,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=_i.ZOOM,this._constraintOptions.interactionFactor=$f(Math.abs(e.radius-this._beginRadius)),fn(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),jq(this._tmpPoints,this._tmpCentroid3d),Lf(e.center,this._tmpCentroid2d),lLe(this.currentCamera,s,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=_i.PAN,this._constraintOptions.interactionFactor=$f(Kb(this._beginCenterScreen,this._tmpCentroid2d)),fn(this.view,this.currentCamera,this._constraintOptions),i){const n=s,o=this._rotationValueSmooth.value,a=o+_K(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=l,this._rotationValueSmooth.update(a);const c=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(c,.001*e.timestamp);const u=this._planeHorizontal;rw(this.currentCamera,n,rD(u,c)),this._constraintOptions.interactionType=_i.TUMBLE,this._constraintOptions.interactionFactor=$f(Math.abs(e.radius*c)),fn(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return new GM({view:this.view,momentum:i,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new HT({view:this.view,momentum:r,center:this._beginCenter,axis:this._planeHorizontal});const s=this._panMomentumEstimator.evaluateMomentum();return s?new z3({view:this.view,momentum:s}):null}_computePlanePoints(e,i,r,s){s.length=e.size;const n=this._tmp2d;let o=0;return e.forEach(a=>{n[0]=a.x,n[1]=a.y,s[o]===void 0&&(s[o]=C()),vK(i,r,n,s[o]),o+=1}),s}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};SK=h([I("esri.views.3d.state.controllers.PinchAndPanControllerLocal")],SK);let nge=class extends ba{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!Roe(e.data,this.pointerAction))return;const i=e.timestamp-this._lastEndTimestamp,r=40,s=this._momentum&&this._momentum.active&&i<r;switch(e.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,i){var r;if((r=this._controller)!=null&&r.active){this._lastEndTimestamp=e.timestamp;const s=this._controller.end(e.data);i&&s&&(this._momentum=s,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new TK({view:this._view}):new SK({view:this._view})}},Syt=class extends ba{constructor(e,i){super(!0),this.view=e,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}},PLe=class extends ba{constructor(e,i){super(!0),this.key=e,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},Eyt=class extends PLe{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},Cyt=class extends PLe{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},Myt=class extends ba{constructor(e,i=!1){super(!0),this._view=e,this._invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(e){var s,n,o;const i=this._invert?-1:1,r=Os(0,e.data.delta*i);switch(e.data.action){case"begin":(s=this._cameraController)==null||s.end(),this._cameraController=new V3({view:this._view,pivot:Su.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":(n=this._cameraController)==null||n.update(r);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}};function oge(t){const e=t.native;return e?{buttons:e.buttons.map(i=>i.pressed?i.value||1:0),axes:e.axes.map(i=>Oyt(i,t.axisThreshold))}:{buttons:[],axes:[]}}function Ayt(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let i=0;i<t.axes.length;i++)if(t.axes[i]!==e.axes[i])return!1;for(let i=0;i<t.buttons.length;i++)if(t.buttons[i]!==e.buttons[i])return!1;return!0}function Pyt(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function Oyt(t,e){const i=Math.abs(t);return i<e?0:Math.sign(t)*(i-e)/(1-e)}let $yt=class{constructor(e,i){this._element=e,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,oge(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&(age(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const i=new Ine(e);i.deviceType!=="unknown"&&(this._inputDevices[e.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=t2({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),i=this._element.contains(document.activeElement),r=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!i;age(s=>{const n=this._inputDevices[s.index];if(!n)return;const o=this._latestUpdate[s.index],a=oge(n),l=r||Pyt(a);o&&(o.timestamp===s.timestamp||!o.active&&l||Ayt(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_emitGamepadEvent(e,i,r){const s=this._latestUpdate[e.index],n=s&&s.active;if(!n&&!r)return;const o=!n&&r?"start":n&&r?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:i,active:r},this._callback&&this._callback({device:this._inputDevices[e.index],state:i,action:o})}};function Ryt(t){if(!t||!t.connected)return!1;for(let e=0;e<t.axes.length;e++)if(isNaN(t.axes[e]))return!1;return!0}function age(t){const e=window.navigator.getGamepads();for(let i=0;i<e.length;i++){const r=e[i];Ryt(r)&&t(r)}}const lge=ue("edge"),Iyt=ue("chrome"),Lyt=ue("ff"),Dyt=ue("safari"),cge="esri-view-surface",LE={touchNone:`${cge}--touch-none`,touchPan:`${cge}--touch-pan`};let OLe=class $Le{constructor(e,i){this._input=i,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new $yt(e,this._input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=He(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const i in this._active)if(!e||!e.has(i)){const r=this._active[i];this._element.removeEventListener(t9[i],r),delete this._active[i]}e&&e.forEach(i=>{if(!this._active[i]&&t9[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(t9[i],r),this._active[i]=r}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,i){i?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?LE.touchNone:LE.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?LE.touchPan:LE.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(LE.touchNone),this._element.classList.remove(LE.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,i){const r=CRe(this._element,e);return $Le.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(e,i){const{key:r}=i;r&&e==="key-up"&&this._keyDownState.delete(r);const s={native:i,key:r,repeat:!!r&&this._keyDownState.has(r)};r&&e==="key-down"&&this._keyDownState.add(s.key),this._callback(e,s)}_handlePointer(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(e,r)}_handlePointerPreventDefault(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(e,r)}_handleMouseWheel(e,i){let r=i.deltaY;switch(i.deltaMode){case 0:lge&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}lge?r*=.7:Iyt||Dyt?r*=.6:Lyt&&(r*=1.375);const s=100,n=Math.abs(r);n>s&&(r=r/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(e,o)}_handlePointerCaptureLost(e,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(e,i)}_handleDefault(e,i){const r={native:i};i.preventDefault(),this._callback(e,r)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};OLe.test={disableSubpixelCoordinates:!1};const t9={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let Nyt=class extends ba{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};const Lh={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function EK(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function Fyt(t,e){const i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}function kyt(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:fp()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[x,T]=t,[E,M]=[T.x-x.x,T.y-x.y];return e.radius=Math.sqrt(E*E+M*M)/2,e.center.x=(x.x+T.x)/2,e.center.y=(x.y+T.y)/2,e}let i=0,r=0;for(let x=0;x<t.length;x++)i+=t[x].x,r+=t[x].y;i/=t.length,r/=t.length;const s=t.map(x=>x.x-i),n=t.map(x=>x.y-r);let o=0,a=0,l=0,c=0,u=0,d=0,f=0;for(let x=0;x<s.length;x++){const T=s[x],E=n[x],M=T*T,O=E*E;o+=M,a+=O,l+=T*E,c+=M*T,u+=O*E,d+=T*O,f+=E*M}const m=.5*(c+d),g=.5*(u+f),y=o*a-l*l,v=(m*a-g*l)/y,b=(o*g-l*m)/y,w=fp(v+i,b+r);return{radius:Math.sqrt(v*v+b*b+(o+a)/t.length),center:w}}function B3(t){const{native:e}=t,{pointerId:i,button:r,pointerType:s}=e;return s==="mouse"?`${i}:${r}`:`${s}`}let Uyt=class extends ba{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,i,r,s){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:s,pointers:Vyt(this._activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(e){const i=e.native.pointerId,r=I4(this._activePointerMap).angle,s={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,s);const n=JU(s,RLe(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const i=e.native.pointerId,r=this._activePointerMap.get(i);r?r.event=e:this._addPointer(e)}_removePointer(e){const i=I4(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(i)}_updatePointerAngles(e){const i=I4(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=JU(r,i)-e,r.lastAngle=JU(r,i)-e})}_emitEvent(e,i,r){const s=I4(this._activePointerMap);this._drag.emit(this._createPayload(e,i,s,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const i=e.data.native.pointerId,r=e.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const i=e.data,r=i.currentEvent,s=e.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function RLe(t){const e=[];return t.forEach(i=>{e.push(fp(i.event.x,i.event.y))}),kyt(e)}function I4(t){const e=RLe(t);let i=0;return t.forEach(r=>{let s=JU(r,e),n=s-r.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=r.lastAngle+n,r.lastAngle=s;const o=s-r.initialAngle;i+=o}),i/=t.size||1,{angle:i,radius:e.radius,center:e.center}}function Vyt(t){const e=new Map;return t.forEach((i,r)=>e.set(r,i.event)),e}function JU(t,e){const i=t.event,r=i.x-e.center.x,s=i.y-e.center.y;return Math.atan2(s,r)}var uge;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(uge||(uge={}));let zyt=class extends ba{constructor(e=Lh.maximumDoubleClickDelay,i=Lh.maximumDoubleClickDistance,r=Lh.maximumDoubleTouchDelay,s=Lh.maximumDoubleTouchDistance,n=ND){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=B3(i);if(!this._pointerState.has(r)){const s={downButton:i.native.button,x:i.x,y:i.y,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(i.native)}}_handlePointerUp(e){const i=e.data,r=B3(i),s=this._pointerState.get(r);if(s&&s.downButton===i.native.button){const n=s.immediateDoubleClick,o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;n?(n.timeoutHandle.remove(),EK(n,e.data)>o?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,n.modifiers),this._removeState(i))):EK(s,e.data)>o?this._removeState(i):this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,i){const r=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),r)}}_removeState(e){const i=B3(e);this._pointerState.delete(i),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},Byt=class extends ba{constructor(e=Lh.maximumClickDelay,i=Lh.movementUntilMouseDrag,r=Lh.movementUntilPenDrag,s=Lh.movementUntilTouchDrag,n=Lh.holdDelay,o=ND){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=r,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=Lr(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=i.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(r);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const n={startEvent:i,previousEvent:i,startTimestamp:e.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_handlePointerMove(e){const i=e.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit(L4("update",s,i),void 0,s.modifiers):Fyt(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(e),s.previousEvent=i)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const i=e.data,r=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=e.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit(L4("start",s,i)):this._pointerDrag.emit(L4("start",s,s.previousEvent),e.timestamp))})}_handlePointerLoss(e,i){const r=e.data,s=r.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(L4("end",n,i==="pointer-up"?r:n.previousEvent),void 0,n.modifiers):i==="pointer-up"&&n.downButton===r.native.button&&e.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}};function L4(t,e,i){return{action:t,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:i}}let jyt=class extends ba{constructor(e=Lh.maximumDoubleClickDelay,i=Lh.maximumDoubleClickDistance,r=Lh.maximumDoubleTouchDelay,s=Lh.maximumDoubleTouchDistance,n=ND){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=Lr(e.doubleClickTimer))}get hasPendingInputs(){return Fh(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,i){const r=this._pointerState.get(e);r&&(r.doubleClickTimer=Lr(r.doubleClickTimer),i&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const i=this._pointerState.get(e);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_handleImmediateClick(e){const i=e.data,{pointerType:r}=i.native,s=Gyt(i);if(!this._pointerState.has(s))return void this._startClick(e);const n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=r==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;EK(o,i)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(e)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const i=B3(e.data),r=this._pointerState.get(i);r&&(r.pointerDownCount+=1)}_startClick(e){const{data:i}=e,{native:{pointerType:r}}=i,s=B3(i),n=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n);this._pointerState.set(s,{event:e,doubleClickTimer:o,pointerDownCount:1}),this.refreshHasPendingInputs()}};function Gyt(t){const{pointerId:e,pointerType:i,button:r}=t.native;return i==="mouse"?`${e}:${r}`:`${i}`}let Hyt=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const i=e.data,r=i.pointers.size;switch(i.action){case"start":this._currentCount=r,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var i,r;this._startEvent=e,(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var i,r;(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var i,r;(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},qyt=class extends ba{constructor(e=20,i=40){super(!1),this._threshold=e,this._maxDelta=i,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new Hyt({start:(r,s)=>this._observeStart(r,s),update:(r,s,n)=>this._observeUpdate(r,s,n),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r))}get failed(){return this._state==="failed"}_observeStart(e,i){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,i,r){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,i){let r=-1/0,s=1/0,n=-1/0,o=1/0;for(const{x:y,y:v}of i.pointers.values())r=Math.max(r,y),s=Math.min(s,y),n=Math.max(n,v),o=Math.min(o,v);let a=-1/0,l=1/0,c=-1/0,u=1/0;for(const{x:y,y:v}of e.pointers.values())a=Math.max(a,y),l=Math.min(l,y),c=Math.max(c,v),u=Math.min(u,v);const d=r-s,f=n-o,m=a-l,g=c-u;return Math.abs(e.center.x-i.center.x)<this._threshold&&Math.abs(m-d)<=this._maxDelta&&Math.abs(g-f)<=this._maxDelta}_checkVerticalThresholdReached(e,i){let r=Math.abs(e.center.y-i.center.y);return e.pointers.forEach((s,n)=>{const o=i.pointers.get(n);r=Math.min(r,Math.abs(s.y-o.y))}),r>=this._threshold}},sf=class extends Ue{destroy(){this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){var e;return!!((e=this._inputManager)!=null&&e.updating)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=He(this._inputManager)}connect(){const e=this.view;this._source=new OLe(this.view.surface,e.input);const i=[new zyt,new Byt,new jyt,new Uyt(this.view.navigation),new qyt],r=new xd({eventSource:this._source,recognizers:i});this._inputManager=r,r.installHandlers("prevent-context-menu",[new Nyt],Tb.INTERNAL),this._modeDragPan=new nge(e,"primary"),this._modeDragRotate=new Kq(e,"secondary",Su.CENTER),this._modeDragZoom=new ayt(e,"tertiary");const s={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};r.installHandlers("navigation",[new Syt(e),new Mgt(e),new myt(e),new yyt(e,s.pan),new _yt(e),new Cyt(e,s.resetTilt),new Eyt(e,s.resetHeading),new Kq(e,"primary",Su.EYE,[s.lookAround]),new Kq(e,"secondary",Su.CENTER,[s.lookAround]),new nge(e,"tertiary",[s.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new Myt(e)],Tb.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),this.addHandles(te(()=>{var n;return(n=this.view.navigation)==null?void 0:n.browserTouchPanEnabled},n=>{this._source.browserTouchPanningEnabled=!n},pt))}isModifierKeyDown(e){var i;return((i=this._inputManager)==null?void 0:i.isModifierKeyDown(e))??!1}_updateMode(){var s;const e=this.mode,i=this.primaryDragAction,r=(s=CK.get(e))==null?void 0:s.get(i);r&&(this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom))}get test(){}};h([p()],sf.prototype,"view",void 0),h([p({value:"pan"})],sf.prototype,"primaryDragAction",null),h([p({value:"default"})],sf.prototype,"mode",null),h([p({readOnly:!0})],sf.prototype,"updating",null),h([p()],sf.prototype,"latestPointerType",null),h([p()],sf.prototype,"latestPointerLocation",null),h([p()],sf.prototype,"multiTouchActive",null),h([p()],sf.prototype,"_inputManager",void 0),sf=h([I("esri.views.3d.input.SceneInputManager")],sf);const CK=new Map,i9=new Map,r9=new Map;i9.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),i9.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),r9.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),r9.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),CK.set("default",i9),CK.set("pro",r9);const Wyt=sf;let un=class extends Ue{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};h([p()],un.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),h([p()],un.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),h([p()],un.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),h([p()],un.prototype,"DECONFLICTOR_SHOW_GRID",void 0),h([p()],un.prototype,"LABELS_SHOW_BORDER",void 0),h([p()],un.prototype,"TEXT_SHOW_BASELINE",void 0),h([p()],un.prototype,"TEXT_SHOW_BORDER",void 0),h([p()],un.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),h([p()],un.prototype,"OVERLAY_SHOW_CENTER",void 0),h([p()],un.prototype,"SHOW_POI",void 0),h([p()],un.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),h([p()],un.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),h([p()],un.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),h([p()],un.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),h([p()],un.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),h([p()],un.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),h([p()],un.prototype,"I3S_TREE_SHOW_TILES",void 0),h([p()],un.prototype,"I3S_SHOW_MODIFICATIONS",void 0),h([p()],un.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),h([p()],un.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),h([p()],un.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),h([p()],un.prototype,"LINE_WIREFRAMES",void 0),un=h([I("esri.views.3d.support.debugFlags")],un);const kr=new un;let Eh,VA,MK=!1,AK=!1,PK=!1,OK=!1,j3=null;function Zyt(t,e){if(!AK||!VA)return;ILe();const i=VA;let r=0;for(let s=0;s<t.accBinsNumX;s++)for(let n=0;n<t.accBinsNumY;n++){const o=t.accBins[s][t.accBinsNumY-1-n];r+=o.length;const a=s*t.accBinsSizeX,l=(s+1)*t.accBinsSizeX,c=n*t.accBinsSizeY,u=(n+1)*t.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),LLe(a,l,c,u,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+e.size,70,50),i.fillText("total numTests: "+t.accNumTests,70,30)}function Yyt(t){PK=kr.DECONFLICTOR_SHOW_VISIBLE,OK=kr.DECONFLICTOR_SHOW_INVISIBLE,MK=PK||OK,AK=kr.DECONFLICTOR_SHOW_GRID,j3=null,MK||AK?j3=()=>Xyt(t):Eh&&(Eh.parentElement.removeChild(Eh),Eh=null)}function ILe(){j3&&(j3(),j3=null)}function Xyt(t){Eh==null&&(Eh=document.createElement("canvas"),Eh.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(Eh));const{state:e}=t,{camera:i,pixelRatio:r}=e,{width:s,height:n}=i,o=s*r,a=n*r;Eh.setAttribute("width",`${o}px`),Eh.setAttribute("height",`${a}px`),Eh.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),VA=Eh.getContext("2d"),VA.clearRect(0,0,s,n),VA.font="12px Arial"}function LLe(t,e,i,r,s){ILe();const n=Eh.height,o=VA;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(t,n-i),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.closePath()}function Jyt(t,e){MK&&(e&&PK||!e&&OK)&&LLe(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var Fa,ko;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(Fa||(Fa={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(ko||(ko={}));function DLe(t,e){return new kLe(t,VLe,e)}function Qyt(t,e){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:s}=VLe;return new kLe(t,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:s9.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:s9.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:s,minPixelSize:s9.minPixelSize},e)}function Kyt(t){return Math.abs(t*t*t)}function NLe(t,e,i){const r=i.parameters;return n9.scale=Math.min(r.divisor/(e-r.offset),1),n9.factor=Kyt(t),n9}function Doe(t,e){return Bt(t*Math.max(e.scale,e.minScaleFactor),t,e.factor)}function e0t(t,e,i){const r=NLe(t,e,i);return r.minScaleFactor=0,Doe(1,r)}function hge(t,e,i,r){r.scale=e0t(t,e,i),r.factor=0,r.minScaleFactor=i.minScaleFactor}function FLe(t,e,i=[0,0]){const r=Math.min(Math.max(e.scale,e.minScaleFactor),1);return i[0]=t[0]*r,i[1]=t[1]*r,i}function t0t(t,e,i,r){return Doe(t,NLe(e,i,r))}let kLe=class ULe{get minScaleFactor(){return this._fontHeight!=null?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,i,r,s=i0t(),n){this._viewingMode=e,this._description=i,this._ellipsoidRadius=r,this.parameters=s,this._fontHeight=n,this._viewingMode===Je.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overrideFontHeight(e){return e!==this._fontHeight?new ULe(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,i,r){const{scaleStart:s,scaleFallOffRange:n}=this._description,{fovY:o,distance:a}=e,l=this._calculateCurvatureDependentParameters(e,i),c=this._coverageCompensation(e,i,l),{tiltAngle:u,scaleFallOffFactor:d}=l,f=Math.sin(u)*a,m=.5*Math.PI-u-o*(.5-s*c),g=f/Math.cos(m),y=m+o*n*c,v=(g-d*(f/Math.cos(y)))/(1-d);return r.camera.fovY=e.fovY,r.camera.distance=e.distance,r.offset=v,r.divisor=g-v,r}_calculateCurvatureDependentParametersLocal(e,i,r=dge){return r.tiltAngle=this._description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(e,i,r=dge){const s=this._description.curvatureDependent,n=1+e.distance/i,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=Ne((o-a)/(l-a),0,1),[u,d]=[s.min,s.max];return r.tiltAngle=Bt(u.tiltAngle,d.tiltAngle,c),r.scaleFallOffFactor=Bt(u.scaleFallOffFactor,d.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(e,i,r){return(e.fovY-r.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,i,r){const s=i*i,n=r.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+s-2*Math.cos(n)*a*i,c=Math.sqrt(l),u=Math.sqrt(l-s);return(Math.acos(u/c)-Math.asin(i/(c/Math.sin(n)))+.5*o)/o}};const VLe={curvatureDependent:{min:{curvature:kt(10),tiltAngle:kt(12),scaleFallOffFactor:.5},max:{curvature:kt(70),tiltAngle:kt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},s9={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function i0t(){return{camera:{distance:0,fovY:0},divisor:0,offset:0}}const n9={scale:0,factor:0,minScaleFactor:0},dge={tiltAngle:0,scaleFallOffFactor:0};function r0t(t){return t instanceof Float32Array&&t.length>=16}function s0t(t){return Array.isArray(t)&&t.length>=16}function n0t(t){return r0t(t)||s0t(t)}const jP={unknown:1,inches:Br(1,"meters","inches"),feet:Br(1,"meters","feet"),"us-feet":Br(1,"meters","us-feet"),yards:Br(1,"meters","yards"),miles:Br(1,"meters","miles"),"nautical-miles":Br(1,"meters","nautical-miles"),millimeters:Br(1,"meters","millimeters"),centimeters:Br(1,"meters","centimeters"),decimeters:Br(1,"meters","decimeters"),meters:Br(1,"meters","meters"),kilometers:Br(1,"meters","kilometers"),"decimal-degrees":1/wYe(1,"meters",ur.radius)};var dl,pge;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(dl||(dl={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(pge||(pge={}));let Noe=class{constructor(e){this.field=e}},o0t=class extends Noe{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[dl.Undefined,dl.Undefined,dl.Undefined]}},a0t=class extends Noe{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},l0t=class extends Noe{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},c0t=class{};function P$(t){return t!=null}function DE(t){return typeof t=="number"}function X6(t){return typeof t=="string"}function u0t(t){return t==null||X6(t)}function h0t(t,e,i,r=ke()){const s=t||0,n=e||0,o=i||0;return s!==0&&mP(r,r,-s/180*Math.PI),n!==0&&fP(r,r,n/180*Math.PI),o!==0&&RG(r,r,o/180*Math.PI),r}function Mv(t,e,i,r,s){var a;const n=t.minSize,o=t.maxSize;if(t.useSymbolValue){const l=r.symbolSize[i];return e.minSize[i]=l,e.maxSize[i]=l,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=dl.DefinedSize,!0}if(P$(t.field))return P$(t.stops)?t.stops.length===2&&DE(t.stops[0].size)&&DE(t.stops[1].size)?(fge(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,i),e.type[i]=dl.DefinedSize,!0):!1:DE(n)&&DE(o)&&P$(t.minDataValue)&&P$(t.maxDataValue)?(fge(n,o,t.minDataValue,t.maxDataValue,e,i),e.type[i]=dl.DefinedSize,!0):t.valueUnit==="unknown"?!1:jP[t.valueUnit]!=null?(e.minSize[i]=-1/0,e.maxSize[i]=1/0,e.offset[i]=0,e.factor[i]=1/jP[t.valueUnit],e.type[i]=dl.DefinedSize,!0):!1;if(!P$(t.field)){if((a=t.stops)!=null&&a[0]&&DE(t.stops[0].size))return e.minSize[i]=t.stops[0].size,e.maxSize[i]=t.stops[0].size,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=dl.DefinedSize,!0;if(DE(n))return e.minSize[i]=n,e.maxSize[i]=n,e.offset[i]=n,e.factor[i]=0,e.type[i]=dl.DefinedSize,!0}return!1}function fge(t,e,i,r,s,n){const o=Math.abs(r-i)>0?(e-t)/(r-i):0;s.minSize[n]=o>0?t:e,s.maxSize[n]=o>0?e:t,s.offset[n]=t-i*o,s.factor[n]=o}function d0t(t,e,i,r){if(t.normalizationField||t.valueRepresentation||!u0t(t.field))return null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return null}else e.size.field=t.field}else e.size=new o0t(t.field);let s;switch(t.axis){case"width":return s=Mv(t,e.size,0,i),s?e:null;case"height":return s=Mv(t,e.size,2,i),s?e:null;case"depth":return s=Mv(t,e.size,1,i),s?e:null;case"width-and-depth":return s=Mv(t,e.size,0,i),s&&Mv(t,e.size,1,i),s?e:null;case null:case void 0:case"all":return s=Mv(t,e.size,0,i),s=s&&Mv(t,e.size,1,i),s=s&&Mv(t,e.size,2,i),s?e:null;default:return`${t.axis}`,null}}function p0t(t,e,i){for(let s=0;s<3;++s){let n=e.unitInMeters;t.type[s]===dl.DefinedSize&&(n*=e.modelSize[s],t.type[s]=dl.DefinedScale),t.minSize[s]=t.minSize[s]/n,t.maxSize[s]=t.maxSize[s]/n,t.offset[s]=t.offset[s]/n,t.factor[s]=t.factor[s]/n}let r;if(t.type[0]!==dl.Undefined)r=0;else if(t.type[1]!==dl.Undefined)r=1;else{if(t.type[2]===dl.Undefined)return!1;r=2}for(let s=0;s<3;++s)t.type[s]===dl.Undefined&&(t.minSize[s]=t.minSize[r],t.maxSize[s]=t.maxSize[r],t.offset[s]=t.offset[r],t.factor[s]=t.factor[r],t.type[s]=t.type[r]);return!0}function mge(t,e,i){t[4*e]=i.r/255,t[4*e+1]=i.g/255,t[4*e+2]=i.b/255,t[4*e+3]=i.a}function f0t(t,e,i){if(t.normalizationField)return null;if(X6(t.field)){if(!t.stops)return null;{if(t.stops.length>8)return null;e.color=new a0t(t.field);const r=t.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];e.color.values[s]=n.value,mge(e.color.colors,s,n.color)}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const r=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.color.values[s]=1/0,mge(e.color.colors,s,r)}}return e}function m0t(t,e,i){if(t.normalizationField)return null;if(X6(t.field)){if(!t.stops)return null;{if(t.stops.length>8)return null;e.opacity=new l0t(t.field);const r=t.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];e.opacity.values[s]=n.value,e.opacity.opacityValues[s]=n.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const r=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)e.opacity.values[s]=1/0,e.opacity.opacityValues[s]=r}}return e}function o9(t,e,i){const r=i===2&&t.rotationType==="arithmetic";e.offset[i]=r?90:0,e.factor[i]=r?-1:1,e.type[i]=1}function g0t(t,e,i){if(!X6(t.field))return null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return o9(t,e.rotation,0),e;case"roll":return o9(t,e.rotation,1),e;case null:case void 0:case"heading":return o9(t,e.rotation,2),e;default:return`${t.axis}`,null}}let vN=class{constructor(e,i=[1,1,1],r=[1,1,1],s=1,n=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=i,this.symbolSize=r,this.unitInMeters=s,this.anchor=n,this.scale=o,this.rotation=a}};function zLe(t,e,i){if(!t)return null;const r=t.reduce((s,n)=>{if(!s)return s;if(n.valueExpression)return null;switch(n.type){case"size":return e.supports.size?d0t(n,s,e,i):s;case"color":return e.supports.color?f0t(n,s):s;case"opacity":return e.supports.opacity?m0t(n,s):null;case"rotation":return e.supports.rotation?g0t(n,s,i):s;default:return null}},new c0t);return!(t.length>0&&r)||r.size||r.color||r.opacity||r.rotation?r!=null&&r.size&&!p0t(r.size,e)?null:r:null}let y0t=class{constructor(e,i,r){this.visualVariables=e,this.materialParameters=i,this.requiresShaderTransformation=r}};function GP(t,e){if(!t||kr.TESTS_DISABLE_FAST_UPDATES)return null;const i=zLe(t.visualVariables,e);return i?new y0t(i,jLe(i,e),!!i.size):null}function HP(t,e,i){if(!e||!t)return!1;const r=t.visualVariables,s=zLe(e.visualVariables,i);return!!s&&!!(D4(r.size,s.size,"size")&&D4(r.color,s.color,"color")&&D4(r.rotation,s.rotation,"rotation")&&D4(r.opacity,s.opacity,"opacity"))&&(t.visualVariables=s,t.materialParameters=jLe(s,i),t.requiresShaderTransformation=!!s.size,!0)}function D4(t,e,i){if(!!t!=!!e||t&&t.field!==(e==null?void 0:e.field))return!1;if(t&&i==="rotation"){const r=t,s=e;for(let n=0;n<3;n++)if(r.type[n]!==s.type[n]||r.offset[n]!==s.offset[n]||r.factor[n]!==s.factor[n])return!1}return!0}let BLe=class extends Ur{constructor(e){super(),this.vvSize=(e==null?void 0:e.size)??null,this.vvColor=(e==null?void 0:e.color)??null,this.vvOpacity=(e==null?void 0:e.opacity)??null}};function jLe(t,e){const i=new BLe(t);return i.vvSize&&(i.vvSymbolAnchor=e.anchor,mp(G3),h0t(e.rotation[2],e.rotation[0],e.rotation[1],G3),i.vvSymbolRotationMatrix=i.vvSymbolRotationMatrix||Kr(),wp(i.vvSymbolRotationMatrix,G3)),i}function _0t(t,e,i){if(!t.vvSize)return i;An(Av,i);const r=t.vvSymbolRotationMatrix;Ay(G3,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),vr(Av,Av,G3);for(let s=0;s<3;++s){const n=t.vvSize.offset[s]+e[0]*t.vvSize.factor[s];gge[s]=Ne(n,t.vvSize.minSize[s],t.vvSize.maxSize[s])}return YD(Av,Av,gge),wl(Av,Av,t.vvSymbolAnchor),Av}function Foe(t,e,i){if(!e.vvSize)return pe(t,1,1,1),t;for(let r=0;r<3;++r){const s=e.vvSize.offset[r]+i[0]*e.vvSize.factor[r];t[r]=Ne(s,e.vvSize.minSize[r],e.vvSize.maxSize[r])}return t}function em(t,e){const i=t==null?0:e.attributes[t];return typeof i=="number"&&isFinite(i)?i:0}const Av=ke(),gge=C(),G3=ke();function koe(t){t.vertex.code.add(S`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(S`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),t.vertex.code.add(S`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(S`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(S`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(S`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function v0t(t){t.uniforms.add(new Wt("screenSizePerspective",e=>GLe(e.screenSizePerspective)))}function J6(t){t.uniforms.add(new Wt("screenSizePerspectiveAlignment",e=>GLe(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function GLe(t){return pe(b0t,t.parameters.divisor,t.parameters.offset,t.minScaleFactor)}const b0t=C();function HLe(t,e){const i=t.vertex;e.hasVerticalOffset?(qLe(i),e.hasScreenSizePerspective&&(t.include(koe),J6(i),fm(t.vertex,e)),i.code.add(S`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?S`vec3 worldNormal = normalize(worldPos + localOrigin);`:S`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?S`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:S`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(S`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const w0t=ci();function qLe(t){t.uniforms.add(new ji("verticalOffset",(e,i)=>{const{minWorldLength:r,maxWorldLength:s,screenLength:n}=e.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return Ss(w0t,n*a,o,r,s)}))}const WLe=.5;function ZLe(t,e){t.include(koe),t.attributes.add($.POSITION,"vec3"),t.attributes.add($.NORMAL,"vec3"),t.attributes.add($.CENTEROFFSETANDDISTANCE,"vec4");const i=t.vertex;Wc(i,e),fm(i,e),i.uniforms.add(new ji("viewport",(r,s)=>s.camera.fullViewport),new tt("polygonOffset",r=>r.shaderPolygonOffset),new tt("cameraGroundRelative",(r,s)=>s.camera.aboveGround?1:-1)),e.hasVerticalOffset&&qLe(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(S`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(S`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${e.multipassEnabled?S.float(0):S`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),e.draped&&!e.hasVerticalOffset||VP(i),e.draped||(i.uniforms.add(new tt("perDistancePixelRatio",(r,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),i.code.add(S`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${S.float(WLe)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),e.screenCenterOffsetUnitsEnabled&&IO(i),e.hasScreenSizePerspective&&J6(i),i.code.add(S`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?S`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled?"":S`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}function YLe(t,e,i,r,s){let n=(i.screenLength||0)*t.pixelRatio;s!=null&&(n=t0t(n,r,e,s));const o=n*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return Ne(o*e,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function XLe(t,e){const i=e?XLe(e):{};for(const r in t){let s=t[r];s!=null&&s.forEach&&(s=T0t(s)),s==null&&r in i||(i[r]=s)}return i}function x0t(t,e){let i=!1;for(const r in e){const s=e[r];s!==void 0&&(Array.isArray(s)?t[r]===null?(t[r]=s.slice(),i=!0):QTe(t[r],s)&&(i=!0):t[r]!==s&&(i=!0,t[r]=s))}return i}function T0t(t){const e=[];return t.forEach(i=>e.push(i)),e}const JLe={multiply:1,ignore:2,replace:3,tint:4};let Cw=class extends mN{constructor(e,i){super(),this.type=Gs.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._vertexAttributeLocations=Pi,this._pp0=qe(0,0,1),this._pp1=qe(0,0,0),this._parameters=XLe(e,i),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,i=!0){x0t(this._parameters,e)&&(this.validateParameters(this._parameters),i&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bindParameters.decorations===rc.ON)&&!!(this.parameters.renderOccluded&e.renderOccludedMask)}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){var e;(e=this.repository)==null||e.materialChanged(this)}queryRenderOccludedState(e){return this.isVisible()&&this.parameters.renderOccluded===e}intersectDraped(e,i,r,s,n,o){return this._pp0[0]=this._pp1[0]=s[0],this._pp0[1]=this._pp1[1]=s[1],this.intersect(e,i,r,this._pp0,this._pp1,n)}},QLe=class extends Gpt{constructor(e,i,r){super(i,r),this.camera=e}};var ir;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(ir||(ir={}));let Uoe=class extends Ur{constructor(){super(...arguments),this.renderOccluded=ir.Occlude,this.isDecoration=!1}},KLe=class{constructor(){this.factor=new yge,this.factorAlignment=new yge}},yge=class{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}};function Lti(t,e,i,r=1){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r===1)for(let c=0;c<l;++c)o[i]=s[n[c]],i+=a;else for(let c=0;c<l;++c){const u=s[n[c]];for(let d=0;d<r;d++)o[i]=u,i+=a}}function _ge(t,e,i){const{data:r,indices:s}=t,n=e.typedBuffer,o=e.typedBufferStride,a=s.length;i*=o;for(let l=0;l<a;++l){const c=2*s[l];n[i]=r[c],n[i+1]=r[c+1],i+=o}}function eDe(t,e,i,r){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r==null||r===1)for(let c=0;c<l;++c){const u=3*n[c];o[i]=s[u],o[i+1]=s[u+1],o[i+2]=s[u+2],i+=a}else for(let c=0;c<l;++c){const u=3*n[c];for(let d=0;d<r;++d)o[i]=s[u],o[i+1]=s[u+1],o[i+2]=s[u+2],i+=a}}function qP(t,e,i,r=1){const{data:s,indices:n}=t,o=e.typedBuffer,a=e.typedBufferStride,l=n.length;if(i*=a,r===1)for(let c=0;c<l;++c){const u=4*n[c];o[i]=s[u],o[i+1]=s[u+1],o[i+2]=s[u+2],o[i+3]=s[u+3],i+=a}else for(let c=0;c<l;++c){const u=4*n[c];for(let d=0;d<r;++d)o[i]=s[u],o[i+1]=s[u+1],o[i+2]=s[u+2],o[i+3]=s[u+3],i+=a}}function vge(t,e,i){const r=t.typedBuffer,s=t.typedBufferStride;e*=s;for(let n=0;n<i;++n)r[e]=0,r[e+1]=0,r[e+2]=0,r[e+3]=0,e+=s}function Voe(t,e,i,r,s=1){if(!e)return void eDe(t,i,r,s);const{data:n,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,c=o.length,u=e[0],d=e[1],f=e[2],m=e[4],g=e[5],y=e[6],v=e[8],b=e[9],w=e[10],x=e[12],T=e[13],E=e[14];r*=l;let M=0,O=0,D=0;const U=DG(e)?k=>{M=n[k]+x,O=n[k+1]+T,D=n[k+2]+E}:k=>{const H=n[k],V=n[k+1],X=n[k+2];M=u*H+m*V+v*X+x,O=d*H+g*V+b*X+T,D=f*H+y*V+w*X+E};if(s===1)for(let k=0;k<c;++k)U(3*o[k]),a[r]=M,a[r+1]=O,a[r+2]=D,r+=l;else for(let k=0;k<c;++k){U(3*o[k]);for(let H=0;H<s;++H)a[r]=M,a[r+1]=O,a[r+2]=D,r+=l}}function zoe(t,e,i,r,s=1){if(!e)return void eDe(t,i,r,s);const{data:n,indices:o}=t,a=e,l=i.typedBuffer,c=i.typedBufferStride,u=o.length,d=a[0],f=a[1],m=a[2],g=a[4],y=a[5],v=a[6],b=a[8],w=a[9],x=a[10],T=!use(a),E=1e-6,M=1-E;r*=c;let O=0,D=0,U=0;const k=DG(a)?H=>{O=n[H],D=n[H+1],U=n[H+2]}:H=>{const V=n[H],X=n[H+1],q=n[H+2];O=d*V+g*X+b*q,D=f*V+y*X+w*q,U=m*V+v*X+x*q};if(s===1)if(T)for(let H=0;H<u;++H){k(3*o[H]);const V=O*O+D*D+U*U;if(V<M&&V>E){const X=1/Math.sqrt(V);l[r]=O*X,l[r+1]=D*X,l[r+2]=U*X}else l[r]=O,l[r+1]=D,l[r+2]=U;r+=c}else for(let H=0;H<u;++H)k(3*o[H]),l[r]=O,l[r+1]=D,l[r+2]=U,r+=c;else for(let H=0;H<u;++H){if(k(3*o[H]),T){const V=O*O+D*D+U*U;if(V<M&&V>E){const X=1/Math.sqrt(V);O*=X,D*=X,U*=X}}for(let V=0;V<s;++V)l[r]=O,l[r+1]=D,l[r+2]=U,r+=c}}function S0t(t,e,i,r,s=1){if(!e)return void qP(t,i,r,s);const{data:n,indices:o}=t,a=e,l=i.typedBuffer,c=i.typedBufferStride,u=o.length,d=a[0],f=a[1],m=a[2],g=a[4],y=a[5],v=a[6],b=a[8],w=a[9],x=a[10],T=!use(a),E=1e-6,M=1-E;if(r*=c,s===1)for(let O=0;O<u;++O){const D=4*o[O],U=n[D],k=n[D+1],H=n[D+2],V=n[D+3];let X=d*U+g*k+b*H,q=f*U+y*k+w*H,Z=m*U+v*k+x*H;if(T){const ye=X*X+q*q+Z*Z;if(ye<M&&ye>E){const L=1/Math.sqrt(ye);X*=L,q*=L,Z*=L}}l[r]=X,l[r+1]=q,l[r+2]=Z,l[r+3]=V,r+=c}else for(let O=0;O<u;++O){const D=4*o[O],U=n[D],k=n[D+1],H=n[D+2],V=n[D+3];let X=d*U+g*k+b*H,q=f*U+y*k+w*H,Z=m*U+v*k+x*H;if(T){const ye=X*X+q*q+Z*Z;if(ye<M&&ye>E){const L=1/Math.sqrt(ye);X*=L,q*=L,Z*=L}}for(let ye=0;ye<s;++ye)l[r]=X,l[r+1]=q,l[r+2]=Z,l[r+3]=V,r+=c}}function tDe(t,e,i,r,s=1){const{data:n,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,c=o.length;if(r*=l,e!==n.length||e!==4)if(s!==1)if(e!==4)for(let u=0;u<c;++u){const d=3*o[u];for(let f=0;f<s;++f)a[r]=n[d],a[r+1]=n[d+1],a[r+2]=n[d+2],a[r+3]=255,r+=l}else for(let u=0;u<c;++u){const d=4*o[u];for(let f=0;f<s;++f)a[r]=n[d],a[r+1]=n[d+1],a[r+2]=n[d+2],a[r+3]=n[d+3],r+=l}else{if(e===4){for(let u=0;u<c;++u){const d=4*o[u];a[r]=n[d],a[r+1]=n[d+1],a[r+2]=n[d+2],a[r+3]=n[d+3],r+=l}return}for(let u=0;u<c;++u){const d=3*o[u];a[r]=n[d],a[r+1]=n[d+1],a[r+2]=n[d+2],a[r+3]=255,r+=l}}else{a[r]=n[0],a[r+1]=n[1],a[r+2]=n[2],a[r+3]=n[3];const u=new Uint32Array(i.typedBuffer.buffer,i.start),d=l/4,f=u[r/=4];r+=d;const m=c*s;for(let g=1;g<m;++g)u[r]=f,r+=d}}function E0t(t,e,i){const{data:r,indices:s}=t,n=e.typedBuffer,o=e.typedBufferStride,a=s.length,l=r[0];i*=o;for(let c=0;c<a;++c)n[i]=l,i+=o}function iDe(t,e,i,r,s=1){const n=e.typedBuffer,o=e.typedBufferStride;if(r*=o,s===1)for(let a=0;a<i;++a)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=o;else for(let a=0;a<i;++a)for(let l=0;l<s;++l)n[r]=t[0],n[r+1]=t[1],n[r+2]=t[2],n[r+3]=t[3],r+=o}function rDe(t,e,i,r,s,n){var o;for(const a of e.fields.keys()){const l=t.attributes.get(a),c=l==null?void 0:l.indices;if(l&&c)C0t(a,l,i,r,s,n);else if(a===$.OBJECTANDLAYERIDCOLOR&&t.objectAndLayerIdColor!=null){const u=(o=t.attributes.get($.POSITION))==null?void 0:o.indices;if(u){const d=u.length,f=s.getField(a,Sl);iDe(t.objectAndLayerIdColor,f,d,n)}}}}function C0t(t,e,i,r,s,n){switch(t){case $.POSITION:{bt(e.size===3);const o=s.getField(t,_o);bt(!!o,`No buffer view for ${t}`),o&&Voe(e,i,o,n);break}case $.NORMAL:{bt(e.size===3);const o=s.getField(t,_o);bt(!!o,`No buffer view for ${t}`),o&&zoe(e,r,o,n);break}case $.NORMALCOMPRESSED:{bt(e.size===2);const o=s.getField(t,fN);bt(!!o,`No buffer view for ${t}`),o&&_ge(e,o,n);break}case $.UV0:{bt(e.size===2);const o=s.getField(t,rE);bt(!!o,`No buffer view for ${t}`),o&&_ge(e,o,n);break}case $.COLOR:case $.SYMBOLCOLOR:{const o=s.getField(t,Sl);bt(!!o,`No buffer view for ${t}`),bt(e.size===3||e.size===4),!o||e.size!==3&&e.size!==4||tDe(e,e.size,o,n);break}case $.COLORFEATUREATTRIBUTE:{const o=s.getField(t,I6);bt(!!o,`No buffer view for ${t}`),bt(e.size===1),o&&e.size===1&&E0t(e,o,n);break}case $.TANGENT:{bt(e.size===4);const o=s.getField(t,mm);bt(!!o,`No buffer view for ${t}`),o&&S0t(e,i,o,n);break}case $.PROFILERIGHT:case $.PROFILEUP:case $.PROFILEVERTEXANDNORMAL:case $.FEATUREVALUE:{bt(e.size===4);const o=s.getField(t,mm);bt(!!o,`No buffer view for ${t}`),o&&qP(e,o,n)}}}let Dti=class extends Ur{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function M0t(t,e){sDe(t,e,new Wt("slicePlaneOrigin",(i,r)=>lDe(e,i,r)),new Wt("slicePlaneBasis1",(i,r)=>{var s;return qB(e,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new Wt("slicePlaneBasis2",(i,r)=>{var s;return qB(e,i,r,(s=r.slicePlane)==null?void 0:s.basis2)}))}function Mn(t,e){sDe(t,e,new Wh("slicePlaneOrigin",(i,r)=>lDe(e,i,r)),new Wh("slicePlaneBasis1",(i,r)=>{var s;return qB(e,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new Wh("slicePlaneBasis2",(i,r)=>{var s;return qB(e,i,r,(s=r.slicePlane)==null?void 0:s.basis2)}))}function sDe(t,e,...i){if(!e.hasSlicePlane){const o=S`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}e.hasSliceInVertexProgram&&t.vertex.uniforms.add(...i),t.fragment.uniforms.add(...i);const r=S`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=S`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=e.hasSliceHighlight?S`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:S`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(r),t.fragment.code.add(r),t.fragment.code.add(n)}function nDe(t,e,i){return t.instancedDoublePrecision?pe(A0t,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function oDe(t,e){return t!=null?$e(WB,e.origin,t):e.origin}function aDe(t,e,i){return t.hasSliceTranslatedView?e!=null?wl(P0t,i.camera.viewMatrix,e):i.camera.viewMatrix:null}function lDe(t,e,i){if(i.slicePlane==null)return Nn;const r=nDe(t,e,i),s=oDe(r,i.slicePlane),n=aDe(t,r,i);return n!=null?nt(WB,s,n):s}function qB(t,e,i,r){if(r==null||i.slicePlane==null)return Nn;const s=nDe(t,e,i),n=oDe(s,i.slicePlane),o=aDe(t,s,i);return o!=null?(Ee(O$,r,n),nt(WB,n,o),nt(O$,O$,o),$e(O$,O$,WB)):r}const A0t=C(),WB=C(),O$=C(),P0t=ke();function aE(t,e){const i=e.output===G.ObjectAndLayerIdColor,r=e.objectAndLayerIdColorInstanced;i&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),r?t.attributes.add($.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):t.attributes.add($.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(S`
     void forwardObjectAndLayerIdColor() {
      ${i?r?S`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:S`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:S``} }`),t.fragment.code.add(S`
      void outputObjectAndLayerIdColor() {
        ${i?S`fragColor = objectAndLayerIdColorVarying;`:S``} }`)}function Q6(t){t.uniforms.add(new ny("alignPixelEnabled",(e,i)=>i.alignPixelEnabled)),t.code.add(S`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(S`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}function O0t(t,e){const{vertex:i,fragment:r}=t;i.include(Q6),e.multipassEnabled&&t.varyings.add("depth","float"),i.code.add(S`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.multipassEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.include(Uy,e),r.code.add(S`
  void main() {
    fragColor = vec4(1);
    ${e.multipassEnabled?S`
        if(terrainDepthTest(depth)) {
          fragColor.g = 0.5;
        }`:""}
  }
  `)}function cDe(t){t.vertex.uniforms.add(new tt("renderTransparentlyOccludedHUD",(e,i)=>i.hudRenderStyle===Uc.Occluded?1:i.hudRenderStyle===Uc.NotOccluded?0:.75),new ji("viewport",(e,i)=>i.camera.fullViewport),new xt("hudVisibilityTexture",(e,i)=>{var r;return(r=i.hudVisibility)==null?void 0:r.getTexture()})),t.vertex.include(Q6),t.vertex.code.add(S`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}const uDe=ri(1,1,0,1),Boe=ri(1,0,1,1);function Mw(t){t.fragment.uniforms.add(new xt("depthTexture",(e,i)=>i.mainDepth)),t.fragment.constants.add("occludedHighlightFlag","vec4",uDe).add("unoccludedHighlightFlag","vec4",Boe),t.fragment.code.add(S`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}let hDe=class extends qs{constructor(e,i,r){super(e,"vec4",Yi.Pass,(s,n,o)=>s.setUniform4fv(e,i(n,o)),r)}},sc=class extends qs{constructor(e,i,r){super(e,"float",Yi.Pass,(s,n,o)=>s.setUniform1fv(e,i(n,o)),r)}},bN=class extends BLe{constructor(){super(...arguments),this.renderOccluded=ir.Occlude,this.isDecoration=!1}};const zA=8;function b_(t,e){const{vertex:i,attributes:r}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&r.add($.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(i.uniforms.add(new Wt("vvSizeMinSize",s=>s.vvSize.minSize)),i.uniforms.add(new Wt("vvSizeMaxSize",s=>s.vvSize.maxSize)),i.uniforms.add(new Wt("vvSizeOffset",s=>s.vvSize.offset)),i.uniforms.add(new Wt("vvSizeFactor",s=>s.vvSize.factor)),i.uniforms.add(new xp("vvSymbolRotationMatrix",s=>s.vvSymbolRotationMatrix)),i.uniforms.add(new Wt("vvSymbolAnchor",s=>s.vvSymbolAnchor)),i.code.add(S`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(S`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?S`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(S`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(i.constants.add("vvColorNumber","int",zA),i.uniforms.add(new sc("vvColorValues",s=>s.vvColor.values,zA),new hDe("vvColorColors",s=>s.vvColor.colors,zA)),i.code.add(S`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?S`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):i.code.add(S`vec4 vvColor() { return vec4(1.0); }`)}const ZB=.1,la=.001;function dDe(t){const e=new Hi,i=t.signedDistanceFieldEnabled;if(e.include(ZLe,t),e.include(Mn,t),t.occlusionPass)return e.include(O0t,t),e;const{vertex:r,fragment:s}=e;e.include(koe),s.include(vm),s.include(Fy),e.include(b_,t),e.include(aE,t),e.include(cDe),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),e.varyings.add("voccluded","float"),r.uniforms.add(new ji("viewport",(c,u)=>u.camera.fullViewport),new Hr("screenOffset",(c,u)=>Di(pDe,2*c.screenOffset[0]*u.camera.pixelRatio,2*c.screenOffset[1]*u.camera.pixelRatio)),new Hr("anchorPosition",c=>oD(c)),new ji("materialColor",c=>c.color)),IO(r),i&&(r.uniforms.add(new ji("outlineColor",c=>c.outlineColor)),s.uniforms.add(new ji("outlineColor",c=>bge(c)?c.outlineColor:jh),new tt("outlineSize",c=>bge(c)?c.outlineSize:0))),t.pixelSnappingEnabled&&r.include(Q6),t.hasScreenSizePerspective&&(v0t(r),J6(r)),t.debugDrawLabelBorder&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add($.UV0,"vec2"),e.attributes.add($.COLOR,"vec4"),e.attributes.add($.SIZE,"vec2"),e.attributes.add($.FEATUREATTRIBUTE,"vec4"),r.code.add(S`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?S`
            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:S`
            inputSize = size;
            vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(featureAttribute).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const n=S`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=t.pixelSnappingEnabled?i?S`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:S`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:S`posProj += quadOffset;`;r.code.add(S`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${t.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===G.ObjectAndLayerIdColor?S`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${S.float(la)};
    ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${S.float(la)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?S`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new xt("tex",c=>c.texture));const a=t.debugDrawLabelBorder?S`(isBorder > 0.0 ? 0.0 : ${S.float(ZB)})`:S.float(ZB),l=S`
    ${t.debugDrawLabelBorder?S`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${t.sampleSignedDistanceFieldTexelCenter?S`
      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;
      `:S`
      vec2 samplePos = vtc;
      `}

    ${i?S`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${S.float(la)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:S`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?S`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;switch(t.output){case G.Color:t.transparencyPassType===ft.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),s.code.add(S`
        void main() {
          ${l}
          ${t.transparencyPassType===ft.FrontFace?"fragColor.rgb /= fragColor.a;":""}
          ${t.transparencyPassType===ft.ColorAlpha?"fragAlpha = fragColor.a;":""}
        }`);break;case G.ObjectAndLayerIdColor:s.code.add(S`
        void main() {
          ${l}
          outputObjectAndLayerIdColor();
        }`);break;case G.Highlight:s.constants.add("occludedHighlightFlag","vec4",uDe),s.constants.add("unoccludedHighlightFlag","vec4",Boe),s.code.add(S`
        void main() {
          ${l}
          if (voccluded == 1.0) {
            fragColor = occludedHighlightFlag;
          } else {
            fragColor = unoccludedHighlightFlag;
          }
        }`)}return e}function bge(t){return t.outlineColor[3]>0&&t.outlineSize>0}function oD(t,e=pDe){return t.textureIsSignedDistanceField?$0t(t.anchorPosition,t.distanceFieldBoundingBox,e):Ga(e,t.anchorPosition),e}function $0t(t,e,i){e!=null?Di(i,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):Di(i,0,0)}const pDe=gt(),R0t=Object.freeze(Object.defineProperty({__proto__:null,build:dDe,calculateAnchorPosForRendering:oD},Symbol.toStringTag,{value:"Module"})),Bu=_a(Be.SRC_ALPHA,Be.ONE,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),I0t=_a(Be.ONE,Be.ZERO,Be.ONE,Be.ONE_MINUS_SRC_ALPHA);function Q_(t){return t===ft.FrontFace?null:I0t}function K6(t){return t===ft.FrontFace?Wu:null}const e8=5e5,t8={factor:-1,units:-2};function i8(t){return t?t8:null}function Aw(t,e=xr.LESS){return t===ft.NONE||t===ft.FrontFace?e:xr.LEQUAL}function K_(t){return t===ft.ColorAlpha?{buffers:[Xn.COLOR_ATTACHMENT0,Xn.COLOR_ATTACHMENT1]}:null}let fDe=class mDe extends Ki{initializeConfiguration(e,i){i.spherical=e.viewingMode===Je.Global}initializeProgram(e){return new er(e.rctx,mDe.shader.get().build(this.configuration),Pi)}initializePipeline(){const e=this.configuration.transparencyPassType,i=this.configuration,r=e===ft.NONE,s=e===ft.FrontFace,n=this.configuration.hasPolygonOffset?L0t:null,o=i.draped?null:(r||s)&&i.output!==G.Highlight&&(i.depthEnabled||i.occlusionPass)?Wu:null;return Kt({blending:i.output===G.Color||i.output===G.Highlight?r?D0t:Q_(e):null,depthTest:i.draped?null:{func:xr.LEQUAL},depthWrite:o,drawBuffers:K_(e),colorWrite:ui,polygonOffset:n})}get primitiveType(){return this.configuration.occlusionPass?Mi.POINTS:Mi.TRIANGLES}};fDe.shader=new qi(R0t,()=>oe(()=>Promise.resolve().then(()=>S9t),void 0));const L0t={factor:0,units:-4},D0t=rd(Be.ONE,Be.ONE_MINUS_SRC_ALPHA);let bn=class extends Xc{constructor(){super(...arguments),this.output=G.Color,this.transparencyPassType=ft.NONE,this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};h([j({count:G.COUNT})],bn.prototype,"output",void 0),h([j({count:ft.COUNT})],bn.prototype,"transparencyPassType",void 0),h([j()],bn.prototype,"screenCenterOffsetUnitsEnabled",void 0),h([j()],bn.prototype,"spherical",void 0),h([j()],bn.prototype,"occlusionTestEnabled",void 0),h([j()],bn.prototype,"signedDistanceFieldEnabled",void 0),h([j()],bn.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),h([j()],bn.prototype,"vvSize",void 0),h([j()],bn.prototype,"vvColor",void 0),h([j()],bn.prototype,"hasVerticalOffset",void 0),h([j()],bn.prototype,"hasScreenSizePerspective",void 0),h([j()],bn.prototype,"debugDrawLabelBorder",void 0),h([j()],bn.prototype,"hasSlicePlane",void 0),h([j()],bn.prototype,"hasPolygonOffset",void 0),h([j()],bn.prototype,"depthEnabled",void 0),h([j()],bn.prototype,"pixelSnappingEnabled",void 0),h([j()],bn.prototype,"draped",void 0),h([j()],bn.prototype,"multipassEnabled",void 0),h([j()],bn.prototype,"cullAboveGround",void 0),h([j()],bn.prototype,"occlusionPass",void 0),h([j()],bn.prototype,"objectAndLayerIdColorInstanced",void 0),h([j({constValue:!0})],bn.prototype,"hasSliceInVertexProgram",void 0),h([j({constValue:!1})],bn.prototype,"hasVvInstancing",void 0);let WP=class extends Cw{constructor(e){super(e,new q0t),this._configuration=new bn,this.produces=new Map([[Pe.HUD_MATERIAL,i=>VU(i)&&!this.parameters.drawInSecondSlot],[Pe.LABEL_MATERIAL,i=>VU(i)&&this.parameters.drawInSecondSlot],[Pe.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[Pe.DRAPED_MATERIAL,i=>VU(i)]])}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=i.slot===Pe.OCCLUSION_PIXELS&&this.parameters.occlusionTest,e===G.Color&&(this._configuration.debugDrawLabelBorder=!!kr.LABELS_SHOW_BORDER),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(e,i,r,s,n,o){if(!(r.options.selectionMode&&r.options.hud&&e.visible&&r.point))return;const a=this.parameters,l=r.point,c=r.camera;let{scaleX:u,scaleY:d}=this._getScreenScale(e);u*=c.pixelRatio,d*=c.pixelRatio,wp(l9,i),e.attributes.has($.FEATUREATTRIBUTE)&&k0t(l9);const f=e.attributes.get($.POSITION),m=e.attributes.get($.SIZE),g=e.attributes.get($.NORMAL),y=e.attributes.get($.CENTEROFFSETANDDISTANCE);bt(f.size>=3);const v=oD(a),b=this.parameters.centerOffsetUnits==="screen";for(let w=0;w<f.data.length/f.size;w++){const x=w*f.size;pe(Za,f.data[x],f.data[x+1],f.data[x+2]),nt(Za,Za,i);const T=w*m.size;Pv[0]=m.data[T]*u,Pv[1]=m.data[T+1]*d,nt(Za,Za,c.viewMatrix);const E=w*y.size;if(pe(th,y.data[E],y.data[E+1],y.data[E+2]),!b&&(Za[0]+=th[0],Za[1]+=th[1],th[2]!==0)){const O=th[2];Ce(th,Za),$e(Za,Za,de(th,th,O))}const M=w*g.size;if(pe($$,g.data[M],g.data[M+1],g.data[M+2]),wge($$,l9,c,c9),this._applyVerticalOffsetTransformationView(Za,c9,c,a9),c.applyProjection(Za,Il),Il[0]>-1){b&&(th[0]||th[1])&&(Il[0]+=th[0]*c.pixelRatio,th[1]!==0&&(Il[1]+=Doe(th[1],a9.factorAlignment)*c.pixelRatio),c.unapplyProjection(Il,Za)),Il[0]+=this.parameters.screenOffset[0]*c.pixelRatio,Il[1]+=this.parameters.screenOffset[1]*c.pixelRatio,Il[0]=Math.floor(Il[0]),Il[1]=Math.floor(Il[1]),FLe(Pv,a9.factor,Pv);const O=j0t*c.pixelRatio;let D=0;if(a.textureIsSignedDistanceField&&(D=a.outlineSize*c.pixelRatio/2),xge(l,Il[0],Il[1],Pv,O,D,a,v)){const U=r.ray;if(nt(Tge,Za,eo(V0t,c.viewMatrix)),Il[0]=l[0],Il[1]=l[1],c.unprojectFromRenderScreen(Il,Za)){const k=C();ve(k,U.direction);const H=1/Ve(k);de(k,k,H),o(Ar(U.origin,Za)*H,k,-1,!0,1,Tge)}}}}}intersectDraped(e,i,r,s,n,o){const a=e.attributes.get($.POSITION),l=e.attributes.get($.SIZE),c=this.parameters,u=oD(c);let{scaleX:d,scaleY:f}=this._getScreenScale(e);d*=e.screenToWorldRatio,f*=e.screenToWorldRatio;const m=G0t*e.screenToWorldRatio;for(let g=0;g<a.data.length/a.size;g++){const y=g*a.size,v=a.data[y],b=a.data[y+1],w=g*l.size;Pv[0]=l.data[w]*d,Pv[1]=l.data[w+1]*f;let x=0;c.textureIsSignedDistanceField&&(x=c.outlineSize*e.screenToWorldRatio/2),xge(s,v,b,Pv,m,x,c,u)&&n(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new Z0t(this)}_updateScaleInfo(e,i,r){const s=this.parameters;s.screenSizePerspective!=null?hge(r,i,s.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),s.screenSizePerspectiveAlignment!=null?hge(r,i,s.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,i,r,s,n,o,a){const l=wge(i,r,n,c9);return this._applyVerticalGroundOffsetView(e,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(e,i,r,s,n){return this._applyCenterOffsetNDC(e,i,r,s),n!=null&&ve(n,s),this._applyPolygonOffsetNDC(s,i,r,s),s}_applyPolygonOffsetView(e,i,r,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(r);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return ve(n,e);const c=Ne(Math.abs(i.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/s.viewport[2];return de(n,e,l>0?u:1/u),n}_applyVerticalGroundOffsetView(e,i,r,s){const n=Ve(e),o=r.aboveGround?1:-1,a=r.computeRenderPixelSizeAtDist(n)*WLe,l=de(Za,i.normal,o*a);return Ee(s,e,l),s}_applyVerticalOffsetTransformationView(e,i,r,s){var c;const n=this.parameters;if(!((c=n.verticalOffset)!=null&&c.screenLength)){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const u=Ve(e);this._updateScaleInfo(s,u,i.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return e}const o=Ve(e),a=n.screenSizePerspectiveAlignment??n.screenSizePerspective,l=YLe(r,o,n.verticalOffset,i.cosAngle,a);return this._updateScaleInfo(s,o,i.cosAngle),de(i.normal,i.normal,l),Ee(e,e,i.normal)}_applyCenterOffsetView(e,i,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==e&&ve(r,e),s&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(Ce($$,r),Ee(r,r,de($$,$$,i[2])))),r}_applyCenterOffsetNDC(e,i,r,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==e&&ve(s,e),n||(s[0]+=i[0]/r.fullWidth*2,s[1]+=i[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(e,i,r,s){const n=this.parameters.shaderPolygonOffset;if(e!==s&&ve(s,e),n){const o=r.aboveGround?1:-1,a=o*Math.sign(i[3]);s[2]-=(a||o)*n}return s}createGLMaterial(e){return new N0t(e)}calculateRelativeScreenBounds(e,i,r=oi()){return F0t(this.parameters,e,i,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}_getScreenScale(e){const i=e.attributes.get($.FEATUREATTRIBUTE);if(i==null)return{scaleX:1,scaleY:1};const r=jL(i.data,B0t),[s,n]=Foe(z0t,this.parameters,r);return{scaleX:s,scaleY:n}}},N0t=class extends qne{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(fDe,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function F0t(t,e,i,r){r[0]=t.anchorPosition[0]*-e[0]+t.screenOffset[0]*i,r[1]=t.anchorPosition[1]*-e[1]+t.screenOffset[1]*i}function wge(t,e,i,r){return n0t(e)&&(e=wp(U0t,e)),ca(r.normal,t,e),nt(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=Te(gDe,H0t),r}function k0t(t){const e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=1/Math.sqrt(e*e+i*i+r*r),d=1/Math.sqrt(s*s+n*n+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*u,t[1]=i*u,t[2]=r*u,t[3]=s*d,t[4]=n*d,t[5]=o*d,t[6]=a*f,t[7]=l*f,t[8]=c*f,t}function xge(t,e,i,r,s,n,o,a){let l=e-s-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*s,u=i-s-(a[1]>0?r[1]*a[1]:0),d=u+r[1]+2*s;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&f!=null&&(l+=r[0]*f[0],u+=r[1]*f[1],c-=r[0]*(1-f[2]),d-=r[1]*(1-f[3]),l-=n,c+=n,u-=n,d+=n),t[0]>l&&t[0]<c&&t[1]>u&&t[1]<d}const a9=new KLe,Za=C(),$$=C(),Il=ci(),gDe=C(),Tge=C(),l9=Kr(),U0t=Kr(),V0t=ke(),th=C(),z0t=C(),B0t=ci(),c9={normal:gDe,cosAngle:0},j0t=1,G0t=2,Pv=[0,0],H0t=qe(0,0,1);class q0t extends vIe{constructor(){super(...arguments),this.renderOccluded=ir.Occlude,this.isDecoration=!1,this.color=ri(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=Ei(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=ri(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.draped=!1}}const yDe=Ds().vec3f($.POSITION).vec3f($.NORMAL).vec2f($.UV0).vec4u8($.COLOR).vec2f($.SIZE).vec4f($.CENTEROFFSETANDDISTANCE).vec4f($.FEATUREATTRIBUTE),W0t=yDe.clone().vec4u8($.OBJECTANDLAYERIDCOLOR);let Z0t=class{constructor(e){this._material=e,this.vertexBufferLayout=ue("enable-feature:objectAndLayerId-rendering")?W0t:yDe}elementCount(e){return 6*e.attributes.get($.POSITION).indices.length}write(e,i,r,s,n){var b;Voe(r.attributes.get($.POSITION),e,s.position,n,6),zoe(r.attributes.get($.NORMAL),i,s.normal,n,6);const o=r.attributes.get($.UV0).data;let a,l,c,u;if(o==null||o.length<4){const w=this._material.parameters;a=0,l=0,c=w.texCoordScale[0],u=w.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],u=o[3];c=Math.min(1.99999,c+1),u=Math.min(1.99999,u+1);let d=r.attributes.get($.POSITION).indices.length,f=n;const m=s.uv0;for(let w=0;w<d;++w)m.set(f,0,a),m.set(f,1,l),f++,m.set(f,0,c),m.set(f,1,l),f++,m.set(f,0,c),m.set(f,1,u),f++,m.set(f,0,c),m.set(f,1,u),f++,m.set(f,0,a),m.set(f,1,u),f++,m.set(f,0,a),m.set(f,1,l),f++;tDe(r.attributes.get($.COLOR),4,s.color,n,6);const{data:g,indices:y}=r.attributes.get($.SIZE);d=y.length;const v=s.size;f=n;for(let w=0;w<d;++w){const x=g[2*y[w]],T=g[2*y[w]+1];for(let E=0;E<6;++E)v.set(f,0,x),v.set(f,1,T),f++}if(r.attributes.get($.CENTEROFFSETANDDISTANCE)?qP(r.attributes.get($.CENTEROFFSETANDDISTANCE),s.centerOffsetAndDistance,n,6):vge(s.centerOffsetAndDistance,n,6*d),r.attributes.get($.FEATUREATTRIBUTE)?qP(r.attributes.get($.FEATUREATTRIBUTE),s.featureAttribute,n,6):vge(s.featureAttribute,n,6*d),r.objectAndLayerIdColor!=null){const w=(b=r.attributes.get($.POSITION))==null?void 0:b.indices;if(w){const x=w.length,T=s.getField($.OBJECTANDLAYERIDCOLOR,Sl);iDe(r.objectAndLayerIdColor,T,x,n,6)}}}};const Mm=C(),NE=ci(),R$=ci(),u9=C(),Y0t=ke(),X0t=_n(),h9=mo(),J0t=C(),Q0t=oi();class K0t{constructor(){this.aabr=oi(),this.distance=0,this.culled=!1,this.visible=!1}}class e_t{constructor(e,i){this.graphics3DGraphic=e,this.slicePlaneEnabled=i,this.info={}}}var wu;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(wu||(wu={}));class t_t{constructor(){this.camera=new Fr,this.slicePlane=j_(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),H2(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let HM=class extends Ue{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._viewState=new t_t,this._state=wu.Idle,this._active=new Map,this._visible=new Map,this._iterators=new n_t,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==wu.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/wu.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case wu.Idle:this._startUpdate(),t.madeProgress();case wu.Process:if(this._state=wu.Process,!this._processActiveGraphics(t))return;case wu.Sort:if(this._state=wu.Sort,!this._sortVisibleGraphics(t))return;case wu.Deconflict:if(this._state=wu.Deconflict,!this._deconflictVisibleGraphics(t))return;default:Zyt(this,this._visible),this._state=wu.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(i=>this.addToActiveGraphics(i)):t.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;if(((e==null?void 0:e.geometries.length)??0)!==1)return!1;const i=e==null?void 0:e.geometries[0];return(i==null?void 0:i.material)instanceof WP}_startUpdate(){Yyt(this.view),this._dirty=!1,this._viewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._viewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new K0t,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),i_t(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),i=fw(Y0t,this._viewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._viewState.camera.relativeElevation>0?X0t:null;let s=0;for(r!=null&&(nt(r,Nn,this._viewState.camera.viewMatrix),r[3]=br(this.view.spatialReference).radius,s=RPe(r,Nn));!t.done;){t.madeProgress();const n=e.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o==null?void 0:o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,i,r,s),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const i=e.next();if(t.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===ko.LABEL;for(;!t.done;){t.madeProgress();const r=e.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=r.value,n=s.info[this.visibilityGroup];if(!n||n.culled){this._setGraphicVisibility(s,!1);continue}const o=s.graphics3DGraphic,a=!i||o.isVisible();n.visible=a&&!this._isConflicted(s),n.visible&&this._addToBins(s),this._setGraphicVisibility(s,n.visible),Jyt(n,n.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=Sge(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=Sge(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=r_t(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,i,r){const s=t.graphics3DGraphic;if(s.destroyed)return;const n=t.info[this.visibilityGroup];if(!s.isVisible(ko.GRAPHIC,Fa.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);Kh(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(a==null&&(a=c_t,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,Mm)||i!=null&&l_t(a,i,r)))return void(n.culled=!0);this._expandBoundingRect(n,l,c,a)}a==null?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(t,e,i){const r=this._viewState.camera,s=t.stageObject,n=s.geometries[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;nt(Mm,a,r.viewMatrix);const l=n.attributes,c=l.get($.NORMAL).data,u=l.get($.CENTEROFFSETANDDISTANCE).data;o.applyShaderOffsetsView(Mm,c,s.transformation,u,r,i.scaleInfo,Mm),Ss(NE,Mm[0],Mm[1],Mm[2],1),Vu(R$,NE,r.projectionMatrix),de(i.positionNDC,R$,1/R$[3]),o.applyShaderOffsetsNDC(i.positionNDC,u,r,i.positionNDC,u9),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(u9[2]),i.distance=u9[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),Ss(R$,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),Vu(NE,R$,e),g2(NE,NE,1/NE[3]),pe(i.positionView,Mm[0],Mm[1],Mm[2])}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._viewState.slicePlaneEnabled&&Gse(this._viewState.slicePlane,e)}_expandBoundingRect(t,e,i,{positionNDC:r,scaleInfo:s}){const n=this._viewState.camera,o=e.getScreenSize(o_t);FLe(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=Yz(i.calculateRelativeScreenBounds(o,s.factorAlignment.scale,Q0t),Bt(0,n.fullWidth,.5+.5*r[0]),Bt(0,n.fullHeight,.5+.5*r[1])),l=this.marginFactor;if(l!==0){const c=l*Math.min(fl(a),Hc(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}vb(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,i=t.info[this.visibilityGroup];let r=!0;for(let s=Math.floor(i.aabr[0]/this._accBinsSizeX);s<=Math.floor(i.aabr[2]/this._accBinsSizeX);s++)if(!(s<0||s>=this._accBinsNumX))for(let n=Math.floor(i.aabr[1]/this._accBinsSizeY);n<=Math.floor(i.aabr[3]/this._accBinsSizeY);n++){if(n<0||n>=this._accBinsNumY)continue;r=!1;const o=this._accBins[s][n];for(let a=0;a<o.length;a++){const l=o.data[a],c=l.info[this.visibilityGroup];if(c&&c.visible&&l.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,VG(c.aabr,i.aabr)))return!0}}return r}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let i=0;i<this._accBinsNumX;i++){this._accBins.push([]);const r=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)r.push(new ai)}}else for(let i=0;i<this._accBinsNumX;i++)for(let r=0;r<this._accBinsNumY;r++)this._accBins[i][r].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],i=Math.floor(e.aabr[0]/this._accBinsSizeX),r=Math.floor(e.aabr[2]/this._accBinsSizeX),s=Math.floor(e.aabr[1]/this._accBinsSizeY),n=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const i=t.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(this.visibilityGroup,Fa.DECONFLICTION,e),this.visibilityGroup===ko.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,e))}};function i_t(t,e){const i=t.graphics3DGraphic;i.destroyed||i.setVisibilityFlag(e,Fa.DECONFLICTION,!0)}function*Sge(t){if(Map.prototype.entries){const e=t.entries();for(let i=e.next();!i.done;i=e.next())yield i.value[1]}else yield*t.values()}function*r_t(t,e,i){e.clear(),t.forEach((s,n)=>{var l;const o=e.pushNew();o.id=n,o.visible=s.graphics3DGraphic.getVisibilityFlag(i,Fa.DECONFLICTION);const a=(l=s.info)==null?void 0:l[i];o.prio=s.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE}),yield;const r=e.iterableSort((s,n)=>s.prio!==n.prio?n.prio-s.prio:s.distance!==n.distance?s.distance-n.distance:s.visible!==n.visible?s.visible?-1:1:s.id-n.id);for(let s=r.next();!s.done;s=r.next())yield;e.forAll(s=>{const n=t.get(s.id);n&&(t.delete(s.id),t.set(s.id,n))}),e.clear()}h([p({constructOnly:!0})],HM.prototype,"view",void 0),h([p({type:Boolean,readOnly:!0})],HM.prototype,"updating",null),HM=h([I("esri.views.3d.layers.graphics.Deconflictor")],HM);class s_t{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class n_t{constructor(e=null,i=null,r=null){this.active=e,this.visible=i,this.sort=r,this.sortArray=new ai({allocator:s=>s||new s_t})}}const o_t=gt();class a_t{constructor(){this.positionView=C(),this.positionNDC=C(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new KLe}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}function l_t(t,e,i){return ve(h9.direction,t.positionView),pe(h9.origin,0,0,0),!!yw(e,h9,J0t)&&t.distanceWithoutPolygonOffset>i}const c_t=new a_t,u_t=2e3;let QU=class extends HM{constructor(e){super(e),this.visibilityGroup=ko.LABEL,this.marginFactor=.05,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return pa;const i=performance.now();if(e.state!==Ii.IDLE&&i-this._lastDeconfliction<u_t)return pa;super.runTask(e),this.state===wu.Idle&&(this._lastDeconfliction=i)}enabledChanged(e,i){this.modifyGraphics(i,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};h([p({constructOnly:!0})],QU.prototype,"parent",void 0),QU=h([I("esri.views.3d.layers.graphics.LabelDeconflictor")],QU);let $K=class extends HM{constructor(){super(...arguments),this._contexts=new Map,this.visibilityGroup=ko.GRAPHIC,this._marginFactor=-.1,this.test={overrideMarginFactor:e=>{this._marginFactor=e,this.setDirty()}}}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this.addHandles([te(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.state)==null?void 0:i.camera},()=>{this._updateViewState(),this.setDirty()}),te(()=>{var e,i,r;return(r=(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.ground)==null?void 0:r.opacity},(e,i)=>{e!==1&&i!==1||this.setDirty()}),te(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},pt)]),this._frameTask=this.view.resourceController.scheduler.registerTask(It.GRAPHICS_DECONFLICTOR,this),this._labels=new QU({view:this.view,parent:this})}destroy(){this._labels=He(this._labels),this._frameTask=Lr(this._frameTask)}get marginFactor(){return this._marginFactor}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}_updateViewState(){var e;(e=this.view)!=null&&e.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&SPe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){Fh(this._contexts,(e,i)=>i.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const i=this._getGraphicsContext(e);return{addGraphic:r=>this._addGraphic(e,i,r),removeGraphic:r=>this._removeGraphic(i,r),labelingInfoChange:()=>this._labels.enabledChanged(e,i),featureReductionChange:()=>this.enabledChanged(e,i),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,i),clear:()=>i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const i=this._contexts.get(e);i&&(i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,i,r){const s=r.graphic.uid,n=new e_t(r,e.symbolCreationContext.slicePlaneEnabled);i.set(s,n),d9(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n);const o=!this._graphicSupportsDeconfliction(r)||!d9(e);r.setVisibilityFlag(ko.GRAPHIC,Fa.DECONFLICTION,o)}_removeGraphic(e,i){const r=i.graphic.uid,s=e.get(r);s&&(this.removeFromActiveGraphics(s),this._labels.removeFromActiveGraphics(s),e.delete(r),this.setDirty())}enabledChanged(e,i){const r=d9(e);r||h_t(e),this.modifyGraphics(i,r)}_slicePlaneEnabledChanged(e,i){const r=e.symbolCreationContext.slicePlaneEnabled;i.forEach(s=>s.slicePlaneEnabled=r),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const i=e.layers;if(!(i!=null&&i.length))return!1;for(const r of i)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(e){const i=this._contexts.get(e);if(i)return i;const r=new Map;return this._contexts.set(e,r),this.setDirty(),r}};function d9(t){const e=t.layer;return!(!(e!=null&&e.featureReduction)||e.featureReduction.type!=="selection")}function h_t(t){const e=t.graphics3DGraphics;e&&e.forEach(i=>i.setVisibilityFlag(ko.GRAPHIC,Fa.DECONFLICTION,!0))}$K=h([I("esri.views.3d.layers.graphics.GraphicsDeconflictor")],$K);function _De(t){return"declaredClass"in t}function Ege(t){return"declaredClass"in t}function d_t(t){return"declaredClass"in t}function p_t(t,e){return t?d_t(t)?t:new ya({layer:e,sourceLayer:e,visible:t.visible,symbol:re(t.symbol),attributes:re(t.attributes),geometry:vDe(t.geometry)}):null}function vDe(t){return t==null?null:_De(t)?t:_y(f_t(t))}function f_t(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:s}=t.spatialReference,n={wkid:e,wkt:i,wkt2:r,latestWkid:s};switch(t.type){case"point":{const{x:o,y:a,z:l,m:c}=t;return{x:o,y:a,z:l,m:c,spatialReference:n}}case"polygon":{const{rings:o,hasZ:a,hasM:l}=t;return{rings:Cge(o),hasZ:a,hasM:l,spatialReference:n}}case"polyline":{const{paths:o,hasZ:a,hasM:l}=t;return{paths:Cge(o),hasZ:a,hasM:l,spatialReference:n}}case"extent":{const{xmin:o,xmax:a,ymin:l,ymax:c,zmin:u,zmax:d,mmin:f,mmax:m,hasZ:g,hasM:y}=t;return{xmin:o,xmax:a,ymin:l,ymax:c,zmin:u,zmax:d,mmin:f,mmax:m,hasZ:g,hasM:y,spatialReference:n}}case"multipoint":{const{points:o,hasZ:a,hasM:l}=t;return{points:wDe(o)?bDe(o):o,hasZ:a,hasM:l,spatialReference:n}}default:return}}function Cge(t){return m_t(t)?t.map(e=>bDe(e)):t}function bDe(t){return t.map(e=>Array.from(e))}function m_t(t){for(const e of t)if(e.length!==0)return wDe(e);return!1}function wDe(t){return t.length>0&&(OD(t[0])||$D(t[0]))}function g_t(t,e){if(!t)return null;let i;if(Ege(t)){if(e==null)return t.clone();if(Ege(e))return e.copy(t)}return e!=null?(i=e,i.x=t.x,i.y=t.y,i.spatialReference=t.spatialReference,t.hasZ?(i.z=t.z,i.hasZ=t.hasZ):(i.z=void 0,i.hasZ=!1),t.hasM?(i.m=t.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=_w(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0)),i}function qti(t){const{wkid:e,wkt:i,wkt2:r,latestWkid:s}=t,n={wkid:e,wkt:i,wkt2:r,latestWkid:s};return Ye.fromJSON(n)}const joe="__begin__",Goe="__end__",y_t=new RegExp(joe,"ig"),__t=new RegExp(Goe,"ig"),Mge=new RegExp("^"+joe,"i"),Age=new RegExp(Goe+"$","i"),YB='"',v_t=YB+" + ",b_t=" + "+YB;function w_t(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function x_t(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function r8(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=w_t(t.labelExpression),e.type="conventional"),e}function T_t(t){const e=r8(t);if(!e)return null;switch(e.type){case"conventional":return RK(e.expression);case"arcade":return e.expression}return null}function S_t(t){const e=r8(t);if(!e)return null;switch(e.type){case"conventional":return C_t(e.expression);case"arcade":return Hoe(e.expression)}return null}function RK(t){let e;return t?(e=py(t,i=>joe+'$feature["'+i+'"]'+Goe),e=Mge.test(e)?e.replace(Mge,""):YB+e,e=Age.test(e)?e.replace(Age,""):e+YB,e=e.replaceAll(y_t,v_t).replaceAll(__t,b_t)):e='""',e}const E_t=/^\s*\{([^}]+)\}\s*$/i;function C_t(t){const e=t==null?void 0:t.match(E_t);return(e==null?void 0:e[1].trim())||null}const M_t=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,A_t=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,P_t=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;function Hoe(t){if(!t)return null;let e=M_t.exec(t)||A_t.exec(t);return e?e[1]||e[3]:(e=P_t.exec(t),e?e[2]:null)}const p9=()=>ne.getLogger("esri.layers.support.labelFormatUtils"),f9={type:"simple",evaluate:()=>null},O_t={getAttribute:(t,e)=>t.field(e)};async function $_t(t,e,i){if(!t||!t.symbol||!e)return f9;const r=t.where,s=r8(t);let n;if(s.type==="arcade"){const o=await tat(s.expression,i,e);if(o==null)return f9;n={type:"arcade",evaluate(a,l){try{const c="attributes"in a?o.repurposeFeature(a):a;c.contextTimeZone=l??null;const u=o.evaluate({$view:{timeZone:l},$feature:c},o.services);if(u!=null)return u.toString()}catch(c){p9().error(new B("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:c,feature:a,expression:s}))}return null},needsHydrationToEvaluate:()=>Hoe(s.expression)==null}}else n={type:"simple",evaluate:o=>s.expression.replaceAll(/{[^}]*}/g,a=>{const l=a.slice(1,-1),c=e.get(l);if(!c)return a;let u=null;return"attributes"in o?o&&o.attributes&&(u=o.attributes[c.name]):u=o.field(c.name),u==null?"":R_t(u,c)})};if(r){let o;try{o=await hne(r,e)}catch(l){return p9().error(new B("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:l})),f9}const a=n.evaluate;n.evaluate=(l,c)=>{const u="attributes"in l?void 0:O_t;try{if(o.testFeature(l,u))return a(l,c)}catch(d){p9().error(new B("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:l,error:d}))}return null}}return n}function R_t(t,e){if(t==null)return"";const i=e.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const s=t;for(const n of i.codedValues)if(n.code===s)return n.name}else if(i.type==="range"){const{max:s,min:n}=d$e(e),o=+t;if(n!=null&&s!=null&&n<=o&&o<=s)return i.name}}let r=t;return mne(e)?r=ku(r,W1("short-date")):m6(e)&&(r=nc(+r)),r||""}function xDe(t,e,i,r,s,n,o,a,l,c,u){const d=U_t[u.mode];let f,m,g=0;if(gs(t,e,i,r,l.spatialReference,s,a))return d.requiresAlignment(u)?(g=d.applyElevationAlignmentBuffer(r,s,n,o,a,l,c,u),f=n,m=o):(f=r,m=s),gs(f,l.spatialReference,m,n,c.spatialReference,o,a)?g:void 0}function nw(t,e,i,r,s){const n=(gB(t)?t.z:LOe(t)?t.array[t.offset+2]:t[2])||0;switch(i.mode){case"on-the-ground":{const o=Gg(e,t,"ground")??0;return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=Gg(e,t,"ground")??0,a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=Gg(e,t,"scene")??0,a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(n,r),a=Gg(e,t,"ground")??0;return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return void(s.z=0)}}function I_t(t,e,i,r){return nw(t,e,i,r,qM),qM.z}function wN(t,e,i){return e==="on-the-ground"&&i==="on-the-ground"?t.staysOnTheGround:e===i||e!=="on-the-ground"&&i!=="on-the-ground"?e==null||i==null?t.definedChanged:Hs.UPDATE:t.onTheGroundChanged}function _p(t){return t==="relative-to-ground"||t==="relative-to-scene"}function ow(t){return t!=="absolute-height"}function TDe(t,e,i,r,s){nw(e,i,s,r,qM),SDe(t,qM.verticalDistanceToGround);const n=qM.sampledElevation,o=An(V_t,t.transformation);return N4[0]=e.x,N4[1]=e.y,N4[2]=qM.z,Gh(e.spatialReference,N4,o,r.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function SDe(t,e){for(let i=0;i<t.geometries.length;++i){const r=t.geometries[i].getMutableAttribute($.CENTEROFFSETANDDISTANCE);r&&r.data[3]!==e&&(r.data[3]=e,t.geometryVertexAttributeUpdated(t.geometries[i],$.CENTEROFFSETANDDISTANCE))}}function L_t(t,e,i,r,s,n){let o=0;const a=n.spatialReference;e*=3,r*=3;for(let l=0;l<s;++l){const c=t[e],u=t[e+1],d=t[e+2],f=n.getElevation(c,u,d,a,"ground")??0;o+=f,i[r]=c,i[r+1]=u,i[r+2]=f,e+=3,r+=3}return o/s}function D_t(t,e,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,d=n.spatialReference;e*=3,r*=3;for(let f=0;f<s;++f){const m=t[e],g=t[e+1],y=t[e+2],v=n.getElevation(m,g,y,d,"ground")??0;l+=v,i[r]=m,i[r+1]=g,i[r+2]=u==null?y+v+c:v+c,e+=3,r+=3}return l/s}function N_t(t,e,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,d=n.spatialReference;e*=3,r*=3;for(let f=0;f<s;++f){const m=t[e],g=t[e+1],y=t[e+2],v=n.getElevation(m,g,y,d,"scene")??0;l+=v,i[r]=m,i[r+1]=g,i[r+2]=u==null?y+v+c:v+c,e+=3,r+=3}return l/s}function F_t(t){const e=t.meterUnitOffset,i=t.featureExpressionInfoContext;return e!==0||i!=null}function k_t(t,e,i,r,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,r*=3;for(let u=0;u<s;++u){const d=t[e],f=t[e+1],m=t[e+2];i[r]=d,i[r+1]=f,i[r+2]=c==null?m+l:l,e+=3,r+=3}return 0}let xN=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var Hs;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(Hs||(Hs={}));const U_t={"absolute-height":{applyElevationAlignmentBuffer:k_t,requiresAlignment:F_t},"on-the-ground":{applyElevationAlignmentBuffer:L_t,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:D_t,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:N_t,requiresAlignment:()=>!0}},V_t=ke(),qM=new xN,N4=C();function qoe(t){return t.mapPositions!=null}function EDe(t,e,i,r,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!qoe(l))continue;const{update:c,averageGeometrySampledElevation:u}=MDe(l,e,i,r,s);a+=u,c&&n.geometryVertexAttributeUpdated(l,$.POSITION)}return a/o.length}function jS(t,e,i,r,s,n){const o=t.stageObject,a=e.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(r(a,Bc),SDe(o,Bc.verticalDistanceToGround),l=Bc.sampledElevation):(r(a,Bc),e.mode!=="absolute-height"&&(l=Bc.sampledElevation));const c=An(z_t,n??o.transformation),u=pe(CDe,c[12],c[13],c[14]);kr.TESTS_DISABLE_OPTIMIZATIONS?(zc[0]=a.x,zc[1]=a.y,zc[2]=Bc.z,Gh(a.spatialReference,zc,c,s.spatialReference)&&(n?An(n,c):o.transformation=c)):s.setAltitudeOfTransformation(Bc.z,c);const d=Woe/s.unitInMeters;return(Math.abs(c[12]-u[0])>=d||Math.abs(c[13]-u[1])>=d||Math.abs(c[14]-u[2])>=d)&&(n?An(n,c):o.transformation=c),l}const z_t=ke();function B_t(t,e,i,r,s){const n=t.graphics3DSymbolLayer.lodRenderer;if(n==null)return 0;const o=e.centerPointInElevationSR;r(o,Bc);const a=e.mode!=="absolute-height"?Bc.sampledElevation:0,l=n.instanceData,c=t.instanceIndex,u=G_t;l.getGlobalTransform(c,u);const d=pe(CDe,u[12],u[13],u[14]);kr.TESTS_DISABLE_OPTIMIZATIONS?(zc[0]=o.x,zc[1]=o.y,zc[2]=Bc.z,Gh(o.spatialReference,zc,u,s.spatialReference)&&l.setGlobalTransform(c,u)):s.setAltitudeOfTransformation(Bc.z,u);const f=Woe/s.unitInMeters;return(kr.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(u[12]-d[0])>=f||Math.abs(u[13]-d[1])>=f||Math.abs(u[14]-d[2])>=f)&&l.setGlobalTransform(c,u),a}function j_t(t,e,i,r,s){const n=t.stageObject,o=n.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,u=!1;for(const d of o){if(!qoe(d))continue;const f=d.attributes.get($.POSITION);if(f!==l){const{update:m,averageGeometrySampledElevation:g}=MDe(d,e,i,r,s);c=g,l=f,u=m}u&&n.geometryVertexAttributeUpdated(d,$.POSITION),a+=c}return a/o.length}const Woe=.01,zc=C(),dd=C(),FE=C(),G_t=ke(),CDe=C(),Bc=new xN;function MDe(t,e,i,r,s){let n=!1;const o=t.transformation,a=e.requiresSampledElevationInfo;dd[0]=o[12],dd[1]=o[13],dd[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute($.POSITION),c=l.data,u=l.size,d=c.length/u,f=new nne(t.mapPositions,i);let m=0,g=0;for(let y=0;y<d;y++){if(FE[0]=c[m],FE[1]=c[m+1],FE[2]=c[m+2],r(f,Bc),a&&(g+=Bc.sampledElevation),kr.TESTS_DISABLE_OPTIMIZATIONS)c[m]=f.array[f.offset],c[m+1]=f.array[f.offset+1],c[m+2]=Bc.z,gs(c,i,m,c,s.spatialReference,m,1),c[m]-=dd[0],c[m+1]-=dd[1],c[m+2]-=dd[2],n=!0;else{zc[0]=c[m]+dd[0],zc[1]=c[m+1]+dd[1],zc[2]=c[m+2]+dd[2],s.setAltitude(zc,Bc.z),c[m]=zc[0]-dd[0],c[m+1]=zc[1]-dd[1],c[m+2]=zc[2]-dd[2];const v=Woe/s.unitInMeters;(Math.abs(FE[0]-c[m])>=v||Math.abs(FE[1]-c[m+1])>=v||Math.abs(FE[2]-c[m+2])>=v)&&(n=!0)}m+=u,f.offset+=3}return g/=d,{update:n,averageGeometrySampledElevation:g}}function H_t(t){return!!t&&jP[t]!=null}function ADe(t){return 1/(jP[t]||1)}function q_t(){const t=Object.keys(jP);return t.sort(),t}const W_t=q_t(),Z_t=()=>ne.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function Y_t(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function Zti(t){const e=t==null?void 0:t.expression;if(typeof e=="string"){const i=$De(e);if(i!=null)return{cachedResult:i}}return null}async function Yti(t,e,i,r){const s=t==null?void 0:t.expression;if(typeof s!="string")return null;const n=$De(s);if(n!=null)return{cachedResult:n};const o=await by();Dt(i);const a=o.arcadeUtils,l=a.createSyntaxTree(s);return a.dependsOnView(l)?(r!=null&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function PDe(t,e,i){return t.arcadeUtils.createFeature(e.attributes,e.geometry,i)}function s8(t,e){if(t!=null&&!ODe(t)){if(!e||!t.arcade)return void Z_t().errorOncePerTick("Arcade support required but not provided");const i=e;i._geometry&&(i._geometry=vDe(i._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function X_t(t){if(t!=null){if(ODe(t))return t.cachedResult;const e=t.arcade;let i=e==null?void 0:e.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof i!="number"&&(t.cachedResult=0,i=0),i}return 0}function Xti(t,e=!1){let i=t==null?void 0:t.featureExpressionInfo;const r=i==null?void 0:i.expression;return e||r==="0"||(i=null),i??null}const J_t={cachedResult:0};function ODe(t){return t.cachedResult!=null}function $De(t){return t==="0"?0:null}let XB=class RDe{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=ADe(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:e+r}calculateOffsetRenderUnits(e){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=X_t(r)*this._metersPerElevationInfoUnit),i/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=H_t(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,i,r){if(e==null)return void(this._featureExpressionInfoContext=null);const s=e==null?void 0:e.arcade;s&&i!=null&&r!=null?(this._featureExpressionInfoContext=Y_t(e),s8(this._featureExpressionInfoContext,PDe(s.modules,i,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const i=new RDe;return e!=null&&i.setFromElevationInfo(e),i}},Q_t=class{constructor(e,i,r){this.graphic=e,this.renderingInfo=i,this.layer=r}};function Zoe(t,e){if(t.type==="point")return Ov(t,e,!1);if(_De(t))switch(t.type){case"extent":return Ov(t.center,e,!1);case"polygon":return Ov(t.centroid,e,!1);case"polyline":return Ov(Pge(t),e,!0);case"mesh":return Ov(t.origin,e,!1)}else switch(t.type){case"extent":return Ov(K_t(t),e,!0);case"polygon":return Ov(evt(t),e,!0);case"polyline":return Ov(Pge(t),e,!0)}}function Pge(t){const e=t.paths[0];if(!e||e.length===0)return null;const i=pMe(e,dse(e)/2);return _w(i[0],i[1],i[2],t.spatialReference)}function K_t(t){return _w(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function evt(t){const e=t.rings[0];if(!e||e.length===0)return null;const i=gMe(t.rings,!!t.hasZ);return _w(i[0],i[1],i[2],t.spatialReference)}function Ov(t,e,i){const r=i?t:g_t(t);return e&&t?rAe(t,r,e)?r:null:r}function Qti(t,e,i,r=0){if(t){e||(e=oi());const s=t;let n=.5*s.width*(i-1),o=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),Ss(e,s.xmin-n-r,s.ymin-o-r,s.xmax+n+r,s.ymax+o+r),e}return null}function H3(t,e,i=null){const r=QD(Kd);return t!=null&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),e!=null?r[3]=e:t!=null&&t.length>3&&(r[3]=t[3]),i&&(r[0]*=i,r[1]*=i,r[2]*=i,r[3]*=i),r}function Kti(t,e,i,r,s,n=[0,0,0,0]){for(let o=0;o<3;++o)n[o]=(t==null?void 0:t[o])!=null?t[o]:(i==null?void 0:i[o])!=null?i[o]:s[o];return n[3]=e??r??s[3],n}function Oge(t=o_,e,i,r=1){const s=new Array(3);if(e==null||i==null)s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const u=l!=null,d=a===0&&!n&&!u,f=i[a];l==="symbol-value"||d?c=f!==0?e[a]/f:1:u&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=r;return Xl(s)}function tvt(t){return t.isPrimitive!=null}function n8(t){return IK(tvt(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function IK(t){const e=i=>i==null||i>=0;return Array.isArray(t)?t.every(e):e(t)}function ivt(t,e,i,r=ke()){return t&&mP(r,r,-t/180*Math.PI),e&&fP(r,r,e/180*Math.PI),i&&RG(r,r,i/180*Math.PI),r}function Yoe(t,e,i){if(i.minDemResolution!=null)return i.minDemResolution;const r=cc(e),s=X2(t)*r,n=J2(t)*r,o=xw(t)*(e.isGeographic?1:r);return s===0&&n===0&&o===0?i.minDemResolutionForPoints:.01*Math.max(s,n,o)}var $h;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})($h||($h={}));let rvt=class{constructor(e,i,r){this.baseMaterial=e,this.edgeMaterials=i,this.properties=r}},Vy=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,i,r,s,n,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const i=e.stage;i.addMany(this._uniqueMaterials),i.addMany(this._uniqueGeometries),i.add(this.stageObject)}destroy(){var i,r;if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),(i=e.renderer.edgeView)==null||i.removeObject(this.stageObject),this.stageObject.dispose(),(r=this._sharedResource)==null||r.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,i){const{stageObject:r,_edgeState:s,_stageLayer:n}=this;if(s==null)return;const o=$ge(s.baseMaterial);let a=!1;for(const l of s.edgeMaterials)l.objectTransparency!==o&&(l.objectTransparency=o,a=!0);a&&this.resetEdgeObject(i),n.stage.renderer.withEdgeView(l=>{l.updateAllComponentOpacities(r,[e])})}slicePlaneEnabledChanged(e,i){const{stageObject:r,_edgeState:s,_stageLayer:n}=this;s!=null&&n.stage.renderer.withEdgeView(o=>{o.updateAllComponentMaterials(r,s.edgeMaterials,{hasSlicePlane:e},!i),s.properties.hasSlicePlane=e})}setVisibility(e){const{_edgeState:i,stageObject:r,_stageLayer:s}=this;s!=null&&this.visible!==e&&(this._visible=e,r.visible=e,e&&!this._addedToStage&&(s.add(r),this._addedToStage=!0),i!=null&&s.stage.renderer.withEdgeView(n=>{n.hasObject(r)?n.updateObjectVisibility(r,e):e&&this._addOrUpdateEdgeObject(i,n,!1)}))}get visible(){return this._visible}alignWithElevation(e,i,r,s){if(this.elevationAligner==null)return;r!=null&&s8(this.elevationContext.featureExpressionInfoContext,r);const n=(o,a)=>nw(o,e,this.elevationContext,i,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,i),this.resetEdgeObject(s)}alignWithAbsoluteElevation(e,i,r){const s=(n,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,s,i),this.resetEdgeObject(r)}getCenterObjectSpace(e=C()){return ve(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=io()){const i=this.stageObject.boundingVolumeObjectSpace;return G$e(e,i.min),H$e(e,i.max),e}computeAttachmentOrigin(e){const i=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=i[12],e.render.origin[1]+=i[13],e.render.origin[2]+=i[14],e.render.num++;else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(Ky)&&(nt(Ky,Ky,i),Ee(e.render.origin,e.render.origin,Ky),e.render.num++)}async getProjectedBoundingBox(e,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=svt,l=Sne(o)?1:a.length;for(let u=0;u<l;u++){const d=a[u];$v[0]=o[d[0]],$v[1]=o[d[1]],$v[2]=o[d[2]],nt($v,$v,this.stageObject.transformation),tx[3*u]=$v[0],tx[3*u+1]=$v[1],tx[3*u+2]=$v[2]}if(!e(tx,0,l))return null;Qr(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],tx[u+d]),o[d+3]=Math.max(o[d+3],tx[u+d]);c&&r.push({location:tx.slice(u,u+3),screenSpaceBoundingRect:c})}if(i!=null&&i.service&&this.elevationContext.mode!=="absolute-height"){jf(o,Ky);const u=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let d=0;if(i.useViewElevation)d=i.service.getElevation(Ky[0],Ky[1],u)??0;else try{const f=Yoe(o,i.service.spatialReference,i);d=await i.service.queryElevation(Ky[0],Ky[1],s,f,u)??0}catch{}j$e(o,0,0,-this.alignedSampledElevation+d)}return o}addObjectState(e,i){e===R_.Highlight&&i.addObject(this.stageObject,this.stageObject.highlight()),e===R_.MaskOccludee&&i.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){const{_edgeState:i,stageObject:r,_stageLayer:s,_visible:n}=this;i!=null&&s.stage.renderer.withEdgeView(o=>{n?this._addOrUpdateEdgeObject(i,o,e):o.removeObject(r)})}_addOrUpdateEdgeObject(e,i,r){const s=$ge(e.baseMaterial);for(const n of e.edgeMaterials)n.objectTransparency=s;i.addOrUpdateObject3D(this.stageObject,e.edgeMaterials,e.properties,!r).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}};function $ge(t){return t.isVisible()?t.parameters.transparent?$h.TRANSPARENT:$h.OPAQUE:$h.INVISIBLE}const tx=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],$v=C(),Ky=C(),svt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let IDe=class{constructor(e,i=null){this.labelText=i,this.elevationOffset=e??0}};const LDe=3,LK=3,DDe=10;let NDe=class{constructor(e,i=null){this.geometry=e,this.textures=i}},FDe=class{constructor(e,i,r){this.components=e,this.minScreenSpaceRadius=i,this.pivotOffset=r;const s=this.geometries;this.numVertices=s.reduce((n,o)=>n+o.attributes.get($.POSITION).indices.length,0)}get geometries(){return D2(this.components.map(e=>e.geometry))}},kDe=class{constructor(e){this.levels=e,this.levels.sort((i,r)=>i.minScreenSpaceRadius===r.minScreenSpaceRadius?i.numVertices-r.numVertices:i.minScreenSpaceRadius-r.minScreenSpaceRadius)}};function F4(t){const e=[];return t.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry.material))),D2(e)}function Rge(t){const e=new Array;return t.levels.forEach(i=>i.components.forEach(r=>{r.textures!=null&&e.push(...r.textures)})),D2(e)}function Ige(t){const e=new Array;return t.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry))),D2(e)}function nvt(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function UDe(t,e){const i=(r,s,n=!1)=>new kDe(r.map(o=>{const a=s(o.tesselation);return n&&Apt(a),new FDe([new NDe(a)],o.minScreenSpaceRadius)}));switch(t){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>Spt(e,.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>mpt(e,1));case"cone":return i(m9,r=>Kfe(e,1,.5,r,!1),!0);case"inverted-cone":return i(m9,r=>Kfe(e,1,.5,r,!0),!0);case"cylinder":return i(m9,r=>Cpt(e,1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Tpt(e,1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>vpt(e,1),!0);default:return}}const m9=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let qd=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new VDe}},Xoe=class extends qd{constructor(e){super(e),this.estimated=!0}},ovt=class extends qd{constructor(e,i){super(i),this.numComplexities=e}},avt=class extends Xoe{constructor(e,i){super(i),this.numComplexities=e}},VDe=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}};function lvt(t){return t.type==="fill"}function cvt(t){return t.type==="extrude"}function Joe(t,e,i=0){const r=Ne(t,0,dvt);for(let s=0;s<4;s++)e[i+s]=Math.floor(256*pvt(r*uvt[s]))}function Qoe(t,e=0){let i=0;for(let r=0;r<4;r++)i+=t[e+r]*hvt[r];return i}const uvt=[1,256,65536,16777216],hvt=[1/256,1/65536,1/16777216,1/4294967296],dvt=Qoe(new Uint8ClampedArray([255,255,255,255]));function pvt(t){return t-Math.floor(t)}var Qn;function fvt(t){switch(t){case"multiply":default:return Qn.Multiply;case"ignore":return Qn.Ignore;case"replace":return Qn.Replace;case"tint":return Qn.Tint}}function zDe(t,e,i){if(t==null||e===Qn.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=Ne(Math.round(t[3]*JB),0,JB),s=r===0||e===Qn.Tint?0:e===Qn.Replace?mvt:gvt;i[0]=Ne(Math.round(t[0]*kE),0,kE),i[1]=Ne(Math.round(t[1]*kE),0,kE),i[2]=Ne(Math.round(t[2]*kE),0,kE),i[3]=r+s}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(Qn||(Qn={}));const kE=255,JB=85,mvt=JB,gvt=2*JB;function BDe(t){t.vertex.code.add(S`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${S.int(Qn.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${S.int(Qn.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${S.int(Qn.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${S.int(Qn.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}let QB=class extends qs{constructor(e,i){super(e,"vec4",Yi.Draw,(r,s,n)=>r.setUniform4fv(e,i(s,n)))}},yvt=class extends qs{constructor(e,i){super(e,"int",Yi.Draw,(r,s,n)=>r.setUniform1i(e,i(s,n)))}};var ly;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(ly||(ly={}));const Koe=429496.7296;function _vt(t,e){Joe(t/Koe*.5+.5,e)}function vvt(t,e){switch(e.componentData){case ly.Varying:return bvt(t,e);case ly.Uniform:return wvt(t,e);case ly.COUNT:return;default:e.componentData}}function bvt(t,e){const{vertex:i,fragment:r}=t;i.include(vm),i.uniforms.add(new sy("componentColorTex",n=>n.componentParameters.texture.texture)),t.attributes.add($.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const s=e.output===G.ObjectAndLayerIdColor;s&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(BDe),i.constants.add("elevationScale","float",2*Koe),i.constants.add("stride","float",ue("enable-feature:objectAndLayerId-rendering")?3:2),i.code.add(S`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),i.code.add(S`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${s?S`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:S`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),r.code.add(S`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?S`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function wvt(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new QB("externalColor",n=>n.componentParameters.externalColor)),r.uniforms.add(new yvt("externalColorMixMode",n=>n.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),i.code.add(S`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);const s=e.output===G.ObjectAndLayerIdColor;r.code.add(S`
  void readExternalColor(out vec4 color, out int colorMixMode) {
    color = vExternalColor;
    colorMixMode = externalColorMixMode;
  }

  void outputObjectAndLayerIdColor() {
    ${s?S`fragColor = vec4(0,0,0,0);`:""}
 }
`)}function FO(t,e){switch(e.normalType){case or.Compressed:t.attributes.add($.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(S`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case or.Attribute:t.attributes.add($.NORMAL,"vec3"),t.vertex.code.add(S`vec3 normalModel() {
return normal;
}`);break;case or.ScreenDerivative:t.fragment.code.add(S`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case or.COUNT:case or.Ground:}}var or;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(or||(or={}));function pii(t,e){const i=t.vertex;i.include(vm),t.include(FO,e),i.uniforms.add(new tt("distanceFalloffFactor",r=>r.distanceFalloffFactor)),i.code.add(S`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add(new sy("componentDataTex",r=>r.componentDataTexture)),t.attributes.add($.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentVerticalOffsetFieldOffset","float",2),i.constants.add("componentFieldCount","float",3),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("verticalOffsetScale","float",2*Koe),i.code.add(S`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
      float texSize = float(textureSize(componentDataTex, 0).x);
      float colIndex = mod(fieldIndex, texSize);
      float rowIndex = floor(fieldIndex / texSize);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      vec3 normal;
      vec3 normal2;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
      vec3 normal = normalModel();
      vec3 normal2 = ${e.silhouette?S`decompressNormal(normal2Compressed)`:S`normal`};

      vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
      vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
      float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        normal, normal2,
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),e.legacy?i.code.add(S`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new AB("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),i.code.add(S`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add($.NORMAL2COMPRESSED,"vec2"),i.code.add(S`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(normalize(data.normal + data.normal2));
}`)):i.code.add(S`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(data.normal);
}`),e.legacy?i.code.add(S`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(eoe,e),i.uniforms.add(new xp("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new AB("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Wh("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new Wh("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Wt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new Wt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)),i.code.add(S`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?S`normalize(transformWorldFromModelTL + rotatedModelPosition);`:S`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new fs("transformProjFromView",(r,s)=>s.camera.projectionMatrix)),i.code.add(S`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(S`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function fii(t){return t===ZP.Sketch||t===ZP.Mixed}var ZP,Lge;(function(t){t[t.Solid=0]="Solid",t[t.Sketch=1]="Sketch",t[t.Mixed=2]="Mixed",t[t.COUNT=3]="COUNT"})(ZP||(ZP={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(Lge||(Lge={}));function xvt(t){return t&&t.enabled&&(cvt(t)||lvt(t))&&t.edges!=null}function Tvt(t){return t&&t.enabled&&t.edges||null}function jDe(t,e){return Svt(Tvt(t),e)}function Svt(t,e){if(t==null)return null;const i=t.color!=null?jL(je.toUnitRGBA(t.color)):ri(0,0,0,0),r=mr(t.size),s=mr(t.extensionLength);switch(t.type){case"solid":return Evt({color:i,size:r,extensionLength:s,...e});case"sketch":return Cvt({color:i,size:r,extensionLength:s,...e});default:return}}function Evt(t){return{...Mvt,...t,type:ZP.Solid}}function Cvt(t){return{...Avt,...t,type:ZP.Sketch}}const Mvt={color:ri(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:$h.OPAQUE,hasSlicePlane:!1},Avt={color:ri(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:$h.OPAQUE,hasSlicePlane:!1};function GDe(t,e){const i=t.fragment;switch(i.code.add(S`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case Rs.None:i.code.add(S`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Rs.View:i.code.add(S`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Rs.WindingOrder:i.code.add(S`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case Rs.COUNT:}}var Rs;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(Rs||(Rs={}));let TN=class{constructor(e=!1,i=!0){this.isVerticalRay=e,this.normalRequired=i}};const k4=io();function HDe(t,e,i,r,s,n){if(!t.visible)return;const o=Li(XDe,r,i),a=(c,u,d)=>{n(c,d,u,!1)},l=new TN(!1,e.options.normalRequired);if(t.boundingInfo){bt(t.type===Gs.Mesh);const c=e.tolerance;qDe(t.boundingInfo,i,o,c,s,l,a)}else{const c=t.attributes.get($.POSITION),u=c.indices;YDe(i,o,0,u.length/3,u,c.data,c.stride,s,l,a)}}const Pvt=C();function qDe(t,e,i,r,s,n,o){if(t==null)return;const a=Fvt(i,Pvt);if(G$e(k4,t.bbMin),H$e(k4,t.bbMax),s!=null&&s.applyToAabb(k4),tae(k4,e,a,r)){const{primitiveIndices:l,position:c}=t,u=l?l.length:c.indices.length/3;if(u>kvt){const d=t.getChildren();if(d!==void 0){for(const f of d)qDe(f,e,i,r,s,n,o);return}}$vt(e,i,0,u,c.indices,c.data,c.stride,l,s,n,o)}}const hS=C();function WDe(t,e,i,r,s,n,o,a,l){const{data:c,stride:u}=n;YDe(t,Li(XDe,e,t),i,r,s,c,u,o,a,l)}function ZDe(t,e,i,r,s,n,o,a,l,c=null,u=0){const d=t[0],f=t[1],m=t[2],g=e[0],y=e[1],v=e[2];for(let b=i;b<r;++b){const w=u+(c?c[b]:b),x=3*w,T=o*s[x],E=n[T],M=n[T+1],O=n[T+2],D=o*s[x+1],U=n[D],k=n[D+1],H=n[D+2],V=o*s[x+2],X=U-E,q=k-M,Z=H-O,ye=n[V]-E,L=n[V+1]-M,N=n[V+2]-O,z=y*N-L*v,W=v*ye-N*g,J=g*L-ye*y,ee=X*z+q*W+Z*J;if(Math.abs(ee)<=rae)continue;const ae=d-E,we=f-M,Ie=m-O,Ge=ae*z+we*W+Ie*J;if(ee>0){if(Ge<0||Ge>ee)continue}else if(Ge>0||Ge<ee)continue;const ut=we*Z-q*Ie,ot=Ie*X-Z*ae,at=ae*q-X*we,it=g*ut+y*ot+v*at;if(ee>0){if(it<0||Ge+it>ee)continue}else if(it>0||Ge+it<ee)continue;const st=(ye*ut+L*ot+N*at)/ee;st>=0&&l(st,w,a?eae(X,q,Z,ye,L,N,hS):null)}}function Ovt(t,e,i,r,s,n,o,a,l,c,u,d=null,f=0){const m=t[0],g=t[1],y=t[2],v=e[0],b=e[1],w=e[2];for(let x=i;x<r;++x){const T=f+(d?d[x]:x),E=3*T,M=o*s[E],O=n[M],D=n[M+1],U=n[M+2],k=o*s[E+1],H=n[k],V=n[k+1],X=n[k+2],q=o*s[E+2],Z=n[q],ye=n[q+1],L=n[q+2],N=U-l,z=a/Math.sqrt(O*O+D*D+N*N),W=O+O*z,J=D+D*z,ee=U+N*z,ae=X-l,we=a/Math.sqrt(H*H+V*V+ae*ae),Ie=H+H*we,Ge=V+V*we,ut=X+ae*we,ot=L-l,at=a/Math.sqrt(Z*Z+ye*ye+ot*ot),it=Ie-W,st=Ge-J,li=ut-ee,Y=Z+Z*at-W,ie=ye+ye*at-J,se=L+ot*at-ee,Ae=b*se-ie*w,ce=w*Y-se*v,me=v*ie-Y*b,Me=it*Ae+st*ce+li*me;if(Math.abs(Me)<=rae)continue;const Oe=m-W,be=g-J,xe=y-ee,_e=Oe*Ae+be*ce+xe*me;if(Me>0){if(_e<0||_e>Me)continue}else if(_e>0||_e<Me)continue;const Le=be*li-st*xe,Fe=xe*it-li*Oe,lt=Oe*st-it*be,ct=v*Le+b*Fe+w*lt;if(Me>0){if(ct<0||_e+ct>Me)continue}else if(ct>0||_e+ct<Me)continue;const Vt=(Y*Le+ie*Fe+se*lt)/Me;Vt>=0&&u(Vt,T,c?eae(it,st,li,Y,ie,se,hS):null)}}function $vt(t,e,i,r,s,n,o,a,l,c,u){const d=t[0],f=t[1],m=t[2],g=e[0],y=e[1],v=e[2],{normalRequired:b}=c;for(let w=i;w<r;++w){const x=a[w],T=3*x,E=o*s[T];let M=n[E],O=n[E+1],D=n[E+2];const U=o*s[T+1];let k=n[U],H=n[U+1],V=n[U+2];const X=o*s[T+2];let q=n[X],Z=n[X+1],ye=n[X+2];l!=null&&([M,O,D]=l.applyToVertex(M,O,D,w),[k,H,V]=l.applyToVertex(k,H,V,w),[q,Z,ye]=l.applyToVertex(q,Z,ye,w));const L=k-M,N=H-O,z=V-D,W=q-M,J=Z-O,ee=ye-D,ae=y*ee-J*v,we=v*W-ee*g,Ie=g*J-W*y,Ge=L*ae+N*we+z*Ie;if(Math.abs(Ge)<=rae)continue;const ut=d-M,ot=f-O,at=m-D,it=ut*ae+ot*we+at*Ie;if(Ge>0){if(it<0||it>Ge)continue}else if(it>0||it<Ge)continue;const st=ot*z-N*at,li=at*L-z*ut,Y=ut*N-L*ot,ie=g*st+y*li+v*Y;if(Ge>0){if(ie<0||it+ie>Ge)continue}else if(ie>0||it+ie<Ge)continue;const se=(W*st+J*li+ee*Y)/Ge;se>=0&&u(se,x,b?eae(L,N,z,W,J,ee,hS):null)}}function YDe(t,e,i,r,s,n,o,a,l,c){const u=e,d=Uvt,f=Math.abs(u[0]),m=Math.abs(u[1]),g=Math.abs(u[2]),y=f>=m?f>=g?0:2:m>=g?1:2,v=y,b=u[v]<0?2:1,w=(y+b)%3,x=(y+(3-b))%3,T=u[w]/u[v],E=u[x]/u[v],M=1/u[v],O=Rvt,D=Ivt,U=Lvt,{normalRequired:k}=l;for(let H=i;H<r;++H){const V=3*H,X=o*s[V];pe(d[0],n[X+0],n[X+1],n[X+2]);const q=o*s[V+1];pe(d[1],n[q+0],n[q+1],n[q+2]);const Z=o*s[V+2];pe(d[2],n[Z+0],n[Z+1],n[Z+2]),a&&(ve(d[0],a.applyToVertex(d[0][0],d[0][1],d[0][2],H)),ve(d[1],a.applyToVertex(d[1][0],d[1][1],d[1][2],H)),ve(d[2],a.applyToVertex(d[2][0],d[2][1],d[2][2],H))),Li(O,d[0],t),Li(D,d[1],t),Li(U,d[2],t);const ye=O[w]-T*O[v],L=O[x]-E*O[v],N=D[w]-T*D[v],z=D[x]-E*D[v],W=U[w]-T*U[v],J=U[x]-E*U[v],ee=W*z-J*N,ae=ye*J-L*W,we=N*L-z*ye;if((ee<0||ae<0||we<0)&&(ee>0||ae>0||we>0))continue;const Ie=ee+ae+we;if(Ie===0)continue;const Ge=ee*(M*O[v])+ae*(M*D[v])+we*(M*U[v]);if(Ge*Math.sign(Ie)<0)continue;const ut=Ge/Ie;ut>=0&&c(ut,H,k?Dvt(d):null)}}const Rvt=C(),Ivt=C(),Lvt=C();function eae(t,e,i,r,s,n,o){return pe(KB,t,e,i),pe(ej,r,s,n),mt(o,KB,ej),Ce(o,o),o}function Dvt(t){return Li(KB,t[1],t[0]),Li(ej,t[2],t[0]),mt(hS,KB,ej),Ce(hS,hS),hS}const KB=C(),ej=C();function Nvt(t,e,i){return pe(i,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function Fvt(t,e){return pe(e,1/t[0],1/t[1],1/t[2])}function tae(t,e,i,r){return iae(t,e,i,r,1/0)}function iae(t,e,i,r,s){const n=(t[0]-r-e[0])*i[0],o=(t[3]+r-e[0])*i[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(t[1]-r-e[1])*i[1],u=(t[4]+r-e[1])*i[1];if(l=Math.min(l,Math.max(c,u)),l<0||(a=Math.max(a,Math.min(c,u)),a>l))return!1;const d=(t[2]-r-e[2])*i[2],f=(t[5]+r-e[2])*i[2];return l=Math.min(l,Math.max(d,f)),!(l<0)&&(a=Math.max(a,Math.min(d,f)),!(a>l)&&a<s)}const kvt=1e3,rae=1e-7,XDe=C(),Uvt=[C(),C(),C()];let kO=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.attributes.get($.POSITION).indices.length}write(e,i,r,s,n){rDe(r,this.vertexBufferLayout,e,i,s,n)}};function o8(t,e){switch(e.normalType){case or.Attribute:case or.Compressed:t.include(FO,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new AB("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new xp("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)),t.vertex.code.add(S`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case or.Ground:t.include(LA,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(S`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?S`normalize(vPositionWorldCameraRelative);`:S`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case or.ScreenDerivative:t.vertex.code.add(S`void forwardNormal() {}`);break;default:e.normalType;case or.COUNT:}}let JDe=class extends Hdt{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Kr()}},QDe=class extends qdt{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Kr(),this.toMapSpace=ci()}};const sae={func:xr.LESS},tj={func:xr.ALWAYS},Ty={mask:255},KDe={mask:0},Vvt=t=>({function:{func:xr.NOTEQUAL,ref:t,mask:t},operation:{fail:Cs.KEEP,zFail:Cs.KEEP,zPass:Cs.KEEP}}),zvt=t=>({function:{func:xr.ALWAYS,ref:t,mask:t},operation:{fail:Cs.KEEP,zFail:Cs.KEEP,zPass:Cs.REPLACE}}),Pw={function:{func:xr.ALWAYS,ref:Yc.OutlineVisualElementMask,mask:Yc.OutlineVisualElementMask},operation:{fail:Cs.KEEP,zFail:Cs.KEEP,zPass:Cs.ZERO}},aw={function:{func:xr.ALWAYS,ref:Yc.OutlineVisualElementMask,mask:Yc.OutlineVisualElementMask},operation:{fail:Cs.KEEP,zFail:Cs.KEEP,zPass:Cs.REPLACE}},eNe={function:{func:xr.EQUAL,ref:Yc.OutlineVisualElementMask,mask:Yc.OutlineVisualElementMask},operation:{fail:Cs.KEEP,zFail:Cs.KEEP,zPass:Cs.KEEP}},tNe={function:{func:xr.NOTEQUAL,ref:Yc.OutlineVisualElementMask,mask:Yc.OutlineVisualElementMask},operation:{fail:Cs.KEEP,zFail:Cs.KEEP,zPass:Cs.KEEP}};function iNe({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return t==null&&e==null&&s==null&&(n==null||Uo(n,Nn))&&o==null&&(r==null||r===1)&&(i==null||i===1)}function vii({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:s,emissiveFactor:n,occlusionTexture:o}){return t==null&&e==null&&s==null&&(n==null||Uo(n,Nn))&&o==null&&(r==null||r===1)&&(i==null||i===1||i===0)}const a8=[1,1,.5],nae=[0,.6,.2],Bvt=[0,1,.2];function rNe(t){t.vertex.code.add(S`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let UO=class extends qs{constructor(e,i){super(e,"int",Yi.Pass,(r,s,n)=>r.setUniform1i(e,i(s,n)))}};function sNe(t,e){e.hasSymbolColors?(t.include(BDe),t.attributes.add($.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(S`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new UO("colorMixMode",i=>JLe[i.colorMixMode])),t.vertex.code.add(S`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function lE(t,e){e.hasVertexColors?(t.attributes.add($.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(S`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(S`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(S`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function oae(t){t.code.add(S`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)}function l8(t,e){switch(e.output){case G.Shadow:case G.ShadowHighlight:case G.ShadowExcludeHighlight:case G.ViewshedShadow:t.fragment.include(oae),t.fragment.code.add(S`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`)}}function jvt(t){t.fragment.code.add(S`
    #define discardOrAdjustAlpha(color) { if (color.a < ${S.float(la)}) { discard; } }
  `)}let nNe=class extends qs{constructor(e,i){super(e,"float",Yi.Draw,(r,s,n)=>r.setUniform1f(e,i(s,n)))}};function WM(t,e){oNe(t,e,new tt("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function Gvt(t,e){oNe(t,e,new nNe("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function oNe(t,e,i){const r=t.fragment;switch(e.alphaDiscardMode!==Ir.Mask&&e.alphaDiscardMode!==Ir.MaskBlend||r.uniforms.add(i),e.alphaDiscardMode){case Ir.Blend:return t.include(jvt);case Ir.Opaque:r.code.add(S`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Ir.Mask:r.code.add(S`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Ir.MaskBlend:t.fragment.code.add(S`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function aNe(t,e){const{vertex:i,fragment:r}=t,s=e.hasColorTexture&&e.alphaDiscardMode!==Ir.Opaque;switch(e.output){case G.Depth:Wc(i,e),t.include(gl,e),t.include(Mn,e),t.include(Hf,e),s&&r.uniforms.add(new xt("tex",n=>n.texture)),i.code.add(S`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),t.include(WM,e),r.code.add(S`
          void main(void) {
            discardBySlice(vpos);
            ${s?S`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
          }
        `);break;case G.Shadow:case G.ShadowHighlight:case G.ShadowExcludeHighlight:case G.ViewshedShadow:case G.ObjectAndLayerIdColor:Wc(i,e),t.include(gl,e),t.include(Hf,e),t.include(b_,e),t.include(l8,e),t.include(Mn,e),t.include(aE,e),$6(t),t.varyings.add("depth","float"),s&&r.uniforms.add(new xt("tex",n=>n.texture)),i.code.add(S`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();
}`),t.include(WM,e),r.code.add(S`
          void main(void) {
            discardBySlice(vpos);
            ${s?S`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===G.ObjectAndLayerIdColor?S`outputObjectAndLayerIdColor();`:S`outputDepth(depth);`}
          }
        `);break;case G.Normal:{Wc(i,e),t.include(gl,e),t.include(FO,e),t.include(o8,e),t.include(Hf,e),t.include(b_,e),s&&r.uniforms.add(new xt("tex",o=>o.texture)),e.normalType===or.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const n=e.normalType===or.Attribute||e.normalType===or.Compressed;i.code.add(S`
          void main(void) {
            vpos = getVertexInLocalOriginSpace();

            ${n?S`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:S`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(Mn,e),t.include(WM,e),r.code.add(S`
          void main() {
            discardBySlice(vpos);
            ${s?S`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===or.ScreenDerivative?S`vec3 normal = screenDerivativeNormal(vPositionView);`:S`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case G.Highlight:Wc(i,e),t.include(gl,e),t.include(Hf,e),t.include(b_,e),s&&r.uniforms.add(new xt("tex",n=>n.texture)),i.code.add(S`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),t.include(Mn,e),t.include(WM,e),t.include(Mw,e),r.code.add(S`
          void main() {
            discardBySlice(vpos);
            ${s?S`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function lNe(t,e){const i=t.fragment;e.hasVertexTangents?(t.attributes.add($.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===Rs.WindingOrder?i.code.add(S`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(S`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):i.code.add(S`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==Es.None&&(t.include(Hne,e),i.uniforms.add(e.pbrTextureBindType===Yi.Pass?new xt("normalTexture",r=>r.textureNormal):new sy("normalTexture",r=>r.textureNormal)),e.hasNormalTextureTransform&&(i.uniforms.add(new Hr("scale",r=>r.scale??YG)),i.uniforms.add(new xp("normalTextureTransformMatrix",r=>r.normalTextureTransformMatrix??j2))),i.code.add(S`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;`),e.hasNormalTextureTransform&&i.code.add(S`mat3 normalTextureRotation = mat3(normalTextureTransformMatrix[0][0]/scale[0], normalTextureTransformMatrix[0][1]/scale[1], 0.0,
normalTextureTransformMatrix[1][0]/scale[0], normalTextureTransformMatrix[1][1]/scale[1], 0.0,
0.0, 0.0, 0.0 );
rawNormal.xy = (normalTextureRotation * vec3(rawNormal.x, rawNormal.y, 1.0)).xy;`),i.code.add(S`return tangentSpace * rawNormal;
}`))}let XC=class extends Ue{constructor(e){super(e),this.view=null,this.consumes={required:[]},this.produces="composite-color",this._context=null,this._dirty=!0}initialize(){this.addHandles([te(()=>this.view.ready,e=>{var i;e&&((i=this.view._stage)==null||i.renderer.addRenderNode(this))},pt)])}destroy(){var e,i;(i=(e=this.view._stage)==null?void 0:e.renderer)==null||i.removeRenderNode(this)}render(){throw new B("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view._stage.renderView.renderingContext.gl}acquireOutputFramebuffer(){var r,s,n;const e=(s=(r=this._frameBuffer)==null?void 0:r.getTexture())==null?void 0:s.descriptor,i=this.view._stage.renderer.fboCache.acquire((e==null?void 0:e.width)??640,(e==null?void 0:e.height)??480,this.produces);return(n=i.fbo)==null||n.initializeAndBind(),i}bindRenderTarget(){var e,i;return(i=(e=this._frameBuffer)==null?void 0:e.fbo)==null||i.initializeAndBind(),this._frameBuffer}requestRender(e){var i;e===cr.UPDATE&&((i=this.view._stage)==null||i.renderView.requestRender(e)),this._dirty=!0}resetWebGLState(){var e;this.renderingContext.resetState(),this.renderingContext.bindFramebuffer((e=this._frameBuffer)==null?void 0:e.fbo)}get fboCache(){return this.view._stage.renderer.fboCache}get bindParameters(){return this._context.bindParameters}get renderingContext(){return this.view._stage.renderView.renderingContext}updateAnimation(){return!!this._dirty&&(this._dirty=!1,!0)}doRender(e,i){this._context=i,this._frameBuffer=e.find(({name:r})=>r===this.produces);try{return this.render(e)}finally{this._frameBuffer=null}}};h([p({constructOnly:!0})],XC.prototype,"view",void 0),h([p({constructOnly:!0})],XC.prototype,"consumes",void 0),h([p()],XC.prototype,"produces",void 0),XC=h([I("esri.views.3d.webgl.RenderNode")],XC);const SN=XC,cNe=3e5,ij=5e5;let uNe=class extends qs{constructor(e,i){super(e,"vec2",Yi.Draw,(r,s,n,o)=>r.setUniform2fv(e,i(s,n,o)))}};const g9=4;function hNe(){const t=new Hi,e=t.fragment;t.include(qa);const i=(g9+1)/2,r=1/(2*i*i);return e.include($y),e.uniforms.add(new xt("depthMap",s=>s.depthTexture),new sy("tex",s=>s.colorTexture),new uNe("blurSize",s=>s.blurSize),new tt("projScale",(s,n)=>{const o=Ar(n.camera.eye,n.camera.center);return o>5e4?Math.max(0,s.projScale-(o-5e4)):s.projScale})),e.code.add(S`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${S.float(r)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),t.outputs.add("fragBlur","float"),e.code.add(S`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${S.int(g9)}; r <= ${S.int(g9)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragBlur = b / w_total;
    }
  `),t}const Hvt=Object.freeze(Object.defineProperty({__proto__:null,build:hNe},Symbol.toStringTag,{value:"Module"}));let dNe=class pNe extends Ki{initializeProgram(e){return new er(e.rctx,pNe.shader.get().build(),Pi)}initializePipeline(){return Kt({colorWrite:ui})}};dNe.shader=new qi(Hvt,()=>oe(()=>Promise.resolve().then(()=>E9t),void 0));const qvt="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";let Wvt=class extends Ur{constructor(){super(...arguments),this.projScale=1}},Zvt=class extends Wvt{constructor(){super(...arguments),this.intensity=1}},Yvt=class extends Ur{},Xvt=class extends Yvt{constructor(){super(...arguments),this.blurSize=gt()}};function EN(t){t.fragment.uniforms.add(new ji("projInfo",(e,i)=>Jvt(i.camera))),t.fragment.uniforms.add(new Hr("zScale",(e,i)=>Qvt(i.camera))),t.fragment.code.add(S`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function Jvt(t){const e=t.projectionMatrix;return e[11]===0?Ss(Dge,2/(t.fullWidth*e[0]),2/(t.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):Ss(Dge,-2/(t.fullWidth*e[0]),-2/(t.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const Dge=ci();function Qvt(t){return t.projectionMatrix[11]===0?Di(Nge,0,1):Di(Nge,1,0)}const Nge=gt(),Fge=16;function fNe(){const t=new Hi,e=t.fragment;return t.include(qa),t.include(EN),e.include($y),e.uniforms.add(new tt("radius",(i,r)=>c8(r.camera))).code.add(S`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(S`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new xt("normalMap",i=>i.normalTexture),new xt("depthMap",i=>i.depthTexture),new tt("projScale",i=>i.projScale),new xt("rnm",i=>i.noiseTexture),new Hr("rnmScale",(i,r)=>Di(kge,r.camera.fullWidth/i.noiseTexture.descriptor.width,r.camera.fullHeight/i.noiseTexture.descriptor.height)),new tt("intensity",i=>i.intensity),new Hr("screenSize",(i,r)=>Di(kge,r.camera.fullWidth,r.camera.fullHeight))),t.outputs.add("fragOcclusion","float"),e.code.add(S`
    void main(void) {
      float depth = depthFromTexture(depthMap, uv);

      // Early out if depth is out of range, such as in the sky
      if (depth >= 1.0 || depth <= 0.0) {
        fragOcclusion = 1.0;
        return;
      }

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      if(norm4.a != 1.0) {
        fragOcclusion = 1.0;
        return;
      }
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;

      float currentPixelDepth = linearizeDepth(depth);
      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      float sum = 0.0;
      vec3 tapPixelPos;

      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${S.int(Fge)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        // don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap);

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${S.int(Fge)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

      fragOcclusion = A;
    }
  `),t}function c8(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const kge=gt(),Kvt=Object.freeze(Object.defineProperty({__proto__:null,build:fNe,getRadius:c8},Symbol.toStringTag,{value:"Module"}));let mNe=class gNe extends Ki{initializeProgram(e){return new er(e.rctx,gNe.shader.get().build(),Pi)}initializePipeline(){return Kt({colorWrite:ui})}};mNe.shader=new qi(Kvt,()=>oe(()=>Promise.resolve().then(()=>C9t),void 0));const dI=2;let cT=class extends SN{constructor(e){super(e),this.consumes={required:["normals"]},this.produces="ssao",this.isEnabled=()=>!1,this._enableTime=0,this._passParameters=new Zvt,this._drawParameters=new Xvt}initialize(){const e=Uint8Array.from(atob(qvt),r=>r.charCodeAt(0)),i=new es;i.wrapMode=Ai.CLAMP_TO_EDGE,i.pixelFormat=Ht.RGB,i.wrapMode=Ai.REPEAT,i.hasMipmap=!0,i.width=32,i.height=32,this._passParameters.noiseTexture=new Mr(this.renderingContext,i,e),this._ssaoTechnique=this.techniques.acquire(mNe),this._blurTechnique=this.techniques.acquire(dNe),this.addHandles(te(()=>this.isEnabled(),()=>this._enableTime=0))}destroy(){this._passParameters.noiseTexture=Ut(this._passParameters.noiseTexture),this._blurTechnique.release(),this._ssaoTechnique.release()}render(e){const i=this.bindParameters,r=e.find(({name:E})=>E==="normals"),s=r==null?void 0:r.getTexture(),n=r==null?void 0:r.getTexture(UP),o=this.fboCache,a=i.camera,l=a.fullViewport[2],c=a.fullViewport[3],u=Math.round(l/dI),d=Math.round(c/dI);if(!this._ssaoTechnique.compiled||!this._blurTechnique.compiled)return this._enableTime=performance.now(),this.requestRender(),o.acquire(u,d,"ssao",ls.RED);this._enableTime===0&&(this._enableTime=performance.now());const f=this.renderingContext,m=this.view.qualitySettings.fadeDuration,g=a.relativeElevation,y=Ne((ij-g)/(ij-cNe),0,1),v=m>0?Math.min(m,performance.now()-this._enableTime)/m:1,b=v*y;this._passParameters.normalTexture=s,this._passParameters.depthTexture=n,this._passParameters.projScale=1/a.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*e1t/c8(a)**6*b;const w=o.acquire(l,c,"ssao input",ls.RG);f.unbindTexture(w.fbo.colorTexture),f.bindFramebuffer(w.fbo),f.setViewport(0,0,l,c),f.bindTechnique(this._ssaoTechnique,i,this._passParameters,this._drawParameters),f.screen.draw();const x=o.acquire(u,d,"ssao blur",ls.RED);f.unbindTexture(x.fbo.colorTexture),f.bindFramebuffer(x.fbo),this._drawParameters.colorTexture=w.getTexture(),Di(this._drawParameters.blurSize,0,dI/c),f.bindTechnique(this._blurTechnique,i,this._passParameters,this._drawParameters),f.setViewport(0,0,u,d),f.screen.draw(),w.release();const T=o.acquire(u,d,"ssao",ls.RED);return f.unbindTexture(T.fbo.colorTexture),f.bindFramebuffer(T.fbo),f.setViewport(0,0,l,c),f.setClearColor(1,1,1,0),f.clear(jr.COLOR_BUFFER_BIT),this._drawParameters.colorTexture=x.getTexture(),Di(this._drawParameters.blurSize,dI/l,0),f.bindTechnique(this._blurTechnique,i,this._passParameters,this._drawParameters),f.setViewport(0,0,u,d),f.screen.draw(),f.setViewport4fv(a.fullViewport),x.release(),v<1&&this.requestRender(cr.UPDATE),T}};h([p()],cT.prototype,"consumes",void 0),h([p()],cT.prototype,"produces",void 0),h([p({constructOnly:!0})],cT.prototype,"techniques",void 0),h([p({constructOnly:!0})],cT.prototype,"isEnabled",void 0),cT=h([I("esri.views.3d.webgl-engine.effects.ssao.SSAO")],cT);const e1t=.5;function CN(t,e){const i=t.fragment;e.receiveAmbientOcclusion?(i.uniforms.add(new xt("ssaoTex",(r,s)=>{var n;return(n=s.ssao)==null?void 0:n.getTexture()})),i.constants.add("blurSizePixelsInverse","float",1/dI),i.code.add(S`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):i.code.add(S`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function t1t(t){const e=t.fragment.code;e.add(S`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(S`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(S`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function aae(t,e){const i=t.fragment.code;t.include(hN),e.pbrMode!==Pt.Normal&&e.pbrMode!==Pt.Schematic&&e.pbrMode!==Pt.Simplified&&e.pbrMode!==Pt.TerrainWithWater||(i.add(S`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(S`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==Pt.Normal&&e.pbrMode!==Pt.Schematic||(t.include(t1t),i.add(S`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(S`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(S`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(S`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function i1t(t,e){const i=t.fragment.code;t.include(hN),i.add(S`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),i.add(S`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(S`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(S`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(S`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function MN(t){t.constants.add("ambientBoostFactor","float",ZIe)}function VO(t){t.uniforms.add(new tt("lightingGlobalFactor",(e,i)=>i.lighting.globalFactor))}function E2(t,e){const i=t.fragment;switch(t.include(CN,e),e.pbrMode!==Pt.Disabled&&t.include(aae,e),t.include(Zne,e),t.include(hN),i.code.add(S`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===Pt.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),MN(i),VO(i),q_(i),i.code.add(S`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?S`normalize(vPosWorld)`:S`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),Ry(i),i.code.add(S`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case Pt.Disabled:case Pt.WaterOnIntegratedMesh:case Pt.Water:t.include(xB),i.code.add(S`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case Pt.Normal:case Pt.Schematic:i.code.add(S`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(S`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?i.uniforms.add(new ny("hasFillLights",(r,s)=>s.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(S`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add(new tt("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new tt("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)),i.code.add(S`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(S`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission == vec3(0.0) ? _emission : pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode!==Pt.Schematic||e.hasColorTexture?S`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:S`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case Pt.Simplified:case Pt.TerrainWithWater:t.include(xB),i.code.add(S`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case Pt.COUNT:}}let r1t=class extends qs{constructor(e,i,r){super(e,"mat4",Yi.Draw,(s,n,o,a)=>s.setUniformMatrix4fv(e,i(n,o,a)),r)}},DK=class extends qs{constructor(e,i,r){super(e,"mat4",Yi.Pass,(s,n,o)=>s.setUniformMatrix4fv(e,i(n,o)),r)}},s1t=class extends Ur{constructor(){super(...arguments),this.modelTransformation=Jr}},lae=class extends s1t{constructor(){super(...arguments),this.origin=C()}};function AN(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new DK("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),yNe(t))}function YP(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new r1t("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),yNe(t))}function yNe(t){const e=t.fragment;e.include(oae),e.uniforms.add(new xt("shadowMap",(i,r)=>r.shadowMap.depthTexture),new UO("numCascades",(i,r)=>r.shadowMap.numCascades),new ji("cascadeDistances",(i,r)=>r.shadowMap.cascadeDistances)),e.code.add(S`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMap, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMap);
}`)}function n1t(t,e){e.hasColorTextureTransform?(t.vertex.uniforms.add(new xp("colorTextureTransformMatrix",i=>i.colorTextureTransformMatrix??j2)),t.varyings.add("colorUV","vec2"),t.vertex.code.add(S`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(S`void forwardColorUV(){}`)}function o1t(t,e){e.hasNormalTextureTransform&&e.textureCoordinateType!==Es.None?(t.vertex.uniforms.add(new xp("normalTextureTransformMatrix",i=>i.normalTextureTransformMatrix??j2)),t.varyings.add("normalUV","vec2"),t.vertex.code.add(S`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(S`void forwardNormalUV(){}`)}function a1t(t,e){e.hasEmissionTextureTransform&&e.textureCoordinateType!==Es.None?(t.vertex.uniforms.add(new xp("emissiveTextureTransformMatrix",i=>i.emissiveTextureTransformMatrix??j2)),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(S`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(S`void forwardEmissiveUV(){}`)}function l1t(t,e){e.hasOcclusionTextureTransform&&e.textureCoordinateType!==Es.None?(t.vertex.uniforms.add(new xp("occlusionTextureTransformMatrix",i=>i.occlusionTextureTransformMatrix??j2)),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(S`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(S`void forwardOcclusionUV(){}`)}function c1t(t,e){e.hasMetallicRoughnessTextureTransform&&e.textureCoordinateType!==Es.None?(t.vertex.uniforms.add(new xp("metallicRoughnessTextureTransformMatrix",i=>i.metallicRoughnessTextureTransformMatrix??j2)),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(S`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(S`void forwardMetallicRoughnessUV(){}`)}function cae(t){t.include(Fy),t.code.add(S`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${S.int(Qn.Multiply)}) {
        return allMixed;
      }
      if (mode == ${S.int(Qn.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${S.int(Qn.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${S.int(Qn.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${S.int(Qn.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function _Ne(t){const e=new Hi,{vertex:i,fragment:r,varyings:s}=e;if(Wc(i,t),e.include(dN),s.add("vpos","vec3"),e.include(b_,t),e.include(t3e,t),e.include(HLe,t),e.include(n1t,t),t.output===G.Color){e.include(o1t,t),e.include(a1t,t),e.include(l1t,t),e.include(c1t,t),fm(i,t),e.include(FO,t),e.include(gl,t);const n=t.normalType===or.Attribute||t.normalType===or.Compressed;n&&t.offsetBackfaces&&e.include(rNe),e.include(lNe,t),e.include(o8,t),t.instancedColor&&e.attributes.add($.INSTANCECOLOR,"vec4"),s.add("vPositionLocal","vec3"),e.include(Hf,t),e.include(LO,t),e.include(sNe,t),e.include(lE,t),i.uniforms.add(new ji("externalColor",o=>o.externalColor)),s.add("vcolorExt","vec4"),t.multipassEnabled&&s.add("depth","float"),i.code.add(S`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${S.float(la)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = getVertexInLocalOriginSpace();
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${n?S`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${n&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        forwardColorUV();
        forwardNormalUV();
        forwardEmissiveUV();
        forwardOcclusionUV();
        forwardMetallicRoughnessUV();
      }
    `),e.include(Mn,t),e.include(E2,t),e.include(CN,t),e.include(WM,t),e.include(t.instancedDoublePrecision?AN:YP,t),e.include(Uy,t),fm(r,t),r.uniforms.add(i.uniforms.get("localOrigin"),new Wt("ambient",o=>o.ambient),new Wt("diffuse",o=>o.diffuse),new tt("opacity",o=>o.opacity),new tt("layerOpacity",o=>o.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new xt("tex",o=>o.texture)),e.include(Wne,t),e.include(aae,t),r.include(cae),e.include(GDe,t),MN(r),VO(r),Ry(r),t.transparencyPassType===ft.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),r.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        ${t.hasColorTexture?S`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===or.ScreenDerivative?S`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:S`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===Pt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?S`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?S`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${t.hasNormalTextureTransform?S`normalUV`:"vuv0"});`:S`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?S`normalize(posWorld);`:S`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?S`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===Pt.Normal||t.pbrMode===Pt.Schematic?S`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?S`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:S`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===ft.ColorAlpha?S`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}
      }
    `)}return e.include(aNe,t),e}const u1t=Object.freeze(Object.defineProperty({__proto__:null,build:_Ne},Symbol.toStringTag,{value:"Module"}));let h1t=class extends JDe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Xl(a8),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=Gr.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=qe(0,0,0),this.instancedDoublePrecision=!1,this.normalType=or.Attribute,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=qe(.2,.2,.2),this.diffuse=qe(.8,.8,.8),this.externalColor=ri(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=C(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=w2.Less,this.textureAlphaMode=Ir.Blend,this.textureAlphaCutoff=ZB,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=ir.Occlude,this.isDecoration=!1}},d1t=class extends QDe{constructor(){super(...arguments),this.origin=C(),this.slicePlaneLocalOrigin=this.origin}},uae=class vNe extends Ki{initializeConfiguration(e,i){i.spherical=e.viewingMode===Je.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,i.textureCoordinateType=i.hasColorTexture||i.hasMetallicRoughnessTexture||i.hasEmissionTexture||i.hasOcclusionTexture||i.hasNormalTexture?Es.Default:Es.None,i.objectAndLayerIdColorInstanced=i.instanced}initializeProgram(e){return this._initializeProgram(e,vNe.shader)}_initializeProgram(e,i){return new er(e.rctx,i.get().build(this.configuration),Pi)}_makePipeline(e,i){const r=this.configuration,s=e===ft.NONE,n=e===ft.FrontFace;return Kt({blending:r.output===G.Color&&r.transparent?s?Bu:Q_(e):null,culling:f1t(r)?A6(r.cullFace):null,depthTest:{func:Aw(e,p1t(r.customDepthTest))},depthWrite:(s||n)&&r.writeDepth?Wu:null,drawBuffers:r.output===G.Depth?{buffers:[ho.NONE]}:K_(e),colorWrite:ui,stencilWrite:r.hasOccludees?Ty:null,stencilTest:r.hasOccludees?i?aw:Pw:null,polygonOffset:s||n?null:i8(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};function p1t(t){return t===w2.Lequal?xr.LEQUAL:xr.LESS}function f1t(t){return t.cullFace!==Gr.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}uae.shader=new qi(u1t,()=>oe(()=>Promise.resolve().then(()=>M9t),void 0));let si=class extends Xc{constructor(){super(...arguments),this.output=G.Color,this.alphaDiscardMode=Ir.Opaque,this.doubleSidedMode=Rs.None,this.pbrMode=Pt.Disabled,this.cullFace=Gr.None,this.transparencyPassType=ft.NONE,this.normalType=or.Attribute,this.textureCoordinateType=Es.None,this.customDepthTest=w2.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};h([j({count:G.COUNT})],si.prototype,"output",void 0),h([j({count:Ir.COUNT})],si.prototype,"alphaDiscardMode",void 0),h([j({count:Rs.COUNT})],si.prototype,"doubleSidedMode",void 0),h([j({count:Pt.COUNT})],si.prototype,"pbrMode",void 0),h([j({count:Gr.COUNT})],si.prototype,"cullFace",void 0),h([j({count:ft.COUNT})],si.prototype,"transparencyPassType",void 0),h([j({count:or.COUNT})],si.prototype,"normalType",void 0),h([j({count:Es.COUNT})],si.prototype,"textureCoordinateType",void 0),h([j({count:w2.COUNT})],si.prototype,"customDepthTest",void 0),h([j()],si.prototype,"spherical",void 0),h([j()],si.prototype,"hasVertexColors",void 0),h([j()],si.prototype,"hasSymbolColors",void 0),h([j()],si.prototype,"hasVerticalOffset",void 0),h([j()],si.prototype,"hasSlicePlane",void 0),h([j()],si.prototype,"hasSliceHighlight",void 0),h([j()],si.prototype,"hasColorTexture",void 0),h([j()],si.prototype,"hasMetallicRoughnessTexture",void 0),h([j()],si.prototype,"hasEmissionTexture",void 0),h([j()],si.prototype,"hasOcclusionTexture",void 0),h([j()],si.prototype,"hasNormalTexture",void 0),h([j()],si.prototype,"hasScreenSizePerspective",void 0),h([j()],si.prototype,"hasVertexTangents",void 0),h([j()],si.prototype,"hasOccludees",void 0),h([j()],si.prototype,"multipassEnabled",void 0),h([j()],si.prototype,"hasModelTransformation",void 0),h([j()],si.prototype,"offsetBackfaces",void 0),h([j()],si.prototype,"vvSize",void 0),h([j()],si.prototype,"vvColor",void 0),h([j()],si.prototype,"receiveShadows",void 0),h([j()],si.prototype,"receiveAmbientOcclusion",void 0),h([j()],si.prototype,"textureAlphaPremultiplied",void 0),h([j()],si.prototype,"instanced",void 0),h([j()],si.prototype,"instancedColor",void 0),h([j()],si.prototype,"objectAndLayerIdColorInstanced",void 0),h([j()],si.prototype,"instancedDoublePrecision",void 0),h([j()],si.prototype,"doublePrecisionRequiresObfuscation",void 0),h([j()],si.prototype,"writeDepth",void 0),h([j()],si.prototype,"transparent",void 0),h([j()],si.prototype,"enableOffset",void 0),h([j()],si.prototype,"cullAboveGround",void 0),h([j()],si.prototype,"snowCover",void 0),h([j()],si.prototype,"hasColorTextureTransform",void 0),h([j()],si.prototype,"hasEmissionTextureTransform",void 0),h([j()],si.prototype,"hasNormalTextureTransform",void 0),h([j()],si.prototype,"hasOcclusionTextureTransform",void 0),h([j()],si.prototype,"hasMetallicRoughnessTextureTransform",void 0),h([j({constValue:!1})],si.prototype,"occlusionPass",void 0),h([j({constValue:!0})],si.prototype,"hasVvInstancing",void 0),h([j({constValue:!1})],si.prototype,"useCustomDTRExponentForWater",void 0),h([j({constValue:!1})],si.prototype,"supportsTextureAtlas",void 0),h([j({constValue:!0})],si.prototype,"useFillLights",void 0);function bNe(t){const e=new Hi,{vertex:i,fragment:r,varyings:s}=e;return Wc(i,t),e.include(dN),s.add("vpos","vec3"),e.include(b_,t),e.include(t3e,t),e.include(HLe,t),t.output===G.Color&&(fm(e.vertex,t),e.include(FO,t),e.include(gl,t),t.offsetBackfaces&&e.include(rNe),t.instancedColor&&e.attributes.add($.INSTANCECOLOR,"vec4"),s.add("vNormalWorld","vec3"),s.add("localvpos","vec3"),t.multipassEnabled&&s.add("depth","float"),e.include(Hf,t),e.include(LO,t),e.include(sNe,t),e.include(lE,t),i.uniforms.add(new ji("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),i.code.add(S`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${S.float(la)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = getVertexInLocalOriginSpace();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.multipassEnabled?S`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===G.Color&&(e.include(Mn,t),e.include(E2,t),e.include(CN,t),e.include(WM,t),e.include(t.instancedDoublePrecision?AN:YP,t),e.include(Uy,t),fm(e.fragment,t),q_(r),MN(r),VO(r),r.uniforms.add(i.uniforms.get("localOrigin"),i.uniforms.get("view"),new Wt("ambient",n=>n.ambient),new Wt("diffuse",n=>n.diffuse),new tt("opacity",n=>n.opacity),new tt("layerOpacity",n=>n.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new xt("tex",n=>n.texture)),e.include(Wne,t),e.include(aae,t),r.include(cae),t.transparencyPassType===ft.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),Ry(r),r.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?S`terrainDepthTest(depth);`:""}
        ${t.hasColorTexture?S`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===Pt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?S`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?S`albedo = mix(albedo, vec3(1), 0.9);`:S``}
        ${S`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===Pt.Normal||t.pbrMode===Pt.Schematic?t.spherical?S`vec3 normalGround = normalize(vpos + localOrigin);`:S`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:S``}
        ${t.pbrMode===Pt.Normal||t.pbrMode===Pt.Schematic?S`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?S`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:S`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===ft.ColorAlpha?S`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `)),e.include(aNe,t),e}const m1t=Object.freeze(Object.defineProperty({__proto__:null,build:bNe},Symbol.toStringTag,{value:"Module"}));let wNe=class xNe extends uae{initializeConfiguration(e,i){super.initializeConfiguration(e,i),i.hasMetallicRoughnessTexture=!1,i.hasEmissionTexture=!1,i.hasOcclusionTexture=!1,i.hasNormalTexture=!1,i.hasModelTransformation=!1,i.normalType=or.Attribute,i.doubleSidedMode=Rs.WindingOrder,i.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,xNe.shader)}};wNe.shader=new qi(m1t,()=>oe(()=>Promise.resolve().then(()=>A9t),void 0));let gm=class extends Cw{constructor(e){super(e,_1t),this.supportsEdges=!0,this.produces=new Map([[Pe.OPAQUE_MATERIAL,i=>(k3(i)||IA(i))&&!this.parameters.transparent],[Pe.TRANSPARENT_MATERIAL,i=>(k3(i)||IA(i))&&this.parameters.transparent&&this.parameters.writeDepth],[Pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>(k3(i)||IA(i))&&this.parameters.transparent&&!this.parameters.writeDepth]]),this._configuration=new si,this._vertexBufferLayout=v1t(this.parameters)}isVisibleForOutput(e){return e!==G.Shadow&&e!==G.ShadowExcludeHighlight&&e!==G.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{hasInstancedColor:i,hasVertexColors:r,hasSymbolColors:s,vvColor:n}=e,o=e.colorMixMode==="replace",a=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0,c=i||n||s;return r&&c?o||a:r?o?l:a:c?o||a:o?l:a}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?Gr.None:this.parameters.cullFace,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,e===G.Color&&(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=Rs.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Rs.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Rs.WindingOrder:Rs.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=this.parameters.receiveAmbientOcclusion&&i.ssao!=null,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?Pt.Schematic:Pt.Normal:Pt.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<e8,this._configuration.snowCover=this.hasSnowCover(i),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,i,r,s,n,o){if(this.parameters.verticalOffset!=null){const a=r.camera;pe(_9,i[12],i[13],i[14]);let l=null;switch(r.viewingMode){case Je.Global:l=Ce(Uge,_9);break;case Je.Local:l=ve(Uge,x1t)}let c=0;const u=$e(T1t,_9,a.eye),d=Ve(u),f=de(u,u,1/d);let m=null;this.parameters.screenSizePerspective&&(m=Te(l,f)),c+=YLe(a,d,this.parameters.verticalOffset,m??0,this.parameters.screenSizePerspective),de(l,l,c),ca(y9,l,r.transform.inverseRotation),s=$e(b1t,s,y9),n=$e(w1t,n,y9)}HDe(e,r,s,n,MX(r.verticalOffset),o)}createGLMaterial(e){return new g1t(e)}createBufferWriter(){return new kO(this._vertexBufferLayout)}},g1t=class extends qne{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===G.Color&&(this._updateShadowState(e),this._updateOccludeeState(e));const i=this._material.parameters;this.updateTexture(i.textureId);const r=e.camera.viewInverseTransposeMatrix;return pe(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(i.treeRendering?wNe:uae,e)}},y1t=class extends h1t{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const _1t=new y1t;function v1t(t){const e=Ds().vec3f($.POSITION);return t.normalType===or.Compressed?e.vec2i16($.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f($.NORMAL),t.hasVertexTangents&&e.vec4f($.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f($.UV0),t.hasVertexColors&&e.vec4u8($.COLOR),t.hasSymbolColors&&e.vec4u8($.SYMBOLCOLOR),ue("enable-feature:objectAndLayerId-rendering")&&e.vec4u8($.OBJECTANDLAYERIDCOLOR),e}const b1t=C(),w1t=C(),x1t=qe(0,0,1),Uge=C(),y9=C(),_9=C(),T1t=C(),TNe=new Xoe({});function Uii(t){return t.type==="web-style"?TNe:hae(t.symbolLayers.toArray().map(e=>SNe(t,e)))}function hae(t){let e=0,i=0,r=0,s=!1,n=0;const o=new VDe;for(const a of t)a!=null&&(e+=a.verticesPerFeature,i+=a.verticesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,s=s||a.estimated,++n);return s?new avt(n,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:o}):new ovt(n,{verticesPerFeature:e,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:o})}function Vii(t){const e=hae(t);return e.numComplexities>0&&(e.verticesPerFeature/=e.numComplexities,e.verticesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities),e}const v9={};function SNe(t,e){var s,n;const i=ENe(t,e),r=xvt(e)?2:0;switch(e.type){case"extrude":return new qd({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:r,memory:i});case"fill":if(t.type==="mesh-3d")return new qd({drawCallsPerFeature:r,memory:i});if(e.outline!=null&&e.outline.size>0)return new qd({verticesPerFeature:-12,verticesPerCoordinate:9,memory:i});case"water":return new qd({verticesPerFeature:-6,verticesPerCoordinate:3,memory:i});case"line":return new qd({verticesPerFeature:-6,verticesPerCoordinate:6,memory:i});case"object":return(s=e.resource)!=null&&s.href?new Xoe({verticesPerFeature:100,memory:i}):{...S1t(((n=e.resource)==null?void 0:n.primitive)??Cne),memory:i};case"path":{let o=0,a=0;switch(e.profile){case"circle":o=DDe;break;case"quad":o=4;break;default:return void(e.profile,void 0)}switch(e.join){case"round":a=LDe;break;case"miter":case"bevel":a=1;break;default:return}const l=2*o,c=o*a*2,u=c+l;let d=-2*c-l;switch(e.cap){case"none":break;case"butt":case"square":d+=2*(o-1);break;case"round":d+=2*(o*(LK-1)*2+o);break;default:return}return new qd({verticesPerFeature:d,verticesPerCoordinate:u,memory:i})}case"text":case"icon":return new qd({verticesPerFeature:6,memory:i});default:return}}function ENe(t,e){const i=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?fc.EXTRUDE_EDGES:fc.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?fc.FILL_OUTLINE:fc.FILL;case"water":return fc.FILL;case"line":return e.join==="round"?fc.LINE_ROUND:fc.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return fc.PATH_ROUND_CIRCLE;case"quad":return fc.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return fc.PATH_MITER_CIRCLE;case"quad":return fc.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return i?fc.OBJECT_POINT:fc.OBJECT_POLYGON;case"icon":case"text":return i?fc.ICON_POINT:fc.ICON_POLYGON;default:return}}function S1t(t){const e=v9[t];if(e)return e;const i=CNe(UDe(t,new gm({})).levels);return v9[t]=new qd({verticesPerFeature:i}),v9[t]}function CNe(t){return t.reduce((e,i,r)=>e+i.numVertices*(1/10**r),0)/t.reduce((e,i,r)=>e+1/10**r,0)}const fc={ICON_POINT:{bytesPerFeature:2379.8272296852992,bytesPerFeatureLabel:852.246235,resourceBytes:0,draped:{bytesPerFeature:1868.2382921559424,bytesPerFeatureLabel:839.205415}},ICON_POLYGON:{bytesPerFeature:2957.8429876524656,bytesPerFeatureLabel:862.5307816666666,resourceBytes:0,draped:{bytesPerFeature:2579.7767085451133,bytesPerFeatureLabel:856.9298550000001}},OBJECT_POINT:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999,resourceBytes:0,draped:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999}},OBJECT_POLYGON:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998,resourceBytes:0,draped:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998}},LINE_MITER:{bytesPerFeature:3081.208408220661,bytesPerFeatureLabel:858.6749016666668,resourceBytes:0,draped:{bytesPerFeature:2682.57863388475,bytesPerFeatureLabel:844.6118016666666}},LINE_ROUND:{bytesPerFeature:3209.3236242927915,bytesPerFeatureLabel:858.1810416666667,resourceBytes:0,draped:{bytesPerFeature:2687.6256038096126,bytesPerFeatureLabel:849.578535}},PATH_MITER_CIRCLE:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415,resourceBytes:0,draped:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415}},PATH_ROUND_CIRCLE:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001,resourceBytes:0,draped:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001}},PATH_MITER_QUAD:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355,resourceBytes:0,draped:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355}},PATH_ROUND_QUAD:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955,resourceBytes:0,draped:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955}},FILL:{bytesPerFeature:3147.43349219103,bytesPerFeatureLabel:850.7598550000001,resourceBytes:0,draped:{bytesPerFeature:2673.7898488975106,bytesPerFeatureLabel:846.6459950000002}},FILL_OUTLINE:{bytesPerFeature:4565.099993465867,bytesPerFeatureLabel:855.334515,resourceBytes:0,draped:{bytesPerFeature:3904.46969705314,bytesPerFeatureLabel:844.7081016666667}},EXTRUDE:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333,resourceBytes:0,draped:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333}},EXTRUDE_EDGES:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335,resourceBytes:0,draped:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335}}};var mn;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(mn||(mn={}));let dae=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=Ph.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,i){return this._loadStatus===Ph.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===Ph.FAILED?(i&&i(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Ph.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=Ph.FAILED,!us(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(e,i).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=oc(this._abortController):this._loadStatus===Ph.LOADING&&(this._loadStatus=Ph.FAILED),this._loader=null}};var Ph;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(Ph||(Ph={}));const Rv=()=>ne.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let zy=class extends dae{constructor(e,i,r,s){super(r.schedule),this.symbol=e,this.symbolLayer=i,this._context=r,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this._materials=[],this.usedMemory=0,this.logger=Rv(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new XB,this.complexity=this.computeComplexity(),this.ignoreDrivers=s.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=Vge(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const i=this._drivenProperties,r=Vge(e);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,i,r,s){const n=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${s} geometry failed to be created`;n?!this._logGeometryValidationWarnings(i,r,s)&&o&&o.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&Rv().warnOncePerTick(`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):Rv().warnOncePerTick(`${a} (failed to project geometry to view spatial reference)`)}_logGeometryValidationWarnings(e,i,r){const s=`${r} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(Rv().warnOncePerTick(`${s} (no ${i} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(Rv().warnOncePerTick(`${s} (${i} should be defined as a 2D array)`),!0)}_validateGeometry(e,i=null,r=null){if(i!=null&&!i.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;switch(e.type){case"point":{const s=e;if(!isFinite(s.x)||!isFinite(s.y))return Rv().warn("point coordinate is not a valid number, graphic skipped"),!1;break}case"polygon":KJe(e)&&Rv().warnOncePerTick("Fixed a non-closed polygon ring.")}return!0}_defaultElevationInfoNoZ(){return E1t}_defaultElevationInfoZ(){return C1t}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,i=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,i=new XB){const r=e.geometry,s=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,i.mode=this.getGeometryElevationMode(r,s),i.offsetMeters=this._elevationContext.meterUnitOffset??s.offset??0;const n=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";n&&(i.mode="relative-to-ground",i.offsetMeters=0);const o=n?J_t:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(o,e,this._context.layer),i}prepareSymbolLayerPatch(e){}updateGeometry(e,i){return!1}updateTransform(e,i,r,s){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,i=zge){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(e!=null?r*=e.a:i.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(e,i=zge){const r=this._getCombinedOpacity(e,i);if(this._drivenProperties.color)return H3(null,r);const s=e!=null?je.toUnitRGB(e):o_;return H3(s,r)}_getVertexOpacityAndColor(e,i=null){const r=this._drivenProperties.color?e.color:null,s=this._drivenProperties.opacity?e.opacity:null,n=H3(r,s);return i&&(n[0]*=i,n[1]*=i,n[2]*=i,n[3]*=i),n}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return SNe(this.symbol,this.symbolLayer)}globalPropertyChanged(e,i,r){switch(e){case"opacity":return this.layerOpacityChanged(i,r),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,s)!==Hs.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,i,r){let s=Hs.UPDATE;return e.forEach(n=>{const o=i(n);if(o!=null){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else s=Hs.RECREATE}),s}applyRendererDiff(e,i){return mn.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const i=this._fastUpdates.visualVariables,r=i.size?em(i.size.field,e):0,s=i.color?em(i.color.field,e):0,n=i.opacity?em(i.opacity.field,e):0;return ri(r,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&Rv().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var i,r,s,n,o,a,l,c;return{size:((r=(i=this._fastUpdates)==null?void 0:i.visualVariables.size)==null?void 0:r.field)??null,color:((n=(s=this._fastUpdates)==null?void 0:s.visualVariables.color)==null?void 0:n.field)??null,opacity:((a=(o=this._fastUpdates)==null?void 0:o.visualVariables.opacity)==null?void 0:a.field)??null,rotation:((c=(l=this._fastUpdates)==null?void 0:l.visualVariables.rotation)==null?void 0:c.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function Vge(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(i=>{switch(i.type){case"color":if(e.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const s=i.stops[r].color;s&&(e.opacity=!0,s.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const E1t={mode:"on-the-ground",offset:0,unit:"meters"},C1t={mode:"absolute-height",offset:0,unit:"meters"},zge={hasIntrinsicColor:!1};let Ow=class extends mN{get geometries(){return this._geometries}get transformation(){return this._transformation??Jr}set transformation(e){this._transformation=An(this._transformation??ke(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?An(this._shaderTransformation??ke(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(e={}){super(),this.type=Gs.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new MNe),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){bt(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const i=this._geometries.splice(e,1)[0];i&&(this._emit("geometryRemoved",{object:this,geometry:i}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,i,r=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:i,sync:r}),Aut(i)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const i of this._geometries)i.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new RB(R_.MaskOccludee);for(const i of this._geometries)i.occludees=rK(i.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const i of this._geometries)i.occludees=sK(i.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new RB(R_.Highlight);for(const i of this._geometries)i.highlights=rK(i.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const i of this._geometries)i.highlights=sK(i.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,i){return vr(i,this.transformation,e.transformation)}getCombinedShaderTransformation(e,i=ke()){return vr(i,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new Bge,this._validateBoundingVolume(this._bvWorldSpace,q3.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new Bge,this._validateBoundingVolume(this._bvObjectSpace,q3.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,i){const r=i===q3.ObjectSpace;for(const s of this._geometries){const n=s.boundingInfo;n&&M1t(n,e,r?s.transformation:this.getCombinedShaderTransformation(s))}Sr(e.bounds,e.min,e.max,.5);for(const s of this._geometries){const n=s.boundingInfo;if(n==null)continue;const o=r?s.transformation:this.getCombinedShaderTransformation(s),a=CP(o);nt(jge,n.center,o);const l=Ar(jge,e.bounds),c=n.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){var i;const e=(i=this._bvWorldSpace)==null?void 0:i.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,i){this._parentLayer&&this._parentLayer.events.emit(e,i)}get test(){}},MNe=class{constructor(){this.min=qe(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=qe(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},Bge=class extends MNe{constructor(){super(...arguments),this.bounds=_n()}};function M1t(t,e,i){const r=t.bbMin,s=t.bbMax;if(DG(i)){const n=pe(A1t,i[12],i[13],i[14]);Ee(ih,r,n),Ee(Np,s,n);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],ih[o]),e.max[o]=Math.max(e.max[o],Np[o])}else if(nt(ih,r,i),Uo(r,s))for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],ih[n]),e.max[n]=Math.max(e.max[n],ih[n]);else{nt(Np,s,i);for(let n=0;n<3;++n)e.min[n]=Math.min(e.min[n],ih[n],Np[n]),e.max[n]=Math.max(e.max[n],ih[n],Np[n]);for(let n=0;n<3;++n){ve(ih,r),ve(Np,s),ih[n]=s[n],Np[n]=r[n],nt(ih,ih,i),nt(Np,Np,i);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],ih[o],Np[o]),e.max[o]=Math.max(e.max[o],ih[o],Np[o])}}}const A1t=C(),ih=C(),Np=C(),jge=C();var q3;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(q3||(q3={}));function pae(t,e,i,r,s){if(PNe(t,e))return null;i.localOrigin=fae(t,e);const n=new Ow({geometries:[i],castShadow:!1,layerUid:t.layer.uid,graphicUid:s,usesVerticalDistanceToGround:!0});return{object:n,sampledElevation:TDe(n,e,t.elevationProvider,t.renderCoordsHelper,r)}}function ANe(t,e,i,r){return PNe(e,i)?null:TDe(t,i,e.elevationProvider,e.renderCoordsHelper,r)}function PNe(t,e){const i=t.clippingExtent;return!!i&&(xl(e,hb,t.elevationProvider.spatialReference),!xne(i,hb))}function C2(t,e,i){const r=t.elevationContext,s=i.spatialReference;xl(e,hb,s),r.centerPointInElevationSR=_w(hb[0],hb[1],e.hasZ?hb[2]:0,s??null)}function GS(t){switch(t.type){case"point":return t;case"polygon":case"extent":return Zoe(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const i=pMe(e,dse(e)/2);return _w(i[0],i[1],i[2],t.spatialReference)}case"mesh":return t.origin}return null}function fae(t,e){return xl(e,hb,t.renderCoordsHelper.spatialReference),t.localOriginFactory.getOrigin(hb)}const hb=C();function ONe(){return new Float32Array(2)}function P1t(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function Og(t,e){const i=new Float32Array(2);return i[0]=t,i[1]=e,i}function O1t(t,e){return new Float32Array(t,e,2)}function $Ne(){return ONe()}function RNe(){return Og(1,1)}function INe(){return Og(1,0)}function LNe(){return Og(0,1)}const DNe=$Ne(),NNe=RNe(),$1t=INe(),R1t=LNe();Object.freeze(Object.defineProperty({__proto__:null,ONES:NNe,UNIT_X:$1t,UNIT_Y:R1t,ZEROS:DNe,clone:P1t,create:ONe,createView:O1t,fromValues:Og,ones:RNe,unitX:INe,unitY:LNe,zeros:$Ne},Symbol.toStringTag,{value:"Module"}));function FNe(t){const e=new Hi,{vertex:i,fragment:r}=e;return i.include(Q6),e.include(ZLe,t),e.include(Mn,t),e.attributes.add($.UV0,"vec2"),i.uniforms.add(new ji("viewport",(s,n)=>n.camera.fullViewport),new tt("lineSize",(s,n)=>s.size>0?Math.max(1,s.size)*n.camera.pixelRatio:0),new Hr("pixelToNDC",(s,n)=>Di(Hge,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new tt("borderSize",(s,n)=>s.borderColor!=null?n.camera.pixelRatio:0),new Hr("screenOffset",(s,n)=>Di(Hge,s.horizontalScreenOffset*n.camera.pixelRatio,0))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.multipassEnabled&&e.varyings.add("depth","float"),t.occlusionTestEnabled&&e.include(cDe),t.hasScreenSizePerspective&&J6(i),i.code.add(S`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?S`
      if (!testHUDVisibility(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?S`
      vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:S`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.multipassEnabled?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?S`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:S`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?S`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:S`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),r.uniforms.add(new ji("uColor",s=>Gge(s.color)),new ji("borderColor",s=>Gge(s.borderColor))),t.multipassEnabled&&(r.include(vdt,t),r.uniforms.add(new Hr("inverseViewport",(s,n)=>n.inverseViewport))),r.code.add(S`
    void main() {
      ${t.multipassEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?S`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:S`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function Gge(t){return t??jh}const Hge=gt(),I1t=Object.freeze(Object.defineProperty({__proto__:null,build:FNe},Symbol.toStringTag,{value:"Module"}));let kNe=class UNe extends Ki{initializeConfiguration(e,i){i.spherical=e.viewingMode===Je.Global}initializeProgram(e){return new er(e.rctx,UNe.shader.get().build(this.configuration),Pi)}setPipelineState(e){const i=e?xr.ALWAYS:xr.LESS;return this.configuration.depthHudEnabled?Kt({depthTest:{func:i},depthWrite:Wu}):Kt({blending:_a(Be.ONE,Be.SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),depthTest:{func:i},colorWrite:ui})}initializePipeline(){return this.setPipelineState(this.configuration.multipassEnabled)}};kNe.shader=new qi(I1t,()=>oe(()=>Promise.resolve().then(()=>P9t),void 0));let Md=class extends Xc{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.multipassEnabled=!1}};h([j()],Md.prototype,"screenCenterOffsetUnitsEnabled",void 0),h([j()],Md.prototype,"spherical",void 0),h([j()],Md.prototype,"occlusionTestEnabled",void 0),h([j()],Md.prototype,"hasVerticalOffset",void 0),h([j()],Md.prototype,"hasScreenSizePerspective",void 0),h([j()],Md.prototype,"depthHudEnabled",void 0),h([j()],Md.prototype,"depthHudAlignStartEnabled",void 0),h([j()],Md.prototype,"hasSlicePlane",void 0),h([j()],Md.prototype,"multipassEnabled",void 0),h([j({constValue:!0})],Md.prototype,"hasSliceInVertexProgram",void 0),h([j({constValue:!1})],Md.prototype,"draped",void 0);let U4=class NK extends Cw{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new VNe),this.produces=new Map([[Pe.LINE_CALLOUTS,i=>i===G.Color],[Pe.LINE_CALLOUTS_HUD_DEPTH,i=>i===G.Color]]),this._configuration=new Md,this._uniqueMaterialIdentifier=NK.uniqueMaterialIdentifier(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,i){const r=(i==null?void 0:i.slot)!==Pe.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.depthHudEnabled=r,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration}intersect(){}createGLMaterial(e){return new L1t(e)}createBufferWriter(){return new N1t}validateParameters(e){const i=NK.uniqueMaterialIdentifier(e);i!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=i)}static uniqueMaterialIdentifier({renderOccluded:e,isDecoration:i,horizontalScreenOffset:r,color:s,size:n,occlusionTest:o,shaderPolygonOffset:a,depthHUDAlignStart:l,centerOffsetUnits:c,hasSlicePlane:u,screenSizePerspective:d,verticalOffset:f,borderColor:m}){return U9e`${e}:${i}:${r}:[${s}]:${n}:${o}:${a}:${l}:${c}:${u}:${d!=null}:{${f.screenLength}:${f.minWorldLength}:${f.maxWorldLength}}:[${m}]`}},L1t=class extends Sw{beginSlot(e){return this.ensureTechnique(kNe,e)}},VNe=class extends Uoe{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const D1t=Ds().vec3f($.POSITION).vec3f($.NORMAL).vec2f($.UV0).vec4f($.CENTEROFFSETANDDISTANCE),qge=[Og(0,0),Og(1,0),Og(0,1),Og(1,0),Og(1,1),Og(0,1)];let N1t=class{constructor(){this.vertexBufferLayout=D1t}elementCount(e){return 6*e.attributes.get($.POSITION).indices.length}write(e,i,r,s,n){Voe(r.attributes.get($.POSITION),e,s.position,n,6),zoe(r.attributes.get($.NORMAL),i,s.normal,n,6),qP(r.attributes.get($.CENTEROFFSETANDDISTANCE),s.centerOffsetAndDistance,n,6);for(let o=0;o<qge.length;++o)s.uv0.setVec(n+o,qge[o])}},zNe=class BNe extends zy{constructor(e,i){super(e,null,i,U1t),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new U4(this._materialParameters),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){const i=this._materialParameters;return i.horizontalScreenOffset=e.horizontalScreenOffset??0,i.centerOffsetUnits=e.centerOffsetUnits||"world",i}get _materialParameters(){var o;const e=new VNe,i=this.symbol,r=i.callout;if(e.color=r.color!=null?je.toUnitRGBA(r.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=mr(r.size||0),i.verticalOffset){const{screenLength:a,minWorldLength:l,maxWorldLength:c}=i.verticalOffset;e.verticalOffset={screenLength:mr(a),minWorldLength:l||0,maxWorldLength:c??1/0}}e.borderColor=((o=r.border)==null?void 0:o.color)!=null?je.toUnitRGBA(r.border.color):null;const s=i.symbolLayers.at(0).type==="object",n=i.type==="label-3d";return e.occlusionTest=!s,e.shaderPolygonOffset=s?0:void 0,e.depthHUDAlignStart=n,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return k1t}createGraphics3DGraphic(e){const i=e.renderingInfo,r=e.graphic,s=this.setGraphicElevationContext(r,new XB,i.elevationOffset||0),n=i.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!sRe(l)))return null;const a=Zoe(r.geometry);return a==null?null:this._createAs3DShape(a,s,i,r.uid)}layerOpacityChanged(){var e;(e=this._materials[0])==null||e.setParameters(this._materialParameters)}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=wN(BNe.elevationModeChangeTypes,r,s);return n!==Hs.UPDATE||e.forEach(o=>{const a=i(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,i,r=0){return super.setGraphicElevationContext(e,i),i.addOffsetRenderUnits(r),i}updateGraphicElevationContext(e,i){this.setGraphicElevationContext(e,i.elevationContext,i.metadata!=null?i.metadata.elevationOffset:0),i.needsElevationUpdates=_p(i.elevationContext.mode)}computeComplexity(){return new qd({verticesPerFeature:6})}_getOrCreateMaterial(e){var s;const i=this._perInstanceMaterialParameters(e),r=U4.uniqueMaterialIdentifier(i);if(r===((s=this._materials[0])==null?void 0:s.uniqueMaterialIdentifier))return{material:this._materials[0],isUnique:!1};if(e.materialCollection!=null){let n=e.materialCollection.get(r);return n==null&&(n=new U4(i),e.materialCollection.add(r,n)),{material:n,isUnique:!1}}return{material:new U4(i),isUnique:!0}}_createAs3DShape(e,i,r,s){const n=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:n}),a=this._getOrCreateMaterial(r),l=new Pn(a.material,F1t(r),null,Gs.Point,o),c=pae(this._context,e,l,i,s);if(c==null)return null;const u=new Vy(this,c.object,[l],a.isUnique?[a.material]:null,null,jS,i);return u.metadata=new IDe(r.elevationOffset),u.alignedSampledElevation=c.sampledElevation,u.needsElevationUpdates=_p(i.mode),C2(u,e,this._context.elevationProvider),u}};function F1t(t){const{translation:e,centerOffset:i}=t,r=new ht(e?[e[0],e[1],e[2]]:[0,0,0],b9,3,!0),s=new ht(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],b9,4,!0);return[[$.POSITION,r],[$.NORMAL,new ht([0,0,1],b9,3,!0)],[$.CENTEROFFSETANDDISTANCE,s]]}zNe.elevationModeChangeTypes={definedChanged:Hs.UPDATE,staysOnTheGround:Hs.UPDATE,onTheGroundChanged:Hs.RECREATE};const b9=[0],k1t={mode:"relative-to-ground",offset:0},U1t={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let V1t=class{constructor(e,i,r=C(),s=ci(),n=0,o="world",a=0,l=null){this.renderer=e,this.symbol=i,this.translation=r,this.centerOffset=s,this.horizontalScreenOffset=n,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},z1t=class extends Q_t{};const Wge=()=>ne.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function B1t(t,e){if(!One(t))return Wge().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const i=j1t[t.callout.type];return i?new i(t,e):(Wge().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const j1t={line:zNe};function Qii(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance,1,1]:[1,1,1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax,t.extent.zmin??0,t.extent.mmin??0]:[0,0,0,0]}:null}function G1t(t){return t.originPosition==="lowerLeft"&&t.scale.length===4&&t.translate.length===4}function PN(t){if(G1t(t))return t;const{originPosition:e,scale:i,translate:r}=t,s=i[0]??1,n=i[1]??1;return{originPosition:"lowerLeft",scale:[s,e==="lowerLeft"?n:-n,i[2]??1,i[3]??1],translate:[r[0]??0,r[1]??0,r[2]??0,r[3]??0]}}function H1t({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function q1t({scale:t,translate:e},i){return Math.round((i-e[1])/t[1])}function W1t({scale:t,translate:e},i){return Math.round(((i??0)-e[2])/t[2])}function Z1t({scale:t,translate:e},i){return i?Math.round((i-e[3])/t[3]):0}function ON({scale:t,translate:e},i){return i*t[0]+e[0]}function $N({scale:t,translate:e},i){return i*t[1]+e[1]}function aD({scale:t,translate:e},i){return(i??0)*t[2]+e[2]}function lD({scale:t,translate:e},i){return i?i*t[3]+e[3]:0}function mae(t,e){return t&&e?Q1t:t&&!e?X1t:!t&&e?J1t:Y1t}const Y1t=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=ON(t,r[0]),n=$N(t,r[1]);i[0]=[s,n];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let u=1;u<e.length;u++){const[d,f]=e[u];s+=l*d,n+=c*f,i[u]=[s,n]}return i},X1t=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=ON(t,r[0]),n=$N(t,r[1]);i[0]=[s,n,aD(t,r[2])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let u=1;u<e.length;u++){const[d,f,m]=e[u];s+=l*d,n+=c*f,i[u]=[s,n,aD(t,m)]}return i},J1t=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=ON(t,r[0]),n=$N(t,r[1]);i[0]=[s,n,lD(t,r[2])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let u=1;u<e.length;u++){const[d,f,m]=e[u];s+=l*d,n+=c*f,i[u]=[s,n,lD(t,m)]}return i},Q1t=(t,e)=>{const i=new Array(e.length);if(!e.length)return i;const r=e[0];let s=ON(t,r[0]),n=$N(t,r[1]);i[0]=[s,n,aD(t,r[2]),lD(t,r[3])];const{scale:o,originPosition:a}=t,l=o[0],c=a==="lowerLeft"?o[1]:-o[1];for(let u=1;u<e.length;u++){const[d,f,m,g]=e[u];s+=l*d,n+=c*f,i[u]=[s,n,aD(t,m),lD(t,g)]}return i};function jNe(t,e,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=e(t,i[s]);return r}function Kii(t,e,i){const r=PN(t);return e.x=H1t(r,i.x),e.y=q1t(r,i.y),i.z!=null&&(e.z=W1t(r,i.z)),i.m!=null&&(e.m=Z1t(r,i.m)),e}function GNe(t,e,i,r=(i==null?void 0:i.hasZ)??!1,s=(i==null?void 0:i.hasM)??!1){if(i!=null){const n=PN(t);e.points=mae(r,s)(n,i.points),e.hasZ=r,e.hasM=s}return e}function HNe(t,e,i,r=(i==null?void 0:i.z)!=null,s=(i==null?void 0:i.m)!=null){if(i==null)return e;const n=PN(t);return e.x=ON(n,i.x),e.y=$N(n,i.y),r&&(e.z=aD(n,i.z)),s&&(e.m=lD(n,i.m)),e}function qNe(t,e,i,r=(i==null?void 0:i.hasZ)??!1,s=(i==null?void 0:i.hasM)??!1){if(i!=null){const n=PN(t);e.rings=jNe(n,mae(r,s),i.rings),e.hasZ=r,e.hasM=s}return e}function WNe(t,e,i,r=(i==null?void 0:i.hasZ)??!1,s=(i==null?void 0:i.hasM)??!1){if(i!=null){const n=PN(t);e.paths=jNe(n,mae(r,s),i.paths),e.hasZ=r,e.hasM=s}return e}let eri=class{constructor(e,i,r){this.uid=e,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}};function iri(t){return t.geometry!=null}let rri=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function nri(t,e){var u;const i=LMe.fromJSON(t.geometryType),r=Ye.fromJSON(t.spatialReference),s=t.transform,n=t.objectIdFieldName,o=e==null?void 0:e.maxStringAttributeLength,a=e==null?void 0:e.maxStringAttributeFields;let l;const c=t.features.map(d=>{const f=K1t(d,i,r,t.objectIdFieldName),m=f.geometry;if(sbt(f.attributes,a,o,g=>{l??(l=[]);const y=rbt(f,n);y!=null&&l.push({objectId:y,attribute:g})}),m!=null&&s)switch(m.type){case"point":f.geometry=HNe(s,m,m);break;case"multipoint":f.geometry=GNe(s,m,m);break;case"polygon":f.geometry=qNe(s,m,m);break;case"polyline":f.geometry=WNe(s,m,m);break;case"extent":case"mesh":f.geometry=m}return f});return{geometryType:i,features:c,spatialReference:r,fields:((u=t.fields)==null?void 0:u.map(d=>S6.fromJSON(d)))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null,missingAttributes:l}}function K1t(t,e,i,r){return{uid:zh(),objectId:r&&t.attributes?t.attributes[r]:null,attributes:t.attributes,geometry:ebt(t.geometry,e,i),visible:!0}}function ebt(t,e,i){if(t==null)return null;switch(e){case"point":{const r=t;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=t;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=t;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=t;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function tbt(t){if(t==null)return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(t.hasZ?1:0)+(t.hasM?1:0),s=t.type==="polyline"?t.paths:t.rings;for(const n of s)i+=n.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32*(s.length+1);break}case"multipoint":{const i=2+(t.hasZ?1:0)+(t.hasM?1:0),r=t.points.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=Db(t.vertexAttributes.position,t.vertexAttributes.normal,t.vertexAttributes.uv,t.vertexAttributes.tangent)}return e}function ori(t){let e=32;return e+=rSe(t.attributes),e+=3,e+=8+tbt(t.geometry),e}function ari(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const i of t.paths)e+=i.length;return e}case"polygon":{let e=0;for(const i of t.rings)e+=i.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function lri(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function cri(t,e){switch(Qr(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let i=0;i<t.paths.length;i++)iq(e,t.paths[i],!!t.hasZ);break;case"polygon":for(let i=0;i<t.rings.length;i++)iq(e,t.rings[i],!!t.hasZ);break;case"multipoint":iq(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function ibt(t,e){switch(Kh(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let i=0;i<t.paths.length;i++)RH(e,t.paths[i]);break;case"polygon":for(let i=0;i<t.rings.length;i++)RH(e,t.rings[i]);break;case"multipoint":RH(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function rbt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function sbt(t,e,i,r){if(e!=null&&e.size&&i!=null&&t)for(const s in t){if(!e.has(s))continue;const n=t[s];typeof n=="string"&&n.length>i&&(r(s),t[s]="")}}const w9=2;let El=class JC{constructor(e=[],i=[],r=!1){this.lengths=e??[],this.coords=i??[],this.hasIndeterminateRingOrder=r}static fromJSON(e){return new JC(e.lengths,e.coords,e.hasIndeterminateRingOrder)}static fromRect(e){const[i,r,s,n]=e,o=s-i,a=n-r;return new JC([5],[i,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,i)=>e+i)}forEachVertex(e){let i=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let n=0;n<s;n++)e(this.coords[w9*(n+i)],this.coords[w9*(n+i)+1]);i+=s}}deltaDecode(){const e=this.clone(),{coords:i,lengths:r}=e;let s=0;for(const n of r){for(let o=1;o<n;o++)i[2*(s+o)]+=i[2*(s+o)-2],i[2*(s+o)+1]+=i[2*(s+o)-1];s+=n}return e}clone(e){if(this.lengths.length===0)return new JC([],[this.coords[0],this.coords[1]]);const i=(this.lengths.length===0?1:this.lengths.reduce((s,n)=>s+n))*w9,r=this.coords.slice(0,i);return e?(e.set(r),new JC(this.lengths,e,this.hasIndeterminateRingOrder)):new JC(Array.from(this.lengths),Array.from(r),this.hasIndeterminateRingOrder)}},M2=class KU{constructor(e=null,i={},r,s){this.geometry=e,this.attributes=i,this.centroid=r,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}static fromJSON(e,i){const r=e.geometry?El.fromJSON(e.geometry):null,s=e.centroid?El.fromJSON(e.centroid):null,n=e.attributes[i];return new KU(r,e.attributes,s,n)}weakClone(){const e=new KU(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}clone(){var r,s;const e=(r=this.geometry)==null?void 0:r.clone(),i=new KU(e,{...this.attributes},(s=this.centroid)==null?void 0:s.clone(),this.objectId);return i.displayId=this.displayId,i.geohashX=this.geohashX,i.geohashY=this.geohashY,i}};function nbt(t){var e,i;return!!((i=(e=t.geometry)==null?void 0:e.coords)!=null&&i.length)}let ZNe=class YNe{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new YNe;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}};function Cl(t,e){return t?e?4:3:e?3:2}const RN=()=>ne.getLogger("esri.layers.graphics.featureConversionUtils"),XNe={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},obt=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n},Zge=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+2]},abt=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+3]},lbt=(t,e,i,r,s,n)=>{t[i]=s,t[i+1]=n,t[i+2]=e[r+2],t[i+3]=e[r+3]};function gae(t,e,i,r){if(t){if(i)return e&&r?lbt:Zge;if(e&&r)return abt}else if(e&&r)return Zge;return obt}function x9({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function T9({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function S9({scale:t,translate:e},i,r){return i*t[r]+e[r]}function uri(t,e,i){return t?e?i?vae(t):yae(t):i?_ae(t):u8(t):null}function u8(t){const e=t.coords;return{x:e[0],y:e[1]}}function JNe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function yae(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function cbt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function _ae(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function ubt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function vae(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function hbt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function dbt(t,e,i,r){let s=u8;i&&r?s=vae:i?s=yae:r&&(s=_ae);for(const n of e){const{geometry:o,attributes:a}=n,l=o!=null?s(o):null;t.push({attributes:a,geometry:l})}return t}function bae(t,e){return t&&e?hbt:t?cbt:e?ubt:JNe}function pbt(t,e,i,r,s){const n=bae(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?n(new El,o):null;t.push(new M2(l,a,null,s?a[s]:void 0))}return t}function fbt(t,e,i=bae(e.z!=null,e.m!=null)){return i(t,e)}function mbt(t,e,i,r){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?QNe(s,i,r):null});return t}function QNe(t,e,i){if(t==null)return null;const r=Cl(e,i),s=[];for(let n=0;n<t.coords.length;n+=r){const o=[];for(let a=0;a<r;a++)o.push(t.coords[n+a]);s.push(o)}return e?i?{points:s,hasZ:e,hasM:i}:{points:s,hasZ:e}:i?{points:s,hasM:i}:{points:s}}function gbt(t,e,i,r,s){const n=Cl(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?KNe(new El,o,n):null;t.push(new M2(l,a,null,s?a[s]:void 0))}return t}function KNe(t,e,i=Cl(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const r=t.coords;let s=0;for(const n of e.points)for(let o=0;o<i;o++)r[s++]=n[o];return t}function ybt(t,e,i,r){for(const{geometry:s,attributes:n}of e)t.push({attributes:n,geometry:s!=null?eFe(s,i,r):null});return t}function eFe(t,e,i){if(!t)return null;const r=Cl(e,i),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let u=0;u<l;u++){const d=[];for(let f=0;f<r;f++)d.push(s[a++]);c.push(d)}o.push(c)}return e?i?{paths:o,hasZ:e,hasM:i}:{paths:o,hasZ:e}:i?{paths:o,hasM:i}:{paths:o}}function _bt(t,e,i,r,s){const n=Cl(i,r);for(const{geometry:o,attributes:a,centroid:l}of e){const c=o!=null?tFe(new El,o,n):null,u=l!=null?fbt(new El,l):null;t.push(new M2(c,a,u,s?a[s]:void 0))}return t}function tFe(t,e,i=Cl(e.hasZ,e.hasM)){const{lengths:r,coords:s}=t;let n=0;for(const o of e.paths){for(const a of o)for(let l=0;l<i;l++)s[n++]=a[l];r.push(o.length)}return t}function vbt(t,e,i,r){for(const{geometry:s,attributes:n,centroid:o}of e){const a=s!=null?iFe(s,i,r):null;if(o!=null){const l=u8(o);t.push({attributes:n,centroid:l,geometry:a})}else t.push({attributes:n,geometry:a})}return t}function iFe(t,e,i){if(!t)return null;const r=Cl(e,i),{coords:s,lengths:n}=t,o=[];let a=0;for(const l of n){const c=[];for(let u=0;u<l;u++){const d=[];for(let f=0;f<r;f++)d.push(s[a++]);c.push(d)}o.push(c)}return e?i?{rings:o,hasZ:e,hasM:i}:{rings:o,hasZ:e}:i?{rings:o,hasM:i}:{rings:o}}function bbt(t,e,i,r,s){for(const{geometry:n,centroid:o,attributes:a}of e){const l=n!=null?rFe(new El,n,i,r):null,c=s?a[s]:void 0;o!=null?t.push(new M2(l,a,JNe(new El,o),c)):t.push(new M2(l,a,null,c))}return t}function rFe(t,e,i=e.hasZ,r=e.hasM){return wbt(t,e.rings,i,r)}function wbt(t,e,i,r){const s=Cl(i,r),{lengths:n,coords:o}=t;let a=0;w_(t);for(const l of e){for(const c of l)for(let u=0;u<s;u++)o[a++]=c[u];n.push(l.length)}return t}const BA=[],W3=[];function hri(t,e,i,r,s){BA[0]=t;const[n]=sFe(W3,BA,e,i,r,s);return ym(BA),ym(W3),n}function sFe(t,e,i,r,s,n){if(ym(t),!i){for(const o of e){const a=n?o.attributes[n]:void 0;t.push(new M2(null,o.attributes,null,a))}return t}switch(i){case"esriGeometryPoint":return pbt(t,e,r,s,n);case"esriGeometryMultipoint":return gbt(t,e,r,s,n);case"esriGeometryPolyline":return _bt(t,e,r,s,n);case"esriGeometryPolygon":return bbt(t,e,r,s,n);default:RN().error("convertToFeatureSet:unknown-geometry",new B(`Unable to parse unknown geometry type '${i}'`)),ym(t)}return t}function dri(t,e,i,r){W3[0]=t,nFe(BA,W3,e,i,r);const s=BA[0];return ym(BA),ym(W3),s}function xbt(t,e,i){if(t==null)return null;const r=new El;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&i==null&&(i=t.hasM),_P(t)?bae(e??t.z!=null,i??t.m!=null)(r,t):ml(t)?rFe(r,t,e,i):Nf(t)?tFe(r,t,Cl(e,i)):OS(t)?KNe(r,t,Cl(e,i)):void RN().error("convertFromGeometry:unknown-geometry",new B(`Unable to parse unknown geometry type '${t}'`))}function Tbt(t,e,i,r){const s=t&&("coords"in t?t:t.geometry);if(s==null)return null;switch(e){case"esriGeometryPoint":{let n=u8;return i&&r?n=vae:i?n=yae:r&&(n=_ae),n(s)}case"esriGeometryMultipoint":return QNe(s,i,r);case"esriGeometryPolyline":return eFe(s,i,r);case"esriGeometryPolygon":return iFe(s,i,r);default:return RN().error("convertToGeometry:unknown-geometry",new B(`Unable to parse unknown geometry type '${e}'`)),null}}function Sbt(t,e){for(const i of e)t.push({attributes:i.attributes});return t}function nFe(t,e,i,r,s){if(ym(t),i==null)return Sbt(t,e);switch(i){case"esriGeometryPoint":return dbt(t,e,r,s);case"esriGeometryMultipoint":return mbt(t,e,r,s);case"esriGeometryPolyline":return ybt(t,e,r,s);case"esriGeometryPolygon":return vbt(t,e,r,s);default:RN().error("convertToFeatureSet:unknown-geometry",new B(`Unable to parse unknown geometry type '${i}'`))}return t}function pri(t){const{objectIdFieldName:e,spatialReference:i,transform:r,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:d,queryGeometryType:f}=t,m={features:nFe([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:e,spatialReference:i,uniqueIdField:u,queryGeometry:Tbt(d,f,!1,!1)};return r&&(m.transform=r),c&&(m.exceededTransferLimit=c),n&&(m.hasM=n),o&&(m.hasZ=o),m}function fri(t,e){const i=new ZNe,{hasM:r,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:u,fields:d}=t;return d&&(i.fields=d),i.geometryType=l??null,i.objectIdFieldName=o??e??null,i.spatialReference=a??null,i.objectIdFieldName?(n&&sFe(i.features,n,l,s,r,i.objectIdFieldName),c&&(i.exceededTransferLimit=c),r&&(i.hasM=r),s&&(i.hasZ=s),u&&(i.transform=u),i):(RN().error(new B("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function mri(t){const{transform:e,features:i,hasM:r,hasZ:s}=t;if(!e)return t;for(const n of i)n.geometry!=null&&Xge(n.geometry,n.geometry,r,s,e),n.centroid!=null&&Xge(n.centroid,n.centroid,r,s,e);return t.transform=null,t}function gri(t,e){const{geometryType:i,features:r,hasM:s,hasZ:n}=e;if(!t)return e;for(let o=0;o<r.length;o++){const a=r[o],l=a.weakClone();l.geometry=new El,Yge(l.geometry,a.geometry,s,n,i,t),a.centroid&&(l.centroid=new El,Yge(l.centroid,a.centroid,s,n,"esriGeometryPoint",t)),r[o]=l}return e.transform=t,e}function Yge(t,e,i,r,s,n,o=i,a=r){if(w_(t),!(e!=null&&e.coords.length))return null;const l=XNe[s],{coords:c,lengths:u}=e,d=Cl(i,r),f=Cl(i&&o,r&&a),m=gae(i,r,o,a);if(!u.length)return m(t.coords,c,0,0,x9(n,c[0]),T9(n,c[1])),w_(t,d,0),t;let g,y,v,b,w=0,x=0,T=x;for(const E of u){if(E<l)continue;let M=0;x=T,v=g=x9(n,c[w]),b=y=T9(n,c[w+1]),m(t.coords,c,x,w,v,b),M++,w+=d,x+=f;for(let O=1;O<E;O++,w+=d)v=x9(n,c[w]),b=T9(n,c[w+1]),v===g&&b===y||(m(t.coords,c,x,w,v-g,b-y),x+=f,M++,g=v,y=b);M>=l&&(t.lengths.push(M),T=x)}return ym(t.coords,T),t.coords.length?t:null}function yri(t,e,i,r,s,n,o=i,a=r){if(w_(t),!(e!=null&&e.coords.length))return null;const l=XNe[s],{coords:c,lengths:u}=e,d=Cl(i,r),f=Cl(i&&o,r&&a),m=gae(i,r,o,a);if(!u.length)return m(t.coords,c,0,0,c[0],c[1]),w_(t,d,0),t;let g=0;const y=n*n;for(const v of u){if(v<l){g+=v*d;continue}const b=t.coords.length/f,w=g,x=g+(v-1)*d;m(t.coords,c,t.coords.length,w,c[w],c[w+1]),FK(t.coords,c,d,y,m,w,x),m(t.coords,c,t.coords.length,x,c[x],c[x+1]);const T=t.coords.length/f-b;T>=l?t.lengths.push(T):ym(t.coords,b*f),g+=v*d}return t.coords.length?t:null}function Ebt(t,e,i,r){const s=t[e],n=t[e+1],o=t[i],a=t[i+1],l=t[r],c=t[r+1];let u=o,d=a,f=l-u,m=c-d;if(f!==0||m!==0){const g=((s-u)*f+(n-d)*m)/(f*f+m*m);g>1?(u=l,d=c):g>0&&(u+=f*g,d+=m*g)}return f=s-u,m=n-d,f*f+m*m}function FK(t,e,i,r,s,n,o){let a,l=r,c=0;for(let u=n+i;u<o;u+=i)a=Ebt(e,u,n,o),a>l&&(c=u,l=a);l>r&&(c-n>i&&FK(t,e,i,r,s,n,c),s(t,e,t.length,c,e[c],e[c+1]),o-c>i&&FK(t,e,i,r,s,c,o))}function _ri(t,e,i,r){var c;if(!((c=e==null?void 0:e.coords)!=null&&c.length))return null;const s=Cl(i,r);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const u=e.coords;for(let d=0;d<u.length;d+=s){const f=u[d],m=u[d+1];n=Math.min(n,f),a=Math.max(a,f),o=Math.min(o,m),l=Math.max(l,m)}}return hJ(t)?flt(t,n,o,a,l):FG(n,o,a,l,t),t}function Xge(t,e,i,r,s){const{coords:n,lengths:o}=e,a=Cl(i,r);if(!n.length)return t!==e&&w_(t),t;F2(s);const{originPosition:l,scale:c,translate:u}=s,d=Mbt;d.originPosition=l;const f=d.scale;f[0]=c[0]??1,f[1]=-(c[1]??1),f[2]=c[2]??1,f[3]=c[3]??1;const m=d.translate;if(m[0]=u[0]??0,m[1]=u[1]??0,m[2]=u[2]??0,m[3]=u[3]??0,!o.length){for(let y=0;y<a;++y)t.coords[y]=S9(d,n[y],y);return t!==e&&w_(t,a,0),t}let g=0;for(let y=0;y<o.length;y++){const v=o[y];t.lengths[y]=v;for(let x=0;x<a;++x)t.coords[g+x]=S9(d,n[g+x],x);let b=t.coords[g],w=t.coords[g+1];g+=a;for(let x=1;x<v;x++,g+=a){b+=n[g]*f[0],w+=n[g+1]*f[1],t.coords[g]=b,t.coords[g+1]=w;for(let T=2;T<a;++T)t.coords[g+T]=S9(d,n[g+T],T)}}return t!==e&&w_(t,n.length,o.length),t}function vri(t,e,i,r,s,n){if(w_(t),t.lengths.push(...e.lengths),i===s&&r===n)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=Cl(i,r),a=gae(i,r,s,n),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function Cbt(t,e,i,r){let s=0,n=t[r*e],o=t[r*(e+1)];for(let a=1;a<i;a++){const l=n+t[r*(e+a)],c=o+t[r*(e+a)+1],u=(l-n)*(c+o);n=l,o=c,s+=u}return .5*s}function bri(t,e){const{coords:i,lengths:r}=t;let s=0,n=0;for(let o=0;o<r.length;o++){const a=r[o];n+=Cbt(i,s,a,e),s+=a}return Math.abs(n)}function w_(t,e=0,i=0){ym(t.lengths,i),ym(t.coords,e)}function ym(t,e=0){t.length!==e&&(t.length=e)}const Mbt={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},Jge=new ga(Array,t=>v6(t,q$e),null,10,5),Abt=oi();let Pbt=class{get labelLayers(){return this._labelLayers||lHe}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e==null?void 0:e.isElevationSource)}constructor(e,i,r,s,n){this.graphic=e,this.graphics3DSymbol=i,this.layers=r,this._visibleFlags=Fa.ALL_LABEL,this.deconflictionPriority=0,++i.referenced,this._featureExpressionFeature=n?PDe(n,e,s):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(i=>{i.initialize(e),i.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,i){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(i),e.setVisibility(this.isVisible(ko.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(e=!0)}),e}isVisible(e=ko.GRAPHIC,i){const r=i?this._visibleFlags|i|ko.LABEL*i:this._visibleFlags;return e===ko.GRAPHIC?(r&Fa.ALL_GRAPHIC)===Fa.ALL_GRAPHIC:(r&Fa.ALL_LABEL)===Fa.ALL_LABEL}setVisibilityFlag(e,i,r){const s=this.isVisible(e);r?this._visibleFlags|=e*i:this._visibleFlags&=~(e*i);const n=this.isVisible(e);if(s===n)return!1;if(e===ko.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(ko.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,i){return!!(this._visibleFlags&e*i)}computeExtent(e){if(!this._extent){const i=this.graphic.geometry;if(i==null)return!1;this._extent=oi(),ibt(i,this._extent);const r=i.spatialReference;if(!ms(r,e)&&!ZG(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,i){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,i)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,i,r){let s=e.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=cm.fromExtent(s.type==="mesh"?s.extent:s)),xbt(s,i,r)}get usedMemory(){let e=rSe(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>e+=i.graphics3DSymbolLayer.usedMemory),e}computeAttachmentOrigin(){const e={render:{origin:C(),num:0},draped:{origin:gt(),num:0}};for(const i of this.layers)i!=null&&i.computeAttachmentOrigin(e);return e.render.num>1&&de(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&Rh(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,i,r,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?Qr(n.boundingBox):n.boundingBox=Qr(),n.requiresDrapedElevation=!1,await TG(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?i:e,l=Jge.acquire(),c=await o.getProjectedBoundingBox(a,r,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&NP(n.boundingBox,l),Jge.release(l)}),dlt(n.boundingBox)||dY(Tne(n.boundingBox,Abt))?n:null}needsElevationUpdates(){var e;for(const i of this.layers)if(i!=null&&(i.type==="object3d"||i.type==="lod-instance")&&i.needsElevationUpdates)return!0;return((e=this._labelLayers)==null?void 0:e.some(i=>(i==null?void 0:i.needsElevationUpdates)??!1))??!1}alignWithElevation(e,i,r){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(e,i,this._featureExpressionFeature,r)})}alignWithAbsoluteElevation(e,i,r){this._forEachRenderedGraphic(s=>{s.type==="object3d"&&s.alignWithAbsoluteElevation(e,i,r)})}addObjectStateSet(e,i){this._forEachSymbolLayerGraphic(r=>r.addObjectState(e,i))}removeObjectState(e){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(e))}_forEachGraphicList(e,i){e==null||e.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){}},xri=class{constructor(e,i){this.scheduler=e,this.schedule=i,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}},Obt=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};var Qge,Kge,eye,oFe={exports:{}};Qge=oFe,Kge=function(){function t(L,N,z){z=z||2;var W,J,ee,ae,we,Ie,Ge,ut=N&&N.length,ot=ut?N[0]*z:L.length,at=e(L,0,ot,z,!0),it=[];if(!at||at.next===at.prev)return it;if(ut&&(at=l(L,N,at,z)),L.length>80*z){W=ee=L[0],J=ae=L[1];for(var st=z;st<ot;st+=z)(we=L[st])<W&&(W=we),(Ie=L[st+1])<J&&(J=Ie),we>ee&&(ee=we),Ie>ae&&(ae=Ie);Ge=(Ge=Math.max(ee-W,ae-J))!==0?1/Ge:0}return r(at,it,z,W,J,Ge),it}function e(L,N,z,W,J){var ee,ae;if(J===ye(L,N,z,W)>0)for(ee=N;ee<z;ee+=W)ae=X(ee,L[ee],L[ee+1],ae);else for(ee=z-W;ee>=N;ee-=W)ae=X(ee,L[ee],L[ee+1],ae);if(ae&&E(ae,ae.next)){var we=ae.next;q(ae),ae=we}return ae}function i(L,N){if(!L)return L;N||(N=L);var z,W=L;do if(z=!1,W.steiner||!E(W,W.next)&&T(W.prev,W,W.next)!==0)W=W.next;else{var J=W.prev;if(q(W),(W=N=J)===W.next)break;z=!0}while(z||W!==N);return N}function r(L,N,z,W,J,ee,ae){if(L){!ae&&ee&&g(L,W,J,ee);for(var we,Ie,Ge=L;L.prev!==L.next;)if(we=L.prev,Ie=L.next,ee?n(L,W,J,ee):s(L))N.push(we.i/z),N.push(L.i/z),N.push(Ie.i/z),q(L),L=Ie.next,Ge=Ie.next;else if((L=Ie)===Ge){ae?ae===1?r(L=o(i(L),N,z),N,z,W,J,ee,2):ae===2&&a(L,N,z,W,J,ee):r(i(L),N,z,W,J,ee,1);break}}}function s(L){var N=L.prev,z=L,W=L.next;if(T(N,z,W)>=0)return!1;for(var J=L.next.next;J!==L.prev;){if(w(N.x,N.y,z.x,z.y,W.x,W.y,J.x,J.y)&&T(J.prev,J,J.next)>=0)return!1;J=J.next}return!0}function n(L,N,z,W){var J=L.prev,ee=L,ae=L.next;if(T(J,ee,ae)>=0)return!1;for(var we=J.x<ee.x?J.x<ae.x?J.x:ae.x:ee.x<ae.x?ee.x:ae.x,Ie=J.y<ee.y?J.y<ae.y?J.y:ae.y:ee.y<ae.y?ee.y:ae.y,Ge=J.x>ee.x?J.x>ae.x?J.x:ae.x:ee.x>ae.x?ee.x:ae.x,ut=J.y>ee.y?J.y>ae.y?J.y:ae.y:ee.y>ae.y?ee.y:ae.y,ot=v(we,Ie,N,z,W),at=v(Ge,ut,N,z,W),it=L.prevZ,st=L.nextZ;it&&it.z>=ot&&st&&st.z<=at;){if(it!==L.prev&&it!==L.next&&w(J.x,J.y,ee.x,ee.y,ae.x,ae.y,it.x,it.y)&&T(it.prev,it,it.next)>=0||(it=it.prevZ,st!==L.prev&&st!==L.next&&w(J.x,J.y,ee.x,ee.y,ae.x,ae.y,st.x,st.y)&&T(st.prev,st,st.next)>=0))return!1;st=st.nextZ}for(;it&&it.z>=ot;){if(it!==L.prev&&it!==L.next&&w(J.x,J.y,ee.x,ee.y,ae.x,ae.y,it.x,it.y)&&T(it.prev,it,it.next)>=0)return!1;it=it.prevZ}for(;st&&st.z<=at;){if(st!==L.prev&&st!==L.next&&w(J.x,J.y,ee.x,ee.y,ae.x,ae.y,st.x,st.y)&&T(st.prev,st,st.next)>=0)return!1;st=st.nextZ}return!0}function o(L,N,z){var W=L;do{var J=W.prev,ee=W.next.next;!E(J,ee)&&M(J,W,W.next,ee)&&k(J,ee)&&k(ee,J)&&(N.push(J.i/z),N.push(W.i/z),N.push(ee.i/z),q(W),q(W.next),W=L=ee),W=W.next}while(W!==L);return i(W)}function a(L,N,z,W,J,ee){var ae=L;do{for(var we=ae.next.next;we!==ae.prev;){if(ae.i!==we.i&&x(ae,we)){var Ie=V(ae,we);return ae=i(ae,ae.next),Ie=i(Ie,Ie.next),r(ae,N,z,W,J,ee),void r(Ie,N,z,W,J,ee)}we=we.next}ae=ae.next}while(ae!==L)}function l(L,N,z,W){var J,ee,ae,we=[];for(J=0,ee=N.length;J<ee;J++)(ae=e(L,N[J]*W,J<ee-1?N[J+1]*W:L.length,W,!1))===ae.next&&(ae.steiner=!0),we.push(b(ae));for(we.sort(c),J=0;J<we.length;J++)z=i(z=d(we[J],z),z.next);return z}function c(L,N){return L.x-N.x}function u(L){if(L.next.prev===L)return L;let N=L;for(;;){const z=N.next;if(z.prev===N||z===N||z===L)break;N=z}return N}function d(L,N){var z=f(L,N);if(!z)return N;var W=V(z,L),J=i(z,z.next);let ee=u(W);return i(ee,ee.next),J=u(J),u(N===z?J:N)}function f(L,N){var z,W=N,J=L.x,ee=L.y,ae=-1/0;do{if(ee<=W.y&&ee>=W.next.y&&W.next.y!==W.y){var we=W.x+(ee-W.y)*(W.next.x-W.x)/(W.next.y-W.y);if(we<=J&&we>ae){if(ae=we,we===J){if(ee===W.y)return W;if(ee===W.next.y)return W.next}z=W.x<W.next.x?W:W.next}}W=W.next}while(W!==N);if(!z)return null;if(J===ae)return z;var Ie,Ge=z,ut=z.x,ot=z.y,at=1/0;W=z;do J>=W.x&&W.x>=ut&&J!==W.x&&w(ee<ot?J:ae,ee,ut,ot,ee<ot?ae:J,ee,W.x,W.y)&&(Ie=Math.abs(ee-W.y)/(J-W.x),k(W,L)&&(Ie<at||Ie===at&&(W.x>z.x||W.x===z.x&&m(z,W)))&&(z=W,at=Ie)),W=W.next;while(W!==Ge);return z}function m(L,N){return T(L.prev,L,N.prev)<0&&T(N.next,L,L.next)<0}function g(L,N,z,W){var J=L;do J.z===null&&(J.z=v(J.x,J.y,N,z,W)),J.prevZ=J.prev,J.nextZ=J.next,J=J.next;while(J!==L);J.prevZ.nextZ=null,J.prevZ=null,y(J)}function y(L){var N,z,W,J,ee,ae,we,Ie,Ge=1;do{for(z=L,L=null,ee=null,ae=0;z;){for(ae++,W=z,we=0,N=0;N<Ge&&(we++,W=W.nextZ);N++);for(Ie=Ge;we>0||Ie>0&&W;)we!==0&&(Ie===0||!W||z.z<=W.z)?(J=z,z=z.nextZ,we--):(J=W,W=W.nextZ,Ie--),ee?ee.nextZ=J:L=J,J.prevZ=ee,ee=J;z=W}ee.nextZ=null,Ge*=2}while(ae>1);return L}function v(L,N,z,W,J){return(L=1431655765&((L=858993459&((L=252645135&((L=16711935&((L=32767*(L-z)*J)|L<<8))|L<<4))|L<<2))|L<<1))|(N=1431655765&((N=858993459&((N=252645135&((N=16711935&((N=32767*(N-W)*J)|N<<8))|N<<4))|N<<2))|N<<1))<<1}function b(L){var N=L,z=L;do(N.x<z.x||N.x===z.x&&N.y<z.y)&&(z=N),N=N.next;while(N!==L);return z}function w(L,N,z,W,J,ee,ae,we){return(J-ae)*(N-we)-(L-ae)*(ee-we)>=0&&(L-ae)*(W-we)-(z-ae)*(N-we)>=0&&(z-ae)*(ee-we)-(J-ae)*(W-we)>=0}function x(L,N){return L.next.i!==N.i&&L.prev.i!==N.i&&!U(L,N)&&(k(L,N)&&k(N,L)&&H(L,N)&&(T(L.prev,L,N.prev)||T(L,N.prev,N))||E(L,N)&&T(L.prev,L,L.next)>0&&T(N.prev,N,N.next)>0)}function T(L,N,z){return(N.y-L.y)*(z.x-N.x)-(N.x-L.x)*(z.y-N.y)}function E(L,N){return L.x===N.x&&L.y===N.y}function M(L,N,z,W){var J=D(T(L,N,z)),ee=D(T(L,N,W)),ae=D(T(z,W,L)),we=D(T(z,W,N));return J!==ee&&ae!==we||!(J!==0||!O(L,z,N))||!(ee!==0||!O(L,W,N))||!(ae!==0||!O(z,L,W))||!(we!==0||!O(z,N,W))}function O(L,N,z){return N.x<=Math.max(L.x,z.x)&&N.x>=Math.min(L.x,z.x)&&N.y<=Math.max(L.y,z.y)&&N.y>=Math.min(L.y,z.y)}function D(L){return L>0?1:L<0?-1:0}function U(L,N){var z=L;do{if(z.i!==L.i&&z.next.i!==L.i&&z.i!==N.i&&z.next.i!==N.i&&M(z,z.next,L,N))return!0;z=z.next}while(z!==L);return!1}function k(L,N){return T(L.prev,L,L.next)<0?T(L,N,L.next)>=0&&T(L,L.prev,N)>=0:T(L,N,L.prev)<0||T(L,L.next,N)<0}function H(L,N){var z=L,W=!1,J=(L.x+N.x)/2,ee=(L.y+N.y)/2;do z.y>ee!=z.next.y>ee&&z.next.y!==z.y&&J<(z.next.x-z.x)*(ee-z.y)/(z.next.y-z.y)+z.x&&(W=!W),z=z.next;while(z!==L);return W}function V(L,N){var z=new Z(L.i,L.x,L.y),W=new Z(N.i,N.x,N.y),J=L.next,ee=N.prev;return L.next=N,N.prev=L,z.next=J,J.prev=z,W.next=z,z.prev=W,ee.next=W,W.prev=ee,W}function X(L,N,z,W){var J=new Z(L,N,z);return W?(J.next=W.next,J.prev=W,W.next.prev=J,W.next=J):(J.prev=J,J.next=J),J}function q(L){L.next.prev=L.prev,L.prev.next=L.next,L.prevZ&&(L.prevZ.nextZ=L.nextZ),L.nextZ&&(L.nextZ.prevZ=L.prevZ)}function Z(L,N,z){this.i=L,this.x=N,this.y=z,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ye(L,N,z,W){for(var J=0,ee=N,ae=z-W;ee<z;ee+=W)J+=(L[ae]-L[ee])*(L[ee+1]+L[ae+1]),ae=ee;return J}return t.deviation=function(L,N,z,W){var J=N&&N.length,ee=J?N[0]*z:L.length,ae=Math.abs(ye(L,0,ee,z));if(J)for(var we=0,Ie=N.length;we<Ie;we++){var Ge=N[we]*z,ut=we<Ie-1?N[we+1]*z:L.length;ae-=Math.abs(ye(L,Ge,ut,z))}var ot=0;for(we=0;we<W.length;we+=3){var at=W[we]*z,it=W[we+1]*z,st=W[we+2]*z;ot+=Math.abs((L[at]-L[st])*(L[it+1]-L[at+1])-(L[at]-L[it])*(L[st+1]-L[at+1]))}return ae===0&&ot===0?0:Math.abs((ot-ae)/ae)},t.flatten=function(L){for(var N=L[0][0].length,z={vertices:[],holes:[],dimensions:N},W=0,J=0;J<L.length;J++){for(var ee=0;ee<L[J].length;ee++)for(var ae=0;ae<N;ae++)z.vertices.push(L[J][ee][ae]);J>0&&(W+=L[J-1].length,z.holes.push(W))}return z},t},(eye=Kge())!==void 0&&(Qge.exports=eye);const XP=gN(oFe.exports);function $bt(t,e,i){lw(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function lw(t,e,i,r=3,s=r){if(t.length/r!==Math.ceil(e.length/s))return t;const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[4],u=i[5],d=i[6],f=i[8],m=i[9],g=i[10],y=i[12],v=i[13],b=i[14];let w=0,x=0;for(let T=0;T<n;T++){const E=e[w],M=e[w+1],O=e[w+2];t[x]=o*E+c*M+f*O+y,t[x+1]=a*E+u*M+m*O+v,t[x+2]=l*E+d*M+g*O+b,w+=s,x+=r}return t}function aFe(t,e,i){h8(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function h8(t,e,i,r=3,s=r){if(t.length/r!==Math.ceil(e.length/s))return;const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],u=i[4],d=i[5],f=i[6],m=i[7],g=i[8];let y=0,v=0;for(let b=0;b<n;b++){const w=e[y],x=e[y+1],T=e[y+2];t[v]=o*w+c*x+f*T,t[v+1]=a*w+u*x+m*T,t[v+2]=l*w+d*x+g*T,y+=s,v+=r}}function Rbt(t,e,i){rj(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function rj(t,e,i,r=3,s=r){const n=Math.min(t.length/r,e.length/s);let o=0,a=0;for(let l=0;l<n;l++)t[a]=i*e[o],t[a+1]=i*e[o+1],t[a+2]=i*e[o+2],o+=s,a+=r;return t}function Ibt(t,e,i,r=3,s=r){const n=t.length/r;if(n!==Math.ceil(e.length/s))return t;let o=0,a=0;for(let l=0;l<n;l++)t[a]=e[o]+i[0],t[a+1]=e[o+1]+i[1],t[a+2]=e[o+2]+i[2],o+=s,a+=r;return t}function Lbt(t,e){JP(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function JP(t,e,i=3,r=i){const s=Math.min(t.length/i,e.length/r);let n=0,o=0;for(let a=0;a<s;a++){const l=e[n],c=e[n+1],u=e[n+2],d=l*l+c*c+u*u;if(d>0){const f=1/Math.sqrt(d);t[o]=f*l,t[o+1]=f*c,t[o+2]=f*u}n+=r,o+=i}}function Dbt(t,e,i){const r=Math.min(t.count,e.count),s=t.typedBuffer,n=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let u=0;u<r;u++)s[c]=o[l]>>i,s[c+1]=o[l+1]>>i,s[c+2]=o[l+2]>>i,l+=a,c+=n}Object.freeze(Object.defineProperty({__proto__:null,normalize:JP,normalizeView:Lbt,scale:rj,scaleView:Rbt,shiftRight:Dbt,transformMat3:h8,transformMat3View:aFe,transformMat4:lw,transformMat4View:$bt,translate:Ibt},Symbol.toStringTag,{value:"Module"}));function Nbt(t,e,i){return{objectId:t,target:e,distance:i,type:"vertex"}}function tye(t,e,i,r,s,n=!1){return{objectId:t,target:e,distance:i,type:"edge",start:r,end:s,draped:n}}var x_,oa;function ZM(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function cD(t){return t!=null&&!isNaN(t)&&isFinite(t)}function lFe(t){return t.valueExpression?x_.Expression:t.field&&typeof t.field=="string"?x_.Field:x_.Unknown}function Fbt(t,e){const i=e||lFe(t),r=t.valueUnit||"unknown";return i===x_.Unknown?oa.Constant:t.stops?oa.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?oa.ClampedLinear:r==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?oa.Proportional:oa.Additive:oa.Identity:oa.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(x_||(x_={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(oa||(oa={}));const cFe=()=>ne.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),d8=t=>cFe().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${t}`),p8=()=>cFe().error("Use of arcade expressions requires an arcade context"),iye=new ya,eV=Math.PI,uFe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function hFe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="color"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void d8("ColorVariable");const s=typeof e=="number",n=s?null:e,o=n==null?void 0:n.attributes;let a=s?e:null;const l=r.field,{ipData:c,hasExpression:u}=r.cache;let d=r.cache.compiledFunc;if(!l&&!u){const g=r.stops;return g&&g[0]&&g[0].color}if(typeof a!="number")if(u){if((i==null?void 0:i.arcade)==null)return void p8();const g={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},y=i.arcade.arcadeUtils,v=y.getViewInfo(g),b=y.createExecContext(n,v,i.timeZone);if(!d){const w=y.createSyntaxTree(r.valueExpression);d=y.createFunction(w),r.cache.compiledFunc=d}a=y.executeFunction(d,b)}else o&&(a=o[l]);const f=r.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const g=xae(a,c);if(g){const y=g[0],v=g[1],b=y===v?r.stops[y].color:je.blendColors(r.stops[y].color,r.stops[v].color,g[2],i!=null?i.color:void 0);return new je(b)}}}function dFe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="opacity"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void d8("OpacityVariable");const s=typeof e=="number",n=s?null:e,o=n==null?void 0:n.attributes;let a=s?e:null;const l=r.field,{ipData:c,hasExpression:u}=r.cache;let d=r.cache.compiledFunc;if(!l&&!u){const g=r.stops;return g&&g[0]&&g[0].opacity}if(typeof a!="number")if(u){if((i==null?void 0:i.arcade)==null)return void p8();const g={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},y=i.arcade.arcadeUtils,v=y.getViewInfo(g),b=y.createExecContext(n,v,i.timeZone);if(!d){const w=y.createSyntaxTree(r.valueExpression);d=y.createFunction(w),r.cache.compiledFunc=d}a=y.executeFunction(d,b)}else o&&(a=o[l]);const f=r.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const g=xae(a,c);if(g){const y=g[0],v=g[1];if(y===v)return r.stops[y].opacity;{const b=r.stops[y].opacity;return b+(r.stops[v].opacity-b)*g[2]}}}}function pFe(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(m=>m.type==="rotation"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void d8("RotationVariable");const s=r.axis||"heading",n=s==="heading"&&r.rotationType==="arithmetic"?90:0,o=s==="heading"&&r.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a==null?void 0:a.attributes,c=r.field,{hasExpression:u}=r.cache;let d=r.cache.compiledFunc,f=0;if(!c&&!u)return f;if(u){if((i==null?void 0:i.arcade)==null)return void p8();const m={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},g=i.arcade.arcadeUtils,y=g.getViewInfo(m),v=g.createExecContext(a,y,i.timeZone);if(!d){const b=g.createSyntaxTree(r.valueExpression);d=g.createFunction(b),r.cache.compiledFunc=d}f=g.executeFunction(d,v)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:n+o*f,f}function kbt(t,e,i){const r=typeof e=="number",s=r?null:e,n=s==null?void 0:s.attributes;let o=r?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const u=i!=null?i.scale:void 0,d=i!=null?i.view:void 0;o=u==null||d==="3d"?Ubt(t):u}else if(!r)switch(t.inputValueType){case x_.Expression:{if((i==null?void 0:i.arcade)==null)return void p8();const u={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},d=i.arcade.arcadeUtils,f=d.getViewInfo(u),m=d.createExecContext(s,f,i.timeZone);if(!l){const g=d.createSyntaxTree(t.valueExpression);l=d.createFunction(g),t.cache.compiledFunc=l}o=d.executeFunction(l,m);break}case x_.Field:n&&(o=n[t.field]);break;case x_.Unknown:o=null}if(!cD(o))return null;if(r||!t.normalizationField)return o;const c=n?parseFloat(n[t.normalizationField]):null;return cD(c)&&c!==0?o/c:null}function Ubt(t){let e=null,i=null;const r=t.stops;return r?(e=r[0].value,i=r[r.length-1].value):(e=t.minDataValue||0,i=t.maxDataValue||0),(e+i)/2}function f8(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(n=>n.type==="size"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void d8("SizeVariable");const s=mFe(kbt(r,e,i),r,e,i,r.cache.ipData);return s==null||isNaN(s)?0:s}function ju(t,e,i){return t==null?null:ZM(t)?f8(t,e,i):cD(t)?t:null}function fFe(t,e,i){return cD(i)&&t>i?i:cD(e)&&t<e?e:t}function Vbt(t,e,i,r){return t+((ju(e.minSize,i,r)||e.minDataValue)??0)}function zbt(t,e,i){const r=t.stops;let s=(r==null?void 0:r.length)&&r[0].size;return s==null&&(s=t.minSize),ju(s,e,i)}function Bbt(t,e,i,r){const s=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),n=ju(e.minSize,i,r),o=ju(e.maxSize,i,r),a=r!=null?r.shape:void 0;if(t<=e.minDataValue)return n;if(t>=e.maxDataValue)return o;if(n==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?eV*(n/2)**2:n*n,u=c+s*((l?eV*(o/2)**2:o*o)-c);return l?2*Math.sqrt(u/eV):Math.sqrt(u)}return n+s*(o-n)}function jbt(t,e,i,r){const s=r!=null?r.shape:void 0,n=t/e.minDataValue,o=ju(e.minSize,i,r),a=ju(e.maxSize,i,r);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,fFe(l,o,a)}function Gbt(t,e,i,r,s){var l,c,u;const[n,o,a]=xae(t,s);if(n===o)return ju((l=e.stops)==null?void 0:l[n].size,i,r);{const d=ju((c=e.stops)==null?void 0:c[n].size,i,r);return d+(ju((u=e.stops)==null?void 0:u[o].size,i,r)-d)*a}}function Hbt(t,e,i,r){const s=((r==null?void 0:r.resolution)??1)*jP[e.valueUnit],n=ju(e.minSize,i,r),o=ju(e.maxSize,i,r),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/eV)/s:a==="radius"||a==="distance"?2*t/s:t/s,fFe(l,n,o)}function mFe(t,e,i,r,s){switch(e.transformationType){case oa.Additive:return Vbt(t,e,i,r);case oa.Constant:return zbt(e,i,r);case oa.ClampedLinear:return Bbt(t,e,i,r);case oa.Proportional:return jbt(t,e,i,r);case oa.Stops:return Gbt(t,e,i,r,s);case oa.RealWorldSize:return Hbt(t,e,i,r);case oa.Identity:return t;case oa.Unknown:return null}}function qbt(t,e,i){const{isScaleDriven:r}=t.cache;if(!(r&&i==="3d"||e))return null;const s={scale:e,view:i};let n=ju(t.minSize,iye,s),o=ju(t.maxSize,iye,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function wae(t,e,i){if(!t.visualVariables)return;const r=[],s=[],n=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=hFe(l,e,i);r.push({variable:l,value:c})}),n.forEach(l=>{const c=dFe(l,e,i);r.push({variable:l,value:c})}),a.forEach(l=>{const c=pFe(l,e,i);r.push({variable:l,value:c})}),o.forEach(l=>{const c=f8(l,e,i);r.push({variable:l,value:c})}),r.filter(l=>l.value!=null)}function xae(t,e){if(!e)return;let i=0,r=e.length-1;return e.some((s,n)=>t<s?(r=n,!0):(i=n,!1)),[i,r,(t-e[i])/(e[r]-e[i])]}function Wbt(t,e,i){const r=["proportional","proportional","proportional"];for(const s of t){const n=s.useSymbolValue?"symbol-value":f8(s,e,i);switch(s.axis){case"width":r[0]=n;break;case"depth":r[1]=n;break;case"height":r[2]=n;break;case"width-and-depth":r[0]=n,r[1]=n;break;case"all":case void 0:case null:r[0]=n,r[1]=n,r[2]=n;break;default:s.axis}}return r}const m8=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:Wbt,getColor:hFe,getOpacity:dFe,getRotationAngle:pFe,getSize:f8,getSizeForValue:mFe,getSizeFromNumberOrVariable:ju,getSizeRangeAtScale:qbt,getVisualVariableValues:wae,viewScaleRE:uFe},Symbol.toStringTag,{value:"Module"}));function g8(t,e){if(!t||t.symbol)return null;const i=e==null?void 0:e.renderer;return t&&i!=null&&i.getObservationRenderer?i.getObservationRenderer(t):i}function Zbt(t,e){if(t.symbol!=null)return t.symbol;const i=g8(t,e);return i!=null&&i.type!=="dot-density"?i.getSymbol(t,e):null}function Eri(t,e){const i=g8(t,e),r=Zbt(t,e);if(r==null)return null;const s={renderer:i,symbol:r};if(i==null||!("visualVariables"in i)||!i.visualVariables)return s;const n=wae(i,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=u;break;case"depth":o[1]=u;break;case"height":o[2]=u;break;case"width-and-depth":o[0]=o[1]=u;break;default:o[0]=o[1]=o[2]=u}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function Ybt(t,e){if(t.symbol!=null)return t.symbol;const i=g8(t,e);return i!=null?i.getSymbolAsync(t,e):null}async function Cri(t,e){const i=g8(t,e),r=await Ybt(t,e);if(!r)return null;const s={renderer:i,symbol:r};if(!i||!("visualVariables"in i)||!i.visualVariables)return s;const n=wae(i,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=je.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=u:c==="depth"?o[1]=u:c==="height"?o[2]=u:o[0]=o[1]=c==="width-and-depth"?u:o[2]=u}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function Xbt(t,e=0){const i=t[e];return typeof i=="number"&&isFinite(i)?i:null}function Jbt(t){for(let e=0;e<3;e++){const i=t[e];if(typeof i=="number")return isFinite(i)?i:0}return 0}function gFe(t,e,i){const r=Qbt(rye,t,e,i)?rye:[0,0,1];return Math.abs(r[2])>Math.cos(kt(80))?Ts.Z:Math.abs(r[1])>Math.abs(r[0])?Ts.Y:Ts.X}function Qbt(t,e,i,r){const s=(o=>!Array.isArray(o[0]))(e)?(o,a)=>e[3*o+a]:(o,a)=>e[o][a],n=r?cc(r)/M_(r):1;return Vse(t,(o,a)=>pe(o,s(a,0)*n,s(a,1)*n,s(a,2)),i)}const rye=rr();function Kbt(t,e,i){const r=(e.length>0?e[0]:t.length/3)-1,s=gFe(t,r,i);if(s!==Ts.Z){t=t.slice();for(let n=0;n<t.length;n+=3)t[n+s]=t[n+2]}return XP(t,e,3)}function sye(t){const e=[[$.POSITION,new ht(t.attributeData.position,t.indices,3,!0)]],i=Ew(t.indices.length);return t.attributeData.colorFeature!=null?e.push([$.COLORFEATUREATTRIBUTE,new ht([t.attributeData.colorFeature],i,1,!0)]):t.attributeData.color&&e.push([$.COLOR,new ht(t.attributeData.color,i,4,!0)]),t.attributeData.uvMapSpace&&e.push([$.UVMAPSPACE,new ht(t.attributeData.uvMapSpace,t.indices,4,!0)]),t.attributeData.boundingRect&&e.push([$.BOUNDINGRECT,new ht(t.attributeData.boundingRect,t.indices,9,!0)]),new Pn(t.material,e,t.mapPositions,Gs.Mesh,t.attributeData.objectAndLayerIdColor)}function nye(t,e=null){const i=[[$.POSITION,new ht(t.attributeData.position,t.indices,3,!0)],[$.UV0,new ht(t.attributeData.uv0,t.indices,2,!0)]];return new Pn(t.material,i,t.mapPositions,Gs.Mesh,e)}function uD(t){switch(t.type){case"extent":if(t instanceof dr)return cm.fromExtent(t);break;case"polygon":return t}return null}let y8=class{constructor(e,i,r){this.renderData=e,this.layerUid=i,this.graphicUid=r,this.outGeometries=new Array}};function kK(t,e,i){const r=Array.isArray(t),s=r?t.length/e:t.byteLength/(4*e),n=r?t:new Uint32Array(t,0,s*e),o=(i==null?void 0:i.minReduction)??0,a=(i==null?void 0:i.originalIndices)||null,l=a?a.length:0,c=(i==null?void 0:i.componentOffsets)||null;let u=0;if(c)for(let M=0;M<c.length-1;M++){const O=c[M+1]-c[M];O>u&&(u=O)}else u=s;const d=Math.floor(1.1*u)+1;(Am==null||Am.length<2*d)&&(Am=new Uint32Array(DCe(2*d)));for(let M=0;M<2*d;M++)Am[M]=0;let f=0;const m=!!c&&!!a,g=m?l:s;let y=$B(s);const v=new Uint32Array(l),b=1.96;let w=o!==0?Math.ceil(4*b*b/(o*o)*o*(1-o)):g,x=1,T=c?c[1]:g;for(let M=0;M<g;M++){if(M===w){const V=1-f/M;if(V+b*Math.sqrt(V*(1-V)/M)<o)return null;w*=2}if(M===T){for(let V=0;V<2*d;V++)Am[V]=0;if(a)for(let V=c[x-1];V<c[x];V++)v[V]=y[a[V]];T=c[++x]}const O=m?a[M]:M,D=O*e,U=iwt(n,D,e);let k=U%d,H=f;for(;Am[2*k+1]!==0;){if(Am[2*k]===U){const V=Am[2*k+1]-1;if(ewt(n,D,V*e,e)){H=y[V];break}}k++,k>=d&&(k-=d)}H===f&&(Am[2*k]=U,Am[2*k+1]=O+1,f++),y[O]=H}if(o!==0&&1-f/s<o)return null;if(m){for(let M=c[x-1];M<v.length;M++)v[M]=y[a[M]];y=oy(v)}const E=r?new Array(f):new Uint32Array(f*e);f=0;for(let M=0;M<g;M++)y[M]===f&&(twt(n,(m?a[M]:M)*e,E,f*e,e),f++);if(a&&!m){const M=new Uint32Array(l);for(let O=0;O<M.length;O++)M[O]=y[a[O]];y=oy(M)}return{buffer:Array.isArray(E)?E:E.buffer,indices:y,uniqueCount:f}}function ewt(t,e,i,r){for(let s=0;s<r;s++)if(t[e+s]!==t[i+s])return!1;return!0}function twt(t,e,i,r,s){for(let n=0;n<s;n++)i[r+n]=t[e+n]}function iwt(t,e,i){let r=0;for(let s=0;s<i;s++)r=t[e+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let Am=null;function Ari(t){const e=IN(t.rings,t.hasZ,Sy.CCW_IS_HOLE,t.spatialReference),i=new Array;let r=0,s=0;for(const a of e.polygons){const l=a.count,c=a.index,u=up(e.position,3*c,3*l),d=a.holeIndices.map(m=>m-c),f=oy(XP(u,d,3));i.push({position:u,faces:f}),r+=u.length,s+=f.length}const n=rwt(i,r,s),o=Array.isArray(n.position)?kK(n.position,3,{originalIndices:n.faces}):kK(n.position.buffer,6,{originalIndices:n.faces});return n.position=w3e(new Float64Array(o.buffer)),n.faces=o.indices,n}function rwt(t,e,i){if(t.length===1)return t[0];const r=go(e),s=new Array(i);let n=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)r[n++]=l.position[c];for(const c of l.faces)s[o++]=c+a;a=n/3}return{position:r,faces:oy(s)}}function IN(t,e,i,r){const s=t.length,n=new Array(s),o=new Array(s),a=new Array(s);let l=0;for(let g=0;g<s;++g)l+=t[g].length;let c=0,u=0,d=0;const f=go(3*l);let m=0;for(let g=s-1;g>=0;g--){const y=t[g],v=i===Sy.CCW_IS_HOLE&&swt(y,e,r);if(v&&s!==1)n[c++]=y;else{let b=y.length;for(let x=0;x<c;++x)b+=n[x].length;const w={index:m,pathLengths:new Array(c+1),count:b,holeIndices:new Array(c)};w.pathLengths[0]=y.length,y.length>0&&(a[d++]={index:m,count:y.length}),m=v?V4(y,y.length-1,-1,f,m,y.length,e):V4(y,0,1,f,m,y.length,e);for(let x=0;x<c;++x){const T=n[x];w.holeIndices[x]=m,w.pathLengths[x+1]=T.length,T.length>0&&(a[d++]={index:m,count:T.length}),m=V4(T,0,1,f,m,T.length,e)}c=0,w.count>0&&(o[u++]=w)}}for(let g=0;g<c;++g){const y=n[g];y.length>0&&(a[d++]={index:m,count:y.length}),m=V4(y,0,1,f,m,y.length,e)}return o.length=u,a.length=d,{position:f,polygons:o,outlines:a}}function V4(t,e,i,r,s,n,o){s*=3;for(let a=0;a<n;++a){const l=t[e];r[s++]=l[0],r[s++]=l[1],r[s++]=o?l[2]:0,e+=i}return s/3}function swt(t,e,i){if(!e)return!mR(t);const r=t.length-1;switch(gFe(t,r,i)){case Ts.X:return!mR(t,Ts.Y,Ts.Z);case Ts.Y:return!mR(t,Ts.X,Ts.Z);case Ts.Z:return!mR(t,Ts.X,Ts.Y)}}var Sy;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(Sy||(Sy={}));var Z3,sj,UK;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(Z3||(Z3={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(sj||(sj={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(UK||(UK={}));var In,Jd,Y3,Cn;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(In||(In={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(Jd||(Jd={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(Y3||(Y3={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(Cn||(Cn={}));let nwt=class{constructor(e,i){this.vec3=e,this.id=i}};function nj(t,e,i,r){return new nwt(qe(t,e,i),r)}let oye=class{constructor(){this._extent=oi(),this.resolution=0,this.renderLocalOrigin=nj(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new owt}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const i=.001*e.range;if(this._extent[0]-i<=e.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Yz(this._extent,e.range,0,r)}if(this._extent[2]+i>=e.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Yz(this._extent,-e.range,0,r)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,A_(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const i=this.canvasGeometries.extents[e];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}},owt=class{constructor(){this.extents=[oi(),oi(),oi()],this.numViews=0}};var os;(function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.WaterNormal=3]="WaterNormal",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})(os||(os={}));let awt=class{constructor(e,i,r){this._fbos=e,this._format=i,this._name=r}get valid(){var e;return((e=this._handle)==null?void 0:e.getTexture())!=null}dispose(){this._handle=hi(this._handle)}get texture(){var e;return(e=this._handle)==null?void 0:e.getTexture()}bind(e,i,r){var s,n,o,a,l,c;this._handle&&((s=this._handle.fbo)==null?void 0:s.width)===i&&((n=this._handle.fbo)==null?void 0:n.height)===r||((o=this._handle)==null||o.release(),this._handle=this._fbos.acquire(i,r,this._name,this._format)),e.unbindTexture((l=(a=this._handle)==null?void 0:a.fbo)==null?void 0:l.colorTexture),e.bindFramebuffer((c=this._handle)==null?void 0:c.fbo)}generateMipMap(){var e,i,r,s,n;(r=(i=(e=this._handle)==null?void 0:e.getTexture())==null?void 0:i.descriptor)!=null&&r.hasMipmap&&((n=(s=this._handle)==null?void 0:s.getTexture())==null||n.generateMipmap())}},UE=class{constructor(e,i,r,s,n=ls.RGBA_MIPMAP){this.output=r,this.content=s,this.fbo=new awt(e,n,i)}get valid(){return this.fbo.valid}},lwt=class{constructor(e){this.targets=[new UE(e,"overlay color",G.Color,os.Color),new UE(e,"overlay IM color",G.Color,os.ColorNoRasterImage),new UE(e,"overlay highlight",G.Highlight,os.Highlight,ls.RGBA4),new UE(e,"overlay water",G.Normal,os.WaterNormal),new UE(e,"overlay occluded",G.Color,os.Occluded)],ue("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new UE(e,"overlay oid",G.ObjectAndLayerIdColor,os.ObjectAndLayerIdColor))}getTexture(e){var i;return(i=this.targets[e])==null?void 0:i.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce((e,i,r)=>i.valid?e|=1<<r:e,0)}},_8=class extends JDe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=C(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var Kl;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight",t[t.ViewshedShadowMap=3]="ViewshedShadowMap"})(Kl||(Kl={}));let cwt=class extends _8{constructor(){super(...arguments),this.identifier=Kl.Material,this.output=G.Color,this.transparent=!1}},uwt=class extends _8{constructor(){super(...arguments),this.identifier=Kl.ShadowMap}},hwt=class extends _8{constructor(){super(...arguments),this.identifier=Kl.Highlight}},dwt=class extends _8{constructor(){super(...arguments),this.identifier=Kl.ViewshedShadowMap}};function pwt(t){t.fragment.code.add(S`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function fwt(t){t.fragment.code.add(S`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function mwt(t,e){const i=t.fragment;i.include($y),i.uniforms.add(new Hr("nearFar",(r,s)=>s.camera.nearFar)),i.uniforms.add(new xt("depthMap",(r,s)=>{var n;return(n=s.depth)==null?void 0:n.attachment})),i.uniforms.add(new fs("proj",(r,s)=>s.camera.projectionMatrix)),i.uniforms.add(new tt("invResolutionHeight",(r,s)=>1/s.camera.height)),i.uniforms.add(new fs("reprojectionMatrix",(r,s)=>s.ssr.reprojectionMatrix)),i.code.add(S`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}function yFe(t,e){t.include(i1t,e),t.include(M6),t.include(fwt),e.hasCloudsReflections&&t.include(wIe,e),e.hasScreenSpaceReflections&&t.include(mwt,e);const i=t.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",cNe).add("ssrHeightFadeEnd","float",ij).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(S`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add(new tt("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new tt("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)),i.code.add(S`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&i.code.add(S`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(i.uniforms.add(new fs("view",(r,s)=>s.camera.viewMatrix),new xt("lastFrameColorTexture",(r,s)=>{var n;return(n=s.ssr.lastFrameColor)==null?void 0:n.getTexture()}),new tt("fadeFactorSSR",(r,s)=>s.ssr.fadeFactor)),i.code.add(S`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):i.code.add(S`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?i.code.add(S`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(S`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(S`return waterRenderedColor;
}`)}var Zg;function gwt(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new QB("overlayTexOffset",(s,n)=>ywt(s,n)),new QB("overlayTexScale",(s,n)=>_wt(s,n))),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new xt("ovColorTex",(s,n)=>vFe(s,n))),_Fe(t,e)}function I$(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new aye("overlayTexOffset"),new aye("overlayTexScale")),r.uniforms.add(new tt("overlayOpacity",s=>s.overlayOpacity),new xt("ovColorTex",(s,n)=>{var o;return(o=n.overlay)==null?void 0:o.getTexture(s.overlayContent)})),_Fe(t,e)}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(Zg||(Zg={}));let aye=class extends qs{constructor(e){super(e,"vec4")}};function _Fe(t,e){e.pbrMode!==Pt.Water&&e.pbrMode!==Pt.WaterOnIntegratedMesh&&e.pbrMode!==Pt.TerrainWithWater||t.include(yFe,e);const{vertex:i,fragment:r}=t;t.varyings.add("vtcOverlay","vec4"),i.code.add(S`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),r.code.add(S`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),r.code.add(S`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),r.code.add(S`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.pbrMode!==Pt.Water&&e.pbrMode!==Pt.WaterOnIntegratedMesh&&e.pbrMode!==Pt.TerrainWithWater||(q_(r),Ry(r),r.code.add(S`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function vFe(t,e){var i,r,s;return t.identifier===Kl.Material&&t.output===G.Color?(i=e.overlay)==null?void 0:i.getTexture(os.ColorNoRasterImage):t.identifier===Kl.Material&&t.output===G.ObjectAndLayerIdColor?(r=e.overlay)==null?void 0:r.getTexture(os.ObjectAndLayerIdColor):t.identifier===Kl.Highlight?(s=e.overlay)==null?void 0:s.getTexture(os.Highlight):null}function ywt(t,e){var s,n,o,a;const i=(n=(s=e.overlay)==null?void 0:s.overlays[In.INNER])==null?void 0:n.extent;Zz(i)&&(kg[0]=t.toMapSpace[0]/fl(i)-i[0]/fl(i),kg[1]=t.toMapSpace[1]/Hc(i)-i[1]/Hc(i));const r=(a=(o=e.overlay)==null?void 0:o.overlays[In.OUTER])==null?void 0:a.extent;return Zz(r)&&(kg[2]=t.toMapSpace[0]/fl(r)-r[0]/fl(r),kg[3]=t.toMapSpace[1]/Hc(r)-r[1]/Hc(r)),kg}function _wt(t,e){var s,n,o,a;const i=(n=(s=e.overlay)==null?void 0:s.overlays[In.INNER])==null?void 0:n.extent;Zz(i)&&(kg[0]=t.toMapSpace[2]/fl(i),kg[1]=t.toMapSpace[3]/Hc(i));const r=(a=(o=e.overlay)==null?void 0:o.overlays[In.OUTER])==null?void 0:a.extent;return Zz(r)&&(kg[2]=t.toMapSpace[2]/fl(r),kg[3]=t.toMapSpace[3]/Hc(r)),kg}const kg=ci();let Tae=class extends Ur{constructor(){super(...arguments),this.color=qe(1,1,1)}};function bFe(){const t=new Hi;return t.include(qa),t.fragment.uniforms.add(new xt("tex",e=>e.texture),new Wt("uColor",e=>e.color)),t.fragment.code.add(S`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);
}`),t}const vwt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:Tae,build:bFe},Symbol.toStringTag,{value:"Module"}));let wFe=class{constructor(e){this._context=e,this._perConstructorInstances=new sw,this._frameCounter=0,this._keepAliveFrameCount=lye}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(i=>i.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,i=wwt){const r=i.key;let s=this._perConstructorInstances.get(e,r);if(s==null){const n=new e(this._context,i,()=>this.release(n));s=new bwt(n),this._perConstructorInstances.set(e,r,s)}return++s.refCount,s.technique}releaseAndAcquire(e,i,r){if(r!=null){if(i.key===r.key)return r;this.release(r)}return this.acquire(e,i)}release(e){if(e==null||this._perConstructorInstances.empty)return;const i=this._perConstructorInstances.get(e.constructor,e.key);i!=null&&(--i.refCount,i.refCount===0&&(i.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==lye&&this._perConstructorInstances.forEach((e,i)=>{e.forEach((r,s)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._perConstructorInstances.delete(i,s))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((i,r)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>l.technique.reload(this._context)))};e.push(s(i,r))}),await Promise.all(e)}},bwt=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const lye=-1,wwt=new uc;let xFe=class{constructor(e,i,r,s){this._textures=e,this._techniques=i,this.materialChanged=r,this.requestRender=s,this._id2glMaterialRef=new sw}dispose(){this._textures.destroy()}acquire(e,i,r){this._ownMaterial(e);const s=e.produces.get(i);if(!(s!=null&&s(r)))return null;let n=this._id2glMaterialRef.get(r,e.id);if(n==null){const o=e.createGLMaterial({material:e,techniques:this._techniques,textures:this._textures,output:r});n=new xwt(o),this._id2glMaterialRef.set(r,e.id,n)}return n.ref(),n.glMaterial}release(e,i){const r=this._id2glMaterialRef.get(i,e.id);r!=null&&(r.unref(),r.referenced||(Ut(r.glMaterial),this._id2glMaterialRef.delete(i,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&ne.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},xwt=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,bt(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const Twt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];let oj=class VK{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,i){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new Lo,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}destroy(){this._degenerateObjects.clear(),Lo.clearPool(),zK[0]=null,uT.prune(),hT.prune()}add(e,i=e.length){this._objectCount+=i,this._grow(e,i);const r=Lo.acquire();for(let s=0;s<i;s++){const n=e[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(r.init(this._root),this._add(n,r))}Lo.release(r)}remove(e,i=null){this._objectCount-=e.length;const r=Lo.acquire();for(const s of e){const n=i??_2(this.objectToBoundingSphere(s),Rwt);pI(n[3])?(r.init(this._root),Swt(s,n,r)):this._degenerateObjects.delete(s)}Lo.release(r),this._shrink()}update(e,i){if(!pI(i[3])&&this._isDegenerate(e))return;const r=$wt(e);this.remove(r,i),this.add(r)}forEachAlongRay(e,i,r){const s=td(e,i);ix(this._root,n=>{if(!Cwt(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),!0})}forEachAlongRayWithVerticalOffset(e,i,r,s){const n=td(e,i);ix(this._root,o=>{if(!Mwt(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),!0})}forEach(e){ix(this._root,i=>{const r=i.node;return r.terminals.forAll(e),r.residents!==null&&r.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,i,r,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=E9(e,i),u=d=>{if(--n,!s(d))return;const f=this.objectToBoundingSphere(d);if(!cb(r,f))return;const m=U1(e,i,f),g=m-f[3],y=m+f[3];g<o&&(o=g,a=y,l=d)};return cye(this._root,d=>{if(n<=0||!cb(r,d.bounds)||(de(pd,c,d.halfSize),Ee(pd,pd,d.bounds),U1(e,i,pd)>a))return!1;const f=d.node;return f.terminals.forAll(m=>u(m)),f.residents!==null&&f.residents.forAll(m=>u(m)),!0},e,i),l}forEachInDepthRange(e,i,r,s,n,o,a){let l=-1/0,c=1/0;const u={setRange:y=>{r===VK.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,y.near),c=Math.min(c,y.far)):(l=Math.max(l,-y.far),c=Math.min(c,-y.near))}};u.setRange(s);const d=U1(i,r,e),f=E9(i,r),m=E9(i,-r),g=y=>{if(!a(y))return;const v=this.objectToBoundingSphere(y),b=v,w=U1(i,r,b)-d,x=w-v[3],T=w+v[3];x>c||T<l||!cb(o,v)||n(y,u)};cye(this._root,y=>{if(!cb(o,y.bounds)||(de(pd,f,y.halfSize),Ee(pd,pd,y.bounds),U1(i,r,pd)-d>c)||(de(pd,m,y.halfSize),Ee(pd,pd,y.bounds),U1(i,r,pd)-d<l))return!1;const v=y.node;return v.terminals.forAll(b=>g(b)),v.residents!==null&&v.residents.forAll(b=>g(b)),!0},i,r)}forEachNode(e){ix(this._root,i=>e(i.node,i.bounds,i.halfSize,i.depth))}forEachNeighbor(e,i){const r=wb(i),s=i,n=l=>{const c=this.objectToBoundingSphere(l),u=wb(c),d=r+u;return!(yo(c,s)-d*d<=0)||e(l)};let o=!0;const a=l=>{o&&(o=n(l))};ix(this._root,l=>{const c=wb(l.bounds),u=r+c;if(yo(l.bounds,s)-u*u>0)return!1;const d=l.node;return d.terminals.forAll(a),o&&d.residents!==null&&d.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsObject(e,i){const r=this.objectToBoundingSphere(i);return!(r[3]>0)||fX(r,e)}_intersectsObjectWithOffset(e,i,r){const s=this.objectToBoundingSphere(i);return!(s[3]>0)||fX(r.applyToBoundingSphere(s),e)}_add(e,i){i.advanceTo(this.objectToBoundingSphere(e))?i.node.terminals.push(e):(i.node.residents.push(e),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(e){const i=e.node.residents;e.node.residents=null;for(let r=0;r<i.length;r++){const s=Lo.acquire().init(e);this._add(i.at(r),s),Lo.release(s)}}_grow(e,i){if(i!==0&&(uye(e,i,r=>this.objectToBoundingSphere(r),e0),pI(e0[3])&&!this._fitsInsideTree(e0)))if(TFe(this._root.node))_2(e0,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const r=this._rootBoundsForRootAsSubNode(e0);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(e0,r):this._growRootAsSubNode(r),Lo.release(r)}}_rebuildTree(e,i){ve(M9,i.bounds),M9[3]=i.halfSize,uye([e,M9],2,s=>s,A9);const r=Lo.acquire().init(this._root);this._root.initFrom(null,A9,A9[3]),this._root.increaseHalfSize(1.25),ix(r,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),Lo.release(r)}_placingRootViolatesMaxDepth(e){const i=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return ix(this._root,s=>(r=Math.max(r,s.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const i=e[3],r=e;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=n[l]-o-(r[l]-i),u=r[l]+i-(n[l]+o),d=Math.max(0,Math.ceil(c/(2*o))),f=Math.max(0,Math.ceil(u/(2*o)))+1,m=2**Math.ceil(Math.log(d+f)*Math.LOG2E);s=Math.max(s,m),z4[l].min=d,z4[l].max=f}for(let l=0;l<3;l++){let c=z4[l].min,u=z4[l].max;const d=(s-(c+u))/2;c+=Math.ceil(d),u+=Math.floor(d);const f=n[l]-o-c*o*2;C9[l]=f+(u+c)*o}const a=s*o;return C9[3]=a*EFe,Lo.acquire().initFrom(null,C9,a,0)}_growRootAsSubNode(e){const i=this._root.node;ve(e0,this._root.bounds),e0[3]=this._root.halfSize,this._root.init(e),e.advanceTo(e0,null,!0),e.node.children=i.children,e.node.residents=i.residents,e.node.terminals=i.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const i=this._root.node.children;let r=0,s=0;for(;s<i.length&&e==null;)r=s++,e=i[r];for(;s<i.length;)if(i[s++])return-1;return r}_isDegenerate(e){return!pI(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const i=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=i[0]-r&&e[0]<=i[0]+r&&e[1]>=i[1]-r&&e[1]<=i[1]+r&&e[2]>=i[2]-r&&e[2]<=i[2]+r}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:i,_objectCount:r}=this,s=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:i,objectCount:r,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:s}}}_nodeToJSON(e){var n,o;const i=e.children.map(a=>a?this._nodeToJSON(a):null),r=(n=e.residents)==null?void 0:n.map(a=>this.objectToBoundingSphere(a)),s=(o=e.terminals)==null?void 0:o.map(a=>this.objectToBoundingSphere(a));return{children:i,residents:r,terminals:s}}static fromJSON(e){const i=new VK(r=>r,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return i._objectCount=e.objectCount,i._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),i}},Lo=class QC{constructor(){this.bounds=_n(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,i,r,s=this.depth){return this.node=e??QC.createEmptyNode(),i&&_2(i,this.bounds),this.halfSize=r,this.depth=s,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*EFe}advance(e){let i=this.node.children[e];i||(i=QC.createEmptyNode(),this.node.children[e]=i),this.node=i,this.halfSize/=2,this.depth++;const r=SFe[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,i,r=!1){for(;;){if(this.isTerminalFor(e))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const s=this._childIndex(e);i&&i(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const i=this.bounds;return(i[0]<e[0]?1:0)+(i[1]<e[1]?2:0)+(i[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new ai({shrink:!0}),residents:new ai({shrink:!0})}}static acquire(){return QC._pool.acquire()}static release(e){QC._pool.release(e)}static clearPool(){QC._pool.prune()}};function ix(t,e){let i=Lo.acquire().init(t);const r=[i];for(;r.length!==0;){if(i=r.pop(),e(i)&&!i.isLeaf())for(let s=0;s<i.node.children.length;s++)i.node.children[s]&&r.push(Lo.acquire().init(i).advance(s));Lo.release(i)}}function cye(t,e,i,r=oj.DepthOrder.FRONT_TO_BACK){let s=Lo.acquire().init(t);const n=[s];for(Owt(i,r,dye);n.length!==0;){if(s=n.pop(),e(s)&&!s.isLeaf())for(let o=7;o>=0;--o){const a=dye[o];s.node.children[a]&&n.push(Lo.acquire().init(s).advance(a))}Lo.release(s)}}function Swt(t,e,i){uT.clear();const r=i.advanceTo(e,(s,n)=>{uT.push(s.node),uT.push(n)})?i.node.terminals:i.node.residents;if(r.removeUnordered(t),r.length===0)for(let s=uT.length-2;s>=0&&Ewt(uT.data[s],uT.data[s+1]);s-=2);}function Ewt(t,e){return e>=0&&(t.children[e]=null),!!TFe(t)&&(t.residents===null&&(t.residents=new ai({shrink:!0})),!0)}function Cwt(t,e){return aj(e.bounds,2*-e.halfSize,Ch),aj(e.bounds,2*e.halfSize,Mh),WRe(t.origin,t.direction,Ch,Mh)}function Mwt(t,e,i){return aj(e.bounds,2*-e.halfSize,Ch),aj(e.bounds,2*e.halfSize,Mh),i.applyToMinMax(Ch,Mh),WRe(t.origin,t.direction,Ch,Mh)}function TFe(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let e=0;e<t.children.length;e++)if(t.children[e])return!1;return!0}function Awt(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function Pwt(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function aj(t,e,i){i[0]=t[0]+e,i[1]=t[1]+e,i[2]=t[2]+e}function uye(t,e,i,r){if(e===1){const s=i(t[0]);_2(s,r)}else{Ch[0]=1/0,Ch[1]=1/0,Ch[2]=1/0,Mh[0]=-1/0,Mh[1]=-1/0,Mh[2]=-1/0;for(let s=0;s<e;s++){const n=i(t[s]);pI(n[3])&&(Awt(Ch,n),Pwt(Mh,n))}Sr(r,Ch,Mh,.5),r[3]=Math.max(Mh[0]-Ch[0],Mh[1]-Ch[1],Mh[2]-Ch[2])/2}}function Owt(t,e,i){if(!hT.length)for(let r=0;r<8;++r)hT.push({index:0,distance:0});for(let r=0;r<8;++r){const s=SFe[r];hT.data[r].index=r,hT.data[r].distance=U1(t,e,s)}hT.sort((r,s)=>r.distance-s.distance);for(let r=0;r<8;++r)i[r]=hT.data[r].index}function E9(t,e){let i,r=1/0;for(let s=0;s<8;++s){const n=U1(t,e,hye[s]);n<r&&(r=n,i=hye[s])}return i}function U1(t,e,i){return e*(t[0]*i[0]+t[1]*i[1]+t[2]*i[2])}function pI(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}Lo._pool=new ga(Lo),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(oj||(oj={}));const SFe=[qe(-1,-1,-1),qe(1,-1,-1),qe(-1,1,-1),qe(1,1,-1),qe(-1,-1,1),qe(1,-1,1),qe(-1,1,1),qe(1,1,1)],hye=[qe(-1,-1,-1),qe(-1,-1,1),qe(-1,1,-1),qe(-1,1,1),qe(1,-1,-1),qe(1,-1,1),qe(1,1,-1),qe(1,1,1)],EFe=Math.sqrt(3),zK=[null];function $wt(t){return zK[0]=t,zK}const C9=_n(),pd=C(),Ch=C(),Mh=C(),uT=new ai,Rwt=_n(),e0=_n(),M9=_n(),A9=_n(),z4=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],hT=new ai,dye=[0,0,0,0,0,0,0,0],Wf=oj;var Ab;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(Ab||(Ab={}));let CFe=class extends mN{get objects(){return this._objects}constructor(e,i,r=""){super(),this.stage=e,this.apiLayerUid=r,this.type=Gs.Layer,this.events=new Ls,this.visible=!0,this.pickable=!0,this.sliceable=!1,this._objects=new ai,this._objectsAdded=new ai,this._handles=new Ey,this.apiLayerUid=r,this.visible=(i==null?void 0:i.visible)??!0,this.pickable=(i==null?void 0:i.pickable)??!0,this.updatePolicy=(i==null?void 0:i.updatePolicy)??Ab.ASYNC,this._disableOctree=(i==null?void 0:i.disableOctree)??!1,e.add(this);for(const s of Twt)this._handles.add(this.events.on(s,n=>e.handleEvent(s,n)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const i of e)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const i=new Array;if(this._objects.removeUnorderedMany(e,e.length,i),i.length!==0){for(const r of i)r.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),this._octree!=null){for(let r=0;r<i.length;)this._objectsAdded.removeUnordered(i[r])?(i[r]=i[i.length-1],i.length-=1):++r;this._octree.remove(i)}}}sync(){this.updatePolicy!==Ab.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,i){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,i)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new Wf(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=He(this._octree),this._objectsAdded.clear()}};function lj(t){return t!=null&&t.type===Gs.Layer}var Jc,A2;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(Jc||(Jc={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(A2||(A2={}));let Mo=class extends Xc{constructor(){super(...arguments),this.output=G.Color,this.transparencyPassType=ft.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=Jc.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=A2.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}get draped(){return this.space===Jc.Draped}};h([j({count:G.COUNT})],Mo.prototype,"output",void 0),h([j({count:ft.COUNT})],Mo.prototype,"transparencyPassType",void 0),h([j()],Mo.prototype,"occluder",void 0),h([j()],Mo.prototype,"hasSlicePlane",void 0),h([j()],Mo.prototype,"writeDepth",void 0),h([j({count:Jc.COUNT})],Mo.prototype,"space",void 0),h([j()],Mo.prototype,"hideOnShortSegments",void 0),h([j()],Mo.prototype,"hasCap",void 0),h([j({count:A2.COUNT})],Mo.prototype,"anchor",void 0),h([j()],Mo.prototype,"hasTip",void 0),h([j()],Mo.prototype,"vvSize",void 0),h([j()],Mo.prototype,"vvColor",void 0),h([j()],Mo.prototype,"vvOpacity",void 0),h([j()],Mo.prototype,"hasOccludees",void 0),h([j()],Mo.prototype,"multipassEnabled",void 0),h([j()],Mo.prototype,"cullAboveGround",void 0),h([j({constValue:!1})],Mo.prototype,"occlusionPass",void 0),h([j({constValue:!0})],Mo.prototype,"hasVvInstancing",void 0),h([j({constValue:!0})],Mo.prototype,"hasSliceTranslatedView",void 0);const pye=8;function MFe(t,e){const i=t.vertex;i.uniforms.add(new tt("intrinsicWidth",r=>r.width)),e.vvSize?(t.attributes.add($.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new Wt("vvSizeMinSize",r=>r.vvSize.minSize),new Wt("vvSizeMaxSize",r=>r.vvSize.maxSize),new Wt("vvSizeOffset",r=>r.vvSize.offset),new Wt("vvSizeFactor",r=>r.vvSize.factor)),i.code.add(S`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add($.SIZE,"float"),i.code.add(S`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add($.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add(new sc("vvOpacityValues",r=>r.vvOpacity.values,pye),new sc("vvOpacityOpacities",r=>r.vvOpacity.opacityValues,pye)),i.code.add(S`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(S`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(b_,e),t.attributes.add($.COLORFEATUREATTRIBUTE,"float"),i.code.add(S`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add($.COLOR,"vec4"),i.code.add(S`vec4 getColor(){
return applyOpacity(color);
}`))}let AFe=class{constructor(e,i,r){this._createTexture=e,this._parametersKey=i,this._repository=new Map,this._orphanCache=r.newCache(`procedural-texture-repository:${zh()}`,s=>s.dispose())}destroy(){for(const[e,{texture:i}]of this._repository)i.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,i=null){const r=this._acquire(e);return this.release(i),r}release(e){if(e==null)return;const i=this._parametersKey(e),r=this._repository.get(i);if(r&&(r.refCount--,r.refCount===0)){this._repository.delete(i);const{texture:s}=r,n=s.usedMemory;this._orphanCache.put(i,s,n)}}_acquire(e){if(e==null)return null;const i=this._parametersKey(e),r=this._repository.get(i);if(r)return r.refCount++,r.texture;const s=this._orphanCache.pop(i)??this._createTexture(e),n=new Iwt(s);return this._repository.set(i,n),s}},Iwt=class{constructor(e){this.texture=e,this.refCount=1}};function Lwt(t,e){return new AFe(i=>{const{encodedData:r,textureSize:s}=Dwt(i),n=new es;return n.internalFormat=Ht.RGBA,n.width=s,n.height=1,n.wrapMode=Ai.REPEAT,new Mr(t,n,r)},i=>`${i.pattern.join(",")}-r${i.pixelRatio}`,e)}function Dwt(t){const e=Sae(t),i=1/t.pixelRatio,r=PFe(t),s=OFe(t),n=(Math.floor(.5*(s-1))+.5)*i,o=[];let a=1;for(const f of e){for(let m=0;m<f;m++){const g=a*(Math.min(m,f-1-m)+.5)*i/n*.5+.5;o.push(g)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],u=new Uint8Array(4*r);let d=0;for(const f of c)Joe(f,u,d),d+=4;return{encodedData:u,textureSize:r}}function Sae(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function PFe(t){if(t==null)return 1;const e=Sae(t);return Math.floor(e.reduce((i,r)=>i+r))}function OFe(t){return Sae(t).reduce((e,i)=>Math.max(e,i))}function Nwt(t){return t==null?jh:t.length===4?t:Ss(Fwt,t[0],t[1],t[2],1)}const Fwt=ci();function kwt(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?Uwt(t,e):Vwt(t)}function Uwt(t,e){const i=!(e.draped&&e.stipplePreferContinuous),{vertex:r,fragment:s}=t;s.include(vm),e.draped||(fm(r,e),r.uniforms.add(new tt("worldToScreenPerDistanceRatio",(n,o)=>1/o.camera.perScreenPixelRatio)),r.code.add(S`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),t.varyings.add("vStippleDistanceLimits","vec2"),t.varyings.add("vStipplePatternStretch","float"),r.code.add(S`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${Bwt};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(S`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(S`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),IO(r),r.code.add(S`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`),s.uniforms.add(new xt("stipplePatternTexture",n=>n.stippleTexture),new tt("stipplePatternSDFNormalizer",n=>zwt(n.stipplePattern)),new tt("stipplePatternPixelSizeInv",n=>1/$Fe(n))),s.code.add(S`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),e.stippleOffColorEnabled?(s.uniforms.add(new ji("stippleOffColor",n=>Nwt(n.stippleOffColor))),s.code.add(S`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(S`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function Vwt(t){t.fragment.code.add(S`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function zwt(t){return t?(Math.floor(.5*(OFe(t)-1))+.5)/t.pixelRatio:1}function $Fe(t){const e=t.stipplePattern;return e?PFe(t.stipplePattern)/e.pixelRatio:1}const Bwt=S.float(.4);async function D_(t,e){const{data:i}=await fr(t,{responseType:"image",...e});return i}function jwt(){return fye??(fye=(async()=>{const t=await oe(()=>import("./basis_transcoder-B40h2JNH.js"),[]),e=await t.default({locateFile:i=>tr(`esri/libs/basisu/${i}`)});return e.initializeBasis(),e})()),fye}let fye;var qT;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(qT||(qT={}));let tm=null,B4=null;async function RFe(){return B4==null&&(B4=jwt(),tm=await B4),B4}function Gwt(t,e){if(tm==null)return t.byteLength;const i=new tm.BasisFile(new Uint8Array(t)),r=LFe(i)?IFe(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),e):0;return i.close(),i.delete(),r}function Hwt(t,e){if(tm==null)return t.byteLength;const i=new tm.KTX2File(new Uint8Array(t)),r=DFe(i)?IFe(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),e):0;return i.close(),i.delete(),r}function IFe(t,e,i,r,s){const n=zne(e?en.COMPRESSED_RGBA8_ETC2_EAC:en.COMPRESSED_RGB8_ETC2),o=s&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(i*r*n*o)}function LFe(t){return t.getNumImages()>=1&&!t.isUASTC()}function DFe(t){return t.getFaces()>=1&&t.isETC1S()}async function qwt(t,e,i){tm==null&&(tm=await RFe());const r=new tm.BasisFile(new Uint8Array(i));if(!LFe(r))return null;r.startTranscoding();const s=NFe(t,e,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(n,o)=>r.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>r.transcodeImage(a,0,n,o,0,0));return r.close(),r.delete(),s}async function Wwt(t,e,i){tm==null&&(tm=await RFe());const r=new tm.KTX2File(new Uint8Array(i));if(!DFe(r))return null;r.startTranscoding();const s=NFe(t,e,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(n,o)=>r.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>r.transcodeImage(a,n,0,0,o,0,-1,-1));return r.close(),r.delete(),s}function NFe(t,e,i,r,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[u,d]=l?r?[qT.ETC2_RGBA,en.COMPRESSED_RGBA8_ETC2_EAC]:[qT.ETC1_RGB,en.COMPRESSED_RGB8_ETC2]:c?r?[qT.BC3_RGBA,en.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[qT.BC1_RGB,en.COMPRESSED_RGB_S3TC_DXT1_EXT]:[qT.RGBA32,Ht.RGBA],f=e.hasMipmap?i:Math.min(1,i),m=[];for(let g=0;g<f;g++)m.push(new Uint8Array(o(g,u))),a(g,u,m[g]);return e.internalFormat=d,e.hasMipmap=m.length>1,e.samplingMode=e.hasMipmap?di.LINEAR_MIPMAP_LINEAR:di.LINEAR,e.width=s,e.height=n,new Mr(t,e,{type:"compressed",levels:m})}const j4=()=>ne.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),Zwt=542327876,Ywt=131072,Xwt=4;function Eae(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function Jwt(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const Qwt=Eae("DXT1"),Kwt=Eae("DXT3"),ext=Eae("DXT5"),txt=31,ixt=0,rxt=1,sxt=2,nxt=3,oxt=4,axt=7,lxt=20,cxt=21;function uxt(t,e,i){const r=hxt(i,e.hasMipmap??!1);if(r==null)throw new Error("DDS texture data is null");const{textureData:s,internalFormat:n,width:o,height:a}=r;return e.samplingMode=s.levels.length>1?di.LINEAR_MIPMAP_LINEAR:di.LINEAR,e.hasMipmap=s.levels.length>1,e.internalFormat=n,e.width=o,e.height=a,new Mr(t,e,s)}function hxt(t,e){const i=new Int32Array(t,0,txt);if(i[ixt]!==Zwt)return j4().error("Invalid magic number in DDS header"),null;if(!(i[lxt]&Xwt))return j4().error("Unsupported format, must contain a FourCC code"),null;const r=i[cxt];let s,n;switch(r){case Qwt:s=8,n=en.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case Kwt:s=16,n=en.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case ext:s=16,n=en.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return j4().error("Unsupported FourCC code:",Jwt(r)),null}let o=1,a=i[oxt],l=i[nxt];(3&a||3&l)&&(j4().warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let d,f;i[sxt]&Ywt&&e!==!1&&(o=Math.max(1,i[axt]));let m=i[rxt]+4;const g=[];for(let y=0;y<o;++y)f=(a+3>>2)*(l+3>>2)*s,d=new Uint8Array(t,m,f),g.push(d),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:g},internalFormat:n,width:c,height:u}}let cw=class extends mN{get parameters(){return this._parameters}constructor(e,i){super(),this._data=e,this.type=Gs.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new Ls,this._parameters={...pxt,...i},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?(this.frameUpdate=i=>this._frameUpdate(e,i),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(rP(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const i=!e.paused;if(e.src=e.src,i&&e.autoplay){const r=()=>{e.removeEventListener("canplay",r),e.play()};e.addEventListener("canplay",r)}}}_startPreloadImageElement(e){Cy(e.src)||rP(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const i=new es;return i.wrapMode=this._parameters.wrap??Ai.REPEAT,i.flipped=!this._parameters.noUnpackFlip,i.samplingMode=this._parameters.mipmap?di.LINEAR_MIPMAP_LINEAR:di.LINEAR,i.hasMipmap=!!this._parameters.mipmap,i.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,i.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),i}get glTexture(){return this._glTexture}get memoryEstimate(){var e;return((e=this._glTexture)==null?void 0:e.usedMemory)||dxt(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const i=this._data;return i==null?(this._glTexture=new Mr(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),typeof i=="string"?this._loadFromURL(e,i):i instanceof Image?this._loadFromImageElement(e,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(e,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(e,i):(lR(i)||rb(i))&&this._parameters.encoding===g_.DDS_ENCODING?this._loadFromDDSData(e,i):(lR(i)||rb(i))&&this._parameters.encoding===g_.KTX2_ENCODING?this._loadFromKTX2(e,i):(lR(i)||rb(i))&&this._parameters.encoding===g_.BASIS_ENCODING?this._loadFromBasis(e,i):rb(i)?this._loadFromPixelData(e,i):lR(i)?this._loadFromPixelData(e,new Uint8Array(i)):null)}_frameUpdate(e,i){return this._glTexture==null||e.readyState<X3.HAVE_CURRENT_DATA||i===e.currentTime?i:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,i){return this._glTexture=uxt(e,this._createDescriptor(e),i),this._glTexture}_loadFromKTX2(e,i){return this._loadAsync(()=>Wwt(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(e,i){return this._loadAsync(()=>qwt(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(e,i){bt(this._parameters.width>0&&this._parameters.height>0);const r=this._createDescriptor(e);return r.pixelFormat=this._parameters.components===1?Ht.LUMINANCE:this._parameters.components===3?Ht.RGB:Ht.RGBA,r.width=this._parameters.width??0,r.height=this._parameters.height??0,this._glTexture=new Mr(e,r,i),this._glTexture}_loadFromURL(e,i){return this._loadAsync(async r=>{const s=await D_(i,{signal:r});return Dt(r),this._loadFromImage(e,s)})}_loadFromImageElement(e,i){return i.complete?this._loadFromImage(e,i):this._loadAsync(async r=>{const s=await zEe(i,i.src,!1,r);return Dt(r),this._loadFromImage(e,s)})}_loadFromVideoElement(e,i){return i.readyState>=X3.HAVE_CURRENT_DATA?this._loadFromImage(e,i):this._loadFromVideoElementAsync(e,i)}_loadFromVideoElementAsync(e,i){return this._loadAsync(r=>new Promise((s,n)=>{const o=()=>{i.removeEventListener("loadeddata",a),i.removeEventListener("error",l),Lr(c)},a=()=>{i.readyState>=X3.HAVE_CURRENT_DATA&&(o(),s(this._loadFromImage(e,i)))},l=u=>{o(),n(u||new B("Failed to load video"))};i.addEventListener("loadeddata",a),i.addEventListener("error",l);const c=Va(r,()=>l(Ui()))}))}_loadFromImage(e,i){let r=i;if(!(r instanceof HTMLVideoElement)){const{maxTextureSize:o}=e.parameters;r=this._parameters.downsampleUncompressed?Eht(r,o):Cht(r,o)}const s=FFe(r);this._parameters.width=s.width,this._parameters.height=s.height;const n=this._createDescriptor(e);return n.pixelFormat=this._parameters.components===3?Ht.RGB:Ht.RGBA,n.width=s.width,n.height=s.height,this._glTexture=new Mr(e,n,r),this._glTexture}_loadAsync(e){const i=new AbortController;this._loadingController=i;const r=e(i.signal);this._loadingPromise=r;const s=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(s,s),r}unload(){if(this._glTexture=Ut(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};function dxt(t,e){if(t==null)return 0;if(lR(t)||rb(t))return e.encoding===g_.KTX2_ENCODING?Hwt(t,!!e.mipmap):e.encoding===g_.BASIS_ENCODING?Gwt(t,!!e.mipmap):t.byteLength;const{width:i,height:r}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?FFe(t):e;return(e.mipmap?4/3:1)*i*r*(e.components||4)||0}function FFe(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var X3;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(X3||(X3={}));const pxt={wrap:{s:Ai.REPEAT,t:Ai.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1},cj=128,Cae=.5;function fxt(t){return t==="cross"||t==="x"}function mxt(t,e=cj,i=e*Cae,r=0){const s=kFe(t,e,i,r);return new cw(s,{mipmap:!1,wrap:{s:Ai.CLAMP_TO_EDGE,t:Ai.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0,reloadable:!0})}function kFe(t,e=cj,i=e*Cae,r=0){switch(t){case"circle":default:return gxt(e,i);case"square":return yxt(e,i);case"cross":return vxt(e,i,r);case"x":return bxt(e,i,r);case"kite":return _xt(e,i);case"triangle":return wxt(e,i);case"arrow":return xxt(e,i)}}function gxt(t,e){const i=t/2-.5;return LN(t,zFe(i,i,e/2))}function yxt(t,e){return UFe(t,e,!1)}function _xt(t,e){return UFe(t,e,!0)}function vxt(t,e,i=0){return VFe(t,e,!1,i)}function bxt(t,e,i=0){return VFe(t,e,!0,i)}function wxt(t,e){return LN(t,BFe(t/2,e,e/2))}function xxt(t,e){const i=e,r=e/2,s=t/2,n=.8*i,o=zFe(s,(t-e)/2-n,Math.sqrt(n*n+r*r)),a=BFe(s,i,r);return LN(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function UFe(t,e,i){return i&&(e/=Math.SQRT2),LN(t,(r,s)=>{let n=r-.5*t+.25,o=.5*t-s-.75;if(i){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*e})}function VFe(t,e,i,r=0){e-=r,i&&(e*=Math.SQRT2);const s=.5*e;return LN(t,(n,o)=>{let a,l=n-.5*t,c=.5*t-o-1;if(i){const u=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=u}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=r/2,a})}function zFe(t,e,i){return(r,s)=>{const n=r-t,o=s-e;return Math.sqrt(n*n+o*o)-i}}function BFe(t,e,i){const r=Math.sqrt(e*e+i*i);return(s,n)=>{const o=Math.abs(s-t)-i,a=n-t+e/2+.75,l=(e*o+i*a)/r,c=-a;return Math.max(l,c)}}function LN(t,e){const i=new Uint8Array(4*t*t);for(let r=0;r<t;r++)for(let s=0;s<t;s++){const n=s+t*r;let o=e(s,r);o=o/t+.5,Joe(o,i,4*n)}return i}const HS=64,Mae=HS/2,jFe=Mae/5,Txt=HS/jFe,Sxt=.25;function Ext(t,e){const i=kFe(t,HS,Mae,jFe),r=new es;return r.internalFormat=Ht.RGBA,r.width=HS,r.height=HS,r.wrapMode=Ai.CLAMP_TO_EDGE,new Mr(e,r,i)}function GFe(t,e){const{vertex:i,constants:r}=t;r.add("markerSizePerLineWidth","float",Txt),IO(i),i.uniforms.get("markerScale")==null&&i.constants.add("markerScale","float",1),i.code.add(S`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===Jc.World&&(i.constants.add("maxSegmentLengthFraction","float",.45),i.uniforms.add(new tt("perRenderPixelRatio",(s,n)=>n.camera.perRenderPixelRatio)),i.code.add(S`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var hp;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(hp||(hp={}));let ks=class extends Xc{constructor(){super(...arguments),this.output=G.Color,this.capType=hp.BUTT,this.transparencyPassType=ft.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};h([j({count:G.COUNT})],ks.prototype,"output",void 0),h([j({count:hp.COUNT})],ks.prototype,"capType",void 0),h([j({count:ft.COUNT})],ks.prototype,"transparencyPassType",void 0),h([j()],ks.prototype,"occluder",void 0),h([j()],ks.prototype,"hasSlicePlane",void 0),h([j()],ks.prototype,"hasPolygonOffset",void 0),h([j()],ks.prototype,"writeDepth",void 0),h([j()],ks.prototype,"draped",void 0),h([j()],ks.prototype,"stippleEnabled",void 0),h([j()],ks.prototype,"stippleOffColorEnabled",void 0),h([j()],ks.prototype,"stipplePreferContinuous",void 0),h([j()],ks.prototype,"roundJoins",void 0),h([j()],ks.prototype,"applyMarkerOffset",void 0),h([j()],ks.prototype,"vvSize",void 0),h([j()],ks.prototype,"vvColor",void 0),h([j()],ks.prototype,"vvOpacity",void 0),h([j()],ks.prototype,"falloffEnabled",void 0),h([j()],ks.prototype,"innerColorEnabled",void 0),h([j()],ks.prototype,"hasOccludees",void 0),h([j()],ks.prototype,"multipassEnabled",void 0),h([j()],ks.prototype,"cullAboveGround",void 0),h([j()],ks.prototype,"wireframe",void 0),h([j()],ks.prototype,"objectAndLayerIdColorInstanced",void 0),h([j({constValue:!1})],ks.prototype,"occlusionPass",void 0),h([j({constValue:!0})],ks.prototype,"hasVvInstancing",void 0),h([j({constValue:!0})],ks.prototype,"hasSliceTranslatedView",void 0);const hD=1;function HFe(t){const e=new Hi,{attributes:i,varyings:r,constants:s,vertex:n,fragment:o}=e;e.include(hN),e.include(MFe,t),e.include(kwt,t);const a=t.applyMarkerOffset&&!t.draped;a&&(n.uniforms.add(new tt("markerScale",g=>g.markerScale)),e.include(GFe,{space:Jc.World,draped:!1})),e.include(aE,t),Wc(n,t),n.uniforms.add(new fs("inverseProjectionMatrix",(g,y)=>y.camera.inverseProjectionMatrix),new Hr("nearFar",(g,y)=>y.camera.nearFar),new tt("miterLimit",g=>g.join!=="miter"?0:g.miterLimit),new ji("viewport",(g,y)=>y.camera.fullViewport)),n.constants.add("LARGE_HALF_FLOAT","float",65500),i.add($.POSITION,"vec3"),i.add($.PREVPOSITION,"vec3"),i.add($.NEXTPOSITION,"vec3"),i.add($.SUBDIVISIONFACTOR,"float"),i.add($.UV0,"vec2"),r.add("vColor","vec4"),r.add("vpos","vec3"),r.add("vLineDistance","float"),r.add("vLineWidth","float");const l=t.multipassEnabled&&t.output===G.Color;l&&r.add("depth","float");const c=t.stippleEnabled;c&&r.add("vLineSizeInv","float"),s.add("aaWidth","float",t.stippleEnabled?0:1);const u=t.capType===hp.ROUND,d=t.stippleEnabled&&u,f=t.falloffEnabled||d;f&&r.add("vLineDistanceNorm","float"),u&&(r.add("vSegmentSDF","float"),r.add("vReverseSegmentSDF","float")),n.code.add(S`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),n.code.add(S`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),n.code.add(S`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${l?"depth = pos.z;":""}

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),IO(n),n.code.add(S`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;
      float lineSize = getSize();

      if (lineSize < 1.0) {
        coverage = lineSize; // convert sub-pixel coverage to alpha
        lineSize = 1.0;
      }
      lineSize += aaWidth;

      float lineWidth = lineSize * pixelRatio;
      vLineWidth = lineWidth;
      ${c?S`vLineSizeInv = 1.0 / lineSize;`:""}

      vec4 pos  = view * vec4(position, 1.0);
      vec4 prev = view * vec4(prevPosition, 1.0);
      vec4 next = view * vec4(nextPosition, 1.0);
  `),a&&n.code.add(S`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),n.code.add(S`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||u)&&n.code.add(S`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${u?S`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),n.code.add(S`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?n.code.add(S`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?S`min(1.0, subdivisionFactor * ${S.float((hD+2)/(hD+1))})`:S`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):n.code.add(S`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const m=t.capType!==hp.BUTT;return n.code.add(S`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${m?S`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),n.code.add(S`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;
    float lineDistNorm = sign(uv0.y) * pos.w;

    vLineDistance =  lineWidth * lineDistNorm;
    ${f?S`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),u&&n.code.add(S`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?n.uniforms.add(new tt("worldToScreenRatio",(g,y)=>1/y.screenToPCSRatio)):n.code.add(S`vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),n.code.add(S`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?n.code.add(S`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):n.code.add(S`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),n.uniforms.add(new tt("stipplePatternPixelSize",g=>$Fe(g))),n.code.add(S`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),n.code.add(S`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),l&&e.include(Uy,t),e.include(Mn,t),o.include(Fy),o.code.add(S`
  void main() {
    discardBySlice(vpos);
    ${l?"terrainDepthTest(depth);":""}
  `),t.wireframe?o.code.add(S`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(u&&o.code.add(S`
        float sdf = min(vSegmentSDF, vReverseSegmentSDF);
        vec2 fragmentPosition = vec2(
          min(sdf, 0.0),
          vLineDistance
        ) * gl_FragCoord.w;

        float fragmentRadius = length(fragmentPosition);
        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

        if (capCoverage < ${S.float(la)}) {
          discard;
        }
      `),d?o.code.add(S`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${S.float(la)}, stippleCoverage);
      `):o.code.add(S`float stippleAlpha = getStippleAlpha();`),t.output!==G.ObjectAndLayerIdColor&&o.code.add(S`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),o.uniforms.add(new ji("intrinsicColor",g=>g.color)),o.code.add(S`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(o.uniforms.add(new ji("innerColor",g=>g.innerColor??g.color),new tt("innerWidth",(g,y)=>g.innerWidth*y.camera.pixelRatio)),o.code.add(S`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),o.code.add(S`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(o.uniforms.add(new tt("falloff",g=>g.falloff)),o.code.add(S`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)),t.stippleEnabled||o.code.add(S`float featherStartDistance = max(vLineWidth - 2.0, 0.0);
float value = abs(vLineDistance) * gl_FragCoord.w;
float feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);
finalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);`)),t.transparencyPassType===ft.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),o.code.add(S`
    ${t.output===G.ObjectAndLayerIdColor?S`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${S.float(la)}) {
      discard;
    }

    ${t.output===G.Color?S`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===G.Color&&t.transparencyPassType===ft.ColorAlpha?S`
            fragColor = premultiplyAlpha(fragColor);
            fragAlpha = fragColor.a;`:""}
    ${t.output===G.Highlight?S`fragColor = vec4(1.0);`:""}
    ${t.output===G.ObjectAndLayerIdColor?S`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const Cxt=Object.freeze(Object.defineProperty({__proto__:null,build:HFe,ribbonlineNumRoundJoinSubdivisions:hD},Symbol.toStringTag,{value:"Module"})),qFe=new Map([[$.POSITION,0],[$.PREVPOSITION,1],[$.NEXTPOSITION,2],[$.SUBDIVISIONFACTOR,3],[$.UV0,4],[$.COLOR,5],[$.COLORFEATUREATTRIBUTE,5],[$.SIZE,6],[$.SIZEFEATUREATTRIBUTE,6],[$.OPACITYFEATUREATTRIBUTE,7],[$.OBJECTANDLAYERIDCOLOR,8]]);let WFe=class ZFe extends Ki{initializeProgram(e){return new er(e.rctx,ZFe.shader.get().build(this.configuration),qFe)}_makePipelineState(e,i){const r=this.configuration,s=e===ft.NONE,n=e===ft.FrontFace,o=zdt(r.output);return Kt({blending:r.output===G.Color?s?Bu:Q_(e):null,depthTest:{func:Aw(e)},depthWrite:s?r.writeDepth||o?Wu:null:K6(e),drawBuffers:r.output===G.Depth?{buffers:[ho.NONE]}:K_(e),colorWrite:ui,stencilWrite:r.hasOccludees?Ty:null,stencilTest:r.hasOccludees?i?aw:Pw:null,polygonOffset:s||n?r.hasPolygonOffset?mye:null:t8})}initializePipeline(){const e=this.configuration;if(e.occluder){const i=e.hasPolygonOffset?mye:null;this._occluderPipelineTransparent=Kt({blending:Bu,polygonOffset:i,depthTest:tj,depthWrite:null,colorWrite:ui,stencilWrite:null,stencilTest:tNe,drawBuffers:e.output===G.Depth?{buffers:[ho.NONE]}:null}),this._occluderPipelineOpaque=Kt({blending:Bu,polygonOffset:i,depthTest:tj,depthWrite:null,colorWrite:ui,stencilWrite:KDe,stencilTest:eNe,drawBuffers:e.output===G.Depth?{buffers:[ho.NONE]}:null}),this._occluderPipelineMaskWrite=Kt({blending:null,polygonOffset:i,depthTest:sae,depthWrite:null,colorWrite:null,stencilWrite:Ty,stencilTest:aw,drawBuffers:e.output===G.Depth?{buffers:[ho.NONE]}:null})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Mi.LINES:Mi.TRIANGLE_STRIP}getPipeline(e,i,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:i?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};WFe.shader=new qi(Cxt,()=>oe(()=>Promise.resolve().then(()=>O9t),void 0));const mye={factor:0,units:-4};var _u;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(_u||(_u={}));let YM=class extends Cw{constructor(e){super(e,new Axt),this._configuration=new ks,this.produces=new Map([[Pe.OPAQUE_MATERIAL,i=>i===G.Highlight||i===G.ObjectAndLayerIdColor||i===G.Color&&this.parameters.renderOccluded===ir.OccludeAndTransparentStencil],[Pe.OPAQUE_NO_SSAO_DEPTH,i=>Cb(i)],[Pe.OCCLUDER_MATERIAL,i=>yQ(i)&&this.parameters.renderOccluded===ir.OccludeAndTransparentStencil],[Pe.TRANSPARENT_OCCLUDER_MATERIAL,i=>yQ(i)&&this.parameters.renderOccluded===ir.OccludeAndTransparentStencil],[Pe.TRANSPARENT_MATERIAL,i=>i===G.Color&&this.parameters.writeDepth&&this.parameters.renderOccluded!==ir.OccludeAndTransparentStencil],[Pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>i===G.Color&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==ir.OccludeAndTransparentStencil],[Pe.DRAPED_MATERIAL,i=>QIe(i)]]),this._vertexAttributeLocations=qFe}getConfiguration(e,i){this._configuration.output=e,this._configuration.draped=i.slot===Pe.DRAPED_MATERIAL;const r=this.parameters.stipplePattern!=null&&e!==G.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&this.parameters.stippleOffColor!=null,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&Oxt(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===ir.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,i,r,s,n,o){if(!r.options.selectionMode)return;const a=e.attributes.get($.POSITION).data,l=e.attributes.get($.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const y=e.attributes.get($.SIZEFEATUREATTRIBUTE).data[0];c*=Ne(this.parameters.vvSize.offset[0]+y*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const u=s[0],d=s[1],f=(c/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,g=0;for(let y=0;y<a.length-5;y+=3){const v=a[y],b=a[y+1],w=u-v,x=d-b,T=a[y+3]-v,E=a[y+4]-b,M=Ne((T*w+E*x)/(T*T+E*E),0,1),O=T*M-w,D=E*M-x,U=O*O+D*D;U<m&&(m=U,g=y/3)}m<f*f&&n(o.dist,o.normal,g,!1)}intersect(e,i,r,s,n,o){if(!r.options.selectionMode||!e.visible)return;if(!ZRe(i))return void ne.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes,l=a.get($.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const w=a.get($.SIZEFEATUREATTRIBUTE).data[0];c*=Ne(this.parameters.vvSize.offset[0]+w*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has($.SIZE)&&(c*=a.get($.SIZE).data[0]);const u=r.camera,d=$xt;Ga(d,r.point);const f=c*u.pixelRatio/2+4*u.pixelRatio;pe(L$[0],d[0]-f,d[1]+f,0),pe(L$[1],d[0]+f,d[1]+f,0),pe(L$[2],d[0]+f,d[1]-f,0),pe(L$[3],d[0]-f,d[1]-f,0);for(let w=0;w<4;w++)if(!u.unprojectFromRenderScreen(L$[w],t0[w]))return;hl(u.eye,t0[0],t0[1],O9),hl(u.eye,t0[1],t0[2],$9),hl(u.eye,t0[2],t0[3],R9),hl(u.eye,t0[3],t0[0],I9);let m=Number.MAX_VALUE,g=0;const y=YFe(this.parameters,a)?l.length-2:l.length-5;for(let w=0;w<y;w+=3){mc[0]=l[w]+i[12],mc[1]=l[w+1]+i[13],mc[2]=l[w+2]+i[14];const x=(w+3)%l.length;if(gc[0]=l[x]+i[12],gc[1]=l[x+1]+i[13],gc[2]=l[x+2]+i[14],Rr(O9,mc)<0&&Rr(O9,gc)<0||Rr($9,mc)<0&&Rr($9,gc)<0||Rr(R9,mc)<0&&Rr(R9,gc)<0||Rr(I9,mc)<0&&Rr(I9,gc)<0)continue;if(u.projectToRenderScreen(mc,sx),u.projectToRenderScreen(gc,nx),sx[2]<0&&nx[2]>0){$e(Pm,mc,gc);const E=u.frustum,M=-Rr(E[Er.NEAR],mc)/Te(Pm,E[Er.NEAR]);de(Pm,Pm,M),Ee(mc,mc,Pm),u.projectToRenderScreen(mc,sx)}else if(sx[2]>0&&nx[2]<0){$e(Pm,gc,mc);const E=u.frustum,M=-Rr(E[Er.NEAR],gc)/Te(Pm,E[Er.NEAR]);de(Pm,Pm,M),Ee(gc,gc,Pm),u.projectToRenderScreen(gc,nx)}else if(sx[2]<0&&nx[2]<0)continue;sx[2]=0,nx[2]=0;const T=Lse(kS(sx,nx,_ye),d);T<m&&(m=T,ve(gye,mc),ve(yye,gc),g=w/3)}const v=r.rayBegin,b=r.rayEnd;if(m<f*f){let w=Number.MAX_VALUE;if(iPe(kS(gye,yye,_ye),kS(v,b,Rxt),rx)){$e(rx,rx,v);const x=Ve(rx);de(rx,rx,1/x),w=x/Ar(v,b)}o(w,rx,g,!1)}}get _layout(){const e=Ds().vec3f($.POSITION).vec3f($.PREVPOSITION).vec3f($.NEXTPOSITION).f32($.SUBDIVISIONFACTOR).vec2f($.UV0);return this.parameters.vvSize?e.f32($.SIZEFEATUREATTRIBUTE):e.f32($.SIZE),this.parameters.vvColor?e.f32($.COLORFEATUREATTRIBUTE):e.vec4f($.COLOR),this.parameters.vvOpacity&&e.f32($.OPACITYFEATUREATTRIBUTE),ue("enable-feature:objectAndLayerId-rendering")&&e.vec4u8($.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new Pxt(this._layout,this.parameters)}createGLMaterial(e){return new Mxt(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},Mxt=class extends Sw{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextures.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===G.Color&&this._updateOccludeeState(e);const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters({stippleTexture:this._stippleTextures.swap(i,this._stipplePattern)}),this._stipplePattern=i),this.ensureTechnique(WFe,e)}},Axt=class extends bN{constructor(){super(...arguments),this.width=0,this.color=Kd,this.join="miter",this.cap=hp.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},Pxt=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i,this.numJoinSubdivisions=0;const r=i.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=hD+r}}_isClosed(e){return YFe(this._parameters,e.attributes)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const r=e.attributes.get($.POSITION).indices.length/2+1,s=this._isClosed(e);let n=s?2:2*2;return n+=((s?r:r-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(e,i,r,s,n){var ye,L,N;const o=Ixt,a=Lxt,l=Dxt,c=r.attributes.get($.POSITION),u=c.indices,d=c.data.length/3,f=(ye=r.attributes.get($.DISTANCETOSTART))==null?void 0:ye.data;u&&u.length!==2*(d-1)&&console.warn("RibbonLineMaterial does not support indices");const m=((L=r.attributes.get($.SIZEFEATUREATTRIBUTE))==null?void 0:L.data[0])??((N=r.attributes.get($.SIZE))==null?void 0:N.data[0])??1;let g=[1,1,1,1],y=0;const v=this.vertexBufferLayout.fields.has($.COLORFEATUREATTRIBUTE);v?y=r.attributes.get($.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has($.COLOR)&&(g=r.attributes.get($.COLOR).data);const b=ue("enable-feature:objectAndLayerId-rendering")?r.objectAndLayerIdColor:null,w=this.vertexBufferLayout.fields.has($.OPACITYFEATUREATTRIBUTE),x=w?r.attributes.get($.OPACITYFEATUREATTRIBUTE).data[0]:0,T=new Float32Array(s.buffer),E=ue("enable-feature:objectAndLayerId-rendering")?new Uint8Array(s.buffer):null,M=this.vertexBufferLayout.stride/4;let O=n*M;const D=O;let U=0;const k=f?(z,W,J)=>U=f[J]:(z,W,J)=>U+=Ar(z,W),H=ue("enable-feature:objectAndLayerId-rendering"),V=(z,W,J,ee,ae,we,Ie)=>{if(T[O++]=W[0],T[O++]=W[1],T[O++]=W[2],T[O++]=z[0],T[O++]=z[1],T[O++]=z[2],T[O++]=J[0],T[O++]=J[1],T[O++]=J[2],T[O++]=ee,T[O++]=Ie,T[O++]=ae,T[O++]=m,v)T[O++]=y;else{const Ge=Math.min(4*we,g.length-4);T[O++]=g[Ge],T[O++]=g[Ge+1],T[O++]=g[Ge+2],T[O++]=g[Ge+3]}w&&(T[O++]=x),H&&(b!=null&&(E[4*O]=b[0],E[4*O+1]=b[1],E[4*O+2]=b[2],E[4*O+3]=b[3]),O++)};O+=M,pe(a,c.data[0],c.data[1],c.data[2]),e&&nt(a,a,e);const X=this._isClosed(r);if(X){const z=c.data.length-3;pe(o,c.data[z],c.data[z+1],c.data[z+2]),e&&nt(o,o,e)}else pe(l,c.data[3],c.data[4],c.data[5]),e&&nt(l,l,e),V(a,a,l,1,_u.LEFT_CAP_START,0,0),V(a,a,l,1,_u.RIGHT_CAP_START,0,0),ve(o,a),ve(a,l);const q=X?0:1,Z=X?d:d-1;for(let z=q;z<Z;z++){const W=(z+1)%d*3;pe(l,c.data[W],c.data[W+1],c.data[W+2]),e&&nt(l,l,e),k(o,a,z),V(o,a,l,0,_u.LEFT_JOIN_END,z,U),V(o,a,l,0,_u.RIGHT_JOIN_END,z,U);const J=this.numJoinSubdivisions;for(let ee=0;ee<J;++ee){const ae=(ee+1)/(J+1);V(o,a,l,ae,_u.LEFT_JOIN_END,z,U),V(o,a,l,ae,_u.RIGHT_JOIN_END,z,U)}V(o,a,l,1,_u.LEFT_JOIN_START,z,U),V(o,a,l,1,_u.RIGHT_JOIN_START,z,U),ve(o,a),ve(a,l)}X?(pe(l,c.data[3],c.data[4],c.data[5]),e&&nt(l,l,e),U=k(o,a,Z),V(o,a,l,0,_u.LEFT_JOIN_END,q,U),V(o,a,l,0,_u.RIGHT_JOIN_END,q,U)):(U=k(o,a,Z),V(o,a,a,0,_u.LEFT_CAP_END,Z,U),V(o,a,a,0,_u.RIGHT_CAP_END,Z,U)),P9(T,D+M,T,D,M),O=P9(T,O-M,T,O,M),this._parameters.wireframe&&this._addWireframeVertices(s,D,O,M)}_addWireframeVertices(e,i,r,s){const n=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let a=0;const l=c=>a=P9(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}};function P9(t,e,i,r,s){for(let n=0;n<s;n++)i[r++]=t[e++];return r}function YFe(t,e){return t.isClosed?e.get($.POSITION).indices.length>2:!1}function Oxt(t){return t.anchor===A2.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const mc=C(),gc=C(),Pm=C(),rx=C(),$xt=C(),sx=ka(),nx=ka(),gye=C(),yye=C(),_ye=_m(),Rxt=_m(),Ixt=C(),Lxt=C(),Dxt=C(),L$=[ka(),ka(),ka(),ka()],t0=[C(),C(),C(),C()],O9=rr(),$9=rr(),R9=rr(),I9=rr();let XFe=class{constructor(e){this._originSR=e,this._rootOriginId="root/"+zh(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const i=this._origins.get(this._rootOriginId);if(i==null){const u=nj(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,u),u}const r=this._gridSize,s=Math.round(e[0]/r),n=Math.round(e[1]/r),o=Math.round(e[2]/r),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*r;if($e(Xo,e,i.vec3),Xo[0]=Math.abs(Xo[0]),Xo[1]=Math.abs(Xo[1]),Xo[2]=Math.abs(Xo[2]),Xo[0]<c&&Xo[1]<c&&Xo[2]<c){if(l){const u=Math.max(...Xo);if($e(Xo,e,l.vec3),Xo[0]=Math.abs(Xo[0]),Xo[1]=Math.abs(Xo[1]),Xo[2]=Math.abs(Xo[2]),Math.max(...Xo)<u)return l}return i}return l||(l=nj(s*r,n*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(e,i=ri(1,1,0,1)){const r=window.view,s=r._stage,n=i.toString();if(!this._objects.has(n)){this._material=new YM({width:2,color:i}),s.add(this._material);const m=new CFe(s,{pickable:!1}),g=new Ow({castShadow:!1});s.add(g),m.add(g),this._objects.set(n,g)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),u=new Array,d=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m]=e[0]+(1&a[m]?d:-d),c[3*m+1]=e[1]+(2&a[m]?d:-d),c[3*m+2]=e[2]+(4&a[m]?d:-d),m>0&&u.push(m-1,m);gs(c,this._originSR,0,c,r.renderSpatialReference,0,l);const f=new Pn(this._material,[[$.POSITION,new ht(c,u,3,!0)]],null,Gs.Line);s.add(f),o.addGeometry(f)}get test(){}};const Xo=C();let JFe=class{constructor(e,i,r=null){this.rctx=e,this.sliceHelper=r,this.lastFrameCamera=new Fr,this.output=G.Color,this.renderOccludedMask=uj,this.bindParameters=new O6(i,r!=null?r.plane:null),this.bindParameters.alignPixelEnabled=!0}},Nxt=class extends JFe{constructor(e,i,r,s){super(e,r,s),this.offscreenRenderingHelper=i,this.sliceHelper=s,this.time=0}};const uj=ir.Occlude|ir.OccludeAndTransparent|ir.OccludeAndTransparentStencil;let fI=class extends Fr{constructor(){super(...arguments),this._projectionMatrix=ke()}get projectionMatrix(){return this._projectionMatrix}};h([p()],fI.prototype,"_projectionMatrix",void 0),h([p({readOnly:!0})],fI.prototype,"projectionMatrix",null),fI=h([I("esri.views.3d.webgl-engine.lib.CascadeCamera")],fI);var P2;(function(t){t[t.Highlight=0]="Highlight",t[t.ExcludeHighlight=1]="ExcludeHighlight"})(P2||(P2={}));let G4=class{constructor(){this.camera=new fI,this.lightMat=ke()}},Fxt=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},Aae=class{constructor(e,i){this._fbos=e,this._viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new Fxt,this._projectionView=ke(),this._projectionViewInverse=ke(),this._modelViewLight=ke(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=ci(),this._cascades=[new G4,new G4,new G4,new G4],this._lastOrigin=null,this._maxTextureWidth=Math.min(ue("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){var e;return(e=this._handle)==null?void 0:e.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return Ss(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=hi(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=Ne(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}get cascades(){for(let e=0;e<this._numCascades;++e)D9[e]=this._cascades[e];return D9.length=this._numCascades,D9}start(e,i,r,s,n){bt(this.enabled);const{near:o,far:a}=jxt(r);this._computeCascadeDistances(o,a,s),this._textureHeight=this._computeTextureHeight(e,n,s),this._setupMatrices(e,i);const{viewMatrix:l,projectionMatrix:c}=e;for(let u=0;u<this._numCascades;++u)this._constructCascade(u,c,l,i);this._lastOrigin=null,this.clear()}finish(){var e;bt(this.enabled),(e=this._handle)==null||e.detachDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!Uo(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||C(),ve(this._lastOrigin,e);for(let i=0;i<this._numCascades;++i){wl(Sye,this._cascades[i].lightMat,e);for(let r=0;r<16;++r)Eye[16*i+r]=Sye[r]}}return Eye}moveSnapshot(e){var i,r;bt(this.enabled),(i=this._handle)==null||i.detachDepth(),(r=this._snapshots[e])==null||r.release(),this._snapshots[e]=this._handle,this._handle=null,this.clear()}copySnapshot(e){var l,c,u,d;const i=(c=(l=this._handle)==null?void 0:l.getTexture())==null?void 0:c.descriptor;if(!this.enabled||!i)return;(u=this._snapshots[e])==null||u.release();const{width:r,height:s}=i,n=e===P2.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[e]=this._fbos.acquire(r,s,n,ls.RGBA4);const o=this._fbos.rctx;this._bindFbo();const a=o.bindTexture((d=this._snapshots[e])==null?void 0:d.getTexture(),Mr.TEXTURE_UNIT_FOR_UPDATES);o.gl.copyTexSubImage2D(js.TEXTURE_2D,0,0,0,0,0,r,s),o.bindTexture(a,Mr.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){var i;return this.enabled?(i=this._snapshots[e])==null?void 0:i.getTexture():null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clear(jr.COLOR_BUFFER_BIT|jr.DEPTH_BUFFER_BIT)}_computeTextureHeight(e,i,r){const s=Math.min(window.devicePixelRatio,i)/e.pixelRatio,n=r?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,o=Sb(Math.floor(Math.max(e.fullWidth,e.fullHeight)*s*n)),a=Math.min(this._maxTextureWidth,this._numCascades*o);return mIe(a/this._numCascades)}_ensureFbo(){var e,i,r,s,n;((i=(e=this._handle)==null?void 0:e.fbo)==null?void 0:i.width)===this._textureWidth&&((r=this._handle)==null?void 0:r.fbo.height)===this._textureHeight||((s=this._handle)==null||s.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",ls.RGBA4)),(n=this._handle)==null||n.acquireDepth(Fo.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=hi(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){var i;const e=this._fbos.rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer((i=this._handle)==null?void 0:i.fbo)}_constructCascade(e,i,r,s){const n=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),c=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]);bt(l<c);for(let m=0;m<8;++m){Ss(vye,m%4==0||m%4==3?-1:1,m%4==0||m%4==1?-1:1,m<4?l:c,1);const g=zd[m];Vu(g,vye,this._projectionViewInverse),g[0]/=g[3],g[1]/=g[3],g[2]/=g[3]}da(L9,zd[0]),n.camera.viewMatrix=wl(kxt,this._modelViewLight,L9);for(let m=0;m<8;++m)nt(zd[m],zd[m],n.camera.viewMatrix);let u=zd[0][2],d=zd[0][2];for(let m=1;m<8;++m)u=Math.min(u,zd[m][2]),d=Math.max(d,zd[m][2]);u-=200,d+=200,n.camera.near=-d,n.camera.far=-u,Bxt(r,s,u,d,n.camera),vr(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const f=this._textureHeight;n.camera.viewport=[e*f,0,f,f]}_setupMatrices(e,i){vr(this._projectionView,e.projectionMatrix,e.viewMatrix),eo(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===Je.Global?e.eye:pe(L9,0,0,1);IG(this._modelViewLight,[0,0,0],[-i[0],-i[1],-i[2]],r)}_computeCascadeDistances(e,i,r){const s=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(Rut(i/e,4)),s);const n=(i-e)/this._numCascades,o=(i/e)**(1/this._numCascades);let a=e,l=e;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=Bt(a,l,this.settings.splitSchemeLambda),a*=o,l+=n}get test(){}};const kxt=ke(),vye=ci(),zd=[];for(let t=0;t<8;++t)zd.push(ci());const bye=gt(),wye=gt(),Uxt=gt(),xye=gt(),Tye=gt(),L9=C(),D9=[],Sye=ke(),Eye=Jr.concat(Jr,Jr,Jr,Jr),rh=gt(),VE=gt(),ox=[gt(),gt(),gt(),gt()],ro=gt(),N9=gt(),Iv=gt(),D$=gt(),zE=gt(),BE=gt(),H4=gt();function Vxt(t,e,i,r,s,n,o,a){Di(rh,0,0);for(let E=0;E<4;++E)Tf(rh,rh,t[E]);Rh(rh,rh,.25),Di(VE,0,0);for(let E=4;E<8;++E)Tf(VE,VE,t[E]);Rh(VE,VE,.25),Xd(ox[0],t[4],t[5],.5),Xd(ox[1],t[5],t[6],.5),Xd(ox[2],t[6],t[7],.5),Xd(ox[3],t[7],t[4],.5);let l=0,c=wB(ox[0],rh);for(let E=1;E<4;++E){const M=wB(ox[E],rh);M<c&&(c=M,l=E)}Ng(ro,ox[l],t[l+4]);const u=ro[0];let d,f;ro[0]=-ro[1],ro[1]=u,Ng(N9,VE,rh),Wn(N9,ro)<0&&BRe(ro,ro),Xd(ro,ro,N9,i),JL(ro,ro),d=f=Wn(Ng(Iv,t[0],rh),ro);for(let E=1;E<8;++E){const M=Wn(Ng(Iv,t[E],rh),ro);M<d?d=M:M>f&&(f=M)}Ga(r,rh),Rh(Iv,ro,d-e),Tf(r,r,Iv);let m=-1,g=1,y=0,v=0;for(let E=0;E<8;++E){Ng(D$,t[E],r),JL(D$,D$);const M=ro[0]*D$[1]-ro[1]*D$[0];M>0?M>m&&(m=M,y=E):M<g&&(g=M,v=E)}TE(m>0,"leftArea"),TE(g<0,"rightArea"),Rh(zE,ro,d),Tf(zE,zE,rh),Rh(BE,ro,f),Tf(BE,BE,rh),H4[0]=-ro[1],H4[1]=ro[0];const b=JF(r,t[v],BE,Tf(Iv,BE,H4),1,s),w=JF(r,t[y],BE,Iv,1,n),x=JF(r,t[y],zE,Tf(Iv,zE,H4),1,o),T=JF(r,t[v],zE,Iv,1,a);TE(b,"rayRay"),TE(w,"rayRay"),TE(x,"rayRay"),TE(T,"rayRay")}function zi(t,e){return 3*e+t}const Cye=gt();function ru(t,e){return Di(Cye,t[e],t[e+3]),Cye}const yc=gt(),_t=Kr();function zxt(t,e,i,r,s){Ng(yc,i,r),Rh(yc,yc,.5),_t[0]=yc[0],_t[1]=yc[1],_t[2]=0,_t[3]=yc[1],_t[4]=-yc[0],_t[5]=0,_t[6]=yc[0]*yc[0]+yc[1]*yc[1],_t[7]=yc[0]*yc[1]-yc[1]*yc[0],_t[8]=1,_t[zi(0,2)]=-Wn(ru(_t,0),t),_t[zi(1,2)]=-Wn(ru(_t,1),t);let n=Wn(ru(_t,0),i)+_t[zi(0,2)],o=Wn(ru(_t,1),i)+_t[zi(1,2)],a=Wn(ru(_t,0),r)+_t[zi(0,2)],l=Wn(ru(_t,1),r)+_t[zi(1,2)];n=-(n+a)/(o+l),_t[zi(0,0)]+=_t[zi(1,0)]*n,_t[zi(0,1)]+=_t[zi(1,1)]*n,_t[zi(0,2)]+=_t[zi(1,2)]*n,n=1/(Wn(ru(_t,0),i)+_t[zi(0,2)]),o=1/(Wn(ru(_t,1),i)+_t[zi(1,2)]),_t[zi(0,0)]*=n,_t[zi(0,1)]*=n,_t[zi(0,2)]*=n,_t[zi(1,0)]*=o,_t[zi(1,1)]*=o,_t[zi(1,2)]*=o,_t[zi(2,0)]=_t[zi(1,0)],_t[zi(2,1)]=_t[zi(1,1)],_t[zi(2,2)]=_t[zi(1,2)],_t[zi(1,2)]+=1,n=Wn(ru(_t,1),e)+_t[zi(1,2)],o=Wn(ru(_t,2),e)+_t[zi(2,2)],a=Wn(ru(_t,1),i)+_t[zi(1,2)],l=Wn(ru(_t,2),i)+_t[zi(2,2)],n=-.5*(n/o+a/l),_t[zi(1,0)]+=_t[zi(2,0)]*n,_t[zi(1,1)]+=_t[zi(2,1)]*n,_t[zi(1,2)]+=_t[zi(2,2)]*n,n=Wn(ru(_t,1),e)+_t[zi(1,2)],o=Wn(ru(_t,2),e)+_t[zi(2,2)],a=-o/n,_t[zi(1,0)]*=a,_t[zi(1,1)]*=a,_t[zi(1,2)]*=a,s[0]=_t[0],s[1]=_t[1],s[2]=0,s[3]=_t[2],s[4]=_t[3],s[5]=_t[4],s[6]=0,s[7]=_t[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=_t[6],s[13]=_t[7],s[14]=0,s[15]=_t[8]}function Bxt(t,e,i,r,s){const n=1/zd[0][3],o=1/zd[4][3];bt(n<o);let a=n+Math.sqrt(n*o);const l=Math.sin(vo(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,Vxt(zd,a,l,bye,wye,Uxt,xye,Tye),zxt(bye,wye,xye,Tye,s.projectionMatrix),s.projectionMatrix[10]=2/(i-r),s.projectionMatrix[14]=-(i+r)/(i-r)}function jxt(t){let{near:e,far:i}=t;return e<2&&(e=2),i<2&&(i=2),e>=i&&(e=2,i=4),{near:e,far:i}}function Gxt(t){return bp(t)&&t.intersector===as.TERRAIN&&!!t.target}let Hxt=class extends eN{constructor(e,i,r){super(e,i),this.triangleNr=r}};function QFe(t){return bp(t)&&t.intersector===as.OVERLAY&&!!t.target}var bs,Jn;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(bs||(bs={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(Jn||(Jn={}));let KFe=class{constructor(e,i){this._material=e,this._repository=i,this._map=new Map}dispose(){this._map.forEach((e,i)=>{e!=null&&this._repository.release(this._material,i)})}load(e,i,r){const s=this._material.produces.get(i);if(!(s!=null&&s(r)))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,i,r));const n=this._map.get(r);if(n!=null){if(n.ensureResources(e)===ew.LOADED)return n;this._repository.requestRender()}return null}},BK=class extends QDe{constructor(e=C()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},Pae=class{constructor(e=0,i=0){this.from=e,this.to=i}get numElements(){return this.to-this.from}};function Mye(t){const e=new Map;t.forAll(r=>e.set(r.from,r));let i=!0;for(;i;){i=!1;for(let r=0;r<t.length;++r){const s=t.data[r],n=e.get(s.to);if(!n)return;s.to=n.to,e.delete(n.from),t.removeUnordered(n),i=!0}}}let Aye=class extends Pae{constructor(e,i,r){super(i,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.geometry.highlights!=null&&this.isVisible}get hasOccludees(){return this.geometry.occludees!=null}},qxt=class{constructor(){this.first=0,this.count=0}},Wxt=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new ai({allocator:e=>e||new Pae,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=q4(),this.drawCommandsHighlight=q4(),this.drawCommandsOccludees=q4(),this.drawCommandsShadowHighlightRest=q4()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,i){this.deleteInstance(e),this._instances.set(e,i),this._numElements+=i.numElements}deleteInstance(e){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,this._instances.delete(e))}updateInstance(e,i,r){const s=this._instances.get(e);s&&(this._numElements-=s.numElements,s.from=i,s.to=r,this._numElements+=s.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const r=this.drawCommandsDefault.pushNew(),s=this.holes.front();return this.vao!=null&&this.holes.length===1&&s.to===Math.floor(this.vao.byteSize/e)?(r.first=0,void(r.count=s.from)):(r.first=1/0,r.count=0,this._instances.forEach(n=>{r.first=Math.min(r.first,n.from),r.count=Math.max(r.count,n.to)}),void(r.count-=r.first))}const i=Array.from(this._instances.values()).sort((r,s)=>r.from===s.from?r.to-s.to:r.from-s.from);for(const r of i)r.isVisible&&(Pye(r.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,r),Pye(r.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,r))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function Zxt(t){return t.vao!=null}function q4(){return new ai({allocator:t=>t||new qxt,deallocator:t=>t})}function Pye(t,e){const i=t.back();if(i==null){const r=t.pushNew();return r.first=e.from,void(r.count=e.numElements)}if(Yxt(i,e)){const r=e.from-i.first+e.numElements;i.count=r}else{const r=t.pushNew();r.first=e.from,r.count=e.numElements}}function Yxt(t,e){return t.first+t.count>=e.from}let Xxt=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(i=>i.instances.has(e))}};const jK=-3,e4e=jK-1;var Ef;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(Ef||(Ef={}));let Jxt=class{constructor(e,i,r){this.name=e,this._storage=i,this.id=Qxt+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),r&&(this._storage.registerRemoveFunc(this.id,r),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,i,r,s=0){this._storage.put(this,e,i,r,s)}pop(e){const i=this._storage.pop(this,e);return i===void 0?++this._miss:++this._hit,i}get(e){const i=this._storage.get(this,e);return i===void 0?++this._miss:++this._hit,i}peek(e){return this._storage.peek(this,e)}updateSize(e,i,r){this._storage.updateSize(this,e,i,r)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},t4e=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new ai,this._users=new ai}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,i){this._removeFuncs.push([e,i])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(i=>i[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,i){const r=this._db.get(e.id+i);return(r==null?void 0:r.size)??0}put(e,i,r,s,n){i=e.id+i;const o=this._db.get(i);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(i),o.entry!==r&&this._notifyRemove(i,o.entry,o.size,Ef.ALL)),s>this._maxSize)return void this._notifyRemove(i,r,s,Ef.ALL);if(r===void 0)return void console.warn("Refusing to cache undefined entry ");if(!s||s<0)return console.warn(`Refusing to cache entry with size ${s} for key ${i}`),void this._notifyRemove(i,r,0,Ef.ALL);const a=1+Math.max(n,e4e)-jK;this._db.set(i,new Kxt(r,s,a)),this._size+=s,e.size+=s,this._checkSize()}updateSize(e,i,r,s){i=e.id+i;const n=this._db.get(i);if(n&&n.entry===r){for(this._size-=n.size,e.size-=n.size;s>this._maxSize;){const o=this._notifyRemove(i,r,s,Ef.SOME);if(!(o!=null&&o>0))return void this._db.delete(i);s=o}n.size=s,this._size+=s,e.size+=s,this._checkSize()}}pop(e,i){i=e.id+i;const r=this._db.get(i);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(i),++this._hit,r.entry;++this._miss}get(e,i){i=e.id+i;const r=this._db.get(i);if(r!==void 0)return this._db.delete(i),r.lives=r.lifetime,this._db.set(i,r),++this._hit,r.entry;++this._miss}peek(e,i){const r=this._db.get(e.id+i);return r?++this._hit:++this._miss,r==null?void 0:r.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;r[l]=(r[l]||0)+o.size,this._users.forAll(c=>{const{id:u,name:d}=c;if(a.startsWith(u)){const f=i[d]||0;i[d]=f+o.size}})});const s={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=i[a]||0;i[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(i);n.sort((o,a)=>i[a]-i[o]),n.forEach(o=>e[o]=Math.round(i[o]/2**20)+"MB / "+s[o]);for(let o=r.length-1;o>=0;--o){const a=r[o];a&&(e["Priority "+(o+jK-1)]=Math.round(a/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const i=e.id;this._db.forEach((r,s)=>{s.startsWith(i)&&(this._size-=r.size,this._db.delete(s),this._notifyRemove(s,r.entry,r.size,Ef.ALL))}),e.size=0}clearAll(){this._db.forEach((e,i)=>this._notifyRemove(i,e.entry,e.size,Ef.ALL)),this._users.forAll(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,i,r,s){let n;return this._removeFuncs.some(o=>{if(e.startsWith(o[0])){const a=o[1](i,s,r);return typeof a=="number"&&(n=a),!0}return!1}),n}_checkSize(){this._users.forAll(e=>this._checkSizeLimits(e)),this._checkSizeLimits()}_checkSizeLimits(e){const i=e??this;if(i.maxSize<0||i.size<=i.maxSize)return;const r=e==null?void 0:e.id;let s=!0;for(;s;){s=!1;for(const[n,o]of this._db)if(o.lifetime===0&&(!r||n.startsWith(r))){if(this._purgeItem(n,o,e),i.size<=.9*i.maxSize)return;s||(s=this._db.has(n))}}for(const[n,o]of this._db)if((!r||n.startsWith(r))&&(this._purgeItem(n,o,e),i.size<=.9*i.maxSize))return}_purgeItem(e,i,r=this._users.find(s=>e.startsWith(s.id))){if(this._db.delete(e),i.lives<=1){this._size-=i.size,r&&(r.size-=i.size);const s=this._notifyRemove(e,i.entry,i.size,Ef.SOME);s!=null&&s>0&&(this._size+=s,r&&(r.size+=s),i.lives=i.lifetime,i.size=s,this._db.set(e,i))}else--i.lives,this._db.set(e,i)}},Qxt=0,Kxt=class{constructor(e,i,r){this.entry=e,this.size=i,this.lifetime=r,this.lives=r}},DN=class{constructor(e,i){this._cache=e(i,(r,s,n)=>{switch(s){case Ef.ALL:return r.forEach(o=>o.dispose()),0;case Ef.SOME:{const o=r.shift();return o&&(n-=Math.round(o.usedMemory),o.dispose()),n}}})}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(e){return this._cache.getSize(e)}pop(e){const i=this._cache.peek(e);if(!i)return;const r=i.pop();if(i.length>0){if(r){const s=this._cache.getSize(e)-Math.round(r.usedMemory);this._cache.updateSize(e,i,s)}}else this._cache.pop(e);return r}put(e,i,r=e4e){const s=this._cache.peek(e);if(!s)return void this._cache.put(e,[i],i.usedMemory,r);s.push(i);const n=this._cache.getSize(e)+Math.round(i.usedMemory);this._cache.updateSize(e,s,n)}},eTt=class{constructor(e,i,r){this._rctx=e,this._locations=i,this._layout=r,this._cache=new DN(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const i=e.toString();let r=this._cache.pop(i);return r||(r=new Dy(this._rctx,this._locations,{geometry:this._layout},{geometry:Cr.createVertex(this._rctx,hr.STATIC_DRAW)}),r.vertexBuffers.geometry.setSize(e),r)}deleteVao(e){if(e==null)return;const i=e.byteSize.toString();this._cache.put(i,e)}},J3=class extends D3e{constructor(e){super(e),this._vaoCache=null,this._glMaterials=null,this._bufferWriter=null,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._produces=new Map,this.drapedPriority=0}destroy(){this._glMaterials=Ut(this._glMaterials),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache=Ut(this._vaoCache)}initialize(){this.material.produces.forEach((e,i)=>{this._produces.set(i,r=>!(this._dataByOrigin.size===0||!(r!==G.Highlight&&r!==G.ShadowHighlight||this._hasHighlights))&&e(r))})}get produces(){return this._produces}initializeRenderContext(e,i){const{rctx:r}=e.renderContext;this._glMaterials=new KFe(this.material,i??e.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=new eTt(r,this.material.vertexAttributeLocations,Xu(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get hasOccludees(){return this._hasOccludees}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get materialReference(){return this.material}get numGeometries(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,s)=>r+s.instances.size,0)),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,s)=>r+s.vao.usedMemory,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(i=>i.buffers.forEach(r=>r.instances.forEach(s=>e(s.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const i=this._bufferWriter;if(i===null)return;const r=i.vertexBufferLayout.stride/4;for(const s of e){const n=s.renderGeometry,o=this._dataByOrigin.get(n.localOrigin.id),a=o==null?void 0:o.findBuffer(n.id);if(a==null)return;const l=a.instances.get(n.id);if(s.updateType&(Jn.GEOMETRY|Jn.TRANSFORMATION)){const c=Y4(i.elementCount(l.geometry.geometry)*r),u=i.vertexBufferLayout.createView(c.buffer);this._writeGeometry(n,u,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*r,0,l.numElements*r)}s.updateType&(Jn.HIGHLIGHT|Jn.OCCLUDEE|Jn.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,i){const r=new sw;for(const s of e){const n=s.localOrigin;if(n==null)continue;let o=r.get(n.id,null);o==null&&(o=new Oye(n.vec3),r.set(n.id,null,o)),o.changes.push(s)}for(const s of i){const n=s.localOrigin;if(n==null)continue;const o=this._dataByOrigin.get(n.id),a=o==null?void 0:o.findBuffer(s.id);if(a==null)continue;let l=r.get(n.id,a);l==null&&(l=new Oye(n.vec3),r.set(n.id,a,l)),l.changes.push(s)}return r}_addAndRemoveGeometries(e,i){if(this._bufferWriter===null||this._vaoCache===null)return;const{_bufferWriter:r,_dataByOrigin:s}=this,n=r.vertexBufferLayout.stride/4,o=this._computeDeltas(e,i);o.forEach((a,l)=>{const c=a.get(null),u=c!=null?c.changes:[];o.delete(l,null);let d=s.get(l);if(a.forEach((f,m)=>{if(o.delete(l,m),m==null)return void bt(!1,"No VAO for removed geometries");if(m.instances.size===f.changes.length)return this._vaoCache.deleteVao(m.vao),TL(d.buffers,m),void(d.buffers.length===0&&u.length===0&&s.delete(l));const g=m.numElements,y=m.vao.byteSize/4,v=u.reduce((T,E)=>T+r.elementCount(E.geometry),0),b=f.changes.reduce((T,E)=>T+r.elementCount(E.geometry),0),w=Math.min((g+v-b)*n,Z4),x=w>y;w>hj&&w<y/2?(f.changes.forEach(({id:T})=>m.deleteInstance(T)),m.instances.forEach(({geometry:T})=>u.push(T)),this._vaoCache.deleteVao(m.vao),TL(d.buffers,m)):x?this._applyAndRebuild(m,u,f):this._applyRemoves(m,f)}),u.length>0)for(d==null&&(d=new Xxt(c.origin),s.set(l,d)),d.buffers.forEach(f=>this._applyAdds(f,u));u.length>0;)d.buffers.push(this._applyAndRebuild(new Wxt,u,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(i=>{i.drawCommandsDirty&&(i.hasHiddenInstances=!1,i.hasHighlights=!1,i.hasOccludees=!1,Fh(i.instances,r=>(i.updateDrawState(r),i.hasHiddenInstances&&i.hasHighlights&&i.hasOccludees)),i.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||i.hasHighlights,this._hasOccludees=this._hasOccludees||i.hasOccludees})})}_applyAndRebuild(e,i,r){if(r!=null)for(const g of r.changes)e.deleteInstance(g.id);const s=this._bufferWriter,n=s.vertexBufferLayout.stride,o=n/4,a=Math.floor(Z4/o);let l=e.numElements;for(;i.length>0;){const g=i.pop(),y=s.elementCount(g.geometry);if(l+y>a&&l>0){i.push(g);break}l+=y;const v=new Aye(g,0,0);bt(e.instances.get(g.id)==null),e.addInstance(g.id,v)}const c=l*o,u=Y4(c),d=s.vertexBufferLayout.createView(u.buffer);let f=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((g,y)=>{this._writeGeometry(g.geometry,d,f);const v=f;f+=s.elementCount(g.geometry.geometry),e.updateInstance(y,v,f),e.updateDrawState(g)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Iye(c)),e.vao.vertexBuffers.geometry.setSubData(u,0,0,f*o),e.holes.clear();const m=e.holes.pushNew();return m.from=f,m.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(n),e}_applyRemoves(e,i){if(i.changes.length===0||this._bufferWriter===null)return;for(const a of i.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const u=Om.back();if(u){if(u.to===c.from){u.to=c.to;continue}if(u.from===c.to){u.from=c.from;continue}}const d=Om.pushNew();d.from=c.from,d.to=c.to}Mye(Om);const r=this._bufferWriter.vertexBufferLayout.stride/4,s=Om.reduce((a,l)=>Math.max(a,l.numElements),0)*r,n=Y4(s);n.fill(0,0,s);const o=e.vao.vertexBuffers.geometry;Om.forAll(a=>o.setSubData(n,a.from*r,0,a.numElements*r)),e.holes.pushArray(Om.data,Om.length),Om.forAll((a,l)=>Om.data[l]=null),Om.clear(),e.drawCommandsDirty=!0}_applyAdds(e,i){if(i.length===0||this._bufferWriter===null)return;if(!Zxt(e))return void this._applyAndRebuild(e,i,null);const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,n=e.numElements,o=i.reduce((b,w)=>b+r.elementCount(w.geometry),0),a=Math.min((n+o)*s,Z4),l=4*a;if(e.vao.byteSize<Iye(Z4-hj)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,i,null);Mye(e.holes);const c=new Array;for(const b of i){const w=r.elementCount(b.geometry),x=tTt(e.holes,w);c.push(x)}const u=e.vao.vertexBuffers.geometry;let d=0,f=0,m=0;const g=Y4(a),y=r.vertexBufferLayout.createView(g.buffer);i.forEach((b,w)=>{const x=c[w];if(x==null)return;if(m!==x){const M=m-f;M>0&&u.setSubData(g,f*s,0,M*s),f=x,d=0}const T=r.elementCount(b.geometry);this._writeGeometry(b,y,d),d+=T,m=x+T;const E=new Aye(b,x,x+T);bt(e.instances.get(b.id)==null),e.addInstance(b.id,E),e.drawCommandsDirty=!0});const v=m-f;v>0&&u.setSubData(g,f*s,0,v*s),oHe(i,(b,w)=>c[w]==null)}_writeGeometry(e,i,r){if(this._bufferWriter===null)return;const s=e.localOrigin.vec3;Iut($ye,-s[0],-s[1],-s[2]);const n=vr(iTt,$ye,e.transformation);eo(W4,n),Hu(W4,W4),this._bufferWriter.write(n,W4,e.geometry,i,r)}updateAnimation(e){return this.material.update(e)}prepareTechnique(e){if(!this.material.shouldRender(e))return null;const{output:i,bindParameters:r}=e,s=this.material.produces.get(r.slot);if(!(s!=null&&s(i)))return null;const n=i===G.Highlight||i===G.ShadowHighlight;if(n&&!this._hasHighlights)return null;const o=i===G.ShadowExcludeHighlight,a=!(n||o);for(const l of this._dataByOrigin.values())for(const c of l.buffers){if(n&&!c.hasHighlights)continue;const u=(n?c.drawCommandsHighlight:o&&c.needsMultipleCommands()?c.drawCommandsShadowHighlightRest:c.drawCommandsDefault)||null,d=a&&c.drawCommandsOccludees||null;if(u!=null&&u.length||d!=null&&d.length){const f=this._glMaterials.load(e.rctx,r.slot,i),m=f!=null?f.beginSlot(r):null;if(m!=null)return m}}return null}renderNode(e,i){const{output:r,bindParameters:s}=e,n=r===G.Highlight||r===G.ShadowHighlight,o=r===G.ShadowExcludeHighlight,a=!(n||o),l=s.slot===Pe.OCCLUDER_MATERIAL,c=s.slot===Pe.TRANSPARENT_OCCLUDER_MATERIAL,u=e.rctx;u.runAppleAmdDriverHelper(),u.bindTechnique(i,s,this.material.parameters);for(const d of this._dataByOrigin.values())for(const f of d.buffers){if(n&&!f.hasHighlights)continue;const m=(n?f.drawCommandsHighlight:o&&f.needsMultipleCommands()?f.drawCommandsShadowHighlightRest:f.drawCommandsDefault)||null,g=a&&f.drawCommandsOccludees||null;(m!=null&&m.length||g!=null&&g.length)&&(i.program.bindDraw(new BK(d.origin),s,this.material.parameters),i.ensureAttributeLocations(f.vao),u.bindVAO(f.vao),m!=null&&m.length&&(u.setPipelineState(i.getPipeline(!1,l,c)),m.forAll(y=>u.drawArrays(i.primitiveType,y.first,y.count))),g!=null&&g.length&&(u.setPipelineState(i.getPipeline(!0,l,c)),g.forAll(y=>u.drawArrays(i.primitiveType,y.first,y.count))))}}get test(){}};h([p({constructOnly:!0})],J3.prototype,"material",void 0),J3=h([I("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],J3);let Oye=class{constructor(e){this.origin=e,this.changes=new Array}};function tTt(t,e){let i;if(!t.some(s=>!(s.numElements<e)&&(i=s,!0)))return null;const r=i.from;return i.from+=e,i.from>=i.to&&t.removeUnordered(i),r}const $ye=ke(),iTt=ke(),W4=ke(),Om=new ai({allocator:t=>t||new Pae,deallocator:null}),hj=65536,F9=4*hj,Rye=1024,i4e=16777216,Z4=i4e/4;let k9=new Float32Array(hj);function Y4(t){return k9.length<t&&(k9=new Float32Array(t)),k9}function Iye(t){const e=4*t;return e<=Rye?Rye:e<F9?DCe(e):Math.max(Math.min(Math.ceil(1.5*e/F9)*F9,i4e),e)}let vh=class extends Ue{constructor(e){super(e),this._pending=new rTt,this._changes=new fQ,this._materialRenderers=new Map,this._sortedMaterialRenderers=new ai,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.destroy()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materials(){return this.rendererContext.materials}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){return Fh(this._materialRenderers,e=>e.numGeometries!==0&&!e.queryRenderOccludedState(ir.Occlude))}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}getMaterialRenderer(e){return this._materialRenderers.get(e)}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=jIe(this._changes);let i=!1;return e.forEach((r,s)=>{let n=this.getMaterialRenderer(s);if(!n&&r.adds.length>0){const o=new J3({material:s});o.initializeRenderContext(this.rendererContext.pluginContext,this._materials),n=o,this._materialRenderers.set(s,n),i=!0}n&&(n.modify(r),n.numGeometries===0&&(this._materialRenderers.delete(s),n.destroy(),i=!0))}),this._changes.clear(),i&&this._updateSortedMaterialRenderers(),this._hasHighlights=Fh(this._materialRenderers,r=>{const s=r.produces.get(Pe.DRAPED_MATERIAL);return!!s&&s(G.Highlight)}),this._hasWater=Fh(this._materialRenderers,r=>{const s=r.produces.get(Pe.DRAPED_WATER);return!!s&&s(G.Normal)}),this.notifyChange("updating"),!0}addGeometries(e,i){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const n of r)this._geometries.set(n.id,n);const s=this._pending.empty;for(const n of r)this._pending.adds.add(n);s&&this.notifyChange("updating"),i===bs.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,i){const r=this._pending.empty,s=this._pending.adds;for(const n of e)s.has(n)?(this._pending.removed.add(n),s.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);r&&!this._pending.empty&&this.notifyChange("updating"),i===bs.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,i){const r=this._changes.updates.length===0;for(const s of e){const n=this._changes.updates.pushNew();n.renderGeometry=this._validateRenderGeometry(s),n.updateType=i}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),i){case Jn.TRANSFORMATION:case Jn.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case Jn.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let i=!1;return this._sortedMaterialRenderers.forAll(r=>i=!!r.updateAnimation&&r.updateAnimation(e)||i),i}shouldRender(e){return this._sortedMaterialRenderers.some(i=>i.prepareTechnique(e))}render(e){this._sortedMaterialRenderers.forAll(i=>{const r=i.prepareTechnique(e);r!=null&&i.renderNode(e,r)})}intersect(e,i,r,s,n){return this._geometries.forEach(o=>{if(s&&!s(o))return;this._intersectRenderGeometry(o,r,i,0,e,n);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,r,i,a.range,e,n),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,r,i,-a.range,e,n)),n++}),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;for(const i of this._materialRenderers.values())i.drapedPriority=e++,this._sortedMaterialRenderers.push(i);this._sortedMaterialRenderers.sort((i,r)=>{var s,n,o,a;return((s=r.materialReference)==null?void 0:s.renderPriority)===((n=i.materialReference)==null?void 0:n.renderPriority)?i.drapedPriority-r.drapedPriority:(((o=r.materialReference)==null?void 0:o.renderPriority)||0)-(((a=i.materialReference)==null?void 0:a.renderPriority)||0)})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const i=this._changes.updates.data[e];this._pending.has(i.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,i,r,s,n,o){if(!e.visible)return;let a=0;s+=e.transformation[12],a=e.transformation[13],U9[0]=r[0]-s,U9[1]=r[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,U9,(l,c,u)=>{sTt(i,u,o,e.material.renderPriority,n,e.layerUid,e.graphicUid)},i)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let i;for(const r of e){const s=r.graphicUid;s!=null&&s!==i&&(this.drapeSource.notifyGraphicGeometryChanged(s),i=s)}}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let i;for(const r of e){const s=r.graphicUid;s!=null&&s!==i&&(this.drapeSource.notifyGraphicVisibilityChanged(s),i=s)}}_validateRenderGeometries(e){for(const i of e)this._validateRenderGeometry(i);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){}};h([p()],vh.prototype,"drapeSource",void 0),h([p()],vh.prototype,"updating",null),h([p()],vh.prototype,"rctx",null),h([p({constructOnly:!0})],vh.prototype,"rendererContext",void 0),h([p()],vh.prototype,"_materials",null),h([p()],vh.prototype,"_localOriginFactory",null),h([p({readOnly:!0})],vh.prototype,"isEmpty",null),h([p()],vh.prototype,"_materialRenderers",void 0),h([p()],vh.prototype,"_geometries",void 0),vh=h([I("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],vh);let rTt=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function sTt(t,e,i,r,s,n,o){const a=new Hxt(n,o,e),l=c=>{c.set(as.OVERLAY,a,t.dist,t.normal,t.transformation,i,r)};if((s.results.min.drapedLayerOrder==null||i>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==fa.MIN&&(s.results.max.drapedLayerOrder==null||i<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===fa.ALL){const c=rne(s.ray);l(c),s.results.all.push(c)}}const U9=gt();let Oae=class r4e extends Ki{initializeProgram(e){return new er(e.rctx,r4e.shader.get().build(),Pi)}initializePipeline(){return this.configuration.hasAlpha?Kt({blending:_a(Be.SRC_ALPHA,Be.ONE,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),colorWrite:ui}):Kt({colorWrite:ui})}};Oae.shader=new qi(vwt,()=>oe(()=>Promise.resolve().then(()=>$9t),void 0));let $ae=class extends uc{constructor(){super(...arguments),this.hasAlpha=!1}};h([j()],$ae.prototype,"hasAlpha",void 0);let Rae=class extends Ur{constructor(){super(...arguments),this.overlayIndex=In.INNER,this.opacity=1}};function s4e(){const t=new Hi;return t.include(qa),t.fragment.uniforms.add(new xt("tex",e=>e.texture)),t.fragment.uniforms.add(new UO("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new tt("opacity",e=>e.opacity)),t.fragment.code.add(S`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),t}const nTt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:Rae,build:s4e},Symbol.toStringTag,{value:"Module"}));let n4e=class o4e extends Ki{initializeProgram(e){return new er(e.rctx,o4e.shader.get().build(),Pi)}initializePipeline(){return Kt({blending:rd(Be.ONE,Be.ONE_MINUS_SRC_ALPHA),colorWrite:ui})}};n4e.shader=new qi(nTt,()=>oe(()=>Promise.resolve().then(()=>R9t),void 0));let Ad=class extends poe{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new Rae,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new ai,this._passParameters=new Tae,this._materials=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new Fr,this.worldToPCSRatio=1,this.events=new Ls,this.longitudeCyclical=null,this.produces=new Map([[Pe.DRAPED_MATERIAL,i=>i!==G.Highlight||this.hasHighlights],[Pe.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this.view._stage.renderer.fboCache,i=this.view._stage.renderView,{waterTextures:r,stippleTextures:s,markerTextures:n}=i;this._techniques=new wFe({rctx:this._rctx,viewingMode:Je.Local,stippleTextures:s,markerTextures:n,waterTextures:r}),this._renderContext=new JFe(this._rctx,new Aae(e,this.view.state.viewingMode),null),this.addHandles([te(()=>r.updating,()=>this.events.emit("content-changed"),pr),te(()=>this.spatialReference,o=>this._localOriginFactory=new XFe(o),pr),on(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materials=new xFe(i.textures,this._techniques,()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=Pe.DRAPED_MATERIAL,this._bindParameters.mainDepth=null,this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=ft.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new Qne(qe(1,1,1))]),this.addHandles(this.view.resourceController.scheduler.registerTask(It.STAGE,this))}destroy(){this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=hi(this._debugTextureTechnique),this._passParameters.texture=Ut(this._passParameters.texture),this._techniques=He(this._techniques),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initializeRenderContext(e){this.pluginContext=e}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||Fh(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._renderTargets!=null}getMaterialRenderer(e){for(const i of this._renderers.values()){const r=i.getMaterialRenderer(e);if(r)return r}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map(e=>e.drapeSource.layer).filter(e=>!!e)}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,vh)}createDrapeSourceRenderer(e,i,r){const s=this._renderers.get(e);s!=null&&s.destroy();const n=new i({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles(te(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),n}removeDrapeSourceRenderer(e){if(e==null)return;const i=this._renderers.get(e);i!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),i.destroy())}computeValidity(){var e;return((e=this._renderTargets)==null?void 0:e.computeValidity())??0}releaseRenderTargets(){var e;(e=this._renderTargets)==null||e.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&Dk(e,i=>i.drapeTargetType===UK.WithoutRasterImage)}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=Dk(e,i=>i.drapeSourceType===Z3.Features),this._hasDrapedRasterSource=Dk(e,i=>i.drapeSourceType===Z3.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,i,r=this._bindParameters.overlayStretch){this._overlays==null&&(this._renderTargets=new lwt(this.view._stage.renderer.fboCache),this._overlays=[new oye,new oye]),this.ensureDrapeTargets(e),this.ensureDrapeSources(i),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets=Ut(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){var i,r;if(e!=null)return e===os.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?(i=this._renderTargets)==null?void 0:i.getTexture(os.Color):(r=this._renderTargets)==null?void 0:r.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,i){let r=!1;for(const[s,n]of this._renderers){if(e.done)break;(s.destroyed||i(s))&&n.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=Fh(this._renderers,s=>s.hasHighlights),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(Nu,e=>e.updatePolicy===Ab.SYNC)}get isEmpty(){return!kr.OVERLAY_DRAW_DEBUG_TEXTURE&&!Fh(this._renderers,e=>!e.isEmpty)}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=dj;const i=this._sortedRenderers.some(({renderer:r})=>r.shouldRender(this._renderContext));return this._renderContext.renderOccludedMask=e,i}renders(e){return kr.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==os.Occluded||this._sortedRenderers.some(({renderer:i})=>i.shouldRender(this._renderContext))}get mode(){var e,i;return this.isEmpty?Zg.Disabled:(e=this._renderTargets)!=null&&e.getTexture(os.WaterNormal)?Zg.EnabledWithWater:(i=this._renderTargets)!=null&&i.getTexture(os.Color)?Zg.Enabled:Zg.Disabled}updateAnimation(e){let i=!1;return this._renderers.forEach(r=>i=r.updateAnimation(e)||i),i}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const i of this._overlays)this.longitudeCyclical?i.setupGeometryViewsCyclical(this.longitudeCyclical):i.setupGeometryViewsDirect();for(const i of this._renderTargets.targets){if(i.content===os.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const r=this._drawTarget(In.INNER,i,e),s=this._drawTarget(In.OUTER,i,e);(r||s)&&i.fbo.generateMipMap()}}}_drawTarget(e,i,r){const s=this._overlays[e],n=s.canvasGeometries;if(n.numViews===0)return!1;const{alignPixelEnabled:o,contentPixelRatio:a}=r;this._screenToWorldRatio=a*s.mapUnitsPerPixel/this._bindParameters.overlayStretch;const l=i.output;if(this.isEmpty||l===G.Highlight&&!this.hasHighlights||l===G.Normal&&!this.hasWater||!s.hasSomeSizedView())return!1;const c=this._rctx;if(this._camera.pixelRatio=s.pixelRatio*a,this._renderContext.output=l,this._bindParameters.alignPixelEnabled=o,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=l===G.Normal?Pe.DRAPED_WATER:Pe.DRAPED_MATERIAL,i.content===os.Occluded&&(this._renderContext.renderOccludedMask=dj),!this.renders(i.content))return this._renderContext.renderOccludedMask=uj,!1;const u=s.resolution;this._rctx.setViewport(e===In.INNER?0:u,0,u,u);const d=2*s.resolution,f=s.resolution,m=i.fbo;if(m.bind(c,d,f),e===In.INNER&&(c.setClearColor(0,0,0,0),c.clear(jr.COLOR_BUFFER_BIT)),kr.OVERLAY_DRAW_DEBUG_TEXTURE&&i.content!==os.Occluded)for(let g=0;g<n.numViews;g++)this._setViewParameters(n.extents[g],s),this._ensureDebugPatternResources(s.resolution,aTt[e]),this._rctx.bindTechnique(this._debugTextureTechnique,this._renderContext.bindParameters,this._passParameters),this._rctx.screen.draw();return this._sortedRenderers.forAll(({drapeSource:g,renderer:y})=>{if(i.content===os.ColorNoRasterImage&&g.drapeSourceType===Z3.RasterImage)return;const{fullOpacity:v}=g,b=v!=null&&v<1&&l===G.Color?this.bindTemporaryFramebuffer(d,f):null;for(let w=0;w<n.numViews;w++)this._setViewParameters(n.extents[w],s),y.render(this._renderContext);if(b){m.bind(c,d,f),this._overlayParameters.texture=b.getTexture(),this._overlayParameters.opacity=v,this._overlayParameters.overlayIndex=e;const w=this.pluginContext.techniques.acquire(n4e);this._rctx.bindTechnique(w,this._renderContext.bindParameters,this._overlayParameters),this._rctx.screen.draw(),w.release(),b.release()}}),c.bindFramebuffer(null),this._renderContext.renderOccludedMask=uj,!0}bindTemporaryFramebuffer(e,i){var n;const r=this.view._stage.renderer.fboCache,s=r.acquire(e,i,"overlay tmp");return r.rctx.unbindTexture((n=s.fbo)==null?void 0:n.colorTexture),r.rctx.bindFramebuffer(s.fbo),r.rctx.clear(jr.COLOR_BUFFER_BIT),s}async reloadShaders(){await this._techniques.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,i,r,s){var o;this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let n=0;for(const{renderer:a}of this._sortedRenderers)n=((o=a.intersect)==null?void 0:o.call(a,e,i,r,s,n))??n}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers,i=e.length;this._renderers.forEach((r,s)=>{const n=e.indexOf(s.layer),o=n>=0,a=s.renderGroup??(o?sj.MapLayer:sj.ViewLayer),l=i*a+(o?n:0);this._sortedRenderers.push(new oTt(s,r,l))}),this._sortedRenderers.sort((r,s)=>r.index-s.index)}_setViewParameters(e,i){const r=this._camera;r.viewport=[0,0,i.resolution,i.resolution],XCe(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),z2(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=Fh(this._renderers,i=>i.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_ensureDebugPatternResources(e,i){if(pe(this._passParameters.color,i[0],i[1],i[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let s=0;for(let a=0;a<e;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),u=Math.floor(a/10);c<2||u<2||10*c>e-20||10*u>e-20?(r[s++]=255,r[s++]=255,r[s++]=255,r[s++]=255):(r[s++]=255,r[s++]=255,r[s++]=255,r[s++]=1&c&&1&u?1&l^1&a?0:255:1&c^1&u?0:128)}const n=new es(e);n.samplingMode=di.NEAREST,this._passParameters.texture=new Mr(this._rctx,n,r);const o=new $ae;o.hasAlpha=!0,this._debugTextureTechnique=this._techniques.acquire(Oae,o)}get test(){}};h([p()],Ad.prototype,"hasHighlights",void 0),h([p()],Ad.prototype,"_sortedDrapeSourceRenderersDirty",void 0),h([p()],Ad.prototype,"_techniques",void 0),h([p({constructOnly:!0})],Ad.prototype,"view",void 0),h([p()],Ad.prototype,"worldToPCSRatio",void 0),h([p()],Ad.prototype,"spatialReference",void 0),h([p({type:Boolean,readOnly:!0})],Ad.prototype,"updating",null),h([p()],Ad.prototype,"isEmpty",null),h([p({readOnly:!0})],Ad.prototype,"rendersOccludedDraped",null),Ad=h([I("esri.views.3d.terrain.OverlayRenderer")],Ad);let oTt=class{constructor(e,i,r){this.drapeSource=e,this.renderer=i,this.index=r}};const aTt=[[1,.5,.5],[.5,.5,1]],Iae=-2,dj=ir.OccludeAndTransparent;function Lae(t,e,i,r){const s=IN(t.rings,!!t.hasZ&&r.mode!=="on-the-ground",Sy.CCW_IS_HOLE,t.spatialReference),n=go(s.position.length),o=xDe(s.position,t.spatialReference,0,n,0,s.position,0,s.position.length/3,e,i,r),a=o!=null;return new uTt(s.position,n,c4e(s.polygons,s.position,n),l4e(s.outlines,s.position,n),a,o)}function a4e(t,e){const i=IN(t.rings,!1,Sy.CCW_IS_HOLE),r=gs(i.position,t.spatialReference,0,i.position,e,0,i.position.length/3);for(let s=2;s<i.position.length;s+=3)i.position[s]=Iae;return{position:i.position,polygons:c4e(i.polygons,i.position),outlines:l4e(i.outlines,i.position),projectionSuccess:r}}function l4e(t,e,i=null){return t.filter(({count:r})=>r>1).map(({index:r,count:s})=>{const n=3*r,o=3*s;return i!=null?new u4e(r,s,up(e,n,o),up(i,n,o)):new Dae(r,s,up(e,n,o))})}function c4e(t,e,i=null){const r=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of t){if(n<=1)continue;const l=3*s,c=3*n,u=o.map(f=>f-s),d=i!=null?new lTt(s,n,up(e,3*s,3*n),up(i,l,c),u,a):new cTt(s,n,up(e,3*s,3*n),u,a);r.push(d)}return r}let Dae=class{constructor(e,i,r){this.index=e,this.count=i,this.position=r}},u4e=class extends Dae{constructor(e,i,r,s){super(e,i,r),this.mapPositions=s}},lTt=class extends u4e{constructor(e,i,r,s,n,o){super(e,i,r,s),this.holeIndices=n,this.pathLengths=o}},cTt=class extends Dae{constructor(e,i,r,s,n){super(e,i,r),this.holeIndices=s,this.pathLengths=n}},uTt=class{constructor(e,i,r,s,n,o){this.position=e,this.mapPositions=i,this.polygons=r,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=o}};function vp(t,e,i,r,s,n=2){const o=1/(Math.abs(i)+Math.abs(r)+Math.abs(s)),a=i*o,l=r*o,c=s<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,u=s<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,d=e*n;t[d]=Lye(c),t[d+1]=Lye(u)}function hTt(t){const e=t.length/3,i=new Int16Array(2*e);let r=0;for(let s=0;s<e;++s)vp(i,s,t[r++],t[r++],t[r++]);return i}function Dsi(t,e){const i=t.length/3,r=new Int16Array(2*i);let s=0;const n=C();for(let o=0;o<i;++o)n[0]=t[s++],n[1]=t[s++],n[2]=t[s++],ca(n,n,e),vp(r,o,n[0],n[1],n[2]);return r}function dTt(t,e,i,r=2){const s=i*r,n=Dye(e[s]),o=Dye(e[s+1]),a=1-Math.abs(n)-Math.abs(o);t[2]=a,a<0?(t[0]=(n>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(n))):(t[0]=n,t[1]=o),Ce(t,t)}function Lye(t){return Ne(Math.round(32767*t),-32767,32767)}function Dye(t){return Ne(t/32767,-1,1)}const pTt=["polygon","extent"];let fTt=class extends zy{constructor(e,i,r,s){super(e,i,r,s),this.ensureDrapedStatus(!1)}async doLoad(){var a,l;if(!this._drivenProperties.size){const c=n8(this._getSymbolSize());if(c)throw new B("graphics3dextrudesymbollayer:invalid-size",c)}const e=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,i=this._getCombinedOpacityAndColor(e),r=Xl(i),s=i[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:s,transparent:n,cullFace:n?Gr.None:Gr.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:or.Compressed};this._materials[bh.Main]=new gm(o),this._materials[bh.Bottom]=new gm({...o,cullFace:Gr.Back}),this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,pTt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(i);return this._createAs3DShape(i,e.renderingInfo,r,s,i.uid)}layerOpacityChanged(e,i){var a,l,c,u;const r=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,s=this._getCombinedOpacity(r),n=s<1||this.needsDrivenTransparentPass;(c=this._materials[bh.Main])==null||c.setParameters({opacity:s,transparent:n}),(u=this._materials[bh.Bottom])==null||u.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();e.forEach(d=>{const f=i(d);f!=null&&f.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,ow)}slicePlaneEnabledChanged(e,i){var r,s;return(r=this._materials[bh.Main])==null||r.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),(s=this._materials[bh.Bottom])==null||s.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(n=>{const o=i(n);o!=null&&o.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){var i,r;const e={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return(i=this._materials[bh.Main])==null||i.setParameters(e),(r=this._materials[bh.Bottom])==null||r.setParameters(e),!0}_getExtrusionSize(e){let i;return i=e.size&&this._drivenProperties.size?Xbt(e.size,2)??0:this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(e,i){return this._drivenPropertiesChanged(i)?mn.RecreateSymbol:mn.RecreateGraphics}async queryForSnapping(e,i,r,s){const n=this._getExtrusionSize(r)*this._context.renderCoordsHelper.unitInMeters/M_(i),{objectId:o,target:a}=e,l=re(a);switch(l.z=(l.z??0)+n,e.type){case"edge":{const{start:c,end:u}=e,d=re(c),f=re(u);return d.z=(d.z??0)+n,f.z=(f.z??0)+n,[tye(o,l,1/0,d,f)]}case"vertex":return[Nbt(o,l,1/0),tye(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,i,r,s,n){const o=uD(e.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some(k=>k.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=Lae(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=Zoe(o);if(l==null)return null;const c=new Array,u=new Array,d=io(),f=ke(),m=C(),g=this._context.renderCoordsHelper.viewingMode===Je.Global;g||this._context.renderCoordsHelper.worldUpAtPosition(null,m),Gh(o.spatialReference,[l.x,l.y,0],f,this._context.renderCoordsHelper.spatialReference);const y=ke();eo(y,f);const v=Kr();Yb(v,y);const{polygons:b,mapPositions:w,position:x}=a,T=new Map,E=this._materials[bh.Main];for(const k of b){const H=k.count;if(this._context.clippingExtent&&(Qr(d),Uh(d,k.mapPositions),!Gf(d,this._context.clippingExtent)))continue;const V=XP(k.mapPositions,k.holeIndices,3);if(V.length===0)continue;const X=V.length,q=6*H,Z=$B(q+X),ye=$B(X),L=go(3*q),N=go(3*q),z=go(3*q),W=go(q);mTt(x,w,V,k,L,z,N,W,Z,ye,this._getExtrusionSize(i),m,g),lw(L,L,y);const J=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),ee=new STt(L,z,hTt(N),W),ae=Nye(E,Z,Z.length-ye.length,ee,r,J),we=H,Ie=H,Ge=2*k.count,ut=new ETt(we,Ie,Ge,X/3);h4e(ae,ut,f),T.set(ae,ut),c.push(ae,Nye(this._materials[bh.Bottom],ye,0,ee,r,J)),u.push(ee.heights)}if(c.length===0)return null;const M=new Ow({geometries:c,layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0});M.transformation=f;const O=jDe(this.symbolLayer,{opacity:this._getLayerOpacity()}),D=O!=null?{baseMaterial:this._materials[bh.Main],edgeMaterials:[O],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,U=new Vy(this,M,c,null,null,(k,H,V,X,q)=>_Tt(k,H,V,X,q,u,T),s,D);return U.alignedSampledElevation=a.sampledElevation,U.needsElevationUpdates=ow(s.mode),U}};function Nye(t,e,i,r,s,n){const o=Ew(e.length),a=[[$.POSITION,new ht(r.positions,e,3,!0)],[$.NORMALCOMPRESSED,new ht(r.normals,e,2,!0)],[$.COLOR,new ht(s,o,4,!0)]];return new Pn(t,a,r.elevation,Gs.Mesh,n,i)}function mTt(t,e,i,r,s,n,o,a,l,c,u,d,f){{const m=i.length/3,g=2*r.count;gTt(t,e,r.index,r.count,i,0,m,s,n,o,a,l,c,g,u,d,f)}{let m=0,g=2*r.count,y=0;const v=r.pathLengths[0];Fye(s,n,a,o,m,v,r.count,g,l,y,u),g+=4*v,y+=2*v,m+=v;for(let b=1;b<r.pathLengths.length;++b){const w=r.pathLengths[b];Fye(s,n,a,o,m,w,r.count,g,l,y,u),g+=4*w,y+=2*w,m+=w}}}function gTt(t,e,i,r,s,n,o,a,l,c,u,d,f,m,g,y,v){ve(dh,y);{const b=g>0?1:-1;let w=3*i,x=0,T=3*x,E=r,M=3*E;for(let O=0;O<r;++O){const D=t[w],U=t[w+1],k=t[w+2];v&&(dh[0]=D,dh[1]=U,dh[2]=k,Ce(dh,dh)),a[T+0]=D,a[T+1]=U,a[T+2]=k;const H=e[w+0],V=e[w+1],X=e[w+2];l[T+0]=H,l[T+1]=V,l[T+2]=X,c[T+0]=-b*dh[0],c[T+1]=-b*dh[1],c[T+2]=-b*dh[2],u[x]=0,a[M+0]=D+g*dh[0],a[M+1]=U+g*dh[1],a[M+2]=k+g*dh[2],l[M+0]=H,l[M+1]=V,l[M+2]=X,u[E]=g,T+=3,M+=3,w+=3,x+=1,E+=1}}{let b=3*n,w=0,x=3*m;const T=g<0?jye:Bye,E=g<0?Bye:jye;for(let M=0;M<o;++M)f[w]=s[b+T[0]],f[w+1]=s[b+T[1]],f[w+2]=s[b+T[2]],d[x]=s[b+E[0]]+r,d[x+1]=s[b+E[1]]+r,d[x+2]=s[b+E[2]]+r,w+=3,x+=3,b+=3}}function X4(t,e,i,r,s,n,o){r[n]=r[o],o*=3,t[n*=3]=t[o],t[n+1]=t[o+1],t[n+2]=t[o+2],e[n]=e[o],e[n+1]=e[o+1],e[n+2]=e[o+2],i[n]=s[0],i[n+1]=s[1],i[n+2]=s[2]}const N$=C();function Fye(t,e,i,r,s,n,o,a,l,c,u){let d=s,f=s+1,m=s+o,g=s+o+1,y=a,v=a+1,b=a+2*n,w=a+2*n+1;u<0&&(d=s+o+1,g=s);let x=3*c;for(let T=0;T<n;++T)T===n-1&&(f=s,u>0?g=s+o:d=s+o),yTt(t,d,f,m,N$),X4(t,e,r,i,N$,y,d),X4(t,e,r,i,N$,v,f),X4(t,e,r,i,N$,b,m),X4(t,e,r,i,N$,w,g),l[x]=y,l[x+1]=b,l[x+2]=w,l[x+3]=y,l[x+4]=w,l[x+5]=v,x+=6,d++,f++,m++,g++,y+=2,v+=2,b+=2,w+=2}const V9=C(),kye=C(),Uye=C(),Vye=C(),zye=C();function yTt(t,e,i,r,s){e*=3,i*=3,r*=3,pe(V9,t[e++],t[e++],t[e++]),pe(kye,t[i++],t[i++],t[i++]),pe(Uye,t[r++],t[r++],t[r++]),$e(Vye,kye,V9),$e(zye,Uye,V9),mt(s,zye,Vye),Ce(s,s)}const jE=C();function _Tt(t,e,i,r,s,n,o){const a=t.stageObject,l=a.geometries,c=l.length,u=e.mode!=="absolute-height";let d=0;const f=a.transformation,m=fw(ke(),f);for(let g=0;g<c;g+=2){const y=l[g];if(!qoe(y))continue;const v=y.getMutableAttribute($.POSITION).data,b=n[g/2],w=new nne(y.mapPositions),x=v.length/3;let T=!1,E=0;{let M=0;for(let O=0;O<x;O++){jE[0]=v[M],jE[1]=v[M+1],jE[2]=v[M+2],r(w,J4),u&&(E+=J4.sampledElevation),kr.TESTS_DISABLE_OPTIMIZATIONS?(pe(Gl,w.array[w.offset],w.array[w.offset+1],J4.z+b[M/3]),i!=null&&s.toRenderCoords(Gl,i,Gl),nt(Gl,Gl,m)):(pe(Gl,v[M],v[M+1],v[M+2]),nt(Gl,Gl,f),s.setAltitude(Gl,J4.z+b[M/3]),nt(Gl,Gl,m)),v[M]=Gl[0],v[M+1]=Gl[1],v[M+2]=Gl[2];const D=vTt/s.unitInMeters;(Math.abs(jE[0]-v[M])>=D||Math.abs(jE[1]-v[M+1])>=D||Math.abs(jE[2]-v[M+2])>=D)&&(T=!0),w.offset+=3,M+=3}}if(T){const M=o.get(y);M&&h4e(y,M,f),a.geometryVertexAttributeUpdated(l[g],$.NORMALCOMPRESSED),y.invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[g],$.POSITION),l[g+1].invalidateBoundingInfo(),a.geometryVertexAttributeUpdated(l[g+1],$.POSITION)}d+=E/x}return d/c}function h4e(t,e,i){const r=t.getMutableAttribute($.POSITION),s=t.getMutableAttribute($.NORMALCOMPRESSED).data,{topVertexStart:n,topVertexCount:o,topFaceStart:a,topFaceCount:l}=e,c=r.data,u=o,d=t.attributes.get($.POSITION).indices,f=a+l,m=n+o,g=go(3*u);for(let T=0;T<u;++T){const E=3*T;g[E+0]=0,g[E+1]=0,g[E+2]=0}const y=bTt,v=wTt,b=xTt,w=TTt,x=dh;for(let T=a;T<f;++T){const E=3*T;for(let M=0;M<3;++M){const O=d[E+M];w[M]=O;const D=3*O;pe(Gl,c[D+0],c[D+1],c[D+2]),nt(y[M],Gl,i)}Li(v,y[1],y[0]),Li(b,y[2],y[0]),mt(x,v,b),Ce(x,x);for(let M=0;M<3;++M){const O=3*(w[M]-n);g[O+0]+=x[0],g[O+1]+=x[1],g[O+2]+=x[2]}}for(let T=n;T<m;++T){const E=3*(T-n),M=g[E+0],O=g[E+1],D=g[E+2],U=Math.sqrt(M*M+O*O+D*D);vp(s,T,M/U,O/U,D/U)}}const Gl=C(),dh=C(),J4=new xN,Bye=[0,2,1],jye=[0,1,2],vTt=.01,bTt=[C(),C(),C()],wTt=C(),xTt=C(),TTt=[0,0,0];var bh;(function(t){t[t.Main=0]="Main",t[t.Bottom=1]="Bottom"})(bh||(bh={}));let STt=class{constructor(e,i,r,s){this.positions=e,this.elevation=i,this.normals=r,this.heights=s}},ETt=class{constructor(e,i,r,s){this.topVertexStart=e,this.topVertexCount=i,this.topFaceStart=r,this.topFaceCount=s}};const Q4=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["«","»"],["»","«"],["‹","›"],["›","‹"],["⁽","⁾"],["⁾","⁽"],["₍","₎"],["₎","₍"],["≤","≥"],["≥","≤"],["〈","〉"],["〉","〈"],["﹙","﹚"],["﹚","﹙"],["﹛","﹜"],["﹜","﹛"],["﹝","﹞"],["﹞","﹝"],["﹤","﹥"],["﹥","﹤"]],QP=["آ","أ","إ","ا"],CTt=["ﻵ","ﻷ","ﻹ","ﻻ"],MTt=["ﻶ","ﻸ","ﻺ","ﻼ"],pj=["ا","ب","ت","ث","ج","ح","خ","د","ذ","ر","ز","س","ش","ص","ض","ط","ظ","ع","غ","ف","ق","ك","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ی","ئ","ؤ"],ATt=["ﺍ","ﺏ","ﺕ","ﺙ","ﺝ","ﺡ","ﺥ","ﺩ","ﺫ","ﺭ","ﺯ","ﺱ","ﺵ","ﺹ","ﺽ","ﻁ","ﻅ","ﻉ","ﻍ","ﻑ","ﻕ","ﻙ","ﻝ","ﻡ","ﻥ","ﻩ","ﻭ","ﻱ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯼ","ﺉ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺉ","ﺅ"],PTt=["ﺎ","ﺐ","ﺖ","ﺚ","ﺞ","ﺢ","ﺦ","ﺪ","ﺬ","ﺮ","ﺰ","ﺲ","ﺶ","ﺺ","ﺾ","ﻂ","ﻆ","ﻊ","ﻎ","ﻒ","ﻖ","ﻚ","ﻞ","ﻢ","ﻦ","ﻪ","ﻮ","ﻲ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯽ","ﺊ","ﺆ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺊ","ﺆ"],OTt=["ﺎ","ﺒ","ﺘ","ﺜ","ﺠ","ﺤ","ﺨ","ﺪ","ﺬ","ﺮ","ﺰ","ﺴ","ﺸ","ﺼ","ﻀ","ﻄ","ﻈ","ﻌ","ﻐ","ﻔ","ﻘ","ﻜ","ﻠ","ﻤ","ﻨ","ﻬ","ﻮ","ﻴ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯿ","ﺌ","ﺆ","ﹱ","ﹲ","ﹴ","ﹷ","ﹹ","ﹻ","ﹽ","ﹿ","ﺀ","ﺌ","ﺆ"],$Tt=["ﺍ","ﺑ","ﺗ","ﺛ","ﺟ","ﺣ","ﺧ","ﺩ","ﺫ","ﺭ","ﺯ","ﺳ","ﺷ","ﺻ","ﺿ","ﻃ","ﻇ","ﻋ","ﻏ","ﻓ","ﻗ","ﻛ","ﻟ","ﻣ","ﻧ","ﻫ","ﻭ","ﻳ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯾ","ﺋ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺋ","ﺅ"],Gye=["ء","آ","أ","ؤ","إ","ا","ة","د","ذ","ر","ز","و","ى"],RTt=["ً","ً","ٌ","؟","ٍ","؟","َ","َ","ُ","ُ","ِ","ِ","ّ","ّ","ْ","ْ","ء","آ","آ","أ","أ","ؤ","ؤ","إ","إ","ئ","ئ","ئ","ئ","ا","ا","ب","ب","ب","ب","ة","ة","ت","ت","ت","ت","ث","ث","ث","ث","ج","ج","ج","ج","ح","ح","ح","ح","خ","خ","خ","خ","د","د","ذ","ذ","ر","ر","ز","ز","س","س","س","س","ش","ش","ش","ش","ص","ص","ص","ص","ض","ض","ض","ض","ط","ط","ط","ط","ظ","ظ","ظ","ظ","ع","ع","ع","ع","غ","غ","غ","غ","ف","ف","ف","ف","ق","ق","ق","ق","ك","ك","ك","ك","ل","ل","ل","ل","م","م","م","م","ن","ن","ن","ن","ه","ه","ه","ه","و","و","ى","ى","ي","ي","ي","ي","ﻵ","ﻶ","ﻷ","ﻸ","ﻹ","ﻺ","ﻻ","ﻼ","؟","؟","؟"],Hye=["ء","ف"],ITt=["غ","ي"],LTt=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],DTt=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],R=0,De=1,Gt=2,Hn=3,A=4,Cg=5,tV=6,P=7,zl=8,_c=9,Fp=10,ii=11,le=12,NTt=13,FTt=14,kTt=15,UTt=16,VTt=17,At=18,zTt=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],bg=100,BTt=[bg+0,R,R,R,R,bg+1,bg+2,bg+3,De,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,bg+4,A,A,A,R,A,R,A,R,A,A,A,R,R,A,A,R,R,R,R,R,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,R,R,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,R,R,R,R,R,R,R,R,R,R,R,R,R,R,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,R,R,A,A,R,R,A,A,R,R,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,R,R,R,bg+5,P,P,bg+6,bg+7],jTt=[[At,At,At,At,At,At,At,At,At,tV,Cg,tV,zl,Cg,At,At,At,At,At,At,At,At,At,At,At,At,At,At,Cg,Cg,Cg,tV,zl,A,A,ii,ii,ii,A,A,A,A,A,Fp,_c,Fp,_c,_c,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,_c,A,A,A,A,A,A,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,A,A,A,A,A,A,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,A,A,A,A,At,At,At,At,At,At,Cg,At,At,At,At,At,At,At,At,At,At,At,At,At,At,At,At,At,At,At,At,At,At,At,At,At,At,_c,A,ii,ii,ii,ii,A,A,A,A,R,A,A,At,A,A,ii,ii,Gt,Gt,A,R,A,A,A,Gt,R,A,A,A,A,A,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,A,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,A,R,R,R,R,R,R,R,R],[R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,A,A,A,A,A,A,A,A,A,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,A,A,R,R,R,R,R,R,R,A,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,A,R,A,A,A,A,A,A,A,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,De,le,De,le,le,De,le,le,De,le,A,A,A,A,A,A,A,A,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,A,A,A,A,A,De,De,De,De,De,A,A,A,A,A,A,A,A,A,A,A],[Hn,Hn,Hn,Hn,A,A,A,A,P,ii,ii,P,_c,P,A,A,le,le,le,le,le,le,le,le,le,le,le,P,A,A,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,Hn,Hn,Hn,Hn,Hn,Hn,Hn,Hn,Hn,Hn,ii,Hn,Hn,P,P,P,le,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,le,le,le,le,le,le,le,Hn,A,le,le,le,le,le,le,P,P,le,le,A,le,le,le,le,P,P,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,P,P,P,P,P,P],[P,P,P,P,P,P,P,P,P,P,P,P,P,P,A,P,P,le,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,A,A,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,le,le,le,le,le,le,le,le,le,le,le,P,A,A,A,A,A,A,A,A,A,A,A,A,A,A,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,De,le,le,le,le,le,le,le,le,le,De,De,A,A,A,A,De,A,A,A,A,A],[zl,zl,zl,zl,zl,zl,zl,zl,zl,zl,zl,At,At,At,R,De,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,zl,Cg,NTt,FTt,kTt,UTt,VTt,_c,ii,ii,ii,ii,ii,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,_c,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,zl,At,At,At,At,At,A,A,A,A,A,At,At,At,At,At,At,Gt,R,A,A,Gt,Gt,Gt,Gt,Gt,Gt,Fp,Fp,A,A,A,R,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Fp,Fp,A,A,A,A,R,R,R,R,R,R,R,R,R,R,R,R,R,A,A,A,ii,ii,ii,ii,ii,ii,ii,ii,ii,ii,ii,ii,ii,ii,ii,ii,ii,ii,ii,ii,ii,ii,ii,ii,ii,ii,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A],[R,R,R,R,R,R,R,A,A,A,A,A,A,A,A,A,A,A,A,R,R,R,R,R,A,A,A,A,A,De,le,De,De,De,De,De,De,De,De,De,De,Fp,De,De,De,De,De,De,De,De,De,De,De,De,De,A,De,De,De,De,De,A,De,A,De,De,A,De,De,A,De,De,De,De,De,De,De,De,De,De,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P],[le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,le,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,le,le,le,le,le,le,le,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,_c,A,_c,A,A,_c,A,A,A,A,A,A,A,A,A,ii,A,A,Fp,Fp,A,A,A,A,A,ii,ii,A,A,A,A,A,P,P,P,P,P,A,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,A,A,At],[A,A,A,ii,ii,ii,A,A,A,A,A,Fp,_c,Fp,_c,_c,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,Gt,_c,A,A,A,A,A,A,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,A,A,A,A,A,A,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,A,A,A,A,A,A,A,A,A,A,A,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,R,A,A,A,R,R,R,R,R,R,A,A,R,R,R,R,R,R,A,A,R,R,R,R,R,R,A,A,R,R,R,A,A,A,ii,ii,A,A,A,ii,ii,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A]];let GTt=class{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(e,i,r){if(this.sourceToTarget=[],this.targetToSource=[],!e)return"";if(aSt(this.sourceToTarget,this.targetToSource,e.length),!this.checkParameters(i,r))return e;i=this.inputFormat,r=this.outputFormat;let s=e;const n=cSt,o=Zye(i.charAt(1)),a=Zye(r.charAt(1)),l=(i.charAt(0)==="I"?"L":i.charAt(0))+o,c=(r.charAt(0)==="I"?"L":r.charAt(0))+a,u=i.charAt(2)+r.charAt(2);n.defInFormat=l,n.defOutFormat=c,n.defSwap=u;const d=mI(e,l,c,u,n);let f=!1;return r.charAt(1)==="R"?f=!0:r.charAt(1)!=="C"&&r.charAt(1)!=="D"||(f=this.checkContextual(d)==="rtl"),this.sourceToTarget=Dh,this.targetToSource=lSt(this.sourceToTarget),mj=this.targetToSource,s=i.charAt(3)===r.charAt(3)?d:r.charAt(3)==="S"?qTt(f,d):YTt(d,f,!0),this.sourceToTarget=Dh,this.targetToSource=mj,this.levels=v8,s}_inputFormatSetter(e){if(!Yye.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=e}_outputFormatSetter(e){if(!Yye.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=e}checkParameters(e,i){return e?this._inputFormatSetter(e):e=this.inputFormat,i?this._outputFormatSetter(i):i=this.outputFormat,e!==i}checkContextual(e){let i=fj(e);if(i!=="ltr"&&i!=="rtl"){try{i=document.dir.toLowerCase()}catch{}i!=="ltr"&&i!=="rtl"&&(i="ltr")}return i}hasBidiChar(e){return dSt.test(e)}};function mI(t,e,i,r,s){const n=HTt(t,{inFormat:e,outFormat:i,swap:r},s);if(n.inFormat===n.outFormat)return t;e=n.inFormat,i=n.outFormat,r=n.swap;const o=e.substring(0,1),a=e.substring(1,4),l=i.substring(0,1),c=i.substring(1,4);if(s.inFormat=e,s.outFormat=i,s.swap=r,o==="L"&&i==="VLTR"){if(a==="LTR")return s.dir=GE,Lv(t,s);if(a==="RTL")return s.dir=gI,Lv(t,s)}if(o==="V"&&l==="V")return s.dir=a==="RTL"?gI:GE,z9(t,s);if(o==="L"&&i==="VRTL")return a==="LTR"?(s.dir=GE,t=Lv(t,s)):(s.dir=gI,t=Lv(t,s)),z9(t);if(e==="VLTR"&&i==="LLTR")return s.dir=GE,Lv(t,s);if(o==="V"&&l==="L"&&a!==c)return t=z9(t),a==="RTL"?mI(t,"LLTR","VLTR",r,s):mI(t,"LRTL","VRTL",r,s);if(e==="VRTL"&&i==="LRTL")return mI(t,"LRTL","VRTL",r,s);if(o==="L"&&l==="L"){const u=s.swap;return s.swap=u.substr(0,1)+"N",a==="RTL"?(s.dir=gI,t=Lv(t,s),s.swap="N"+u.substr(1,2),s.dir=GE,t=Lv(t,s)):(s.dir=GE,t=Lv(t,s),s.swap="N"+u.substr(1,2),t=mI(t,"VLTR","LRTL",s.swap,s)),t}return t}function HTt(t,e,i){if(e.inFormat===void 0&&(e.inFormat=i.defInFormat),e.outFormat===void 0&&(e.outFormat=i.defOutFormat),e.swap===void 0&&(e.swap=i.defSwap),e.inFormat===e.outFormat)return e;const r=e.inFormat.substring(0,1),s=e.outFormat.substring(0,1);let n,o=e.inFormat.substring(1,4),a=e.outFormat.substring(1,4);return o.charAt(0)==="C"&&(n=fj(t),o=n==="ltr"||n==="rtl"?n.toUpperCase():e.inFormat.charAt(2)==="L"?"LTR":"RTL",e.inFormat=r+o),a.charAt(0)==="C"&&(n=fj(t),n==="rtl"?a="RTL":n==="ltr"?(n=ZTt(t),a=n.toUpperCase()):a=e.outFormat.charAt(2)==="L"?"LTR":"RTL",e.outFormat=s+a),e}function qTt(t,e,i){if(e.length===0)return"";t===void 0&&(t=!0);const r=(e=String(e)).split("");let s=0,n=1,o=r.length;t||(s=r.length-1,n=-1,o=1);const a=WTt(r,s,n,o);let l="";for(let c=0;c<r.length;c++)KTt(a,a.length,c)>-1?(f4e(mj,c,!t,-1),Dh.splice(c,1)):l+=r[c];return l}function WTt(t,e,i,r,s){let n=0;const o=[];let a=0;for(let l=e;l*i<r;l+=i)if(p4e(t[l])||dD(t[l])){if(t[l]==="ل"&&eSt(t,l+i,i,r)){t[l]=oSt(t[l+i],n===0?CTt:MTt),l+=i,nSt(t,l,i,r),o[a]=l,a++,n=0;continue}const c=t[l];n===1?t[l]=qye(t,l+i,i,r)?sSt(t[l]):B9(t[l],PTt):qye(t,l+i,i,r)===!0?t[l]=B9(t[l],$Tt):t[l]=B9(t[l],ATt),dD(c)||(n=1),rSt(c)===!0&&(n=0)}else n=0;return o}function fj(t){const e=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(t);return e?e[0]<="z"?"ltr":"rtl":""}function ZTt(t){const e=t.split("");return e.reverse(),fj(e.join(""))}function YTt(t,e,i){if(t.length===0)return"";e===void 0&&(e=!0);let r="";const s=(t=String(t)).split("");for(let n=0;n<t.length;n++){let o=!1;if(s[n]>="ﹰ"&&s[n]<"\uFEFF"){const a=t.charCodeAt(n);s[n]>="ﻵ"&&s[n]<="ﻼ"?(e?(n>0&&i&&s[n-1]===" "?r=r.substring(0,r.length-1)+"ل":(r+="ل",o=!0),r+=QP[(a-65269)/2]):(r+=QP[(a-65269)/2],r+="ل",n+1<t.length&&i&&s[n+1]===" "?n++:o=!0),o&&(f4e(mj,n,!0,1),Dh.splice(n,0,Dh[n]))):r+=RTt[a-65136]}else r+=s[n]}return r}function Lv(t,e){const i=t.split(""),r=[];return d4e(i,r,e),JTt(i,r,e),Wye(2,i,r,e),Wye(1,i,r,e),v8=r,i.join("")}function d4e(t,e,i){const r=t.length,s=i.dir?DTt:LTt;let n=0,o=-1;const a=[],l=[];i.hiLevel=i.dir,i.lastArabic=!1,i.hasUbatAl=!1,i.hasUbatB=!1,i.hasUbatS=!1;for(let c=0;c<r;c++)a[c]=QTt(t[c]);for(let c=0;c<r;c++){const u=n,d=tSt(t,a,l,c,i);l[c]=d,n=s[u][d];const f=240&n;n&=15;const m=s[n][uSt];if(e[c]=m,f>0)if(f===16){for(let g=o;g<c;g++)e[g]=1;o=-1}else o=-1;if(s[n][hSt])o===-1&&(o=c);else if(o>-1){for(let g=o;g<c;g++)e[g]=m;o=-1}a[c]===Cg&&(e[c]=0),i.hiLevel|=m}i.hasUbatS&&XTt(a,e,r,i)}function XTt(t,e,i,r){for(let s=0;s<i;s++)if(t[s]===tV){e[s]=r.dir;for(let n=s-1;n>=0&&t[n]===zl;n--)e[n]=r.dir}}function JTt(t,e,i){if(i.hiLevel!==0&&i.swap.substr(0,1)!==i.swap.substr(1,2))for(let r=0;r<t.length;r++)e[r]===1&&(t[r]=iSt(t[r]))}function QTt(t){const e=t.charCodeAt(0),i=BTt[e>>8];return i<bg?i:jTt[i-bg][255&e]}function z9(t,e){const i=t.split("");if(e){const r=[];d4e(i,r,e),v8=r}return i.reverse(),Dh.reverse(),i.join("")}function KTt(t,e,i){for(let r=0;r<e;r++)if(t[r]===i)return r;return-1}function p4e(t){for(let e=0;e<Hye.length;e++)if(t>=Hye[e]&&t<=ITt[e])return!0;return!1}function qye(t,e,i,r){for(;e*i<r&&dD(t[e]);)e+=i;return!!(e*i<r&&p4e(t[e]))}function eSt(t,e,i,r){for(;e*i<r&&dD(t[e]);)e+=i;let s=" ";if(!(e*i<r))return!1;s=t[e];for(let n=0;n<QP.length;n++)if(QP[n]===s)return!0;return!1}function Wye(t,e,i,r){if(r.hiLevel<t)return;if(t===1&&r.dir===gI&&!r.hasUbatB)return e.reverse(),void Dh.reverse();const s=e.length;let n,o,a,l,c,u=0;for(;u<s;){if(i[u]>=t){for(n=u+1;n<s&&i[n]>=t;)n++;for(o=u,a=n-1;o<a;o++,a--)l=e[o],e[o]=e[a],e[a]=l,c=Dh[o],Dh[o]=Dh[a],Dh[a]=c;u=n}u++}}function tSt(t,e,i,r,s){const n=e[r];return{UBAT_L:()=>(s.lastArabic=!1,R),UBAT_R:()=>(s.lastArabic=!1,De),UBAT_ON:()=>A,UBAT_AN:()=>Hn,UBAT_EN:()=>s.lastArabic?Hn:Gt,UBAT_AL:()=>(s.lastArabic=!0,s.hasUbatAl=!0,De),UBAT_WS:()=>A,UBAT_CS:()=>{let o,a;return r<1||r+1>=e.length||(o=i[r-1])!==Gt&&o!==Hn||(a=e[r+1])!==Gt&&a!==Hn?A:(s.lastArabic&&(a=Hn),a===o?a:A)},UBAT_ES:()=>(r>0?i[r-1]:Cg)===Gt&&r+1<e.length&&e[r+1]===Gt?Gt:A,UBAT_ET:()=>{if(r>0&&i[r-1]===Gt)return Gt;if(s.lastArabic)return A;let o=r+1;const a=e.length;for(;o<a&&e[o]===ii;)o++;return o<a&&e[o]===Gt?Gt:A},UBAT_NSM:()=>{if(s.inFormat==="VLTR"){const o=e.length;let a=r+1;for(;a<o&&e[a]===le;)a++;if(a<o){const l=t[r].charCodeAt(0),c=l>=1425&&l<=2303||l===64286,u=e[a];if(c&&(u===De||u===P))return De}}return r<1||e[r-1]===Cg?A:i[r-1]},UBAT_B:()=>(s.lastArabic=!0,s.hasUbatB=!0,s.dir),UBAT_S:()=>(s.hasUbatS=!0,A),UBAT_LRE:()=>(s.lastArabic=!1,A),UBAT_RLE:()=>(s.lastArabic=!1,A),UBAT_LRO:()=>(s.lastArabic=!1,A),UBAT_RLO:()=>(s.lastArabic=!1,A),UBAT_PDF:()=>(s.lastArabic=!1,A),UBAT_BN:()=>A}[zTt[n]]()}function iSt(t){let e,i=0,r=Q4.length-1;for(;i<=r;)if(e=Math.floor((i+r)/2),t<Q4[e][0])r=e-1;else{if(!(t>Q4[e][0]))return Q4[e][1];i=e+1}return t}function rSt(t){for(let e=0;e<Gye.length;e++)if(Gye[e]===t)return!0;return!1}function sSt(t){for(let e=0;e<pj.length;e++)if(t===pj[e])return OTt[e];return t}function B9(t,e){for(let i=0;i<pj.length;i++)if(t===pj[i])return e[i];return t}function dD(t){return t>="ً"&&t<="ٕ"}function Zye(t){return t==="L"?"LTR":t==="R"?"RTL":t==="C"?"CLR":t==="D"?"CRL":""}function nSt(t,e,i,r){for(;e*i<r&&dD(t[e]);)e+=i;return e*i<r&&(t[e]=" ",!0)}function oSt(t,e){for(let i=0;i<QP.length;i++)if(t===QP[i])return e[i];return t}function aSt(t,e,i){Dh=[],v8=[];for(let r=0;r<i;r++)t[r]=r,e[r]=r,Dh[r]=r}function lSt(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[t[i]]=i;return e}function f4e(t,e,i,r){for(let s=0;s<t.length;s++)(t[s]>e||!i&&t[s]===e)&&(t[s]+=r)}let Dh=[],mj=[],v8=[];const cSt={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},uSt=5,hSt=6,GE=0,gI=1,Yye=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,dSt=/[\u0591-\u06ff\ufb1d-\ufefc]/,j9=new GTt;function pSt(t){if(t==null)return["",!1];if(!j9.hasBidiChar(t))return[t,!1];let e;return e=j9.checkContextual(t)==="rtl"?"IDNNN":"ICNNN",[j9.bidiTransform(t,e,"VLYSN"),!0]}let zO=class{constructor(){this.setIdentity()}getAngle(){return(this.rz==null||this.rz===0&&this.rzCos!==1&&this.rzSin!==0)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(e,i){this.tx=e,this.ty=i}setTranslateZ(e){this.tz=e}setRotateCS(e,i){this.rz=void 0,this.rzCos=e,this.rzSin=i}setRotate(e){this.rz=e,this.rzCos=void 0,this.rzSin=void 0}setRotateY(e){this.ry=e}setScale(e){this.s=e}setMeasure(e){this.m=e}};const Nae="arial-unicode-ms",Xye="woff2",Jye=new Map,m4e=new Set;let fSt=class{constructor(e,i){this.fontFace=e,this.promise=i}};async function mSt(t){const e=vSt(t),i=_St(t),r=Jye.get(e);if(r)return r.promise;const s=new FontFace(t.family,`url('${nr.fontsUrl}/woff2/${i}.${Xye}') format('${Xye}')`,{style:t.style,weight:t.weight}),n=document.fonts;if(n.has(s)&&s.status==="loading")return s.loaded;const o=s.load().then(()=>(n.add(s),s));return Jye.set(e,new fSt(s,o)),m4e.add(s),o}function gSt(t){return m4e.has(t)}function ySt(t){if(!t)return Nae;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function _St(t){const e=g4e(t)+y4e(t);return ySt(t.family)+(e.length>0?e:"-regular")}function vSt(t){const e=g4e(t)+y4e(t);return(t.family||Nae)+(e.length>0?e:"-regular")}function g4e(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function y4e(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let to=class{static fromOptimized(e,i,r=!1,s=!1,n=1){return new GK().initialize(e,i,r,s,n)}static fromJSON(e,i=!1,r=!1){const[s,n]=Qye(e);return new HK().initialize(s,n,i,r,1)}static fromOptimizedCIM(e,i,r=!1,s=!1,n=1){return new Kye().initialize(e,i,r,s,n)}static fromJSONCIM(e,i=!1,r=!1,s=1){const[n,o]=Qye(e);return new e0e().initialize(n,o,i,r,s)}static fromFeatureSetReader(e){const i=e.readGeometryForDisplay(),r=e.geometryType;return i&&r?this.fromOptimized(i,r):null}static fromFeatureSetReaderCIM(e){const i=e.readGeometryForDisplay(),r=e.geometryType;return i&&r?this.fromOptimizedCIM(i,r):null}static createEmptyOptimized(e,i=!1,r=!1,s=1){return new GK().initialize(new El,e,i,r,s)}static createEmptyJSON(e,i=!1,r=!1){return new HK().initialize([],e,i,r,1)}static createEmptyOptimizedCIM(e,i=!1,r=!1,s=1){return new Kye().initialize(new El,e,i,r,s)}static createEmptyJSONCIM(e,i=!1,r=!1,s=1){return new e0e().initialize([],e,i,r,s)}asJSON(){const e=XD(this);return this.geometryType==="esriGeometryEnvelope"?{xmin:e[0][0][0],ymin:e[0][0][1],xmax:e[0][2][0],ymax:e[0][2][1]}:this.geometryType==="esriGeometryMultipoint"?{points:e.flat()}:this.geometryType==="esriGeometryPoint"?{x:e[0][0][0],y:e[0][0][1]}:this.geometryType==="esriGeometryPolygon"?{rings:e}:{paths:e}}getCurrentRingArea(){if(this.pathSize<3)return 0;let e,i,r=0;if(this.seekPathStart(),!this.nextPoint())return 0;e=this.x,i=this.y;const s=e,n=i;for(;this.nextPoint();)r+=(e-this.x)*(i+this.y),e=this.x,i=this.y;return r+=(e-s)*(i+n),-.5*r}invertY(){this.yFactor*=-1}},GK=class _4e extends to{constructor(){super(...arguments),this._end=-1}initialize(e,i,r,s,n){return this.hasZ=r,this.hasM=s,this.geometryType=i,this._stride=2+Number(r)+Number(s),this._geometry=e,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=n,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(e){if(e>=0&&e<this.totalSize){if(this._pathIndex<e)for(;this._pathIndex<e&&this.nextPath(););else if(this._pathIndex>e)for(;this._pathIndex>e&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(e){const i=this._pathOffset+e*this._stride;return i>=0&&i<this._end&&(this._pointOffset=i,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1)&&(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,!0)}prevPath(){return!(this.pathIndex<=0)&&(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,!0)}pathLength(){const e=this._end,i=this._stride,r=this._geometry.coords;let s=0;for(let n=this._pathOffset+i;n<e;n+=i){const o=r[n-i],a=r[n-i+1],l=r[n]-o,c=r[n+1]-a;s+=Math.sqrt(l*l+c*c)}return s}startPath(){this._geometry.lengths.push(0)}pushPath(e){this.startPath(),this.pushPoints(e)}pushPoint(e){for(let i=0;i<this._stride;++i)this._geometry.coords.push(e[i]);this._geometry.lengths[this.totalSize-1]++}pushXY(e,i){this._geometry.coords.push(e,i),this._geometry.lengths[this.totalSize-1]++}pushPoints(e){for(const i of e)for(let r=0;r<this._stride;++r)this._geometry.coords.push(i[r]);this._geometry.lengths[this.totalSize-1]+=e.length}pushCursor(e){const i=e.asOptimized();this._geometry.coords.push(...i.coords),this._geometry.lengths.push(...i.lengths)}asOptimized(){const e=this._geometry.clone();if(this.yFactor!==1)for(let i=1;i<e.coords.length;i+=this._stride)e.coords[i]*=this.yFactor;return this.geometryType==="esriGeometryPoint"&&(e.lengths.length=0),e}isClosed(){const e=this._geometry.coords,i=this._pathOffset,r=this._end-this._stride;for(let s=0;s<this._stride;s++)if(e[i+s]!==e[r+s])return!1;return!0}clone(){return new _4e().initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce((e,i)=>e+i)}get pathSize(){const{lengths:e}=this._geometry;return this._geometry.isPoint?1:this._pathIndex<0||this._pathIndex>e.length-1?0:e[this._pathIndex]}get totalSize(){return this._geometry.isPoint?1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(e){this._geometry.coords[this._pointOffset]=e}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(e){this._geometry.coords[this._pointOffset+1]=this.yFactor*e}get z(){return this._geometry.coords[this._pointOffset+2]}set z(e){this._geometry.coords[this._pointOffset+2]=e}get m(){const e=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+e]}set m(e){this._geometry.coords[this._pointOffset+3]=e}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}};function bSt(t){const e=[t.x,t.y];return t.z&&e.push(t.z),t.m&&e.push(t.m),e}function Qye(t){return ml(t)?[t.rings,"esriGeometryPolygon"]:Nf(t)?[t.paths,"esriGeometryPolyline"]:OS(t)?[[t.points],"esriGeometryMultipoint"]:Df(t)?[[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]],"esriGeometryEnvelope"]:_P(t)?[[[bSt(t)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}let HK=class v4e extends to{initialize(e,i,r,s,n){return this._paths=e,this.geometryType=i,this.hasZ=r,this.hasM=s,this._pathIndex=this._pointIndex=-1,this.yFactor=n,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(e){return this._pathIndex=e,this._pointIndex=-1,e>=0&&e<this.totalSize&&(this._currentPath=this._paths[e],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(e){return e>=0&&e<this._currentPath.length&&(this._pointIndex=e,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){const e=this._currentPath.length,i=this._currentPath;let r=0;for(let s=1;s<e;s++){const n=i[s-1],o=i[s],a=n[0],l=n[1],c=o[0]-a,u=o[1]-l;r+=Math.sqrt(c*c+u*u)}return r}startPath(){this._paths.push([])}pushPath(e){this._paths.push(e)}pushPoint(e){this._paths[this.totalSize-1].push(e)}pushXY(e,i){this._paths[this.totalSize-1].push([e,i])}pushPoints(e){this._paths[this.totalSize-1].push(...e)}pushCursor(e){const i=XD(e);for(const r of i)this.pushPath(r)}asOptimized(){const e=new El;if(this.geometryType==="esriGeometryPoint")e.coords.push(...this._paths[0][0]),e.lengths.length=0;else for(const i of this._paths){for(const r of i)e.coords.push(r[0]),e.coords.push(r[1]*this.yFactor),this.hasZ&&e.coords.push(r[2]),this.hasM&&e.coords.push(r[this._mIndex]);e.lengths.push(i.length)}return e}isClosed(){const e=this._currentPath[0],i=this._currentPath[this._currentPath.length-1];for(let r=0;r<e.length;r++)if(e[r]!==i[r])return!1;return!0}clone(){return new v4e().initialize(re(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map(e=>e.length).reduce((e,i)=>e+i)}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(e){this._currentPoint[0]=e}get y(){return this.yFactor*this._currentPoint[1]}set y(e){this._currentPoint[1]=this.yFactor*e}get z(){return this._currentPoint[2]}set z(e){this._currentPoint[2]=e}get m(){return this._currentPoint[this._mIndex]}set m(e){this._currentPoint[this._mIndex]=e}get pathIndex(){return this._pathIndex}};const K4=4,e5=1;let Kye=class b4e extends GK{initialize(e,i,r,s,n){return super.initialize(e,i,r,s,n),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.totalSize).fill(void 0).map(o=>new Set)),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){const e=new b4e().initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return e._controlPoints=this._controlPoints,e}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(e){this._controlPoints[this.pathIndex].add(e)}getControlPointAt(e){return this._controlPoints[this.pathIndex].has(e)}},e0e=class w4e extends HK{initialize(e,i,r,s,n){return super.initialize(e,i,r,s,n)}clone(){return new w4e().initialize(re(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][K4]=e5}getControlPoint(){return this._paths[this.pathIndex][this._pointIndex][K4]===e5}setControlPointAt(e){this._paths[this.pathIndex][e][K4]=e5}getControlPointAt(e){return this._paths[this.pathIndex][e][K4]===e5}};const wSt=512;var Cf,Oa;(function(t){t[t.Unknown=0]="Unknown",t[t.Point=1]="Point",t[t.LineString=2]="LineString",t[t.Polygon=3]="Polygon"})(Cf||(Cf={}));let ll=class iV{constructor(e,i){this.x=e,this.y=i}clone(){return new iV(this.x,this.y)}equals(e,i){return e===this.x&&i===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,i){return this.x=e,this.y=i,this}normalize(){const e=this.x,i=this.y,r=Math.sqrt(e*e+i*i);return this.x/=r,this.y/=r,this}rightPerpendicular(){const e=this.x;return this.x=this.y,this.y=-e,this}leftPerpendicular(){const e=this.x;return this.x=-this.y,this.y=e,this}move(e,i){return this.x+=e,this.y+=i,this}assign(e){return this.x=e.x,this.y=e.y,this}assignAdd(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}assignSub(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}rotate(e,i){const r=this.x,s=this.y;return this.x=r*e-s*i,this.y=r*i+s*e,this}scale(e){return this.x*=e,this.y*=e,this}length(){const e=this.x,i=this.y;return Math.sqrt(e*e+i*i)}sub(e){return this.x-=e.x,this.y-=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}static distance(e,i){const r=i.x-e.x,s=i.y-e.y;return Math.sqrt(r*r+s*s)}static add(e,i){return new iV(e.x+i.x,e.y+i.y)}static sub(e,i){return new iV(e.x-i.x,e.y-i.y)}},t5=class{constructor(e,i,r){this.ratio=e,this.x=i,this.y=r}},xSt=class{constructor(e,i,r,s=8,n=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=s,this._pixelMargin=n,this._tileSize=wSt*s,this._dz=e,this._yPos=i,this._xPos=r}setPixelMargin(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);let i=this._pixelRatio*this._pixelMargin;i/=this._finalRatio;const r=e>>this._dz;i>r&&(i=r),this._margin=i,this._xmin=r*this._xPos-i,this._ymin=r*this._yPos-i,this._xmax=this._xmin+r+2*i,this._ymax=this._ymin+r+2*i}reset(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(e,i){this._pushLine(),this._prevIsIn=this._isIn(e,i),this._moveTo(e,i,this._prevIsIn),this._prevPt=new ll(e,i),this._firstPt=new ll(e,i),this._dist=0}lineTo(e,i){const r=this._isIn(e,i),s=new ll(e,i),n=ll.distance(this._prevPt,s);let o,a,l,c,u,d,f,m;if(r)this._prevIsIn?this._lineTo(e,i,!0):(o=this._prevPt,a=s,l=this._intersect(a,o),this._start=this._dist+n*(1-this._r),this._lineTo(l.x,l.y,!0),this._lineTo(a.x,a.y,!0));else if(this._prevIsIn)a=this._prevPt,o=s,l=this._intersect(a,o),this._lineTo(l.x,l.y,!0),this._lineTo(o.x,o.y,!1);else{const g=this._prevPt,y=s;if(g.x<=this._xmin&&y.x<=this._xmin||g.x>=this._xmax&&y.x>=this._xmax||g.y<=this._ymin&&y.y<=this._ymin||g.y>=this._ymax&&y.y>=this._ymax)this._lineTo(y.x,y.y,!1);else{const v=[];if((g.x<this._xmin&&y.x>this._xmin||g.x>this._xmin&&y.x<this._xmin)&&(c=(this._xmin-g.x)/(y.x-g.x),m=g.y+c*(y.y-g.y),m<=this._ymin?d=!1:m>=this._ymax?d=!0:v.push(new t5(c,this._xmin,m))),(g.x<this._xmax&&y.x>this._xmax||g.x>this._xmax&&y.x<this._xmax)&&(c=(this._xmax-g.x)/(y.x-g.x),m=g.y+c*(y.y-g.y),m<=this._ymin?d=!1:m>=this._ymax?d=!0:v.push(new t5(c,this._xmax,m))),(g.y<this._ymin&&y.y>this._ymin||g.y>this._ymin&&y.y<this._ymin)&&(c=(this._ymin-g.y)/(y.y-g.y),f=g.x+c*(y.x-g.x),f<=this._xmin?u=!1:f>=this._xmax?u=!0:v.push(new t5(c,f,this._ymin))),(g.y<this._ymax&&y.y>this._ymax||g.y>this._ymax&&y.y<this._ymax)&&(c=(this._ymax-g.y)/(y.y-g.y),f=g.x+c*(y.x-g.x),f<=this._xmin?u=!1:f>=this._xmax?u=!0:v.push(new t5(c,f,this._ymax))),v.length===0)u?d?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):d?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(v.length>1&&v[0].ratio>v[1].ratio)this._start=this._dist+n*v[1].ratio,this._lineTo(v[1].x,v[1].y,!0),this._lineTo(v[0].x,v[0].y,!0);else{this._start=this._dist+n*v[0].ratio;for(let b=0;b<v.length;b++)this._lineTo(v[b].x,v[b].y,!0)}this._lineTo(y.x,y.y,!1)}}this._dist+=n,this._prevIsIn=r,this._prevPt=s}close(){if(this._line.length>2){const e=this._firstPt,i=this._prevPt;e.x===i.x&&e.y===i.y||this.lineTo(e.x,e.y);const r=this._line;let s=r.length;for(;s>=4&&(r[0].x===r[1].x&&r[0].x===r[s-2].x||r[0].y===r[1].y&&r[0].y===r[s-2].y);)r.pop(),r[0].x=r[s-2].x,r[0].y=r[s-2].y,--s}}result(e=!0){return this._pushLine(),this._lines.length===0?null:(this._type===Cf.Polygon&&e&&TSt.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==Cf.LineString)throw new Error("Only valid for lines");this._pushLine();const e=this._lines,i=e.length;if(i===0)return null;const r=[];for(let s=0;s<i;s++)r.push({line:e[s],start:this._starts[s]||0});return r}_isIn(e,i){return e>=this._xmin&&e<=this._xmax&&i>=this._ymin&&i<=this._ymax}_intersect(e,i){let r,s,n;if(i.x>=this._xmin&&i.x<=this._xmax)s=i.y<=this._ymin?this._ymin:this._ymax,n=(s-e.y)/(i.y-e.y),r=e.x+n*(i.x-e.x);else if(i.y>=this._ymin&&i.y<=this._ymax)r=i.x<=this._xmin?this._xmin:this._xmax,n=(r-e.x)/(i.x-e.x),s=e.y+n*(i.y-e.y);else{s=i.y<=this._ymin?this._ymin:this._ymax,r=i.x<=this._xmin?this._xmin:this._xmax;const o=(r-e.x)/(i.x-e.x),a=(s-e.y)/(i.y-e.y);o<a?(n=o,s=e.y+o*(i.y-e.y)):(n=a,r=e.x+a*(i.x-e.x))}return this._r=n,new ll(r,s)}_pushLine(){this._line&&(this._type===Cf.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===Cf.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===Cf.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(e,i,r){this._type!==Cf.Polygon?r&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new ll(e,i))):(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new ll(e,i)),this._isH=!1,this._isV=!1)}_lineTo(e,i,r){let s,n;if(this._type!==Cf.Polygon)if(r){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(s=this._line[this._line.length-1],s.equals(e,i)))return;this._line.push(new ll(e,i))}else this._line&&this._line.length>0&&this._pushLine();else if(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){s=this._line[this._line.length-1];const o=s.x===e,a=s.y===i;if(o&&a)return;this._isH&&o||this._isV&&a?(s.x=e,s.y=i,n=this._line[this._line.length-2],n.x===e&&n.y===i?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(n=this._line[this._line.length-2],this._isH=n.x===e,this._isV=n.y===i)):(this._isH=n.x===e,this._isV=n.y===i)):(this._line.push(new ll(e,i)),this._isH=o,this._isV=a)}else this._line.push(new ll(e,i))}},Hsi=class{setExtent(e){this._ratio=e===4096?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this._lines=[],this._line=null}moveTo(e,i){this._line&&this._lines.push(this._line),this._line=[];const r=this._ratio;this._line.push(new ll(e*r,i*r))}lineTo(e,i){const r=this._ratio;this._line.push(new ll(e*r,i*r))}close(){const e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this._line&&this._lines.push(this._line),this._lines.length===0?null:this._lines}};(function(t){t[t.sideLeft=0]="sideLeft",t[t.sideRight=1]="sideRight",t[t.sideTop=2]="sideTop",t[t.sideBottom=3]="sideBottom"})(Oa||(Oa={}));let TSt=class m1{static simplify(e,i,r){if(!r)return;const s=-i,n=e+i,o=-i,a=e+i,l=[],c=[],u=r.length;for(let f=0;f<u;++f){const m=r[f];if(!m||m.length<2)continue;let g,y=m[0];const v=m.length;for(let b=1;b<v;++b)g=m[b],y.x===g.x&&(y.x<=s&&(y.y>g.y?(l.push(f),l.push(b),l.push(Oa.sideLeft),l.push(-1)):(c.push(f),c.push(b),c.push(Oa.sideLeft),c.push(-1))),y.x>=n&&(y.y<g.y?(l.push(f),l.push(b),l.push(Oa.sideRight),l.push(-1)):(c.push(f),c.push(b),c.push(Oa.sideRight),c.push(-1)))),y.y===g.y&&(y.y<=o&&(y.x<g.x?(l.push(f),l.push(b),l.push(Oa.sideTop),l.push(-1)):(c.push(f),c.push(b),c.push(Oa.sideTop),c.push(-1))),y.y>=a&&(y.x>g.x?(l.push(f),l.push(b),l.push(Oa.sideBottom),l.push(-1)):(c.push(f),c.push(b),c.push(Oa.sideBottom),c.push(-1)))),y=g}if(l.length===0||c.length===0)return;m1.fillParent(r,c,l),m1.fillParent(r,l,c);const d=[];m1.calcDeltas(d,c,l),m1.calcDeltas(d,l,c),m1.addDeltas(d,r)}static fillParent(e,i,r){const s=r.length,n=i.length;for(let o=0;o<n;o+=4){const a=i[o],l=i[o+1],c=i[o+2],u=e[a][l-1],d=e[a][l];let f=8092,m=-1;for(let g=0;g<s;g+=4){if(r[g+2]!==c)continue;const y=r[g],v=r[g+1],b=e[y][v-1],w=e[y][v];switch(c){case Oa.sideLeft:case Oa.sideRight:if(i5(u.y,b.y,w.y)&&i5(d.y,b.y,w.y)){const x=Math.abs(w.y-b.y);x<f&&(f=x,m=g)}break;case Oa.sideTop:case Oa.sideBottom:if(i5(u.x,b.x,w.x)&&i5(d.x,b.x,w.x)){const x=Math.abs(w.x-b.x);x<f&&(f=x,m=g)}}}i[o+3]=m}}static calcDeltas(e,i,r){const s=i.length;for(let n=0;n<s;n+=4){const o=[],a=m1.calcDelta(n,i,r,o);e.push(i[n]),e.push(i[n+1]),e.push(i[n+2]),e.push(a)}}static calcDelta(e,i,r,s){const n=i[e+3];if(n===-1)return 0;const o=s.length;return o>1&&s[o-2]===n?0:(s.push(n),m1.calcDelta(n,r,i,s)+1)}static addDeltas(e,i){const r=e.length;let s=0;for(let n=0;n<r;n+=4){const o=e[n+3];o>s&&(s=o)}for(let n=0;n<r;n+=4){const o=i[e[n]],a=e[n+1],l=s-e[n+3];switch(e[n+2]){case Oa.sideLeft:o[a-1].x-=l,o[a].x-=l,a===1&&(o[o.length-1].x-=l),a===o.length-1&&(o[0].x-=l);break;case Oa.sideRight:o[a-1].x+=l,o[a].x+=l,a===1&&(o[o.length-1].x+=l),a===o.length-1&&(o[0].x+=l);break;case Oa.sideTop:o[a-1].y-=l,o[a].y-=l,a===1&&(o[o.length-1].y-=l),a===o.length-1&&(o[0].y-=l);break;case Oa.sideBottom:o[a-1].y+=l,o[a].y+=l,a===1&&(o[o.length-1].y+=l),a===o.length-1&&(o[0].y+=l)}}}};const i5=(t,e,i)=>t>=e&&t<=i||t>=i&&t<=e,SSt=512;let i0,ESt=class{constructor(e){this._geometry=e}next(){const e=this._geometry;return this._geometry=null,e}};function b8(t,e){i0||(i0=new xSt(0,0,0,1));const i=t.geometryType==="esriGeometryPolygon",r=i?Cf.Polygon:Cf.LineString,s=i?3:2;let n,o;for(i0.reset(r),i0.setPixelMargin(e+1),i0.setExtent(SSt);t.nextPath();)if(!(t.pathSize<s)){for(t.nextPoint(),n=t.x,o=-t.y,i0.moveTo(n,o);t.nextPoint();)n=t.x,o=-t.y,i0.lineTo(n,o);i&&i0.close()}const a=i0.result(!1);if(a){const l=to.createEmptyOptimizedCIM(t.geometryType);for(const c of a){l.startPath();for(const u of c)l.pushXY(u.x,-u.y)}return l.reset(),l}return null}let CSt=class{applyColorSubstituition(e,i){if(!i)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:r,height:s}=e,n=this._rasterizationCanvas,o=n.getContext("2d",{willReadFrequently:!0});e!==n&&(n.width=r,n.height=s,o.drawImage(e,0,0,r,s));const a=o.getImageData(0,0,r,s).data;if(i){for(const c of i)if(c&&c.oldColor&&c.oldColor.length===4&&c.newColor&&c.newColor.length===4){const[u,d,f,m]=c.oldColor,[g,y,v,b]=c.newColor;if(u===g&&d===y&&f===v&&m===b)continue;for(let w=0;w<a.length;w+=4)u===a[w]&&d===a[w+1]&&f===a[w+2]&&m===a[w+3]&&(a[w]=g,a[w+1]=y,a[w+2]=v,a[w+3]=b)}}const l=new ImageData(a,r,s);return o.putImageData(l,0,0),n}tintImageData(e,i){if(!i||i.length<4)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:r,height:s}=e,n=this._rasterizationCanvas,o=n.getContext("2d",{willReadFrequently:!0});e!==n&&(n.width=r,n.height=s,o.drawImage(e,0,0,r,s));const a=o.getImageData(0,0,r,s),l=new Uint8Array(a.data),c=[i[0]/255,i[1]/255,i[2]/255,i[3]/255];for(let d=0;d<l.length;d+=4)l[d]*=c[0],l[d+1]*=c[1],l[d+2]*=c[2],l[d+3]*=c[3];const u=new ImageData(new Uint8ClampedArray(l.buffer),r,s);return o.putImageData(u,0,0),n}},x4e=class yI{static local(){return yI.instance===null&&(yI.instance=new yI),yI.instance}execute(e,i,r,s,n){return new MSt(e,i,r)}};x4e.instance=null;let MSt=class{constructor(e,i,r){this._inputGeometries=e,this._angleTolerance=i.angleTolerance!==void 0?i.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let e=this._inputGeometries.next();for(;e;){if(e.geometryType==="esriGeometryPolygon")this._isClosed=!0;else if(e.geometryType==="esriGeometryPolyline")this._isClosed=!1;else{if(e.geometryType!=="esriGeometryEnvelope"){e=this._inputGeometries.next();continue}if(this._maxCosAngle)return e;this._isClosed=!0}for(;e.nextPath();)this._processPath(e);return e.reset(),e}return null}_processPath(e){if(e.nextPoint()){const i=e.x,r=e.y;let s=i,n=r,o=e.pathSize,a=0,l=0,c=0,u=0,d=0,f=0;this._isClosed&&++o;for(let m=1;e.nextPoint()||m<o;++m){let g,y;this._isClosed&&m===o-1?(g=i,y=r):(g=e.x,y=e.y);const v=g-s,b=y-n,w=Math.sqrt(v*v+b*b);m>1&&w>0&&c>0&&(a*v+l*b)/w/c<=this._maxCosAngle&&e.setControlPointAt(m-1),m===1&&(u=v,d=b,f=w),w>0&&(s=g,n=y,a=v,l=b,c=w)}this._isClosed&&c>0&&f>0&&(a*u+l*d)/f/c<=this._maxCosAngle&&e.setControlPointAt(0)}}};function G9(t,e){t[4]=e}let NN=class{constructor(e,i=!0,r=!0,s=0){this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!i&&e.geometryType==="esriGeometryPolygon"||!r&&e.geometryType==="esriGeometryPolyline"?null:e,this.geomUnitsPerPoint=s,this.iterateMultiPath=!1,this.iteratePath=!1,this.internalPlacement=new zO}next(){if(!this.geometryCursor)return null;const e=this.processMultiPath(this.geometryCursor);return this.iterateMultiPath&&e||(this.geometryCursor=null),e}processMultiPath(e){for(;this.iteratePath||e.pathIndex<e.totalSize-1;){this.iteratePath||e.nextPath(),this.iterateMultiPath=!0;const i=this.processPath(e);if(i)return i}return this.iterateMultiPath=!1,null}},w8=class{constructor(e,i,r,s=0){this.isClosed=!1,this._tileKey=null,this.inputGeometries=e,this.acceptPolygon=i,this.acceptPolyline=r,this.geomUnitsPerPoint=s,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let e=this.inputGeometries.next();for(;e&&(this.isClosed=this.acceptPolygon&&e.geometryType==="esriGeometryPolygon"||e.geometryType==="esriGeometryEnvelope",this.multiPathCursor=e,!this.multiPathCursor);)e=this.inputGeometries.next();if(!this.multiPathCursor)return null;this._tileKey&&this.isClippingRequired(this.multiPathCursor)&&(this.multiPathCursor.reset(),this.multiPathCursor=b8(this.multiPathCursor,256))}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();const e=this.processPath(this.multiPathCursor);if(e)return e}this.multiPathCursor=null}}isClippingRequired(e){return!1}};var qK,WK,t0e,i0e,Yg,r0e,ZK,YK,XK,s0e,n0e,o0e,a0e,l0e,c0e,JK,QK,u0e,h0e,jA,Zi,WT,d0e,p0e,l_,f0e,m0e,XM,KK,g0e,y0e,_0e,v0e,b0e,w0e,ap,sl,x0e,T0e,Xg,S0e,E0e,C0e,M0e,_f,Q3,ZT,JM,A0e,P0e,O0e,$0e,R0e,I0e,L0e,gj,QM,D0e,eee,N0e,F0e;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(qK||(qK={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(WK||(WK={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(t0e||(t0e={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(i0e||(i0e={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(Yg||(Yg={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(r0e||(r0e={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(ZK||(ZK={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(YK||(YK={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(XK||(XK={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(s0e||(s0e={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(n0e||(n0e={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(o0e||(o0e={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(a0e||(a0e={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(l0e||(l0e={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(c0e||(c0e={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(JK||(JK={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(QK||(QK={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(u0e||(u0e={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(h0e||(h0e={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(jA||(jA={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees",t.TipWithPerpendicularAndTicks="TipWithPerpendicularAndTicks"}(Zi||(Zi={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(WT||(WT={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(d0e||(d0e={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(p0e||(p0e={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(l_||(l_={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(f0e||(f0e={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(m0e||(m0e={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(XM||(XM={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(KK||(KK={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(g0e||(g0e={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(y0e||(y0e={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(_0e||(_0e={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AloneLine=1]="AloneLine"}(v0e||(v0e={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(b0e||(b0e={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(w0e||(w0e={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(ap||(ap={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(sl||(sl={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(x0e||(x0e={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(T0e||(T0e={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(Xg||(Xg={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(S0e||(S0e={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(E0e||(E0e={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(C0e||(C0e={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(M0e||(M0e={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(_f||(_f={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(Q3||(Q3={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(ZT||(ZT={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(JM||(JM={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(A0e||(A0e={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(P0e||(P0e={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(O0e||(O0e={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}($0e||($0e={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(R0e||(R0e={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(I0e||(I0e={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(L0e||(L0e={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(gj||(gj={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(QM||(QM={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(D0e||(D0e={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(eee||(eee={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(N0e||(N0e={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(F0e||(F0e={}));const pD=.03;let ev=class{constructor(e=0,i=!1){}isEmpty(e){if(!e.nextPoint())return!0;let i,r,s,n;for(i=e.x,r=e.y;e.nextPoint();i=r,r=n)if(s=e.x,n=e.y,s!==i||n!==r)return e.seekPathStart(),!1;return e.seekPathStart(),!0}normalize(e){const i=Math.sqrt(e[0]*e[0]+e[1]*e[1]);i!==0&&(e[0]/=i,e[1]/=i)}getLength(e,i,r,s){const n=r-e,o=s-i;return Math.sqrt(n*n+o*o)}getSegLength(e){const[[i,r],[s,n]]=e;return this.getLength(i,r,s,n)}getCoord2D(e,i,r,s,n){return[e+(r-e)*n,i+(s-i)*n]}getSegCoord2D(e,i){const[[r,s],[n,o]]=e;return this.getCoord2D(r,s,n,o,i)}getAngle(e,i,r,s,n){const o=r-e,a=s-i;return Math.atan2(a,o)}getAngleCS(e,i,r,s,n){const o=r-e,a=s-i,l=Math.sqrt(o*o+a*a);return l>0?[o/l,a/l]:[1,0]}getSegAngleCS(e,i){const[[r,s],[n,o]]=e;return this.getAngleCS(r,s,n,o,i)}cut(e,i,r,s,n,o){return[n<=0?[e,i]:this.getCoord2D(e,i,r,s,n),o>=1?[r,s]:this.getCoord2D(e,i,r,s,o)]}getSubCurve(e,i,r){const s=to.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(s,e,i,r)?s:null}appendSubCurve(e,i,r,s){e.startPath(),i.seekPathStart();let n=0,o=!0;if(!i.nextPoint())return!1;let a=i.x,l=i.y;for(;i.nextPoint();){const c=this.getLength(a,l,i.x,i.y);if(c!==0){if(o){if(n+c>r){const u=(r-n)/c;let d=1,f=!1;n+c>=s&&(d=(s-n)/c,f=!0);const m=this.cut(a,l,i.x,i.y,u,d);if(m&&e.pushPoints(m),f)break;o=!1}}else{if(n+c>s){const u=this.cut(a,l,i.x,i.y,0,(s-n)/c);u&&e.pushPoint(u[1]);break}e.pushXY(i.x,i.y)}n+=c,a=i.x,l=i.y}else a=i.x,l=i.y}return!0}getCIMPointAlong(e,i){if(!e.nextPoint())return null;let r,s,n,o,a=0;for(r=e.x,s=e.y;e.nextPoint();r=n,s=o){n=e.x,o=e.y;const l=this.getLength(r,s,n,o);if(l!==0){if(a+l>i){const c=(i-a)/l;return this.getCoord2D(r,s,n,o,c)}a+=l}}return null}offset(e,i,r,s,n){if(!e||e.length<2)return null;let o=0,a=e[o++],l=o;for(;o<e.length;){const f=e[o];f[0]===a[0]&&f[1]===a[1]||(o!==l&&(e[l]=e[o]),a=e[l++]),o++}const c=e[0][0]===e[l-1][0]&&e[0][1]===e[l-1][1];if(c&&--l,l<(c?3:2))return null;const u=[];a=c?e[l-1]:null;let d=e[0];for(let f=0;f<l;f++){const m=f===l-1?c?e[0]:null:e[f+1];if(a)if(m){const g=[m[0]-d[0],m[1]-d[1]];this.normalize(g);const y=[d[0]-a[0],d[1]-a[1]];this.normalize(y);const v=y[0]*g[1]-y[1]*g[0],b=y[0]*g[0]+y[1]*g[1];if(v===0&&b===1){d=m;continue}if(v>=0==i<=0){if(b<1){const w=[g[0]-y[0],g[1]-y[1]];this.normalize(w);const x=Math.sqrt((1+b)/2);if(x>1/s){const T=-Math.abs(i)/x;u.push([d[0]-w[0]*T,d[1]-w[1]*T])}}}else switch(r){case l_.Mitered:{const w=Math.sqrt((1+b)/2);if(w>0&&1/w<s){const x=[g[0]-y[0],g[1]-y[1]];this.normalize(x);const T=Math.abs(i)/w;u.push([d[0]-x[0]*T,d[1]-x[1]*T]);break}}case l_.Bevelled:u.push([d[0]+y[1]*i,d[1]-y[0]*i]),u.push([d[0]+g[1]*i,d[1]-g[0]*i]);break;case l_.Rounded:if(b<1){u.push([d[0]+y[1]*i,d[1]-y[0]*i]);const w=Math.floor(2.5*(1-b));if(w>0){const x=1/w;let T=x;for(let E=1;E<w;E++,T+=x){const M=[y[1]*(1-T)+g[1]*T,-y[0]*(1-T)-g[0]*T];this.normalize(M),u.push([d[0]+M[0]*i,d[1]+M[1]*i])}}u.push([d[0]+g[1]*i,d[1]-g[0]*i])}break;case l_.Square:default:if(v<0)u.push([d[0]+(y[1]+y[0])*i,d[1]+(y[1]-y[0])*i]),u.push([d[0]+(g[1]-g[0])*i,d[1]-(g[0]+g[1])*i]);else{const w=Math.sqrt((1+Math.abs(b))/2),x=[g[0]-y[0],g[1]-y[1]];this.normalize(x);const T=i/w;u.push([d[0]-x[0]*T,d[1]-x[1]*T])}}}else{const g=[d[0]-a[0],d[1]-a[1]];this.normalize(g),u.push([d[0]+g[1]*i,d[1]-g[0]*i])}else{const g=[m[0]-d[0],m[1]-d[1]];this.normalize(g),u.push([d[0]+g[1]*i,d[1]-g[0]*i])}a=d,d=m}return u.length<(c?3:2)?null:(c&&u.push([u[0][0],u[0][1]]),u)}};const H9=1.7320508075688772,ASt=5,PSt=jA.OpenEnded;let T4e=class _I{static local(){return _I.instance===null&&(_I.instance=new _I),_I.instance}execute(e,i,r,s,n){return new OSt(e,i,r)}};T4e.instance=null;let OSt=class extends w8{constructor(e,i,r){super(e,!1,!0),this._curveHelper=new ev,this._width=(i.width!==void 0?i.width:ASt)*r,this._arrowType=i.geometricEffectArrowType!==void 0?i.geometricEffectArrowType:i.arrowType!==void 0?i.arrowType:PSt,this._offsetFlattenError=pD*r}processPath(e){const i=to.createEmptyOptimizedCIM(e.geometryType);switch(this._arrowType){case jA.OpenEnded:default:this._constructSimpleArrow(i,e,!0);break;case jA.Block:this._constructSimpleArrow(i,e,!1);break;case jA.Crossed:this._constructCrossedArrow(i,e)}return i}_constructSimpleArrow(e,i,r){const s=i.pathLength();let n=this._width;s<2*n&&(n=s/2);const o=this._curveHelper.getSubCurve(i,0,s-n);if(!o||!o.nextPath())return;o.seekPathStart();const a=n/2;if(this._curveHelper.isEmpty(o))return;const l=_b(o),c=this._constructOffset(l,-a);if(!c)return;const u=this._constructOffset(l,a);if(!u)return;const d=this._constructArrowBasePoint(c,-a/2);if(!d)return;const f=this._constructArrowBasePoint(u,a/2);if(!f)return;i.seekInPath(i.pathSize-1);const m=[i.x,i.y];e.pushPath(u),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(f),e.nextPoint(),e.setControlPoint(),e.pushPoint(m),e.nextPoint(),e.setControlPoint(),e.pushPoint(d),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.setControlPoint(),r||(e.setControlPointAt(0),e.setControlPointAt(e.pathSize-1),e.pushPoint(u[0])),e.reset()}_constructCrossedArrow(e,i){const r=i.pathLength();let s=this._width;r<s*(1+H9+1)&&(s=r/(1+H9+1)),i.seekPathStart();const n=this._curveHelper.getSubCurve(i,0,r-s*(1+H9));if(!n)return;n.nextPath();const o=s/2;if(this._curveHelper.isEmpty(n))return;const a=_b(n),l=this._constructOffset(a,o);if(!l)return;const c=this._constructOffset(a,-o);if(!c)return;const u=this._curveHelper.getSubCurve(i,0,r-s);if(!u||(u.nextPath(),this._curveHelper.isEmpty(u)))return;const d=_b(u),f=this._constructOffset(d,o);if(!f)return;const m=this._constructOffset(d,-o);if(!m)return;const g=f[f.length-1],y=this._constructArrowBasePoint(f,o/2);if(!y)return;const v=m[m.length-1],b=this._constructArrowBasePoint(m,-o/2);if(!b)return;i.seekInPath(i.pathSize-1);const w=[i.x,i.y];e.pushPath(l),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(v),e.nextPoint(),e.setControlPoint(),e.pushPoint(b),e.nextPoint(),e.setControlPoint(),e.pushPoint(w),e.nextPoint(),e.setControlPoint(),e.pushPoint(y),e.nextPoint(),e.setControlPoint(),e.pushPoint(g),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.nextPoint(),e.setControlPoint(),e.reset()}_constructOffset(e,i){return this._curveHelper.offset(e,i,l_.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(e,i){if(!e||e.length<2)return null;const r=e[e.length-2],s=e[e.length-1],n=[s[0]-r[0],s[1]-r[1]];return this._curveHelper.normalize(n),[s[0]+n[1]*i,s[1]-n[0]*i]}},S4e=class vI{static local(){return vI.instance===null&&(vI.instance=new vI),vI.instance}execute(e,i,r,s,n,o){return new $St(e,i,r,s,n,o)}};S4e.instance=null;let $St=class{constructor(e,i,r,s,n,o){this._inputGeometries=e,this._tileKey=s,this._geometryEngine=n,this._curveHelper=new ev,this._size=(i.size!==void 0?i.size:1)*r,this._maxInflateSize=o*r,this._offsetFlattenError=pD*r}next(){let e;for(;e=this._inputGeometries.next();){if(this._size===0)return e;if(e.geometryType==="esriGeometryEnvelope"){if(this._size>0){const n=to.createEmptyOptimizedCIM(e.geometryType),o=XD(e)[0],a=this._curveHelper.offset(o,this._size,l_.Rounded,4,this._offsetFlattenError);if(a)return n.pushPath(a),n}else if(this._size<0){const n=e.asJSON();if(Math.min(n.xmax-n.xmin,n.ymax-n.ymin)+2*this._size>0)return to.fromJSONCIM({xmin:n.xmin-this._size,xmax:n.xmax+this._size,ymin:n.ymin-this._size,ymax:n.ymax+this._size})}}const i=this._geometryEngine;if(i==null)return null;const r=this._tileKey?b8(e,this._maxInflateSize):e;if(!r)continue;const s=i.buffer(Ye.WebMercator,r.asJSON(),this._size,1);return s?to.fromJSONCIM(s):null}return null}},E4e=class bI{static local(){return bI.instance===null&&(bI.instance=new bI),bI.instance}execute(e,i,r,s,n){return new RSt(e,i,r)}};E4e.instance=null;let RSt=class{constructor(e,i,r){this._defaultPointSize=20,this._inputGeometries=e,this._geomUnitsPerPoint=r,this._rule=i.rule??Zi.FullGeometry,this._defaultSize=this._defaultPointSize*r}next(){let e;for(;e=this._inputGeometries.next();){const i=this._processGeom(XD(e));if(i!=null&&i.length)return to.fromJSONCIM({paths:i})}return null}_clone(e){return[e[0],e[1]]}_mid(e,i){return[(e[0]+i[0])/2,(e[1]+i[1])/2]}_mix(e,i,r,s){return[e[0]*i+r[0]*s,e[1]*i+r[1]*s]}_add(e,i){return[e[0]+i[0],e[1]+i[1]]}_add2(e,i,r){return[e[0]+i,e[1]+r]}_sub(e,i){return[e[0]-i[0],e[1]-i[1]]}_dist(e,i){return Math.sqrt((e[0]-i[0])*(e[0]-i[0])+(e[1]-i[1])*(e[1]-i[1]))}_norm(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}_normalize(e,i=1){const r=i/this._norm(e);e[0]*=r,e[1]*=r}_leftPerpendicular(e){const i=-e[1],r=e[0];e[0]=i,e[1]=r}_leftPerp(e){return[-e[1],e[0]]}_rightPerpendicular(e){const i=e[1],r=-e[0];e[0]=i,e[1]=r}_rightPerp(e){return[e[1],-e[0]]}_dotProduct(e,i){return e[0]*i[0]+e[1]*i[1]}_crossProduct(e,i){return e[0]*i[1]-e[1]*i[0]}_rotateDirect(e,i,r){const s=e[0]*i-e[1]*r,n=e[0]*r+e[1]*i;e[0]=s,e[1]=n}_makeCtrlPt(e){const i=[e[0],e[1]];return G9(i,1),i}_addAngledTicks(e,i,r,s){const n=this._sub(r,i);this._normalize(n);const o=this._crossProduct(n,this._sub(s,i));let a;a=o>0?this._rightPerp(n):this._leftPerp(n);const l=Math.abs(o)/2,c=[];c.push([i[0]+(a[0]-n[0])*l,i[1]+(a[1]-n[1])*l]),c.push(i),c.push(r),c.push([r[0]+(a[0]+n[0])*l,r[1]+(a[1]+n[1])*l]),e.push(c)}_addBezier2(e,i,r,s,n){if(n--==0)return void e.push(s);const o=this._mid(i,r),a=this._mid(r,s),l=this._mid(o,a);this._addBezier2(e,i,o,l,n),this._addBezier2(e,l,a,s,n)}_addBezier3(e,i,r,s,n,o){if(o--==0)return void e.push(n);const a=this._mid(i,r),l=this._mid(r,s),c=this._mid(s,n),u=this._mid(a,l),d=this._mid(l,c),f=this._mid(u,d);this._addBezier3(e,i,a,u,f,o),this._addBezier3(e,f,d,c,n,o)}_add90DegArc(e,i,r,s,n){const o=n??this._crossProduct(this._sub(r,i),this._sub(s,i))>0,a=this._mid(i,r),l=this._sub(a,i);o?this._leftPerpendicular(l):this._rightPerpendicular(l),a[0]+=l[0],a[1]+=l[1],this._addBezier3(e,i,this._mix(i,.33333,a,.66667),this._mix(r,.33333,a,.66667),r,4)}_addArrow(e,i,r){const s=i[0],n=i[1],o=i[i.length-1],a=this._sub(s,n),l=this._norm(a);this._normalize(a);const c=Math.abs(this._crossProduct(a,this._sub(o,n)));let u=this._dotProduct(a,this._sub(o,n));u<.05*l?u=.05*l:u>.95*l&&(u=.95*l);const d=.5*c,f=this._leftPerp(a),m=[n[0]+a[0]*u,n[1]+a[1]*u],g=i.length-1,y=[];y.push(r?[-f[0],-f[1]]:f);let v=[-a[0],-a[1]];for(let b=1;b<g-1;b++){const w=this._sub(i[b+1],i[b]);this._normalize(w);const x=this._dotProduct(w,v),T=this._crossProduct(w,v),E=Math.sqrt((1+x)/2),M=this._sub(w,v);this._normalize(M),M[0]/=E,M[1]/=E,y.push(T<0?[-M[0],-M[1]]:M),v=w}y.push(this._rightPerp(v));for(let b=y.length-1;b>0;b--)e.push([i[b][0]+y[b][0]*d,i[b][1]+y[b][1]*d]);e.push([m[0]+y[0][0]*d,m[1]+y[0][1]*d]),e.push([m[0]+y[0][0]*c,m[1]+y[0][1]*c]),e.push(s),e.push([m[0]-y[0][0]*c,m[1]-y[0][1]*c]),e.push([m[0]-y[0][0]*d,m[1]-y[0][1]*d]);for(let b=1;b<y.length;b++)e.push([i[b][0]-y[b][0]*d,i[b][1]-y[b][1]*d])}_cp2(e,i,r){return e.length>=2?e[1]:this._add2(e[0],i*this._defaultSize,r*this._defaultSize)}_cp3(e,i,r,s){if(e.length>=3)return e[2];const n=this._mix(e[0],1-r,i,r),o=this._sub(i,e[0]);return this._normalize(o),this._rightPerpendicular(o),[n[0]+o[0]*s*this._defaultSize,n[1]+o[1]*s*this._defaultSize]}_arrowPath(e){if(e.length>2)return e;const i=e[0],r=this._cp2(e,-4,0),s=this._sub(i,r);this._normalize(s);const n=this._rightPerp(s);return[i,r,[i[0]+(n[0]-s[0])*this._defaultSize,i[1]+(n[1]-s[1])*this._defaultSize]]}_arrowLastSeg(e){const i=e[0],r=this._cp2(e,-4,0);let s;if(e.length>=3)s=e[e.length-1];else{const n=this._sub(i,r);this._normalize(n);const o=this._rightPerp(n);s=[i[0]+(o[0]-n[0])*this._defaultSize,i[1]+(o[1]-n[1])*this._defaultSize]}return[r,s]}_processGeom(e){if(!e)return null;const i=[];for(const r of e){if(!r||r.length===0)continue;const s=r.length;let n=r[0];switch(this._rule){case Zi.PerpendicularFromFirstSegment:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,4),l=[];l.push(a),l.push(this._mid(n,o)),i.push(l);break}case Zi.ReversedFirstSegment:{const o=this._cp2(r,0,-1);i.push([o,n]);break}case Zi.PerpendicularToSecondSegment:{if(r.length<3)return[];const o=this._cp2(r,-4,1),a=this._cp3(r,o,.882353,-1.94),l=[];l.push(this._mid(o,a)),l.push(n),i.push(l);break}case Zi.SecondSegmentWithTicks:{if(r.length<3)return[];const o=this._cp2(r,-4,1),a=this._cp3(r,o,.882353,-1.94),l=this._sub(a,o);let c;c=this._crossProduct(l,this._sub(n,o))>0?this._rightPerp(l):this._leftPerp(l);const u=[];u.push([o[0]+(c[0]-l[0])/3,o[1]+(c[1]-l[1])/3]),u.push(o),u.push(a),u.push([a[0]+(c[0]+l[0])/3,a[1]+(c[1]+l[1])/3]),i.push(u);break}case Zi.DoublePerpendicular:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,3),l=this._mid(n,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(n,a));this._leftPerpendicular(c);const d=[];d.push(n),d.push([a[0]+c[0]*u,a[1]+c[1]*u]),i.push(d);const f=[];f.push([a[0]-c[0]*u,a[1]-c[1]*u]),f.push(o),i.push(f);break}case Zi.OppositeToFirstSegment:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,3),l=this._mid(n,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(n,a));this._leftPerpendicular(c);const d=[];d.push([a[0]+c[0]*u,a[1]+c[1]*u]),d.push([a[0]-c[0]*u,a[1]-c[1]*u]),i.push(d);break}case Zi.TriplePerpendicular:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,4),l=this._mid(n,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(n,a));this._leftPerpendicular(c);const d=[];d.push([a[0]+c[0]*u*.8,a[1]+c[1]*u*.8]),d.push([l[0]+.8*(n[0]-l[0]),l[1]+.8*(n[1]-l[1])]),i.push(d),i.push([a,l]);const f=[];f.push([a[0]-c[0]*u*.8,a[1]-c[1]*u*.8]),f.push([l[0]+.8*(o[0]-l[0]),l[1]+.8*(o[1]-l[1])]),i.push(f);break}case Zi.HalfCircleFirstSegment:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,4),l=this._mid(n,o);let c=this._sub(o,n);const u=Math.cos(Math.PI/18),d=Math.sin(Math.PI/18),f=Math.sqrt((1+u)/2),m=Math.sqrt((1-u)/2),g=[];let y;this._crossProduct(c,this._sub(a,n))>0?(g.push(n),c=this._sub(n,l),y=o):(g.push(o),c=this._sub(o,l),y=n),this._rotateDirect(c,f,m),c[0]/=f,c[1]/=f;for(let v=1;v<=18;v++)g.push(this._add(l,c)),this._rotateDirect(c,u,d);g.push(y),i.push(g);break}case Zi.HalfCircleSecondSegment:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,1,-1);let l=this._sub(n,o);this._normalize(l);const c=this._crossProduct(l,this._sub(a,o))/2;this._leftPerpendicular(l);const u=[o[0]+l[0]*c,o[1]+l[1]*c];l=this._sub(o,u);const d=Math.cos(Math.PI/18);let f=Math.sin(Math.PI/18);c>0&&(f=-f);const m=[o];for(let g=1;g<=18;g++)this._rotateDirect(l,d,f),m.push(this._add(u,l));i.push(m);break}case Zi.HalfCircleExtended:{const o=this._cp2(r,0,-2),a=this._cp3(r,o,1,-1);let l;if(s>=4)l=r[3];else{const g=this._sub(n,o);l=this._add(a,g)}const c=this._dist(o,a)/2/.75,u=this._sub(o,n);this._normalize(u,c);const d=this._sub(a,l);this._normalize(d,c);const f=[l,a];i.push(f);const m=[this._clone(a)];this._addBezier3(m,a,this._add(a,d),this._add(o,u),o,4),m.push(n),i.push(m);break}case Zi.OpenCircle:{const o=this._cp2(r,-2,0),a=this._sub(o,n),l=Math.cos(Math.PI/18),c=-Math.sin(Math.PI/18),u=[o];for(let d=1;d<=33;d++)this._rotateDirect(a,l,c),u.push(this._add(n,a));i.push(u);break}case Zi.CoverageEdgesWithTicks:{const o=this._cp2(r,0,-1);let a,l;if(s>=3)a=r[2];else{const f=this._sub(o,n),m=this._leftPerp(f);a=[n[0]+m[0]-.25*f[0],n[1]+m[1]-.25*f[1]]}if(s>=4)l=r[3];else{const f=this._mid(n,o),m=this._sub(n,o);this._normalize(m),this._leftPerpendicular(m);const g=this._crossProduct(m,this._sub(a,f));this._rightPerpendicular(m),l=[a[0]+m[0]*g*2,a[1]+m[1]*g*2]}const c=this._sub(o,n);let u,d;u=this._crossProduct(c,this._sub(a,n))>0?this._rightPerp(c):this._leftPerp(c),d=[],d.push(a),d.push(n),d.push([n[0]+(u[0]-c[0])/3,n[1]+(u[1]-c[1])/3]),i.push(d),u=this._crossProduct(c,this._sub(l,o))>0?this._rightPerp(c):this._leftPerp(c),d=[],d.push([o[0]+(u[0]+c[0])/3,o[1]+(u[1]+c[1])/3]),d.push(o),d.push(l),i.push(d);break}case Zi.GapExtentWithDoubleTicks:{const o=this._cp2(r,0,2),a=this._cp3(r,o,0,1);let l;if(s>=4)l=r[3];else{const c=this._sub(o,n);l=this._add(a,c)}this._addAngledTicks(i,n,o,this._mid(a,l)),this._addAngledTicks(i,a,l,this._mid(n,o));break}case Zi.GapExtentMidline:{const o=this._cp2(r,2,0),a=this._cp3(r,o,0,1);let l;if(s>=4)l=r[3];else{const u=this._sub(o,n);l=this._add(a,u)}const c=[];c.push(this._mid(n,a)),c.push(this._mid(o,l)),i.push(c);break}case Zi.Chevron:{const o=this._cp2(r,-1,-1);let a;if(s>=3)a=r[2];else{const l=this._sub(o,n);this._leftPerpendicular(l),a=this._add(n,l)}i.push([o,this._makeCtrlPt(n),a]);break}case Zi.PerpendicularWithArc:{const o=this._cp2(r,0,-2),a=this._cp3(r,o,.5,-1),l=this._sub(o,n),c=this._norm(l);l[0]/=c,l[1]/=c;const u=this._crossProduct(l,this._sub(a,n));let d=this._dotProduct(l,this._sub(a,n));d<.05*c?d=.05*c:d>.95*c&&(d=.95*c);const f=[n[0]+l[0]*d,n[1]+l[1]*d];let m=this._leftPerp(l),g=[];if(g.push([f[0]-m[0]*u,f[1]-m[1]*u]),g.push([f[0]+m[0]*u,f[1]+m[1]*u]),i.push(g),s>=4){const w=r[3];let x=this._dotProduct(l,this._sub(w,n));x<.1*c?x=.1*c:x>.9*c&&(x=.9*c);const T=[n[0]+l[0]*x,n[1]+l[1]*x],E=this._crossProduct(l,this._sub(w,n)),M=[];M.push([T[0]-m[0]*E,T[1]-m[1]*E]),M.push([T[0]+m[0]*E,T[1]+m[1]*E]),i.push(M)}const y=[o[0]+m[0]*u,o[1]+m[1]*u];m=this._sub(o,y);const v=Math.cos(Math.PI/18);let b=Math.sin(Math.PI/18);u<0&&(b=-b),g=[n,o];for(let w=1;w<=9;w++)this._rotateDirect(m,v,b),g.push(this._add(y,m));i.push(g);break}case Zi.ClosedHalfCircle:{const o=this._cp2(r,2,0),a=this._mid(n,o),l=this._sub(o,a),c=Math.cos(Math.PI/18),u=Math.sin(Math.PI/18),d=[n,o];for(let f=1;f<=18;f++)this._rotateDirect(l,c,u),d.push(this._add(a,l));i.push(d);break}case Zi.TripleParallelExtended:{const o=this._cp2(r,0,-2),a=this._cp3(r,o,1,-2),l=this._mid(n,o),c=this._sub(a,o);this._normalize(c);const u=Math.abs(this._crossProduct(c,this._sub(l,o)))/2,d=this._dist(o,a),f=[o,n];f.push([n[0]+c[0]*d*.5,n[1]+c[1]*d*.5]),i.push(f);const m=[];m.push([l[0]-c[0]*u,l[1]-c[1]*u]),m.push([l[0]+c[0]*d*.375,l[1]+c[1]*d*.375]),G9(m[m.length-1],1),m.push([l[0]+c[0]*d*.75,l[1]+c[1]*d*.75]),i.push(m);const g=[o,a];i.push(g);break}case Zi.ParallelWithTicks:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(a,o);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l),this._addAngledTicks(i,n,o,a),this._addAngledTicks(i,this._mix(n,1,l,c),this._mix(o,1,l,c),this._mid(n,o));break}case Zi.Parallel:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._leftPerp(l),u=this._crossProduct(l,this._sub(a,n));let d=[n,o];i.push(d),d=[],d.push([n[0]+c[0]*u,n[1]+c[1]*u]),d.push([o[0]+c[0]*u,o[1]+c[1]*u]),i.push(d);break}case Zi.PerpendicularToFirstSegment:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._mid(n,o),c=this._sub(o,n);this._normalize(c);const u=this._crossProduct(c,this._sub(a,n));this._leftPerpendicular(c);const d=[];d.push([l[0]-c[0]*u*.25,l[1]-c[1]*u*.25]),d.push([l[0]+c[0]*u*1.25,l[1]+c[1]*u*1.25]),i.push(d);break}case Zi.ParallelOffset:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l);const u=[];u.push([n[0]-l[0]*c,n[1]-l[1]*c]),u.push([o[0]-l[0]*c,o[1]-l[1]*c]),i.push(u);const d=[];d.push([n[0]+l[0]*c,n[1]+l[1]*c]),d.push([o[0]+l[0]*c,o[1]+l[1]*c]),i.push(d);break}case Zi.OffsetOpposite:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l);const u=[];u.push([n[0]-l[0]*c,n[1]-l[1]*c]),u.push([o[0]-l[0]*c,o[1]-l[1]*c]),i.push(u);break}case Zi.OffsetSame:{const o=this._cp2(r,3,0),a=this._cp3(r,o,.5,-1),l=this._sub(o,n);this._normalize(l);const c=this._crossProduct(l,this._sub(a,n));this._leftPerpendicular(l);const u=[];u.push([n[0]+l[0]*c,n[1]+l[1]*c]),u.push([o[0]+l[0]*c,o[1]+l[1]*c]),i.push(u);break}case Zi.CircleWithArc:{let o=this._cp2(r,3,0);const a=this._cp3(r,o,.5,-1);let l,c;if(s>=4)l=r[3],c=this._crossProduct(this._sub(l,o),this._sub(a,o))>0;else{l=o,c=this._crossProduct(this._sub(l,n),this._sub(a,n))>0;const g=24*this._geomUnitsPerPoint,y=this._sub(l,n);this._normalize(y,g);const v=Math.sqrt(2)/2;this._rotateDirect(y,v,c?v:-v),o=this._add(n,y)}const u=this._sub(o,n),d=Math.cos(Math.PI/18),f=Math.sin(Math.PI/18),m=[o];for(let g=1;g<=36;g++)this._rotateDirect(u,d,f),m.push(this._add(n,u));this._add90DegArc(m,o,l,a,c),G9(m[m.length-8],1),i.push(m);break}case Zi.DoubleJog:{let o,a=this._cp2(r,-3,1),l=this._cp3(r,a,-1,-.5);if(s>=4)o=r[3];else{const b=n;n=a,o=l;const w=this._dist(n,b),x=this._dist(o,b);let T=30*this._geomUnitsPerPoint;.5*w<T&&(T=.5*w),.5*x<T&&(T=.5*x),a=this._mix(n,T/w,b,(w-T)/w),l=this._mix(o,T/x,b,(x-T)/x)}const c=this._mid(n,a),u=this._mid(o,l),d=this._dist(n,a),f=this._dist(l,o);let m=Math.min(d,f)/8;m=Math.min(m,24*this._geomUnitsPerPoint);const g=Math.cos(Math.PI/4);let y=this._sub(n,a);this._normalize(y,m),this._crossProduct(y,this._sub(o,a))>0?this._rotateDirect(y,g,-g):this._rotateDirect(y,g,g);let v=[];v.push(a),v.push(this._add(c,y)),v.push(this._sub(c,y)),v.push(n),i.push(v),y=this._sub(o,l),this._normalize(y,m),this._crossProduct(y,this._sub(n,l))<0?this._rotateDirect(y,g,g):this._rotateDirect(y,g,-g),v=[],v.push(l),v.push(this._add(u,y)),v.push(this._sub(u,y)),v.push(o),i.push(v);break}case Zi.PerpendicularOffset:{const o=this._cp2(r,-4,1),a=this._cp3(r,o,.882353,-1.94),l=this._sub(a,o);this._crossProduct(l,this._sub(n,o))>0?this._rightPerpendicular(l):this._leftPerpendicular(l);const c=[l[0]/8,l[1]/8],u=this._sub(this._mid(o,a),c);i.push([u,n]);break}case Zi.LineExcludingLastSegment:{const o=this._arrowPath(r),a=[];let l=o.length-2;for(;l--;)a.push(o[l]);i.push(a);break}case Zi.MultivertexArrow:{const o=this._arrowPath(r),a=[];this._addArrow(a,o,!1),i.push(a);break}case Zi.CrossedArrow:{const o=this._arrowPath(r),a=[];this._addArrow(a,o,!0),i.push(a);break}case Zi.ChevronArrow:{const[o,a]=this._arrowLastSeg(r),l=10*this._geomUnitsPerPoint,c=this._sub(n,o),u=this._norm(c);this._normalize(c);const d=this._crossProduct(c,this._sub(a,o));let f=this._dotProduct(c,this._sub(a,o));f<.05*u?f=.05*u:f>.95*u-l&&(f=.95*u-l);const m=[o[0]+c[0]*f,o[1]+c[1]*f],g=this._leftPerp(c),y=[];y.push([m[0]+g[0]*d+c[0]*l,m[1]+g[1]*d+c[1]*l]),y.push(n),y.push([m[0]-g[0]*d+c[0]*l,m[1]-g[1]*d+c[1]*l]),i.push(y);break}case Zi.ChevronArrowOffset:{const[o,a]=this._arrowLastSeg(r),l=this._sub(n,o),c=this._norm(l);this._normalize(l);const u=this._crossProduct(l,this._sub(a,o));let d=this._dotProduct(l,this._sub(a,o));d<.05*c?d=.05*c:d>.95*c&&(d=.95*c);const f=[o[0]+l[0]*d,o[1]+l[1]*d];this._leftPerpendicular(l);const m=[];m.push([f[0]+l[0]*u*.5,f[1]+l[1]*u*.5]),m.push(this._mid(f,n)),m.push([f[0]-l[0]*u*.5,f[1]-l[1]*u*.5]),i.push(m);break}case Zi.PartialFirstSegment:{const[o,a]=this._arrowLastSeg(r),l=this._sub(n,o),c=this._norm(l);this._normalize(l);let u=this._dotProduct(l,this._sub(a,o));u<.05*c?u=.05*c:u>.95*c&&(u=.95*c);const d=[o[0]+l[0]*u,o[1]+l[1]*u];i.push([o,d]);break}case Zi.Arch:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,1),l=this._sub(n,o),c=this._mix(a,1,l,.55),u=this._mix(a,1,l,-.55),d=[n];this._addBezier2(d,n,c,a,4),this._addBezier2(d,a,u,o,4),i.push(d);break}case Zi.CurvedParallelTicks:{const o=this._cp2(r,-4,1),a=this._cp3(r,o,.882353,-1.94),l=this._sub(a,o);this._crossProduct(l,this._sub(n,o))>0?this._rightPerpendicular(l):this._leftPerpendicular(l);const c=[l[0]/8,l[1]/8],u=this._sub(this._mid(o,a),c),d=this._sub(this._mix(o,.75,a,.25),c),f=this._sub(this._mix(o,.25,a,.75),c),m=[o];this._addBezier2(m,o,d,u,3),this._addBezier2(m,u,f,a,3),i.push(m);for(let g=0;g<8;g++){const y=m[2*g+1],v=[this._clone(y)];v.push(this._add(y,[l[0]/4,l[1]/4])),i.push(v)}break}case Zi.Arc90Degrees:{const o=this._cp2(r,0,-1),a=this._cp3(r,o,.5,1),l=[o];this._add90DegArc(l,o,n,a),i.push(l);break}case Zi.TipWithPerpendicularAndTicks:{const[o,a]=this._arrowLastSeg(r),l=10*this._geomUnitsPerPoint,c=this._sub(n,o),u=this._norm(c);this._normalize(c);let d=this._crossProduct(c,this._sub(a,o)),f=this._dotProduct(c,this._sub(a,o));f<.05*u?f=.05*u:f>.95*u-l&&(f=.95*u-l);const m=this._leftPerp(c),g=[n[0]-c[0]*l,n[1]-c[1]*l],y=.5*Math.max(u-f-l,l);d=Math.abs(d);const v=[];v.push([g[0]+m[0]*(d+y)-c[0]*y,g[1]+m[1]*(d+y)-c[1]*y]),v.push([g[0]+m[0]*d,g[1]+m[1]*d]),v.push([g[0]-m[0]*d,g[1]-m[1]*d]),v.push([g[0]-m[0]*(d+y)-c[0]*y,g[1]-m[1]*(d+y)-c[1]*y]),i.push(v),i.push([g,n]);break}case Zi.FullGeometry:default:i.push(r)}}return i}},C4e=class wI{static local(){return wI.instance===null&&(wI.instance=new wI),wI.instance}execute(e,i,r,s,n){return new ISt(e,i,r)}};C4e.instance=null;let ISt=class extends w8{constructor(e,i,r){super(e,!0,!0),this._curveHelper=new ev,this._beginCut=(i.beginCut!==void 0?i.beginCut:1)*r,this._endCut=(i.endCut!==void 0?i.endCut:1)*r,this._middleCut=(i.middleCut!==void 0?i.middleCut:0)*r,this._invert=i.invert!==void 0&&i.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(e){const{_beginCut:i,_endCut:r,_middleCut:s}=this,n=e.pathLength(),o=to.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._invert){if(i!==0||r!==0||s!==0)if(i+r+s>=n)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else this._curveHelper.appendSubCurve(o,e,0,i),this._curveHelper.appendSubCurve(o,e,.5*(n-s),.5*(n+s)),this._curveHelper.appendSubCurve(o,e,n-r,r)}else if(i===0&&r===0&&s===0)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else i+r+s<n&&(s===0?this._curveHelper.appendSubCurve(o,e,i,n-r):(this._curveHelper.appendSubCurve(o,e,i,.5*(n-s)),this._curveHelper.appendSubCurve(o,e,.5*(n+s),n-r)));return o.totalSize===0?null:o}};const k0e=1e-7;let x8=class{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return this._values.length===0}size(){return this._values.length}init(e,i,r=!0){if(this._setEmpty(),!e||e.length===0)return!1;for(let s=0;s<e.length;s++){let n=Math.abs(e[s]);r&&n<k0e&&(n=k0e),this._values.push(n),this._length+=n}return i&&1&e.length&&(this._length*=2),this._length!==0&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(e){const i=this._values?this._values.length:0;for(let r=0;r<i;++r)this._values[r]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e}addValue(e){this._length+=e,this._values.push(e)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}},H0=class{constructor(){this.pt=null,this.ca=0,this.sa=0}};var X1;(function(t){t[t.FAIL=0]="FAIL",t[t.END=1]="END",t[t.CONTINUE=2]="CONTINUE"})(X1||(X1={}));let r5=class{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return this.segment!==null}copyTo(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd}},T8=class extends ev{constructor(e=0,i=!1){super(e,i),this._tolerance=pD,this._currentPosition=new r5}updateTolerance(e){this._tolerance=pD*e}init(e,i,r=!0){return r?(this._patternLength=i.length(),this._partExtPtGap=i.extPtGap,this._partCtrlPtGap=i.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=e,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(e,i=X1.FAIL){const r=new r5;return!!this._nextPosition(e,r,null,i)&&(r.copyTo(this._currentPosition),!0)}curPointAndAngle(e){e.pt=this._getPoint(this._currentPosition);const[i,r]=this._getAngleCS(this._currentPosition);e.ca=i,e.sa=r}nextPointAndAngle(e,i,r=X1.FAIL){const s=new r5;if(!this._nextPosition(e,s,null,r))return!1;s.copyTo(this._currentPosition),i.pt=this._getPoint(s);const[n,o]=this._getAngleCS(s);return i.ca=n,i.sa=o,!0}nextCurve(e){if(e===0)return null;const i=to.createEmptyOptimizedCIM("esriGeometryPolyline");i.startPath(),i.nextPath();const r=new r5;return this._nextPosition(e,r,i,X1.END)?(r.copyTo(this._currentPosition),i):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(e){return this._pathCursor.seekInPath(e),[this._pathCursor.x,this._pathCursor.y]}getSeg(e){return[this.getPt(e),this.getPt(e+1)]}_nextPosition(e,i,r,s){if(this._currentPosition.isPathEnd)return!1;let n=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(n/=this._currentPosition.segmentLength),this._currentPosition.copyTo(i);i.abscissa+e*this._partLengthRatio>i.segmentLength+this._tolerance;){if(r){if(r.pathSize===0)if(n===0){const a=i.segment[0];r.pushXY(a[0],a[1])}else r.pushPoint(this.getSegCoord2D(i.segment,n));const o=i.segment[1];r.pushXY(o[0],o[1])}if(n=0,e-=(i.segmentLength-i.abscissa)/this._partLengthRatio,this._partSegCount)i.segment=this._nextSegment(),i.segmentLength=this.getSegLength(i.segment),i.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return s!==X1.FAIL&&(i.segmentLength=this.getSegLength(i.segment),i.isPartEnd=!0,s===X1.END?(i.abscissa=i.segmentLength,i.isPathEnd=!0):i.abscissa=i.segmentLength+e,!0);this._currentPosition.copyTo(i)}}if(i.abscissa+=e*this._partLengthRatio,r){r.pathSize===0&&(n===0?r.pushPoint(i.segment[0]):r.pushPoint(this.getSegCoord2D(i.segment,n)));const o=i.abscissa/i.segmentLength;o===1?r.pushPoint(i.segment[1]):r.pushPoint(this.getSegCoord2D(i.segment,o))}return this._partSegCount||Math.abs(i.abscissa-i.segmentLength)<this._tolerance&&(i.isPathEnd=this._partIsLast,i.isPartEnd=!0),!0}_getPoint(e){const i=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,i)}_getAngleCS(e){const i=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegAngleCS(this._currentPosition.segment,i)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let e=this._partSegCount;for(;e;)this._previousSegment(),--e;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const i=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(i);let r=i+this._partSegCount+1;if(r>=this._pathCursor.pathSize&&(r=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(r),this._patternLength>0){const s=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,n=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let o=Math.round((this._partLength-(s+n))/this._patternLength);o<=0&&(o=s+n>0?0:1),this._partLengthRatio=this._partLength/(s+n+o*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}};const GA={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMSolidFill:{enable:!0,colorlocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:"Loop",repeatdelay:0}};function LSt(t){return typeof t=="function"}function DSt(t,e,i,r){return LSt(t)?t(e,i,r):t}const NSt=` /-,
`;function U0e(t){let e=t.length;for(;e--;)if(!NSt.includes(t.charAt(e)))return!1;return!0}function FSt(t,e){const i=[];let r=0,s=-1;do if(s=t.indexOf("[",r),s>=r){if(s>r){const n=t.substr(r,s-r);i.push([n,null,U0e(n)])}if(r=s+1,s=t.indexOf("]",r),s>=r){if(s>r){const n=e[t.substr(r,s-r)];n&&i.push([null,n,!1])}r=s+1}}while(s!==-1);if(r<t.length-1){const n=t.substr(r);i.push([n,null,U0e(n)])}return i}function kSt(t,e,i,r){let s="",n=null;for(const o of e){const[a,l,c]=o;if(a)c?n=a:(n&&(s+=n,n=null),s+=a);else{let u=l;i!=null&&(u=I4e(l,i));const d=t.attributes[u];d&&(n&&(s+=n,n=null),s+=d)}}return USt(s,r)}function USt(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function VSt(t){return t?[t[0],t[1],t[2],t[3]/255]:[0,0,0,0]}function M4e(t){var e;return((e=t.data)==null?void 0:e.symbol)??null}function A4e(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function P4e(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function Fae(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const Fi=(t,e=0)=>t==null||isNaN(t)?e:t,zSt=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function BSt(){return oe(()=>import("./geometryEngineJSON-C7R8ki81.js").then(t=>t.g),__vite__mapDeps([16,17,18]))}function jSt(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function GSt(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function O4e(t){let e="normal",i="normal";if(t){const r=t.toLowerCase();r.includes("italic")?e="italic":r.includes("oblique")&&(e="oblique"),r.includes("bold")?i="bold":r.includes("light")&&(i="lighter")}return{style:e,weight:i}}function $4e(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function K3(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=K3(e);if(i!=null)return i}break;case"CIMTextSymbol":return K3(t.symbol);case"CIMSolidFill":return t.color}return null}function tee(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const i of e){const r=tee(i);if(r!=null)return r}break}case"CIMTextSymbol":return tee(t.symbol);case"CIMSolidStroke":return t.color}}function iee(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=iee(e);if(i!==void 0)return i}break;case"CIMTextSymbol":return iee(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function HSt(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function qSt(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function WSt(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const HE=t=>t.includes("data:image/svg+xml");function ani(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function kae(t){return t&&t.charAt(0).toLowerCase()+t.substring(1)}function lni(t,e,i,r,s,n){const{infos:o}=n;let a=1,l=0,c=0,u=0;for(const{offsetX:m,offsetY:g,rotation:y,size:v,frameHeight:b,rotateClockWise:w}of o)c=B0e(m,g,l,a,c),u=z0e(m,g,l,a,u),b&&(a*=v/b),l=j0e(y,w,l);const d=B0e(r,s,l,a,c),f=z0e(r,s,l,a,u);return{size:t*a,rotation:j0e(e,i,l),offsetX:d,offsetY:f}}function R4e(t){return t!=null&&t.dashTemplate&&typeof t.dashTemplate=="string"&&(t.dashTemplate=t.dashTemplate.split(" ").map(Number)),t}function ree(t){if(t==null)return"Normal";switch(t.type){case"CIMTextSymbol":return t.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const e=t.symbolLayers;if(!e)return"Normal";for(const i of e)if(i.type==="CIMVectorMarker")return ree(i)}break;case"CIMVectorMarker":{const e=t.markerGraphics;if(!e)return"Normal";for(const i of e)if(i.symbol)return ree(i.symbol)}}return"Normal"}function I4e(t,e){if(e!==null){const i=e.get(t);return i?i.name:t}return t}function ZSt(t){return t.map(e=>({...e,propertyName:kae(e.propertyName)}))}function V0e(t){const e={};for(const i in t){const r=t[i];e[kae(i)]=r}return e}function z0e(t,e,i,r,s){const n=i*Math.PI/180;if(n){const o=Math.cos(n);return(Math.sin(n)*t+o*e)*r+s}return e*r+s}function B0e(t,e,i,r,s){const n=i*Math.PI/180;return n?(Math.cos(n)*t-Math.sin(n)*e)*r+s:t*r+s}function j0e(t,e,i){return e?i-t:i+t}const YSt=1e3,G0e=1e-7;let L4e=class xI{static local(){return xI.instance===null&&(xI.instance=new xI),xI.instance}execute(e,i,r,s,n){return new XSt(e,i,r,s)}};L4e.instance=null;let XSt=class extends w8{constructor(e,i,r,s){super(e,!0,!0),this._firstCurve=null,this._walker=new T8,this._walker.updateTolerance(r),this._endings=i.lineDashEnding,this._customDashPos=-(i.offsetAlongLine??0)*r,this._offsetAtEnd=(i.customEndingOffset??0)*r,this._tileKey=s;let n=R4e(i).dashTemplate;n==null&&(n=[]),n.length%2&&(n=[...n,...n]);let o=0;for(let a=0;a<n.length;a++){let l=Math.abs(n[a]);l<G0e&&(l=G0e),o+=l}this._patternLength=o,this._numOfDashesPerPattern=n.length/2,this._pattern=new x8,this._pattern.init(n,!0),this._pattern.scale(r)}processPath(e){if(this._pattern.length()===0){this.iteratePath=!1;const s=_b(e);return to.fromJSONCIM({paths:[s]})}if(!this.iteratePath){let s=!0;switch(this._endings){case sl.HalfPattern:case sl.HalfGap:default:this._pattern.extPtGap=0;break;case sl.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case sl.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case sl.NoConstraint:this.isClosed||(s=!1);break;case sl.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const n=e.pathLength();if(this._pattern.isEmpty()||n<.1*this._pattern.length()){const o=_b(e);return to.fromJSONCIM({paths:[o]})}if(!this._walker.init(e,this._pattern,s)){const o=_b(e);return to.fromJSONCIM({paths:[o]})}}let i;if(this.iteratePath)i=this._pattern.nextValue();else{let s;switch(this._endings){case sl.HalfPattern:default:s=.5*this._pattern.firstValue();break;case sl.HalfGap:s=.5*-this._pattern.lastValue();break;case sl.FullGap:s=-this._pattern.lastValue();break;case sl.FullPattern:s=0;break;case sl.NoConstraint:case sl.Custom:s=-this._customDashPos}let n=s/this._pattern.length();n-=Math.floor(n),s=n*this._pattern.length(),this._pattern.reset(),i=this._pattern.nextValue();let o=!1;for(;s>=i;)s-=i,i=this._pattern.nextValue(),o=!o;i-=s,o?(this._walker.nextPosition(i),i=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(i),i=this._pattern.nextValue(),this._walker.nextPosition(i),i=this._pattern.nextValue())}let r=this._walker.nextCurve(i);if(r)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)r.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else i=this._pattern.nextValue(),!this._walker.nextPosition(i)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(r.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,r=this._firstCurve,this._firstCurve=null;return r==null||r.reset(),r}isClippingRequired(e){const i=XD(e);let r=0;for(const s of i)r+=dse(s);return Math.round(this._numOfDashesPerPattern*(r/this._patternLength))>YSt}},D4e=class TI{static local(){return TI.instance===null&&(TI.instance=new TI),TI.instance}execute(e,i,r,s,n,o){return new JSt(e,i,r,s,n,o)}};D4e.instance=null;let JSt=class{constructor(e,i,r,s,n,o){switch(this._inputGeometries=e,this._tileKey=s,this._geometryEngine=n,this._maxInflateSize=o*r,this._width=(i.width!==void 0?i.width:2)*r,i.method){case WT.Mitered:case WT.Bevelled:case WT.Rounded:case WT.TrueBuffer:case WT.Square:}this._option=i.option}next(){let e;for(;e=this._inputGeometries.next();){if(e.geometryType==="esriGeometryEnvelope"&&this._width>0){const i=e.asJSON();return Math.min(i.xmax-i.xmin,i.ymax-i.ymin)-2*this._width<0?e:to.fromJSONCIM({paths:[[[i.xmin+this._width,i.ymin+this._width],[i.xmax-this._width,i.ymin+this._width],[i.xmax-this._width,i.ymax-this._width],[i.xmin+this._width,i.ymax-this._width],[i.xmin+this._width,i.ymin+this._width]],[[i.xmin,i.ymin],[i.xmin,i.ymax],[i.xmax,i.ymax],[i.xmax,i.ymin],[i.xmin,i.ymin]]]})}if(e.geometryType==="esriGeometryPolygon"){if(this._width===0)return e.clone();const i=this._geometryEngine;if(i==null)return null;const r=this._tileKey?b8(e,this._maxInflateSize):e.clone();if(!r)continue;const s=i.buffer(Ye.WebMercator,r.asJSON(),-this._width,1);if(s){for(const n of s.rings)if(n){r.startPath();for(const o of n.reverse())r.pushXY(o[0],r.yFactor*o[1])}}return r}}return null}},N4e=class SI{static local(){return SI.instance===null&&(SI.instance=new SI),SI.instance}execute(e,i,r,s,n){return new QSt(e,i,r)}};N4e.instance=null;let QSt=class extends w8{constructor(e,i,r){super(e,!1,!0),this._curveHelper=new ev,this._length=(i.length!==void 0?i.length:20)*r,this._angle=i.angle!==void 0?i.angle:225,this._position=i.position!==void 0?i.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(e){const i=to.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(e))return null;e.seekInPath(0);const r=e.x,s=e.y;e.seekInPath(e.pathSize-1);const n=e.x,o=e.y,a=[n-r,o-s];this._curveHelper.normalize(a);const l=r+(n-r)*this._position/100,c=s+(o-s)*this._position/100,u=Math.cos((90-this._angle)/180*Math.PI);let d=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(d=-d),this._mirror=!this._mirror;const f=[l-this._length/2*u,c-this._length/2*d],m=[l+this._length/2*u,c+this._length/2*d];return i.pushPath([[r,s],f,m,[n,o]]),i}},F4e=class EI{static local(){return EI.instance===null&&(EI.instance=new EI),EI.instance}execute(e,i,r,s,n){return new KSt(e,i,r)}};F4e.instance=null;let KSt=class{constructor(e,i,r){this._inputGeometries=e,this._offsetX=i.offsetX!==void 0?i.offsetX*r:0,this._offsetY=i.offsetY!==void 0?i.offsetY*r:0}next(){let e=this._inputGeometries.next();for(;e;){if(e.totalSize>0)return this._move(e.clone(),this._offsetX,this._offsetY);e=this._inputGeometries.next()}return null}_move(e,i,r){for(;e.nextPath();)for(;e.nextPoint();)e.x=e.x+i,e.y=e.y+r;return e.reset(),e}};const e2t=10;let k4e=class CI{static local(){return CI.instance===null&&(CI.instance=new CI),CI.instance}execute(e,i,r,s,n,o){return new t2t(e,i,r,s,n,o)}};k4e.instance=null;let t2t=class{constructor(e,i,r,s,n,o){this._inputGeometries=e,this._tileKey=s,this._geometryEngine=n,this._curveHelper=new ev,this._offset=(i.offset??1)*r,this._method=i.method,this._maxInflateSize=Math.max(Math.abs(o*r),e2t),this._option=i.option,this._offsetFlattenError=pD*r}next(){let e;for(;e=this._inputGeometries.next();){if(this._offset===0)return e.clone();if(e.geometryType==="esriGeometryEnvelope"){if(this._method===l_.Rounded&&this._offset>0){const o=_b(e),a=this._curveHelper.offset(o,-this._offset,this._method,4,this._offsetFlattenError);if(a){const l=to.createEmptyOptimizedCIM(e.geometryType);return l.pushPath(a),l}return null}const n=e.asJSON();if(Df(n)&&Math.min(n.xmax-n.xmin,n.ymax-n.ymin)+2*this._offset>0)return to.fromJSONCIM({xmin:n.xmin-this._offset,xmax:n.xmax+this._offset,ymin:n.ymin-this._offset,ymax:n.ymax+this._offset})}const i=this._geometryEngine;if(i==null)continue;const r=this._tileKey?b8(e,this._maxInflateSize):e.clone();if(!r)continue;const s=i.offset(Ye.WebMercator,r.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError);return s?to.fromJSONCIM(s):null}return null}},U4e=class MI{static local(){return MI.instance===null&&(MI.instance=new MI),MI.instance}execute(e,i,r,s,n){return new i2t(e,i,r)}};U4e.instance=null;let i2t=class{constructor(e,i,r){this._inputGeometries=e,this._reverse=i.reverse===void 0||i.reverse}next(){let e=this._inputGeometries.next();for(;e;){if(!this._reverse)return e;if(e.geometryType==="esriGeometryPolyline")return r2t(e.clone());e=this._inputGeometries.next()}return null}};function r2t(t){for(;t.nextPath();)for(let e=0;e<t.pathSize/2;e++){t.seekInPath(e);const i=t.x,r=t.y;t.seekInPath(t.pathSize-e-1);const s=t.x,n=t.y;t.x=i,t.y=r,t.seekInPath(e),t.x=s,t.y=n}return t.reset(),t}let V4e=class AI{static local(){return AI.instance===null&&(AI.instance=new AI),AI.instance}execute(e,i,r,s,n){return new s2t(e,i,r)}};V4e.instance=null;let s2t=class{constructor(e,i,r){this._inputGeometries=e,this._rotateAngle=i.angle!==void 0?i.angle*Math.PI/180:0}next(){let e=this._inputGeometries.next();for(;e;){if(this._rotateAngle===0||e.geometryType==="esriGeometryPoint")return e;if(e.totalSize>0){const i=zG(e),r=(i[2]+i[0])/2,s=(i[3]+i[1])/2;return e.reset(),this._rotate(e.clone(),r,s)}e=this._inputGeometries.next()}return null}_rotate(e,i,r){const s=Math.cos(this._rotateAngle),n=Math.sin(this._rotateAngle);for(;e.nextPath();)for(;e.nextPoint();){const o=e.x-i,a=e.y-r;e.x=i+o*s-a*n,e.y=r+o*n+a*s}return e.reset(),e}},z4e=class PI{static local(){return PI.instance===null&&(PI.instance=new PI),PI.instance}execute(e,i,r,s,n){return new n2t(e,i,r)}};z4e.instance=null;let n2t=class{constructor(e,i,r){this._inputGeometries=e,this._xFactor=i.xScaleFactor!==void 0?i.xScaleFactor:1.15,this._yFactor=i.yScaleFactor!==void 0?i.yScaleFactor:1.15}next(){const e=this._inputGeometries.next();if(e){if(this._xFactor===1&&this._yFactor===1||e.geometryType==="esriGeometryPoint")return e;if(e.totalSize>0){const i=zG(e),r=(i[2]+i[0])/2,s=(i[3]+i[1])/2;return e.reset(),this._scaleCursor(e.clone(),r,s)}}return null}_scaleCursor(e,i,r){for(;e.nextPath();)for(;e.nextPoint();)e.x=i+(e.x-i)*this._xFactor,e.y=r+(e.y-r)*this._yFactor;return e.reset(),e}},B4e=class OI{static local(){return OI.instance===null&&(OI.instance=new OI),OI.instance}execute(e,i,r,s,n){return new o2t(e,i,r)}};B4e.instance=null;let o2t=class{constructor(e,i,r){this._inputGeometries=e,this._height=(i.amplitude!==void 0?i.amplitude:2)*r,this._period=(i.period!==void 0?i.period:3)*r,this._style=i.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new x8,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new T8,this._walker.updateTolerance(r)}next(){let e=this._inputGeometries.next();for(;e;){if(this._height===0||this._period===0)return e;const i=this._processGeom(e);if(i)return i;e=this._inputGeometries.next()}return null}_processGeom(e){const i=to.createEmptyOptimizedCIM(e.geometryType);for(;e.nextPath();){i.startPath();const r=e.pathLength();if(this._walker.init(e,this._pattern))switch(this._style){case XM.Sinus:default:this._constructCurve(i,r,!1);break;case XM.Square:this._constructSquare(i,r);break;case XM.Triangle:this._constructTriangle(i,r);break;case XM.Random:this._constructCurve(i,r,!0)}else for(;e.nextPoint();)i.pushXY(e.x,e.y)}return i}_constructCurve(e,i,r){let s=Math.round(i/this._period);s===0&&(s=1);const n=s*16+1,o=i/s,a=this._period/16,l=1/n,c=2*Math.PI*i/o,u=2*Math.PI*Math.random(),d=2*Math.PI*Math.random(),f=2*Math.PI*Math.random(),m=.75-Math.random()/2,g=.75-Math.random()/2,y=new H0;this._walker.curPointAndAngle(y),e.pushPoint(y.pt);let v=0;for(;;){if(!this._walker.nextPointAndAngle(a,y)){e.pushPoint(this._walker.getPathEnd());break}{const b=v;let w;if(v+=l,r){const x=this._height/2*(1+.3*Math.sin(m*c*b+u));w=x*Math.sin(c*b+d),w+=x*Math.sin(g*c*b+f),w/=2}else w=.5*this._height*Math.sin(.5*c*b);e.pushXY(y.pt[0]-w*y.sa,y.pt[1]+w*y.ca)}}}_constructSquare(e,i){Math.round(i/this._period);let r=!0;for(;;){let s=!1;if(this._walker.curPositionIsValid()){const n=new H0;this._walker.curPointAndAngle(n);const o=new H0;if(this._walker.nextPointAndAngle(this._period,o)){const a=new H0;this._walker.nextPointAndAngle(this._period,a)&&(r?(e.pushPoint(n.pt),r=!1):e.pushPoint(n.pt),e.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),e.pushXY(o.pt[0]-this._height/2*o.sa,o.pt[1]+this._height/2*o.ca),e.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca),e.pushXY(a.pt[0]+this._height/2*a.sa,a.pt[1]-this._height/2*a.ca),s=!0)}}if(!s){e.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(e,i){Math.round(i/this._period);let r=!0;for(;;){let s=!1;if(this._walker.curPositionIsValid()){const n=new H0;this._walker.curPointAndAngle(n);const o=new H0;if(this._walker.nextPointAndAngle(this._period/2,o)){const a=new H0;this._walker.nextPointAndAngle(this._period,a)&&(this._walker.nextPosition(this._period/2)&&(r?(e.pushPoint(n.pt),r=!1):e.pushPoint(n.pt),e.pushXY(o.pt[0]-this._height/2*o.sa,o.pt[1]+this._height/2*o.ca),e.pushXY(a.pt[0]+this._height/2*a.sa,a.pt[1]-this._height/2*a.ca)),s=!0)}}if(!s){e.pushPoint(this._walker.getPathEnd());break}}}},j4e=class $I{static local(){return $I.instance===null&&($I.instance=new $I),$I.instance}execute(e,i,r,s,n){return new a2t(e,i,r)}};j4e.instance=null;let a2t=class extends NN{constructor(e,i,r){super(e),this._geometryWalker=new T8,this._geometryWalker.updateTolerance(r),this._angleToLine=i.angleToLine??!0,this._offset=(i.offset?i.offset:0)*r,this._originalEndings=i.endings,this._offsetAtEnd=(i.customEndingOffset?i.customEndingOffset:0)*r,this._position=-(i.offsetAlongLine?i.offsetAlongLine:0)*r,this._pattern=new x8,this._pattern.init(i.placementTemplate,!1),this._pattern.scale(r),this._endings=this._originalEndings}processPath(e){if(this._pattern.isEmpty())return null;let i;if(this.iteratePath)i=this._pattern.nextValue();else{this._originalEndings===_f.WithFullGap&&this.isClosed?this._endings=_f.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;let s,n=!0;switch(this._endings){case _f.NoConstraint:s=-this._position,s=this._adjustPosition(s),n=!1;break;case _f.WithHalfGap:default:s=-this._pattern.lastValue()/2;break;case _f.WithFullGap:s=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case _f.WithMarkers:s=0;break;case _f.Custom:s=-this._position,s=this._adjustPosition(s),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(e,this._pattern,n))return null;this._pattern.reset();let o=0;for(;s>o;)s-=o,o=this._pattern.nextValue();o-=s,i=o,this.iteratePath=!0}const r=new H0;return this._geometryWalker.nextPointAndAngle(i,r)?this._endings===_f.WithFullGap&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===_f.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(r.pt[0]-this._offset*r.sa,r.pt[1]+this._offset*r.ca),this._angleToLine&&this.internalPlacement.setRotateCS(r.ca,r.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(e){let i=e/this._pattern.length();return i-=Math.floor(i),i*this._pattern.length()}},G4e=class RI{static local(){return RI.instance===null&&(RI.instance=new RI),RI.instance}execute(e,i,r,s,n){return new l2t(e,i,r)}};G4e.instance=null;let l2t=class extends NN{constructor(e,i,r){super(e,!1,!0),this._curveHelper=new ev,this._placePerPart=i.placePerPart??!1,this._angleToLine=i.angleToLine===void 0||i.angleToLine,this._offset=i.offset!==void 0?i.offset*r:0,this._type=i.extremityPlacement,this._position=i.offsetAlongLine!==void 0?i.offsetAlongLine*r:0,this._beginProcessed=!1}processMultiPath(e){return this._placePerPart?super.processMultiPath(e):this.processPath(e)}processPath(e){let i;switch(this._type){case Yg.Both:default:this._beginProcessed?(i=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iterateMultiPath=!1,this.iteratePath=!1):(i=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iterateMultiPath=!0,this.iteratePath=!0);break;case Yg.JustBegin:i=this._atExtremities(e,this._position,!0);break;case Yg.JustEnd:i=this._atExtremities(e,this._position,!1);case Yg.None:}return i}_atExtremities(e,i,r){if(this._placePerPart||(r?e.seekPath(0):e.seekPath(e.totalSize-1)),r||e.seekPathEnd(),r?e.nextPoint():e.prevPoint()){let s=0,[n,o]=[0,0],[a,l]=[e.x,e.y];for(;r?e.nextPoint():e.prevPoint();){n=a,o=l,a=e.x,l=e.y;const c=this._curveHelper.getLength(n,o,a,l);if(s+c>i){const u=(i-s)/c,[d,f]=this._curveHelper.getAngleCS(n,o,a,l,u),m=this._curveHelper.getCoord2D(n,o,a,l,u);return this.internalPlacement.setTranslate(m[0]-this._offset*f,m[1]+this._offset*d),this._angleToLine&&this.internalPlacement.setRotateCS(-d,-f),this.internalPlacement}s+=c}}return null}},H4e=class II{static local(){return II.instance===null&&(II.instance=new II),II.instance}execute(e,i,r,s,n){return new c2t(e,i,r)}};H4e.instance=null;let c2t=class extends NN{constructor(e,i,r){super(e),this._walker=new T8,this._walker.updateTolerance(r),this._angleToLine=i.angleToLine===void 0||i.angleToLine,this._offset=i.offset!==void 0?i.offset*r:0,this._beginGap=i.beginPosition!==void 0?i.beginPosition*r:0,this._endGap=i.endPosition!==void 0?i.endPosition*r:0,this._flipFirst=i.flipFirst===void 0||i.flipFirst,this._pattern=new x8,this._pattern.init(i.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(e){if(this._pattern.isEmpty())return null;let i;if(this.iteratePath){const a=this._pattern.nextValue()*this._subPathLen,l=this._beginGap+a;i=l-this._prevPos,this._prevPos=l}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=e.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();const a=this._pattern.nextValue()*this._subPathLen,l=this._beginGap+a;i=l-this._prevPos,this._prevPos=l,this.iteratePath=!0}const r=new H0;if(!this._walker.nextPointAndAngle(i,r,X1.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(r.pt[0]-this._offset*r.sa,r.pt[1]+this._offset*r.ca);const s=this._isFirst&&this._flipFirst;let n,o;return this._angleToLine?(n=r.ca,o=r.sa):(n=1,o=0),s&&(n=-n,o=-o),this.internalPlacement.setRotateCS(n,o),this._isFirst=!1,this._posCount--,this._posCount===0&&(this.iteratePath=!1),this.internalPlacement}};const Dv=512,u2t=10,$m=24,yj=1e-6;let q4e=class LI{static local(){return LI.instance===null&&(LI.instance=new LI),LI.instance}execute(e,i,r,s,n){return new h2t(e,i,r,s,n)}};q4e.instance=null;let h2t=class dT{constructor(e,i,r,s,n){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(i.stepX??16)*r,this._stepY=Math.abs(i.stepY??16)*r,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,this._stepX!==0&&this._stepY!==0){if(this._gridType=i.gridType??Q3.Fixed,this._gridType===Q3.Random){const o=i.seed??13,a=1;this._randomLCG=new TS(o*a),this._randomness=(i.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=i.gridAngle??0,this._shiftOddRows=i.shiftOddRows??!1,this._offsetX=(i.offsetX??0)*r,this._offsetY=(i.offsetY??0)*r,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,s!=null){const[o,a,l,c]=s.split("/"),u=parseFloat(o),d=parseFloat(a),f=parseFloat(l),m=parseFloat(c);this._graphicOriginX=-(m*2**u+f)*Dv,this._graphicOriginY=d*Dv,this._testInsidePolygon=!0}this._internalPlacement=new zO,this._calculateMinMax(e),this._geometryCursor=e}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!dT._randValues){dT._randValues=[];for(let e=0;e<$m;e++)for(let i=0;i<$m;i++)dT._randValues.push(this._randomLCG.getFloat()),dT._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(e){let i,r,s,n,o,a,l,c,u,d,f,m,g,y;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,l=c=g=f=Number.MAX_VALUE,u=d=y=m=-Number.MAX_VALUE;const v=this._cosAngle!==1;for(e.reset();e.nextPath();)for(;e.nextPoint();)a=e.x,o=e.y,i=a-this._graphicOriginX-this._offsetX,r=o-this._graphicOriginY-this._offsetY,v?(s=this._cosAngle*i-this._sinAngle*r,n=this._sinAngle*i+this._cosAngle*r):(s=i,n=r),l=Math.min(l,s),u=Math.max(u,s),c=Math.min(c,n),d=Math.max(d,n),f=Math.min(f,o),m=Math.max(m,o),g=Math.min(g,a),y=Math.max(y,a);f=f!==Number.MAX_VALUE?f:-Dv-this._stepY,m=m!==-Number.MAX_VALUE?m:this._stepY,g=g!==Number.MAX_VALUE?g:-this._stepX,y=y!==-Number.MAX_VALUE?y:Dv+this._stepX;const b=m-f,w=y-g;if(this._verticalSubdivision=b>=w,this._polygonMin=this._verticalSubdivision?f:g,this._testInsidePolygon){let x=0-this._graphicOriginX-this._offsetX-this._stepX,T=Dv-this._graphicOriginX-this._offsetX+this._stepX,E=-Dv-this._graphicOriginY-this._offsetY-this._stepY,M=0-this._graphicOriginY-this._offsetY+this._stepY;if(v){const O=[[x,E],[x,M],[T,E],[T,M]];x=E=Number.MAX_VALUE,T=M=-Number.MAX_VALUE;for(const D of O){const U=this._cosAngle*D[0]-this._sinAngle*D[1],k=this._sinAngle*D[0]+this._cosAngle*D[1];x=Math.min(x,U),T=Math.max(T,U),E=Math.min(E,k),M=Math.max(M,k)}}l=l!==Number.MAX_VALUE?Math.max(l,x):x,c=c!==Number.MAX_VALUE?Math.max(c,E):E,u=u!==-Number.MAX_VALUE?Math.min(u,T):T,d=d!==-Number.MAX_VALUE?Math.min(d,M):M}this._xMin=Math.round(l/this._stepX),this._xMax=Math.round(u/this._stepX),this._yMin=Math.round(c/this._stepY),this._yMax=Math.round(d/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(e,g,y,f,m)}_buildAccelerationMap(e,i,r,s,n){e.reset();const o=new Map,a=this._verticalSubdivision,l=a?n-s:r-i;let c=Math.ceil(l/u2t);if(c<=1)return;const u=Math.floor(l/c);let d,f,m,g,y,v,b,w,x,T,E;for(c++,this._delta=u,a?(x=-Dv-2*this._stepY,T=2*this._stepY,E=s):(x=-2*this._stepX,T=Dv+2*this._stepX,E=i);e.nextPath();)if(!(e.pathSize<2)&&e.nextPoint())for(d=e.x,f=e.y;e.nextPoint();d=m,f=g){if(m=e.x,g=e.y,a){if(f===g||f<x&&g<x||f>T&&g>T)continue;y=Math.min(f,g),v=Math.max(f,g)}else{if(d===m||d<x&&m<x||d>T&&m>T)continue;y=Math.min(d,m),v=Math.max(d,m)}for(;y<v;)b=Math.floor((y-E)/u),H0e(b,d,f,m,g,o),y+=u;w=Math.floor((v-E)/u),w>b&&H0e(w,d,f,m,g,o)}this._accelerationMap=o}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let e=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(e+=.5*this._stepX);const i=this._currentY*this._stepY+this._offsetY;let r,s;if(this._currentX++,this._gridType===Q3.Random){const n=(this._currentX%$m+$m)%$m,o=(this._currentY%$m+$m)%$m;r=this._graphicOriginX+e+this._stepX*this._randomness*(.5-dT._randValues[o*$m+n])*2/3,s=this._graphicOriginY+i+this._stepY*this._randomness*(.5-dT._randValues[o*$m+n+1])*2/3}else r=this._graphicOriginX+this._cosAngle*e+this._sinAngle*i,s=this._graphicOriginY-this._sinAngle*e+this._cosAngle*i;if(!this._testInsidePolygon||this._isInsidePolygon(r,s,this._geometryCursor))return this._internalPlacement.setTranslate(r,s),this._internalPlacement}}_isInsidePolygon(e,i,r){if(this._accelerationMap==null)return d2t(e,i,r);e+=yj,i+=yj;const s=this._verticalSubdivision,n=s?i:e,o=Math.floor((n-this._polygonMin)/this._delta),a=this._accelerationMap.get(o);if(!a)return!1;let l,c,u,d=0;for(const f of a){if(l=f[0],c=f[1],s){if(l[1]>i==c[1]>i)continue;u=(c[0]-l[0])*(i-l[1])-(c[1]-l[1])*(e-l[0])}else{if(l[0]>e==c[0]>e)continue;u=(c[1]-l[1])*(e-l[0])-(c[0]-l[0])*(i-l[1])}u>0?d++:d--}return d!==0}};function d2t(t,e,i){let r,s,n,o,a=0;for(t+=yj,e+=yj,i.reset();i.nextPath();)if(i.nextPoint())for(r=i.x,s=i.y;i.nextPoint();r=n,s=o)n=i.x,o=i.y,s>e!=o>e&&((n-r)*(e-s)-(o-s)*(t-r)>0?a++:a--);return a!==0}function H0e(t,e,i,r,s,n){let o=n.get(t);o||(o=[],n.set(t,o)),o.push([[e,i],[r,s]])}const p2t=.001;let W4e=class DI{static local(){return DI.instance===null&&(DI.instance=new DI),DI.instance}execute(e,i,r,s,n){return new f2t(e,i,r)}};W4e.instance=null;let f2t=class extends NN{constructor(e,i,r){super(e),this._curveHelper=new ev,this._angleToLine=i.angleToLine===void 0||i.angleToLine,this._offset=i.offset!==void 0?i.offset*r:0,this._relativeTo=i.relativeTo,this._position=i.startPointOffset!==void 0?i.startPointOffset*r:0,this._epsilon=p2t*r}processPath(e){const i=this._position;if(this._relativeTo===ZT.SegmentMidpoint){if(this.iteratePath||(this.iteratePath=!0),e.nextPoint()){let[s,n]=[e.x,e.y],[o,a]=[0,0];for(;e.nextPoint();){o=e.x,a=e.y;const l=this._curveHelper.getLength(s,n,o,a);if(l<this._epsilon){s=o,n=a;continue}const c=.5+this._position/l,[u,d]=this._curveHelper.getAngleCS(s,n,o,a,c),f=this._curveHelper.getCoord2D(s,n,o,a,c);return this.internalPlacement.setTranslate(f[0]-this._offset*d,f[1]+this._offset*u),this._angleToLine&&this.internalPlacement.setRotateCS(u,d),this.internalPlacement}}return this.iteratePath=!1,null}const r=this._relativeTo===ZT.LineEnd;return this.onLine(e,i,r)}onLine(e,i,r){let s,n=!1;switch(this._relativeTo){case ZT.LineMiddle:default:e.seekPathStart(),s=e.pathLength()/2+i;break;case ZT.LineBeginning:s=i;break;case ZT.LineEnd:s=i,n=!0}r?e.seekPathEnd():e.seekPathStart();let o=0;if(r?e.prevPoint():e.nextPoint()){let[a,l]=[e.x,e.y],[c,u]=[0,0];for(;r?e.prevPoint():e.nextPoint();){c=e.x,u=e.y;const d=this._curveHelper.getLength(a,l,c,u);if(o+d>s){const f=(s-o)/d,[m,g]=this._curveHelper.getAngleCS(a,l,c,u,f),y=this._curveHelper.getCoord2D(a,l,c,u,f),v=n?-this._offset:this._offset;return this.internalPlacement.setTranslate(y[0]-v*g,y[1]+v*m),this._angleToLine&&(n?this.internalPlacement.setRotateCS(-m,-g):this.internalPlacement.setRotateCS(m,g)),this.internalPlacement}a=c,l=u,o+=d}}return null}};const m2t=1e-15;let Z4e=class NI{static local(){return NI.instance===null&&(NI.instance=new NI),NI.instance}execute(e,i,r,s,n){return new g2t(e,i,r)}};Z4e.instance=null;let g2t=class extends NN{constructor(e,i,r){super(e),this._curveHelper=new ev,this._angleToLine=i.angleToLine===void 0||i.angleToLine,this._offset=i.offset!==void 0?i.offset*r:0,this._endPoints=i.placeOnEndPoints===void 0||i.placeOnEndPoints,this._controlPoints=i.placeOnControlPoints===void 0||i.placeOnControlPoints,this._regularVertices=i.placeOnRegularVertices===void 0||i.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(e){if(this.iteratePath||(this._preparePath(e),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const i=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(i[2]);let r=i[0],s=i[1];if(this._offset!==0){const n=Math.cos(i[2]),o=Math.sin(i[2]);r-=this._offset*o,s+=this._offset*n}return this.internalPlacement.setTranslate(r,s),this._tagIterator++,this.internalPlacement}_preparePath(e){this._tags.length=0,this._tagIterator=0,e.seekPathStart();const i=e.isClosed();let r=0,s=!1,n=0,o=0;if(e.seekPathStart(),e.nextPoint()){let a=e.x,l=e.y,c=e.getControlPoint(),u=!0,d=e.nextPoint();for(;d;){const f=e.x,m=e.y,g=e.getControlPoint();(this._angleToLine||this._offset!==0)&&(n=this._curveHelper.getAngle(a,l,f,m,0)),u?(u=!1,i?(r=n,s=c):(this._endPoints||this._controlPoints&&c)&&this._tags.push([a,l,n])):c?this._controlPoints&&this._tags.push([a,l,s5(o,n)]):this._regularVertices&&this._tags.push([a,l,s5(o,n)]),(this._angleToLine||this._offset!==0)&&(o=this._curveHelper.getAngle(a,l,f,m,1)),d=e.nextPoint(),d||(i?g||s?this._controlPoints&&this._tags.push([f,m,s5(o,r)]):this._regularVertices&&this._tags.push([f,m,s5(o,r)]):(this._endPoints||this._controlPoints&&g)&&this._tags.push([f,m,o])),a=f,l=m,c=g}}this._tagIterator=0}};function s5(t,e){const i=Math.PI;for(;Math.abs(e-t)>i+2*m2t;)e-t>i?e-=2*i:e+=2*i;return(t+e)/2}const y2t=100*222045e-21;function _2t(t){if(t.totalSize===0)return null;const e=zG(t);if(!e)return null;const i=4*(Math.abs(e[0])+Math.abs(e[2])+Math.abs(e[1])+Math.abs(e[3])+1)*y2t;let r=0,s=0;t.reset();for(let U=0;t.nextPath();U++){const k=t.getCurrentRingArea();k>s&&(s=k,r=U)}if(t.seekPath(r),t.pathSize===0)return null;t.seekPathStart();const n=CMe(t);if(Math.abs(s)<=2*i*i)return[(n[0]+n[2])/2,(n[1]+n[3])/2];t.seekPathStart();const o=iQe(t,oi());if(o===null)return null;if(t.totalPoints<4)return o;const a=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],l=[NaN,NaN,NaN,NaN],c=[NaN,NaN,NaN,NaN];let u=!1,d=F$(o,t,!0);d.distance===0&&(u=!0,a[0][0]=o[0],a[0][1]=o[1],d=F$(o,t,!1)),l[0]=d.distance,c[0]=0;const f=[NaN,NaN];let m=!1,g=.25,y=-1,v=NaN;do if(v=NaN,a[1]=q9(t,W9(n[0],n[2],g),i,e),isNaN(a[1][0])||isNaN(a[1][1])||(d=F$(a[1],t,!1),v=d.distance),!isNaN(v)&&v>i&&rV(a[1],t))m=!0,l[1]=v,c[1]=pT(a[1],o);else if(!isNaN(v)&&v>y&&(y=v,f[0]=a[1][0],f[1]=a[1][1]),g-=.01,g<.1){if(!(y>=0))break;m=!0,l[1]=y,a[1][0]=f[0],a[1][1]=f[1],c[1]=pT(a[1],o)}while(!m);m=!1,g=.5,y=-1;let b=.01,w=1;do if(v=NaN,a[2]=q9(t,W9(n[0],n[2],g),i,e),isNaN(a[2][0])||isNaN(a[2][1])||(d=F$(a[2],t,!1),v=d.distance),!isNaN(v)&&v>i&&rV(a[2],t))m=!0,l[2]=v,c[2]=pT(a[2],o);else if(!isNaN(v)&&v>y)y=v,f[0]=a[2][0],f[1]=a[2][1];else if(v>y&&(y=v,f[0]=a[2][0],f[1]=a[2][1]),g=.5+b*w,b+=.01,w*=-1,g<.3||g>.7){if(!(y>=0))break;m=!0,l[2]=y,a[2][0]=f[0],a[2][1]=f[1],c[2]=pT(a[2],o)}while(!m);m=!1,g=.75,y=-1;do if(v=NaN,a[3]=q9(t,W9(n[0],n[2],g),i,e),isNaN(a[3][0])||isNaN(a[3][1])||(d=F$(a[3],t,!1),v=d.distance),!isNaN(v)&&v>i&&rV(a[3],t))m=!0,l[3]=v,c[3]=pT(a[3],o);else if(v>y&&(y=v,f[0]=a[3][0],f[1]=a[3][1]),g+=.01,g>.9){if(!(y>=0))break;m=!0,l[3]=y,a[3][0]=f[0],a[3][1]=f[1],c[3]=pT(a[3],o)}while(!m);const x=[0,1,2,3],T=u?0:1;let E;for(let U=T;U<4;U++)for(let k=T;k<3;k++){const H=c[k],V=c[k+1];w2t(H,V)>0&&(E=x[k],x[k]=x[k+1],x[k+1]=E,c[k]=V,c[k+1]=H)}let M=T,O=0,D=0;for(let U=T;U<4;U++){switch(U){case 0:D=2*l[x[U]];break;case 1:D=1.66666666*l[x[U]];break;case 2:D=1.33333333*l[x[U]];break;case 3:D=l[x[U]]}D>O&&(O=D,M=x[U])}return a[M]}function rV(t,e){let i,r,s,n,o=0;for(e.reset();e.nextPath()&&e.nextPoint();)for(i=e.x,r=e.y;e.nextPoint();i=s,r=n)s=e.x,n=e.y,r>t[1]!=n>t[1]&&((s-i)*(t[1]-r)-(n-r)*(t[0]-i)>0?o++:o--);return o!==0}function F$(t,e,i){if(i&&rV(t,e))return{coord:t,distance:0};let r=1/0,s=0,n=0,o=[0,0],a=[0,0];const l=[0,0];for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(o[0]=e.x,o[1]=e.y;e.nextPoint();o=a){a=[e.x,e.y],JJe(l,t,o,a);const c=pT(t,l);c<r&&(r=c,s=l[0],n=l[1])}return{coord:[s,n],distance:Math.sqrt(r)}}function q9(t,e,i,r){const s=[e,0];let n=1/0,o=1/0,a=!1,l=!1;const c=[[e,r[1]-1],[e,r[3]+1]],u=[0,0],d=[0,0],f=[0,0],m=[[0,0],[0,0]],g=oi();for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(m[0][0]=t.x,m[0][1]=t.y;t.nextPoint();m[0][0]=m[1][0],m[0][1]=m[1][1]){if(m[1][0]=t.x,m[1][1]=t.y,v2t(g,m)===null||(d[0]=c[0][0],d[1]=c[0][1],f[0]=c[1][0],f[1]=c[1][1],b2t(g,d,f)===0)||!zz(c[0],c[1],m[0],m[1],u))continue;const y=u[1];n>o?y<n&&(n=y,a=!0):y<o&&(o=y,l=!0)}return a&&l?s[1]=(n+o)/2:s[0]=s[1]=NaN,s}function v2t(t,e){if(e.length<2)return null;t||(t=oi());const[i,r]=e[0],[s,n]=e[1];return t[0]=Math.min(i,s),t[1]=Math.min(r,n),t[2]=Math.max(i,s),t[3]=Math.max(r,n),t}const n5=1,o5=4,q0e=3,W0e=12;function b2t(t,e,i){let r=Rm(e,t),s=Rm(i,t);const n=t[0],o=t[1],a=t[2],l=t[3];if(r&s)return 0;if(!(r|s))return 4;const c=(r?1:0)|(s?2:0);do{const u=i[0]-e[0],d=i[1]-e[1];if(u>d)r&q0e?(r&n5?(e[1]+=d*(n-e[0])/u,e[0]=n):(e[1]+=d*(a-e[0])/u,e[0]=a),r=Rm(e,t)):s&q0e?(s&n5?(i[1]+=d*(n-i[0])/u,i[0]=n):(i[1]+=d*(a-i[0])/u,i[0]=a),s=Rm(i,t)):r?(r&o5?(e[0]+=u*(o-e[1])/d,e[1]=o):(e[0]+=u*(l-e[1])/d,e[1]=l),r=Rm(e,t)):(s&o5?(i[0]+=u*(o-i[1])/d,i[1]=o):(i[0]+=u*(l-i[1])/d,i[1]=l),s=Rm(i,t));else if(r&W0e?(r&o5?(e[0]+=u*(o-e[1])/d,e[1]=o):(e[0]+=u*(l-e[1])/d,e[1]=l),r=Rm(e,t)):s&W0e?(s&o5?(i[0]+=u*(o-i[1])/d,i[1]=o):(i[0]+=u*(l-i[1])/d,i[1]=l),s=Rm(i,t)):r?(r&n5?(e[1]+=d*(n-e[0])/u,e[0]=n):(e[1]+=d*(a-e[0])/u,e[0]=a),r=Rm(e,t)):(s&n5?(i[1]+=d*(n-i[0])/u,i[0]=n):(i[1]+=d*(a-i[0])/u,i[0]=a),s=Rm(i,t)),r&s)return 0}while(r|s);return c}function Rm(t,e){return(t[0]<e[0]?1:0)|(t[0]>e[2]?1:0)<<1|(t[1]<e[1]?1:0)<<2|(t[1]>e[3]?1:0)<<3}function W9(t,e,i){return t+(e-t)*i}function pT(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])}function w2t(t,e){if(t<e)return-1;if(t>e)return 1;if(t===e)return 0;const i=isNaN(t),r=isNaN(e);return i<r?-1:i>r?1:0}let Y4e=class FI{static local(){return FI.instance===null&&(FI.instance=new FI),FI.instance}execute(e,i,r,s,n){return new x2t(e,i,r)}};Y4e.instance=null;let x2t=class{constructor(e,i,r){this._geometryCursor=e,this._offsetX=i.offsetX!==void 0?i.offsetX*r:0,this._offsetY=i.offsetY!==void 0?i.offsetY*r:0,this._method=i.method!==void 0?i.method:JM.OnPolygon,this._internalPlacement=new zO}next(){const e=this._geometryCursor;return this._geometryCursor=null,e?this._polygonCenter(e):null}_polygonCenter(e){let i=!1;switch(this._method){case JM.CenterOfMass:{const r=aQe(e);r&&(this._internalPlacement.setTranslate(r[0]+this._offsetX,r[1]+this._offsetY),i=!0)}break;case JM.BoundingBoxCenter:{const r=zG(e);r&&(this._internalPlacement.setTranslate((r[2]+r[0])/2+this._offsetX,(r[3]+r[1])/2+this._offsetY),i=!0)}break;case JM.OnPolygon:default:{const r=_2t(e);r!==null&&(this._internalPlacement.setTranslate(r[0]+this._offsetX,r[1]+this._offsetY),i=!0)}}return i?this._internalPlacement:null}};function T2t(t){if(!t)return null;switch(t.type){case"CIMGeometricEffectAddControlPoints":return x4e.local();case"CIMGeometricEffectArrow":return T4e.local();case"CIMGeometricEffectBuffer":return S4e.local();case"CIMGeometricEffectControlMeasureLine":return E4e.local();case"CIMGeometricEffectCut":return C4e.local();case"CIMGeometricEffectDashes":return L4e.local();case"CIMGeometricEffectDonut":return D4e.local();case"CIMGeometricEffectJog":return N4e.local();case"CIMGeometricEffectMove":return F4e.local();case"CIMGeometricEffectOffset":return k4e.local();case"CIMGeometricEffectReverse":return U4e.local();case"CIMGeometricEffectRotate":return V4e.local();case"CIMGeometricEffectScale":return z4e.local();case"CIMGeometricEffectWave":return B4e.local()}return null}function S2t(t){if(!t)return null;switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":return j4e.local();case"CIMMarkerPlacementAtExtremities":return G4e.local();case"CIMMarkerPlacementAtRatioPositions":return H4e.local();case"CIMMarkerPlacementInsidePolygon":return q4e.local();case"CIMMarkerPlacementOnLine":return W4e.local();case"CIMMarkerPlacementOnVertices":return Z4e.local();case"CIMMarkerPlacementPolygonCenter":return Y4e.local()}return null}function Z9(t){const e=t.getFrame(0);if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement)return e;const i=document.createElement("canvas");i.width=t.width,i.height=t.height;const r=i.getContext("2d");return e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0),i}let E2t=class X4e{constructor(e=0,i=0,r=0,s=0){this.x=e,this.y=i,this.width=r,this.height=s}static fromExtent(e){return new X4e(e.xmin,-e.ymax,e.xmax-e.xmin,e.ymax-e.ymin)}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}};function C2t(t){return`rgb(${t.slice(0,3).toString()})`}function Y9(t){return`rgba(${t.slice(0,3).toString()},${t[3]})`}let J4e=class{constructor(e){e&&(this._textRasterizationCanvas=e)}rasterizeText(e,i){var H,V;this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const r=this._textRasterizationCanvas,s=r.getContext("2d",{willReadFrequently:!0});a5(s,i),this._parameters=i,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const{decoration:n,weight:o}=i.font;this._lineThroughWidthOffset=n&&n==="line-through"?.1*this._lineHeight:0;const a=i.backgroundColor!=null||i.borderLine!=null,l=a?Mlt:0,c=this._computeTextWidth(s,i)+2*l,u=this._lineHeight*this._textLines.length+2*l;if(r.width=c+2*this._lineThroughWidthOffset,r.height=u,r.width===0||r.height===0)return r.width=r.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:r};this._renderedLineHeight=Math.round(this._lineHeight*i.pixelRatio),this._renderedHaloSize=mr(i.halo.size)*i.pixelRatio,this._renderedWidth=c*i.pixelRatio,this._renderedHeight=u*i.pixelRatio,this._lineThroughWidthOffset*=i.pixelRatio;const d=i.color??[0,0,0,0],f=i.halo&&i.halo.color?i.halo.color:[0,0,0,0];this._fillStyle=Y9(d),this._haloStyle=C2t(f);const m=this._renderedLineHeight,g=this._renderedHaloSize;s.save(),s.clearRect(0,0,r.width,r.height),a5(s,i);const y=l*i.pixelRatio,v=M2t(s.textAlign,this._renderedWidth-2*y)+g+y,b=g+y,w=g>0;let x=this._lineThroughWidthOffset,T=0;if(a){s.save();const X=i.backgroundColor??[0,0,0,0],q=((H=i.borderLine)==null?void 0:H.color)??[0,0,0,0],Z=2*mr(((V=i.borderLine)==null?void 0:V.size)??0);s.fillStyle=Y9(X),s.strokeStyle=Y9(q),s.lineWidth=Z,s.fillRect(0,0,r.width,r.height),s.strokeRect(0,0,r.width,r.height),s.restore()}w&&this._renderHalo(s,v,b,x,T,i),T+=b,x+=v;for(const X of this._textLines)w?(s.globalCompositeOperation="destination-out",s.fillStyle="rgb(0, 0, 0)",s.fillText(X,x,T),s.globalCompositeOperation="source-over",s.fillStyle=this._fillStyle,s.fillText(X,x,T)):(s.fillStyle=this._fillStyle,s.fillText(X,x,T)),n&&n!=="none"&&this._renderDecoration(s,x,T,n,o),T+=m;s.restore();const E=this._renderedWidth+2*this._lineThroughWidthOffset,M=this._renderedHeight,O=s.getImageData(0,0,E,M),D=new Uint8Array(O.data);if(i.premultiplyColors){let X;for(let q=0;q<D.length;q+=4)X=D[q+3]/255,D[q]=D[q]*X,D[q+1]=D[q+1]*X,D[q+2]=D[q+2]*X}let U,k;switch(i.horizontalAlignment){case"left":U=-.5;break;case"right":U=.5;break;default:U=0}switch(i.verticalAlignment){case"bottom":k=-.5;break;case"top":k=.5;break;case"baseline":k=-1/6;break;default:k=0}return{size:[E,M],image:new Uint32Array(D.buffer),sdf:!1,simplePattern:!1,anchorX:U,anchorY:k,canvas:r}}_renderHalo(e,i,r,s,n,o){const a=this._renderedWidth,l=this._renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas")),this._haloRasterizationCanvas.width=a,this._haloRasterizationCanvas.height=l;const c=this._haloRasterizationCanvas,u=c.getContext("2d");u.clearRect(0,0,a,l),a5(u,o);const{decoration:d,weight:f}=o.font;u.fillStyle=this._haloStyle,u.strokeStyle=this._haloStyle,u.lineJoin="round",this._renderHaloNative(u,i,r,d,f),e.globalAlpha=this._parameters.halo.color[3],e.drawImage(c,0,0,a,l,s,n,a,l),e.globalAlpha=1}_renderHaloNative(e,i,r,s,n){const o=this._renderedLineHeight,a=this._renderedHaloSize;for(const l of this._textLines){const c=2*a,u=5,d=.1;for(let f=0;f<u;f++){const m=(1-(u-1)*d+f*d)*c;e.lineWidth=m,e.strokeText(l,i,r),s&&s!=="none"&&this._renderDecoration(e,i,r,s,n,m)}r+=o}}computeTextSize(e,i){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const r=this._textRasterizationCanvas,s=r.getContext("2d");a5(s,i),this._parameters=i,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const n=this._computeTextWidth(s,i),o=this._lineHeight*this._textLines.length;return r.width=n,r.height=o,[n*i.pixelRatio,o*i.pixelRatio]}_computeTextWidth(e,i){let r=0;for(const n of this._textLines)r=Math.max(r,e.measureText(n).width);const s=i.font;return(s.style==="italic"||s.style==="oblique"||typeof s.weight=="string"&&(s.weight==="bold"||s.weight==="bolder")||typeof s.weight=="number"&&s.weight>600)&&(r+=.3*e.measureText("w").width),r+=2*mr(this._parameters.halo.size),Math.round(r)}_computeLineHeight(){let e=1.275*this._parameters.size;const i=this._parameters.font.decoration;return i&&i==="underline"&&(e*=1.3),Math.round(e+2*mr(this._parameters.halo.size))}_renderDecoration(e,i,r,s,n,o){const a=.9*this._lineHeight,l=n==="bold"?.06:n==="bolder"?.09:.04;switch(e.textAlign){case"center":i-=this._renderedWidth/2;break;case"right":i-=this._renderedWidth}const c=e.textBaseline;if(s==="underline")switch(c){case"top":r+=a;break;case"middle":r+=a/2}else if(s==="line-through")switch(c){case"top":r+=a/1.5;break;case"middle":r+=a/3}const u=o?1.5*o:Math.ceil(a*l);e.save(),e.beginPath(),e.strokeStyle=e.fillStyle,e.lineWidth=u,e.moveTo(i-this._lineThroughWidthOffset,r),e.lineTo(i+this._renderedWidth+2*this._lineThroughWidthOffset,r),e.stroke(),e.restore()}};function a5(t,e){const i=Math.max(e.size,.5),r=e.font,s=`${r.style} ${r.weight} ${mr(i*e.pixelRatio).toFixed(1)}px ${r.family}, sans-serif`;let n;switch(t.font=s,t.textBaseline="top",e.horizontalAlignment){case"left":default:n="left";break;case"right":n="right";break;case"center":n="center"}t.textAlign=n}function M2t(t,e){return t==="center"?.5*e:t==="right"?e:0}const Eni=512,Cni=29,Mni=24;var Z0e;(function(t){t[t.FilterFlags=0]="FilterFlags",t[t.Animation=1]="Animation",t[t.GPGPU=2]="GPGPU",t[t.VV=3]="VV",t[t.DD0=4]="DD0",t[t.DD1=5]="DD1",t[t.DD2=6]="DD2"})(Z0e||(Z0e={}));const Ani=1.05,Pni=5,Oni=6,$ni=1.15,Rni=2,Ini=10,A2t=1024,Lni=256,Dni=32,Nni=512;function P2t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function S8(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function O2t(t,e,i,r,s,n,o){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=o,t}function $2t(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5];let l=i*n-r*s;return l?(l=1/l,t[0]=n*l,t[1]=-r*l,t[2]=-s*l,t[3]=i*l,t[4]=(s*a-n*o)*l,t[5]=(r*o-i*a)*l,t):null}function R2t(t){return t[0]*t[3]-t[1]*t[2]}function YT(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],u=i[1],d=i[2],f=i[3],m=i[4],g=i[5];return t[0]=r*c+n*u,t[1]=s*c+o*u,t[2]=r*d+n*f,t[3]=s*d+o*f,t[4]=r*m+n*g+a,t[5]=s*m+o*g+l,t}function Q4e(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(i),u=Math.cos(i);return t[0]=r*u+n*c,t[1]=s*u+o*c,t[2]=r*-c+n*u,t[3]=s*-c+o*u,t[4]=a,t[5]=l,t}function K4e(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],u=i[1];return t[0]=r*c,t[1]=s*c,t[2]=n*u,t[3]=o*u,t[4]=a,t[5]=l,t}function e5e(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=i[0],u=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=o,t[4]=r*c+n*u+a,t[5]=s*c+o*u+l,t}function I2t(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t}function L2t(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function D2t(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function N2t(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function F2t(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function k2t(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t}function t5e(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}function U2t(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t}function V2t(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t}function z2t(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function B2t(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=e[0],c=e[1],u=e[2],d=e[3],f=e[4],m=e[5],g=Bo();return Math.abs(i-l)<=g*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=g*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-u)<=g*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(n-d)<=g*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-f)<=g*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=g*Math.max(1,Math.abs(a),Math.abs(m))}const j2t=YT,G2t=t5e;Object.freeze(Object.defineProperty({__proto__:null,add:k2t,copy:P2t,determinant:R2t,equals:B2t,exactEquals:z2t,frob:F2t,fromRotation:I2t,fromScaling:L2t,fromTranslation:D2t,identity:S8,invert:$2t,mul:j2t,multiply:YT,multiplyScalar:U2t,multiplyScalarAndAdd:V2t,rotate:Q4e,scale:K4e,set:O2t,str:N2t,sub:G2t,subtract:t5e,translate:e5e},Symbol.toStringTag,{value:"Module"}));function see(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function H2t(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function q2t(t,e,i,r,s,n){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function W2t(t,e){return new Float32Array(t,e,6)}function i5e(t,e,i,r){const s=e[r],n=e[r+1];t[r]=i[0]*s+i[2]*n+i[4],t[r+1]=i[1]*s+i[3]*n+i[5]}function Z2t(t,e,i,r=0,s=0,n=2){const o=s||e.length/n;for(let a=r;a<o;a++)i5e(t,e,i,a*n)}Object.freeze(Object.defineProperty({__proto__:null,clone:H2t,create:see,createView:W2t,fromValues:q2t,transform:i5e,transformMany:Z2t},Symbol.toStringTag,{value:"Module"}));const Y2t=()=>ne.getLogger("esri.views.2d.engine.webgl.alignmentUtils");var Ug,Uf;function Fni(t){if(!t)return Ug.Center;switch(t){case"Left":case"left":return Ug.Left;case"Right":case"right":return Ug.Right;case"Justify":return Y2t().warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),Ug.Center;case"Center":case"center":return Ug.Center}}function kni(t){if(!t)return Uf.Center;switch(t){case"Top":case"top":return Uf.Top;case"Center":case"middle":return Uf.Center;case"Baseline":case"baseline":return Uf.Baseline;case"Bottom":case"bottom":return Uf.Bottom}}function Uni(t){switch(t){case Ug.Right:case"right":return-1;case Ug.Center:case"center":return 0;case Ug.Left:case"left":return 1;default:return console.debug(`Found invalid horizontal alignment ${t}`),0}}function Vni(t){switch(t){case Uf.Top:case"top":return 1;case Uf.Center:case"middle":return 0;case Uf.Bottom:case Uf.Baseline:case"baseline":case"bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${t}`),0}}(function(t){t[t.Left=-1]="Left",t[t.Center=0]="Center",t[t.Right=1]="Right"})(Ug||(Ug={})),function(t){t[t.Top=1]="Top",t[t.Center=0]="Center",t[t.Bottom=-1]="Bottom",t[t.Baseline=2]="Baseline"}(Uf||(Uf={}));const XT=Math.PI/180,r5e=.5,X2t=()=>ne.getLogger("esri.symbols.cim.CIMSymbolDrawHelper");let fT=class lg{constructor(e){this._t=e}static createIdentity(){return new lg([1,0,0,0,1,0])}clone(){const e=this._t;return new lg(e.slice())}transform(e){const i=this._t;return[i[0]*e[0]+i[1]*e[1]+i[2],i[3]*e[0]+i[4]*e[1]+i[5]]}static createScale(e,i){return new lg([e,0,0,0,i,0])}scale(e,i){const r=this._t;return r[0]*=e,r[1]*=e,r[2]*=e,r[3]*=i,r[4]*=i,r[5]*=i,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(e,i){return new lg([0,0,e,0,0,i])}translate(e,i){const r=this._t;return r[2]+=e,r[5]+=i,this}static createRotate(e){const i=Math.cos(e),r=Math.sin(e);return new lg([i,-r,0,r,i,0])}rotate(e){return lg.multiply(this,lg.createRotate(e),this)}angle(){const e=this._t[0],i=this._t[3],r=Math.sqrt(e*e+i*i);return[e/r,i/r]}static multiply(e,i,r){const s=e._t,n=i._t,o=s[0]*n[0]+s[3]*n[1],a=s[1]*n[0]+s[4]*n[1],l=s[2]*n[0]+s[5]*n[1]+n[2],c=s[0]*n[3]+s[3]*n[4],u=s[1]*n[3]+s[4]*n[4],d=s[2]*n[3]+s[5]*n[4]+n[5],f=r._t;return f[0]=o,f[1]=a,f[2]=l,f[3]=c,f[4]=u,f[5]=d,r}invert(){const e=this._t;let i=e[0]*e[4]-e[1]*e[3];if(i===0)return new lg([0,0,0,0,0,0]);i=1/i;const r=(e[1]*e[5]-e[2]*e[4])*i,s=(e[2]*e[3]-e[0]*e[5])*i,n=e[4]*i,o=-e[1]*i,a=-e[3]*i,l=e[0]*i;return new lg([n,o,r,a,l,s])}},s5e=class{constructor(e,i){this._resourceManager=e,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new ga(zO,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(i||fT.createIdentity()),this._sizeTransfos.push(i?i.scaleRatio():1)}setTransform(e,i){this._transfos=[e||fT.createIdentity()],this._sizeTransfos=[i||(e?e.scaleRatio():1)]}setGeomUnitsPerPoint(e){this._geomUnitsPerPoint=e}transformPt(e){return this._transfos[this._transfos.length-1].transform(e)}transformSize(e){return e*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(e){return this._transfos[this._transfos.length-1].invert().transform(e)}reverseTransformSize(e){return e/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(e){return e/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return this._transfos.length>2?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(e,i){const r=i?e.scaleRatio():1;fT.multiply(e,this.back(),e),this._transfos.push(e),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*r)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(e,i,r){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(e,i);break;case"CIMTextSymbol":this.drawTextSymbol(e,i,r)}}drawMultiLayerSymbol(e,i){if(!e||!i)return;const r=e.symbolLayers;if(!r)return;const s=e.effects;if(s&&s.length>0){const n=this.executeEffects(s,i);if(n){let o=n.next();for(;o;)this.drawSymbolLayers(r,o.asJSON()),o=n.next()}}else this.drawSymbolLayers(r,i)}executeEffects(e,i){const r=this._resourceManager.geometryEngine;let s=new ESt(to.fromJSONCIM(i));for(const n of e){const o=T2t(n);o&&(s=o.execute(s,n,this.geomUnitsPerPoint(),null,r))}return s}drawSymbolLayers(e,i){let r=e.length;for(;r--;){const s=e[r];if(!s||s.enable===!1)continue;const n=s.effects;if(n&&n.length>0){const o=this.executeEffects(n,i);if(o){let a=null;for(;(a=o.next())&&(this.drawSymbolLayer(s,a.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(s,i);if(this._earlyReturn)return}}drawSymbolLayer(e,i){switch(e.type){case"CIMSolidFill":this.drawSolidFill(i,e.color);break;case"CIMHatchFill":this.drawHatchFill(i,e);break;case"CIMPictureFill":this.drawPictureFill(i,e);break;case"CIMGradientFill":this.drawGradientFill(i,e);break;case"CIMSolidStroke":this.drawSolidStroke(i,e.color,e.width,e.capStyle,e.joinStyle,e.miterLimit);break;case"CIMPictureStroke":this.drawPictureStroke(i,e);break;case"CIMGradientStroke":this.drawGradientStroke(i,e);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(e,i)}}drawHatchFill(e,i){const r=K2t(i,e,this.geomUnitsPerPoint());r&&(this.pushClipPath(e),this.drawMultiLayerSymbol(i.lineSymbol,r),this.popClipPath())}drawPictureFill(e,i){}drawGradientFill(e,i){}drawPictureStroke(e,i){}drawGradientStroke(e,i){}drawMarkerLayer(e,i){const r=e.markerPlacement;if(r){const s=S2t(r);if(s){const n=r.type==="CIMMarkerPlacementInsidePolygon"||r.type==="CIMMarkerPlacementPolygonCenter"&&r.clipAtBoundary;n&&this.pushClipPath(i);const o=s.execute(to.fromJSONCIM(i),r,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine);if(o){let a=null;for(;(a=o.next())&&(this.drawMarker(e,a),!this._earlyReturn););}n&&this.popClipPath()}}else{const s=this._placementPool.acquire();if(_P(i))s.tx=i.x,s.ty=i.y,this.drawMarker(e,s);else if(ml(i)){const n=mMe(i);n&&([s.tx,s.ty]=n,this.drawMarker(e,s))}else for(const n of i.points)if(s.tx=n[0],s.ty=n[1],this.drawMarker(e,s),this._earlyReturn)break;this._placementPool.release(s)}}drawMarker(e,i){switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(e,i);break;case"CIMVectorMarker":this.drawVectorMarker(e,i)}}drawPictureMarker(e,i){if(!e)return;const r=this._resourceManager.getResource(e.url),s=Fi(e.size,GA.CIMPictureMarker.size);if(r==null||s<=0)return;const n=r.width,o=r.height;if(!n||!o)return;const a=n/o,l=Fi(e.scaleX,1),c=fT.createIdentity(),u=e.anchorPoint;if(u){let v=u.x,b=u.y;e.anchorPointUnits!=="Absolute"&&(v*=s*a*l,b*=s),c.translate(-v,-b)}let d=Fi(e.rotation);e.rotateClockwise&&(d=-d),this._mapRotation&&(d+=this._mapRotation),d&&c.rotate(d*XT);let f=Fi(e.offsetX),m=Fi(e.offsetY);if(f||m){if(this._mapRotation){const v=XT*this._mapRotation,b=Math.cos(v),w=Math.sin(v),x=f*w+m*b;f=f*b-m*w,m=x}c.translate(f,m)}const g=this.geomUnitsPerPoint();g!==1&&c.scale(g,g);const y=i.getAngle();y&&c.rotate(y),c.translate(i.tx,i.ty),this.push(c,!1),this.drawImage(e,s),this.pop()}drawVectorMarker(e,i){if(!e)return;const r=e.markerGraphics;if(!r)return;const s=Fi(e.size,GA.CIMVectorMarker.size),n=e.frame,o=n?n.ymax-n.ymin:0,a=s&&o?s/o:1,l=fT.createIdentity();n&&l.translate(.5*-(n.xmax+n.xmin),.5*-(n.ymax+n.ymin));const c=e.anchorPoint;if(c){let y=c.x,v=c.y;e.anchorPointUnits!=="Absolute"?n&&(y*=n.xmax-n.xmin,v*=n.ymax-n.ymin):(y/=a,v/=a),l.translate(-y,-v)}a!==1&&l.scale(a,a);let u=Fi(e.rotation);e.rotateClockwise&&(u=-u),this._mapRotation&&(u+=this._mapRotation),u&&l.rotate(u*XT);let d=Fi(e.offsetX),f=Fi(e.offsetY);if(d||f){if(this._mapRotation){const y=XT*this._mapRotation,v=Math.cos(y),b=Math.sin(y),w=d*b+f*v;d=d*v-f*b,f=w}l.translate(d,f)}const m=this.geomUnitsPerPoint();m!==1&&l.scale(m,m);const g=i.getAngle();g&&l.rotate(g),l.translate(i.tx,i.ty),this.push(l,e.scaleSymbolsProportionally);for(const y of r){y!=null&&y.symbol&&y.geometry||X2t().error("Invalid marker graphic",y);let v=y.textString;if(typeof v=="number"&&(v=v.toString()),this.drawSymbol(y.symbol,y.geometry,v),this._earlyReturn)break}this.pop()}drawTextSymbol(e,i,r){if(!e||!_P(i)||Fi(e.height,GA.CIMTextSymbol.height)<=0)return;const s=fT.createIdentity();let n=Fi(e.angle);n=-n,n&&s.rotate(n*XT);const o=Fi(e.offsetX),a=Fi(e.offsetY);(o||a)&&s.translate(o,a);const l=this.geomUnitsPerPoint();l!==1&&s.scale(l,l),s.translate(i.x,i.y),this.push(s,!1),this.drawText(e,r),this.pop()}},J2t=class extends s5e{constructor(e,i){super(e,i),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new E2t(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return FG(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(e){if(e&&!(this._clipCount>0))if(ml(e))this._processPath(e.rings,0);else if(Nf(e))this._processPath(e.paths,0);else if(Df(e)){const i=JT(e);i&&this._processPath(i.rings,0)}else console.error("drawSolidFill Unexpected geometry type!")}drawSolidStroke(e,i,r){if(!e||this._clipCount>0||r==null||r<=0)return;const s=Math.max(.5*this.transformSize(Fi(r,GA.CIMSolidStroke.width)),.5*r5e);if(ml(e))this._processPath(e.rings,s);else if(Nf(e))this._processPath(e.paths,s);else if(Df(e)){const n=JT(e);n&&this._processPath(n.rings,s)}else console.error("drawSolidStroke unexpected geometry type!")}drawMarkerLayer(e,i){ml(i)&&e.markerPlacement&&(e.markerPlacement.type==="CIMMarkerPlacementInsidePolygon"||e.markerPlacement.type==="CIMMarkerPlacementPolygonCenter"&&e.markerPlacement.clipAtBoundary)?this._processPath(i.rings,0):super.drawMarkerLayer(e,i)}drawHatchFill(e,i){this.drawSolidFill(e)}drawPictureFill(e,i){this.drawSolidFill(e)}drawGradientFill(e,i){this.drawSolidFill(e)}drawPictureStroke(e,i){this.drawSolidStroke(e,null,i.width)}drawGradientStroke(e,i){this.drawSolidStroke(e,null,i.width)}pushClipPath(e){this.drawSolidFill(e),this._clipCount++}popClipPath(){this._clipCount--}drawImage(e,i){const{url:r}=e,s=Fi(e.scaleX,1);let n=s*i,o=i;const a=this._resourceManager.getResource(r);if(a!=null){const l=a.height/a.width;n=s*(i?l>1?i:i/l:a.width),o=i?l>1?i*l:i:a.height}this._merge(this.transformPt([-n/2,-o/2]),0),this._merge(this.transformPt([-n/2,o/2]),0),this._merge(this.transformPt([n/2,-o/2]),0),this._merge(this.transformPt([n/2,o/2]),0)}drawText(e,i){if(!i||i.length===0)return;this._textRasterizer||(this._textRasterizer=new J4e);const r=n5e(e);let[s,n]=this._textRasterizer.computeTextSize(i,r);s=bo(s),n=bo(n);let o=0;switch(e.horizontalAlignment){case"Left":o=s/2;break;case"Right":o=-s/2}let a=0;switch(e.verticalAlignment){case"Bottom":a=n/2;break;case"Top":a=-n/2;break;case"Baseline":a=n/6}this._merge(this.transformPt([-s/2+o,-n/2+a]),0),this._merge(this.transformPt([-s/2+o,n/2+a]),0),this._merge(this.transformPt([s/2+o,-n/2+a]),0),this._merge(this.transformPt([s/2+o,n/2+a]),0)}_processPath(e,i){if(e)for(const r of e){const s=r?r.length:0;if(s>1){this._merge(this.transformPt(r[0]),i);for(let n=1;n<s;n++)this._merge(this.transformPt(r[n]),i)}}}_merge(e,i){e[0]-i<this._xmin&&(this._xmin=e[0]-i),e[0]+i>this._xmax&&(this._xmax=e[0]+i),e[1]-i<this._ymin&&(this._ymin=e[1]-i),e[1]+i>this._ymax&&(this._ymax=e[1]+i)}},Q2t=class extends s5e{constructor(e,i,r,s){super(i,r),this._applyAdditionalRenderProps=s,this._colorSubstitutionHelper=new CSt,this._ctx=e}drawSolidFill(e,i){if(!e)return;if(ml(e))this._buildPath(e.rings,!0);else if(Nf(e))this._buildPath(e.paths,!0);else if(Df(e))this._buildPath(JT(e).rings,!0);else{if(!OS(e))return;console.log("CanvasDrawHelper.drawSolidFill - No implementation!")}const r=this._ctx;r.fillStyle=typeof i=="string"?i:"rgba("+Math.round(i[0])+","+Math.round(i[1])+","+Math.round(i[2])+","+(i[3]??255)/255+")",r.fill("evenodd")}drawSolidStroke(e,i,r,s,n,o){if(!e||!i||r===0)return;if(ml(e))this._buildPath(e.rings,!0);else if(Nf(e))this._buildPath(e.paths,!1);else{if(!Df(e))return void console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");this._buildPath(JT(e).rings,!0)}const a=this._ctx;a.strokeStyle=typeof i=="string"?i:"rgba("+Math.round(i[0])+","+Math.round(i[1])+","+Math.round(i[2])+","+(i[3]??255)/255+")",a.lineWidth=Math.max(this.transformSize(r),r5e),this._setCapStyle(s),this._setJoinStyle(n),a.miterLimit=o,a.stroke()}pushClipPath(e){if(this._ctx.save(),ml(e))this._buildPath(e.rings,!0);else if(Nf(e))this._buildPath(e.paths,!0);else{if(!Df(e))return;this._buildPath(JT(e).rings,!0)}this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(e,i){const{colorSubstitutions:r,url:s,tintColor:n}=e,o=Fi(e.scaleX,1),a=this._resourceManager.getResource(s);if(a==null)return;let l=i*(a.width/a.height),c=i;i||(l=a.width,c=a.height);const u=HE(s)||"src"in a&&HE(a.src);let d="getFrame"in a?Z9(a):a;r&&(d=this._colorSubstitutionHelper.applyColorSubstituition(d,r)),this._applyAdditionalRenderProps&&!u&&n&&(d=this._colorSubstitutionHelper.tintImageData(d,n));const f=this.transformPt([0,0]),[m,g]=this.getTransformAngle(),y=this.transformSize(1),v=this._ctx;v.save(),v.setTransform({m11:o*y*m,m12:o*y*g,m21:-y*g,m22:y*m,m41:f[0],m42:f[1]}),v.drawImage(d,-l/2,-c/2,l,c),v.restore()}drawText(e,i){if(!i||i.length===0)return;this._textRasterizer||(this._textRasterizer=new J4e);const r=n5e(e);r.size*=this.transformSize(bo(1));const s=this._textRasterizer.rasterizeText(i,r);if(!s)return;const{size:n,anchorX:o,anchorY:a,canvas:l}=s,c=n[0]*(o+.5),u=n[1]*(a-.5),d=this._ctx,f=this.transformPt([0,0]),[m,g]=this.getTransformAngle(),y=1;d.save(),d.setTransform({m11:y*m,m12:y*g,m21:-y*g,m22:y*m,m41:f[0]-y*c,m42:f[1]+y*u}),d.drawImage(l,0,0),d.restore()}drawPictureFill(e,i){if(!e)return;let{colorSubstitutions:r,height:s,offsetX:n,offsetY:o,rotation:a,scaleX:l,tintColor:c,url:u}=i;const d=this._resourceManager.getResource(u);if(d==null)return;if(ml(e))this._buildPath(e.rings,!0);else if(Nf(e))this._buildPath(e.paths,!0);else if(Df(e))this._buildPath(JT(e).rings,!0);else{if(!OS(e))return;console.log("CanvasDrawHelper.drawPictureFill - No implementation!")}const f=this._ctx,m=HE(u)||"src"in d&&HE(d.src);let g,y="getFrame"in d?Z9(d):d;if(r&&(y=this._colorSubstitutionHelper.applyColorSubstituition(y,r)),this._applyAdditionalRenderProps){m||c&&(y=this._colorSubstitutionHelper.tintImageData(y,c)),g=f.createPattern(y,"repeat");const v=this.transformSize(1);a||(a=0),n?n*=v:n=0,o?o*=v:o=0,s&&(s*=v);const b=s?s/d.height:1,w=l&&s?l*s/d.width:1;if(a!==0||b!==1||w!==1||n!==0||o!==0){const x=new DOMMatrix;x.rotateSelf(0,0,-a).translateSelf(n,o).scaleSelf(w,b,1),g.setTransform(x)}}else g=f.createPattern(y,"repeat");f.save(),f.fillStyle=g,f.fill("evenodd"),f.restore()}drawPictureStroke(e,i){if(!e)return;let{colorSubstitutions:r,capStyle:s,joinStyle:n,miterLimit:o,tintColor:a,url:l,width:c}=i;const u=this._resourceManager.getResource(l);if(u==null)return;let d;if(ml(e))d=e.rings;else if(Nf(e))d=e.paths;else{if(!Df(e))return OS(e)?void console.log("CanvasDrawHelper.drawPictureStroke - No implementation!"):void 0;d=JT(e).rings}c||(c=u.width);const f=HE(l)||"src"in u&&HE(u.src);let m="getFrame"in u?Z9(u):u;r&&(m=this._colorSubstitutionHelper.applyColorSubstituition(m,r)),this._applyAdditionalRenderProps&&(f||a&&(m=this._colorSubstitutionHelper.tintImageData(m,a)));const g=Math.max(this.transformSize(mr(c)),.5),y=g/m.width,v=this._ctx,b=v.createPattern(m,"repeat-y");let w,x;v.save(),this._setCapStyle(s),this._setJoinStyle(n),o!==void 0&&(v.miterLimit=o),v.lineWidth=g;for(let T of d)if(T=re(T),iEt(T),T&&!(T.length<=1)){w=this.transformPt(T[0]);for(let E=1;E<T.length;E++){x=this.transformPt(T[E]);const M=eEt(w,x),O=new DOMMatrix;O.translateSelf(0,w[1]-g/2).scaleSelf(y,y,1).rotateSelf(0,0,90-M),b.setTransform(O),v.strokeStyle=b,v.beginPath(),v.moveTo(w[0],w[1]),v.lineTo(x[0],x[1]),v.stroke(),w=x}}v.restore()}_buildPath(e,i){const r=this._ctx;if(r.beginPath(),e)for(const s of e){const n=s?s.length:0;if(n>1){let o=this.transformPt(s[0]);r.moveTo(o[0],o[1]);for(let a=1;a<n;a++)o=this.transformPt(s[a]),r.lineTo(o[0],o[1]);i&&r.closePath()}}}_setCapStyle(e){switch(e){case ap.Butt:this._ctx.lineCap="butt";break;case ap.Round:this._ctx.lineCap="round";break;case ap.Square:this._ctx.lineCap="square"}}_setJoinStyle(e){switch(e){case Xg.Bevel:this._ctx.lineJoin="bevel";break;case Xg.Round:this._ctx.lineJoin="round";break;case Xg.Miter:this._ctx.lineJoin="miter"}}};function K2t(t,e,i){let r=Fi(t.separation,GA.CIMHatchFill.separation)*i,s=Fi(t.rotation);if(r===0)return null;r<0&&(r=-r);let n=0;const o=.5*r;for(;n>o;)n-=r;for(;n<-o;)n+=r;const a=oi();fQe(a,e),a[0]-=o,a[1]-=o,a[2]+=o,a[3]+=o;const l=[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]]];for(;s>180;)s-=180;for(;s<0;)s+=180;const c=Math.cos(s*XT),u=Math.sin(s*XT),d=-r*u,f=r*c;let m,g,y,v;n=Fi(t.offsetX)*i*u-Fi(t.offsetY)*i*c,m=y=Number.MAX_VALUE,g=v=-Number.MAX_VALUE;for(const O of l){const D=O[0],U=O[1],k=c*D+u*U,H=-u*D+c*U;m=Math.min(m,k),y=Math.min(y,H),g=Math.max(g,k),v=Math.max(v,H)}y=Math.floor(y/r)*r;let b=c*m-u*y-d*n/r,w=u*m+c*y-f*n/r,x=c*g-u*y-d*n/r,T=u*g+c*y-f*n/r;const E=1+Math.round((v-y)/r),M=[];for(let O=0;O<E;O++)b+=d,w+=f,x+=d,T+=f,M.push([[b,w],[x,T]]);return{paths:M}}function eEt(t,e){const i=e[0]-t[0],r=e[1]-t[1];return 180/Math.PI*Math.atan2(r,i)}const JT=t=>t?{spatialReference:t.spatialReference,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:null;function n5e(t,e=1){var b;const i=$4e(t),r=O4e(t.fontStyleName),s=t.fontFamilyName??Nae,{weight:n,style:o}=r,a=e*(t.height||5),l=HSt(t.horizontalAlignment),c=qSt(t.verticalAlignment),u=K3(t),d=K3(t.haloSymbol),f=d!=null?e*(t.haloSize??0):0,m=((b=t.callout)==null?void 0:b.type)==="CIMBackgroundCallout"?t.callout.backgroundSymbol:null,g=K3(m),y=iee(m),v=tee(m);return{color:u,size:a,horizontalAlignment:l,verticalAlignment:c,font:{family:s,style:jSt(o),weight:GSt(n),decoration:i},halo:{size:f||0,color:d,style:o},backgroundColor:g,borderLine:y!=null&&v!=null?{size:y,color:v}:null,pixelRatio:1,premultiplyColors:!0}}const tEt=1e-4;function iEt(t){let e,i,r,s,n,o=t[0],a=1;for(;a<t.length;)e=t[a][0]-o[0],i=t[a][1]-o[1],s=e!==0?i/e:Math.PI/2,r!==void 0&&s-r<=tEt?(t.splice(a-1,1),o=n):(n=o,o=t[a],a++),r=s}const Uae=[252,146,31,255],rEt=[153,153,153,255],sEt={type:"esriSMS",style:"esriSMSCircle",size:6,color:Uae,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},nEt={type:"esriSLS",style:"esriSLSSolid",width:.75,color:Uae},oEt={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},aEt={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},lEt={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},cEt={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},uEt={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},o5e=Oy.fromJSON(sEt),Vae=Yu.fromJSON(nEt),a5e=H_.fromJSON(oEt),hEt=$O.fromJSON(aEt);function Gni(t){if(t==null)return null;switch(t.type){case"mesh":return null;case"point":case"multipoint":return o5e;case"polyline":return Vae;case"polygon":case"extent":return a5e}return null}Oy.fromJSON(lEt);Yu.fromJSON(cEt);H_.fromJSON(uEt);const Hni=Number.POSITIVE_INFINITY,zae=Math.PI,qni=2*zae,dEt=128/zae,pEt=256/360,Wni=zae/180,fEt=1/Math.LN2;function l5e(t,e){return(t%=e)>=0?t:t+e}function Zni(t){return l5e(t*dEt,256)}function Yni(t){return l5e(t*pEt,256)}function Xni(t){return Math.log(t)*fEt}function Jni(t,e,i){return t*(1-i)+e*i}const mEt=8,gEt=14,yEt=16;function Qni(t){return mEt+Math.max((t-gEt)*yEt,0)}function Kni(t,e,i){let r,s,n,o=0;for(const a of i){r=a.length;for(let l=1;l<r;++l)s=a[l-1],n=a[l],s.y>e!=n.y>e&&((n.x-s.x)*(e-s.y)-(n.y-s.y)*(t-s.x)>0?o++:o--)}return o!==0}function eoi(t,e,i,r){let s,n,o,a;const l=r*r;for(const c of i){const u=c.length;if(!(u<2)){s=c[0].x,n=c[0].y;for(let d=1;d<u;++d){if(o=c[d].x,a=c[d].y,QJe(t,e,s,n,o,a)<l)return!0;s=o,n=a}}}return!1}function _Et(t,e,i,r,s,n,o){const a=Math.max(r,Math.min(e,n))-e,l=Math.max(s,Math.min(i,o))-i;return a*a+l*l<=t*t}function toi(t,e){if(e===0||Number.isNaN(e))return t;const i=[],r=new ll(0,0),s=new ll(0,0),n=new ll(0,0);for(let o=0;o<t.length;o++){const a=t[o],l=[];for(let c=0;c<a.length;c++){const u=a[c-1],d=a[c],f=a[c+1];c===0?r.setCoords(0,0):r.assignSub(d,u).normalize().rightPerpendicular(),c===a.length-1?s.setCoords(0,0):s.assignSub(f,d).normalize().rightPerpendicular(),n.assignAdd(r,s).normalize();const m=n.x*s.x+n.y*s.y;m!==0&&n.scale(1/m),l.push(ll.add(d,n.scale(e)))}i.push(l)}return i}function ioi(t,e,i,r){const s=new ll(t[0],t[1]);if(s.scale(r),e==="viewport"){const n=-i*(Math.PI/180),o=Math.cos(n),a=Math.sin(n);s.rotate(o,a)}return s}const c5e=Math.PI,vEt=c5e/2,Im=96/72,Y0e=4,_j=()=>ne.getLogger("esri.symbols.cim.CIMSymbolHelper");function sV(t,e,i){switch(e.type){case"CIMSymbolReference":return sV(t,e.symbol,i);case"CIMPointSymbol":i==null&&(i={x:0,y:0}),t.drawSymbol(e,i);break;case"CIMLineSymbol":i==null&&(i={paths:[[[0,0],[10,0]]]}),t.drawSymbol(e,i);break;case"CIMPolygonSymbol":i==null&&(i={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]}),t.drawSymbol(e,i);break;case"CIMTextSymbol":{const r={x:0,y:0};t.drawSymbol(e,r);break}case"CIMVectorMarker":{const r=new zO;t.drawMarker(e,r);break}}return t.envelope()}function bEt(t){if(!t)return 0;switch(t.type){case"CIMGeometricEffectArrow":return Math.abs(.5*t.width);case"CIMGeometricEffectBuffer":return Math.abs(t.size);case"CIMGeometricEffectControlMeasureLine":return 500;case"CIMGeometricEffectExtension":case"CIMGeometricEffectRadial":return Math.abs(t.length);case"CIMGeometricEffectJog":return Math.abs(.5*t.length);case"CIMGeometricEffectMove":return Math.max(Math.abs(Fi(t.offsetX)),Math.abs(Fi(t.offsetY)));case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":return Math.abs(t.offset);case"CIMGeometricEffectRegularPolygon":return Math.abs(t.radius);case"CIMGeometricEffectRotate":case"CIMGeometricEffectScale":default:return 0;case"CIMGeometricEffectTaperedPolygon":return .5*Math.max(Math.abs(t.fromWidth),Math.abs(t.toWidth));case"CIMGeometricEffectWave":return Math.abs(t.amplitude);case"CIMGeometricEffectDonut":return Math.abs(t.width)}}function roi(t){if(!t)return 0;let e=0;for(const i of t)e+=bEt(i);return e}let X9=class nV{static getEnvelope(e,i,r){if(!e)return null;const s=new J2t(r);if(Array.isArray(e)){let n;for(const o of e)n?n.union(sV(s,o,i)):n=sV(s,o,i);return n}return sV(s,e,i)}static getTextureAnchor(e,i){const r=this.getEnvelope(e,null,i);if(!r)return[0,0,0];const s=(r.x+.5*r.width)*Im,n=(r.y+.5*r.height)*Im,o=r.width*Im+2,a=r.height*Im+2;return[-s/o,-n/a,a]}static rasterize(e,i,r,s,n=!0){const o=r||this.getEnvelope(i,null,s);if(!o)return[null,0,0,0,0];const a=(o.x+.5*o.width)*Im,l=(o.y+.5*o.height)*Im;e.width=o.width*Im,e.height=o.height*Im,r||(e.width+=2,e.height+=2);const c=e.getContext("2d",{willReadFrequently:!0}),u=fT.createScale(Im,-Im);u.translate(.5*e.width-a,.5*e.height+l);const d=new Q2t(c,s,u);switch(i.type){case"CIMPointSymbol":{const g={type:"point",x:0,y:0};d.drawSymbol(i,g);break}case"CIMVectorMarker":{const g=new zO;d.drawMarker(i,g);break}}const f=c.getImageData(0,0,e.width,e.height),m=new Uint8Array(f.data);if(n){let g;for(let y=0;y<m.length;y+=4)g=m[y+3]/255,m[y]=m[y]*g,m[y+1]=m[y+1]*g,m[y+2]=m[y+2]*g}return[m,e.width,e.height,-a/e.width,-l/e.height]}static fromTextSymbol(e){const{text:i}=e;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:nV.createCIMTextSymbolfromTextSymbol(e),textString:i}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(e){const{height:i,outline:r,width:s,xoffset:n,xscale:o,yoffset:a,yscale:l}=e,c=[],u={type:"CIMPolygonSymbol",symbolLayers:c};if(r){const y=X0e(r);y&&c.push(y)}let d=e.url;e.type==="esriPFS"&&e.imageData&&(d=e.imageData);const f="angle"in e?e.angle??0:0,m=(s??0)*(o||1),g=(i??0)*(l||1);return c.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:QM.Picture,tintColor:null,url:d,height:g,width:m,offsetX:Fi(n),offsetY:Fi(a),rotation:Fi(-f),colorSubstitutions:null}),u}static fromSimpleFillSymbol(e){const{color:i,style:r,outline:s}=e,n=[],o={type:"CIMPolygonSymbol",symbolLayers:n};if(s){const a=X0e(s);a&&n.push(a)}if(r&&r!=="solid"&&r!=="none"&&r!=="esriSFSSolid"&&r!=="esriSFSNull"){const a={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:ph(i),capStyle:ap.Butt,joinStyle:Xg.Miter,width:.75}]};let l=0;const c=bo(CEt(r)?8:10);switch(r){case"vertical":case"esriSFSVertical":l=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":l=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":l=45;break;case"cross":case"esriSFSCross":l=0}n.push({type:"CIMHatchFill",lineSymbol:a,offsetX:0,offsetY:0,rotation:l,separation:c}),r==="cross"||r==="esriSFSCross"?n.push({type:"CIMHatchFill",lineSymbol:re(a),offsetX:0,offsetY:0,rotation:90,separation:c}):r!=="diagonal-cross"&&r!=="esriSFSDiagonalCross"||n.push({type:"CIMHatchFill",lineSymbol:re(a),offsetX:0,offsetY:0,rotation:45,separation:c})}else!r||r!=="solid"&&r!=="esriSFSSolid"||n.push({type:"CIMSolidFill",enable:!0,color:ph(i)});return o}static fromSimpleLineSymbol(e){const{cap:i,color:r,join:s,marker:n,miterLimit:o,style:a,width:l}=e;let c=null;a!=="solid"&&a!=="none"&&a!=="esriSLSSolid"&&a!=="esriSLSNull"&&(c=[{type:"CIMGeometricEffectDashes",dashTemplate:nee(a,i),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const u=[];if(n){let d;switch(n.placement){case"begin-end":d=Yg.Both;break;case"begin":d=Yg.JustBegin;break;case"end":d=Yg.JustEnd;break;default:d=Yg.None}const f=nV.fromSimpleMarker(n,l,r).symbolLayers[0];f.markerPlacement={type:"CIMMarkerPlacementAtExtremities",placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:d,offsetAlongLine:0},u.push(f)}return u.push({type:"CIMSolidStroke",color:a!=="none"&&a!=="esriSLSNull"?ph(r):[0,0,0,0],capStyle:h5e(i),joinStyle:d5e(s),miterLimit:o,width:l,effects:c}),{type:"CIMLineSymbol",symbolLayers:u}}static fromPictureMarker(e){const{angle:i,height:r,width:s,xoffset:n,yoffset:o}=e;let a=e.url;return e.type==="esriPMS"&&e.imageData&&(a=e.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:QM.Picture,tintColor:null,url:a,size:r,width:s,offsetX:Fi(n),offsetY:Fi(o),rotation:Fi(-i)}]}}static createCIMTextSymbolfromTextSymbol(e){const{angle:i,color:r,font:s,haloColor:n,haloSize:o,horizontalAlignment:a,kerning:l,lineWidth:c,text:u,verticalAlignment:d,xoffset:f,yoffset:m,backgroundColor:g,borderLineColor:y,borderLineSize:v}=e;let b,w,x,T,E,M;s&&(b=s.family,w=s.style,x=s.weight,T=s.size,E=s.decoration);let O=!1;return u&&(O=pSt(u)[1]),(g||v)&&(M={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:ph(g)},{type:"CIMSolidStroke",color:ph(y),width:v}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:"CIMTextSymbol",angle:i,blockProgression:JK.BTT,depth3D:1,extrapolateBaselines:!0,fontEffects:ZK.Normal,fontEncoding:YK.Unicode,fontFamilyName:b||"Arial",fontStyleName:TEt(w,x),fontType:XK.Unspecified,haloSize:o,height:T,hinting:KK.Default,horizontalAlignment:wEt(a??"center"),kerning:l,letterWidth:100,ligatures:!0,lineGapType:"Multiple",lineWidth:c,offsetX:Fi(f),offsetY:Fi(m),strikethrough:E==="line-through",underline:E==="underline",symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:ph(r)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:ph(n)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:O?gj.RTL:gj.LTR,verticalAlignment:xEt(d??"baseline"),verticalGlyphOrientation:eee.Right,wordSpacing:100,billboardMode3D:QK.FaceNearPlane,callout:M}}static createPictureMarkerRasterizationParam(e){var l,c;const{angle:i,height:r,width:s,xoffset:n,yoffset:o}=e,a=e.url??((l=e.source)==null?void 0:l.url)??((c=e.source)==null?void 0:c.imageData);return a?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:QM.Picture,tintColor:null,url:a,size:r,width:s,offsetX:Fi(n),offsetY:Fi(o),rotation:Fi(-i)}}:null}static createPictureFillRasterizationParam(e){const{width:i,height:r,xoffset:s,yoffset:n,url:o}=e;return o?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:QM.Picture,tintColor:null,url:o,width:i,height:r,offsetX:Fi(s),offsetY:Fi(n),rotation:0}}:null}static fromSimpleMarker(e,i,r){const{style:s}=e,n=e.color??r;if(s==="path"||s==="esriSMSPath"){const d=[];if("outline"in e&&e.outline){const g=e.outline;d.push({type:"CIMSolidStroke",enable:!0,width:g.width,color:ph(g.color),path:e.path})}d.push({type:"CIMSolidFill",enable:!0,color:ph(n),path:e.path});const[f,m]=k$("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-Fi(e.angle),size:Fi(e.size||6),offsetX:Fi(e.xoffset),offsetY:Fi(e.yoffset),scaleSymbolsProportionally:!1,frame:f,markerGraphics:[{type:"CIMMarkerGraphic",geometry:m,symbol:{type:"CIMPolygonSymbol",symbolLayers:d}}]}]}}const o=[];let a,l,c=e.size;if("outline"in e&&e.outline&&e.outline.style!=="none"&&e.outline.style!=="esriSLSNull"){const d=e.outline,f=d.style!=="solid"&&d.style!=="esriSLSSolid";[a,l]=f?k$(s,e.size):k$(s);const m=d.width??Vae.width;if(f){const v=m/e.size,b=(a.xmax-a.xmin)*v/2,w=(a.ymax-a.ymin)*v/2;a.xmin-=b,a.xmax+=b,a.ymin-=w,a.ymax+=w,c&&(c+=m)}const g=e.style!=="cross"&&e.style!=="x"||(e==null?void 0:e.outline.style)==="dot"||(e==null?void 0:e.outline.style)==="short-dot"?sl.HalfGap:sl.FullPattern,y=f?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:nee(d.style,null).map(v=>d.width&&d.width>0?v*d.width:v),lineDashEnding:g,controlPointEnding:sl.FullPattern}]:void 0;o.push({type:"CIMSolidStroke",capStyle:f?ap.Round:ap.Butt,enable:!0,width:m,color:ph(d.color),effects:y})}else!i||e.type!=="line-marker"||e.style!=="cross"&&e.style!=="x"?[a,l]=k$(s):([a,l]=k$(s),o.push({type:"CIMSolidStroke",enable:!0,width:i,color:ph(n)}));o.push({type:"CIMSolidFill",enable:!0,color:ph(n)});const u={type:"CIMPolygonSymbol",symbolLayers:o};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:Fi(-e.angle),size:Fi(c||6*i),offsetX:Fi(e.xoffset),offsetY:Fi(e.yoffset),scaleSymbolsProportionally:!1,frame:a,markerGraphics:[{type:"CIMMarkerGraphic",geometry:l,symbol:u}]}]}}static fromCIMHatchFill(e,i){var l;const r=i*(e.separation??GA.CIMHatchFill.separation),s=r/2,n=re(e.lineSymbol);(l=n.symbolLayers)==null||l.forEach(c=>{var u;switch(c.type){case"CIMSolidStroke":c.width!=null&&(c.width*=i),(u=c.effects)==null||u.forEach(d=>{if(d.type==="CIMGeometricEffectDashes"){const f=d.dashTemplate;d.dashTemplate=f==null?void 0:f.map(m=>m*i)}});break;case"CIMVectorMarker":{c.size!=null&&(c.size*=i);const d=c.markerPlacement;d!=null&&"placementTemplate"in d&&(d.placementTemplate=d.placementTemplate.map(f=>f*i));break}}});let o=this._getLineSymbolPeriod(n)||Y0e;for(;o<Y0e;)o*=2;const a=o/2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-s,ymax:s},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:n}],size:r}}static fetchResources(e,i,r,s=null){return e&&i&&u5e(e,n=>{MEt(n,i,r),"url"in n&&n.url&&r.push(i.fetchResource(n.url,{signal:s}))}),r}static fetchFonts(e,i,r){if(e&&i){if("symbolLayers"in e&&e.symbolLayers){for(const s of e.symbolLayers)if(s.type==="CIMVectorMarker"&&s.markerGraphics)for(const n of s.markerGraphics)n!=null&&n.symbol&&nV.fetchFonts(n.symbol,i,r)}else if(e.type==="CIMTextSymbol"){const{fontFamilyName:s,fontStyleName:n}=e;if(!s||s.toLowerCase()==="calcitewebcoreicons")return;const{style:o,weight:a}=O4e(n),l=$4e(e),c=new oN({family:s,style:o,weight:a,decoration:l});r.push(i.loadFont(c).catch(()=>{_j().error(`Unsupported font ${s} in CIM symbol`)}))}}}static _getLineSymbolPeriod(e){if(e){const i=this._getEffectsRepeat(e.effects);if(i)return i;if(e.symbolLayers){for(const r of e.symbolLayers)if(r){const s=this._getEffectsRepeat(r.effects);if(s)return s;switch(r.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const n=this._getPlacementRepeat(r.markerPlacement);if(n)return n}}}}}return 0}static _getEffectsRepeat(e){if(e){for(const i of e)if(i)switch(i.type){case"CIMGeometricEffectDashes":{const r=i.dashTemplate;if(r&&r.length){let s=0;for(const n of r)s+=n;return 1&r.length&&(s*=2),s}break}case"CIMGeometricEffectWave":return i.period;default:_j().error(`unsupported geometric effect type ${i.type}`)}}return 0}static _getPlacementRepeat(e){if(e)switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const i=e.placementTemplate;if(i&&i.length){let r=0;for(const s of i)r+=+s;return 1&i.length&&(r*=2),r}break}}return 0}static fromCIMInsidePolygon(e){const i=e.markerPlacement,r={...e};r.markerPlacement=null,r.anchorPoint=null;const s=Math.abs(i.stepX),n=Math.abs(i.stepY),o=(i.randomness??100)/100;let a,l,c,u;if(i.gridType==="Random"){const d=bo(A2t),f=Math.max(Math.floor(d/s),1),m=Math.max(Math.floor(d/n),1);a=f*s/2,l=m*n/2,c=2*l;const g=new TS(i.seed),y=o*s/1.5,v=o*n/1.5;u=[];for(let b=0;b<f;b++)for(let w=0;w<m;w++){const x=b*s-a+y*(.5-g.getFloat()),T=w*n-l+v*(.5-g.getFloat());u.push({x,y:T}),b===0&&u.push({x:x+2*a,y:T}),w===0&&u.push({x,y:T+2*l})}}else i.shiftOddRows===!0?(a=s/2,l=n,c=2*n,u=[{x:-a,y:0},{x:a,y:0},{x:0,y:l},{x:0,y:-l}]):(a=s/2,l=n/2,c=n,u=[{x:-s,y:0},{x:0,y:-n},{x:-s,y:-n},{x:0,y:0},{x:s,y:0},{x:0,y:n},{x:s,y:n},{x:-s,y:n},{x:s,y:-n}]);return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-l,ymax:l},markerGraphics:u.map(d=>({type:"CIMMarkerGraphic",geometry:d,symbol:{type:"CIMPointSymbol",symbolLayers:[r]}})),size:c}}};function u5e(t,e){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const i=t.symbolLayers;if(!i)return;for(const r of i)if(e(r),r.type==="CIMVectorMarker"){const s=r.markerGraphics;if(!s)continue;for(const n of s)if(n){const o=n.symbol;o&&u5e(o,e)}}break}}}const h5e=t=>{if(!t)return ap.Butt;switch(t){case"butt":return ap.Butt;case"square":return ap.Square;case"round":return ap.Round}},d5e=t=>{if(!t)return Xg.Miter;switch(t){case"miter":return Xg.Miter;case"round":return Xg.Round;case"bevel":return Xg.Bevel}},wEt=t=>{if(t==null)return"Center";switch(t){case"left":return"Left";case"right":return"Right";case"center":return"Center"}},xEt=t=>{if(t==null)return"Center";switch(t){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},ph=t=>{if(!t)return[0,0,0,0];const{r:e,g:i,b:r,a:s}=t;return[e,i,r,255*s]},TEt=(t,e)=>{const i=SEt(e),r=EEt(t);return i&&r?`${i}-${r}`:`${i}${r}`},SEt=t=>{if(!t)return"";switch(t.toLowerCase()){case"bold":case"bolder":return"bold"}return""},EEt=t=>{if(!t)return"";switch(t.toLowerCase()){case"italic":case"oblique":return"italic"}return""},nee=(t,e)=>{const i=ue("safari")?.001:0,r=e==="butt";switch(t){case"dash":case"esriSLSDash":return r?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return r?[4,3,1,3]:[3,4,i,4];case"dot":case"esriSLSDot":return r?[1,3]:[i,4];case"long-dash":case"esriSLSLongDash":return r?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return r?[8,3,1,3]:[7,4,i,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return r?[8,3,1,3,1,3]:[7,4,i,4,i,4];case"short-dash":case"esriSLSShortDash":return r?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return r?[4,1,1,1]:[3,2,i,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return r?[4,1,1,1,1,1]:[3,2,i,2,i,2];case"short-dot":case"esriSLSShortDot":return r?[1,1]:[i,2];case"solid":case"esriSLSSolid":case"none":return _j().error("Unexpected: style does not require rasterization"),[0,0];default:return _j().error(`Tried to rasterize SLS, but found an unexpected style: ${t}!`),[0,0]}},k$=(t,e=100)=>{const i=e/2;let r,s;const n=t;if(n==="circle"||n==="esriSMSCircle"){let a=Math.acos(1-.25/i),l=Math.ceil(c5e/a/4);l===0&&(l=1),a=vEt/l,l*=4;const c=[];c.push([i,0]);for(let u=1;u<l;u++)c.push([i*Math.cos(u*a),-i*Math.sin(u*a)]);c.push([i,0]),r={rings:[c]},s={xmin:-i,ymin:-i,xmax:i,ymax:i}}else if(n==="cross"||n==="esriSMSCross")r={paths:[[[0,i],[0,-i]],[[i,0],[-i,0]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if(n==="diamond"||n==="esriSMSDiamond")r={rings:[[[-i,0],[0,i],[i,0],[0,-i],[-i,0]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if(n==="square"||n==="esriSMSSquare")r={rings:[[[-i,-i],[-i,i],[i,i],[i,-i],[-i,-i]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if(n==="x"||n==="esriSMSX")r={paths:[[[i,i],[-i,-i]],[[i,-i],[-i,i]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i};else if(n==="triangle"||n==="esriSMSTriangle"){const o=e*.5773502691896257,a=-o,l=2/3*e,c=l-e;r={rings:[[[a,c],[0,l],[o,c],[a,c]]]},s={xmin:a,ymin:c,xmax:o,ymax:l}}else n==="arrow"&&(r={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},s={xmin:-i,ymin:-i,xmax:i,ymax:i});return[s,r]},CEt=t=>t==="vertical"||t==="horizontal"||t==="cross"||t==="esriSFSCross"||t==="esriSFSVertical"||t==="esriSFSHorizontal";function MEt(t,e,i){if(!(!t.effects||e.geometryEngine!=null)){if(e.geometryEnginePromise)return void i.push(e.geometryEnginePromise);zSt(t.effects)&&(e.geometryEnginePromise=BSt(),i.push(e.geometryEnginePromise),e.geometryEnginePromise.then(r=>e.geometryEngine=r))}}function X0e(t){if(!t)return null;let e=null;const{cap:i,color:r,join:s,miterLimit:n,style:o,width:a}=t;return o!=="solid"&&o!=="none"&&o!=="esriSLSSolid"&&o!=="esriSLSNull"&&(e=[{type:"CIMGeometricEffectDashes",dashTemplate:nee(o,i),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),{type:"CIMSolidStroke",color:o!=="esriSLSNull"&&o!=="none"?ph(r):[0,0,0,0],capStyle:h5e(i),joinStyle:d5e(s),miterLimit:n,width:a,effects:e}}function p5e(t,e,i,r,s){if(t==null)return null;const n=t.referencesGeometry()&&s?AEt(e,r,s):e,o=t.repurposeFeature(n);try{return t.evaluate({...i,$feature:o},t.services)}catch(a){return ne.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const J9=new Map;function AEt(t,e,i){const{transform:r,hasZ:s,hasM:n}=i;J9.has(e)||J9.set(e,PEt(e));const o=J9.get(e)(t.geometry,r,s,n);return{...t,geometry:o}}function PEt(t){const e={};switch(t){case"esriGeometryPoint":return(i,r,s,n)=>HNe(r,e,i,s,n);case"esriGeometryPolygon":return(i,r,s,n)=>qNe(r,e,i,s,n);case"esriGeometryPolyline":return(i,r,s,n)=>WNe(r,e,i,s,n);case"esriGeometryMultipoint":return(i,r,s,n)=>GNe(r,e,i,s,n);default:return ne.getLogger("esri.views.2d.support.arcadeOnDemand").error(new B("mapview-arcade",`Unable to handle geometryType: ${t}`)),i=>i}}const OEt=t=>{if(!t)return[0,0,0,0];const{r:e,g:i,b:r,a:s}=t;return[e,i,r,255*s]};let KM=class wn{static findApplicableOverrides(e,i,r){if(e&&i){if(e.primitiveName){let s=!1;for(const n of r)if(n.primitiveName===e.primitiveName){s=!0;break}if(!s)for(const n of i)n.primitiveName===e.primitiveName&&r.push(n)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const s of e.effects)wn.findApplicableOverrides(s,i,r);if(e.symbolLayers)for(const s of e.symbolLayers)wn.findApplicableOverrides(s,i,r);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const s of e.effects)wn.findApplicableOverrides(s,i,r);if(e.markerPlacement&&wn.findApplicableOverrides(e.markerPlacement,i,r),e.type==="CIMVectorMarker"){if(e.markerGraphics)for(const s of e.markerGraphics)wn.findApplicableOverrides(s,i,r),wn.findApplicableOverrides(s.symbol,i,r)}else e.type==="CIMCharacterMarker"?wn.findApplicableOverrides(e.symbol,i,r):e.type==="CIMHatchFill"?wn.findApplicableOverrides(e.lineSymbol,i,r):e.type==="CIMPictureMarker"&&wn.findApplicableOverrides(e.animatedSymbolProperties,i,r)}}}static findEffectOverrides(e,i){if(!e)return null;if(e.type==="CIMGeometricEffectDashes"&&R4e(e),!i||!e.primitiveName)return{type:"cim-effect-param",effect:e,overrides:[]};const r=V0e(e),s=e.primitiveName,n=[];for(const o of i)o.primitiveName===s&&n.push(V0e(o));return{type:"cim-effect-param",effect:r,overrides:ZSt(n)}}static async resolveSymbolOverrides(e,i,r,s,n,o,a){if(!(e!=null&&e.symbol))return null;let{symbol:l,primitiveOverrides:c}=e;const u=!!c;if(!u&&!s)return l;l=re(l),c=re(c);let d=!0;if(i||(i={attributes:{}},d=!1),u){if(d||(c=c.filter(f=>{var m;return!((m=f.valueExpressionInfo)!=null&&m.expression.includes("$feature"))})),a||(c=c.filter(f=>{var m;return!((m=f.valueExpressionInfo)!=null&&m.expression.includes("$view"))})),c.length>0){const f={spatialReference:r,fields:WSt(i.attributes),geometryType:n};await wn.createRenderExpressions(c,f),wn.evaluateOverrides(c,i,n??"esriGeometryPoint",o,a)}wn.applyOverrides(l,c)}return s&&wn.applyDictionaryTextOverrides(l,i,s,null),l}static async createRenderExpressions(e,i){const r=[];for(const s of e){const n=s.valueExpressionInfo;if(!n||wn._expressionToRenderExpression.has(n.expression))continue;const o=p$e(n.expression,i.spatialReference,i.fields);r.push(o),o.then(a=>wn._expressionToRenderExpression.set(n.expression,a))}r.length>0&&await Promise.all(r)}static evaluateOverrides(e,i,r,s,n){const o={$view:{scale:n==null?void 0:n.scale}};for(const a of e){a.value&&typeof a.value=="object"&&$Re(a.value)&&(a.propertyName==="Color"||a.propertyName==="StrokeColor")&&(a.value=OEt(a.value));const l=a.valueExpressionInfo;if(!l)continue;const c=wn._expressionToRenderExpression.get(l.expression);c&&(a.value=p5e(c,i,o,r,s))}}static applyDictionaryTextOverrides(e,i,r,s,n="Normal"){if(e!=null&&e.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const o=e.symbolLayers;if(!o)return;for(const a of o)a&&a.type==="CIMVectorMarker"&&wn.applyDictionaryTextOverrides(a,i,r,s,e.type==="CIMTextSymbol"?e.textCase:n)}break;case"CIMVectorMarker":{const o=e.markerGraphics;if(!o)return;for(const a of o)a&&wn.applyDictionaryTextOverrides(a,i,r,s)}break;case"CIMMarkerGraphic":{const o=e.textString;if(o&&o.includes("[")){const a=FSt(o,r);e.textString=kSt(i,a,s,n)}}}}static applyOverrides(e,i,r,s){if(e.primitiveName){for(const n of i)if(n.primitiveName===e.primitiveName){const o=kae(n.propertyName);if(s&&s.push({cim:e,nocapPropertyName:o,value:e[o]}),r){let a=!1;for(const l of r)l.primitiveName===e.primitiveName&&(a=!0);a||r.push(n)}n.value!=null&&(e[o]=n.value)}}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const n of e.effects)wn.applyOverrides(n,i,r,s);if(e.symbolLayers)for(const n of e.symbolLayers)wn.applyOverrides(n,i,r,s);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const n of e.effects)wn.applyOverrides(n,i,r,s);if(e.type==="CIMVectorMarker"&&e.markerGraphics)for(const n of e.markerGraphics)wn.applyOverrides(n,i,r,s),wn.applyOverrides(n.symbol,i,r,s)}}static restoreOverrides(e){for(const i of e)i.cim[i.nocapPropertyName]=i.value}static buildOverrideKey(e){let i="";for(const r of e)r.value!==void 0&&(i+=`${r.primitiveName}${r.propertyName}${JSON.stringify(r.value)}`);return i}static toValue(e,i){if(e==="DashTemplate")return i.split(" ").map(r=>Number(r));if(e==="Color"){const r=new je(i).toRgba();return r[3]*=255,r}return i}};KM._expressionToRenderExpression=new Map;function Bae(t,e,i,r){if(t)if(t.type!=="CIMTextSymbol"){if(t.effects)for(const s of t.effects)IEt(s,e);if(t.symbolLayers)for(const s of t.symbolLayers)switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":$Et(s,e,r);break;case"CIMPictureStroke":case"CIMSolidStroke":!(r!=null&&r.preserveOutlineWidth)&&s.width&&(s.width*=e);break;case"CIMPictureFill":s.height&&(s.height*=e),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e);break;case"CIMHatchFill":Bae(s.lineSymbol,e,!0,{...r,preserveOutlineWidth:!1}),s.offsetX&&(s.offsetX*=e),s.offsetY&&(s.offsetY*=e),s.separation&&(s.separation*=e)}}else t.height!=null&&(t.height*=e)}function $Et(t,e,i){if(t&&(t.markerPlacement&&REt(t.markerPlacement,e),t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.anchorPoint&&t.anchorPointUnits==="Absolute"&&(t.anchorPoint={x:t.anchorPoint.x*e,y:t.anchorPoint.y*e}),t.size=t.size!=null?t.size*e:0,t.type==="CIMVectorMarker"&&t.markerGraphics))for(const r of t.markerGraphics)t.scaleSymbolsProportionally||Bae(r.symbol,e,!0,i)}function REt(t,e){switch(Fae(t)&&t.offset&&(t.offset*=e),t.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.placementTemplate&&t.placementTemplate.length){const i=t.placementTemplate.map(r=>r*e);t.placementTemplate=i}break;case"CIMMarkerPlacementAlongLineVariableSize":if(t.maxRandomOffset&&(t.maxRandomOffset*=e),t.placementTemplate&&t.placementTemplate.length){const i=t.placementTemplate.map(r=>r*e);t.placementTemplate=i}break;case"CIMMarkerPlacementOnLine":t.startPointOffset&&(t.startPointOffset*=e);break;case"CIMMarkerPlacementAtExtremities":t.offsetAlongLine&&(t.offsetAlongLine*=e);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":t.beginPosition&&(t.beginPosition*=e),t.endPosition&&(t.endPosition*=e);break;case"CIMMarkerPlacementPolygonCenter":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMMarkerPlacementInsidePolygon":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.stepX&&(t.stepX*=e),t.stepY&&(t.stepY*=e)}}function IEt(t,e){switch(t.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":t.width&&(t.width*=e);break;case"CIMGeometricEffectBuffer":t.size&&(t.size*=e);break;case"CIMGeometricEffectCut":t.beginCut&&(t.beginCut*=e),t.endCut&&(t.endCut*=e),t.middleCut&&(t.middleCut*=e);break;case"CIMGeometricEffectDashes":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.dashTemplate&&t.dashTemplate.length){const i=t.dashTemplate.map(r=>r*e);t.dashTemplate=i}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":t.length&&(t.length*=e);break;case"CIMGeometricEffectMove":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":t.offset&&(t.offset*=e);break;case"CIMGeometricEffectRegularPolygon":t.radius&&(t.radius*=e);break;case"CIMGeometricEffectTaperedPolygon":t.fromWidth&&(t.fromWidth*=e),t.length&&(t.length*=e),t.toWidth&&(t.toWidth*=e);break;case"CIMGeometricEffectWave":t.amplitude&&(t.amplitude*=e),t.period&&(t.period*=e)}}function f5e(t){const e=[];return oee(M4e(t),e),e.length?new je(VSt(e[0])):null}function oee(t,e){var s;if(!t)return;let i;i=t.type==="CIMTextSymbol"?t.symbol:t;const r=t.type==="CIMPolygonSymbol";if(i!=null&&i.symbolLayers){for(const n of i.symbolLayers)if(!(n.colorLocked||r&&(P4e(n)||A4e(n)&&n.markerPlacement&&Fae(n.markerPlacement))))switch(n.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":n.tintColor&&J0e(e,n.tintColor);break;case"CIMVectorMarker":(s=n.markerGraphics)==null||s.forEach(o=>{oee(o.symbol,e)});break;case"CIMSolidStroke":case"CIMSolidFill":J0e(e,n.color);break;case"CIMHatchFill":oee(n.lineSymbol,e)}}}function J0e(t,e){for(const i of t)if(i.join(".")===e.join("."))return;t.push(e)}function soi(t,e,i){e instanceof je||(e=new je(e));const r=M4e(t);r&&aee(r,e)}function aee(t,e,i){var n;if(!t)return;let r;r=t.type==="CIMTextSymbol"?t.symbol:t;const s=(r==null?void 0:r.type)==="CIMPolygonSymbol";if(r!=null&&r.symbolLayers)for(const o of r.symbolLayers){if(o.colorLocked||s&&(P4e(o)||A4e(o)&&o.markerPlacement&&Fae(o.markerPlacement)))continue;const a=e.toArray();switch(o.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":o.tintColor=a;break;case"CIMVectorMarker":(n=o.markerGraphics)==null||n.forEach(l=>{aee(l.symbol,e)});break;case"CIMSolidStroke":case"CIMSolidFill":o.color=a;break;case"CIMHatchFill":aee(o.lineSymbol,e)}}}var Q0e,K0e,m5e={exports:{}};K0e=function(){function t(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function e(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function i(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function r(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:jy},u=jy,d="none",f=")",m=",",g="(",y="%",v="px",b="cm",w="mm",x="in",T="pt",E="pc",M="deg",O="rad",D="grad",U="turn",k="#",H=".",V="e",X=/^[ \t\n\r]/,q=/^[a-z\-]/,Z=/^[0-9a-fA-F]/,ye=/^[+\-]/,L=/^[0-9]/,N=hc("none"),z=To("none",!1),W=To(")",!1),J=To(",",!1),ee=hc("whitespace"),ae=Rw([" ","	",`
`,"\r"],!1,!1),we=hc("function"),Ie=To("(",!1),Ge=hc("identifier"),ut=Rw([["a","z"],"-"],!1,!1),ot=hc("percentage"),at=To("%",!1),it=hc("length"),st=To("px",!1),li=To("cm",!1),Y=To("mm",!1),ie=To("in",!1),se=To("pt",!1),Ae=To("pc",!1),ce=hc("angle"),me=To("deg",!1),Me=To("rad",!1),Oe=To("grad",!1),be=To("turn",!1),xe=hc("number"),_e=hc("color"),Le=To("#",!1),Fe=Rw([["0","9"],["a","f"],["A","F"]],!1,!1),lt=Rw(["+","-"],!1,!1),ct=Rw([["0","9"]],!1,!1),Vt=To(".",!1),Mt=To("e",!1),Zt=function(){return[]},Xt=function(K,Re){return{type:"function",name:K,parameters:Re||[]}},vi=function(K,Re){return Re.length>0?ZO(K,Re,3):[K]},xi=function(K){return{type:"quantity",value:K.value,unit:K.unit}},Ni=function(K){return{type:"color",colorType:K.type,value:K.value}},Nt=function(K){return K},jt=function(){return eu()},ti=function(K){return{value:K,unit:"%"}},gr=function(K){return{value:K,unit:"px"}},vn=function(K){return{value:K,unit:"cm"}},Si=function(K){return{value:K,unit:"mm"}},is=function(K){return{value:K,unit:"in"}},Ws=function(K){return{value:K,unit:"pt"}},Zo=function(K){return{value:K,unit:"pc"}},Al=function(K){return{value:K,unit:"deg"}},Pl=function(K){return{value:K,unit:"rad"}},Yo=function(K){return{value:K,unit:"grad"}},On=function(K){return{value:K,unit:"turn"}},Zs=function(K){return{value:K,unit:null}},Oi=function(){return{type:"hex",value:eu()}},hs=function(K){return{type:"function",value:K}},kn=function(){return{type:"named",value:eu()}},wo=function(){return parseFloat(eu())},ge=0,ar=0,Mp=[{line:1,column:1}],xo=0,Ap=[],Ct=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');u=c[n.startRule]}function eu(){return s.substring(ar,ge)}function To(K,Re){return{type:"literal",text:K,ignoreCase:Re}}function Rw(K,Re,We){return{type:"class",parts:K,inverted:Re,ignoreCase:We}}function Iw(){return{type:"end"}}function hc(K){return{type:"other",description:K}}function By(K){var Re,We=Mp[K];if(We)return We;for(Re=K-1;!Mp[Re];)Re--;for(We={line:(We=Mp[Re]).line,column:We.column};Re<K;)s.charCodeAt(Re)===10?(We.line++,We.column=1):We.column++,Re++;return Mp[K]=We,We}function Lw(K,Re,We){var $i=By(K),$n=By(Re);return{source:l,start:{offset:K,line:$i.line,column:$i.column},end:{offset:Re,line:$n.line,column:$n.column}}}function pi(K){ge<xo||(ge>xo&&(xo=ge,Ap=[]),Ap.push(K))}function rv(K,Re,We){return new e(e.buildMessage(K,Re),K,Re,We)}function jy(){var K;return(K=sv())===a&&(K=Ol()),K}function sv(){var K,Re;return Ct++,K=ge,Ns(),s.substr(ge,4)===d?(Re=d,ge+=4):(Re=a,Ct===0&&pi(z)),Re!==a?(Ns(),ar=K,K=Zt()):(ge=K,K=a),Ct--,K===a&&Ct===0&&pi(N),K}function Ol(){var K,Re;if(K=[],(Re=tu())!==a)for(;Re!==a;)K.push(Re),Re=tu();else K=a;return K}function tu(){var K,Re,We,$i;return K=ge,Ns(),(Re=nv())!==a?(Ns(),(We=bm())===a&&(We=null),Ns(),s.charCodeAt(ge)===41?($i=f,ge++):($i=a,Ct===0&&pi(W)),$i!==a?(Ns(),ar=K,K=Xt(Re,We)):(ge=K,K=a)):(ge=K,K=a),K}function bm(){var K,Re,We,$i,$n,Ys,$l,kw;if(K=ge,(Re=So())!==a){for(We=[],$i=ge,$n=Ns(),s.charCodeAt(ge)===44?(Ys=m,ge++):(Ys=a,Ct===0&&pi(J)),Ys===a&&(Ys=null),$l=Ns(),(kw=So())!==a?$i=$n=[$n,Ys,$l,kw]:(ge=$i,$i=a);$i!==a;)We.push($i),$i=ge,$n=Ns(),s.charCodeAt(ge)===44?(Ys=m,ge++):(Ys=a,Ct===0&&pi(J)),Ys===a&&(Ys=null),$l=Ns(),(kw=So())!==a?$i=$n=[$n,Ys,$l,kw]:(ge=$i,$i=a);ar=K,K=vi(Re,We)}else ge=K,K=a;return K}function So(){var K,Re;return K=ge,(Re=Nw())===a&&(Re=uE())===a&&(Re=Fw())===a&&(Re=ov()),Re!==a&&(ar=K,Re=xi(Re)),(K=Re)===a&&(K=ge,(Re=WN())!==a&&(ar=K,Re=Ni(Re)),K=Re),K}function Ns(){var K,Re;for(Ct++,K=[],X.test(s.charAt(ge))?(Re=s.charAt(ge),ge++):(Re=a,Ct===0&&pi(ae));Re!==a;)K.push(Re),X.test(s.charAt(ge))?(Re=s.charAt(ge),ge++):(Re=a,Ct===0&&pi(ae));return Ct--,Re=a,Ct===0&&pi(ee),K}function nv(){var K,Re,We;return Ct++,K=ge,(Re=Dw())!==a?(s.charCodeAt(ge)===40?(We=g,ge++):(We=a,Ct===0&&pi(Ie)),We!==a?(ar=K,K=Nt(Re)):(ge=K,K=a)):(ge=K,K=a),Ct--,K===a&&(Re=a,Ct===0&&pi(we)),K}function Dw(){var K,Re,We;if(Ct++,K=ge,Re=[],q.test(s.charAt(ge))?(We=s.charAt(ge),ge++):(We=a,Ct===0&&pi(ut)),We!==a)for(;We!==a;)Re.push(We),q.test(s.charAt(ge))?(We=s.charAt(ge),ge++):(We=a,Ct===0&&pi(ut));else Re=a;return Re!==a&&(ar=K,Re=jt()),Ct--,(K=Re)===a&&(Re=a,Ct===0&&pi(Ge)),K}function Nw(){var K,Re,We;return Ct++,K=ge,Ns(),(Re=dc())!==a?(s.charCodeAt(ge)===37?(We=y,ge++):(We=a,Ct===0&&pi(at)),We!==a?(ar=K,K=ti(Re)):(ge=K,K=a)):(ge=K,K=a),Ct--,K===a&&Ct===0&&pi(ot),K}function uE(){var K,Re,We;return Ct++,K=ge,Ns(),(Re=dc())!==a?(s.substr(ge,2)===v?(We=v,ge+=2):(We=a,Ct===0&&pi(st)),We!==a?(ar=K,K=gr(Re)):(ge=K,K=a)):(ge=K,K=a),K===a&&(K=ge,Ns(),(Re=dc())!==a?(s.substr(ge,2)===b?(We=b,ge+=2):(We=a,Ct===0&&pi(li)),We!==a?(ar=K,K=vn(Re)):(ge=K,K=a)):(ge=K,K=a),K===a&&(K=ge,Ns(),(Re=dc())!==a?(s.substr(ge,2)===w?(We=w,ge+=2):(We=a,Ct===0&&pi(Y)),We!==a?(ar=K,K=Si(Re)):(ge=K,K=a)):(ge=K,K=a),K===a&&(K=ge,Ns(),(Re=dc())!==a?(s.substr(ge,2)===x?(We=x,ge+=2):(We=a,Ct===0&&pi(ie)),We!==a?(ar=K,K=is(Re)):(ge=K,K=a)):(ge=K,K=a),K===a&&(K=ge,Ns(),(Re=dc())!==a?(s.substr(ge,2)===T?(We=T,ge+=2):(We=a,Ct===0&&pi(se)),We!==a?(ar=K,K=Ws(Re)):(ge=K,K=a)):(ge=K,K=a),K===a&&(K=ge,Ns(),(Re=dc())!==a?(s.substr(ge,2)===E?(We=E,ge+=2):(We=a,Ct===0&&pi(Ae)),We!==a?(ar=K,K=Zo(Re)):(ge=K,K=a)):(ge=K,K=a)))))),Ct--,K===a&&Ct===0&&pi(it),K}function Fw(){var K,Re,We;return Ct++,K=ge,(Re=dc())!==a?(s.substr(ge,3)===M?(We=M,ge+=3):(We=a,Ct===0&&pi(me)),We!==a?(ar=K,K=Al(Re)):(ge=K,K=a)):(ge=K,K=a),K===a&&(K=ge,(Re=dc())!==a?(s.substr(ge,3)===O?(We=O,ge+=3):(We=a,Ct===0&&pi(Me)),We!==a?(ar=K,K=Pl(Re)):(ge=K,K=a)):(ge=K,K=a),K===a&&(K=ge,(Re=dc())!==a?(s.substr(ge,4)===D?(We=D,ge+=4):(We=a,Ct===0&&pi(Oe)),We!==a?(ar=K,K=Yo(Re)):(ge=K,K=a)):(ge=K,K=a),K===a&&(K=ge,(Re=dc())!==a?(s.substr(ge,4)===U?(We=U,ge+=4):(We=a,Ct===0&&pi(be)),We!==a?(ar=K,K=On(Re)):(ge=K,K=a)):(ge=K,K=a)))),Ct--,K===a&&(Re=a,Ct===0&&pi(ce)),K}function ov(){var K,Re;return Ct++,K=ge,Ns(),(Re=dc())!==a?(ar=K,K=Zs(Re)):(ge=K,K=a),Ct--,K===a&&Ct===0&&pi(xe),K}function WN(){var K,Re,We,$i;if(Ct++,K=ge,s.charCodeAt(ge)===35?(Re=k,ge++):(Re=a,Ct===0&&pi(Le)),Re!==a){if(We=[],Z.test(s.charAt(ge))?($i=s.charAt(ge),ge++):($i=a,Ct===0&&pi(Fe)),$i!==a)for(;$i!==a;)We.push($i),Z.test(s.charAt(ge))?($i=s.charAt(ge),ge++):($i=a,Ct===0&&pi(Fe));else We=a;We!==a?(ar=K,K=Oi()):(ge=K,K=a)}else ge=K,K=a;return K===a&&(K=ge,(Re=tu())!==a&&(ar=K,Re=hs(Re)),(K=Re)===a&&(K=ge,(Re=Dw())!==a&&(ar=K,Re=kn()),K=Re)),Ct--,K===a&&(Re=a,Ct===0&&pi(_e)),K}function dc(){var K,Re,We,$i,$n,Ys,$l;for(K=ge,ye.test(s.charAt(ge))?(s.charAt(ge),ge++):Ct===0&&pi(lt),Re=ge,We=[],L.test(s.charAt(ge))?($i=s.charAt(ge),ge++):($i=a,Ct===0&&pi(ct));$i!==a;)We.push($i),L.test(s.charAt(ge))?($i=s.charAt(ge),ge++):($i=a,Ct===0&&pi(ct));if(s.charCodeAt(ge)===46?($i=H,ge++):($i=a,Ct===0&&pi(Vt)),$i!==a){if($n=[],L.test(s.charAt(ge))?(Ys=s.charAt(ge),ge++):(Ys=a,Ct===0&&pi(ct)),Ys!==a)for(;Ys!==a;)$n.push(Ys),L.test(s.charAt(ge))?(Ys=s.charAt(ge),ge++):(Ys=a,Ct===0&&pi(ct));else $n=a;$n!==a?Re=We=[We,$i,$n]:(ge=Re,Re=a)}else ge=Re,Re=a;if(Re===a)if(Re=[],L.test(s.charAt(ge))?(We=s.charAt(ge),ge++):(We=a,Ct===0&&pi(ct)),We!==a)for(;We!==a;)Re.push(We),L.test(s.charAt(ge))?(We=s.charAt(ge),ge++):(We=a,Ct===0&&pi(ct));else Re=a;if(Re!==a){if(We=ge,s.charCodeAt(ge)===101?($i=V,ge++):($i=a,Ct===0&&pi(Mt)),$i!==a){if(ye.test(s.charAt(ge))?($n=s.charAt(ge),ge++):($n=a,Ct===0&&pi(lt)),$n===a&&($n=null),Ys=[],L.test(s.charAt(ge))?($l=s.charAt(ge),ge++):($l=a,Ct===0&&pi(ct)),$l!==a)for(;$l!==a;)Ys.push($l),L.test(s.charAt(ge))?($l=s.charAt(ge),ge++):($l=a,Ct===0&&pi(ct));else Ys=a;Ys!==a?We=$i=[$i,$n,Ys]:(ge=We,We=a)}else ge=We,We=a;We===a&&(We=null),ar=K,K=wo()}else ge=K,K=a;return K}function WO(K,Re){return K.map(function(We){return We[Re]})}function ZO(K,Re,We){return[K].concat(WO(Re,We))}if((o=u())!==a&&ge===s.length)return o;throw o!==a&&ge<s.length&&pi(Iw()),rv(Ap,xo<s.length?s.charAt(xo):null,xo<s.length?Lw(xo,xo+1):Lw(xo,xo))}return t(e,Error),e.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(l):l,u=this.location.source+":"+c.line+":"+c.column;if(a){var d=this.location.end,f=i("",c.line.toString().length," "),m=a[l.line-1],g=(l.line===d.line?d.column:m.length+1)-l.column||1;n+=`
 --> `+u+`
`+f+` |
`+c.line+" | "+m+`
`+f+" | "+i("",l.column-1," ")+i("",g,"^")}else n+=`
 at `+u}return n},e.buildMessage=function(s,n){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var g=m.parts.map(function(y){return Array.isArray(y)?c(y[0])+"-"+c(y[1]):c(y)});return"["+(m.inverted?"^":"")+g.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function u(m){return o[m.type](m)}function d(m){var g,y,v=m.map(u);if(v.sort(),v.length>0){for(g=1,y=1;g<v.length;g++)v[g-1]!==v[g]&&(v[y]=v[g],y++);v.length=y}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+d(s)+" but "+f(n)+" found."},{SyntaxError:e,parse:r}},(Q0e=m5e).exports&&(Q0e.exports=K0e());var LEt=m5e.exports;function g5e(t){if(!t||t.length===0)return null;if(typeof t=="string"){const i=e_e(t);return i&&i.length!==0?i:null}const e=t.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new B("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:e_e(i.value)}});e.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<e.length-1;i++){if(!FJe(e[i].effects,e[i+1].effects))throw new B("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[i].effects,b:e[i+1].effects});kJe(e[i].effects,e[i+1].effects)}return e.sort((i,r)=>r.scale-i.scale),e}function e_e(t){let e;if(!t)return[];try{e=LEt.parse(t)}catch(i){throw new B("effect:invalid-syntax","Invalid effect syntax",{value:t,error:i})}return e.map(i=>DEt(i))}function DEt(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return NEt(t);case"opacity":return FEt(t);case"hue-rotate":return kEt(t);case"blur":return UEt(t);case"drop-shadow":return VEt(t);case"bloom":return zEt(t)}}catch(e){throw e.details.filter=t,e}throw new B("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function NEt(t){let e=1;return BO(t.parameters,1),t.parameters.length===1&&(e=Mf(t.parameters[0])),new uY(t.name,e)}function FEt(t){let e=1;return BO(t.parameters,1),t.parameters.length===1&&(e=Mf(t.parameters[0])),new cMe(e)}function kEt(t){let e=0;return BO(t.parameters,1),t.parameters.length===1&&(e=WEt(t.parameters[0])),new aMe(e)}function UEt(t){let e=0;return BO(t.parameters,1),t.parameters.length===1&&(e=Hae(t.parameters[0]),FN(e,t.parameters[0])),new iMe(e)}function VEt(t){const e=[];let i=null;for(const r of t.parameters)if(r.type==="color"){if(e.length&&Object.freeze(e),i)throw new B("effect:type-error","Accepts only one color",{});i=ZEt(r)}else{const s=Hae(r);if(Object.isFrozen(e))throw new B("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(s),e.length===3&&FN(s,r)}if(e.length<2||e.length>3)throw new B("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new nMe(e[0],e[1],e[2]||0,i||y5e("black"))}function zEt(t){let e=1,i=0,r=0;return BO(t.parameters,3),t.parameters[0]&&(e=Mf(t.parameters[0])),t.parameters[1]&&(i=Hae(t.parameters[1]),FN(i,t.parameters[1])),t.parameters[2]&&(r=Mf(t.parameters[2])),new eMe(e,i,r)}function BO(t,e){if(t.length>e)throw new B("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function E8(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in Gae)return"<length>";if(t.unit in jae)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function FN(t,e){if(t<0)throw new B("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function BEt(t){if(t.type!=="quantity"||t.unit!==null)throw new B("effect:type-error",`Expected <double>, Actual: ${E8(t)}`,{term:t})}function jEt(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new B("effect:type-error",`Expected <double> or <percentage>, Actual: ${E8(t)}`,{term:t})}const jae={deg:1,grad:.9,rad:180/Math.PI,turn:360};function GEt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&jae[t.unit]!=null))throw new B("effect:type-error",`Expected <angle>, Actual: ${E8(t)}`,{term:t})}const Gae={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function HEt(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Gae[t.unit]!=null))throw new B("effect:type-error",`Expected <length>, Actual: ${E8(t)}`,{term:t})}function Mf(t){jEt(t);const e=t.value;return FN(e,t),t.unit==="%"?.01*e:e}function qEt(t){return BEt(t),FN(t.value,t),t.value}function WEt(t){return GEt(t),t.value*jae[t.unit]||0}function Hae(t){return HEt(t),t.value*Gae[t.unit]||0}function ZEt(t){switch(t.colorType){case"hex":return $Xe(t.value);case"named":return y5e(t.value);case"function":return JEt(t.value)}}function y5e(t){if(!ECe(t))throw new B("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return OXe(t)}const YEt=/^rgba?/i,XEt=/^hsla?/i;function JEt(t){if(BO(t.parameters,4),YEt.test(t.name))return[Mf(t.parameters[0]),Mf(t.parameters[1]),Mf(t.parameters[2]),t.parameters[3]?Mf(t.parameters[3]):1];if(XEt.test(t.name))return CCe(qEt(t.parameters[0]),Mf(t.parameters[1]),Mf(t.parameters[2]),t.parameters[3]?Mf(t.parameters[3]):1);throw new B("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function fD(t,e,i){var r;try{return KEt(t)}catch(s){(r=i==null?void 0:i.messages)==null||r.push(s)}return null}function mD(t,e,i,r){try{const s=QEt(t);ua(i,s,e)}catch(s){r.messages&&r.messages.push(s)}}function QEt(t){const e=g5e(t);return e?UJe(e)?e.map(i=>i.toJSON()):e.map(({scale:i,effects:r})=>({scale:i,value:r.map(s=>s.toJSON())})):null}function KEt(t){if(!t||t.length===0)return null;if(eCt(t)){const e=[];for(const i of t)e.push({scale:i.scale,value:lee(i.value)});return e}return lee(t)}function eCt(t){const e=t[0];return!!e&&"scale"in e}function lee(t){if(!(t!=null&&t.length))return"";const e=[];for(const i of t){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[r0(i,"amount")];break;case"blur":r=[r0(i,"radius","pt")];break;case"hue-rotate":r=[r0(i,"angle","deg")];break;case"drop-shadow":r=[r0(i,"xoffset","pt"),r0(i,"yoffset","pt"),r0(i,"blurRadius","pt"),tCt(i,"color")];break;case"bloom":r=[r0(i,"strength"),r0(i,"radius","pt"),r0(i,"threshold")]}const s=`${i.type}(${r.filter(Boolean).join(" ")})`;g5e(s),e.push(s)}return e.join(" ")}function r0(t,e,i){if(t[e]==null)throw new B("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return i?t[e]+i:""+t[e]}function tCt(t,e){if(t[e]==null)throw new B("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const i=t[e];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}let _5e=class{constructor(e,i){this._storage=new t4e,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),i&&this._storage.registerRemoveFunc("",i)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,i,r=1){this._storage.put(this,e,i,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}};const v5e="picture-fill",b5e="simple-fill",iCt="simple-line",w5e="simple-marker",rCt="text",sCt="cim",t_e=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),Q9=new _5e(1e3);function ooi(t){const e=t.style;let i=null;if(t)switch(t.type){case w5e:e!=="cross"&&e!=="x"&&(i=t.color);break;case b5e:e&&e!=="solid"?e!=="none"&&(i={type:"pattern",x:0,y:0,src:tr(`esri/symbols/patterns/${e}.png`),width:5,height:5}):i=t.color;break;case v5e:i={type:"pattern",src:t.url,width:mr(t.width)*t.xscale,height:mr(t.height)*t.yscale,x:mr(t.xoffset),y:mr(t.yoffset)};break;case rCt:i=t.color;break;case sCt:i=f5e(t)}return i}function nCt(t,e){const i=t+"-"+e;return Q9.get(i)!==void 0?Promise.resolve(Q9.get(i)):fr(t,{responseType:"image"}).then(r=>{const s=r.data,n=s.naturalWidth,o=s.naturalHeight,a=document.createElement("canvas");a.width=n,a.height=o;const l=a.getContext("2d");l.fillStyle=e,l.fillRect(0,0,n,o),l.globalCompositeOperation="destination-in",l.drawImage(s,0,0);const c=a.toDataURL();return Q9.put(i,c),c})}function qae(t){if(!t)return null;let e=null;switch(t.type){case b5e:case v5e:case w5e:e=qae(t.outline);break;case iCt:{const i=mr(t.width);t.style!=null&&t.style!=="none"&&i!==0&&(e={color:t.color,style:Wae(t.style),width:i,cap:t.cap,join:t.join==="miter"?mr(t.miterLimit):t.join},e.dashArray=x5e(e).join(",")||"none");break}default:e=null}return e}function x5e(t){if(!(t!=null&&t.style))return[];const{dashArray:e,style:i,width:r}=t;if(typeof e=="string"&&e!=="none")return e.split(",").map(o=>Number(o));const s=r??0,n=t_e.has(i)?t_e.get(i).map(o=>o*s):[];if(t.cap!=="butt")for(const[o,a]of n.entries())n[o]=o%2==1?a+s:Math.max(a-s,1);return n}const Wae=(()=>{const t={};return e=>{if(t[e])return t[e];const i=e.replaceAll("-","");return t[e]=i,i}})(),oCt=new je([128,128,128]),aCt=new je("white");function lCt(t){var i,r;const e=(i=t.symbolLayers)==null?void 0:i.at(-1);if(e&&"outline"in e)return(r=e==null?void 0:e.outline)==null?void 0:r.size}function aoi(t){var e;if(!t)return 0;if(Qb(t)){const i=lCt(t);return i??0}return bo((e=qae(t))==null?void 0:e.width)}function cCt(t){if(t==null||!("symbolLayers"in t)||t.symbolLayers==null)return!1;switch(t.type){case"point-3d":return t.symbolLayers.some(e=>e.type==="object");case"line-3d":return t.symbolLayers.some(e=>e.type==="path");case"polygon-3d":return t.symbolLayers.some(e=>e.type==="object"||e.type==="extrude");default:return!1}}function T5e(t){var e;return((e=t.resource)==null?void 0:e.href)??""}function qE(t,e){if(!t)return null;let i=null;return Qb(t)?i=uCt(t):w6(t)&&(i=t.type==="cim"?f5e(t):t.color?new je(t.color):null),i?gD(i,e):null}function uCt(t){const e=t.symbolLayers;if(!e)return null;let i=null;return e.forEach(r=>{var s;r.type==="object"&&((s=r.resource)!=null&&s.href)||(i=r.type==="water"?r.color:r.material?r.material.color:null)}),i?new je(i):null}function gD(t,e){if(e==null||t==null)return t;const i=t.toRgba();return i[3]=i[3]*e,new je(i)}function hCt(t,e,i){const r=t.symbolLayers;if(!r)return;const s=n=>gD(e=e??n??(i!=null?aCt:null),i);r.forEach(n=>{var o,a;if(n.type!=="object"||!((o=n.resource)!=null&&o.href)||e)if(n.type==="water")n.color=s(n.color);else{const l=n.material!=null?n.material.color:null,c=s(l);n.material==null?n.material=new Hh({color:c}):n.material.color=c,i!=null&&"outline"in n&&((a=n.outline)==null?void 0:a.color)!=null&&(n.outline.color=gD(n.outline.color,i))}})}function dCt(t,e,i){var r;(e=e??t.color)&&(t.color=gD(e,i)),i!=null&&"outline"in t&&((r=t.outline)!=null&&r.color)&&(t.outline.color=gD(t.outline.color,i))}function K9(t,e,i){t&&(e||i!=null)&&(e&&(e=new je(e)),Qb(t)?hCt(t,e,i):w6(t)&&dCt(t,e,i))}async function pCt(t,e){const i=t.symbolLayers;i&&await TG(i,async r=>fCt(r,e))}async function fCt(t,e){switch(t.type){case"extrude":gCt(t,e);break;case"icon":case"line":case"text":mCt(t,e);break;case"path":_Ct(t,e);break;case"object":await yCt(t,e)}}function mCt(t,e){const i=S5e(e);i!=null&&(t.size=i)}function S5e(t){for(const e of t)if(typeof e=="number")return e;return null}function gCt(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function yCt(t,e){const{resourceSize:i,symbolSize:r}=await vCt(t),s=E5e(e,i,r);t.width=eL(e[0],r[0],i[0],s),t.depth=eL(e[1],r[1],i[1],s),t.height=eL(e[2],r[2],i[2],s)}function _Ct(t,e){const i=E5e(e,o_,[t.width,void 0,t.height]);t.width=eL(e[0],t.width,1,i),t.height=eL(e[2],t.height,1,i)}function E5e(t,e,i){for(let r=0;r<3;r++){const s=t[r];switch(s){case"symbol-value":{const n=i[r];return n!=null?n/e[r]:1}case"proportional":break;default:if(s&&e[r])return s/e[r]}}return 1}async function vCt(t){const{computeObjectLayerResourceSize:e}=await oe(()=>import("./symbolLayerUtils-BljFlzfb.js"),[]),i=await e(t,10),{width:r,height:s,depth:n}=t,o=[r,n,s];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/i[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=i[l]*a);return{resourceSize:i,symbolSize:o}}function eL(t,e,i,r){switch(t){case"proportional":return i*r;case"symbol-value":return e??i;default:return t}}function bCt(t,e){const i=S5e(e);if(i!=null)switch(t.type){case"simple-marker":t.size=i;break;case"picture-marker":{const r=t.width/t.height;r>1?(t.width=i,t.height=i*r):(t.width=i*r,t.height=i);break}case"simple-line":t.width=i;break;case"text":t.font.size=i}}async function wCt(t,e){if(t&&e)return Qb(t)?pCt(t,e):void(w6(t)&&bCt(t,e))}function xCt(t,e,i){if(t&&e!=null)if(Qb(t)){const r=t.symbolLayers;r&&r.forEach(s=>{if(s&&s.type==="object")switch(i){case"tilt":s.tilt=(s.tilt??0)+e;break;case"roll":s.roll=(s.roll??0)+e;break;default:s.heading=(s.heading??0)+e}})}else w6(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle+=e))}function C5e(t){if(!t)return null;const e=t.effects.filter(i=>i.type!=="bloom").map(i=>i.toJSON());return lee(e)}function loi(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function TCt(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}const coi=1.2,SCt=jh,ECt=4;let C8=class{constructor(e,i,r,s){this.graphics3DSymbolLayer=e,this.renderGeometries=i,this.boundingBox=r,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,bs.ADD);if(e||this._addedToStage){for(const i of this.renderGeometries)i.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Jn.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,bs.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=C()){return pe(e,0,0,0)}getBoundingBoxObjectSpace(e=io()){return Qr(e)}addObjectState(e,i){e===R_.Highlight&&(this.renderGeometries.forEach(r=>{const s=r.geometry.addHighlight();i.addRenderGeometry(r,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Jn.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(i=>{e.removeRenderGeometry(i)})}removeRenderGeometryObjectState(e,i){e.geometry.removeHighlight(i),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Jn.HIGHLIGHT)}computeAttachmentOrigin(e){for(const i of this.renderGeometries)i.geometry.computeAttachmentOrigin(WE)&&(e.draped.origin[0]+=WE[0],e.draped.origin[1]+=WE[1],e.draped.num++)}async getProjectedBoundingBox(e,i,r,s,n){Qr(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,i_e,r),hlt(n,i_e)}if(i){let o;jf(n,WE);const a=Yoe(n,i.service.spatialReference,i);try{o=await i.service.queryElevation(WE[0],WE[1],s,a,"ground")}catch{}o!=null&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(e,i,r,s){if(this.boundingBox)v6(Lm,this.boundingBox);else{const n=e.boundingSphere,o=n[3];Lm[0]=n[0]-o,Lm[1]=n[1]-o,Lm[2]=n[2]-o,Lm[3]=n[0]+o,Lm[4]=n[1]+o,Lm[5]=n[2]+o}return i(Lm,0,2),this.calculateRelativeScreenBounds&&s.push({location:jf(Lm),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),Tne(Lm,r)}};const i_e=oi(),Lm=io(),WE=C();function vj(t,e,i){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=i,t.canvas}function M5e(t){const{size:e}=t.definition,i=t.fontString(e);let r=r_e.get(i);if(!r){const s=vj(MCt,0,0).getContext("2d");t.setFontProperties(s,e);const n=s.measureText(ACt);r=new CCt(n.actualBoundingBoxAscent,n.actualBoundingBoxDescent),r_e.set(i,r)}return r}const r_e=new Map;let CCt=class{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,i){this.maxAscent=e,this.maxDescent=i}};const MCt={canvas:null},ACt=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})(),bj=1;let A5e=class{constructor(e,i,r,s){this.text=e,this._alignment=i,this._parameters=r,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.replaceAll(" "," ").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let i=0;i<this._lines.length-1;i++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=vj(s_e,l5,l5).getContext("2d"),i=this._parameters.definition.pixelRatio,r=this._fontSize*i;this._parameters.setFontProperties(e,r);let s=2*this._haloSize;const n=this._parameters.definition.font;n.style!=="italic"&&n.style!=="oblique"&&n.weight!=="bold"&&n.weight!=="bolder"||(s+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let o=0,a=0,l=0,c=0,u=0;this._lines.forEach((b,w)=>{const x=e.measureText(b),T=x.width/i,E=T+s;this._textWidths.push(T),this._lineWidths.push(E),o=Math.max(o,E),c=Math.max(c,x.actualBoundingBoxAscent/i),u=Math.max(u,x.actualBoundingBoxDescent/i),w===0&&(a=x.actualBoundingBoxAscent/i),w===this._lines.length-1&&(l=x.actualBoundingBoxDescent/i)});const d=M5e(this._parameters),f=Math.max(c,d.maxAscent),m=Math.max(u,d.maxDescent),g=a,y=this._parameters.definition.font.decoration==="underline"?m:l,v=o;this._metricsCached=new OCt(g,y,f,m,v)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*PCt}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,bj)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case Pb.Left:return this._horizontalPadding;case Pb.Center:return(this.displayWidth-this._lineWidths[e])/2;case Pb.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,i,r){e.save();const s=i/=this.renderPixelRatio,n=r/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset+this._metrics.firstLineAscent;i+=o,r+=a;const l=this._haloSize>0;l&&this._renderHalo(e,s,n,o,a),this._parameters.setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const u=this._lines[c],d=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,u,i+d,r),this._renderLineDecoration(e,i+d,r,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,u,i+this._getLineXOffset(c),r),this._renderLineDecoration(e,i+d,r,this._textWidths[c]),r+=this._lineSpacing}if(kr.TEXT_SHOW_BASELINE){e.strokeStyle=n_e,e.setLineDash([2,2]),e.lineWidth=1;let c=n+a;for(let u=0;u<this._lines.length;++u)this._drawLine(e,[s,c],[s+this.displayWidth,c]),c+=this._lineSpacing}if(kr.TEXT_SHOW_BORDER&&(e.strokeStyle=n_e,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,s,n,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,i,r,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":r+=2*a;break;case"line-through":r-=.33*this._midLineAscent}const l=n?this._haloSize:0;e.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(i+s+l),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,i,r,s){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=Ne(s,0,Math.floor(o/2)),e.beginPath(),e.moveTo(i,r+s),e.arcTo(i,r,i+s,r,s),e.lineTo(i+n-s,r),e.arcTo(i+n,r,i+n,r+s,s),e.lineTo(i+n,r+o-s),e.arcTo(i+n,r+o,i+n-s,r+o,s),e.lineTo(i+s,r+o),e.arcTo(i,r+o,i,r+o-s,s),e.closePath()):e.rect(i,r,n,o)}_renderHalo(e,i,r,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=vj(s_e,Math.max(o,l5),Math.max(a,l5)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._parameters.setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const u=this._renderedHaloSize<3;c.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let d=n;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,s+m,d,this._textWidths[f],!0),d+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(i),this._toRenderUnit(r),o,a),e.globalAlpha=1}_renderHaloEmulated(e,i,r){for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of P5e)this._fillText(e,n,i+o+this._haloSize*a,r+this._haloSize*l);r+=this._lineSpacing}}_renderHaloNative(e,i,r){const s=2*this._haloSize;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let u=0;u<l;u++){const d=1-(l-1)*c+u*c;e.lineWidth=this._toRenderUnit(d*s),this._strokeText(e,o,i+a,r)}r+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,i,r,s){e.fillText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_strokeText(e,i,r,s){e.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_drawLine(e,i,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,i,r){const s=this._toRenderUnit(i[0]),n=this._toRenderUnit(i[1]),o=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,u=Math.floor(n)+.5,d=Math.ceil(n+a)-.5;e.beginPath(),e.moveTo(l,u),e.lineTo(c,u),e.lineTo(c,d),e.lineTo(l,d),e.lineTo(l,u),e.stroke()}};const P5e=[];for(let e=0;e<360;e+=360/16)P5e.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var Pb;(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(Pb||(Pb={}));const s_e={canvas:null},PCt=.2,l5=512,n_e="rgb(255, 0, 255, 0.5)";let OCt=class{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,i,r,s,n){this.firstLineAscent=e,this.lastLineDescent=i,this.maxLineAscent=r,this.maxLineDescent=s,this.displayWidth=n}};const $Ct=Object.freeze({left:0,center:.5,right:1}),oV=Object.freeze({"bottom-left":Ei(0,0),bottom:Ei(.5,0),"bottom-right":Ei(1,0),left:Ei(0,.5),center:Ei(.5,.5),right:Ei(1,.5),"top-left":Ei(0,1),top:Ei(.5,1),"top-right":Ei(1,1)});function O5e(t){switch(t){case"left":return Pb.Left;case"right":return Pb.Right;default:return Pb.Center}}function o_e(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function RCt(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function ICt(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function LCt(t){return t==="middle"?"center":t}function DCt(t,e){switch(t){case"top":return Di(e,0,bj);case"bottom":return Di(e,0,-bj);default:return Ga(e,m2)}}let KP=class{constructor(e,i={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=ke(),this._shaderTransformation=null,this._boundingSphere=null,this.id=zh(),this.layerUid=i.layerUid,this.graphicUid=i.graphicUid,this.castShadow=i.castShadow??!1,i.objectShaderTransformation!=null&&this.objectShaderTransformationChanged(i.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){An(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){e==null?this._shaderTransformation=null:(this._shaderTransformation??(this._shaderTransformation=ke()),vr(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(this._boundingSphere==null&&(this._boundingSphere??(this._boundingSphere=_n()),nt(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*CP(this.shaderTransformation)),this._boundingSphere):APe}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const a_e=qe(0,0,1),NCt=16,FCt=1.5,dS=Cae,kCt=[dS/2,dS/2,1-dS/2,1-dS/2],UCt=[cj*dS,cj*dS];let cee=class $5e extends zy{getCachedSize(){return{size:this._getIconSize()}}constructor(e,i,r,s){super(e,i,r,s),this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._patchTask=null,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const i=this._prepareMaterialParameters(),r=this._getPrimitive();if(r!=null)this._prepareResourcesPrimitive(i,r);else{const s=T5e(this.symbolLayer),n=l_e(s);n!=null?await this._prepareResourcesCIM(i,JSON.parse(n),e):await this._prepareResourcesHref(i,s,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=n8(this._getIconSize());if(e)throw new B("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,i=Math.round(e.size!=null?mr(e.size):NCt);return this._drivenProperties.size?Math.max(i,64):i}_generateTextureCIM(e){let i=this._cimData;if(i&&i.symbol||this.logger.error("Can't create texture, CIM data is undefined"),i.primitiveOverrides){i=re(i);const c=i.primitiveOverrides;KM.evaluateOverrides(c,e,this._arcadeInfo.geometryType,null,null),KM.applyOverrides(i.symbol,c)}const r=vre(JSON.stringify(i));let s=this._cimSymbolTextures.get(r);if(s)return s;const n=this._context.sharedResources.cimSymbolRasterizer,o=this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null;o&&KM.applyDictionaryTextOverrides(i.symbol,e,o,null);const a=this._cimScaleFactorOrFunction!=null?DSt(this._cimScaleFactorOrFunction,e):1;a!==1&&i.symbol&&Bae(i.symbol,a);const l=X9.getEnvelope(i,null,n.resourceManager);if(l!=null&&l.width&&l.height){const c=l.x+l.width/2,u=l.y+l.height/2,d=n.rasterize({type:"cim",data:i},l.width,l.height,c,u,1,"esriGeometryPoint"),f=new lS({x:-l.x/l.width-.5,y:(l.height+l.y)/l.height-.5});this._cimMaterialParametersInfo.anchorPosition=c_e("relative",f),s=new cw(d,{width:(d==null?void 0:d.width)??1,height:(d==null?void 0:d.height)??1,reloadable:!0})}else s=new cw(new ImageData(1,1),{width:1,height:1,reloadable:!0});return this._cimSymbolTextures.set(r,s),this._context.stage.add(s),s}_prepareMaterialParameters(){const e={anchorPosition:c_e(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},i=this.symbol;if(VCt(i)){const{screenLength:r,minWorldLength:s,maxWorldLength:n}=i.verticalOffset;e.verticalOffset={screenLength:mr(r),minWorldLength:s||0,maxWorldLength:n??1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!ue("enable-feature:non-occluded-hud"),e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,i){const r=this._getOutlineSize();if(e7(i)&&r===0)throw new Error("Nothing to render");if(this._outlineSize=r,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,this._context.sharedResources.textures!=null){const n=this._context.sharedResources.textures.fromData(`${i}-icon`,()=>mxt(i));this._textureHandle=n,e.textureId=n.texture.id}e.textureIsSignedDistanceField=!0,e.sampleSignedDistanceFieldTexelCenter=fxt(i),e.distanceFieldBoundingBox=kCt;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/dS,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,i,r){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(this._context.sharedResources.textures!=null){const o=await Qh(this._context.sharedResources.textures.fromUrl(i,n,{signal:r}));if(o.ok===!1)throw Ql(o.error),new B("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${i})`);this._textureHandle=o.value;const a=o.value.texture;this._size=u_e(a,s),e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,i,r){if(this._cimData=i,!this._context.sharedResources.cimSymbolRasterizer){const u=(await oe(async()=>{const{CIMSymbolRasterizer:d}=await import("./CIMSymbolRasterizer-l_nPs_TF.js");return{CIMSymbolRasterizer:d}},[])).CIMSymbolRasterizer;Dt(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new u(this._context.renderCoordsHelper.spatialReference))}const s=this._context.sharedResources.cimSymbolRasterizer,n=[],o=i,a=o==null?void 0:o.symbol;X9.fetchResources(a,s.resourceManager,n,r),X9.fetchFonts(a,s.resourceManager,n);const l=this._context.layer.fields?this._context.layer.fields.map(u=>u.toJSON()):[],c=this._context.renderCoordsHelper.spatialReference;if(this._arcadeInfo={spatialReference:c,fields:l,geometryType:"esriGeometryPoint"},o!=null&&o.primitiveOverrides&&n.push(KM.createRenderExpressions(o.primitiveOverrides,this._arcadeInfo)),n.length>0&&(await Promise.all(n),Dt(r)),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const u=this._context.renderer;if(u.scaleExpression){const d=u.scaleExpression,f=await p$e(d,this._context.layer.spatialReference,l);this._cimScaleFactorOrFunction=(m,g,y)=>{const v=p5e(f,m,{$view:y},"esriGeometryPoint",g);return v!==null?v:1}}}Dt(r),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){var e,i;return(e=this.symbolLayer.resource)!=null&&e.href?null:((i=this.symbolLayer.resource)==null?void 0:i.primitive)??J$e}_getOutlineSize(){var r;let e=0;const i=this.symbolLayer;return((r=i.outline)==null?void 0:r.size)!=null?Math.max(mr(i.outline.size),0):(e=e7(this._getPrimitive())?FCt:0,Math.max(e,0))}_getOutlineColor(){var s;const e=this._getLayerOpacity(),i=this.symbolLayer,r=(s=i==null?void 0:i.outline)==null?void 0:s.color;if(r!=null){const n=je.toUnitRGB(r),o=r.a*e;return[n[0],n[1],n[2],o]}return[0,0,0,0]}_getFillColor(){var r,s;if(e7(this._getPrimitive()))return SCt;const e=this._getPrimitive()==null,i=(s=(r=this.symbolLayer)==null?void 0:r.material)==null?void 0:s.color;return this._getCombinedOpacityAndColor(i,{hasIntrinsicColor:e})}_createMaterialAndAddToStage(e,i){if(this._cimData){this._fastUpdates=null;let r=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return r||(r=new WP(e),this._cimSymbolMaterials.set(e.textureId??0,r),i.add(r)),r}return this._fastUpdates=GP(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._materials[0]=new WP(e),i.add(this._materials[0]),this._materials[0]}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,draped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._patchTask=oc(this._patchTask),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._textureHandle=hi(this._textureHandle)}_getScaleFactor(e,i){if(this._drivenProperties.size&&e.size){for(let r=0;r<3;r++){const s=e.size[r];s&&s!=="symbol-value"&&s!=="proportional"&&(e.size[r]=mr(s))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/i;if(isFinite(+e.size[2]))return+e.size[2]/i}return 1}createGraphics3DGraphic(e){var d;const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;let r,s=[0,0];if(this._cimData){if(!this._cimData.symbol)return null;const f=this._generateTextureCIM(i),m={textureId:f.id,...this._cimMaterialParametersInfo};r=this._createMaterialAndAddToStage(m,this._context.stage);const g=window.devicePixelRatio||1;s=[f.parameters.width/g,f.parameters.height/g]}else s=this._size,r=this._materials[0];const n=GS(i.geometry);if(n==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!((d=this._fastUpdates)!=null&&d.visualVariables.size)){const f=s[0]>s[1]?s[0]:s[1];l=this._getScaleFactor(o,f)}l*=this._symbolTextureRatio;const c=Ei(s[0]*l,s[1]*l),u=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(u.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(i,n,r,a,c,e.layer.uid):this._createAs3DShape(i,n,r,a,c,u,i.uid)}layerOpacityChanged(){const e=this._getFillColor(),i=this._getOutlineColor();this._forEachMaterial(r=>{r.setParameters({color:e}),r.setParameters({outlineColor:i})})}updateGeometry(e,i){if(this.draped||!this._validateGeometry(i))return!1;const{elevationContext:r,stageObject:s}=e;if(r.mode!==this.getGeometryElevationMode(i))return!1;const n=GS(i);if(!n)return!1;const o=ANe(s,this._context,n,r);if(o==null)return!1;const a=fae(this._context,n);return s.geometries[0].localOrigin===a&&(e.alignedSampledElevation=o,C2(e,n,this._context.elevationProvider),!0)}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=wN($5e.elevationModeChangeTypes,r,s);if(n!==Hs.UPDATE)return n;const o=_p(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return this._getPrimitive()!=null}applyRendererDiff(e,i){var r;for(const s in e.diff){if(s!=="visualVariables"||!HP(this._fastUpdates,i,this._fastVisualVariableConvertOptions()))return mn.RecreateSymbol;(r=this._materials[0])==null||r.setParameters(this._fastUpdates.materialParameters)}return mn.FastUpdate}prepareSymbolLayerPatch(e){var r;if((r=this._patchTask)==null||r.abort(),e.diff.type!=="partial")return;const i=e.diff.diff;this._preparePatchResource(e,i)}_preparePatchResource(e,i){var l;if(!i.resource||i.resource.type!=="partial")return;const r=i.resource.diff;if(((l=r==null?void 0:r.href)==null?void 0:l.type)!=="complete")return;const s=r.href.newValue,{textures:n}=this._context.sharedResources;if(s==null||n==null||l_e(s)!=null)return;const o=this._getIconSize(),a=o*this._context.graphicsCoreOwner.view.state.pixelRatio;e.symbolLayerStatePatches.push(()=>{this._patchTask=oc(this._patchTask),this._patchTask=My(c=>this._context.schedule(async(u,d)=>{const f=await Qh(n.fromUrl(s,a,{signal:d}));Dt(d);const m=!f.ok;if(m&&Ql(f.error),this._textureHandle=hi(this._textureHandle),this._patchTask=null,m){this._forEachMaterial(v=>{v.visible=!1,v.setParameters({textureId:null})});const y=`Failed to load (Request for icon resource failed: ${s})`;return void this.logger.error(new B("graphics3diconsymbollayer:request-failed",y))}this._textureHandle=f.value;const g=f.value.texture;this._size=u_e(g,o),this._forEachMaterial(y=>{y.setParameters({textureId:g.id}),y.visible=!0})},c))}),delete r.href}_defaultElevationInfoNoZ(){return zCt}_createAs3DShape(e,i,r,s,n,o,a){const l=this.getFastUpdateAttrValues(e),c=this._context.layer.uid,u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:c}),d=nK(r,a_e,null,s,n,BCt,null,l,u),f=pae(this._context,i,d,o,a);if(f==null)return null;const m=new Vy(this,f.object,[d],null,null,jS,o);return m.alignedSampledElevation=f.sampledElevation,m.needsElevationUpdates=_p(o.mode)||o.mode==="absolute-height",m.getScreenSize=this._createScreenSizeGetter(n,l),m.calculateRelativeScreenBounds=g=>r.calculateRelativeScreenBounds(m.getScreenSize(),1,g),C2(m,i,this._context.elevationProvider),m}_createAsOverlay(e,i,r,s,n,o){r.renderPriority=this._renderPriority;const a=C();xl(i,a,this._context.overlaySR),a[2]=Iae;const l=this._context.clippingExtent;if(l!=null&&!xne(l,a))return null;const c=this.getFastUpdateAttrValues(e),u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),d=nK(r,a_e,a,s,n,null,null,c,u),f=new KP(d,{layerUid:o,graphicUid:e.uid}),m=new C8(this,[f],null,this._context.drapeSourceRenderer);return m.getScreenSize=this._createScreenSizeGetter(n,c),m.calculateRelativeScreenBounds=g=>r.calculateRelativeScreenBounds(m.getScreenSize(),1,g),m}_createScreenSizeGetter(e,i){const r=this._outlineSize+2;if(this._fastUpdates&&i){const o=e[0]/this._symbolTextureRatio,a=e[1]/this._symbolTextureRatio;return(l=gt())=>{const[c,u]=Foe(jCt,this._fastUpdates.materialParameters,i);return l[0]=c*o+r,l[1]=u*a+r,l}}const s=e[0]/this._symbolTextureRatio+r,n=e[1]/this._symbolTextureRatio+r;return(o=gt())=>(o[0]=s,o[1]=n,o)}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),i=qe(e,e,e),r=bo(1),s=e*r,n=qe(s,s,s);return new vN({size:!0,color:!0,rotation:!0,opacity:!1},i,n,r)}_forEachMaterial(e){this._materials.forEach(e),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._materials[0]}}};function VCt(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function e7(t){return t!=null&&(t==="cross"||t==="x")}function l_e(t){const e=Fb(t);return(e==null?void 0:e.mediaType)==="application/json"?e.data:void 0}function c_e(t,e){return t==="relative"?Ei((e.x||0)+.5,.5-(e.y||0)):t in oV?oV[t]:oV.center}function u_e({parameters:t},e){const i=(t.width??1)/(t.height??1);return i>1?[e,Math.round(e/i)]:[Math.round(e*i),e]}cee.PRIMITIVE_SIZE=UCt,cee.elevationModeChangeTypes={definedChanged:Hs.UPDATE,staysOnTheGround:Hs.NONE,onTheGroundChanged:Hs.RECREATE};const zCt={mode:"relative-to-ground",offset:0},BCt=ri(0,0,0,1),jCt=C();function uee(t){switch(t){case"butt":return hp.BUTT;case"square":return hp.SQUARE;case"round":return hp.ROUND;default:return null}}function h_e(t){return t==="diamond"?"kite":t}function hee(t,e,i=null){const r=[],s=e.mapPositions;GCt(e,r);const n=r[0][1].data,o=r[0][1].indices.length,a=Ew(o);return HCt(e,r,a),ZCt(e,r,a),qCt(e,r,a),WCt(e,r,a),YCt(e,r,a),XCt(e,r,a),JCt(e,r,n),new Pn(t,r,s,Gs.Line,i)}function GCt(t,e){const{attributeData:{position:i},removeDuplicateStartEnd:r}=t,s=QCt(i)&&r,n=i.length/3-(s?1:0),o=new Array(2*(n-1)),a=s?i.slice(0,-3):i;let l=0;for(let c=0;c<n-1;c++)o[l++]=c,o[l++]=c+1;e.push([$.POSITION,new ht(a,o,3,s)])}function HCt(t,e,i){if(t.attributeData.colorFeature!=null)return;const r=t.attributeData.color;e.push([$.COLOR,new ht(r??Kd,i,4)])}function qCt(t,e,i){t.attributeData.normal&&e.push([$.NORMAL,new ht(t.attributeData.normal,i,3)])}function WCt(t,e,i){t.attributeData.colorFeature!=null&&e.push([$.COLORFEATUREATTRIBUTE,new ht([t.attributeData.colorFeature],i,1,!0)])}function ZCt(t,e,i){t.attributeData.sizeFeature==null&&e.push([$.SIZE,new ht([t.attributeData.size??1],i,1,!0)])}function YCt(t,e,i){t.attributeData.sizeFeature!=null&&e.push([$.SIZEFEATUREATTRIBUTE,new ht([t.attributeData.sizeFeature],i,1,!0)])}function XCt(t,e,i){t.attributeData.opacityFeature!=null&&e.push([$.OPACITYFEATUREATTRIBUTE,new ht([t.attributeData.opacityFeature],i,1,!0)])}function JCt(t,e,i){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==Je.Global||!t.overlayInfo.spatialReference.isGeographic)return;const r=go(i.length),s=br(t.overlayInfo.spatialReference);for(let d=0;d<r.length;d+=3)vse(i,d,r,d,s);const n=i.length/3,o=$s(n+1);let a=KCt,l=eMt,c=0,u=0;Di(a,r[u++],r[u++]),u++,o[0]=0;for(let d=1;d<n+1;++d)d===n&&(u=0),Di(l,r[u++],r[u++]),u++,c+=qRe(a,l),o[d]=c,[a,l]=[l,a];e.push([$.DISTANCETOSTART,new ht(o,e[0][1].indices,1,!0)])}function QCt(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const KCt=gt(),eMt=gt();function moi(t,e){if(t==null||t.length===0)return[];const i=[];return t.forEach(r=>{const s=r.length,n=go(3*s);r.forEach((a,l)=>{n[3*l]=a[0],n[3*l+1]=a[1],n[3*l+2]=a[2]});const o={attributeData:{position:n,normal:e},removeDuplicateStartEnd:!1};i.push(o)}),i}function tMt(t,e,i,r){const s=t.type==="polygon"?Sy.CCW_IS_HOLE:Sy.NONE,n=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=IN(n,!!t.hasZ,s,t.spatialReference),l=go(o.length),c=xDe(o,t.spatialReference,0,l,0,o,0,o.length/3,e,i,r),u=c!=null;return{lines:u?R5e(a,o,l):[],projectionSuccess:u,sampledElevation:c}}function iMt(t,e){const i=t.type==="polygon"?Sy.CCW_IS_HOLE:Sy.NONE,r=t.type==="polygon"?t.rings:t.paths,{position:s,outlines:n}=IN(r,!1,i),o=gs(s,t.spatialReference,0,s,e,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=Iae;return{lines:o?R5e(n,s):[],projectionSuccess:o}}function R5e(t,e,i=null){const r=new Array;for(const{index:s,count:n}of t){if(n<=1)continue;const o=3*s,a=3*n;r.push({position:up(e,3*s,3*n),mapPositions:i!=null?up(i,o,a):void 0})}return r}function I5e(t){const e=new Hi,i=t.multipassEnabled&&t.output===G.Color,r=t.space===Jc.World;e.include(MFe,t),e.include(GFe,t);const{vertex:s,fragment:n}=e;return n.include(vm),Wc(s,t),e.attributes.add($.POSITION,"vec3"),e.attributes.add($.PREVPOSITION,"vec3"),e.attributes.add($.UV0,"vec2"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),i&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),s.uniforms.add(new Hr("nearFar",(o,a)=>a.camera.nearFar),new ji("viewport",(o,a)=>a.camera.fullViewport)),s.code.add(S`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(S`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),r?(e.attributes.add($.NORMAL,"vec3"),VP(s),s.constants.add("tiltThreshold","float",.7),s.code.add(S`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):s.code.add(S`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),s.code.add(S`
      #define vecN ${r?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${r?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===A2.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===Jc.Screen&&(s.uniforms.add(new fs("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),s.code.add(S`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),s.code.add(S`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),s.uniforms.add(new tt("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),s.code.add(S`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),IO(s),s.code.add(S`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position, 1.0);
vec4 prev = view * vec4(prevPosition, 1.0);
clip(pos, prev);`),r?(t.hideOnShortSegments&&s.code.add(S`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),s.code.add(S`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(s.code.add(S`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===Jc.Screen&&s.code.add(S`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),s.code.add(S`
        ${i?"depth = pos.z;":""}

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${r?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),i&&e.include(Uy,t),e.include(Mn,t),n.uniforms.add(new ji("intrinsicColor",o=>o.color),new xt("tex",o=>o.markerTexture)),n.include(Fy),e.constants.add("texelSize","float",1/HS),n.code.add(S`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",Mae/HS),e.constants.add("relativeTipLineWidth","float",Sxt),n.code.add(S`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${r?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),t.transparencyPassType===ft.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),e.constants.add("symbolAlphaCutoff","float",la),n.code.add(S`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${r?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===G.ObjectAndLayerIdColor?S`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===G.Color?S`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===G.Color&&t.transparencyPassType===ft.ColorAlpha?S`
            fragColor = premultiplyAlpha(fragColor);
            fragAlpha = fragColor.a;`:""}
    ${t.output===G.Highlight?S`fragColor = vec4(1.0);`:""}
  }
  `),e}const rMt=Object.freeze(Object.defineProperty({__proto__:null,build:I5e},Symbol.toStringTag,{value:"Module"})),L5e=new Map([[$.POSITION,0],[$.PREVPOSITION,1],[$.UV0,2],[$.NORMAL,3],[$.COLOR,4],[$.COLORFEATUREATTRIBUTE,4],[$.SIZE,5],[$.SIZEFEATUREATTRIBUTE,5],[$.OPACITYFEATUREATTRIBUTE,6]]);let D5e=class N5e extends Ki{initializeProgram(e){return new er(e.rctx,N5e.shader.get().build(this.configuration),L5e)}_makePipelineState(e,i){const r=this.configuration,s=e===ft.NONE;return Kt({blending:r.output===G.Color?s?Bu:Q_(e):null,depthTest:r.space===Jc.Draped?null:{func:Aw(e)},depthWrite:r.space===Jc.Draped?null:s?r.writeDepth?Wu:null:K6(e),drawBuffers:r.output===G.Depth?{buffers:[ho.NONE]}:K_(e),colorWrite:ui,stencilWrite:r.hasOccludees?Ty:null,stencilTest:r.hasOccludees?i?aw:Pw:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Kt({blending:Bu,depthTest:tj,depthWrite:null,colorWrite:ui,stencilWrite:null,stencilTest:tNe}),this._occluderPipelineOpaque=Kt({blending:Bu,depthTest:tj,depthWrite:null,colorWrite:ui,stencilWrite:KDe,stencilTest:eNe}),this._occluderPipelineMaskWrite=Kt({blending:null,depthTest:sae,depthWrite:null,colorWrite:null,stencilWrite:Ty,stencilTest:aw})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e,i,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:i?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};D5e.shader=new qi(rMt,()=>oe(()=>Promise.resolve().then(()=>I9t),void 0));let sMt=class extends Cw{constructor(e){super(e,new oMt),this.produces=new Map([[Pe.OPAQUE_MATERIAL,i=>i===G.Highlight||__(i)&&this.parameters.renderOccluded===ir.OccludeAndTransparentStencil],[Pe.OPAQUE_NO_SSAO_DEPTH,i=>Cb(i)],[Pe.OCCLUDER_MATERIAL,i=>qfe(i)&&this.parameters.renderOccluded===ir.OccludeAndTransparentStencil],[Pe.TRANSPARENT_OCCLUDER_MATERIAL,i=>qfe(i)&&this.parameters.renderOccluded===ir.OccludeAndTransparentStencil],[Pe.TRANSPARENT_MATERIAL,i=>__(i)&&this.parameters.writeDepth],[Pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>__(i)&&!this.parameters.writeDepth],[Pe.DRAPED_MATERIAL,i=>i===G.Color||i===G.Highlight]]),this._vertexAttributeLocations=L5e,this._configuration=new Mo,this._layout=this.createLayout()}getConfiguration(e,i){return this._configuration.output=e,this._configuration.space=i.slot===Pe.DRAPED_MATERIAL?Jc.Draped:this.parameters.worldSpace?Jc.World:Jc.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==hp.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===ir.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=Ds().vec3f($.POSITION).vec3f($.PREVPOSITION).vec2f($.UV0);return this.parameters.worldSpace&&e.vec3f($.NORMAL),this.parameters.vvSize?e.f32($.SIZEFEATUREATTRIBUTE):e.f32($.SIZE),this.parameters.vvColor?e.f32($.COLORFEATUREATTRIBUTE):e.vec4f($.COLOR),this.parameters.vvOpacity&&e.f32($.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new aMt(this._layout,this.parameters)}createGLMaterial(e){return new nMt(e)}},nMt=class extends qne{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextures.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(e){const i=this._material.parameters.markerPrimitive;return i!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextures.swap(i,this._markerPrimitive)}),this._markerPrimitive=i),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(D5e,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===G.Color&&this._updateOccludeeState(e),this._updateParameters(e)}},oMt=class extends bN{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=hp.BUTT,this.anchor=A2.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}},aMt=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,i,r,s,n){const o=r.attributes.get($.POSITION).data,a=o.length/3;let l=[1,0,0];const c=r.attributes.get($.NORMAL);this._parameters.worldSpace&&c!=null&&(l=c.data);let u=1,d=0;this._parameters.vvSize?d=r.attributes.get($.SIZEFEATUREATTRIBUTE).data[0]:r.attributes.has($.SIZE)&&(u=r.attributes.get($.SIZE).data[0]);let f=[1,1,1,1],m=0;this._parameters.vvColor?m=r.attributes.get($.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has($.COLOR)&&(f=r.attributes.get($.COLOR).data);let g=0;this._parameters.vvOpacity&&(g=r.attributes.get($.OPACITYFEATUREATTRIBUTE).data[0]);const y=new Float32Array(s.buffer);let v=n*(this.vertexBufferLayout.stride/4);const b=(E,M,O,D)=>{if(y[v++]=E[0],y[v++]=E[1],y[v++]=E[2],y[v++]=M[0],y[v++]=M[1],y[v++]=M[2],y[v++]=O[0],y[v++]=O[1],this._parameters.worldSpace&&(y[v++]=l[0],y[v++]=l[1],y[v++]=l[2]),this._parameters.vvSize?y[v++]=d:y[v++]=u,this._parameters.vvColor)y[v++]=m;else{const U=Math.min(4*D,f.length-4);y[v++]=f[U],y[v++]=f[U+1],y[v++]=f[U+2],y[v++]=f[U+3]}this._parameters.vvOpacity&&(y[v++]=g)};let w;(function(E){E[E.ASCENDING=1]="ASCENDING",E[E.DESCENDING=-1]="DESCENDING"})(w||(w={}));const x=(E,M)=>{const O=pe(lMt,o[3*E],o[3*E+1],o[3*E+2]),D=cMt;let U=E+M;do pe(D,o[3*U],o[3*U+1],o[3*U+2]),U+=M;while(h2(O,D)&&U>=0&&U<a);e&&(nt(O,O,e),nt(D,D,e)),b(O,D,[-1,-1],E),b(O,D,[1,-1],E),b(O,D,[1,1],E),b(O,D,[-1,-1],E),b(O,D,[1,1],E),b(O,D,[-1,1],E)},T=this._parameters.placement;T!=="begin"&&T!=="begin-end"||x(0,w.ASCENDING),T!=="end"&&T!=="begin-end"||x(a-1,w.DESCENDING)}};const lMt=C(),cMt=C(),Ya={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},uMt={dash:Ya.dash,"dash-dot":[...Ya.dash,...Ya.dot],dot:Ya.dot,"long-dash":Ya["long-dash"],"long-dash-dot":[...Ya["long-dash"],...Ya.dot],"long-dash-dot-dot":[...Ya["long-dash"],...Ya.dot,...Ya.dot],none:null,"short-dash":Ya["short-dash"],"short-dash-dot":[...Ya["short-dash"],...Ya["short-dot"]],"short-dash-dot-dot":[...Ya["short-dash"],...Ya["short-dot"],...Ya["short-dot"]],"short-dot":Ya["short-dot"],solid:null},hMt=8;function dMt(t,e){return t==null?t:{pattern:t.slice(),pixelRatio:e}}function boi(t){return{pattern:[t,t],pixelRatio:2}}function F5e(t){return t!=null&&t.type==="style"?pMt(t.style):null}function pMt(t){return t!=null?dMt(uMt[t],hMt):null}const fMt=["polyline","polygon","extent"],d_e=new vN({size:!0,color:!0,rotation:!1,opacity:!0});let k5e=class U5e extends zy{constructor(e,i,r,s){super(e,i,r,s)}async doLoad(){if(this._fastUpdates=GP(this._context.renderer,d_e),!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:bo(1))<0)throw new B("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e,i=!1){var n,o;const r=this._getCombinedOpacityAndColor(i&&this._markerColor||this._materialColor);this._patternHidesLine&&!i&&(r[3]=0);const s={width:this._computeMaterialWidth((n=this.symbolLayer)==null?void 0:n.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:uee(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:F5e(this.symbolLayer.pattern)};return(o=this._fastUpdates)!=null&&o.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){var e;return(e=this.symbolLayer.material)==null?void 0:e.color}get _markerColor(){var e;return(e=this.symbolLayer.marker)==null?void 0:e.color}get _lineMaterial(){return this._materials[Qs.Line]==null&&(this._materials[Qs.Line]=new YM(this._getMaterialParameters(!1)),this._context.stage.add(this._materials[Qs.Line])),this._materials[Qs.Line]}get _ringMaterial(){return this._materials[Qs.Ring]==null&&(this._materials[Qs.Ring]=new YM(this._getMaterialParameters(!0)),this._context.stage.add(this._materials[Qs.Ring])),this._materials[Qs.Ring]}get _wireframeLineMaterial(){return this._materials[Qs.LineWireframe]==null&&(this._materials[Qs.LineWireframe]=new YM({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._materials[Qs.LineWireframe])),this._materials[Qs.LineWireframe]}get _wireframeRingMaterial(){return this._materials[Qs.RingWireframe]==null&&(this._materials[Qs.RingWireframe]=new YM({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._materials[Qs.RingWireframe])),this._materials[Qs.RingWireframe]}get _markerMaterial(){return this._materials[Qs.Marker]==null&&this.symbolLayer.marker!=null&&(this._materials[Qs.Marker]=new sMt({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:h_e(this.symbolLayer.marker.style)}),this._context.stage.add(this._materials[Qs.Marker])),this._materials[Qs.Marker]}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0}_getDrivenSize(e){return this._drivenProperties.size&&e.size?mr(Jbt(e.size)):1}_getDrivenColor(e){const i=ri(1,1,1,1);return this._drivenProperties.color&&e.color&&(i[0]=e.color[0],i[1]=e.color[1],i[2]=e.color[2],e.color.length>0&&(i[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(i[3]=e.opacity),i}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,fMt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,r,i.uid)}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables")return mn.RecreateSymbol;{const s=this._fastUpdates;if(!HP(s,i,d_e))return mn.RecreateSymbol;this._forEachMaterial(n=>n==null?void 0:n.setParameters(s.materialParameters))}}return mn.FastUpdate}prepareSymbolLayerPatch(e){var n,o;if(e.diff.type!=="partial")return;const i=e.diff.diff,r={};((n=i.size)==null?void 0:n.type)==="complete"&&(r.width=this._computeMaterialWidth(i.size.newValue),delete i.size),((o=i.cap)==null?void 0:o.type)==="complete"&&(r.cap=uee(i.cap.newValue??"butt"),delete i.cap);const s=this._prepareMarkerPatch(e,i);this._prepareMaterialPatch(e,i,s),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a==null?void 0:a.setParameters(r)))}layerOpacityChanged(){this._forEachMaterial((e,i)=>this._updateMaterialLayerOpacity(e,i===Qs.Marker))}_forEachMaterial(e){this._materials.forEach(e)}_updateMaterialLayerOpacity(e,i=!1){var a,l;if(e==null)return;const r=e.parameters.color,s=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,n=this._patternHidesLine&&!i?0:this._getCombinedOpacity(s),o=ri(r[0],r[1],r[2],n);e.setParameters({color:o})}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=wN(U5e.elevationModeChangeTypes,r,s);if(n!==Hs.UPDATE)return n;const o=_p(s);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(i=>i==null?void 0:i.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){const s=p_e(e.graphic.geometry),n=s.type==="polygon"?s.rings:s.paths,o=new Array,a=io(),l=tMt(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),c=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(l,n,c,"LineSymbol3DLayer");for(let f=0;f<l.lines.length;f++){const m=l.lines[f],g=m.position,y=m.mapPositions;if(this._context.clippingExtent!=null&&(Qr(a),Uh(a,y),!Gf(a,this._context.clippingExtent)))continue;const v=this._createGeometry(s.type==="polygon"?this._ringMaterial:this._lineMaterial,e,g,y,s.type,tL.ELEVATED,r);o.push(v),kr.LINE_WIREFRAMES&&o.push(v.instantiate({material:s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),this._markerMaterial!=null&&o.push(v.instantiate({material:this._markerMaterial}))}if(o.length===0)return null;const u=new Ow({geometries:o,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),d=new Vy(this,u,o,null,null,j_t,i);return d.alignedSampledElevation=l.sampledElevation,d.needsElevationUpdates=_p(i.mode),d}_createGeometry(e,i,r,s,n,o,a){var y,v,b;const l=o===tL.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,c=n==="polygon",u=(y=this._fastUpdates)==null?void 0:y.visualVariables.color,d=(v=this._fastUpdates)==null?void 0:v.visualVariables.size,f=(b=this._fastUpdates)==null?void 0:b.visualVariables.opacity,m=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),g={position:r,size:d?null:this._getDrivenSize(i.renderingInfo),color:u?null:this._getDrivenColor(i.renderingInfo),sizeFeature:d?em(d.field,i.graphic):null,colorFeature:u?em(u.field,i.graphic):null,opacityFeature:f?em(f.field,i.graphic):null};return hee(e,{overlayInfo:l,removeDuplicateStartEnd:c,mapPositions:s,attributeData:g},m)}_createAsOverlay(e,i){const r=e.graphic,s=p_e(r.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=kr.LINE_WIREFRAMES?s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;a!=null&&(a.renderPriority=this._renderPriority-.001),l!=null&&(l.renderPriority=this._renderPriority-.002);const c=new Array,u=io(),d=Qr(),f=iMt(s,this._context.overlaySR),m=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,n,m,"LineSymbol3DLayer");for(const g of f.lines){if(Qr(u),Uh(u,g.position),!Gf(u,this._context.clippingExtent))continue;NP(d,u);const y=v=>{const b=this._createGeometry(v,e,g.position,void 0,s.type,tL.DRAPED,r.uid),w=new KP(b,{layerUid:i,graphicUid:r.uid});c.push(w)};if(l!=null){y(l);const v=this.symbolLayer.marker.placement;v!=="begin"&&v!=="begin-end"||Uh(u,g.position,0,1),v!=="end"&&v!=="begin-end"||Uh(u,g.position,g.position.length-3,1)}y(o),kr.LINE_WIREFRAMES&&y(a)}return new C8(this,c,d,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return e!=null&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){var i;return e=e??bo(1),this._drivenProperties.size?(i=this._fastUpdates)!=null&&i.visualVariables.size?mr(1):1:mr(e)}_prepareMaterialPatch(e,i,r){var a,l;const s=i.material;if(s==null)return void(r.changed&&r.useMaterialColor&&c5(this._getCombinedOpacityAndColor(this._materialColor),this._materials[Qs.Marker],e));if(s.type==="collection")return;const n=s.type==="complete"?(a=s.newValue)==null?void 0:a.color:((l=s.diff.color)==null?void 0:l.type)==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);r.useMaterialColor&&c5(QD(o),this._materials[Qs.Marker],e),this._patternHidesLine&&(o[3]=0),c5(o,this._materials[Qs.Line],e),delete i.material}_prepareMarkerPatch(e,i){var u;const r=i.marker,s=this._markerMaterial;if(r==null||r.type!=="partial"||r.diff==null||r.diff.placement!=null||r.diff.style!=null&&r.diff.style.type!=="complete"||r.diff.color!=null&&r.diff.color.type!=="complete"||s==null)return{changed:!1,useMaterialColor:this._markerColor==null};const n=r.diff.color,o=n!=null,a=o?n.newValue:null,l=a==null&&this._markerColor==null;a&&c5(this._getCombinedOpacityAndColor(a),s,e);const c=(u=r.diff.style)==null?void 0:u.newValue;return c&&e.symbolLayerStatePatches.push(()=>s.setParameters({markerPrimitive:h_e(c)})),delete i.marker,{changed:o,useMaterialColor:l}}};function p_e(t){switch(t.type){case"extent":if(t instanceof dr)return cm.fromExtent(t);break;case"polygon":case"polyline":return t}return null}function c5(t,e,i){e!=null&&i.symbolLayerStatePatches.push(()=>e.setParameters({color:t}))}var tL,Qs;k5e.elevationModeChangeTypes={definedChanged:Hs.RECREATE,staysOnTheGround:Hs.NONE,onTheGroundChanged:Hs.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(tL||(tL={})),function(t){t[t.Line=0]="Line",t[t.Ring=1]="Ring",t[t.LineWireframe=2]="LineWireframe",t[t.RingWireframe=3]="RingWireframe",t[t.Marker=4]="Marker"}(Qs||(Qs={}));let U$=null,wj=!0;function t7(t,e,i){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(wj)try{return new ImageData(t,e)}catch{wj=!1}return V5e(t,e,i)}function mMt(t,e,i,r){if(!e||!i)throw new Error("Cannot construct image data without dimensions");if(wj)try{return new ImageData(t,e,i)}catch{wj=!1}const s=V5e(e,i,r);return s.data.set(t,0),s}function gMt(){return U$||(U$=document.createElement("canvas"),U$.width=1,U$.height=1),U$}function V5e(t,e,i){return i||(i=gMt()),i.getContext("2d").createImageData(t,e)}async function yMt(t,e){const i=window.URL.createObjectURL(t);try{const{data:r}=await fr(i,{...e,responseType:"image"});return r}catch(r){throw us(r)?r:new B("invalid-image",`Could not fetch requested image at ${i}`)}finally{window.URL.revokeObjectURL(i)}}async function woi(t,e){const{arrayBuffer:i,mediaType:r}=await _Mt(t,e),s=r==="image/png";if(r==="image/gif"){const{isAnimatedGIF:n,parseGif:o}=await oe(()=>import("./gif-biZ8o911.js"),[]);if(n(i))return o(i,e)}if(s){const{isAnimatedPNG:n,parseApng:o}=await oe(()=>import("./apng-DnZ99wit.js"),[]);if(n(i))return o(i,e)}return yMt(new Blob([i],{type:r}),e)}async function _Mt(t,e){var s;const i=Fb(t);if(i!=null&&i.isBase64)return{arrayBuffer:MEe(i.data),mediaType:i.mediaType};const r=await fr(t,{responseType:"array-buffer",...e});return{arrayBuffer:r.data,mediaType:((s=r.getHeader)==null?void 0:s.call(r,"Content-Type"))??""}}var KC;const i7=new WeakMap;let vMt=0,cg=KC=class extends Se{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,i,r){if(t instanceof HTMLImageElement){const s={type:"image-element",src:u2(t.src,r),crossOrigin:t.crossOrigin};e[i]=s}else if(t instanceof HTMLCanvasElement){const s={type:"canvas-element",imageData:f_e(t.getContext("2d").getImageData(0,0,t.width,t.height))};e[i]=s}else if(t instanceof HTMLVideoElement){const s={type:"video-element",src:u2(t.src,r),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[i]=s}else if(t instanceof ImageData){const s={type:"image-data",imageData:f_e(t)};e[i]=s}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=m_e(t.imageData),i=document.createElement("canvas");return i.width=e.width,i.height=e.height,i.getContext("2d").putImageData(e,0,0),i}case"image-data":return m_e(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return g_e(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return g_e(t);if(e){const i=e.substr(e.length-4,4).toLowerCase(),r=e.substr(0,15).toLocaleLowerCase();if(i===".png"||r==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(i="")=>`d:${i},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(i7.has(this.data)||i7.set(this.data,++vMt),e(i7.get(this.data))):e()}get memoryUsage(){let t=0;if(t+=this.url!=null?this.url.length:0,this.data!=null){const e=this.data;"data"in e?t+=e.data.byteLength:e instanceof HTMLImageElement?t+=e.naturalWidth*e.naturalHeight*3:e instanceof HTMLCanvasElement&&(t+=e.width*e.height*3)}return t}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new KC(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const i=this.clone();return t.set(this,i),i}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}static from(t){return typeof t=="string"?new KC({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new KC({data:t}):i2(KC,t)}};function f_e(t){let e="";for(let i=0;i<t.data.length;i++)e+=String.fromCharCode(t.data[i]);return{data:btoa(e),width:t.width,height:t.height}}function m_e(t){const e=atob(t.data),i=new Uint8ClampedArray(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return mMt(i,t.width,t.height)}function g_e(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}h([p({type:String,json:{write:Vb}})],cg.prototype,"url",null),h([p({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),p()],cg.prototype,"data",null),h([Ze("data")],cg.prototype,"writeData",null),h([ze("data")],cg.prototype,"readData",null),h([p({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],cg.prototype,"transparent",null),h([p({json:{write:!0}})],cg.prototype,"wrap",void 0),h([p({readOnly:!0})],cg.prototype,"contentHash",null),cg=KC=h([I("esri.geometry.support.MeshTexture")],cg);const iL=cg;let eM=class extends ts(Se){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};h([p({type:[Number],nonNullable:!0,json:{write:!0}})],eM.prototype,"offset",void 0),h([p({type:Number,nonNullable:!0,json:{write:!0}})],eM.prototype,"rotation",void 0),h([p({type:[Number],nonNullable:!0,json:{write:!0}})],eM.prototype,"scale",void 0),eM=h([I("esri.geometry.support.MeshTextureTransform")],eM);const HA=eM;var dee;let nf=dee=class extends Se{constructor(t){super(t),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=t!=null?t.get(this):null;if(i)return i;const r=new dee(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,r),r}clonePropertiesWithDeduplication(t){var e,i,r,s;return{color:this.color!=null?this.color.clone():null,colorTexture:(e=this.colorTexture)==null?void 0:e.cloneWithDeduplication(t),normalTexture:(i=this.normalTexture)==null?void 0:i.cloneWithDeduplication(t),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:(r=this.colorTextureTransform)==null?void 0:r.clone(),normalTextureTransform:(s=this.normalTextureTransform)==null?void 0:s.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let t=0;return t+=this.color!=null?16:0,this.colorTexture!=null&&(t+=this.colorTexture.memoryUsage),t+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(t+=this.normalTexture.memoryUsage),t+=this.normalTextureTransform!=null?20:0,t}};h([p({type:je,json:{write:!0}})],nf.prototype,"color",void 0),h([p({type:iL,json:{write:!0}})],nf.prototype,"colorTexture",void 0),h([p({type:HA,json:{write:!0}})],nf.prototype,"colorTextureTransform",void 0),h([p({type:iL,json:{write:!0}})],nf.prototype,"normalTexture",void 0),h([p({type:HA,json:{write:!0}})],nf.prototype,"normalTextureTransform",void 0),h([p({nonNullable:!0,json:{write:!0}})],nf.prototype,"alphaMode",void 0),h([p({nonNullable:!0,json:{write:!0}})],nf.prototype,"alphaCutoff",void 0),h([p({nonNullable:!0,json:{write:!0}})],nf.prototype,"doubleSided",void 0),nf=dee=h([I("esri.geometry.support.MeshMaterial")],nf);const Zae=nf;var pee;let Pd=pee=class extends Zae{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=t!=null?t.get(this):null;if(i)return i;const r=new pee(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,r),r}getMemoryUsage(){let t=super.getMemoryUsage();return t+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(t+=this.emissiveTexture.memoryUsage),t+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(t+=this.occlusionTexture.memoryUsage),t+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=this.metallicRoughnessTextureTransform!=null?20:0,t}clonePropertiesWithDeduplication(t){var e,i,r,s,n,o,a;return{...super.clonePropertiesWithDeduplication(t),emissiveColor:(e=this.emissiveColor)==null?void 0:e.clone(),emissiveTexture:(i=this.emissiveTexture)==null?void 0:i.cloneWithDeduplication(t),emissiveTextureTransform:(r=this.emissiveTextureTransform)==null?void 0:r.clone(),occlusionTexture:(s=this.occlusionTexture)==null?void 0:s.cloneWithDeduplication(t),occlusionTextureTransform:(n=this.occlusionTextureTransform)==null?void 0:n.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:(o=this.metallicRoughnessTexture)==null?void 0:o.cloneWithDeduplication(t),metallicRoughnessTextureTransform:(a=this.metallicRoughnessTextureTransform)==null?void 0:a.clone()}}};h([p({type:je,json:{write:!0}})],Pd.prototype,"emissiveColor",void 0),h([p({type:iL,json:{write:!0}})],Pd.prototype,"emissiveTexture",void 0),h([p({type:HA,json:{write:!0}})],Pd.prototype,"emissiveTextureTransform",void 0),h([p({type:iL,json:{write:!0}})],Pd.prototype,"occlusionTexture",void 0),h([p({type:HA,json:{write:!0}})],Pd.prototype,"occlusionTextureTransform",void 0),h([p({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Pd.prototype,"metallic",void 0),h([p({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Pd.prototype,"roughness",void 0),h([p({type:iL,json:{write:!0}})],Pd.prototype,"metallicRoughnessTexture",void 0),h([p({type:HA,json:{write:!0}})],Pd.prototype,"metallicRoughnessTextureTransform",void 0),Pd=pee=h([I("esri.geometry.support.MeshMaterialMetallicRoughness")],Pd);const z5e=Pd;var aV;let fd=aV=class extends Se{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return tM(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},ne.getLogger(this))}castPosition(t){return t&&t instanceof Float32Array&&ne.getLogger(this).warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),tM(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},ne.getLogger(this))}castUv(t){return tM(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},ne.getLogger(this))}castNormal(t){return tM(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},ne.getLogger(this))}castTangent(t){return tM(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},ne.getLogger(this))}clone(){const t={position:re(this.position),uv:re(this.uv),normal:re(this.normal),tangent:re(this.tangent),color:re(this.color)};return new aV(t)}clonePositional(){const t={position:re(this.position),normal:re(this.normal),tangent:re(this.tangent),uv:this.uv,color:this.color};return new aV(t)}get memoryUsage(){let t=0;return t+=this.position.byteLength,this.uv!=null&&(t+=this.uv.byteLength),this.normal!=null&&(t+=this.normal.byteLength),this.tangent!=null&&(t+=this.tangent.byteLength),this.color!=null&&(t+=this.color.byteLength),t}};function r7(t,e,i,r){const{loggerTag:s,stride:n}=e;return t.length%n!=0?(r.error(s,`Invalid array length, expected a multiple of ${n}`),new i([])):t}function tM(t,e,i,r,s){if(!t)return t;if(t instanceof e)return r7(t,r,e,s);for(const n of i)if(t instanceof n)return r7(new e(t),r,e,s);if(Array.isArray(t))return r7(new e(t),r,e,s);{const n=i.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${t.constructor.name}`),new e([])}}function V$(t,e,i){e[i]=bMt(t)}function bMt(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[i]=t[i];return e}h([p({json:{write:V$}})],fd.prototype,"color",void 0),h([Qt("color")],fd.prototype,"castColor",null),h([p({nonNullable:!0,json:{write:V$}})],fd.prototype,"position",void 0),h([Qt("position")],fd.prototype,"castPosition",null),h([p({json:{write:V$}})],fd.prototype,"uv",void 0),h([Qt("uv")],fd.prototype,"castUv",null),h([p({json:{write:V$}})],fd.prototype,"normal",void 0),h([Qt("normal")],fd.prototype,"castNormal",null),h([p({json:{write:V$}})],fd.prototype,"tangent",void 0),h([Qt("tangent")],fd.prototype,"castTangent",null),fd=aV=h([I("esri.geometry.support.MeshVertexAttributes")],fd);var kI;let ug=kI=class extends Se{static from(t){return i2(kI,t)}constructor(t){super(t),this.faces=null,this.material=null,this.name=void 0,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return tM(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},ne.getLogger(this))}castMaterial(t){return i2(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?z5e:Zae,t)}clone(){return new kI({faces:re(this.faces),shading:this.shading,material:re(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(t,e){const i={faces:re(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new kI(i)}get memoryUsage(){let t=0;return this.faces!=null&&(t+=this.faces.byteLength),this.material!=null&&(t+=this.material.memoryUsage),t}};h([p({json:{write:!0}})],ug.prototype,"faces",void 0),h([Qt("faces")],ug.prototype,"castFaces",null),h([p({type:Zae,json:{write:!0}})],ug.prototype,"material",void 0),h([Qt("material")],ug.prototype,"castMaterial",null),h([p()],ug.prototype,"name",void 0),h([p({type:String,json:{write:!0}})],ug.prototype,"shading",void 0),h([p({type:Boolean})],ug.prototype,"trustSourceNormals",void 0),ug=kI=h([I("esri.geometry.support.MeshComponent")],ug);const wMt=ug;let UI=class extends ts(Se){constructor(e){super(e),this.type="georeferenced",this.origin=null}};h([$t({georeferenced:"georeferenced"},{readOnly:!0})],UI.prototype,"type",void 0),h([p({type:[Number],nonNullable:!1,json:{write:!0}})],UI.prototype,"origin",void 0),UI=h([I("esri.geometry.support.MeshGeoreferencedVertexSpace")],UI);const xMt=UI;let VI=class extends ts(Se){constructor(e){super(e),this.type="local",this.origin=C()}};h([$t({local:"local"},{readOnly:!0})],VI.prototype,"type",void 0),h([p({type:[Number],nonNullable:!0,json:{write:!0}})],VI.prototype,"origin",void 0),VI=h([I("esri.geometry.support.MeshLocalVertexSpace")],VI);const TMt=VI;function y_e(){return ne.getLogger("esri.geometry.Mesh")}function SMt(t){return!M8(t)}function M8(t){return t.origin!=null}function Eoi(t){return M8(t.vertexSpace)}function Coi(t,e){if(!M8(t))return null;const[i,r,s]=t.origin;return new wt({x:i,y:r,z:s,spatialReference:e})}function Moi(t,e){const{x:i,y:r,z:s,spatialReference:n}=t,o=[i,r,s??0];return(e==null?void 0:e.geographic)!==void 0&&(Nb(y_e(),"option: geographic",{replacement:"Use the `vertexSpace` option instead.",version:"4.29",warnOnce:!0}),e.vertexSpace&&y_e().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")),((e==null?void 0:e.vertexSpace)??CMt(e==null?void 0:e.geographic)??EMt(n))==="local"?new TMt({origin:o}):new xMt({origin:o})}function EMt(t){return t.isGeographic||t.isWebMercator?"local":"georeferenced"}function CMt(t){return t==null?void 0:t?"local":"georeferenced"}function Aoi(t,e){return t.type===e.type&&(t.origin===e.origin||t.origin!=null&&e.origin!=null&&Uo(t.origin,e.origin))}const MMt=()=>ne.getLogger("esri.views.3d.support.buffer.math");function AMt(t,e,i){if(t.count!==e.count)return;const r=t.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],u=i[6],d=i[7],f=i[8],m=i[9],g=i[10],y=i[11],v=i[12],b=i[13],w=i[14],x=i[15],T=t.typedBuffer,E=t.typedBufferStride,M=e.typedBuffer,O=e.typedBufferStride;for(let D=0;D<r;D++){const U=D*E,k=D*O,H=M[k],V=M[k+1],X=M[k+2],q=M[k+3];T[U]=s*H+l*V+f*X+v*q,T[U+1]=n*H+c*V+m*X+b*q,T[U+2]=o*H+u*V+g*X+w*q,T[U+3]=a*H+d*V+y*X+x*q}}function PMt(t,e,i,r=4,s=r){if(t.length/r!=e.length/s)return void MMt().error("source and destination buffers need to have the same number of elements");const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],u=i[4],d=i[5],f=i[6],m=i[7],g=i[8],y=i[9],v=i[10],b=i[11],w=i[12],x=i[13],T=i[14],E=i[15];let M=0,O=0;for(let D=0;D<n;D++){const U=e[M],k=e[M+1],H=e[M+2],V=e[M+3];t[O]=o*U+u*k+g*H+w*V,t[O+1]=a*U+d*k+y*H+x*V,t[O+2]=l*U+f*k+v*H+T*V,t[O+3]=c*U+m*k+b*H+E*V,M+=s,O+=r}}function OMt(t,e,i){A8(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function A8(t,e,i,r=4,s=r){if(t.length/r!=e.length/s)return;const n=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],u=i[4],d=i[5],f=i[6],m=i[7],g=i[8];let y=0,v=0;for(let b=0;b<n;b++){const w=e[y],x=e[y+1],T=e[y+2],E=e[y+3];t[v]=o*w+c*x+f*T,t[v+1]=a*w+u*x+m*T,t[v+2]=l*w+d*x+g*T,t[v+3]=E,y+=s,v+=r}}function $Mt(t,e){const i=Math.min(t.count,e.count),r=t.typedBuffer,s=t.typedBufferStride,n=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,u=n[c],d=n[c+1],f=n[c+2],m=u*u+d*d+f*f;if(m>0){const g=1/Math.sqrt(m);r[l]=g*u,r[l+1]=g*d,r[l+2]=g*f}}}function RMt(t,e,i){xj(t.typedBuffer,e,i,t.typedBufferStride)}function xj(t,e,i,r=4){const s=Math.min(t.length/r,e.count),n=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<s;c++)t[l]=i*n[a],t[l+1]=i*n[a+1],t[l+2]=i*n[a+2],t[l+3]=i*n[a+3],a+=o,l+=r}Object.freeze(Object.defineProperty({__proto__:null,normalize:$Mt,scale:xj,scaleView:RMt,transformMat3:A8,transformMat3View:OMt,transformMat4:PMt,transformMat4View:AMt},Symbol.toStringTag,{value:"Module"}));const IMt="Projection may be possible after calling projection.load().";function LMt(t,e,i,r){t.error(`Failed to project from (wkid:${e.wkid}) to (wkid:${i.wkid}).${r?" ":""}${r}`)}function B5e(t,e,i,r,s){return P8(N_.TO_PCPF,_o.fromTypedArray(t),_l.NORMAL,yp.fromTypedArray(e),yp.fromTypedArray(i),r,_o.fromTypedArray(s))?s:null}function DMt(t,e,i,r,s){return P8(N_.FROM_PCPF,_o.fromTypedArray(t),_l.NORMAL,yp.fromTypedArray(e),yp.fromTypedArray(i),r,_o.fromTypedArray(s))?s:null}function NMt(t,e,i){return gs(t,e,0,i,id(e),0,t.length/3)?i:null}function FMt(t,e,i){return gs(t,id(i),0,e,i,0,t.length/3)?e:null}function fee(t,e,i){return Yb(lo,i),h8(e,t,lo),qz(lo)&&JP(e,e),e}function mee(t,e,i){return wp(lo,i),A8(e,t,lo),qz(lo)&&JP(e,e,4),e}function gee(t,e,i,r){const s=e===_l.NORMAL;return j5e(t,e,i,(n,o)=>{const a=Math.cos(kt(n));o[0]=s?a:1/a,o[1]=1},r)}function yee(t,e,i,r){const s=e===_l.NORMAL;return j5e(t,e,i,(n,o)=>{const a=Math.cosh(-n/ur.radius);o[0]=1,o[1]=s?a:1/a},r)}function j5e(t,e,i,r,s){const n=e===_l.NORMAL?3:4,o=[0,0];for(let a=0,l=1;a<t.length;a+=n,l+=3){r(i[l],o);const c=t[a]*o[0],u=t[a+1]*o[1],d=t[a+2],f=1/Math.sqrt(c*c+u*u+d*d);s[a]=c*f,s[a+1]=u*f,s[a+2]=d*f,n===4&&(s[a+3]=t[a+3])}return s}function G5e(t,e,i,r,s){if(!P8(N_.TO_PCPF,_o.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),_l.TANGENT,yp.fromTypedArray(e),yp.fromTypedArray(i),r,_o.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT)))return null;for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}function kMt(t,e,i,r,s){if(!P8(N_.FROM_PCPF,_o.fromTypedArray(t,16),_l.TANGENT,yp.fromTypedArray(e),yp.fromTypedArray(i),r,_o.fromTypedArray(s,16)))return null;for(let n=3;n<t.length;n+=4)s[n]=t[n];return s}var _l,N_;function __e(t,e,i,r,s){switch(Gh(r,i,i_,r),t===N_.FROM_PCPF&&eo(i_,i_),e){case _l.NORMAL:return Yb(s,i_);case _l.TANGENT:return wp(s,i_)}}function P8(t,e,i,r,s,n,o){if(!e)return;const a=r.count,l=id(n);if(zMt(n))for(let c=0;c<a;c++)s.getVec(c,u5),e.getVec(c,Dm),ca(Dm,Dm,__e(t,i,u5,l,lo)),o.setVec(c,Dm);else for(let c=0;c<a;c++){s.getVec(c,u5),e.getVec(c,Dm);const u=Uz(r.get(c,1));let d=Math.cos(u);i===_l.TANGENT!=(t===N_.TO_PCPF)&&(d=1/d),__e(t,i,u5,l,lo),t===N_.TO_PCPF?(lo[0]*=d,lo[1]*=d,lo[2]*=d,lo[3]*=d,lo[4]*=d,lo[5]*=d):(lo[0]*=d,lo[3]*=d,lo[6]*=d,lo[1]*=d,lo[4]*=d,lo[7]*=d),ca(Dm,Dm,lo),Ce(Dm,Dm),o.setVec(c,Dm)}return o}function H5e(t){return t.vertexSpace.type==="local"?UMt(t):VMt(t)}function UMt({vertexSpace:t,transform:e,inSpatialReference:i,outSpatialReference:r,localMode:s,outPositions:n,positions:o}){const a=t.origin??Nn,l=t.origin!=null?(e==null?void 0:e.localMatrix)??Jr:Jr,c=id(i),u=r.isWebMercator&&s||!Kc(i,c)?i:c;Gh(i,a,i_,u),vr(i_,i_,l);const d=n??go(o.length);return lw(d,o,i_),gs(d,u,0,d,r,0,d.length/3),d}function VMt({vertexSpace:t,transform:e,outPositions:i,positions:r,inSpatialReference:s,outSpatialReference:n}){const o=t.origin!=null?(e==null?void 0:e.localMatrix)??Jr:Jr,a=i??go(r.length);LG(o,Jr)?ept(a,r):lw(a,r,o);const l=t.origin??Nn;if(!Uo(l,Nn)){const[c,u,d]=l;for(let f=0;f<a.length;f+=3)a[f]+=c,a[f+1]+=u,a[f+2]+=d}return gs(a,s,0,a,n,0,a.length/3)?a:null}function zMt(t){return t.isWGS84||oP(t)||U2(t)||V2(t)}(function(t){t[t.NORMAL=0]="NORMAL",t[t.TANGENT=1]="TANGENT"})(_l||(_l={})),function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"}(N_||(N_={}));const u5=C(),Dm=C(),i_=ke(),lo=Kr(),Poi=Object.freeze(Object.defineProperty({__proto__:null,get VectorType(){return _l},loadProjectErrorMessage:IMt,logProjectionError:LMt,project:H5e,projectFromPCPF:FMt,projectNormalFromPCPF:DMt,projectNormalToPCPF:B5e,projectTangentFromPCPF:kMt,projectTangentToPCPF:G5e,projectToPCPF:NMt,transformNormal:fee,transformTangent:mee,transformVectorENUPlateCarree:gee,transformVectorWMPlateCarree:yee},Symbol.toStringTag,{value:"Module"}));var wg;(function(t){t[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(wg||(wg={}));let q5e=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=g_.KTX2_ENCODING}};function rL(t){return(t==null?void 0:t.type)==="encoded-mesh-texture"}async function BMt(t){const e=new Blob([t]),i=await e.text();return JSON.parse(i)}async function jMt(t,e){if(e===g_.KTX2_ENCODING)return new q5e(t);const i=new Blob([t],{type:e}),r=URL.createObjectURL(i),s=new Image;if(ue("esri-iPhone"))return new Promise((n,o)=>{const a=()=>{c(),n(s)},l=u=>{c(),o(u)},c=()=>{URL.revokeObjectURL(r),s.removeEventListener("load",a),s.removeEventListener("error",l)};s.addEventListener("load",a),s.addEventListener("error",l),s.src=r});try{s.src=r,await s.decode()}catch{console.warn("Failed decoding HTMLImageElement")}return URL.revokeObjectURL(r),s}function Vg(t){if(t==null)return null;const e=t.offset!=null?t.offset:DNe,i=t.rotation!=null?t.rotation:0,r=t.scale!=null?t.scale:NNe,s=P3(1,0,0,0,1,0,e[0],e[1],1),n=P3(Math.cos(i),-Math.sin(i),0,Math.sin(i),Math.cos(i),0,0,0,1),o=P3(r[0],0,0,0,r[1],0,0,0,1),a=Kr();return AP(a,n,o),AP(a,s,a),a}const GMt={disableDelayMs:2e3};let HMt=class extends Vy{constructor(){super(...arguments),this.fastTransformUpdatesAllowed=!1,this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1,this._autoDisableFastUpdatesTimeoutId=0}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}destroy(){super.destroy(),this._cancelAutoDisableFastUpdates()}enableFastTransformUpdates(e,i){if(!this.fastTransformUpdatesAllowed||this._fastTransformUpdatesEnabled)return;this._cancelAutoDisableFastUpdates(),this._fastTransformUpdatesEnabled=!0;const{stageObject:r}=this,s=r.geometries.slice();r.removeAllGeometries();const n=Wz(s7,r.transformation),o=i.getOrigin(n);for(const a of s){const l=e(a.material),c=a.instantiate({material:l});c.localOrigin=o,r.addGeometry(c)}this._originalGeometries=s}autoDisableFastTransformUpdates(e){this._cancelAutoDisableFastUpdates(),this._autoDisableFastUpdatesTimeoutId=setTimeout(()=>{this._autoDisableFastUpdatesTimeoutId=0,e()},GMt.disableDelayMs)}updateAutoDisableFastTransformUpdates(e){this._autoDisableFastUpdatesTimeoutId&&this.autoDisableFastTransformUpdates(e)}_cancelAutoDisableFastUpdates(){clearTimeout(this._autoDisableFastUpdatesTimeoutId),this._autoDisableFastUpdatesTimeoutId=0}disableFastTransformUpdates(e){if(!this._fastTransformUpdatesEnabled)return;this._cancelAutoDisableFastUpdates(),this._fastTransformUpdatesEnabled=!1;const{stageObject:i}=this,r=i.geometries.map(s=>e(s.material));i.removeAllGeometries();for(let s=0;s<this._originalGeometries.length;s++){const n=this._originalGeometries[s],o=r[s];o.setParameters({modelTransformation:null}),o===n.material?i.addGeometry(n):i.addGeometry(n.instantiate({material:o}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,i,r){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:s}=this;if(s.geometries.length===0)return;const n=s.geometries[0].localOrigin,o=Wz(s7,e),a=r.getOrigin(o);if(a===n)return;const l=(i==null?void 0:i.localMatrix)??Jr;s.shaderTransformation=null,s.transformation=e,s.geometries.forEach(c=>{c.transformation=l,c.localOrigin=a})}updateTransform(e,i,r){const{stageObject:s}=this,n=(i==null?void 0:i.localMatrix)??Jr;if(!this._fastTransformUpdatesEnabled)return s.shaderTransformation=null,s.transformation=e,s.geometries.forEach(m=>m.transformation=n),void this._updateEdgeTransform(r);const o=s.transformation,a=s.geometries[0].transformation,l=e,c=n,u=vr(v_e,o,a),d=vr(b_e,l,c),f=vr(w_e,d,eo(w_e,a));s.shaderTransformation=f,this._setFastMaterialTransformation({matA:u,matB:d}),this._updateEdgeTransform(r)}alignWithElevation(e,i,r,s){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(e,i,r,s);r!=null&&s8(this.elevationContext.featureExpressionInfoContext,r);const n=(g,y)=>nw(g,e,this.elevationContext,i,y),{stageObject:o}=this;if(!o.geometries[0].material.parameters.modelTransformation)return;const a=o.transformation,l=o.geometries[0].transformation,c=vr(v_e,a,l),u=o.effectiveTransformation,d=An(qMt,u);this.alignedSampledElevation=jS(this,this.elevationContext,e.spatialReference,n,i,d),o.shaderTransformation=d;const f=o.geometries[0].transformation,m=vr(b_e,d,f);this._setFastMaterialTransformation({matA:c,matB:m}),this._updateEdgeTransform(s)}_setFastMaterialTransformation({matA:e,matB:i}){const{stageObject:r}=this;if(r.geometries.length===0)return;const s=r.geometries[0].localOrigin,n=z2(WMt,de(s7,s.vec3,-1)),o=vr(x_e,n,e),a=vr(T_e,n,i),l=eo(x_e,o),c=vr(T_e,a,l);for(const u of r.geometries)u.material.setParameters({modelTransformation:c})}_updateEdgeTransform(e){const{stageObject:i,_stageLayer:r}=this;r.stage.renderer.withEdgeView(s=>{s.fastUpdateObject3DEdgesTransform(i)||this.resetEdgeObject(e)})}};const s7=C(),v_e=ke(),b_e=ke(),qMt=ke(),w_e=ke(),x_e=ke(),T_e=ke(),WMt=ke();let ZMt=class{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(e,i,r){e.enableFastTransformUpdates(s=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(s))return s;const o=i.byMaterial(s);return this._fastTransformOriginalMaterials.set(s,o),i.delete(s),s}const n=new gm(s.parameters);return r.stage.add(n),this._fastTransformClonedMaterials.set(n,s),n},r.localOriginFactory)}disable(e,i,r){const s=new Set,n=new Set;e.disableFastTransformUpdates(o=>{if(!this._fastTransformClonedMaterials.has(o)){const c=o,u=this._fastTransformOriginalMaterials.get(c);return i.has(u.uid)?(s.add(c),i.byUid(u.uid).material):(n.add(c),u.material)}const a=o,l=this._fastTransformClonedMaterials.get(a);return this._fastTransformClonedMaterials.delete(a),r.stage.remove(a),l});for(const o of s)this._fastTransformOriginalMaterials.delete(o),r.stage.remove(o);for(const o of n){const a=this._fastTransformOriginalMaterials.get(o);this._fastTransformOriginalMaterials.delete(o),i.set(a.uid,a)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(e,i,r){this._graphicReferenceCount--,this.disable(e,i,r)}forEachMaterialInfo(e){this._fastTransformOriginalMaterials.forEach(e)}forEachClonedMaterial(e){this._fastTransformClonedMaterials.forEach(e)}destroy(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:i})=>i)),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}},YMt=class{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),e=>e.material)}byUid(e){return this._byUid.get(e)}byMaterial(e){return this._byMaterial.get(e)}set(e,i){this._byUid.set(e,i),this._byMaterial.set(i.material,i)}delete(e){var r;const i=(r=this._byMaterial.get(e))==null?void 0:r.uid;i&&(this._byUid.delete(i),this._byMaterial.delete(e))}has(e){return this._byUid.has(e)}forEachMaterialInfo(e){this._byUid.forEach(e)}clear(){this._byUid.clear(),this._byMaterial.clear()}};const XMt=Ds().vec3f($.POSITION),JMt=Ds().vec3f($.POSITION).vec2f($.UV0),QMt=Ds().vec3f($.POSITION).vec4u8($.COLOR),KMt=Ds().vec3f($.POSITION).vec2f($.UV0).vec4u8($.OBJECTANDLAYERIDCOLOR);function W5e(t){const e=new Hi,{vertex:i,fragment:r}=e;return e.include(gl,t),e.include(lE,t),Wc(i,t),e.attributes.add($.POSITION,"vec3"),e.varyings.add("vpos","vec3"),i.code.add(S`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);
}`),t.output===G.Highlight&&e.include(Mw,t),e.include(Mn,t),r.uniforms.add(new tt("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),t.hasVertexColors||r.uniforms.add(new ji("constantColor",s=>s.color)),r.code.add(S`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    ${t.output===G.ObjectAndLayerIdColor?S`color.a = 1.0;`:""}

    if (color.a < ${S.float(la)}) {
      discard;
    }

    ${t.output===G.Color?S`fragColor = highlightSlice(color, vpos);`:""}
    ${t.output===G.Highlight?S`outputHighlight();`:""}
  }
  `),e}const eAt=Object.freeze(Object.defineProperty({__proto__:null,build:W5e},Symbol.toStringTag,{value:"Module"}));let Z5e=class Y5e extends Ki{initializeProgram(e){return new er(e.rctx,Y5e.shader.get().build(this.configuration),Pi)}initializePipeline(){const e=this.configuration,i=_a(Be.SRC_ALPHA,Be.ONE,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),r=(s,n=null,o=null)=>Kt({blending:n,depthTest:sae,depthWrite:o,colorWrite:ui,stencilWrite:e.hasOccludees?Ty:null,stencilTest:e.hasOccludees?s?aw:Pw:null});return e.output===G.Color?(this._occludeePipelineState=r(!0,e.transparent?i:null,Wu),r(!1,e.transparent?i:null,Wu)):r(!1)}get primitiveType(){return Mi.LINES}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};Z5e.shader=new qi(eAt,()=>oe(()=>Promise.resolve().then(()=>L9t),void 0));let iM=class extends Xc{constructor(){super(...arguments),this.output=G.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.hasOccludees=!1}};h([j({count:G.COUNT})],iM.prototype,"output",void 0),h([j()],iM.prototype,"hasSlicePlane",void 0),h([j()],iM.prototype,"hasVertexColors",void 0),h([j()],iM.prototype,"transparent",void 0),h([j()],iM.prototype,"hasOccludees",void 0);let n7=class extends Cw{constructor(e){super(e,new iAt),this._configuration=new iM,this.produces=new Map([[Pe.OPAQUE_MATERIAL,i=>i===G.Color||i===G.Highlight||i===G.ObjectAndLayerIdColor]])}getConfiguration(e){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration}intersect(e,i,r,s,n,o){if(!r.options.selectionMode||!e.visible)return;if(!ZRe(i))return void ne.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes.get($.POSITION).data,l=r.camera,c=sAt;Ga(c,r.point);const u=2;pe(z$[0],c[0]-u,c[1]+u,0),pe(z$[1],c[0]+u,c[1]+u,0),pe(z$[2],c[0]+u,c[1]-u,0),pe(z$[3],c[0]-u,c[1]-u,0);for(let y=0;y<4;y++)if(!l.unprojectFromRenderScreen(z$[y],s0[y]))return;hl(l.eye,s0[0],s0[1],o7),hl(l.eye,s0[1],s0[2],a7),hl(l.eye,s0[2],s0[3],l7),hl(l.eye,s0[3],s0[0],c7);let d=Number.MAX_VALUE,f=0;for(let y=0;y<a.length-5;y+=3){if(vc[0]=a[y]+i[12],vc[1]=a[y+1]+i[13],vc[2]=a[y+2]+i[14],bc[0]=a[y+3]+i[12],bc[1]=a[y+4]+i[13],bc[2]=a[y+5]+i[14],Rr(o7,vc)<0&&Rr(o7,bc)<0||Rr(a7,vc)<0&&Rr(a7,bc)<0||Rr(l7,vc)<0&&Rr(l7,bc)<0||Rr(c7,vc)<0&&Rr(c7,bc)<0)continue;if(l.projectToRenderScreen(vc,lx),l.projectToRenderScreen(bc,cx),lx[2]<0&&cx[2]>0){$e(Nm,vc,bc);const b=l.frustum,w=-Rr(b[Er.NEAR],vc)/Te(Nm,b[Er.NEAR]);de(Nm,Nm,w),Ee(vc,vc,Nm),l.projectToRenderScreen(vc,lx)}else if(lx[2]>0&&cx[2]<0){$e(Nm,bc,vc);const b=l.frustum,w=-Rr(b[Er.NEAR],bc)/Te(Nm,b[Er.NEAR]);de(Nm,Nm,w),Ee(bc,bc,Nm),l.projectToRenderScreen(bc,cx)}else if(lx[2]<0&&cx[2]<0)continue;lx[2]=0,cx[2]=0;const v=Lse(kS(lx,cx,C_e),c);v<d&&(d=v,ve(S_e,vc),ve(E_e,bc),f=y/3)}const m=r.rayBegin,g=r.rayEnd;if(d<u*u){let y=Number.MAX_VALUE;if(iPe(kS(S_e,E_e,C_e),kS(m,g,rAt),ax)){$e(ax,ax,m);const v=Ve(ax);de(ax,ax,1/v),y=v/Ar(m,g)}o(y,ax,f,!1)}}intersectDraped(e,i,r,s,n,o){if(!r.options.selectionMode)return;const a=e.attributes.get($.POSITION).data,l=e.attributes.get($.SIZE),c=l?l.data[0]:0,u=s[0],d=s[1],f=((c+1)/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,g=0;for(let y=0;y<a.length-5;y+=3){const v=a[y],b=a[y+1],w=u-v,x=d-b,T=a[y+3]-v,E=a[y+4]-b,M=Ne((T*w+E*x)/(T*T+E*E),0,1),O=T*M-w,D=E*M-x,U=O*O+D*D;U<m&&(m=U,g=y/3)}m<f*f&&n(o.dist,o.normal,g,!1)}createGLMaterial(e){return new tAt(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?QMt:XMt;return new kO(e)}},tAt=class extends Sw{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===G.Color&&this._updateOccludeeState(e),this.ensureTechnique(Z5e,e)}},iAt=class extends Uoe{constructor(){super(...arguments),this.color=Kd,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.hasOccludees=!1}};const vc=C(),bc=C(),Nm=C(),ax=C(),lx=ka(),cx=ka(),S_e=C(),E_e=C(),C_e=_m(),rAt=_m(),sAt=C(),z$=[ka(),ka(),ka(),ka()],s0=[C(),C(),C(),C()],o7=rr(),a7=rr(),l7=rr(),c7=rr(),nAt=["mesh"];let oAt=class extends zy{constructor(e,i,r,s){super(e,i,r,s),this._materialInfoCache=new YMt,this._fastUpdateProcessor=new ZMt,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){kr.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new n7({color:[1,0,1,1]}),this._debugTangentNormalMaterial=new n7({color:[1,.5,0,1]}),this._debugFaceNormalMaterial=new n7({color:[0,1,1,1]}))}destroy(){super.destroy(),this._textures.forEach(e=>e.unload()),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}get materials(){return this._materialInfoCache.materials}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,nAt,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(i),s=e.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,i){const r=this._getLayerOpacity();this._updateMaterialParameters(s=>{s.material.setParameters({layerOpacity:r});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),e.forEach(s=>{var n;return(n=i(s))==null?void 0:n.layerOpacityChanged(r,this._context.isAsync)})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,ow)}slicePlaneEnabledChanged(e,i){return this._updateMaterialParameters(({material:r})=>{r.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(r=>{var s;return(s=i(r))==null?void 0:s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters(({material:i})=>i.setParameters({usePBR:e})),!0}updateTransform(e,i,r,s){if(!e.fastTransformUpdatesAllowed)return!1;const n=e.fastTransformUpdatesEnabled;switch(s){case wg.EnableFastUpdates:if(n)return!0;break;case wg.DisableFastUpdates:if(!n)return!0;break;default:if(!n)return!!this.updateTransform(e,i,r,wg.EnableFastUpdates)&&(e.autoDisableFastTransformUpdates(()=>this.updateTransform(e,i,r,wg.DisableFastUpdates)),!0)}const o=this._context.renderCoordsHelper.spatialReference,a=_At,{origin:l,transform:c}=r;if(!Gh(i,pe(ns,l.x,l.y,l.z??0),a,o))return!1;switch(s){case wg.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case wg.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case wg.UpdateFastLocalOrigin:e.updateFastLocalOrigin(a,c,this._context.localOriginFactory)}const{elevationContext:u}=e;u.centerPointInElevationSR=this._getCenterPointInElevationSR(a);const{elevationProvider:d,renderCoordsHelper:f}=this._context,m=(g,y)=>nw(g,d,u,f,y);return e.alignedSampledElevation=jS(e,u,d.spatialReference,m,f,a),e.updateTransform(a,c,this._context.isAsync),e.updateAutoDisableFastTransformUpdates(()=>this.updateTransform(e,i,r,wg.DisableFastUpdates)),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_materialPropertiesDefault(e,i){const r=this._requiresSymbolVertexColors(),s=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${i},svc:${r}`}}_materialProperties(e,i,r){const s=this._materialPropertiesDefault(e,r);if(!i.material)return s;const{color:n,colorTexture:o,colorTextureTransform:a,normalTexture:l,normalTextureTransform:c,doubleSided:u,alphaCutoff:d,alphaMode:f}=i.material,m=ux(n),g=ux(o),y=j$(a),v=ux(l),b=j$(c);if(s.color=n,s.colorTexture=o,s.normalTexture=l,s.uid=`${s.uid},cmuid:${m},ctmuid:${g},cttuid:${y},ntmuid:${v},nttuid:${b},ds:${u},ac:${d},am:${f}`,i.material instanceof z5e){const{metallic:w,roughness:x,metallicRoughnessTexture:T,metallicRoughnessTextureTransform:E,emissiveColor:M,emissiveTexture:O,emissiveTextureTransform:D,occlusionTexture:U,occlusionTextureTransform:k}=i.material,H=ux(T),V=j$(E),X=ux(M),q=ux(O),Z=j$(D),ye=ux(U),L=j$(k);s.metallic=w,s.roughness=x,s.metallicRoughnessTexture=T,s.emissiveColor=M,s.emissiveTexture=O,s.occlusionTexture=U,s.colorTextureTransform=B$(a),s.normalTextureTransform=B$(c),s.emissiveTextureTransform=B$(D),s.occlusionTextureTransform=B$(k),s.metallicRoughnessTextureTransform=B$(E),s.uid=`${s.uid},mrm:${w},mrr:${x},mrt:${H},mrtt:${V},emuid:${X},etmuid:${q},ett:${Z},otmuid:${ye},ott:${L}`}return s}_getInternalTextureId(e){const i=this._getInternalTexture(e,Ir.Opaque);return i==null?void 0:i.id}_getInternalTexture(e,i){const r=mAt(e);if(!r)return null;const s=`${e.contentHash}/${i}`;let n=this._textures.get(s);if(!n){let o=null;const a=this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy,l={wrap:dAt(e.wrap),noUnpackFlip:!0,maxAnisotropy:a,mipmap:a>1};rL(r)?(o=r.data,l.preMultiplyAlpha=!1,l.encoding=r.encoding):(o=r,l.preMultiplyAlpha=i!==Ir.Opaque,l.downsampleUncompressed=this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled),n=new cw(o,l),this._textures.set(s,n),n.load(this._context.stage.renderView.renderingContext),this._context.stage.add(n)}return n}_setInternalMaterialParameters(e,i){var s,n;if(e.color!=null&&fAt(e.color,i),e.colorTexture!=null){const o=this._getInternalTexture(e.colorTexture,i.textureAlphaMode);o?(i.textureId=o.id,i.textureAlphaPremultiplied=!!o.parameters.preMultiplyAlpha):i.textureId=void 0}e.normalTexture&&(i.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor&&(i.emissiveFactor=je.toUnitRGB(e.emissiveColor)),e.emissiveTexture&&(i.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture&&(i.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture&&(i.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),i.colorTextureTransformMatrix=Vg(e.colorTextureTransform),i.normalTextureTransformMatrix=Vg(e.normalTextureTransform);const r=((s=e.normalTextureTransform)==null?void 0:s.scale)!=null?(n=e.normalTextureTransform)==null?void 0:n.scale:YG;i.scale=[r[0],r[1]],i.occlusionTextureTransformMatrix=Vg(e.occlusionTextureTransform),i.emissiveTextureTransformMatrix=Vg(e.emissiveTextureTransform),i.metallicRoughnessTextureTransformMatrix=Vg(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){var s,n;const i=this._drivenProperties.color;let r=((s=this.symbolLayer.material)==null?void 0:s.colorMixMode)??null;if(i)e.externalColor=Kd;else{const o=((n=this.symbolLayer.material)==null?void 0:n.color)??null;o?e.externalColor=je.toUnitRGBA(o):(r=null,e.externalColor=Kd)}r&&(e.colorMixMode=r),e.castShadows=!!this.symbolLayer.castShadows}_getOrCreateMaterial(e,i){var g,y,v;const r=(g=i.material)==null?void 0:g.color,s=(y=i.material)==null?void 0:y.colorTexture,n=(v=i.material)==null?void 0:v.alphaMode,o=n==="blend",a=n!=="opaque"&&(pAt(e)||r!=null&&r.a<1||(s==null?void 0:s.transparent)||o),l=this._materialProperties(e,i,a),c=this._materialInfoCache.byUid(l.uid);if(c)return c.material;const u={uid:l.uid,material:null,isComponentTransparent:a,alphaMode:i.material?i.material.alphaMode:"opaque"},d=iNe({normalTexture:l.normalTexture,metallicRoughnessTexture:l.metallicRoughnessTexture,metallicFactor:l.metallic,roughnessFactor:l.roughness,emissiveTexture:l.emissiveTexture,emissiveFactor:je.toUnitRGB(l.emissiveColor),occlusionTexture:l.occlusionTexture}),f={usePBR:this._usePBR(),isSchematic:d,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:Nn,diffuse:o_,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Gr.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};f.mrrFactors=d?[...nae]:[l.metallic,l.roughness,a8[2]],i.material&&(f.doubleSided=i.material.doubleSided,f.cullFace=i.material.doubleSided?Gr.None:Gr.Back,f.textureAlphaCutoff=i.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,u),this._setInternalMaterialParameters(l,f);const m=new gm(f);return u.material=m,this._materialInfoCache.set(l.uid,u),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,i){e.transparent=this.needsDrivenTransparentPass||i.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,i.alphaMode==="auto"?e.textureAlphaMode=e.transparent?Ir.MaskBlend:Ir.Opaque:e.textureAlphaMode=i.alphaMode==="opaque"?Ir.Opaque:i.alphaMode==="mask"?Ir.Mask:Ir.Blend}_createFaceDebugNormals(e,i){const r=i.length,s=e.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(e.extent.width*s,e.extent.height*s,e.extent.zmax-e.extent.zmin),o=[],a=[],l=i[0].transformation,c=Yb(Kr(),l);for(let u=0;u<r;u++){const d=i[u].attributes.get($.POSITION);if(!d)continue;const f=d.data,m=d.indices;for(let g=0;g<m.length;g+=3)O8(f,m,g,$g),J5e(f,m,g,ns,Bd,eA),Ee(ns,ns,Bd),Ee(ns,ns,eA),de(ns,ns,1/3),nt(ns,ns,l),o.push(...ns),ca($g,$g,c),Ce($g,$g),Dn(ns,ns,$g,n),o.push(...ns),a.push(a.length),a.push(a.length)}return o.length?new Pn(this._debugFaceNormalMaterial,[[$.POSITION,new ht(o,a,3,!0)]],null,Gs.Line):null}_createPerVertexDebugVectors(e,i,r,s,n){const o=i.length,a=e.spatialReference.isGeographic?20015077/180:1,l=.1*n*Math.max(e.extent.width*a,e.extent.height*a,e.extent.zmax-e.extent.zmin),c=[],u=[],d=i[0].transformation,f=Yb(Kr(),d);r===$.TANGENT&&wp(f,d);for(let m=0;m<o;m++){const g=i[m],y=g.attributes.get($.POSITION),v=g.attributes.get(r);if(!y||!v)continue;const b=y.data,w=y.indices,x=v.data,T=v.indices;for(let E=0;E<w.length;E++){const M=3*w[E],O=T[E]*v.stride;pe(ns,b[M+0],b[M+1],b[M+2]),nt(ns,ns,d),c.push(...ns),pe(Bd,x[O+0],x[O+1],x[O+2]),ca(Bd,Bd,f),Ce(Bd,Bd),Dn(ns,ns,Bd,l),c.push(...ns),u.push(u.length),u.push(u.length)}}return c.length?new Pn(s,[[$.POSITION,new ht(c,u,3,!0)]],null,Gs.Line):null}_createAs3DShape(e,i,r,s){const n=e.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,i,s);if(o==null)return null;const{geometries:a,objectTransformation:l}=o;if(kr.DRAW_MESH_GEOMETRY_NORMALS){const v=this._createPerVertexDebugVectors(n,a,$.NORMAL,this._debugVertexNormalMaterial,1),b=this._createPerVertexDebugVectors(n,a,$.TANGENT,this._debugTangentNormalMaterial,.5),w=this._createFaceDebugNormals(n,a);v&&a.push(v),b&&a.push(b),w&&a.push(w)}const c=new Ow({geometries:a,layerUid:this._context.layer.uid,graphicUid:s,isElevationSource:!0});c.transformation=l;const u=jDe(this.symbolLayer,{opacity:this._getLayerOpacity()}),d=u?new rvt(a[0].material,[u],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,f=new HMt(this,c,a,null,null,jS,r,d);this._fastUpdateProcessor.onAddGraphic(),f.needsElevationUpdates=ow(r.mode),f.useObjectOriginAsAttachmentOrigin=!0,f.fastTransformUpdatesAllowed=this._fastTransformUpdatesAllowed(n),r.centerPointInElevationSR=this._getCenterPointInElevationSR(c.transformation);const{elevationProvider:m,renderCoordsHelper:g}=this._context,y=(v,b)=>nw(v,m,r,g,b);return f.alignedSampledElevation=jS(f,r,m.spatialReference,y,g),f}_fastTransformUpdatesAllowed(e){const{vertexSpace:i,spatialReference:r}=e;if(!M8(i))return!1;const{type:s}=i,{view:n}=this._context.graphicsCoreOwner,{viewingMode:o}=n.state,a=n.spatialReference;return o===Je.Global&&s==="local"||o===Je.Local&&ms(a,r)&&s==="georeferenced"&&!r.isGeographic}_getCenterPointInElevationSR(e){const i=_w(0,0,0,this._context.elevationProvider.spatialReference!=null?this._context.elevationProvider.spatialReference:null);return vw([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,i),i}_passthroughReprojectionInfo(e){return e.reprojection===vu.NONE&&!!e.objectTransformation}_createPositionBuffer(e,i){const r=e.vertexAttributes.position;let s=r,n=null;if(i.reprojection===vu.NONE)return{position:s,georeferencedPositionBuffer:n};const o=i.reprojection===vu.RENDER?i.transformBeforeProject:null;o&&(s=lw(new Float64Array(s.length),s,o));const{normal:a,tangent:l}=e.vertexAttributes;this._passthroughReprojectionInfo(i)||!a&&!l||(n=s);const c=s===r||s===n?new Float64Array(s.length):s;return gs(s,e.spatialReference,0,c,this._context.renderCoordsHelper.spatialReference,0,s.length/3),{position:c,georeferencedPositionBuffer:n}}_createNormalBuffer(e,i,r,s){const n=e.vertexAttributes.normal;if(n==null)return null;let o=n;const a=s.reprojection===vu.RENDER?s.transformBeforeProject:null;a&&(o=fee(o,new Float32Array(o.length),a));const l=this._context.graphicsCoreOwner.view.viewingMode;if(s.reprojection===vu.NONE)return o;if(l==="local"){if(!s2(this._context.renderCoordsHelper.spatialReference))return o;if(r==null)return null;if(e.spatialReference.isGeographic){const u=o===n?new Float32Array(o.length):o;return gee(o,_l.NORMAL,r,u)}if(e.spatialReference.isWebMercator){const u=o===n?new Float32Array(o.length):o;return yee(o,_l.NORMAL,r,u)}return o}if(r==null)return null;const c=o===n?new Float32Array(o.length):o;return B5e(o,r,i,e.spatialReference,c)}_createTangentBuffer(e,i,r,s){const n=e.vertexAttributes.tangent;if(n==null)return null;let o=n;const a=s.reprojection===vu.RENDER?s.transformBeforeProject:null;a&&(o=mee(o,new Float32Array(o.length),a));const l=this._context.graphicsCoreOwner.view.viewingMode;if(s.reprojection===vu.NONE)return o;if(l==="local"){if(!s2(this._context.renderCoordsHelper.spatialReference))return o;if(r==null)return null;if(e.spatialReference.isGeographic){const u=o===n?new Float32Array(o.length):o;return gee(o,_l.TANGENT,r,u)}if(e.spatialReference.isWebMercator){const u=o===n?new Float32Array(o.length):o;return yee(o,_l.TANGENT,r,u)}return o}if(r==null)return null;const c=o===n?new Float32Array(o.length):o;return G5e(o,r,i,e.spatialReference,c)}_createSymbolColorBuffer(e){var i,r;if(this._requiresSymbolVertexColors()){const s=this._getVertexOpacityAndColor(e),n=fvt((r=(i=this.symbolLayer)==null?void 0:i.material)==null?void 0:r.colorMixMode),o=new Uint8Array(4);return zDe(s,n,o),o}return null}_createBuffers(e,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=e.vertexAttributes.normal,n=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(s&&s.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(o&&o.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(n&&n.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),{position:l,georeferencedPositionBuffer:c}=this._createPositionBuffer(e,a),u=gAt(e),d=this._createSymbolColorBuffer(i),f=this._createNormalBuffer(e,l,c,a),m=this._createTangentBuffer(e,l,c,a),g=n,{transformation:y,position:v,normal:b,tangent:w}=this._passthroughReprojectionInfo(a)?{transformation:a.objectTransformation,position:l,normal:f,tangent:m}:this._transformOriginLocal(e,l,f,m);return{positionBuffer:v,normalBuffer:b,tangentBuffer:w,uvBuffer:g,colorBuffer:u,symbolColorBuffer:d,objectTransformation:y,geometryTransformation:a.reprojection===vu.NONE&&a.geometryTransformation?a.geometryTransformation:ke()}}_computeReprojectionInfo(e){var l;const{vertexSpace:i}=e,r=i.type==="georeferenced"?ms(this._context.renderCoordsHelper.spatialReference,e.spatialReference)?vu.NONE:vu.RENDER:vu.NONE;if(SMt(i))return{reprojection:r};const s=i.origin,n=ke(),o=((l=e.transform)==null?void 0:l.localMatrix)??Jr;if(r===vu.NONE)return Gh(e.spatialReference,s,n,this._context.renderCoordsHelper.spatialReference),{reprojection:r,objectTransformation:n,geometryTransformation:EP(o)};const a=z2(ke(),s);return vr(a,a,o),{reprojection:r,transformBeforeProject:a}}_transformOriginLocal(e,i,r,s){const n=this._context.renderCoordsHelper.spatialReference,o=e.anchor;h5[0]=o.x,h5[1]=o.y,h5[2]=o.z??0;const a=ke();Gh(e.spatialReference,h5,a,n),eo(d5,a);const{position:l,normal:c,tangent:u}=e.vertexAttributes,d=i===l?new Float64Array(i.length):i;lw(d,i,d5);const f=r?r===c?new Float32Array(r.length):r:null,m=s?s===u?new Float32Array(s.length):s:null;return r&&f&&fee(r,f,d5),s&&m&&mee(s,m,d5),{transformation:a,position:d,normal:f,tangent:m}}_validateFaces(e,i){const r=e.vertexAttributes.position.length/3,s=i.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(r<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_isOutsideClippingArea(e){var o;if(!this._context.clippingExtent)return!1;const i=(o=e.vertexAttributes)==null?void 0:o.position;if(!i)return!1;const r=this._context.elevationProvider.spatialReference,s=H5e({positions:i,transform:e.transform,vertexSpace:e.vertexSpace,inSpatialReference:e.spatialReference,outSpatialReference:r??e.spatialReference,localMode:this._context.stage.viewingMode===Je.Local});if(!s)return!1;const n=s.length/3;return Qr(h7),Uh(h7,s,0,n),!Gf(h7,this._context.clippingExtent)}_createGeometryInfo(e,i,r){if(!Kc(e.spatialReference,this._context.renderCoordsHelper.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(!this._validateVertexSpace(e)||this._isOutsideClippingArea(e))return null;const s=this._createBuffers(e,i);if(s==null)return null;const{positionBuffer:n,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:u,objectTransformation:d,geometryTransformation:f}=s,m=hAt(e),g=new Array;let y=!1;const v=Wz(ns,d),b=this._context.localOriginFactory.getOrigin(v);for(const w of m){if(!this._validateFaces(e,w))return null;const x=aAt(e,w);if(x.length===0)continue;const T=lAt(n,c,w,x);T.didFlipNormals&&(y=!0);const E=[[$.POSITION,new ht(n,x,3,!0)],[$.NORMAL,new ht(T.normals,T.indices,3,!0)]];a&&E.push([$.COLOR,new ht(a,x,4,!0)]),l&&E.push([$.SYMBOLCOLOR,new ht(l,Ew(x.length),4,!0)]),o&&E.push([$.UV0,new ht(o,x,2,!0)]),u&&E.push([$.TANGENT,new ht(u,x,4,!0)]);const M=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerUid:this._context.layer.uid}),O=this._getOrCreateMaterial(e,w),D=new Pn(O,E,null,Gs.Mesh,M);D.transformation=f,D.localOrigin=b,g.push(D)}return y&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:g,objectTransformation:d}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial((i,r)=>{r.setParameters(i.parameters)})}_validateVertexSpace(e){const{_context:{graphicsCoreOwner:{view:{state:{viewingMode:i}}}}}=this,{vertexSpace:r}=e;return i!==Je.Local||r.type!=="local"||(this.logger.warn("Displaying a mesh with a local vertex space in a view in local viewing mode is not supported."),!1)}test(){return{...super.test(),materials:this._materialInfoCache.materials}}},Yae=class{constructor(e,i,r){this.normals=e,this.indices=i,this.didFlipNormals=r}};function aAt(t,e){return e.faces??sE(t.vertexAttributes.position.length/3)}function lAt(t,e,i,r){switch(i.shading||"flat"){default:case"source":return cAt(t,e,i,r);case"flat":return X5e(t,r);case"smooth":return uAt(t,r)}}function X5e(t,e){const i=$s(e.length),r=new Array(3*e.length);for(let s=0;s<e.length;s+=3){const n=O8(t,e,s,$g);for(let o=0;o<3;o++)i[s+o]=n[o],r[s+o]=s/3}return new Yae(i,r,!1)}function cAt(t,e,i,r){if(e==null)return X5e(t,r);let s=!1;if(!i.trustSourceNormals)for(let n=0;n<r.length;n+=3){O8(t,r,n,$g);for(let o=0;o<3;o++){const a=3*r[n+o];ns[0]=e[a],ns[1]=e[a+1],ns[2]=e[a+2],Te($g,ns)<0&&(e[a]=-e[a],e[a+1]=-e[a+1],e[a+2]=-e[a+2],s=!0)}}return new Yae(e,r,s)}function uAt(t,e){const i={};for(let n=0;n<e.length;n+=3){const o=O8(t,e,n,$g);for(let a=0;a<3;a++){const l=e[n+a];let c=i[l];c||(c={normal:C(),count:0},i[l]=c),Ee(c.normal,c.normal,o),c.count++}}const r=$s(3*e.length),s=new Array(3*e.length);for(let n=0;n<e.length;n++){const o=i[e[n]];o.count!==1&&(Ce(o.normal,o.normal),o.count=1);for(let a=0;a<3;a++)r[3*n+a]=o.normal[a];s[n]=n}return new Yae(r,s,!1)}function J5e(t,e,i,r,s,n){const o=3*e[i],a=3*e[i+1],l=3*e[i+2];r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2],s[0]=t[a],s[1]=t[a+1],s[2]=t[a+2],n[0]=t[l],n[1]=t[l+1],n[2]=t[l+2]}function O8(t,e,i,r){return J5e(t,e,i,ns,Bd,eA),$e(Bd,Bd,ns),$e(eA,eA,ns),mt(ns,Bd,eA),Ce(r,ns),r}function hAt(t){return t.components??vAt}function B$(t){if(!t)return null;const{scale:e,offset:i,rotation:r}=t;return{scale:e,offset:i,rotation:kt(r)}}function dAt(t="repeat"){if(typeof t=="string"){const e=u7(t);return{s:e,t:e}}return{s:u7(t.horizontal),t:u7(t.vertical)}}function u7(t){switch(t){case"clamp":return Ai.CLAMP_TO_EDGE;case"mirror":return Ai.MIRRORED_REPEAT;default:return Ai.REPEAT}}function pAt(t){const e=t.vertexAttributes.color;if(e==null)return!1;for(let i=3;i<e.length;i+=4)if(e[i]!==255)return!0;return!1}function fAt(t,e){e.diffuse=je.toUnitRGB(t),e.opacity=t.a}function mAt(t){return t.data??t.url}function ux(t){return t==null?"-":t instanceof je?t.toHex():t.contentHash}function j$(t){const{offset:e,scale:i,rotation:r}=t??yAt;return`${e[0]},${e[1]},${r},${i[0]},${i[1]}`}function gAt(t){return t.vertexAttributes.color}const yAt=new HA,h5=C(),ns=C(),Bd=C(),eA=C(),$g=C(),d5=ke(),_At=ke(),h7=io(),vAt=[new wMt];var vu;(function(t){t[t.NONE=0]="NONE",t[t.RENDER=1]="RENDER"})(vu||(vu={}));let bAt=class{constructor(e,i,r,s){this.graphics3DSymbolLayer=e,this.instanceIndex=i,this.elevationAligner=r,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const i=this._lodRenderer.instanceData;e!==i.getVisible(this.instanceIndex)&&i.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,i,r){if(this.elevationAligner){s8(this.elevationContext.featureExpressionInfoContext,r);const s=(o,a)=>nw(o,e,this.elevationContext,i,a),n=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,i);n!=null&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(e=C()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Fm),nt(e,this._lodRenderer.baseBoundingSphere.center,Fm)}getBoundingBoxObjectSpace(e=io()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Fm);const i=this._lodRenderer.baseBoundingBox;Qr(e);for(let r=0;r<8;++r)pe(md,1&r?i[3]:i[0],2&r?i[4]:i[1],4&r?i[5]:i[2]),nt(md,md,Fm),hm(e,md);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Fm),e.render.origin[0]+=Fm[12],e.render.origin[1]+=Fm[13],e.render.origin[2]+=Fm[14],e.render.num++}async getProjectedBoundingBox(e,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=wAt,l=Sne(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Fm);for(let u=0;u<l;u++){const d=a[u];md[0]=o[d[0]],md[1]=o[d[1]],md[2]=o[d[2]],nt(md,md,Fm),hx[3*u]=md[0],hx[3*u+1]=md[1],hx[3*u+2]=md[2]}if(!e(hx,0,l))return null;Qr(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],hx[u+d]),o[d+3]=Math.max(o[d+3],hx[u+d]);c&&r.push({location:hx.slice(u,u+3),screenSpaceBoundingRect:c})}if(i&&(jf(o,d7),this.elevationContext.mode!=="absolute-height")){let u;const d=Yoe(o,i.service.spatialReference,i);try{u=await i.service.queryElevation(d7[0],d7[1],s,d,"ground")}catch{}u!=null&&j$e(o,0,0,-this.alignedSampledElevation+u)}return o}addObjectState(e,i){if(e===R_.Highlight){const r=new RB(e);this._addHighlightId(r),i.addExternal(s=>{this._removeHighlightId(s)},r)}}removeObjectState(e){this._highlights.forEach(i=>e.remove(i))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const hx=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],md=C(),d7=C(),wAt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Fm=ke();function xAt(t,e){const i=t.stageResources.geometries.map(s=>new NDe(s,t.stageResources.textures)),r=t.lodThreshold==null||t.lodThreshold===0&&e>0?SAt(i):t.lodThreshold;return new FDe(i,r,t.pivotOffset)}function TAt(t){return new kDe(t.map((e,i)=>xAt(e,i)))}function SAt(t){const e=t.reduce((i,{geometry:r})=>i+r.indexCount/3,0);return Math.sqrt(e*EAt/Math.PI)}const EAt=20;function CAt(t){return t=t||globalThis.location.hostname,MAt.some(e=>(t==null?void 0:t.match(e))!=null)}function _ee(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(Q5e)!=null||e.match(eke)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(K5e)!=null||e.match(tke)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const Q5e=/^devext\.arcgis\.com$/,K5e=/^qaext\.arcgis\.com$/,eke=/^[\w-]*\.mapsdevext\.arcgis\.com$/,tke=/^[\w-]*\.mapsqa\.arcgis\.com$/,MAt=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local\.esri\.com$/,Q5e,K5e,/^jsapps\.esri\.com$/,eke,tke];function AAt(t,e){Xae(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function Xae(t,e,i=2,r=i){const s=e.length/2;let n=0,o=0;if(hy(e)||dHe(e)){for(let l=0;l<s;++l)t[n]=e[o],t[n+1]=e[o+1],n+=i,o+=r;return}const a=pHe(e);if(hHe(e))for(let l=0;l<s;++l)t[n]=Math.max(e[o]/a,-1),t[n+1]=Math.max(e[o+1]/a,-1),n+=i,o+=r;else for(let l=0;l<s;++l)t[n]=e[o]/a,t[n+1]=e[o+1]/a,n+=i,o+=r}function PAt(t,e,i,r){const s=t.typedBuffer,n=t.typedBufferStride,o=(r==null?void 0:r.count)??t.count;let a=((r==null?void 0:r.dstIndex)??0)*n;for(let l=0;l<o;++l)s[a]=e,s[a+1]=i,a+=n}Object.freeze(Object.defineProperty({__proto__:null,fill:PAt,normalizeIntegerBuffer:Xae,normalizeIntegerBufferView:AAt},Symbol.toStringTag,{value:"Module"}));function OAt(t,e){$8(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function $8(t,e,i=3,r=i){const s=e.length/r;let n=0,o=0;for(let a=0;a<s;++a)t[n]=e[o],t[n+1]=e[o+1],t[n+2]=e[o+2],n+=i,o+=r}function $At(t,e,i,r,s){const n=t.typedBuffer,o=t.typedBufferStride,a=(s==null?void 0:s.count)??t.count;let l=((s==null?void 0:s.dstIndex)??0)*o;for(let c=0;c<a;++c)n[l]=e,n[l+1]=i,n[l+2]=r,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:$8,copyView:OAt,fill:$At},Symbol.toStringTag,{value:"Module"}));function RAt(t,e){Jae(t.typedBuffer,e,t.typedBufferStride)}function Jae(t,e,i=4){const r=e.typedBuffer,s=e.typedBufferStride,n=e.count;let o=0,a=0;for(let l=0;l<n;++l)t[o]=r[a],t[o+1]=r[a+1],t[o+2]=r[a+2],t[o+3]=r[a+3],o+=i,a+=s}function IAt(t,e,i,r,s,n){const o=t.typedBuffer,a=t.typedBufferStride,l=(n==null?void 0:n.count)??t.count;let c=((n==null?void 0:n.dstIndex)??0)*a;for(let u=0;u<l;++u)o[c]=e,o[c+1]=i,o[c+2]=r,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:Jae,copyView:RAt,fill:IAt},Symbol.toStringTag,{value:"Module"}));let ike=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,i){return this._load("json",e,i)}async loadBinary(e,i){return Cy(e)?(Dt(i),Dre(e)):this._load("binary",e,i)}async loadImage(e,i){return this._load("image",e,i)}async _load(e,i,r){if(this._streamDataRequester==null)return(await fr(i,{responseType:LAt[e]})).data;const s=await Qh(this._streamDataRequester.request(i,e,r));if(s.ok===!0)return s.value;throw Ql(s.error),new B("",`Request for resource failed: ${s.error}`)}};const LAt={image:"image",binary:"array-buffer",json:"json","image+type":void 0};function DAt(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function NAt(t,e={}){return{data:t,parameters:{wrap:{s:Ai.REPEAT,t:Ai.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}function lV(t,e){const i=t.count;e||(e=new t.TypedArrayConstructor(i));for(let r=0;r<i;r++)e[r]=t.get(r);return e}Object.freeze(Object.defineProperty({__proto__:null,makeDense:lV},Symbol.toStringTag,{value:"Module"}));let M_e=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const i=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,i,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var sL,A_e;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(sL||(sL={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(A_e||(A_e={}));const rke={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},FAt={pbrMetallicRoughness:rke,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},kAt={ESRI_externalColorMixMode:"tint",ESRI_receiveShadows:!0,ESRI_receiveAmbientOcclusion:!0},P_e=(t={})=>{const e={...rke,...t.pbrMetallicRoughness},i=UAt({...kAt,...t.extras});return{...FAt,...t,pbrMetallicRoughness:e,extras:i}};function UAt(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode="tint"}return t}const VAt={magFilter:di.LINEAR,minFilter:di.LINEAR_MIPMAP_LINEAR,wrapS:Ai.REPEAT,wrapT:Ai.REPEAT},zAt=t=>({...VAt,...t});function BAt(t){let e,i;return t.replace(/^(.*\/)?([^/]*)$/,(r,s,n)=>(e=s||"",i=n||"","")),{dirPart:e,filePart:i}}const p5={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let jAt=class g1{constructor(e,i,r,s){if(this._context=e,this.uri=i,this.json=r,this._glbBuffer=s,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu","KHR_texture_transform"],this._baseUri=BAt(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),r.scenes==null)throw new B("gltf-loader-unsupported-feature","Scenes must be defined.");if(r.meshes==null)throw new B("gltf-loader-unsupported-feature","Meshes must be defined");if(r.nodes==null)throw new B("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,i,r){if(Cy(i)){const o=Fb(i);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new g1(e,i,l)}catch{}const a=Dre(i);if(g1._isGLBData(a))return this._fromGLBData(e,i,a)}if(YAt.test(i)||(r==null?void 0:r.expectedType)==="gltf"){const o=await e.loadJSON(i,r);return new g1(e,i,o)}const s=await e.loadBinary(i,r);if(g1._isGLBData(s))return this._fromGLBData(e,i,s);if(XAt.test(i)||(r==null?void 0:r.expectedType)==="glb")throw new B("gltf-loader-invalid-glb","This is not a valid glb file.");const n=await e.loadJSON(i,r);return new g1(e,i,n)}static _isGLBData(e){if(e==null)return!1;const i=new M_e(e);return i.remainingBytes()>=4&&i.readUint32()===p5.MAGIC}static async _fromGLBData(e,i,r){const s=await g1._parseGLBData(r);return new g1(e,i,s.json,s.binaryData)}static async _parseGLBData(e){const i=new M_e(e);if(i.remainingBytes()<12)throw new B("gltf-loader-error","glb binary data is insufficiently large.");const r=i.readUint32(),s=i.readUint32(),n=i.readUint32();if(r!==p5.MAGIC)throw new B("gltf-loader-error","Magic first 4 bytes do not fit to expected glb value.");if(e.byteLength<n)throw new B("gltf-loader-error","glb binary data is smaller than header specifies.");if(s!==2)throw new B("gltf-loader-unsupported-feature","An unsupported glb container version was detected. Only version 2 is supported.");let o,a,l=0;for(;i.remainingBytes()>=8;){const c=i.readUint32(),u=i.readUint32();if(l===0){if(u!==p5.CHUNK_TYPE_JSON)throw new B("gltf-loader-error","First glb chunk must be JSON.");if(c<0)throw new B("gltf-loader-error","No JSON data found.");o=await BMt(i.readUint8Array(c))}else if(l===1){if(u!==p5.CHUNK_TYPE_BIN)throw new B("gltf-loader-unsupported-feature","Second glb chunk expected to be BIN.");a=i.readUint8Array(c)}else ne.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 glb chunks detected. Skipping.");l+=1}if(!o)throw new B("gltf-loader-error","No glb JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,i){const r=this.json.buffers[e];if(r.uri==null){if(this._glbBuffer==null)throw new B("gltf-loader-error","glb buffer not present");return this._glbBuffer}const s=await this._getBufferLoader(e,i);if(s.byteLength!==r.byteLength)throw new B("gltf-loader-error","Buffer byte lengths should match.");return s}async _getBufferLoader(e,i){const r=this._bufferLoaders.get(e);if(r)return r;const s=this.json.buffers[e].uri,n=this._context.loadBinary(this._resolveUri(s),i).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,n),n}async getAccessor(e,i){if(!this.json.accessors)throw new B("gltf-loader-unsupported-feature","Accessors missing.");const r=this.json.accessors[e];if((r==null?void 0:r.bufferView)==null)throw new B("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(r.type in[sL.MAT2,sL.MAT3,sL.MAT4])throw new B("gltf-loader-unsupported-feature",`AttributeType ${r.type} is not supported`);const s=this.json.bufferViews[r.bufferView],n=await this.getBuffer(s.buffer,i),o=qAt[r.type],a=WAt[r.componentType],l=o*a,c=s.byteStride||l;return{raw:n.buffer,byteStride:c,byteOffset:n.byteOffset+(s.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized}}async getIndexData(e,i){if(e.indices==null)return;const r=await this.getAccessor(e.indices,i);if(r.isDenselyPacked)switch(r.componentType){case Et.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case Et.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case Et.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case Et.UNSIGNED_BYTE:return lV(gd(zP,r));case Et.UNSIGNED_SHORT:return lV(gd(F6,r));case Et.UNSIGNED_INT:return lV(gd(U6,r))}}async getPositionData(e,i){if(e.attributes.POSITION==null)throw new B("gltf-loader-unsupported-feature","No POSITION vertex data found.");const r=await this.getAccessor(e.attributes.POSITION,i);if(r.componentType!==Et.FLOAT)throw new B("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+Et[r.componentType]);if(r.componentCount!==3)throw new B("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return gd(_o,r)}async getNormalData(e,i){if(e.attributes.NORMAL==null)throw new B("gltf-loader-error","No NORMAL vertex data found.");const r=await this.getAccessor(e.attributes.NORMAL,i);if(r.componentType!==Et.FLOAT)throw new B("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+Et[r.componentType]);if(r.componentCount!==3)throw new B("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return gd(_o,r)}async getTangentData(e,i){if(e.attributes.TANGENT==null)throw new B("gltf-loader-error","No TANGENT vertex data found.");const r=await this.getAccessor(e.attributes.TANGENT,i);if(r.componentType!==Et.FLOAT)throw new B("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+Et[r.componentType]);if(r.componentCount!==4)throw new B("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+r.componentCount.toFixed());return new mm(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*r.entryCount)}async getTextureCoordinates(e,i){if(e.attributes.TEXCOORD_0==null)throw new B("gltf-loader-error","No TEXCOORD_0 vertex data found.");const r=await this.getAccessor(e.attributes.TEXCOORD_0,i);if(r.componentCount!==2)throw new B("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+r.componentCount.toFixed());if(r.componentType===Et.FLOAT)return gd(rE,r);if(!r.normalized)throw new B("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return ZAt(r)}async getVertexColors(e,i){if(e.attributes.COLOR_0==null)throw new B("gltf-loader-error","No COLOR_0 vertex data found.");const r=await this.getAccessor(e.attributes.COLOR_0,i);if(r.componentCount!==4&&r.componentCount!==3)throw new B("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+r.componentCount.toFixed());if(r.componentCount===4){if(r.componentType===Et.FLOAT)return gd(mm,r);if(r.componentType===Et.UNSIGNED_BYTE)return gd(Sl,r);if(r.componentType===Et.UNSIGNED_SHORT)return gd(pN,r)}else if(r.componentCount===3){if(r.componentType===Et.FLOAT)return gd(_o,r);if(r.componentType===Et.UNSIGNED_BYTE)return gd(N6,r);if(r.componentType===Et.UNSIGNED_SHORT)return gd(k6,r)}throw new B("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+Et[r.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,i,r){var n,o,a,l,c,u,d,f,m,g;let s=e.material?this._materialCache.get(e.material):void 0;if(!s){const y=e.material!=null?P_e(this.json.materials[e.material]):P_e(),v=y.pbrMetallicRoughness,b=this.hasVertexColors(e),w=this.getTexture(v.baseColorTexture,i),x=this.getTexture(y.normalTexture,i),T=r?this.getTexture(y.occlusionTexture,i):void 0,E=r?this.getTexture(y.emissiveTexture,i):void 0,M=r?this.getTexture(v.metallicRoughnessTexture,i):void 0,O=e.material!=null?e.material:-1;s={alphaMode:y.alphaMode,alphaCutoff:y.alphaCutoff,color:v.baseColorFactor,doubleSided:!!y.doubleSided,colorTexture:await w,normalTexture:await x,name:y.name,id:O,occlusionTexture:await T,emissiveTexture:await E,emissiveFactor:y.emissiveFactor,metallicFactor:v.metallicFactor,roughnessFactor:v.roughnessFactor,metallicRoughnessTexture:await M,hasVertexColors:b,ESRI_externalColorMixMode:y.extras.ESRI_externalColorMixMode,colorTextureTransform:(o=(n=v==null?void 0:v.baseColorTexture)==null?void 0:n.extensions)==null?void 0:o.KHR_texture_transform,normalTextureTransform:(l=(a=y.normalTexture)==null?void 0:a.extensions)==null?void 0:l.KHR_texture_transform,occlusionTextureTransform:(u=(c=y.occlusionTexture)==null?void 0:c.extensions)==null?void 0:u.KHR_texture_transform,emissiveTextureTransform:(f=(d=y.emissiveTexture)==null?void 0:d.extensions)==null?void 0:f.KHR_texture_transform,metallicRoughnessTextureTransform:(g=(m=v==null?void 0:v.metallicRoughnessTexture)==null?void 0:m.extensions)==null?void 0:g.KHR_texture_transform,receiveAmbientOcclusion:y.extras.ESRI_receiveAmbientOcclusion,receiveShadows:y.extras.ESRI_receiveShadows}}return s}async getTexture(e,i){if(!e)return;if((e.texCoord||0)!==0)throw new B("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const r=e.index,s=this.json.textures[r],n=zAt(s.sampler!=null?this.json.samplers[s.sampler]:{}),o=O_e(s),a=this.json.images[o],l=await this._loadTextureImageData(r,s,i);return VD(this._textureCache,r,()=>{const c=d=>d===33071||d===33648||d===10497,u=d=>{throw new B("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${d}`)};return{data:l,wrapS:c(n.wrapS)?n.wrapS:u(n.wrapS),wrapT:c(n.wrapT)?n.wrapT:u(n.wrapT),minFilter:n.minFilter,name:a.name,id:r}})}getNodeTransform(e){if(e===void 0)return GAt;let i=this._nodeTransformCache.get(e);if(!i){const r=this.getNodeTransform(this._getNodeParent(e)),s=this.json.nodes[e];s.matrix?i=vr(ke(),r,s.matrix):s.translation||s.rotation||s.scale?(i=EP(r),s.translation&&wl(i,i,s.translation),s.rotation&&(f5[3]=u6(f5,s.rotation),Uu(i,i,f5[3],f5)),s.scale&&YD(i,i,s.scale)):i=EP(r),this._nodeTransformCache.set(e,i)}return i}_resolveUri(e){return Lu(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=SO.parse(this.json.asset.version,"glTF");HAt.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(i=>this._supportedExtensions.includes(i)))throw new B("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,i)=>{e.children&&e.children.forEach(r=>{this._nodeParentMap.set(r,i)})})}async _loadTextureImageData(e,i,r){const s=this._textureLoaders.get(e);if(s)return s;const n=this._createTextureLoader(i,r);return this._textureLoaders.set(e,n),n}async _createTextureLoader(e,i){const r=O_e(e),s=this.json.images[r];if(s.uri){if(s.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(s.uri),i);return new q5e(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(s.uri),i)}if(s.bufferView==null)throw new B("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(s.mimeType==null)throw new B("gltf-loader-unsupported-feature","Image mimeType must be defined.");const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,i);if(n.byteStride!=null)throw new B("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(n.byteOffset||0);return jMt(new Uint8Array(o.buffer,a,n.byteLength),s.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await wZ(Array.from(this._bufferLoaders.values())),i=await wZ(Array.from(this._textureLoaders.values()));return e.reduce((r,s)=>r+((s==null?void 0:s.byteLength)??0),0)+i.reduce((r,s)=>r+(s?rL(s)?s.data.byteLength:s.width*s.height*4:0),0)}};const GAt=GCe(ke(),Math.PI/2),HAt=new SO(2,0,"glTF"),f5=nd(),qAt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},WAt={[Et.BYTE]:1,[Et.UNSIGNED_BYTE]:1,[Et.SHORT]:2,[Et.UNSIGNED_SHORT]:2,[Et.HALF_FLOAT]:2,[Et.FLOAT]:4,[Et.INT]:4,[Et.UNSIGNED_INT]:4};function ZAt(t){switch(t.componentType){case Et.BYTE:return new V6(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Et.UNSIGNED_BYTE:return new D6(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Et.SHORT:return new fN(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Et.UNSIGNED_SHORT:return new coe(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Et.UNSIGNED_INT:return new uoe(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Et.FLOAT:return new rE(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}function gd(t,e){return new t(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*(e.entryCount-1)+e.componentByteSize*e.componentCount)}function O_e(t){var e;if(((e=t.extensions)==null?void 0:e.KHR_texture_basisu)!=null)return t.extensions.KHR_texture_basisu.source;if(t.source!==null)return t.source;throw new B("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}const YAt=/\.gltf$/i,XAt=/\.glb$/i;let JAt=0;async function ske(t,e,i={},r=!0){var d,f;const s=await jAt.load(t,e,i),n="gltf_"+JAt++,o={lods:[],materials:new Map,textures:new Map,meta:QAt(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=(f=(d=s.json.asset.extras)==null?void 0:d.ESRI_webstyleSymbol)==null?void 0:f.webstyle,c=new Map;await KAt(s,async(m,g,y,v)=>{var X;const b=c.get(y)??0;c.set(y,b+1);const w=m.mode!==void 0?m.mode:Mi.TRIANGLES,x=w===Mi.TRIANGLES||w===Mi.TRIANGLE_STRIP||w===Mi.TRIANGLE_FAN?w:null;if(x==null)return void ne.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+Mi[w]+"). Skipping primitive.");if(!s.hasPositions(m))return void ne.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const T=s.getPositionData(m,i),E=s.getMaterial(m,i,r),M=s.hasNormals(m)?s.getNormalData(m,i):null,O=s.hasTangents(m)?s.getTangentData(m,i):null,D=s.hasTextureCoordinates(m)?s.getTextureCoordinates(m,i):null,U=s.hasVertexColors(m)?s.getVertexColors(m,i):null,k=s.getIndexData(m,i),H={name:v,transform:EP(g),attributes:{position:await T,normal:M?await M:null,texCoord0:D?await D:null,color:U?await U:null,tangent:O?await O:null},indices:await k,primitiveType:x,material:tPt(o,await E,n)};let V=null;((X=o.meta)==null?void 0:X.ESRI_lod)!=null&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(V=o.meta.ESRI_lod.thresholds[y]),o.lods[y]=o.lods[y]||{parts:[],name:v,lodThreshold:V},o.lods[y].parts[b]=H});for(const m of o.lods)m.parts=m.parts.filter(g=>!!g);const u=await s.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri,ESRI_webstyle:l},customMeta:{},size:u}}function QAt(t){const e=t.json;let i=null;return e.nodes.forEach(r=>{const s=r.extras;s!=null&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(i=s)}),i}async function KAt(t,e){const i=t.json,r=i.scenes[i.scene||0].nodes,s=r.length>1,n=[];for(const a of r){const l=i.nodes[a];n.push(o(a,0)),ePt(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,u)=>o(c,u+1))}async function o(a,l){const c=i.nodes[a],u=t.getNodeTransform(a);if(c.weights!=null&&ne.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const d=i.meshes[c.mesh];for(const f of d.primitives)n.push(e(f,u,l,d.name))}for(const d of c.children||[])n.push(o(d,l))}await Promise.all(n)}function ePt(t){var e;return((e=t.extensions)==null?void 0:e.MSFT_lod)&&Array.isArray(t.extensions.MSFT_lod.ids)}function tPt(t,e,i){const r=n=>{const o=`${i}_tex_${n&&n.id}${n!=null&&n.name?"_"+n.name:""}`;if(n&&!t.textures.has(o)){const a=NAt(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:iPt.has(n.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},s=`${i}_mat_${e.id}_${e.name}`;if(!t.materials.has(s)){const n=DAt({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?r(e.colorTexture):void 0,textureNormal:e.normalTexture?r(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?r(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?r(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?r(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor,receiveShadows:e.receiveShadows,receiveAmbientOcclustion:e.receiveAmbientOcclusion});t.materials.set(s,n)}return s}const iPt=new Set([di.LINEAR_MIPMAP_LINEAR,di.LINEAR_MIPMAP_NEAREST]);function rPt(t,e){switch(e){case Mi.TRIANGLES:return sPt(t);case Mi.TRIANGLE_STRIP:return nPt(t);case Mi.TRIANGLE_FAN:return oPt(t)}}function sPt(t){return typeof t=="number"?sE(t):rb(t)?new Uint16Array(t):t}function nPt(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const i=e-2,r=$B(3*i);if(typeof t=="number"){let s=0;for(let n=0;n<i;n+=1)n%2==0?(r[s++]=n,r[s++]=n+1,r[s++]=n+2):(r[s++]=n+1,r[s++]=n,r[s++]=n+2)}else{let s=0;for(let n=0;n<i;n+=1)n%2==0?(r[s++]=t[n],r[s++]=t[n+1],r[s++]=t[n+2]):(r[s++]=t[n+1],r[s++]=t[n],r[s++]=t[n+2])}return r}function oPt(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const i=e-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof t=="number"){let a=0;for(let l=0;l<i;++l)r[a++]=0,r[a++]=l+1,r[a++]=l+2;return r}const s=t[0];let n=t[1],o=0;for(let a=0;a<i;++a){const l=t[a+2];r[o++]=s,r[o++]=n,r[o++]=l,n=l}return r}let aPt=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},lPt=class{constructor(e,i,r){this.name=e,this.lodThreshold=i,this.pivotOffset=r,this.stageResources=new aPt,this.numberOfVertices=0}};const S0=()=>ne.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function nke(t,e){const i=await cPt(t,e),r=await fPt(i.textureDefinitions??{},e);let s=0;for(const n in r)if(r.hasOwnProperty(n)){const o=r[n];s+=o!=null&&o.image?o.image.width*o.image.height*4:0}return{resource:i,textures:r,size:s+sSe(i)}}async function cPt(t,e){const i=e==null?void 0:e.streamDataRequester;if(i)return uPt(t,i,e);const r=await Qh(fr(t,e));if(r.ok===!0)return r.value.data;Ql(r.error),oke(r.error)}async function uPt(t,e,i){const r=await Qh(e.request(t,"json",i));if(r.ok===!0)return r.value;Ql(r.error),oke(r.error.details.url)}function oke(t){throw new B("",`Request for object resource failed: ${t}`)}function hPt(t){const e=t.params,i=e.topology;let r=!0;switch(e.vertexAttributes||(S0().warn("Geometry must specify vertex attributes"),r=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=e.faces;if(n){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=n[o];a!=null&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(S0().warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(S0().warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(S0().warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else S0().warn("Indexed geometries must specify faces"),r=!1;break}default:S0().warn(`Unsupported topology '${i}'`),r=!1}t.params.material||(S0().warn("Geometry requires material"),r=!1);const s=t.params.vertexAttributes;for(const n in s)s[n].values||(S0().warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function dPt(t,e){var g,y;const i=new Array,r=new Array,s=new Array,n=new sw,o=t.resource,a=SO.parse(o.version||"1.0","wosr");gPt.validate(a);const l=o.model.name,c=o.model.geometries,u=o.materialDefinitions??{},d=t.textures;let f=0;const m=new Map;for(let v=0;v<c.length;v++){const b=c[v];if(!hPt(b))continue;const w=mPt(b),x=b.params.vertexAttributes,T=[],E=Z=>{if(b.params.topology==="PerAttributeArray")return null;const ye=b.params.faces;for(const L in ye)if(L===Z)return ye[L].values;return null},M=x[$.POSITION],O=M.values.length/M.valuesPerElement;for(const Z in x){const ye=x[Z],L=ye.values,N=E(Z)??sE(O);T.push([Z,new ht(L,N,ye.valuesPerElement,!0)])}const D=w.texture,U=d&&d[D];if(U&&!m.has(D)){const{image:Z,parameters:ye}=U,L=new cw(Z,ye);r.push(L),m.set(D,L)}const k=m.get(D),H=k?k.id:void 0,V=w.material;let X=n.get(V,D);if(X==null){const Z=u[V.substring(V.lastIndexOf("/")+1)].params;Z.transparency===1&&(Z.transparency=0);const ye=U&&U.alphaChannelUsage,L=Z.transparency>0||ye==="transparency"||ye==="maskAndTransparency",N=U?ake(U.alphaChannelUsage):void 0,z={ambient:Xl(Z.diffuse),diffuse:Xl(Z.diffuse),opacity:1-(Z.transparency||0),transparent:L,textureAlphaMode:N,textureAlphaCutoff:.33,textureId:H,initTextureTransparent:!0,doubleSided:!0,cullFace:Gr.None,colorMixMode:Z.externalColorMixMode||"tint",textureAlphaPremultiplied:(U==null?void 0:U.parameters.preMultiplyAlpha)??!1};e!=null&&e.materialParameters&&Object.assign(z,e.materialParameters),X=new gm(z),n.set(V,D,X)}s.push(X);const q=new Pn(X,T);f+=((y=(g=T.find(Z=>Z[0]===$.POSITION))==null?void 0:g[1])==null?void 0:y.indices.length)??0,i.push(q)}return{engineResources:[{name:l,stageResources:{textures:r,materials:s,geometries:i},pivotOffset:o.model.pivotOffset,numberOfVertices:f,lodThreshold:null}],referenceBoundingBox:pPt(i)}}function pPt(t){const e=Qr();return t.forEach(i=>{const r=i.boundingInfo;r!=null&&(hm(e,r.bbMin),hm(e,r.bbMax))}),e}async function fPt(t,e){const i=new Array;for(const n in t){const o=t[n],a=o.images[0].data;if(!a){S0().warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,u=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",d={noUnpackFlip:!0,wrap:{s:Ai.REPEAT,t:Ai.REPEAT},preMultiplyAlpha:ake(u)!==Ir.Opaque},f=e!=null&&e.disableTextures?Promise.resolve(null):D_(l,e);i.push(f.then(m=>({refId:c,image:m,parameters:d,alphaChannelUsage:u})))}const r=await Promise.all(i),s={};for(const n of r)s[n.refId]=n;return s}function ake(t){switch(t){case"mask":return Ir.Mask;case"maskAndTransparency":return Ir.MaskBlend;case"none":return Ir.Opaque;default:return Ir.Blend}}function mPt(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const gPt=new SO(1,2,"wosr"),ZE=2.1;async function lke(t,e){var d;const i=cke(_ee(t));if(i.fileType==="wosr"){const f=await(e.cache?e.cache.loadWOSR(i.url,e):nke(i.url,e)),{engineResources:m,referenceBoundingBox:g}=dPt(f,e);return{lods:m,referenceBoundingBox:g,isEsriSymbolResource:!1,isWosr:!0}}const r=await(e.cache?e.cache.loadGLTF(i.url,e,!!e.usePBR):ske(new ike(e.streamDataRequester),i.url,e,e.usePBR)),s=(d=r.model.meta)==null?void 0:d.ESRI_proxyEllipsoid,n=r.meta.isEsriSymbolResource&&s!=null&&r.meta.ESRI_webstyle==="EsriRealisticTreesStyle";n&&!r.customMeta.esriTreeRendering&&(r.customMeta.esriTreeRendering=!0,bPt(r,s));const o=!!e.usePBR,a=r.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:n,mrrFactors:[...Bvt]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[...a8]},l={...e.materialParameters,treeRendering:n},{engineResources:c,referenceBoundingBox:u}=uke(r,a,l,e.skipHighLods&&i.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:i.specifiedLodIndex});return{lods:c,referenceBoundingBox:u,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1}}function cke(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function uke(t,e,i,r){const s=t.model,n=new Array,o=new Map,a=new Map,l=s.lods.length,c=Qr();return s.lods.forEach((u,d)=>{const f=r.skipHighLods===!0&&(l>1&&d===0||l>3&&d===1)||r.skipHighLods===!1&&r.singleLodIndex!=null&&d!==r.singleLodIndex;if(f&&d!==0)return;const m=new lPt(u.name,u.lodThreshold,[0,0,0]);u.parts.forEach(g=>{const y=f?new gm({}):yPt(s,g,m,e,i,o,a),{geometry:v,vertexCount:b}=_Pt(g,y??new gm({})),w=v.boundingInfo;w!=null&&d===0&&(hm(c,w.bbMin),hm(c,w.bbMax)),y!=null&&(m.stageResources.geometries.push(v),m.numberOfVertices+=b)}),f||n.push(m)}),{engineResources:n,referenceBoundingBox:c}}function yPt(t,e,i,r,s,n,o){var m,g;const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=e.attributes.texCoord0!=null,u=e.attributes.normal!=null;if(l==null)return null;const d=vPt(l.alphaMode);if(!n.has(a)){if(c){const D=(U,k=!1)=>{if(U!=null&&!o.has(U)){const H=t.textures.get(U);if(H!=null){const V=H.data;o.set(U,new cw(rL(V)?V.data:V,{...H.parameters,preMultiplyAlpha:!rL(V)&&k,encoding:rL(V)&&V.encoding!=null?V.encoding:void 0}))}}};D(l.textureColor,d!==Ir.Opaque),D(l.textureNormal),D(l.textureOcclusion),D(l.textureEmissive),D(l.textureMetallicRoughness)}const y=l.color[0]**(1/ZE),v=l.color[1]**(1/ZE),b=l.color[2]**(1/ZE),w=l.emissiveFactor[0]**(1/ZE),x=l.emissiveFactor[1]**(1/ZE),T=l.emissiveFactor[2]**(1/ZE),E=l.textureColor!=null&&c?o.get(l.textureColor):null,M=iNe({normalTexture:l.textureNormal,metallicRoughnessTexture:l.textureMetallicRoughness,metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor,emissiveTexture:l.textureEmissive,emissiveFactor:l.emissiveFactor,occlusionTexture:l.textureOcclusion}),O=((m=l.normalTextureTransform)==null?void 0:m.scale)!=null?(g=l.normalTextureTransform)==null?void 0:g.scale:YG;n.set(a,new gm({...r,transparent:d===Ir.Blend,customDepthTest:w2.Lequal,textureAlphaMode:d,textureAlphaCutoff:l.alphaCutoff,diffuse:[y,v,b],ambient:[y,v,b],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?Gr.None:Gr.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:u?or.Attribute:or.ScreenDerivative,castShadows:!0,receiveShadows:l.receiveShadows,receiveAmbientOcclusion:l.receiveAmbientOcclustion,textureId:E!=null?E.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:l.textureNormal!=null&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:E!=null&&!!E.parameters.preMultiplyAlpha,occlusionTextureId:l.textureOcclusion!=null&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:l.textureEmissive!=null&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:l.textureMetallicRoughness!=null&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[w,x,T],mrrFactors:M?[...nae]:[l.metallicFactor,l.roughnessFactor,r.mrrFactors[2]],isSchematic:M,colorTextureTransformMatrix:Vg(l.colorTextureTransform),normalTextureTransformMatrix:Vg(l.normalTextureTransform),scale:[O[0],O[1]],occlusionTextureTransformMatrix:Vg(l.occlusionTextureTransform),emissiveTextureTransformMatrix:Vg(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:Vg(l.metallicRoughnessTextureTransform),...s}))}const f=n.get(a);if(i.stageResources.materials.push(f),c){const y=v=>{v!=null&&i.stageResources.textures.push(o.get(v))};y(l.textureColor),y(l.textureNormal),y(l.textureOcclusion),y(l.textureEmissive),y(l.textureMetallicRoughness)}return f}function _Pt(t,e){const i=t.attributes.position.count,r=rPt(t.indices||i,t.primitiveType),s=$s(3*i),{typedBuffer:n,typedBufferStride:o}=t.attributes.position;lw(s,n,t.transform,3,o);const a=[[$.POSITION,new ht(s,r,3,!0)]];if(t.attributes.normal!=null){const c=$s(3*i),{typedBuffer:u,typedBufferStride:d}=t.attributes.normal;Yb(YE,t.transform),h8(c,u,YE,3,d),qz(YE)&&JP(c,c),a.push([$.NORMAL,new ht(c,r,3,!0)])}if(t.attributes.tangent!=null){const c=$s(4*i),{typedBuffer:u,typedBufferStride:d}=t.attributes.tangent;wp(YE,t.transform),A8(c,u,YE,4,d),qz(YE)&&JP(c,c,4),a.push([$.TANGENT,new ht(c,r,4,!0)])}if(t.attributes.texCoord0!=null){const c=$s(2*i),{typedBuffer:u,typedBufferStride:d}=t.attributes.texCoord0;Xae(c,u,2,d),a.push([$.UV0,new ht(c,r,2,!0)])}const l=t.attributes.color;if(l!=null){const c=new Uint8Array(4*i);l.elementCount===4?l instanceof mm?xj(c,l,255):l instanceof Sl?Jae(c,l):l instanceof pN&&xj(c,l,1/256):(c.fill(255),l instanceof _o?rj(c,l.typedBuffer,255,4,l.typedBufferStride):t.attributes.color instanceof N6?$8(c,l.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof k6&&rj(c,l.typedBuffer,1/256,4,l.typedBufferStride)),a.push([$.COLOR,new ht(c,r,4,!0)])}return{geometry:new Pn(e,a),vertexCount:i}}const YE=Kr();function vPt(t){switch(t){case"BLEND":return Ir.Blend;case"MASK":return Ir.Mask;case"OPAQUE":case null:case void 0:return Ir.Opaque}}function bPt(t,e){for(let i=0;i<t.model.lods.length;++i){const r=t.model.lods[i];for(const s of r.parts){const n=s.attributes.normal;if(n==null)return;const o=s.attributes.position,a=o.count,l=C(),c=C(),u=C(),d=new Uint8Array(4*a),f=new Float64Array(3*a),m=eo(ke(),s.transform);let g=0,y=0;for(let v=0;v<a;v++){o.getVec(v,c),n.getVec(v,l),nt(c,c,s.transform),$e(u,c,e.center),jz(u,u,e.radius);const b=u[2],w=Ve(u),x=Math.min(.45+.55*w*w,1);jz(u,u,e.radius),m!==null&&nt(u,u,m),Ce(u,u),i+1!==t.model.lods.length&&t.model.lods.length>1&&Sr(u,u,l,b>-1?.2:Math.min(-4*b-3.8,1)),f[g]=u[0],f[g+1]=u[1],f[g+2]=u[2],g+=3,d[y]=255*x,d[y+1]=255*x,d[y+2]=255*x,d[y+3]=255,y+=4}s.attributes.normal=new _o(f),s.attributes.color=new Sl(d)}}}const Hoi=Object.freeze(Object.defineProperty({__proto__:null,fetch:lke,gltfToEngineResources:uke,parseUrl:cke},Symbol.toStringTag,{value:"Module"})),wPt=()=>!!ue("enable-feature:force-wosr"),qoi=()=>!!ue("enable-feature:direct-3d-object-feature-layer-display"),xPt=()=>ue.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0),TPt=()=>ue.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),Woi=()=>!!ue("enable-i3s-patching"),SPt=()=>ue.add("enable-i3s-patching",!0,!0,!0),EPt=()=>ue.add("enable-i3s-patching",!1,!0,!0),Zoi=()=>!!ue("enable-feature:SceneLayer-editing"),CPt=(t="i3s-patching")=>{switch(EPt(),TPt(),ue.add("enable-feature:SceneLayer-editing",!0,!0,!0),t){case"feature-layer-view":xPt();break;case"i3s-patching":SPt()}};CPt("i3s-patching");let p7={};async function MPt(t,e){try{return{data:(await Kae(t,e)).data,baseUrl:kre(t),styleUrl:t}}catch(i){return Ql(i),null}}function APt(t,e,i){var o;const r=e.portal!=null?e.portal:Kn.getDefault();let s;const n=`${r.url} - ${(o=r.user)==null?void 0:o.username} - ${t}`;return p7[n]||(p7[n]=PPt(t,r,i).then(a=>(s=a,a.fetchData())).then(a=>({data:a,baseUrl:s.itemUrl??"",styleName:t}))),p7[n]}function PPt(t,e,i){return e.load(i).then(()=>{const r=new Ig({disableExtraQuery:!0,query:`owner:${$_e} AND type:${R_e} AND typekeywords:"${t}"`});return e.queryItems(r,i)}).then(({results:r})=>{var o;let s=null;const n=t.toLowerCase();if(r&&Array.isArray(r)){for(const a of r)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===n))&&a.type===R_e&&a.owner===$_e){s=a;break}}if(!s)throw new B("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return s.load(i)})}function Qae(t,e,i){return(t==null?void 0:t.styleUrl)!=null?MPt(t.styleUrl,i):(t==null?void 0:t.styleName)!=null?APt(t.styleName,e,i):Promise.reject(new B("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function hke(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function dke(t,e,i=["gltf"]){if(e==="cimRef")return encodeURI(t.cimRef);if(t.formatInfos&&!wPt())for(const r of i){const s=t.formatInfos.find(n=>n.type===r);if(s)return s.href}return encodeURI(t.webRef)}function Kae(t,e){const i={responseType:"json",query:{f:"json"},...e};return fr(lp(t),i)}const $_e="esri_en",R_e="Style",OPt="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",$Pt=Hg.fromSimpleMarkerSymbol(o5e),RPt=eE.fromSimpleLineSymbol(Vae),IPt=Tw.fromSimpleFillSymbol(a5e),LPt=new aN({symbolLayers:new Ke([new Q2({material:{color:Uae},edges:new I$e({size:bo(1),color:new je(rEt)})})])}),DPt=new eE({symbolLayers:new Ke([new PO({material:{color:new je([0,0,0])},size:bo(1)})])}),NPt=new Tw({symbolLayers:new Ke([new Q2({outline:{color:new je([0,0,0]),size:bo(1)}})])});function Yoi(t){if(t==null)return null;switch(t.type){case"mesh":return LPt;case"point":case"multipoint":return $Pt;case"polyline":return RPt;case"polygon":case"extent":return IPt}return null}const XE={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function FPt(t,e=XE){var l,c,u,d;if(!t)return{symbol:null};const{retainId:i=XE.retainId,ignoreDrivers:r=XE.ignoreDrivers,hasLabelingContext:s=XE.hasLabelingContext,retainCIM:n=XE.retainCIM,cimFallbackEnabled:o=XE.cimFallbackEnabled}=e;let a=null;if(Qb(t)||t instanceof tE)a=t.clone();else if(t.type==="cim"){const f=(c=(l=t.data)==null?void 0:l.symbol)==null?void 0:c.type;switch(f){case"CIMPointSymbol":a=n?t.clone():Hg.fromCIMSymbol(t);break;case"CIMLineSymbol":o&&(a=DPt.clone(),(u=e==null?void 0:e.logWarning)==null||u.call(e,"Unsupported CIM line symbology converted to fallback 3D line symbology"));break;case"CIMPolygonSymbol":o&&(a=NPt.clone(),(d=e==null?void 0:e.logWarning)==null||d.call(e,"Unsupported CIM polygon symbology converted to fallback 3D polygon symbology"))}if(!a)return{error:new B("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${f||"unknown"}' is unsupported in 3D`,{symbol:t})}}else if(t instanceof Yu)a=eE.fromSimpleLineSymbol(t);else if(t instanceof Oy)a=Hg.fromSimpleMarkerSymbol(t);else if(t instanceof lN)a=Hg.fromPictureMarkerSymbol(t);else if(t instanceof H_)a=e.geometryType&&e.geometryType==="mesh"?aN.fromSimpleFillSymbol(t):Tw.fromSimpleFillSymbol(t);else{if(!(t instanceof $O))return{error:new B("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};a=s?b6.fromTextSymbol(t):Hg.fromTextSymbol(t)}return i&&a&&a.type!=="cim"&&(a.id=t.id),r&&Qb(a)&&a.symbolLayers.forEach(f=>f.ignoreDrivers=!0),{symbol:a}}function Tj(t,e,i,r){const s=pke(t,{},{context:r,isLabelSymbol:!1});s!=null&&(e[i]=s)}function I_e(t,e,i,r){const s=pke(t,{},{context:r,isLabelSymbol:!0});s!=null&&(e[i]=s)}function L_e(t){return t instanceof OO||t instanceof tE}function pke(t,e,i){if(t==null)return null;const{context:r,isLabelSymbol:s}=i,n=r==null?void 0:r.origin,o=r==null?void 0:r.messages;if(n==="web-scene"&&!L_e(t)){const a=FPt(t,{retainCIM:!0,hasLabelingContext:s});return a.symbol!=null?a.symbol.write(e,r):(o==null||o.push(new B("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:r,error:a.error})),null)}return(n==="web-map"||n==="portal-item"&&!xCe(r==null?void 0:r.layer))&&L_e(t)?(o==null||o.push(new B("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:r})),null):t.write(e,r)}function fke(t,e){return Vlt(t,null,e)}function mke(t,e,i,r){const s=t.name;return s==null?Promise.reject(new B("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName&&t.styleName==="Esri2DPointSymbolsStyle"?kPt(s,e,r):Qae(t,e,r).then(n=>tle(n,s,e,i,dke,r))}function ele(t,e){return e.items.find(i=>i.name===t)}function tle(t,e,i,r,s,n){var m,g;const o=(i==null?void 0:i.portal)!=null?i.portal:Kn.getDefault(),a={portal:o,url:gn(t.baseUrl),origin:"portal-item"},l=ele(e,t.data);if(!l){const y=`The symbol name '${e}' could not be found`;return Promise.reject(new B("symbolstyleutils:symbol-name-not-found",y,{symbolName:e}))}let c=Ub(s(l,r),a),u=((m=l.thumbnail)==null?void 0:m.href)??null;const d=(g=l.thumbnail)==null?void 0:g.imageData;CAt()&&(c=_ee(c)??"",u=_ee(u));const f={portal:o,url:gn(kre(c)),origin:"portal-item"};return Kae(c,n).then(y=>{const v=r==="cimRef"?hke(y.data):y.data,b=fke(v,f);if(b&&Qb(b)){if(u){const w=Ub(u,a);b.thumbnail=new US({url:w})}else d&&(b.thumbnail=new US({url:`data:image/png;base64,${d}`}));t.styleUrl?b.styleOrigin=new ZL({portal:i.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(b.styleOrigin=new ZL({portal:i.portal,styleName:t.styleName,name:e}))}return b})}function kPt(t,e,i){const r=OPt.replaceAll(/\{SymbolName\}/gi,t),s=e.portal!=null?e.portal:Kn.getDefault();return Kae(r,i).then(n=>{const o=hke(n.data);return fke(o,{portal:s,url:gn(kre(r)),origin:"portal-item"})})}const UPt=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:tle,getStyleItemFromStyle:ele,resolveWebStyleSymbol:mke},Symbol.toStringTag,{value:"Module"}));async function VPt(t){var a;if(t===null||t.styleName==null&&t.styleUrl==null)return null;const e=t.name;if(e==null)throw new B("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const i={portal:t.portal},r=await Qae(t,i).catch(()=>null);if(r===null)return null;const s=ele(e,r.data);if(s&&!((a=s.formatInfos)!=null&&a.some(l=>l.type==="gltf_basisu")))return null;const n=await tle(r,e,i,"webRef",(l,c)=>dke(l,c,["gltf_basisu","gltf"])).catch(()=>null);if(n===null||n.type!=="point-3d")return null;const o=n.symbolLayers.items[0];return o.type==="object"?o.resource:null}let zPt=class{constructor(e,i,r){this._elementSize=i,this._buffer=Cr.createVertex(e,hr.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.usedMemory}copyRange(e,i,r,s=0){const n=new Uint8Array(this.array,e*this.elementSize,(i-e)*this.elementSize);new Uint8Array(r.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,i){const r=e*this._elementSize,s=i*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,s)}resize(e){const i=e*this._elementSize,r=new ArrayBuffer(i);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=e}},BPt=class{constructor(e){this.modelOriginHi=e.getField($.INSTANCEMODELORIGINHI,_o),this.modelOriginLo=e.getField($.INSTANCEMODELORIGINLO,_o),this.model=e.getField($.INSTANCEMODEL,tw),this.modelNormal=e.getField($.INSTANCEMODELNORMAL,tw),this.featureAttribute=e.getField($.INSTANCEFEATUREATTRIBUTE,mm),this.color=e.getField($.INSTANCECOLOR,Sl),this.objectAndLayerIdColor=e.getField($.INSTANCEOBJECTANDLAYERIDCOLOR,Sl)}},D_e=class{constructor(e,i){this._rctx=e,this._instanceBufferLayout=i,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,i=this._tailIndex;return e>=i?e-i:e+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){var e;return((e=this._buffer)==null?void 0:e.usedMemory)??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){bt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){bt(this._updating,"not updating"),this.size<rHe*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){bt(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),bt(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){bt(this._updating,"not updating"),bt(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(Sj,Math.floor(this._capacity*cG));this._resize(e)}_shrink(){const e=Math.max(Sj,Math.floor(this._capacity*iHe));this._resize(e)}_resize(e){if(bt(this._updating,"not updating"),e===this._capacity)return;const i=new zPt(this._rctx,this._instanceBufferLayout.stride,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,s=this._compactInstances(i);bt(s===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=i,this._view=new BPt(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,e),i-r):r>i?(this._buffer.copyRange(r,this._capacity,e),i>0&&this._buffer.copyRange(0,i,e,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,i){e<i?this._buffer.transferRange(e,i):e>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(e,this._capacity))}};const Sj=64;var ds;function jPt(t){let e=Ds().mat4f64($.LOCALTRANSFORM).mat4f64($.GLOBALTRANSFORM).vec4f64($.BOUNDINGSPHERE).vec3f64($.MODELORIGIN).mat3f($.INSTANCEMODEL).mat3f($.INSTANCEMODELNORMAL).vec2f($.MODELSCALEFACTORS);return t.includes($.FEATUREATTRIBUTE)&&(e=e.vec4f($.FEATUREATTRIBUTE)),t.includes($.COLOR)&&(e=e.vec4u8($.COLOR)),t.includes($.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8($.OBJECTANDLAYERIDCOLOR)),e=e.u8($.STATE).u8($.LODLEVEL),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(ds||(ds={}));let N_e=class{constructor(e){this.localTransform=e.getField($.LOCALTRANSFORM,KL),this.globalTransform=e.getField($.GLOBALTRANSFORM,KL),this.modelOrigin=e.getField($.MODELORIGIN,yp),this.model=e.getField($.INSTANCEMODEL,tw),this.modelNormal=e.getField($.INSTANCEMODELNORMAL,tw),this.modelScaleFactors=e.getField($.MODELSCALEFACTORS,rE),this.boundingSphere=e.getField($.BOUNDINGSPHERE,L6),this.featureAttribute=e.getField($.FEATUREATTRIBUTE,mm),this.color=e.getField($.COLOR,Sl),this.objectAndLayerIdColor=e.getField($.OBJECTANDLAYERIDCOLOR,Sl),this.state=e.getField($.STATE,zP),this.lodLevel=e.getField($.LODLEVEL,zP)}},rM=class extends Ue{constructor(e,i){super(e),this.events=new Ls,this._capacity=0,this._size=0,this._next=0,this._layout=jPt(i),this._capacity=Sj,this._buffer=this._layout.createBuffer(this._capacity),this._view=new N_e(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,ds.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const i=this._view.state;bt(e>=0&&e<this._capacity&&!!(i.get(e)&ds.ALLOCATED),"invalid instance handle"),this._getStateFlag(e,ds.ACTIVE)?this._setStateFlags(e,ds.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const i=this._view.state;bt(e>=0&&e<this._capacity&&!!(i.get(e)&ds.ALLOCATED),"invalid instance handle"),i.set(e,0),this._size--}setLocalTransform(e,i,r=!0){this._view.localTransform.setMat(e,i),r&&this.updateModelTransform(e)}getLocalTransform(e,i){this._view.localTransform.getMat(e,i)}setGlobalTransform(e,i,r=!0){this._view.globalTransform.setMat(e,i),r&&this.updateModelTransform(e)}getGlobalTransform(e,i){this._view.globalTransform.getMat(e,i)}updateModelTransform(e){const i=this._view,r=su,s=kp;i.localTransform.getMat(e,F_e),i.globalTransform.getMat(e,f7);const n=vr(f7,f7,F_e);pe(r,n[12],n[13],n[14]),i.modelOrigin.setVec(e,r),wp(s,n),i.model.setMat(e,s);const o=ktt(su,n);o.sort(),i.modelScaleFactors.set(e,0,o[1]),i.modelScaleFactors.set(e,1,o[2]),tN(s,s),W2(s,s),i.modelNormal.setMat(e,s),this._setStateFlags(e,ds.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,i){const r=this._view;r.model.getMat(e,kp),r.modelOrigin.getVec(e,su),i[0]=kp[0],i[1]=kp[1],i[2]=kp[2],i[3]=0,i[4]=kp[3],i[5]=kp[4],i[6]=kp[5],i[7]=0,i[8]=kp[6],i[9]=kp[7],i[10]=kp[8],i[11]=0,i[12]=su[0],i[13]=su[1],i[14]=su[2],i[15]=1}applyShaderTransformation(e,i){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedModelTransform(e,i){return this.getModelTransform(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i),i}getCombinedLocalTransform(e,i){this._view.localTransform.getMat(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedMaxScaleFactor(e){let i=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(su,this,e),i*=Math.max(su[0],su[1],su[2])),i}getCombinedMedianScaleFactor(e){let i=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(su,this,e),i*=GPt(su[0],su[1],su[2])),i}getModel(e,i){this._view.model.getMat(e,i)}setFeatureAttribute(e,i){this._view.featureAttribute.setVec(e,i)}getFeatureAttribute(e,i){this._view.featureAttribute.getVec(e,i)}setColor(e,i){this._view.color.setVec(e,i)}setObjectAndLayerIdColor(e,i){this._view.objectAndLayerIdColor.setVec(e,i)}setVisible(e,i){i!==this.getVisible(e)&&(this._setStateFlag(e,ds.VISIBLE,i),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,ds.VISIBLE)}setHighlight(e,i){i!==this.getHighlight(e)&&(this._setStateFlag(e,ds.HIGHLIGHT,i),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,ds.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++i;return i}_setStateFlags(e,i){const r=this._view.state;i=r.get(e)|i,r.set(e,i)}_clearStateFlags(e,i){const r=this._view.state;i=r.get(e)&~i,r.set(e,i)}_setStateFlag(e,i,r){r?this._setStateFlags(e,i):this._clearStateFlags(e,i)}_getStateFlag(e,i){return!!(this._view.state.get(e)&i)}_grow(){this._capacity=Math.max(Sj,Math.floor(this._capacity*cG)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new N_e(this._buffer)}_findSlot(){const e=this._view.state;let i=this._next;for(;e.get(i)&ds.ALLOCATED;)i=i+1===this._capacity?0:i+1;return this._next=i+1===this._capacity?0:i+1,i}};function GPt(t,e,i){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),i))}h([p({constructOnly:!0})],rM.prototype,"shaderTransformation",void 0),h([p()],rM.prototype,"_size",void 0),h([p({readOnly:!0})],rM.prototype,"size",null),rM=h([I("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],rM);const su=C(),kp=Kr(),F_e=ke(),f7=ke();let HPt=class extends Wf{constructor(e,i){super(r=>this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=i,this._tmpSphere=_n(),this._tmpMat4=ke()}addInstance(e){const i=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);nt(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*CP(r),i.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},qPt=class{constructor(e,i){this._worldSpaceRadius=e,this._minScreenSpaceRadii=i}selectLevel(e,i,r){const s=r.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*i/s;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)n>=this._minScreenSpaceRadii[a]&&(o=a);return o}},WPt=class extends eN{constructor(e,i,r,s,n,o){super(e,i),this.layerUid=e,this.graphicUid=i,this.geometryId=r,this.triangleNr=s,this.baseBoundingSphere=n,this.numLodLevels=o}};function ile(t){return bp(t)&&t.intersector===as.LOD&&!!t.target}let ZPt=class{constructor(e,i){const r=e.renderContext.rctx,s=i.geometry;this._materials=e.materials,s.material.setParameters({instancedDoublePrecision:!0});const n=s.material.createBufferWriter(),o=n.vertexBufferLayout,a=n.elementCount(s),l=o.createBuffer(a);n.write(null,null,s,l,0),this.geometry=s,this.material=s.material,this.glMaterials=new KFe(s.material,this._materials),this.vertexBufferLayout=o,this.vbo=Cr.createVertex(r,hr.STATIC_DRAW,l.buffer),this.vao=new Dy(r,Pi,{geometry:Xu(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,i,r,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,r,s,(u,d,f,m,g)=>{if(u>=0){if(i!=null&&!i(e.rayBegin,e.rayEnd,u))return;const y=new WPt(o.layerUid,o.graphicUid(n),c,f,a,l);if((e.results.min.drapedLayerOrder==null||g>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||u<e.results.min.dist)&&e.results.min.set(as.LOD,y,u,d,e.transform.transform,g),e.options.store!==fa.MIN&&(e.results.max.drapedLayerOrder==null||g>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||u>e.results.max.dist)&&e.results.max.set(as.LOD,y,u,d,e.transform.transform,g),e.options.store===fa.ALL){const v=rne(e.results.min.ray);v.set(as.LOD,y,u,d,e.transform.transform,g),e.results.all.push(v)}}})}},YPt=class gke{static async create(e,i,r){const s=await Promise.allSettled(i.components.map(o=>e.controller.schedule(()=>new ZPt(e,o),r))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(sd);if(ha(r)||n.length!==s.length){n.forEach(o=>o.destroy()),Dt(r);for(const o of s)if(o.status==="rejected")throw o.reason}return new gke(i.minScreenSpaceRadius,n)}constructor(e,i){this.minScreenSpaceRadius=e,this.components=i}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,i,r,s,n,o,a){this.components.forEach(l=>l.intersect(e,i,r,s,n,o,this.boundingSphere,a))}get boundingBox(){if(this._boundingBox==null){const e=Qr();this.components.forEach(i=>{i.boundingInfo!=null&&(hm(e,i.boundingInfo.bbMin),hm(e,i.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const e=this.boundingBox,i=C();jf(e,i),this._boundingSphere={center:i,radius:.5*B$e(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,i)=>e+i.triangleCount,0)}};const XPt=t=>{const e=t.baseBoundingSphere.radius,i=t.levels.map(r=>r.minScreenSpaceRadius);return new qPt(e,i)};let Od=class extends nft{constructor(e,i){super(e),this.type=as.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new Fr,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.produces=new Map([[Pe.OPAQUE_MATERIAL,r=>this._produces(r)],[Pe.TRANSPARENT_MATERIAL,r=>!!this._hasTransparentLevels()&&this._produces(r)]]),this._instanceData=new rM({shaderTransformation:e.shaderTransformation},e.optionalFields),this.addHandles(i.registerTask(It.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=QPt(this.optionalFields),this._glInstanceBufferLayout=Xu(this._instanceBufferLayout,1),this.addHandles([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get usedMemory(){return this._allRenderInstanceData.reduce((e,i)=>i.reduce((r,s)=>r+s.usedMemory,e),0)}get renderStats(){const e=this._instanceData.size,i=[];return this._levels.forEach((r,s)=>{const n=this._allRenderInstanceData[0][s].size+this._allRenderInstanceData[1][s].size,o=r.triangleCount;i.push({renderedInstances:n,renderedTriangles:n*o,trianglesPerInstance:o})}),{totalInstances:e,renderedInstances:i.reduce((r,s)=>r+s.renderedInstances,0),renderedTriangles:i.reduce((r,s)=>r+s.renderedTriangles,0),levels:i}}async initializeRenderContext(e,i){this._context=e;const r=e.renderContext.rctx,s=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData[0].push(new D_e(r,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new D_e(r,this._instanceBufferLayout)),YPt.create(e,o,i)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(sd);if(ha(i)||n.length!==s.length){n.forEach(o=>o.destroy()),Dt(i);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=XPt(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData[0].forEach(e=>e.destroy()),this._highlightRenderInstanceData[0].forEach(e=>e.destroy())}_hasTransparentLevels(){return this._levels.some(e=>e.components.some(i=>{const r=i.material.produces.get(Pe.TRANSPARENT_MATERIAL);return r==null?void 0:r(G.Color)}))}hasHighlights(){return this._highlightRenderInstanceData[0].some(e=>e.size>0)}_produces(e){return e!==G.Highlight&&e!==G.ShadowHighlight||this.hasHighlights()}prepareRender(e){if(!kr.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const i=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),i||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(Nu),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const i=this._getInstanceDatas(e.output);if(!i)return null;const r=new Array;return i.forEach(s=>this.levels.forEach((n,o)=>{n.components.forEach(a=>r.push(this._beginComponent(e,s[o],a)))})),r}renderNode(e,i){const r=this._getInstanceDatas(e.output);if(!r||i==null)return;let s=0;e.rctx.bindVAO(),r.forEach(n=>this.levels.forEach((o,a)=>{o.components.forEach(l=>this._renderComponent(e,i[s++],n[a],l,a))}))}_getInstanceDatas(e){const i=e!==G.Highlight&&e!==G.ShadowHighlight,r=e!==G.ShadowExcludeHighlight;return i&&r?this._allRenderInstanceData:i?this._defaultRenderInstanceData:r?this._highlightRenderInstanceData:null}intersect(e,i,r,s){if(!this.baseMaterial.isVisible()||this._octree==null)return;const n=C();$e(n,s,r);const o=a=>{this._instanceData.getCombinedModelTransform(a,V_e),e.transform.set(V_e),nt(z_e,r,e.transform.inverse),nt(B_e,s,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),u=this._levels.length;bt(!!(l&ds.ACTIVE),"invalid instance state"),bt(c>=0&&c<u,"invaid lod level"),this._levels[c].intersect(e,i,z_e,B_e,a,this.metadata,u)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(r,n,o)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(this._octreeCached==null){const i=this._instanceData,r=(e=i.view)==null?void 0:e.state;if(!r)return null;this._octreeCached=new HPt(i,this.baseBoundingSphere);for(let s=0;s<i.capacity;++s)r.get(s)&ds.ACTIVE&&this._octreeCached.addInstance(s)}return this._octreeCached}_invalidateOctree(){this._octreeCached=He(this._octreeCached)}queryDepthRange(e){if(this._octree==null)return{near:1/0,far:-1/0};const i=e.viewForward,r=this._octree.findClosest(i,Wf.DepthOrder.FRONT_TO_BACK,e.frustum),s=this._octree.findClosest(i,Wf.DepthOrder.BACK_TO_FRONT,e.frustum);if(r==null||s==null)return{near:1/0,far:-1/0};const n=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(r,km),$e(km,km,n);const a=Te(km,i)-km[3];o.boundingSphere.getVec(s,km),$e(km,km,n);const l=Te(km,i)+km[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(i=>i.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:i,_camera:r,_levelSelector:s}=this;this._allRenderInstanceData.forEach(d=>d.forEach(f=>f.beginUpdate()));const n=this._instanceData,o=n.view;let a=n.size;const l=n.capacity;let c=this._instanceIndex;const u=Math.ceil(l/500);for(let d=0;d<a&&!e.done;++d){c===this._cycleStartIndex&&this._startUpdateCycle();const f=o.state.get(c);let m=0;if(!(f&ds.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const g=o.lodLevel.get(c);if(f&ds.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][g].freeTail(),f&ds.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][g].freeTail(),f&ds.REMOVE)n.freeInstance(c);else if(f&ds.VISIBLE){let y=0;i&&(o.modelOrigin.getVec(c,U_e),y=s.selectLevel(U_e,n.getCombinedMedianScaleFactor(c),r)),m=f&~(ds.ACTIVE|ds.TRANSFORM_CHANGED),y>=0&&(f&ds.HIGHLIGHT?(k_e(this._highlightRenderInstanceData[0][y],o,c),m|=ds.HIGHLIGHT_ACTIVE):(k_e(this._defaultRenderInstanceData[0][y],o,c),m|=ds.DEFAULT_ACTIVE)),o.state.set(c,m),o.lodLevel.set(c,y)}else m=f&~(ds.ACTIVE|ds.TRANSFORM_CHANGED),o.state.set(c,m);if(this._octreeCached!=null){const y=!!(f&ds.ACTIVE),v=!!(m&ds.ACTIVE);!y&&v?this._octreeCached.addInstance(c):y&&!v?this._octreeCached.removeInstance(c):y&&v&&f&ds.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,c%u==0&&e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach(d=>d.forEach(f=>f.endUpdate())),this._context.requestRender()}_beginComponent(e,i,r){if(i.size===0)return null;const s=r.glMaterials.load(e.rctx,e.bindParameters.slot,e.output);return s!=null?s.beginSlot(e.bindParameters):null}_renderComponent(e,i,r,s,n){if(!i)return;const{bindParameters:o,rctx:a}=e;a.runAppleAmdDriverHelper();const l=a.bindTechnique(i,o,s.material.parameters,KPt);a.bindVAO(s.vao),i.ensureAttributeLocations(s.vao),kr.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===G.Color&&(l.setUniform4fv("externalColor",j_e[Math.min(n,j_e.length-1)]),l.setUniform1i("colorMixMode",JLe.replace));const c=r.capacity,u=r.headIndex,d=r.tailIndex,f=r.firstIndex,m=this._glInstanceBufferLayout,g=(y,v)=>{Vne(a,Pi,r.buffer,m,y),a.drawArraysInstanced(i.primitiveType,0,s.vertexCount,v-y),dIe(a,Pi,r.buffer,m)};s.material.parameters.transparent&&f!=null?u>d?(bt(f>=d&&f<=u,"invalid firstIndex"),g(f,u),g(d,f)):u<d&&(f<=u?(bt(f>=0&&f<=u,"invalid firstIndex"),g(f,u),g(d,c),g(0,f)):(bt(f>=d&&f<=c,"invalid firstIndex"),g(f,c),g(0,u),g(d,f))):u>d?g(d,u):u<d&&(g(0,u),g(d,c)),a.bindVAO(null)}};function k_e(t,e,i){const r=t.allocateHead();JPt(e,i,t.view,r)}function JPt(t,e,i,r){upt(t.modelOrigin,e,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,t.model,e),i.modelNormal.copyFrom(r,t.modelNormal,e),t.color&&i.color&&i.color.copyFrom(r,t.color,e),t.objectAndLayerIdColor&&i.objectAndLayerIdColor&&i.objectAndLayerIdColor.copyFrom(r,t.objectAndLayerIdColor,e),t.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,t.featureAttribute,e)}function QPt(t){let e=Ds().vec3f($.INSTANCEMODELORIGINHI).vec3f($.INSTANCEMODELORIGINLO).mat3f($.INSTANCEMODEL).mat3f($.INSTANCEMODELNORMAL);return t!=null&&t.includes("featureAttribute")&&(e=e.vec4f($.INSTANCEFEATUREATTRIBUTE)),t!=null&&t.includes("color")&&(e=e.vec4u8($.INSTANCECOLOR)),t!=null&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8($.INSTANCEOBJECTANDLAYERIDCOLOR)),e}h([p({constructOnly:!0})],Od.prototype,"symbol",void 0),h([p({constructOnly:!0})],Od.prototype,"optionalFields",void 0),h([p({constructOnly:!0})],Od.prototype,"metadata",void 0),h([p({constructOnly:!0})],Od.prototype,"shaderTransformation",void 0),h([p()],Od.prototype,"_instanceData",void 0),h([p()],Od.prototype,"_cycleStartIndex",void 0),h([p({readOnly:!0})],Od.prototype,"_enableLevelSelection",null),h([p()],Od.prototype,"_updateCyclesWithStaticCamera",void 0),h([p({readOnly:!0})],Od.prototype,"running",null),Od=h([I("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],Od);const U_e=C(),km=ci(),V_e=ke(),z_e=C(),B_e=C(),j_e=[ri(1,0,1,1),ri(0,0,1,1),ri(0,1,0,1),ri(1,1,0,1),ri(1,0,0,1)],KPt=new d1t;let G_e=class{constructor(e,i,r,s,n,o,a,l,c,u,d,f){this.lodResources=e,this.lodRenderer=i,this.stageResources=r,this.originalMaterialParameters=s,this.resourceSize=n,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=u,this.physicalBasedRenderingEnabled=d,this.pivotOffset=f}},eOt=class extends zy{getCachedSize(){const[e,i,r]=this._resources!=null?this._resources.symbolSize:[1,1,1];return{width:e,depth:i,height:r}}constructor(e,i,r,s){super(e,i,r,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}async doLoad(e){var i;if(!this._drivenProperties.size&&n8(this.symbolLayer))throw new Error;if(this._isPrimitive){const r=this.symbolLayer.resource,s=r&&nvt(r==null?void 0:r.primitive)?r.primitive:Cne;this._resources=await this._createResourcesForPrimitive(s,e)}else{const r=await VPt(this.symbol.styleOrigin),s=(r==null?void 0:r.href)??((i=this.symbolLayer.resource)==null?void 0:i.href);this._resources=await this._createResourcesForUrl(s,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return this._resources!=null?this._resources.extentPadding:0}get _isPrimitive(){var e;return!((e=this.symbolLayer.resource)!=null&&e.href)}get lodRenderer(){var e;return(e=this._resources)==null?void 0:e.lodRenderer}get materials(){var e;return((e=this._resources)==null?void 0:e.stageResources.materials)??[]}_setMaterialTransparencyParameters(e,i=(s=>(s=(r=>(r=this.symbolLayer)==null?void 0:r.material)())==null?void 0:s.color)()){const n=this._getCombinedOpacity(i),o=n<1||this.needsDrivenTransparentPass;return e.transparent=o,e.opacity=n,e.cullFace=o?Gr.None:Gr.Back,e}async _createResourcesForPrimitive(e,i){const r=this.symbolLayer,s=io(blt(e)),n=Xl(TU(s)),o=Xl(rq(n,r)),a=Ve(o),l=!1,c=!1,u={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...nae],ambient:o_,diffuse:o_,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},d=!!u.usePBR;this._setMaterialTransparencyParameters(u);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:w,minWorldLength:x,maxWorldLength:T}=f.verticalOffset;u.verticalOffset={screenLength:mr(w),minWorldLength:x||0,maxWorldLength:T??1/0},u.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(u.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)u.externalColor=Kd;else{const w=r.material!=null?r.material.color:null,x=w!=null?je.toUnitRGBA(w):Kd;u.externalColor=x}this._fastUpdates=GP(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,null)),u.isInstanced=!0,this._fastUpdates?(Object.assign(u,this._fastUpdates.materialParameters),this._optionalFields.push($.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(u.hasInstancedColor=!0,this._optionalFields.push($.COLOR)),ue("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push($.OBJECTANDLAYERIDCOLOR);const m=new gm(u),g=UDe(e,m);if(!g)throw new Error(`Unknown object symbol primitive: ${e}`);const y=F4(g).map(w=>({opacity:1,transparent:w.parameters.transparent})),v=await this._createStageResources(g,d,i),b=await this._createLodRenderer(g,i);return new G_e(g,b,v,y,n,l,c,s,o,a,d,null)}async _createResourcesForUrl(e,i){var k,H;const r={materialParameters:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=GP(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(r.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push($.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(r.materialParameters.hasInstancedColor=!0,this._optionalFields.push($.COLOR)),ue("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push($.OBJECTANDLAYERIDCOLOR);const s=this.symbol;if(s.type==="point-3d"&&s.verticalOffset){const{screenLength:V,minWorldLength:X,maxWorldLength:q}=s.verticalOffset;r.materialParameters.verticalOffset={screenLength:mr(V),minWorldLength:X||0,maxWorldLength:q??1/0},r.materialParameters.castShadows=!1}const n=this._context.physicalBasedRenderingEnabled;r.signal=i,r.usePBR=n,r.skipHighLods=this._context.skipHighSymbolLods;const o=await lke(e,r),a=o.isEsriSymbolResource,l=o.isWosr,c=TAt(o.lods),u=this._context,d=this.symbolLayer.material,f=this._getExternalColorParameters(d),m=(H=(k=this.symbolLayer)==null?void 0:k.material)==null?void 0:H.color,g=this._getCombinedOpacity(m,{hasIntrinsicColor:!0}),y=this.needsDrivenTransparentPass,v=F4(c),b=F4(c).map(V=>({opacity:V.parameters.opacity||1,transparent:V.parameters.transparent}));v.forEach(V=>{const X=V.parameters;V.setParameters(f);const q=X.opacity*g,Z=q<1||y||X.transparent;V.setParameters({opacity:q,transparent:Z}),u.screenSizePerspectiveEnabled&&V.setParameters({screenSizePerspective:u.sharedResources.screenSizePerspectiveSettings})});const w=o.referenceBoundingBox,x=Xl(TU(w)),T=Xl(c.levels[0].pivotOffset),E=Xl(rq(x,this.symbolLayer)),M=Ve(E),O=this._fastUpdates;HP(O,this._context.renderer,this._fastVisualVariableConvertOptions(w,E,x,T))&&v.forEach(V=>V.setParameters(O.materialParameters));const D=await this._createStageResources(c,n,i),U=await this._createLodRenderer(c,i);return new G_e(c,U,D,b,x,a,l,w,E,M,n,T)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,i,r){const s=this._context.stage,n=F4(e);i!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),s.addMany(n),this._addDisposeResource(()=>s.removeMany(n));const o=Rge(e);s.addMany(o),this._addDisposeResource(()=>{o.forEach(l=>l.unload()),s.removeMany(o)}),await Promise.all(o.map(l=>this._context.stage.schedule(()=>l.load(s.renderView.renderingContext),r))),Dt(r);const a=Ige(e);return s.addMany(a),this._addDisposeResource(()=>s.removeMany(a)),{materials:n,textures:o,geometries:a}}async _createLodRenderer(e,i){const r=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:l=>this._instanceIndexToGraphicUid.get(l),notifyGraphicGeometryChanged:l=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(l)),notifyGraphicVisibilityChanged:l=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(l))},n=this._fastUpdates,o=n?{applyTransform:(l,c,u)=>{l.getFeatureAttribute(c,m5),An(u,_0t(n.materialParameters,m5,u))},scaleFactor:(l,c,u)=>{c.getFeatureAttribute(u,m5),Foe(l,n.materialParameters,m5)}}:null,a=new Od({symbol:e,optionalFields:this._optionalFields,metadata:s,shaderTransformation:o},this._context.scheduler);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{r.removeRenderPlugin(a),a.destroy()}),await r.addRenderPlugin(a,i),a}_getExternalColorParameters(e){const i={};return this._drivenProperties.color?i.externalColor=Kd:(e==null?void 0:e.color)!=null?i.externalColor=je.toUnitRGBA(e.color):(i.externalColor=Kd,i.colorMixMode="ignore"),i}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;const r=GS(i.geometry);if(r==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const s=this.setGraphicElevationContext(i),n=e.renderingInfo;return this._createAs3DShape(i,r,n,s,i.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){var n,o;if(this._resources==null)return;const e=this._drivenProperties.opacity,i=!this._isPrimitive,r=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let a=0;a<r.length;a++){const l=r[a],c=(o=(n=this.symbolLayer)==null?void 0:n.material)==null?void 0:o.color,u=s[a],d=this._getCombinedOpacity(c,{hasIntrinsicColor:i})*u.opacity,f=d<1||e||u.transparent;l.setParameters({opacity:d,transparent:f}),this._isPrimitive&&l.setParameters({cullFace:f?Gr.None:Gr.Back})}}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,ow)}slicePlaneEnabledChanged(){if(this._resources==null)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(this._resources==null)return!0;const{stageResources:e,isWosr:i}=this._resources;for(const r of e.materials)this._isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,i){if(this._resources==null)return mn.RecreateSymbol;const{stageResources:{materials:r},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!HP(this._fastUpdates,i,this._fastVisualVariableConvertOptions(n,o,a,l)))return mn.RecreateSymbol;for(const u of r)u.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return mn.FastUpdate}computeComplexity(){if(this._resources==null)return super.computeComplexity();const e=this._resources.lodResources,i=CNe(e.levels),r=a=>Array.from(a.attributes.values()).reduce((l,c)=>l+Db(c.data,c.indices),0),s=Ige(e).reduce((a,l)=>a+r(l),0),n=Rge(e).reduce((a,l)=>a+l.memoryEstimate,0)+s,o={...ENe(this.symbol,this.symbolLayer),resourceBytes:n};return new qd({verticesPerFeature:i,memory:o})}_hasLodRenderer(){return this._resources!=null}_createAs3DShape(e,i,r,s,n,o){if(!this._hasLodRenderer()||this._resources==null)return null;const a=this.getFastUpdateAttrValues(e),l=this._context.clippingExtent;if(xl(i,JE,this._context.elevationProvider.spatialReference),l!=null&&!xne(l,JE))return null;const c=q_e(s),u=this._computeGlobalTransform(i,s,m7,g5),d=this._computeLocalTransform(this._resources,this.symbolLayer,r,W_e),f=this._resources.lodRenderer.instanceData,m=f.addInstance();this._instanceIndexToGraphicUid.set(m,n),f.setLocalTransform(m,d,!1),f.setGlobalTransform(m,u),a&&f.setFeatureAttribute(m,a),this._fastUpdates==null&&this._hasPerInstanceColor()&&f.setColor(m,H3(r.color,r.opacity,255)),this._context.stage.renderView.objectAndLayerIdRenderHelper!=null&&f.setObjectAndLayerIdColor(m,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:o}));const g=new bAt(this,m,B_t,s);return c&&(g.alignedSampledElevation=g5.sampledElevation),g.needsElevationUpdates=ow(s.mode),C2(g,i,this._context.elevationProvider),g}_computeGlobalTransform(e,i,r,s){return nw(e,this._context.elevationProvider,i,this._context.renderCoordsHelper,s),JE[0]=e.x,JE[1]=e.y,JE[2]=s.z,Gh(e.spatialReference,JE,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(e,i,r,s){return mp(s),this._applyObjectRotation(r,!1,s),this._applyObjectRotation(i,!0,s),this._applyObjectScale(e,r,s),this._applyAnchor(e,i,s),s}_applyObjectScale(e,i,r){var o;if((o=this._fastUpdates)!=null&&o.requiresShaderTransformation)return;const s=this._drivenProperties.size&&i.size?i.size:e.symbolSize,n=Oge(s,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||YD(r,r,n)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const i=e.diff.diff;this._preparePatchTransform(e,i),this._preparePatchColor(e,i)}updateGeometry(e,i){if(this._resources==null)return!0;const r=i&&GS(i);if(r==null)return!1;const s=this.getGeometryElevationMode(i);return e.elevationContext.mode===s&&(this._computeGlobalTransform(r,e.elevationContext,m7,g5),q_e(e.elevationContext)&&(e.alignedSampledElevation=g5.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,m7,!0),C2(e,r,this._context.elevationProvider),!0)}_preparePatchTransform(e,i){if(!(i.heading||i.tilt||i.roll||i.width||i.height||i.depth||i.anchor||i.anchorPosition)||this._resources==null)return;const r=(g,y,v)=>(g!=null&&g.type==="complete"?g.newValue:y)??v,s=r(i.heading,this.symbolLayer.heading,0),n=r(i.tilt,this.symbolLayer.tilt,0),o=r(i.roll,this.symbolLayer.roll,0),a=r(i.width,this.symbolLayer.width,void 0),l=r(i.height,this.symbolLayer.height,void 0),c=r(i.depth,this.symbolLayer.depth,void 0),u=r(i.anchor,this.symbolLayer.anchor,void 0),d=r(i.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete i.heading,delete i.tilt,delete i.roll,delete i.width,delete i.height,delete i.depth,delete i.anchor,delete i.anchorPosition;const f={heading:s,tilt:n,roll:o,anchor:u,anchorPosition:d},m=this._resources;this.loadStatus===Ph.LOADED&&e.symbolLayerStatePatches.push(()=>{m.symbolSize=Xl(rq(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((g,y)=>{const v=this._computeLocalTransform(m,f,y,W_e),b=g.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(b,v,!0)})}_preparePatchColor(e,i){if(!i.material||i.material.type!=="partial")return;const r=i.material.diff;if(!r.color||r.color.type!=="complete"||r.color.newValue==null||r.color.oldValue==null)return;const s=r.color.newValue,n=s!=null?je.toUnitRGBA(s):Kd;delete r.color;const o=this._resources;o!=null&&e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParameters({},s)):l=this._setMaterialTransparencyParameters({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_applyObjectRotation(e,i,r){var s;if(!((s=this._fastUpdates)!=null&&s.requiresShaderTransformation)||!i)return ivt(e.heading,e.tilt,e.roll,r)}_applyAnchor(e,i,r){var n;if((n=this._fastUpdates)!=null&&n.requiresShaderTransformation)return;const s=H_e(e.resourceBoundingBox,e.pivotOffset,i);s&&wl(r,r,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,i,r,s){const n=e!=null?Xl(TU(e)):o_,o=e!=null?H_e(e,s,this.symbolLayer):Nn,a=this._context.renderCoordsHelper.unitInMeters,l=Oge(i??void 0,i,r,a),c=qe(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new vN({size:!0,color:!0,rotation:!0,opacity:!1},n,i??o_,a,o,l,c)}};function H_e(t,e,i){const r=C();switch(i.anchor){case"center":ve(r,jf(t)),da(r,r);break;case"top":{const s=jf(t);pe(r,-s[0],-s[1],-t[5]);break}case"bottom":{const s=jf(t);pe(r,-s[0],-s[1],-t[2]);break}case"relative":{const s=jf(t),n=TU(t),o=i.anchorPosition,a=o?qe(o.x,o.y,o.z):Nn;OG(r,n,a),Ee(r,r,s),da(r,r);break}default:e!=null?da(r,e):ve(r,Nn)}return r}function q_e(t){return t.mode!=="absolute-height"}const JE=C(),W_e=ke(),m7=ke(),m5=ci(),g5=new xN;let tOt=class{constructor(e,i,r,s){this.vertices=e,this.positionsES=i,this.offset=s;const n=e.length,o=Math.floor(n/2),a=this.offset+3*o,l=r[a],c=r[a+1],u=r[a+2];this.origin=qe(l,c,u),this.positions=$s(3*n);const d=this.offset+3*n;for(let f=this.offset;f<d;f+=3)this.positions[f]=r[f]-l,this.positions[f+1]=r[f+1]-c,this.positions[f+2]=r[f+2]-u;this.updatePathVertexInformation()}get usedMemory(){return Db(this.positions)}updatePathVertexInformation(){const e=this.vertices.length,i=this.vertices[0];let r=this.offset;const s=this.positions;i.vRight[0]=s[r+3]-s[r],i.vRight[1]=s[r+4]-s[r+1],i.vRight[2]=s[r+5]-s[r+2],r+=3;let n=Ve(i.vRight);i.vMinSiblingLength=n,Ce(i.vRight,i.vRight);let o=i;for(let a=1;a<e;++a){const l=this.vertices[a];if(l.vLeft=o.vRight,a<e-1){l.vRight[0]=s[r+3]-s[r],l.vRight[1]=s[r+4]-s[r+1],l.vRight[2]=s[r+5]-s[r+2];const c=Ve(l.vRight);l.vMinSiblingLength=Math.min(n,c),n=c,Ce(l.vRight,l.vRight)}else ve(l.vRight,l.vLeft),l.vMinSiblingLength=n;o=l,r+=3}}},iOt=class{constructor(e,i,r,s,n,o={}){this.path=e,this.profile=i,this.extruder=r,this.startCap=s,this.endCap=n,this.options=o,this._extrusionVertexCount=0;const a=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*a+2,this.numVerticesTotal=i.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.numVertices;this.numVerticesTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.numVertices;this.numVerticesTotal+=c,this.pathVertexData=ipt(1*this.numVerticesTotal),this.profileRightAxes=$s(4*this.numVerticesTotal),this.profileUpAxes=$s(4*this.numVerticesTotal),this.profileVertexAndNormals=$s(4*this.numVerticesTotal),this.positions=OB(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}get usedMemory(){return Db(this.pathVertexData,this.profileRightAxes,this.profileUpAxes,this.profileVertexAndNormals)+this.path.usedMemory+this.profile.usedMemory}emitVertex(e,i,r,s,n){const o=4*this._extrusionVertexCount;if(this.profileRightAxes[o]=i.right[0],this.profileRightAxes[o+1]=i.right[1],this.profileRightAxes[o+2]=i.right[2],this.profileUpAxes[o]=i.up[0],this.profileUpAxes[o+1]=i.up[1],this.profileUpAxes[o+2]=i.up[2],this.profileVertexAndNormals[o]=r[0],this.profileVertexAndNormals[o+1]=r[1],this.profileVertexAndNormals[o+2]=s[0],this.profileVertexAndNormals[o+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,n){const a=this.path.vertices[e],l=a.maxStretchDistance;this.profileRightAxes[o+3]=a.rotationRight[0]*l,this.profileUpAxes[o+3]=a.rotationRight[1]*l}else this.profileRightAxes[o+3]=0,this.profileUpAxes[o+3]=0;++this._extrusionVertexCount}emitCapVertex(e,i,r,s,n,o){const a=4*this._extrusionVertexCount;this.profileRightAxes[a]=i.right[0],this.profileRightAxes[a+1]=i.right[1],this.profileRightAxes[a+2]=i.right[2],this.profileRightAxes[a+3]=n,this.profileUpAxes[a]=i.up[0],this.profileUpAxes[a+1]=i.up[1],this.profileUpAxes[a+2]=i.up[2],this.profileUpAxes[a+3]=o,this.profileVertexAndNormals[a]=r[0],this.profileVertexAndNormals[a+1]=r[1],this.profileVertexAndNormals[a+2]=s[0],this.profileVertexAndNormals[a+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:i,vertices:r}=this.path;this.positions=OB(e,i,3*r.length);let s=0;const n=(a,l,c,u,d)=>this.emitCapVertex(s,a,l,c,u,d),o=(a,l,c,u)=>this.emitVertex(s,a,l,c,u);for(this.startCap.rebuildConnectingProfileGeometry(r[s],this.profile,n),s=1;s<r.length-1;++s)this.extruder.extrude(r[s],this.profile,o);this.endCap.rebuildConnectingProfileGeometry(r[s],this.profile,n),s=0,this.startCap.rebuildCapGeometry(r[s],n),s=r.length-1,this.endCap.rebuildCapGeometry(r[s],n)}buildTopology(){const e=this.profile.vertices.length,i=this.profile.numSegments,r=this.numExtrusionProfiles-1;let s=3*(2*(i*r));this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.numIndices,this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const n=new Array,o=new Array,a=new Array,l=(c,u,d)=>{n.push(c),n.push(u),n.push(d),o.push(c),o.push(u),o.push(d),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[u]),a.push(this.pathVertexData[d])};for(let c=0;c<i;++c){const u=this.profile.indices[2*c],d=this.profile.indices[2*c+1];for(let f=0;f<r;++f){const m=f*e+u,g=(f+1)*e+d,y=f*e+d;l(m,(f+1)*e+u,g),l(m,g,y)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=oy(n),this.normalIndices=oy(o),this.pathVertexIndices=oy(a)}onPathChanged(){this._rebuildGeometry()}},rle=class{rebuildConnectingProfileGeometry(e,i,r){for(let s=0;s<i.vertices.length;++s)r(e.frame,i.vertices[s],i.normals[s],0,0)}},Z_e=class extends rle{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}},y5=class extends rle{constructor(e,i=0,r=!1){super(),this.profile=e,this.profilePlaneOffset=i,this.flip=r}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,i,r){const s=this.profilePlaneOffset;for(let n=0;n<i.vertices.length;++n)r(e.frame,i.vertices[n],i.normals[n],s,0)}rebuildCapGeometry(e,i){const r=this.profile,s=this.flip?1:-1,n=this.profilePlaneOffset,o=yke;Di(o,0,0);for(let a=0;a<r.vertices.length;++a)i(e.frame,r.vertices[a],o,n,s)}buildTopology(e,i){const r=this.profile,s=this.vertexBufferStart+r.indices[0];for(let n=1;n<r.numSegments;++n){const o=r.indices[2*n],a=r.indices[2*n+1],l=this.vertexBufferStart+o,c=this.vertexBufferStart+a;this.flip?i(c,l,s):i(s,l,c)}}},Y_e=class extends rle{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const i=this.profile;e+=2*i.numSegments*(this.numSegments-1);for(let r=0;r<i.numSegments;++r){const s=i.indices[2*r],n=i.indices[2*r+1];i.poleIndices[s]===i.poleIndices[n]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,i){const r=this.profile,s=e.frame,n=.5*this.sign,o=rOt,a=yke;Di(a,0,0);for(const l of r.poles)l.normal?i(s,l.position,l.normal,n,0):i(s,l.position,a,n,this.sign);if(this.breakNormals)for(let l=0;l<r.vertices.length;++l)i(s,r.vertices[l],r.normals[l],0,0);for(let l=0;l<this.numSegments-1;++l){const c=(1-(l+1)/this.numSegments)*Math.PI*.5,u=Math.sin(c),d=Math.cos(c);for(let f=0;f<r.vertices.length;++f){const m=r.poles[r.poleIndices[f]];Ng(o,r.vertices[f],m.position),Rh(o,o,u),m.normal?(Tf(o,o,m.position),i(s,o,m.normal,n*d,0)):(JL(a,o),Rh(a,a,u),Tf(o,o,m.position),i(s,o,a,n*d,this.sign*d))}}}buildTopology(e,i){const r=this.profile,s=this.breakNormals?this.vertexBufferStart+r.poles.length:this.firstProfileVertexIndex,n=this.breakNormals?this.vertexBufferStart+r.poles.length+r.vertices.length:this.vertexBufferStart+r.poles.length;for(let o=0;o<r.numSegments;++o){const a=r.indices[2*o],l=r.indices[2*o+1],c=this.vertexBufferStart+r.poleIndices[a],u=this.vertexBufferStart+r.poleIndices[l];let d=s+a,f=s+l;for(let m=0;m<this.numSegments-1;++m){const g=n+m*r.vertices.length+a,y=n+m*r.vertices.length+l;this.flip?(i(g,f,d),i(f,g,y)):(i(d,f,g),i(y,g,f)),d=g,f=y}this.flip?(i(c,f,d),c!==u&&i(c,u,f)):(i(d,f,c),c!==u&&i(f,u,c))}}};const rOt=gt(),yke=gt();let sOt=class{numProfilesPerJoin(){return 1}extrude(e,i,r){for(let s=0;s<i.vertices.length;++s)r(e.frame,i.vertices[s],i.normals[s],!1)}},g7=class{constructor(e,i){this.cutoffAngle=e,this.numBendSubdivisions=i}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,i,r){const s=oOt,{rotationAngle:n,rotationRight:o,frame:a}=e;if(Math.abs(n)>=this.cutoffAngle){const l=e.rotationFrameUp;for(let c=0;c<this.numBendSubdivisions+1;++c){qu(J_e,.5*-n+c*n/this.numBendSubdivisions,l),nOt(s,a,J_e);for(let u=0;u<i.vertices.length;++u)Wn(i.vertices[u],o)*n>=0?r(s,i.vertices[u],i.normals[u],!1):r(a,e.applyMiterStretch(X_e,i.vertices[u]),i.normals[u],!0)}}else for(let l=0;l<this.numBendSubdivisions+1;++l)for(let c=0;c<i.vertices.length;++c){const u=Wn(i.vertices[c],o)*n>=0;r(a,e.applyMiterStretch(X_e,i.vertices[c]),i.normals[c],!u)}}},_ke=class{constructor(){this.up=C(),this.right=C()}};function nOt(t,e,i){nt(t.up,e.up,i),nt(t.right,e.right,i)}const X_e=gt(),J_e=ke(),oOt=new _ke;let aOt=class extends Pn{constructor(e,i,r,s,n,o){super(e,i,null,Gs.Mesh,o),this.path=r,this.geometrySR=s,this.stencilWidth=n}};var cy;function vke(t){return"path"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(cy||(cy={}));let bke=class{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}},wke=class extends bke{constructor(e){super(e),this.vertexAttributeColor=ri(255,255,255,255),this.size=new Array,this.vertexAttributePosition=$s(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:i,pathVertexData:r,path:s,positions:n,profileRightAxes:o,profileUpAxes:a,profileVertexAndNormals:l}=this.builder;for(let c=0;c<i;++c){let u=r[c];const d=u===0||u===s.vertices.length-1;u*=3;const f=dOt;let m=0,g=0;const y=4*c,v=pe(pOt,o[y],o[y+1],o[y+2]),b=pe(fOt,a[y],a[y+1],a[y+2]),w=Di(Q_e,l[y]*e[0],l[y+1]*e[1]);if(d)mt(f,b,v),m=o[y+3]*e[0],g=a[y+3];else{const M=cOt,O=uOt;Di(M,o[y+3],a[y+3]);const D=Dne(M);JL(M,M);const U=Wn(w,M);if(Math.abs(U)>D){Di(O,-M[1],M[0]);const k=Wn(w,O);Rh(M,M,D*Math.sign(U)),Rh(O,O,k),Tf(w,M,O)}pe(f,0,0,0)}const x=pe(hOt,v[0]*w[0]+b[0]*w[1],v[1]*w[0]+b[1]*w[1],v[2]*w[0]+b[2]*w[1]),T=3*c;this.vertexAttributePosition[T]=n[u]+x[0]+f[0]*m,this.vertexAttributePosition[T+1]=n[u+1]+x[1]+f[1]*m,this.vertexAttributePosition[T+2]=n[u+2]+x[2]+f[2]*m;const E=Di(Q_e,l[y+2],l[y+3]);vp(this.vertexAttributeNormal,c,v[0]*E[0]+b[0]*E[1]+f[0]*g,v[1]*E[0]+b[1]*E[1]+f[1]*g,v[2]*E[0]+b[2]*E[1]+f[2]*g)}}createGeometryData(){const e=this.builder.vertexIndices.length,{normalIndices:i,vertexIndices:r}=this.builder;return[[$.POSITION,new ht(this.vertexAttributePosition,r,3,!0)],[$.NORMALCOMPRESSED,new ht(this.vertexAttributeNormal,i,2,!0)],[$.COLOR,new ht(this.vertexAttributeColor,Ew(e),4)]]}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,i,r,s){const n=this.builder.vertexIndices,o=new rN(this.vertexAttributePosition,3),a=n.length/3;WDe(e,i,0,a,n,o,void 0,r,(l,c,u)=>{s(l,u,c,!1)})}},lOt=class extends bke{constructor(e,i,r,s){super(e),this.sizeAttributeValue=i,this.colorAttributeValue=r,this.opacityAttributeValue=s,this.vvData=null,this.baked=new wke(e),this.vvData=$s(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n]=i,this.vvData[4*n+1]=r,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){const{positions:e,profileRightAxes:i,profileUpAxes:r,profileVertexAndNormals:s,pathVertexIndices:n,vertexIndices:o}=this.builder;return[[$.POSITION,new ht(e,n,3,!0)],[$.PROFILERIGHT,new ht(i,o,4,!0)],[$.PROFILEUP,new ht(r,o,4,!0)],[$.PROFILEVERTEXANDNORMAL,new ht(s,o,4,!0)],[$.FEATUREVALUE,new ht(this.vvData,n,4,!0)]]}onPathChanged(e){super.onPathChanged(e);const i=e.getMutableAttribute($.POSITION);i&&(i.data=this.builder.positions)}};const Q_e=gt(),cOt=gt(),uOt=gt(),hOt=C(),dOt=C(),pOt=C(),fOt=C();function mOt(t,e){let i=null;const r=t.vertices.length,s=.99619469809,n=C(),o=C(),a=C(),l=C(),c=C(),u=C(),d=rr();let f=t.vertices[0];ve(o,e),pe(n,0,1,0),IB(f.vRight,o,n,n,a,o,s),ve(f.frame.up,o),ve(f.frame.right,a);const m=t.positions;let g=t.offset;i=f;for(let y=1;y<r;++y){f=t.vertices[y],Ee(c,f.vLeft,f.vRight);let v=Ve(c);v>0?(v=1/Math.sqrt(v),c[0]=c[0]*v,c[1]=c[1]*v,c[2]=c[2]*v):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),u[0]=m[g]+i.frame.up[0],u[1]=m[g+1]+i.frame.up[1],u[2]=m[g+2]+i.frame.up[2],g+=3;const b=pe(gOt,m[g],m[g+1],m[g+2]);KD(b,c,d),G2(d,td(u,f.vLeft),l)?(l[0]-=m[g],l[1]-=m[g+1],l[2]-=m[g+2],Ce(o,l),mt(a,c,o),Ce(a,a)):IB(c,i.frame.up,i.frame.right,n,a,o,s),ve(f.frame.up,o),ve(f.frame.right,a),i=f}}const gOt=C();let xke=class{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,i){return this.vertices.push(MR(e)),this.normals.push(MR(i)),this.vertices.length-1}addPole(e,i=null){return this.poles.push({position:MR(e),normal:i?MR(i):null}),this.poles.length-1}addSegment(e,i=null){this.indices.push(e.v0),this.indices.push(e.v1),i&&(this.poleIndices.push(i.v0),this.poleIndices.push(i.v1))}get numSegments(){return this.indices.length/2}translate(e,i){for(const r of this.vertices)r[0]+=e,r[1]+=i;for(const r of this.poles)r.position[0]+=e,r.position[1]+=i}get usedMemory(){return this.vertices.length*Db(this.vertices[0])*2+Db(this.indices)}};const Tke={top:[0,-.5],bottom:[0,.5]};function y7(t){const i=DDe,r=new xke,s={v0:0,v1:0};r.addPole(Ei(0,0));for(let o=0;o<i;++o){const a=2*o*Math.PI/i,l=Math.cos(a),c=Math.sin(a),u=Ei(l*.5,c*.5),d=Ei(l,c);r.addVertex(u,d)}for(let o=0;o<i-1;++o){const a={v0:o,v1:o+1};r.addSegment(a,s)}const n={v0:i-1,v1:0};if(r.addSegment(n,s),t!=="center"){const o=Tke[t];r.translate(o[0],o[1])}return r}const yOt={center:y7("center"),top:y7("top"),bottom:y7("bottom")},_Ot={center:_7("center"),top:_7("top"),bottom:_7("bottom")};function _7(t){const r=new xke,s=Ei(.5*-1,.5*-1),n=Ei(.5*1,.5*-1),o=Ei(.5*1,.5*1),a=Ei(.5*-1,.5*1),l=Ei(0,-1),c=Ei(1,0),u=Ei(0,1),d=Ei(-1,0);if(r.addPole(Ei(0,.5*1),u),r.addPole(Ei(0,.5*1)),r.addPole(Ei(0,.5*-1)),r.addPole(Ei(0,.5*-1),l),r.addVertex(s,l),r.addVertex(n,l),r.addSegment({v0:0,v1:1},{v0:3,v1:3}),r.addVertex(n,c),r.addVertex(o,c),r.addSegment({v0:2,v1:3},{v0:2,v1:1}),r.addVertex(o,u),r.addVertex(a,u),r.addSegment({v0:4,v1:5},{v0:0,v1:0}),r.addVertex(a,d),r.addVertex(s,d),r.addSegment({v0:6,v1:7},{v0:1,v1:2}),t!=="center"){const f=Tke[t];r.translate(f[0],f[1])}return r}function vOt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function bOt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function Ske(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function wOt(t,e){if(t===e){const i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function xOt(t,e){const i=e[0],r=e[1],s=e[2],n=e[3];let o=i*n-s*r;return o?(o=1/o,t[0]=n*o,t[1]=-r*o,t[2]=-s*o,t[3]=i*o,t):null}function TOt(t,e){const i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t}function SOt(t){return t[0]*t[3]-t[2]*t[1]}function Eke(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=r*a+n*l,t[1]=s*a+o*l,t[2]=r*c+n*u,t[3]=s*c+o*u,t}function EOt(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+n*a,t[1]=s*l+o*a,t[2]=r*-a+n*l,t[3]=s*-a+o*l,t}function COt(t,e,i){const r=e[0],s=e[1],n=e[2],o=e[3],a=i[0],l=i[1];return t[0]=r*a,t[1]=s*a,t[2]=n*l,t[3]=o*l,t}function MOt(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t}function AOt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function POt(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function OOt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function $Ot(t,e,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,e,i]}function ROt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function Cke(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function IOt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function LOt(t,e){const i=t[0],r=t[1],s=t[2],n=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=Bo();return Math.abs(i-o)<=u*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=u*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=u*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=u*Math.max(1,Math.abs(n),Math.abs(c))}function DOt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function NOt(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}const FOt=Eke,kOt=Cke;Object.freeze(Object.defineProperty({__proto__:null,LDU:$Ot,add:ROt,adjoint:TOt,copy:vOt,determinant:SOt,equals:LOt,exactEquals:IOt,frob:OOt,fromRotation:MOt,fromScaling:AOt,identity:bOt,invert:xOt,mul:FOt,multiply:Eke,multiplyScalar:DOt,multiplyScalarAndAdd:NOt,rotate:EOt,scale:COt,set:Ske,str:POt,sub:kOt,subtract:Cke,transpose:wOt},Symbol.toStringTag,{value:"Module"}));function Mke(){return[1,0,0,1]}function UOt(t){return[t[0],t[1],t[2],t[3]]}function VOt(t,e,i,r){return[t,e,i,r]}function zOt(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:UOt,create:Mke,createView:zOt,fromValues:VOt},Symbol.toStringTag,{value:"Module"}));let Ake=class{constructor(){this.vLeft=C(),this.vRight=C(),this.vMinSiblingLength=0,this.frame=new _ke}setFrameFromUpVector(e){ve(this.frame.up,e),Ee(H$,this.vLeft,this.vRight),Ce(H$,H$),de(tve,this.frame.up,Te(H$,this.frame.up)),$e(_5,H$,tve),Ce(_5,_5),mt(this.frame.right,_5,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}},BOt=class extends Ake{get rotationFrameUp(){return this.frame.up}get rotationRight(){return YAe}get rotationAngle(){return de(Nv,this.frame.up,Te(this.frame.up,this.vLeft)),$e(Nv,this.vLeft,Nv),da(Nv,Nv),Ce(Nv,Nv),de(KE,this.frame.up,Te(this.frame.up,this.vRight)),$e(KE,this.vRight,KE),Ce(KE,KE),mt(Ej,this.rotationFrameUp,this.vLeft),Math.sign(Te(Ej,this.vRight))*(Math.PI-vo(Te(Nv,KE)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,i){const r=this.rotationAngle;if(Math.abs(r)<=0)return i;const s=nY(Math.cos(.5*r));return Di(e,(s-1+1)*i[0],i[1])}},jOt=class extends Ake{get rotationFrameUp(){const e=Math.sign(Te(this.frame.right,this.vRight));return mt(G$,this.vRight,this.vLeft),de(G$,G$,e),Ce(G$,G$)}get rotationRight(){const e=this.rotationFrameUp,i=Te(e,this.frame.up),r=Te(e,this.frame.right);return de(QE,this.frame.up,-r),de(eve,this.frame.right,i),Ee(QE,QE,eve),Ce(QE,QE),GOt(K_e,this.frame,QE),K_e}get rotationAngle(){const e=Math.sign(Te(this.frame.right,this.vRight));return da(Ej,this.vLeft),-e*(Math.PI-vo(Te(Ej,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*nY(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,i){const r=this.rotationAngle;if(Math.abs(r)===0)return i;const s=nY(Math.cos(.5*r)),n=this.rotationRight,o=Ske(qOt,1+(s-1)*n[0]*n[0],(s-1)*n[0]*n[1],(s-1)*n[0]*n[1],1+(s-1)*n[1]*n[1]);return jRe(e,i,o)}};function GOt(t,e,i){Di(t,Te(i,e.right),Te(i,e.up))}function HOt(t){switch(t){case cy.World:return new BOt;case cy.Path:return new jOt}}const G$=C(),K_e=gt(),QE=C(),eve=C(),Ej=C(),Nv=C(),KE=C(),tve=C(),H$=C(),_5=C(),qOt=Mke(),v7=8;function WOt(t,e){const i=$.FEATUREVALUE;t.attributes.add(i,"vec4");const r=t.vertex;r.code.add(S`
  bool isCapVertex() {
    return ${i}.w == 1.0;
  }
  `),r.uniforms.add(new Hr("size",s=>s.size)),e.vvSize?(r.uniforms.add(new Wt("vvSizeMinSize",s=>s.vvSize.minSize),new Wt("vvSizeMaxSize",s=>s.vvSize.maxSize),new Wt("vvSizeOffset",s=>s.vvSize.offset),new Wt("vvSizeFactor",s=>s.vvSize.factor)),r.code.add(S`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${i}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):r.code.add(S`vec2 getSize(){
return size;
}`),e.vvOpacity?(r.constants.add("vvOpacityNumber","int",v7),r.uniforms.add(new sc("vvOpacityValues",s=>s.vvOpacity.values,v7),new sc("vvOpacityOpacities",s=>s.vvOpacity.opacityValues,v7)),r.code.add(S`
    vec4 applyOpacity(vec4 color) {
      float value = ${i}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):r.code.add(S`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(r.constants.add("vvColorNumber","int",zA),r.uniforms.add(new sc("vvColorValues",s=>s.vvColor.values,zA),new hDe("vvColorColors",s=>s.vvColor.colors,zA)),r.code.add(S`
    vec4 getColor() {
      float value = ${i}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):r.code.add(S`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(dN),t.attributes.add($.PROFILERIGHT,"vec4"),t.attributes.add($.PROFILEUP,"vec4"),t.attributes.add($.PROFILEVERTEXANDNORMAL,"vec4"),r.code.add(S`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),r.code.add(S`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),r.code.add(S`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),r.code.add(S`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let ZOt=class extends bN{constructor(){super(...arguments),this.size=Ei(1,1)}};function yD(t,e){e.spherical?t.vertex.code.add(S`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(S`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(S`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(S`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function Pke(t){const e=new Hi,{vertex:i,fragment:r}=e;switch(Wc(i,t),e.varyings.add("vpos","vec3"),e.include(WOt,t),t.output!==G.Color&&t.output!==G.ObjectAndLayerIdColor||(e.include(gl,t),e.include(YP,t),e.include(LO,t),e.include(aE,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.multipassEnabled&&e.varyings.add("depth","float"),i.code.add(S`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===G.Color?"forwardLinearDepth();":""}
        forwardObjectAndLayerIdColor();

        vcolor = getColor();
      }
    `)),e.include(Uy,t),t.output){case G.Color:e.include(Mn,t),e.include(E2,t),e.include(CN,t),e.include(YP,t),e.include(GDe,t),fm(r,t),MN(r),VO(r),r.uniforms.add(i.uniforms.get("localOrigin"),new Wt("ambient",s=>s.ambient),new Wt("diffuse",s=>s.diffuse),new Wt("specular",s=>s.specular),new tt("opacity",s=>s.opacity)),r.include(Fy),t.transparencyPassType===ft.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),Ry(r),r.code.add(S`
        void main() {
          discardBySlice(vpos);
          ${t.multipassEnabled?"terrainDepthTest(depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${t.transparencyPassType===ft.ColorAlpha?S`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}
        }
      `);break;case G.Depth:e.include(gl,t),i.code.add(S`void main() {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(Mn,t),r.code.add(S`void main() {
discardBySlice(vpos);
}`);break;case G.Shadow:case G.ShadowHighlight:case G.ShadowExcludeHighlight:case G.ViewshedShadow:e.include(gl,t),$6(e),e.varyings.add("depth","float"),i.code.add(S`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(Mn,t),e.include(l8,t),r.code.add(S`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case G.ObjectAndLayerIdColor:e.include(Mn,t),r.code.add(S`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`);break;case G.Normal:e.include(gl,t),e.include(yD,t),VP(i),e.varyings.add("vnormal","vec3"),i.code.add(S`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(Mn,t),r.code.add(S`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case G.Highlight:e.include(gl,t),e.include(yD,t),e.varyings.add("vnormal","vec3"),i.code.add(S`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(Mn,t),e.include(Mw,t),r.code.add(S`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const YOt=Object.freeze(Object.defineProperty({__proto__:null,build:Pke},Symbol.toStringTag,{value:"Module"})),Oke=new Map([[$.POSITION,0],[$.PROFILERIGHT,1],[$.PROFILEUP,2],[$.PROFILEVERTEXANDNORMAL,3],[$.FEATUREVALUE,4],[$.OBJECTANDLAYERIDCOLOR,5]]);let XOt=class extends ZOt{constructor(){super(...arguments),this.ambient=qe(.2,.2,.2),this.diffuse=qe(.8,.8,.8),this.specular=qe(0,0,0),this.opacity=1,this.origin=C(),this.modelTransformation=null}},$ke=class Rke extends Ki{initializeConfiguration(e,i){i.spherical=e.viewingMode===Je.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new er(e.rctx,Rke.shader.get().build(this.configuration),Oke)}initializePipeline(){const e=this.configuration.transparencyPassType,i=this.configuration,r=e===ft.NONE,s=e===ft.FrontFace;return Kt({blending:i.output===G.Color&&i.transparent?r?Bu:Q_(e):null,culling:i.hasSlicePlane&&!i.transparent&&i.doubleSidedMode!==Rs.None?QRe:null,depthTest:{func:Aw(e)},depthWrite:r||s?Wu:null,drawBuffers:i.output===G.Depth?{buffers:[ho.NONE]}:K_(e),colorWrite:ui,stencilWrite:i.hasOccludees?Ty:null,stencilTest:i.hasOccludees?Pw:null,polygonOffset:r||s?null:t8})}};$ke.shader=new qi(YOt,()=>oe(()=>Promise.resolve().then(()=>D9t),void 0));let Vn=class extends Xc{constructor(){super(...arguments),this.output=G.Color,this.doubleSidedMode=Rs.None,this.transparencyPassType=ft.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1,this.objectAndLayerIdColorInstanced=!1}};h([j({count:G.COUNT})],Vn.prototype,"output",void 0),h([j({count:Rs.COUNT})],Vn.prototype,"doubleSidedMode",void 0),h([j({count:ft.COUNT})],Vn.prototype,"transparencyPassType",void 0),h([j()],Vn.prototype,"spherical",void 0),h([j()],Vn.prototype,"receiveShadows",void 0),h([j()],Vn.prototype,"receiveAmbientOcclusion",void 0),h([j()],Vn.prototype,"vvSize",void 0),h([j()],Vn.prototype,"vvColor",void 0),h([j()],Vn.prototype,"vvOpacity",void 0),h([j()],Vn.prototype,"hasSlicePlane",void 0),h([j()],Vn.prototype,"transparent",void 0),h([j()],Vn.prototype,"hasOccludees",void 0),h([j()],Vn.prototype,"multipassEnabled",void 0),h([j()],Vn.prototype,"cullAboveGround",void 0),h([j()],Vn.prototype,"doublePrecisionRequiresObfuscation",void 0),h([j({constValue:!1})],Vn.prototype,"occlusionPass",void 0),h([j({constValue:Pt.Disabled})],Vn.prototype,"pbrMode",void 0),h([j({constValue:!0})],Vn.prototype,"hasVvInstancing",void 0),h([j({constValue:!1})],Vn.prototype,"useCustomDTRExponentForWater",void 0),h([j({constValue:!1})],Vn.prototype,"useFillLights",void 0),h([j({constValue:!1})],Vn.prototype,"hasColorTexture",void 0);let JOt=class Ike extends Cw{constructor(e){super(e,new KOt),this.supportsEdges=!0,this.produces=new Map([[Pe.OPAQUE_MATERIAL,i=>(this.parameters.castShadows&&IA(i)||k3(i))&&!this.parameters.transparent],[Pe.TRANSPARENT_MATERIAL,i=>(this.parameters.castShadows&&IA(i)||k3(i))&&this.parameters.transparent]]),this._vertexAttributeLocations=Oke,this._configuration=new Vn,this._vertexBufferLayout=Ike.getVertexBufferLayout()}getConfiguration(e,i){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e===G.Color&&(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Rs.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Rs.WindingOrder:Rs.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=i.ssao!=null),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==G.Shadow&&e!==G.ShadowExcludeHighlight&&e!==G.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,i,r,s,n,o){const a=e;if(!vke(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:b,factor:w,minSize:x,maxSize:T}=this.parameters.vvSize,E=l.sizeAttributeValue;c[0]*=Ne(b[0]+E*w[0],x[0],T[0]),c[1]*=Ne(b[2]+E*w[2],x[2],T[2])}const u=new TN(!1,r.options.normalRequired),d=Math.max(c[0],c[1]),f=e.boundingInfo;if(f==null)return void ive(l,c,s,n,u,o);const m=b2(f.bbMin[0]-d,f.bbMin[1]-d,f.bbMin[2]-d,f.bbMax[0]+d,f.bbMax[1]+d,f.bbMax[2]+d),g=[n[0]-s[0],n[1]-s[1],n[2]-s[2]],y=Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]),v=[y/g[0],y/g[1],y/g[2]];tae(m,s,v,r.tolerance)&&ive(l,c,s,n,u,o)}createBufferWriter(){return new kO(this._vertexBufferLayout)}createGLMaterial(e){return new QOt(e)}static getVertexBufferLayout(){const e=Ds().vec3f($.POSITION).vec4f($.PROFILERIGHT).vec4f($.PROFILEUP).vec4f($.PROFILEVERTEXANDNORMAL).vec4f($.FEATUREVALUE);return ue("enable-feature:objectAndLayerId-rendering")&&e.vec4u8($.OBJECTANDLAYERIDCOLOR),e}},QOt=class extends Sw{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){this.technique!=null&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output===G.Color&&(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique($ke,e)}};function ive(t,e,i,r,s,n){t.baked.size&&t.baked.size[0]===e[0]&&t.baked.size[1]===e[1]||t.baked.bake(e),t.baked.intersect(i,r,s,n)}let KOt=class extends XOt{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const e$t=["polyline"];let t$t=class extends zy{constructor(e,i,r,s){super(e,i,r,s),this._intrinsicSize=Ei(1,1),this._upVectorAlignment=cy.Path,this._stencilWidth=.1,this.usedMemory=0,this.ensureDrapedStatus(!1)}async doLoad(){var f,m,g,y,v;const e=this.symbolLayer.width!=null?this.symbolLayer.width:this.symbolLayer.height,i=this.symbolLayer.height!=null?this.symbolLayer.height:e;this._vvConvertOptions=new vN({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,i],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=((m=(f=this._context.renderer)==null?void 0:f.visualVariables)==null?void 0:m.length)>0?GP(this._context.renderer,this._vvConvertOptions):null;const r=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?cy.World:cy.Path;const s=this.symbolLayer.profile||"circle";switch(s){default:case"circle":this._profile=yOt[r];break;case"quad":this._profile=_Ot[r]}switch(this.symbolLayer.join){case"round":this._extruder=new g7(0,LDe);break;case"bevel":this._extruder=new g7(0,1);break;case"miter":this._extruder=new g7(.8*Math.PI,1);break;default:this._extruder=new sOt}const n=this.symbolLayer.cap||"butt";switch(n){case"none":this._startCap=new Z_e,this._endCap=new Z_e;break;case"butt":default:this._startCap=new y5(this._profile,0),this._endCap=new y5(this._profile,0,!0);break;case"square":this._startCap=new y5(this._profile,-.5),this._endCap=new y5(this._profile,.5,!0);break;case"round":{const b=s==="quad";this._startCap=new Y_e({profile:this._profile,flip:!1,breakNormals:b,subdivisions:LK}),this._endCap=new Y_e({profile:this._profile,flip:!0,breakNormals:b,subdivisions:LK});break}}const o=(y=(g=this.symbolLayer)==null?void 0:g.material)==null?void 0:y.color,a=this._getCombinedOpacityAndColor(o),l=Xl(a),c=a[3],u=c<1||this.needsDrivenTransparentPass,d={diffuse:l,ambient:l,opacity:c,transparent:u,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:u||n==="none"?Gr.None:Gr.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(Di(this._intrinsicSize,e,i),!IK(this._intrinsicSize[0])||!IK(this._intrinsicSize[1])))throw new B("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if((v=this._fastUpdates)!=null&&v.visualVariables.size||Rh(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const b={...d,...this._fastUpdates.materialParameters,size:GAe(this._intrinsicSize)};this._materials[0]=new JOt(b)}else d.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,d.normalType=or.Compressed,this._materials[0]=new gm(d);this._materials[0].setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials[0]=null,this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,e$t,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i),s=e.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(){var s,n,o;const e=(n=(s=this.symbolLayer)==null?void 0:s.material)==null?void 0:n.color,i=this._getCombinedOpacity(e),r=i<1||this.needsDrivenTransparentPass;(o=this._materials[0])==null||o.setParameters({opacity:i,transparent:r})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,ow)}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){var e;return(e=this._materials[0])==null||e.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,i){var r;for(const s in e.diff){if(s!=="visualVariables"||!HP(this._fastUpdates,i,this._vvConvertOptions))return mn.RecreateSymbol;(r=this._materials[0])==null||r.setParameters(this._fastUpdates.materialParameters)}return mn.FastUpdate}_getVertexData(e){let i=0;const r=e.paths,s=[],n=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const d of r)i+=d.length;const l=go(3*i);let c,u=0;for(const d of r){s.push({offset:u,numVertices:d.length});for(const f of d)l[u++]=f[0],l[u++]=f[1],l[u++]=e.hasZ?f[2]:0}return o==null||n.equals(o)||gs(l,n,0,l,o,0,i)?(o==null||o.equals(a)?c=w3e(l):(c=go(3*i),gs(l,o,0,c,a,0,i)),{pathVertexDataInfos:s,vertexDataES:l,vertexDataRS:c}):null}_createAs3DShape(e,i,r,s){var g,y,v;this.usedMemory=0;const n=e.geometry,o=this._getVertexData(n);if(o==null)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(o.pathVertexDataInfos.length===0)return n.paths.length!==0&&n.paths.some(b=>b.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const a=new Array,l=n.spatialReference,c=io(),u=this._context.renderCoordsHelper,d=new nne(o.vertexDataES);for(const b of o.pathVertexDataInfos){const w=b.numVertices;if(w<2)continue;const x=b.offset;if(this._context.clippingExtent!=null&&(Qr(c),Uh(c,o.vertexDataES,x,w),!Gf(c,this._context.clippingExtent)))continue;const T=new Array,E=x+3*w;for(let V=x;V<E;V+=3){d.offset=V;const X=I_t(d,this._context.elevationProvider,r,u);pe(rn,o.vertexDataRS[V],o.vertexDataRS[V+1],o.vertexDataRS[V+2]),u.setAltitude(rn,X),o.vertexDataRS[V]=rn[0],o.vertexDataRS[V+1]=rn[1],o.vertexDataRS[V+2]=rn[2],T.push(HOt(this._upVectorAlignment))}const M=new tOt(T,o.vertexDataES,o.vertexDataRS,x);Lke(M,this._upVectorAlignment,this._context.renderCoordsHelper);const O=new iOt(M,this._profile,this._extruder,this._startCap,this._endCap);let D=null;if(this._fastUpdates){const V=this._fastUpdates.visualVariables,X=em((g=V.size)==null?void 0:g.field,e)??0,q=em((y=V.color)==null?void 0:y.field,e)??0,Z=em((v=V.opacity)==null?void 0:v.field,e)??0;D=new lOt(O,X,q,Z)}else{const V=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const Z=i.size;V[0]*=rve(Z[0],Z[2]==="symbol-value"?this.symbolLayer.height||0:Z[2],this.symbolLayer.width||0),V[1]*=rve(Z[2],Z[0]==="symbol-value"?this.symbolLayer.width||0:Z[0],this.symbolLayer.height||0)}let X;this._drivenProperties.color&&(X=i.color),this._drivenProperties.opacity&&i.opacity!=null&&(X=X?[X[0],X[1],X[2],i.opacity]:[1,1,1,i.opacity]);const q=new wke(O);q.bake(V),X&&q.bakeVertexColors(X),D=q}const U=D.createGeometryData(),k=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),H=new aOt(this._materials[0],U,D,l,this._stencilWidth,k);H.transformation=wl(ke(),Jr,O.path.origin),a.push(H),this.usedMemory+=O.usedMemory}if(a.length===0)return null;const f=new Ow({geometries:a,layerUid:this._context.layer.uid,graphicUid:s}),m=new Vy(this,f,a,null,null,(b,w,x,T,E)=>r$t(b,w,T,E,this._upVectorAlignment),r);return m.alignedSampledElevation=0,m.needsElevationUpdates=ow(r.mode),m}};function Lke(t,e,i){const{origin:r,positions:s}=t;let n=t.offset;switch(e){default:case cy.World:for(const o of t.vertices)rn[0]=s[n++]+r[0],rn[1]=s[n++]+r[1],rn[2]=s[n++]+r[2],i.worldUpAtPosition(rn,rn),o.setFrameFromUpVector(rn);break;case cy.Path:rn[0]=s[n]+r[0],rn[1]=s[n+1]+r[1],rn[2]=s[n+2]+r[2],i.worldUpAtPosition(rn,rn),mOt(t,rn)}}function rve(t,e,i){switch(t){case"symbol-value":return i;case"proportional":return e;default:return t}}function i$t(t,e,i,r){let s=0;const{origin:n,vertices:o,positions:a,positionsES:l}=t,c=t.offset+3*o.length;for(let u=t.offset;u<c;u+=3)pe(rn,l[u],l[u+1],l[u+2]),i(rn,b7),s+=b7.sampledElevation,rn[0]=a[u]+n[0],rn[1]=a[u+1]+n[1],rn[2]=a[u+2]+n[2],r.setAltitude(rn,b7.z),a[u]=rn[0]-n[0],a[u+1]=rn[1]-n[1],a[u+2]=rn[2]-n[2];return t.updatePathVertexInformation(),s/o.length}function r$t(t,e,i,r,s){const n=t.stageObject,o=n.geometries;let a=0;for(const l of o){if(!vke(l))continue;const c=l.path,u=c.builder.path;a+=i$t(u,e,i,r),s!==cy.World&&Lke(u,s,r),c.onPathChanged(l),l.invalidateBoundingInfo(),n.geometryVertexAttributeUpdated(l,$.POSITION)}return a/o.length}const rn=C(),b7=new xN;function s$t(t,e,i,r,s=1){if(i.isGeographic&&r===Je.Global){const c=go(e.length),u=e.length,d=br(i);for(let f=0;f<u;f+=3)vse(e,f,c,f,d);e=c}Di(Yn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)Yn[0]=Math.min(Yn[0],e[c]),Yn[1]=Math.min(Yn[1],e[c+1]);const n=Yn[0]%s,o=Yn[1]%s,a=Yn[0]-n,l=Yn[1]-o;for(let c=0;c<e.length;c+=3){const u=c/3*4;t[u]=(e[c]-a)/s,t[u+1]=(e[c+1]-l)/s,t[u+2]=a/s,t[u+3]=l/s}}function Dke(t,e,i,r,s=1){pe(dx,1,0,0),pe(px,0,1,0),pe(tC,0,0,1),o$t(w7,i),jtt(sve,i)&&n$t(sve,dx,px,tC,r,w7),Di(Yn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Di(fx,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let u=0;u<i.length;u+=3){pe(eC,i[u],i[u+1],i[u+2]);const d=Te(dx,eC),f=Te(px,eC);Yn[0]=Math.min(Yn[0],d),Yn[1]=Math.min(Yn[1],f),fx[0]=Math.max(fx[0],d),fx[1]=Math.max(fx[1],f)}const n=Te(tC,w7);T7(Fv,Yn[0],Yn[1],n,dx,px,tC),T7(mx,fx[0],Yn[1],n,dx,px,tC),T7(gx,Yn[0],fx[1],n,dx,px,tC),$e(mx,mx,Fv),de(mx,mx,.5),$e(gx,gx,Fv),de(gx,gx,.5),Ee(Fv,Fv,mx),Ee(Fv,Fv,gx);const o=Yn[0]%s,a=Yn[1]%s,l=Yn[0]-o,c=Yn[1]-a;for(let u=0;u<i.length;u+=3){pe(eC,i[u],i[u+1],i[u+2]);const d=u/3,f=4*d;t[f]=(Te(dx,eC)-l)/s,t[f+1]=(Te(px,eC)-c)/s,t[f+2]=l/s,t[f+3]=c/s;const m=9*d;for(let g=0;g<3;g++)e[m+g]=Fv[g],e[m+g+3]=mx[g],e[m+g+6]=gx[g]}}const w7=C(),eC=C(),sve=rr(),dx=C(),px=C(),tC=C(),Yn=gt(),fx=gt(),Fv=C(),mx=C(),gx=C();function n$t(t,e,i,r,s,n){s!=null?(s.basisMatrixAtPosition(n,Um),pe(v5,Um[0],Um[1],Um[2]),pe(b5,Um[4],Um[5],Um[6]),pe(x7,Um[8],Um[9],Um[10])):(pe(v5,1,0,0),pe(b5,0,1,0),pe(x7,0,0,1));const o=t;Te(o,x7)<0&&de(o,o,-1),ve(r,o);const a=Te(o,b5),l=Te(o,v5);Math.abs(a)>Math.abs(l)?(Dn(e,v5,o,-l),Ce(e,e),mt(i,e,o),Ce(i,i),de(i,i,-1)):(Dn(i,b5,o,-a),Ce(i,i),mt(e,i,o),Ce(e,e))}const Um=ke(),v5=C(),b5=C(),x7=C();function o$t(t,e){pe(q$,0,0,0);for(let i=0;i<e.length-3;i+=3)q$[0]+=e[i],q$[1]+=e[i+1],q$[2]+=e[i+2];de(t,q$,1/(e.length/3-1))}const q$=C();function T7(t,e,i,r,s,n,o){pe(t,e*s[0]+i*n[0]+r*o[0],e*s[1]+i*n[1]+r*o[1],e*s[2]+i*n[2]+r*o[2])}let sle=class extends Cw{intersect(e,i,r,s,n,o){return HDe(e,r,s,n,void 0,o)}};function Nke(t){const e=new Hi,{vertex:i,fragment:r,attributes:s,varyings:n}=e;Wc(i,t),e.include(gl,t),e.include(lE,t),e.include(b_,t),e.include(aE,t),s.add($.POSITION,"vec3"),t.vvColor&&s.add($.COLORFEATUREATTRIBUTE,"float"),n.add("vColor","vec4"),n.add("vpos","vec3");const o=t.multipassEnabled&&t.output===G.Color;o&&n.add("depth","float"),i.uniforms.add(new ji("eColor",l=>l.color)),i.code.add(S`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${t.hasVertexColors?"vColor *= eColor;":t.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${o?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),e.include(Mn,t),o&&e.include(Uy,t),r.include(Fy);const a=t.output===G.Highlight;return a&&e.include(Mw,t),t.transparencyPassType===ft.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),r.code.add(S`
  void main() {
    discardBySlice(vpos);
    ${o?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;

    ${t.output===G.ObjectAndLayerIdColor?S`fColor.a = 1.0;`:""}

    if (fColor.a < ${S.float(la)}) {
      discard;
    }

    ${t.output===G.Color?S`fragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===ft.ColorAlpha?S`
                  fragColor = premultiplyAlpha(fragColor);
                  fragAlpha = fragColor.a;`:""}`:""}
    ${a?S`outputHighlight();`:""};
    ${t.output===G.ObjectAndLayerIdColor?S`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const a$t=Object.freeze(Object.defineProperty({__proto__:null,build:Nke},Symbol.toStringTag,{value:"Module"}));let Fke=class kke extends Ki{initializeProgram(e){return new er(e.rctx,kke.shader.get().build(this.configuration),Pi)}_createPipeline(e,i){const r=this.configuration,s=e===ft.NONE,n=e===ft.FrontFace;return Kt({blending:r.output===G.Color&&r.transparent?s?Bu:Q_(e):null,culling:A6(r.cullFace),depthTest:r.draped?null:{func:Aw(e)},depthWrite:r.draped?null:(s||n)&&r.writeDepth?Wu:null,drawBuffers:r.output===G.Depth?{buffers:[ho.NONE]}:K_(e),colorWrite:ui,stencilWrite:r.hasOccludees?Ty:null,stencilTest:r.hasOccludees?i?aw:Pw:null,polygonOffset:s||n?r.polygonOffset?l$t:null:i8(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};Fke.shader=new qi(a$t,()=>oe(()=>Promise.resolve().then(()=>N9t),void 0));const l$t={factor:1,units:1};let Ao=class extends Xc{constructor(){super(...arguments),this.output=G.Color,this.cullFace=Gr.None,this.transparencyPassType=ft.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1}};h([j({count:G.COUNT})],Ao.prototype,"output",void 0),h([j({count:Gr.COUNT})],Ao.prototype,"cullFace",void 0),h([j({count:ft.COUNT})],Ao.prototype,"transparencyPassType",void 0),h([j()],Ao.prototype,"hasSlicePlane",void 0),h([j()],Ao.prototype,"hasVertexColors",void 0),h([j()],Ao.prototype,"transparent",void 0),h([j()],Ao.prototype,"polygonOffset",void 0),h([j()],Ao.prototype,"enableOffset",void 0),h([j()],Ao.prototype,"writeDepth",void 0),h([j()],Ao.prototype,"hasOccludees",void 0),h([j()],Ao.prototype,"multipassEnabled",void 0),h([j()],Ao.prototype,"cullAboveGround",void 0),h([j()],Ao.prototype,"objectAndLayerIdColorInstanced",void 0),h([j()],Ao.prototype,"vvColor",void 0),h([j()],Ao.prototype,"draped",void 0),h([j({constValue:!1})],Ao.prototype,"occlusionPass",void 0),h([j({constValue:!0})],Ao.prototype,"hasVvInstancing",void 0),h([j({constValue:!1})],Ao.prototype,"vvSize",void 0),h([j({constValue:!1})],Ao.prototype,"vvOpacity",void 0);let nve=class extends sle{constructor(e){super(e,new u$t),this.supportsEdges=!0,this.produces=new Map([[Pe.OPAQUE_MATERIAL,i=>i===G.Highlight||xq(i)&&!this._isTransparent],[Pe.OPAQUE_NO_SSAO_DEPTH,i=>Cb(i)&&this.parameters.writeLinearDepth&&!this._isTransparent],[Pe.TRANSPARENT_MATERIAL,i=>xq(i)&&this._isTransparent&&this.parameters.writeDepth],[Pe.TRANSPARENT_NO_SSAO_DEPTH,i=>Cb(i)&&this.parameters.writeLinearDepth&&this._isTransparent&&this.parameters.writeDepth],[Pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,i=>(xq(i)||Cb(i)&&this.parameters.writeLinearDepth)&&this._isTransparent&&!this.parameters.writeDepth],[Pe.DRAPED_MATERIAL,i=>QIe(i)]]),this._configuration=new Ao}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<e8,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}createGLMaterial(e){return new c$t(e)}createBufferWriter(){const e=Ds().vec3f($.POSITION);return ue("enable-feature:objectAndLayerId-rendering")&&e.vec4u8($.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32($.COLORFEATUREATTRIBUTE):e.vec4u8($.COLOR),new kO(e)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}},c$t=class extends Sw{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===G.Color&&this._updateOccludeeState(e),this.ensureTechnique(Fke,e)}},u$t=class extends bN{constructor(){super(...arguments),this.color=jh,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Gr.None,this.hasOccludees=!1,this.draped=!1}};var aa;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(aa||(aa={}));const vee=.70710678118,ove=vee,h$t=.08715574274;function Uke(t){const e=new Hi,i=t.multipassEnabled&&t.output===G.Color,{vertex:r,fragment:s,attributes:n,varyings:o}=e;Wc(r,t),e.include(gl,t),e.include(lE,t),e.include(b_,t),e.include(aE,t),t.draped?r.uniforms.add(new tt("worldToScreenRatio",(l,c)=>1/c.screenToPCSRatio)):n.add($.BOUNDINGRECT,"mat3"),n.add($.POSITION,"vec3"),n.add($.UVMAPSPACE,"vec4"),t.vvColor&&n.add($.COLORFEATUREATTRIBUTE,"float"),o.add("vColor","vec4"),o.add("vpos","vec3"),o.add("vuv","vec2"),i&&o.add("depth","float"),r.uniforms.add(new ji("uColor",l=>l.color));const a=t.style===aa.ForwardDiagonal||t.style===aa.BackwardDiagonal||t.style===aa.DiagonalCross;return a&&r.code.add(S`
      const mat2 rotate45 = mat2(${S.float(vee)}, ${S.float(-ove)},
                                 ${S.float(ove)}, ${S.float(vee)});
    `),t.draped||(fm(r,t),r.uniforms.add(new tt("worldToScreenPerDistanceRatio",(l,c)=>1/c.camera.perScreenPixelRatio)),r.code.add(S`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),r.code.add(S`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),r.code.add(S`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${S.float(h$t)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),r.code.add(S`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${a?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${a?" * rotate45":""};

      ${t.draped?"":S`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${S.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),r.code.add(S`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${t.hasVertexColors?"vColor *= uColor;":t.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),e.include(Mn,t),s.include(Fy),t.draped&&s.uniforms.add(new tt("texelSize",(l,c)=>1/c.camera.pixelRatio)),t.output===G.Highlight&&e.include(Mw,t),i&&e.include(Uy,t),t.output!==G.Highlight&&(s.code.add(S`
      const float lineWidth = ${S.float(t.lineWidth)};
      const float spacing = ${S.float(t.patternSpacing)};
      const float spacingINV = ${S.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||s.code.add(S`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),t.transparencyPassType===ft.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),s.code.add(S`
    void main() {
      discardBySlice(vpos);
      ${i?"terrainDepthTest(depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${t.output!==G.Highlight?S`color.a *= ${d$t(t)};`:""}

      ${t.output===G.ObjectAndLayerIdColor?S`color.a = 1.0;`:""}

      if (color.a < ${S.float(la)}) {
        discard;
      }

      ${t.output===G.Color?S`fragColor = color; ${t.transparencyPassType===ft.ColorAlpha?S`
                    fragColor = premultiplyAlpha(fragColor);
                    fragAlpha = fragColor.a;`:""}`:""}
      ${t.output===G.Highlight?S`outputHighlight();`:""}
      ${t.output===G.ObjectAndLayerIdColor?S`outputObjectAndLayerIdColor();`:""}
    }
  `),e}function d$t(t){function e(i){return t.draped?S`coverage(vuv.${i}, texelSize)`:S`sampleAA(vuv.${i})`}switch(t.style){case aa.ForwardDiagonal:case aa.Horizontal:return e("y");case aa.BackwardDiagonal:case aa.Vertical:return e("x");case aa.DiagonalCross:case aa.Cross:return S`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const p$t=Object.freeze(Object.defineProperty({__proto__:null,build:Uke},Symbol.toStringTag,{value:"Module"}));let Vke=class zke extends Ki{initializeProgram(e){return new er(e.rctx,zke.shader.get().build(this.configuration),ue("enable-feature:objectAndLayerId-rendering")?jke:Bke)}_setPipelineState(e,i){const r=this.configuration,s=e===ft.NONE,n=e===ft.FrontFace;return Kt({blending:r.output===G.Color?s?Bu:Q_(e):null,culling:A6(r.cullFace),depthTest:r.draped?null:{func:Aw(e)},depthWrite:r.draped?null:s?Wu:K6(e),drawBuffers:r.output===G.Depth?{buffers:[ho.NONE]}:K_(e),colorWrite:ui,stencilWrite:r.hasOccludees?Ty:null,stencilTest:r.hasOccludees?i?aw:Pw:null,polygonOffset:s||n?r.polygonOffset?f$t:null:i8(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};Vke.shader=new qi(p$t,()=>oe(()=>Promise.resolve().then(()=>F9t),void 0));const f$t={factor:1,units:1};let oo=class extends Xc{constructor(){super(...arguments),this.output=G.Color,this.cullFace=Gr.None,this.transparencyPassType=ft.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasOccludees=!1,this.enableOffset=!0,this.multipassEnabled=!1,this.cullAboveGround=!1,this.vvColor=!1,this.objectAndLayerIdColorInstanced=!1}};h([j({count:G.COUNT})],oo.prototype,"output",void 0),h([j({count:Gr.COUNT})],oo.prototype,"cullFace",void 0),h([j({count:aa.COUNT})],oo.prototype,"style",void 0),h([j({count:ft.COUNT})],oo.prototype,"transparencyPassType",void 0),h([j()],oo.prototype,"hasSlicePlane",void 0),h([j()],oo.prototype,"hasVertexColors",void 0),h([j()],oo.prototype,"polygonOffset",void 0),h([j()],oo.prototype,"hasOccludees",void 0),h([j()],oo.prototype,"patternSpacing",void 0),h([j()],oo.prototype,"lineWidth",void 0),h([j()],oo.prototype,"enableOffset",void 0),h([j()],oo.prototype,"draped",void 0),h([j()],oo.prototype,"multipassEnabled",void 0),h([j()],oo.prototype,"cullAboveGround",void 0),h([j()],oo.prototype,"vvColor",void 0),h([j({constValue:!0})],oo.prototype,"writeDepth",void 0),h([j({constValue:!1})],oo.prototype,"occlusionPass",void 0),h([j({constValue:!1})],oo.prototype,"hasVvInstancing",void 0),h([j({constValue:!1})],oo.prototype,"vvSize",void 0),h([j({constValue:!1})],oo.prototype,"vvOpacity",void 0);const Bke=new Map([[$.POSITION,0],[$.COLOR,3],[$.UVMAPSPACE,4],[$.COLORFEATUREATTRIBUTE,5],[$.BOUNDINGRECT,6]]),jke=new Map([[$.POSITION,0],[$.COLOR,3],[$.UVMAPSPACE,4],[$.COLORFEATUREATTRIBUTE,5],[$.BOUNDINGRECT,6],[$.OBJECTANDLAYERIDCOLOR,9]]);let nle=class extends sle{constructor(e){super(e,new _$t),this.supportsEdges=!0,this.produces=new Map([[Pe.OPAQUE_MATERIAL,i=>zS(i)],[Pe.TRANSPARENT_MATERIAL,i=>__(i)],[Pe.TRANSPARENT_NO_SSAO_DEPTH,i=>Cb(i)&&this.parameters.writeLinearDepth],[Pe.DRAPED_MATERIAL,i=>this.parameters.draped&&i===G.Color||zS(i)]]),this._vertexAttributeLocations=ue("enable-feature:objectAndLayerId-rendering")?jke:Bke,this._configuration=new oo}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<e8,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}createGLMaterial(e){return new m$t(e)}createBufferWriter(){const e=Ds().vec3f($.POSITION).vec4f($.UVMAPSPACE);return this.parameters.draped||e.mat3f($.BOUNDINGRECT),this.parameters.vvColor?e.f32($.COLORFEATUREATTRIBUTE):e.vec4u8($.COLOR),ue("enable-feature:objectAndLayerId-rendering")&&e.vec4u8($.OBJECTANDLAYERIDCOLOR),new g$t(e)}},m$t=class extends Sw{_updateParameters(e){return this.ensureTechnique(Vke,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===G.Color&&this._updateOccludeeState(e),this._updateParameters(e)}},g$t=class extends kO{write(e,i,r,s,n){rDe(r,this.vertexBufferLayout,e,i,s,n);for(const o of this.vertexBufferLayout.fields.keys()){const a=r.attributes.get(o),l=a==null?void 0:a.indices;if(a&&l)switch(o){case $.UVMAPSPACE:{bt(a.size===4);const c=s.getField(o,mm);c&&qP(a,c,n);break}case $.BOUNDINGRECT:{bt(a.size===9);const c=s.getField(o,tw);c&&y$t(a,e,c,n);break}}}}};function y$t(t,e,i,r){const{data:s,indices:n}=t,o=e,a=i.typedBuffer,l=i.typedBufferStride,c=n.length;r*=l;for(let u=0;u<c;++u){const d=9*n[u],f=s[d],m=s[d+1],g=s[d+2];a[r]=o[0]*f+o[4]*m+o[8]*g+o[12],a[r+1]=o[1]*f+o[5]*m+o[9]*g+o[13],a[r+2]=o[2]*f+o[6]*m+o[10]*g+o[14];for(let y=3;y<9;++y)a[r+y]=s[d+y];r+=l}}let _$t=class extends bN{constructor(){super(...arguments),this.color=ri(1,1,1,1),this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Gr.None,this.hasOccludees=!1,this.style=aa.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function v$t(t,e){const i=(t==null?void 0:t.pattern)??null;return i==null?new nve(e):i.style==="none"||i.style==="solid"?(i.style==="none"&&(e.color=ri(0,0,0,0),e.forceTransparentMode=!0),new nve(e)):(e.style=b$t(i.style),new nle(e))}function b$t(t){switch(t){case"horizontal":return aa.Horizontal;case"vertical":return aa.Vertical;case"cross":return aa.Cross;case"forward-diagonal":return aa.ForwardDiagonal;case"backward-diagonal":return aa.BackwardDiagonal;case"diagonal-cross":return aa.DiagonalCross;default:return}}function w$t(t){return t.material instanceof nle&&!t.material.parameters.draped}function x$t(t,e){if(w$t(t)){const i=t.attributes.get($.POSITION).data,r=t.getMutableAttribute($.UVMAPSPACE).data,s=t.getMutableAttribute($.BOUNDINGRECT).data;Dke(r,s,i,e)}}function T$t(t,e,i,r,s){const n=EDe(t,e,i,r,s),o=t.stageObject.geometries;for(const a of o)x$t(a,s);return n}const S$t=["polyline","polygon","extent"],ave=new vN({size:!1,color:!0,rotation:!1,opacity:!1});let Gke=class Hke extends zy{constructor(e,i,r,s){super(e,i,r,s),this._needsUV=!1}async doLoad(){this._fastUpdates=GP(this._context.renderer,ave)}_createMaterials(){var s,n,o;if(this._materials.length>0)return;const e=(n=(s=this.symbolLayer)==null?void 0:s.material)==null?void 0:n.color,i=this._getCombinedOpacityAndColor(e);this._materials[Ks.Fill]=v$t(this.symbolLayer,{color:i,forceTransparentMode:this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...(o=this._fastUpdates)==null?void 0:o.materialParameters}),this._needsUV=this._materials[Ks.Fill]instanceof nle;const r=this.symbolLayer.outline;if(M$t(r)){const a=F5e(r.pattern);this._materials[Ks.Outline]=new YM({width:mr(r.size),color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:a,cap:uee(r.patternCap||"butt")})}this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,S$t,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),s=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._createMaterials(),this.draped?this._createAsOverlay(i,r):this._createAs3DShape(i,r,s)}applyRendererDiff(e,i){var r;for(const s in e.diff){if(s!=="visualVariables"||!HP(this._fastUpdates,i,ave))return mn.RecreateSymbol;(r=this._materials[Ks.Fill])==null||r.setParameters(this._fastUpdates.materialParameters)}return mn.FastUpdate}layerOpacityChanged(){var e,i;if(this._materials[Ks.Fill]!=null){const r=this._materials[Ks.Fill].parameters.color,s=(i=(e=this.symbolLayer)==null?void 0:e.material)==null?void 0:i.color,n=this._getCombinedOpacity(s);this._materials[Ks.Fill].setParameters({color:[r[0],r[1],r[2],n],forceTransparentMode:this.needsDrivenTransparentPass})}if(this._materials[Ks.Outline]!=null){const r=this._materials[Ks.Outline].parameters.color;this._materials[Ks.Outline].setParameters({color:[r[0],r[1],r[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=wN(Hke.elevationModeChangeTypes,r,s);if(n!==Hs.UPDATE)return n;const o=_p(s);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){var e;if((e=this._materials[Ks.Fill])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[Ks.Outline]){const i={hasSlicePlane:this._context.slicePlaneEnabled};this._materials[Ks.Outline].setParameters(i)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){var u;const s=uD(e.geometry);if(!s)return null;const n=Lae(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=new E$t(n,i,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=$s(4*a,!0),o.boundingRect=go(9*a,!0),Dke(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=(u=this._context.stage.renderView)==null?void 0:u.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(e,o),this._materials[Ks.Outline]&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,s.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new Ow({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),c=new Vy(this,l,o.outGeometries,null,null,T$t,r);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=_p(r.mode),c}_createAs3DShapeFill(e,i){var s;const r=i.renderData.polygons;for(const{position:n,mapPositions:o,holeIndices:a,index:l,count:c}of r){if(this._context.clippingExtent!=null&&(Qr(Up),Uh(Up,o),!Gf(Up,this._context.clippingExtent)))continue;const u=Kbt(o,a,this._context.elevationProvider.spatialReference);if(u.length===0)continue;const d=(s=this._fastUpdates)==null?void 0:s.visualVariables.color,f=sye({material:this._materials[Ks.Fill],indices:u,mapPositions:o,attributeData:{position:n,color:d?null:i.color,colorFeature:d?em(d.field,e):null,uvMapSpace:this._needsUV?OB(i.uvMapSpace,4*l,4*c):null,boundingRect:this._needsUV?up(i.boundingRect,9*l,9*c):null,objectAndLayerIdColor:i.objectAndLayerIdColor}});i.outGeometries.push(f)}}_createAs3DShapeOutline(e){if(this._materials[Ks.Outline]==null)return;const i=e.renderData.outlines;for(const{mapPositions:r,position:s}of i){if(this._context.clippingExtent!=null&&(Qr(Up),Uh(Up,r),!Gf(Up,this._context.clippingExtent)))continue;const n=hee(this._materials[Ks.Outline],{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:r,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(n)}}_createAsOverlay(e,i){var a;const r=uD(e.geometry);if(r==null)return null;this._materials[Ks.Fill].renderPriority=this._renderPriority+this._renderPriorityStep/2,this._materials[Ks.Outline]!=null&&(this._materials[Ks.Outline].renderPriority=this._renderPriority);const s=a4e(r,this._context.overlaySR),n=new C$t(s,i,this._context.layer.uid,e.uid),o=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=$s(4*o,!0),s$t(n.uvMapSpace,n.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),n.outBoundingBox=Qr(),n.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(n),this._createAsOverlayFill(e,n),this._materials[Ks.Outline]&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,r.rings,"rings","FillSymbol3DLayer"),n.outGeometries.length===0?null:new C8(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,i){var s;const r=i.renderData.polygons;for(const{position:n,holeIndices:o,index:a,count:l}of r){const c=Qr(Up);if(Uh(c,n),!Gf(c,this._context.clippingExtent))continue;const u=XP(n,o,3);if(u.length===0)continue;NP(i.outBoundingBox,c);const d=(s=this._fastUpdates)==null?void 0:s.visualVariables.color,f=sye({material:this._materials[Ks.Fill],indices:u,attributeData:{position:n,color:d?null:i.color,colorFeature:d?em(d.field,e):null,uvMapSpace:this._needsUV?OB(i.uvMapSpace,4*a,4*l):null,objectAndLayerIdColor:i.objectAndLayerIdColor}});i.outGeometries.push(new KP(f,i))}}_createAsOverlayOutline(e){if(this._materials[Ks.Outline]==null)return;const i=e.renderData.outlines;for(let r=0;r<i.length;++r){const{position:s}=i[r];if(Qr(Up),Uh(Up,s),!Gf(Up,this._context.clippingExtent))continue;NP(e.outBoundingBox,Up);const n=hee(this._materials[Ks.Outline],{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(new KP(n,e))}}_getOutlineOpacity(){var i,r;const e=(r=(i=this.symbolLayer)==null?void 0:i.outline)==null?void 0:r.color;return(this.draped?1:this._getLayerOpacity())*(e!=null?e.a:0)}_getOutlineColor(){var r,s;const e=(s=(r=this.symbolLayer)==null?void 0:r.outline)==null?void 0:s.color,i=this._getOutlineOpacity();return H3(e!=null?je.toUnitRGB(e):null,i)}test(){return{...super.test(),createAsOverlay:(e,i)=>this._createAsOverlay(e,i),createAs3DShape:(e,i,r)=>this._createAs3DShape(e,i,r)}}};Gke.elevationModeChangeTypes={definedChanged:Hs.RECREATE,staysOnTheGround:Hs.NONE,onTheGroundChanged:Hs.RECREATE};const Up=io();let E$t=class extends y8{constructor(e,i,r,s){super(e,r,s),this.color=i}},C$t=class extends y8{constructor(e,i,r,s){super(e,r,s),this.color=i}};var Ks;function M$t(t){return(t==null?void 0:t.size)!=null&&t.size>0&&t.color!=null&&(t.pattern==null||t.pattern.type!=="style"||t.pattern.style!=="none")}(function(t){t[t.Fill=0]="Fill",t[t.Outline=1]="Outline"})(Ks||(Ks={}));let qke=class{constructor(e,i="center",r=!1,s=gt(),n=ri(0,0,0,-1),o="world",a=C(),l=0){this.verticalOffset=e,this.anchor=i,this.hasLabelVerticalOffset=r,this.screenOffset=s,this.centerOffset=n,this.centerOffsetUnits=o,this.translation=a,this.elevationOffset=l}},Wke=class{constructor(e,i="center",r="center",s=null,n=gt()){this.placement=e,this.horizontalPlacement=i,this.verticalPlacement=r,this.text=s,this.displaySize=n}},Zke=class Yke{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=lve(e.color),this.haloStyle=A$t(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?lve(e.background.color):null}fontString(e){const i=this.definition.font;return`${i.style} ${i.weight} ${e}px ${i.family}, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji`}setFontProperties(e,i){e.font=this.fontString(i),e.textAlign="left",e.textBaseline="alphabetic"}static async fromSymbol(e,i){var f,m,g,y,v;const r=(f=e==null?void 0:e.material)==null?void 0:f.color,s=je.toUnitRGBA(r)??jh,n=e.size!=null?mr(e.size):12,o=e.lineHeight,a=e.background!=null?je.toUnitRGBA(e.background.color):jh,l={family:((m=e.font)==null?void 0:m.family)??"sans-serif",decoration:((g=e.font)==null?void 0:g.decoration)??"none",weight:((y=e.font)==null?void 0:y.weight)??"normal",style:((v=e.font)==null?void 0:v.style)??"normal"},c=e.halo,u=(c==null?void 0:c.color)!=null&&c.size>0?{size:mr(c.size),color:je.toUnitRGBA(c.color)}:{size:0,color:jh},d=new Yke({color:s,size:n,background:{color:a,padding:e.background!=null?[.65*n,.5*n]:[0,0],borderRadius:e.background!=null?n*(6/16):0},lineSpacingFactor:o,font:l,halo:u,pixelRatio:i});if(e.font){let b=!1;const w=d.fontString(n);try{b=(await document.fonts.load(w)).some(x=>!gSt(x))}catch{ne.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${w}'. Some text symbology may be rendered using the default browser font.`)}if(!b&&!P$t.has(e.font.family))try{await mSt(e.font)}catch{}}return d}};function A$t(t){return`rgb(${t.slice(0,3).map(e=>Math.floor(255*e)).toString()})`}function lve(t){return`rgba(${t.slice(0,3).map(e=>Math.floor(255*e)).toString()},${t[3]})`}const P$t=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),kv=4096;let pS=class extends Ue{constructor(e){super(e),this.type=Gs.Texture,this.id=zh(),this.events=new Ls,this._glTexture=null,this._atlas=new R$t(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=Ut(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){return nL=0,[kv-Uv-nL,kv-Uv-nL-cve]}load(e){if(this._glTexture)return this._glTexture;const i=new es;return i.wrapMode=Ai.CLAMP_TO_EDGE,i.samplingMode=di.LINEAR_MIPMAP_LINEAR,i.hasMipmap=!0,i.preMultiplyAlpha=!0,i.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new Mr(e,i,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(It.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=Lr(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=Ut(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.width.toString()),this._canvas.setAttribute("height",e.height.toString())}_resizeAtlas(e,i){var n,o;const{width:r,height:s}=this._atlas;r===e&&s===i||(this._atlas.width=e,this._atlas.height=i,(n=this._glTexture)==null||n.resize(e,i),(o=this._glTexture)==null||o.updateData(0,0,0,r,s,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach(a=>{const l=this._stageObjects.get(a.textRenderer.key);l==null||l.forEach(c=>S7(c,a))}),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(e,i,r,s){const n=this._atlas;if(n.width<r||n.height<s)return!1;let o=n.cursors.get(s);if(!o){if(n.height<n.nextY+s)return!1;o=[new uve(n.nextY)],n.cursors.set(s,o),n.nextY+=s}let a=o.find(l=>n.width>=l.x+r);if(a==null){if(n.height<n.nextY+s)return!1;a=new uve(n.nextY),n.nextY+=s,o.push(a)}return e.setNewPosition(a),this._elements.set(i,e),this._elementsToRender.set(i,e),a.x+=r,!0}_ensureStageObjects(e){const i=this._stageObjects.get(e);if(i)return i;const r=new Set;return this._stageObjects.set(e,r),r}_addStageObject(e,i){this._ensureStageObjects(e).add(i)}_removeStageObject(e,i){const r=this._stageObjects.get(e);r!=null&&r.delete(i)&&(i.geometries[0].setAttributeData($.SIZE,[0,0]),i.geometryVertexAttributeUpdated(i.geometries[0],$.SIZE),this._elementsToRender.delete(e))}_processAddition(e){const i=e.textRenderer.key;if(this._needsRepack)return void this._elements.set(i,e);const r=this._atlas,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,o=s+Uv,a=n+Uv+cve;if(!this._addAtlasElement(e,i,o,a)){if(this._canRepack)this._reset();else if(r.width<o){const l=Math.min(Sb(Math.max(o,1.5*r.width)),kv);this._resizeAtlas(l,r.height)}else{const l=r.nextY+a,c=Math.min(Sb(Math.max(l,1.5*r.height)),kv);if(c>r.height)this._resizeAtlas(r.width,c);else if(r.width<kv){const u=Math.min(Sb(1.5*r.width),kv);this._resizeAtlas(u,r.height)}}this._elements.set(i,e)}}_renderElement(e){const i=e.commitNewPosition(),r=e.textRenderer;this._ctx.clearRect(i[0]-Uv,i[1]-Uv,r.renderedWidth+2*Uv,r.renderedHeight+2*Uv),r.render(this._ctx,i[0],i[1]);const s=this._stageObjects.get(r.key);s==null||s.forEach(n=>S7(n,e))}get running(){return this.updating}runTask(e){if(this._glTexture==null)return pa;for(;this._needsRepack&&(this._canRepack||this._atlas.height<kv&&this._atlas.height<kv);){this._canRepack=this._needsRepack=!1;const i=this._elements;this._elements=new Map,i.forEach(r=>this._processAddition(r)),e.madeProgress()}if(this._elementsToRender.size>0){for(const[i,r]of this._elementsToRender){if(e.done)break;this._renderElement(r),this._elementsToRender.delete(i),e.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addTextTexture(e,i){const r=e.key;this._addStageObject(r,i);let s=this._elements.get(r);s==null&&(s=new $$t(this._atlas,e),this._processAddition(s),this.setDirty()),O$t(i,s),S7(i,s)}removeTextTexture(e,i){const r=e.key;if(!this._elements.get(r))return;this._removeStageObject(r,i);const s=this._stageObjects.get(r);s&&s.size!==0||this._elements.delete(r),(s==null?void 0:s.size)===0&&this._stageObjects.delete(r),this._canRepack=!0}setDirty(){this._glTexture&&(this.updating=!0)}get test(){}};function O$t(t,e){t.geometries[0].setAttributeData($.SIZE,[e.textRenderer.displayWidth,e.textRenderer.displayHeight]),t.geometryVertexAttributeUpdated(t.geometries[0],$.SIZE)}function S7(t,e){t.geometries[0].setAttributeData($.UV0,e.uv),t.geometryVertexAttributeUpdated(t.geometries[0],$.UV0,!0)}h([p({constructOnly:!0})],pS.prototype,"view",void 0),h([p({type:Boolean})],pS.prototype,"updating",void 0),pS=h([I("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],pS);const Uv=2,cve=2;let $$t=class{constructor(e,i){this._atlas=e,this.textRenderer=i,this._uv=ci(),this._newPosition=[0,0]}get uv(){if(this._xOffset==null||this._yOffset==null)return jh;const{renderedWidth:e,renderedHeight:i}=this.textRenderer;return Ss(this._uv,this._xOffset/this._atlas.width,(this._yOffset+i)/this._atlas.height,(this._xOffset+e)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}},R$t=class{constructor(e,i){this.width=e,this.height=i,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=nL}},uve=class{constructor(e){this.y=e,this.x=nL}},nL=0,I$t=class{constructor(e,i,r){this._renderer=new A5e(e,i,r,pS.maxSize)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=vj(L$t,this._renderer.renderedWidth,this._renderer.renderedHeight),i=e.getContext("2d");return i.save(),this._renderer.render(i,0,0),i.restore(),new cw(e,{wrap:{s:Ai.CLAMP_TO_EDGE,t:Ai.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}};const L$t={canvas:null},D$t=qe(0,0,1);let N$t=class extends zy{constructor(e,i,r,s){super(e,i,r,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=n8(this.symbolLayer.size);if(e)throw new B("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await Zke.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const i=e.graphic,r=GS(i.geometry);if(r==null)return this.logger.warn(`unsupported geometry type for text symbol: ${i.geometry.type}`),null;const s=this.symbolLayer.text;if(s==null||s==="")return null;const n=One(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(n!=null&&!sRe(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const{verticalAlignment:o}=this.symbolLayer,a=new qke(n);DCt(o,a.screenOffset);const l=new Wke(a,this.symbolLayer.horizontalAlignment,LCt(o));return this._createAs3DShape(i,r,s,l)}createLabel(e,i,r,s,n){const o=e.graphic,a=GS(o.geometry);if(a==null)return this.logger.warn(`unsupported geometry type for label: ${o.geometry.type}`),null;const l=i.text;return!l||/^\s+$/.test(l)?null:this._createAs3DShape(o,a,l,i,r,s,n)}setGraphicElevationContext(e,i,r=0){return super.setGraphicElevationContext(e,i),i.addOffsetRenderUnits(r),i}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,i){return hve(e,i,(r,s)=>{this.updateGraphicElevationContext(s,r)}),Hs.UPDATE}slicePlaneEnabledChanged(e,i){return hve(e,i,r=>{for(const s of r.stageObject.geometries)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,i){const r=i.elevationContext;this.setGraphicElevationContext(e,r,i.metadata!=null?i.metadata.elevationOffset:0),i.needsElevationUpdates=_p(r.mode)||r.mode==="absolute-height"}updateGeometry(e,i){if(this.draped||!this._validateGeometry(i))return!1;const{elevationContext:r,stageObject:s}=e;if(r.mode!==this.getGeometryElevationMode(i))return!1;const n=GS(i);if(!n)return!1;const o=ANe(s,this._context,n,r);if(o==null)return!1;const a=fae(this._context,n);return s.geometries[0].localOrigin===a&&(e.alignedSampledElevation=o,C2(e,n,this._context.elevationProvider),!0)}_defaultElevationInfoNoZ(){return k$t}_createAs3DShape(e,i,r,s,n=null,o=null,a=()=>s.placement.elevationOffset){var V;const l=this.setGraphicElevationContext(e,new XB,s.placement.elevationOffset),c=((V=e.geometry)==null?void 0:V.type)==="polyline",u=e.uid;let d=null,f=null;if(o==null){const X=O5e(s.horizontalPlacement);d=new I$t(r,X,this._textRenderParameters);let q=null;if(this._context.sharedResources.textures!=null){f=this._context.sharedResources.textures.fromData(d.key,()=>d.create()),f.texture.events.on("unloaded",()=>q=hi(q));const Z=this._context.stage.renderView.textures.acquire(f.texture.id);if(Z==null||Zu(Z))return f.release(),null;q=Z}}const m=F$t(d,s),g={occlusionTest:!ue("enable-feature:non-occluded-hud"),screenOffset:s.placement.screenOffset,anchorPosition:m,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.placement.centerOffsetUnits,drawInSecondSlot:!0};if(c&&(g.shaderPolygonOffset=1e-4),o?g.textureId=o.id:f&&(g.textureId=f.texture.id),s.placement.verticalOffset!=null){const{screenLength:X,minWorldLength:q,maxWorldLength:Z}=s.placement.verticalOffset;g.verticalOffset={screenLength:mr(X),minWorldLength:q||0,maxWorldLength:Z??1/0}}const y={screenOffset:g.screenOffset,anchorPosition:m,centerOffsetUnits:g.centerOffsetUnits,verticalOffset:g.verticalOffset,shaderPolygonOffset:g.shaderPolygonOffset};if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:X,screenSizePerspectiveSettingsLabels:q}=this._context.sharedResources,Z=M5e(this._textRenderParameters);g.screenSizePerspective=q.overrideFontHeight(Z.maxHeight),g.screenSizePerspectiveAlignment=X,y.fontHeight=Z.maxHeight}g.hasSlicePlane=this._context.slicePlaneEnabled;const v=(X,q,Z)=>{let ye=X.get(Z);return ye==null&&(ye=new WP(q),X.add(Z,ye)),ye},b=n?v(n,g,JSON.stringify(y)):new WP(g),w=s.placement.translation,x=d?Ei(d.displayWidth,d.displayHeight):m2,T=s.placement.centerOffset,E=D$t,M=gt(),O=nK(b,E,w,null,x,T,M,null),D=pae(this._context,i,O,l,u);if(D==null)return null;const U=(X,q,Z,ye,L,N)=>{const z=a()||s.placement.elevationOffset,W=this.setGraphicElevationContext(e,q,z);return jS(X,W,Z,ye,L,N)},k=new Vy(this,D.object,[O],n==null?[b]:null,f,U,l);k.alignedSampledElevation=D.sampledElevation,k.needsElevationUpdates=_p(l.mode)||l.mode==="absolute-height",k.getScreenSize=(X=gt())=>(X[0]=d?d.displayWidth:s.displaySize[0],X[1]=d?d.displayHeight:s.displaySize[1],X);const H=new IDe(s.placement.elevationOffset,r);return k.metadata=H,C2(k,i,this._context.elevationProvider),k}};function hve(t,e,i){t&&t.forEach(r=>{const s=e(r);s!=null&&i(s,r.graphic)})}function F$t(t,e){if(e.verticalPlacement==="baseline"){const r=$Ct[e.horizontalPlacement],s=t!=null?t.baselineAnchorY:0;return Ei(r,s)}const i=ICt(e.horizontalPlacement,e.verticalPlacement);return oV[i]}const k$t={mode:"relative-to-ground",offset:0};function dve(t){t.fragment.uniforms.add(new xt("texWaveNormal",e=>e.waveNormal),new xt("texWavePerturbation",e=>e.wavePerturbation),new ji("waveParams",e=>Ss(U$t,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new Hr("waveDirection",e=>Di(V$t,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))),t.include(pwt),t.fragment.code.add(S`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const U$t=ci(),V$t=gt();function Xke(t){const e=new Hi,{vertex:i,fragment:r}=e;Wc(i,t),e.include(gl,t),e.attributes.add($.POSITION,"vec3"),e.attributes.add($.UV0,"vec2");const s=new ji("waterColor",n=>n.color);if(t.output===G.Color&&t.draped)return e.varyings.add("vpos","vec3"),i.uniforms.add(s),i.code.add(S`
        void main(void) {
          if (waterColor.a < ${S.float(la)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(s),r.code.add(S`void main() {
fragColor = waterColor;
}`),e;switch(t.output===G.Color&&(e.include(yD,t),e.include(LO,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.multipassEnabled&&e.varyings.add("depth","float"),i.uniforms.add(s),i.code.add(S`
      void main(void) {
        if (waterColor.a < ${S.float(la)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===G.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(Uy,t),t.output){case G.Color:e.include(xB),e.include(Zne,{pbrMode:Pt.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(dve),e.include(Mn,t),e.include(YP,t),e.include(yFe,t),r.uniforms.add(s,new tt("timeElapsed",n=>n.timeElapsed),i.uniforms.get("view"),i.uniforms.get("localOrigin")),fm(r,t),r.include(Fy),t.transparencyPassType===ft.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),q_(r),Ry(r),r.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?S`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${t.transparencyPassType===ft.ColorAlpha?S`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `);break;case G.Normal:e.include(yD,t),e.include(dve,t),e.include(Mn,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),i.uniforms.add(s),i.code.add(S`
        void main(void) {
          if (waterColor.a < ${S.float(la)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new tt("timeElapsed",n=>n.timeElapsed)),r.code.add(S`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case G.Highlight:e.include(Mw,t),e.varyings.add("vpos","vec3"),i.uniforms.add(s),i.code.add(S`
      void main(void) {
        if (waterColor.a < ${S.float(la)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(Mn,t),r.code.add(S`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case G.ObjectAndLayerIdColor:e.include(aE,t),e.varyings.add("vpos","vec3"),i.uniforms.add(s),i.code.add(S`
      void main(void) {
        if (waterColor.a < ${S.float(la)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),e.include(Mn,t),r.code.add(S`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return e}const z$t=Object.freeze(Object.defineProperty({__proto__:null,build:Xke},Symbol.toStringTag,{value:"Module"}));let Jke=class Qke extends Ki{initializeConfiguration(e,i){i.spherical=e.viewingMode===Je.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new er(e.rctx,Qke.shader.get().build(this.configuration),Pi)}_setPipelineState(e){const i=this.configuration,r=e===ft.NONE,s=e===ft.FrontFace;return Kt({blending:i.output!==G.Normal&&i.output!==G.Highlight&&i.output!==G.ObjectAndLayerIdColor&&i.transparent?r?Bu:Q_(e):null,depthTest:i.draped?null:{func:Aw(e)},depthWrite:i.draped?null:r?i.writeDepth?Wu:null:K6(e),drawBuffers:K_(e),colorWrite:ui,polygonOffset:r||s?null:i8(i.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};Jke.shader=new qi(z$t,()=>oe(()=>Promise.resolve().then(()=>k9t),void 0));let ao=class extends Xc{constructor(){super(...arguments),this.output=G.Color,this.transparencyPassType=ft.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}};h([j({count:G.COUNT})],ao.prototype,"output",void 0),h([j({count:ft.COUNT})],ao.prototype,"transparencyPassType",void 0),h([j()],ao.prototype,"spherical",void 0),h([j()],ao.prototype,"receiveShadows",void 0),h([j()],ao.prototype,"hasSlicePlane",void 0),h([j()],ao.prototype,"transparent",void 0),h([j()],ao.prototype,"enableOffset",void 0),h([j()],ao.prototype,"writeDepth",void 0),h([j()],ao.prototype,"hasScreenSpaceReflections",void 0),h([j()],ao.prototype,"doublePrecisionRequiresObfuscation",void 0),h([j()],ao.prototype,"hasCloudsReflections",void 0),h([j()],ao.prototype,"objectAndLayerIdColorInstanced",void 0),h([j()],ao.prototype,"draped",void 0),h([j()],ao.prototype,"multipassEnabled",void 0),h([j()],ao.prototype,"cullAboveGround",void 0),h([j({constValue:!1})],ao.prototype,"occlusionPass",void 0),h([j({constValue:Pt.Water})],ao.prototype,"pbrMode",void 0),h([j({constValue:!0})],ao.prototype,"useCustomDTRExponentForWater",void 0),h([j({constValue:!0})],ao.prototype,"highStepCount",void 0),h([j({constValue:!1})],ao.prototype,"useFillLights",void 0);let B$t=class extends Sw{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){const i=e.ssr.lastFrameColor!=null;i!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:i})}_updateCloudsReflectionState(e){const i=e.cloudsFade.data!=null;i!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:i})}ensureResources(e){return this._techniques.constructionContext.waterTextures.ensureResources(e)}beginSlot(e){return this._output===G.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniques.constructionContext.waterTextures.passParameters),this.ensureTechnique(Jke,e)}},j$t=class extends sle{constructor(e){super(e,new Kke),this._configuration=new ao,this._animation=new O3e,this.produces=new Map([[Pe.OPAQUE_MATERIAL,i=>__(i)&&!this.parameters.transparent||zS(i)],[Pe.TRANSPARENT_MATERIAL,i=>__(i)&&this.parameters.transparent||zS(i)],[Pe.DRAPED_MATERIAL,i=>this.parameters.draped&&i===G.Color||zS(i)],[Pe.DRAPED_WATER,i=>i===G.Normal]])}getConfiguration(e,i){return this._configuration.output=e,this._configuration.writeDepth=!0,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<e8,this._configuration.multipassEnabled=i.multipassEnabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}update(e){const i=Math.min(e.camera.relativeElevation,e.camera.distance);this._animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*i<G$t;const r=this._animation.advance(e);return this.setParameters({timeElapsed:Tre(this._animation.time)*this.parameters.animationSpeed},!1),this._animation.enabled&&r}createGLMaterial(e){return new B$t(e)}createBufferWriter(){return new kO(ue("enable-feature:objectAndLayerId-rendering")?KMt:JMt)}get test(){}},Kke=class extends Uoe{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=Ei(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=ri(0,0,0,0),this.transparent=!0,this.hasSlicePlane=!1,this.draped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=C(),this.modelTransformation=null}};const G$t=35e3,H$t={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},q$t=["polyline","polygon","extent"];let fS=class bee extends zy{constructor(e,i,r,s){super(e,i,r,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,q$t,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(i):this._createAs3DShape(i,r,i.uid)}ensureMaterial(){if(this._materials[0])return;const e=new Kke,i=this.symbolLayer.color;i!=null&&(e.color=je.toUnitRGBA(i));const r=this._getCombinedOpacity(i,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],r],e.transparent=r<1||this.needsDrivenTransparentPass,e.waveDirection=this.symbolLayer.waveDirection!=null?bee.headingVectorFromAngle(this.symbolLayer.waveDirection):Ei(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=H$t[s];e.waveStrength=n.waveStrength,e.waveTextureRepeat=n.textureRepeat,e.waveVelocity=n.waveVelocity,e.flowStrength=n.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.draped=this.draped,this._materials[0]=new j$t(e),this._context.stage.add(this._materials[0])}layerOpacityChanged(){if(this._materials[0]==null)return;const e=this._materials[0].parameters.color,i=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=i<1||this.needsDrivenTransparentPass;this._materials[0].setParameters({color:[e[0],e[1],e[2],i],transparent:r})}layerElevationInfoChanged(e,i,r){const s=this._elevationContext.mode,n=wN(bee.elevationModeChangeTypes,r,s);if(n!==Hs.UPDATE)return n;const o=_p(s);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){var d;const s=uD(e.geometry);if(s==null)return null;const n=Lae(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=n.position.length/3,a=go(2*o);pve(a,n.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new W$t(n,a,this._context.layer.uid,e.uid);if(l.objectAndLayerIdColor=(d=this._context.stage.renderView)==null?void 0:d.getObjectAndLayerIdColor(l),this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,s.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new Ow({geometries:l.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),u=new Vy(this,c,l.outGeometries,null,null,EDe,i);return u.alignedSampledElevation=l.renderData.sampledElevation,u.needsElevationUpdates=_p(i.mode),u}_create3DShapeGeometries(e){const i=e.renderData.polygons,r=e.uvCoords;for(const{count:s,index:n,position:o,mapPositions:a,holeIndices:l}of i){if(this._context.clippingExtent!=null&&(Qr(yx),Uh(yx,a),!Gf(yx,this._context.clippingExtent)))continue;const c=XP(a,l,3);if(c.length===0)continue;const u=up(r,2*n,2*s),d=nye({material:this._materials[0],indices:c,mapPositions:a,attributeData:{position:o,uv0:u}},e.objectAndLayerIdColor);e.outGeometries.push(d)}}_createAsOverlay(e){var a;const i=uD(e.geometry);if(i==null)return null;this._materials[0].renderPriority=this._renderPriority;const r=a4e(i,this._context.overlaySR),s=r.position.length/3,n=go(2*s);pve(n,r.position,s,this._context.overlaySR);const o=new Z$t(r,n,this._context.layer.uid,e.uid);return o.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(o),o.outBoundingBox=Qr(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,i.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new C8(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const i=e.uvCoords,r=e.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of r){if(Qr(yx),Uh(yx,s),!Gf(yx,this._context.clippingExtent))continue;NP(e.outBoundingBox,yx);const l=XP(s,n,3);if(l.length===0)continue;const c=up(i,2*o,2*a),u=nye({material:this._materials[0],indices:l,attributeData:{position:s,uv0:c}},e.objectAndLayerIdColor);e.outGeometries.push(new KP(u,e))}}static headingVectorFromAngle(e){const i=gt(),r=PG(e);return i[0]=Math.sin(r),i[1]=Math.cos(r),i}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};function pve(t,e,i,r){const s=cc(r);Kh(Vv);for(let a=0;a<i;a++)Di(fve,e[3*a],e[3*a+1]),pse(Vv,fve);g2(Vv,Vv,s);const n=Vv[0]%fS.unitSizeOfTexture,o=Vv[1]%fS.unitSizeOfTexture;w5[0]=Vv[0]-n,w5[1]=Vv[1]-o;for(let a=0;a<i;a++)t[2*a]=(e[3*a]*s-w5[0])/fS.unitSizeOfTexture,t[2*a+1]=(e[3*a+1]*s-w5[1])/fS.unitSizeOfTexture}fS.unitSizeOfTexture=100,fS.elevationModeChangeTypes={definedChanged:Hs.RECREATE,staysOnTheGround:Hs.NONE,onTheGroundChanged:Hs.RECREATE};const w5=gt(),Vv=oi(),fve=gt(),yx=io();let W$t=class extends y8{constructor(e,i,r,s){super(e,r,s),this.uvCoords=i}},Z$t=class extends y8{constructor(e,i,r,s){super(e,r,s),this.uvCoords=i}};function Y$t(t,e,i,r){var n;const s=((n=J$t[t.type])==null?void 0:n[e.type])||X$t[e.type];return s?new s(t,e,i,r):(ne.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const X$t={icon:cee,object:eOt,line:k5e,path:t$t,fill:Gke,extrude:fTt,text:N$t,water:fS},J$t={"mesh-3d":{fill:oAt}};let Q$t=class extends dae{set symbol(e){this._symbol=e,e.symbolLayers.forEach((i,r)=>{const s=this.symbolLayers[r];s!=null&&(s.symbol=e,s.symbolLayer=i)})}get symbol(){return this._symbol}constructor(e,i,r){super(i.schedule),this._symbol=e,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const s=[];for(let n=0;n<r;n++){const o=i.at(n);if(o.enabled===!1)continue;x5.renderPriority=1-(1+n)/r,x5.renderPriorityStep=1/r,x5.ignoreDrivers=o.ignoreDrivers;const a=Y$t(this.symbol,o,this._context,x5),l=FD(e,()=>{this.symbolLayers[n]=null,a.destroy()});l&&s.push(l),this.symbolLayers[n]=a}if(await TG(this.symbolLayers,async(n,o)=>{if(n!=null)try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}}),s.forEach(n=>n.remove()),Dt(e),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(e){const i=this.symbolLayers[e];return i!=null?i.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e==null?void 0:e.queryForSnapping)}createGraphics3DGraphic(e,i){var o,a;const r=e.graphic,s=this.symbolLayers.map(l=>(l==null?void 0:l.createGraphics3DGraphic(e))??null),n=this._context.arcade||((a=(o=this._context.featureExpressionInfoContext)==null?void 0:o.arcade)==null?void 0:a.modules)||null;return new Pbt(r,i||this,s,e.layer,n)}get complexity(){return hae(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,i){const r=this.symbolLayers.length;for(let s=0;s<r;s++){const n=this.symbolLayers[s],o=a=>{const l=a.layers[s];return l instanceof Vy?l:null};if(n!=null&&!n.globalPropertyChanged(e,i,o))return!1}return!0}applyRendererDiff(e,i){return this.loadStatus!==Ph.LOADED?mn.RecreateSymbol:this.symbolLayers.reduce((r,s)=>r!==mn.RecreateSymbol&&s!=null?Math.min(r,s.applyRendererDiff(e,i)):r,mn.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===Ph.FAILED||e.diff.type!=="partial")return;const i=e.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(s==null)return;const o=r[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const u=l.layers[n];u!=null&&a.graphics3DGraphicPatches.forEach(d=>d(u,c))})}})}updateGeometry(e,i){return this._updateGeometryOrTransform(e,(r,s)=>r.updateGeometry(s,i))}updateTransform(e,i,r,s){return this._updateGeometryOrTransform(e,(n,o)=>n.updateTransform(o,i,r,s))}_updateGeometryOrTransform(e,i){for(let r=0;r<this.symbolLayers.length;r++){const s=this.symbolLayers[r];if(s==null)continue;const n=e.layers[r];if(!n||!i(s,n))return!1}return!0}onRemoveGraphic(e){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(r==null)continue;const s=e.layers[i];s!=null&&r.onRemoveGraphic(s)}}getFastUpdateStatus(){let e=0,i=0,r=0;return this.symbolLayers.forEach(s=>{s!=null&&(s.loadStatus===Ph.LOADING?e++:s.isFastUpdatesEnabled()?r++:i++)}),{loading:e,slow:i,fast:r}}async queryForSnapping(e,i,r,s){const n=this.symbolLayers.filter(sd).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,i,r,s)),o=await Promise.all(n);return Dt(s),o.flat()}destroy(){if(!this.destroyed){super.destroy();for(const e of this.symbolLayers)e!=null&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const x5=new Obt;let K$t=class extends dae{constructor(e,i,r){super(i),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const i=await this.symbol.fetchSymbol({signal:e});i.id=this.symbol.id,this.graphics3DSymbol=this._convert(i),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:TNe}globalPropertyChanged(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,i)}applyRendererDiff(e,i){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,i):mn.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,i)}updateTransform(e,i,r,s){var n;return((n=this.graphics3DSymbol)==null?void 0:n.updateTransform(e,i,r,s))??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function ole(t){return t instanceof K$t?t.graphics3DSymbol:t instanceof Q$t?t:null}const _D=()=>ne.getLogger("esri.views.3d.layers.graphics.labelPlacement");let eRt=class{constructor(e,i,r,s=null){this.graphics3DGraphic=e,this.labelSymbol=i,this.labelClass=r,this.disablePlacement=s}};function mve(t){const e=cRt(t);if(e==null)return null;const i=tRt(t,e);if(i==null)return null;const r=i.anchor,s=!!e.hasLabelVerticalOffset,n=e.verticalOffset;return rRt(new qke(n,r,s),i,t)}function tRt(t,e){if(e.anchor)return e;const i=t.labelClass.labelPlacement,r=Zf[i],s=r||Cj(t);return i&&!r&&_D().warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),iRt(s,t)}function ale(t){const e=t.graphics3DGraphic.graphics3DSymbol,i=ole(e);return i!=null?i.symbol.symbolLayers.at(0):null}function iRt(t,e){const i=e.graphics3DGraphic.graphic.geometry;if(i==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?(_D().warnOncePerTick(gve(t==null?void 0:t.placement,e.disablePlacement.logEntityDescription)),Cj(e)):t;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return _D().warnOncePerTick(gve(t==null?void 0:t.placement,`'${r}' geometries`)),Cj(e);break;case"point":case"mesh":return t}return t}function gve(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function Cj(t){const e=t.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:Nn,anchor:"center"};case"polygon":{const i=ale(t);return i!=null&&i.type==="extrude"?Zf["above-center"]:{placement:"center-center",normalizedOffset:Nn,anchor:"center"}}case"point":case"mesh":return Zf["above-center"];default:return}}function rRt(t,e,i){const r=i.graphics3DGraphic.graphic.geometry;if(r==null)return null;switch(r.type){case"point":case"mesh":nRt(t,e,i);break;case"polygon":sRt(t,e,i)}const s=ECt-bj;return t.screenOffset[0]+=s*e.normalizedOffset[0],t.screenOffset[1]+=s*e.normalizedOffset[1],t}function sRt(t,e,i){const r=ale(i);if(r!=null)switch(r.type){case"extrude":{const s=i.graphics3DGraphic.layers[0];s!=null?(s.getBoundingBoxObjectSpace(oL),jf(oL,t.translation),t.translation[2]=xw(oL)/2):pe(t.translation,0,0,0),eUe(t,e,s);break}}}function nRt(t,e,i){const r=ale(i);if(r==null)return;const s=i.graphics3DGraphic.layers[0];switch(s!=null?s.getCenterObjectSpace(t.translation):pe(t.translation,0,0,0),r.type){case"icon":case"text":oRt(t,e,i,s);break;case"object":case"fill":eUe(t,e,s)}}function oRt(t,e,i,r){const{graphics3DGraphic:s}=i,n=r!=null?r.getScreenSize():null;if(s.isDraped||n==null)t.hasLabelVerticalOffset||t.anchor==="center"||(Zf[i.labelClass.labelPlacement]&&_D().warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center");else{const o=aRt(i);t.screenOffset[0]=n[0]/2*(e.normalizedOffset[0]-o[0]);const a=n[1]/2*(e.normalizedOffset[1]-o[1]);t.hasLabelVerticalOffset?(t.centerOffset[1]=a,t.centerOffsetUnits="screen"):t.screenOffset[1]=a}}function aRt(t,e=uRt){const{graphics3DGraphic:i}=t,r=i.layers[0],s=(r==null?void 0:r.stageObject.geometries[0].material)??null;if(s&&s instanceof WP){const n=s.parameters.anchorPosition;e[0]=2*(n[0]-.5),e[1]=2*(n[1]-.5)}else e[0]=0,e[1]=0;return e}function eUe(t,e,i){const r=i!=null?i.getBoundingBoxObjectSpace(oL):oL,s=qe(r[3]-r[0],r[4]-r[1],r[5]-r[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);t.centerOffset[0]=n/2*e.normalizedOffset[0];const o=t.translation[2],a=s[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=Ve(s);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function lRt(t){return t==="above-center"}function cRt(t){const e=t.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=t,s=ole(r.graphics3DSymbol),n=(s==null?void 0:s.symbol.type)==="point-3d"?s.symbol:null,o=Zf[e]||Cj(t);return n!=null&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:n.verticalOffset.clone(),anchor:null,normalizedOffset:null}:!i||!i.hasVisibleVerticalOffset()||n!=null&&n.supportsCallout()&&n.verticalOffset&&!r.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&lRt(o.placement)?{placement:"above-center",verticalOffset:i.verticalOffset.clone(),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(_D().errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}const Zf={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},yve={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in yve){const e=yve[t],i=Zf[t];e.forEach(r=>{Zf[r]=i})}Object.freeze&&(Object.freeze(Zf),Object.keys(Zf).forEach(t=>{var e;Object.freeze(Zf[t]),Object.freeze((e=Zf[t])==null?void 0:e.normalizedOffset)}));const uRt=[0,0],oL=io();let _ve=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,i){this._materials.set(e,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}},vve=class{constructor(e,i){this.labelingContext=e,this.graphics3DGraphic=i,this.hasGraphics3DResources=!1,this.visible=!1,this.addedToTextureAtlas=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},hRt=class{constructor(e,i,r,s,n){this.labelClass=e,this.graphics3DSymbol=i,this.graphics3DCalloutSymbolLayer=r,this.textRenderParameters=s,this.labelFunction=n,this.calloutSymbolLayerIndex=0}},dRt=class{constructor(e,i,r,s,n,o,a,l){this.layer=i,this.graphics3DCore=r,this.scaleVisibility=s,this.emptySymbolLabelSupported=n,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new CFe(e,{pickable:!0,disableOctree:!0},i.uid)}destroy(){this.stageLayer.destroy()}},mT=class extends Ue{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this.addHandles([te(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),te(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(It.LABELER,this)]),this._textTextureAtlas=new pS({view:this.view}),this._hudMaterialCollection=new _ve(this.view._stage),this._calloutMaterialCollection=new _ve(this.view._stage)}dispose(){this.removeAllHandles(),this._textTextureAtlas=Ut(this._textTextureAtlas),this._hudMaterialCollection=Ut(this._hudMaterialCollection),this._calloutMaterialCollection=Ut(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear()}destroy(){this.dispose(),Vp.graphic=null,Vp.renderingInfo=null,Vp.layer=null}_activateLabelingContext(e){e.graphics.forEach((i,r)=>{const s=new vve(e,i);this._labels.set(r,s),e.labelsToInitialize.set(r,s),i.setVisibilityFlag(ko.LABEL,Fa.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((i,r)=>{i.setVisibilityFlag(ko.LABEL,Fa.USER,!1),this.setLabelGraphicVisibility(i,!1),i.clearLabelGraphics(),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];r&&(this._textTextureAtlas.addTextTexture(r,i.stageObject),e.addedToTextureAtlas=!0)}}_removeLabelTextureFromAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];r!=null&&(this._textTextureAtlas.removeTextTexture(r,i.stageObject),e.addedToTextureAtlas=!1)}}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),pa}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const i of this._labelingContexts)if(i.active)if(E7(i))this._dirty=!0;else if(C7(i.labelClassContexts)){if(i.labelClassContexts===null){this._deactivateLabelingContext(i);continue}this._createLabelClassContext(i),this._dirty=!0}else Fh(i.labelsToInitialize,(r,s)=>(this._ensureGraphics3DResources(r)&&(this._labels.set(s,r),this.deconflictor.setDirty(),e.madeProgress()),(r.visible&&r.textInitialized||!r.visible&&r.hasGraphics3DResources)&&(i.labelsToInitialize.delete(s),e.madeProgress()),e.done))&&(this._dirty=!0);this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var o,a,l;const i=(o=e.labelClassAbortController)==null?void 0:o.signal;e.layer.when&&await e.layer.when(),Dt(i),(a=e.scaleVisibility)==null||a.updateScaleRangeActive();const r=e.graphics3DCore,s=r.layer,n=(l=s.labelingInfo)==null?void 0:l.filter(c=>!!c.symbol);!n||n.length===0||(await TG(n,async(c,u)=>{const d=c.symbol,f=ole(r.getOrCreateGraphics3DSymbol(d));if(f==null)return void ne.getLogger(this).error("Failed to create Graphics3DSymbol for label");await f.load(),Dt(i);let m=null;One(d)&&d.hasVisibleCallout()&&(m=B1t(d,r.symbolCreationContext),await m.load(),Dt(i));const g=await Qh($_t(c,e.layer.fieldsIndex,this.view.spatialReference));if(Dt(i),g.ok===!0){const y=await this._createTextRenderParameters(f.symbol);Dt(i),e.labelClassContexts[u]=new hRt(c,f,m,y,g.value)}else ne.getLogger(this).error(`Label expression failed to evaluate: ${g.error}`)}),Dt(i))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(i=>{if(us(i))throw i;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const i=e.symbolLayers.at(0);return(i==null?void 0:i.type)!=="text"?null:Zke.fromSymbol(i,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced;const i=e.labelClassAbortController;e.labelClassAbortController=new AbortController,oc(i),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,i,r,s,n,o){const a=new Wke(r,o_e(r.anchor),RCt(r.anchor),e.text,Ei(e.displayWidth,e.displayHeight));return Vp.graphic=i,Vp.renderingInfo=null,Vp.layer=s,n.createLabel(Vp,a,this._hudMaterialCollection,this._textTextureAtlas,()=>{const l=mve(o);return l?l.elevationOffset:null})}_createLineCalloutGraphic(e,i,r,s,n){Vp.graphic=e,Vp.layer=n;const o=s.screenOffset[0];return Vp.renderingInfo=new V1t(null,i,s.translation,s.centerOffset,o,s.centerOffsetUnits,s.elevationOffset,this._calloutMaterialCollection),r.createGraphics3DGraphic(Vp)}_ensureGraphics3DResources(e){var c,u;if(e.hasGraphics3DResources)return!1;const i=e.graphics3DGraphic;if(i.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,s=r.labelClassContexts;if(C7(s)||!r.emptySymbolLabelSupported&&i.layers.length===0)return!1;let n=!1;const o=i.graphic,a=r.layer,l=T5(r.layer);for(let d=0;d<s.length;d++){const f=e.textRenderers[d],m=e.textLabelPlacements[d];if(f==null||m==null)continue;const g=s[d],y=g.graphics3DSymbol,v=y.symbol&&y.symbol.type==="label-3d"?y.symbol:null,b=y.symbolLayers[0];if(!b)continue;b.setElevationInfoOverride(r.elevationInfoOverride);const w=new eRt(i,v,g.labelClass),x=this._createTextSymbolGraphic(f,o,m,a,b,w);if(x==null)return!1;x._labelClass=g.labelClass,x._labelIndex=d,i.addLabelGraphic(x,r.stageLayer),i.deconflictionPriority=((c=g.textRenderParameters)==null?void 0:c.definition.size)??0,i.setVisibilityFlag(ko.LABEL,Fa.USER,l),i.setVisibilityFlag(ko.LABEL,Fa.SCALE_RANGE,!0),i.setVisibilityFlag(ko.LABEL,Fa.DECONFLICTION,!1),n=!0;const T=g.graphics3DCalloutSymbolLayer;if(T&&m.hasLabelVerticalOffset){T.setElevationInfoOverride(r.elevationInfoOverride);const E=this._createLineCalloutGraphic(o,v,T,m,a);E!=null&&(g.calloutSymbolLayerIndex=i.labelLayers.length,i.addLabelGraphic(E,r.stageLayer))}break}return n&&((u=r.scaleVisibility)==null||u.updateGraphicLabelScaleVisibility(i)),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const i=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelLayers){if(r._labelClass==null)continue;const s=i[r._labelIndex].graphics3DSymbol.symbolLayers[0];s==null||s.onRemoveGraphic(r)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var n;if(e.textInitialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(C7(r))return;const s=e.graphics3DGraphic.graphic;for(let o=0;o<r.length;o++){const a=r[o];if(e.textRenderers[o]=null,e.textLabelPlacements[o]=null,(a==null?void 0:a.textRenderParameters)==null)continue;const l=a.labelFunction;let c;if(l.type==="arcade")try{const w=l.needsHydrationToEvaluate()?p_t(s,i.layer):s;c=l.evaluate(w)}catch{c=null}else c=l.evaluate(s);if(c==null||c===""||/^\s+$/.test(c))continue;const u=a.graphics3DSymbol,d=((n=u.symbol)==null?void 0:n.type)==="label-3d"?u.symbol:null;if(!u.symbolLayers[0])continue;const f=e.graphics3DGraphic,m=a.labelClass,g=i.disablePlacement,y=mve({graphics3DGraphic:f,labelSymbol:d,labelClass:m,disablePlacement:g});if(y==null)continue;const v=o_e(y.anchor),b=O5e(v);e.textRenderers[o]=new A5e(c,b,a.textRenderParameters,pS.maxSize),e.textLabelPlacements[o]=y}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,i){const r=i.graphic.uid;if(e.graphics.set(r,i),e.active){const s=new vve(e,i);this._labels.set(r,s),e.labelsToInitialize.set(r,s)}this.setDirty(),this.deconflictor.setDirty()}_updateGraphicGeometry(e,i){const r=i.graphic.uid,s=this._labels.get(r);if(!s)return!0;for(const n of s.graphics3DGraphic.labelLayers)if(n._labelClass!=null&&!e.labelClassContexts[n._labelIndex].graphics3DSymbol.symbolLayers[0].updateGeometry(n,i.graphic.geometry))return!1;return this.setDirty(),this.deconflictor.setDirty(),!0}_removeGraphic(e,i){const r=i.graphic.uid,s=this._labels.get(r);e.graphics.delete(r),s&&(this._destroyGraphic(s,r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,i){this._labels.delete(i),e.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,i){if(!i)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of i){const s=e.graphics.get(r);s&&(this._removeGraphic(e,s),this._addGraphic(e,s))}}_globalPropertyChanged(e,i){for(const r of i.labelClassContexts){const s=new Map;i.graphics.forEach(o=>s.set(o.graphic.uid,o));const n=o=>o.labelLayers[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,s,n),r.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,s,o)}}}_visibilityInfoChange(e){const i=T5(e.layer);i&&!e.active&&this._activateLabelingContext(e),!i&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((i,r)=>{const s=this._labels.get(r);s&&(this._destroyGraphic(s,r),s.visible=!1,e.labelsToInitialize.set(r,s))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const i of this._labelingContexts)if(i.graphics3DCore===e)return i;return null}addGraphicsOwner(e,i,r){const s=(r==null?void 0:r.emptySymbolLabelSupported)||!1,n=(r==null?void 0:r.elevationInfoOverride)||null,o=(r==null?void 0:r.disablePlacement)||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new dRt(this.view._stage,a,e,i,s,n,o,T5(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),updateGraphicGeometry:c=>this._updateGraphicGeometry(l,c),layerLabelsEnabled:()=>T5(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),remove:()=>this._removeGraphicsOwner(e),setDirty:()=>this.setDirty()}}_removeGraphicsOwner(e){const i=this._findLabelingContext(e);if(!i)return;const r=this._labelingContexts.indexOf(i);this._labelingContexts.splice(r,1),i.graphics.forEach(s=>this._removeGraphic(i,s)),i.destroy(),this.setDirty()}setLabelGraphicVisibility(e,i){const r=e.graphic.uid,s=this._labels.get(r);s&&s.visible!==i&&(i&&!s.addedToTextureAtlas?(this._addLabelTextureToAtlas(s),s.textInitialized||s.labelingContext.labelsToInitialize.set(r,s)):!i&&s.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(s),s.visible=i,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(i=>E7(i))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((i,r)=>i+(E7(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){}};function E7(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function C7(t){return!t||t.length===0}function T5(t){var e;return t.labelsVisible===!0&&!!((e=t.labelingInfo)!=null&&e.some(i=>!!i.symbol))}h([p({constructOnly:!0})],mT.prototype,"view",void 0),h([p({constructOnly:!0})],mT.prototype,"deconflictor",void 0),h([p()],mT.prototype,"_textTextureAtlas",void 0),h([p({type:Boolean,readOnly:!0})],mT.prototype,"updating",null),mT=h([I("esri.views.3d.layers.graphics.Labeler")],mT);const Vp=new z1t(null,null,null);let zI=class sM{constructor(e,i,r,s=null){this.lij=[0,0,0],this.extent=oi(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Vc.VISIBLE_ON_SURFACE,screenRect:oi(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(e,i,r,s)}acquire(e,i,r,s){this.tilingScheme=s,this.id=sM.id(e,i,r),this.lij[0]=e,this.lij[1]=i,this.lij[2]=r,s.getExtent(e,i,r,this.extent),this.resolution=s.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const i=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return e?(e[0].acquire(i,r,s,this.tilingScheme),e[1].acquire(i,r+1,s,this.tilingScheme),e[2].acquire(i,r,s+1,this.tilingScheme),e[3].acquire(i,r+1,s+1,this.tilingScheme),e):[new sM(i,r,s,this.tilingScheme),new sM(i,r+1,s,this.tilingScheme),new sM(i,r,s+1,this.tilingScheme),new sM(i,r+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,A_(e.measures.screenRect,this.measures.screenRect)}static id(e,i,r){return`${e}/${i}/${r}`}};var Vc;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(Vc||(Vc={}));function pRt(t,e,i,r,s,n,o=1){const a=jb(e,s,jG);if(a==null)return!1;if(a===Vs){if(t===r&&i===n)return!0;const c=i+o;for(let u=i,d=n;u<c;++u,++d)ve(r[d],t[u]);return!0}const l=i+o;for(let c=i,u=n;c<l;++c,++u)a(t[c],0,r[u],0);return!0}const tUe=.5*Math.PI,fRt=tUe/Math.PI*180;let mRt=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:C(),direction:C()};for(let i=0;i<4;i++)this._extent[i]={origin:C(),direction:C(),cap:{next:null,direction:C()}},this._planes[i]=rr();this._planes[Er.NEAR]=rr(),this._planes[Er.FAR]=rr(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,i,r,s=!0){const n=this._extent;this._toRenderBoundingExtent(e,i,r),Ee(this._center.origin,n[0].origin,n[2].origin),de(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||de(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,U_(a.cap.direction,a.origin,l.origin),GL(a.direction,a.cap.direction,a.origin,this._planes[o]),s||de(a.direction,a.direction,-1)}GL(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[Er.NEAR]),s?dX(this._planes[Er.NEAR],this._planes[Er.FAR]):(JG(this._planes[Er.FAR],this._planes[Er.NEAR]),dX(this._planes[Er.NEAR],this._planes[Er.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=i,this._minGlobalAltitude=.9*br(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,i,r=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===Je.Global){const n=this._maxSpanSpatialReference.isGeographic?fRt:tUe*i;if(this._maxSpan>n)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const n=this._extent[0];return!(r||!e.intersectsRay(td(n.origin,n.direction)))}for(let n=0;n<this._extent.length;n++){const o=this._extent[n];if(!r&&e.intersectsRay(td(o.origin,o.direction))||e.intersectsLineSegment(kS(o.origin,o.cap.next,yRt),o.cap.direction))return!0}const s=r?this._planes:this._planesWithoutFar;for(let n=0;n<e.lines.length;n++){const o=e.lines[n];if(Aft(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,i,r){fse(e,zp),zp[2]=r,Gh(i,zp,M7,this._renderCoordsHelper.spatialReference),eo(bve,M7),Qr(nu);for(const{x0:n,x1:o,y0:a,y1:l}of gRt)for(let c=0;c<5;c++){const u=c/4;zp[0]=Bt(e[n],e[o],u),zp[1]=Bt(e[a],e[l],u),zp[2]=r,Go(zp,i,zp,this._renderCoordsHelper.spatialReference),nt(zp,zp,bve),hm(nu,zp)}pe(this._extent[0].origin,nu[0],nu[1],nu[2]),pe(this._extent[1].origin,nu[3],nu[1],nu[2]),pe(this._extent[2].origin,nu[3],nu[4],nu[2]),pe(this._extent[3].origin,nu[0],nu[4],nu[2]);for(let n=0;n<4;++n)nt(this._extent[n].origin,this._extent[n].origin,M7)}_toRenderBoundingExtentLocal(e,i,r){ZG(e,i,n0,this._renderCoordsHelper.spatialReference),pe(this._extent[0].origin,n0[0],n0[1],r),pe(this._extent[1].origin,n0[2],n0[1],r),pe(this._extent[2].origin,n0[2],n0[3],r),pe(this._extent[3].origin,n0[0],n0[3],r)}_toRenderBoundingExtent(e,i,r){switch(this._renderCoordsHelper.viewingMode){case Je.Global:this._toRenderBoundingExtentGlobal(e,i,r);break;case Je.Local:this._toRenderBoundingExtentLocal(e,i,r);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(Rr(e.planes[Er.NEAR],this._center.origin)<0&&Te(this._center.direction,e.direction)<0)return!0;for(let i=0;i<4;i++){const r=this._extent[i];if(Rr(e.planes[Er.NEAR],r.origin)<0&&Te(r.direction,e.direction)<0)return!0}return!1}};const gRt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],zp=C(),M7=ke(),bve=ke(),nu=io(),n0=oi(),yRt=_m();let _Rt=class{constructor(e,i){this._renderCoordsHelper=e,this._getIsGroundOpaque=i,this._surfaceElevation=0,this._isGroundOpaque=!1,this._cache=new Map,this._frustumBoundingSphereCenter=C(),this._frustumBoundingSphereRadius=0,this._frustum=new ub(e),this._extendedFrustum=new ub(e),this._intersector=new mRt({renderCoordsHelper:e}),this._renderSR=e.spatialReference;const r=id(this._renderSR);this._renderSREllipsoidRadius=br(r).radius,this._renderCoordsHelper=e}begin(e,i){this._surfaceElevation=i,this._aboveGround=e.aboveGround,this._isGroundOpaque=this._getIsGroundOpaque(),this._frustum.update(e),Eve(this._frustum),this._updateExtendedFrustum(e),this._updateFrustumBoundingSphere()}end(){this._cache.clear()}calculate(e){const i=this._renderCoordsHelper.viewingMode===Je.Global&&e.lij[0]>=vRt&&e.lij[0]<bRt,r=this._getOrCalculateSingleTileVisibility(e,!i);return r!==Vc.INVISIBLE&&i?this._calculateAggregatedChildrenVisibility(e):r}_calculateAggregatedChildrenVisibility(e){let i=Vc.INVISIBLE;const r=this._cache.get(e.id);if(r!=null)return r;const s=Sve.acquire();e.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==Vc.INVISIBLE&&(i=o,o===Vc.VISIBLE_ON_SURFACE))break}return Sve.release(s),this._cache.set(e.id,i),i}_getOrCalculateSingleTileVisibility(e,i){const r=this._cache.get(e.id);if(r!=null)return r;const s=this._calculateSingleTileVisibility(e);return i&&this._cache.set(e.id,s),s}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===Je.Global&&e.lij[0]<wRt?this._calculateSingleTileVisibilitySided(e,!1)===Vc.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_isTileVisibleInFrustum(e){return this._renderCoordsHelper.viewingMode===Je.Local?this._isTileVisibleInFrustumLocal(e):this._isTileVisibleInFrustumGlobal(e)}_updateFrustumBoundingSphere(){const e=this._frustum,i=e.origin,r=IRt;Ce(r,e.direction);const s=e.points,n=LRt;Li(n,s[4],i);const o=.5*Te(n,n)/Te(r,n),a=this._frustumBoundingSphereCenter;Dn(a,i,r,o);const l=1+o;this._frustumBoundingSphereRadius=l}_isTileVisibleInFrustumLocal(e){const i=e.tilingScheme.spatialReference,r=e.extent,s=this._renderSR,n=MRt;if(n[0]=r[0],n[1]=r[1],n[2]=0,n[3]=r[2],n[4]=r[3],n[5]=0,!gs(n,i,0,n,s,0,2))return!1;const o=Mve;pe(o[0],n[0],n[1],0),pe(o[1],n[3],n[1],0),pe(o[2],n[3],n[4],0),pe(o[3],n[0],n[4],0);const a=Ave;pe(a,.5*(n[0]+n[3]),.5*(n[1]+n[4]),.5*(n[2]+n[5]));const l=ARt;pe(l,0,0,1);const c=.5*gb(o[0],o[2]),u=this._frustum,d=this._frustumBoundingSphereRadius,f=this._frustumBoundingSphereCenter,m=NRt;Li(m,f,a);const g=Te(l,m),y=DRt;if(Dn(y,a,l,g),gb(y,f)>c+d)return!1;const v=CRt,b=this._isGroundOpaque&&this._aboveGround,w=this._isGroundOpaque&&!this._aboveGround,x=Math.min(w?Z$:1/0,g+d),T=Math.max(b?-Z$:-1/0,g-d);for(let E=0;E<4;++E)Dn(v[E],o[E],l,x),Dn(v[E+4],o[E],l,T);return!wee(u.planes,v,8)}_isTileVisibleInFrustumGlobal(e){const i=e.tilingScheme.spatialReference,r=e.extent,s=this._isGroundOpaque&&this._aboveGround,n=this._isGroundOpaque&&!this._aboveGround;if(e.lij[0]<iUe)return!0;const o=Mve,a=.5*(r[0]+r[2]);if(pe(o[0],r[0],r[1],0),pe(o[1],r[2],r[1],0),pe(o[2],r[2],r[3],0),pe(o[3],r[0],r[3],0),pe(o[4],a,r[1],0),pe(o[5],a,r[3],0),!pRt(o,i,0,o,this._renderSR,0,6))return!1;const l=o[0][2]>0,c=o[3][2]<0,u=l||c,d=this._renderSREllipsoidRadius;if(u){const ee=qe(0,0,1),ae=PRt;y1(ae,ee,o[0]);const we=ORt;if(y1(we,ee,o[1]),l){const Ie=Pve,Ge=o[4],ut=Ove;y1(ut,Ge,ee),y1(Ie,ut,Ge);const ot=o[0];mt(ot,ae,Ie),W$(ot,d);const at=o[1];mt(at,we,Ie),W$(at,d)}else if(c){const Ie=Pve,Ge=o[5],ut=Ove;y1(ut,Ge,ee),y1(Ie,Ge,ut);const ot=o[3];mt(ot,Ie,ae),W$(ot,d);const at=o[2];mt(at,Ie,we),W$(at,d)}}const f=Ave;{const ee=Li(VRt,o[3],o[0]);Ce(ee,ee);const ae=Ee(zRt,o[0],o[3]);de(ae,ae,.5);const we=-Te(ae,ee),Ie=Ee(BRt,o[0],o[1]);de(Ie,Ie,.5);const Ge=Ee(jRt,o[2],o[3]);de(Ge,Ge,.5);const ut=Li(GRt,Ge,Ie);Ce(ut,ut);const ot=-(we+Te(ee,Ie))/Te(ee,ut);Dn(f,Ie,ut,ot),W$(f,d)}const m=this._frustumBoundingSphereRadius,g=this._frustumBoundingSphereCenter,y=this._frustum,v=y.planes,b=$Rt;Ce(b,f);const w=Te(o[0],b)/Wl(o[0]),x=y.origin,T=y.points;let E=!1;if(s){{E=!0;const ae=Ce(C(),x);for(let we=0;we<4;++we){const Ie=T[4+we],Ge=Li(C(),Ie,x);Ce(Ge,Ge);const ut=mt(C(),ae,Ge);Ce(ut,ut);const ot=mt(C(),Ge,ut);if(Ce(ot,ot),Te(x,ot)>d){E=!1;break}}}if(E&&Te(x,b)<d*w-Z$)return!1;const ee=Ce(oIt,y.origin);if(Te(ee,b)<0)return!1;{const ae=Ce(aIt,y.direction);if(Te(ae,b)>lIt)return!1}}const M=Math.sqrt(1-w*w);if(M>.9)return!0;let O=!1;{const ee=Te(b,g),ae=Wl(g);if(ae<=m&&!v.some(Ge=>Rr(Ge,A7)>0)){if(!s)return!0;O=!0}const we=ee/ae;if(!O&&ee<=0&&-ee>m)return!1;const Ie=m/ae;if(Math.sqrt(1-we*we)*Math.sqrt(1-Ie*Ie)-Ie*we>M)return!1}if(!E&&(o.some(ee=>y.intersectsPoint(ee))||y.intersectsPoint(f)))return!0;const D=FRt;Li(D,g,A7);const U=Te(D,b),k=RRt;de(k,b,U);const H=gb(k,g),V=i.isWGS84,X=e.lij,q=V&&X[2]===2**X[0]-1,Z=V&&X[2]===0,ye=Z?eIt:q?QRt:XRt,L=Z?tIt:q?KRt:JRt;if(!O){const ee=o,ae=iIt,we=HRt,Ie=qRt,Ge=A7;for(const ut of ye){const ot=ee[ut];if(Cve(we,ee[(ut+1)%4],ot),Cve(Ie,Ge,ot),y1(ae,Ie,we),ERt(ae,T,1))return!1}}let N=null;if(!s&&U<1.01*m){const ee=2.5*m;if(H>w*ee+m)return!1;const ae=URt,we=ee/w;for(let Ie=0;Ie<4;++Ie)de(ae[Ie],o[Ie],we/d);pe(ae[4],0,0,0),N=ae}else{const ee=(n?d+Z$:U+m)/w,ae=s?d-Z$:(U-m)/w,we=kRt;for(let Ie=0;Ie<4;++Ie){const Ge=o[Ie];de(we[Ie],Ge,ae/d),de(we[Ie+4],Ge,ee/d)}N=we}if(wee(v,N,N.length))return!1;const z=y.lines,W=WRt,J=ZRt;for(const ee of z){Ce(J,ee.direction);for(const ae of L){const we=N[ae];if(Ce(W,we),P7(J,W,N,T))return!1;const Ie=(ae+1)%4;if(s){const Ge=N[Ie];if(Li(W,Ge,we),Ce(W,W),P7(J,W,N,T))return!1}if(n){const Ge=N[4+ae],ut=N[4+Ie];if(Li(W,ut,Ge),Ce(W,W),P7(J,W,N,T))return!1}}}return!0}_calculateSingleTileVisibilitySided(e,i){return this._isTileVisibleInFrustum(e)?(this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,i),this._intersector.isVisibleInFrustum(this._frustum,this._renderSREllipsoidRadius,!0)?Vc.VISIBLE_ON_SURFACE:Vc.VISIBLE_WHEN_EXTENDED):Vc.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),Eve(this._extendedFrustum);const i=this._renderCoordsHelper.worldUpAtPosition(e.eye,Th);this._aboveGround||da(i,i);const r=vo(-Te(i,e.viewForward));if(this._hasExtendedFrustum=r>e.fovY/2,!this._hasExtendedFrustum)return;const s=this._extendedFrustumParameters(),n=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this._renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,Th),a){case vt.FAR_BOTTOM_LEFT:case vt.FAR_TOP_LEFT:case vt.NEAR_BOTTOM_LEFT:case vt.NEAR_TOP_LEFT:pX(this._extendedFrustum.planes[Er.LEFT],Th,Th);break;case vt.FAR_BOTTOM_RIGHT:case vt.FAR_TOP_RIGHT:case vt.NEAR_BOTTOM_RIGHT:case vt.NEAR_TOP_RIGHT:pX(this._extendedFrustum.planes[Er.RIGHT],Th,Th)}de(Th,Th,s.direction),this._renderCoordsHelper.intersectInfiniteManifold(td(l,Th),s.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(n),hl(n[vt.NEAR_BOTTOM_LEFT],n[vt.NEAR_BOTTOM_RIGHT],n[vt.NEAR_TOP_RIGHT],xve),hl(n[vt.NEAR_BOTTOM_RIGHT],n[vt.NEAR_TOP_RIGHT],n[vt.NEAR_TOP_LEFT],Tve),Te(xve,Tve)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[vt.NEAR_BOTTOM_LEFT],o[vt.NEAR_BOTTOM_RIGHT]]=[o[vt.NEAR_BOTTOM_RIGHT],o[vt.NEAR_BOTTOM_LEFT]]:[o[vt.NEAR_TOP_LEFT],o[vt.NEAR_TOP_RIGHT]]=[o[vt.NEAR_TOP_RIGHT],o[vt.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-wve;return{zWithMargin:e,pointIndices:ub.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:i=>i>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+wve;return{zWithMargin:e,pointIndices:ub.planePointIndices.top,direction:1,needsAltitudeAdjustment:i=>i<e}}};const vRt=2,bRt=6,wRt=12,xRt=.95,wve=1,Th=C(),xve=rr(),Tve=rr(),Sve=new ga(Array,t=>{t.length!==4&&(t[0]=new zI,t[1]=new zI,t[2]=new zI,t[3]=new zI)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});function Eve(t){const e=ub.nearFarLineIndices,i=t.mutablePoints;for(const r of e){const[s,n]=r,o=i[s],a=i[n];$e(Th,a,o),de(Th,Th,xRt),Ee(i[n],o,Th)}t.updatePoints(i)}function y1(t,e,i){return mt(t,e,i),Ce(t,t),t}function Cve(t,e,i){return Li(t,e,i),Ce(t,t),t}function W$(t,e){return de(t,t,e/Wl(t)),t}const TRt=[Er.LEFT,Er.RIGHT,Er.BOTTOM,Er.TOP,Er.FAR];function SRt(t,e,i){for(let r=0;r<i;++r)if(Rr(t,e[r])<=0)return!1;return!0}function wee(t,e,i){for(const r of TRt)if(SRt(t[r],e,i))return!0;return!1}const iUe=4;function ERt(t,e,i){for(const r of e)if(Te(r,t)<i)return!1;return!0}const CRt=[C(),C(),C(),C(),C(),C(),C(),C()],MRt=[0,0,0,0,0,0],Mve=[C(),C(),C(),C(),C(),C()],Ave=C(),ARt=C(),Pve=C(),PRt=C(),ORt=C(),Ove=C(),$Rt=C(),RRt=C(),IRt=C(),LRt=C(),DRt=C(),NRt=C(),A7=qe(0,0,0),FRt=C(),kRt=[C(),C(),C(),C(),C(),C(),C(),C()],URt=[C(),C(),C(),C(),C()],VRt=C(),zRt=C(),BRt=C(),jRt=C(),GRt=C(),HRt=C(),qRt=C(),WRt=C(),ZRt=C(),YRt=C(),XRt=[0,1,2,3],JRt=[0,1,2,3],QRt=[0,1,3],KRt=[0,1,3],eIt=[1,2,3],tIt=[1,2,3],iIt=C();function rIt(t,e,i){let r=1/0,s=-1/0;for(const n of i){const o=Te(e,n);r=Math.min(r,o),s=Math.max(s,o)}t[0]=r,t[1]=s}function sIt(t,e,i,r){let s=1/0,n=-1/0;for(const o of r){const a=Te(i,o);if(s=Math.min(s,a),n=Math.max(n,a),s<=e&&n>=t)return!1}return!0}const nIt=[0,0];function P7(t,e,i,r){if(i.length===0||r.length===0)return!0;const s=YRt;y1(s,t,e);const n=r[0]<i[0],o=n?i:r,a=nIt;return rIt(a,s,n?r:i),sIt(a[0],a[1],s,o)}const Z$=430,oIt=C(),aIt=C(),lIt=Math.cos(.25*Math.PI);let cIt=class{constructor(e){this._camera=new Fr,this._focusOnMap=[0,0],this._screenRect=oi(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new _Rt(e.renderCoordsHelper,e.getIsGroundOpaque)}begin(e,i,r){this._camera.copyFrom(e),this._surfaceElevation=r,this._focusOnMap[0]=i.x,this._focusOnMap[1]=i.y,FG(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,r)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=hQe(e.extent,this._focusOnMap),e.measures.visibility!==Vc.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const i=uIt,r=1<<i,s=e.measures.screenRect;Kh(s);let n=0;const o=e.lij,a=o[0],l=a+i,c=o[1]<<i,u=o[2]<<i,d=this._tileSizeWithBias(e),f=d*d,m=this._camera,{frustum:g,viewport:y}=m;if(this._renderCoordsHelper.viewingMode===Je.Local||a>iUe){const v=$ve;this._tilingScheme.getExtent(o[0],o[1],o[2],v);const b=iC,w=pIt,x=Kh();for(let M=0;M<4;++M)this._toRenderCoords(v,Lve[M][0],Lve[M][1],w[M]),m.projectToScreen(w[M],b[M]),pse(x,b[M]);const T=wee(g,w,4),E=x[0]>y[2]||x[1]>y[3]||x[2]<y[0]||x[3]<y[1];if(T||E)return void(e.measures.shouldSplit=!1)}for(let v=0;v<r;v++)for(let b=0;b<r;b++)if(n+=this._computeScreenArea(l,c+v,u+b,s),n>f)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===Vc.VISIBLE_WHEN_EXTENDED?this._tileSize*hIt:this._tileSize}_computeScreenArea(e,i,r,s){this._tilingScheme.ensureMaxLod(e);const n=$ve;this._tilingScheme.getExtent(e,i,r,n);const o=dIt;return this._toRenderCoords(n,0,3,o[0]),this._toRenderCoords(n,2,3,o[1]),this._toRenderCoords(n,2,1,o[2]),this._toRenderCoords(n,0,1,o[3]),this._computeTriangleScreenArea([o[0],o[1],o[2]],s)+this._computeTriangleScreenArea([o[2],o[1],o[3]],s)}_computeTriangleScreenArea(e,i){const r=this._camera.frustum[Er.NEAR];let s=0,n=-1,o=-1;for(let a=0;a<3;++a)Rr(r,e[a])>0?(s++,n===-1&&(n=a)):o===-1&&(o=a);if(s===0)return this._computeTriangleScreenAreaInside(e,i);if(s===1){const a=Ive,l=(n+1)%3,c=(n+2)%3,u=n;ve(a[0],e[l]),ve(a[1],e[c]),E5(a[2],e[c],e[u],r);const d=this._computeTriangleScreenAreaInside(a,i);return E5(a[1],e[l],e[u],r),d+this._computeTriangleScreenAreaInside(a,i)}if(s===2){const a=Ive,l=o;ve(a[0],e[l]);const c=(o+1)%3,u=(o+2)%3;return E5(a[1],e[l],e[c],r),E5(a[2],e[l],e[u],r),this._computeTriangleScreenAreaInside(a,i)}return 0}_computeTriangleScreenAreaInside(e,i){for(let r=0;r<3;r++)this._camera.projectToRenderScreen(e[r],Rve),this._camera.renderToScreen(Rve,iC[r]),vb(i,iC[r],i);return npt(iC[0],iC[1],iC[2])}_toRenderCoords(e,i,r,s){return S5[0]=e[i],S5[1]=e[r],S5[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(S5,this._tilingScheme.spatialReference,s),s}};const uIt=2,hIt=5,iC=[Os(),Os(),Os(),Os()],$ve=oi(),S5=C(),dIt=[C(),C(),C(),C()],Rve=ka(),Ive=[C(),C(),C()];function E5(t,e,i,r){const s=Rr(r,e),n=Rr(r,i),o=Math.abs(n-s);de(t,e,Math.abs(n)/o),Dn(t,t,i,Math.abs(s)/o)}const pIt=[C(),C(),C(),C()],Lve=[[0,3],[2,3],[2,1],[0,1]];function fli(t,e,i){if(t==null||i==null)return!1;let r=!0;return Zn[0]=t.xmin!=null?t.xmin:0,Zn[1]=t.ymin!=null?t.ymin:0,Zn[2]=t.zmin!=null?t.zmin:0,r=r&&gs(Zn,t.spatialReference,0,e,i,0,1),Zn[0]=t.xmax!=null?t.xmax:0,Zn[1]=t.ymax!=null?t.ymax:0,Zn[2]=t.zmax!=null?t.zmax:0,r=r&&gs(Zn,t.spatialReference,0,e,i,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),r}function rUe(t,e,i){if(t==null||i==null)return!1;let r=!0;return Zn[0]=t.xmin!=null?t.xmin:0,Zn[1]=t.ymin!=null?t.ymin:0,Zn[2]=t.zmin!=null?t.zmin:0,r=r&&gs(Zn,t.spatialReference,0,Zn,i,0,1),e[0]=Zn[0],e[1]=Zn[1],Zn[0]=t.xmax!=null?t.xmax:0,Zn[1]=t.ymax!=null?t.ymax:0,Zn[2]=t.zmax!=null?t.zmax:0,r=r&&gs(Zn,t.spatialReference,0,Zn,i,0,1),e[2]=Zn[0],e[3]=Zn[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),r}const Zn=C();let sa=class extends Ue{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void ne.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const i=this._get("filterExtent");if(i===e||i!=null&&e&&i.equals(e))return;const r=e!=null?e.clone():null;this._set("filterExtent",r),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=oi();return rUe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new Ke,this.tileSize=512,this._idToTile=new Map,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new ai}initialize(){this.addHandles([te(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),lr),te(()=>{var e,i,r;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(i=this.viewState)==null?void 0:i.contentCamera,(r=this.focus)==null?void 0:r.location]},()=>this._setDirty(),pr),te(()=>{var e;return((e=this.terrain)==null?void 0:e.baseOpacity)??1},()=>this._setDirty())]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(It.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Lr(this._frameWorker)}addClient(){const e=zh();return this._clients.add(e),this._clients.size===1&&this._setDirty(),Gi(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(Nu))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=It.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=It.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new cIt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,getIsGroundOpaque:()=>{var i;return(((i=this.terrain)==null?void 0:i.baseOpacity)??1)===1}}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(i=>new zI(i[0],i[1],i[2],e))}_purgeHorizonTiles(e){if(e.sort((i,r)=>{const s=i.measures.screenRect,n=r.measures.screenRect;return s[1]+s[3]-(n[1]+n[3])}),!(e.length>mIt))return e.toArray();Kh(C5);for(let i=0;i<e.length;i++)if(vb(C5,e.data[i].measures.screenRect,C5),Hc(C5)>fIt)return e.data.slice(i,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:i}=this;for(;this._pendingTiles.length>0&&!e.done;){const r=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!VG(this._filterExtentRect,r.extent)||(this._tileMeasurements.updateTile(r),r.measures.visibility!==Vc.INVISIBLE&&(r.measures.shouldSplit?(i.ensureMaxLod(r.lij[0]+1),this._pendingTiles.push(...r.getChildren())):this._newTiles.push(r)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const s of this.tiles.items)s.used=!1;const i=e.filter(s=>{const n=this._idToTile.get(s.id);return n?(n.copyMeasurementsFrom(s),n.used=!0):this._idToTile.set(s.id,s),!n}),r=this.tiles.items.filter(s=>!s.used&&(this._idToTile.delete(s.id),!0));this.tiles.removeMany(r),this.tiles.addMany(i),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,i)=>e.measures.visibility!==i.measures.visibility?e.measures.visibility===Vc.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-i.measures.distance),this.tiles.forEach((e,i)=>e.loadPriority=i)}};h([p({constructOnly:!0})],sa.prototype,"scheduler",void 0),h([p({constructOnly:!0})],sa.prototype,"renderCoordsHelper",void 0),h([p({constructOnly:!0})],sa.prototype,"tilingSchemeOwner",void 0),h([p({constructOnly:!0})],sa.prototype,"cameraOnSurface",void 0),h([p({constructOnly:!0})],sa.prototype,"focus",void 0),h([p({constructOnly:!0})],sa.prototype,"viewState",void 0),h([p({constructOnly:!0})],sa.prototype,"terrain",void 0),h([p()],sa.prototype,"tiles",void 0),h([p()],sa.prototype,"tileSize",void 0),h([p({readOnly:!0})],sa.prototype,"tilingScheme",null),h([p()],sa.prototype,"filterExtent",null),h([p({readOnly:!0})],sa.prototype,"_filterExtentRect",null),h([p({readOnly:!0})],sa.prototype,"_rootTileIds",null),h([p({value:!1})],sa.prototype,"suspended",null),h([p({readOnly:!0})],sa.prototype,"updating",null),sa=h([I("esri.views.3d.layers.support.FeatureTileTree3D")],sa);const C5=oi(),fIt=10,mIt=50;let Us=class extends Ue{constructor(){super(...arguments),this._propertiesPool=new O_({camera:Fr},this),this._lastSeenCameraProjectionValues=new Fr,this.mode=Ii.ANIMATING,this._cssCamera=new Fr,this._camera=new Fr,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new Ls,this.viewingMode=Je.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,i){this._set("viewingMode",e),this._set("spatialReference",i),this._set("constraints",new T0({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new O_({camera:Fr},this)}destroy(){var e;this.cameraController=null,(e=this._propertiesPool)==null||e.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===Je.Global){const e=br(this.spatialReference).radius;this.camera=new Fr({eye:qe(4*e,0,0),center:qe(e,0,0),up:qe(0,0,1)})}else this.camera=new Fr({eye:qe(0,0,100),center:qe(0,0,0),up:qe(0,1,0)})}get animation(){return this.cameraController instanceof iD&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:i,width:r,pixelRatio:s}=this.camera;return e.pixelRatio=1,e.height=Math.round(i/s),e.width=Math.round(r/s),e}get camera(){return this._camera}set camera(e){e!==yd&&yd.copyFrom(e),yd.computeUp(this.viewingMode),this.events.emit("before-camera-change",yd);const i=this._camera;if(yIt(this._lastSeenCameraProjectionValues,yd)&&(this._lastSeenCameraProjectionValues.copyFrom(yd),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!i.equals(yd)&&(this._camera=this._propertiesPool.get("camera").copyFrom(yd),this._cameraChanged=!i.almostEquals(yd),this._cameraChanged)){const r=tEe(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===Ii.IDLE}get updating(){return this.mode!==Ii.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===Je.Global}get isLocal(){return this.viewingMode===Je.Local}get navigating(){var e;return!!((e=this.cameraController)!=null&&e.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){var i;this.stopActiveCameraController()?((i=this.cameraController)==null||i.destroy(),e&&(this.removeHandles(Dve),this.addHandles(jo(()=>e.state===xs.Finished||e.state===xs.Stopped,()=>{this._set("cameraController",null),this.updateCamera(r=>e.onControllerEnd(r))},{sync:!0,once:!0}),Dve),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=xs.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==xs.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();yd.copyFrom(this._get("camera")),e(yd),this.camera=yd,this._processingUpdates=!1,this._processUpdateQueue()}};h([p()],Us.prototype,"mode",void 0),h([p({readOnly:!0,type:FP})],Us.prototype,"animation",null),h([p({type:Fr})],Us.prototype,"cssCamera",null),h([p()],Us.prototype,"_cssCamera",void 0),h([p({type:Fr})],Us.prototype,"camera",null),h([p()],Us.prototype,"_camera",void 0),h([p({readOnly:!0})],Us.prototype,"pixelRatio",null),h([p()],Us.prototype,"rasterPixelRatio",void 0),h([p()],Us.prototype,"contentPixelRatio",void 0),h([p({readOnly:!0})],Us.prototype,"alignPixelEnabled",null),h([p({readOnly:!0})],Us.prototype,"updating",null),h([p({})],Us.prototype,"_contentCamera",void 0),h([p({type:Fr})],Us.prototype,"contentCamera",null),h([p({readOnly:!0})],Us.prototype,"fixedContentCamera",null),h([p({readOnly:!0})],Us.prototype,"constraints",void 0),h([p({readOnly:!0})],Us.prototype,"events",void 0),h([p({readOnly:!0})],Us.prototype,"isGlobal",null),h([p({readOnly:!0})],Us.prototype,"isLocal",null),h([p({readOnly:!0})],Us.prototype,"viewingMode",void 0),h([p({readOnly:!0})],Us.prototype,"spatialReference",void 0),h([p()],Us.prototype,"navigating",null),h([p()],Us.prototype,"stationary",null),h([p()],Us.prototype,"_cameraChanged",void 0),h([p()],Us.prototype,"cameraController",null),Us=h([I("esri.views.3d.state.ViewState")],Us);const gIt=Us;function yIt(t,e){return t.fov!==e.fov||t.fullViewport[0]!==e.fullViewport[0]||t.fullViewport[1]!==e.fullViewport[1]||t.fullViewport[2]!==e.fullViewport[2]||t.fullViewport[3]!==e.fullViewport[3]||t.padding[gi.TOP]!==e.padding[gi.TOP]||t.padding[gi.RIGHT]!==e.padding[gi.RIGHT]||t.padding[gi.BOTTOM]!==e.padding[gi.BOTTOM]||t.padding[gi.LEFT]!==e.padding[gi.LEFT]}const yd=new Fr,Dve="ViewStateHandles";function sUe(t){return t?SIt:EIt}function _It(t,e){return e!=null&&e.mode?e.mode:sUe(t).mode}function vIt(t,e){return e??sUe(t)}function nUe(t,e){return _It(t!=null&&t.hasZ,e)}function yli(t,e){return vIt(t!=null&&!!t.hasZ,e)}function _li(t){const e=oUe(t);return nUe(t.geometry,e)}function vli(t){const e=oUe(t),i=nUe(t.geometry,e),r=e!=null&&i!=="on-the-ground"?lUe(e):0,s=e==null?void 0:e.featureExpressionInfo;return{mode:i,offset:r,featureExpressionInfo:s}}function bli(t){return wIt(t)||bIt(t)}function bIt(t){var e;return((e=t==null?void 0:t.featureExpressionInfo)==null?void 0:e.expression)==="0"}function wIt(t){if(!t||t.mode==="on-the-ground")return!1;const e=t!=null&&t.featureExpressionInfo?t.featureExpressionInfo.expression:null;return!(!e||e==="0")}function oUe(t){return t.layer&&"elevationInfo"in t.layer?t.layer.elevationInfo:null}function lle(t,e){if(!(t!=null&&t.offset))return 0;const{offset:i,unit:r}=t;if(r==="decimal-degrees")return 0;const s=r!=="unknown"&&r?r:"meters",n=hCe(e);return n?Br(i,s,n):0}function wli(t,e,i){if(!(i!=null&&i.mode))return;const r=t.hasZ?t.z:0,s=lle(i,t.spatialReference);switch(i.mode){case"absolute-height":return r-s;case"on-the-ground":return 0;case"relative-to-ground":return r-((e.elevationProvider.getElevation(t.x,t.y,r,t.spatialReference,"ground")??0)+s);case"relative-to-scene":return r-((e.elevationProvider.getElevation(t.x,t.y,r,t.spatialReference,"scene")??0)+s)}}function xli(t,e,i,r=null){return aUe(t,e.x,e.y,e.hasZ?e.z:0,e.spatialReference,i,r)}function Tli(t,e,i,r,s=null){return aUe(t,e[0],e[1],e.length>2?e[2]:0,i,r,s)}function aUe(t,e,i,r,s,n,o=null){if(n==null)return;const a=o!=null?o.mode:"absolute-height";if(a==="on-the-ground")return 0;const{absoluteZ:l}=xIt(e,i,r,s,t,n);return TIt(l,e,i,r,s,t,o,a)}function xIt(t,e,i,r,s,n){const o=lle(n,r);switch(n.mode){case"absolute-height":return{absoluteZ:i+o,elevation:0};case"on-the-ground":{const a=s.elevationProvider.getElevation(t,e,0,r,"ground")??0;return{absoluteZ:a,elevation:a}}case"relative-to-ground":{const a=s.elevationProvider.getElevation(t,e,i,r,"ground")??0;return{absoluteZ:i+a+o,elevation:a}}case"relative-to-scene":{const a=s.elevationProvider.getElevation(t,e,i,r,"scene")??0;return{absoluteZ:i+a+o,elevation:a}}}}function TIt(t,e,i,r,s,n,o,a){const l=lle(o,s);switch(a){case"absolute-height":return t-l;case"relative-to-ground":return t-((n.elevationProvider.getElevation(e,i,r,s,"ground")??0)+l);case"relative-to-scene":return t-((n.elevationProvider.getElevation(e,i,r,s,"scene")??0)+l)}}function Sli(t,e){if(e==null)return!1;const{mode:i}=e;return i!=null&&(t==="scene"&&i==="relative-to-scene"||t==="ground"&&i!=="absolute-height")}function Eli(t,e,i){return i&&i.mode!==e?`${t} only support ${e} elevation mode`:null}function Cli(t,e,i){return(i==null?void 0:i.mode)===e?`${t} do not support ${e} elevation mode`:null}function Mli(t,e){return(e==null?void 0:e.featureExpressionInfo)!=null&&e.featureExpressionInfo.expression!=="0"?`${t} do not support featureExpressionInfo`:null}function Ali(t,e){e&&t.warn(".elevationInfo=",e)}function lUe(t){return((t==null?void 0:t.offset)??0)*ADe(t==null?void 0:t.unit)}const SIt={mode:"absolute-height",offset:0},EIt={mode:"on-the-ground",offset:null},cUe="OBJECTID";let Pli=class extends eN{constructor(e,i,r,s){super(i,r),this.point=e,this.createGraphic=s}};function uUe(t){return bp(t)&&t.intersector===as.PCL&&!!t.target}let $li=class extends lOe{constructor(e,i,r,s,n){super(e),this.layerUid=e,this.sublayerUid=i,this.nodeIndex=r,this.componentIndex=s,this.triangleNr=n}},Ili=class extends eN{constructor(e,i,r){super(i,null),this.point=e,this.createVoxelGraphic=r}},Dli=class extends eN{constructor(e,i){super(e,null),this.createTiles3DGraphic=i}};function R8(t){return bp(t)&&t.intersector===as.I3S&&!!t.target}function hUe(t){return bp(t)&&t.intersector===as.VOXEL&&!!t.target}function CIt(t){return bp(t)&&t.intersector===as.TILES3D&&!!t.target}function dUe(t,e){var i,r;return o6(t)||a6(t)?vD((i=t.target)==null?void 0:i.object,e):Gxt(t)?(r=e.map)==null?void 0:r.ground:uUe(t)||R8(t)||QFe(t)||hUe(t)?vD(t.target,e):null}function Fli(t,e){const i=cle(t,e);return i!=null&&i.type==="graphic"?i.graphic:null}function cle(t,e){var i;if(t==null)return null;if(o6(t)||a6(t))return Nve((i=t.target)==null?void 0:i.object,e);if(uUe(t)){const r=t.target.createGraphic();return{type:"graphic",graphic:r,layer:r.layer}}if(hUe(t)){const r=t.target.createVoxelGraphic();return{type:"graphic",graphic:r,layer:r.layer}}if(CIt(t)){const r=t.target.createTiles3DGraphic();return{type:"graphic",graphic:r,layer:r.layer}}return QFe(t)||ile(t)?Nve(t.target,e):R8(t)?MIt(t.target,e):null}function Nve(t,e){if((t==null?void 0:t.graphicUid)==null)return null;const i=vD(t,e);if(i==null)return null;if(i===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const r=e.allLayerViews.find(s=>s.layer===i);return!r||r.suspended||t.graphicUid==null?null:"getHit"in r?r.getHit(t.graphicUid):null}function MIt(t,e){const i=vD(t,e);if(i==null)return null;const r=e.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?PIt(r.getGraphicFromIntersectorTarget(t)):null}function AIt(t,e){const i=vD(t,e);if(i==null)return null;const r=e.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(t):null}function PIt(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function vD(t,e){return(t==null?void 0:t.layerUid)==null?null:e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.allLayers.find(i=>i.uid===t.layerUid)}function kli(t,e){if(o6(t)||a6(t))return wb(t.target.object.boundingVolumeWorldSpace.bounds);if(ile(t)){WCe(M5,t.transformation);const i=Math.max(M5[0],M5[1],M5[2]);return t.target.baseBoundingSphere.radius*i}if(R8(t)){const i=AIt(t.target,e);return i?.5*B$e(i):null}return null}function Uli(t){return!o6(t)&&!a6(t)&&(ile(t)?t.target.numLodLevels>1:!!R8(t))}const M5=C();async function OIt(t,e,i,r){const s=i?mUe(t,i):r,n=Os(e.x,e.y);s.requiresGroundFeedback=!0,s.enableDraped=!0;const o=gp(t.state.viewingMode);o.options.selectionMode=!0,o.options.store=fa.ALL,t.sceneIntersectionHelper.intersectIntersectorScreen(n,o,s);const a=RIt(t,o.results.all,s.graphics),l=o.results.ground,c=dUe(l,t),u=c!=null&&"type"in c&&RL(c.type)?c:null,d={screenPoint:e,results:a,ground:{mapPoint:tA(t,l),distance:bp(l)?l.distanceInRenderSpace:0,layer:u}};return kr.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(d.intersector=o),d}function $It(t,e,i,r){var u,d,f,m,g;const s=i?mUe(t,i):r,n=!(!((u=s.graphics)!=null&&u.include)&&!((d=s.graphics)!=null&&d.exclude)),o=!(!((f=s.mediaElements)!=null&&f.include)&&!((m=s.mediaElements)!=null&&m.exclude)),a=Lf(e);s.enableDraped=s.include&&!s.include.has(Xb)||((g=s.exclude)==null?void 0:g.has(Xb));const l=t.sceneIntersectionHelper,c=gp(t.state.viewingMode);if(c.options.selectionMode=!0,c.options.store=n||o?fa.ALL:fa.MIN,c.options.hud=!(i!=null&&i.excludeHud),l.intersectIntersectorScreen(a,c,s),n||o){for(const y of c.results.all){const v=cle(y,t);if(v==null||n&&(v.type!=="graphic"||pUe(s.graphics,v.graphic))||o&&(v.type!=="media"||fUe(s.mediaElements,v.element)))return tA(t,y)}return null}return tA(t,c.results.min)}function RIt(t,e,i){const r=new Array;let s=null;for(let n=0;n<e.length;n++){const o=e[n],a=dUe(o,t);if(a!=null&&(a===t.map.ground||"type"in a&&RL(a.type)))break;const l=cle(o,t);if(l==null)continue;if(l.type==="graphic"){if(s==null&&n!==e.length-1&&(s=new Set),s!=null){const d=ule(l.graphic);if(s.has(d))continue;s.add(d)}if(!pUe(i,l.graphic))continue}const c=tA(t,o),u=o.distanceInRenderSpace;if(l.type==="media"){const d=l.element.toSource(c);r.push({...l,mapPoint:c,distance:u,sourcePoint:d})}else r.push({...l,mapPoint:c,distance:u})}return r}function tA(t,e,i){return e.getIntersectionPoint(iA)?(i=xee(t,iA,i),e.intersector===as.TERRAIN&&t.basemapTerrain&&(i.z=Gg(t.basemapTerrain,i)??0),i):null}function ule(t){var s;const e=t.sourceLayer,i=t.layer,r=e&&"objectIdField"in e?e:i&&"objectIdField"in i?i:e;if(r){const n=r.objectIdField??cUe,o=(s=t.attributes)==null?void 0:s[n];if(o)return`o-${r.id}-${o}`}return`u-${t.uid}`}function pUe(t,e){return fUe(t,ule(e))}function fUe(t,e){return t==null||(t.include==null||t.include.has(e))&&(t.exclude==null||!t.exclude.has(e))}function xee(t,e,i){let r=t.spatialReference||Ye.WGS84;return Go(e,t.renderSpatialReference,iA,r)?e=iA:(r=Ye.WGS84,Go(e,t.renderSpatialReference,iA,r)&&(e=iA)),i?(i.x=e[0],i.y=e[1],i.z=e[2],i.spatialReference=r):i=new wt(e,r),i}function mUe(t,e){const i=Tee(t,e.include,eO.INCLUDE),r=Tee(t,e.exclude,eO.EXCLUDE);return{include:i.layerUids,exclude:r.layerUids,graphics:{include:i.graphicUids,exclude:r.graphicUids},mediaElements:{include:i.mediaElements,exclude:r.mediaElements}}}function Tee(t,e,i,r={layerUids:void 0,graphicUids:void 0,mediaElements:void 0}){if(!e)return r;if(e instanceof ya)IIt(r,ule(e)),i===eO.INCLUDE&&(t.graphicsView!=null&&e.layer===t?rC(r,t.graphicsView.processor.layer.id):e.layer&&rC(r,e.layer.uid));else if("layer"in e&&"element"in e)LIt(r,e.element),i===eO.INCLUDE&&rC(r,e.layer.uid);else if(TZ(e))for(const s of e)s===t.graphics&&t.graphicsView!=null?rC(r,t.graphicsView.processor.layer.id):s===t.map.ground?rC(r,Xb):Tee(t,s,i,r);else"uid"in e&&rC(r,e.uid);return r}function rC(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function IIt(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function LIt(t,e){t.mediaElements||(t.mediaElements=new Set),t.mediaElements.add(e)}const iA=C();var eO;(function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"})(eO||(eO={}));let DIt=class{constructor(e,i,r){this.viewingMode=e,this._forEachLayer=i,this._view=r,this._externalIntersectionHandlers=new ai,this._tolerance=$P,this._tmpRay=mo(),this._tmpRegion=oi(),this._validateHUDIntersector=gp(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,i,r){return this.intersectRay(this._getPickRay(e,this._tmpRay),Fve(this.viewingMode),i,r)}intersectScreenFreePointFallback(e,i,r){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),i,r)}intersectRayFreePointFallback(e,i,r){return this.intersectRay(e,Fve(this.viewingMode),i,r)||this._intersectRayFreePointLocal(e,i)}intersectRay(e,i,r,s){return i.options.selectionMode=!1,i.options.store=fa.MIN,this.computeIntersection(e,i,s),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(e,i,r=.5,s=.5){return e.getRenderCenter(P5,r,s),P5[0]+=.0466,P5[1]-=.0123,Moe(e,P5,i)}intersectIntersectorScreen(e,i,r){this.computeIntersection(this._getPickRay(e,this._tmpRay),i,r)}intersectToolIntersectorScreen(e,i,r){const s=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(s,i,r)}intersectToolIntersectorRay(e,i,r){i.options.selectionMode=!0,this.computeIntersection(e,i,r);const s=i.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||bp(s)&&s.intersector!==as.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(e,i,r))}setTolerance(e=$P){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((i,r)=>i.type===as.TERRAIN?1:r.type===as.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((i,r)=>i.type===as.TERRAIN?1:r.type===as.TERRAIN?-1:0)}_getPickRay(e,i){const r=this._view.state.camera;return Coe(r,e,i)}_intersectRayFreePointLocal(e,i){return this.viewingMode!==Je.Local||e==null||Ee(i,e.origin,Ce(rt.get(),e.direction)),!1}intersectElevationFromScreen(e,i,r=0,s=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),i,r,s)}_intersectElevation(e,i,r=0,s=null){if(e==null)return null;const n=this._view,{renderCoordsHelper:o}=n,a=M_(n.spatialReference),l=i!=null?i.mode:"absolute-height",c=lUe(i)/a,u=(l!=="on-the-ground"?c+r:0)*a/o.unitInMeters,{camera:d}=n.state;if(l==="absolute-height"){const T=o==null?void 0:o.getAltitude(d.eye),E=Te(Ce(Y$,e.direction),o.worldUpAtPosition(d.eye,kIt));if(T<u&&E<0||T>=u&&E>0)return null;if(o.intersectInfiniteManifold(e,u,Y$)){const M=xee(n,Y$);return M.z??(M.z=0),M.z-=c,M}return null}const f=rt.get();d.projectToRenderScreen(e.origin,f);const m=new kve(null,this._forEachLayer),{slicePlane:g}=n,y=g!=null?ype(g):null,v=gp(this.viewingMode);v.options.store=fa.MIN,v.options.verticalOffset=u,v.options.normalRequired=!1;const b=e.origin,w=Ee(rt.get(),b,e.direction);v.reset(b,w,d),v.point=f;const x=s?"type"in s&&s.type==="graphics"?T=>T.layerUid!==s.uid:T=>T.graphicUid!==s.uid:null;switch(l){case"relative-to-scene":{const T=E=>(!x||x(E))&&!!E.lastValidElevationBB;v.intersect(m.layers,f,this._tolerance,null,T),this._externalIntersectionHandlers.forAll(E=>{if(E.type===as.I3S||E.type===as.TERRAIN||E.type===as.TILES3D){const M=E.slicePlaneEnabled?y:null;E.intersect(v,M,v.rayBegin,v.rayEnd,f)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(T=>{if(T.isGround){const E=T.slicePlaneEnabled?y:null;T.intersect(v,E,v.rayBegin,v.rayEnd,f)}})}if(v.results.min.getIntersectionPoint(Y$)){const T=xee(n,Y$);return T.z=r,T}return null}computeIntersection(e,i,r,s){var y;if(e==null)return;const n=this._view.state.camera,o=rt.get();n.projectToRenderScreen(e.origin,o);const a=new kve(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const l=e.origin,c=Ee(rt.get(),e.origin,e.direction);i.reset(l,c,n),i.intersect(a.layers,o,this._tolerance);const u=this._view.slicePlane,d=u!=null?ype(u):null;i.intersect(a.sliceableLayers,o,this._tolerance,d);const f=r&&(r.requiresGroundFeedback||r.enableDraped);this._externalIntersectionHandlers.forAll(v=>{const b=v.layerUid,w=Array.isArray(b),x=w?b:[b];w&&(i.options.filteredLayerUids=[]);let T=!1;for(const E of x)a.filterLayerUid(E)?T=!0:w&&i.options.filteredLayerUids.push(E);if(i.options.isFiltered=!T,v.isGround&&f||!i.options.isFiltered){const E=v.slicePlaneEnabled?d:null;v.intersect(i,E,l,c,o,s)}});const m=rt.get(),g=this._view.basemapTerrain;if(r&&r.enableDraped&&g.spatialReference!=null&&i.results.ground.getIntersectionPoint(m)){const v=g.overlayManager.renderer,b=this._view.renderCoordsHelper.spatialReference,w=rt.get();this._view.renderCoordsHelper.fromRenderCoords(m,w,g.spatialReference),w[2]=((y=this._view.elevationProvider)==null?void 0:y.getElevation(m[0],m[1],m[2],b,"ground"))??0,v.intersect(i,w,i.results.ground,x=>a.filterRenderGeometry(x))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(e){const i=e.results.hud;A_(this._tmpRegion,mY);const r=this._view.state.camera,s=[],n=this._tmpRegion,o=b=>{const w=new FIt(b);r.projectToRenderScreen(b.target.center,w.screenPoint),w.screenPoint[0]=Math.floor(w.screenPoint[0]),w.screenPoint[1]=Math.floor(w.screenPoint[1]),s.push(w),pse(n,w.screenPoint)};e.sortResults(i.all),i.min.dist!=null&&o(i.min);for(const b of i.all)i.min.target.object!==b.target.object&&i.max.target.object!==b.target.object&&o(b);if(i.max.dist!=null&&i.max.target.object!==i.min.target.object&&o(i.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=r.fullWidth,l=r.fullHeight,c=Math.max(0,n[0]-BI),u=Math.max(0,n[1]-BI),d=Math.min(fl(n)+2*BI,a-c),f=Math.min(Hc(n)+2*BI,l-u);if(d<=0||f<=0)return;const m=new Uint8Array(d*f*4);this._view._stage.renderer.readHUDVisibility(c,u,d,f,m);let g=!0;const y=e.results.max.dist==null;let v=0;for(const b of s)for(const w of NIt){const x=4*(Math.min(b.screenPoint[0]+w[0],a)-n[0]+(Math.min(b.screenPoint[1]+w[1],l)-n[1])*d);if(!(x<0||x>=m.length)&&m[x]){g&&(e.results.min.copy(b.result),g=!1),y&&e.results.max.copy(b.result),e.options.store===fa.ALL&&e.results.all.splice(v++,0,b.result);break}}}};const BI=1,NIt=(()=>{const t=[],e=BI;for(let i=-e;i<=e;i++)for(let r=-e;r<=e;r++)t.push([r+e,i+e]);return t})();let FIt=class{constructor(e){this.result=e,this.screenPoint=ka()}},A5;function Fve(t){return A5&&A5.viewingMode===t||(A5=gp(t)),A5}let kve=class{constructor(e,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,i(r=>{r.pickable&&this.filterLayerUid(r.apiLayerUid)&&(r.sliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(e){const{include:i,exclude:r}=this;return e==null?i==null&&r==null:(i==null||i.has(e))&&(r==null||!r.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function Uve(t){return typeof t=="object"&&"intersect"in t}const Y$=C(),kIt=C(),P5=ka();let jli=class{constructor(e,i){this.spatialReference=e,this._view=i}getElevation(e,i,r){return this._view.elevationProvider.getElevation(e,i,0,this.spatialReference,r)}async queryElevation(e,i,r,s,n){return this._view.elevationProvider.queryElevation(e,i,0,this.spatialReference,n,r,s)}},UIt=class{constructor(e,i,r,s){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(It.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(e)this.runTask(Nu);else for(const i of this._queries)i.result.reject(Ui())}queryElevation(e,i,r,s=0){const n=ma(),o={x:e,y:i,minDemResolution:s,result:n,signal:r};return this._queries.push(o),Va(r,()=>{tSe(this._queries,o),n.reject(Ui())}),n.promise}get running(){return this._queries.length>0}runTask(e){const i=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return i.forEach(u=>u.result.reject()),void e.madeProgress();const s=i.map(u=>[u.x,u.y]),n=i.reduce((u,d)=>Math.min(u,d.minDemResolution),1/0),o=new vO({points:s,spatialReference:this.spatialReference}),a=i.length>1&&i.some(u=>!!u.signal)?new AbortController:null,l=a!=null?a.signal:i[0].signal;if(a!=null){let u=0;i.forEach(d=>Va(d.signal,()=>{u++,d.result.reject(Ui()),u===i.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:n,signal:l};r.queryElevation(o,c).then(u=>{i.forEach((d,f)=>{d.signal!=null&&d.signal.aborted?d.result.reject(Ui()):d.result.resolve(u.geometry.points[f][2])})}).catch(u=>{i.forEach(d=>d.result.reject(u))}),e.madeProgress()}get test(){}},Mj=class{constructor(e=1/0,i=-1/0){this.elevationRangeMin=e,this.elevationRangeMax=i}get elevationRangeValid(){return!Number.isNaN(this.elevationRangeMin)}invalidateElevationRange(){this.elevationRangeMin=NaN}expandElevationRangeValues(e,i){this.elevationRangeMin=Math.min(this.elevationRangeMin,e),this.elevationRangeMax=Math.max(this.elevationRangeMax,i)}expandElevationRange(e){this.elevationRangeMin=Math.min(this.elevationRangeMin,e.elevationRangeMin),this.elevationRangeMax=Math.max(this.elevationRangeMax,e.elevationRangeMax)}setElevationRange(e){this.elevationRangeMin=e.elevationRangeMin,this.elevationRangeMax=e.elevationRangeMax}},jI=class extends Ls.EventedMixin(Ue){get spatialReference(){var e,i;return(i=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:i.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this.lastElevationQuery=null,this._cacheEnabled=!1}destroy(){this._cachedQuery=He(this._cachedQuery)}enableCache(e){e||(this.lastElevationQuery=null),this._cacheEnabled=e}getElevation(e,i,r,s,n){if(this._cacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&i===a.y&&r===a.z&&ms(s,a.spatialReference)&&n===a.queryContext)return a.result}let o=null;return o=O5(o,this._im,e,i,r,s,n),o==null&&(o=O5(o,this._ground,e,i,r,s,n)),n==="scene"&&(o=O5(o,this._scene,e,i,r,s,n)),this._cacheEnabled&&(this.lastElevationQuery={x:e,y:i,z:r,spatialReference:s,queryContext:n,result:o}),o}getSphereElevationBounds(e,i,r){const s=new Mj;function n(o){for(const a of o)if(a.getSphereElevationBounds){const l=a.getSphereElevationBounds(e,i,r);l!=null&&s.expandElevationRangeValues(l.elevationRangeMin,l.elevationRangeMax)}}return n(this._ground),n(this._im),r==="scene"&&n(this._scene),s}getRootElevationBounds(){const e=new Mj;for(const i of[this._im,this._ground,this._scene])i.forEach(r=>{if(r.getRootElevationBounds){const s=r.getRootElevationBounds();s!=null&&e.expandElevationRangeValues(s.elevationRangeMin,s.elevationRangeMax)}});return e}async queryElevation(e,i,r,s,n,o=null,a=0){const l=this._getElevationQuery(s);try{const c=await l.queryElevation(e,i,o,a);return n==="scene"?O5(c,this._scene,e,i,r,s,n):c}catch(c){return Ql(c),this.getElevation(e,i,r,s,n)}}register(e,i){this.addHandles(i.on("elevation-change",r=>this.emit("elevation-change",r)),i),this._providersFromContext(e).push(i)}unregister(e){this.removeHandles(e);for(const i of[this._im,this._ground,this._scene]){const r=i.indexOf(e);r>-1&&i.splice(r,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}_getElevationQuery(e=this.view.spatialReference){const i=this._cachedQuery;if(i!=null&&ms(e,i.spatialReference))return i;i==null||i.destroy({completeTasks:!0});const{wkid:r,wkt:s,wkt2:n,latestWkid:o}=e,a=new UIt(this.view.resourceController.scheduler,new Ye({wkid:r,wkt:s,wkt2:n,latestWkid:o}),()=>{var l;return(l=this.view.map)==null?void 0:l.ground},{maximumAutoTileRequests:4});return this._cachedQuery=a,a}};function O5(t,e,i,r,s,n,o){for(const a of e){const l=a.getElevation(i,r,s,n,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}h([p({constructOnly:!0})],jI.prototype,"view",void 0),h([p()],jI.prototype,"spatialReference",null),jI=h([I("esri.views.3d.support.CombinedElevationProvider")],jI);let bD=class See{static isValidProfile(e){return e in See.profiles}static getDefaultProfile(){return ue("esri-iPhone")?"low":"medium"}static apply(e,i){const r=See.profiles[e];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxNumberOfDrawCalls=r.graphics3D.maxNumberOfDrawCalls,i.graphics3D.maxTotalNumberOfVertices=r.graphics3D.maxTotalNumberOfVertices,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable,i.graphics3D.skipHighSymbolLods=r.graphics3D.skipHighSymbolLods,i.graphics3D.uncompressedTextureDownsamplingEnabled=r.graphics3D.uncompressedTextureDownsamplingEnabled;const s=i.sceneService.object,n=r.sceneService.object;s.lodFactor=n.lodFactor,i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.vtlContentZoom=r.tiledSurface.vtlContentZoom,i.tiledSurface.elevationLevelDelta=r.tiledSurface.elevationLevelDelta,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.fadeDuration=r.fadeDuration,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.highResolutionAtmosphere=r.highResolutionAtmosphere,i.reflections=r.reflections,i.ambientOcclusion=r.ambientOcclusion,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumPixelRatio=r.maximumPixelRatio}};bD.test={reset(){const t=gUe();for(const e of Object.keys(t))bD.profiles[e]=t[e]}};const X$={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};function gUe(){const t=!!ue("esri-mobile"),e=!!ue("ios"),i=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,elevationLevelDelta:3,reduceTileLevelDifferences:!0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+X$.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:13e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:3,reduceTileLevelDifferences:!ue("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600+X$.GalaxyS20:750+X$.FullHD,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:23e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,elevationLevelDelta:2,reduceTileLevelDifferences:!ue("disable-feature:reduce-map-tile-levels")},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900+X$.SurfacePro7:1500+X$.FullHDRetina,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}(function(t){t.profiles=gUe()})(bD||(bD={}));const cV=bD,yUe=new je([0,255,255]),_Ue=1,vUe=.25,bUe=new je([0,0,0]),wUe=.4,xUe=.2;let hg=class extends Ue{constructor(){super(...arguments),this.color=yUe.clone(),this.haloColor=null,this.haloOpacity=_Ue,this.fillOpacity=vUe,this.shadowOpacity=wUe,this.shadowColor=bUe.clone(),this.shadowDifference=xUe}};h([p({type:je})],hg.prototype,"color",void 0),h([p({type:je})],hg.prototype,"haloColor",void 0),h([p()],hg.prototype,"haloOpacity",void 0),h([p()],hg.prototype,"fillOpacity",void 0),h([p()],hg.prototype,"shadowOpacity",void 0),h([p({type:je})],hg.prototype,"shadowColor",void 0),h([p()],hg.prototype,"shadowDifference",void 0),hg=h([I("esri.views.3d.support.HighlightOptions")],hg);const TUe=hg;function VIt(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function hle(t){return typeof t=="string"?gn(t):re(t)}function zIt(t,e,i){const r={};for(const s in t){if(s==="declaredClass")continue;const n=t[s];if(n!=null&&typeof n!="function")if(Array.isArray(n))r[s]=n.map(o=>zIt(o));else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(i==null?void 0:i[s]);r[s]=JSON.stringify(o)}else r[s]=JSON.stringify(n);else r[s]=n}return r}function BIt(t){return{geometryType:bO(t[0]),geometries:t.map(e=>e.toJSON())}}function SUe(t,e,i){const r=SQe(e);return t.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}let gT=class extends Se{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(s=>s.toJSON()),i=this.geometries[0],r={};return r.outSR=nP(this.outSpatialReference),r.inSR=nP(i.spatialReference),r.geometries=JSON.stringify({geometryType:bO(i),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};h([p()],gT.prototype,"geometries",void 0),h([p({json:{read:{source:"outSR"}}})],gT.prototype,"outSpatialReference",void 0),h([p()],gT.prototype,"transformation",void 0),h([p()],gT.prototype,"transformForward",void 0),gT=h([I("esri.rest.support.ProjectParameters")],gT);const I8=gT,jIt=nn(I8);async function dle(t,e,i){e=jIt(e);const r=hle(t),s={...r.query,f:"json",...e.toJSON()},n=e.outSpatialReference,o=bO(e.geometries[0]),a=VIt(s,i);return fr(r.path+"/project",a).then(({data:{geometries:l}})=>SUe(l,o,n))}async function ple(t=null,e){var s,n;if(nr.geometryServiceUrl)return nr.geometryServiceUrl;if(!t)throw new B("internal:geometry-service-url-not-configured");let i;i="portal"in t?t.portal||Kn.getDefault():t,await i.load({signal:e});const r=(n=(s=i.helperServices)==null?void 0:s.geometry)==null?void 0:n.url;if(!r)throw new B("internal:geometry-service-url-not-configured");return r}async function GIt(t,e,i=null,r){const s=await ple(i,r),n=new I8({geometries:[t],outSpatialReference:e}),o=await dle(s,n,{signal:r});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new B("internal:geometry-service-projection-failed")}const HIt=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:ple,projectGeometry:GIt},Symbol.toStringTag,{value:"Module"}));let qIt=class{constructor(e,i){this.spatialReference=i,this.unitInMeters=cc(this.spatialReference,br(this.spatialReference).metersPerDegree);const r=e&&"portalItem"in e?e.portalItem:void 0;this._geometryServiceURLPromise=ple(r).catch(()=>{throw new B("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const i=await this._geometryServiceURLPromise;let r,s=!0;Array.isArray(e[0])&&typeof e[0]!="number"?r=e:(r=[e],s=!1);const n=r.map(l=>l instanceof wt?l:new wt(l,this.spatialReference)),o=new I8({geometries:n,outSpatialReference:Ye.WGS84}),a=(await dle(i,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return s?a:a[0]}};var ei;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(ei||(ei={}));const yT=[ei.ELEVATION,ei.MAP];async function WIt(t,e){if(t.type==="2d")return t.hitTest(e);const i=await t.hitTest(e);if(i.results.length===0)return i;const r=i.results[0],s=(r.distance??0)*(1+ZIt),n=i.results.findIndex(o=>(o.distance??0)>s);return n!==-1&&(i.results=i.results.slice(0,n)),r&&i.ground.distance>s&&(i.ground.mapPoint=null),i}const ZIt=.05;async function YIt(t,e){var f,m,g,y,v;const{results:i,ground:r}=await WIt(t,e),s=(!r.layer||!RL(r.layer.type))&&r.mapPoint,n=[],o=QIt(t),a=s?XIt(t,o):JIt;let l=0,c=0;const u=()=>{const b=a.layerViews[c];s&&b&&"fetchPopupFeaturesAtLocation"in b&&n.push({mapPoint:r.mapPoint,layerView:b}),++c};let d=null;for(;l<i.length||c<a.layerViews.length;){const b=i[l];if(b&&b.type!=="graphic")++l;else if(((f=b==null?void 0:b.layer)==null?void 0:f.type)!=="scene"||((m=b==null?void 0:b.layer)==null?void 0:m.parent)!==((g=t==null?void 0:t.map)==null?void 0:g.basemap))if(b){const w=(y=b.layer)==null?void 0:y.uid,x=a.layerUids.has(w)&&b.distance===r.distance,T=o.get((v=b.layer)==null?void 0:v.uid);if(d??(d=b.mapPoint),c<a.layerViews.length&&(x||(b.distance??0)>r.distance)&&a.layerViews[c]!==T){u();continue}n.push({graphic:b.graphic,layerView:T}),++l}else u();else++l}return d??(d=r.mapPoint),{hits:n,location:d}}function XIt(t,e){const i=new Set,r=[];for(let n=t.basemapTerrain.numLayers(ei.MAP)-1;n>=0;n--){const o=t.basemapTerrain.layerViewByIndex(n,ei.MAP);i.add(o.layer.uid),r.push(o)}const s=t.basemapTerrain.overlayManager.renderer.layers;for(const{uid:n}of s){const o=e.get(n);o&&(i.add(n),r.push(o))}return r.reverse(),{layerUids:i,layerViews:r}}const JIt={layerUids:new Set,layerViews:[]};function QIt(t){const e=new Map;for(const i of t.allLayerViews){const r=i.layer.uid;e.set(r,i)}return e}let wh=class extends Ue{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1,this.uncompressedTextureDownsamplingEnabled=!1}};h([p()],wh.prototype,"minTotalNumberOfFeatures",void 0),h([p()],wh.prototype,"maxTotalNumberOfFeatures",void 0),h([p()],wh.prototype,"maxNumberOfDrawCalls",void 0),h([p()],wh.prototype,"maxTotalNumberOfVertices",void 0),h([p()],wh.prototype,"snapshotAvailable",void 0),h([p()],wh.prototype,"polygonLodFactor",void 0),h([p()],wh.prototype,"polylineLodFactor",void 0),h([p()],wh.prototype,"skipHighSymbolLods",void 0),h([p()],wh.prototype,"uncompressedTextureDownsamplingEnabled",void 0),wh=h([I("esri.views.3d.support.QualitySettings.Graphics3DSettings")],wh);let Yf=class extends Ue{constructor(){super(...arguments),this.lodFactor=1}};h([p()],Yf.prototype,"lodFactor",void 0),Yf=h([I("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Yf);let q0=class extends Ue{constructor(){super(...arguments),this.object=new Yf,this.point=new Yf,this.integratedMesh=new Yf,this.pointCloud=new Yf,this.uncompressedTextureDownsamplingEnabled=!1}};h([p({type:Yf})],q0.prototype,"object",void 0),h([p({type:Yf})],q0.prototype,"point",void 0),h([p({type:Yf})],q0.prototype,"integratedMesh",void 0),h([p({type:Yf})],q0.prototype,"pointCloud",void 0),h([p()],q0.prototype,"uncompressedTextureDownsamplingEnabled",void 0),q0=h([I("esri.views.3d.support.QualitySettings.SceneServiceSettings")],q0);let W0=class extends Ue{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.elevationLevelDelta=3,this.reduceTileLevelDifferences=!0}};h([p()],W0.prototype,"lodBias",void 0),h([p()],W0.prototype,"angledSplitBias",void 0),h([p()],W0.prototype,"vtlContentZoom",void 0),h([p()],W0.prototype,"elevationLevelDelta",void 0),h([p()],W0.prototype,"reduceTileLevelDifferences",void 0),W0=h([I("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],W0);let rA=class extends Ue{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};h([p()],rA.prototype,"pixelRatio",void 0),h([p()],rA.prototype,"maxTotalNumberOfFeatures",void 0),rA=h([I("esri.views.3d.support.QualitySettings.HeatmapSettings")],rA);let Sa=class extends Ue{constructor(){super(...arguments),this.graphics3D=new wh,this.sceneService=new q0,this.tiledSurface=new W0,this.heatmap=new rA,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};h([p({type:wh})],Sa.prototype,"graphics3D",void 0),h([p({type:q0})],Sa.prototype,"sceneService",void 0),h([p({type:W0})],Sa.prototype,"tiledSurface",void 0),h([p({type:rA})],Sa.prototype,"heatmap",void 0),h([p()],Sa.prototype,"fadeDuration",void 0),h([p()],Sa.prototype,"antialiasingEnabled",void 0),h([p()],Sa.prototype,"physicallyBasedRenderingEnabled",void 0),h([p()],Sa.prototype,"highQualityTransparency",void 0),h([p()],Sa.prototype,"highResolutionAtmosphere",void 0),h([p()],Sa.prototype,"reflections",void 0),h([p()],Sa.prototype,"ambientOcclusion",void 0),h([p()],Sa.prototype,"memoryLimit",void 0),h([p()],Sa.prototype,"additionalCacheMemory",void 0),h([p()],Sa.prototype,"frameRate",void 0),h([p()],Sa.prototype,"maximumPixelRatio",void 0),Sa=h([I("esri.views.3d.support.QualitySettings")],Sa);const Vve=Sa;let KIt=class Eee{constructor(e,i,r,s){this.viewingMode=e,this.spatialReference=i,this.unitInMeters=r,this._coordinateSystem=s,this._tmpCoordinateSystem=Dit(s),this.referenceEllipsoid=br(i),this.sphericalPCPF=id(i)}set extent(e){e&&Nit(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return Git(this._coordinateSystem,e)}setAltitude(e,i,r=e){return FPe(this._coordinateSystem,r,i,e)}setAltitudeOfTransformation(e,i){Hit(this._coordinateSystem,i,e,i)}worldUpAtPosition(e,i){return Vit(this._coordinateSystem,e,i)}worldBasisAtPosition(e,i,r){return zit(this._coordinateSystem,e,i,r)}basisMatrixAtPosition(e,i){const r=this.worldBasisAtPosition(e,Ts.X,rt.get()),s=this.worldBasisAtPosition(e,Ts.Y,rt.get()),n=this.worldBasisAtPosition(e,Ts.Z,rt.get());return Ay(i,r[0],r[1],r[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),i}headingAtPosition(e,i){const r=this.worldUpAtPosition(e,rt.get()),s=this.worldBasisAtPosition(e,Ts.Y,rt.get()),n=hPe(i,s,r);return ja(n)}intersectManifoldClosestSilhouette(e,i,r){return HH(this._coordinateSystem,i,this._tmpCoordinateSystem),jit(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,i,r){HH(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=rt.get();return Bit(this._tmpCoordinateSystem,e,s)?ve(r,s):null}intersectInfiniteManifold(e,i,r){if(this.viewingMode===Je.Global)return this.intersectManifold(e,i,r);HH(this._coordinateSystem,i,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=rt.get();return G2(s.plane,e,n)?ve(r,n):null}toRenderCoords(e,i,r){return gB(e)?xl(e,i,this.spatialReference):Go(e,i,r,this.spatialReference)}fromRenderCoords(e,i,r=null){return gB(i)?(r!=null&&(i.spatialReference=r),vw(e,this.spatialReference,i)?i:null):Go(e,this.spatialReference,i,r)?i:null}static create(e,i){switch(e){case Je.Local:return new Eee(Je.Local,i,cc(i),Uit());case Je.Global:return new Eee(Je.Global,i,1,kit(i))}}static renderUnitScaleFactor(e,i){return Dhe(e)/Dhe(i)}};var zg;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(zg||(zg={}));const e3t=(()=>{const t=new Array;return t[zg.ELEVATION]=10,t[zg.BASEMAP]=10,t[zg.I3S_INDEX]=10,t[zg.I3S_DATA]=10,t[zg.SYMBOLOGY]=5,t})(),t3t=30;function i3t(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function r3t(t){return new Bl({view:t})}const zve=.1,$5=1,O7=1,s3t=.75,n3t=.6,Bve=1.3;let Bl=class extends Ue{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new t4e,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0,this.addHandles(t2({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality($5),this._maxMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(e,i){return new Jxt(e,this._cacheStorage,i)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();this._memoryPredicted<n3t&&this._canFastRecover?(this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality($5)):e?(this._memoryPredicted>1.1*O7||this._usedMemory>O7)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>zve&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/Bve),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1)):(this._downscaleMemoryUsed=0,this._usedMemory>O7?(this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/Bve),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(this._usedMemory<s3t&&this._quality<$5?(this._stableQuality=this._quality,e=this._updateQuality(this._quality+.05)):this._quality<1&&(this._canFastRecover=!0))),this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,zve),$5))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){var a,l,c,u,d;if(!this.view)return;(l=(a=this.view._stage)==null?void 0:a.renderer)==null||l.tick();const e=(u=(c=this.view._stage)==null?void 0:c.renderer)==null?void 0:u.usedMemory;let i=(((d=this.view.basemapTerrain)==null?void 0:d.usedMemory)??0)+(e?e.fbos+e.edges+e.plugins:0),r=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(f=>{if(i3t(f)){const m=f.ignoresMemoryFactor?this._quality:1;i+=f.usedMemory*m,r+=f.unloadedMemory*m}});const s=this._warnMemoryUsage==null||Math.round(10*i)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(i>n&&s){this._warnMemoryUsage=i;const f=g=>(g/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",m=Math.round(100*this._quality);ne.getLogger(this).warn(`Memory Limit exceeded! Limit: ${f(n)} Current: ${f(i)} Projected: ${f(i+r)} Quality: ${m}%`)}this._usedMemory=i/n,this._memoryPredicted=(i+r)/n;const o=n-i;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){}};h([p({constructOnly:!0})],Bl.prototype,"view",void 0),h([p()],Bl.prototype,"maxMemory",null),h([p()],Bl.prototype,"additionalCacheMemory",null),h([p({readOnly:!0})],Bl.prototype,"memoryFactor",null),h([p({readOnly:!0})],Bl.prototype,"updating",null),h([p({readOnly:!0})],Bl.prototype,"usedMemory",null),h([p({readOnly:!0})],Bl.prototype,"usedCacheMemory",null),h([p()],Bl.prototype,"_quality",void 0),h([p()],Bl.prototype,"_usedMemory",void 0),h([p()],Bl.prototype,"_updating",void 0),h([p()],Bl.prototype,"_stableQuality",void 0),h([p()],Bl.prototype,"_maxMemory",void 0),h([p()],Bl.prototype,"_additionalCacheMemory",void 0),Bl=h([I("esri.views.3d.support.MemoryController")],Bl);let o3t=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},a3t=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new l3t}},l3t=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},c3t=class{constructor(e,i,r,s){this._workerFunc=e,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=s.map(n=>new a3t(n))}destroy(){this._clients.length=0}hasQuota(e){const i=this._clients[e];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(e){const i=this._clients[e.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(r,s)=>this._taskCallback(r,s))):i.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const i=this._clients[e.client];this._totalNumWorkers--,i&&(i.numWorkers--,i.statistics.requests++,i.statistics.size+=e.size||0,i.statistics.duration+=e.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,bt(i.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,i){e._cancelled||(this._callbackFunc(e,i),this._taskFinished(e))}getStatsForType(e){const i=this._clients[e];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){}},u3t=class{constructor(e,i){this.element=e,this.type="image+type",this.isOpaque=i==="image/jpeg"}};function nM(t){return t!=null&&"type"in t&&t.type==="vector-tile"}function EUe(t){return t!=null&&"type"in t&&t.type==="raster-tile"}function CUe(t){return t!=null&&"type"in t&&t.type==="tile-texture"}function L8(t){return t!=null&&"type"in t&&t.type==="image+type"}let uV=class extends Ue{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,i,r){this._loadQueue=new c3t((s,n)=>this._startLoading(s,n),(s,n)=>this._doneLoadingCB(s,n),e,i),r&&(this._frameTask=r.registerTask(It.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Lr(this._frameTask),this._tasks.forEach(e=>oc(e.abortController)),this._loadQueue=He(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,i,r,s={}){const n=ma();n.__signal=s!=null?s.signal:null;const o=this._createOrUpdateTask(e,i,r,s,n);return Va(s,()=>this._cancelRequest(o,n)),n.promise}_createTask(e,i,r,s,n,o){const a=new p3t(e,i,r,s,n);return this._updateTask(a,o),this._tasks.set(n,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,i){var r;TL(e.resolvers,i),i.reject(Ui()),e.resolvers.length===0&&(e.status===kd.DOWNLOADING&&(e.status=kd.CANCELLED,this._loadQueue.cancel(e),(r=e.abortController)==null||r.abort(),e.request=null,e.abortController=null),e.status=kd.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,i){e.resolvers.push(i)}_createOrUpdateTask(e,i,r,s,n){const o=f3t((s==null?void 0:s.uid)||e,i,r),a=this._tasks.get(o);return a?(this._updateTask(a,n),a):this._createTask(e,s,i,r,o,n)}_doneLoadingCB(e,i){this._loadQueue&&(bt(e.status===kd.DOWNLOADING),e.status=kd.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:i}):this._doneLoading(e,i))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const i=this._onLoadQueue.shift();Dt(i.task.abortController),i.task.abortController=null,i.callback(i.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const i=this._doneQueue.shift();i.task.status!==kd.DOWNLOADED&&(i.err=i.err||Ui()),this._doneLoading(i.task,i.err),e.madeProgress()}}_doneLoading(e,i){if(i&&!us(i)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=L8(e.result)||e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const s of e.resolvers)if(i)us(i)?s.reject(i):s.reject(new B("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${i}`,{url:e.url,error:i}));else{--r;const n=r>0?re(e.result):e.result;s.resolve(n)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,i){if(e.status===kd.CANCELLED)return!1;let r,s;switch(e.startTime=performance.now(),e.status=kd.DOWNLOADING,e.docType){case"binary":s="array-buffer",r=0;break;case"image":s="image";break;case"image+type":s="array-buffer";break;default:s="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=fr(e.url,{...e.options,responseType:s,timeout:r,signal:n});const o=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:i,task:e}):(e.abortController=null,i(e))},a=l=>{e.status===kd.DOWNLOADING&&i(e,l)};return e.docType!=="image+type"?(e.request.then(l=>o(l.data),a),!0):(e.request.then(l=>{const c=l.data,u=d3t(c);if(s="image",e.size=c.byteLength,u==="unknown")return e.request=fr(e.url,{responseType:s,timeout:r,signal:n}),void e.request.then(m=>o(m.data),a);const d=new Blob([c],{type:u}),f=window.URL.createObjectURL(d);e.request=fr(f,{responseType:s,timeout:r,signal:n}),e.request.then(m=>o(new u3t(m.data,u)),a).finally(()=>window.URL.revokeObjectURL(f))},a),!0)}get test(){}};h([p({readOnly:!0})],uV.prototype,"updating",void 0),uV=h([I("esri.views.3d.support.StreamDataLoader")],uV);const h3t={numRetries:0};function d3t(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let p3t=class extends o3t{constructor(e,i,r,s,n){super(s),this.url=e,this.options=i,this.docType=r,this.key=n,this.result=null,this.status=kd.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=h3t.numRetries}};function f3t(t,e,i){return`${t}:${e}:${i}`}var kd;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(kd||(kd={}));let hV=class extends Ue{constructor(){super(...arguments),this.updating=!1}};function m3t(t){return new of({view:t})}h([p({readOnly:!0})],hV.prototype,"updating",void 0),hV=h([I("esri.views.3d.support.ResourceController.ResourceControllerMain")],hV);let of=class extends hV{constructor(){super(...arguments),this._immediateTask=SP,this._normalTask=SP,this._updatingObjects=iy([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=met(),this._memoryController=r3t(this.view),this._streamDataLoader=new uV,this._streamDataLoader.setup(t3t,e3t,this._scheduler),this.addHandles([te(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},lr),te(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=t2({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(It.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(It.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=Lr(this._frameTask),this._streamDataLoader=He(this._streamDataLoader),this._memoryController=He(this._memoryController),this._scheduler=He(this._scheduler),this.view=null}get updating(){var e,i,r,s;return!!((e=this._memoryController)!=null&&e.updating||(i=this._streamDataLoader)!=null&&i.updating||(r=this._immediateTask)!=null&&r.updating)||((s=this._updatingObjects)==null?void 0:s.value.some(n=>n.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const i=this._streamDataLoader;return{request:(r,s,n)=>i.request(r,s,e,n),get busy(){return!i.hasDownloadSlots(e)}}}addUpdatingObject(e){const i=this._updatingObjects;return i.value=[...i.value,e],Gi(()=>{i.value=i.value.filter(r=>r!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(Tre(e.deltaTime)),!this._scheduler)||(this._memoryController.update(),this._scheduler.updateBudget(e)&&this._scheduler.frame())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){}};h([p()],of.prototype,"view",void 0),h([p()],of.prototype,"_scheduler",void 0),h([p()],of.prototype,"_memoryController",void 0),h([p()],of.prototype,"_streamDataLoader",void 0),h([p()],of.prototype,"_immediateTask",void 0),h([p()],of.prototype,"_normalTask",void 0),h([p()],of.prototype,"_updatingObjects",void 0),h([p({readOnly:!0})],of.prototype,"updating",null),of=h([I("esri.views.3d.support.ResourceController")],of);var wD;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(wD||(wD={}));let pci=class{constructor(e,i=0,r=0,s=0,n=0,o=null){this.usedMemory=e,this.displayedFeatures=i,this.totalFeatures=r,this.maximumFeatures=s,this.nodes=n,this.core=o}};function g3t(t){return"performanceInfo"in t}let y3t=class{constructor(e){this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer;const i=e.performanceInfo;this.memory=i.usedMemory,this.displayedNumberOfFeatures=i.displayedFeatures,this.maximumNumberOfFeatures=i.maximumFeatures,this.totalNumberOfFeatures=i.totalFeatures}},_3t=class{constructor(e){var i,r,s,n;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,e.resourceController!=null){const o=e.resourceController.memoryController;this.totalMemory=(o.maxMemory??0)*wD.MEGABYTES,this.usedMemory=Math.round(o.usedMemory*this.totalMemory),this.quality=e.quality,this.load=e.resourceController.scheduler.load,this.cachedMemory=o.usedCacheMemory}this.terrainMemory=((i=e.basemapTerrain)==null?void 0:i.usedMemory)??0,this.edgesMemory=((r=e._stage)==null?void 0:r.renderer.usedMemory.edges)??0,this.fboMemory=((s=e._stage)==null?void 0:s.renderer.usedMemory.fbos)??0,(n=e.allLayerViews)==null||n.items.forEach(o=>{g3t(o)&&this.layerPerformanceInfos.push(new y3t(o))}),this.layerPerformanceInfos.sort((o,a)=>a.memory-o.memory)}},v3t=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,i,r){const s=r?`gltfPBR:${e}`:`gltf:${e}`,n=this._gltfMemCache.get(s);return n!=null?Promise.resolve(n):jve(this._gltfLoading,this._gltfMemCache,s,o=>ske(new ike(o.streamDataRequester),e,o,r),i)}loadWOSR(e,i){const r=`wosr:${e}:${i.disableTextures}`,s=this._wosrMemCache.get(r);return s!=null?Promise.resolve(s):jve(this._wosrLoading,this._wosrMemCache,r,n=>nke(e,n),i)}};async function jve(t,e,i,r,s){Dt(s);const n=Va(s,()=>b3t(t,i));let o=t.get(i);if(o)o.refCount++;else{const a=new AbortController;o={refCount:1,abortController:a,promise:r({...s,signal:a.signal})},t.set(i,o)}try{const a=await o.promise;return e.put(i,a,a.size),t.delete(i),Dt(s),a}finally{Lr(n)}}function b3t(t,e){const i=t.get(e);i!=null&&--i.refCount>0||(t.delete(e),i!=null&&i.abortController.abort())}let sA=class extends Ue{constructor(e,i){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(i==null?void 0:i.registerTask(It.TEXTURE_UNLOAD))??SP}normalizeCtorArgs(){return{}}destroy(){var e,i,r;super.destroy(),(e=this._frameTask)==null||e.remove(),(i=this._textureRequests)==null||i.forEach(s=>this._releaseTextureRequest(s)),(r=this._textureRequests)==null||r.clear()}get updating(){return this._frameTask.updating}fromData(e,i){const r=this.makeUid(e);let s=this._textureRequests.get(r);if(!s){const n=new AUe;n.texture=i(),this._stage&&(n.texture.load(this._stage.renderView.renderingContext),this._stage.add(n.texture)),this._textureRequests.set(r,n),s=n}return s.referenceCount++,new MUe(r,s.texture,()=>this._release(r))}_release(e){const i=this._textureRequests.get(e);i?(i.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),i.referenceCount--,i.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){}_releaseNow(e){var r;if(!this._textureRequests)return;const i=this._textureRequests.get(e);!i||i.referenceCount>0||((r=i.texture)==null||r.unload(),this._releaseTextureRequest(i),this._textureRequests.delete(e))}_releaseTextureRequest(e){var i;e.texture?(i=this._stage)==null||i.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,i=null){return i!=null?`${e}.${i}px`:e}};h([p()],sA.prototype,"_frameTask",void 0),h([p()],sA.prototype,"updating",null),sA=h([I("esri.views.3d.support.TextureCollection")],sA);let MUe=class{constructor(e,i,r){this.uid=e,this.texture=i,this.release=r}},AUe=class{constructor(){this.referenceCount=0}},w3t=class extends sA{constructor(e,i,r){super(i,r),this._streamDataRequester=e}async fromUrl(e,i,r){Dt(r);const s=r==null?void 0:r.signal,n=this.makeUid(e,i);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:n,signal:a.signal});o=new AUe,o.abortController=a;const c=o;this._textureRequests.set(n,o),o.textureAsync=l.then(async u=>{const d=this._createTexture(e,u,i);return c.texture=d,c.abortController=null,await d.load(this._stage.renderView.renderingContext),this._stage.add(d),new MUe(n,d,()=>this._release(n))},u=>{throw c.abortController=null,u})}o.referenceCount++;try{return await wre(o.textureAsync,s)}catch(a){throw this._release(n),a}}_createTexture(e,i,r){var n;const s={width:i.width,height:i.height,wrap:{s:Ai.CLAMP_TO_EDGE,t:Ai.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(LEe(e)){if(r||i.width===0&&i.height===0){const o=i.width?i.height/i.width:1;r=r||64,o>1?(i.width=Math.round(r/o),i.height=r):(i.width=r,i.height=Math.round(r*o))}(n=this._stage.renderView)!=null&&n.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return new cw(i,s)}},x3t=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(zg.SYMBOLOGY),this.objectResourceCache=new v3t((r,s)=>e.resourceController.memoryController.newCache(r,s)),this.textures=new w3t(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const i=br(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=DLe(e.viewingMode,i),this.screenSizePerspectiveSettingsLabels=Qyt(e.viewingMode,i)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return Gi();this._graphicsOwners.push(e);const i=te(()=>{var r;return(r=e.layer)==null?void 0:r.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Gi(()=>{i.remove(),TL(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(i=>{var r;return((r=i.layer)==null?void 0:r.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new Ey;const i=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([te(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,i,lr),this._viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=He(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;R5.distance=e.centerOnSurfaceInfrequent.distance,R5.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(R5),this.screenSizePerspectiveSettingsLabels.update(R5),this._view._stage.renderView.requestRender()}get test(){}};const R5={distance:0,fovY:0};let oM=class{constructor(e,i,r=""){this.graphics=e,this._symbol=new Hg({symbolLayers:new Ke([new lb({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new K2({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})])})}show(e,i){if(i==null)return;this.hide();const r=new wt({x:e[0],y:e[1],z:e[2],spatialReference:i});this._graphic=new ya({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},J1=class extends Ue{constructor(e){super(e)}};h([p({constructOnly:!0})],J1.prototype,"renderCoordsHelper",void 0),h([p({constructOnly:!0})],J1.prototype,"surface",void 0),h([p({constructOnly:!0})],J1.prototype,"state",void 0),J1=h([I("esri.views.3d.support.pointsOfInterest.PointOfInterest")],J1);const T3t=Array;let af=class extends J1{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new O_({location:wt,renderLocation:T3t},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=C(),this._tmpPoint=new wt}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.addHandles(on(()=>{var i,r;return(r=(i=this.map)==null?void 0:i.ground)==null?void 0:r.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=He(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get scale(){const e=this._camera,i=Ar(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return Jb(r,i,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){var s;if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!((s=this.map)!=null&&s.ground))return this._updateSurfaceAltitude(0),pa;const e=this.state.spatialReference;this._tmpPoint.spatialReference=e,this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);const i=(this._tmpPoint.z??0)>S3t&&this.renderCoordsHelper.viewingMode===Je.Global&&(e.isWGS84||e.isWebMercator);let r=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:i?E3t:0}).then(n=>this._updateSurfaceAltitude(n.geometry.z??0)).catch(n=>{us(n)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===r&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),r=null}),this._pendingElevationQueryController=r,pa}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude($7,this._estimatedSurfaceAltitude,this._camera.eye),Uo(this._get("renderLocation"),$7)||(this._set("renderLocation",ve(this._propertiesPool.get("renderLocation"),$7)),this.notifyChange("renderLocation"))}};h([p({constructOnly:!0})],af.prototype,"scheduler",void 0),h([p({constructOnly:!0})],af.prototype,"cache",void 0),h([p({constructOnly:!0})],af.prototype,"task",void 0),h([p()],af.prototype,"location",null),h([p({constructOnly:!0})],af.prototype,"map",void 0),h([p()],af.prototype,"renderLocation",void 0),h([p()],af.prototype,"scale",null),h([p()],af.prototype,"updating",null),af=h([I("esri.views.3d.support.pointsOfInterest.CameraOnSurface")],af);const $7=C(),S3t=1e5,E3t=1e6,C3t=Array;let Ud=class extends J1{constructor(e){super(e),this._propertiesPool=new O_({location:wt,renderLocation:C3t},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=C(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Lr(this._frameWorker),this._propertiesPool=He(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,pa}_updateRenderLocation(){const e=A3t;let i=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!i&&r&&(i=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),i&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=P3t;i&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,s)&&(ve(e,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),i?this.distance=Ar(this._camera.eye,e):(de(e,this._camera.viewForward,this._get("distance")),Ee(e,e,this._camera.eye)),Uo(this._get("renderLocation"),e)||this._set("renderLocation",ve(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,i){var s,n;const r=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(r.ray,e,i))return!1;if(this.state.isGlobal){const o=br(this.renderCoordsHelper.spatialReference).radius,a=o+e,l=pl(r.eye),c=l<a*a,u=Ar(r.eye,i);if(c&&u>o/4){const d=a-Math.sqrt(l);return de(i,r.viewForward,d),Ee(i,i,r.eye),!0}}else{const o=(s=this.surface)!=null&&s.ready?this.surface.extent:null;o!=null&&ZG(o,(n=this.surface)==null?void 0:n.spatialReference,J$,this.renderCoordsHelper.spatialReference)&&(i[0]=Ne(i[0],J$[0],J$[2]),i[1]=Ne(i[1],J$[1],J$[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,i){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,i)){if(kr.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,s=Ar(r,e),n=Ar(r,i);if(Math.abs(n-s)/s>M3t)return!0}return!1}};h([p({constructOnly:!0})],Ud.prototype,"scheduler",void 0),h([p({constructOnly:!0})],Ud.prototype,"task",void 0),h([p()],Ud.prototype,"distance",void 0),h([p({constructOnly:!0})],Ud.prototype,"estimateSurfaceAltitudeAtCenter",void 0),h([p({readOnly:!0})],Ud.prototype,"location",null),h([p({readOnly:!0})],Ud.prototype,"renderLocation",void 0),h([p()],Ud.prototype,"updating",void 0),Ud=h([I("esri.views.3d.support.pointsOfInterest.CenterOnSurface")],Ud);const M3t=.05,A3t=C(),P3t=C(),J$=oi();let O3t=class{constructor(e){this._handles=new Ey,this.events=new Ls,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=He(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),e.removed.forEach(i=>this._handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",$3t)}};const $3t={},R3t=Array;let lf=class extends J1{constructor(e){super(e),this._propertiesPool=new O_({location:wt,renderLocation:R3t},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([te(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),te(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.addHandles(this.scheduler.registerTask(It.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=He(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get worldUnitsPerContentPixel(){const{camera:e,contentPixelRatio:i}=this.state;return e.computeRenderPixelSizeAt(this.renderLocation)*(e.pixelRatio/i)}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),i=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(i,Gve);const n=Math.max(0,(Math.acos(Te(Gve,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!h2(e,i)){const c=this._propertiesPool.get("renderLocation");ve(c,i),this._set("renderLocation",c)}return pa}const o=1-Ne(n/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(Hve);const l=this._propertiesPool.get("renderLocation");return Sr(l,i,Hve,a),e&&h2(e,l)||this._set("renderLocation",l),pa}_calculateScreenHorizontalEdgeOnSurface(e){const i=this.state.contentCamera,r=i.getRenderCenter(ka());if(r[1]=i.aboveGround?i.padding[gi.BOTTOM]:i.fullHeight-i.padding[gi.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(i.unprojectFromRenderScreen(r,Q$)){$e(Q$,Q$,i.eye);const n=Ce(Q$,Q$);if(this.renderCoordsHelper.intersectInfiniteManifold(td(i.eye,n),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,i.eye)}updateRenderLocation(){this._dirty=!0}};h([p()],lf.prototype,"_dirty",void 0),h([p({constructOnly:!0})],lf.prototype,"scheduler",void 0),h([p({constructOnly:!0})],lf.prototype,"centerOnSurface",void 0),h([p({constructOnly:!0})],lf.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),h([p()],lf.prototype,"updating",null),h([p()],lf.prototype,"location",null),h([p()],lf.prototype,"renderLocation",void 0),h([p()],lf.prototype,"worldUnitsPerContentPixel",null),lf=h([I("esri.views.3d.support.pointsOfInterest.Focus")],lf);const Gve=C(),Q$=C(),Hve=C();let E0=class extends Ue{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=C();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([te(()=>{var e,i;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(i=this.surfaceView)==null?void 0:i.extent]},()=>this._update()),on(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}_update(){var r;if(this._updateController&&(this._updateController.abort(),this._updateController=null),((r=this.surfaceView)==null?void 0:r.extent)==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=fse(this.surfaceView.extent),i=new wt({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(i,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(s=>{this._updateController=null,this._set("location",s.geometry)}).catch(s=>{})):this._set("location",i)}};h([p({constructOnly:!0})],E0.prototype,"view",void 0),h([p({constructOnly:!0})],E0.prototype,"cache",void 0),h([p()],E0.prototype,"surface",null),h([p()],E0.prototype,"surfaceView",null),h([p({readOnly:!0})],E0.prototype,"location",void 0),h([p({readOnly:!0})],E0.prototype,"renderLocation",null),E0=h([I("esri.views.3d.support.pointsOfInterest.StableSurfaceCenter")],E0);let C0=class extends Ue{constructor(e){super(e),this._tileGeometryUpdateExtent=Kh(),this._tileGeometryUpdateSpatialReference=null,this.events=new Ls,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(It.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",I3t),Kh(this._tileGeometryUpdateExtent),this._set("updating",!1)),pa}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,vb(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let i=1;i<this.centerOnSurfaces.length;i++){const r=this.centerOnSurfaces[i];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,i){const r=this.state.contentCamera.eye,s=L3t,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,_x,i),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,vx,i),_x[0]<vx[0]?(s[0]=_x[0],s[2]=vx[0]):(s[0]=vx[0],s[2]=_x[0]),_x[1]<vx[1]?(s[1]=_x[1],s[3]=vx[1]):(s[1]=vx[1],s[3]=_x[1]),VG(s,e)}};h([p({constructOnly:!0})],C0.prototype,"state",void 0),h([p({constructOnly:!0})],C0.prototype,"centerOnSurfaces",void 0),h([p({constructOnly:!0})],C0.prototype,"renderCoordsHelper",void 0),h([p({constructOnly:!0})],C0.prototype,"scheduler",void 0),h([p({constructOnly:!0})],C0.prototype,"surface",void 0),h([p({readOnly:!0})],C0.prototype,"updating",void 0),C0=h([I("esri.views.3d.support.pointsOfInterest.SurfaceGeometryUpdates")],C0);const I3t={},_x=C(),vx=C(),L3t=Kh();let Nc=class extends Ue{constructor(e){super(e),this.renderPointOfView=C(),this._pois=new Array,this._debugCenters=new Map,this._tmpRay=mo(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new O_({renderPointOfView:D3t},this)}initialize(){var u;const{state:e,basemapTerrain:i,renderCoordsHelper:r,map:s}=this.view;this._surfaceIntersector=gp(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=fa.MIN,this._contentIntersector=gp(e.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=(u=this.view.basemapTerrain)==null?void 0:u.elevationQueryCache,l={state:e,scheduler:o,surface:i,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new Ud({...l,task:It.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new Ud({...l,task:It.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnContent",new Ud({...l,task:It.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new af({...l,cache:a,task:It.POINT_OF_INTEREST_INFREQUENT,map:s})),this._set("surfaceGeometryUpdates",new C0({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new O3t({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new E0({cache:a,view:this.view})),this._set("focus",new lf({state:e,scheduler:o,surface:i,renderCoordsHelper:r,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(d,f)=>this._estimateSurfaceIntersectionAtRenderPoint(d,this.view.state.contentCamera,f)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new oM(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new oM(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new oM(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new oM(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new oM(c,"green","Focus")),this.addHandles([te(()=>e.contentCamera,d=>this._cameraChanged(d),lr),te(()=>i.extent,()=>this._updateCenterPointsOfInterest()),jo(()=>!i.updating,()=>this._updateCenterPointsOfInterest(),lr),on(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),on(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),jo(()=>kr.SHOW_POI,d=>this._setDebug(d),pt)]),this._cameraChanged(this.view.state.contentCamera);for(const d of this._pois)d.runTask()}destroy(){this._setDebug(!1),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(i=>i.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,sC,F3t)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(sC):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const i=e.origin,r=Ee(sC,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,i,r),this._surfaceIntersector.results.min.getIntersectionPoint(sC)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(sC)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,i,r){const s=Moe(i,e,N3t);if(s==null)return null;const n=s.origin,o=Ee(sC,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,i),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,o),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const i=e.eye;Uo(this.renderPointOfView,i)||this._set("renderPointOfView",ve(this._propertiesPool.get("renderPointOfView"),i))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(i=>i.hide()),void this.removeHandles("debug");for(const i of this._pois)this.addHandles(te(()=>i.renderLocation,r=>{var s;return(s=this._debugCenters.get(i))==null?void 0:s.show(r,i.renderCoordsHelper.spatialReference)},pt),"debug")}get test(){}};h([p()],Nc.prototype,"centerOnContent",void 0),h([p()],Nc.prototype,"centerOnSurfaceFrequent",void 0),h([p()],Nc.prototype,"centerOnSurfaceInfrequent",void 0),h([p()],Nc.prototype,"cameraOnSurface",void 0),h([p()],Nc.prototype,"focus",void 0),h([p()],Nc.prototype,"renderPointOfView",void 0),h([p()],Nc.prototype,"surfaceOrigin",void 0),h([p()],Nc.prototype,"contentGeometryUpdates",void 0),h([p()],Nc.prototype,"surfaceGeometryUpdates",void 0),h([p({constructOnly:!0})],Nc.prototype,"view",void 0),h([p()],Nc.prototype,"updating",null),Nc=h([I("esri.views.3d.support.pointsOfInterest.PointsOfInterest")],Nc);const D3t=Array,sC=C(),N3t=mo(),F3t={exclude:new Set([Xb])};let k3t=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,i){this._store.put(e,i,i.values.byteLength+256)}};function qS(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function PUe(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function U3t(t,e,i,r,s,n,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=r,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function V3t(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:PUe,create:qS,createView:V3t,fromValues:U3t},Symbol.toStringTag,{value:"Module"}));var Mu,qve,Wve;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(Mu||(Mu={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(qve||(qve={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(Wve||(Wve={}));let F_=class _T{static getId(e,i,r,s){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${i}/${r}/${s}`}constructor(e,i,r,s){this.set(e,i,r,s)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(e){this.set(e)}get hash(){const e=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|e<<8|r}acquire(e,i,r,s){this.set(e,i,r,s)}contains(e){const i=e.level-this.level;return i>=0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}containsChild(e){const i=e.level-this.level;return i>0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new _T(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,i,r,s){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[n,o,a,l]=e.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+i,this.col=+r,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new _T(this.level-1,this.row>>1,this.col>>1,this.world)}getNeighborId(e,i){return`${this.level}/${this.row+i}/${this.col+e}/${this.world}`}getChildKeys(){const e=this.level+1,i=this.row<<1,r=this.col<<1,s=this.world;return[new _T(e,i,r,s),new _T(e,i,r+1,s),new _T(e,i+1,r,s),new _T(e,i+1,r+1,s)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};F_.pool=new ga(F_,null,null,25,50);function zv(t,e){return[t,e]}function bx(t,e,i){return t[0]=e,t[1]=i,t}function z3t(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}const Bp=new F_("0/0/0/0");let B3t=class OUe{static create(e,i,r=null){const s=ey(e.spatialReference),n=i.origin||zv(e.origin.x,e.origin.y),o=zv(e.size[0]*i.resolution,e.size[1]*i.resolution),a=zv(-1/0,-1/0),l=zv(1/0,1/0),c=zv(1/0,1/0);r!=null&&(bx(a,Math.max(0,Math.floor((r.xmin-n[0])/o[0])),Math.max(0,Math.floor((n[1]-r.ymax)/o[1]))),bx(l,Math.max(0,Math.floor((r.xmax-n[0])/o[0])),Math.max(0,Math.floor((n[1]-r.ymin)/o[1]))),bx(c,l[0]-a[0]+1,l[1]-a[1]+1));const{cols:u,rows:d}=i;let f,m,g,y;return!r&&u&&d&&(bx(a,u[0],d[0]),bx(l,u[1],d[1]),bx(c,u[1]-u[0]+1,d[1]-d[0]+1)),e.isWrappable?(f=zv(Math.ceil(Math.round((s.valid[1]-s.valid[0])/i.resolution)/e.size[0]),c[1]),m=zv(Math.floor((s.origin[0]-n[0])/o[0]),a[1]),g=zv(f[0]+m[0]-1,l[1]),y=!0):(m=a,g=l,f=c,y=!1),new OUe(i.level,i.resolution,i.scale,n,a,l,c,o,m,g,f,y)}constructor(e,i,r,s,n,o,a,l,c,u,d,f){this.level=e,this.resolution=i,this.scale=r,this.origin=s,this.first=n,this.last=o,this.size=a,this.norm=l,this.worldStart=c,this.worldEnd=u,this.worldSize=d,this.wrap=f}normalizeCol(e){if(!this.wrap)return e;const i=this.worldSize[0];return e<0?i-1-Math.abs((e+1)%i):e%i}denormalizeCol(e,i){return this.wrap?this.worldSize[0]*i+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){return this.origin[0]+e*this.norm[0]}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,i,r=!1){Bp.set(i);const s=r?Bp.col:this.denormalizeCol(Bp.col,Bp.world),n=Bp.row;return z3t(e,this.getXForColumn(s),this.getYForRow(n+1),this.getXForColumn(s+1),this.getYForRow(n)),e}getTileCoords(e,i,r=!1){Bp.set(i);const s=r?Bp.col:this.denormalizeCol(Bp.col,Bp.world);return Array.isArray(e)?bx(e,this.getXForColumn(s),this.getYForRow(Bp.row)):(e.x=this.getXForColumn(s),e.y=this.getYForRow(Bp.row)),e}},Cee=class{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}*keys(){const e=this.lodInfo;for(const{row:i,colFrom:r,colTo:s}of this.spans)for(let n=r;n<=s;n++){const o=e.getWorldForColumn(n);yield new F_(e.level,i,e.normalizeCol(n),o)}}forEach(e,i){const{spans:r,lodInfo:s}=this,{level:n}=s;if(r.length!==0)for(const{row:o,colFrom:a,colTo:l}of r)for(let c=a;c<=l;c++)e.call(i,n,o,s.normalizeCol(c),s.getWorldForColumn(c))}};Cee.pool=new ga(Cee);let R7=class{constructor(e,i,r){this.row=e,this.colFrom=i,this.colTo=r}};const an=new F_("0/0/0/0");let j3t=class $Ue{static create(e,i){e[1]>i[1]&&([e,i]=[i,e]);const[r,s]=e,[n,o]=i,a=n-r,l=o-s,c=l!==0?a/l:0,u=(Math.ceil(s)-s)*c,d=(Math.floor(s)-s)*c;return new $Ue(r,Math.floor(s),Math.ceil(o),c,a<0?u:d,a<0?d:u,a<0?n:r,a<0?r:n)}constructor(e,i,r,s,n,o,a,l){this.x=e,this.ymin=i,this.ymax=r,this.invM=s,this.leftAdjust=n,this.rightAdjust=o,this.leftBound=a,this.rightBound=l}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const sh=[[0,0],[0,0],[0,0],[0,0]],G3t=1e-6;let Dci=class{constructor(e,i=null,r=e.lods[0].level,s=e.lods[e.lods.length-1].level){this.tileInfo=e,this.fullExtent=i,this.scales=[],this._infoByScale={},this._infoByLevel={};const n=e.lods.filter(a=>a.level>=r&&a.level<=s);this.minScale=n[0].scale,this.maxScale=n[n.length-1].scale;const o=this._lodInfos=n.map(a=>B3t.create(e,a,i));n.forEach((a,l)=>{this._infoByLevel[a.level]=o[l],this._infoByScale[a.scale]=o[l],this.scales[l]=a.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel[typeof e=="number"?e:e.level]}getTileBounds(e,i,r=!1){an.set(i);const s=this._infoByLevel[an.level];return s?s.getTileBounds(e,an,r):e}getTileCoords(e,i,r=!1){an.set(i);const s=this._infoByLevel[an.level];return s?s.getTileCoords(e,an,r):e}getTileCoverage(e,i=192,r=!0,s="closest"){if(!r&&(e.scale>this.minScale||e.scale<this.maxScale))return null;const n=s==="closest"?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),o=Cee.pool.acquire(n),a=this._wrap;let l,c,u,d=1/0,f=-1/0;const m=o.spans;sh[0][0]=sh[0][1]=sh[1][1]=sh[3][0]=-i,sh[1][0]=sh[2][0]=e.size[0]+i,sh[2][1]=sh[3][1]=e.size[1]+i;for(const b of sh)e.toMap(b,b),b[0]=n.getColumnForX(b[0]),b[1]=n.getRowForY(b[1]);const g=[];let y=3;for(let b=0;b<4;b++){if(sh[b][1]===sh[y][1]){y=b;continue}const w=j3t.create(sh[b],sh[y]);d=Math.min(w.ymin,d),f=Math.max(w.ymax,f),g[w.ymin]===void 0&&(g[w.ymin]=[]),g[w.ymin].push(w),y=b}if(d==null||f==null||f-d>100)return null;let v=[];for(l=d;l<f;){g[l]!=null&&(v=v.concat(g[l])),c=1/0,u=-1/0;for(let b=v.length-1;b>=0;b--){const w=v[b];c=Math.min(c,w.getLeftCol()),u=Math.max(u,w.getRightCol())}if(c=Math.floor(c),u=Math.floor(u),l>=n.first[1]&&l<=n.last[1])if(a)if(n.size[0]<n.worldSize[0]){const b=Math.floor(u/n.worldSize[0]);for(let w=Math.floor(c/n.worldSize[0]);w<=b;w++)m.push(new R7(l,Math.max(n.getFirstColumnForWorld(w),c),Math.min(n.getLastColumnForWorld(w),u)))}else m.push(new R7(l,c,u));else c>n.last[0]||u<n.first[0]||(c=Math.max(c,n.first[0]),u=Math.min(u,n.last[0]),m.push(new R7(l,c,u)));l+=1;for(let b=v.length-1;b>=0;b--){const w=v[b];w.ymax>=l?w.incrRow():v.splice(b,1)}}return o}getTileParentId(e){an.set(e);const i=this._infoByLevel[an.level],r=this._lodInfos.indexOf(i)-1;return r<0?null:(this._getTileIdAtLOD(an,this._lodInfos[r],an),an.id)}getTileResolution(e){const i=this._infoByLevel[typeof e=="object"?e.level:e];return i?i.resolution:-1}getTileScale(e){const i=this._infoByLevel[e.level];return i?i.scale:-1}intersects(e,i){an.set(i);const r=this._infoByLevel[an.level],s=e.lodInfo;if(s.resolution>r.resolution){this._getTileIdAtLOD(an,s,an);const o=s.denormalizeCol(an.col,an.world);for(const a of e.spans)if(a.row===an.row&&a.colFrom<=o&&a.colTo>=o)return!0}if(s.resolution<r.resolution){const[o,a,l,c]=e.spans.reduce((y,v)=>(y[0]=Math.min(y[0],v.row),y[1]=Math.max(y[1],v.row),y[2]=Math.min(y[2],v.colFrom),y[3]=Math.max(y[3],v.colTo),y),[1/0,-1/0,1/0,-1/0]),u=r.denormalizeCol(an.col,an.world),d=s.getColumnForX(r.getXForColumn(u)),f=s.getRowForY(r.getYForRow(an.row)),m=s.getColumnForX(r.getXForColumn(u+1))-1,g=s.getRowForY(r.getYForRow(an.row+1))-1;return!(d>c||m<l||f>a||g<o)}const n=s.denormalizeCol(an.col,an.world);return e.spans.some(o=>o.row===an.row&&o.colFrom<=n&&o.colTo>=n)}normalizeBounds(e,i,r){if(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],this._wrap){const s=ey(this.tileInfo.spatialReference),n=-r*(s.valid[1]-s.valid[0]);e[0]+=n,e[2]+=n}return e}getSmallestInfoForScale(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>i[0])return this._infoByScale[i[0]];for(let r=1;r<i.length-1;r++)if(e>i[r]+G3t)return this._infoByScale[i[r-1]];return this._infoByScale[i[i.length-1]]}getClosestInfoForScale(e){const i=this.scales;return this._infoByScale[e]||(e=i.reduce((r,s)=>Math.abs(s-e)<Math.abs(r-e)?s:r,i[0])),this._infoByScale[e]}scaleToLevel(e){const i=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let r=i.length-1;r>=0;r--)if(e<i[r])return r===i.length-1?this._infoByScale[i[i.length-1]].level:this._infoByScale[i[r]].level+(i[r]-e)/(i[r]-i[r+1]);return this._infoByScale[i[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}zoomToScale(e){return this.tileInfo.zoomToScale(e)}_getTileIdAtLOD(e,i,r){const s=this._infoByLevel[r.level];return e.set(r),i.resolution<s.resolution?null:(i.resolution===s.resolution||(e.level=i.level,e.col=Math.floor(r.col*s.resolution/i.resolution+.01),e.row=Math.floor(r.row*s.resolution/i.resolution+.01)),e)}},H3t=class{constructor(e,i){this.item=e,this.controller=i,this.promise=null}},q3t=class{constructor(e){this._schedule=null,this._task=null,this._deferreds=new N3,this._controllers=new N3,this._processingItems=new N3,this._pausedSignal=iy(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new rB(e.peeker),this.process=e.process;const i=e.scheduler;e.priority&&i&&(this._task=i.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=Lr(this._schedule),this._task=Lr(this._task)}get updating(){var e;return!!((e=this._task)!=null&&e.updating)||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){const i=this._controllers.get(e);i&&i.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(i=>e.push(i)),this._controllers.clear(),e.forEach(i=>i.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((i,r)=>e(r))}get(e){const i=this._deferreds.get(e);return i?i.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,i){const r=this.get(e);if(r)return r;const s=new AbortController;let n=null;i&&(n=Va(i,()=>s.abort()));const o=()=>{const u=this._processingItems.get(e);u&&u.controller.abort(),a(),c.reject(Ui())},a=()=>{l.remove(),n!=null&&n.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},l=FD(s.signal,o),c=ma();return this._deferreds.set(e,c),this._controllers.set(e,s),c.promise.then(a,a),this._queue.push(e),this._scheduleNext(),c.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){var i;const e=this._queue.popLast();return e&&((i=this._deferreds.get(e))==null||i.reject(Ui("Removed from queue")),this._removeItem(e)),e}reset(){const e=[];this._processingItems.forEach(i=>e.push(i)),this._processingItems.clear();for(const i of e)this._queue.push(i.item),i.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=k2(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(i))}_processError(e,i){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(i))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(e==null)return;let i;const r=new AbortController,s=new H3t(e,r);this._processingItems.set(e,s);try{i=this.process(e,r.signal)}catch(n){this._processError(s,n)}Zu(i)?(s.promise=i,i.then(n=>this._processResult(s,n),n=>this._processError(s,n))):this._processResult(s,i)}get test(){}};function W3t(t,e){return t.length=0,e.forEach(i=>t.push(i)),t}const I7=new Set,I5=[],nC=new Map,Zve=[0,0];let wx=class extends Ue{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:i,strategy:r}=this;this._queue=new q3t({concurrency:e,process:(s,n)=>{const o=this._keyToItem.get(s);return i(o,{signal:n})},peeker:r==="scale-first"?s=>this._peekByScaleFirst(s):s=>this._peekByCenterFirst(s)})}destroy(){this.clear(),this._queue=He(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}abort(e){const i=typeof e=="string"?e:e.id;this._queue.abort(i)}clear(){this._queue.clear(),this._keyToItem.clear()}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const i=typeof e=="string"?e:e.id;return this.has(i)&&this._queue.isOngoing(i)}pause(){this._queue.pause()}push(e){const i=e.key.id;if(this._queue.has(i))return this._queue.get(i);const r=this._queue.push(i),s=()=>{this._keyToItem.delete(i)};return this._keyToItem.set(i,e),r.then(s,s),r}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView;let r=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;e.forEach(u=>{const d=this._keyToItem.get(u),f=this.tileInfoView.getTileScale(d.key);nC.has(f)||(nC.set(f,[]),r=Math.max(f,r),s=Math.min(f,s)),nC.get(f).push(d.key),I7.add(f)});let n=this.state.scale;nC.has(n)||(W3t(I5,I7),I5.sort((u,d)=>u-d),n=I5.reduce((u,d)=>Math.abs(d-n)<Math.abs(u-n)?d:u,I5[0])),n=Math.min(n,r),n=Math.max(n,s);const o=nC.get(n),a=i.getClosestInfoForScale(n),l=a.getColumnForX(this.state.center[0]),c=a.getRowForY(this.state.center[1]);return o.sort((u,d)=>{const f=a.denormalizeCol(u.col,u.world),m=a.denormalizeCol(d.col,d.world);return Math.sqrt((l-f)*(l-f)+(c-u.row)*(c-u.row))-Math.sqrt((l-m)*(l-m)+(c-d.row)*(c-d.row))}),I7.clear(),nC.clear(),o[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const i=this.tileInfoView,r=this.state.center;let s,n=Number.POSITIVE_INFINITY;return e.forEach(o=>{const a=this._keyToItem.get(o);i.getTileCoords(Zve,a.key);const l=Kb(Zve,r);l<n&&(n=l,s=a.key)}),s.id}};h([p({constructOnly:!0})],wx.prototype,"concurrency",void 0),h([p({constructOnly:!0})],wx.prototype,"process",void 0),h([p()],wx.prototype,"state",void 0),h([p({constructOnly:!0})],wx.prototype,"strategy",void 0),h([p({constructOnly:!0})],wx.prototype,"tileInfoView",void 0),wx=h([I("esri.views.2d.tiling.TileQueue")],wx);new F_(0,0,0,0);let Z3t=class{constructor(e,i){this.sourceTile=i,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},Y3t=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function Yve(t,e,i,r,s,n){const o=i-s;if(o>=0)return(e>>o)+(r-(n<<o))*(t>>o);const a=-o;return e-(n-(r<<a))*(t>>a)<<a}let RUe=class{constructor(e,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(e/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(e,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(e,i,r,s){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function X3t(t,e,i,r,s,n,o){const a=e[r++];for(let l=0;l<a;l++){const c=new Z3t(n,o);c.xTile=e[r++],c.yTile=e[r++],c.hash=e[r++],c.priority=e[r++],c.featureIndex=e[r++];const u=e[r++];for(let m=0;m<u;m++){const g=e[r++],y=e[r++],v=e[r++],b=e[r++],w=!!e[r++],x=e[r++],T=i[r++],E=i[r++],M=e[r++],O=e[r++];c.colliders.push({xTile:g,yTile:y,dxPixels:v,dyPixels:b,hard:w,partIndex:x,width:M,height:O,minLod:T,maxLod:E})}const d=t[r++];for(let m=0;m<d;m++)c.textVertexRanges.push([t[r++],t[r++]]);const f=t[r++];for(let m=0;m<f;m++)c.iconVertexRanges.push([t[r++],t[r++]]);s.push(c)}return r}function J3t(t,e,i){for(const[r,s]of t.symbols)Q3t(t,e,i,s,r)}function Q3t(t,e,i,r,s){const n=t.layerData.get(s);if(n.type===Mu.SYMBOL){for(const o of r){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0];c.startOpacity;const u=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&u===0;const d=u?255:0;l=d<<24|d<<16|d<<8|d}else l=0;for(const[c,u]of o.iconVertexRanges)for(let d=c;d<c+u;d+=4)n.iconOpacity[d/4]=l;if(o.selectedForRendering){const c=a.parts[1];c.startOpacity;const u=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&u===0;const d=u?255:0;l=d<<24|d<<16|d<<8|d}else l=0;for(const[c,u]of o.textVertexRanges)for(let d=c;d<c+u;d+=4)n.textOpacity[d/4]=l}n.lastOpacityUpdate=e,n.opacityChanged=!0}}function K3t(t,e,i,r){const s=t.colliders;let n,o,a,l;for(const c of s)if(t.unique.show&&t.unique.parts[c.partIndex].show&&(n=c.xScreen-r[0]+c.dxScreen,o=c.yScreen-r[1]+c.dyScreen,a=n+c.width,l=o+c.height,_Et(i,e.x,e.y,n,o,a,l)))return!0;return!1}let D8=class{constructor(e,i){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let r=1;const s=new Uint32Array(e);this.layerUIDs=[];const n=s[r++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},eLt=class extends D8{constructor(e,i){super(e,i),this.type=Mu.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.lineIndexStart=r[s++],this.lineIndexCount=r[s++];const n=r[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=r[s++],l=r[s++],c=r[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){var e,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((i=this.vao)==null?void 0:i.usedMemory)??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=Ut(this.vao)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++],a=Cr.createVertex(e,hr.STATIC_DRAW,new Int32Array(n.buffer,4*r,o));r+=o;const l=s[r++],c=Cr.createIndex(e,hr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l));r+=l;const u=this.layer.lineMaterial;this.vao=new pm(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}},tLt=class extends D8{constructor(e,i){super(e,i),this.type=Mu.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.fillIndexStart=r[s++],this.fillIndexCount=r[s++],this.outlineIndexStart=r[s++],this.outlineIndexCount=r[s++];const n=r[s++];if(n>0){this.patternMap=new Map;for(let o=0;o<n;o++){const a=r[s++],l=r[s++],c=r[s++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=s}get memoryUsed(){var e,i,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((i=this.fillVAO)==null?void 0:i.usedMemory)??0)+(((r=this.outlineVAO)==null?void 0:r.usedMemory)??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=Ut(this.fillVAO),this.outlineVAO=Ut(this.outlineVAO)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++],a=Cr.createVertex(e,hr.STATIC_DRAW,new Int32Array(n.buffer,4*r,o));r+=o;const l=s[r++],c=Cr.createIndex(e,hr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l));r+=l;const u=s[r++],d=Cr.createVertex(e,hr.STATIC_DRAW,new Int32Array(n.buffer,4*r,u));r+=u;const f=s[r++],m=Cr.createIndex(e,hr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,f));r+=f;const g=this.layer,y=g.fillMaterial,v=g.outlineMaterial;this.fillVAO=new pm(e,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:a},c),this.outlineVAO=new pm(e,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:d},m)}},iLt=class extends D8{constructor(e,i,r){super(e,i),this.type=Mu.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(e),n=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++],c=s[a++],u=s[a++],d=new F_(l,c,u,0),f=s[a++];for(let v=0;v<f;v++){const b=s[a++],w=s[a++],x=s[a++];this.iconPerPageElementsMap.set(b,[w,x])}const m=s[a++];for(let v=0;v<m;v++){const b=s[a++],w=s[a++],x=s[a++];this.glyphPerPageElementsMap.set(b,[w,x])}const g=s[a++],y=s[a++];this.iconOpacity=new Int32Array(g),this.textOpacity=new Int32Array(y),a=X3t(s,n,o,a,this.symbols,r,d),this.bufferDataOffset=a}get memoryUsed(){var e,i,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((i=this.iconVAO)==null?void 0:i.usedMemory)??0)+(((r=this.textVAO)==null?void 0:r.usedMemory)??0)+Db(this.iconOpacity)+Db(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[i,r]of this.iconPerPageElementsMap)e+=r[1];for(const[i,r]of this.glyphPerPageElementsMap)e+=r[1];return e/3}doDestroy(){this.iconVAO=Ut(this.iconVAO),this.textVAO=Ut(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,i=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===i.usedMemory&&i.setSubData(e,0,0,e.length);const r=this.textOpacity,s=this.textVAO.vertexBuffers.opacity;r.length>0&&r.byteLength===s.usedMemory&&s.setSubData(r,0,0,r.length)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++],a=Cr.createVertex(e,hr.STATIC_DRAW,new Int32Array(n.buffer,4*r,o));r+=o;const l=s[r++],c=Cr.createIndex(e,hr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l));r+=l;const u=s[r++],d=Cr.createVertex(e,hr.STATIC_DRAW,new Int32Array(n.buffer,4*r,u));r+=u;const f=s[r++],m=Cr.createIndex(e,hr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,f));r+=f;const g=Cr.createVertex(e,hr.STATIC_DRAW,this.iconOpacity.buffer),y=Cr.createVertex(e,hr.STATIC_DRAW,this.textOpacity.buffer),v=this.layer,b=v.iconMaterial,w=v.textMaterial;this.iconVAO=new pm(e,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:a,opacity:g},c),this.textVAO=new pm(e,w.getAttributeLocations(),w.getLayoutInfo(),{geometry:d,opacity:y},m)}},rLt=class extends D8{constructor(e,i){super(e,i),this.type=Mu.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(e);let s=this.bufferDataOffset;this.circleIndexStart=r[s++],this.circleIndexCount=r[s++],this.bufferDataOffset=s}get memoryUsed(){var e,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((i=this.vao)==null?void 0:i.usedMemory)??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=Ut(this.vao)}doPrepareForRendering(e,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++],a=Cr.createVertex(e,hr.STATIC_DRAW,new Int32Array(n.buffer,4*r,o));r+=o;const l=s[r++],c=Cr.createIndex(e,hr.STATIC_DRAW,new Uint32Array(s.buffer,4*r,l));r+=l;const u=this.layer.circleMaterial;this.vao=new pm(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}};const Zci=!0,sLt=32,Mee=200;let nLt=class extends Ls{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){var r;if(this._stage===e)return;const i=this._stage;this._stage=e,e?(r=this._stage)!=null&&r.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i==null||i.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=ma(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=ma(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var e,i;(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,(i=this._fadeOutResolver)==null||i.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale),this.setTransform(e.state)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,i){const r=ue("mapview-transitions-duration")===0?0:1/ue("mapview-transitions-duration");if(this.fadeTransitionEnabled&&r!==0){const s=this._fadeOutResolver||!this.visible?0:this.opacity,n=this.computedOpacity;if(n===s)this.computedVisible=this.visible;else{const o=e*r;this.computedOpacity=n>s?Math.max(s,n-o):Math.min(s,n+o),this.computedVisible=this.computedOpacity>0;const a=s===this.computedOpacity;this.inFadeTransition=!a,a||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},IUe=class extends nLt{constructor(e,i,r,s,n,o,a=n,l=o){super(),this.tileDebugInfoTexture=null,this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}},this._destroyed=!1,this.key=new F_(e),this.resolution=i,this.x=r,this.y=s,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null),this._destroyed=!0}get debugSlot(){let e=this;for(;e.parent!==this._stage;){if(!e.parent)return 0;e=e.parent}return this._stage.children.indexOf(e)}setTransform(e){const i=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*i,a=this.height/this.rangeY*i;ene(r,o,0,0,0,a,0,s,n,1),AP(this.transforms.displayViewScreenMat3,e.displayViewMat3,r)}get destroyed(){return this._destroyed}},Jci=class LUe extends IUe{constructor(e,i,r,s,n,o,a,l=null){super(e,i,r,s,n,o,4096,4096),this.styleRepository=a,this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this.featureIndex=null,this.triangleCount=0,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<Mee}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<Mee)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(e){var r,s;let i=!1;for(const n of e){const o=this.layerData.get(n);o&&(this._memoryUsedByLayerData-=o.memoryUsed,o.type===Mu.SYMBOL&&this.symbols.delete(n)&&(i=!0),o.destroy(),this.layerData.delete(n))}(r=this._memCache)==null||r.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&((s=this.featureIndex)==null||s.clear(),this.emit("symbols-changed")),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}dispose(){this.status!=="unloaded"&&(this.featureIndex=null,DUe.delete(this),LUe._destroyRenderBuckets(this.layerData),this.layerData.clear(),this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get usedMemory(){return this._memoryUsedByLayerData+256}changeDataImpl(e){var r,s;(r=this.featureIndex)==null||r.clear();let i=!1;if(e){const{bucketsWithData:n,emptyBuckets:o}=e,a=this._createRenderBuckets(n);if(o&&o.byteLength>0){const l=new Uint32Array(o);for(const c of l)this._deleteLayerData(c)}for(const[l,c]of a)this._deleteLayerData(l),c.type===Mu.SYMBOL&&(this.symbols.set(l,c.symbols),i=!0),this._memoryUsedByLayerData+=c.memoryUsed,this.layerData.set(l,c);(s=this._memCache)==null||s.updateSize(this.key.id,this,this.usedMemory)}this._hasSymbolBuckets=!1;for(const[n,o]of this.layerData)o.type===Mu.SYMBOL&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const i=this.resolution/(e.resolution*e.pixelRatio),r=this.width/this.rangeX*i,s=this.height/this.rangeY*i,n=[0,0];e.toScreen(n,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;l6(o),PP(o,o,n),c6(o,o,Math.PI*e.rotation/180),iN(o,o,[r,s,1])}_createTransforms(){return{displayViewScreenMat3:qS(),tileMat3:qS(),tileUnitsToPixels:qS()}}static _destroyRenderBuckets(e){if(!e)return;const i=new Set;for(const r of e.values())i.has(r)||(r.destroy(),i.add(r));e.clear()}_createRenderBuckets(e){const i=new Map,r=new Map;for(const s of e){const n=this._deserializeBucket(s,r);for(const o of n.layerUIDs)i.set(o,n)}return i}_deserializeBucket(e,i){let r=i.get(e);if(r)return r;switch(new Uint32Array(e)[0]){case Mu.FILL:r=new tLt(e,this.styleRepository);break;case Mu.LINE:r=new eLt(e,this.styleRepository);break;case Mu.SYMBOL:r=new iLt(e,this.styleRepository,this);break;case Mu.CIRCLE:r=new rLt(e,this.styleRepository)}return i.set(e,r),r}_deleteLayerData(e){if(!this.layerData.has(e))return;const i=this.layerData.get(e);this._memoryUsedByLayerData-=i.memoryUsed,i.destroy(),this.layerData.delete(e)}};const DUe=new Map;function oLt(){DUe.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(i=>console.log(i)),console.log("========"),t[1].forEach(i=>console.log(i))})}let aLt=class{constructor(e="scene"){this.context=e,this.extent=Kh()}};const Kci={value:.5,readOnly:!0},lLt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let nA=class{constructor(e=0,i=0){this.min=e,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},cLt=class{constructor(e,i){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(i[2]-i[0]),this.dy=(e.width-1)/(i[3]-i[1]),this.x0=i[0],this.y1=i[3]}},uLt=class{constructor(e,i,r){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=i,this.samplerData=new cLt(r,i)}computeMinMaxValue(e,i,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=e-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.data.width,u=this.samplerData.data.values,d=.5*une;let f=(c-1)/o,m=(r-this.j*o)*f,g=(i-this.i*o)*f;if(f<1){const y=Math.floor(m),v=Math.floor(g),b=y+v*c,w=u[b],x=u[b+1],T=u[b+c],E=u[b+c+1];if(w+x+T+E<d){const M=m-y,O=g-v,D=$F(w,x,T,E,M,O),U=$F(w,x,T,E,M+f,O),k=$F(w,x,T,E,M,O+f),H=$F(w,x,T,E,M+f,O+f);return s.min=Math.min(D,U,k,H),s.max=Math.max(D,U,k,H),s}m=y,g=v,f=1}else m=Math.floor(m),g=Math.floor(g),f=Math.ceil(f);for(let y=m;y<=m+f;y++)for(let v=g;v<=g+f;v++){const b=u[y+v*c];b<d?(a=Math.min(a,b),l=Math.max(l,b)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}};const hLt=.5*une;function Ps(t,e,i){if(i==null)return null;for(const r of i){if(!r)continue;const s=r.safeWidth;let n=Ne(r.dy*(r.y1-e),0,s),o=Ne(r.dx*(t-r.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=r.data.width,u=a*c+l,d=r.data.values,f=d[u],m=d[u+1],g=u+c,y=d[g],v=d[g+1];if(f+y+m+v<hLt){n-=a,o-=l;const b=f+(m-f)*o;return b+(y+(v-y)*o-b)*n}}return null}var Ot;(function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"})(Ot||(Ot={}));function NUe(t){return fle(t)||U2(t)||V2(t)}function fle(t){return C_(t)||oP(t)}const oC=C(),dLt=C(),o0=C(),a0=C();function pLt(t,e,i=0){const r=t.extent;if(r==null)return!1;if(i===0)return vMe(r,e);const s=Math.min(r[2]-r[0],r[3]-r[1]);return uQe(r,e,i*s)}function L5(t,e,i,r){ve(oC,i),oC[r]=e[r];const s=$e(oC,oC,e),n=$e(dLt,t,e),o=Te(n,s),a=Te(s,s);let l;l=o<=0?e:a<=o?i:Ee(oC,e,de(s,s,o/a));const c=$e(oC,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function fLt(t,e,i){const r=t.extent;if(r==null)return 0;o0[0]=r[0],o0[1]=r[1],o0[2]=i,a0[0]=r[2],a0[1]=r[3],a0[2]=i;let s=1/0,n=1/0;return e[0]<o0[0]?s=L5(e,o0,a0,0):e[0]>a0[0]&&(s=L5(e,a0,o0,0)),e[1]<o0[1]?n=L5(e,o0,a0,1):e[1]>a0[1]&&(n=L5(e,a0,o0,1)),Math.min(s,n)}function mLt(t,e,i,r){if(t==null)return cne();const s=t.spatialReference;if(s.isGeographic&&!fle(s))return new B("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const n=$u.checkUnsupported(t);return n??(i==null?new B("tilingscheme:extent-not-exist","The layer does not provide a layer extent."):gLt(t,i)||(e==null||s.equals(e)||e.isWGS84&&s.isWebMercator?null:new B("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")))}function gLt(t,e){const i=t.lods,r=i[0].resolution*2**i[0].level,s=[r*t.size[0],r*t.size[1]],n=[t.origin.x,t.origin.y],o=_Me(e),a=oi();$u.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>kM){const c=i[0].scale*2**i[0].level;let u=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/r;const d=Math.floor(Math.log(u)/Math.log(10));return u=Math.ceil(u/10**d)*10**d,new B("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+u.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:u,requiredNumRootTiles:l,allowedNumRootTiles:kM})}return null}const yLt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:mLt,isInsideExtent:pLt,tiltToExtentEdge:fLt},Symbol.toStringTag,{value:"Module"}));function _Lt(){return!0}function vLt(){return 0}function bLt(t,e,i,r){if(t==null)return cne();const s=(t==null?void 0:t.lods.length)-1,n=t.spatialReference;if(n.isWebMercator){if(!$u.makeWebMercatorAuxiliarySphere(s).compatibleWith(t,r))return new B("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!NUe(n))return new B("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!$u.makeGCSWithTileSize(t.spatialReference,t.size[0],s).compatibleWith(t,r))return t.spatialReference.isWGS84?new B("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new B("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?null:new B("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const wLt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:bLt,isInsideExtent:_Lt,tiltToExtentEdge:vLt},Symbol.toStringTag,{value:"Module"})),xLt={[Je.Global]:wLt,[Je.Local]:yLt};function Bn(t,e){t||console.warn("Terrain: "+e)}let fo=!1,Aj=!1;function TLt(t){Aj=t,fo=fo||t}function SLt(t){fo=t}function Xe(t,e){var i;if(fo&&!t){const r=(i=new Error().stack)==null?void 0:i.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+r),new Error("Assertion failed"+(e?": "+e:""))}}function Aee(t){return mle(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function Pj(t){return(t==null?void 0:t.type)==="imagery-tile"||(t==null?void 0:t.type)==="wcs"}function mle(t){return(t==null?void 0:t.type)==="imagery-tile-3d"}function FUe(t){return(t==null?void 0:t.type)==="tile-3d"}function tO(t){return(t==null?void 0:t.type)==="vector-tile-3d"}function kUe(t){return(t==null?void 0:t.type)==="wmts-3d"}function Pee(t){return(t==null?void 0:t.type)==="elevation-3d"}function K$(t){return(t==null?void 0:t.type)==="group"}function xD(t){return t&&(FUe(t)||kUe(t)||mle(t)||tO(t))}function Oee(t){return t&&(FUe(t)||mle(t)||tO(t)||kUe(t))}function $ee(t){return Oee(t)||Pee(t)}function ELt(t){var e;return EUe((e=t==null?void 0:t.sourceLayerInfo)==null?void 0:e.data)}function CLt(t){return UUe(t==null?void 0:t.sourceLayerInfo)||!!(t!=null&&t.isVTLBackground)}function MLt(t){var e;return CUe((e=t==null?void 0:t.sourceLayerInfo)==null?void 0:e.data)}function ALt(t){var i;const e=(i=t==null?void 0:t.sourceLayerInfo)==null?void 0:i.data;return L8(e)||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData}function UUe(t){return nM(t==null?void 0:t.data)}function qA(t){return t!=null&&"release"in t&&t.release(),null}function rui(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function gle(t,e,i,r,s){return xLt[r].checkIfTileInfoSupportedForViewSR(t,i,e,s)}function N8(t,e,i){var o;let r=null,s=null;if((t==null?void 0:t.type)==="wmts"){const a=PLt(t,e,i);r=a.tileInfo,s=a.fullExtent}else{s=Pj(t)?t.getCompatibleFullExtent(e):t.fullExtent;const a=i===Je.Local;Pj(t)?r=t.getCompatibleTileInfo(e,s,a):(t==null?void 0:t.type)==="vector-tile"?r=a&&!OLt(e)||$Lt.force512VTL?t.tileInfo:t.tileInfo.getCompatibleForVTL(256):r=t.tileInfo}const n="tilemapCache"in t?(o=t.tilemapCache)==null?void 0:o.effectiveMaxLOD:void 0;return r!=null&&s!=null&&gle(r,s,e,i,n)==null?{tileInfo:r,fullExtent:s}:null}function PLt(t,e,i){const r=gXe(t);if(r!=null){if(!Ke.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const s=r.find(n=>gle(n.tileInfo,n.fullExtent,e,i)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function OLt(t){return t.isWGS84||t.isWebMercator||oP(t)||!r2(t)}const $Lt={force512VTL:!1};function Xve(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function l0(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function Qd(t,e,i=LLt){return Math.abs(t-e)<i}function Oj(t){return t===Ot.NORTH_EAST?Ot.SOUTH_WEST:t===Ot.NORTH_WEST?Ot.SOUTH_EAST:t===Ot.SOUTH_WEST?Ot.NORTH_EAST:Ot.NORTH_WEST}function yle(t){return t===Ot.NORTH?Ot.SOUTH:t===Ot.EAST?Ot.WEST:t===Ot.SOUTH?Ot.NORTH:Ot.EAST}function RLt(t){return t===Ot.NORTH_WEST||t===Ot.SOUTH_WEST}function ILt(t){return t===Ot.NORTH_WEST||t===Ot.NORTH_EAST}function Jve(t){return t===Ot.NORTH_WEST||t===Ot.WEST||t===Ot.SOUTH_WEST}function Qve(t){return t===Ot.NORTH_EAST||t===Ot.EAST||t===Ot.SOUTH_EAST}function Kve(t){return t===Ot.SOUTH_EAST||t===Ot.SOUTH||t===Ot.SOUTH_WEST}function e1e(t){return t===Ot.NORTH_EAST||t===Ot.NORTH||t===Ot.NORTH_WEST}const Xf=[Ot.NORTH,Ot.EAST,Ot.SOUTH,Ot.WEST],$j=[Ot.NORTH_EAST,Ot.SOUTH_EAST,Ot.SOUTH_WEST,Ot.NORTH_WEST],LLt=1e-5;let Fd=class extends Ue{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(i=>{const r=i.layer;if("operationalLayerType"in r&&mXe(r.operationalLayerType)&&this.viewSpatialReference!=null){const s=VUe(r.fullExtent,this.viewSpatialReference);s!=null&&e.push(_Me(s))}}),e}};function DLt(t,e){return t===Je.Global?new Ree(e):new Iee(e)}h([p({readOnly:!0})],Fd.prototype,"layerViewsExtent",null),h([p({readOnly:!0})],Fd.prototype,"tiledLayersExtent",null),h([p({readOnly:!0})],Fd.prototype,"stencilEnabledExtents",null),h([p()],Fd.prototype,"viewSpatialReference",void 0),h([p()],Fd.prototype,"tilingScheme",void 0),h([p()],Fd.prototype,"defaultTiledLayersExtent",void 0),h([p({constructOnly:!0})],Fd.prototype,"layers",void 0),h([p({constructOnly:!0})],Fd.prototype,"layerViews",void 0),Fd=h([I("esri.views.3d.terrain.ExtentHelper")],Fd);let Ree=class extends Fd{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?l$e:Mot}};Ree=h([I("esri.views.3d.terrain.ExtentHelper.ExtentHelperGlobal")],Ree);let Iee=class extends Fd{_computeLayerViewsExtent(){const e=Kh(),i=this.viewSpatialReference;this.layerViews.forEach(n=>{const o=n.layer;if(n.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=VUe("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,i);vb(e,a,e)}});const r=dY(e)?e:null,s=this._get("layerViewsExtent");return PS(r,s)?s:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const i=this.viewSpatialReference,r=Kh();this.layers.forEach(o=>{var a;if(o.loaded&&x3(o)){const l=N8(o,i,Je.Local);if(l==null)return;const{tileInfo:c,fullExtent:u}=l,d="tilemapCache"in o?(a=o.tilemapCache)==null?void 0:a.effectiveMaxLOD:void 0;c!=null&&u!=null&&(Pj(o)||e.compatibleWith(c,d)&&u.spatialReference.equals(e.spatialReference))&&vb(r,u,r)}}),vb(r,this.defaultTiledLayersExtent,r);const s=dY(r)?r:null,n=this._get("tiledLayersExtent");return PS(s,n)?n:s}};function VUe(t,e){return t==null||t.spatialReference.equals(e)?t:C3(t,t.spatialReference,e)}Iee=h([I("esri.views.3d.terrain.ExtentHelper.ExtentHelperLocal")],Iee);function zUe(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const i=Object.keys(t);for(const r of i)r.includes(".glsl")&&delete t[r]}}const BUe=1.3,NLt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let Bv,Oc=class extends Ue{constructor(e){super(e),this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=ue("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){const e=this.view;this.renderer=new Ad({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),e._stage.renderer.plugins.add(this.renderer);const i=()=>this.setDrawTexturesDirty();this._groundIntersector=gp(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([te(()=>this.renderer.hasHighlights,i),this.renderer.events.on("has-water",r=>{var s;return(s=e._stage)==null?void 0:s.renderer.setParameters({hasOverlayWater:r})}),this.renderer.events.on("content-changed",i),te(()=>e.state.camera.pixelRatio,i),te(()=>e.state.alignPixelEnabled,i),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),te(()=>{var r,s,n;return[(r=e.pointsOfInterest)==null?void 0:r.renderPointOfView,(n=(s=e.pointsOfInterest)==null?void 0:s.centerOnSurfaceFrequent)==null?void 0:n.location]},()=>this.setPlacementDirty()),te(()=>{var r,s;return[(r=e.state)==null?void 0:r.pixelRatio,(s=e.state)==null?void 0:s.contentPixelRatio]},()=>this.setPlacementDirty(),lr),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(It.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",r=>{this._updateOverlays(Nu,r.camera,cr.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlays(cr.BACKGROUND,r)})]),e._stage.renderer.renderOverlay=r=>this._renderOverlay(r)}destroy(){var e;(e=this.view)!=null&&e._stage&&(this.view._stage.renderer.plugins.remove(this.renderer),this.view._stage.renderer.renderOverlay=()=>{}),Bv&&(Bv.hide(),Bv=null),this.renderer=He(this.renderer)}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||kr.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?br(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return BUe/this.view.resolutionScale}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccludedDraped(){return this.renderer.rendersOccludedDraped}_renderOverlay(e){if(this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays)return this._dispatchAnimationUpdate(e),this._drawOverlays(cr.UPDATE,this.view.state)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const i=this.view.renderSpatialReference;e!=null&&i!=null?(this._renderSR=i,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new zb(-20037508342787e-6,20037508342787e-6):new zb(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}registerDrapeSource(e,i,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this.renderer.createDrapeSourceRenderer(e,i,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),s}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,vh)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,cr.UPDATE)}_updateOverlays(e,i,r){if(!this._spatialReference)return pa;const s=this._computeOverlayResolution(i);this._computeOverlayExtents(i,s,Vm),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,Vm.stretch);const n=this._updateOverlay(In.INNER,Vm.inner,s,1*Vm.pixelRatioAdjustment,Vm.mapUnitsPerPixel),o=fl(Vm.inner)/fl(Vm.outer),a=this._updateOverlay(In.OUTER,Vm.outer,s,o*Vm.pixelRatioAdjustment,Vm.mapUnitsPerPixel);n!==xg.EXTENT&&a!==xg.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(r)),n===xg.NONE&&a===xg.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const i=this.view.state.contentPixelRatio*this.view.resolutionScale,r=e.fullWidth/e.pixelRatio*i,s=e.fullHeight/e.pixelRatio*i,n=Math.ceil(1.5*Math.max(r,s));return Math.min(Sb(n),this._maxResolution)}_updateOverlay(e,i,r,s,n){if(this.renderer.overlays.length===0)return xg.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=n,o.pixelRatio=s,FLt(i,o.extent)&&r===o.resolution)return a===n?xg.NONE:xg.RERENDER_ONLY;A_(o.extent,i),o.resolution=r;const l=fse(o.extent);return o.renderLocalOrigin=nj(l[0],l[1],0,"OV_"+this._latestOriginId++),xg.EXTENT}setTileParameters(e){const i=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[In.INNER],s=this.renderer.overlays[In.OUTER],n=e.extent;this._rectInsideRect(r.extent,n)||this._rectanglesOverlap(n,r.extent)||this._rectanglesOverlap(n,s.extent)?(this._setTileOverlayData(n,In.INNER,i),this._setTileOverlayData(n,In.OUTER,i)):(this._clearTileOverlayData(In.INNER,i),this._clearTileOverlayData(In.OUTER,i))}else this._clearTileOverlayData(In.INNER,i),this._clearTileOverlayData(In.OUTER,i)}overlayPixelSizeInMapUnits(e,i){if(this.renderer.overlays.length===0)return i();const r=this.renderer.overlays[In.INNER],s=this.renderer.overlays[In.OUTER],n=this._pointIsInExtent(e,r.extent)?r:s;return(n.extent[2]-n.extent[0])/n.resolution}_setTileOverlayData(e,i,r){if(this.renderer.overlays.length===0)return;const s=this.renderer.overlays[i].extent,n=fl(s),o=Hc(s);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(s[0],a);const l=this._longitudeCyclical.minimalMonotonic(s[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}r.setScale(i,fl(e)/n,Hc(e)/o),r.setOffset(i,(a-s[0])/n,(e[1]-s[1])/o)}_clearTileOverlayData(e,i){i.setScale(e,-1,-1),i.setOffset(e,-1,-1)}async reloadShaders(){zUe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(Nu)}_dispatchAnimationUpdate(e){const i=e-this._animationTimeLast;if(i>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const r=i/this.surface.view._stage.renderer.animationTimeDilation,s=new QLe(this.view.state.camera,r,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(s)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,i,r,s){const n=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,zLt,i,r);if(n==null)return!1;const o=n.origin,a=Ee(D5,n.origin,n.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(s)}_findHorizonBasedPointOfInterest(e,i){let r=.5;const s=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=Ne(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+a,e.aboveGround?n-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const u=D5;CO(t6(i6,br(this.view.spatialReference).radius+l),td(e.eye,e.viewForward),u),$e(u,u,e.eye);const d=Bb.normalize(hPe(e.viewForward,u,e.viewRight))/e.fovY+.5,f=d<=0||d>=1?.5:s;r=c?f*d:d+f*(1-d)}else{const u=.5*Math.PI-Math.acos(-e.viewForward[2]),d=Math.tan(u),f=ri(0,d,1,0),m=Vu(f,f,e.projectionMatrix)[1],g=Ne(.5+.5*m,0,1);r=g===1||g===0?.5:c?g*s:1-(1-g)*s}return!!this._intersectGroundFromView(e,.5,r,i)&&IL(i,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,i,r){var U;const s=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=C();this._findHorizonBasedPointOfInterest(e,n)||ve(n,s),kr.OVERLAY_SHOW_CENTER?(Bv==null&&(Bv=new oM(this.view.graphics,"red")),Bv.show(n,this._renderSR)):Bv!=null&&Bv.hide();const o=Math.max(.1,Ar(e.eye,n)),a=iw(this.view.renderCoordsHelper,s,e.eye);this._overlaySREqualsRenderSR||Go(n,this._renderSR,n,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&((U=this._spatialReference)==null?void 0:U.isGeographic),u=c&&this._spatialReference?1/br(this._spatialReference).metersPerDegree:1,d=this.view.state.contentPixelRatio,f=e.perScreenPixelRatio/d*o*u;r.mapUnitsPerPixel=f/this._worldToPCSRatio,r.stretch=this._overlayStretch;let m=i*f/2*r.stretch,g=!1,y=c?90:1/0;this._isSpherical&&l&&this._spatialReference&&(this._spatialReference.isWebMercator?(m/=Math.cos(Uz(n[1])),y=l[3]):(g=!0,m/=br(this._spatialReference).metersPerDegree,y=90),m>=y&&(m=y,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let v=1;g&&(v=1/Math.max(.2,Math.cos(Math.abs(kt(n[1])))),m*v>180&&(v=180/m),r.mapUnitsPerPixel*=v);const b=Math.log(2)/12;m=Math.exp(Math.round(Math.log(m)/b)*b);const w=m*v,x=32,T=.5*i/(x*w),E=.5*i/(x*m);n[0]=Math.round(n[0]*T)/T,n[1]=Math.round(n[1]*E)/E;const M=r.inner;M[0]=n[0]-w,M[1]=n[1]-m,M[2]=n[0]+w,M[3]=n[1]+m,this._isSpherical&&this._shiftExtentToFitBounds(M,1/0,y);const O=r.outer;if(6*w>fl(l))A_(O,l);else if(Math.PI/2-Math.abs(a-Math.PI/2)<=.25*Math.PI)O[0]=M[0]-w,O[1]=M[1]-m,O[2]=M[2]+w,O[3]=M[3]+m;else{Go(e.eye,this._renderSR,D5,this._spatialReference),Ng(xx,n,D5);let k=-Math.atan2(xx[1],xx[0])+.125*Math.PI;k<0&&(k+=2*Math.PI);const H=Math.floor(k/(.25*Math.PI));g2(xx,NLt[H],2*m),xx[0]*=v,xx[2]*=v,Dse(O,M,xx)}if(this._isSpherical)O[0]=this._longitudeCyclical.clamp(O[0]),O[2]=this._longitudeCyclical.clamp(O[2]),O[1]=Math.max(O[1],-y),O[3]=Math.min(O[3],y);else{const k=pY(M,l,ULt),H=pY(O,l,VLt);cde(k,H)&&(O[2]=O[0],O[3]=O[1])}const D=Math.abs(M[2]-M[0])/i;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,D),r.pixelRatioAdjustment=r.mapUnitsPerPixel/D}_drawOverlays(e,i){if(!this.renderer.hasOverlays)return;if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;const r=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;const s=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(),this.renderer.drawOverlays(i),s!==this.renderer.computeValidity()&&this.surface.updateTileOverlayParams(cr.UPDATE),r?(this.surface.requestRender(e),e===cr.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(cr.BACKGROUND),this.renderer}_rectanglesOverlap(e,i){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(i[0],i[2],e[0])||this._longitudeCyclical.contains(i[0],i[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],i[0]))&&!(e[1]>i[3]||e[3]<i[1]):VG(e,i))}_rectInsideRect(e,i){return i!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],i[0])&&this._longitudeCyclical.contains(e[0],e[2],i[2])&&i[1]>e[1]&&i[3]<e[3]:cde(e,i))}_pointIsInExtent(e,i){if(this._longitudeCyclical)return this._longitudeCyclical.contains(i[0],i[2],e.x)&&e.y>=i[1]&&e.y<=i[3];const r=e.x,s=e.y;return r>i[0]&&r<i[2]&&s>i[1]&&s<i[3]}_shiftExtentToFitBounds(e,i,r){let s=0,n=0;e[0]<-i?s=e[0]+i:e[2]>i&&(s=i-e[2]),e[1]<-r?n=e[1]+r:e[3]>r&&(n=r-e[3]),Yz(e,s,n)}get test(){}};function FLt(t,e){const r=kr.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r}h([p()],Oc.prototype,"_spatialReference",void 0),h([p({readOnly:!0})],Oc.prototype,"running",null),h([p()],Oc.prototype,"_placementDirty",void 0),h([p()],Oc.prototype,"_contentUpdated",void 0),h([p()],Oc.prototype,"_isSpherical",null),h([p()],Oc.prototype,"_worldToPCSRatio",null),h([p()],Oc.prototype,"renderer",void 0),h([p({constructOnly:!0})],Oc.prototype,"view",void 0),h([p({constructOnly:!0})],Oc.prototype,"surface",void 0),h([p()],Oc.prototype,"suspended",null),h([p()],Oc.prototype,"updating",null),h([p({type:Boolean})],Oc.prototype,"rendersOccludedDraped",null),Oc=h([I("esri.views.3d.terrain.OverlayManager")],Oc);let kLt=class{constructor(){this.inner=oi(),this.outer=oi(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=BUe}};const xx=ci(),D5=C(),Vm=new kLt,ULt=oi(),VLt=oi(),zLt=mo();var xg;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(xg||(xg={}));let BLt=class{constructor(){this.indices=null,this.indexCount=0,this.edgeIndicesStartIndex=0,this.poleIndicesStartIndex=0,this.vertexAttributes=null,this.edgeVerticesStartIndex=0,this.poleVerticesStartIndex=0,this.maxEdgeVertexCount=0,this.boundingBox=Qr(),this.numVerticesPerSide=0,this.minu=0,this.minv=0,this.maxu=1,this.maxv=1,this.outerEdgesOffsetAndLength=[0,0,0,0,0,0,0,0]}release(){this.vertexAttributes=hi(this.vertexAttributes),this.indices=null}reset(){this.indices=null,this.vertexAttributes=null,Qr(this.boundingBox),this.numVerticesPerSide=0}getEdgeFirstVertexIndex(e){return this.outerEdgesOffsetAndLength[2*e]}getEdgeCount(e){return this.outerEdgesOffsetAndLength[2*e+1]}getEdgeVertexIndex(e,i){return this.getEdgeAttributeIndex(e,i)}getEdgeVertexPosition(e,i,r,s){this._getEdgeVertexRaw(this.getEdgeAttributeIndex(e,s),i),Ee(i,i,r)}getEdgeNormal(e,i,r){const{typedBuffer:s,typedBufferStride:n}=this.vertexAttributes.normalCompressed;dTt(i,s,this.getEdgeAttributeIndex(e,r),n)}setEdgeNormalFromValues(e,i,r,s,n){this._setNormal(this.getEdgeAttributeIndex(e,i),r,s,n)}setEdgeVertexFromValuesRawPositionUV(e,i,r,s,n,o,a){const l=this.getEdgeAttributeIndex(e,i);this.vertexAttributes.position.setValues(l,r,s,n),this._setUV(l,o,a)}setEdgeVertexFromValuesRawPositionUVNormal(e,i,r,s,n,o,a,l,c,u){const d=this.getEdgeAttributeIndex(e,i);this.vertexAttributes.position.setValues(d,r,s,n),this._setUV(d,o,a),this._setNormal(d,l,c,u)}_getEdgeVertexRaw(e,i){this.vertexAttributes.position.getVec(e,i)}_setNormal(e,i,r,s){const{typedBuffer:n,typedBufferStride:o}=this.vertexAttributes.normalCompressed;vp(n,e,i,r,s,o)}_setUV(e,i,r){im(this.vertexAttributes.uv0,e,i,r)}getEdgeAttributeIndex(e,i){return Xe(0<=i&&i<this.getEdgeCount(e)),this.getEdgeFirstVertexIndex(e)+i}};const t1e=16384;function im(t,e,i,r){t.setValues(e,i*t1e,r*t1e)}let jLt=class{constructor(){this.sinLonLUT=new Array(OR+1),this.cosLonLUT=new Array(OR+1),this.sinLatLUT=new Array(OR+1),this.cosLatLUT=new Array(OR+1)}update(e,i,r){const s=i[0],n=i[2];for(let o=0;o<=e;o++){const a=o/e,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=r(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},GLt=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.samplerDataVersion=0,this.clippingArea=null,this.wireframe=!1,this.cornerPeerNeighbors=[null,null,null,null],this.cornerNeighborCornerTiles=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.cornerNeighborCornerTileSamplerVersions=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1]}},jUe=class dV{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=He(this._current),this._next=He(this._next),this._waiting=He(this._waiting),this._delayed=He(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let e=dV.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,Ob.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const i=this._fadeDuration,r=this._current!=null&&this._next.texture===this._current.texture,s=this._next.type!==Cn.FADING,n=e-this._fadeStart>=i;(r||s||n)&&(He(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=dV.test.fadeMoment||performance.now(),i=Math.max(0,e-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return this._next!=null||this._delayed!=null}push(e,i=Ob.Immediate){this._delayed=He(this._delayed),this._push(e,i)}_push(e,i){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const r=dV.test.fadeMoment||performance.now();return i!==Ob.Immediate?(this._delayed=e,void(this._delayedTime=r+i)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(r))):void(e!=null&&(He(this._waiting),this._waiting=e))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const i=this._getFadeDuration();return e+i-e%i}get _isFadingEnabled(){return this._getFadeDuration()>0}};var Ob;jUe.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(Ob||(Ob={}));var iO;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(iO||(iO={}));let GUe=class{constructor(){this._queue=new ai,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var i;const e=(i=this._last)==null?void 0:i.children;return e!=null&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},HLt=class{constructor(){this._q=new ai}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let i=0;i<this._q.length;++i){const r=this._q.data[i];r.isLeaf||this._q.pushArray(r.children)}}}next(){return this._q.pop()}};function aL(t,e,i){if((e==null?void 0:e.fullExtent)==null)return!1;const r=e.fullExtent,s=t.extent;if(i){if(s[0]<r.xmin||s[1]<r.ymin||s[2]>r.xmax||s[3]>r.ymax)return!1}else if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;const n=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&n>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&n<.99999999*a)}function Jg(t,e){const i=t.lij,r=e.lij;return i[0]-r[0]||i[1]-r[1]||i[2]-r[2]}function qLt(t,e,i=null){i==null||i.length===0?t===iO.BACK_TO_FRONT?e.sort(WLt):e.sort(ZLt):e.sort((r,s)=>YLt(r,s,t,i))}function WLt(t,e){const i=e.screenDepth-t.screenDepth;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function ZLt(t,e){const i=t.screenDepth-e.screenDepth;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function HUe(t,e,i){const r=t.screenDepth,s=e.screenDepth;return r<s?-i:r>s?i:Jg(t,e)}function YLt(t,e,i,r){return i1e(t,r)===i1e(e,r)?HUe(t,e,i):t?i:-i}function i1e(t,e){for(const i of e)if(t.intersectsExtent(i))return!0;return!1}function XLt(t,e){const i=t.distanceToPOI-e.distanceToPOI;if(i!==0)return i;const r=t.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function JLt(t,e){const i=t.length;for(let r=0;r<i;++r)t.at(r).updateDistanceToPOI(e);t.sort(XLt)}function QLt(t,e,i){let r=1,s=0,n=0;for(;t!==e;)if(r*=.5,s*=.5,n*=.5,1&t.lij[2]&&(s+=.5),1&t.lij[1]||(n+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(e,s,n,r)}function KLt(t){for(let e=0;e<t.length;e++){const i=t[e],r=i.parent;if(r)for(let s=0;s<4;s++){const n=r.children[s];if(n&&n!==i)return!0}}return!1}function fui(t,e){if(!t||!e||t[0]===e[0])return!1;const i=t[0]<e[0],r=i?t:e,s=i?e:t,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}let _le=class{get updating(){return!!this._tileRequested}init(e,i,r,s){this.tile=e,this._layerIdx=i,this._layerClass=r,this._suspended=s,this._tileLayerInfo=e.getLayerInfo(i,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,i){this._setUpsampleTile(e,i),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,Cn.FADING,i):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(e,i),s=Aee(r),{minLevel:n,maxLevel:o}=r.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?aL:()=>!0;let u=this.tile;const d=u.level;let f;const m=this._tileLayerInfo.upsampleInfo,g=m!=null?m.tile.level:-1,y=m!=null&&g-d>=a,v=s==null?void 0:s.tilemapCache,b=r.type==="vector-tile-3d"?r.schemaHelper:null;for(;u&&c(u,s,!1)&&u.level>=n;){const w=u.level,x=d-w,T=u.layerInfo[i][e];if(T.data&&x>=a){(!y||w>g)&&this._setUpsampleTile(u),T.dataInvalidated&&(f=u);break}const E=(b==null?void 0:b.getLevelRowColumn(u.lij))??u.lij;if((v==null?void 0:v.getAvailability(E[0],E[1],E[2]))!=="unavailable"&&w<=o&&!T.data&&!T.dataMissing&&((!f||u.level===n||w%a$e==0||d-f.level<a)&&(f=u),x>=l))break;u=u.parent}if(f!=null&&d-f.level<a)if(m)f=null;else{const w=this._findAncestorWithData();w!=null&&(this._setUpsampleTile(w),f=w.layerInfo[i][e].dataInvalidated?w:null)}return f}_findAncestorWithData(){const e=this.tile.elevationLevel,i=this._desiredMinLevelDelta;let r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(e-s.level>=i)return s;r=s}return r}_setUpsampleTile(e,i){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,Cn.FADING,i)}get test(){}},eDt=class extends _le{constructor(){super(...arguments),this.type="none"}get _desiredMinLevelDelta(){throw r1e}get _progressiveLevelModulo(){throw r1e}dispose(){}};const r1e=new Error("Abstract method called on TileAgent"),ou=new eDt;let tDt=class extends _le{constructor(){super(...arguments),this.type="elevation",this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return this.tile.elevationLevelDelta-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}};function iDt(t){return t.type==="elevation"}let rDt=class extends _le{constructor(){super(),this.type="map",this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return a$e}};function sDt(t){return t.type==="map"}var cl;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(cl||(cl={}));let pV=class{constructor(){this.waitingAgents=new ai,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const i=L7.acquire();return i._init(e),i}release(){this.dispose(),fV.delete(this),L7.release(this)}dispose(){this.loadingAgent=Ut(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=qA(this._data)}static prune(){L7.prune(0)}_init(e){this.waitingAgents.clear(),this._data=qA(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=oc(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,i){if(e!==i&&i!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile.unrefMapData()}i.refMapData(),QLt(e,i,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){qA(this._data),this._data=e}};const L7=new ga(pV,null,()=>{}),fV=new Map;function nDt(){fV.size>0&&(console.log(`${fV.size} live TilePerLayerInfo allocations:`),fV.forEach(t=>console.log(t,`
`)))}var St;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.GEOMETRY=8]="GEOMETRY",t[t.TEXTURE_NOFADING=16]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=32]="TEXTURE_FADING"})(St||(St={}));const oDt=.1;let vle=class{constructor(){this._lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=oi(),this._elevationBoundsMin=NaN,this._elevationBoundsMax=0,this.layerInfo=[[],[]],this.extentInRadians=oi(),this.centerAtSeaLevel=C(),this._center=[C(),_n(),C()],this.up=nse(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=C(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0}get lij(){return this._lij}get elevationLevelDelta(){return this._surface.getElevationLevelDelta(this.level)}static prune(){ble.prune(0),wle.prune(0),pV.prune()}get _isCached(){return!this.isLeaf&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBoundsMin(){return this._elevationBoundsMin}get elevationBoundsMax(){return this._elevationBoundsMax}get level(){return this._lij[0]}get key(){return`${this._lij[0]}/${this._lij[1]}/${this._lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Sn.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,i=(e==null?void 0:e.frustumVisibility)??cl.INTERSECTS;this._frustumVisibility=i===cl.INSIDE?cl.INSIDE:i===cl.OUTSIDE?cl.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const r=this._frustumVisibility!==cl.OUTSIDE&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}init(e,i,r,s,n){this._lij[0]=e,this._lij[1]=i,this._lij[2]=r,this.ellipsoid=br(n.tilingScheme.spatialReference),n.tilingScheme.getExtent(e,i,r,this.extent),n.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,n.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Sn.MIDDLE][3]=0,this.elevationLevel=e,s&&!Number.isNaN(s.elevationBoundsMin)?(this._elevationBoundsMin=s.elevationBoundsMin,this._elevationBoundsMax=s.elevationBoundsMax):(this._elevationBoundsMin=0,this._elevationBoundsMax=0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=s,this.unsetChildren(),this._surface=n,this.updateVisibility(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0;for(const o of yT){const a=n.numLayers(o),l=this.layerInfo[o];for(const c of l)c.release();l.length=a;for(let c=0;c<a;c++)l[c]=pV.acquire(this._surface.upsampleInfoPool),o===ei.ELEVATION&&this.findElevationBoundsForLayer(c,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(n.tilingScheme.pixelSize,OR)}dispose(){Bn(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of yT){for(const i of this.layerInfo[e])i.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[ei.MAP].reduce((e,{data:i})=>e+(nM(i)?i.usedMemory/i.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){var r;if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=this._baseUsedMemory,this._mapTileMemoryInternal=0;let e=0;for(const{data:s}of this.layerInfo[ei.MAP])nM(s)?e+=this._getTerrainDataMemory(s):this._mapTileMemoryInternal+=this._getTerrainDataMemory(s);const i=this._cpuImageMemorySize;for(const s of this.layerInfo[ei.ELEVATION])this._usedMemory+=s.data?i:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=((r=this.renderData.texture)==null?void 0:r.usedMemory)??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,i){const r=this.layerInfo[e][i];return r!=null&&r.data?e===ei.MAP?this._isCached?0:this._getTerrainDataMemory(r.data):e===ei.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return CUe(e)?e.texture.usedMemory:EUe(e)?e.memoryUsage:nM(e)?e.usedMemory/e.referenced:L8(e)||e instanceof HTMLImageElement?this._cpuImageMemorySize:0}updateScreenDepth(e){const i=this._center[Sn.MIDDLE],r=e,s=i[0],n=i[1],o=i[2],a=r[2]*s+r[6]*n+r[10]*o+r[14];this.screenDepth=a<0?0:a/(r[3]*s+r[7]*n+r[11]*o+r[15])}shouldSplit(e,i,r){if(!this.visible||e.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===cl.OUTSIDE))return St.NONE;const s=this.level;$e(F5,this._center[Sn.MIDDLE],i);let n=pl(F5),o=F5,a=this._center[Sn.MIDDLE];$e(D7,this._center[Sn.TOP],i);const l=pl(D7);l<n&&(n=l,o=D7,a=this._center[Sn.TOP]),$e(N7,this._center[Sn.BOTTOM],i);const c=pl(N7);if(c<n&&(n=c,o=N7,a=this._center[Sn.BOTTOM]),this._edgeLen2>n&&s<e.maxLod)return St.SPLIT;const u=Math.sqrt(n),d=e.fovX*u*2,f=this._edgeLen/d,m=()=>{if(s<e.maxLod)return this.elevationLevel=s,St.NONE;const O=s+Math.ceil(-Math.log2(e.relativeWidthLimit/f));return O!==this.elevationLevel?(this.elevationLevel=O,St.ELEVATION):St.NONE},g=r!=null?r-s:1/0;if(g<=.5)return m();const y=Te(this.up,F5),v=this._elevationBoundsMax-this._elevationBoundsMin,b=v/this.edgeLen;if(e.aboveGround&&y>0&&b<.001&&y/u-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-b>0)return St.NONE;const w=r!=null?3-Math.min(g,2):1;if(f*w<e.relativeWidthLimit||s>=e.maxLod)return m();if(s<7)return St.SPLIT;de(Jo,this.up,y),$e(Jo,Jo,o);const x=pl(Jo);if(x<=this.radius*this.radius)return St.SPLIT;de(Jo,Jo,this.radius/Math.sqrt(x)),Ee(Jo,Jo,a),$e(Jo,i,Jo);const T=Math.min(1,(Math.abs(Te(Jo,this.up))+.5*v+this._curvatureHeight)/Ve(Jo)),E=oDt/e.angledSplitBias,M=e.fovY*u*2;return T*(this._edgeLen/M*w)<E*e.relativeHeightLimit?St.NONE:St.SPLIT}setChildren(e,i,r,s){Bn(!!(e&&i&&r&&s),"Null child passed");const n=this._children;return n[0]=e,n[1]=i,n[2]=r,n[3]=s,n}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of yT)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const i of yT){const r=this.layerInfo[i];for(const s of r)s.loadingAgent&&s.loadingAgent!==ou&&(N5(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(St.GEOMETRY),this.resetPendingUpdate(St.TEXTURE_NOFADING),this.resetPendingUpdate(St.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[ei.MAP];for(const i of e)i.loadingAgent&&i.loadingAgent!==ou&&(N5(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(PS(e,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._isWithinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const s=r&&this._isWithinClippingArea,n=!(r||i||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(St.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,i){return this.layerInfo[i][e]}hasLayerData(e,i){const r=this.layerInfo[i][e];return!(!(r!=null&&r.data)||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of yT){const i=this.layerInfo[e];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==ou&&r.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(St.SPLIT)||e!==ei.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){const i=this._pendingUpdates;return this._pendingUpdates|=e,e===St.SPLIT||e===St.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate(),i!==this._pendingUpdates}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,i,r){const s=this.layerInfo[i][e];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,e),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),r.tile.lij.toString(),i,e);const a=nM(s.data);return r.dataArrived(this,a),!0}if(s.requestPromise)return!0;oc(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,e,i,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this._lij[0]===e[0]&&this._lij[1]===e[1]&&this._lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const i=this._children;return i[0]?i[0].findByLij(e)||i[1].findByLij(e)||i[2].findByLij(e)||i[3].findByLij(e):null}distanceToSquared(e){return pl($e(Jo,this._center[Sn.MIDDLE],e))}containsPoint(e){const i=this.extent;return e[0]>=i[0]&&e[1]>=i[1]&&e[0]<=i[2]&&e[1]<=i[3]}containsPointXY(e,i){const r=this.extent;return e>=r[0]&&i>=r[1]&&e<=r[2]&&i<=r[3]}unrequestLayerData(e,i,r){const s=this.layerInfo[i][e],n=s.waitingAgents,o=n.removeUnordered(r)!=null;Bn(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(e,i,r){const s=nM(r),n=this.layerInfo[i][e];n.data=r,n.dataInvalidated=!1,n.waitingAgents.forAll(o=>o.dataArrived(this,s)),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,i){const r=this.layerInfo[i][e];r.dataMissing=!0,r.waitingAgents.forAll(s=>s.dataMissing()),r.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,i,r){switch(r&&this.forEachLoadedNeighbor(s=>s.updateRenderData(e,i)),e){case ei.MAP:return this._updateTexture(i);case ei.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===Cn.FADING?St.TEXTURE_NOFADING:St.TEXTURE_FADING),this.setPendingUpdate(e===Cn.FADING?St.TEXTURE_FADING:St.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(St.GEOMETRY);for(const e of this.layerInfo[ei.ELEVATION])e.pendingUpdates|=St.GEOMETRY}invalidateLayerData(e,i){this.layerInfo[i][e].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const e=this._elevationBoundsMin,i=this._elevationBoundsMax;let r=1/0,s=-1/0;const n=this.layerInfo[ei.ELEVATION];let o=!0;for(const a of n)a.elevationBounds!=null&&(r=Math.min(r,a.elevationBounds.min),s=Math.max(s,a.elevationBounds.max),a.elevationBounds.hasNoDataValues||(o=!1));o&&(r=Math.min(r,0),s=Math.max(s,0)),e===r&&i===s||(this._elevationBoundsMin=r,this._elevationBoundsMax=s,this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBoundsMin,i=this._elevationBoundsMax,r=.5*(e+i),s=this._center;de(Jo,this.up,r),Ee(s[Sn.MIDDLE],this.centerAtSeaLevel,Jo),de(Jo,this.up,e),Ee(s[Sn.TOP],this.centerAtSeaLevel,Jo),de(Jo,this.up,i),Ee(s[Sn.BOTTOM],this.centerAtSeaLevel,Jo)}findElevationBoundsForLayer(e,i){const r=this.layerInfo[ei.ELEVATION][e],s=this.elevationLevelDelta,n=Math.max(this.elevationLevel-s,0),o=r.elevationBounds;if(o!=null&&o.level>=i&&o.level<=n)return;const a=this._surface.layerViewByIndex(e,ei.ELEVATION),l=Aee(a);if(!aL(this,l,!1))return;const c=lDt;let u=!1;const d=r.data;if(d&&d.level<=n){const f=r.data;c.min=f.samplerData.data.minValue,c.max=f.samplerData.data.maxValue,c.hasNoDataValues=f.samplerData.data.hasNoDataValues,c.level=this.level,u=!0}else{let f,m,g=0;for(let y=this._parent;y&&(!m||g<s)&&(g=this.elevationLevel-y.level,f=m||f,m=y.layerInfo[ei.ELEVATION][e].data,!(!m&&f&&y.level<=n));y=y.parent);m=m||f,m&&(m.computeMinMaxValue(this._lij[0],this._lij[1],this._lij[2],c),c.min!==1/0&&(c.level=m.level,u=!0))}u&&(r.elevationBounds==null&&(r.elevationBounds=new nA),r.elevationBounds.copyFrom(c))}modifyLayers(e,i,r){const s=this.layerInfo[r];for(const a of s)a.loadingAgent&&a.loadingAgent!==ou&&(N5(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)e[a]===void 0&&s[a].release();const n=new Array(...s),o=i.length;s.length=o;for(let a=0;a<o;a++){const l=i[a];s[a]=l>-1?n[l]:pV.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,Cn.FADING))}updateAgents(e){if(this.renderData){const i=this.layerInfo[e];for(const r of i)r.loadingAgent===ou&&(r.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of yT){const i=this._isSuspended(e);for(const r of this.layerInfo[e])r.loadingAgent&&r.loadingAgent!==ou&&(r.loadingAgent.setSuspension(i),r.loadingAgent===ou&&this.updateRenderData(e,Cn.FADING))}}removeLayerAgent(e,i){const r=this.layerInfo[i][e];r.loadingAgent&&r.loadingAgent!==ou&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(e,i){const r=this.layerInfo[i][e];r.loadingAgent=ou,r.data||r.upsampleInfo!=null||this._createOrUpdateAgents(e+1,i)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||uP(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,i,r){var s,n,o;for(let a=e;a<i;++a){const l=this._surface.layerViewByIndex(a,r);if(xD(l)&&((s=l==null?void 0:l.layer)==null?void 0:s.blendMode)!=="normal"||uP((n=l==null?void 0:l.layer)==null?void 0:n.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(e,i){const r=this.layerInfo[i];if(r.length===0)return;const s=this._isSuspended(i);for(let n=e;n<r.length;++n){const o=r[n];let a=!1;const l=this._surface.layerViewByIndex(n,i),c=Aee(l);if(o.loadingAgent?aL(this,c,!1)?(o.loadingAgent!==ou&&o.loadingAgent.setSuspension(s),o.loadingAgent!==ou&&(a=o.loadingAgent.update())):o.dispose():aL(this,c,!1)&&(o.loadingAgent=aDt(this,n,i,s),a=o.loadingAgent.startLoading(),a?o.loadingAgent===ou&&this.setPendingUpdate(St.GEOMETRY):(N5(o.loadingAgent),o.loadingAgent=ou)),o.loadingAgent===ou&&this.updateRenderData(i,Cn.FADING),!this._hasBlendModes(e,r.length,i)&&a&&l.isOpaque)return}}_isWithinExtent(e){const i=this.extent;return i[0]>=e[0]&&e[2]>=i[2]&&i[1]>=e[1]&&e[3]>=i[3]}intersectsExtent(e){const i=this.extent;return i[2]>=e[0]&&e[2]>=i[0]&&i[3]>=e[1]&&e[3]>=i[1]}getElevationVerticesPerSide(e){const i=this.elevationLevel-this.level,r=Math.max(this.level-e,this.elevationLevelDelta-i),s=Ne(1+(this.maxTesselation>>r),2,this.maxTesselation+1),n=this.getDefaultVerticesPerSide();return Math.max(s,n)}_findLIJ(e,i){if(!e)return null;const r=this.surface.rootTiles;if(r!=null){for(const s of r)if(cDt(s,e)){let n=s,o=e[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!i(n);){const a=e[1]>>o&1,l=e[2]>>o&1;n=n.children[2*a+l],o--}return i(n)?n:null}}return null}findNeighborTile(e,i){const r=this._lij,s=this.getNeighborLIJ(r,e);return s?mV(r,s)?i(this)?this:null:this._findLIJ(s,i):null}findCorner(e,i){const r=e===Ot.NORTH_EAST?1:e===Ot.NORTH_WEST?0:e===Ot.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!i||!i(s));)s=s.children[r];return s}findNeighborCornerTileExact(e,i){var r;return((r=this.findNeighborTile(e,s=>i(s)||s.level===this.level))==null?void 0:r.findCorner(Oj(e),i))||null}forAllSubtreeOnSide(e,i){const r=e===Ot.NORTH?[0,1]:e===Ot.NORTH_EAST?[1]:e===Ot.EAST?[1,3]:e===Ot.SOUTH_EAST?[3]:e===Ot.SOUTH?[2,3]:e===Ot.SOUTH_WEST?[2]:e===Ot.WEST?[0,2]:[0],s=n=>{const o=n.children;!i(n)&&o[0]&&r.forEach(a=>s(o[a]))};s(this)}getNeighborEdgeStartVertexIndex(e,i){if(!i)return 0;const r=this.level-i.level;if(Xe(!fo||r>=0),r===0)return 0;const s=2**r,n=!(1&~e),o=n?0:1,a=i.lij[o+1]*s,l=this._lij[o+1],c=l-a,u=n?s-1-c:c;return fo&&(Xe(a<=l&&l<a+s),Xe(0<=u&&u<s)),u}forEachLoadedNeighbor(e){const i=this.level,r=s=>s.level===i||s.isLoaded;Xf.forEach(s=>{const n=this.findNeighborTile(s,r);n!=null&&n!==this&&n.forAllSubtreeOnSide(yle(s),o=>!!o.isLoaded&&(e(o,s),!0))}),$j.forEach(s=>{var o;const n=(o=this.findNeighborTile(s,r))==null?void 0:o.findCorner(Oj(s),a=>a.isLoaded);Xe(!n||Lee(this,n,s)),n!=null&&n.isLoaded&&e(n,s)})}getNeighborLIJ(e,i){const r=e1e(i)?-1:Kve(i)?1:0,s=Jve(i)?-1:Qve(i)?1:0,n=[e[0],e[1]+r,e[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this._lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this._lij[2]===0}get isNorthEnd(){return this._lij[1]===0}get isSouthEnd(){const e=this.surface.extent,i=(e==null?void 0:e[1])??null;return i!=null&&this.extent[1]+Bo()>=i}checkGeometryWaterproofness(){var e;Aj&&(Xe(this.isLoaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const i=this.extent,r=this.surface.rootTilesExtent,s=.25*(i[2]-i[0]);if(e1e(e)&&i[3]+s>=r[3]||Kve(e)&&i[1]-s<=r[1])return!1;const n=this.surface.isGlobal;return!(!n&&Jve(e)&&i[0]-s<=r[0])&&!(!n&&Qve(e)&&i[2]+s>=r[2])}updateDistanceToPOI(e){const i=this._lastPOI;if(this.distanceToPOI>=0&&i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2])return;ve(this._lastPOI,e);const r=this._center[Sn.MIDDLE],s=e[0]-r[0],n=e[1]-r[1],o=e[2]-r[2];this.distanceToPOI=s*s+n*n+o*o}get test(){return{cachedMemory:this._cachedMemory}}};function aDt(t,e,i,r){const s=i===ei.ELEVATION?wle.acquire():ble.acquire();return s.init(t,e,i,r),s}function N5(t){t.dispose(),iDt(t)?wle.release(t):sDt(t)&&ble.release(t)}const ble=new ga(rDt),wle=new ga(tDt),lDt=new nA;var Sn;function cDt(t,e){const i=t.lij,r=e[0]-i[0];return!(r<0)&&e[1]>>r===i[1]&&e[2]>>r===i[2]}function mV(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function uDt(t,e,i){if(t==null||e==null)return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&i===Ot.EAST||t.isWestEnd&&e.isEastEnd&&i===Ot.WEST))return!0;const r=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(i){case Ot.NORTH:return Qd(t.extent[3],e.extent[1],r);case Ot.SOUTH:return Qd(t.extent[1],e.extent[3],r);case Ot.EAST:return Qd(t.extent[2],e.extent[0],r)||Qd(t.extent[2],-e.extent[0],r);case Ot.WEST:return Qd(t.extent[0],e.extent[2],r)||Qd(t.extent[0],-e.extent[2],r)}}function Lee(t,e,i){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?s1e(t,e,i):s1e(e,t,Oj(i)))}function s1e(t,e,i){Xe(t.level>=e.level);const r=RLt(i),s=ILt(i),n=t.extent,o=e.extent,a=[r?n[0]:n[2],s?n[3]:n[1]],l=[r?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),u=Qd(a[0],l[0],c)||t.surface.isGlobal&&Qd(a[0],-l[0],c),d=Qd(a[1],l[1],c);if(u&&d)return!0;if(t.level===e.level||!u&&!d)return Xe(!1),!1;const f=u?n1e(o[1],o[3],n[1],n[3],c):n1e(o[0],o[2],n[0],n[2],c);return Xe(f),f}function n1e(t,e,i,r,s){return t-s<=i&&i<=r&&r<=e+s}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(Sn||(Sn={}));const F5=C(),D7=C(),N7=C(),Jo=C();let hDt=class{constructor(){this._scales=ri(-1,-1,-1,-1),this._offsets=ri(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,i,r){this._scales[2*e]=i,this._scales[2*e+1]=r}setOffset(e,i,r){this._offsets[2*e]=i,this._offsets[2*e+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}};function dDt(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(S`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(S`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(S`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}function xle(t){t.code.add(S`
    float lineFactorAtPosition(float value) {
      float pos = value * ${S.float(257)};
      if(pos < 0.5 || pos > ${S.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}var Qg;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(Qg||(Qg={}));let pDt=class extends lae{constructor(){super(...arguments),this.overlayOpacity=1}};function fDt(t,e){const{vertex:i,fragment:r,varyings:s}=t;s.add("vtc","vec2"),i.uniforms.add(new o1e("texOffsetAndScale")),r.uniforms.add(new a1e("tex")),r.uniforms.add(new F7("textureOpacities"));const n=e.textureFadingEnabled&&!e.renderOccluded;n&&(i.uniforms.add(new o1e("nextTexOffsetAndScale")),s.add("nvtc","vec2"),r.uniforms.add(new a1e("texNext")),r.uniforms.add(new F7("nextTexOpacities")),r.uniforms.add(new mDt("fadeFactor")));const o=e.tileBlendInput===Qg.ColorComposite,a=e.tileBlendInput===Qg.GridComposite;a&&r.include(xle),o&&r.uniforms.add(new F7("backgroundColor")),i.code.add(S`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${n?S`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:S``}
  }`),r.code.add(S`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?S`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?S`backgroundColor`:S`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:S`return color;`}
    }`),n?r.code.add(S`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):r.code.add(S`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let mDt=class extends qs{constructor(e){super(e,"float")}},F7=class extends qs{constructor(e){super(e,"vec3")}},o1e=class extends qs{constructor(e){super(e,"vec4")}},a1e=class extends qs{constructor(e){super(e,"sampler2D")}},Tle=class extends pDt{};function qUe(t){const e=new Hi,{vertex:i,fragment:r,varyings:s}=e;e.include(dN),e.include(FO,t),e.include(Hf,t);const n=()=>{e.include(yD,t),i.code.add(S`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};Wc(i,t),e.include(gl,t);const o=t.overlayMode!==Zg.Disabled,a=o&&t.invisible;switch(t.output){case G.Color:{e.include(fDt,t),e.include(E2,t),o&&e.include(I$,{...t,pbrMode:t.pbrMode===Pt.Simplified?Pt.TerrainWithWater:Pt.Water});const l=t.overlayMode===Zg.EnabledWithWater;l&&e.include(dDt,t),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),n(),t.screenSizePerspective&&VP(i);const c=t.receiveShadows&&!t.renderOccluded;c&&e.include(LO,t),t.screenSizePerspective&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),i.code.add(S`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${l?S`forwardVertexTangent(vnormal);`:S``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?S`setOverlayVTC(uv);`:""}
          ${t.tileBorders?S`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?S`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${c?S`forwardLinearDepth();`:""}

        }
      `),e.include(Mn,t),e.include(E2,t),e.include(CN,t),e.include(YP,t),fm(r,t),MN(r),VO(r),r.uniforms.add(i.uniforms.get("localOrigin"),new Wt("viewDirection",(u,d)=>Ce(l1e,pe(l1e,d.camera.viewMatrix[12],d.camera.viewMatrix[13],d.camera.viewMatrix[14])))),l&&r.uniforms.add(new xt("ovWaterTex",(u,d)=>{var f;return(f=d.overlay)==null?void 0:f.getTexture(os.WaterNormal)}),new KIe("view",(u,d)=>wl(gDt,d.camera.viewMatrix,u.origin))),r.code.add(S`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),q_(r),Ry(r),r.code.add(S`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?S`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?S`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===Pt.Simplified||t.pbrMode===Pt.TerrainWithWater?S`fragColor = vec4(evaluatePBRSimplifiedLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:S`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${l?S`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?S`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?S`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:S`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?S`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case G.Depth:a&&e.include(I$,t),i.code.add(S`
              void main(void) {
                ${a?S`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPosition(proj, view, position);
              }
          `),r.code.add(S`
              void main() {
                ${a?S`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              }
          `);break;case G.Shadow:case G.ShadowHighlight:case G.ShadowExcludeHighlight:case G.ViewshedShadow:e.include(l8,t),bQ(e),$6(e),i.code.add(S`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),r.code.add(S`void main() {
outputDepth(linearDepth);
}`);break;case G.Normal:a&&e.include(I$,t),s.add("vnormal","vec3"),VP(i),n(),i.code.add(S`
        void main(void) {
          ${a?S`setOverlayVTC(getUV0());`:""}
          gl_Position = transformPosition(proj, view, position);
          vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
        }
      `),r.code.add(S`
        void main() {
          ${a?S`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
          vec3 normal = normalize(vnormal);
          if (gl_FrontFacing == false) {
            normal = -normal;
          }
          fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
        }
      `);break;case G.Highlight:o&&e.include(I$,t),i.code.add(S`
          void main() {
            ${o?S`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(Mw,t),r.code.add(S`
          void main() {
            ${o?S`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===G.ObjectAndLayerIdColor&&(o?(e.include(I$,{...t,pbrMode:Pt.Disabled}),i.code.add(S`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),r.code.add(S`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)):(i.code.add(S`void main(void) {
        ${t.opaque?S` gl_Position = transformPosition(proj, view, position);`:""}
      }`),r.code.add(S`void main() {
fragColor = vec4(0.0);
}`))),e}const gDt=ke(),l1e=C(),yDt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:Tle,build:qUe},Symbol.toStringTag,{value:"Module"}));let WUe=class ZUe extends Ki{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,i){i.spherical=e.viewingMode===Je.Global}initializeProgram(e){return new er(e.rctx,ZUe.shader.get().build(this.configuration),YUe)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const i=this.configuration,r=i.backfaceCullingEnabled&&!i.renderOccluded;return Kt({blending:i.renderOccluded?rd(Be.ONE,Be.ONE_MINUS_SRC_ALPHA):null,culling:r?kne:null,depthTest:i.renderOccluded?null:{func:xr.LESS},depthWrite:i.renderOccluded?null:Wu,colorWrite:ui,stencilTest:e?Vvt(Yc.IntegratedMeshMaskExcluded):null,drawBuffers:i.output===G.Depth?{buffers:[ho.NONE]}:null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}};WUe.shader=new qi(yDt,()=>oe(()=>Promise.resolve().then(()=>U9t),void 0));const YUe=new Map([[$.POSITION,0],[$.UV0,1],[$.NORMALCOMPRESSED,2]]);let _Dt=class{constructor(){this.geometry=new BLt,this.intersectionData=null,this.geometryState=null,this._vao=null,this._texture=null,this._textureRef=new jUe(()=>this.tile.surface.fadeDuration),this.overlay=new hDt,this._localOrigin=null,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._modifiedFlags=0}get tile(){return this._tile}get localOrigin(){return this._localOrigin}init(e,i){this.clear(),this._tile=e,this.geometry.reset(),this.intersectionData=null,this.geometryState=new GLt,this._localOrigin=i,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this.wireframeChanged||this.clippingAreaChanged||this.samplerDataChanged||this.numVerticesPerSideChanged||this.dirtyCorners||this.dirtyEdgeResolutions||this.dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),fo&&this.tile.intersectsClippingArea)for(let i=0;i<4;++i)Xe(this.geometry.getEdgeCount(i)===this.geometryState.edgeResolutions[i]+1)}_calculateEdgeResolution(e,i){var l;const r=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const c=r.surface.extent;if(c!=null&&(e===0&&r.extent[3]>c[3]||e===1&&r.extent[2]>c[2]||e===2&&r.extent[1]<c[1]||e===3&&r.extent[0]<c[0]))return s}const n=r.level,o=Xf[e];if(!i)return Xe(((l=r.surface)==null?void 0:l.rootTiles)==null||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(o)),s;if(i.isLoaded){const c=i,u=c.renderData.geometryState,d=n-c.level;if(Xe(d>=0),d===0){const g=u.numVerticesPerSide-1;return Math.max(g,s)}const f=2**d,m=u.edgeResolutions[(e+2)%4]/f;return Math.max(1,m)}Xe(!i.isLeaf);let a=s;return i.forAllSubtreeOnSide(yle(o),c=>c===r||(c.isLoaded?(a=Math.max(a,2**(c.level-n)),!0):(Xe(!c.isLeaf),!1))),a}updateNeighborData(){var o;const e=this.tile;if(!e.intersectsClippingArea)return;const i=e.renderData.geometryState,r=a=>(a.isLoaded||a.level===e.level)&&(a==null?void 0:a.intersectsClippingArea),s=i.edgePeerNeighbors,n=i.edgePeerNeighborSamplerVersions;for(let a=0;a<4;++a){const l=e.findNeighborTile(Xf[a],r),c=QT(e,l),u=((o=c==null?void 0:c.renderData)==null?void 0:o.geometryState.samplerDataVersion)??-1,d=s[a],f=c!==QT(e,d),m=n[a]!==u;fo&&l&&(Xe(e.level>=l.level),Xe(e.level-l.level<=qn)),s[a]=l,(f||m)&&(n[a]=u,this._markEdgeDirty(a));const g=i.edgeResolutions[a],y=this._calculateEdgeResolution(a,l);Xe(LL(y)),Xe(y>=1),i.edgeResolutions[a]=y,g!==y&&this._markEdgeResolutionDirty(a)}for(let a=0;a<4;++a){const l=e.findNeighborTile($j[a],r);i.cornerPeerNeighbors[a]=l;const c=QT(e,s[a]),u=QT(e,s[(a+1)%4]),d=QT(e,l);jp[a]=d,jp[(a+1)%4]=u,jp[(a+2)%4]=e,jp[(a+3)%4]=c,Xe(jp.some(y=>(y==null?void 0:y.isLoaded)||y===e));const f=jp.reduce((y,v)=>Math.min(y,(v==null?void 0:v.level)??1/0),1/0);jp.forEach((y,v)=>{y&&(y==null?void 0:y.level)>f&&(jp[v]=null)}),Xe(jp.some(y=>(y==null?void 0:y.isLoaded)||y===e));const m=i.cornerNeighborCornerTiles,g=i.cornerNeighborCornerTileSamplerVersions;for(let y=0;y<4;++y){const v=jp[y],b=(v==null?void 0:v.renderData.geometryState.samplerDataVersion)??-1,w=4*a+y,x=m[w]!==v,T=!x&&g[w]!==b;(x||T)&&(m[w]=v,g[w]=b,this._markCornerDirty(a))}fo&&Xe(Sle.some(y=>{var v;return((v=m[4*a+y])==null?void 0:v.isLoaded)||m[4*a+y]===e}))}fo&&Xe(this.geometryState.edgeResolutions.every(a=>a>0));for(let a=0;a<4;++a)jp[a]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;fo&&Xe(!this.tile.intersectsClippingArea||this.geometryState.edgeResolutions.every(m=>m>0)),this.intersectionData=null;const{tile:i,_vao:r,geometry:s,geometryState:n}=this,o=!r||!1||this.wireframeChanged||this.samplerDataChanged||this.clippingAreaChanged||this.numVerticesPerSideChanged,a=this.dirtyEdgeResolutions!==0,l=n.edgeResolutions.reduce((m,g)=>m+g+1,0),c=o||a&&l>((s==null?void 0:s.maxEdgeVertexCount)??0),u=!c&&a,d=!u&&(this.dirtyEdges!==0||a),f=!d&&this.dirtyCorners!==0;c?(this.releaseGeometry(),this._createGeometry(e)):u?i.updateEdgeElevationsAndResolutions():d||f?i.updateEdgeElevations():f?i.updateCornerElevations():console.warn("Update for no reason?"),this._modifiedFlags=0}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=Ut(this._vao),this.geometry.release(),!0)}ensureTexture(e,i,r){const s=i?Ht.RGBA:Ht.RGB;return this._texture==null||this._texture.descriptor.width===e&&this._texture.descriptor.pixelFormat===s||this.releaseTexture(),this._texture==null&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}get numVerticesPerSideChanged(){return!!(this._modifiedFlags&bDt)}get samplerDataChanged(){return!!(this._modifiedFlags&wDt)}get clippingAreaChanged(){return!!(this._modifiedFlags&xDt)}get wireframeChanged(){return!!(this._modifiedFlags&TDt)}get dirtyEdges(){return this._modifiedFlags>>k7&15}get dirtyCorners(){return this._modifiedFlags>>U7&15}get dirtyEdgeResolutions(){return this._modifiedFlags>>V7&15}_markCornerDirty(e){const i=1<<e<<U7;this._modifiedFlags|=i}_markEdgeDirty(e){const i=1<<e<<k7;this._modifiedFlags|=i,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const i=1<<e<<V7;this._modifiedFlags|=i,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._modifiedFlags|=15<<U7|15<<k7|15<<V7}updateGeometryState(){const e=this._getElevationInfo(),i=this.tile,r=e.samplerData?i.getElevationVerticesPerSide(e.maxTileLevel):i.getDefaultVerticesPerSide(),s=Math.max(r,5);let n=i.clippingArea;i.intersectsClippingArea&&!i.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==s&&(this._modifiedFlags|=1,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),e.changed&&(this._modifiedFlags|=2,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),Lb(o.clippingArea,n)||(this._modifiedFlags=4,o.clippingArea=n,a=!0);const l=i.surface.wireframe;return o.wireframe!==l&&(this._modifiedFlags=8,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const i=this.geometry.vertexAttributes,r=this.geometry.indices,s=e.gl;this._vao=new Dy(e,YUe,{geometry:Xu(i.layout)},{geometry:Cr.createVertex(e,s.STATIC_DRAW,i.buffer)},Cr.createIndex(e,s.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,i=Ob.Immediate){e!=null&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,i=this.tile.layerInfo[ei.ELEVATION],r=i.length,s=new Array(r);let n=0,o=0,a=!1;for(let u=0;u<r;u++){const d=i[u];if(d.upsampleInfo!=null){const f=d.upsampleInfo.tile,m=f.layerInfo[ei.ELEVATION][u].data,g=m&&m.samplerData;e&&e[n]===g||(a=!0),s[n++]=g,o=Math.max(o,f.lij[0])}else if(d.data){const f=this.tile.surface.layerViewByIndex(u,ei.ELEVATION);if(aL(this.tile,f.layer,!1)){const m=d.data;e&&e[n]===m.samplerData||(a=!0),s[n++]=m.samplerData,o=this.tile.level}}}e!=null&&e.length!==n&&(a=!0);const l=n>0,c=l?s:null;return l&&(s.length=n),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var i,r,s;const e=((i=this.intersectionData)==null?void 0:i.estimatedMemoryUsage)??0;return(((r=this.geometry.indices)==null?void 0:r.byteLength)??0)+(((s=this.geometry.vertexAttributes)==null?void 0:s.byteLength)??0)+e}get texture(){return this._texture}get test(){}checkGeometryWaterproofness(){if(!fo)return;const e=this.tile;if(!e.isLoaded||!e.intersectsClippingArea||e.level===0)return void Xe(e==null?void 0:e.isLoaded);const i=e.surface.extent;if(i!=null&&!e.intersectsExtent(i))return;const r=Xf.map((a,l)=>i!=null&&(l<2?-1:1)*(e.extent[3-l]-i[3-l])<0),s=e.level;Xe(this.dirtyCorners===0),Xe(this.dirtyEdges===0),Xe(this.dirtyEdgeResolutions===0),Xe(!this.numVerticesPerSideChanged),Xe(!this.samplerDataChanged),Xe(!this.clippingAreaChanged),Xe(!this.wireframeChanged);const n=$j.map(a=>e.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.isLoaded||l.level===e.level)??null).map(a=>a!=null&&a.intersectsClippingArea?a:null),o=this.geometryState;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=n[a];Xe(c===l,`Tile[${e.lij}].corner[${a}] out of date: cur=[${l==null?void 0:l.lij}] exp=[${c==null?void 0:c.lij}]`)}Xf.forEach((a,l)=>{if(r[l])return;const c=e.findNeighborTile(a,J=>(J.level===s||(J==null?void 0:J.isLoaded))&&(J==null?void 0:J.intersectsClippingArea));if(!c){const J=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(a);return void Xe(!J)}Xe(c.isLoaded||c.level===e.level),Xe(c===this.geometryState.edgePeerNeighbors[l]);const u=s-c.level;if(!c.isLoaded)return Xe(!c.isLeaf),void Xe(u===0);const d=c.renderData;Xe(uDt(e,c,a)),Xe(u>=0);const f=2**u;if(u<0)return void Xe(!1);const m=e.renderData,g=m.geometry,y=m.localOrigin,v=g.getEdgeCount(l),b=g.numVerticesPerSide-1,w=d.geometry;if(!w)return void Xe(!1);const x=d.localOrigin,T=this.geometryState.edgePeerNeighbors[l];if(T!=null&&T.isLoaded){const J=T.renderData;Xe(m.geometryState.edgePeerNeighborSamplerVersions[l]===J.geometryState.samplerDataVersion),Xe(this.geometryState.edgePeerNeighborSamplerVersions[l]===J.geometryState.samplerDataVersion)}const E=(l+2)%4,M=w.getEdgeCount(E),O=v-1,D=M-1;Xe(O*f===D,`Tile[${e.lij}]:e${l},res=${O} edgeRes mismatch with Neighbor[${c.lij}]:e${E},res=${D} (expected:${O*f})`);const U=e.extent,k=a===Ot.NORTH||a===Ot.SOUTH,H=M-1,V=H>>u,X=v-1;if(V<1)return void Xe(X===1);Xe(V===X),Xe(LL(V));const q=w.numVerticesPerSide-1;Xe(u>0||V===Math.max(q,b));const Z=e.getNeighborEdgeStartVertexIndex(l,c);Xe(0<=Z&&Z<f);const ye=Z*V;Xe(0<=ye&&ye<=H-V);let L=0,N=ye;g.getEdgeVertexPosition(l,zm,y,0),g.getEdgeVertexPosition(l,Bm,y,v-1);const z=Ar(zm,Bm),W=Math.max(vDt,1e-4*z);for(let J=0;J<=V;++J){g.getEdgeVertexPosition(l,zm,y,L),w.getEdgeVertexPosition(E,Bm,x,N);const ee=J/V,ae=k?U[0]+ee*(U[2]-U[0]):a===Ot.WEST?U[0]:U[2],we=k?a===Ot.SOUTH?U[1]:U[3]:U[1]+ee*(U[3]-U[1]),Ie=e.surface.extent;if(Ie==null||UG(Ie,ae,we)){const Ge=gb(zm,Bm),ut=Wl(zm)-ur.radius,ot=Wl(Bm)-ur.radius,at=Ge<W;if(!at){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${L}/${v}] and [${c.lij}].edge${E}[${N}/${M}]`),Ie!=null&&console.warn("  surface extent= ",Ie," x,y=",ae,",",we);const li=C();$e(li,m.localOrigin,d.localOrigin),Wl(li)>0&&console.warn(`   localOrigins: ${m.localOrigin} vs ${d.localOrigin} d=${Wl(li)} [${li}]`),(()=>{const se=yn(zm),Ae=yn(Bm);e.updateEdgeElevations(),c.updateEdgeElevations(),g.getEdgeVertexPosition(l,zm,y,L),w.getEdgeVertexPosition(E,Bm,x,N);const ce=C();Li(ce,zm,se),Wl(ce)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${se} vs ${zm} d=${Wl(ce)} [${ce}]`),Li(ce,Bm,Ae),Wl(ce)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${Ae} vs ${Bm} d=${Wl(ce)} [${ce}]`)})();const Y=g.getEdgeCount(l),ie=w.getEdgeCount(M);Xe(at,`Mismatch in tile [${e.lij}].edge[${l}][${L}/${Y}] vs neighbor [${c.lij}].edge[${E}][${N}/${ie}] ${l0(zm)} vs ${l0(Bm)}  dist=${Ge} h(t|n|d)=${ut}|${ot}|${ot-ut}`)}g.getEdgeNormal(l,aC,L),w.getEdgeNormal(E,lC,N),Ce(c1e,aC),Ce(u1e,lC);const it=Te(c1e,u1e),st=1-it<.01||!1||e===c;if(!st){const li=C();Li(li,aC,lC);const Y=()=>`Mismatch in tile edge normal ${Xve(e.lij)} (${L}/${v-1}) edge ${l} vs neighbor ${Xve(c.lij)}  (${N}/${M-1}) nedge ${E} :${l0(aC)} vs ${l0(lC)}  dot = ${it} : ${l0(li)}`;console.warn("Mismatch in tile edge normal: ",Y());{e.updateEdgeElevations(),c.updateEdgeElevations();const ie=C(),se=C();g.getEdgeNormal(l,ie,L),w.getEdgeNormal(E,se,N),h2(aC,ie)||console.warn("Missing update in tile normal: ",l0(aC)," => ",l0(ie)),h2(lC,se)||console.warn("Missing update in neighbor normal: ",l0(lC)," => ",l0(se))}Xe(st,Y())}}L+=1,N+=1}})}};const zm=C(),Bm=C(),aC=C(),lC=C(),c1e=C(),u1e=C(),vDt=1,jp=[null,null,null,null];function QT(t,e){return e!=null&&e.isLoaded||e===t?e:null}const bDt=1,wDt=2,xDt=4,TDt=8,k7=4,U7=8,V7=12,Sle=[0,1,2,3],SDt=65536;function EDt(t,e){const{tile:i,geometry:r,geometryState:s}=t,{extentInRadians:n,surface:o}=i,{isWebMercator:a,renderer:l}=o,{numVerticesPerSide:c,wireframe:u}=s,d=c-1,f=(c-2)**2,m=a&&(e===Jd.HAS_SOUTH_POLE||e===Jd.HAS_BOTH_POLES),g=a&&(e===Jd.HAS_NORTH_POLE||e===Jd.HAS_BOTH_POLES),y=((m?1:0)+(g?1:0))*gV*c,v=uVe(s),b=f+y+4*v,w=l.tileGeometryCache.acquire(b);r.numVerticesPerSide=c,r.vertexAttributes=w,r.maxEdgeVertexCount=v;const{boundingBox:x}=r;Qr(x);const T=Cle(t);na.update(d,n,T),MDt(t),r.poleVerticesStartIndex=f;const E=CDt(t,m,g);r.edgeVerticesStartIndex=f+y,Ale(t),Ele(t),iVe(r,E,u),t.intersectionData=null}function CDt(t,e,i){const{tile:r,localOrigin:s,geometry:n}=t,{extent:o,ellipsoid:a}=r,{boundingBox:l,numVerticesPerSide:c,vertexAttributes:u,poleVerticesStartIndex:d}=n,f=c-1,m=s[0],g=s[1],y=s[2],v=a.radius,b=o[1],w=o[3],x=[];let T=d;const E=(M,O)=>{const D=O*c;dp(-m,-g,M*v-y,l),x.push(new HDt(M===1,D,M===1?0:2,T,gV));const U=QUe(M===-1?b:w,v),k=M*Math.PI/2-U,H=.99*(M===1?1:-1),V=v+0,{position:X,uv0:q}=u,{typedBuffer:Z,typedBufferStride:ye}=u.normalCompressed;for(let L=1;L<=gV;++L){const N=U+k*(L/gV),z=Math.cos(N),W=Math.sin(N);for(let J=0;J<=f;J++){const ee=J/f,ae=na.sinLonLUT[J],we=na.cosLonLUT[J]*z,Ie=ae*z,Ge=W,ut=we*V-m,ot=Ie*V-g,at=Ge*V-y;dp(ut,ot,at,l),X.setValues(T,ut,ot,at),im(q,T,ee,H),vp(Z,T,we,Ie,Ge,ye),++T}}};return e&&E(-1,0),i&&E(1,f),x}function MDt(t){const{tile:e}=t;if(!e.intersectsClippingArea)return;const{geometry:i,geometryState:r,localOrigin:s}=t,{numVerticesPerSide:n,samplerData:o}=r,a=n-2,l=n-1,{vertexAttributes:c,boundingBox:u}=i,d=c.position,f=c.uv0,{typedBuffer:m,typedBufferStride:g}=c.normalCompressed,{extent:y}=e,v=y[0],b=y[2],w=y[1],x=y[3],T=e.ellipsoid.radius,E=s[0],M=s[1],O=s[2],D=d.typedBuffer,U=d.typedBufferStride,k=1/l;let H=0;if(1<=a){const V=k,X=w*(1-V)+x*V,q=na.sinLatLUT[1],Z=na.cosLatLUT[1];for(let ye=1;ye<=a;ye++){const L=ye*k,N=v*(1-L)+b*L,z=na.sinLonLUT[ye],W=na.cosLonLUT[ye],J=T+Ps(N,X,o),ee=J*W*Z-E,ae=J*z*Z-M,we=J*q-O;dp(ee,ae,we,u);const Ie=(ye-1)*U;D[Ie]=ee,D[Ie+1]=ae,D[Ie+2]=we,im(f,ye-1,L,V)}}for(let V=1;V<=a;V++){const X=V*k,q=w*(1-X)+x*X,Z=na.sinLatLUT[V],ye=na.cosLatLUT[V],L=V+1,N=L*k,z=w*(1-N)+x*N,W=na.sinLatLUT[L],J=na.cosLatLUT[L],ee=na.sinLonLUT[0],ae=na.cosLonLUT[0],we=T+Ps(v,q,o);let Ie=ae*ye*we-E,Ge=ee*ye*we-M,ut=Z*we-O;const ot=H*U;let at=D[ot],it=D[ot+1],st=D[ot+2];for(let li=1;li<=a;li++){const Y=li*k,ie=v*(1-Y)+b*Y,se=na.sinLonLUT[li],Ae=na.cosLonLUT[li];let ce=0,me=0,Me=0;if(li<a){const Si=(H+1)*U;ce=D[Si],me=D[Si+1],Me=D[Si+2]}else{const Si=na.sinLonLUT[l],is=na.cosLonLUT[l],Ws=T+Ps(b,q,o);ce=is*ye*Ws-E,me=Si*ye*Ws-M,Me=Z*Ws-O}const Oe=Ie,be=Ge,xe=ut;Ie=at,Ge=it,ut=st,at=ce,it=me,st=Me;const _e=ce-Oe,Le=me-be,Fe=Me-xe;let lt=0,ct=0,Vt=0;if(V>1){const Si=(H-a)*U;lt=D[Si],ct=D[Si+1],Vt=D[Si+2]}else{const Si=na.sinLatLUT[0],is=na.cosLatLUT[0],Ws=T+Ps(ie,w,o);lt=Ae*is*Ws-E,ct=se*is*Ws-M,Vt=Si*Ws-O}const Mt=T+Ps(ie,z,o),Zt=Ae*J*Mt-E,Xt=se*J*Mt-M,vi=W*Mt-O;if(V<a){const Si=H+a,is=Si*U;D[is]=Zt,D[is+1]=Xt,D[is+2]=vi,dp(Zt,Xt,vi,u),im(f,Si,Y,N)}const xi=lt-Zt,Ni=ct-Xt,Nt=Vt-vi;let jt=Ae*ye,ti=se*ye,gr=Z;gr*gr<.999&&(jt=Fe*Ni-Le*Nt,ti=_e*Nt-Fe*xi,gr=Le*xi-_e*Ni);const vn=1/Math.sqrt(jt*jt+ti*ti+gr*gr);vp(m,H,jt*vn,ti*vn,gr*vn,g),++H}}}function ADt(t){t.tile.intersectsClippingArea&&(Ele(t),jO(t),t.intersectionData=null)}function PDt(t){t.tile.intersectsClippingArea&&(nVe(t),Ele(t),jO(t),lVe(t),t.intersectionData=null)}function ODt(t){t.tile.intersectsClippingArea&&(JUe(t),XUe(t,!0),jO(t),t.intersectionData=null)}function Ele(t){t.tile.intersectsClippingArea&&(JUe(t),XUe(t))}function XUe(t,e=!1){const{geometry:i,geometryState:r,tile:s,localOrigin:n}=t,{level:o,extent:a,extentInRadians:l,ellipsoid:c}=s,u=c.radius,d=l[0],f=l[2],m=l[1],g=l[3],{samplerData:y}=r,v=a[0],b=a[2],w=a[1],x=a[3],T=Cle(t),{boundingBox:E,vertexAttributes:M}=i,O=n[0],D=n[1],U=n[2],k=M.position,H=k.typedBuffer,V=k.typedBufferStride,X=M.uv0;for(let q=0;q<4;++q){const Z=q===1||q===3,ye=r.edgeResolutions[q];Xe(LL(ye));const L=ye+1,N=QT(s,r.edgePeerNeighbors[q]);if(cVe(s,N,q)){oVe(t,q,N);continue}const z=N!=null;Xe(!z||N.level===s.level),Xe(!z||Jg(s,N)<=0);const W=N==null?void 0:N.renderData,J=W==null?void 0:W.geometryState;if(fo){const _e=s.surface;if(!N&&_e&&!_e.updatingRootTiles){const Le=Xf[q],Fe=s.findNeighborTile(Le,lt=>lt.isLoaded||lt.isLeaf||lt.level===s.level);Fe?Fe.intersectsClippingArea&&(Xe(!Fe.isLoaded),Xe(!Fe.isLeaf),Xe(Fe.level===o)):Xe((_e==null?void 0:_e.rootTiles)==null||!s.shouldHaveNeighbor(Le))}}const ee=q===1?a[2]:a[0],ae=N==null?void 0:N.extent,we=ae&&Z?q===1?ae[0]:ae[2]:ee,Ie=q===0?a[3]:a[1],Ge=q===1?1:0,ut=q===0?1:0,ot=q===1?f:d,at=q===0?g:m,it=Math.sin(ot),st=Math.cos(ot),li=Math.sin(at),Y=Math.cos(at),ie=J==null?void 0:J.samplerData,se=z?(_e,Le,Fe)=>.5*(Ps(_e,Le,y)+Ps(Fe,Le,ie)):(_e,Le,Fe)=>Ps(_e,Le,y),Ae=i.outerEdgesOffsetAndLength[2*q+0],ce=e&&L>3?L-3:1,me=y!=null&&y.some(_e=>_e!=null),Me=ie!=null&&ie.some(_e=>_e!=null),Oe=me||Me,be=1/ye,xe=Ae;Xe(!ae||Qd(ae[2]-ae[0],a[2]-a[0])),(()=>{const _e=q===1?-1:q===3?1:0,Le=q===0?-1:q===2?1:0,Fe=(a[2]-a[0])*be,lt=_e*Fe,ct=Le*Fe,Vt=Z?_e*((f-d)*be):0,Mt=Z?0:Le*be,Zt=ut,Xt=Z?ot+Vt:ot,vi=Z?Math.sin(Xt):it,xi=Z?Math.cos(Xt):st,Ni=Z?ot-Vt:ot,Nt=Z?Math.sin(Ni):it,jt=Z?Math.cos(Ni):st,ti=Z?at:T(Zt+Mt),gr=Z?li:Math.sin(ti),vn=Z?Y:Math.cos(ti),Si=Z?at:T(Zt-Mt),is=Z?li:Math.sin(Si),Ws=Z?Y:Math.cos(Si);let Zo=0,Al=0,Pl=0;{const Oi=0*be,hs=Z?ee:v*(1-Oi)+b*Oi,kn=Z?we:hs,wo=Z?w*(1-Oi)+x*Oi:Ie,ge=Z?ot:d*(1-Oi)+f*Oi,ar=Z?it:Math.sin(ge),Mp=Z?st:Math.cos(ge),xo=Z?T(Oi):at,Ap=Z?Math.sin(xo):li,Ct=Z?Math.cos(xo):Y,eu=u+se(hs,wo,kn);Zo=Mp*Ct*eu,Al=ar*Ct*eu,Pl=Ap*eu}let Yo=0,On=0,Zs=0;{const Oi=1*be,hs=Z?ee:v*(1-Oi)+b*Oi,kn=Z?we:hs,wo=Z?w*(1-Oi)+x*Oi:Ie,ge=Z?ot:d*(1-Oi)+f*Oi,ar=Z?it:Math.sin(ge),Mp=Z?st:Math.cos(ge),xo=Z?T(Oi):at,Ap=Z?Math.sin(xo):li,Ct=Z?Math.cos(xo):Y,eu=u+se(hs,wo,kn);Yo=Mp*Ct*eu,On=ar*Ct*eu,Zs=Ap*eu}for(let Oi=1;Oi<L-1;Oi+=ce){let hs=0,kn=0,wo=0;{const Ol=(Oi+1)*be,tu=Z?ee:v*(1-Ol)+b*Ol,bm=Z?we:tu,So=Z?w*(1-Ol)+x*Ol:Ie,Ns=Z?ot:d*(1-Ol)+f*Ol,nv=Z?it:Math.sin(Ns),Dw=Z?st:Math.cos(Ns),Nw=Z?T(Ol):at,uE=Z?Math.sin(Nw):li,Fw=Z?Math.cos(Nw):Y,ov=u+se(tu,So,bm);hs=Dw*Fw*ov,kn=nv*Fw*ov,wo=uE*ov}const ge=hs,ar=kn,Mp=wo,xo=Yo,Ap=On,Ct=Zs;Yo=ge,On=ar,Zs=Mp;{const Ol=xe+Oi,tu=Ol*V,bm=xo-O,So=Ap-D,Ns=Ct-U;H[tu]=bm,H[tu+1]=So,H[tu+2]=Ns,dp(bm,So,Ns,E);const nv=Oi*be;im(X,Ol,Z?Ge:nv,Z?nv:ut)}const eu=Zo,To=Al,Rw=Pl;Zo=xo,Al=Ap,Pl=Ct;const Iw=xo,hc=Ap,By=Ct,Lw=1/Math.sqrt(Iw*Iw+hc*hc+By*By),pi=By*Lw;let rv=0,jy=0,sv=0;if(Oe&&pi*pi<.999){let Ol=0,tu=0,bm=0;{const So=q===0?-1:1;Ol=So*(ge-eu),tu=So*(ar-To),bm=So*(Mp-Rw)}{const So=Oi*be,Ns=Z?ee:v*(1-So)+b*So,nv=Z?we:Ns,Dw=Z?w*(1-So)+x*So:Ie,Nw=Z?ot:d*(1-So)+f*So,uE=Z?it:Math.sin(Nw),Fw=Z?st:Math.cos(Nw),ov=Z?T(So):at,WN=Z?Math.sin(ov):li,dc=Z?Math.cos(ov):Y;let WO=Iw,ZO=hc,K=By;if(z){const Re=u+Ps(nv-lt,Dw-ct,ie),We=Z?dc:Ws;WO=(Z?jt:Fw)*We*Re,ZO=(Z?Nt:uE)*We*Re,K=(Z?WN:is)*Re}{const Re=u+Ps(Ns+lt,Dw+ct,y),We=Z?dc:vn,$i=(Z?xi:Fw)*We*Re,$n=(Z?vi:uE)*We*Re,Ys=(Z?WN:gr)*Re;z||(WO=2*Iw-$i,ZO=2*hc-$n,K=2*By-Ys);const $l=q===3?-1:1,kw=$l*(WO-$i),Oce=$l*(ZO-$n),$ce=$l*(K-Ys);rv=bm*Oce-tu*$ce,jy=Ol*$ce-bm*kw,sv=tu*kw-Ol*Oce;const J8=1/Math.sqrt(rv*rv+jy*jy+sv*sv);rv*=J8,jy*=J8,sv*=J8}}}else rv=Iw*Lw,jy=hc*Lw,sv=By*Lw;i.setEdgeNormalFromValues(q,Oi,rv,jy,sv)}})()}}function JUe(t){aVe(t)}function QUe(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function $Dt(t,e,i,r){return QUe(t*(1-r)+e*r,i)}function RDt(t,e,i){return t*(1-i)+e*i}function Cle(t){const{tile:e}=t;if(e.surface.isWebMercator){const r=e.extent,s=e.ellipsoid.radius;return n=>$Dt(r[1],r[3],s,n)}const i=e.extentInRadians;return r=>RDt(i[1],i[3],r)}function IDt(t,e){const{tile:i,geometryState:r,geometry:s}=t,{extent:n,surface:o}=i,{wireframe:a}=r,l=n[0],c=n[1],u=n[2]-l,d=n[3]-c,{numVerticesPerSide:f,clippingArea:m}=r,g=m!=null?Math.max(0,(m[0]-l)/u):0,y=m!=null?Math.max(0,(m[1]-c)/d):0,v=m!=null?Math.min(1,(m[2]-l)/u):1,b=m!=null?Math.min(1,(m[3]-c)/d):1,w=(f-2)**2,x=uVe(r),T=w+4*x,E=o.renderer.tileGeometryCache.acquire(T),{boundingBox:M}=s;Qr(M),s.numVerticesPerSide=f,s.vertexAttributes=E,s.maxEdgeVertexCount=x,s.minu=g,s.minv=y,s.maxu=v,s.maxv=b,LDt(t),s.edgeVerticesStartIndex=w,Ale(t),Mle(t),iVe(s,[],a),t.intersectionData=null}function LDt(t){const e=t.tile;if(!e.intersectsClippingArea)return;const{geometry:i,geometryState:r,localOrigin:s}=t,{samplerData:n,clippingArea:o,numVerticesPerSide:a}=r,{surface:l,extent:c,ellipsoid:u}=e,{isWebMercatorOnPlateCarree:d}=l,f=o??Ple,m=c[0],g=c[1],y=c[2],v=c[3],b=Math.max(m,f[0]),w=Math.min(y,f[2]),x=Math.max(g,f[1]),T=Math.min(v,f[3]),E=u.radius,M=e.horizontalScale,O=a-1,D=a-2,{minu:U,minv:k,maxu:H,maxv:V,boundingBox:X,vertexAttributes:q}=i,Z=q.position,ye=q.uv0,{typedBuffer:L,typedBufferStride:N}=q.normalCompressed,z=s[0],W=s[1],J=s[2],ee=Z.typedBuffer,ae=Z.typedBufferStride;let we=0;const Ie=Ne(g,x,T),Ge=d?(Math.PI/2-2*Math.atan(Math.exp(-Ie/E)))*E:Ie*M,ut=1/O,ot=Ne(g*(1-ut)+v*ut,x,T);let at=Ge,it=d?(Math.PI/2-2*Math.atan(Math.exp(-ot/E)))*E:ot*M;for(let st=1;st<=D;st++){const li=st/O,Y=Ne(g*(1-li)+v*li,x,T),ie=Ne(li,k,V),se=it,Ae=(st-1)/O,ce=Ne(g*(1-Ae)+v*Ae,x,T),me=at,Me=(st+1)/O,Oe=Ne(g*(1-Me)+v*Me,x,T),be=d?(Math.PI/2-2*Math.atan(Math.exp(-Oe/E)))*E:Oe*M,xe=Ne(Me,k,V);at=it,it=be;const _e=Ne(m,b,w);let Le=_e*M,Fe=Ps(_e,Y,n);const lt=1/O,ct=Ne(lt,U,H),Vt=Ne(m*(1-ct)+y*ct,b,w);let Mt=ct,Zt=Vt,Xt=Vt*M,vi=Ps(Vt,Y,n);if(st===1){const xi=Xt-z,Ni=at-W,Nt=vi-J,jt=0*ae;ee[jt]=xi,ee[jt+1]=Ni,ee[jt+2]=Nt,dp(xi,Ni,Nt,X);const ti=Ne(lt,U,H);im(ye,we,ti,ie)}for(let xi=1;xi<=D;xi++){const Ni=Xt,Nt=vi,jt=(xi+1)/O,ti=Ne(jt,U,H),gr=Ne(m*(1-jt)+y*jt,b,w),vn=Zt;Zt=gr;{const On=we+1,Zs=On*ae;if(st===1||xi===D){const Oi=gr*M,hs=Ps(gr,Y,n);if(st===1&&xi<D){const kn=Oi-z,wo=se-W,ge=hs-J;ee[Zs]=kn,ee[Zs+1]=wo,ee[Zs+2]=ge,dp(kn,wo,ge,X),im(ye,On,ti,ie)}Xt=Oi,vi=hs}else Xt=ee[Zs]+z,vi=ee[Zs+2]+J}const Si=Xt,is=vi,Ws=Le,Zo=Fe;Le=Ni,Fe=Nt;const Al=(we-D)*ae,Pl=st===1?Ps(vn,ce,n):ee[Al+2]+J,Yo=Ps(vn,Oe,n);if(st<D){const On=we+D,Zs=On*ae,Oi=Ni-z,hs=be-W,kn=Yo-J;ee[Zs]=Oi,ee[Zs+1]=hs,ee[Zs+2]=kn,dp(Oi,hs,kn,X);const wo=Mt;Mt=ti,im(ye,On,wo,xe)}{const On=Si-Ws,Zs=me-be,Oi=Zs*(is-Zo),hs=On*(Pl-Yo),kn=-Zs*On,wo=Oi*Oi+hs*hs+kn*kn;if(wo===0)vp(L,we,0,0,1,N);else{const ge=1/Math.sqrt(wo);vp(L,we,Oi*ge,hs*ge,kn*ge,N)}}++we}}}function DDt(t,e){t.tile.intersectsClippingArea&&(eVe(t),KUe(t,!0),jO(t),t.intersectionData=null)}function NDt(t,e){t.tile.intersectsClippingArea&&(nVe(t),Mle(t),jO(t),lVe(t),t.intersectionData=null)}function FDt(t,e){t.tile.intersectsClippingArea&&(Mle(t),jO(t),t.intersectionData=null)}function Mle(t,e){t.tile.intersectsClippingArea&&(eVe(t),KUe(t,!1))}function KUe(t,e){const{geometry:i,geometryState:r,localOrigin:s}=t,n=t.tile,{surface:o,extent:a}=n,{clippingArea:l,samplerData:c}=r,u=l??Ple,d=a[0],f=a[2],m=a[1],g=a[3],y=[g>u[3],f>u[2],m<u[1],d<u[0]],v=n.horizontalScale,b=tVe(o.isWebMercatorOnPlateCarree,n.ellipsoid.radius,v),{minu:w,minv:x,maxu:T,maxv:E,boundingBox:M}=i,O=Math.max(d,u[0]),D=Math.min(f,u[2]),U=Math.max(m,u[1]),k=Math.min(g,u[3]),H=s[0],V=s[1],X=s[2];for(let q=0;q<4;++q){const Z=q===1||q===3,ye=r.edgeResolutions[q];Xe(LL(ye));const L=ye+1,N=y[q],z=QT(n,r.edgePeerNeighbors[q]);if(!N&&cVe(n,z,q)){oVe(t,q,z);continue}const W=z!=null&&!N,J=z==null?void 0:z.renderData,ee=J==null?void 0:J.geometryState;if(fo&&(Xe(!W||z.level===n.level),Xe(!W||Jg(n,z)<=0),n&&!z&&!o.updatingRootTiles)){const be=Xf[q],xe=n.findNeighborTile(be,_e=>_e.isLoaded||_e.isLeaf||_e.level===n.level);o.updatingRootTiles||(xe?xe.intersectsClippingArea&&(Xe(!xe.isLoaded),Xe(!xe.isLeaf),Xe(xe.level===n.level)):Xe((o==null?void 0:o.rootTiles)==null||!n.shouldHaveNeighbor(be)))}const ae=Ne(q===1?f:d,O,D),we=Ne(q===0?g:m,U,k),Ie=ee==null?void 0:ee.samplerData,Ge=e&&L>3?L-3:1,ut=Ne(q===1?1:0,w,T),ot=Ne(q===0?1:0,x,E),at=W?(be,xe)=>.5*(Ps(be,xe,Ie)+Ps(be,xe,c)):(be,xe)=>Ps(be,xe,c),it=(f-d)/ye,st=Z?q===1?it:-it:0,li=Z?0:q===0?it:-it,Y=-st,ie=-li;let se=0,Ae=0,ce=0;{const be=0/ye,xe=Z?ae:Ne(d*(1-be)+f*be,O,D),_e=Z?Ne(m*(1-be)+g*be,U,k):we,Le=at(xe,_e);se=xe*v,Ae=b(_e),ce=Le}let me=0,Me=0,Oe=0;{const be=1/ye,xe=Z?ae:Ne(d*(1-be)+f*be,O,D),_e=Z?Ne(m*(1-be)+g*be,U,k):we,Le=at(xe,_e);me=xe*v,Me=b(_e),Oe=Le}for(let be=1;be<L-1;be+=Ge){const xe=be/ye,_e=me,Le=Me,Fe=Oe;{const Nt=Z?ut:Ne(xe,w,T),jt=Z?Ne(xe,x,E):ot,ti=_e-H,gr=Le-V,vn=Fe-X;dp(_e,gr,vn,M),i.setEdgeVertexFromValuesRawPositionUV(q,be,ti,gr,vn,Nt,jt)}{const Nt=(be+1)/ye,jt=Z?ae:Ne(d*(1-Nt)+f*Nt,O,D),ti=Z?Ne(m*(1-Nt)+g*Nt,U,k):we,gr=at(jt,ti);me=jt*v,Me=b(ti),Oe=gr}const lt=me,ct=Oe,Vt=se,Mt=Ae,Zt=ce;se=_e,Ae=Le,ce=Fe;let Xt=0,vi=0,xi=0;if(Z){const Nt=Me-Le,jt=ct-Fe,ti=Mt-Le,gr=Zt-Fe,vn=Ne(m*(1-xe)+g*xe,U,k),Si=ae+Y,is=Si*v-_e,Ws=Ps(Si,vn,c)-Fe,Zo=q===3?-1:1;if(Xt=Zo*(-ti+Nt)*Ws,vi=Zo*is*(-gr+jt),xi=-Zo*is*(-ti+Nt),W){const Al=ae+st,Pl=Al*v-_e;Xt=(-ti+Nt)*(Ws-(Ps(Al,vn,Ie)-Fe)),vi=(is-Pl)*(-gr+jt),xi=-(is-Pl)*(-ti+Nt)}}else{const Nt=lt-_e,jt=ct-Fe,ti=Vt-_e,gr=Zt-Fe,vn=Ne(d*(1-xe)+f*xe,O,D),Si=we+ie,is=Ps(vn,Si,c)-Fe,Ws=b(Si)-Le,Zo=q===2?-1:1;if(Xt=Zo*Ws*(-gr+jt),vi=Zo*(-ti+Nt)*is,xi=-Zo*Ws*(-ti+Nt),W){const Al=vn,Pl=we+li,Yo=b(Pl)-Le;Xt=(-Ws+Yo)*(-gr+jt),vi=(-ti+Nt)*(-is+(Ps(Al,Pl,Ie)-Fe)),xi=-(-Ws+Yo)*(-ti+Nt)}}const Ni=1/Math.sqrt(Xt*Xt+vi*vi+xi*xi);i.setEdgeNormalFromValues(q,be,Xt*Ni,vi*Ni,xi*Ni)}}}function eVe(t,e){aVe(t)}function kDt(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function UDt(t,e){return t*e}function tVe(t,e,i){return t?r=>kDt(r,e):r=>UDt(r,i)}function iVe(t,e,i){const{numVerticesPerSide:r,vertexAttributes:s,maxEdgeVertexCount:n}=t,o=r-1,a=s.count,l=2*(r-3)*(r-3),c=4*(o+n-3),u=Sle.reduce((y,v)=>y+(o+t.getEdgeCount(v)-3),0),d=e.reduce((y,v)=>y+o*(2*(v.latitudeResolution-1)+1),0),f=3*(i?2:1),m=(l+c+d)*f,g=a>=SDt?new Uint32Array(m):new Uint16Array(m);for(let y=0;y<m;++y)g[y]=0;t.indices=g,t.indexCount=(l+u+d)*f,t.poleIndicesStartIndex=l*f,t.edgeIndicesStartIndex=(l+d)*f,i?(BDt(t),jDt(t,e),sVe(t)):(VDt(t),zDt(t,e),rVe(t))}function VDt(t){const{numVerticesPerSide:e,indices:i,vertexAttributes:r}=t,{position:s}=r,{typedBuffer:n,typedBufferStride:o}=s,a=e-2,l=e-3,c=0,u=e-3;let d=0;for(let f=0;f<l;++f){const m=f*a;for(let g=c;g<u;++g){const y=m+g,v=y+1,b=v+a,w=b-1;hVe(y,v,b,w,o,n)?(i[d]=y,i[d+1]=v,i[d+2]=b,i[d+3]=b,i[d+4]=w,i[d+5]=y):(i[d]=y,i[d+1]=v,i[d+2]=w,i[d+3]=w,i[d+4]=v,i[d+5]=b),d+=6}}}function zDt(t,e){const{numVerticesPerSide:i,indices:r,poleIndicesStartIndex:s}=t,n=i-1;let o=s;for(const a of e){const l=a.isNorth?1:2,c=a.isNorth?2:1,u=a.isNorth?3:4,d=a.isNorth?4:3;let f=t.getEdgeVertexIndex(a.connectedOuterEdgeOffset,0),m=1;for(let g=0;g<a.latitudeResolution;++g){const y=g===0?a.rowOffset:f+i;for(let v=0;v<n;v++){const b=y+v;r[o]=f,r[o+l]=f+1,r[o+c]=b,g<a.latitudeResolution-1?(r[o+u]=f+1,r[o+d]=b+1,r[o+5]=b,o+=6):o+=3,f+=m}f=y,m=1}}}function rVe(t){const{indices:e,numVerticesPerSide:i,edgeIndicesStartIndex:r}=t,s=i-1,n=s-2;let o=r;for(let a=0;a<4;++a){const l=Ole[a];let c=0,u=0;const d=t.getEdgeCount(a),f=l.count;Xe(f===s-1);const m=a===1||a===2,g=m?1:2,y=m?2:1,v=t.getEdgeFirstVertexIndex(a),b=1,w=l.vertex0Index,x=l.stride;for(;c<d-1||u<f-1;){const T=w+u*x,E=v+c*b,M=c<d-1,O=u<f-1,D=M&&(!O||(M?0+s*(c+.5)/(d-1):0)<=(O?1+n*(u+.5)/(f-1):0));D?++c:++u;const U=D?E+b:T+x;e[o]=T,e[o+g]=E,e[o+y]=U,o+=3}}t.indexCount=o}function BDt(t){const{indices:e,numVerticesPerSide:i,vertexAttributes:r}=t,{position:s}=r,{typedBuffer:n,typedBufferStride:o}=s,a=i-2;let l=0;for(let c=0;c<i-3;++c){const u=c*a;for(let d=0;d<i-3;++d){const f=c*a+d,m=f+1,g=m+a,y=g-1,v=u+d,b=v+1,w=b+a;hVe(v,b,w,w-1,o,n)?(oA(e,l,f,m,g),l+=6,oA(e,l,g,y,f)):(oA(e,l,f,m,y),l+=6,oA(e,l,y,g,m)),l+=6}}}function jDt(t,e){const{indices:i,numVerticesPerSide:r,poleIndicesStartIndex:s}=t,n=r-1;let o=s;for(const a of e){const l=a.connectedOuterEdgeOffset;let c=t.getEdgeVertexIndex(l,0),u=1;for(let d=0;d<a.latitudeResolution;++d){const f=d===0?a.rowOffset:c+r;for(let m=0;m<n;m++)oA(i,o,c,c+1,f+m),o+=6,d<a.latitudeResolution-1&&(oA(i,o,c+1,f+m+1,f+m),o+=6),c+=u;c=f,u=1}}}function sVe(t){const{indices:e,numVerticesPerSide:i,edgeIndicesStartIndex:r}=t,s=i-1,n=s-2;let o=r;for(let a=0;a<4;++a){const l=Ole[a];let c=0,u=0;const d=t.getEdgeCount(a),f=l.count;Xe(f===s-1);const m=a===1||a===2,g=m?1:3,y=m?3:1,v=t.getEdgeFirstVertexIndex(a),b=1,w=l.vertex0Index,x=l.stride;for(;c<d-1||u<f-1;){const T=w+u*x,E=v+c*b,M=c<d-1,O=u<f-1,D=M&&(!O||(M?0+s*(c+.5)/(d-1):0)<=(O?1+n*(u+.5)/(f-1):0));D?++c:++u;const U=D?E+b:T+x;e[o]=T,e[o+g]=E,e[o+g+1]=E,e[o+y]=U,e[o+y+1]=U,e[o+5]=T,o+=6}}t.indexCount=o}function Ale(t){const{geometry:e,geometryState:i}=t,{edgeResolutions:r}=i,{numVerticesPerSide:s,edgeVerticesStartIndex:n}=e,o=s-2;let a=n;for(let l=0;l<4;++l){{const c=l===0||l===2,u=(l===0?o-1:0)*o+(l===1?o-1:0),d=(c?0:1)*o+(c?1:0),f=Ole[l];f.vertex0Index=u,f.stride=d,f.count=o}{const c=r[l]+1;e.outerEdgesOffsetAndLength[2*l+0]=a,e.outerEdgesOffsetAndLength[2*l+1]=c,a+=c}}}function nVe(t){Ale(t),t.geometryState.wireframe?sVe(t.geometry):rVe(t.geometry)}function oVe(t,e,i){const{geometryState:r,geometry:s,tile:n,localOrigin:o}=t,a=e===1||e===3,l=r.edgeResolutions[e];Xe(LL(l));const c=l+1,{boundingBox:u,minu:d,minv:f,maxu:m,maxv:g,vertexAttributes:y}=s,v=Ne(e===1?1:0,d,m),b=Ne(e===0?1:0,f,g),w=i.renderData,x=w.geometryState,T=w.geometry,E=(e+2)%4,M=T.getEdgeCount(E),O=n.getNeighborEdgeStartVertexIndex(e,i)*l,D=l*2**(n.level-i.level);Xe(x.edgeResolutions[E]===D),Xe(M-1===D);const U=w.localOrigin[0]-o[0],k=w.localOrigin[1]-o[1],H=w.localOrigin[2]-o[2],V=s.getEdgeFirstVertexIndex(e),X=y.position,q=X.typedBuffer,Z=X.typedBufferStride,ye=y.normalCompressed,L=ye.typedBuffer,N=ye.typedBufferStride,z=y.uv0,W=T.vertexAttributes,J=T.getEdgeFirstVertexIndex(E),ee=W.position.typedBuffer,ae=W.position.typedBufferStride,we=W.normalCompressed.typedBuffer,Ie=W.normalCompressed.typedBufferStride;for(let Ge=1;Ge<c-1;++Ge){const ut=V+Ge,ot=J+(O+Ge),at=ut*Z,it=ot*ae,st=ee[it]+U,li=ee[it+1]+k,Y=ee[it+2]+H;q[at]=st,q[at+1]=li,q[at+2]=Y,dp(st,li,Y,u);const ie=ut*N,se=ot*Ie;L[ie]=we[se],L[ie+1]=we[se+1];const Ae=Ge/l,ce=a?v:Ne(Ae,d,m),me=a?Ne(Ae,f,g):b;im(z,ut,ce,me)}}function aVe(t){var ie;const{geometry:e,geometryState:i,localOrigin:r}=t,{clippingArea:s,samplerData:n}=i,{minu:o,minv:a,maxu:l,maxv:c,boundingBox:u,vertexAttributes:d}=e,f=t.tile,{surface:m,ellipsoid:g,extent:y,extentInRadians:v,horizontalScale:b}=f,w=((ie=m.view)==null?void 0:ie.viewingMode)==="local",x=g.radius;let T=0,E=0,M=0;const O=(se,Ae,ce)=>{const me=v[Ae===0?1:3],Me=v[se===0?0:2],Oe=Math.cos(me),be=Math.sin(me),xe=Math.sin(Me),_e=Math.cos(Me),Le=x+ce;T=_e*Oe*Le,E=xe*Oe*Le,M=be*Le},D=w?(()=>{const se=s,Ae=se!=null&&(y[3]>se[3]||y[2]>se[2]||y[1]<se[1]||y[0]<se[0]),ce=tVe(m.isWebMercatorOnPlateCarree,x,b);return(me,Me,Oe)=>{const be=me===0?y[0]:y[2],xe=Me===0?y[1]:y[3],_e=Ae?Ne(be,se[0],se[2]):be,Le=Ae?Ne(xe,se[1],se[3]):xe,Fe=Oe;T=_e*b,E=ce(Le),M=Fe}})():O;let U=0,k=0,H=0,V=0,X=0,q=0,Z=0,ye=0,L=0;const N=w&&m.isWebMercatorOnPlateCarree,z=(se,Ae,ce,me,Me)=>{let Oe=0,be=0,xe=0;if(w){const _e=Ae*b,Le=N?(Math.PI/2-2*Math.atan(Math.exp(-ce/x)))*x:ce*b;Oe=_e-T,be=Le-E,xe=me-M}else{const _e=Cle(se),Le=se.tile,Fe=Le.extent,lt=Le.extentInRadians,ct=(Ae-Fe[0])/(Fe[2]-Fe[0]),Vt=(ce-Fe[1])/(Fe[3]-Fe[1]),Mt=lt[0]*(1-ct)+lt[2]*ct,Zt=_e(Vt),Xt=Math.cos(Zt),vi=Math.sin(Zt),xi=Math.sin(Mt),Ni=Math.cos(Mt),Nt=x+me;Oe=Ni*Xt*Nt-T,be=xi*Xt*Nt-E,xe=vi*Nt-M}switch(Me){case 0:Z+=Oe,ye+=be,L+=xe;break;case 1:V-=Oe,X-=be,q-=xe;break;case 2:Z-=Oe,ye-=be,L-=xe;break;case 3:V+=Oe,X+=be,q+=xe}},W=s??Ple,J=y[0],ee=y[2],ae=y[1],we=y[3],Ie=[we>W[3],ee>W[2],ae<W[1],J<W[0]],Ge=Math.max(J,W[0]),ut=Math.min(ee,W[2]),ot=Math.max(ae,W[1]),at=Math.min(we,W[3]),it=se=>Math.max(W[0],Math.min(W[2],se)),st=se=>Math.max(W[1],Math.min(W[3],se)),li=se=>{const Ae=i.cornerNeighborCornerTiles;U=0,k=0,H=1,V=0,X=0,q=0,Z=0,ye=0,L=0;let ce=1/0;for(let _e=0;_e<4;++_e){const Le=Ae[4*se+_e];ce=Math.min(ce,(Le==null?void 0:Le.level)??1/0)}for(let _e=0;_e<4;++_e){const Le=Ae[4*se+_e];eR[_e]=(Le==null?void 0:Le.level)===ce?Le:null}let me=1,Me=0;for(let _e=0;_e<4;++_e){const Le=eR[_e];Le&&(me=Math.max(me,Le==null?void 0:Le.renderData.geometryState.numVerticesPerSide),Me=Le.extent[2]-Le.extent[0])}const Oe=Me,be=me;Xe(be>1);const xe=Oe/be;for(let _e=0;_e<4;++_e){const Le=eR[(_e+3)%4],Fe=eR[_e%4];if(!Le&&!Fe)continue;const lt=_e===0?1:_e===1?2:_e===2?3:0,ct=_e===0?2:_e===1?3:_e===2?0:1;if(Le&&Fe){const Vt=z7[_e][0]*xe,Mt=z7[_e][1]*xe,Zt=Le.extent,Xt=it(Zt[lt===0||lt===1?2:0]+Vt),vi=st(Zt[lt===0||lt===3?3:1]+Mt),xi=Fe.extent,Ni=it(xi[ct===0||ct===1?2:0]+Vt),Nt=st(xi[ct===0||ct===3?3:1]+Mt),jt=Le.renderData,ti=Fe.renderData,gr=Ps(Xt,vi,jt.geometryState.samplerData),vn=Ps(Ni,Nt,ti.geometryState.samplerData);z(jt,Xt,vi,.5*(gr+vn),_e)}else{const Vt=Le??Fe,Mt=Le?lt:ct,Zt=Vt.extent,Xt=z7[_e],vi=it(Zt[Mt===0||Mt===1?2:0]+Xt[0]*xe),xi=st(Zt[Mt===0||Mt===3?3:1]+Xt[1]*xe),Ni=Vt.renderData,Nt=Ps(vi,xi,Ni.geometryState.samplerData);z(Ni,vi,xi,Nt,_e)}}if(!w){const _e=Math.sqrt(T*T+E*E+M*M);U=T/_e,k=E/_e,H=M/_e}if(w||H*H<.999){const _e=Math.sqrt(V*V+X*X+q*q);V/=_e,X/=_e,q/=_e;const Le=Math.sqrt(Z*Z+ye*ye+L*L);Z/=Le,ye/=Le,L/=Le,U=q*ye-X*L,k=V*L-q*Z,H=X*Z-V*ye;const Fe=1/Math.sqrt(U*U+k*k+H*H);U*=Fe,k*=Fe,H*=Fe}},Y=i.cornerNeighborCornerTiles;for(let se=0;se<4;++se){const Ae=se,ce=(se+1)%4,me=se===0||se===1?1:0,Me=se===0||se===3?1:0,Oe=Ne(me,o,l),be=Ne(Me,a,c),xe=e.getEdgeFirstVertexIndex(Ae),_e=e.getEdgeCount(Ae),Le=se===0||se===3?_e-1:0,Fe=e.getEdgeFirstVertexIndex(ce),lt=e.getEdgeCount(ce),ct=se===0||se===1?lt-1:0;let Vt=-1;for(let Xt=0;Xt<4;++Xt){const vi=Y[4*se+Xt],xi=Y[4*se+Vt];vi&&(Vt===-1||Jg(xi,vi)>0)&&(Vt=Xt)}const Mt=Vt,Zt=Y[4*se+Mt];if(Zt!==f){const Xt=f.level-Zt.level,vi=2**Xt,xi=[Zt.lij[0]+Xt,Zt.lij[1]*vi,Zt.lij[2]*vi],Ni=[xi[1]+vi===f.lij[1],se===0&&(Mt===1||Mt===0&&Zt!==Y[4*se+3])||se===1&&(Mt===0||Mt===1&&Zt!==Y[4*se+2]),xi[1]===f.lij[1]+1,se===2&&(Mt===3||Mt===2&&Zt!==Y[4*se+1])||se===3&&(Mt===2||Mt===3&&Zt!==Y[4*se+0])],Nt=Ni.reduce((Si,is)=>Si+(is?1:0),0);Xe(Nt===1||Nt===2);let jt=-1,ti=-1;const gr=Zt.renderData;if(Nt===1){const Si=Ni.findIndex(Ws=>Ws);Xe(0<=Si&&Si<=3),jt=(Si+2)%4;const is=i.edgeResolutions[Si];ti=f.getNeighborEdgeStartVertexIndex(Si,Zt)*is+is*(Si===0&&se===0||Si===1&&se===0||Si===2&&se===1||Si===3&&se===3?1:0)}else{Xe(Ni[1]||Ni[3]),jt=Ni[1]?3:1;const Si=gr.geometryState.edgeResolutions[jt];ti=se===0||se===3?0:Si}const vn=gr.geometry;{const Si=xe+Le,is=Fe+ct,Ws=vn.getEdgeFirstVertexIndex(jt)+ti,Zo=vn.vertexAttributes,Al=gr.localOrigin;{const Yo=Zo.position,On=Yo.typedBuffer,Zs=Ws*Yo.typedBufferStride,Oi=On[Zs]+Al[0]-r[0],hs=On[Zs+1]+Al[1]-r[1],kn=On[Zs+2]+Al[2]-r[2];dp(Oi,hs,kn,u);const wo=d.position,ge=wo.typedBuffer;{const ar=Si*wo.typedBufferStride;ge[ar]=Oi,ge[ar+1]=hs,ge[ar+2]=kn}{const ar=is*wo.typedBufferStride;ge[ar]=Oi,ge[ar+1]=hs,ge[ar+2]=kn}}const Pl=d.uv0;im(Pl,Si,Oe,be),im(Pl,is,Oe,be);{const Yo=Zo.normalCompressed.typedBuffer,On=Ws*Zo.normalCompressed.typedBufferStride,Zs=d.normalCompressed,Oi=Zs.typedBuffer;{const hs=Si*Zs.typedBufferStride;Oi[hs]=Yo[On],Oi[hs+1]=Yo[On+1]}{const hs=is*Zs.typedBufferStride;Oi[hs]=Yo[On],Oi[hs+1]=Yo[On+1]}}}}else{const Xt=Ie[Ae],vi=Ie[ce];let xi;if(Xt||vi){const ti=Ne(J*(1-me)+ee*me,Ge,ut),gr=Ne(ae*(1-Me)+we*Me,ot,at);xi=Ps(ti,gr,n)}else xi=GDt(Y,se);D(me,Me,xi),li(se);const Ni=T-r[0],Nt=E-r[1],jt=M-r[2];dp(Ni,Nt,jt,u),e.setEdgeVertexFromValuesRawPositionUVNormal(Ae,Le,Ni,Nt,jt,Oe,be,U,k,H),e.setEdgeVertexFromValuesRawPositionUVNormal(ce,ct,Ni,Nt,jt,Oe,be,U,k,H)}}for(let se=0;se<4;++se)eR[se]=null}function GDt(t,e){var a,l;const i=4*e,r=Sle.reduce((c,u)=>{var d;return Math.min(c,((d=t[i+u])==null?void 0:d.level)??1/0)},1/0);fo&&(Xe(!t[i+0]||!t[i+2]||Lee(t[i+0],t[i+2],Ot.SOUTH_WEST)),Xe(!t[i+1]||!t[i+3]||Lee(t[i+1],t[i+3],Ot.NORTH_WEST)));let s=0,n=0;for(let c=0;c<4;++c){const u=t[i+c];if(u&&u.level===r){const d=c===0||c===1,f=c===0||c===3,m=u.extent,g=m[d?0:2],y=m[f?1:3],v=(l=(a=u.renderData)==null?void 0:a.geometryState)==null?void 0:l.samplerData;n+=Ps(g,y,v),s++}}const o=s?n/s:0;return Xe(o!=null),o}function jO(t){const{vao:e,geometry:i}=t,{vertexAttributes:r,edgeVerticesStartIndex:s}=i,n=r.position.typedBuffer;e.vertexBuffers.geometry.setSubData(n,s,s,n.length)}function lVe(t){const{vao:e,geometry:i}=t,{indices:r,indexCount:s,edgeIndicesStartIndex:n}=i;e.indexBuffer.setSubData(r,n,n,s)}let HDt=class{constructor(e,i,r,s,n){this.isNorth=e,this.connectedRowOffset=i,this.connectedOuterEdgeOffset=r,this.rowOffset=s,this.latitudeResolution=n}};const z7=[[0,1],[1,0],[0,-1],[-1,0]],na=new jLt,Ple=FG(-1/0,-1/0,1/0,1/0),eR=[null,null,null,null];function cVe(t,e,i){if(!e)return!1;const r=Jg(t,e);return r>0||r===0&&i>=2}let k5=class{constructor(){this.vertex0Index=0,this.stride=1,this.count=0}getVertexIndex(e){return Xe(0<=e&&e<this.count),this.vertex0Index+this.stride*e}};const Ole=[new k5,new k5,new k5,new k5];function dp(t,e,i,r){t<r[0]?r[0]=t:t>r[3]&&(r[3]=t),e<r[1]?r[1]=e:e>r[4]&&(r[4]=e),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}function uVe(t){const{edgeResolutions:e,numVerticesPerSide:i}=t,r=1+Math.max(...e);return Math.max(i,r)}function hVe(t,e,i,r,s,n){const o=t*s,a=n[o],l=n[o+1],c=n[o+2],u=e*s,d=n[u],f=n[u+1],m=n[u+2],g=i*s,y=n[g],v=n[g+1],b=n[g+2],w=r*s,x=n[w],T=n[w+1],E=n[w+2];return(d-x)*(d-x)+(f-T)*(f-T)+(m-E)*(m-E)>(a-y)*(a-y)+(l-v)*(l-v)+(c-b)*(c-b)}function oA(t,e,i,r,s){t[e]=i,t[e+1]=r,t[e+2]=r,t[e+3]=s,t[e+4]=s,t[e+5]=i}const gV=6;let qDt=class extends vle{constructor(e,i,r,s,n){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=oi(),this._baseUsedMemory=900,this._subtreeGeometryElevationBoundMin=0,this._subtreeGeometryElevationBoundMax=0,this.init(e,i,r,s,n)}init(e,i,r,s,n){super.init(e,i,r,s,n);const o=n.view.renderSpatialReference,a=n.spatialReference,l=o!=null&&s2(o)&&a!=null&&a.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=l;const{isWebMercatorOnPlateCarree:c}=n,u=this._extentInRenderSR,d=this.extent;if(c){const f=qe(d[0],d[1],0);Go(f,Ye.WebMercator,f,Ye.PlateCarree);const m=qe(d[2],d[3],0);Go(m,Ye.WebMercator,m,Ye.PlateCarree),u[0]=f[0],u[1]=f[1],u[2]=m[0],u[3]=m[1]}else for(let f=0;f<4;++f)u[f]=d[f]*l;this.centerAtSeaLevel[0]=.5*(u[0]+u[2]),this.centerAtSeaLevel[1]=.5*(u[1]+u[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(u[2]-u[0],u[3]-u[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,i=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),s=Math.sqrt(i*i+r*r),n=.5*(this.elevationBoundsMax-this.elevationBoundsMin),o=Math.max(s,n);this._center[Sn.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const i=this._aabb(),r=i[0],s=i[1],n=i[2],o=i[3],a=i[4],l=i[5];let c=!0;for(let u=0;u<6;u++){const d=e[u],f=d[0],m=d[1],g=d[2],y=d[3];if(f*(f>0?r:o)+m*(m>0?s:a)+g*(g>0?n:l)+y>=0)return cl.OUTSIDE;c=c&&f*(f<0?r:o)+m*(m<0?s:a)+g*(g<0?n:l)+y<=0}return c?cl.INSIDE:cl.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return mlt(e[0],e[1],Math.min(this.elevationBoundsMin,this._subtreeGeometryElevationBoundMin),e[2],e[3],Math.max(this.elevationBoundsMax,this._subtreeGeometryElevationBoundMax))}intersectsRay(e,i,r,s){return U5[0]=1/i[0],U5[1]=1/i[1],U5[2]=1/i[2],iae(this._aabb(),e,U5,r,s)}createGeometry(){IDt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds(),this.setMemoryDirty()}_updateSubtreeGeometryElevationsBounds(){const e=this._subtreeGeometryElevationBoundMin,i=this._subtreeGeometryElevationBoundMax,r=this.renderData;let s=e,n=i;if(r){const o=r.geometry.boundingBox;s=o[2],n=o[5]}else if(!this.isLeaf){s=1/0,n=-1/0;for(const o of this.children)s=Math.min(s,o._subtreeGeometryElevationBoundMin),n=Math.max(n,o._subtreeGeometryElevationBoundMax)}if(s!==this._subtreeGeometryElevationBoundMin||n!==this._subtreeGeometryElevationBoundMax){this._subtreeGeometryElevationBoundMin=s,this._subtreeGeometryElevationBoundMax=n;const o=this.parent;o==null||o._updateSubtreeGeometryElevationsBounds()}}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){DDt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevations(){FDt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}updateEdgeElevationsAndResolutions(){NDt(this.renderData,this._horizontalScaleFactor),this._updateSubtreeGeometryElevationsBounds()}get horizontalScale(){return this._horizontalScaleFactor}};const U5=C();let WDt=class{constructor(){this.extent=ci(),this.minLevel=0,this.maxLevel=0,this.callback=null}},yV=class extends Ue{constructor(){super(...arguments),this._queries=new ai({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new ai({initialSize:30}),this._queryPool=new ga(WDt)}queryVisibleLevelRange(e,i,r,s){const n=this._queryPool.acquire();np(n.extent,e),n.minLevel=i??-Number.MAX_VALUE,n.maxLevel=r??Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const i=this._queries.data[e];this._queryPool.release(i),i.callback(e>=this._queriesInvPtr),i.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const i=e.level;let r=0;for(;r<this._queriesInvPtr;){const s=this._queries.data[r],n=s.extent;i>=s.minLevel&&i<=s.maxLevel&&n[0]<=e.extent[2]&&n[2]>=e.extent[0]&&n[1]<=e.extent[3]&&n[3]>=e.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}};h([p()],yV.prototype,"updating",null),yV=h([I("esri.views.3d.terrain.ScaleRangeQueries")],yV);function ZDt(t,e,i,r){const s=Math.cos(i);t[0]=Math.cos(e)*s*r,t[1]=Math.sin(e)*s*r,t[2]=Math.sin(i)*r}let YDt=class extends vle{constructor(e,i,r,s,n){super(),this._convexHull=new Array(24),this._boundingSphere=_n(),this._baseUsedMemory=1816,this.init(e,i,r,s,n)}init(e,i,r,s,n){super.init(e,i,r,s,n);const o=this.ellipsoid.radius,a=this.extentInRadians[0],l=this.extentInRadians[1],c=this.extentInRadians[2],u=this.extentInRadians[3],d=Bt(l,u,.5),f=Bt(a,c,.5),m=e===0?0:Math.min(Math.abs(l),Math.abs(u));this._edgeLen=(c-a)*Math.cos(m)*o,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=o-Math.sqrt(o*o-this._edgeLen2/4),ZDt(this.centerAtSeaLevel,f,d,this.ellipsoid.radius),Ce(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)pe(e[Sn.MIDDLE],0,0,0),pe(e[Sn.TOP],0,0,0),pe(e[Sn.BOTTOM],0,0,0),e[Sn.MIDDLE][3]=this.ellipsoid.radius+this.elevationBoundsMax;else{this._updateCenter();const i=e[Sn.MIDDLE],r=this.convexHull;let s=0;for(let n=0;n<8;++n)s=Math.max(s,XDt(i,r,3*n));e[Sn.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibilityStatus(e){if(!cb(e,this._boundingSphere))return cl.OUTSIDE;if(this.lij[0]<10)return cl.INTERSECTS;const i=this.convexHull,r=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<RO;n++){const o=n===Er.NEAR,a=e[n],l=a[0],c=a[1],u=a[2],d=a[3]-(o?r:0);let f=!1;for(let m=0;m<8;++m){const g=3*m;if(l*i[g]+c*i[g+1]+u*i[g+2]+d<0){if(f=!0,!s)break}else s=!1}if(!f)return cl.OUTSIDE}return s?cl.INSIDE:cl.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){EDt(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),fo&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,i=e,r=this.elevationBoundsMin,s=this.elevationBoundsMax,n=this.ellipsoid.radius,o=s;if(this.level===0)pe(i,0,0,0),e[3]=n+o;else{const a=this.extentInRadians,l=.5*(a[0]+a[2]),c=a[1],u=a[3];Tx(p1e,l,c,n),Tx(f1e,l,u,n),Ee(i,p1e,f1e),de(i,i,(n+.5*(r+s))/Wl(i));const d=this.convexHull;let f=0;const m=(y,v)=>{const b=y[0]-d[3*v],w=y[1]-d[3*v+1],x=y[2]-d[3*v+2];return Math.sqrt(b*b+w*w+x*x)};for(let y=0;y<8;++y){const v=m(i,y);f=Math.max(f,v)}const g=f;e[3]=g+2}}_updateConvexHull(){const e=this.extentInRadians,i=this.ellipsoid.radius;if(this.level===0)return;const r=this.elevationBoundsMin,s=this.elevationBoundsMax,n=this._getPatchType(),o=this.surface.isWebMercator,a=o&&n===Jd.HAS_NORTH_POLE,l=o&&n===Jd.HAS_SOUTH_POLE,c=l||a,u=Math.PI/2,d=e[0],f=e[2],m=l?-u:e[1],g=a?u:e[3],y=.5*(d+f),v=r,b=i+(c?Math.min(0,v-1):v),w=(L,N,z)=>Tx(L,N,z,b),x=C(),T=C(),E=C(),M=C();w(x,d,m),w(T,d,g),w(E,f,g),w(M,f,m);const O=(L,N)=>{for(let z=0;z<3;++z)this._convexHull[3*N+z]=L[z]};O(x,0),O(T,1),O(E,2),O(M,3);const D=s,U=i+(c?Math.max(0,D+1):D),k=C(),H=C(),V=C();Tx(H,y,g,b),Tx(V,y,m,b),Ee(k,H,V),Ce(k,k);const X=C(),q=C(),Z=(L,N)=>{Li(q,L,N),Ce(q,q);const z=-Te(L,X)/Te(q,X);Xe(z>=0),de(q,q,z),Ee(L,L,q)};if(2**this.lij[0]>2*this.lij[1]){const L=V,N=C();mt(N,d1e,L),Ce(N,N),mt(X,L,N),Ce(X,X),Xe(Qd(Te(X,L)/Wl(L),0)),Z(x,T),Z(M,E),O(x,0),O(M,3)}else if(2**this.lij[0]!==2*this.lij[1]){const L=H,N=C();mt(N,d1e,L),Ce(N,N),mt(X,N,L),Ce(X,X),Z(T,x),Z(E,M),O(T,1),O(E,2)}const ye=(L,N)=>{const z=U/Te(N,k);for(let W=0;W<3;++W)this._convexHull[3*L+W]=N[W]*z};ye(4,x),ye(5,T),ye(6,E),ye(7,M)}_getPatchType(){const e=this.lij[1],i=e===0,r=e===(1<<this.level)-1;return i?r?Jd.HAS_BOTH_POLES:Jd.HAS_NORTH_POLE:r?Jd.HAS_SOUTH_POLE:Jd.REGULAR}intersectsRay(e,i,r,s){const n=this._boundingSphere,o=n[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=n[0]-e[0],c=n[1]-e[1],u=n[2]-e[2],d=(l*i[0]+c*i[1]+u*i[2])/a,f=i[0]*d-l,m=i[1]*d-c,g=i[2]*d-u;return f*f+m*m+g*g<o*o}getDefaultVerticesPerSide(){return this.level<h1e.length?h1e[this.level]+1:2}updateCornerElevations(){ODt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){ADt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevationsAndResolutions(){PDt(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var Ae;if(!fo||this.level<=2)return;const e=this._boundingSphere,i=e[3],r=e,s=C(),n=this.ellipsoid.radius,o=this.elevationBoundsMin,a=this.elevationBoundsMax,l=n+o,c=1,u=0,d=this._center[Sn.MIDDLE][3],f=this.convexHull,m=(ce,me)=>{for(let Me=0;Me<3;++Me)ce[Me]=f[3*me+Me]};{const ce=C(),me=C(),Me=C(),Oe=C(),be=C(),xe=(_e,Le,Fe,lt)=>{m(me,_e),m(Me,Le),m(Oe,Fe),Li(me,me,Me),Li(Oe,Oe,Me),mt(ce,me,Oe),Ce(ce,ce);const ct=Te(ce,Me);m(be,lt);const Vt=Te(ce,be),Mt=Math.abs(Vt-ct);Xe(Qd(Mt,0),`Non coplanar ${_e},${Le},${Fe},${lt} diff = ${Mt}`)};xe(0,1,2,3),xe(4,5,6,7),xe(0,1,4,5),xe(1,2,5,6),xe(2,3,6,7),xe(3,0,7,4)}const g=go(24),y=(ce,me,Me)=>{const Oe=4*ce;for(let be=0;be<3;++be)g[Oe+be]=me[be];g[Oe+3]=Me},v=C(),b=C(),w=C(),x=C(),T=(ce,me,Me,Oe)=>{m(v,me),m(b,Me),m(w,Oe),Li(v,v,b),Ce(v,v),Li(w,w,b),Ce(w,w),mt(x,v,w),Ce(x,x);const be=Te(x,b);y(ce,x,be)};T(0,0,1,2),T(1,1,0,4),T(2,1,5,2),T(3,3,2,6),T(4,4,0,3),T(5,4,6,5);const E=1,M=(ce,me,Me,Oe)=>{const be=4*ce;return g[be]*me+g[be+1]*Me+g[be+2]*Oe-g[be+3]},O=(ce,me,Me,Oe)=>M(ce,me,Me,Oe)>=-E,D=(ce,me)=>O(ce,me[0],me[1],me[2]),U=2**this.lij[0]>2*this.lij[1],k=(ce,me,Me)=>Math.sqrt(dVe(ce,me,Me,r[0],r[1],r[2]))<i,H=ce=>k(ce[0],ce[1],ce[2]),V=(ce,me)=>k(ce[me],ce[me+1],ce[me+2]),X=this.extentInRadians,q=.5*(X[0]+X[2]),Z=X[1],ye=X[3],L=C(),N=C();Tx(L,q,ye,l),Tx(N,q,Z,l);const z=U?"Upper":"Lower";let W=!0;for(let ce=0;ce<6;++ce){for(let me=0;me<8;++me){const Me=3*me,Oe=O(ce,f[Me],f[Me+1],f[Me+2]);W&&(W=Oe),Xe(Oe,`Tile[${this.lij}] Convex hull point ${me} outside of plane ${ce}`)}Xe(D(ce,N),`Tile[${this.lij}] (${z}) bottom mid outside of plane ${ce}`),Xe(D(ce,L),`Tile[${this.lij}] (${z}) top mid outside of plane ${ce}`)}Xe(W,"Not all convex hull points are inside  convex hull polyhedron"),Xe(H(N),`Tile[${this.lij}] (${z}) bottom mid outside of bounding sphere`),Xe(H(L),`Tile[${this.lij}] (${z}) top mid outside of bounding sphere`);for(let ce=0;ce<8;++ce){const me=V(f,3*ce);Xe(me,`Tile[${this.lij}] Convex hull point ${ce} outside of bounding sphere`)}for(let ce=0;ce<6;++ce)for(let me=0;me<8;++me){const Me=3*me;O(ce,f[Me],f[Me+1],f[Me+2])||console.error(`Tile[${this.lij}] Convex hull point ${me} outside of plane ${ce}`)}const{extentInRadians:J}=this,ee=Math.max(J[2]-J[0],J[3]-J[1]),ae=Math.round(ee*n),{renderData:we}=this;if(!we)return;const{geometry:Ie,geometryState:Ge,localOrigin:ut}=we,ot=(Ae=Ie.vertexAttributes)==null?void 0:Ae.position;if(!ot)return;const at=C(),it=Ie.numVerticesPerSide-2,{indices:st,indexCount:li,edgeVerticesStartIndex:Y,poleVerticesStartIndex:ie}=Ie;if(!st)return;const se=new Set;for(let ce=0;ce<li;++ce){const me=st[ce];if(se.has(me))continue;se.add(me);const Me=me<ie,Oe=me>=Y;let be=!1,xe=-1;if(Oe){let Nt=Y;for(let jt=0;jt<4;++jt){const ti=Ge.edgeResolutions[jt];if(me===Nt||me===Nt+ti-1){be=!0;break}if(Nt+=ti,me<Nt){xe=jt;break}}}const _e=Oe?Ge.edgePeerNeighbors[xe]:null,Le=Oe&&_e&&Jg(this,_e)>0;ot.getVec(me,s),Ee(at,s,ut);const Fe=Wl(at)-n;let lt=0,ct=!1;const Vt=o-Fe,Mt=Fe-a,Zt=Vt>c,Xt=Mt>c,vi=Zt||Xt,xi=()=>{const Nt=Me?"internal":Oe&&!be?"edge":be?"corner":"pole";return`Tile[${this.lij}].vertex[${me}]:${Nt}`+(Zt?"(below)":Xt?"(above)":"")+(Le?"(Neighbor)":"")},Ni=gb(at,r);if(Ni>=i+u){const Nt=Ni-i;vi||(console.error(`${xi()} is out of the bounding sphere by ${Nt.toFixed(0)} / ${i.toFixed(0)}[tol=${u}] h=${Fe.toFixed(0)} / [${o.toFixed(0)}..${a.toFixed(0)}] (${(Nt/i).toFixed(0)})`),ct=!0)}for(let Nt=0;Nt<6;++Nt)if(!O(Nt,at[0],at[1],at[2])){const jt=M(Nt,at[0],at[1],at[2]),ti=me%it,gr=(me-ti)/it;Nt===0&&Vt||Nt===5&&Mt||(console.error(`${xi()} (${ti},${gr})|${it}] is out of the bounding trapezoid plane ${Nt} h=${Math.round(Fe)} / [${Math.round(o)}..${Math.round(a)}] dist=${Math.round(jt)} radii = ${Math.round(i)}/${Math.round(d)}} : maxL = ${ae}`),++lt)}if(ct||lt>0)break}}get convexHull(){return this._convexHull}};const h1e=[128,64,64,32,16,8,8,4];function XDt(t,e,i){return dVe(t[0],t[1],t[2],e[i],e[i+1],e[i+2])}function dVe(t,e,i,r,s,n){const o=r-t,a=s-e,l=n-i;return o*o+a*a+l*l}const Tx=(t,e,i,r)=>{const s=Math.cos(e),n=Math.sin(e),o=Math.cos(i),a=Math.sin(i);t[0]=r*o*s,t[1]=r*o*n,t[2]=r*a},d1e=[0,0,1],p1e=C(),f1e=C();let cf=class extends Ue{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};h([p()],cf.prototype,"fovX",void 0),h([p()],cf.prototype,"fovY",void 0),h([p()],cf.prototype,"relativeWidthLimit",void 0),h([p()],cf.prototype,"relativeHeightLimit",void 0),h([p()],cf.prototype,"maxLod",void 0),h([p()],cf.prototype,"angledSplitBias",void 0),h([p()],cf.prototype,"aboveGround",void 0),h([p()],cf.prototype,"frustum",void 0),cf=h([I("esri.views.3d.terrain.SplitLimits")],cf);const JDt=Ds().vec3f($.POSITION).vec2i16($.UV0).vec2i16($.NORMALCOMPRESSED,{glNormalized:!0});let QDt=class{constructor(e){this._storage=new DN((i,r)=>e.newCache(i,r),"TileGeometry")}acquire(e){const r=Math.ceil(e/4)*4,s=this._storage,n=KDt(r),o=s.pop(n);if(o)return o;const a=JDt.createBuffer(r);return a.release=()=>s.put(n,a),a}clear(){this._storage.clear()}destroy(){this._storage.destroy()}};function KDt(t){return t.toString()}var Qe;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Qe||(Qe={}));const Dee={normal:Qe.Normal,average:Qe.Average,lighten:Qe.Lighten,lighter:Qe.Lighter,screen:Qe.Screen,plus:Qe.Plus,"color-dodge":Qe.ColorDodge,darken:Qe.Darken,multiply:Qe.Multiply,"color-burn":Qe.ColorBurn,overlay:Qe.Overlay,"soft-light":Qe.SoftLight,"hard-light":Qe.HardLight,"vivid-light":Qe.VividLight,hue:Qe.Hue,saturation:Qe.Saturation,luminosity:Qe.Luminosity,color:Qe.Color,difference:Qe.Difference,exclusion:Qe.Exclusion,minus:Qe.Minus,invert:Qe.Invert,reflect:Qe.Reflect,"destination-over":Qe.DestinationOver,"destination-atop":Qe.DestinationAtop,"destination-in":Qe.DestinationIn,"destination-out":Qe.DestinationOut,"source-atop":Qe.SourceAtop,"source-in":Qe.SourceIn,"source-out":Qe.SourceOut,xor:Qe.Xor};function eNt(t){return t===Qe.DestinationOver||t===Qe.DestinationAtop||t===Qe.DestinationIn||t===Qe.DestinationOut||t===Qe.SourceAtop||t===Qe.SourceIn||t===Qe.SourceOut||t===Qe.Xor}let pVe=class extends uc{constructor(){super(...arguments),this.blendMode=Qe.Normal}};h([j({count:Qe.COUNT})],pVe.prototype,"blendMode",void 0);var nl;(function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"})(nl||(nl={}));var Ln;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(Ln||(Ln={}));var Af;(function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"})(Af||(Af={}));let lL=class extends pVe{constructor(){super(...arguments),this.output=Ln.Composite,this.baseOpacityMode=nl.NotRequired,this.premultipliedSource=Af.Off}};h([j({count:Ln.COUNT})],lL.prototype,"output",void 0),h([j({count:nl.COUNT})],lL.prototype,"baseOpacityMode",void 0),h([j()],lL.prototype,"premultipliedSource",void 0);let fVe=class extends Ur{constructor(){super(...arguments),this.scale=1,this.offset=m2}};function mVe(t){t.attributes.add($.POSITION,"vec2"),t.attributes.add($.UV0,"vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.uniforms.add(new tt("scale",e=>e.scale),new Hr("offset",e=>e.offset)).code.add(S`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}function tNt(t,e){const i=e.blendMode;i!==Qe.Normal&&(i===Qe.Reflect&&t.code.add(S`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==Qe.ColorDodge&&i!==Qe.VividLight||t.code.add(S`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==Qe.ColorBurn&&i!==Qe.VividLight||t.code.add(S`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===Qe.Overlay&&t.code.add(S`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===Qe.HardLight&&t.code.add(S`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===Qe.SoftLight&&t.code.add(S`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===Qe.VividLight&&t.code.add(S`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==Qe.Hue&&i!==Qe.Saturation&&i!==Qe.Color&&i!==Qe.Luminosity||(t.code.add(S`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==Qe.Hue&&i!==Qe.Saturation||t.code.add(S`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(S`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===Qe.Multiply?S`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Average?S`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Lighten?S`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Darken?S`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Lighter?S`return vec4(cl * ol + cb * ob, ol + ob);`:i===Qe.Plus?S`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===Qe.Minus?S`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===Qe.Screen?S`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Difference?S`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Invert?S`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Qe.DestinationOver?S`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===Qe.DestinationAtop?S`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===Qe.DestinationOut?S`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===Qe.SourceAtop?S`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Qe.SourceOut?S`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===Qe.Xor?S`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===Qe.DestinationIn?S`return vec4(cb * ob * ol, ol * ob);`:i===Qe.SourceIn?S`return vec4(cl * ol * ob, ol * ob);`:i===Qe.Hue?S`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Saturation?S`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Color?S`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Luminosity?S`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Exclusion?S`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Reflect?S`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.ColorDodge?S`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.ColorBurn?S`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Overlay?S`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.SoftLight?S`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.HardLight?S`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.VividLight?S`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:S``}
    }
  `))}function gVe(t,e){const i=e.output===Ln.GridComposite,r=e.output===Ln.ColorComposite,s=e.output===Ln.GroupBackgroundComposite,n=e.output===Ln.Composite,o=e.baseOpacityMode===nl.Required,a=t.fragment;o&&a.uniforms.add(new tt("baseOpacity",d=>d.baseOpacity)),i?a.include(xle):r?a.uniforms.add(new Wt("backgroundColor",d=>d.backgroundColor)):n&&a.uniforms.add(new xt("fboColor",d=>d.fboTexture));const l=e.blendMode!==Qe.Normal,c=e.premultipliedSource===Af.On,u=!l&&!c&&(n&&!o||s);a.include(tNt,e),a.code.add(S`
    vec4 getBackground(vec2 uv) {
      return ${o?S`baseOpacity *`:""} ${s?S`vec4(0.0, 0.0, 0.0, 0.0)`:r?S`vec4(backgroundColor, 1.0)`:i?S`vec4(gridColor(uv), 1.0)`:S`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec2 bgUV, vec4 colorLayer, float opacity) {
      ${l?S`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec4 bgColor = getBackground(bgUV);
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:S`
          float composeAlpha = colorLayer.a * opacity;
          ${u?S`return colorLayer * opacity;`:S`
            vec4 bgColor = getBackground(bgUV);
            return bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}var uw;function yVe(t){const e=new Hi,i=e.fragment;if(e.include(mVe),t.background===uw.Only){const r=t.output===Ln.ColorComposite;return r?i.uniforms.add(new Wt("backgroundColor",s=>s.backgroundColor)):i.include(xle),i.code.add(S`
      void main() {
        fragColor = vec4(${r?S`backgroundColor`:S`gridColor(uv)`}, 1.0);
      }
    `),e}return e.include(gVe,t),i.uniforms.add(new xt("tex",r=>r.texture),new tt("opacity",r=>r.opacity)).code.add(S`void main() {
fragColor = blendLayers(uv, texture(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(uw||(uw={}));const iNt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return uw},build:yVe},Symbol.toStringTag,{value:"Module"}));let rNt=class extends fVe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Nn}},_Ve=class vVe extends Ki{initializeProgram(e){return new er(e.rctx,vVe.shader.get().build(this.configuration),Pi)}initializePipeline(){return Kt({blending:rd(Be.ONE,Be.ONE_MINUS_SRC_ALPHA),colorWrite:ui})}};_Ve.shader=new qi(iNt,()=>oe(()=>Promise.resolve().then(()=>V9t),void 0));let bVe=class extends lL{constructor(){super(...arguments),this.background=uw.BelowLayer}};h([j()],bVe.prototype,"background",void 0);let Nee=class{constructor(e,i,r,s,n,o){this.texture=e,this.type=i,e.retain(),this.offsetAndScale=ri(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=qe(s,n,o)}destroy(){this.texture.release()}};var WS,O2;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(WS||(WS={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(O2||(O2={}));var Fee,Q1,Rj,If,kee,Ij,Uee,K1,Vee;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(Fee||(Fee={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(Q1||(Q1={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(Rj||(Rj={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(If||(If={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(kee||(kee={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(Ij||(Ij={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(Uee||(Uee={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(K1||(K1={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(Vee||(Vee={}));let Gp=class{};Gp.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Q1.VISIBLE}},Gp.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Q1.VISIBLE}},Gp.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Q1.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:qK.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:WK.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},Gp.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Q1.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:Rj.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:Ij.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:If.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:Ij.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:kee.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:If.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:Uee.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[Vee.HORIZONTAL]}},Gp.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Q1.VISIBLE}},Gp.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},Gp.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:K1.MAP}},Gp.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:K1.MAP},"line-width":{type:"number",minimum:0,default:1}},Gp.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:K1.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:K1.MAP}},Gp.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},Gp.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:K1.MAP}};function sNt(t,e,i,r,s,n){const{iconRotationAlignment:o,textRotationAlignment:a,iconTranslate:l,iconTranslateAnchor:c,textTranslate:u,textTranslateAnchor:d}=r;let f=0;for(const m of t.colliders){const[g,y]=m.partIndex===0?l:u,v=m.partIndex===0?c:d,b=m.minLod<=n&&n<=m.maxLod;f+=b?0:1,m.enabled=b,m.xScreen=m.xTile*s[0]+m.yTile*s[3]+s[6],m.yScreen=m.xTile*s[1]+m.yTile*s[4]+s[7],v===K1.MAP?(m.xScreen+=i*g-e*y,m.yScreen+=e*g+i*y):(m.xScreen+=g,m.yScreen+=y),If.VIEWPORT===(m.partIndex===0?o:a)?(m.dxScreen=m.dxPixels,m.dyScreen=m.dyPixels):(m.dxScreen=i*(m.dxPixels+m.width/2)-e*(m.dyPixels+m.height/2)-m.width/2,m.dyScreen=e*(m.dxPixels+m.width/2)+i*(m.dyPixels+m.height/2)-m.height/2)}t.colliders.length>0&&f===t.colliders.length&&(t.unique.show=!1)}let nNt=class{constructor(e,i,r,s,n,o){this._symbols=e,this._styleRepository=s,this._zoom=n,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new RUe(i,r,sLt),this._si=Math.sin(Math.PI*o/180),this._co=Math.cos(Math.PI*o/180);for(const a of e)for(const l of a.symbols)this._allNeededMatrices.has(l.tile)||this._allNeededMatrices.set(l.tile,PUe(l.tile.transforms.tileUnitsToPixels))}work(e){const i=this._gridIndex;function r(n){const o=n.xScreen+n.dxScreen,a=n.yScreen+n.dyScreen,l=o+n.width,c=a+n.height,[u,d,f,m]=i.getCellSpan(o,a,l,c);for(let g=d;g<=m;g++)for(let y=u;y<=f;y++){const v=i.cells[g][y];for(const b of v){const w=b.xScreen+b.dxScreen,x=b.yScreen+b.dyScreen,T=w+b.width,E=x+b.height;if(!(l<w||o>T||c<x||a>E))return!0}}return!1}const s=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const n=this._symbols[this._currentLayerCursor],o=this._getProperties(n.styleLayerUID);for(;this._currentSymbolCursor<n.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-s>e)return!1;const a=n.symbols[this._currentSymbolCursor];if(!a.unique.show)continue;sNt(a,this._si,this._co,o,this._allNeededMatrices.get(a.tile),this._zoom);const l=a.unique;if(!l.show)continue;const{iconAllowOverlap:c,iconIgnorePlacement:u,textAllowOverlap:d,textIgnorePlacement:f}=o;for(const m of a.colliders){if(!m.enabled)continue;const g=l.parts[m.partIndex];g.show&&!(m.partIndex?d:c)&&r(m)&&(m.hard?l.show=!1:g.show=!1)}if(l.show)for(const m of a.colliders){if(!m.enabled||(m.partIndex?f:u)||!l.parts[m.partIndex].show)continue;const g=m.xScreen+m.dxScreen,y=m.yScreen+m.dyScreen,v=g+m.width,b=y+m.height,[w,x,T,E]=this._gridIndex.getCellSpan(g,y,v,b);for(let M=x;M<=E;M++)for(let O=w;O<=T;O++)this._gridIndex.cells[M][O].push(m)}}}return!0}_getProperties(e){const i=this._styleProps.get(e);if(i)return i;const r=this._zoom,s=this._styleRepository.getStyleLayerByUID(e),n=s.getLayoutValue("symbol-placement",r)!==Rj.POINT;let o=s.getLayoutValue("icon-rotation-alignment",r);o===If.AUTO&&(o=n?If.MAP:If.VIEWPORT);let a=s.getLayoutValue("text-rotation-alignment",r);a===If.AUTO&&(a=n?If.MAP:If.VIEWPORT);const l=s.getPaintValue("icon-translate",r),c=s.getPaintValue("icon-translate-anchor",r),u=s.getPaintValue("text-translate",r),d=s.getPaintValue("text-translate-anchor",r),f={iconAllowOverlap:s.getLayoutValue("icon-allow-overlap",r),iconIgnorePlacement:s.getLayoutValue("icon-ignore-placement",r),textAllowOverlap:s.getLayoutValue("text-allow-overlap",r),textIgnorePlacement:s.getLayoutValue("text-ignore-placement",r),iconRotationAlignment:o,textRotationAlignment:a,iconTranslateAnchor:c,iconTranslate:l,textTranslateAnchor:d,textTranslate:u};return this._styleProps.set(e,f),f}};function oNt(t,e){if(t.priority-e.priority)return t.priority-e.priority;const i=t.tile.key,r=e.tile.key;return i.world-r.world?i.world-r.world:i.level-r.level?i.level-r.level:i.row-r.row?i.row-r.row:i.col-r.col?i.col-r.col:t.xTile-e.xTile?t.xTile-e.xTile:t.yTile-e.yTile}let aNt=class{get running(){return this._running}constructor(e,i,r,s,n,o){this._visibleTiles=e,this._symbolRepository=i,this._createCollisionJob=r,this._assignTileSymbolsOpacity=s,this._symbolLayerSorter=n,this._isLayerVisible=o,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}setScreenSize(e,i){this._screenWidth===e&&this._screenHeight===i||this.restart(),this._screenWidth=e,this._screenHeight=i}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const i=performance.now();if(!this._selectionJob.work(e)||(this._selectionJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const i=performance.now();if(!this._collisionJob.work(e)||(this._collisionJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const i=performance.now();if(!this._opacityJob.work(e)||(this._opacityJobCompleted=!0,(e=Math.max(0,e-(performance.now()-i)))===0))return!1}return this._running=!1,!0}_createSelectionJob(){const e=this._symbolRepository.uniqueSymbols;for(let l=0;l<e.length;l++){const c=e[l];for(let u=0;u<c.uniqueSymbols.length;u++){const d=c.uniqueSymbols[u];for(const f of d.tileSymbols)f.selectedForRendering=!1}}const i=[];let r=0,s=0;const n=this._isLayerVisible;function o(l){let c;const u=performance.now();for(;s<e.length;s++,r=0){const d=e[s],f=d.styleLayerUID;if(!n(f)){i[s]||(i[s]={styleLayerUID:f,symbols:[]});continue}i[s]=i[s]||{styleLayerUID:f,symbols:[]};const m=i[s];for(;r<d.uniqueSymbols.length;r++){if(c=d.uniqueSymbols[r],r%100==99&&performance.now()-u>l)return!1;let g=null,y=!1,v=!1;for(const b of c.tileSymbols)if(!v||!y){const w=b.tile;(!g||w.isCoverage||w.neededForCoverage&&!y)&&(g=b,(w.neededForCoverage||w.isCoverage)&&(v=!0),w.isCoverage&&(y=!0))}if(g.selectedForRendering=!0,v){m.symbols.push(g),c.show=!0;for(const b of c.parts)b.show=!0}else c.show=!1}}for(const d of i)d.symbols.sort(oNt);return!0}const a=this._symbolLayerSorter;return{work:o,get sortedSymbols(){return i.sort(a)}}}_createOpacityJob(){const e=this._assignTileSymbolsOpacity,i=this._visibleTiles;let r=0;function s(n,o){const a=n.symbols;for(const[l,c]of a)lNt(c,o);e(n,o);for(const l of n.childrenTiles)s(l,o)}return{work(n){const o=performance.now();for(;r<i.length;r++){if(performance.now()-o>n)return!1;const a=i[r];a.parentTile==null&&s(a,performance.now())}return!0}}}};function lNt(t,e){for(const i of t){const r=i.unique;for(const s of r.parts){const n=s.targetOpacity>.5?1:-1;s.startOpacity+=n*((e-s.startTime)/Mee),s.startOpacity=Math.min(Math.max(s.startOpacity,0),1),s.startTime=e,s.targetOpacity=r.show&&s.show?1:0}}}const cNt=32,uNt=8,hNt=64,dNt=20;let pNt=class{constructor(e,i,r){this.tileCoordRange=e,this._visibleTiles=i,this._createUnique=r,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){return this._uniqueSymbolLayerArray==null&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}get uniqueSymbolsReferences(){return this._uniqueSymbolsReferences}add(e,i){this._uniqueSymbolLayerArray=null;let r=this._tiles.get(e.id);r||(r={symbols:new Map},this._tiles.set(e.id,r));const s=new Map;if(i)for(const a of i)r.symbols.has(a)&&(s.set(a,r.symbols.get(a)),r.symbols.delete(a));else for(const[a,l]of e.layerData)r.symbols.has(a)&&(s.set(a,r.symbols.get(a)),r.symbols.delete(a));this._removeSymbols(s);const n=e.symbols,o=new Map;for(const[a,l]of n){let c=l.length;if(c>=cNt){let u=this.tileCoordRange;do u/=2,c/=4;while(c>uNt&&u>hNt);const d=new RUe(this.tileCoordRange,this.tileCoordRange,u);o.set(a,{flat:l,index:d}),r.symbols.set(a,{flat:l,index:d});for(const f of l)d.getCell(f.xTile,f.yTile).push(f)}else o.set(a,{flat:l}),r.symbols.set(a,{flat:l})}this._addSymbols(e.key,n)}deleteStyleLayers(e){this._uniqueSymbolLayerArray=null;for(const[i,r]of this._tiles){const s=new Map;for(const n of e)r.symbols.has(n)&&(s.set(n,r.symbols.get(n)),r.symbols.delete(n));this._removeSymbols(s),r.symbols.size===0&&this._tiles.delete(i)}}removeTile(e){this._uniqueSymbolLayerArray=null;const i=this._tiles.get(e.id);if(!i)return;const r=new Map;for(const[s,n]of e.symbols)i.symbols.has(s)&&(r.set(s,i.symbols.get(s)),i.symbols.delete(s));this._removeSymbols(r),i.symbols.size===0&&this._tiles.delete(e.id)}querySymbols(e,i,r,s){const n=[],o=this.uniqueSymbols;for(const a of o){const l=a.styleLayerUID,c=a.uniqueSymbols;for(const u of c){const d=u.tileSymbols.find(f=>f.selectedForRendering);d&&K3t(d,e,i*(window.devicePixelRatio||1),r)&&n.push({vtlSymbol:d,styleLayerUID:l,tileKey:d.tile.key})}}return n}_removeSymbols(e){for(const[i,{flat:r}]of e)for(const s of r){const n=s.unique,o=n.tileSymbols,a=o.length-1;for(let l=0;l<a;l++)if(o[l]===s){o[l]=o[a];break}if(o.length=a,a===0){const l=this._uniqueSymbolsReferences.get(i);l.delete(n),l.size===0&&this._uniqueSymbolsReferences.delete(i)}s.unique=null}}_addSymbols(e,i){if(i.size===0)return;const r=this._visibleTiles;for(const s of r)s.parentTile||s.key.world!==e.world||s.key.level===e.level&&!s.key.equals(e)||this._matchSymbols(s,e,i);for(const[s,n]of i)for(const o of n)if(o.unique==null){const a=this._createUnique();o.unique=a,a.tileSymbols.push(o);let l=this._uniqueSymbolsReferences.get(s);l||(l=new Set,this._uniqueSymbolsReferences.set(s,l)),l.add(a)}}_matchSymbols(e,i,r){if(e.key.level>i.level){const n=e.key.level-i.level;if(e.key.row>>n!==i.row||e.key.col>>n!==i.col)return}if(i.level>e.key.level){const n=i.level-e.key.level;if(i.row>>n!==e.key.row||i.col>>n!==e.key.col)return}if(i.equals(e.key)){for(const n of e.childrenTiles)this._matchSymbols(n,i,r);return}const s=new Map;for(const[n,o]of r){const a=[];for(const d of o){const f=Yve(this.tileCoordRange,d.xTile,i.level,i.col,e.key.level,e.key.col),m=Yve(this.tileCoordRange,d.yTile,i.level,i.row,e.key.level,e.key.row);f>=0&&f<this.tileCoordRange&&m>=0&&m<this.tileCoordRange&&a.push({symbol:d,xTransformed:f,yTransformed:m})}const l=[],c=(e.key.level<i.level?1:1<<e.key.level-i.level)+dNt,u=this._tiles.get(e.id).symbols.get(n);if(u){const d=u.flat;for(const f of a){let m,g=!1;const y=f.xTransformed,v=f.yTransformed;m=u.index!=null?u.index.getCell(y,v):d;const b=f.symbol,w=b.hash;for(const x of m)if(w===x.hash&&Math.abs(y-x.xTile)<=c&&Math.abs(v-x.yTile)<=c){const T=x.unique;b.unique=T,T.tileSymbols.push(b),g=!0;break}g||l.push(b)}}l.length>0&&s.set(n,l)}for(const n of e.childrenTiles)this._matchSymbols(n,i,s)}_createUniqueSymbolLayerArray(){const e=this._uniqueSymbolsReferences,i=new Array(e.size);let r,s=0;for(const[n,o]of e){const a=new Array(o.size);r=0;for(const l of o)a[r++]=l;i[s]={styleLayerUID:n,uniqueSymbols:a},s++}return i}};function fNt(t,e){const i=t.transforms.tileUnitsToPixels,r=PG(e),s=Math.cos(r),n=Math.sin(r),o=Math.ceil(512*(Math.abs(n)+Math.abs(s)));l6(jm),PP(jm,jm,[o/2,o/2]),c6(jm,jm,r),PP(jm,jm,[-256,-256]),iN(jm,jm,[1/8,1/8,1]),t.transforms.tileUnitsToPixels=jm;const a=[],l=new pNt(4096,a,()=>new Y3t),c=new aNt(a,l,(u,d,f)=>new nNt(u,d,f,t.styleRepository,t.key.level,e),(u,d)=>{J3t(u,d,!1)},()=>0,u=>{const d=t.styleRepository.getStyleLayerByUID(u).getLayoutProperty("visibility");return!d||d.getValue()!==Q1.NONE});a.push(t),l.add(t),c.setScreenSize(o,o),c.continue(1/0),l.removeTile(t),t.transforms.tileUnitsToPixels=i}const jm=qS();let mNt=class extends IUe{_createTransforms(){return{displayViewScreenMat3:qS(),tileMat3:qS()}}},gNt=class{constructor(){this._candidateTiles=[]}schedule(e){this._candidateTiles.includes(e)||this._candidateTiles.push(e)}reshuffle(e){const i=[];for(const r of this._candidateTiles)e>0?(r.reshuffle(),e--):i.push(r);this._candidateTiles=i}};const yNt=.125;let _Nt=class{constructor(){this._renderParams={reshuffleManager:new gNt,context:null,drawPhase:1,state:new vNt,stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null},this._backgroundTile=new mNt(new F_(0,0,0,0),0,0,0,512,512,4096,4096),this._heading=0,this._declutteredForHeading=new WeakMap}dispose(){this._renderParams=null}renderBackground(e,i,r,s,n,o,a,l,c,u){const d=this._backgroundTile;this._updateRenderParameters(e,i,d,r,n,o,a,l,c,u),this._renderParams.stencilSymbols=!1,r.drawBackground(this._renderParams,d,s)}renderContent(e,i,r,s,n,o,a,l,c,u,d,f){this._declutter(r),s.forAll(g=>this._declutter(g.sourceLayerInfo.data)),this._stencilSymbols(e,i,r,s,n,o,a,Math.round(1/l),c,u,d,f);let m=1;r.stencilRef=m++,e.setStencilFunction(xr.EQUAL,r.stencilRef,255),this._render(e,i,r,n,o,a,l,c,u,d,f),s.forAll(g=>{g.sourceLayerInfo.data.stencilRef=m++,this._renderSymbols(e,g.sourceLod,g.sourceLayerInfo.data,n,o,a,Math.round(1/l),g.offset,u,d,f)})}_stencilSymbols(e,i,r,s,n,o,a,l,c,u,d,f){let m=1;r.stencilRef=m++,e.setDepthTestEnabled(!1),e.setDepthWriteEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(Cs.KEEP,Cs.KEEP,Cs.REPLACE),e.setStencilWriteMask(255),e.setStencilFunction(xr.ALWAYS,r.stencilRef,255),this._stencilTileSymbols(e,i,r,n,o,a,l,c,u,d,f);for(const g of s.toArray()){const{sourceLod:y,offset:v,sourceLayerInfo:b}=g;b.data.stencilRef=m++,e.setStencilFunction(xr.ALWAYS,b.data.stencilRef,255),this._stencilTileSymbols(e,y,b.data,n,o,a,l,v,u,d,f)}e.setStencilWriteMask(0),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!0),e.setColorMask(!0,!0,!0,!0)}_renderSymbols(e,i,r,s,n,o,a,l,c,u,d){e.setStencilFunction(xr.EQUAL,r.stencilRef,255),this._render(e,i,r,s,n,o,a,l,c,u,d,Fee.SYMBOL)}_render(e,i,r,s,n,o,a,l,c,u,d,f){this._updateRenderParameters(e,i,r,s,o,a,l,c,u,d),this._renderParams.stencilSymbols=!1,s.drawTile(this._renderParams,r,n,f)}_stencilTileSymbols(e,i,r,s,n,o,a,l,c,u,d){this._updateRenderParameters(e,i,r,s,o,a,l,c,u,d),this._renderParams.stencilSymbols=!0,r.triangleCount=0,s.drawSymbols(this._renderParams,r,n)}_updateRenderParameters(e,i,r,s,n,o,a,l,c,u){"type"in r&&r.type==="vector-tile"&&!r.stage&&r.attachWithContext(e);const d=i[0]-n.getLevelShift(i[0]),f=this._renderParams;f.context=e,f.painter=s,f.glyphMosaic=s.glyphMosaic,f.spriteMosaic=s.spriteMosaic,f.pixelRatio=c*u,f.displayLevel=d,f.requiredLevel=d;const m=n.getScale(i[0]),[g,y]=n.getOffset(i,o*m),v=yNt*o*m/l,b=r.transforms.displayViewScreenMat3;b[0]=v,b[4]=-v,b[6]=-1-g-a[0]*o*2,b[7]=1+y+(1-a[1])*o*2-2;const w=f.state,x=l/u;w.size[0]=x,w.size[1]=x,w.pixelRatio=u,w.rotation=(360-this._heading)%360;const T=2/x;ene(w.displayViewMat3,T,0,0,0,-T,0,-1,1,1);const E=l6(w.displayMat3),M=PG(this._heading);PP(E,E,[x/2,x/2]),c6(E,E,M),PP(E,E,[-x/2,-x/2]),AP(E,w.displayViewMat3,E)}updateHeading(e){this._heading=e}_declutter(e){this._declutteredForHeading.get(e)!==this._heading&&(fNt(e,(360-this._heading)%360),this._declutteredForHeading.set(e,this._heading))}},vNt=class{constructor(){this.size=[0,0],this.pixelRatio=1,this.rotation=0,this.displayMat3=Kr(),this.displayViewMat3=Kr(),this.transform=null,this.inverseTransform=null,this.viewMat2d=null,this.viewMat3=null,this.id=0,this.extent=null,this.center=null,this.scale=1,this.resolution=0,this.worldScreenWidth=0,this.spatialReference=null,this.viewpoint=null,this.getScreenTransform=null,this.toMap=null,this.toScreen=null,this.clone=null,this.copy=null,this.toJSON=null}};function bNt(t){t.fragment.uniforms.add(new xt("u_colormap",e=>e.u_colormap),new tt("u_colormapOffset",e=>e.colormap.u_colormapOffset),new tt("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new tt("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(S`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function wNt(t){t.fragment.uniforms.add(new xt("u_transformGrid",e=>e.u_transformGrid),new Hr("u_transformSpacing",e=>e.common.u_transformSpacing),new Hr("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(S`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let xNt=class extends fVe{constructor(e,i,r){super(),this.common=e,this.u_image=i,this.u_transformGrid=r}};function TNt(t,e){t.include(wNt),t.fragment.uniforms.add(new xt("u_image",r=>r.u_image),new ny("u_flipY",r=>r.common.u_flipY),new ny("u_applyTransform",r=>r.common.u_applyTransform));const{requireBilinearWithNN:i}=e;i&&t.fragment.uniforms.add(new Hr("u_srcImageSize",r=>r.common.u_srcImageSize)),t.fragment.code.add(S`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),i?t.fragment.code.add(S`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(S`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}let F8=class extends xNt{constructor(e,i,r,s,n,o){super(e,s,n),this.colormap=i,this.symbolizer=r,this.u_colormap=o,this.backgroundColor=Nn,this.fboTexture=null,this.baseOpacity=1}},wVe=class extends F8{},xVe=class extends F8{};function TVe(t){const e=new Hi;return e.include(mVe),e.include(TNt,t),e.include(bNt,t),e.include(gVe,t),e.fragment.code.add(S`vec4 applyBackgroundBlend(vec4 layerColor) {
return blendLayers(vuv, layerColor, u_opacity);
}`),t.colorizerType===WS.Stretch?ENt(e,t):t.colorizerType===WS.Lut?SNt(e):t.colorizerType===WS.Hillshade&&CNt(e,t),e}function SNt(t){t.fragment.code.add(S`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function ENt(t,e){t.fragment.uniforms.add(new UO("u_bandCount",r=>r.symbolizer.u_bandCount),new sc("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new sc("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new sc("u_factor",r=>r.symbolizer.u_factor,3),new tt("u_minOutput",r=>r.symbolizer.u_minOutput),new tt("u_maxOutput",r=>r.symbolizer.u_maxOutput),new ny("u_useGamma",r=>r.symbolizer.u_useGamma),new sc("u_gamma",r=>r.symbolizer.u_gamma,3),new sc("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new tt("u_opacity",r=>r.common.u_opacity)),t.fragment.code.add(S`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=e.applyColormap?S`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:S`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(S`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===O2.Noop?S`
        fragColor = applyBackgroundBlend(currentPixel);`:S`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function CNt(t,e){const i=t.fragment;i.uniforms.add(new xt("u_image",s=>s.u_image),new UO("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new sc("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new sc("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new sc("u_cosZs",s=>s.symbolizer.u_cosZs,6),new sc("u_weights",s=>s.symbolizer.u_weights,6),new Hr("u_factor",s=>s.symbolizer.u_factor),new tt("u_minValue",s=>s.symbolizer.u_minValue),new tt("u_maxValue",s=>s.symbolizer.u_maxValue),new Hr("u_srcImageSize",s=>s.common.u_srcImageSize)),i.include(Fy),i.code.add(S`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),i.code.add(S`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=e.applyColormap?S`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:S`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.code.add(S`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}const MNt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:xVe,ColorizerStretchUniforms:wVe,ColorizerUniforms:F8,build:TVe},Symbol.toStringTag,{value:"Module"}));let SVe=class EVe extends Ki{initializeProgram(e){return new er(e.rctx,EVe.shader.get().build(this.configuration),Pi)}initializePipeline(){return Kt({blending:rd(Be.ONE,Be.ONE_MINUS_SRC_ALPHA),colorWrite:ui})}};SVe.shader=new qi(MNt,()=>oe(()=>Promise.resolve().then(()=>z9t),void 0));let GI=class extends lL{constructor(){super(...arguments),this.colorizerType=WS.Stretch,this.stretchType=O2.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};h([j({count:WS.COUNT})],GI.prototype,"colorizerType",void 0),h([j({count:O2.COUNT})],GI.prototype,"stretchType",void 0),h([j()],GI.prototype,"applyColormap",void 0),h([j()],GI.prototype,"requireBilinearWithNN",void 0);let m1e=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const i=this._fbos.get(e);if(i)return i;const r=new ky(this._rctx,new es(e),new LIe(La.DEPTH24_STENCIL8,e));return this._fbos.set(e,r),r}};const ANt=()=>ne.getLogger("esri.views.3d.terrain");let PNt=class{constructor(e,i){this._rctx=e,this._techniques=i,this._fbos=[],this._vectorTileHelper=new _Nt,this._bindParameters=new O6(null,null),this._blendLayersTechniqueConfig=new bVe,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=Ny(this._rctx,uN)}dispose(){this._fbos.forEach(Ut),this._fbos=null,this._vtFBO=Ut(this._vtFBO),this._vaoQuad=Ut(this._vaoQuad),this._vectorTileHelper=Ut(this._vectorTileHelper),this._backgroundTechnique=hi(this._backgroundTechnique),this._applyOpacityTechnique=hi(this._applyOpacityTechnique),this._blendLayersTechnique=hi(this._blendLayersTechnique)}updateHeading(e){var i;(i=this._vectorTileHelper)==null||i.updateHeading(e)}_getBlendLayersTechnique(e,i,r,s=Af.Off,n=uw.BelowLayer){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=r,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._blendLayersTechnique=this._techniques.releaseAndAcquire(_Ve,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,i){const r=this._getBlendLayersTechnique(Qe.Normal,i?Ln.ColorComposite:Ln.GridComposite,nl.NotRequired,Af.Off,uw.Only),s=this._rctx.bindTechnique(r,this._bindParameters,e);this._render(s)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Mi.TRIANGLE_STRIP,0,y_(this._vaoQuad,"geometry"))}drawGroup(e,i,r,s,n=Af.On){i===Ln.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture),e.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);const o=e.baseOpacity<1?nl.Required:nl.NotRequired,a=this._getBlendLayersTechnique(s,i,o,n),l=this._rctx.bindTechnique(a,this._bindParameters,e);this._render(l)}drawImageData(e,i,r,s,n=Af.Off){if(e.texture==null)return;const o=e.baseOpacity<1?nl.Required:nl.NotRequired;e.fboTexture=i===Ln.GroupBackgroundComposite||s===Qe.Normal&&o===nl.NotRequired&&n===Af.Off?null:this.switch(r).colorTexture;const a=this._getBlendLayersTechnique(s,i,o,n),l=this._rctx.bindTechnique(a,this._bindParameters,e);this._render(l)}drawRasterData(e,i,r,s,n){const o=n.sourceLayerInfo.data;if(!o.source||(n.tile.surface.layerViewByIndex(n.layerIndex,ei.MAP).ensureSymbolizerParameters(o),!o.bind(this._rctx)))return;const a=e.baseOpacity<1?nl.Required:nl.NotRequired;e.fboTexture=s===Qe.Normal&&a===nl.NotRequired?null:this.switch(r).colorTexture;const l=this._getRasterColorizerTechnique(o,i,s,a);o.opacity=e.opacity;const c=o.getUniforms();c.scale=n.scale,c.offset=n.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const u=this._rctx.bindTechnique(l,null,c);this._render(u)}_getRasterColorizerTechnique(e,i,r,s){const n=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new GI,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=i,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?O2.Noop:O2.PerBand,this._rasterColorizerTechnique=this._techniques.releaseAndAcquire(SVe,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,i,r,s,n,o,a,l){const c=this._rctx,u=n.sourceLayerInfo.data,d=n.tile.surface.layerViewByIndex(n.layerIndex,ei.MAP),f=e.baseOpacity<1?nl.Required:nl.NotRequired,m=f===nl.Required||e.opacity<1||s!==Qe.Normal||i!==Ln.Composite,g=m?Af.On:Af.Off,y=this._getBlendLayersTechnique(s,i,f,g);c.setPipelineState(y.getPipeline());let v=null,b=null;m?(b=this.currentFBO(r),this._vtFBO==null&&(this._vtFBO=new m1e(this._rctx)),v=this._vtFBO.get(r),c.bindFramebuffer(v),this._clearCurrentFBO()):l&&c.clear(jr.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.renderBackground(c,n.sourceLod,d.painter,d.layer.styleRepository,d.schemaHelper,Math.round(1/n.scale),n.offset,a,o,d.contentZoom),u&&this._vectorTileHelper.renderContent(c,n.sourceLod,u,n.vtlNeighborInfos,d.painter,d.layer.styleRepository,d.schemaHelper,Math.round(1/n.scale),n.offset,a,o,d.contentZoom)}catch(w){ANt().warnOnce("A render call containing vector tiles did not resolve correctly.",w)}return v==null||(c.bindFramebuffer(b),e.texture=v.colorTexture,e.offset=m2,e.scale=1,this.drawImageData(e,i,r,s,g),l)}copyFBOToTexture(e){const i=this._rctx,r=i.bindTexture(e.texture,Mr.TEXTURE_UNIT_FOR_UPDATES),s=e.descriptor;i.gl.copyTexImage2D(js.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),e.generateMipmap(),i.bindTexture(r,Mr.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clear(jr.COLOR_BUFFER_BIT|jr.DEPTH_BUFFER_BIT|jr.STENCIL_BUFFER_BIT)}_initFBO(e,i,r){this._rctx.bindFramebuffer(e),r&&(this._rctx.setViewport(0,0,i,i),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,i=0,r=!0){if(this._current=i,i>=this._fbos.length)for(let s=this._fbos.length;s<=i;s++)this._fbos.push(new m1e(this._rctx));this._initFBO(this._fbos[i].get(e),e,r)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const i=this.currentFBO(e),r=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),i}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const i=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},ONt=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new ai({allocator:e=>e||new $Nt})}},$Nt=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},g1e=class{constructor(e,i){this._texture=e,this._cache=i,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){if(--this._refCount,this._refCount===0)if(this._cache){const e=`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`;this._cache.put(e,this)}else this.dispose()}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.usedMemory}},RNt=class{constructor(e,i,r,s,n,o){this.start=e,this.end=i,this.blendMode=r,this.opacity=s,this.output=n,this.baseOpacity=o}},INt=class{constructor(e,i,r,s){this._rctx=e,this.tileSize=i,this._techniques=r,this._cache=s,this._passParameters=new rNt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._compositor=new PNt(this._rctx,this._techniques),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._compositor=Ut(this._compositor),this._backgroundTexture=hi(this._backgroundTexture)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateHeading(e){var i;(i=this._compositor)==null||i.updateHeading(e)}updateTileTexture(e,i){if(!e.renderData)return;const r=e.surface,s=r.baseOpacity;let n=0,o=0,a=this.tileSize,l=!1,c=!1;const u=r.view.state.contentPixelRatio;let d=!1;Lj.clear(),cC.length=0;const f=e.layerInfo[ei.MAP];let m=0,g=null;for(;m<f.length;m++){const b=r.layerViewByIndex(m,ei.MAP),w=b.layer.opacity,x=b.fullOpacity;if(c=c||Vk(b.layer),xD(b)){let M=b.layer.blendMode!=="normal";if(uP(b.layer.parent)){const O=zee(b.layer.parent);O!=null&&O!==""&&(M=CVe(b.layer.parent)||M)}M&&(d=M,l=!1)}if(w===0&&!d){f[m].pendingUpdates&=~(St.TEXTURE_NOFADING&St.TEXTURE_FADING);continue}++o;const T=tO(b),E=B7(e,m,T);if(E){if(f[m].pendingUpdates&=~(St.TEXTURE_NOFADING&St.TEXTURE_FADING),uP(b.layer.parent)){const M=zee(b.layer.parent);M!=null&&M!==""&&MVe(b.layer.parent,m)}T?a=Math.max(a,this.tileSize*u):s===1&&x===1&&(b.isOpaque||this._dataToTexture(E)&&E.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n,g===null&&(g=m)}}const y=a/this.tileSize,v=this._ensureBackgroundTexture(this.tileSize);n!==0&&g!==null?n===1&&!d&&this._useLayerTexture(e,g)||this._composeLayers(e,i,m-1,c,a,y,!l||d,Lj,d):DNt(e,o,v,i!==Cn.FADING)}_ensureBackgroundTexture(e){return this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e,!1),this._backgroundDirty=!0),this._backgroundDirty&&(this._compositor.bind(e),this._passParameters.offset=m2,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._compositor.drawBackground(this._passParameters,this.backgroundColor!=null),this._compositor.copyFBOToTexture(this._backgroundTexture),this._compositor.unbind(),this._backgroundDirty=!1),this._backgroundTexture}_useLayerTexture(e,i){const r=e.surface.layerViewByIndex(i,ei.MAP),s=Vk(r.layer),n=s?e.surface.baseOpacity:1,o=s?1:e.surface.baseOpacity,a=r.fullOpacity,l=B7(e,i,!1);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new Nee(l.sourceLayerInfo.data,Cn.FADING,l,n,o,a)),!0)}_composeLayers(e,i,r,s,n,o,a,l,c){this._compositor.ensureBuffer(n);const u=e.surface.baseOpacity;let d=!1,f=di.LINEAR_MIPMAP_LINEAR,m=!1,g=0;for(let w=r;w>=0;w--){const x=e.surface.layerViewByIndex(w,ei.MAP),T=tO(x),E=B7(e,w,T),M=x.layer.opacity;if(!E||M===0&&!c)continue;const O=!Vk(x.layer)&&!d;O&&(d=!0);let D=!1;l.forEach(V=>{V.start===w&&(V.output=s?Ln.Composite:a&&O?this.backgroundIsGrid?Ln.GridComposite:Ln.ColorComposite:Ln.Composite,V.baseOpacity=O?u:1,cC.push(V),this._compositor.openGroup(n),D=!0)});const U=g===0,k=D?Ln.GroupBackgroundComposite:a&&U?this.backgroundIsGrid?Ln.GridComposite:Ln.ColorComposite:Ln.Composite,H=Dee[xD(x)?x.layer.blendMode:"normal"];for(this._passParameters.baseOpacity=O&&!D&&u<1?u:1,this._passParameters.opacity=M,CLt(E)?m=this._compositor.drawVectorData(this._passParameters,k,n,H,E,o,this.tileSize,m):ELt(E)?(this._compositor.drawRasterData(this._passParameters,k,n,H,E),LNt(E)&&(f=di.NEAREST)):this._dataToTexture(E)&&(this._passParameters.texture=E.sourceLayerInfo.data.texture,this._passParameters.offset=E.offset,this._passParameters.scale=E.scale,this._compositor.drawImageData(this._passParameters,k,n,H));cC.length>0&&cC[cC.length-1].end===w;){const V=cC.pop();this._passParameters.baseOpacity=V.baseOpacity,this._passParameters.opacity=V.opacity,this._passParameters.offset=m2,this._passParameters.scale=1,this._compositor.drawGroup(this._passParameters,V.output,n,Dee[V.blendMode])}g++}const y=e.renderData,v=c||d&&u<1,b=y.ensureTexture(n,v,()=>this._buildTexture(n,v,f));this._compositor.copyFBOToTexture(b),this._compositor.unbind(),y.setTextureReference(new Nee(b,i,AVe,d?1:u,0,1))}_dataToTexture(e){if(ALt(e)){const i=e.sourceLayerInfo;i.data=this._buildTexture(i.data,!0),e.tile.setMemoryDirty()}return MLt(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,i,r=di.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const s=new es;s.wrapMode=Ai.CLAMP_TO_EDGE,s.samplingMode=r,s.maxAnisotropy=this._maxAnisotropy,s.preMultiplyAlpha=!0,s.flipped=!0,s.hasMipmap=!0,i||(s.pixelFormat=Ht.RGB);const n=this._rctx;let o;if(typeof e=="number")s.width=s.height=e,o=this._buildTileTexture(s,e);else if(L8(e))s.isOpaque=e.isOpaque,s.isOpaque&&(s.pixelFormat=Ht.RGB),o=this._buildTileTexture(s,e.element.width,e.element);else try{s.width=e.width,s.height=e.height,o=this._buildTileTexture(s,e.width,e)}catch{o=new g1e(fIe(n)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const a=n.bindTexture(o.texture,Mr.TEXTURE_UNIT_FOR_UPDATES);return o.generateMipmap(),n.bindTexture(a,Mr.TEXTURE_UNIT_FOR_UPDATES),o}_buildTileTexture(e,i,r){const s=`${i} ${e.pixelFormat}`,n=this._cache.pop(s);return n?(n.retain(),n.texture.setData(r),n):new g1e(new Mr(this._rctx,e,r),this._cache)}get test(){}};function B7(t,e,i){Xa.layerIndex=e,Xa.vtlNeighborInfos.clear();const r=t.layerInfo[ei.MAP][e];if(Di(Xa.offset,0,0),Xa.tile=t,Xa.scale=1,Xa.sourceLod=t.lij,Xa.sourceLayerInfo=r,Xa.isVTLBackground=i,r.data)return i&&t.forEachLoadedNeighbor((n,o)=>{if(n.level!==t.level)return;const a=n.layerInfo[ei.MAP][e];if(!UUe(a)||r.data===a.data)return;const l=Xa.vtlNeighborInfos.pushNew();l.offset=M0[o],l.sourceLod=n.lij,l.sourceLayerInfo=a}),Xa;const s=r.upsampleInfo;if(s){const n=s.tile.layerInfo[ei.MAP][e];return Xa.tile=s.tile,Ga(Xa.offset,s.offset),Xa.scale=s.scale,Xa.sourceLod=s.tile.lij,Xa.sourceLayerInfo=n,Xa}return i?Xa:null}function zee(t){return t.uid}function LNt(t){const e=t.sourceLayerInfo.data;return!!e.source&&e.interpolation==="nearest"}function CVe(t){let e=t.blendMode!=="normal";return uP(t.parent)&&(e=CVe(t.parent)||e),e}function MVe(t,e){uP(t.parent)&&MVe(t.parent,e);const i=zee(t);if(i!=null&&i!==""){const r=Lj.get(i);r?r.start=e:Lj.set(i,new RNt(e,e,t.blendMode,t.opacity,Ln.Composite,1))}}function DNt(t,e,i,r){const s=t.renderData,n=!r&&s.textureReference!=null&&(t.surface.view.layerViewManager.updating||e>0)?Ob.Delayed:Ob.Immediate;s.setTextureReference(new Nee(i,Cn.FADING,AVe,t.surface.baseOpacity,0,1),n)}const Lj=new Map,cC=new Array,Xa=new ONt,AVe={offset:[0,0],scale:1},M0=new Array;M0[Ot.NORTH]=[0,-1],M0[Ot.NORTH_EAST]=[-1,-1],M0[Ot.EAST]=[-1,0],M0[Ot.SOUTH_EAST]=[-1,1],M0[Ot.SOUTH]=[0,1],M0[Ot.SOUTH_WEST]=[1,1],M0[Ot.WEST]=[1,0],M0[Ot.NORTH_WEST]=[1,-1];const NNt=200,j7=40,FNt=.8,kNt=10,HI=1e-6;function UNt(t,e,i){const r=e,s=i;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(r[a]<l){if(s[a]<=HI)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-HI){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=t[a+3];if(r[a]>l){if(s[a]>=-HI)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]>=HI){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}let y1e=class{constructor(e,i,r,s,n){this.aabb=e,this.axis=i,this.d=r,this.midStartIndex=s,this.rightStartIndex=n}},PVe=class Bee{constructor(e,i,r,s){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=i,this.positions=s,this._rayDirection=C(),this._callback=v1e,this._intersectionOptions=_1e,this.bspNodeTree=new Array;const n=r-i,o=new(n<GNt?Uint8Array:n<HNt?Uint16Array:Uint32Array)(n);this.triangleIndexMap=o;for(let a=0;a<n;++a)o[a]=a;{const a=jNt(e,i,r,s.data,s.stride),l=Ne(Math.log2(n/j7),2,kNt),c=(u,d,f)=>{const m=zNt(o,a,u,d),g=d-u;if(g<=j7){const T=new y1e(m,void 0,0,u,d);return this.bspNodeTree.push(T),T}const{axis:y,midValue:v}=BNt(m),b=VNt(o,a,u,d,y,v),w=(T,E)=>{if(f>l)return;const M=E-T;return M<j7||M>=FNt*g?void 0:c(T,E,f+1)},x=new y1e(m,y,v,b.next,b.mid);return this.bspNodeTree.push(x),x.leftNode=w(u,b.next),x.rightNode=w(b.mid,d),x};c(0,n,0)}}intersectRayTriangleRange(e,i){if(e>=i)return;const r=this.positions;ZDe(this._rayFrom,this._rayDirection,e,i,this.globalTriangleVertexIndices,r.data,r.stride,this._intersectionOptions.normalRequired,this._callback,this.triangleIndexMap,this.firstTriangleIndex),Bee.numFacesTested+=i-e}intersectRay(e,i,r,s){Bee.numFacesTested=0;const n=e,o=i,a=o[0]-n[0],l=o[1]-n[1],c=o[2]-n[2];if(a*a+l*l+c*c<HI)return;this._rayFrom=n;const u=this._rayDirection;u[0]=a,u[1]=l,u[2]=c;const d=this.triangleIndexMap.length;this._callback=s,this._intersectionOptions=r,this.intersectRayBSP(this.bspNodeTree[0],0,d),this._callback=v1e,this._intersectionOptions=_1e}intersectRayBSP(e,i,r){const s=this._rayFrom,n=this._rayDirection;if(!UNt(e.aabb,s,n))return;const o=e.axis,a=e.d;if(s[o]<a||n[o]<0){const l=i,c=e.midStartIndex;if(l<c){const u=e.leftNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),s[o]>a||n[o]>0){const l=e.rightStartIndex,c=r;if(l<c){const u=e.rightNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleIndexMap.byteLength}};PVe.numFacesTested=0;const uC=[1/0,1/0,1/0],hC=[-1/0,-1/0,-1/0];function VNt(t,e,i,r,s,n){let o=i,a=r;for(;o<a;){const c=t[o];e[6*c+s+3]<=n?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=r;l<a;){const c=t[a-1];e[6*c+s]>=n?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function zNt(t,e,i,r){if(r<=i)return b2(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*t[i];for(let n=0;n<3;++n)uC[n]=e[s+0+n],hC[n]=e[s+3+n]}for(let s=i+1;s<r;++s){const n=6*t[s];for(let o=0;o<3;++o)uC[o]=Math.min(uC[o],e[n+0+o]),hC[o]=Math.max(hC[o],e[n+3+o])}return b2(uC[0],uC[1],uC[2],hC[0],hC[1],hC[2])}function BNt(t){const e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2],s=e>i?e>r?0:i>r?1:2:i>r?1:r>e?2:0;return{axis:s,midValue:(t[s]+t[s+3])/2}}function jNt(t,e,i,r,s){const n=i-e,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+e),c=t[l]*s,u=t[l+1]*s,d=t[l+2]*s;for(let f=0;f<3;++f){const m=r[c+f],g=r[u+f],y=r[d+f];o[6*a+f]=Math.min(m,g,y),o[6*a+3+f]=Math.max(m,g,y)}}return o}const GNt=255,HNt=65535,_1e=new TN,v1e=()=>{};let Xs=class extends Xc{constructor(){super(...arguments),this.output=G.Color,this.overlayMode=Zg.Disabled,this.tileBlendInput=Qg.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.opaque=!0,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=Pt.Simplified}};h([j({count:G.COUNT})],Xs.prototype,"output",void 0),h([j({count:Zg.COUNT})],Xs.prototype,"overlayMode",void 0),h([j({count:Qg.COUNT})],Xs.prototype,"tileBlendInput",void 0),h([j()],Xs.prototype,"spherical",void 0),h([j()],Xs.prototype,"doublePrecisionRequiresObfuscation",void 0),h([j()],Xs.prototype,"receiveShadows",void 0),h([j()],Xs.prototype,"hasSlicePlane",void 0),h([j()],Xs.prototype,"backfaceCullingEnabled",void 0),h([j()],Xs.prototype,"textureFadingEnabled",void 0),h([j()],Xs.prototype,"renderOccluded",void 0),h([j()],Xs.prototype,"hasScreenSpaceReflections",void 0),h([j()],Xs.prototype,"hasCloudsReflections",void 0),h([j()],Xs.prototype,"invisible",void 0),h([j()],Xs.prototype,"opaque",void 0),h([j()],Xs.prototype,"tileBorders",void 0),h([j()],Xs.prototype,"visualizeNormals",void 0),h([j()],Xs.prototype,"screenSizePerspective",void 0),h([j()],Xs.prototype,"receiveAmbientOcclusion",void 0),h([j({count:Pt.COUNT})],Xs.prototype,"pbrMode",void 0),h([j({constValue:or.Compressed})],Xs.prototype,"normalType",void 0),h([j({constValue:Es.Compressed})],Xs.prototype,"textureCoordinateType",void 0),h([j({constValue:!1})],Xs.prototype,"highStepCount",void 0),h([j({constValue:!1})],Xs.prototype,"useCustomDTRExponentForWater",void 0),h([j({constValue:!1})],Xs.prototype,"useFillLights",void 0),h([j({constValue:!0})],Xs.prototype,"hasColorTexture",void 0);const G7=7,qNt=10,H7=io();var ul;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(ul||(ul={}));let $d=class extends D3e{get _isGlobal(){return this._stage.viewingMode===Je.Global}get _techniques(){return this._context.techniques}get _rctx(){return this._context.renderContext.rctx}constructor(e,i,r,s,n){super({}),this._overlayRenderer=e,this._stage=i,this._allTiles=r,this._ellipsoidRadius=s,this.type=as.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new Xs,this._passParameters=new Tle,this._drawParameters=new BK,this._renderDataPool=new ga(_Dt),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new GUe,this._transparencyState=ul.Opaque,this._castShadows=!1,this._inViewshed=!1,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=ir.Occlude,this.produces=new Map([[Pe.OPAQUE_TERRAIN,()=>this._produces()],[Pe.TRANSPARENT_TERRAIN,()=>this._produces()],[Pe.OCCLUDED_TERRAIN,()=>this._produces()]]),this._tileTextureCache=new DN((o,a)=>n.newCache(o,a),"TileTexture"),this.tileGeometryCache=new QDt(n)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this),this.addHandles(te(()=>this._overlayRenderer.rendersOccludedDraped,e=>{this.renderOccludedFlags=e?dj:ir.Occlude,this.setNeedsRender()},lr))}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?doe:z6}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set visible(e){this._set("visible",!!e),this.setDirty()}updateHeading(e){var i;(i=this._tileRenderer)==null||i.updateHeading(e)}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===ul.TransparentWithDraped||e===ul.Empty,this._techniqueConfiguration.opaque=e===ul.Opaque,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return Xb}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e,this._getLocalOriginOfTile(e)))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,St.TEXTURE_FADING)}updateTileTexture(e,i){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,i===St.TEXTURE_FADING?Cn.FADING:Cn.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(i))}updateTileGeometryState(e){for(const r of e.layerInfo[ei.ELEVATION])r.pendingUpdates&=~St.GEOMETRY;e.resetPendingUpdate(St.GEOMETRY);const i=e.renderData.updateGeometryState();return i&&this.setDirty(),i}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const i=e.renderData;i&&(i.releaseGeometry(),this._renderDataPool.release(i),i.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const i=qNt-G7,r=Math.max(0,Math.floor((e.level-i)/G7)*G7);if(this._isGlobal&&r===0)return Nn;for(;e.parent&&e.level>r;)e=e.parent;return e.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=cr.UPDATE){this._patchesByOriginDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=cr.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=cr.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._tileRenderer=new INt(this._rctx,this._tileSize,this._techniques,this._tileTextureCache),this.updateTileBackground(),this._emptyTex=fIe(this._rctx)}uninitializeRenderContext(){this._emptyTex=Ut(this._emptyTex),this._tileRenderer=Ut(this._tileRenderer)}intersect(e,i,r,s){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==ul.Opaque)return;const n=WNt,o=ZNt;$e(n,s,r),pe(o,1/n[0],1/n[1],1/n[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,u=e.options.store===fa.MIN,d=!!e.results.ground.target,f=Lnt(e.verticalOffset),m=e.tolerance;let g,y=u&&a.dist!=null?a.dist:1/0;const v=e.options,b=v.normalRequired||!v.backfacesTerrain,w=new TN(!1,b),x=E=>{const M=E.renderData;if(!(M!=null&&M.vao))return;const O=M.geometry;v6(H7,O.boundingBox);const D=M.localOrigin;f!=null&&(f.localOrigin=D,f.applyToAabb(H7));const U=H7;if(dC[0]=r[0]-D[0],dC[1]=r[1]-D[1],dC[2]=r[2]-D[2],!iae(U,dC,o,m,y))return;const k=(z,W,J)=>{z.set(this.type,E,W,J,Jr),y=u&&a.dist!=null?a.dist:1/0},H=(z,W,J)=>{if((!b||J!=null)&&z>=0&&(v.backfacesTerrain||Te(J,n)<0)&&(v.invisibleTerrain||!v.selectionMode||i==null||i(r,s,z))){if((c.dist==null||z<c.dist)&&k(c,z,J),v.isFiltered)return;v.store===fa.ALL&&(g==null?(g=rne(e.ray),k(g,z,J),e.results.all.push(g)):z<g.dist&&k(g,z,J)),(a.dist==null||z<a.dist)&&k(a,z,J),v.store!==fa.MIN&&(l.dist==null||z>l.dist)&&k(l,z,J)}},V=YNt;$e(V,s,D);const{indices:X,indexCount:q}=O,Z=O.vertexAttributes,ye=Z.getField($.POSITION,_o),L=new rN(ye.typedBuffer,3,Z.stride/4),N=q/3;if(!f&&N>NNt){const z=E.renderData;z.intersectionData==null&&(z.intersectionData=new PVe(X,0,N,L)),z.intersectionData.intersectRay(dC,V,w,H)}else WDe(dC,V,0,N,X,L,f,w,H)},T=this._rootTiles;T!=null&&(()=>{const E=this._tileIterator;E.reset(T);const M=e.options.invisibleTerrain;for(let O=E.next();O;O=E.next())!(O.visible||M&&O.intersectsClippingArea)||f==null&&!O.intersectsRay(r,n,m,y)||d&&this._useStencilForTile(O)?E.skipSubtree():x(O)})()}processScaleRangeQueries(e,i){var r;if(!i.done)for(this._updatePatchGroups();e.updating&&!i.done;){e.prepare();for(const s of this._visiblePatchesByOrigin.values())for(const n of s)((r=n.renderData)==null?void 0:r.textureReference)!=null&&e.queriesForTile(n);e.process(),i.madeProgress()}}prepareTechnique(e){const i=ue("enable-feature:terrain-shadows")&&e.bindParameters.shadowMap.enabled;i!==this._castShadows&&(this._castShadows=i,this._patchesByOriginDirty=!0);const r=e.bindParameters.viewshedEnabled;if(this._inViewshed!==r&&(this._inViewshed=r,this._patchesByOriginDirty=!0),e.bindParameters.slot===Pe.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&dj))return null}else{const s=this.transparency===ul.Opaque?Pe.OPAQUE_TERRAIN:Pe.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==s)return null}if(this.transparency===ul.Empty)return null;switch(e.output){case G.Color:return this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.lastFrameColor!=null,this._techniqueConfiguration.hasCloudsReflections=e.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssao!=null,this._techniqueConfiguration.overlayMode=this._overlayRenderer.mode,this._updateTechnique(G.Color,e.bindParameters.slot===Pe.OCCLUDED_TERRAIN);case G.Shadow:case G.ShadowExcludeHighlight:return this._castShadows?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.Shadow,!1)):null;case G.ViewshedShadow:return this._inViewshed?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.ViewshedShadow,!1)):null;case G.Depth:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.Depth,!1);case G.Normal:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.Normal,!1);case G.ObjectAndLayerIdColor:return this._updateTechnique(G.ObjectAndLayerIdColor,!1);case G.Highlight:return this._overlayRenderer.hasHighlights?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(G.Highlight,!1)):null}return null}renderNode(e,i){switch(this._updatePatchGroups(),i.useStencil=!1,e.output){case G.Color:{const r=e.bindParameters.slot===Pe.OCCLUDED_TERRAIN?os.Occluded:os.Color;this._renderMaterialPass(e,i,r);break}case G.Depth:case G.Normal:this._renderAuxiliaryPass(e,i,os.Color,this._visiblePatchesByOrigin);break;case G.Highlight:this._renderAuxiliaryPass(e,i,os.Highlight,this._visiblePatchesByOrigin);break;case G.Shadow:case G.ShadowExcludeHighlight:case G.ViewshedShadow:this._renderAuxiliaryPass(e,i,null,this._allPatchesByOrigin);break;case G.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,i,os.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(e){if(this._tileRenderer==null)return;const i=this._tileRenderer;let r;if(e!=null){const s=je.toUnitRGBA(e);r=qe(s[0]||0,s[1]||0,s[2]||0)}i.setBackground(r),this._allTiles.forAll(s=>i.updateTileTexture(s,Cn.FADING)),this._techniqueConfiguration.tileBlendInput=i.backgroundIsGrid?Qg.GridComposite:i.backgroundColor!=null?Qg.ColorComposite:Qg.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==iO.NONE){const e=Array.from(this._visiblePatchesByOrigin.values()),i=this._stencilEnabledLayerExtents;for(const r of e)qLt(this.renderOrder,r,i);e.sort((r,s)=>HUe(r[0],s[0],this.renderOrder)),this._visiblePatchesByOrigin=new Map(e.map(r=>[r[0].renderData.localOrigin,r])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var i;const e=this._rootTiles;if(e!=null){(i=e[0])==null||i.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(const r of e)this._rebuildPatchGroupsForRootTile(r)}}_rebuildPatchGroupsForRootTile(e){const i=this._tileIterator;for(i.resetOne(e);!i.done;){const r=i.next(),s=r.renderData;if(!s){this._numTilesCulled++;continue}const n=s.localOrigin;if(this._castShadows||this._inViewshed){let a=this._allPatchesByOrigin.get(n);a||(a=[],this._allPatchesByOrigin.set(n,a)),a.push(r)}if(!r.visible){this._numTilesCulled++,i.skipSubtree();continue}let o=this._visiblePatchesByOrigin.get(n);o||(o=[],this._visiblePatchesByOrigin.set(n,o)),o.push(r),i.skipSubtree()}}_useStencilForTile(e){for(const i of this._stencilEnabledLayerExtents)if(e.intersectsExtent(i))return!0;return!1}_renderAuxiliaryPass(e,i,r,s){const n=e.rctx;this._passParameters.overlayContent=r,n.bindTechnique(i,e.bindParameters,this._passParameters);const o=this._stencilEnabledLayerExtents.length>0;s.forEach(a=>{this._drawParameters.origin=a[0].renderData.localOrigin,i.program.bindDraw(this._drawParameters,e.bindParameters,this._passParameters);for(let l=0;l<a.length;l++)this._renderPatch(e,i,a[l],Mi.TRIANGLES,o,r)}),e.rctx.bindVAO(null)}_renderMaterialPass(e,i,r){var f;const{rctx:s}=e;this._passParameters.overlayContent=r,s.bindTechnique(i,e.bindParameters,this._passParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;const n=e.bindParameters.camera,o=i.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const m=DLe(this._stage.viewingMode,this._ellipsoidRadius),g=this.pointsOfInterest.centerOnSurfaceFrequent.distance;m.update({distance:g,fovY:n.fovY})}const a=this._stencilEnabledLayerExtents.length>0,l=r===os.Occluded;l&&(o.bindTexture("tex",this._emptyTex),o.setUniform3fv("textureOpacities",Nn),o.setUniform4fv("texOffsetAndScale",jh));const c=((f=this._tileRenderer)==null?void 0:f.backgroundColor)!=null?this._tileRenderer.backgroundColor:Nn;this._techniqueConfiguration.tileBlendInput===Qg.ColorComposite&&o.setUniform3fv("backgroundColor",c);const u=this.wireframe?Mi.LINES:Mi.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&o.bindTexture("texNext",this._emptyTex);const d=this._visiblePatchesByOrigin;for(const m of d.values()){const g=m[0].renderData.localOrigin;i.program.bindDraw(new BK(g),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const y of m){const v=y.renderData,b=v.textureReference;if(b!=null){if(!l){o.setUniform4fv("texOffsetAndScale",b.offsetAndScale),o.bindTexture("tex",b.texture.texture);const w=v.textureFadeFactor,x=w<1?v.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&x!=null&&w<1?(o.setUniform1f("fadeFactor",w),o.setUniform4fv("nextTexOffsetAndScale",x.offsetAndScale),o.setUniform3fv("nextTexOpacities",x.opacities),o.bindTexture("texNext",x.texture.texture)):o.setUniform1f("fadeFactor",1),v.textureIsFading&&this.setNeedsRender(),o.setUniform3fv("textureOpacities",b.opacities)}this._renderPatch(e,i,y,u,a,r),y.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,i,r,s,n,o){const a=r.renderData,l=a.vao,c=l==null?void 0:l.indexBuffer;if(!l||c==null)return void(fo&&console.error("Rendered tile with no indices: ",r.lij," : ",a));const u=i.program;o==null||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(u,a.overlay),n&&(i.useStencil=this._useStencilForTile(r),e.rctx.setPipelineState(i.getPipeline()));const d=a.geometry.indexCount;e.rctx.bindVAO(l),u.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(s,d,c.indexType,0)}_bindOverlayPatchData(e,i){e.setUniform4fv("overlayTexOffset",i.offsets),e.setUniform4fv("overlayTexScale",i.scales)}_updateTechnique(e,i){return this._techniqueConfiguration.output=e,this._techniqueConfiguration.renderOccluded=i,this._shaderTechnique=this._techniques.releaseAndAcquire(WUe,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){}};h([p({readOnly:!0})],$d.prototype,"_isGlobal",null),h([p()],$d.prototype,"renderOccludedFlags",void 0),h([p({value:!1})],$d.prototype,"renderingDisabled",null),h([p({value:!0})],$d.prototype,"visible",null),h([p()],$d.prototype,"renderPatchBorders",null),h([p()],$d.prototype,"visualizeNormals",null),h([p()],$d.prototype,"cullBackFaces",null),h([p({value:iO.FRONT_TO_BACK})],$d.prototype,"renderOrder",null),h([p()],$d.prototype,"wireframe",null),$d=h([I("esri.views.3d.terrain.TerrainRenderer")],$d);const WNt=C(),ZNt=C(),dC=C(),YNt=C();let XNt=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},dg=class extends Ue{constructor(e){super(e)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),te(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(i=>!(!x3(i)||i.isRejected())&&!(i.isFulfilled()&&!JNt(i,this.viewSpatialReference,this.viewingMode))&&(e=i,!((i==null?void 0:i.type)==="vector-tile"||Pj(i)))),e)if(e.isResolved()){const i=N8(e,this.viewSpatialReference,this.viewingMode);if(i!=null){const r=new $u(i.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const i=e.when().catch(()=>{}).then(()=>{i!==this._waitTask||this.destroyed||this._update()});this._waitTask=i}_lockTilingScheme(e){if(this.viewingMode===Je.Global){const i=e.levels.length-1,r=e.spatialReference;r.isWebMercator?e=$u.makeWebMercatorAuxiliarySphere(i):fle(r)&&(e=$u.makeGCSWithTileSize(e.spatialReference,e.pixelSize,i))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles(te(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Je.Global){const e=this.extentHelper.viewSpatialReference;e.isWebMercator?this.tilingScheme=$u.WebMercatorAuxiliarySphere:NUe(e)&&(this.tilingScheme=$u.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||PS(e,this.extent)||(this.tilingScheme=$u.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){}};function JNt(t,e,i){return N8(t,e,i)!=null}h([p()],dg.prototype,"tilingScheme",void 0),h([p({readOnly:!0})],dg.prototype,"extent",void 0),h([p({value:!1})],dg.prototype,"tilingSchemeLocked",void 0),h([p({constructOnly:!0})],dg.prototype,"viewSpatialReference",void 0),h([p({constructOnly:!0})],dg.prototype,"layers",void 0),h([p({constructOnly:!0})],dg.prototype,"extentHelper",void 0),h([p({constructOnly:!0})],dg.prototype,"viewingMode",void 0),dg=h([I("esri.views.3d.terrain.TilingSchemeLogic")],dg);let QNt=class{constructor(){this.offset=gt(),this.scale=0,this.tile=null}init(e,i,r,s){this.tile=e,this.offset[0]=i,this.offset[1]=r,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}};var _V;let ni=_V=class extends Ls.EventedMixin(Ue){constructor(t){var e,i,r;super(t),this._scaleRangeQueries=new yV,this._iteratorPool=new ga(GUe,s=>s.remove=()=>this._iteratorPool.release(s)),this._postorderIterator=new HLt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new XNt,this._viewChanged=!1,this.heading=0,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=C(),this._eyePosSurfaceSR=C(),this._splitLimits=new cf,this._frustum=QL(),this._viewProjectionMatrix=ke(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new f_,this._frameTask=SP,this._allTiles=new ai,this._upsampleInfoPool=new ga(QNt),this._shouldEmitChangeEvent=!1,this._rootTilesExtent=oi(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=Ye.WebMercator,this._elevationProjectorCache=new Map,this.visibleElevationBounds=new nA(1/0,-1/0),this.rootTileElevationBounds=new nA(1/0,-1/0),this._sebProjectorMap=new Map,this._sebProjectorCache=xse(),this._tilingSchemeSpatialReference=null,this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateCarree=!1,this.overlayManager=new Oc({...t,surface:this}),this._isGlobal=!((i=(e=t.view)==null?void 0:e.state)!=null&&i.isLocal),this._isGeographic=((r=this._spatialReference)==null?void 0:r.isGeographic)??!1,this._tileConstructor=this._isGlobal?YDt:qDt}initialize(){const t=this.view,e=t.resourceController,i=e.memoryController;this._tileCache=new DN((l,c)=>i.newCache(l,c),"terrain-tile"),this._upsampleMapCache=i.newCache("terrain-upsample",l=>l.unloadMapData()),this._elevationQueryCache=new k3t(i.newCache("elevation-query"));const r=this.overlayManager;this._renderer=new $d(r.renderer,t._stage,this._allTiles,br(t.spatialReference).radius,i),this.addHandles([te(()=>r.renderer.isEmpty,()=>this._evaluateTransparency()),te(()=>this.renderer.visible,l=>this.suspended=!l),te(()=>this.heading,l=>{this._renderer.updateHeading(l),this._updateTileTextures(Cn.FADING)}),te(()=>{var l,c;return{heading:(l=t.camera)==null?void 0:l.heading,state:(c=t.state)==null?void 0:c.mode}},({heading:l,state:c})=>{if(l==null)return;if(this.isGlobal&&this.isGeographic||this.isWebMercatorOnPlateCarree)return void(this.heading=90*Math.round(l/90)%360);const u=Math.round(l)%360,d=Math.abs(u-this.heading);(c===Ii.IDLE||Math.min(d,360-d)>=30)&&(this.heading=u)})],"overlayManager"),this.addHandles([te(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?Cn.UNFADED:Cn.IMMEDIATE)},pr),te(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?Cn.UNFADED:Cn.IMMEDIATE),pr),te(()=>this.backgroundColor,(l,c)=>{l!=null&&l.equals(c)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(l))},lr),te(()=>this.snapLevel,()=>this._viewChanged=!0,lr),te(()=>this.view.pointsOfInterest,l=>{this._renderer.pointsOfInterest=l,this._watchUpdatingTracking.removeAll(),l&&this._watchUpdatingTracking.add(()=>l.focus.renderLocation,()=>this._allTilesSorted=!1)}),te(()=>kr.TERRAIN_TILE_TREE_SHOW_TILES,l=>{l&&!this._treeDebugger?oe(()=>import("./TerrainTileTree3DDebugger-Cg08msqA.js"),__vite__mapDeps([193,194])).then(({TerrainTileTree3DDebugger:c})=>{!this._treeDebugger&&kr.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new c({view:t}))}):l||(this._treeDebugger=He(this._treeDebugger))},pt)]);const{spatialReference:s}=t;this._extentHelper=DLt(this.viewingMode,{layers:t.map.allLayers,layerViews:t.allLayerViews,viewSpatialReference:s});const n=new FL({getCollections:()=>{var l,c;return(c=(l=t.defaultsFromMap)==null?void 0:l.mapCollections)==null?void 0:c.map(({layers:u})=>u)},getChildrenFunction:l=>l&&"layers"in l?l.layers:null}),o=new dg({layers:n,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:s});this._set("tilingSchemeLogic",o),this._updateTilingScheme(),this._elevationDataRequester=e.createStreamDataRequester(zg.ELEVATION),this._mapDataRequester=e.createStreamDataRequester(zg.BASEMAP);const a=e.scheduler;this._frameTask=a.registerTask(It.TERRAIN_SURFACE,this),this.addHandles([te(()=>this._extentHelper.stencilEnabledExtents,l=>this._renderer.setStencilEnabledLayerExtents(l),pt),te(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),lr),te(()=>this.extent,()=>this._updateRootTiles(),pt),t.on("resize",()=>this._viewChangeUpdate()),te(()=>{const l=t.state;return[this._lodBias,this.lodSnapping,t.quality,l.camera,l.contentCamera,l.fixedContentCamera]},()=>this._viewChangeUpdate(),pr),te(()=>{var l;return(l=t.qualitySettings)==null?void 0:l.fadeDuration},l=>this._renderer.textureFadingEnabled=l>0,pt),te(()=>{var l;return(l=t.qualitySettings)==null?void 0:l.physicallyBasedRenderingEnabled},l=>this._renderer.pbrMode=l?Pt.Simplified:Pt.Disabled,pt),te(()=>{var l;return(l=t.qualitySettings)==null?void 0:l.tiledSurface.elevationLevelDelta},()=>this._updateAllTileGeometries()),te(()=>this._userClippingExtent,()=>this._updateClippingExtent(),lr)]),this.addHandles(t.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._frameTask.remove(),this._watchUpdatingTracking.destroy(),this._removeAllTiles(),this._set("tilingSchemeLogic",He(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((t,e)=>this._unregisterTiledLayerView(e)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",He(this.overlayManager)),this._tileCache=He(this._tileCache),vle.prune(),this._treeDebugger=He(this._treeDebugger),this._renderer=He(this._renderer),this._iteratorPool=He(this._iteratorPool),this._upsampleMapCache=He(this._upsampleMapCache),this._elevationQueryCache=He(this._elevationQueryCache),this._set("view",null),this._extentHelper=He(this._extentHelper),this._upsampleInfoPool=He(this._upsampleInfoPool),oLt(),nDt()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnapping===Y3.ON){const t=this.view,e=this.tilingScheme,i=t.terrainScale;if(e&&i){const r=e.levelAtScale(i)+t.qualitySettings.tiledSurface.lodBias,s=e.getMaxLod();return Math.min(r,s||1/0)}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?Y3.ON:Y3.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get _userClippingExtent(){const{spatialReference:t}=this,{clippingArea:e}=this.view;if(e==null||t==null)return null;const i=oi(),r=rUe(e,i,t)?i:null,s=this._get("extent");return PS(r,s)?s:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const t=pY(this.groundExtent,this._userClippingExtent,oi()),e=this._get("extent");return PS(t,e)?e:t}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var t;return(t=this.tilingSchemeLogic)==null?void 0:t.extent}get updating(){var t,e;return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||(t=this._watchUpdatingTracking)!=null&&t.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||(e=this.overlayManager)!=null&&e.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){var t,e,i;return((i=(e=(t=this.view)==null?void 0:t.map)==null?void 0:e.ground)==null?void 0:i.opacity)??1}set baseOpacity(t){this.view.map.ground.opacity=t}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(t){this._renderer.renderOrder=t,this._set("renderOrder",t)}get rootTiles(){return this._rootTiles}get spatialReference(){var t;return((t=this.tilingScheme)==null?void 0:t.spatialReference)??null}get backgroundColor(){var t,e,i;return(i=(e=(t=this.view)==null?void 0:t.map)==null?void 0:e.ground)==null?void 0:i.surfaceColor}set backgroundColor(t){this.view.map.ground.surfaceColor=t}set slicePlaneEnabled(t){this._renderer.slicePlaneEnabled=t,this._set("slicePlaneEnabled",t),this._evaluateTransparency()}get tilingSchemeLocked(){var t;return((t=this.tilingSchemeLogic)==null?void 0:t.tilingSchemeLocked)??!1}get wireframe(){var t;return(t=this._renderer)==null?void 0:t.wireframe}set wireframe(t){t!==this._renderer.wireframe&&(this._renderer.wireframe=t,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===ul.Opaque}set suspended(t){this._set("suspended",t),this._viewChangeUpdate()}get fadeDuration(){return this.view.qualitySettings.fadeDuration??0}intersect(t,e,i,r){this._renderer.intersect(t,e,i,r)}getElevationLevelDelta(t){return t<4?3:this.view.qualitySettings.tiledSurface.elevationLevelDelta}getElevation(t,e,i,r){const s=this._rootTiles;if(!(s!=null&&s.length)||s[0].layerInfo[ei.ELEVATION].length===0)return null;let n=this._elevationProjectorCache.get(r);if(n===void 0&&(n=jb(r,this._spatialReference)??null,this._elevationProjectorCache.set(r,n)),n==null)return ne.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;const o=pe(tR,t,e,i);return n(o,0,o,0),b1e(s,o[0],o[1])}getElevations(t,e,i){const r=this._rootTiles,s=r?r[0].layerInfo[ei.ELEVATION].length:0;if(r!=null&&r.length&&s!==0)for(let n=0;n<e;++n){const o=3*n;i(n,b1e(r,t[o],t[o+1]))}else for(let n=0;n<e;++n)i(n,null)}getScale(t){if(!this.tilingScheme)return null;if(!xl(t,tR,this.spatialReference))return ne.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const e=this._rootTiles;if(e!=null){for(const i of e)if(i!=null&&i.containsPoint(tR)){let r=i;for(;r.children[0]&&!r.rendered;){const s=r.children[0].extent;let n=0;tR[0]>s[2]&&(n+=1),tR[1]<s[1]&&(n+=2),r=r.children[n]}return this._getLodBiasCorrectedScale(r.level)}}return 1/0}_ensureSEBProject(t){const e=this._sebProjectorMap.get(t);if(e)return e;const i=jb(t,this._tilingSchemeSpatialReference,this._sebProjectorCache)??null;return this._sebProjectorMap.set(t,i),i}getSphereElevationBounds(t,e){const i=this._ensureSEBProject(e);if(i==null)return ne.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;_2(t,pC);const r=pC;i(r,0,r,0);const s=new Mj,n=this._rootTiles;if(n!=null){const o=[];for(const l of n)o.push(l);let a=0;for(;a<o.length;){const l=o[a];if(++a,!lde(l.extent,pC))continue;const c=l.children;if(c[0]==null||l.rendered)s.expandElevationRangeValues(l.elevationBoundsMin,l.elevationBoundsMax);else for(const u of c)o.push(u)}}return s}getRootElevationBounds(){return new Mj(this.rootTileElevationBounds.min,this.rootTileElevationBounds.max)}getSphereScale(t,e){if(!this.tilingScheme)return null;if(!xl(t,pC,this.spatialReference))return ne.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;pC[3]=e;let i=null;const r=n=>{if(n&&lde(n.extent,pC)){const o=n.children;if(o[0]&&!n.rendered)for(const a of o)r(a);else{const a=this._getLodBiasCorrectedScale(n.level);i=i==null?a:Math.min(i,a)}}},s=this._rootTiles;if(s!=null)for(const n of s)r(n);return i}queryVisibleScaleRange(t,e,i,r){const s=e?this.tilingScheme.levelAtScale(e):0,n=i?this.tilingScheme.levelAtScale(i):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(t,s+o,n+o,r)}_evaluateTransparency(){var n,o;const t=this.baseOpacity,e=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,r=this._allSurfaceLayersTransparent()?e?ul.Empty:ul.TransparentWithDraped:t>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?ul.Opaque:ul.Semitransparent,s=i!==r;return s&&(this._renderer.transparency=r,(o=(n=this.view)==null?void 0:n._stage)==null||o.renderer.setParameters({terrainTransparency:this._renderer.transparency})),s}_updateTilingScheme(){var i,r,s,n;const t=this.tilingSchemeLogic.tilingScheme;if(t===this.tilingScheme)return;Bn(!!t,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((r=(i=this.view)==null?void 0:i.state)!=null&&r.isLocal),this.tilingScheme&&this._removeAllTiles();const e=(t==null?void 0:t.spatialReference)??Ye.WebMercator;this._spatialReference=e,this._isWebMercator=!!(e!=null&&e.isWebMercator),this._isWebMercatorOnPlateCarree=this._isWebMercator&&s2((s=this.view)==null?void 0:s.renderSpatialReference),this._isGeographic=(e==null?void 0:e.isGeographic)??!1,this._set("tilingScheme",t),this._tilingSchemeSpatialReference=(n=this.tilingScheme)==null?void 0:n.spatialReference,this._sebProjectorMap.clear(),this._updateClippingExtent(),t&&(this._updateTiledLayers(),this._renderer.setTileSize(t.pixelSize),this.overlayManager.setSpatialReference(t.spatialReference),this._updateRootTiles())}_acquireTile(t,e,i,r){const s=this._tileCache.pop(_V._tileMemcacheKey);return s?(s.init(t,e,i,r,this),s):new this._tileConstructor(t,e,i,r,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:t,tilingScheme:e}=this;if(!e)return;const i=eFt;let r=e.rootTilesInExtent(t,i,5*kM);if(this._rootTiles!=null){if(r.length>kM)return void ne.getLogger(this).warn(Aot);const s=this._rootTiles.map(o=>o.lij),n=cZ(s,r,mV);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){const o=this._rootTiles.filter(a=>!(n.removed.findIndex(l=>mV(l,a.lij))>-1)||(this._purgeTile(a),!1));n.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,r.length>kM&&(ne.getLogger(this).warn(Pot),r=e.rootTilesInExtent(t,i,kM)),this._setRootTiles(r.map(s=>this._newRootTile(s)));PS(i,this._rootTilesExtent)||(this._rootTilesExtent=oi(i)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const t=this._allTiles.filter(e=>e.isLoaded&&e.intersectsClippingArea);t.sort(Jg),t.forEach(e=>this._renderer.updateTileGeometryState(e)),t.forEach(e=>e.renderData.updateNeighborData()),this._updateTilesGeometries(t),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(t){if(t.length===0)return;t.sort(Jg);const e=this.renderer;t.forEach(i=>e.updateGeometryIfNeeded(i)),t.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(t){return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===St.SPLIT}_newRootTile(t){const e=this._acquireTile(0,t[1],t[2],null);return this._shouldSplit(e)&&e.setPendingUpdate(St.SPLIT),this._loadTile(e),this._markTileToUpdate(e),this._updateRootTileElevationBounds(),e}_setRootTiles(t){if(this._rootTiles=t,this._allTiles.clear(),t!=null){const e=this._iteratorPool.acquire();for(e.reset(t);!e.done;)this._allTiles.push(e.next());e.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(t)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(t){t.updateClippingStatus(this.extent)&&t.resetPendingUpdate(St.GEOMETRY)&&this._updateTileGeometryState(t)}_updateTilesVisibility(t){if(t==null)return;const e=KLt(t),i=this.visibleElevationBounds;let r=e?i.min:1/0,s=e?i.max:-1/0;const n=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(t);!a.done;){const l=a.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(St.GEOMETRY)&&this._updateTileGeometryState(l),l.computeVisibility(),l.updateScreenDepth(o),l.renderData&&(r=Math.min(l.elevationBoundsMin,r),s=Math.max(l.elevationBoundsMax,s))}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(r)&&isFinite(s)&&(i.min!==r||i.max!==s)&&(this.visibleElevationBounds=new nA(r,s))}_updateRootTileElevationBounds(){let t=1/0,e=-1/0;const i=this._rootTiles;i!=null&&i.forEach(({elevationBoundsMin:s,elevationBoundsMax:n})=>{t=Math.min(t,s),e=Math.max(e,n)});const r=this.rootTileElevationBounds;r.min===t&&r.max===e||(this.rootTileElevationBounds=new nA(t,e))}_updateViewDependentParameters(){const{camera:t,contentCamera:e}=this.view.state,i=Math.tan(.5*e.fovX),r=Math.tan(.5*e.fovY),s=this.tilingScheme.pixelSize,n=2**-this._lodBias*t.pixelRatio;this._splitLimits.aboveGround=t.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=s/t.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/t.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=CB(this._splitLimits.frustum??QL(),e.frustum):this._splitLimits.frustum=null,CB(this._frustum,t.frustum),vr(this._viewProjectionMatrix,e.projectionMatrix,e.viewMatrix),ve(this._eyePosRenderSR,e.eye),Go(t.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateTileGeometryState(t){t.updateVisibility(),this._renderer.updateTileGeometryState(t)&&this._markTileToUpdate(t),this._usedMemory=null}_markAllTileNeighborsForUpdate(t){t.forEachLoadedNeighbor(e=>{this._layerViews[ei.MAP].some(tO)&&e.setPendingUpdate(St.TEXTURE_FADING),this._pendingTilesToUpdate.add(e)})}_updateTileTexture(t,e){const i=t.resetPendingUpdate(St.TEXTURE_FADING)?St.TEXTURE_FADING:!!t.resetPendingUpdate(St.TEXTURE_NOFADING)&&St.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(t,i),this._usedMemory=null,e.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;const t=q7.extent;Kh(t),this._pendingTilesForElevationUpdateEvent.forEach(e=>vb(t,e.extent,t)),this._pendingTilesForElevationUpdateEvent.clear(),q7.spatialReference=this.spatialReference,this.emit("elevation-change",q7),this._shouldEmitChangeEvent=!1}runTask(t){this._handleLayerViewChanges(t),this._frameTask.processQueue(t),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,t),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(t),this._sortTiles(t);const e=!this.view.state.fixedContentCamera;if(this._mergeAndSplit(t,e),this._updateElevation(t),this._updateTextures(t),e||this._mergeAndSplit(t,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),t.done&&t.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue"),fo&&this._checkTileInvariant(),!t.hasProgressed)return pa}_checkTileInvariant(){const t=new Map;this._allTiles.forAll(e=>t.set(e,new Set)),this._allTiles.forAll(e=>{var i;if(Bn(e.rendered===e.isLeaf,` rendered ${e.rendered} != ${e.isLeaf} leaf`),!e.isLeaf){const r=n=>n.unmergableChildCount===0&&n.maxLevelDeltaNeighborCount===0,s=e.children.reduce((n,o)=>n+(r(o)?0:1),0);if(Bn(e.unmergableChildCount===s,` Tile[${e.lij.toString()}] unmergeable child count mismatch: actual ${e.unmergableChildCount} vs ${s}`),e.hasPendingUpdate(St.MERGE)){Bn(!e.hasPendingUpdate(St.SPLIT),"Tile can be both split and merge at the same time");for(const n of e.children)Bn(n.isLeaf||n.hasPendingUpdate(St.MERGE),"Child of tile to merge must also merge")}}for(let r=0;r<4;++r){if(e.rendered){const a=(i=e.renderData)==null?void 0:i.geometryState.edgePeerNeighbors[r];if(a!=null){{const l=e.level-a.level<=qn;l||(console.log(`tile level delta [${e.lij.toString()}] vs [${a.lij.toString()}] > ${qn}  (edge[${r}])`),Bn(l,`tile level delta [${e.level}] vs [${a.level}] > ${qn}`))}Bn(e.level-a.level<=qn,`Max tile lod delta exceeded: [${e.lij.toString()}] vs [${a.lij.toString()}]`)}}const s=e.level-qn,n=a=>a.isLeaf||a.level===e.level,o=e.findNeighborTile(Xf[r],n);if(o!=null){if(e.isLeaf&&e.level>=qn){let a=o;for(;e.level-a.level<qn;)a=a.parent;const l=[s,e.lij[1]>>qn,e.lij[2]>>qn];if(!mV(l,a.lij)){const c=t.get(a);Bn(!c.has(e),"Cannot already have neighbor"),c.add(e)}}Bn(o.rendered||o.level===e.level,"Non-same-level-neighbor of rendered must be rendered"),Bn(e.level-o.level<=qn,`Tile level delta [${e.level}] vs [${o.level}] > ${qn}`)}}}),this._allTiles.forAll(e=>{const i=e.maxLevelDeltaNeighborCount,r=t.get(e);Bn(i===r.size,`Tile[${e.lij.toString()}] merge-blocker mismatch: actual ${i} vs ${r.size}`)})}_updateAllTilesStatus(t){if(!this._viewChanged||!this._rootTiles||t.done)return;this._viewChanged=!1;const e=new tFt(this._allTiles.length);e.pushAll(this._rootTiles);const i=this.snapLevel,r=this._splitLimits,s=this._eyePosRenderSR;this._allTiles.forAll(o=>{o.maxLevelDeltaNeighborCount=0,o.unmergableChildCount=0});const n=this._viewProjectionMatrix;for(;!e.empty;){const o=e.pop(),a=o.parent,l=a!=null&&a.hasPendingUpdate(St.MERGE),c=l?St.MERGE:o.shouldSplit(r,s,i),u=c===St.SPLIT;o.isLeaf?W7(o,u):e.pushAll(o.children),l?(o.resetPendingUpdate(St.SPLIT),o.isLeaf||o.setPendingUpdate(St.MERGE),this._updateClippingStatus(o),o.updateVisibility(),o.updateScreenDepth(n)):u?(o.resetPendingUpdate(St.MERGE),o.isLeaf&&o.setPendingUpdate(St.SPLIT)):(o.resetPendingUpdate(St.SPLIT)&&o.updateAgentSuspension(),c===St.ELEVATION&&o.updateAgents(ei.ELEVATION),o.isLeaf||(o.setPendingUpdate(St.MERGE),o.resetPendingUpdate(St.SPLIT)))}this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),t.madeProgress()}_sortTiles(t){t.done||this._allTilesSorted||(JLt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),t.madeProgress())}_markTileToUpdate(t){Xe(t.isLoaded),t.intersectsClippingArea&&(this._pendingTilesToUpdate.add(t),this._markAllTileNeighborsForUpdate(t))}_updatePendingTileGeometries(){const t=this._pendingTilesToUpdate,e=Array.from(t.keys()).filter(s=>s.isLoaded&&s.intersectsClippingArea);if(e.length===0)return void t.clear();const i=(s,n)=>{!(n!=null&&n.isLoaded)||!n.intersectsClippingArea||n.level<s.level||t.has(n)||(t.add(n),e.push(n),n.renderData.updateNeighborData())};e.sort(Jg);const r=e.length;for(let s=0;s<r;++s){const n=e[s];Xe(n.isLoaded),Xe(n.intersectsClippingArea);const o=n.renderData;o.updateNeighborData();const a=o.dirtyEdgeResolutions,l=o.geometryState,c=u=>{var f;const d=$j[u];i(n,(f=l.cornerPeerNeighbors[u])==null?void 0:f.findCorner(Oj(d),m=>m.isLoaded))};for(let u=0;u<4;++u)if(a&1<<u){const d=o.geometryState.edgePeerNeighbors[u];d&&(d==null?void 0:d.level)>=n.level&&d.forAllSubtreeOnSide(yle(Xf[u]),f=>!(!f.isLoaded||!f.intersectsClippingArea)&&(Xe(t.has(f)||Jg(n,f)<0),i(n,f),!0)),c((u+1)%4),c(u)}}t.clear(),this._updateTilesGeometries(e),this._shouldEmitChangeEvent=!0,fo&&Aj&&this.checkAllTilesWaterproofness()}_mergeAndSplit(t,e){if(this.suspended||t.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const r=this.view.state.fixedContentCamera;let s=!1;for(;!t.done;){s=!0;let n=!1;const o=!this._allTiles.some(a=>{if(!i&&!r&&!a.visible)return t.done;let l=a;if(a.hasPendingUpdate(St.MERGE)){if(!e||a.unmergableChildCount>0)return t.done;for(a.resetPendingUpdate(St.MERGE);l.parent!=null&&l.parent.unmergableChildCount===0&&l.parent.resetPendingUpdate(St.MERGE);)l=l.parent;this._mergeTile(l),n=!0,t.madeProgress()}else if(a.resetPendingUpdate(St.SPLIT)){let c=!0;const u=a.level;if(u>=qn){const d=f=>f.isLeaf||u-f.level<qn;for(let f=0;f<4;++f){const m=a.findNeighborTile(Xf[f],d);m!=null&&u-m.level===qn&&(c=!1,fo&&(Xe(m.isLeaf),Xe(m.hasPendingUpdate(St.SPLIT))))}}c?(this._splitTile(a),t.madeProgress(),n=!0):a.setPendingUpdate(St.SPLIT)}return t.done});if(n&&(this._allTilesSorted=!1,this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries()),o){if(!i){i=!0;continue}if(!n)break}else this._allTilesDirty=!0}s?t.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(t)}_updateElevation(t){t.done||(this._allTiles.some(e=>(e.resetPendingUpdate(St.GEOMETRY)&&(this._updateTileGeometryState(e),this._shortBatches&&this._updatePendingTileGeometries(),t.madeProgress()),t.done)),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(t){t.done||this._allTiles.some(e=>(this._updateTileTexture(e,t),t.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(cr.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const t=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-(1-t)*Cot}_getLodBiasCorrectedScale(t){const e=this.tilingScheme.levels,i=Ne(t-this._lodBias,0,e.length-1),r=i-Math.floor(i);return e[Math.floor(i)].scale*(1-r)+e[Math.ceil(i)].scale*r}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(t=>this._purgeTile(t)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.renderer.visible=!1}_purgeDescendantTiles(t){if(!t.children[0])return;const e=t.children.slice();t.unsetChildren();for(let i=0;i<4;++i)this._purgeTile(e[i])}_purgeTile(t){t.isLeaf?w1e(t):this._purgeDescendantTiles(t),this._allTiles.removeUnordered(t),this._unloadTile(t),this._tileCache.put(_V._tileMemcacheKey,t)}_unloadTile(t){this._pendingTilesToUpdate.delete(t),this._pendingTilesForElevationUpdateEvent.delete(t),t.unload(this._renderer)}_splitTile(t){Bn(t.isLeaf,"Tile that is already split should not be split again!"),Bn(t.rendered,"Tile marked to split is not rendered"),w1e(t);const e=t.level+1,i=2*t.lij[1],r=2*t.lij[2],s=t.setChildren(this._createTile(e,i,r,t),this._createTile(e,i,r+1,t),this._createTile(e,i+1,r,t),this._createTile(e,i+1,r+1,t));this._allTiles.pushArray(s),t.updateAgentSuspension(),Bn(t.rendered,"parent should be rendered"),this._unloadTile(t),s.forEach(n=>this._loadTile(n)),s.forEach(n=>this._pendingTilesToUpdate.add(n)),this._markAllTileNeighborsForUpdate(t),this._emitTileScaleChange(t,t.level+1),this._allTilesDirty=!0,this._shortBatches&&this._updatePendingTileGeometries(),s.forEach(n=>W7(n,n.hasPendingUpdate(St.SPLIT))),++this._performanceInfo.numSplit}_emitTileScaleChange(t,e=t.level){V5.spatialReference=this.spatialReference,V5.extent=t.extent,V5.scale=this._getLodBiasCorrectedScale(e),this.emit("scale-change",V5)}_createTile(t,e,i,r){Bn(!!r,"_createTile sanity check");const s=this._acquireTile(t,e,i,r);return s.updateClippingStatus(this.extent),s.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(s)&&s.setPendingUpdate(St.SPLIT),s}get _shortBatches(){return this.view.state.mode!==Ii.IDLE}_mergeTile(t){Bn(!t.hasPendingUpdate(St.SPLIT),"_mergeTile sanity check"),Bn(!t.isLeaf,"Cannot merge a leaf"),t.isLeaf||(this._purgeDescendantTiles(t),Bn(!t.renderData,"_mergeTile sanity check"),this._loadTile(t),this._markTileToUpdate(t),this._emitTileScaleChange(t),this._shortBatches&&this._updatePendingTileGeometries(),W7(t,!1),this._allTilesDirty=!0,++this._performanceInfo.numMerged)}_loadTile(t){t.load(),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(t)}_handleLayerViewChanges(t=Nu){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let e=!1;const i=new Set;let r=-1;for(let s=this.view.allLayerViews.length-1;s>=0;s--){const n=this.view.allLayerViews.items[s];if(i.add(n.uid),$ee(n)||K$(n))if(this._basemapLayerViewHandles.has(n.uid)&&!K$(n)){const o=this._layerClassFromLayerView(n),a=this._getLayerIdxByUID(o,n.uid);a!=null&&((a<r||r==null)&&(e=!0),r=a)}else this._registerTiledLayerView(n),n.layer.loaded&&(e=!0)}this._basemapLayerViewHandles.forEach((s,n)=>{i.has(n)||(this._unregisterTiledLayerView(n),e=!0)}),e&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),t.madeProgress()}_allSurfaceLayersTransparent(){var e,i;let t=((i=(e=this.view.map)==null?void 0:e.ground)==null?void 0:i.opacity)===0;for(const r of this.view.allLayerViews.items)if(Oee(r)&&!Vk(r.layer)&&r.fullOpacity!==0)return t=!1,t;return t}_hasCompositeBlendMode(){for(const t of this.view.allLayerViews.items)if((xD(t)||K$(t))&&eNt(Dee[t.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(t){return Pee(t)?ei.ELEVATION:ei.MAP}_registerTiledLayerView(t){const e=[];if((xD(t)||K$(t))&&e.push(te(()=>t.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(Cn.UNFADED)})),!K$(t)){const i=this._layerClassFromLayerView(t);e.push(te(()=>t.suspended,()=>this._updateTiledLayers())),e.push(te(()=>t.fullOpacity,()=>this._updateTileTextures(Cn.UNFADED))),e.push(te(()=>"effectiveScaleRange"in t.layer?t.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),e.push(t.on("data-changed",()=>{const r=this._getLayerIdxByUID(i,t.uid);r!=null&&this._invalidateLayerData(r,i)}))}this._unregisterTiledLayerView(t.uid),this._basemapLayerViewHandles.set(t.uid,e)}_unregisterTiledLayerView(t){const e=this._basemapLayerViewHandles.get(t);if(e){for(const i of e)i.remove();this._basemapLayerViewHandles.delete(t)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const t=this.view.allLayerViews,e=[[],[]];let i=null;t.forEach(r=>{if(!r.layer||r.suspended||!$ee(r)||!r.fullExtent)return;const s=this._layerClassFromLayerView(r);if(s===ei.MAP){const n=r.displayLevelRange.maxLevel;n!==1/0&&(i===null||n>i)&&(i=n)}e[s].push(r)});for(const r of yT){const s=this._layerViews[r],n=e[r];n.reverse();const o=n.length;let a=s.length!==o;const l=new Array(o),c=new Array(s.length);this._layerIndexByUid[r].clear();for(let u=0;u<o;u++){const d=n[u].uid;this._layerIndexByUid[r].set(d,u);const f=s.indexOf(n[u]);l[u]=f,u!==f&&(a=!0),f>-1&&(c[f]=u)}if(a){const u=this._postorderIterator;for(u.reset(this._rootTiles);!u.done;)u.next().modifyLayers(c,l,r);this._layerViews[r]=n,this._restartAllAgents(r),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&(this._viewChangeUpdate(),this.notifyChange("tilingScheme"))}_restartAllAgents(t){const e=this._postorderIterator;for(e.reset(this._rootTiles);!e.done;){const i=e.next();i.restartAgents(t),t===ei.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(t,e){return this._layerViews[e][t]}numLayers(t){return this._layerViews[t].length}_updateTileTextures(t){this._allTiles.forAll(e=>{e.updateAgents(ei.MAP),t===Cn.IMMEDIATE?this.renderer.updateTileTexture(e,St.TEXTURE_NOFADING):e.updateRenderData(ei.MAP,t)}),this._evaluateTransparency()}_invalidateLayerData(t,e){this._allTiles.forAll(i=>i.removeLayerAgent(t,e)),this._allTiles.forAll(i=>i.invalidateLayerData(t,e))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(t=cr.UPDATE){this.renderer.setNeedsRender(t)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(t,e,i,r){const s=this.layerViewByIndex(e,i),n=s.layer;return!n.tilemapCache||tO(s)?this._requestTileData(t,i,s,r):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(t.lij[0],t.lij[1],t.lij[2],{...r,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,Dt(r),us(o)||this._dataMissing(t,i,s),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(t,i,s,r),r.signal)))}_requestTileData(t,e,i,r){const s=e===ei.ELEVATION;return r.requester??(r.requester=s?this._elevationDataRequester:this._mapDataRequester),s?Pee(i)?this._requestElevationTileData(t,i,r):Promise.reject():Oee(i)?this._requestMapTileData(t,i,r):Promise.reject()}_requestElevationTileData(t,e,i){++this._asyncWorkItems;const r=n=>{!ha(i)&&n&&(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(t,e,n))},s=n=>{us(n)||(ne.getLogger(this).error(`Tile ${t.lij.toString()} layer ${ei.ELEVATION}/${e.uid} error ${n}`),this._dataMissing(t,ei.ELEVATION,e),this.requestUpdate())};return e.fetchTile(t.lij,i).then(n=>this._frameTask.schedule(()=>r(n)),s).finally(()=>--this._asyncWorkItems)}_elevationDataArrived(t,e,i){const r=this._layerIndexByUid[ei.ELEVATION].get(e.uid);if(r==null)return void ne.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",ei.ELEVATION,t.lij.toString());const s=new uLt(t.lij,t.extent,i);t.dataArrived(r,ei.ELEVATION,s);const n=[t],o=t.level,a=this._iteratorPool.acquire();for(a.reset(n);!a.done;){const l=a.next();l.findElevationBoundsForLayer(r,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(n)}_requestMapTileData(t,e,i){++this._asyncWorkItems;const r=(a,l)=>{qA(l),ha(i)||(console.error(`Tile ${t.lij.toString()} layer ${ei.MAP}/${e.uid} error ${a}`),this._dataMissing(t,ei.MAP,e),this.requestUpdate())},s=a=>l=>r(l,a),n=a=>this._frameTask.schedule(()=>{this.requestUpdate(),ha(i)?qA(a):this._mapTileDataArrived(t,e,a)},i.signal,s(a)).catch(s(a)),o=(a,l=null)=>this._frameTask.schedule(()=>r(a,l));return e.fetchTile(t.lij,i).then(n,o).finally(()=>--this._asyncWorkItems)}_mapTileDataArrived(t,e,i){const r=this._getLayerIdxByUID(ei.MAP,e.uid);if(r==null)return qA(i),void ne.getLogger(this).warn("TerrainSurface: received data from unknown layer");t.dataArrived(r,ei.MAP,i)}_getLayerIdxByUID(t,e){return this._layerIndexByUid[t].get(e)}_dataMissing(t,e,i){const r=this._getLayerIdxByUID(e,i.uid);r!=null?t.dataMissing(r,e):ne.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(t){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(e=>{e.renderData&&this.overlayManager.setTileParameters(e)}),this._renderer.setNeedsRender(t))}get performanceInfo(){const t=this._performanceInfo;return t.numNodes=this._allTiles.length,t.numLeaves=t.numVisible=t.numRendered=t.numLoadedPerLevel.length=t.numRenderedPerLevel.length=0,this._allTiles.forAll(e=>{e.isLeaf&&t.numLeaves++;const i=e.level;e.renderData&&(t.numLoadedPerLevel[i]=(t.numLoadedPerLevel[i]||0)+1),e.visible&&(t.numVisible++,e.rendered&&(t.numRenderedPerLevel[i]=(t.numRenderedPerLevel[i]||0)+1,t.numRendered++))}),t}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((t,e)=>t+e.usedMemory,0)):null}getUsedMemoryForLayerView(t){let e=0;const i=this._layerClassFromLayerView(t),r=this._getLayerIdxByUID(i,t.uid);return r!=null&&this._allTiles.forAll(s=>e+=s.getUsedMemoryForLayer(i,r)),e}getTile(t){if(t==null||this._rootTiles==null)return null;const e=t.split("/").map(o=>+o);if(e[0]===0)return this._rootTiles.find(o=>o.lij[1]===e[1]&&o.lij[2]===e[2]);const i=e[0],r=e[1]>>i,s=e[2]>>i;let n;if(this._rootTiles.some(o=>o.lij[1]===r&&o.lij[2]===s&&(n=o,!0)),n){let o=1<<e[0]-1;for(;n.lij[0]<e[0];){let a=e[1]&o?2:0;if((e[2]&o)>0&&a++,!n.children[a])return null;n=n.children[a],o>>=1}return Bn(n.lij[0]===e[0]&&n.lij[1]===e[1]&&n.lij[2]===e[2],"not the right tile?"),n}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(t){this._renderer.renderPatchBorders=t}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(t){this._renderer.visualizeNormals=t}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(t){this._renderer.renderingDisabled=t}get test(){}checkAllTilesWaterproofness(){if(!Aj)return;const t=this._rootTiles;if(t==null)return;const e=n=>{var o,a,l;return((l=(a=(o=n==null?void 0:n.renderData)==null?void 0:o.geometry)==null?void 0:a.indices)==null?void 0:l.length)>0},i=(n,o)=>{e(n)&&console.error("Tile[",n.lij,"] has geometry although parent[",o.lij,"] has geom")},r=n=>{var o,a;if(n.intersectsClippingArea)if(n.renderData&&!n.renderData.geometryState&&console.error("Tile[",n.lij,"] has renderData but not geometryState"),n.renderData&&!n.renderData.geometry&&console.error("Tile[",n.lij,"] has renderData but not geometryInfo"),!((o=n.renderData)!=null&&o.geometry)||(((a=n.renderData.geometry.indices)==null?void 0:a.length)??0)>0||console.error("Tile[",n.lij,"] has renderData but no indices - geometryInfo: ",n.renderData.geometry),e(n)){n.checkGeometryWaterproofness();for(const l of n.children)i(l,n)}else if(n.isLeaf)console.error("Tile[",n.lij,"] has no geometry and no children, from root to leaf");else for(const l of n.children)r(l)},s=n=>{var c;const o=((c=n.parent)==null?void 0:c.visible)??!0,a=n.visible;n.computeVisibility();const l=n.visible;if(a!==l&&o&&console.error(" Tile[",n.lij,"] has out of date visibility: ",a," instead of ",l),!n.isLeaf)for(const u of n.children)s(u)};for(const n of t)r(n),s(n)}get isGlobal(){return this._isGlobal}get isGeographic(){return this._isGeographic}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateCarree(){return this._isWebMercatorOnPlateCarree}isEastEndWrap(t){return this._isGlobal&&t[2]===this.lijEastEnd(t[0])-1}isWestEndWrap(t){return this._isGlobal&&t[2]===0}lijEastEnd(t){return 1<<t+(this._isGeographic?1:0)}wrapEastWest(t){const e=this.lijEastEnd(t[0]),i=t[2];if(0<=i&&i<e)return t;if(!this._isGlobal)return null;const r=(i+(i<0?e:0))%e;return[t[0],t[1],r]}enableInternalChecks(t){SLt(t)}enableWaterproofnessChecks(t){TLt(t)}};ni._tileMemcacheKey="TerrainTileMemcache",h([p()],ni.prototype,"_renderer",void 0),h([p({constructOnly:!0})],ni.prototype,"_scaleRangeQueries",void 0),h([p({constructOnly:!0})],ni.prototype,"view",void 0),h([p({constructOnly:!0})],ni.prototype,"overlayManager",void 0),h([p()],ni.prototype,"_hasPendingUpdates",void 0),h([p()],ni.prototype,"_asyncWorkItems",void 0),h([p()],ni.prototype,"_allTilesDirty",void 0),h([p()],ni.prototype,"_allTilesSorted",void 0),h([p()],ni.prototype,"_viewChanged",void 0),h([p({type:Number})],ni.prototype,"heading",void 0),h([p()],ni.prototype,"_splitLimits",void 0),h([p({readOnly:!0})],ni.prototype,"_watchUpdatingTracking",void 0),h([p()],ni.prototype,"_frameTask",void 0),h([p({readOnly:!0})],ni.prototype,"snapLevel",null),h([p({readOnly:!0})],ni.prototype,"lodSnapping",null),h([p()],ni.prototype,"_userClippingExtent",null),h([p()],ni.prototype,"_rootTilesExtent",void 0),h([p({readOnly:!0})],ni.prototype,"extent",null),h([p({readOnly:!0})],ni.prototype,"groundExtent",null),h([p({readOnly:!0})],ni.prototype,"_tilingSchemeExtent",null),h([p({readOnly:!0})],ni.prototype,"updating",null),h([p({readOnly:!0})],ni.prototype,"running",null),h([p(lLt)],ni.prototype,"updatingProgress",void 0),h([p({readOnly:!0})],ni.prototype,"updatingProgressValue",null),h([p()],ni.prototype,"_maxNumUpdating",void 0),h([p()],ni.prototype,"baseOpacity",null),h([p()],ni.prototype,"hasCompositeBlendMode",void 0),h([p({readOnly:!0})],ni.prototype,"viewingMode",null),h([p()],ni.prototype,"maxTextureScale",void 0),h([p({readOnly:!0})],ni.prototype,"ready",null),h([p({value:iO.FRONT_TO_BACK})],ni.prototype,"renderOrder",null),h([p({readOnly:!0})],ni.prototype,"rootTiles",null),h([p()],ni.prototype,"_rootTiles",void 0),h([p({readOnly:!0})],ni.prototype,"spatialReference",null),h([p({type:je})],ni.prototype,"backgroundColor",null),h([p({value:!1})],ni.prototype,"slicePlaneEnabled",null),h([p({readOnly:!0})],ni.prototype,"tilingScheme",void 0),h([p({readOnly:!0})],ni.prototype,"tilingSchemeLocked",null),h([p({readOnly:!0})],ni.prototype,"tilingSchemeLogic",void 0),h([p()],ni.prototype,"wireframe",null),h([p({value:!1})],ni.prototype,"suspended",null),h([p()],ni.prototype,"fadeDuration",null),h([p()],ni.prototype,"visibleElevationBounds",void 0),h([p()],ni.prototype,"rootTileElevationBounds",void 0),h([p()],ni.prototype,"_layerViewsDirty",void 0),h([p()],ni.prototype,"renderPatchBorders",null),h([p()],ni.prototype,"visualizeNormals",null),h([p()],ni.prototype,"renderingDisabled",null),ni=_V=h([I("esri.views.3d.terrain.TerrainSurface")],ni);const KNt=ni,tR=C(),pC=_n(),eFt=oi();new ai;const q7=new aLt("ground"),V5={spatialReference:null,extent:null,scale:0};function b1e(t,e,i){var r;for(const s of t){if(!s.containsPointXY(e,i))continue;let n=s;for(;n&&!n.renderData;){const a=(e>n.extentMidX?1:0)+(i<n.extentMidY?2:0);n=n.children[a]}const o=((r=n==null?void 0:n.renderData)==null?void 0:r.geometryState.samplerData)??null;return Ps(e,i,o)}return null}class tFt{constructor(e){this.capacity=e,this._head=0,this._tail=0,this._data=new Array(e)}push(e){const i=this._tail;if(!(i<this.capacity))throw new Error("Queue full");this._data[i]=e,this._tail=i+1}pushAll(e){const i=e.length;if(i===0)return;const r=this._tail;if(!(r+i<=this.capacity))throw new Error("Queue full");for(let s=0;s<i;++s)this._data[r+s]=e[s];this._tail=r+i}pop(){const e=this._head;if(e<this._tail){const i=this._data[e];return this._head=e+1,i}}get empty(){return this._head>=this._tail}get full(){return this._tail>=this._data.length}}function W7(t,e){!t.isLeaf||t.level<qn||$le(t,i=>{e&&OVe(i);const r=jee(i);if(i.maxLevelDeltaNeighborCount++,r){let s=i.parent;for(;s;){const n=jee(s);if(s.unmergableChildCount++,!n)break;s=s.parent}}})}function OVe(t){if(t.hasPendingUpdate(St.SPLIT))return;let e=t.parent;for(;e!=null&&e.resetPendingUpdate(St.MERGE);)e=e.parent;t.resetPendingUpdate(St.MERGE),t.isLeaf&&t.setPendingUpdate(St.SPLIT),t.level<qn||$le(t,i=>{OVe(i)})}function w1e(t){t.level<qn||$le(t,e=>{if(e.maxLevelDeltaNeighborCount--,e.maxLevelDeltaNeighborCount===0&&e.unmergableChildCount===0){let i=e.parent;for(;i&&(i.unmergableChildCount--,jee(i));)i=i.parent}})}function jee(t){return t.maxLevelDeltaNeighborCount===0&&t.unmergableChildCount===0}function $le(t,e){if(t.level<qn)return;const i=t.level-qn,r=t.lij[1]>>qn,s=t.lij[2]>>qn,n=o=>o.isLeaf||o.level===i;for(let o=0;o<4;++o){const a=t.findNeighborTile(Xf[o],n);if(!a||a.level!==i)continue;const l=a.lij;l[1]===r&&l[2]===s||e(a)}}let iFt=class{constructor(e,i,r,s){this.operation=e,this.geometry=i,this.states=r,this.sync=s}},qI=class extends Ue{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,i){const r=this._dirtyGeomRecords.get(e);r&&(r.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c},u)=>{let d=!1;if(l===bs.UPDATE){const f=o.get(u);if(f){if(c&Jn.TRANSFORMATION){const m=this.model.getObject(n);this.model.updateRenderGeometryTransformation(m,a,f)&&(d=!0)}d||i.updates.push({renderGeometry:f,updateType:c})}else bt(!1,"ModelDirtySet.commitLayer: invalid update")}if(l===bs.REMOVE||d){const f=o.get(u);f?(i.removes.push(f),o.delete(u)):l===bs.REMOVE&&bt(!1,"ModelDirtySet.commitLayer: invalid remove")}if(l===bs.ADD||d){const f=this.model.getObject(n);if(f!=null){const m=this.model.getRenderGeometry(f,a);i.adds.push(m),o.set(u,m)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(n)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}commitSyncUpdates(e,i){const r=this._dirtyGeomRecords.get(e);r&&r.forEach((s,n)=>{const o=this._ensureGeomRecord(e,n);s.forEach(({geometry:a,operation:l,states:c,sync:u},d)=>{let f=!1;if(l===bs.UPDATE&&u){const m=o.get(d);if(m){if(c&Jn.TRANSFORMATION){const g=this.model.getObject(n);this.model.updateRenderGeometryTransformation(g,a,m)&&(f=!0)}f||i.updates.push({renderGeometry:m,updateType:c})}else bt(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}})})}getResidentRenderGeometries(e,i){const r=this._residentGeomRecords.get(e);r&&r.forEach(s=>s.forEach(n=>i.push(n)))}_objectStateChanged(e,i){for(const r of i.geometries)this._updateOrCreateDirtyRecord(i,r,null,bs.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(Jn.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(Jn.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(Jn.OCCLUDEE,e)}attributesChanged({object:e,geometry:i,sync:r}){this._updateOrCreateDirtyRecord(e,i,null,bs.UPDATE,Jn.GEOMETRY,r)}layerAdded(e){e.objects.forAll(i=>this._layerObjectAdded(e,i))}layerRemoved(e){e.objects.forAll(i=>this._layerObjectRemoved(e,i))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,i){const r=e.id;for(const s of i.geometries)this._geometryAdded(i,s,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const i of e.objects)this._layerObjectAdded(e.layer,i)}layerObjectsRemoved(e){for(const i of e.objects)this._layerObjectRemoved(e.layer,i)}_layerObjectRemoved(e,i){const r=e.id;for(const s of i.geometries)this._geometryRemoved(i,s,r)}transformationChanged(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(s=>{this._updateOrCreateDirtyRecord(e,s.geometry,i,bs.UPDATE,Jn.TRANSFORMATION)})}shaderTransformationChanged(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(s=>{s.objectShaderTransformationChanged(e.shaderTransformation)})}geometryAdded(e){this._geometryAdded(e.object,e.geometry)}_geometryAdded(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,bs.ADD)}geometryRemoved(e){this._geometryRemoved(e.object,e.geometry)}_geometryRemoved(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,bs.REMOVE)}_updateOrCreateDirtyRecord(e,i,r,s,n=Jn.NONE,o=!1){r=r??this._getParentLayerId(e);const a=e.id,l=i.id,c=this._ensureDirtyRecord(r,a),u=c.get(l);let d=!1;if(u){const f=u.operation;f===bs.REMOVE&&s===bs.ADD&&u.states!==Jn.NONE?u.operation=bs.UPDATE:f===bs.REMOVE&&s===bs.ADD||f===bs.ADD&&s===bs.REMOVE?(c.delete(l),d=!0):f!==bs.UPDATE||s!==bs.REMOVE&&s!==bs.UPDATE?(bt((f===bs.REMOVE||f===bs.ADD)&&s===bs.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),u.states|=n):(u.operation=s,u.states|=n),u.sync=u.sync||o}else c.set(l,new iFt(s,i,n,o));this.dirty=!d||this._hasDirtyGeometryRecords}_ensureGeomRecord(e,i){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let s=r.get(i);return s||(s=new Map,r.set(i,s)),s}get _hasDirtyGeometryRecords(){for(const e of this._dirtyGeomRecords.values())for(const i of e.values())if(i.size>0)return!0;return!1}_ensureDirtyRecord(e,i){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let s=r.get(i);return s||(s=new Map,r.set(i,s)),s}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:W7e}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let i="";return this._dirtyGeomRecords.forEach((r,s)=>{r.forEach((n,o)=>{i.length>0&&(i+=`
`),i+=s+"."+o;const a=[];n.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){i+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)i+=a[l][c]+", "}})}),i}get test(){}};h([p({constructOnly:!0})],qI.prototype,"model",void 0),h([p()],qI.prototype,"dirty",void 0),qI=h([I("esri.views.3d.webgl-engine.lib.ModelDirtySet")],qI);const rFt=qI;let vV=class extends Ue{constructor(){super(...arguments),this.dirtySet=new rFt({model:this}),this._content=new Map,this._originFactory=new XFe(null)}getObject(e){return this._content.get(e)}add(e){const i=e.id;bt(!this._content.has(i),"Model/Stage already contains object to be added"),this._content.set(i,e),lj(e)&&this.dirtySet.layerAdded(e)}remove(e){return!!this._content.has(e.id)&&(this._content.delete(e.id),lj(e)&&this.dirtySet.layerRemoved(e),!0)}addMany(e){for(const i of e)i&&(bt(!this._content.has(i.id),"Model/Stage already contains object to be added"),this._content.set(i.id,i))}removeMany(e){for(const i of e)i&&(bt(this._content.has(i.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(i.id))}has(e){return this._content.has(e.id)}forEachOfType(e,i){this._content.forEach(r=>{r.type===e&&i(r)})}getRenderGeometry(e,i){const r=new KP(i,{castShadow:e.castShadow,objectShaderTransformation:e.shaderTransformation});r.transformation=e.getCombinedStaticTransformation(i,x1e);const{localOrigin:s}=i;return r.localOrigin=s??this._originFactory.getOrigin(r.boundingSphere),r}updateRenderGeometryTransformation(e,i,r){if(e==null)return!1;r.transformation=e.getCombinedStaticTransformation(i,x1e);const s=this._originFactory.getOrigin(r.boundingSphere);return r.localOrigin!==s}getStats(){const e={},i=Array.from(this._content.values());for(let r=0;r<Gs.COUNT;++r)e[r]=i.filter(s=>s.type===r).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){}};h([p({constructOnly:!0})],vV.prototype,"dirtySet",void 0),vV=h([I("esri.views.3d.webgl-engine.parts.Model")],vV);const x1e=ke();let sFt=class{constructor(e){this._totalCount=e,this._componentCountCache=-1,this._indexRanges=[0,e]}allVisible(){return this.componentCount===this._totalCount}allInvisible(){return this._indexRanges.length===0}isVisible(e){if(e<0||e>=this._totalCount)return!1;if(this.allVisible())return!0;{const i=this._indexRanges;let r=0,s=i.length/2;if(e<i[2*r]||e>i[2*s]+i[2*s+1])return!1;for(;s-r>0;){const n=Math.floor(.5*(r+s)),o=i[2*n];if(e<o){if(s-r==1)return!1;s=n;continue}if(e<o+i[2*n+1])return!0;if(s-r==1)return!1;r=n+1}return!1}}get componentCount(){if(this._componentCountCache===-1){const e=this._indexRanges;let i=0;for(let r=0;r<e.length;r+=2)i+=e[r+1];this._componentCountCache=i}return this._componentCountCache}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=nFt(e),this._componentCountCache=-1}forEachComponent(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r],n=s+i[r+1];for(let o=s;o<n;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r];if(!e(s,s+i[r+1]))return!1}return!0}computeOffsetRanges(e){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){const n=r[s],o=n+r[s+1],a=e[n],l=e[o];i[s]=a,i[s+1]=l-a}return i}};function nFt(t){const e=new Array;if(t.length===0)return e;let i=t[0],r=1;for(let s=1;s<t.length;s++){const n=t[s];i+r===n?r+=1:(e.push(i),e.push(r),i=n,r=1)}return e.push(i),e.push(r),e}let oFt=class{constructor(e,i){this.offsets=i,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const r=this.count;this.visibility=new sFt(r),this.materialDataBuffer=e.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:e,defaultRanges:i}=aFt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=i}}};function aFt(t,e,i){const r=[],s=[];let n=i.length,o=i.length;return e.forEachComponent(a=>(t[a]>0?(n!==a-1&&(r.length&&r.push(i[n+1]-r[r.length-1]),r.push(i[a])),n=a):(o!==a-1&&(s.length&&s.push(i[o+1]-s[s.length-1]),s.push(i[a])),o=a),!0)),r.length&&r.push(i[n+1]-r[r.length-1]),s.length&&s.push(i[o+1]-s[s.length-1]),{highlightRanges:r,defaultRanges:s}}let lFt=class{constructor(e,i,r,s,n,o){this.transform=e,this.toMapSpace=i,this.obb=r,this.components=s,this.renderable=n,this.intersectionGeometry=o,this.visible=!1,this.offsetObb=null}destroy(){this.intersectionGeometry=He(this.intersectionGeometry),this.renderable=He(this.renderable),this.components=He(this.components)}};function cFt(t,e,i,r,s,n,o){const a=n-o,l=e-t,c=new Float64Array(4*l);for(let u=0;u<l;++u){const d=3*(u+t),f=s*i[d+0],m=r[f+0],g=r[f+1],y=a/(r[f+2]-o),v=m*y,b=g*y,w=s*i[d+1],x=r[w+0],T=r[w+1],E=a/(r[w+2]-o),M=x*E,O=T*E,D=s*i[d+2],U=r[D+0],k=r[D+1],H=a/(r[D+2]-o),V=U*H,X=k*H,q=4*u;c[q+0]=Math.min(v,M,V),c[q+1]=Math.min(b,O,X),c[q+2]=Math.max(v,M,V),c[q+3]=Math.max(b,O,X)}return c}function uFt(t,e,i,r,s){const n=e-t,o=new Float64Array(4*n);for(let a=0;a<n;++a){const l=3*(a+t),c=s*i[l+0],u=r[c+0],d=r[c+1],f=s*i[l+1],m=r[f+0],g=r[f+1],y=s*i[l+2],v=r[y+0],b=r[y+1],w=4*a;o[w+0]=Math.min(u,m,v),o[w+1]=Math.min(d,g,b),o[w+2]=Math.max(u,m,v),o[w+3]=Math.max(d,g,b)}return o}function hFt(t,e){return new(dFt(t))(e)}function dFt(t){return t<128?Uint8Array:t<32768?Uint16Array:t<1<<31?Uint32Array:Array}let $Ve=class{constructor(e,i){this.elementCount=e,this.model=i,this._elementIndexMap=null,this._bspNodes=[],this._generatedBVH=!1,this.localMode=i.localMode,this.planetCenterZ=i.planetCenterZ,this.geometryMinZ=i.geometryMinZ,this.planetCenter=qe(0,0,this.planetCenterZ),this.maxBspNodeDepth=i.maxBspNodeDepth??8,this.minElementCountForBVH=i.minElementCountForBVH??15,this.minBspNodeElementCount=i.minBspNodeElementCount??5}get elementIndexMap(){return this._ensureBVH(),this._elementIndexMap}get _skipBVH(){return this.elementCount<this.minElementCountForBVH||this.geometryMinZ<.5*this.planetCenterZ}_ensureBVH(){this._generatedBVH||this._skipBVH||this._bspNodes.length===0&&this._generateBsp()}intersectRay(e,i,r){this.elementCount<1||(this._skipBVH?this._intersectRayWithoutBVH(r):this._intersectRayWithBVH(e,i,r))}_intersectRayWithoutBVH(e){this._intersectRange(0,this.elementCount)}_intersectRange(e,i){this.model.intersectRange(e,i)}_intersectRayWithBVH(e,i,r){this._ensureBVH(),r?this._intersectGeometryWithBVHVerticalRay(e):this._intersectGeometryWithBVHGeneralRay(e,i)}_intersectGeometryWithBVHVerticalRay(e){let i=e[0],r=e[1];if(!this.localMode){const{geometryMinZ:o,planetCenterZ:a}=this,l=(o-a)/(e[2]-a);i=e[0]*l,r=e[1]*l}const{_bspNodes:s}=this;let n=0;for(;n>=0;){const o=s[n],{d:a,dim:l,minIndexIndex:c,minMidIndexIndex:u,maxMidIndexIndex:d,maxIndexIndex:f,aabb2D:m}=o;if(i<m[0]||i>m[2]||r<m[1]||r>m[3])break;if(l===-1||o.child0===-1&&o.child1===-1){this._intersectRange(c,f);break}{this._intersectRange(u,d);const g=(l===0?i:r)-a;if(g<0){if(o.child0===-1){this._intersectRange(c,u);break}n=o.child0}else{if(!(g>0))break;if(o.child1===-1){this._intersectRange(d,f);break}n=o.child1}}}}_intersectGeometryWithBVHGeneralRay(e,i){let r=e[0],s=e[1],n=i[0],o=i[1];const{geometryMinZ:a}=this;if(!this.localMode){let g=0,y=1;const v=Math.min(.5*this.planetCenterZ,a),b=e[2],w=i[2];if(b<v&&w<v||(b<v&&(g=(v-b)/(w-b)),w<v&&(y=(v-b)/(w-b)),g>y))return;const x=(1-g)*e[0]+g*i[0],T=(1-g)*e[1]+g*i[1],E=(1-g)*e[2]+g*i[2],M=(1-y)*e[0]+y*i[0],O=(1-y)*e[1]+y*i[1],D=(1-y)*e[2]+y*i[2],{planetCenterZ:U}=this,k=a-U,H=k/(E-U);r=x*H,s=T*H;const V=k/(D-U);n=M*V,o=O*V}const l=n-r,c=o-s,u=this._bspNodes;let d=1;{const{aabb2D:g}=u[0],y=(w,x,T,E)=>{if(Math.abs(x)<1e-5*Math.max(E-T,1))return!1;const M=x>0,O=M?E:T,D=w+d*x;return(M?D<O:D>O)&&(d=Math.max((O-w)/x,d),!0)},v=()=>y(r,l,g[0],g[2]),b=()=>y(s,c,g[1],g[3]);Math.abs(l)>=Math.abs(c)?v()||b():b()||v()}const f=[0,0,d];let m=0;for(;m<f.length;){const g=f[m];let y=f[m+1],v=f[m+2];if(m+=3,y>v)continue;const b=u[g],{minIndexIndex:w,maxIndexIndex:x}=b,{child0:T,child1:E,minMidIndexIndex:M,maxMidIndexIndex:O,aabb2D:D,d:U,dim:k}=b;{const H=r+y*l,V=r+v*l,X=Math.min(H,V),q=Math.max(H,V),Z=D[0],ye=D[2];if(q<Z||ye<X)continue;if(X<Z){const L=(Z-r)/l;l>0?y=Math.max(y,L):v=Math.min(v,L)}if(ye<q){const L=(ye-r)/l;l>0?v=Math.min(v,L):y=Math.max(y,L)}}{const H=s+y*c,V=s+v*c,X=Math.min(H,V),q=Math.max(H,V),Z=D[1],ye=D[3];if(q<Z||ye<X)continue;if(X<Z){const L=(Z-s)/c;c>0?y=Math.max(y,L):v=Math.min(v,L)}if(ye<q){const L=(ye-s)/c;c>0?v=Math.min(v,L):y=Math.max(y,L)}}if(T===-1&&E===-1)this._intersectRange(w,x);else{const H=k===0?r:s,V=k===0?l:c,X=H+y*V,q=H+v*V,Z=Math.min(X,q),ye=Math.max(X,q),L=Ne((U-H)/V,0,d);w<M&&Z<=U&&(T!==-1?(f.push(T),f.push(V>=0?y:Math.max(y,L)),f.push(V>=0?Math.min(v,L):v)):this._intersectRange(w,M)),this._intersectRange(M,O),O<x&&U<=ye&&(E!==-1?(f.push(E),f.push(V>=0?Math.max(y,L):y),f.push(V>=0?v:Math.min(v,L))):this._intersectRange(O,x))}}}_generateBsp(){const{elementCount:e}=this;if(e<1)return;const i=hFt(e,e);this._elementIndexMap=i;for(let m=0;m<e;++m)i[m]=m;const r=this.model.getAabbs2D();let s=0;const n=this._bspNodes;n.length=0;const{localMode:o}=this;let a=!1;if(!o){const{planetCenterZ:m,geometryMinZ:g}=this;a=m>=0||g<.5*m}const l=[],c=(m,g,y,v,b)=>{l.push(m),l.push(g),l.push(y),l.push(v<0?-1:(b?0:1)+2*v)},{maxBspNodeDepth:u,minBspNodeElementCount:d}=this,f=(m,g,y,v,b)=>{const w=n.length;if(w>0&&(a||y>=u||g-m<d))return;const x=[0,0,0,0];gFt(x,m,g,i,r);const{d:T,dim:E}=o?pFt(x):fFt(x),{rangeMidStart:M,rangeMidEnd:O}=mFt(m,g,E,T,i,r),D=y===u-1,U=!D&&M>=m+d,k=!D&&g>=O+d;if(U||k||w===0){const H=new yFt(m,M,O,g,E,T,x);if(U&&c(m,M,y+1,w,!0),k&&c(O,g,y+1,w,!1),n.push(H),v!==-1){const V=n[v];b?V.child0=w:V.child1=w}}};for(c(0,e,0,-1,!1);s<l.length;){const m=l[s],g=l[s+1],y=l[s+2],v=l[s+3];s+=4;const b=v>>1;f(m,g,y,b,v-(b<<1)==0)}this._generatedBVH=!0}};function pFt(t){const e=t[0],i=t[1],r=t[2],s=t[3];let n,o;return r-e>=s-i?(o=.5*(e+r),n=0):(o=.5*(i+s),n=1),{d:o,dim:n}}function fFt(t){const e=t[0],i=t[1],r=t[2],s=t[3];let n,o;return r-e>=s-i?(n=0,o=.5*(e+r)):(n=1,o=.5*(i+s)),{dim:n,d:o}}function mFt(t,e,i,r,s,n){let o=t;{let u=e;for(;o<u;){const d=s[o];T1e(d,i,r,n)<0?++o:(--u,s[o]=s[u],s[u]=d)}}const a=o;let l=o,c=e;for(;l<c;){const u=s[c-1];T1e(u,i,r,n)>0?--c:(s[c-1]=s[l],s[l]=u,++l)}return{rangeMidStart:a,rangeMidEnd:c}}function T1e(t,e,i,r){const s=4*t,n=r[s+0+e];return r[s+2+e]<i?-1:n>i?1:0}function gFt(t,e,i,r,s){let n=1/0,o=1/0,a=-1/0,l=-1/0;for(let c=e;c<i;++c){const u=4*r[c];n=Math.min(n,s[u+0]),o=Math.min(o,s[u+1]),a=Math.max(a,s[u+2]),l=Math.max(l,s[u+3])}t[0]=n,t[1]=o,t[2]=a,t[3]=l}let yFt=class{constructor(e,i,r,s,n,o,a){this.minIndexIndex=e,this.minMidIndexIndex=i,this.maxMidIndexIndex=r,this.maxIndexIndex=s,this.dim=n,this.d=o,this.aabb2D=a,this.child0=-1,this.child1=-1}},_Ft=class{constructor(e,i,r,s,n,o,a,l,c){this.componentIndex=e,this.vertexData=i,this.vertexStride=r,this.indexData=s,this.startTriangleNumber=n,this.endTriangleNumber=o,this.geometryMinZ=a,this.planetCenterZ=l,this.localMode=c,this.maxBspNodeDepth=8,this.minElementCountForBVH=20,this.minBspNodeElementCount=10,this.rayDirection=C(),this.ray0=C(),this.isVerticalRay=!1,this._triangleHitCallback=S1e,this.totalElevationOffset=0,this.normalRequired=!1,this._bvh=new $Ve(o-n,this)}getAabbs2D(){return this.localMode?uFt(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride):cFt(this.startTriangleNumber,this.endTriangleNumber,this.indexData,this.vertexData,this.vertexStride,this.geometryMinZ,this.planetCenterZ)}get numTriangles(){return this.endTriangleNumber-this.startTriangleNumber}intersectRay(e,i,r,s,n,o){ve(this.ray0,e),Li(this.rayDirection,i,e),this.isVerticalRay=r,this.totalElevationOffset=s,this.normalRequired=o,this._triangleHitCallback=n,this._bvh.intersectRay(e,i,r),this._triangleHitCallback=S1e}intersectRange(e,i){const r=this._bvh.elementIndexMap;RVe(this.ray0,this.rayDirection,e,i,this.indexData,this.vertexData,this.vertexStride,this.totalElevationOffset,this.planetCenterZ,this.normalRequired,this._triangleHitCallback,r,this.startTriangleNumber)}getTriangleElevationOffset(e){return this.totalElevationOffset}};function RVe(t,e,i,r,s,n,o,a,l,c,u,d=null,f=0){a!==0?Ovt(t,e,i,r,s,n,o,a,l,c,u,d,f):ZDe(t,e,i,r,s,n,o,c,u,d,f)}function S1e(){}function vFt(t,e,i,r){if(i>=e)return t;t==null&&(t=bFt());const s=t.isVisibleBit;let n=t.data;const o=IVe(n),a=i/o|0,l=i-o*a,c=(e-1)/o|0,u=n,d=r===s;if(!(i<u.length*o)&&d){const f=a+1,m=Math.ceil(u.length*cG),g=c+1;let y=Math.max(f,m);y=Math.min(y,g),n=new Uint32Array(y),n.set(u)}return a<n.length&&(n[a]=xFt(n[a],l,d)),t.data=n,t}function Gee(t,e){if(t==null)return!0;const{isVisibleBit:i,data:r}=t,s=IVe(r);return e<r.length*s?wFt(i,r,e,s):!t.isVisibleBit}function bFt(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function wFt(t,e,i,r){const s=i/r|0,n=i-s*r;return TFt(e[s],n)===t}function IVe(t){return t.BYTES_PER_ELEMENT*8}function xFt(t,e,i){return t&~(1<<e)|(i?1:0)<<e}function TFt(t,e){return!!(t&1<<e)}let SFt=class{constructor(e,i,r,s,n,o,a,l){this.vertexData=e,this.vertexStride=i,this.indexData=r,this._components=s,this._componentAabbs3D=n,this.geometryMinZ=o,this.planetCenterZ=a,this.localMode=l,this.maxBspNodeDepth=6,this.minElementCountForBVH=10,this.minBspNodeElementCount=3,this._ray0=AFt,this._ray1=PFt,this._invDir=C(),this._componentVerticalOffsets=null,this._verticalOffset=null,this._tolerance=0,this._intersectionOptions=OFt,this._callback=E1e,this.rayDirectionC=C(),this._componentIndexMap=null,this._bvh=new $Ve(s.count,this),this.componentIntersectionData=new Array(s.count)}get numComponents(){return this._components.count}get minZGlobal(){return this.geometryMinZ-this.planetCenterZ}getAabbs2D(){return this.localMode?this.getAabbs2DLocal():this.getAabbs2DGlobal()}getAabbs2DGlobal(){const{numComponents:e,planetCenterZ:i,minZGlobal:r}=this,s=new Float64Array(4*e),n=this._componentAabbs3D;for(let o=0;o<e;++o){const a=6*o,l=n[a+0],c=n[a+1],u=n[a+2],d=n[a+3],f=n[a+4],m=r/(u-i),g=r/(n[a+5]-i),y=Math.min(l*m,l*g),v=Math.min(c*m,c*g),b=Math.max(d*m,d*g),w=Math.max(f*m,f*g),x=4*o;s[x+0]=y,s[x+1]=v,s[x+2]=b,s[x+3]=w}return s}getAabbs2DLocal(){const{numComponents:e}=this,i=new Float64Array(4*e),r=this._componentAabbs3D;for(let s=0;s<e;++s){const n=6*s,o=r[n+0],a=r[n+1],l=r[n+3],c=r[n+4],u=4*s;i[u+0]=o,i[u+1]=a,i[u+2]=l,i[u+3]=c}return i}intersectRay(e,i,r,s,n,o,a){const{isVerticalRay:l}=a;this._ray0=e,this._ray1=i,this._componentVerticalOffsets=r,this._verticalOffset=s,this._tolerance=o,this._intersectionOptions=a,this._componentIndexMap=this._bvh.elementIndexMap,Nvt(e,i,this._invDir),this._callback=n,this._bvh.intersectRay(e,i,l),this._callback=E1e}intersectRange(e,i){const r=this._componentIndexMap,s=this._components,n=s.pickability,o=s.visibility;for(let a=e;a<i;++a){const l=r?r[a]:a;Gee(n,l)&&o.isVisible(l)&&this._intersectComponent(l)}}getComponentTriangleCount(e){const i=this._components.offsets,r=i[e]/3;return i[e+1]/3-r}getComponentAabb3D(e,i){const r=this._componentAabbs3D,s=6*e;return i[0]=r[s],i[1]=r[s+1],i[2]=r[s+2],i[3]=r[s+3],i[4]=r[s+4],i[5]=r[s+5],i}_intersectComponent(e){if(!Gee(this._components.pickability,e))return;const i=this.getComponentAabb3D(e,EFt);let r=!1;const{localMode:s,_componentVerticalOffsets:n,_verticalOffset:o,_ray0:a,_ray1:l,_invDir:c,planetCenterZ:u,_tolerance:d,rayDirectionC:f,componentIntersectionData:m}=this,{isVerticalRay:g}=this._intersectionOptions,y=this._components.offsets,v=ve(CFt,a),b=ve(MFt,l),w=(n==null?void 0:n[e])??0,x=w+((o==null?void 0:o.offset)??0);if(x!==0&&(s?(v[2]=a[2]-x,b[2]=l[2]-x,r=!0):o!=null&&(o.componentOffset=w)),o==null||r||x===0||o.applyToAabb(i),!tae(i,v,c,d))return;Li(f,b,v);const T=y[e]/3,E=y[e+1]/3,M=E-T,O=(X,q,Z)=>{this._callback(X,q,e,Z)},{vertexData:D,vertexStride:U,indexData:k,_intersectionOptions:H}=this,{normalRequired:V}=H;if(M>$Ft){let X=m[e];X==null&&(X=new _Ft(e,D,U,k,T,E,this.geometryMinZ,u,s),m[e]=X),X.intersectRay(v,b,g,r?0:x,O,V)}else RVe(v,f,T,E,k,D,U,r?0:x,u,V,O)}};const EFt=io(),CFt=C(),MFt=C(),AFt=C(),PFt=C(),E1e=()=>{},OFt=new TN,$Ft=40;let RFt=class{constructor(e,i,r){this.viewingMode=e,this.positionData=i,this._components=r,this.verticalOffset=null,this.componentVerticalOffsets=null,this._planetCenter=C(),this._componentBvh=null,this._aabb=[0,0,0,0,0,0],this._indices=i.indices?oy(i.indices):sE(i.positions.length/3),this._positions=i.positions}destroy(){this._positions=null,this._indices=null,this._perComponentAabbs=null,this._componentBvh=null}getComponentAabb(e,i){const r=this._ensureComponentAabbs(),s=6*e;return i[0]=r[s],i[1]=r[s+1],i[2]=r[s+2],i[3]=r[s+3],i[4]=r[s+4],i[5]=r[s+5],i}getComponentAabbs(){return this._ensureComponentAabbs()}_ensureComponentAabbs(){return this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs()),this._perComponentAabbs}getComponentPositions(e,i){i.indices=this._indices,i.data=this._positions,i.stride=3,i.startIndex=this._components.offsets[e],i.endIndex=this._components.offsets[e+1]}intersect(e,i,r,s,n,o,a,l){this.verticalOffset=s,this.componentVerticalOffsets=n;const{position:c}=o,u=Li(IFt,e,c),d=Li(LFt,i,c),f=tN(DFt,o.rotationScale);ca(u,u,f),ca(d,d,f);const m=W2(FFt,f);if(this.viewingMode===Je.Global){const y=this._planetCenter;da(y,c),ca(y,y,f)}const g=(y,v,b,w)=>{l(b,y,w?ca(NFt,w,m):null,v)};this._intersectComponents(u,d,n,s,g,r,a)}_computePerComponentAabbs(){const e=this._aabb,i=.5*(e[0]+e[3]),r=.5*(e[1]+e[4]),s=.5*(e[2]+e[5]),n=this._components.count,o=$s(6*n),a=this._indices,l=this._positions,c=this._components.offsets;let u=0,d=1/0,f=1/0,m=1/0,g=-1/0,y=-1/0,v=-1/0;for(let b=0;b<n;b++){const w=c[b],x=c[b+1];let T=1/0,E=1/0,M=1/0,O=-1/0,D=-1/0,U=-1/0;if(w<x)for(let k=w;k<x;k++){const H=3*a[k],V=l[H],X=l[H+1],q=l[H+2];T=Math.min(T,V),E=Math.min(E,X),M=Math.min(M,q),O=Math.max(O,V),D=Math.max(D,X),U=Math.max(U,q)}else T=i,E=r,M=s,O=i,D=r,U=s;o[u++]=T,o[u++]=E,o[u++]=M,o[u++]=O,o[u++]=D,o[u++]=U,d=Math.min(d,T),f=Math.min(f,E),m=Math.min(m,M),g=Math.max(g,O),y=Math.max(y,D),v=Math.max(v,U)}return this._aabb[0]=d,this._aabb[1]=f,this._aabb[2]=m,this._aabb[3]=g,this._aabb[4]=y,this._aabb[5]=v,o}_intersectComponents(e,i,r,s,n,o,a){let l=this._componentBvh;l==null&&(l=new SFt(this._positions,3,this._indices,this._components,this._ensureComponentAabbs(),this.geometryMinZ,this.planetCenterZ,this.localMode),this._componentBvh=l),l.intersectRay(e,i,r,s,n,o,a)}get geometryMinZ(){return this._aabb[2]}get planetCenterZ(){return this._planetCenter[2]}get numTriangles(){return this._indices.length/3}get localMode(){return this.viewingMode===Je.Local}get positions(){return this._positions}get indices(){return this._indices}get aabb(){return this._ensureComponentAabbs(),this._aabb}};const IFt=C(),LFt=C(),DFt=Kr(),NFt=C(),FFt=Kr();let kFt=class{constructor(e,i,r){this.material=e,this.geometry=i,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}},UFt=class{constructor(e,i,r,s){this.vao=e,this.primitiveType=i,this.parameters=r,this.indexed=s}dispose(){this.vao.dispose()}},Rle=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function VFt(t,e){return{near:t,far:e}}function kN(t){return VFt(1/0,-1/0)}function Dj(t,e,i){return t.near=e,t.far=i,t}function rO(t,e){e!=null&&(t.near=Math.min(t.near,e.near),t.far=Math.max(t.far,e.far))}function z5(t,e){return t.near<=e&&e<=t.far}const Hee={near:0,far:0};function zFt(t,e){const i=kN(),{eye:r,frustum:s,viewForward:n}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=Te(Li(fh,a.center,r),n),c=a.projectedRadius(n);if(z5(i,l-c)&&z5(i,l+c))return;const u=qFt(a,s);if(u===-1)return;if(u===0)return c0.far=l+c,c0.near=l-c,void rO(i,c0);const d=B5.pushNew();d.near=l-c,d.far=l+c,d.mask=u,d.object=o});for(let o=0;o<B5.length;o++){const a=B5.data[o];if(z5(i,a.near)&&z5(i,a.far))continue;c0.far=a.far,c0.near=1/0,HFt(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,r,BFt,c=>{let u=jFt;for(let d=0;d<LVe&&c.length>0;d++){if(!(a.mask&1<<d))continue;GFt(s[d],c,u);const f=c;c=u,u=f}for(let d=0;d<c.length;d+=3){pe(Fc,c.data[d],c.data[d+1],c.data[d+2]);const f=Te(Li(Fc,Fc,r),n);c0.near=Math.min(c0.near,f)}})===0&&(c0.near=0),rO(i,c0)}return B5.length=0,i}const B5=new ai({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=null,t)}),c0=kN(),Fc=C(),Sx=C(),BFt=new ai({deallocator:null}),jFt=new ai({deallocator:null});function GFt(t,e,i){i.length=0;const r=e.length-3;Z7(Fc,e,r);const s=Rr(t,Fc);s<=0&&(i.push(Fc[0]),i.push(Fc[1]),i.push(Fc[2]));let n=0,o=s;for(;n<r;n+=3){Z7(Sx,e,n);const a=Rr(t,Sx);o*a<0&&(Sr(Fc,Sx,Fc,a/(a-o)),kc(i,Fc)),a<=0&&kc(i,Sx),o=a,ve(Fc,Sx)}o*s<0&&(Z7(Sx,e,r),Sr(Fc,Sx,Fc,s/(s-o)),kc(i,Fc))}function Z7(t,e,i){return pe(t,e.data[i],e.data[i+1],e.data[i+2])}function kc(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function HFt(t,e,i,r){xb(M1e,t.quaternion),Li(fh,e,t.center),Eu(fh,fh,M1e);const s=t.halfSize,n=8*((fh[0]<-s[0]?-1:fh[0]>s[0]?1:0)+3*(fh[1]<-s[1]?-1:fh[1]>s[1]?1:0)+9*(fh[2]<-s[2]?-1:fh[2]>s[2]?1:0)+13),o=C1e[n];if(o===0)return o;HL(j5,t.quaternion),iN(j5,j5,t.halfSize);const a=(l,c)=>{const u=C1e[n+c+1];return pe(l,((1&u)<<1)-1,(2&u)-1,((4&u)>>1)-1),ca(l,l,j5),Ee(l,t.center,l)};return i.length=0,kc(i,a(Y7,0)),kc(i,a(A1e,1)),kc(i,a(fh,2)),kc(i,a(P1e,3)),r(i),o===1||(i.length=0,kc(i,Y7),kc(i,P1e),kc(i,a(fh,4)),kc(i,a(O1e,5)),r(i),o===2||(i.length=0,kc(i,Y7),kc(i,O1e),kc(i,a(fh,6)),kc(i,A1e),r(i))),o}const C1e=(()=>{const t=new Array(216);let e=0;const i=r=>{for(let s=0;s<r.length;s++)t[e+s]=r[s];e+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),t})(),LVe=4;function qFt(t,e){let i=0;for(let r=0;r<LVe;r++){const s=t.intersectPlane(e[r]);if(s>0)return-1;s===0&&(i|=1<<r)}return i}const j5=Kr(),M1e=nd(),fh=C(),Y7=C(),A1e=C(),P1e=C(),O1e=C();let WFt=class{constructor(e){this._objects=e}submit(e,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(e,i,r))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?zFt(e,this._objects.visibleObjects):null}};function ZFt(t){const e=Ds().vec3f($.POSITION);return t.hasNormals&&e.vec2i16($.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===Es.Default?e.vec2f($.UV0):t.textureCoordinates===Es.Atlas&&(e.vec2f($.UV0),e.vec4u16($.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8($.COLOR,{glNormalized:!0}),e}let YFt=class{constructor(){this.externalColor=ci(),this.externalColorMixMode=Qn.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}};var Iu;function XFt(t,e){const i=t.vertex;switch(i.code.add(S`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case Iu.None:i.code.add(S`#define vertexDiscardByOpacity(_opacity_) {}`);break;case Iu.Opaque:i.code.add(S`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Iu.Transparent:i.code.add(S`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Iu.COUNT:break;default:e.vertexDiscardMode}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(Iu||(Iu={}));var uy;function $hi(t){return t&&U2(t)?uy.Mars:t&&V2(t)?uy.Moon:uy.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(uy||(uy={}));var ep;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(ep||(ep={}));let wi=class extends uc{constructor(){super(...arguments),this.output=G.Color,this.textureCoordinateType=Es.None,this.componentData=ly.Uniform,this.cullFace=Gr.Back,this.vertexDiscardMode=Iu.None,this.doubleSidedMode=Rs.WindingOrder,this.alphaDiscardMode=Ir.Opaque,this.integratedMeshMode=ep.None,this.transparencyPassType=ft.NONE,this.ellipsoidMode=uy.Earth,this.pbrMode=Pt.Disabled,this.normalType=or.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.hasNormalTextureTransform=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};h([j({count:G.COUNT})],wi.prototype,"output",void 0),h([j({count:Es.COUNT})],wi.prototype,"textureCoordinateType",void 0),h([j({count:ly.COUNT})],wi.prototype,"componentData",void 0),h([j({count:Gr.COUNT})],wi.prototype,"cullFace",void 0),h([j({count:Iu.COUNT})],wi.prototype,"vertexDiscardMode",void 0),h([j({count:Rs.COUNT})],wi.prototype,"doubleSidedMode",void 0),h([j({count:Ir.COUNT})],wi.prototype,"alphaDiscardMode",void 0),h([j({count:ep.COUNT})],wi.prototype,"integratedMeshMode",void 0),h([j({count:ft.COUNT})],wi.prototype,"transparencyPassType",void 0),h([j({count:uy.COUNT})],wi.prototype,"ellipsoidMode",void 0),h([j({count:Pt.COUNT})],wi.prototype,"pbrMode",void 0),h([j({count:or.COUNT})],wi.prototype,"normalType",void 0),h([j()],wi.prototype,"spherical",void 0),h([j()],wi.prototype,"doublePrecisionRequiresObfuscation",void 0),h([j()],wi.prototype,"hasVertexColors",void 0),h([j()],wi.prototype,"hasNormals",void 0),h([j()],wi.prototype,"hasSlicePlane",void 0),h([j()],wi.prototype,"hasColorTexture",void 0),h([j()],wi.prototype,"receiveAmbientOcclusion",void 0),h([j()],wi.prototype,"receiveShadows",void 0),h([j()],wi.prototype,"blendingEnabled",void 0),h([j()],wi.prototype,"hasScreenSpaceReflections",void 0),h([j()],wi.prototype,"hasPolygonOffset",void 0),h([j()],wi.prototype,"hasMetallicRoughnessTexture",void 0),h([j()],wi.prototype,"hasEmissionTexture",void 0),h([j()],wi.prototype,"hasOcclusionTexture",void 0),h([j()],wi.prototype,"hasNormalTexture",void 0),h([j()],wi.prototype,"hasOccludees",void 0),h([j()],wi.prototype,"multipassEnabled",void 0),h([j()],wi.prototype,"cullAboveGround",void 0),h([j()],wi.prototype,"hasNormalTextureTransform",void 0),h([j()],wi.prototype,"hasCloudsReflections",void 0),h([j()],wi.prototype,"snowCover",void 0),h([j()],wi.prototype,"objectAndLayerIdColor",void 0),h([j({constValue:!1})],wi.prototype,"occlusionPass",void 0),h([j({constValue:Yi.Draw})],wi.prototype,"pbrTextureBindType",void 0),h([j({constValue:!0})],wi.prototype,"hasSliceHighlight",void 0),h([j({constValue:!1})],wi.prototype,"hasSliceInVertexProgram",void 0),h([j({constValue:!1})],wi.prototype,"useCustomDTRExponentForWater",void 0),h([j({constValue:!1})],wi.prototype,"hasVertexTangents",void 0),h([j({constValue:!0})],wi.prototype,"supportsTextureAtlas",void 0),h([j({constValue:!1})],wi.prototype,"highStepCount",void 0),h([j({constValue:!1})],wi.prototype,"instancedDoublePrecision",void 0),h([j({constValue:!1})],wi.prototype,"hasModelTransformation",void 0),h([j({constValue:!0})],wi.prototype,"useFillLights",void 0),h([j({constValue:!1})],wi.prototype,"objectAndLayerIdColorInstanced",void 0);function JFt(t,e){t.include(lE,e),t.fragment.include(cae);const i=t.fragment;i.uniforms.add(new QB("baseColor",r=>r.baseColor)),i.uniforms.add(new nNe("objectOpacity",r=>r.objectOpacity)),e.hasVertexColors?i.code.add(S`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(S`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(S`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function $1e(t,e){const i=t.fragment;switch(e.doubleSidedMode){case Rs.None:i.code.add(S`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Rs.View:t.include(LA,e),i.code.add(S`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Rs.WindingOrder:i.code.add(S`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case Rs.COUNT:}switch(e.normalType){case or.Attribute:case or.Compressed:t.include(o8,e),i.code.add(S`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case or.ScreenDerivative:t.include(LA,e),i.code.add(S`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case or.Ground:e.spherical?(t.include(LA,e),i.code.add(S`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):i.code.add(S`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),i.code.add(S`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case or.COUNT:}}function QFt(t,e){const i=t.fragment;if(e.hasColorTexture&&(e.output===G.Color||e.alphaDiscardMode!==Ir.Opaque)){t.include(Hne,e);const r=e.textureCoordinateType===Es.Atlas;i.uniforms.add(new sy("baseColorTexture",s=>s.texture)),r?(t.include(Gne),i.code.add(S`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):i.code.add(S`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else i.code.add(S`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function DVe(t){const e=new Hi;e.include(LA,t),e.include(o8,t),e.include(lE,t),e.include(Hf,t),e.include(LO,t),e.include(vvt,t),e.include(Gvt,t),e.include(M0t,t),e.include(QFt,t),e.include(XFt,t);const{vertex:i,fragment:r}=e;t.pbrMode!==Pt.Normal&&t.pbrMode!==Pt.Schematic||(e.include(Wne,t),t.hasNormalTexture&&e.include(lNe,t));const s=t.output===G.Shadow||t.output===G.ShadowHighlight||t.output===G.ShadowExcludeHighlight;s&&t.componentData===ly.Varying?i.code.add(S`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):i.code.add(S`#define discardShadows(castShadows) {}`);const n=t.integratedMeshMode===ep.ColorOverlay||t.integratedMeshMode===ep.ColorOverlayWithWater,o=n&&t.output===G.Color&&t.pbrMode===Pt.WaterOnIntegratedMesh;n&&(e.include(E2,t),e.include(gwt,t),t.spherical?i.code.add(S`
      const float invEllipsoidRadius = ${S.float(1/(t.ellipsoidMode===uy.Earth?ur.radius:t.ellipsoidMode===uy.Mars?Qf.radius:E_.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):i.code.add(S`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),i.code.add(S`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===G.ObjectAndLayerIdColor?S`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${S.float(la)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===G.ObjectAndLayerIdColor?S`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?S`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:S`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${n?S`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===G.Color&&(r.include(Fne),e.include(Uy,t),e.include(JFt,t),e.include($1e,t),e.include(E2,t),t.transparencyPassType===ft.ColorAlpha&&(e.outputs.add("fragColor","vec4",0),e.outputs.add("fragAlpha","float",1)),t.receiveShadows?(e.include(AN,t),r.code.add(S`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):r.code.add(S`float evaluateShadow() { return 0.0; }`),n&&r.uniforms.add(new xt("ovColorTex",(l,c)=>vFe(l,c))),r.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.multipassEnabled?S`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?S`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===Pt.Normal||t.pbrMode===Pt.Schematic?(Ry(r),r.code.add(S`
        ${t.pbrMode===Pt.Normal?S`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?r.code.add(S`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):r.code.add(S`vec3 shadingNormal = normalVertex;`),r.code.add(S`${t.spherical?S`vec3 normalGround = normalize(positionWorld());`:S`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),r.code.add(S`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();
        ${t.snowCover?S`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1.1), snow);
                ssao = mix(ssao, 0.5 * ssao, snow);
                shadingNormal = mix(shadingNormal, surfaceNormal, snow);`:""}

        ${n?S` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?r.code.add(S`float shadow = evaluateShadow();`):t.spherical?(VO(r),r.code.add(S`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):r.code.add(S`float shadow = 0.0;`),o&&r.uniforms.add(new xt("ovNormalTex",(l,c)=>{var u;return(u=c.overlay)==null?void 0:u.getTexture(os.WaterNormal)})),t.snowCover&&r.code.add(S`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),r.code.add(S`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${n?S` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?S`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),r.code.add(S`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===ft.ColorAlpha?S`
                fragColor = premultiplyAlpha(fragColor);
                fragAlpha = fragColor.a;`:""}
      }
    `));const a=t.output===G.Depth;return(a||s||t.output===G.ViewshedShadow)&&(a||e.include(l8,t),r.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${a?"":S`outputDepth(linearDepth);`}
      }
    `)),t.output===G.Normal&&(e.include($1e,t),r.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material to influence ambient occlusion,
        // see the ssao fragment shader
        float alpha = ${t.normalType===or.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===G.ObjectAndLayerIdColor&&e.fragment.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?S`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===G.Highlight&&(e.include(Mw),r.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?S`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}const KFt=Object.freeze(Object.defineProperty({__proto__:null,build:DVe},Symbol.toStringTag,{value:"Module"}));let NVe=class FVe extends Ki{initializeConfiguration(e,i){i.spherical=e.viewingMode===Je.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new er(e.rctx,FVe.shader.get().build(this.configuration),kVe)}_setPipelineState(e){const i=this.configuration,r=i.integratedMeshMode!==ep.None,s=e===ft.NONE,n=e===ft.FrontFace;return Kt({blending:i.output===G.Color&&i.blendingEnabled?s?Bu:Q_(e):null,culling:A6(i.cullFace),depthTest:{func:Aw(e)},depthWrite:s||n?Wu:null,drawBuffers:i.output===G.Depth?{buffers:[ho.NONE]}:K_(e),colorWrite:ui,stencilWrite:r||i.hasOccludees?Ty:null,stencilTest:r?zvt(Yc.IntegratedMeshMaskExcluded):i.hasOccludees?Pw:null,polygonOffset:s||n?i.hasPolygonOffset?{factor:2,units:2}:null:t8})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};NVe.shader=new qi(KFt,()=>oe(()=>Promise.resolve().then(()=>B9t),void 0));const kVe=new Map([[$.POSITION,0],[$.NORMAL,1],[$.NORMALCOMPRESSED,1],[$.COLOR,2],[$.UV0,3],[$.UVREGION,4],[$.COMPONENTINDEX,5]]);let e4t=class extends Ur{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},Ile=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function Bs(t={}){return(e,i)=>{const r=e._parameterCount??0;if(e._parameterCount=r+1,t.vectorOps){const s=t.vectorOps;Object.defineProperty(e,i,{get(){return this[r]},set(n){const o=this[r];if(o==null)this[r]=n;else{if(s.equals(o,n))return;s.copy(o,n)}this._setDirty()}})}else Object.defineProperty(e,i,{get(){return this[r]},set(s){this[r]!==s&&(t.dispose&&this[r]&&this[r].dispose(),this[r]=s,this._setDirty())}})}}function R1e(){return(t,e)=>{const i=t._parameterCount??0;t._parameterCount=i+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(i),Object.defineProperty(t,e,{get(){return this[i]},set(r){this[i]!==r&&(this[i]=r,this._setDirty())}})}}let UVe=class{constructor(e){this._low=C(),this._high=C(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){ve(this._low,ve(I1e,e));const i=Li(I1e,e,this._low);ve(this._high,i)}get(e){return Ee(e,this._low,this._high)}getLowScaled(e){return de(e,this._low,1)}};const I1e=Ru();let Po=class extends e4t{constructor(e,i){super(),this.toMapSpace=i,this.baseColor=ri(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Xl(a8),this.emissiveFactor=qe(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new bV,this.componentParameters=new cL,this.textureAlphaCutoff=ZB,this.alphaDiscardMode=Ir.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=uy.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new wi;const r=new UVe(e.position),s=jAe(e.rotationScale);tN(s,s),W2(s,s),this.transformNormalGlobalFromModel=s,this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=hi(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(e,i,r,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.hasNormals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,n.hasEmissionTexture=this.emissionTexture!=null,n.hasOcclusionTexture=this.occlusionTexture!=null,n.hasNormalTexture=this.normalTexture!=null,n.transparencyPassType=i.identifier===Kl.Material&&r.transparencyPassType!=null?r.transparencyPassType:ft.NONE,n.multipassEnabled=i.identifier===Kl.Material&&r.multipassEnabled,n.cullAboveGround=i.identifier===Kl.Material&&r.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?Rs.View:Rs.None,n.hasColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();if(n.blendingEnabled=o===Hl.Transparent||o===Hl.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?r4t(r)?i4t(r)?ep.ColorOverlayWithWater:ep.ColorOverlay:ep.NoOverlay:ep.None,n.hasPolygonOffset=this.polygonOffsetEnabled,n.pbrMode=n.integratedMeshMode===ep.ColorOverlayWithWater?Pt.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?s.needsNormals&&this.isIntegratedMesh?Pt.Disabled:Pt.Schematic:Pt.Normal:Pt.Disabled,n.normalType=s.needsNormals?n.hasNormals?or.Compressed:or.ScreenDerivative:or.Ground,n.hasSlicePlane=r.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,i.identifier===Kl.ShadowMap)n.output=G.Shadow,n.vertexDiscardMode=Iu.None;else if(i.identifier===Kl.ViewshedShadowMap)n.output=G.ViewshedShadow,n.vertexDiscardMode=Iu.None;else if(i.identifier===Kl.Highlight)n.output=G.Highlight,n.vertexDiscardMode=Iu.None;else{switch(o===Hl.OpaqueAndTransparent?n.vertexDiscardMode=i.transparent?Iu.Opaque:Iu.Transparent:n.vertexDiscardMode=Iu.None,n.output=i.output,n.receiveAmbientOcclusion=!1,n.receiveShadows=!1,i.output){case G.Color:n.receiveAmbientOcclusion=r.ssao!=null,n.hasOccludees=r.hasOccludees,n.receiveShadows=r.shadowMap.ready,n.hasScreenSpaceReflections=r.ssr.lastFrameColor!=null,n.hasCloudsReflections=r.cloudsFade.data!=null;break;case G.ObjectAndLayerIdColor:n.objectAndLayerIdColor=!0}n.snowCover=this.hasSnowCover(r)}return this._technique=e.releaseAndAcquire(NVe,n,this._technique),this._setClean(),this._technique}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,i,r){if(this.objectOpacity===0)return;const s=r.renderable.geometry,n=r.components,o=r.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Hl.Opaque:e.materialOpaque.submitDraw(this,s,a,o);break;case Hl.Transparent:e.materialTransparent.submitDraw(this,s,a,o);break;case Hl.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,s,a,o),e.materialTransparent.submitDraw(this,s,a,o);break;case Hl.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,s,a,o),t4t(i)&&e.highlightIntegratedMesh.submitDraw(this,s,a,o)}const u=this.componentParameters.castShadows!==po.None;u&&e.shadowMap.submitDraw(this,s,a,o),l!=null&&(e.highlight.submitDraw(this,s,l,o),u&&e.highlightShadowMap.submitDraw(this,s,l,o)),i.viewshedEnabled&&e.viewshedShadowMap.submitDraw(this,s,a,o),u&&c!=null&&e.defaultShadowMap.submitDraw(this,s,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?Hl.IntegratedMesh:this.objectOpacity<1?Hl.Transparent:this.componentParameters.opaqueOverride===po.All?Hl.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Ir.Blend||this.alphaDiscardMode===Ir.MaskBlend?Hl.Transparent:this.componentParameters.transparent===po.None?Hl.Opaque:this.componentParameters.transparent===po.All?Hl.Transparent:Hl.OpaqueAndTransparent}};var Hl,po;h([Bs({vectorOps:uPe})],Po.prototype,"baseColor",void 0),h([Bs()],Po.prototype,"usePBR",void 0),h([Bs()],Po.prototype,"hasParametersFromSource",void 0),h([Bs({vectorOps:Jhe})],Po.prototype,"mrrFactors",void 0),h([Bs({vectorOps:Jhe})],Po.prototype,"emissiveFactor",void 0),h([Bs({dispose:!0})],Po.prototype,"baseColorTexture",void 0),h([Bs({dispose:!0})],Po.prototype,"metallicRoughnessTexture",void 0),h([Bs({dispose:!0})],Po.prototype,"emissionTexture",void 0),h([Bs({dispose:!0})],Po.prototype,"occlusionTexture",void 0),h([Bs({dispose:!0})],Po.prototype,"normalTexture",void 0),h([Bs()],Po.prototype,"objectOpacity",void 0),h([R1e()],Po.prototype,"commonMaterialParameters",void 0),h([R1e()],Po.prototype,"componentParameters",void 0),h([Bs()],Po.prototype,"textureAlphaCutoff",void 0),h([Bs()],Po.prototype,"alphaDiscardMode",void 0),h([Bs()],Po.prototype,"isIntegratedMesh",void 0),h([Bs()],Po.prototype,"polygonOffsetEnabled",void 0),h([Bs()],Po.prototype,"ellipsoidMode",void 0),h([Bs()],Po.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(Hl||(Hl={}));let bV=class extends Ile{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Gr.Back,this.hasSlicePlane=!0}};h([Bs()],bV.prototype,"doubleSided",void 0),h([Bs()],bV.prototype,"cullFace",void 0),h([Bs()],bV.prototype,"hasSlicePlane",void 0);let cL=class extends Ile{constructor(){super(...arguments),this.externalColor=ri(1,1,1,1),this.externalColorMixMode=Qn.Multiply,this.castShadows=po.All}get transparent(){return this.externalColor[3]<1?po.All:po.None}get opaqueOverride(){return this.externalColorMixMode===Qn.Replace&&this.externalColor[3]===1?po.All:po.None}get visible(){return this.externalColor[3]>0?po.All:po.None}get type(){return ly.Uniform}};h([Bs({vectorOps:uPe})],cL.prototype,"externalColor",void 0),h([Bs()],cL.prototype,"externalColorMixMode",void 0),h([Bs()],cL.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(po||(po={}));let WI=class extends Ile{constructor(){super(...arguments),this.texture=null,this.transparent=po.None,this.opaqueOverride=po.None,this.castShadows=po.None}get type(){return ly.Varying}};function t4t(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(os.Highlight))!=null}function i4t(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(os.WaterNormal))!=null}function r4t(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(os.ColorNoRasterImage))!=null}h([Bs()],WI.prototype,"texture",void 0),h([Bs()],WI.prototype,"transparent",void 0),h([Bs()],WI.prototype,"opaqueOverride",void 0),h([Bs()],WI.prototype,"castShadows",void 0);const VVe=Ds().vec3f($.POSITION).u16($.COMPONENTINDEX).freeze(),s4t=Ds().vec2u8($.SIDENESS).freeze(),Vhi=Xu(s4t),qee=Ds().vec3f($.POSITION0).vec3f($.POSITION1).vec2i16($.NORMALCOMPRESSED).u16($.COMPONENTINDEX).u8($.VARIANTOFFSET,{glNormalized:!0}).u8($.VARIANTSTROKE).u8($.VARIANTEXTENSION,{glNormalized:!0}).freeze(),Wee=Ds().vec3f($.POSITION0).vec3f($.POSITION1).vec2i16($.NORMALCOMPRESSED).vec2i16($.NORMAL2COMPRESSED).u16($.COMPONENTINDEX).u8($.VARIANTOFFSET,{glNormalized:!0}).u8($.VARIANTSTROKE).u8($.VARIANTEXTENSION,{glNormalized:!0}).freeze(),zhi=new Map([[$.POSITION0,0],[$.POSITION1,1],[$.COMPONENTINDEX,2],[$.VARIANTOFFSET,3],[$.VARIANTSTROKE,4],[$.VARIANTEXTENSION,5],[$.NORMALCOMPRESSED,6],[$.NORMAL2COMPRESSED,7],[$.SIDENESS,8]]);function L1e(t,e,i){const r=e/3,s=new Uint32Array(i+1),n=new Uint32Array(i+1),o=(b,w)=>{b<w?s[b+1]++:n[w+1]++};for(let b=0;b<r;b++){const w=t[3*b],x=t[3*b+1],T=t[3*b+2];o(w,x),o(x,T),o(T,w)}let a=0,l=0;for(let b=0;b<i;b++){const w=s[b+1],x=n[b+1];s[b+1]=a,n[b+1]=l,a+=w,l+=x}const c=new Uint32Array(6*r),u=s[i],d=(b,w,x)=>{if(b<w){const T=s[b+1]++;c[2*T]=w,c[2*T+1]=x}else{const T=n[w+1]++;c[2*u+2*T]=b,c[2*u+2*T+1]=x}};for(let b=0;b<r;b++){const w=t[3*b],x=t[3*b+1],T=t[3*b+2];d(w,x,b),d(x,T,b),d(T,w,b)}const f=(b,w)=>{const x=2*b,T=w-b;for(let E=1;E<T;E++){const M=c[x+2*E],O=c[x+2*E+1];let D=E-1;for(;D>=0&&c[x+2*D]>M;D--)c[x+2*D+2]=c[x+2*D],c[x+2*D+3]=c[x+2*D+1];c[x+2*D+2]=M,c[x+2*D+3]=O}};for(let b=0;b<i;b++)f(s[b],s[b+1]),f(u+n[b],u+n[b+1]);const m=new Int32Array(3*r),g=(b,w)=>b===t[3*w]?0:b===t[3*w+1]?1:b===t[3*w+2]?2:-1,y=(b,w)=>{const x=g(b,w);m[3*w+x]=-1},v=(b,w,x,T)=>{const E=g(b,w);m[3*w+E]=T;const M=g(x,T);m[3*T+M]=w};for(let b=0;b<i;b++){let w=s[b];const x=s[b+1];let T=n[b];const E=n[b+1];for(;w<x&&T<E;){const M=c[2*w],O=c[2*u+2*T];M===O?(v(b,c[2*w+1],O,c[2*u+2*T+1]),w++,T++):M<O?(y(b,c[2*w+1]),w++):(y(O,c[2*u+2*T+1]),T++)}for(;w<x;)y(b,c[2*w+1]),w++;for(;T<E;)y(c[2*u+2*T],c[2*u+2*T+1]),T++}return m}const X7=.7;let zVe=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?o4t:n4t}write(e,i,r){G5.seed=this._edgeHashFunction(r);const s=G5.getIntRange(0,255),n=G5.getIntRange(0,this.settings.variants-1),o=G5.getFloat(),a=255*(.5*a4t(-(1-Math.min(o/X7,1))+Math.max(0,o-X7)/(1-X7),1.2)+.5);e.position0.setVec(i,r.position0),e.position1.setVec(i,r.position1),e.componentIndex.set(i,r.componentIndex),e.variantOffset.set(i,s),e.variantStroke.set(i,n),e.variantExtension.set(i,a)}};const V1=new Float32Array(6),z1=new Uint32Array(V1.buffer),aA=new Uint32Array(1);function n4t(t){return V1[0]=t.position0[0],V1[1]=t.position0[1],V1[2]=t.position0[2],V1[3]=t.position1[0],V1[4]=t.position1[1],V1[5]=t.position1[2],aA[0]=31*(31*(31*(31*(31*(166811+z1[0])+z1[1])+z1[2])+z1[3])+z1[4])+z1[5],aA[0]}function o4t(t){const e=V1;e[0]=fC(t.position0[0]),e[1]=fC(t.position0[1]),e[2]=fC(t.position0[2]),e[3]=fC(t.position1[0]),e[4]=fC(t.position1[1]),e[5]=fC(t.position1[2]),aA[0]=5381;for(let i=0;i<z1.length;i++)aA[0]=31*aA[0]+z1[i];return aA[0]}const D1e=1e4;function fC(t){return Math.round(t*D1e)/D1e}function a4t(t,e){return Math.abs(t)**e*Math.sign(t)}let Zee=class{constructor(){this._commonWriter=new zVe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return qee.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r),Ee(mC,r.faceNormal0,r.faceNormal1),Ce(mC,mC);const{typedBuffer:s,typedBufferStride:n}=e.normalCompressed;vp(s,i,mC[0],mC[1],mC[2],n)}};Zee.Layout=qee,Zee.glLayout=Xu(qee,1);let Yee=class{constructor(){this._commonWriter=new zVe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return Wee.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r);{const{typedBuffer:s,typedBufferStride:n}=e.normalCompressed;vp(s,i,r.faceNormal0[0],r.faceNormal0[1],r.faceNormal0[2],n)}{const{typedBuffer:s,typedBufferStride:n}=e.normal2Compressed;vp(s,i,r.faceNormal1[0],r.faceNormal1[1],r.faceNormal1[2],n)}}};Yee.Layout=Wee,Yee.glLayout=Xu(Wee,1);const mC=C(),G5=new TS;let l4t=class{constructor(){this.position0=C(),this.position1=C(),this.faceNormal0=C(),this.faceNormal1=C(),this.componentIndex=0,this.cosAngle=0}};const wV=-1;function c4t(t,e,i){const r=t.vertices.position,s=t.vertices.componentIndex,n=lu.position0,o=lu.position1,a=lu.faceNormal0,l=lu.faceNormal1,{edges:c,normals:u}=p4t(t),d=c.length/4,f=e.allocate(d);let m=0;const g=d,y=i==null?void 0:i.allocate(g);let v=0,b=0,w=0;H5.length=0;for(let D=0;D<d;++D){const U=4*D;r.getVec(c.data[U],n),r.getVec(c.data[U+1],o);const k=H5.pushNew();k.index=4*D,k.length=Ar(n,o)}H5.sort((D,U)=>U.length-D.length);const x=new Array,T=new Array;H5.forAll(({length:D,index:U})=>{const k=c.data[U],H=c.data[U+1],V=c.data[U+2],X=c.data[U+3],q=X===wV;if(r.getVec(k,n),r.getVec(H,o),q){const Z=3*V;pe(a,u.data[Z],u.data[Z+1],u.data[Z+2]),ve(l,a),lu.componentIndex=s.get(k),lu.cosAngle=Te(a,l)}else{let Z=3*V;if(pe(a,u.data[Z],u.data[Z+1],u.data[Z+2]),Z=3*X,pe(l,u.data[Z],u.data[Z+1],u.data[Z+2]),lu.componentIndex=s.get(k),lu.cosAngle=Te(a,l),h4t(lu,g4t))return;lu.cosAngle<-.9999&&ve(l,a)}b+=D,w++,q||u4t(lu,_4t)?(e.write(f,m++,lu),x.push(D)):d4t(lu,BVe)&&(y&&i&&i.write(y,v++,lu),T.push(D))});const E=new Float32Array(x.reverse()),M=new Float32Array(T.reverse()),O=y&&i?{instancesData:y.slice(0,v),lodInfo:{lengths:M}}:void 0;return{regular:{instancesData:f.slice(0,m),lodInfo:{lengths:E}},silhouette:O,averageEdgeLength:b/w}}function u4t(t,e){return t.cosAngle<e}function h4t(t,e){return t.cosAngle>e}function d4t(t,e){const i=vo(t.cosAngle);return U_(N1e,t.position1,t.position0),i*(Te(mt(m4t,t.faceNormal0,t.faceNormal1),N1e)>0?-1:1)>e}function p4t(t){const e=t.faces.length/3,i=t.faces,r=t.neighbors,s=t.vertices.position;au.length=J7.length=0;for(let n=0;n<e;n++){const o=3*n,a=r[o],l=r[o+1],c=r[o+2],u=i[o],d=i[o+1],f=i[o+2];s.getVec(u,Ex),s.getVec(d,q5),s.getVec(f,W5),$e(q5,q5,Ex),$e(W5,W5,Ex),mt(Ex,q5,W5),Ce(Ex,Ex),J7.pushArray(Ex),(a===wV||u<d)&&(au.push(u),au.push(d),au.push(n),au.push(a)),(l===wV||d<f)&&(au.push(d),au.push(f),au.push(n),au.push(l)),(c===wV||f<u)&&(au.push(f),au.push(u),au.push(n),au.push(c))}return{edges:au,normals:J7}}let f4t=class{constructor(){this.index=0,this.length=0}};const H5=new ai({allocator:t=>t||new f4t,deallocator:null}),au=new ai({deallocator:null}),J7=new ai({deallocator:null}),lu=new l4t,m4t=C(),N1e=C(),Ex=C(),q5=C(),W5=C(),BVe=kt(4),g4t=Math.cos(BVe),y4t=kt(35),_4t=Math.cos(y4t);function Whi(t){const e=v4t(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return F1e.updateSettings(t.writerSettings),k1e.updateSettings(t.writerSettings),c4t(e,F1e,k1e)}function v4t(t,e,i,r){if(e){const o=L1e(i,r,t.count);return new b4t(i,r,o,t)}const s=kK(t.buffer,t.stride/4,{originalIndices:i,originalIndicesLength:r}),n=L1e(s.indices,r,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:VVe.createView(s.buffer)}}let b4t=class{constructor(e,i,r,s){this.faces=e,this.facesLength=i,this.neighbors=r,this.vertices=s}};const F1e=new Zee,k1e=new Yee,Yhi=Ds().vec3f($.POSITION0).vec3f($.POSITION1),w4t=Ds().vec3f($.POSITION0).vec3f($.POSITION1).u16($.COMPONENTINDEX);let x4t=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},T4t=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this.textureWidth=4096,this._dirty=!0;const r=new es(this.textureWidth,1);r.samplingMode=di.NEAREST,r.wrapMode=Ai.CLAMP_TO_EDGE,this._texture=new Mr(this._rctx,r),this._data=new Sl(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,i,r,s,n,o){const a=e*this._fieldCount+i;this._dirty=!0,this._data.set(a,0,r),this._data.set(a,1,s),this._data.set(a,2,n),this._data.set(a,3,o)}setDataElement(e,i,r,s){const n=e*this._fieldCount+i;this._dirty=!0,this._data.set(n,r,s)}getDataElement(e,i,r){const s=e*this._fieldCount+i;return this._dirty=!0,this._data.get(s,r)}resizeToFit(e){const i=(e+1)*this._fieldCount;if(i>this._data.count){const r=Math.ceil(i/this.textureWidth)*this.textureWidth,s=new Sl(new ArrayBuffer(4*r));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,i=this._texture.descriptor.height;this._data.count>e*i&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const jVe=65536;let S4t=class{constructor(e,i=1){this.textureBuffer=new T4t(e,i),this._indexManager=new x4t(jVe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},E4t=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const r of this._buffers)if(r.availableCount>=e)return r;if(e>jVe)return null;const i=new S4t(this._rctx,this._fieldCount);return this._buffers.push(i),i}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const U1e=()=>ne.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let C4t=class{constructor(e,i){this._renderManager=e,this._viewingMode=i,this._elevationRangeCacheVerticalOffset=NaN,this._elevationRangeCacheMin=NaN,this._elevationRangeCacheMax=NaN,this._visible=new ai,this._hidden=new ai,this._renderSubmit=new WFt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=ue("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new E4t(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){bt(this._hidden.length===0&&this._visible.length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy(),this._visible.forAll(e=>e.destroy()),this._hidden.forAll(e=>e.destroy()),this._visible.clear(),this._hidden.clear()}createObject(e){const i=e.geometry,r=new oFt(this._componentBufferManager,oy(i.componentOffsets)),s=this._createRenderable(e,r),n=new RFt(this._viewingMode,i.positionData,r),o=new lFt(e.transform,e.toMapSpace,e.obb.clone(),r,s,n);return(o.visible?this._visible:this._hidden).push(o),o}destroyObject(e){const i=e;(i.visible?this._visible:this._hidden).removeUnordered(i),i.destroy(),this._notifyDirty()}setObjectVisibility(e,i){const r=e;i!==r.visible&&(i?(this._hidden.removeUnordered(r),this._visible.push(r)):(this._visible.removeUnordered(r),this._hidden.push(r)),r.visible=i,this._notifyDirty())}preSubmit(e){const i=e.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=yo(i,r.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,i){const r=e.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,i){const r=e;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,i){return e.components.visibility.forEachComponent(i)}getComponentCount(e){const i=e,r=i.components.visibility.componentCount;return{visible:r,invisible:i.components.count-r}}setComponentData(e,i){const r=e,s=r.renderable.material,n=r.components,o=n.materialDataBuffer,a=n.materialDataIndices,l=new YFt,c=o.textureBuffer,u=new Uint8Array(4),d=new Uint32Array(u.buffer);let f=0,m=0,g=0,y=n.verticalOffsets,v=1/0,b=-1/0,w=!1,x=!1,T=0;for(let E=0;E<n.count;E++){i(E,l),f+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===Qn.Replace&&l.externalColor[3]===1),g+=+l.castShadows,zDe(l.externalColor,l.externalColorMixMode,u),u[2]=254&u[2]|+l.castShadows,c.setData(a[E],0,u[0],u[1],u[2],u[3]),w||(w=E>0&&T!==d[0]),T=d[0],x||(x=l.elevationOffset!==0),x&&y==null&&(y=new Array(E).fill(0)),y!=null&&(y[E]=l.elevationOffset),v=Math.min(v,l.elevationOffset),b=Math.max(b,l.elevationOffset),_vt(l.elevationOffset,u),c.setData(a[E],1,u[0],u[1],u[2],u[3]);const M=l.objectAndLayerIdColor;M!=null&&c.setData(a[E],2,M[0],M[1],M[2],M[3]),l.pickable!==Gee(n.pickability,E)&&(n.pickability=vFt(n.pickability,n.count,E,l.pickable))}n.verticalOffsets=x?y:null,r.offsetObb=x?wOe(r.obb,v,b,this._viewingMode,r.offsetObb??r.obb.clone()):null,w||x||this._hasObjectAndLayerId?(s.componentParameters=new WI,s.componentParameters.castShadows=Q7(g,n.count),s.componentParameters.transparent=Q7(f,n.count),s.componentParameters.opaqueOverride=Q7(m,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new cL,s.componentParameters.castShadows=l.castShadows?po.All:po.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._elevationRangeCacheVerticalOffset=NaN,this._notifyDirty()}getComponentAabb(e,i,r,s=!1){e.intersectionGeometry.getComponentAabb(i,r);const n=e,o=n.components.verticalOffsets;if(s||o==null)return r;const a=o[i];if(this._viewingMode===Je.Local||a===0)return r[2]+=a,r[5]+=a,r;const l=Ope(a);return l.localOrigin=n.transform.position,l.applyToAabb(r)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,i,r){return e.intersectionGeometry.getComponentPositions(i,r)}expandRangeWithComponentObjectElevationRange(e,i,r,s){Number.isNaN(this._elevationRangeCacheVerticalOffset)||this._elevationRangeCacheVerticalOffset!==i||s.expandElevationRangeValues(this._elevationRangeCacheMin,this._elevationRangeCacheMax);const n=e,o=n.components,a=o.count,l=o.verticalOffsets,c=n.intersectionGeometry,u=this._viewingMode===Je.Local,d=c.getComponentAabbs(),f=A4t;let m=1/0,g=-1/0;for(let y=0;y<a;y++){const v=6*y,b=(l==null?void 0:l[y])??0;let w=1/0,x=-1/0;if(u)w=d[v+2]+b+i,x=d[v+5]+b+i;else{if(f[0]=d[v],f[1]=d[v+1],f[2]=d[v+2],f[3]=d[v+3],f[4]=d[v+4],f[5]=d[v+5],b!==0){const O=Ope(b);O.localOrigin=n.transform.position,O.applyToAabb(f)}const T=Math.max(Math.abs(f[3]),Math.abs(f[0])),E=Math.max(Math.abs(f[4]),Math.abs(f[1])),M=i+f[5]+r;s.expandElevationRangeValues(i+f[2],Math.sqrt(T*T+E*E+M*M)-r)}s.expandElevationRangeValues(w,x),m=Math.min(m,w),g=Math.max(g,x)}this._elevationRangeCacheVerticalOffset=i,this._elevationRangeCacheMin=m,this._elevationRangeCacheMax=g}intersect(e,i,r,s,n,o,a){const l=e,{transform:c}=l,{position:u}=c;return n!=null&&(n.localOrigin=u),l.intersectionGeometry.intersect(i,r,s,n,l.components.verticalOffsets,c,o,a)}addEdges(e,i,r,s,n){const o=e,{indices:a,positions:l}=o.intersectionGeometry,c=o.components.offsets;return i.addComponentObject(o,l,a,c,r,s,n)}async extractEdgeInformation(e,i,r){const s=e,n=s.components.visibility;if(n.allInvisible())return{buffer:w4t.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=VVe.createBuffer(a.length/3);$8(c.position.typedBuffer,a,c.position.typedBufferStride,3),aFe(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const u=c.count,d=this._computeVisibilityIndices(o,n,l,u);return{origin:yn(s.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:d,indicesLength:d.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(e,i,r){let s=0;for(let n=0;n<r.length-1;n++){const o=r[n],a=r[n+1];for(let l=o;l<a;l++){const c=i?i[l]:l;e.set(c,s)}s++}}_computeVisibilityIndices(e,i,r,s){if(e&&i.allVisible())return e;let n=0;i.forEachComponentRange((l,c)=>(n+=r[c]-r[l],!0));const o=hy(e)?new Array(n):(e==null?void 0:e.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return i.forEachComponentRange((l,c)=>{const u=r[l],d=r[c];for(let f=u;f<d;f++)o[a++]=e?e[f]:f;return!0}),o}addComponentHighlight(e,i){const r=e.components;r.highlightCounts==null&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[i]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(e,i){const r=e.components;if(r.highlightCounts==null)return void U1e().warn("Removing non-existing highlight.");const s=r.highlightCounts[i],n=r.highlightCounts[r.count];if(s!==0){if(s>1)return r.highlightCounts[i]=s-1,void(r.highlightCounts[r.count]=n-1);r.highlightCounts[i]=0,r.highlightsDirty(),this._notifyDirty(),n===1?r.highlightCounts=null:r.highlightCounts[r.count]=n-1}else U1e().warn("Removing non-existing highlight.")}clearHighlights(e){const i=e.components;i.highlightCounts!=null&&(i.highlightCounts=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._visible}_createRenderable(e,i){const r=this._renderManager.rctx,s=e.geometry,n=s.vertices.layoutParameters,o=Cr.createVertex(r,hr.STATIC_DRAW,s.vertices.data),a=s.indices?Cr.createIndex(r,hr.STATIC_DRAW,s.indices):null,l=Xu(ZFt(n)),c=new Uint16Array(s.vertices.count);for(let y=0;y<i.count;y++){const v=i.offsets[y],b=i.offsets[y+1],w=i.materialDataIndices[y];if(s.indices!=null)for(let x=v;x<b;x++)c[s.indices[x]]=w;else for(let x=v;x<b;x++)c[x]=w}const u=Cr.createVertex(r,hr.STATIC_DRAW,c.buffer),d=new Po(e.transform,e.toMapSpace),f=new pm(r,kVe,{data:l,componentIndices:M4t},{data:o,componentIndices:u},a),m=new UFt(f,Mi.TRIANGLES,n,a!=null),g={cameraDepthSquared:.5,gpuMemoryEstimate:o.usedMemory+u.usedMemory+(a!=null?a.usedMemory:0)};return new kFt(d,m,g)}_notifyDirty(){this._renderManager.notifyDirty()}};const M4t=Xu(Ds().u16($.COMPONENTINDEX));function Q7(t,e){return t===e?po.All:t===0?po.None:po.Some}const A4t=io();let Lle=class extends Ur{};function GVe(){const t=new Hi,{outputs:e,fragment:i}=t;return t.include(qa),i.uniforms.add(new sy("textureInput",r=>r.input)),i.constants.add("sampleArea","int",Math.ceil(TD/2)),e.add("fragGrid","vec2"),i.code.add(S`
    void main() {
      float red = 0.0;
      float green = 1.0;
      int cellSize = ${S.int(bf)};
      vec2 texelSize = 1.0 / vec2(textureSize(textureInput, 0));
      vec2 offset = floor(gl_FragCoord.xy) * vec2(float(cellSize));

      for(int x = -sampleArea; x < cellSize + sampleArea; x += 2) {
        for(int y = -sampleArea; y < cellSize + sampleArea; y += 2) {
          vec2 coord = (offset + vec2(float(x), float(y))) * texelSize;
          vec4 value = texture(textureInput, coord);
          float mx = floor(max(value.g, value.b));

          red = max(red, ceil(value.r));
          green = min(green, mx);
          if(red == 1.0 && green == 0.0) {
            fragGrid = vec2(red, green);
            return;
          }
        }
      }
      fragGrid = vec2(red, green);
    }`),t}const bf=32,TD=9,Dle=.4,P4t=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:Lle,blurSize:Dle,build:GVe,gridCellPixelSize:bf,outlineSize:TD},Symbol.toStringTag,{value:"Module"}));function HVe(){const t=new Hi,{vertex:e,fragment:i}=t,r=e.code,s=i.code;return t.attributes.add($.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add($.UV0,"vec2"),e.uniforms.add(new xt("coverageTex",n=>n.coverageTexture),new Hr("coverageRounding",n=>n.coverageRounding)),r.add(S`void main() {
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),i.uniforms.add(new xt("tex",n=>n.blurTexture),new xt("highlightTexture",n=>n.highlightTexture),new ji("uColor",n=>n.color),new ji("haloColor",n=>n.haloColor),new ji("opacities",n=>Ss(O4t,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),i.constants.add("inner","float",1-(TD-Dle)/TD),s.add(S`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(highlightTexture, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float outlineFactor = smoothstep(0.0, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const O4t=ci(),$4t=Object.freeze(Object.defineProperty({__proto__:null,build:HVe},Symbol.toStringTag,{value:"Module"}));let qVe=class WVe extends Ki{initializeProgram(e){return new er(e.rctx,WVe.shader.get().build(),Pi)}initializePipeline(){return Kt({blending:_a(Be.SRC_ALPHA,Be.ONE,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),colorWrite:ui})}};qVe.shader=new qi($4t,()=>oe(()=>Promise.resolve().then(()=>j9t),void 0));let Nle=class extends Ur{constructor(){super(...arguments),this.blurSize=gt()}};function ZVe(){const t=new Hi,{attributes:e,varyings:i,vertex:r,fragment:s}=t;return e.add($.POSITION,"vec2"),e.add($.UV0,"vec2"),i.add("blurCoordinate","vec3"),r.uniforms.add(new xt("coverageTex",n=>n.coverageTexture),new Hr("coverageRounding",n=>n.coverageRounding)),r.code.add(S`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), cov.g);
}`),s.uniforms.add(new uNe("blurSize",n=>n.blurSize),new sy("tex",n=>n.blurInputTexture)),s.code.add(S`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),t}const R4t=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:Nle,build:ZVe},Symbol.toStringTag,{value:"Module"}));let YVe=class XVe extends Ki{initializeProgram(e){return new er(e.rctx,XVe.shader.get().build(),Pi)}initializePipeline(){return Kt({colorWrite:ui})}};YVe.shader=new qi(R4t,()=>oe(()=>Promise.resolve().then(()=>G9t),void 0));let JVe=class QVe extends Ki{initializeProgram(e){return new er(e.rctx,QVe.shader.get().build(),Pi)}initializePipeline(){return Kt({colorWrite:ui})}};JVe.shader=new qi(P4t,()=>oe(()=>Promise.resolve().then(()=>H9t),void 0));let I4t=class extends Ur{constructor(){super(...arguments),this.color=ri(1,0,1,1),this.haloColor=ri(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.coverageRounding=Ei(1,1)}},aM=class extends SN{constructor(e){super(e),this.produces="highlight-color",this.consumes={required:["highlight-color","highlights"]},this._passParameters=new I4t,this._downsampleDrawParameters=new Lle,this._blurDrawParameters=new Nle,this._blurColorFormat=ue("mac")?ls.RGBA:ls.RGBA4,this._grid={coverage:null,vao:null,verticalCellCount:0,horizontalCellCount:0,viewportWidth:0,viewportHeight:0},this._blurTechnique=e.techniques.acquire(YVe),this._downsampleTechnique=e.techniques.acquire(JVe),this._applyTechnique=e.techniques.acquire(qVe)}initialize(){this.addHandles([te(()=>this.view.highlightOptions.color,e=>{this._passParameters.color=XL(e??yUe),this.view.highlightOptions.haloColor||(this._passParameters.haloColor=this._passParameters.color),this.requestRender(cr.UPDATE)},pr),te(()=>this.view.highlightOptions.haloColor,e=>{this._passParameters.haloColor=e!=null?XL(e):this._passParameters.color,this.requestRender(cr.UPDATE)},pr),te(()=>this.view.highlightOptions.haloOpacity,e=>{this._passParameters.haloOpacity=e??_Ue,this._passParameters.haloOpacityOccluded=.25*this._passParameters.haloOpacity,this.requestRender(cr.UPDATE)},pr),te(()=>this.view.highlightOptions.fillOpacity,e=>{this._passParameters.fillOpacity=e??vUe,this._passParameters.fillOpacityOccluded=.25*this._passParameters.fillOpacity,this.requestRender(cr.UPDATE)},pr)])}destroy(){this._blurTechnique.release(),this._downsampleTechnique.release(),this._applyTechnique.release(),this._grid.coverage=hi(this._grid.coverage),this._grid.vao=Ut(this._grid.vao)}render(e){var b,w,x;if(this.bindParameters.decorations===rc.OFF)return e.find(({name:T})=>T==="highlight-color");if(!(this._blurTechnique.compiled&&this._downsampleTechnique.compiled&&this._applyTechnique.compiled))return this.requestRender(cr.UPDATE),e.find(({name:T})=>T==="highlight-color");const i=e.find(({name:T})=>T==="highlights").getTexture(),r=this.bindParameters.camera,s=r.fullWidth,n=r.fullHeight,o=r.pixelRatio,a=Math.ceil(s/o),l=Math.ceil(n/o),c=this.renderingContext;this._gridUpdateResources(i),this._gridComputeCoverage(i,this.bindParameters),this._passParameters.highlightTexture=i,this._passParameters.coverageTexture=(b=this._grid.coverage)==null?void 0:b.getTexture();const{width:u,height:d}=i.descriptor;Di(this._passParameters.coverageRounding,u/(Math.ceil(u/bf)*bf),d/(Math.ceil(d/bf)*bf));const f=this._grid.vao;c.bindVAO(f);const m=this.fboCache.acquire(a,l,"highlight blur",this._blurColorFormat);c.unbindTexture((w=m.fbo)==null?void 0:w.colorTexture),c.bindFramebuffer(m.fbo),c.setClearColor(0,0,0,0),c.clear(jr.COLOR_BUFFER_BIT),c.setViewport(0,0,a,l),this._blurDrawParameters.blurInputTexture=i,Di(this._blurDrawParameters.blurSize,1/a,0);const g=c.bindTechnique(this._blurTechnique,this.bindParameters,this._passParameters,this._blurDrawParameters);c.drawArrays(this._blurTechnique.primitiveType,0,y_(f,"geometry"));const y=this.fboCache.acquire(a,l,"highlight blur",this._blurColorFormat);c.unbindTexture((x=y.fbo)==null?void 0:x.colorTexture),c.bindFramebuffer(y.fbo),c.setClearColor(0,0,0,0),c.clear(jr.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=m.getTexture(),Di(this._blurDrawParameters.blurSize,0,1/l),g.bindDraw(this._blurDrawParameters,this.bindParameters,this._passParameters),c.drawArrays(this._blurTechnique.primitiveType,0,y_(f,"geometry"));const v=e.find(({name:T})=>T==="highlight-color");return c.bindFramebuffer(v.fbo),c.setViewport4fv(r.fullViewport),this._passParameters.blurTexture=y.getTexture(),c.bindTechnique(this._applyTechnique,this.bindParameters,this._passParameters),c.drawArrays(this._applyTechnique.primitiveType,0,y_(f,"geometry")),m.release(),y.release(),v}_gridUpdateResources(e){var f;const i=this.renderingContext,r=this._grid,s=Math.ceil(e.descriptor.height/bf),n=Math.ceil(e.descriptor.width/bf);if(r.vao&&r.verticalCellCount===s&&r.horizontalCellCount===n)return;r.verticalCellCount=s,r.horizontalCellCount=n;const o=s+1,a=n+1,l=1/s,c=1/n,u=new Float32Array(6*4*o*a);let d=0;for(let m=0;m<o;m++)for(let g=0;g<a;g++)u[d++]=(g-.5)*c*2-1,u[d++]=(m-.5)*l*2-1,u[d++]=g*c,u[d++]=m*l,u[d++]=(g+.5)*c*2-1,u[d++]=(m-.5)*l*2-1,u[d++]=g*c,u[d++]=m*l,u[d++]=(g-.5)*c*2-1,u[d++]=(m+.5)*l*2-1,u[d++]=g*c,u[d++]=m*l,u[d++]=(g-.5)*c*2-1,u[d++]=(m+.5)*l*2-1,u[d++]=g*c,u[d++]=m*l,u[d++]=(g+.5)*c*2-1,u[d++]=(m-.5)*l*2-1,u[d++]=g*c,u[d++]=m*l,u[d++]=(g+.5)*c*2-1,u[d++]=(m+.5)*l*2-1,u[d++]=g*c,u[d++]=m*l;(f=r.vao)==null||f.dispose(),r.vao=new Dy(i,Pi,{geometry:uN},{geometry:Cr.createVertex(i,hr.STATIC_DRAW,u)})}_gridComputeCoverage(e,i){var l,c;const r=this.renderingContext,s=this._grid,n=e.descriptor,o=Math.ceil(n.width/bf),a=Math.ceil(n.height/bf);this._downsampleDrawParameters.input=e,(l=s.coverage)==null||l.release(),s.coverage=this.fboCache.acquire(o,a,"highlight coverage",ls.RG),r.unbindTexture((c=s.coverage.fbo)==null?void 0:c.colorTexture),r.bindFramebuffer(s.coverage.fbo),r.bindTechnique(this._downsampleTechnique,i,this._passParameters,this._downsampleDrawParameters),r.setViewport(0,0,o,a),r.screen.draw()}get test(){}};h([p()],aM.prototype,"produces",void 0),h([p()],aM.prototype,"consumes",void 0),h([p({constructOnly:!0})],aM.prototype,"techniques",void 0),aM=h([I("esri.views.3d.webgl-engine.effects.highlight.Highlight")],aM);let Fle=class extends uc{constructor(){super(...arguments),this.receiveShadows=!0}};h([j()],Fle.prototype,"receiveShadows",void 0);function KVe(t){const e=t.fragment;t.include(EN),e.include($y),e.code.add(S`vec3 normalFromDepth(sampler2D depthMap, vec3 pixelPos, vec2 fragCoord, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
float leftPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(-1, 0), 0).r);
float rightPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(1, 0), 0).r);
float bottomPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, -1), 0).r);
float topPixelDepth = linearizeDepth(texelFetch(depthMap, iuv + ivec2(0, 1), 0).r);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`)}const L4t=.99999,D4t=.025;function eze(t){const e=new Hi;e.include(AN,t),e.include(qa),e.include(KVe);const i=e.fragment;return i.include(vm),i.uniforms.add(new xt("defaultDepthTex",(r,s)=>s.shadowMap.getSnapshot(P2.ExcludeHighlight)),new xt("highlightDepthTex",(r,s)=>s.shadowMap.getSnapshot(P2.Highlight)),new xt("depthMap",(r,s)=>{var n;return(n=s.depth)==null?void 0:n.attachment}),new xt("highlightTexture",r=>r.highlight),new ji("uColor",r=>r.shadowColor),new tt("opacity",r=>r.shadowOpacity),new tt("occludedOpacity",r=>r.occludedShadowOpacity),new tt("terminationFactor",r=>r.opacityElevation*r.dayNightTerminator),new Wt("lightingMainDirectionView",(r,s)=>Ce(z1e,nt(z1e,s.lighting.mainLight.direction,s.camera.viewInverseTransposeMatrix))),new fs("inverseViewMatrix",(r,s)=>eo(V1e,wl(V1e,s.camera.viewMatrix,s.camera.center)))),i.constants.add("unoccludedHighlightFlag","vec4",Boe),i.code.add(S`
    void main(void) {
      vec4 highlightInfo = texture(highlightTexture, uv);
      float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
      if (visiblyHighlighted > ${S.float(L4t)}) {
        discard;
      }

      float depth = depthFromTexture(depthMap, uv);

      // 1.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
      if (depth >= 1.0 || depth <= 0.0) {
        discard;
      }

      float currentPixelDepth = linearizeDepth(depth);
      vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
      vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

      mat4 shadowMatrix;
      float linearDepth = -currentPixelDepth;
      int i = chooseCascade(linearDepth, shadowMatrix);
      if (i >= numCascades) {
        discard;
      }

      vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
        discard;
      }

      ivec2 texSize = textureSize(highlightDepthTex, 0);
      ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

      float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
      bool shadowHighlight = depthHighlight < lvpos.z;
      if (!shadowHighlight) {
        discard;
      }

      float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
      bool shadowDefault = depthDefault < lvpos.z;

      vec3 normal = normalFromDepth(depthMap, currentPixelPos.xyz, gl_FragCoord.xy, uv);
      bool shaded = dot(normal, lightingMainDirectionView) < ${S.float(D4t)};

      float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
      fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
    }
  `),e}const V1e=ke(),z1e=C(),N4t=Object.freeze(Object.defineProperty({__proto__:null,build:eze},Symbol.toStringTag,{value:"Module"}));let F4t=class extends lae{constructor(){super(...arguments),this.shadowColor=ri(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},tze=class ize extends Ki{constructor(e){super(e,new Fle,()=>this.destroy())}initializeProgram(e){return new er(e.rctx,ize.shader.get().build(this.configuration),Pi)}initializePipeline(){return Kt({blending:_a(Be.SRC_ALPHA,Be.ONE,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),colorWrite:ui,depthTest:null,depthWrite:null})}get primitiveType(){return Mi.TRIANGLE_STRIP}};tze.shader=new qi(N4t,()=>oe(()=>Promise.resolve().then(()=>q9t),void 0));const k4t=.001953125,U4t=4e4,V4t=5e4;let vT=class extends SN{constructor(e){super(e),this.produces="composite-color",this.consumes={required:["composite-color","highlights"]},this._passParameters=new F4t,this._maxOpacity=1,this._shadowDifference=.2,this._technique=e.techniques.acquire(tze)}initialize(){this.addHandles([te(()=>this.view.highlightOptions.shadowOpacity,e=>{this._passParameters.shadowOpacity=e??wUe,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},pr),te(()=>this.view.highlightOptions.shadowDifference,e=>{this._shadowDifference=e??xUe,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},pr),te(()=>this.view.highlightOptions.shadowColor,e=>{this._passParameters.shadowColor=XL(e??bUe),this._updateMaxOpacity()},pr)])}destroy(){this._technique.release()}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}render(e){var n;const i=e.find(({name:o})=>o==="composite-color"),r=this.bindParameters;if(!r.shadowHighlightsVisible||!r.depth||!this._ensureIfVisible(r.camera,r.lighting.mainLight.direction))return i;if(!this._technique.compiled)return this.requestRender(cr.UPDATE),i;this._passParameters.highlight=(n=e.find(({name:o})=>o==="highlights"))==null?void 0:n.getTexture(),this._passParameters.origin=r.camera.center;const s=this.renderingContext;return s.bindFramebuffer(i.fbo),s.bindTechnique(this._technique,r,this._passParameters),s.screen.draw(),i}_ensureIfVisible(e,i){this._passParameters.opacityElevation=1-DL(U4t,V4t,e.relativeElevation);const r=this.viewingMode===Je.Global?Ce(B1e,e.center):pe(B1e,0,0,1),s=Te(r,i);return this._passParameters.dayNightTerminator=DL(0,1,Ne(30*s,0,1)),this._maxOpacity*this._passParameters.opacityElevation*this._passParameters.dayNightTerminator>=k4t}};h([p()],vT.prototype,"produces",void 0),h([p()],vT.prototype,"consumes",void 0),h([p({constructOnly:!0})],vT.prototype,"viewingMode",void 0),h([p({constructOnly:!0})],vT.prototype,"techniques",void 0),vT=h([I("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],vT);const B1e=C();let kle=class extends Ur{constructor(){super(...arguments),this.mask=null,this.overlay=null,this.input=null,this.size=0}};function rze(){const t=new Hi;return t.attributes.add($.POSITION,"vec2"),t.vertex.uniforms.add(new ji("drawPosition",(e,i)=>z4t(e,i))),t.varyings.add("vUV","vec2"),t.vertex.code.add(S`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new xt("textureInput",e=>e.input)),t.fragment.uniforms.add(new xt("textureMask",e=>e.mask)),t.fragment.uniforms.add(new xt("textureOverlay",e=>e.overlay)),t.fragment.uniforms.add(new ny("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new ny("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(S`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function z4t(t,e){const i=e.camera.pixelRatio,r=t.magnifier.offset.x*i,s=t.magnifier.offset.y*i;Lf(t.magnifier.position,j1e);const n=e.camera.screenToRender(j1e,B4t),o=Math.ceil(i*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return Ss(j4t,(n[0]+r)/a*2-1,(n[1]-s)/l*2-1,o/a*2,o/l*2)}const j1e=Os(),B4t=BCe(),j4t=ci(),G4t=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:kle,build:rze},Symbol.toStringTag,{value:"Module"}));let sze=class nze extends Ki{initializeProgram(e){return new er(e.rctx,nze.shader.get().build(),Pi)}initializePipeline(){return Kt({blending:rd(Be.ONE,Be.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:ui})}};sze.shader=new qi(G4t,()=>oe(()=>Promise.resolve().then(()=>W9t),void 0));async function H4t(t){const e=oe(()=>import("./mask-svg-cNit2NTT.js"),[]),i=oe(()=>import("./overlay-svg-DioSRl-7.js"),[]),r=D_((await e).default,{signal:t}),s=D_((await i).default,{signal:t}),n={mask:await r,overlay:await s};return Dt(t),n}let _1=class extends SN{constructor(e){super(e),this.produces="magnifier-color",this.consumes={required:["magnifier-color"]},this._imageSources=null,this._imageLoadTask=null,this._passParameters=new kle,this._vao=null,this._technique=null,this._magnifier=null,this._tmpScreenPoint=Os(),this._tmpRenderPoint=BCe()}initialize(){this.addHandles([te(()=>this.view.magnifier,e=>this._update(e),pr)])}_update(e){if(e===this._magnifier)return;this.removeAllHandles(),this._magnifier=e;const i=()=>{const r=this._validMagnifier;r?(this._loadResources(r),this.produces="magnifier-color"):this.produces="disabled",this.requestRender()};this._magnifier&&this.addHandles(te(()=>{var r;return(r=this._magnifier)==null?void 0:r.version},i)),i()}get _validMagnifier(){var e,i,r;return(e=this._magnifier)!=null&&e.visible&&((i=this._magnifier)!=null&&i.position)&&((r=this._magnifier)==null?void 0:r.size)>0?this._magnifier:null}get _factor(){var e;return((e=this._magnifier)==null?void 0:e.factor)||1}destroy(){this._magnifier=null,this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeTextures(),this._vao=Ut(this._vao)}_disposeTextures(){this._passParameters.mask=Ut(this._passParameters.mask),this._passParameters.overlay=Ut(this._passParameters.overlay),this._passParameters.input=Ut(this._passParameters.input)}render(e){var v;const i=this._validMagnifier,r=e.find(({name:b})=>b==="magnifier-color");if(i==null)return r;if(this._imageSources==null)return this.requestRender(cr.UPDATE),r;const s=this.renderingContext,n=this.camera.pixelRatio,o=Math.ceil(n*i.size);if(this._vao??(this._vao=Ny(s,Une,Pi,0,1)),this._technique??(this._technique=this.techniques.acquire(sze)),this._ensureTextureResources(s,o),!((v=this._technique)!=null&&v.compiled)||!this._passParameters.input)return this.requestRender(cr.UPDATE),r;const a=Math.ceil(1/this._factor*o),l=this._passParameters.input;l.resize(a,a),Lf(i.position,this._tmpScreenPoint);const c=this.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),u=this.camera.fullWidth,d=this.camera.fullHeight,f=.5*a,m=.5*a;c[0]=Ne(c[0],f,u-f-1),c[1]=Ne(c[1],m,d-m-1);const g=Math.floor(c[0]-f),y=Math.floor(c[1]-m);return s.bindFramebuffer(r.fbo),this._technique.program.bindTexture("textureInput",l),s.gl.copyTexImage2D(l.descriptor.target,0,l.descriptor.pixelFormat,g,y,a,a,0),this._passParameters.magnifier=i,s.bindTechnique(this._technique,this.bindParameters,this._passParameters),s.bindVAO(this._vao),s.drawArrays(Mi.TRIANGLE_STRIP,0,4),r}_loadResources(e){var s,n,o;const{maskUrl:i,overlayUrl:r}=e;((s=this._imageLoadTask)==null?void 0:s.maskUrl)===i&&((n=this._imageLoadTask)==null?void 0:n.overlayUrl)===r||((o=this._imageLoadTask)==null||o.task.abort(),this._imageLoadTask=this._imageSources=null),this._imageSources||this._imageLoadTask||(this._imageLoadTask={maskUrl:i,overlayUrl:r,task:My(async a=>{const l=i==null||r==null?H4t(a):null,c=i!=null?D_(i,{signal:a}):l.then(d=>d.mask),u=r!=null?D_(r,{signal:a}):l.then(d=>d.overlay);this._imageSources={mask:await c,overlay:await u}})})}_ensureTextureResources(e,i){if(this._imageSources==null||this._passParameters.size===i&&this._passParameters.input&&this._passParameters.mask&&this._passParameters.overlay)return;this._disposeTextures(),this._imageSources.overlay.width=this._imageSources.mask.width=i,this._imageSources.overlay.height=this._imageSources.mask.height=i;const r=new es;r.internalFormat=Ht.RGBA,r.wrapMode=Ai.CLAMP_TO_EDGE,r.flipped=!0,r.preMultiplyAlpha=!LEe(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result,this._passParameters.overlay=new Mr(e,r,this._imageSources.overlay),r.pixelFormat=r.internalFormat=Ht.ALPHA,r.preMultiplyAlpha=!1,this._passParameters.mask=new Mr(e,r,this._imageSources.mask),r.pixelFormat=r.internalFormat=Ht.RGBA,r.flipped=!1,this._passParameters.input=new Mr(e,r)}};h([p()],_1.prototype,"produces",void 0),h([p()],_1.prototype,"consumes",void 0),h([p()],_1.prototype,"_imageSources",void 0),h([p()],_1.prototype,"_imageLoadTask",void 0),h([p({constructOnly:!0})],_1.prototype,"techniques",void 0),_1=h([I("esri.views.3d.webgl-engine.effects.magnifier.MagnifierRenderNode")],_1);const gC={maxSearchSteps:8,maxDistanceAreaTex:16};function oze(){const t=new Hi;return t.include(qa),t.fragment.uniforms.add(new xt("edgesTexture",e=>e.inputTexture),new xt("areaTexture",e=>e.areaTexture),new xt("searchTexture",e=>e.searchTexture)),t.fragment.code.add(S`
    #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
    #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

    vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset, vec2 resolution) {
      return texture(tex, coord + offset.x * resolution, 0.0);
    }

    float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
      e.r = bias + e.r * scale;
      return 255.0 * texture( searchTex, e, 0.0 ).r;
    }

    float searchLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${S.int(gC.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x += 0.25 * resolution.x;
      texcoord.x += resolution.x;
      texcoord.x += 2.0 * resolution.x;
      texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
      return texcoord.x;
    }

    float searchRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${S.int(gC.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x -= 0.25 * resolution.x;
      texcoord.x -= resolution.x;
      texcoord.x -= 2.0 * resolution.x;
      texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
      return texcoord.x;
    }

    float searchUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${S.int(gC.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y -= 0.25 * resolution.y;
      texcoord.y -= resolution.y;
      texcoord.y -= 2.0 * resolution.y;
      texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
      return texcoord.y;
    }

    float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${S.int(gC.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y += 0.25 * resolution.y;
      texcoord.y += resolution.y;
      texcoord.y += 2.0 * resolution.y;
      texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
      return texcoord.y;
    }

    vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
      vec2 texcoord = float( ${S.int(gC.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
      texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
      texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
      return texture( areaTex, texcoord, 0.0 ).rg;
    }

    void main() {
      vec2 size = vec2(textureSize(edgesTexture, 0));
      vec2 resolution = 1.0 / size;
      vec2 pixelCoord = uv * size;
      vec4 offsets[2];
      offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
      offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
      vec4 maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${S.int(gC.maxSearchSteps)} );

      ivec4 subsampleIndices = ivec4(0.0);
      vec4 weights = vec4(0.0);
      vec2 e = texture( edgesTexture, uv ).rg;
      if ( e.g > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.x = searchLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x, resolution );
        coords.y = offsets[1].y;
        d.x = coords.x;
        float e1 = texture( edgesTexture, coords, 0.0 ).r;
        coords.x = searchRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y, resolution );
        d.y = coords.x;
        d = d * size.x - pixelCoord.x;
        vec2 sqrt_d = sqrt( abs(d) );
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ), resolution).r;
        weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
      }

      if ( e.r > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.y = searchUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z, resolution );
        coords.x = offsets[0].x;
        d.x = coords.y;
        float e1 = texture( edgesTexture, coords, 0.0 ).g;
        coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w, resolution );
        d.y = coords.y;
        d = d * size.y - pixelCoord.y;
        vec2 sqrt_d = sqrt(abs(d));
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0), resolution).g;
        weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

        // for some reason the following lines are necessary to prevent
        // texture lookup precision issues on some Intel integrated graphics chips
        vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
        weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
      }
      fragColor = weights;
    }`),t}const q4t=Object.freeze(Object.defineProperty({__proto__:null,build:oze},Symbol.toStringTag,{value:"Module"}));let aze=class lze extends Ki{initializeProgram(e){return new er(e.rctx,lze.shader.get().build(),Pi)}initializePipeline(){return Kt({colorWrite:ui})}};aze.shader=new qi(q4t,()=>oe(()=>Promise.resolve().then(()=>Z9t),void 0));function cze(){const t=new Hi;return t.include(qa),t.fragment.uniforms.add(new xt("blendWeightsTexture",e=>e.inputTexture),new xt("colorTexture",e=>e.color)),t.fragment.code.add(S`void main() {
vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),t}const W4t=Object.freeze(Object.defineProperty({__proto__:null,build:cze},Symbol.toStringTag,{value:"Module"}));let uze=class hze extends Ki{initializeProgram(e){return new er(e.rctx,hze.shader.get().build(),Pi)}initializePipeline(){return Kt({colorWrite:ui})}};uze.shader=new qi(W4t,()=>oe(()=>Promise.resolve().then(()=>Y9t),void 0));const G1e={threshold:.05,localConstrastAdaption:2};function dze(){const t=new Hi;return t.include(qa),t.fragment.uniforms.add(new xt("colorTexture",e=>e.color)),t.outputs.add("fragEdges","vec2"),t.fragment.code.add(S`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
      vec4 offsets[3];
      offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
      offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
      offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${S.float(G1e.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges *= step(maxDelta, float(${S.float(G1e.localConstrastAdaption)}) * delta.xy);

      fragEdges = edges;
    }
  `),t}const Z4t=Object.freeze(Object.defineProperty({__proto__:null,build:dze},Symbol.toStringTag,{value:"Module"}));let pze=class fze extends Ki{initializeProgram(e){return new er(e.rctx,fze.shader.get().build(),Pi)}initializePipeline(){return Kt({colorWrite:ui})}};pze.shader=new qi(Z4t,()=>oe(()=>Promise.resolve().then(()=>X9t),void 0));let Y4t=class extends Ur{},v1=class extends SN{constructor(e){super(e),this.produces="disabled",this.consumes={required:["aa-color","composite-color"]},this._areaTexture=null,this._searchTexture=null,this._smaaParameters=new Y4t,this._edgeTechnique=e.techniques.acquire(pze),this._blendTechnique=e.techniques.acquire(aze),this._blurTechnique=e.techniques.acquire(uze)}initialize(){this.addHandles([te(()=>this.isEnabled(),e=>e?this.enable():this.disable(),pr)])}async enable(){if(this.produces="aa-color",this._abortController||this._areaTexture&&this._searchTexture)return;this._abortController=new AbortController;const e=this._abortController.signal;try{const i=await oe(()=>import("./SMAAData-DCEZ61Cs.js"),[]);await this._loadTextures(i,e),this.requestRender(cr.UPDATE)}catch{}this._abortController=null}async _loadTextures(e,i){Dt(i);const[r,s]=await Promise.allSettled([D_(e.areaTexture,{signal:i}),D_(e.searchTexure,{signal:i})]);if(Dt(i),r.status!=="fulfilled"||s.status!=="fulfilled")return;const n=this.renderingContext;this._areaTexture=H1e(n,di.LINEAR,Ht.RGB,r.value),this._searchTexture=H1e(n,di.NEAREST,Ht.LUMINANCE,s.value)}disable(){this.produces="disabled"}destroy(){this._searchTexture=Ut(this._searchTexture),this._areaTexture=Ut(this._areaTexture),this._blurTechnique.release(),this._blendTechnique.release(),this._edgeTechnique.release()}render(e){var c,u;const i=e.find(({name:d})=>d==="aa-color");if(!(this._edgeTechnique.compiled&&this._blendTechnique.compiled&&this._blurTechnique.compiled&&this._areaTexture&&this._searchTexture))return this.requestRender(cr.UPDATE),i;const r=e.find(({name:d})=>d==="composite-color"),s=r.fbo.width,n=r.fbo.height,o=this.renderingContext;o.setViewport(0,0,s,n);const a=this.fboCache.acquire(s,n,"smaa edges",ls.RG);o.unbindTexture((c=a.fbo)==null?void 0:c.colorTexture),o.bindFramebuffer(a.fbo),o.setClearColor(0,0,0,1),o.clear(jr.COLOR_BUFFER_BIT),this._smaaParameters.color=r.getTexture(),o.bindTechnique(this._edgeTechnique,null,this._smaaParameters),o.screen.draw();const l=this.fboCache.acquire(s,n,"smaa blend");return o.unbindTexture((u=l.fbo)==null?void 0:u.colorTexture),o.bindFramebuffer(l.fbo),o.setClearColor(0,0,1,1),o.clear(jr.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=a.getTexture(),this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,o.bindTechnique(this._blendTechnique,null,this._smaaParameters),o.screen.draw(),a.release(),o.bindFramebuffer(i.fbo),o.setClearColor(0,1,0,1),o.clear(jr.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=l.getTexture(),o.bindTechnique(this._blurTechnique,null,this._smaaParameters),o.screen.draw(),l.release(),i}};function H1e(t,e,i,r){const s=new es;return s.pixelFormat=i,s.wrapMode=Ai.CLAMP_TO_EDGE,s.width=r.width,s.height=r.height,s.samplingMode=e,new Mr(t,s,r)}h([p()],v1.prototype,"produces",void 0),h([p()],v1.prototype,"consumes",void 0),h([p({constructOnly:!0})],v1.prototype,"isEnabled",void 0),h([p({constructOnly:!0})],v1.prototype,"techniques",void 0),h([p()],v1.prototype,"_abortController",void 0),v1=h([I("esri.views.3d.webgl-engine.effects.smaa.SMAA")],v1);let k8=class extends Ur{constructor(){super(...arguments),this.opacity=1}};function mze(t){const e=new Hi;return e.include(qa),e.fragment.uniforms.add(new xt("tex",i=>i.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new tt("opacity",i=>i.opacity)),t.isDepthBlit&&(e.fragment.uniforms.add(new Hr("nearFar",(i,r)=>r.camera.nearFar)),e.fragment.include($y),e.fragment.include(vm)),e.fragment.code.add(S`
    void main() {
      ${t.isDepthBlit?S`
              float normalizedLinearDepth = (-linearDepthFromTexture(tex, uv) - nearFar[0]) / (nearFar[1] - nearFar[0]);
              fragColor = float2rgba(normalizedLinearDepth);`:S`
              fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};`}
    }`),e}const X4t=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:k8,build:mze},Symbol.toStringTag,{value:"Module"}));var Fu;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(Fu||(Fu={}));let uL=class extends uc{constructor(){super(...arguments),this.alphaMode=Fu.None,this.hasOpacityFactor=!1,this.isDepthBlit=!1}};h([j({count:Fu.COUNT})],uL.prototype,"alphaMode",void 0),h([j()],uL.prototype,"hasOpacityFactor",void 0),h([j()],uL.prototype,"isDepthBlit",void 0);let Ule=class gze extends Ki{initializeProgram(e){return new er(e.rctx,gze.shader.get().build(this.configuration),Pi)}initializePipeline(){switch(this.configuration.alphaMode){case Fu.None:return Kt({colorWrite:ui});case Fu.Alpha:return Kt({blending:_a(Be.SRC_ALPHA,Be.ONE,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),colorWrite:ui});case Fu.PremultipliedAlpha:case Fu.COUNT:return Kt({blending:rd(Be.ONE,Be.ONE_MINUS_SRC_ALPHA),colorWrite:ui})}}};Ule.shader=new qi(X4t,()=>oe(()=>Promise.resolve().then(()=>J9t),void 0));let Vle=class extends Ur{};function yze(){const t=new Hi;return t.include(qa),t.fragment.uniforms.add(new xt("tex",e=>e.texture)),t.fragment.code.add(S`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),t}const J4t=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:Vle,build:yze},Symbol.toStringTag,{value:"Module"}));let _ze=class vze extends Ki{initializeProgram(e){return new er(e.rctx,vze.shader.get().build(),Pi)}initializePipeline(){return Kt({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};_ze.shader=new qi(J4t,()=>oe(()=>Promise.resolve().then(()=>Q9t),void 0));let zle=class extends Ur{};function bze(){const t=new Hi;return t.include(qa),t.fragment.uniforms.add(new xt("colorTexture",e=>e.colorTexture),new xt("alphaTexture",e=>e.alphaTexture),new xt("frontFaceTexture",e=>e.frontFaceTexture)),t.fragment.code.add(S`void main() {
float srcAlpha = texture(alphaTexture, uv).r;
if(srcAlpha <= 1e-5){
discard;
}
vec4 srcColor = texture(colorTexture, uv);
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb / srcAlpha, frontFace.rgb, frontFace.a), 1.0 - srcColor.a);
}`),t}const Q4t=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:zle,build:bze},Symbol.toStringTag,{value:"Module"}));let Ble=class wze extends Ki{initializeProgram(e){return new er(e.rctx,wze.shader.get().build(),Pi)}initializePipeline(){return Kt({blending:_a(Be.SRC_ALPHA,Be.ONE,Be.ONE_MINUS_SRC_ALPHA,Be.ONE_MINUS_SRC_ALPHA),colorWrite:ui})}};Ble.shader=new qi(Q4t,()=>oe(()=>Promise.resolve().then(()=>K9t),void 0));let K4t=class{constructor(e,i){this._rctx=e,this._techniques=i,this._configuration=new uL,this._passParameters=new k8,this._oitParameters=new zle,this._hudParameters=new Vle}compositeOIT(e,i,r,s){this._oitParameters.colorTexture=i,this._oitParameters.alphaTexture=r,this._oitParameters.frontFaceTexture=s;const n=this._techniques.acquire(Ble);this._rctx.bindTechnique(n,e,this._oitParameters),this._rctx.screen.draw(),n.release()}compositeHUD(e,i){this._hudParameters.texture=i;const r=this._techniques.acquire(_ze);this._rctx.bindTechnique(r,e,this._hudParameters),this._rctx.screen.draw(),r.release()}composite(e,i,r=Fu.None,s=1){this._configuration.alphaMode=r,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=i,this._passParameters.opacity=s;const n=this._techniques.acquire(Ule,this._configuration);this._rctx.bindTechnique(n,e,this._passParameters),this._rctx.screen.draw(),n.release()}blitDepthToLinearDepth(e,i){this._configuration.isDepthBlit=!0,this.composite(e,i),this._configuration.isDepthBlit=!1}};const e5t=1e4,Xee=100,t5t=500,i5t=500,r5t=.1;function s5t(t,e,i){return Qoe(e,t)*(i[1]-i[0])+i[0]}function n5t(t,e,i){let r=0;if(!e.some(n=>!!n.materialReference&&(r+=n.numGeometries,r>=e5t)))return f5t.compute(t,e);const s=kN();return i.forAll(n=>rO(s,o5t(t,n))),s}function o5t(t,e){if(!e.visible)return;const i=kN(),r=e.getSpatialQueryAccelerator();return r?a5t(i,t,r):l5t(i,t,e.objects),i}function a5t(t,e,i){const r=e.eye,s=e.viewForward,n=e.frustum,o=l=>l.visible,a=i.objectCount;if(a<t5t)Dj(jd,e.near,Math.min(t.near,e.far)),i.forEachInDepthRange(r,s,Wf.DepthOrder.FRONT_TO_BACK,jd,(l,c)=>{Jee(t,e,l),jd.far=t.near,c.setRange(jd)},n,o),Dj(jd,Math.max(t.far,e.near),e.far),i.forEachInDepthRange(r,s,Wf.DepthOrder.BACK_TO_FRONT,jd,(l,c)=>{Jee(t,e,l),jd.near=t.far,c.setRange(jd)},n,o);else{const l=Math.max(Math.min(a,i5t),Math.ceil(a*r5t)),c=i.findClosest(s,Wf.DepthOrder.FRONT_TO_BACK,n,o,l),u=i.findClosest(s,Wf.DepthOrder.BACK_TO_FRONT,n,o,l);c&&u&&(q1e(t,e,c.boundingVolumeWorldSpace.bounds),q1e(t,e,u.boundingVolumeWorldSpace.bounds))}}function l5t(t,e,i){yC.clear(),i.forAll(r=>{r.visible&&r.geometries.length!==0&&yC.add(r)}),yC.empty||(yC.sort(e),Dj(jd,e.near,Math.min(t.near,e.far)),yC.forEachInDepthRange(jd,Wf.DepthOrder.FRONT_TO_BACK,(r,s)=>{s<t.near&&Jee(t,e,r)}),Dj(jd,Math.max(t.far,e.near),e.far),yC.forEachInDepthRange(jd,Wf.DepthOrder.BACK_TO_FRONT,(r,s,n)=>{t.far=Math.max(t.far,n)}))}function Jee(t,e,i){if(!i.visible||!cb(e.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,s=p5t;i.geometries.forEach(n=>{vr(s,r,n.transformation);const o=CP(s);xze(t,e,n.boundingInfo,s,o)})}function xze(t,e,i,r,s){if(i==null)return;nt(Yl,i.center,r);const{eye:n,viewForward:o}=e,a=o[0]*(Yl[0]-n[0])+o[1]*(Yl[1]-n[1])+o[2]*(Yl[2]-n[2]);if(Yl[3]=i.radius*s,!(a-Yl[3]>t.near&&a+Yl[3]<t.far)&&cb(e.frustum,Yl))if(i.radius>Xee&&i.getChildren())for(const l of i.getChildren())xze(t,e,l,r,s);else Qee.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function q1e(t,e,i){const r=e.eye,s=e.viewForward,n=(i[0]-r[0])*s[0]+(i[1]-r[1])*s[1]+(i[2]-r[2])*s[2];t.near=Math.min(t.near,n-i[3]),t.far=Math.max(t.far,n+i[3])}let c5t=class{constructor(){this._items=new ai({allocator:e=>e||{object:null,distance:0,near:0,far:0},deallocator:e=>(e.object=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().object=e}sort(e){const i=e.eye,r=e.viewForward;this._items.forAll(s=>{const n=s.object.boundingVolumeWorldSpace.bounds,o=(n[0]-i[0])*r[0]+(n[1]-i[1])*r[1]+(n[2]-i[2])*r[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(e,i,r){if(i===Wf.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.object,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<e.near||n.near>e.far||r(n.object,n.near,n.far)}}},u5t=class{constructor(){this._view=ke(),this._viewProj=ke(),this._frustum=QL(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,i){this._reset(),An(this._view,e.viewMatrix),vr(this._viewProj,e.projectionMatrix,this._view),CB(this._frustum,e.frustum);const r=this._view,s=r[2],n=r[6],o=r[10],a=r[14];i.forAll(f=>{f.materialReference&&f.forEachGeometry&&f.forEachGeometry(m=>{if(!m.visible||!m.castShadow)return;const g=m.boundingSphere,y=s*g[0]+n*g[1]+o*g[2]+a,v=y-g[3],b=y+g[3];this._geometries.push(m),this._near.push(-b),this._far.push(-v)})});const l=new Rle;if(this._geometries.length===0)return l;for(let f=0;f<this._geometries.length;++f)this._near[f]>l.far&&(l.far=this._near[f]),this._near[f]>2&&this._far[f]<l.near&&(l.near=this._far[f]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let u=0,d=0;for(let f=0;f<this._geometries.length;++f)this._near[f]<l.near&&(this._near[f]>=c.near?l.near=this._near[f]:this._nearCandidates[u++]=f),this._far[f]>l.far&&(this._far[f]<=c.far?l.far=this._far[f]:this._farCandidates[d++]=f);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((f,m)=>this._near[f]<this._near[m]?-1:this._near[f]>this._near[m]?1:0),this._farCandidates.sort((f,m)=>this._far[f]<this._far[m]?1:this._far[f]>this._far[m]?-1:0);for(let f=0;f<this._nearCandidates.length;++f){const m=this._nearCandidates[f];if(this._near[m]<l.near){const g=this._geometries[m],y=g.boundingInfo;this._includeNearBoundingInfoRec(y,g.shaderTransformation,l)}}for(let f=0;f<this._farCandidates.length;++f){const m=this._farCandidates[f];if(this._far[m]>l.far){const g=this._geometries[m],y=g.boundingInfo;this._includeFarBoundingInfoRec(y,g.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,i,r){if(e==null)return;const s=e.center;nt(Yl,s,i);const n=CP(i),o=Yl[0],a=Yl[1],l=Yl[2],c=e.radius*n,u=this._frustum;if(u[0][0]*o+u[0][1]*a+u[0][2]*l+u[0][3]>c||u[1][0]*o+u[1][1]*a+u[1][2]*l+u[1][3]>c||u[2][0]*o+u[2][1]*a+u[2][2]*l+u[2][3]>c||u[3][0]*o+u[3][1]*a+u[3][2]*l+u[3][3]>c)return;const d=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],f=d+c;if(!(-(d-c)<2||-f>=r.near))if(-f>this._looseRange.near)r.near=-f;else{if(c>Xee){const m=e.getChildren();if(m!==void 0){for(const g of m)this._includeNearBoundingInfoRec(g,i,r);return}}Qee.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,i,r){if(e==null)return;let s=e.radius;const n=e.center;nt(Yl,n,i);const o=CP(i),a=Yl[0],l=Yl[1],c=Yl[2];s*=o;const u=this._frustum;if(u[0][0]*a+u[0][1]*l+u[0][2]*c+u[0][3]>s||u[1][0]*a+u[1][1]*l+u[1][2]*c+u[1][3]>s||u[2][0]*a+u[2][1]*l+u[2][2]*c+u[2][3]>s||u[3][0]*a+u[3][1]*l+u[3][2]*c+u[3][3]>s)return;const d=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-s;if(!(-d<=r.far))if(-d<this._looseRange.far)r.far=-d;else{if(s>Xee){const f=e.getChildren();if(f!==void 0){for(const m of f)this._includeFarBoundingInfoRec(m,i,r);return}}Qee.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}},h5t=class{constructor(){this._modelViewProj=ke(),this._clipPosition=[ci(),ci(),ci(),ci(),ci(),ci(),ci(),ci()]}unionDepthRangeWithAABB(e,i,r,s,n){const o=this._modelViewProj;vr(o,i,r);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],u=l===0||l===3||l===4||l===7?s[0]:n[0],d=l===0||l===1||l===4||l===5?s[1]:n[1],f=l<4?s[2]:n[2];c[0]=o[0]*u+o[4]*d+o[8]*f+o[12],c[1]=o[1]*u+o[5]*d+o[9]*f+o[13],c[2]=o[2]*u+o[6]*d+o[10]*f+o[14],c[3]=o[3]*u+o[7]*d+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=d5t(this._clipPosition[eW[l][0]],this._clipPosition[eW[l][1]],this._clipPosition[eW[l][2]]);let u=!0;for(let d=0;d<c.length;++d)if(c[d][3]>=2){u=!1;break}if(!u){a=!0;for(let d=0;d<c.length;++d){const f=c[d][3];Number.isFinite(f)&&(e.near=Math.min(f,e.near),e.far=Math.max(f,e.far))}}}return a}};function d5t(t,e,i){let r=[t,e,i];for(let s=0;s<4;++s){const n=r;r=[];for(let o=0;o<n.length;++o){const a=n[o],l=n[(o+1)%n.length];K7(l,s)?(K7(a,s)||r.push(W1e(a,l,s)),r.push(l)):K7(a,s)&&r.push(W1e(a,l,s))}}return r}function K7(t,e){return e===0?t[0]>=-t[3]:e===1?t[1]>=-t[3]:e===2?t[0]<=t[3]:e===3?t[1]<=t[3]:void bt(!1)}function W1e(t,e,i){let r=0;return i===0?r=(-t[3]-t[0])/(e[0]-t[0]+e[3]-t[3]):i===1?r=(-t[3]-t[1])/(e[1]-t[1]+e[3]-t[3]):i===2?r=(t[3]-t[0])/(e[0]-t[0]-e[3]+t[3]):i===3&&(r=(t[3]-t[1])/(e[1]-t[1]-e[3]+t[3])),XG(ci(),t,e,r)}const eW=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Yl=_n(),p5t=ke(),jd=kN(),yC=new c5t,f5t=new u5t,Qee=new h5t;let m5t=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new Sl(new ArrayBuffer(4)),this._layerToOidToColor=new sw,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new sw,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,i,r,s,n,o=null,a=null,l=null){e&&i&&r&&s&&(this._layerUidToId.set(s,r),this._layerUidToPopupEnabled.set(s,n),n&&this._layerUidToGraphicsUidToObjectId.set(s,i,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l}))}getObjectAndLayerIdColor(e){const i=this.getObjectAndLayerIdColorArray(e);return ri(i.get(0,1),i.get(0,2),i.get(0,3),255)}getObjectAndLayerIdColorArray(e){var o;if(!e.layerUid||!e.graphicUid)return this.colorZero;const i=this._layerUidToPopupEnabled.get(e.layerUid);if(i===void 0)return this.colorZero;if(i===!1)return this.colorZero;const r=(o=this._layerUidToGraphicsUidToObjectId.get(e.layerUid,e.graphicUid))==null?void 0:o.objectId;if(!r)return this.colorZero;let s=this._layerToOidToColor.get(e.layerUid,r);if(!s){for(;!s;){const a=Math.floor(16777214*Math.random())+1;this._colorToUID.has(a)||(s=a)}if(s>16777215)throw new Error("Object ID Overflow");this._layerToOidToColor.set(e.layerUid,r,s),this._colorToUID.set(s,e)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new Sl(n)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[i,r]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(r.layerUid,r.graphicUid),n=this._layerUidToId.get(r.layerUid);s&&n&&e.set(i,s.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:s.objectId,lid:n,attrId:s.attributeNodeId,attrIdx:s.attributeIndex,subLayerId:s.subLayerId}:{type:"object-and-layer-id",oid:s.objectId,lid:n})}return e}};var eb,mS;(function(t){t.OPAQUE="opaque-color",t.TRANSPARENT="transparent-color",t.COMPOSITE="composite-color",t.FINAL="final-color"})(eb||(eb={})),function(t){t.ANTIALIASING="aa-color",t.HIGHLIGHTS="highlight-color",t.MAGNIFIER="magnifier-color"}(mS||(mS={}));let Tze=class{constructor(e,i){this.key=e,this.free=i,this.incarnation=0,this._refCount=1}retain(e=1){this._refCount+=e}release(){return this._refCount===0?(console.log(`Releasing already released FBO attachment in ${new Error().stack}`),!0):(--this._refCount,this._refCount===0&&(this.free(),!0))}};var sO;(function(t){t[t.FBO=0]="FBO",t[t.DEPTH=1]="DEPTH",t[t.COLOR=2]="COLOR"})(sO||(sO={}));let Sze=class extends Tze{constructor(e,i,r){super(e,r),this.attachment=i,this.name=""}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.usedMemory}},g5t=class extends Sze{constructor(e,i,r){super(e,i,r),this.attachment=i,this.type=sO.COLOR}},Z1e=class extends Sze{constructor(){super(...arguments),this.type=sO.DEPTH}};function y5t(t){return(t==null?void 0:t.attachment.type)===I_.Texture}let Eze=class extends Tze{constructor(e,i,r,s,n,o){super(e,o),this.type=sO.FBO,this._colors=new Map,this._name="composite-color",this.acquireDepth=null,this.acquireColor=null,this._name=i,this.fbo=r,this.acquireDepth=s,this.acquireColor=n}dispose(){var e;(e=this.fbo)==null||e.dispose()}get usedMemory(){var e;return((e=this.fbo)==null?void 0:e.usedMemory)||0}get name(){return this._name}setName(e){this._name=e}getTexture(e=Xn.COLOR_ATTACHMENT0){var i,r;return e===UP?(i=this.fbo)==null?void 0:i.depthStencilTexture:(r=this.fbo)==null?void 0:r.getColorTexture(e)}getAttachment(e=Xn.COLOR_ATTACHMENT0){return e===UP?this._depth:this._colors.get(e)}attachDepth(e){var i;return e==null||e.retain(),this.detachDepth(),e&&((i=this.fbo)==null||i.attachDepthStencil(e.attachment)),this._depth=e,this}detachDepth(){var e,i;(e=this.fbo)==null||e.detachDepthStencilTexture(),(i=this.fbo)==null||i.detachDepthStencilBuffer(),this._depth=hi(this._depth)}obtainDepthTexture(){var i;const e=this._depth;return y5t(e)?((i=this.fbo)==null||i.detachDepthStencilTexture(),this._depth=null,e):null}attachColor(e,i){var r;return e.retain(),this.detachColor(i),(r=this.fbo)==null||r.attachColorTexture(e.attachment,i),this._colors.set(i,e),this}detachColor(e){var r;(r=this.fbo)==null||r.detachColorTexture(e);const i=this._colors.get(e);this._colors.delete(e),i==null||i.release()}detachAll(){this._colors.forEach((e,i)=>this.detachColor(i)),this.detachDepth()}},tW=class{constructor(e,i){this._last=new ai,this._incarnation=0,this._cache=new DN(e,i)}destroy(){var e;(e=this._last)==null||e.forAll(i=>i.dispose()),this._last=null,this._cache.destroy()}set interactive(e){var i;e&&!this._last?this._last=new ai:e||((i=this._last)==null||i.forAll(r=>r.dispose()),this._last=null)}clean(){var e;(e=this._last)==null||e.filterInPlace(i=>!(i.incarnation<this._incarnation)||(this._cache.put(i.key,i),!1))}frame(){++this._incarnation}pop(e){if(this._last){const i=this._last.find(r=>r.key===e);if(i)return this._last.removeUnordered(i),i}return this._cache.pop(e)}put(e){e.incarnation=this._incarnation,this._last?this._last.push(e):this._cache.put(e.key,e)}get usedMemory(){var e;return((e=this._last)==null?void 0:e.reduce((i,r)=>i+r.usedMemory,0))??0}},_5t=class{constructor(e){this.rctx=e,this._acquired=new Set,this._cache=new tW(e.newCache,"FBOCache"),this._depthCache=new tW(e.newCache,"DepthAttachmentCache"),this._colorCache=new tW(e.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy(),this._depthCache.destroy(),this._colorCache.destroy()}clean(){this._cache.clean(),this._colorCache.clean(),this._depthCache.clean()}frameStart(){this._cache.frame(),this._colorCache.frame(),this._depthCache.frame(),this.debugCallback&&this.debugCallback()}frameEnd(){const e=this.debugCallback;e&&this._acquired.forEach(i=>i.type===sO.FBO&&e(i.name,i.fbo))}get usedMemory(){return Array.from(this._acquired.values()).reduce((e,i)=>{var r;return e+("getTexture"in i?((r=i.getTexture())==null?void 0:r.usedMemory)??0:i.usedMemory)},this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(e){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=e}acquire(e,i,r,s=ls.RGBA){const n=iW(s,e,i);let o=this._cache.pop(n);if(o){o.retain(),o.setName(r);const a=this.rctx.getBoundFramebufferObject();this.rctx.bindFramebuffer(o.fbo),this.rctx.setDrawBuffers([Xn.COLOR_ATTACHMENT0]),this.rctx.bindFramebuffer(a)}else o=new Eze(n,r,new ky(this.rctx,{...Y1e[s],width:e,height:i}),a=>{a??(a=Fo.DEPTH_STENCIL_TEXTURE);const l=this._acquireDepth(a,o.fbo.width,o.fbo.height,`${o.name} depth`);return o.attachDepth(l),l.release(),o},(a,l)=>{l??(l=ls.RGBA);const c=this._acquireColor(l,e,i,`${o.name} color ${a}`);return o.attachColor(c,a),c.release(),o},()=>{this.debugCallback&&this.debugCallback(o.name,o.fbo),this._acquired.delete(o),o.detachAll(),this._cache.put(o)});return this._trackHandle(o)}acquireDepth(e,i,r,s){return this._acquireDepth(e,i,r,s)}_acquireDepth(e,i,r,s){const n=iW(e,i,r),o=this._depthCache.pop(n);if(o)return o.retain(),o.name=s,this._trackHandle(o);const a=e===Fo.DEPTH_STENCIL_TEXTURE?new Z1e(n,new Mr(this.rctx,{...X1e[e],width:i,height:r}),()=>{this._acquired.delete(a),this._depthCache.put(a)}):new Z1e(n,new DIe(this.rctx,{...X1e[e],width:i,height:r}),()=>{this._acquired.delete(a),this._depthCache.put(a)});return a.name=s,this._trackHandle(a)}_acquireColor(e,i,r,s){const n=iW(e,i,r),o=this._colorCache.pop(n);if(o)return o.retain(),o.name=s,this._trackHandle(o);const a=new g5t(n,new Mr(this.rctx,{...Y1e[e],width:i,height:r}),()=>{this._acquired.delete(a),this._colorCache.put(a)});return a.name=s,this._trackHandle(a)}_trackHandle(e){return this._acquired.add(e),e}};const SD=new Eze("default","default",null,()=>SD,()=>SD,()=>{});function iW(t,e,i){return`${t}x${e}x${i}`}const xV=new es;xV.pixelFormat=Ht.RED,xV.internalFormat=Tt.R8,xV.wrapMode=Ai.CLAMP_TO_EDGE;const TV=new es;TV.pixelFormat=Ht.RG,TV.internalFormat=Tt.RG8,TV.wrapMode=Ai.CLAMP_TO_EDGE;const SV=new es;SV.internalFormat=Tt.RGBA4,SV.dataType=Tl.UNSIGNED_SHORT_4_4_4_4,SV.wrapMode=Ai.CLAMP_TO_EDGE;const Cze=new es;Cze.wrapMode=Ai.CLAMP_TO_EDGE;const ZI=new es;ZI.wrapMode=Ai.CLAMP_TO_EDGE,ZI.samplingMode=di.LINEAR_MIPMAP_LINEAR,ZI.hasMipmap=!0,ZI.maxAnisotropy=8;const YI=new es;YI.pixelFormat=Ht.RED,YI.dataType=Tl.HALF_FLOAT,YI.internalFormat=Tt.R16F,YI.samplingMode=di.NEAREST;const EV=new es;EV.dataType=Tl.HALF_FLOAT,EV.internalFormat=Tt.RGBA16F,EV.samplingMode=di.NEAREST;const Y1e={[ls.RED]:xV,[ls.RG]:TV,[ls.RGBA4]:SV,[ls.RGBA]:Cze,[ls.RGBA_MIPMAP]:ZI,[ls.R16F]:YI,[ls.RGBA16F]:EV},XI=new es;XI.pixelFormat=Ht.DEPTH_STENCIL,XI.dataType=Tl.UNSIGNED_INT_24_8,XI.samplingMode=di.NEAREST,XI.wrapMode=Ai.CLAMP_TO_EDGE;const X1e={[Fo.DEPTH_STENCIL_TEXTURE]:XI,[Fo.DEPTH16_BUFFER]:new LIe(La.DEPTH_COMPONENT16,4)};var ED;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(ED||(ED={}));let u0=class{constructor(e,i,r=ED.FrontToBack){this._rctx=e,this._techniques=i,this._sorting=r,this._draws=new ai({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,i,r,s){const n=this._draws.pushNew();n.geometry=i,n.geometryRanges=r,n.material=e,n.depthSquaredHint=s,n.indexType=(i.indexed?i.vao.indexBuffer.indexType:null)??0}prepare(e,i){return this._draws.map(r=>r.material.prepareTechnique(this._techniques,e,i,r.geometry.parameters))}dispatch(e,i,r){const s=this._rctx;this._previouslyBoundDraw.clear();let n=null;const o=this._draws.length;for(let a=0;a<o;a++){const l=r[a];l===n&&l.configuration.transparencyPassType===ft.NONE||(s.bindTechnique(l,i,e),n=l);const c=this._draws.data[a],u=c.geometry;s.bindVAO(u.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,i,e),this._previouslyBoundDraw.set(l,c.material));const d=c.geometryRanges,f=d.length;if(c.indexType!==0){const m=CV.get(c.indexType);for(let g=0;g<f;g+=2){const y=d[g],v=d[g+1];s.drawElements(u.primitiveType,v,c.indexType,y*m)}}else for(let m=0;m<f;m+=2){const g=d[m],y=d[m+1];s.drawArrays(u.primitiveType,g,y)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===ED.FrontToBack?1:-1;this._draws.sort((i,r)=>{const s=e*(i.depthSquaredHint-r.depthSquaredHint);return s!==0?s:i.geometry.vao.byteSize-r.geometry.vao.byteSize})}get count(){return this._draws.length}};const CV=new Map;CV.set(Et.UNSIGNED_BYTE,1),CV.set(Et.UNSIGNED_SHORT,2),CV.set(Et.UNSIGNED_INT,4);let Kee=class extends sft{constructor(){super({}),this._passes=null,this.produces=new Map([[Pe.OPAQUE_MATERIAL,e=>this._produces(e)],[Pe.TRANSPARENT_MATERIAL,e=>!!(this._passes&&this._passes.materialTransparent.count>0)&&this._produces(e)],[Pe.INTEGRATED_MESH,e=>this._produces(e)]]),this._materialPassParameters=new cwt,this._shadowPassParameters=new uwt,this._highlightPassParameters=new hwt,this._viewshedPassParameters=new dwt,this._systems=new Set}initializeRenderContext(e){this._context=e;const i=e.renderContext.rctx,r=e.techniques;this._passes={materialOpaque:new u0(i,r),materialTransparent:new u0(i,r,ED.BackToFront),materialIntegratedMesh:new u0(i,r),shadowMap:new u0(i,r),highlight:new u0(i,r),highlightIntegratedMesh:new u0(i,r),highlightShadowMap:new u0(i,r),viewshedShadowMap:new u0(i,r),defaultShadowMap:new u0(i,r)}}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}_produces(e){return this._systems.size!==0&&this._passes!==null&&(e===G.Highlight?this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0:e!==G.ShadowHighlight||this._passes.highlight.count>0)}prepareRender(e){if(this._systems.size!==0&&this._passes!==null){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,e.bindParameters));for(const i of Object.values(this._passes))i.finishSubmit();this._context.techniques.frameUpdate()}}prepareTechniques(e){if(this._systems.size===0)return null;const i=e.output===G.Shadow||e.output===G.ShadowHighlight||e.output===G.ShadowExcludeHighlight?this._shadowPassParameters:e.output===G.ViewshedShadow?this._viewshedPassParameters:e.output===G.Highlight?this._highlightPassParameters:this._materialPassParameters,r=e.bindParameters;return this._updateParameters(r.camera,i,r.slot===Pe.TRANSPARENT_MATERIAL),this._materialPassParameters.output=e.output,this._invoke(e,(s,n)=>s.prepare(n,e.bindParameters))}renderNode(e,i){this._invoke(e,(r,s)=>r.dispatch(s,e.bindParameters,i))}_invoke(e,i){if(this._passes===null)return null;switch(e.bindParameters.slot){case Pe.OPAQUE_MATERIAL:switch(e.output){case G.Color:case G.Depth:case G.Normal:case G.ObjectAndLayerIdColor:return i(this._passes.materialOpaque,this._materialPassParameters);case G.Highlight:return i(this._passes.highlight,this._highlightPassParameters);case G.Shadow:return i(this._passes.shadowMap,this._shadowPassParameters);case G.ShadowHighlight:return i(this._passes.highlightShadowMap,this._shadowPassParameters);case G.ShadowExcludeHighlight:return i(this._passes.defaultShadowMap,this._shadowPassParameters);case G.ViewshedShadow:return i(this._passes.viewshedShadowMap,this._viewshedPassParameters)}break;case Pe.TRANSPARENT_MATERIAL:switch(e.output){case G.Color:case G.Depth:case G.Normal:case G.ObjectAndLayerIdColor:return i(this._passes.materialTransparent,this._materialPassParameters)}break;case Pe.INTEGRATED_MESH:switch(e.output){case G.Color:case G.Depth:case G.Normal:case G.ObjectAndLayerIdColor:return i(this._passes.materialIntegratedMesh,this._materialPassParameters);case G.Highlight:return i(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(e){const i=new Rle;return this._systems.forEach(r=>rO(i,r.queryShadowCasterDepthRange(e))),i}_updateParameters(e,i,r){const s=e.viewInverseTransposeMatrix;pe(rW,s[3],s[7],s[11]),sW.set(rW),ve(i.transformWorldFromViewTH,sW.high),ve(i.transformWorldFromViewTL,sW.low),ve(i.slicePlaneLocalOrigin,rW),wp(i.transformViewFromCameraRelativeRS,e.viewMatrix),An(i.transformProjFromView,e.projectionMatrix),i.identifier===Kl.Material&&(this._materialPassParameters.transparent=r,W2(J1e,i.transformViewFromCameraRelativeRS),tN(i.transformNormalViewFromGlobal,J1e))}};Kee=h([I("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],Kee);const rW=C(),J1e=Kr(),sW=new UVe;function Z5(t){return t.name}let v5t=class{constructor(e){this._context=e,this._nodes=new ai}destroy(){this._nodes.forEach(e=>e.destroy()),this._nodes.clear()}add(e){this._nodes.push(e),SB&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:i})=>i).join(", ")}`)}remove(e){this._nodes.remove(e),SB&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:i})=>i).join(", ")}`)}produces(e){return this._nodes.some(({produces:i})=>i===e)}require(e,...i){const r=this._nodes;return i.reduce((s,n)=>s+r.reduce((o,{consumes:a,produces:l})=>o+(a.required.includes(e)&&l===n?1:0),0),0)}optional(e,...i){const r=this._nodes;return i.reduce((s,n)=>s+r.reduce((o,{consumes:a,produces:l})=>{var c;return o+((c=a.optional)!=null&&c.includes(e)&&l===n?1:0)},0),0)}updateAnimation(){return this._nodes.reduce((e,i)=>i.updateAnimation()||e,!1)}render(e,i,r=()=>{}){const s=Z5(e)?e.name:e,n=this._nodes.filter(({produces:o})=>o===s);return n.length===0||(n.forEach(o=>{const a=Z5(e)?[e]:[];for(const l of o.consumes.required){if(l===s)continue;const c=i.get(l);if(!c)return void(r&&r(a));a.push(c)}if(o.consumes.optional)for(const l of o.consumes.optional){if(l===s)continue;const c=i.get(l);c&&a.push(c)}try{const l=o.doRender(a,this._context);l&&l!==e&&(Z5(e)?(e.release(),e=l,i.set(s,e)):e=l)}catch(l){ne.getLogger(o).errorOnce(l)}r&&r(a)}),this._context.rctx.enforceState()),Z5(e)?e:SD}},b5t=class{constructor(e){this._context=e,this._renderPlugins=new ai,this._materialRenderers=new Map,this._slots=new Array,this._renderVersion=iy(0);for(let i=0;i<Pe.MAX_SLOTS;++i)this._slots[i]=[]}destroy(){this._renderPlugins.forEach(e=>e.destroy()),this._renderPlugins.clear(),this._materialRenderers.clear()}get plugins(){return this._renderPlugins}add(e,i){const r=()=>{if(i!=null&&i.aborted)throw e.uninitializeRenderContext(),Ui();this._renderPlugins.push(e),e.materialReference&&this._materialRenderers.set(e.materialReference,e),e.produces.forEach((n,o)=>{this._slots[o].push(e)}),this._context.requestRender(),this._renderVersion.value++},s=e.initializeRenderContext(this._context,i);if(Zu(s))return s.then(r);r()}remove(e){if(e.materialReference!=null&&this._materialRenderers.delete(e.materialReference),this._renderPlugins.removeUnordered(e)!=null){for(let i=0;i<this._slots.length;++i)this._slots[i]=this._slots[i].filter(r=>r!==e);e.uninitializeRenderContext(),this._context.requestRender(),this._renderVersion.value++}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let i=!1;return this._renderPlugins.forAll(r=>{r.updateAnimation&&(i=r.updateAnimation(e)||i)}),i}renderFeatureChanged(){this._renderPlugins.forAll(e=>{e.renderFeatureChanged&&e.renderFeatureChanged()})}prepare(...e){for(const i of e)this._context.renderContext.bindParameters.slot=i,this._slots[i].forEach(r=>{const s=r.produces.get(i);s!=null&&s(G.Color)&&(cK(r)&&r.prepareTechnique(this._context.renderContext),ume(r)&&r.prepareTechniques(this._context.renderContext))})}_getRenderables(){const e=this._context.renderContext.bindParameters.slot,i=this._context.renderContext.output??G.Color,r=new Map;return this._slots[e].forEach(s=>{const n=s.produces.get(e);if(n!=null&&n(i)&&(!s.isDecoration||this._context.renderContext.bindParameters.decorations!==rc.OFF))if(cK(s)){const o=s.prepareTechnique(this._context.renderContext);o!=null&&r.set(s,o)}else if(ume(s)){const o=s.prepareTechniques(this._context.renderContext);o!=null&&r.set(s,o)}else r.set(s,null)}),r}render(e,...i){for(const r of i)this._context.renderContext.bindParameters.slot=r,this._getRenderables().forEach((s,n)=>n.renderNode(this._context.renderContext,s,e))}queryDepthRange(e){const i=new Rle;return this._renderPlugins.forAll(r=>{var n;const s=(n=r.queryDepthRange)==null?void 0:n.call(r,e);rO(i,s)}),i}get updating(){return this._renderVersion.value>=0&&this._renderPlugins.some(e=>e.running)}produces(e,...i){for(const r of i)if(this._slots[r].some(s=>{const n=s.produces.get(r);return!!n&&n(e)}))return!0;return!1}consumes(e){return this._renderPlugins.some(i=>i.consumes().required.includes(e))}getMaterialRenderer(e){return this._materialRenderers.get(e)}removeEmptyMaterialRenderers(){this._renderPlugins.filterInPlace(e=>!e.materialReference||e.numGeometries!==0||(this._materialRenderers.delete(e.materialReference),e.destroy(),!1))}get hasDecorations(){return this._renderPlugins.some(e=>e.isDecoration)}get hasOccludees(){return this._renderPlugins.some(e=>e.hasOccludees)}get renderOccludedFlags(){return this._renderPlugins.reduce((e,i)=>e|i.renderOccludedFlags,ir.None)}get usedMemory(){return this._renderPlugins.reduce((e,i)=>i.materialReference!==null?e:e+(i.usedMemory??0),0)}get test(){}},w5t=class{constructor(e){this.techniques=e,this._blitConfiguration=new uL,this._blitParameters=new k8}render(e,i,r,s,n){e.bindFramebuffer(r.fbo);const o=this.techniques.acquire(Ule,this._blitConfiguration);return e.setClearColor(0,0,0,1),e.clear(jr.COLOR_BUFFER_BIT),o!=null&&o.compiled?(this._blitParameters.texture=i.getTexture(),e.bindTechnique(o,s,this._blitParameters),e.screen.draw(),o.release(),r):(n(cr.UPDATE),r)}},x5t=class{constructor(){this._step=ebe,this._dilation=1,this._firstIdleTime=0}frame(e,i){if(i?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,ue("disable-feature:high-quality-idle"))this._dilation=1;else{const s=i?performance.now()-this._firstIdleTime:0;if(s>=Q1e+S5t)return this._step=1/0,void(this._dilation=1);this._dilation=s>=Q1e?E5t:1}const r=Ne(e/T5t,ebe,M5t);this._step===1/0?this._step=r:this._step=this._step*K1e+r*(1-K1e)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const T5t=.5,Q1e=12e4,S5t=1e4,E5t=10,K1e=.9,C5t=30,ebe=1e3/1,M5t=1e3/C5t;let A5t=class{constructor(e,i){this._fbos=e,this.compositingHelper=i,this._width=4,this._height=4,this._clearColor=ci()}dispose(){this._color=hi(this._color),this.releaseBuffers()}get framebuffer(){return this.color.attachDepth(this.depth),this.color.fbo}get colorTexture(){return this.color.getTexture()}get depthTexture(){return this.depth.attachment}initializeFrame(e,i,r){this._fbos.interactive=r===Of.Default;const s=this._fbos.rctx;this._width=e.fullWidth,this._height=e.fullHeight,cS(this,s.parameters.maxTextureSize);const n=this._color;return this._color=null,this.releaseBuffers(),np(this._clearColor,i),n}releaseBuffers(){var e;(e=this._color)==null||e.detachDepth(),this._depth=hi(this._depth)}renderHUDVisibility(e,i,r){var s,n;return((s=e==null?void 0:e.fbo)==null?void 0:s.width)===this._width&&((n=e==null?void 0:e.fbo)==null?void 0:n.height)===this._height||(e==null||e.release(),e=this._fbos.acquire(this._width,this._height,"hud visibility",ls.RGBA4)),e.attachDepth(r||this.depth),this._fbos.rctx.bindFramebuffer(e.fbo),this._fbos.rctx.clearFramebuffer(P5t),i(),e.detachDepth(),e}compositeToHUDVisibility(e,i){var r;this._fbos.rctx.bindFramebuffer((r=e.hudVisibility)==null?void 0:r.fbo),this.compositingHelper.compositeHUD(e,i)}renderOITPass(e,i,r){let s,n;const{_width:o,_height:a}=this;switch(i){case ft.ColorAlpha:s=this._fbos.acquire(o,a,r?"oit hud color alpha":"oit color alpha",ls.RGBA16F),s.acquireColor(Xn.COLOR_ATTACHMENT1,ls.R16F),n=[0,0,0,1];break;case ft.FrontFace:s=this._fbos.acquire(o,a,r?"oit hud front":"oit front"),n=[0,0,0,0]}return r?s.acquireDepth(Fo.DEPTH16_BUFFER):s.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(s.fbo),this._fbos.rctx.clearFramebuffer(n,r,r),e(),s.detachDepth(),s}compositeToFramebuffer(e,i,r,s){this.bindFbo(),this.compositingHelper.composite(e,i,r,s)}compositeOIT(e,i,r,s){s?(this._fbos.rctx.bindFramebuffer(s.fbo),this._fbos.rctx.setClearColor(0,0,0,1e-13),this._fbos.rctx.clear(jr.COLOR_BUFFER_BIT)):this.bindFbo(),this.compositingHelper.compositeOIT(e,i.getTexture(),i.getTexture(Xn.COLOR_ATTACHMENT1),r.getTexture())}renderDepthDetached(e){this._bindTarget(this.color),e(),this._bindTarget(this.color,this.depth)}renderToCachedFBO(e,i,r,s,n=ls.RGBA,o=Fo.DEPTH16_BUFFER,a=this._width,l=this._height,c=null){var u,d;return((u=e==null?void 0:e.fbo)==null?void 0:u.width)===a&&((d=e==null?void 0:e.fbo)==null?void 0:d.height)===l||(e=hi(e)),e=e??this._fbos.acquire(a,l,i,n),c==null||c.forEach(f=>e.acquireColor(f.attachment,f.format)),o!=null&&e.acquireDepth(o),this._fbos.rctx.bindFramebuffer(e.fbo),this._fbos.rctx.clearFramebuffer(s,!0,!0),r(),e}renderToTargets(e,i,r,s,n=!1,o=!1){this._bindTarget(i,r),this._fbos.rctx.clearFramebuffer(s,n,o),e(),i.detachDepth()}bindFbo(){const e=this._color==null;if(this._bindTarget(this.color,this.depth),e){const i=this._fbos.rctx;i.setClearStencil(0),i.setClearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),i.clear(jr.COLOR_BUFFER_BIT|jr.DEPTH_BUFFER_BIT|jr.STENCIL_BUFFER_BIT)}}_bindTarget(e,i){e.attachDepth(i),this._fbos.rctx.bindFramebuffer(e.fbo)}get width(){return this._width}get height(){return this._height}get color(){return this._ensureColor()}_ensureColor(){return this._color||(this._color=this._fbos.acquire(this._width,this._height,"composite-color")),this._color}updateColor(e){const i=this._ensureColor();i.attachDepth(this.depth),this._color=e(i)}get depth(){return this._depth||(this._depth=this._fbos.acquireDepth(Fo.DEPTH_STENCIL_TEXTURE,this._width,this._height,"depth")),this._depth}};const P5t=[0,1,0,1];let O5t=class{constructor(){this._inputs=new Map}set(e,i){this._inputs.set(e,i)}get(e){return this._inputs.get(e)}has(e){return this._inputs.has(e)}release(e){var i;(i=this._inputs.get(e))!=null&&i.release()&&this._inputs.delete(e)}};const UN=255,$5t=1/UN;function Mze(t){const e=new Hi,i=e.fragment;return i.include(vm),i.include($y),e.include(EN),e.include(qa),e.include(AN,t),i.uniforms.add(new xt("shadowMap",(r,s)=>s.shadowMap.depthTexture),new xt("depthMap",(r,s)=>{var n;return(n=s.depth)==null?void 0:n.attachment}),new fs("inverseViewMatrix",(r,s)=>eo(tbe,wl(tbe,s.camera.viewMatrix,s.camera.center)))),i.constants.add("sampleValue","float",$5t),e.outputs.add("sampleCount","float"),i.code.add(S`void main(void) {
float depth = depthFromTexture(depthMap, uv);
if (depth >= 1.0 || depth <= 0.0) {
discard;
}
float currentPixelDepth = linearizeDepth(depth);
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
ivec2 texSize = textureSize(shadowMap, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMap);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
sampleCount = sampleValue;
}`),e}const tbe=ke(),R5t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:UN,build:Mze},Symbol.toStringTag,{value:"Module"}));var nO;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(nO||(nO={}));let ete=class extends uc{constructor(){super(...arguments),this.visualization=nO.Gradient,this.bandsEnabled=!1}};h([j({count:nO.COUNT})],ete.prototype,"visualization",void 0),h([j()],ete.prototype,"bandsEnabled",void 0);let jle=class extends Ur{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=QD(I5t),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const I5t=ri(.01,0,.25,1);function Aze(t){const e=new Hi,i=e.fragment;i.include(vm),i.include(Fne),e.include(EN),e.include(qa);const{visualization:r,bandsEnabled:s}=t;i.constants.add("inverseSampleValue","float",UN),i.uniforms.add(new xt("shadowCastMap",a=>a.shadowCastMap),new tt("sampleScale",a=>a.sampleScale),new tt("opacityFromElevation",a=>a.opacityFromElevation),new ji("uColor",a=>a.color));const n=r===nO.Gradient,o=r===nO.Threshold;return n&&s?i.uniforms.add(new tt("bandSize",a=>a.bandSize)):o&&i.uniforms.add(new tt("threshold",a=>a.threshold)),i.code.add(S`
    void main(void) {
      float record = texture(shadowCastMap, uv).r;
      float pixelSamples = record * inverseSampleValue;
      if (pixelSamples < 1.0) {
        discard;
      }

      float strength = pixelSamples * sampleScale;

      ${o?S`
          if (strength <= threshold) {
            discard;
          }`:""}

      ${n&&s?S`strength = ceil(strength / bandSize) * bandSize;`:""}

      fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?S`* strength`:""});
    }
  `),e}const L5t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:jle,build:Aze},Symbol.toStringTag,{value:"Module"}));let Pze=class Oze extends Ki{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new er(e.rctx,Oze.shader.get().build(this.configuration),Pi)}initializePipeline(){return Kt({blending:Bu,colorWrite:ui,depthTest:null,depthWrite:null})}get primitiveType(){return Mi.TRIANGLE_STRIP}};Pze.shader=new qi(L5t,()=>oe(()=>Promise.resolve().then(()=>e7t),void 0));const D5t=4e4,N5t=5e4,$ze=1/512;let MV=class extends Ue{constructor(e,i,r,s){super({}),this._techniques=e,this._rctx=i,this._data=r,this._requestRender=s,this._passParameters=new jle(this._data),this._techniqueConfig=new ete,this._enabled=!1,this._vao=Ny(i)}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=Ut(this._vao),this._techniques.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniques.releaseAndAcquire(Pze,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const i=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(i,e,this._passParameters),this._rctx.drawArrays(i.primitiveType,0,y_(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>$ze}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniques.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniques.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const i=this._passParameters.color;EA(e,i)||(np(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};h([p()],MV.prototype,"opacityFromElevation",null),MV=h([I("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],MV);let Rze=class Ize extends Ki{constructor(e){super(e,new Fle,()=>this.destroy())}initializeProgram(e){return new er(e.rctx,Ize.shader.get().build(this.configuration),Pi)}initializePipeline(){return Kt({blending:_a(Be.ONE,Be.ONE,Be.ONE,Be.ONE),colorWrite:ui,depthTest:null,depthWrite:null})}get primitiveType(){return Mi.TRIANGLE_STRIP}};Rze.shader=new qi(R5t,()=>oe(()=>Promise.resolve().then(()=>t7t),void 0));let $c=class extends Ue{constructor(e,i,r,s,n,o){super({}),this.fbos=e,this._stage=r,this._prepareForShadowMapPass=s,this._renderToShadowMap=n,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new lae,this._cachedLightDirections=[],this._depthRange=Hee,this._previewing=!1,this._cameraForcedForScreenshot=!1,this._shadowAccumulatorKey="shadowAccumulator",this._rctx=e.rctx,this._bindParameters=new O6(new Aae(e,r.viewingMode),null),this._bindParameters.shadowMap.enabled=!0,this._vao=Ny(this._rctx),this._accumulationRenderer=new MV(i,this._rctx,this,o);const a=this._stage.view.resourceController.scheduler;this.addHandles([a.registerTask(It.SHADOW_ACCUMULATOR,this),te(()=>r.renderView,l=>{this.removeHandles(ibe),l!=null&&this.addHandles(l.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),ibe)},pr),te(()=>this._previewing,()=>this._requestRenderIfEnabled(),lr)],this._shadowAccumulatorKey)}normalizeCtorArgs(){return{}}dispose(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=Ut(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Ut(this._fbo),this._vao=Ut(this._vao),this._accumulationTechniqueCached=hi(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new Rze(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){return this._bindParameters.depth!=null&&this._depthRange!==Hee&&this._opacityFromElevation>$ze}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const i=this._cachedLightDirections;if(Lb(i,e,h2))return;const r=Math.min(UN,e.length);i.length=r,this._sampleCount=r;for(let s=0;s<r;++s)i[s]=ve(i[s]??C(),e[s]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,i,r,s){if(this._depthRange=i,this._updateCamera(r),this._bindParameters.contentCamera=s,this._bindParameters.depth=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return!1;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(F5t,this._sampleCount-this._progress);for(let o=0;o<n;++o)this._accumulateShadow();return this._cameraForcedForScreenshot=!1,this._requestRender(),n>0}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const i=this._fbo!=null;e.enabled!==i&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,i){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||i<0||i>=this._fbo.height?0:(this._fbo.readPixels(e,i,1,1,Ht.RGBA,Tl.UNSIGNED_BYTE,rbe),rbe[0]/this._progress)}_enable(){this._progress=0;const e=new es;e.pixelFormat=Ht.RED,e.internalFormat=Tt.R8,e.wrapMode=Ai.CLAMP_TO_EDGE,this._fbo=new ky(this._rctx,e),this._requestRender()}_disable(){this._fbo=Ut(this._fbo),this._requestRender()}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clear(jr.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._bindParameters,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,y_(this._vao,"geometry"))}_updateCamera(e){const i=this._fbo;if(i==null)return;const r=this._bindParameters.camera;e.equals(r)||r.copyFrom(e),i.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-DL(D5t,N5t,e.relativeElevation)}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){}};h([p()],$c.prototype,"_progress",void 0),h([p()],$c.prototype,"_sampleCount",void 0),h([p()],$c.prototype,"_fbo",void 0),h([p()],$c.prototype,"_depthRange",void 0),h([p()],$c.prototype,"_previewing",void 0),h([p()],$c.prototype,"_accumulationRenderer",void 0),h([p()],$c.prototype,"_isRefining",null),h([p()],$c.prototype,"_isActive",null),h([p()],$c.prototype,"canAccumulate",null),h([p()],$c.prototype,"_isDoneAccumulating",null),h([p()],$c.prototype,"_opacityFromElevation",null),h([p()],$c.prototype,"running",null),$c=h([I("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],$c);const F5t=6,ibe="renderView",rbe=new Uint8Array(4),sbe=j_();let k5t=class{constructor(){this._plane=j_()}get isEnabled(){return!TPe(this.plane,sbe)}get plane(){return this._plane}set plane(e){H2(e||sbe,this._plane)}},b1=class extends Fr{constructor(){super(...arguments),this.sectionAngles=ci()}get sectionAnglesDeg(){return jL(this.sectionAngles.map(e=>ja(e)))}set sectionAnglesDeg(e){this.sectionAngles=jL(e.map(i=>kt(i)))}get projectionMatrix(){const e=ke();return kL(e,this.sectionMatrix,this._projectionMatrixInternal)}get sectionMatrix(){const e=this.sectionAngles[0],i=this.sectionAngles[1],r=this.sectionAngles[2],s=this.sectionAngles[3];bt(e<=i),bt(r<=s);const n=2*Math.tan(this.fovX/2),o=2*Math.tan(this.fovY/2),a=Math.tan(e),l=Math.tan(i),c=Math.tan(r),u=l-a,d=Math.tan(s)-c,f=n/u,m=o/d,g=-(a+u/2)/n*2,y=-(c+d/2)/o*2,v=ke();z2(v,[g,y,0]);const b=ke();jCe(b,[f,m,1]);const w=ke();return kL(w,b,v)}get _sectionRatioX(){const e=Math.tan(this.sectionAngles[0]),i=Math.tan(this.sectionAngles[1]),r=2*Math.tan(this.fovX/2);return Math.min(1,(i-e)/r)}setViewport(e,i){const r=i*this._sectionRatioX;return this.viewport=[e[0],e[1],r,i],r}};h([p()],b1.prototype,"sectionAngles",void 0),h([p()],b1.prototype,"sectionAnglesDeg",null),h([p()],b1.prototype,"projectionMatrix",null),h([p()],b1.prototype,"sectionMatrix",null),h([p()],b1.prototype,"_sectionRatioX",null),b1=h([I("esri.views.3d.webgl-engine.lib.ViewshedFaceCamera")],b1);let U5t=class{constructor(){this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.textureSizeMultiple=128,this.toleranceSides=5,this.toleranceBottomTop=10}textureSizeModifier(e){return e?this.textureSizeModHighQuality:this.textureSizeModLowQuality}textureResizeModulo(e){return Math.ceil(e/this.textureSizeMultiple)*this.textureSizeMultiple}};const nW=["front","left","right","back","top","bottom"];function V5t(t){return!["top","bottom"].includes(t)}let z5t=class{constructor(e){this._fbos=e,this._enabled=!1,this._faces={},this._textureWidth=0,this._textureHeight=0,this.settings=new U5t,this._maxTextureWidth=Math.min(ue("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}get depthTexture(){var e;return(e=this._handle)==null?void 0:e.getTexture()}get enabled(){return this._enabled}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get isTextureZero(){return this._textureWidth===0||this._textureHeight===0}get nearFar(){const e=this.faces;return e.length===0?null:e[0].nearFar}get numActiveFaces(){const e=this._faces;let i=0;return Object.keys(e).forEach(r=>{e[r]&&(i+=1)}),i}get faces(){const e=this._faces,i=[];for(const r of nW){const s=e[r];s&&i.push(s)}return i}get atlasRegions(){return this.faces.map(e=>[e.x/this._textureWidth,(e.x+e.width)/this._textureWidth,e.y/this._textureHeight,(e.y+e.height)/this._textureHeight])}get viewshedProjectionMatrices(){return this.faces.map(e=>e.projectionMatrix)}get viewshedViewMatrices(){return this.faces.map(e=>e.viewMatrix)}_setupFaceCamera(e,i,r,s){const{observerRenderSpace:n,tiltedUpVector:o,targetRenderSpace:a,farDistanceRenderSpace:l,horizontalFieldOfView:c,verticalFieldOfView:u}=i,d=C();Li(d,a,n);const f=C(),m=C(),g=(U,k)=>{const H=C(),V=ke();return qu(V,U,k),nt(H,d,V),Ee(H,n,H),H};let y,v=o;const b=Math.min(90,c),w=Math.min(90,Math.max(0,(c-90)/2));let x=-45,T=45,E=-45,M=45;if(V5t(e)){const U=k=>Ne(k,-45,45);E=U(-u/2)-this.settings.toleranceBottomTop,M=U(+u/2)+this.settings.toleranceBottomTop}switch(e){case"front":y=a,x=-b/2,T=b/2;break;case"left":y=g(Math.PI/2,o),x=45-w;break;case"right":y=g(-Math.PI/2,o),T=-45+w;break;case"top":y=Ee(f,n,o),v=da(m,d);break;case"bottom":y=Li(f,n,o),v=d;break;case"back":y=g(Math.PI,o)}const O=new b1({center:y,eye:n,up:v,far:l});O.sectionAnglesDeg=[x-this.settings.toleranceSides,T+this.settings.toleranceSides,E,M],O.fovY=Math.PI/2;const D=O.setViewport(r,s);return this._faces[e]=O,D}_bindFBO(){var i;const e=this._fbos.rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer((i=this._handle)==null?void 0:i.fbo)}_computeActiveFaces(e){const i=new Set,{horizontalFieldOfView:r,verticalFieldOfView:s}=e,n=-s/2,o=s/2;return r===0||s===0||(n<=45&&o>=-45&&i.add("front"),r>90&&(i.add("left"),i.add("right")),r>270&&i.add("back"),o>45-this.settings.toleranceBottomTop&&i.add("top"),n<-45+this.settings.toleranceBottomTop&&i.add("bottom")),i}_computeBaseTextureSize(e,i,r,s){const n=Math.min(window.devicePixelRatio,i)/e.pixelRatio,o=this.settings.textureSizeModifier(r),a=Sb(Math.floor(Math.max(e.fullWidth,e.fullHeight)*n*o)),l=Math.floor(this._maxTextureWidth/s),c=Math.min(l,a);return mIe(c)}_ensureFBO(){var r,s,n,o,a;const e=this._textureWidth,i=this._textureHeight;((s=(r=this._handle)==null?void 0:r.fbo)==null?void 0:s.width)===e&&((o=(n=this._handle)==null?void 0:n.fbo)==null?void 0:o.height)===i||((a=this._handle)==null||a.release(),this._handle=this._fbos.acquire(e,i,"viewshed shadow map",ls.RGBA4)),this._handle.acquireDepth(Fo.DEPTH16_BUFFER)}clearFBO(){const e=this._fbos.rctx;this._ensureFBO(),this._bindFBO(),e.setClearColor(1,1,1,1),e.clear(jr.COLOR_BUFFER_BIT|jr.DEPTH_BUFFER_BIT)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._handle=hi(this._handle)}start(e,i,r,s){if(this._faces={},!this.enabled)return!1;const n=this._computeActiveFaces(i),o=n.size;if(o===0)return!1;const a=this._computeBaseTextureSize(e,s,r,o);if(a===0)return!1;let l=0,c=0,u=0;return nW.filter(d=>n.has(d)).forEach(d=>{const f=B5t(d,o);f>c&&(u=Math.max(u,l),l=0),c=f;const m=f*a;l+=this._setupFaceCamera(d,i,[l,m],a)}),u=Math.max(u,l),this._textureWidth=this.settings.textureResizeModulo(u),this._textureHeight=j5t(o)*a,this.clearFBO(),!0}finish(){var e;(e=this._handle)==null||e.detachDepth()}get test(){return{faces:this._faces,faceTypes:nW}}};function B5t(t,e){if(e<4)return 0;const i=t==="front"||t==="left";return e===4?i?0:1:i||t==="right"?0:1}function j5t(t){return t<4?1:2}let G5t=class extends Ur{constructor(){super(...arguments),this.localOrigin=sse()}};function H5t(t){t.include(EN),t.fragment.uniforms.add(new fs("inverseViewMatrix",(e,i)=>{const r=ke();return wl(r,i.camera.viewMatrix,e.localOrigin),fw(r,r)})),t.fragment.code.add(S`vec4 reconstructLocalPosition(vec2 coord, float linearDepth) {
vec4 cameraSpace = vec4(reconstructPosition(coord, linearDepth), 1.0);
return inverseViewMatrix * cameraSpace;
}`)}let Gle=class extends G5t{constructor(){super(...arguments),this.targetVector=[1,0,0],this.upVector=[0,0,1],this.fovs=[45,45],this.headingAndTilt=[0,0],this.shadowMap={depthTexture:null,nearFar:[1,100],numActiveFaces:1,atlasRegions:[[0,0,1,1]]},this.projectionMatrices=Jr.flat(),this.viewMatrices=Jr.flat()}};function Lze(t){const e=new Hi,i=e.fragment;e.include(qa),e.include(H5t),e.include(Gne),i.include($y),i.include(oae),i.uniforms.add(new xt("depthTexture",(s,n)=>{var o;return(o=n.depth)==null?void 0:o.attachment})),i.uniforms.add(new fs("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new fs("inverseViewNormalMatrix",(s,n)=>fw(q5t,n.camera.viewInverseTransposeMatrix))),i.uniforms.add(new Wt("viewshedTargetVector",(s,n)=>s.targetVector),new Wt("viewshedUpVector",(s,n)=>s.upVector),new Hr("viewshedFOVs",(s,n)=>s.fovs),new Hr("viewshedHeadingAndTilt",(s,n)=>s.headingAndTilt),new Hr("viewshedNearFar",(s,n)=>s.shadowMap.nearFar??[1,100])),i.uniforms.add(new xt("viewshedShadowMap",s=>s.shadowMap.depthTexture),new DK("viewshedProjectionMatrices",(s,n)=>s.projectionMatrices,6),new DK("viewshedViewMatrices",(s,n)=>s.viewMatrices,6),new UO("viewshedNumFaces",(s,n)=>s.shadowMap.numActiveFaces),new sc("viewshedAtlasRegions",(s,n)=>s.shadowMap.atlasRegions.flat(),24)),i.constants.add("visibleColor","vec4",[0,1,0,.5]),i.constants.add("occludedColor","vec4",[1,0,0,.5]);const r=t.useNormalMap;return r?(i.uniforms.add(new xt("normalMap",(s,n)=>s.normalTexture)),i.code.add(S`vec3 normalFromTexture() {
vec4 norm4 = texture(normalMap, uv);
vec3 nNormal = vec3(-1.0) + 2.0 * norm4.xyz;
return normalize((inverseViewNormalMatrix * vec4(nNormal, 1.0)).xyz);
}`)):e.include(KVe),i.code.add(S`
    // UV coordinates of point projected onto viewshed shadow map
    vec2 getViewshedUv(vec4 worldPosition, int face) {
      mat4 viewshedMatrix = viewshedProjectionMatrices[face];
      vec4 viewshedUv4 = viewshedMatrix * worldPosition;
      vec3 viewshedUv = viewshedUv4.xyz / viewshedUv4.w;
      return viewshedUv.xy;
    }

    float viewshedDepthToFloat(float depth) {
      return (depth - viewshedNearFar[0]) / (viewshedNearFar[1] - viewshedNearFar[0]);
    }

    // Orthographic depth to viewshed of given point and given cube map face in range [0, 1].
    float getOrthographicDepthToViewshed(vec4 worldPosition, int face) {
      mat4 viewshedViewMatrix = viewshedViewMatrices[face];
      vec4 viewshedUv4 = viewshedViewMatrix * worldPosition;
      vec3 viewshedUv = viewshedUv4.xyz / viewshedUv4.w;
      float depth = -viewshedUv.z;
      return viewshedDepthToFloat(depth);
    }

    // Read depth from shadow map given uv and cube map face
    float getDepthFromShadowMap(vec2 uv, int face) {
      int index = 4 * face;

      float umin = viewshedAtlasRegions[index];
      float umax = viewshedAtlasRegions[index + 1];
      float vmin = viewshedAtlasRegions[index + 2];
      float vmax = viewshedAtlasRegions[index + 3];

      vec4 atlasRegion = vec4(umin, vmin, umax, vmax);
      return rgba4ToFloat(textureAtlasLookup(viewshedShadowMap, uv, atlasRegion));
    }

    struct ViewshedPoint {
      int face;
      vec2 uv;
      bool isWithin;
      float orthographicDepth;
    };

    // Find cube map face the given position lies in and return relevant information about it
    bool getViewshedPoint(vec4 worldPosition, out ViewshedPoint point) {
      vec3 nUp = normalize(viewshedUpVector);

      // Try with all active cube map faces
      for(int i=0; i < viewshedNumFaces; i++) {

        // Check if when projected, point lies within shadow map texture
        vec2 viewshedUv = getViewshedUv(worldPosition, i);
        if (viewshedUv.x > 0.0 && viewshedUv.x < 1.0 && viewshedUv.y > 0.0 && viewshedUv.y < 1.0) {
          float orthoDepth = getOrthographicDepthToViewshed(worldPosition, i);
          if (orthoDepth >= 0.0) { // found a cube map face

            // Check whether point is really inside viewshed geometry, not just within the camera frustum

            // outside farDistance
            vec3 position = worldPosition.xyz;
            bool isWithin = length(position) <= viewshedNearFar[1];

            // horizontally outside fov
            float t = dot(nUp, position);
            bool isBottomHalf = t > 0.0;
            vec3 nProjVector = normalize(position - t * nUp);
            if (isWithin) {
              float angle = acos(dot(normalize(viewshedTargetVector), nProjVector));
              if (angle > viewshedFOVs[0] / 2.0) {
                isWithin = false;
              }
            }

            // vertically outside fov
            if (isWithin) {
              float angle = acos(dot(nProjVector, normalize(position)));
              if (!isBottomHalf) {
                angle = -angle;
              }
              float tilt = viewshedHeadingAndTilt[1];
              float limit = viewshedFOVs[1] / 2.0;
              if (angle > limit || angle < -limit) {
                isWithin = false;
              }
            }

            point = ViewshedPoint(i, viewshedUv, isWithin, orthoDepth);
            return true;
          }
        }
      }

      // no cube face matches
      return false;
    }

    float normalCosAngle(float linearDepth, vec3 localPosition) {
      ${r?S`vec3 normal = normalFromTexture();`:S`
        vec3 cameraSpacePosition = reconstructPosition(gl_FragCoord.xy, linearDepth);
        vec3 normal = normalFromDepth(depthTexture, cameraSpacePosition, gl_FragCoord.xy, uv);
        normal = (inverseViewNormalMatrix * vec4(normal, 1.0)).xyz;
        `};

      vec3 viewingDir = normalize(localPosition);
      return dot(normal, viewingDir);
    }

    void main() {
      float depth = depthFromTexture(depthTexture, uv);

      // Outside camera planes
      if (depth >= 1.0 || depth <= 0.0) {
        return;
      }

      float linearDepth = linearizeDepth(depth);

      // Relative to viewshed position
      vec4 localPosition = reconstructLocalPosition(gl_FragCoord.xy, linearDepth);

      ViewshedPoint point;
      bool foundFace = getViewshedPoint(localPosition, point);

      // Outside every viewshed
      if (!foundFace || !point.isWithin) {
        return;
      }

      float viewshedDepth = getDepthFromShadowMap(point.uv, point.face);
      float distance = point.orthographicDepth;

      bool visible = distance < viewshedDepth;
      fragColor = visible ? visibleColor : occludedColor;

      float cosAngle = normalCosAngle(linearDepth, localPosition.xyz);

      // Everything facing away, and close to parallel is considered occluded.
      // Theshold corresponds to around 0.6 degrees, tuned empirically.
      if (cosAngle > -0.01) {
        fragColor = occludedColor;
      }
    }`),e}const q5t=ke(),W5t=Object.freeze(Object.defineProperty({__proto__:null,ViewshedPassParameters:Gle,build:Lze},Symbol.toStringTag,{value:"Module"}));let Dze=class Nze extends Ki{initializeProgram(e){return new er(e.rctx,Nze.shader.get().build(this.configuration),Pi)}initializePipeline(){return Kt({colorWrite:ui,blending:Bu})}};Dze.shader=new qi(W5t,()=>oe(()=>Promise.resolve().then(()=>i7t),void 0));let Fze=class extends uc{constructor(){super(...arguments),this.useNormalMap=!0}};h([j()],Fze.prototype,"useNormalMap",void 0);let bT=class extends poe{get viewshedShadowMap(){return this._viewshedShadowMap}get enabled(){return this._viewsheds.length>0}constructor(e,i){super(e),this._pluginContext=null,this.renderHighQuality=!1,this._parameters=new Gle,this._configuration=new Fze,this._viewsheds=new Ke,this.produces=new Map([[Pe.VIEWSHED,()=>!0]]),this._renderShadowMap=i}initialize(){this.addHandles(te(()=>this.view.qualitySettings.maximumPixelRatio,e=>this._maximumPixelRatio=e,pr))}destroy(){this.uninitializeRenderContext()}consumes(){return this.enabled?doe:z6}initializeRenderContext(e){this._pluginContext=e,this._viewshedShadowMap=new z5t(this.fboCache),this._viewshedShadowMap.enabled=!0}renderNode(e,i,r){var a,l,c;const{bindParameters:s,rctx:n}=e;if(!this.enabled||!s.depth||r==null)return;const o=this._setupNormals(r);if(this._technique!=null&&this._configuration.useNormalMap===o||(this._configuration.useNormalMap=o,this._technique=(a=this._pluginContext)==null?void 0:a.techniques.acquire(Dze,this._configuration)),(l=this._technique)==null?void 0:l.compiled)for(const u of this._viewsheds){const d=e.rctx.getBoundFramebufferObject(),f=this._renderViewshedShadowCubeMap(s,u),m=this._viewshedShadowMap;f&&m.depthTexture!=null&&!m.isTextureZero&&(this._setPassParameters(u),e.rctx.bindFramebuffer(d),n.bindTechnique(this._technique,s,this._parameters),n.screen.draw())}else(c=this._pluginContext)==null||c.requestRender()}uninitializeRenderContext(){this._pluginContext=null,this._viewshedShadowMap.dispose(),this._technique=He(this._technique)}updateViewsheds(e){const i=e.removes;i!=null&&(Ke.isCollection(i)?this._viewsheds.removeMany(i):this._viewsheds.remove(i));const r=e.adds;if(r!=null)if(Ke.isCollection(r)){const s=r.filter(n=>!this._viewsheds.includes(n));this._viewsheds.addMany(s)}else this._viewsheds.includes(r)||this._viewsheds.add(r)}_renderViewshedShadowCubeMap(e,i){const r=this._viewshedShadowMap;if(!r.enabled)return!1;const s=r.start(e.camera,i,this.renderHighQuality,this._maximumPixelRatio);if(s)for(const n of r.faces)this._renderShadowMap(e,n,G.ViewshedShadow);return r.finish(),s}_setPassParameters(e){const i=this._parameters,r=this._viewshedShadowMap,s=e.observerRenderSpace;i.localOrigin=s,i.fovs=[kt(e.horizontalFieldOfView),kt(e.verticalFieldOfView)],i.headingAndTilt=[kt(e.heading),kt(e.tiltParallelToSurface)],i.upVector=e.tiltedUpVector;const n=Z5t(e.targetRenderSpace,s);i.targetVector=n,i.shadowMap=r;const o=[],a=[];for(let l=0;l<r.numActiveFaces;l++)wl(oW,r.viewshedViewMatrices[l],s),o.push(...oW.flat()),Y5t(r.viewshedProjectionMatrices[l],oW,nbe),a.push(...nbe.flat());i.viewMatrices=o,i.projectionMatrices=a}_setupNormals(e){const i=e.get("normals"),r=i==null?void 0:i.getTexture();return this._parameters.normalTexture=r,r!=null}get test(){return{viewsheds:this._viewsheds}}};function Z5t(t,e){const i=C();return Li(i,t,e)}function Y5t(t,e,i){const r=qe(.5,.5,.5);return z2(i,r),YD(i,i,r),kL(i,i,t),kL(i,i,e),i}h([p()],bT.prototype,"_pluginContext",void 0),h([p()],bT.prototype,"fboCache",void 0),h([p()],bT.prototype,"view",void 0),h([p()],bT.prototype,"viewshedShadowMap",null),bT=h([I("esri.views.3d.webgl-engine.lib.Viewshed")],bT);const oW=ke(),nbe=ke();let obe=class{constructor(e,i,r,s,n,o,a,l,c){this.createQuery=e,this.deleteQuery=i,this.resultAvailable=r,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},A0=!1;function X5t(t,e){if(e.disjointTimerQuery)return null;let i=t.getExtension("EXT_disjoint_timer_query_webgl2");return i?new obe(()=>t.createQuery(),r=>{t.deleteQuery(r),A0=!1},r=>t.getQueryParameter(r,t.QUERY_RESULT_AVAILABLE),r=>t.getQueryParameter(r,t.QUERY_RESULT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{A0||(A0=!0,t.beginQuery(i.TIME_ELAPSED_EXT,r))},()=>{t.endQuery(i.TIME_ELAPSED_EXT),A0=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>t.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=t.getExtension("EXT_disjoint_timer_query"),i?new obe(()=>i.createQueryEXT(),r=>{i.deleteQueryEXT(r),A0=!1},r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{A0||(A0=!0,i.beginQueryEXT(i.TIME_ELAPSED_EXT,r))},()=>{i.endQueryEXT(i.TIME_ELAPSED_EXT),A0=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function J5t(t,e){const i=t.capabilities.disjointTimerQuery;return i==null?null:new Q5t(i,e)}let Q5t=class{constructor(e,i){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,i.forEach(r=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(r,null)})}start(){A0||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const i=this._queryResults.get(e);if(i==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(i))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const r=this._timer.getResult(i)/1e6;return this._queryPool.unshift(i),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,r}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var zs;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.DEPTH="depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.NORMALS="normals",t.SSAO="SSAO",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.OPAQUE_ENVIRONMENT="opaque environment",t.TRANSPARENT_ENVIRONMENT="transparent environment",t.LASER_LINES="laser lines",t.VIEWSHED="viewshed",t.OCCLUDED="occluded",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(zs||(zs={}));const aW=Object.values(eb).concat(Object.values(mS)).concat(Object.values(zs)),abe="Total";let K5t=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new n_(abe),this._cpuTimeSamplers=new Map(aW.map(i=>[i,new n_(i)])),this._enableGPUTimer=0,this._totalGPUTime=new n_("GPU"),this._gpuTimeSamplers=new Map(aW.map(i=>[i,new n_(i)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const i=[...aW,abe];this._gpuTimerPool=J5t(this._rctx,i)}if(this._gpuTimerPool==null)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let e=!1;return{hasGPUTimerSupport:!0,remove:()=>{e||(e=!0,--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=Ut(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool&&this._gpuTimerPool.start()}advance(e){const i=performance.now();if(this._cpuTimeSamplers.get(e).record(i-this._lastTimeStampCPU),this._lastTimeStampCPU=i,this._gpuTimerPool){const r=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(r),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){const i=this._gpuTimerPool.stop(zs.FINISH);this._gpuTimeSamplers.get(zs.FINISH).record(i),this._rctx.gl.flush()}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),this._gpuTimerPool&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((i,r)=>i+(r.last||0),0)),++this._totalFrameCount}};class AV{constructor(e,i,r,s,n,o){this._stage=e,this._techniques=r,this._rctx=s,this._compositingHelper=n,this._requestRender=o,this._pluginsHas={hudElements:!1,water:!1},this._hasOverlayWater=!1,this.renderOverlay=a=>{},this._isRendering=!1,this._inGlobeView=!1,this._backgroundColor=ri(0,0,0,1),this._sliceHelper=new k5t,this._blit=null,this._state=iy(Ii.IDLE),this._highQualityTransparencyEnabled=!0,this._terrainTransparency=ul.Opaque,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new x5t,this._loadEdgeViewTask=null,this._edgeViewCallbacks=[],this._reprojectionMatrixVersion=iy(0),this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new O5t,this._releaseNormals=a=>{a.some(({name:l})=>l==="normals")&&this._pluginInput.release("normals")},this._debugNeedsDepth=!1,this.fboCache=new _5t(s),this._renderStateFeatures=iy(Wme(!ue("disable-feature:high-quality-idle"),e.view.qualityProfile)),this._offscreen=new A5t(this.fboCache,this._compositingHelper),this.performanceInfo=new K5t(this._rctx),this._shadowMap=new Aae(this.fboCache,e.viewingMode),this._viewshed=new bT({fboCache:this.fboCache,view:e.view},(a,l,c)=>{l.setGLViewport(this._rctx);const{camera:u,contentCamera:d}=a;this._ensureBindParametersCamera(l,l),this._renderAllGeometry(c),this._ensureBindParametersCamera(u,d),a.camera.setGLViewport(this._rctx)}),this._shadowAccumulator=new $c(this.fboCache,r,e,a=>{const l=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureBindParametersCamera(a.camera,a.contentCamera),this._plugins.prepareRender(),this._shadowMap.enabled=l},(a,l,c)=>{const u=this._stage.view.qualitySettings.maximumPixelRatio;a.shadowMap.start(a.camera,l,c,!0,u),this._renderShadowCascades(G.Shadow,a.shadowMap),a.shadowMap.finish(),a.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(a.camera,a.contentCamera)},o),this._renderContext=new Nxt(this._rctx,this._offscreen,this._shadowMap,this._sliceHelper),this._nodes=new v5t(this._renderContext),this._plugins=new b5t({renderContext:this._renderContext,techniques:r,materials:i,requestRender:o,controller:e,fbos:this.fboCache,isFeatureEnabled:a=>this.isFeatureEnabled(a)}),this.renderPassManager=new Kee,this._plugins.add(this.renderPassManager),this._plugins.add(this._viewshed),this._handles=[te(()=>this._stage.view.state.camera,()=>o(),pr),te(()=>kr.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,a=>{this._renderHiddenTransparentEdges=a?()=>this._renderEdges($h.TRANSPARENT):()=>{},o()},pt),te(()=>{var a;return(a=this._stage.view.environment.background)==null?void 0:a.color},a=>{const l=a?XL(a):jh;Ss(this._backgroundColor,l[0]*l[3],l[1]*l[3],l[2]*l[3],l[3]),o()},pr),te(()=>this._stage.view.state.camera.relativeElevation,a=>{this._inGlobeView=(a??1/0)>=ij},pr)]}destroy(){this._handles.forEach(e=>e.remove()),this._gpuTimerHandle=Lr(this._gpuTimerHandle),this._nodes.destroy(),this._offscreen.dispose(),this._shadowMap.dispose(),this._shadowAccumulator.dispose(),this._loadEdgeViewTask=oc(this._loadEdgeViewTask),this._edgeView=He(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this.fboCache.destroy(),this._plugins.destroy(),T3e.prune()}get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeatures(e=null,i=!ue("disable-feature:high-quality-idle")){this._renderStateFeatures.value=Wme(i,e),this._plugins.renderFeatureChanged(),this._requestRender()}isFeatureEnabled(e,i=this._state.value){return this._renderStateFeatures.value.get(i,e)??!1}setFeatureEnabled(e,i,r){this._renderStateFeatures.mutate(s=>s.set(i,e,r)),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(tn.HighQualityTransparency)}get hasReflections(){return(this._pluginsHas.water||this._hasOverlayWater)&&(this._ssrEnabled||this.isFeatureEnabled(tn.WaterReflection))}get hasDecorations(){return this._plugins.hasDecorations||this._nodes.produces("magnifier-color")}get hasHighlights(){return this._plugins.produces(G.Highlight,Pe.OPAQUE_MATERIAL,Pe.TRANSPARENT_MATERIAL,Pe.DRAPED_MATERIAL)}get hasLaserlines(){return this._plugins.produces(this._renderContext.output,Pe.LASERLINES,Pe.LASERLINES_CONTRAST_CONTROL)}get hasSSAO(){return(this._stage.view.qualitySettings.ambientOcclusion||this.isFeatureEnabled(tn.SSAO))&&!this._inGlobeView}get hasSMAA(){return this._stage.view.qualitySettings.antialiasingEnabled||this.isFeatureEnabled(tn.Antialiasing)}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(tn.HighResolutionAtmosphere)}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=hi(this._bindParameters.ssr.lastFrameColor),this._bindParameters.multipassTerrain.depth=hi(this._bindParameters.multipassTerrain.depth),this._bindParameters.multipassGeometry.depth=hi(this._bindParameters.multipassGeometry.depth)}_disposeOffscreenBuffers(){this._offscreen.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._viewshed.viewshedShadowMap.disposeOffscreenBuffers(),this._bindParameters.depth=hi(this._bindParameters.depth),this._bindParameters.hudVisibility=hi(this._bindParameters.hudVisibility)}get updating(){return this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._plugins.updating||!this.isCameraFinal}loadEdgeView(){return this._loadEdgeViewTask||(this._loadEdgeViewTask=My(async e=>{const{EdgeView:i}=await oe(()=>import("./EdgeView-UddiXFbZ.js"),__vite__mapDeps([195,196,5,33]));Dt(e);const r=this._edgeView=new i({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniques:this._techniques,setNeedsRender:()=>this._requestRender(),schedule:ekt(this._stage.view.resourceController)});return this._handles.push(te(()=>r.updating,()=>this._requestRender(),lr)),this._requestRender(),this._edgeViewCallbacks.forEach(s=>s(r)),this._edgeViewCallbacks.length=0,r})),this._loadEdgeViewTask.promise}withEdgeView(e){this.loadEdgeView(),this._edgeView==null?this._edgeViewCallbacks.push(e):e(this._edgeView)}get edgeView(){return this._edgeView}get isCameraFinal(){return this._reprojectionMatrixVersion.value>=0&&LG(this._bindParameters.ssr.reprojectionMatrix,Jr)}set _reprojectionMatrix(e){QTe(this._bindParameters.ssr.reprojectionMatrix,e)&&this._reprojectionMatrixVersion.value++}get shadowsEnabled(){var e;return!!((e=this._shadowMap)!=null&&e.enabled)}setParameters(e){var s;const{_shadowMap:i,_bindParameters:r}=this;if(((s=e.qualitySettings)==null?void 0:s.reflections)!==void 0&&this._ssrEnabled!==e.qualitySettings.reflections&&(this._ssrEnabled=e.qualitySettings.reflections,this._requestRender()),e.shadowMap!==void 0&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&i.maxCascades!==e.shadowMapMaxCascades&&(i.maxCascades=e.shadowMapMaxCascades,this._requestRender()),e.environment!=null){e.environment.weather!=null&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=!!e.weatherVisible);const n=e.environment.lighting.type!=="virtual";r.enableFillLights!==n&&(r.enableFillLights=n,this._requestRender())}e.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.terrainTransparency!==void 0&&this._terrainTransparency!==e.terrainTransparency&&(this._terrainTransparency=e.terrainTransparency,this._requestRender()),e.shadowCast!==void 0&&this._shadowAccumulator.setOptions(e.shadowCast)}get hasSlicePlane(){return!!this._sliceHelper.plane}get plugins(){return this._plugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(e,i){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:r,removes:s,updates:n}=e;if(r.length===0&&s.length===0&&n.length===0)return;const o=jIe(e);let a=!1;o.forEach((l,c)=>{if(i.done)return;let u=this._plugins.getMaterialRenderer(c);if(u==null&&l.adds.length>0){const d=new J3({material:c});d.initializeRenderContext(this._plugins._context),u=d,this._plugins.add(u)}u&&(u.modify(l),u.numGeometries===0&&(a=!0)),l.removes.forEach(d=>e.removes.removeUnordered(d)),l.adds.forEach(d=>e.adds.removeUnordered(d)),l.updates.forEach(d=>e.updates.removeUnordered(d)),i.madeProgress()}),a&&this._plugins.removeEmptyMaterialRenderers(),this._updateHasFlags(),this._requestRender()}_updateHasFlags(){const e=this._pluginsHas;e.hudElements=this._plugins.produces(G.Color,Pe.LINE_CALLOUTS_HUD_DEPTH,Pe.HUD_MATERIAL,Pe.LABEL_MATERIAL),e.water=this._plugins.produces(G.Normal,Pe.DRAPED_WATER),this._bindParameters.hasOccludees=this._plugins.hasOccludees}updateAnimation(e){const i=this._hasAnimations;return this._hasAnimations=this._plugins.updateAnimation(e),this._hasAnimations=this._nodes.updateAnimation()||this._hasAnimations,this._hasAnimations!==i&&(this._gpuTimerHandle=i?Lr(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(e,i,r=Of.Default,s=rc.ON){var X,q,Z,ye;this._isRendering=!0,this.performanceInfo.startFrame(),this.fboCache.frameStart(),this._disposeBindBuffers();const n=this._offscreen,{camera:o,contentCamera:a,mode:l,alignPixelEnabled:c}=e;this._state.value=l,this._bindParameters.overlay=this.renderOverlay(i),this._bindParameters.overlay&&this.performanceInfo.advance(zs.OVERLAY),this._renderContext.time=i,this._bindParameters.transparencyPassType=ft.NONE,this._bindParameters.alignPixelEnabled=c,this._bindParameters.decorations=s,this._bindParameters.mainColor=this._bindParameters.mainDepth=null,this._bindParameters.viewshedEnabled=this._viewshed.enabled;const u=this._nodes.produces("magnifier-color"),d=this._nodes.produces("final-color"),f=j_(this._sliceHelper.plane);s===rc.OFF&&(this._sliceHelper.plane=null),o.setGLViewport(this._rctx);const m=n.initializeFrame(o,this._backgroundColor,r);this.hasReflections?this._bindParameters.ssr.lastFrameColor=m:m==null||m.release(),this._ensureBindParametersCamera(o,a),this._plugins.prepareRender(),this._bindParameters.shadowHighlightsVisible=this._needsShadowHighlight&&s===rc.ON;const g=this._plugins.produces(G.Color,Pe.OPAQUE_TERRAIN)&&(this._terrainTransparency===ul.Semitransparent||this._terrainTransparency===ul.TransparentWithDraped),y=this._highQualityTransparency&&g,v=this._plugins.produces(G.Color,...Y5);this._prepareShaders(y,v),this.performanceInfo.advance(zs.PREPARE);const b=this._computeDepthRange(o);this._renderShadowMap(o,this._bindParameters.lighting.mainLight.direction,b),this._ensureBindParametersCamera(o,a);let w=this._renderNormals();if(this._pluginInput.set("normals",w),w){let L=null;this._needsDepth&&(L=w.getAttachment(UP),L==null||L.retain()),this._pluginInput.set("ssao",this._renderSSAO()),this._renderNoSSAOGeometryDepth(L),w=null}else this._renderAllGeometryDepth();this._renderShadowAccumulation(b,o,a),this._ensureBindParametersSSR(i),this._renderContext.output=G.Color,n.bindFbo(),this._bindParameters.mainColor=n.colorTexture,this._bindParameters.mainDepth=n.depthTexture;const x=this.plugins.produces(G.Color,...lW);x&&this._renderOpaqueGeometry(),this._offscreen.updateColor(L=>this._renderNodes(eb.OPAQUE,L,x)),(q=(X=this.fboCache).debugCallback)==null||q.call(X,"opaque-color",this._offscreen.color.fbo),this._renderPlugins(Pe.OPAQUE_ENVIRONMENT,zs.OPAQUE_ENVIRONMENT),this._renderMultipassTerrainDepth(y),this._setMultipassTerrain(y),this._renderEdges($h.OPAQUE),n.bindFbo(),this._renderPlugins(Pe.VOXEL,zs.VOXEL),this._renderHiddenTransparentEdges(),v&&(this._oitEnabled?this._renderOITPass(lA.Geometry):this._renderTransparentMaterial()),this._offscreen.updateColor(L=>this._renderNodes(eb.TRANSPARENT,L,v)),(ye=(Z=this.fboCache).debugCallback)==null||ye.call(Z,"transparent-color",this._offscreen.color.fbo),this._renderMultipassGeometryDepth(y),this._renderHUDVisibility(),y||this._plugins.render(this._pluginInput,Pe.LINE_CALLOUTS);const T=r===Of.ObjectAndLayerID?this._renderObjectAndLayerIdColor():null;this._renderEdges($h.TRANSPARENT);const E=g?this._renderTransparentTerrain():null;E&&(this.performanceInfo.advance(zs.TRANSPARENT_TERRAIN),this._bindParameters.hudVisibility&&(y?this._renderLineCallouts(Uc.Occluded):n.compositeToHUDVisibility(this._bindParameters,E.getTexture()),this._renderHUD(Uc.Occluded,n.color))),this._setTerrainCulling(!1),E&&(n.compositeToFramebuffer(this._bindParameters,E.getTexture(),Fu.PremultipliedAlpha,1),E.release(),y&&(this._renderEdges($h.OPAQUE),v&&(this._oitEnabled?this._renderOITPass(lA.Geometry):this._renderTransparentMaterial(),this.performanceInfo.advance(zs.TRANSPARENT)),this._renderEdges($h.TRANSPARENT))),this._bindParameters.ssao=hi(this._bindParameters.ssao),y&&this._renderLineCallouts(Uc.NotOccluded),this._setMultipassEnabled(!1),this._renderTransparentEnvironment(),this._renderViewshed(),this._renderLaserlines(),this._renderOccluded(),this._pluginInput.set("highlights",this._renderHighlightPrepass()),this._offscreen.updateColor(L=>this._renderNodes(eb.COMPOSITE,L));const M=this._nodes.produces("aa-color"),O=!(r!==Of.Default||d||u&&s===rc.ON&&r===Of.Default),D=this._pluginInput.get("composite-color"),U=O?SD:this.fboCache.acquire(D.fbo.width,D.fbo.height,"aa-color"),k=M?this._renderNodes(mS.ANTIALIASING,U):this._blitToDefault(D,U,!1);this._pluginInput.set(mS.ANTIALIASING,k),this._renderHUD(Uc.NotOccluded,k);const H=this._renderNodes(mS.HIGHLIGHTS,k);let V=this._renderNodes(mS.MAGNIFIER,H);return u&&s===rc.ON&&r===Of.Default&&!d&&(V=this._blitToDefault(V)),d?(V.attachDepth(n.depth),this._blitToDefault(this._renderNodes(eb.FINAL,V)),V.detachDepth()):this._pluginInput.set(eb.FINAL,V),this._pluginInput.release("highlights"),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),this._offscreen.releaseBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=f,this._isRendering=!1,this.fboCache.frameEnd(),this.performanceInfo.finishFrame(),r!==Of.Default&&(this._releaseFBOs(),this._disposeOffscreenBuffers()),{screen:this._pluginInput.get("final-color"),oid:T}}_prepareShaders(e,i){this._renderContext.output=G.Color,this._prepareOpaqueGeometry(),this._setMultipassTerrain(e),this._plugins.prepare(Pe.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),e||this._plugins.prepare(Pe.LINE_CALLOUTS),i&&this._prepareTransparencySlots(),this._plugins.prepare(Pe.VIEWSHED,Pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Pe.TRANSPARENT_ENVIRONMENT,Pe.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(){if(!ue("enable-feature:objectAndLayerId-rendering"))return;const e=this._renderContext.output,i=this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oid");return i.acquireDepth(Fo.DEPTH_STENCIL_TEXTURE),this._rctx.bindFramebuffer(i.fbo),this.fboCache.rctx.clearFramebuffer([0,0,0,0],!0,!0),this._renderAllGeometry(G.ObjectAndLayerIdColor),this._rctx.bindFramebuffer(i.fbo),this.fboCache.rctx.clearFramebuffer(void 0,!0,!0),this._bindParameters.hudRenderStyle=Uc.NotOccluded,this._plugins.render(this._pluginInput,Pe.HUD_MATERIAL),this._renderContext.output=e,this.performanceInfo.advance(zs.OBJECT_AND_LAYER_ID_COLOR),i}finish(e){this._hasAnimations||this._animationTimestep.clear();const i=this.performanceInfo.gpuSamplingEnabled,r=e===cr.BACKGROUND;if(r||i){const s=r?this.performanceInfo.elapsedTime:0,n=i?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),o=Math.max(s,n);this._animationTimestep.frame(o,r)}}readDepthPixels(e,i){var o;if(!this._bindParameters.mainDepth)return;const{width:r,height:s}=this._offscreen,n=this.fboCache.acquire(r,s,"linear-depth");this._rctx.bindFramebuffer(n.fbo),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.clearFramebuffer([0,0,0,0],!0,!0),this._compositingHelper.blitDepthToLinearDepth(this._bindParameters,this._bindParameters.mainDepth),(o=n.fbo)==null||o.readPixels(e[0],e[1],e[2],e[3],Ht.RGBA,Tl.UNSIGNED_BYTE,i),n.release()}readHUDVisibility(e,i,r,s,n){var o,a;(a=(o=this._bindParameters.hudVisibility)==null?void 0:o.fbo)==null||a.readPixels(e,i,r,s,Ht.RGBA,Tl.UNSIGNED_BYTE,n)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_setMultipassTerrain(e){this._setMultipassEnabled(e),this._setTerrainCulling(e)}_setMultipassEnabled(e){this._bindParameters.multipassEnabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderEdges(e){const i=this._edgeView;if(!(i!=null&&i.shouldRender()))return;const{width:r,height:s,depth:n}=this._offscreen,o=this.fboCache.acquire(r,s,"edges"),a=()=>i.render(this._bindParameters,e),l=this._bindParameters.multipassGeometry.depth;this._offscreen.renderToTargets(a,o,l??n,cbe),this._offscreen.compositeToFramebuffer(this._bindParameters,o.getTexture(),Fu.Alpha,1),o.release(),this.performanceInfo.advance(e===$h.OPAQUE?zs.OPAQUE_EDGES:zs.TRANSPARENT_EDGES)}_renderShadowMap(e,i,r){const s=this._shadowMap;s.enabled&&(s.start(e,i,r,this.isFeatureEnabled(tn.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._needsShadowHighlight?(this._renderShadowCascades(G.ShadowHighlight,this._shadowMap),s.moveSnapshot(P2.Highlight),this._renderShadowCascades(G.ShadowExcludeHighlight,this._shadowMap),s.copySnapshot(P2.ExcludeHighlight),this._renderShadowCascades(G.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(G.Shadow),s.finish(),e.setGLViewport(this._rctx),this.performanceInfo.advance(zs.SHADOW_MAP))}_renderShadowCascades(e,i=this._shadowMap){for(const r of i.cascades)r.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(r.camera,r.camera),this._renderAllGeometry(e)}get _needsDepth(){return this._plugins.consumes(G.Depth)||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast||this._debugNeedsDepth}_renderNoSSAOGeometryDepth(e){if(!this._needsDepth||!e)return void(this._bindParameters.depth=hi(this._bindParameters.depth));const{width:i,height:r}=this._offscreen,s=this.fboCache.acquire(i,r,"depth");s.attachDepth(e),e.release(),this._rctx.bindFramebuffer(s.fbo),this._rctx.clearFramebuffer(void 0,!1,!0),this._renderGeometryExcludedFromSSAO(G.Depth),hi(this._bindParameters.depth),this._bindParameters.depth=s.obtainDepthTexture(),s.release(),this.performanceInfo.advance(zs.DEPTH)}_renderAllGeometryDepth(){if(!this._needsDepth)return void(this._bindParameters.depth=hi(this._bindParameters.depth));const{width:e,height:i}=this._offscreen,r=this.fboCache.acquire(e,i,"depth").acquireDepth(Fo.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(r.fbo),this._rctx.clearFramebuffer(void 0,!0,!0),this._renderAllGeometry(G.Depth),hi(this._bindParameters.depth),this._bindParameters.depth=r.obtainDepthTexture(),r.release(),this.performanceInfo.advance(zs.DEPTH)}_renderMultipassTerrainDepth(e){if(!e)return void(this._bindParameters.multipassTerrain.depth=hi(this._bindParameters.multipassTerrain.depth));const i=this._renderContext.output;this._renderContext.output=G.Depth;const{width:r,height:s}=this._offscreen,n=this.fboCache.acquire(r,s,"terrain depth").acquireDepth(Fo.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(n.fbo),this._rctx.clearFramebuffer(void 0,!0,!0),this._renderTransparentTerrain(),hi(this._bindParameters.multipassTerrain.depth),this._bindParameters.multipassTerrain.depth=n.obtainDepthTexture(),this._renderContext.output=i,n.release()}_renderMultipassGeometryDepth(e){if(!e)return void(this._bindParameters.multipassGeometry.depth=hi(this._bindParameters.multipassGeometry.depth));const i=this._renderContext.output,{width:r,height:s}=this._offscreen,n=this.fboCache.acquire(r,s,"geometry depth").acquireDepth(Fo.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(n.fbo),this._rctx.clearFramebuffer(void 0,!0,!0),this._renderOpaqueGeometryAndTransparentMaterial(G.Depth),this._renderContext.output=i,hi(this._bindParameters.multipassGeometry.depth),this._bindParameters.multipassGeometry.depth=n.obtainDepthTexture(),n.release()}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(e){if(!this._needsDepthRange)return Hee;const i=n5t(e,this._plugins.plugins,this._stage.layers);return rO(i,this._plugins.queryDepthRange(e)),i.near=Math.max(e.near,i.near),i.far=Math.min(e.far,i.far),i}_renderNormals(){const e=this._nodes.require("normals","final-color","composite-color","opaque-color","transparent-color"),i=(this.hasSSAO?1:0)+(this.hasLaserlines?1:0)+e;if(i===0)return;const r=this._offscreen.renderToCachedFBO(null,"normals",()=>this._renderGeometryForSSAO(G.Normal),[0,0,0,0],ls.RGBA,Fo.DEPTH_STENCIL_TEXTURE),s=this._nodes.optional("normals","final-color","composite-color","opaque-color","transparent-color")+(this._viewshedEnabled?1:0);return r.retain(i+s-1),this.performanceInfo.advance(zs.NORMALS),r}_renderSSAO(){const e=this._pluginInput.get("normals");if(!this.hasSSAO||!e)return void(e==null?void 0:e.detachDepth());const i=this._nodes.render("ssao",this._pluginInput);return this._bindParameters.ssao=i,e.detachDepth(),this._pluginInput.release("normals"),this.performanceInfo.advance(zs.SSAO),i}_renderAllGeometry(e){this._renderContext.output=e,this._plugins.prepare(Pe.TRANSPARENT_TERRAIN),this._renderOpaqueGeometryAndTransparentMaterial(e),this._renderTransparentTerrain()}_renderOpaqueGeometryAndTransparentMaterial(e){this._renderContext.output=e,this._plugins.prepare(Pe.TRANSPARENT_MATERIAL,Pe.TRANSPARENT_NO_SSAO_DEPTH),this._renderOpaqueGeometry(),this._renderTransparentMaterial()}_renderGeometryForSSAO(e){this._renderContext.output=e,this._plugins.render(this._pluginInput,Pe.INTEGRATED_MESH,Pe.OPAQUE_TERRAIN,Pe.OPAQUE_MATERIAL,Pe.TRANSPARENT_MATERIAL),this._renderTransparentTerrain()}_renderGeometryExcludedFromSSAO(e){this._renderContext.output=e,this._plugins.render(this._pluginInput,Pe.OPAQUE_NO_SSAO_DEPTH,Pe.TRANSPARENT_NO_SSAO_DEPTH)}_prepareOpaqueGeometry(){this._plugins.prepare(...lW,Pe.OPAQUE_ENVIRONMENT)}_renderOpaqueGeometry(){this._plugins.render(this._pluginInput,...lW)}_renderTransparentMaterial(){this._plugins.render(this._pluginInput,...Y5)}_renderTransparentTerrain(){const e=this._renderContext.output;if(!this._plugins.produces(e,Pe.TRANSPARENT_TERRAIN))return;const i=()=>this._plugins.render(this._pluginInput,Pe.TRANSPARENT_TERRAIN);if(e!==G.Color)return void i();const{width:r,height:s,depth:n}=this._offscreen,o=this.fboCache.acquire(r,s,"transparent terrain");return this._offscreen.renderToTargets(i,o,n,[0,0,0,0]),o}_renderHUDVisibility(){this._plugins.produces(this._renderContext.output,Pe.OCCLUSION_PIXELS)?(this._bindParameters.hudVisibility=this._offscreen.renderHUDVisibility(this._bindParameters.hudVisibility,()=>this._plugins.render(this._pluginInput,Pe.OCCLUSION_PIXELS),this._bindParameters.multipassGeometry.depth),this._offscreen.bindFbo(),this.performanceInfo.advance(zs.HUD_VISIBILITY)):this._bindParameters.hudVisibility=hi(this._bindParameters.hudVisibility)}_renderLineCallouts(e){if(this._bindParameters.hudRenderStyle=e,e===Uc.Occluded){const i=()=>this._plugins.render(this._pluginInput,Pe.LINE_CALLOUTS),{width:r,height:s,color:n}=this._offscreen,o=this.fboCache.acquireDepth(Fo.DEPTH16_BUFFER,r,s,"line callouts");this._offscreen.renderToTargets(i,n,o,void 0,!0,!0),o.release()}else this._plugins.render(this._pluginInput,Pe.LINE_CALLOUTS)}_renderLaserlines(){if(this.hasLaserlines){if(this._plugins.render(this._pluginInput,Pe.LASERLINES),this._plugins.produces(this._renderContext.output,Pe.LASERLINES_CONTRAST_CONTROL)){const e=this._offscreen,{width:i,height:r,depth:s}=e,n=this.fboCache.acquire(i,r,"laser lines"),o=()=>this._plugins.render(this._pluginInput,Pe.LASERLINES_CONTRAST_CONTROL);e.renderToTargets(o,n,s,cbe),e.compositeToFramebuffer(this._bindParameters,n.getTexture(),Fu.PremultipliedAlpha,1),n.release()}this._pluginInput.release("normals"),this.performanceInfo.advance(zs.LASER_LINES)}}_renderHUD(e,i){if(this._pluginsHas.hudElements){if(this._oitEnabled){const r=this._renderOITPass(lA.HUD,e);this._rctx.bindFramebuffer(i.fbo),this._compositingHelper.composite(this._bindParameters,r.getTexture(),Fu.PremultipliedAlpha),r.release()}else if(e===Uc.Occluded){this._renderContext.output=G.Color;const r=()=>this._renderHUDElements(e),{width:s,height:n,color:o}=this._offscreen,a=this.fboCache.acquireDepth(Fo.DEPTH16_BUFFER,s,n,"hud");this._offscreen.renderToTargets(r,o,a,void 0,!0,!0),a.release()}else this._renderContext.output=G.Color,i.acquireDepth(Fo.DEPTH16_BUFFER),this._rctx.bindFramebuffer(i.fbo),this._renderHUDElements(e),i.detachDepth();this.performanceInfo.advance(e===Uc.Occluded?zs.HUD_OCCLUDED:zs.HUD)}}_renderHUDElements(e){this._bindParameters.hudRenderStyle=e,this._plugins.prepare(Pe.LINE_CALLOUTS_HUD_DEPTH,Pe.HUD_MATERIAL,Pe.LABEL_MATERIAL),this._plugins.render(this._pluginInput,Pe.LINE_CALLOUTS_HUD_DEPTH,Pe.HUD_MATERIAL,Pe.LABEL_MATERIAL)}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._plugins.produces(G.ShadowHighlight,Pe.OPAQUE_MATERIAL)}_renderHighlightPrepass(){if(!this.hasHighlights)return;const e=()=>{this._renderAllGeometry(G.Highlight),this._rctx.clear(jr.DEPTH_BUFFER_BIT),this._renderHUDElements(Uc.Both)},i=this._offscreen.renderToCachedFBO(null,"highlights",e,[0,0,0,0],ls.RGBA4,Fo.DEPTH_STENCIL_TEXTURE);return i.detachDepth(),i}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_renderShadowAccumulation(e,i,r){this._needsShadowCast&&this._bindParameters.depth&&this._shadowAccumulator.renderAccumulation(this._bindParameters.depth,e,i,r)&&this.performanceInfo.advance(zs.ACCUMULATED_SHADOWS)}_prepareTransparencySlots(){this._renderContext.output=G.Color,this._bindParameters.transparencyPassType=ft.ColorAlpha,this._plugins.prepare(...Y5),this._bindParameters.transparencyPassType=ft.FrontFace,this._plugins.prepare(...Y5),this._bindParameters.transparencyPassType=ft.NONE,this._techniques.acquire(Ble).release()}_renderOITPass(e,i=Uc.Both){const r=e===lA.HUD,s=r?this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oit hud composite"):null,n=r?()=>this._renderHUDElements(i):()=>this._renderTransparentMaterial(),o=this._renderContext.output;this._renderContext.output=G.Color,this._bindParameters.transparencyPassType=ft.ColorAlpha;const a=this._offscreen.renderOITPass(n,ft.ColorAlpha,r);this._bindParameters.transparencyPassType=ft.FrontFace;const l=this._offscreen.renderOITPass(n,ft.FrontFace,r);return this._offscreen.compositeOIT(this._bindParameters,a,l,s),s==null||s.detachDepth(),l.release(),a.release(),this._bindParameters.transparencyPassType=ft.NONE,this._renderContext.output=o,s}_renderOccluded(){let e=0;nh.clear(),this._plugins.plugins.forAll(l=>{l.materialReference&&l.queryRenderOccludedState(ir.OccludeAndTransparentStencil)&&(e|=ir.OccludeAndTransparentStencil,nh.push(l))});const i=this._offscreen,r=(l,c,u,d,f)=>{if(!(e&c))return;const{width:m,height:g,depth:y}=i,v=this.fboCache.acquire(m,g,"tmp color");i.renderToTargets(u,v,y,[0,0,0,0],d,f),i.compositeToFramebuffer(this._bindParameters,v.getTexture(),Fu.PremultipliedAlpha,l),v.release()},s=(l,c)=>{this._bindParameters.slot=l,c.forAll(u=>{if(cK(u)){const d=u.prepareTechnique(this._renderContext);d&&u.renderNode(this._renderContext,d)}})};nh.length!==0&&(s(Pe.OCCLUDER_MATERIAL,nh),r(.5,ir.OccludeAndTransparentStencil,()=>s(Pe.TRANSPARENT_OCCLUDER_MATERIAL,nh),!1,!1));const n=nh.length>0;nh.clear(),this._plugins.plugins.forAll(l=>{if(!l.materialReference)return;const c=l.queryRenderOccludedState(ir.OccludeAndTransparent),u=l.queryRenderOccludedState(ir.Transparent),d=l.queryRenderOccludedState(ir.Opaque);(c||u||d)&&(e|=c?ir.OccludeAndTransparent:u?ir.Transparent:ir.Opaque,nh.push(l))});const o=this._plugins.renderOccludedFlags;if(e|=o,!e)return;const a=l=>{this._renderContext.renderOccludedMask=l,o>ir.Occlude&&this._plugins.render(this._pluginInput,Pe.OCCLUDED_TERRAIN),s(Pe.OPAQUE_MATERIAL,nh),s(Pe.TRANSPARENT_MATERIAL,nh),s(Pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,nh),this._renderContext.renderOccludedMask=uj};this._renderContext.output=G.Color,r(.5,ir.OccludeAndTransparent,()=>a(ir.OccludeAndTransparent),!0,Yc.OutlineVisualElementMask),r(.5,ir.Transparent,()=>a(ir.Transparent),!0,Yc.OutlineVisualElementMask),r(1,ir.Opaque,()=>a(ir.Opaque),!0,Yc.OutlineVisualElementMask),(n||nh.length>0)&&this.performanceInfo.advance(zs.OCCLUDED),nh.clear()}_renderTransparentEnvironment(){this._shadowAccumulator.render(this._bindParameters),this._offscreen.bindFbo(),this._plugins.render(this._pluginInput,Pe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Pe.TRANSPARENT_ENVIRONMENT),this.performanceInfo.advance(zs.TRANSPARENT_ENVIRONMENT)}_renderViewshed(){this._viewshedEnabled&&(this._viewshed.renderHighQuality=this.isFeatureEnabled(tn.HighResolutionViewshed),this._plugins.render(this._pluginInput,Pe.VIEWSHED),this._pluginInput.release("normals"),this.performanceInfo.advance(zs.VIEWSHED))}_renderPlugins(e,i){this._plugins.produces(this._renderContext.output,e)&&(this._plugins.render(this._pluginInput,e),this.performanceInfo.advance(i))}_renderNodes(e,i,r=!1){if(!this._nodes.produces(e))return r&&this.performanceInfo.advance(e),i;i.setName(e),this._pluginInput.set(e,i);const s=this._nodes.render(i,this._pluginInput,this._releaseNormals);return this.performanceInfo.advance(e),s}_blitToDefault(e,i=SD,r=!0){this._blit||(this._blit=new w5t(this._techniques));const s=this._blit.render(this._rctx,e,i,this._bindParameters,this._requestRender);return this._pluginInput.set(e.name,s),r&&e.release(),s}_ensureBindParametersCamera(e,i){this._bindParameters.camera=e,this._bindParameters.contentCamera=i}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.lastFrameColor){this._ssrEnableTime==null&&(this._ssrEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Jr:(eo(hbe,this._bindParameters.camera.viewMatrix),eo(ube,this._bindParameters.camera.projectionMatrix),vr(_C,hbe,ube),vr(_C,this._renderContext.lastFrameCamera.viewMatrix,_C),vr(_C,this._renderContext.lastFrameCamera.projectionMatrix,_C),this._reprojectionMatrix=_C);const i=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=i>0?Math.min(i,e-this._ssrEnableTime)/i:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=Jr,this._ssrEnableTime=null}addRenderNode(e){this._nodes.add(e),this._requestRender()}removeRenderNode(e){this._nodes.remove(e),this._requestRender()}get usedMemory(){var e;return{fbos:this.fboCache.usedMemory,plugins:this._plugins.usedMemory,edges:((e=this.edgeView)==null?void 0:e.usedMemory)??0}}get _viewshedEnabled(){return this._viewshed.enabled&&this._plugins.produces(this._renderContext.output,Pe.VIEWSHED)}get test(){}}var lA,lbe;h([p({readOnly:!0})],AV.prototype,"fullResolutionAtmosphere",null),h([p()],AV.prototype,"_edgeView",void 0),h([p()],AV.prototype,"updating",null),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(lA||(lA={})),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.ShadowMap=2]="ShadowMap",t[t.HudVisibility=3]="HudVisibility",t[t.ViewshedShadowMap=4]="ViewshedShadowMap"}(lbe||(lbe={}));const cbe=[0,0,0,0],lW=[Pe.INTEGRATED_MESH,Pe.OPAQUE_TERRAIN,Pe.OPAQUE_MATERIAL,Pe.OPAQUE_NO_SSAO_DEPTH],Y5=[Pe.TRANSPARENT_MATERIAL,Pe.TRANSPARENT_NO_SSAO_DEPTH],nh=new ai,ube=ke(),hbe=ke(),_C=ke();function ekt(t){return e=>t.immediate.schedule(e)}let tkt=class{constructor(e){this._rctx=e,this._vao=ikt(e)}destroy(){this._vao=Ut(this._vao)}draw(){this._vao!=null&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(Mi.TRIANGLES,0,3))}get test(){}};function ikt(t,e=Une,i=Pi){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new Dy(t,i,{geometry:e},{geometry:Cr.createVertex(t,hr.STATIC_DRAW,r)})}let kze=class Uze{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=Uze.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return Cr.createIndex(this._rctx,hr.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,Rt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(Mi.POINTS,1,Et.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){}},dbe=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Be.ONE,dstRGB:Be.ZERO,srcAlpha:Be.ONE,dstAlpha:Be.ZERO},this.blendEquation={mode:$_.ADD,modeAlpha:$_.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=qf.BACK,this.frontFace=kP.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=xr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:qf.FRONT_AND_BACK,func:xr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:qf.FRONT_AND_BACK,fail:Cs.KEEP,zFail:Cs.KEEP,zPass:Cs.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.transformFeedbackBuffer=null,this.uniformBufferBindingPoints=new Array,this.transformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.drawBuffers={defaultFramebuffer:[ho.BACK],fbos:new WeakMap},this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},rkt=class{constructor(){for(this._current=new Array,this._allocations=null;this._current.length<pn.COUNT;)this._current.push(0)}increment(e,i,r=1){var s;this._current[e]+=r,(s=this._allocations)==null||s.add(i)}decrement(e,i,r=1){var s;this._current[e]-=r,(s=this._allocations)==null||s.remove(i)}get current(){return this._current}get total(){return this.current.reduce((e,i,r)=>e+(r<pn.UNCOUNTED?i:0),0)}get resourceInformation(){var i;let e="";if(this.total>0){e+=`Live objects:
`;for(let r=0;r<pn.COUNT;++r){const s=this._current[r];s>0&&(e+=`${pn[r]}: ${s}
`)}}return e+=(i=this._allocations)==null?void 0:i.resetLog(),e}},skt=class{constructor(e,i,r){const s=i.textureFilterAnisotropic,n=r.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=s?Math.min(e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY),n):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES),this.maxDrawBuffers=e.getParameter(e.MAX_DRAW_BUFFERS)}};const nkt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var pbe,Vze={exports:{}};(pbe=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(Vze.exports=pbe);const okt=gN(Vze.exports);var fbe,zze={exports:{}};fbe=zze,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(fbe.exports=e)}();const mbe=gN(zze.exports);var Bze={exports:{}};(function(t){(function(e){var i=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();i!==void 0&&(t.exports=i)})()})(Bze);const akt=gN(Bze.exports);var Hp=999,gbe=9999,cW=0,uW=1,ybe=2,_be=3,vbe=4,X5=5,lkt=6,ckt=7,ukt=8,bbe=9,hkt=10,wbe=11,dkt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function pkt(){var t,e,i,r=0,s=0,n=Hp,o=[],a=[],l=1,c=0,u=0,d=!1,f=!1,m="";return function(V){return a=[],V!==null?y(V.replace?V.replace(/\r\n/g,`
`):V):v()};function g(V){V.length&&a.push({type:dkt[n],data:V,position:u,line:l,column:c})}function y(V){var X;for(r=0,i=(m+=V).length;t=m[r],r<i;){switch(X=r,n){case cW:r=E();break;case uW:r=T();break;case ybe:r=x();break;case _be:r=M();break;case vbe:r=U();break;case wbe:r=D();break;case X5:r=k();break;case gbe:r=H();break;case bbe:r=w();break;case Hp:r=b()}X!==r&&(m[X]===`
`?(c=0,++l):++c)}return s+=r,m=m.slice(r),a}function v(V){return o.length&&g(o.join("")),n=hkt,g("(eof)"),a}function b(){return o=o.length?[]:o,e==="/"&&t==="*"?(u=s+r-1,n=cW,e=t,r+1):e==="/"&&t==="/"?(u=s+r-1,n=uW,e=t,r+1):t==="#"?(n=ybe,u=s+r,r):/\s/.test(t)?(n=bbe,u=s+r,r):(d=/\d/.test(t),f=/[^\w_]/.test(t),u=s+r,n=d?vbe:f?_be:gbe,r)}function w(){return/[^\s]/g.test(t)?(g(o.join("")),n=Hp,r):(o.push(t),e=t,r+1)}function x(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,r+1):(g(o.join("")),n=Hp,r)}function T(){return x()}function E(){return t==="/"&&e==="*"?(o.push(t),g(o.join("")),n=Hp,r+1):(o.push(t),e=t,r+1)}function M(){if(e==="."&&/\d/.test(t))return n=X5,r;if(e==="/"&&t==="*")return n=cW,r;if(e==="/"&&t==="/")return n=uW,r;if(t==="."&&o.length){for(;O(o););return n=X5,r}if(t===";"||t===")"||t==="("){if(o.length)for(;O(o););return g(t),n=Hp,r+1}var V=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||V){for(;O(o););return n=Hp,r}return o.push(t),e=t,r+1}function O(V){for(var X,q,Z=0;;){if(X=mbe.indexOf(V.slice(0,V.length+Z).join("")),q=mbe[X],X===-1){if(Z--+V.length>0)continue;q=V.slice(0,1).join("")}return g(q),u+=q.length,(o=o.slice(q.length)).length}}function D(){return/[^a-fA-F0-9]/.test(t)?(g(o.join("")),n=Hp,r):(o.push(t),e=t,r+1)}function U(){return t==="."||/[eE]/.test(t)?(o.push(t),n=X5,e=t,r+1):t==="x"&&o.length===1&&o[0]==="0"?(n=wbe,o.push(t),e=t,r+1):/[^\d]/.test(t)?(g(o.join("")),n=Hp,r):(o.push(t),e=t,r+1)}function k(){return t==="f"&&(o.push(t),e=t,r+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,r+1):/[^\d]/.test(t)?(g(o.join("")),n=Hp,r):(o.push(t),e=t,r+1)}function H(){if(/[^\d\w_]/.test(t)){var V=o.join("");return n=okt.indexOf(V)>-1?ukt:akt.indexOf(V)>-1?ckt:lkt,g(o.join("")),n=Hp,r}return o.push(t),e=t,r+1}}function fkt(t){var e=pkt(),i=[];return i=(i=i.concat(e(t))).concat(e(null))}function mkt(t){return fkt(t)}function gkt(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const hW=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function ykt(t,e="100",i="300 es"){const r=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of t)if(s.type==="preprocessor"){const n=r.exec(s.data);if(n){const o=n[1].replaceAll(/\s{2,}/g," ");if(o===i)return o;if(o===e)return s.data="#version "+i,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function _kt(t,e){for(let i=e-1;i>=0;i--){const r=t[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function JI(t,e,i,r){r=r||i;for(const s of t)if(s.type==="ident"&&s.data===i)return r in e?e[r]++:e[r]=0,JI(t,e,r+"_"+e[r],r);return i}function jze(t,e,i="afterVersion"){function r(l,c){for(let u=c;u<l.length;u++){const d=l[u];if(d.type==="operator"&&d.data===";")return u}return null}function s(l){let c=-1,u=0,d=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(/#(if|ifdef|ifndef)\s+.+/.test(m.data)?++u:/#endif\s*.*/.test(m.data)&&--u),i!=="afterVersion"&&i!=="afterPrecision"||m.type==="preprocessor"&&m.data.startsWith("#version")&&(d=Math.max(d,f)),i==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const g=r(l,f);if(g===null)throw new Error("precision statement not followed by any semicolons!");d=Math.max(d,g)}c<d&&u===0&&(c=f)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=s(t);o(a-1)&&t.splice(a++,0,n);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,n)}function vkt(t,e,i,r="lowp"){jze(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function bkt(t,e,i,r,s="lowp"){jze(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function wkt(t,e){let i,r,s=-1;for(let n=e;n<t.length;n++){const o=t[n];if(o.type==="operator"&&(o.data==="["&&(i=n),o.data==="]")){r=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return i&&r&&t.splice(i,r-i+1),s}function xbe(t,e){if(t.startsWith("#version 300"))return t;const i=mkt(t);if(ykt(i,"100","300 es")==="300 es")return t;let r=null,s=null;const n={},o={};for(let a=0;a<i.length;++a){const l=i[a];switch(l.type){case"keyword":e===Oh.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===Oh.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===Oh.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(r||(r=JI(i,n,"fragColor"),vkt(i,r,"vec4")),l.data=r),e===Oh.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=wkt(i,a+1),u=JI(i,n,"fragData");bkt(i,u,"vec4",c,"mediump"),l.data=u}else e===Oh.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(s||(s=JI(i,n,"gl_FragDepth")),l.data=s);break;case"ident":if(nkt.includes(l.data)){if(e===Oh.VERTEX_SHADER&&_kt(i,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=JI(i,n,l.data)),l.data=o[l.data]}}}for(let a=i.length-1;a>=0;--a){const l=i[a];if(l.type==="preprocessor"){const c=l.data.match(/#extension\s+(.*):/);if(c!=null&&c[1]&&hW.has(c[1].trim())){const f=i[a+1];i.splice(a,f&&f.type==="whitespace"?2:1)}const u=l.data.match(/#ifdef\s+(.*)/);u!=null&&u[1]&&hW.has(u[1].trim())&&(l.data="#if 1");const d=l.data.match(/#ifndef\s+(.*)/);d!=null&&d[1]&&hW.has(d[1].trim())&&(l.data="#if 0")}}return xkt(t,gkt(i))}function xkt(t,e){return e}const Tkt=4294967295;let Skt=class{constructor(e,i,r,s,n=new Map,o=[]){var c;this._context=e,this._locations=s,this._uniformBlockBindings=n,this._transformFeedbackVaryings=o,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),i=xbe(i,Oh.VERTEX_SHADER),r=xbe(r,Oh.FRAGMENT_SHADER),this._vShader=Tbe(this._context,Oh.VERTEX_SHADER,i),this._fShader=Tbe(this._context,Oh.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(pn.Shader,this),cQ()&&(this.vertexShader=i,this.fragmentShader=r),this.usedMemory=i.length+r.length;const a=this._context.gl,l=a.createProgram();a.attachShader(l,this._vShader),a.attachShader(l,this._fShader),this._locations.forEach((u,d)=>a.bindAttribLocation(l,u,d)),(c=this._transformFeedbackVaryings)!=null&&c.length&&a.transformFeedbackVaryings(l,this._transformFeedbackVaryings,a.SEPARATE_ATTRIBS),a.linkProgram(l),cQ()&&!a.getProgramParameter(l,a.LINK_STATUS)&&console.error(`Could not link shader
validated: ${a.getProgramParameter(l,a.VALIDATE_STATUS)}, gl error ${a.getError()}, vertex: ${a.getShaderParameter(this._vShader,a.COMPILE_STATUS)}, fragment: ${a.getShaderParameter(this._fShader,a.COMPILE_STATUS)}, info log: ${a.getProgramInfoLog(l)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[u,d]of this._uniformBlockBindings){const f=a.getUniformBlockIndex(l,u);f<Tkt&&a.uniformBlockBinding(l,f,d)}this._glName=l,this._context.instanceCounter.increment(pn.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get hasTransformFeedbackVaryings(){var e;return!!((e=this._transformFeedbackVaryings)!=null&&e.length)}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl,i=this._context.instanceCounter;this._nameToUniformLocation.forEach(r=>r&&i.decrement(pn.Uniform,r)),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(i.decrement(pn.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,i.decrement(pn.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,i.decrement(pn.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const i=this._nameToUniformLocation.get(e);if(i!==void 0)return i;if(this.glName){const r=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,r),r&&this._context.instanceCounter.increment(pn.Uniform,r),r}return null}hasUniform(e){return this._getUniformLocation(e)!=null}setUniform1i(e,i){const r=this._nameToUniform1.get(e);r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1iv(e,i){Gm(this._nameToUniform1v,e,i)&&this._context.gl.uniform1iv(this._getUniformLocation(e),i)}setUniform2iv(e,i){Gm(this._nameToUniform2,e,i)&&this._context.gl.uniform2iv(this._getUniformLocation(e),i)}setUniform3iv(e,i){Gm(this._nameToUniform3,e,i)&&this._context.gl.uniform3iv(this._getUniformLocation(e),i)}setUniform4iv(e,i){Gm(this._nameToUniform4,e,i)&&this._context.gl.uniform4iv(this._getUniformLocation(e),i)}setUniform1f(e,i){const r=this._nameToUniform1.get(e);r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(e),i),this._nameToUniform1.set(e,i))}setUniform1fv(e,i){Gm(this._nameToUniform1v,e,i)&&this._context.gl.uniform1fv(this._getUniformLocation(e),i)}setUniform2f(e,i,r){const s=this._nameToUniform2.get(e);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),this._nameToUniform2.set(e,[i,r])):i===s[0]&&r===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),s[0]=i,s[1]=r)}setUniform2fv(e,i){Gm(this._nameToUniform2,e,i)&&this._context.gl.uniform2fv(this._getUniformLocation(e),i)}setUniform3f(e,i,r,s){const n=this._nameToUniform3.get(e);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,s),this._nameToUniform3.set(e,[i,r,s])):i===n[0]&&r===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,s),n[0]=i,n[1]=r,n[2]=s)}setUniform3fv(e,i){const r=this._getUniformLocation(e);r!=null&&Gm(this._nameToUniform3,e,i)&&this._context.gl.uniform3fv(r,i)}setUniform4f(e,i,r,s,n){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,s,n),this._nameToUniform4.set(e,[i,r,s,n])):o!==void 0&&i===o[0]&&r===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,s,n),o[0]=i,o[1]=r,o[2]=s,o[3]=n)}setUniform4fv(e,i){const r=this._getUniformLocation(e);r!=null&&Gm(this._nameToUniform4,e,i)&&this._context.gl.uniform4fv(r,i)}setUniformMatrix3fv(e,i,r=!1){const s=this._getUniformLocation(e);s!=null&&Gm(this._nameToUniformMatrix3,e,i)&&this._context.gl.uniformMatrix3fv(s,r,i)}setUniformMatrix4fv(e,i,r=!1){const s=this._getUniformLocation(e);s!=null&&Gm(this._nameToUniformMatrix4,e,i)&&this._context.gl.uniformMatrix4fv(s,r,i)}stop(){}};function Tbe(t,e,i){const r=t.gl,s=r.createShader(e);return r.shaderSource(s,i),r.compileShader(s),cQ()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===Oh.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(Ekt(i))),s}function Ekt(t){let e=2;return t.replaceAll(`
`,()=>`
`+Ckt(e++)+":")}function Ckt(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function Gm(t,e,i){const r=t.get(e);if(!r)return t.set(e,Array.from(i)),!0;const s=i.length;if(r.length!==s)return t.set(e,Array.from(i)),!0;for(let n=0;n<s;++n){const o=i[n];if(r[n]!==o){for(r[n]=o;n<s;++n)r[n]=i[n];return!0}}return!1}let Mkt=class{constructor(e){this._rctx=e,this._store=new sw}dispose(){this._store.forEach(e=>e.forEach(i=>i.dispose())),this._store.clear()}acquire(e,i,r,s){const n=this._store.get(e,i);if(n!=null)return n.ref(),n;const o=new Skt(this._rctx,e,i,r,s);return o.ref(),this._store.set(e,i,o),o}get test(){}},U8=class{constructor(){this._result=!1}dispose(){this._program=Ut(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},Akt=class extends U8{constructor(e){super(),this._rctx=e,this._helperProgram=null,ue("mac")&&ue("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){var e;super.dispose(),(e=this._helperProgram)==null||e.dispose(),this._helperProgram=null}_test(e){const i=this._rctx,r=i.getBoundFramebufferObject(),{x:s,y:n,width:o,height:a}=i.getViewport();i.resetState();const l=new es(1);l.wrapMode=Ai.CLAMP_TO_EDGE,l.samplingMode=di.NEAREST;const c=new ky(i,l),u=Cr.createIndex(this._rctx,hr.STATIC_DRAW,new Uint8Array([0]));i.bindFramebuffer(c),i.setViewport(0,0,1,1),i.useProgram(this._helperProgram),i.bindBuffer(u,Rt.ELEMENT_ARRAY_BUFFER),i.drawElements(Mi.POINTS,1,Et.UNSIGNED_BYTE,0),i.useProgram(e),i.bindVAO(null),i.drawArrays(Mi.TRIANGLES,0,258);const d=new Uint8Array(4);return c.readPixels(0,0,1,1,Ht.RGBA,Tl.UNSIGNED_BYTE,d),i.setViewport(s,n,o,a),i.bindFramebuffer(r),c.dispose(),u.dispose(),d[0]===255}_prepareProgram(){const i=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${S.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,r=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${S.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(i,r,new Map([]))}_prepareHelperProgram(){const e=kze.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},Pkt=class extends U8{constructor(e){super(),this._rctx=e,this._program=Sbe(this._rctx,!1),this._obfuscated=Sbe(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=Ut(this._obfuscated)}_test(e){if(ue("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const i=this._rctx,r=i.getBoundFramebufferObject(),{x:s,y:n,width:o,height:a}=i.getViewport(),l=this._runProgram(e),c=this._runProgram(this._obfuscated);return i.setViewport(s,n,o,a),i.bindFramebuffer(r),l!==0&&(c===0||l/c>5)}_runProgram(e){const i=this._rctx;i.resetState();const r=new es(1);r.wrapMode=Ai.CLAMP_TO_EDGE,r.samplingMode=di.NEAREST;const s=new ky(i,r),n=Cr.createVertex(i,hr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new pm(i,new Map([["position",0]]),{geometry:[new dm("position",2,Et.UNSIGNED_SHORT,0,4)]},{geometry:n}),a=qe(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=qe(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);_Q(a,c,3);const u=new Float32Array(6);_Q(l,u,3),i.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",u[0],u[2],u[4]),e.setUniform3f("u_lowB",u[1],u[3],u[5]),i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(Mi.TRIANGLE_STRIP,0,4);const d=new Uint8Array(4);s.readPixels(0,0,1,1,Ht.RGBA,Tl.UNSIGNED_BYTE,d),o.dispose(),s.dispose();const f=(a[2]-l[2])/25,m=Qoe(d);return Math.abs(f-m)}};function Sbe(t,e){const i=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `;return t.programCache.acquire(i,`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `,new Map([["position",0]]))}let Okt=class extends U8{constructor(e){var s,n;if(super(),this._rctx=e,!e.gl||!((s=e.capabilities.colorBufferFloat)!=null&&s.textureFloat&&((n=e.capabilities.colorBufferFloat)!=null&&n.floatBlend)))return;const i=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,r=new es(1);r.wrapMode=Ai.CLAMP_TO_EDGE,r.dataType=Tl.FLOAT,r.internalFormat=Tt.RGBA32F,r.samplingMode=di.NEAREST;const s=new ky(i,r),n=Cr.createVertex(i,hr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new pm(i,new Map([["a_pos",0]]),{geometry:[new dm("a_pos",2,Et.UNSIGNED_SHORT,0,4)]},{geometry:n});i.gl.getError(),i.useProgram(e);const a=i.getBoundFramebufferObject(),{x:l,y:c,width:u,height:d}=i.getViewport();i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(Mi.TRIANGLE_STRIP,0,4);const f=Kt({blending:rd(Be.ZERO,Be.ONE_MINUS_SRC_ALPHA)});i.setPipelineState(f),i.drawArrays(Mi.TRIANGLE_STRIP,0,4);const m=i.gl.getError();return i.setViewport(l,c,u,d),i.bindFramebuffer(a),o.dispose(),s.dispose(),m!==i.gl.INVALID_OPERATION||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}};new dm("a_pos",2,Et.BYTE,0,2);new dm("a_pos",2,Et.BYTE,0,4),new dm("a_tex",2,Et.BYTE,2,4);const $kt={geometry:[new dm("a_pos",2,Et.UNSIGNED_SHORT,0,4)]};let Rkt=class extends U8{constructor(e){super(),this._rctx=e;const i=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const i=this._rctx;if(!i.gl)return e.dispose(),!0;const r=new es(1);r.wrapMode=Ai.CLAMP_TO_EDGE,r.samplingMode=di.NEAREST;const s=new ky(i,r),n=Cr.createVertex(i,hr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new pm(i,new Map([["a_pos",0]]),$kt,{geometry:n}),a=new es;a.samplingMode=di.LINEAR,a.wrapMode=Ai.CLAMP_TO_EDGE;const l=new Mr(i,a,QI);i.useProgram(e),i.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=i.getBoundFramebufferObject(),{x:u,y:d,width:f,height:m}=i.getViewport();i.bindFramebuffer(s),i.setViewport(0,0,1,1),i.setClearColor(0,0,0,0),i.setBlendingEnabled(!1),i.clear(jr.COLOR_BUFFER_BIT),i.bindVAO(o),i.drawArrays(Mi.TRIANGLE_STRIP,0,4);const g=new Uint8Array(4);return s.readPixels(0,0,1,1,Ht.RGBA,Tl.UNSIGNED_BYTE,g),o.dispose(),s.dispose(),l.dispose(),i.setViewport(u,d,f,m),i.bindFramebuffer(c),g[0]!==255}};const QI=new Image;QI.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",QI.width=5,QI.height=5,QI.decode();let Ikt=class{constructor(e){this.rctx=e,this.floatBufferBlend=new Okt(e),this.svgPremultipliesAlpha=new Rkt(e),this.doublePrecisionRequiresObfuscation=new Pkt(e),this.drawArraysRequiresIndicesTypeReset=new Akt(e)}dispose(){this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function Lkt(t,e){if(e.compressedTextureETC)return null;const i=t.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function Dkt(t,e){if(e.compressedTextureS3TC)return null;const i=t.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function Nkt(t,e){if(e.textureFilterAnisotropic)return null;const i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function Fkt(t,e){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),r=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),s=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}function kkt(t,e,i,r,s){if(e[i])return!1;for(const n of s)if(t.getExtension(n))return!0;return!1}function Ukt(t,e){if(e.textureNorm16)return null;const i=t.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function Vkt(t,e){const i=e.loseContext&&t.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}let zkt=class{constructor(e,i){this._gl=e,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._colorBufferFloat=null,this._loseContext=null,this._textureNorm16=null,this._textureFloatLinear=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get compressedTextureETC(){return this._compressedTextureETC??(this._compressedTextureETC=Lkt(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC??(this._compressedTextureS3TC=Dkt(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic??(this._textureFilterAnisotropic=Nkt(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery??(this._disjointTimerQuery=X5t(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get colorBufferFloat(){return this._colorBufferFloat??(this._colorBufferFloat=Fkt(this._gl,this._disabledExtensions)),this._colorBufferFloat}get loseContext(){return this._loseContext??(this._loseContext=Vkt(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16??(this._textureNorm16=Ukt(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear??(this._textureFloatLinear=kkt(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},Bkt=class{constructor(e,i){this.gl=e,this.instanceCounter=new rkt,this.programCache=new Mkt(this),this._transformFeedbackRequestInfo=null,this._state=new dbe,this._numOfDrawCalls=0,this._numOfTriangles=0,this._loadExtensions(),this.configure(i)}configure(e){this._capabilities=new zkt(this.gl,e),this._parameters=new skt(this.gl,this._capabilities,e),Mr.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new dbe,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new pht({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const s=r.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const s=r.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=r.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)},setDrawBuffers:r=>{if(r)this.setDrawBuffers(r.buffers);else{const{drawFramebuffer:s}=this._state;s===null?this.setDrawBuffers([ho.BACK]):s.colorAttachments.length===0?this.setDrawBuffers([ho.NONE]):this.setDrawBuffers([Xn.COLOR_ATTACHMENT0])}}}),this.enforceState(),Ut(this._driverTest),this._driverTest=new Ikt(this)}dispose(){Ut(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Rt.ARRAY_BUFFER),this.unbindBuffer(Rt.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(Rt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Rt.PIXEL_PACK_BUFFER),this.unbindBuffer(Rt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Rt.COPY_READ_BUFFER),this.unbindBuffer(Rt.COPY_WRITE_BUFFER),this._state.textureUnitMap.length=0,Sf()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,i){for(let r=0;r<e.length;++r)this._state.textureUnitMap[e[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null),this._state.vertexArrayObject=null,this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,i,r,s){e===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(e,i,r,s),this._state.blendColor.r=e,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(e,i){e===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,i),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,i,r,s){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(e,i,r,s),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,i){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(e,i),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(e,i,r,s){this._state.colorMask.r===e&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===s||(this.gl.colorMask(e,i,r,s),this._state.colorMask.r=e,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(e,i,r,s){this._state.clearColor.r===e&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===s||(this.gl.clearColor(e,i,r,s),this._state.clearColor.r=e,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=s)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,i){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=i,this.gl.polygonOffset(e,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,i,r,s){this._state.scissorRect.x===e&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===s||(this.gl.scissor(e,i,r,s),this._state.scissorRect.x=e,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=s)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,i){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===i||(this.gl.depthRange(e,i),this._state.depthRange.zNear=e,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,i,r){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(e,i,r),this._state.stencilFunction.face=qf.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,i,r,s){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(e,i,r,s),this._state.stencilFunction.face=e,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,i,r){this._state.stencilOperation.face===qf.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(e,i,r),this._state.stencilOperation.face=qf.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,i,r,s){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(e,i,r,s),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,i=!1){const r=this._state.activeTexture;return e>=0&&(i||e!==this._state.activeTexture)&&(this.gl.activeTexture(fq+e),this._state.activeTexture=e),r}setDrawBuffers(e){const{drawFramebuffer:i}=this._state,r=i===null,s=r?this._state.drawBuffers.defaultFramebuffer:this._state.drawBuffers.fbos.get(i);if((s==null?void 0:s.length)!==e.length||!s.every((n,o)=>n===e[o]))if(e.length>this.parameters.maxDrawBuffers)console.error("Setting more active draw buffers than GL.MAX_DRAW_BUFFERS allows.");else{if(r){if(e.length>1)return void console.error("The default framebuffer can only have one active draw buffer.");if(e[0]!==ho.BACK&&e[0]!==ho.NONE)return void console.error("The default framebuffer can only use the constants GL.BACK or GL.NONE as draw buffers.")}r||!e.includes(ho.BACK)?(this.gl.drawBuffers(e),r?this._state.drawBuffers.defaultFramebuffer=e:this._state.drawBuffers.fbos.set(i,e),this._stateTracker.invalidateDrawBuffers()):console.error("A framebuffer object can only use the constants GL.COLOR_ATTACHMENTi or GL.NONE as draw buffers.")}}clear(e,i=255){var r;if(e){if(e&jr.COLOR_BUFFER_BIT){const s=(r=this._state.drawFramebuffer)==null?void 0:r.colorAttachments;s&&this.setDrawBuffers(s),this.setColorMask(!0,!0,!0,!0)}e&jr.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&jr.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(i),this.gl.clear(e)}}clearFramebuffer(e,i=!1,r=!1){let s=0;if(e){const o=Math.max(1e-13,e[3]);this.setClearColor(e[0],e[1],e[2],o),s|=jr.COLOR_BUFFER_BIT}i&&(s|=jr.DEPTH_BUFFER_BIT),r===!1?r=0:(r===!0&&(r=255),s|=jr.STENCIL_BUFFER_BIT),s&&this.clear(s,r)}drawArrays(e,i,r){var s,n;if(this._transformFeedbackRequestInfo){if(e!==this._transformFeedbackRequestInfo.primitiveType)throw new Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");if(((s=this._state.program)==null?void 0:s.hasTransformFeedbackVaryings)==null)throw new Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying")}if(Sf()){this._numOfDrawCalls++,this._numOfTriangles+=Ebe(e,r);const o=this._state.textureUnitMap;for(let a=0;a<o.length;a++){const l=o[a];if(l!=null&&l===((n=this._state.drawFramebuffer)==null?void 0:n.colorTexture))throw new Error(`Detected readWrite. Texture already bound at index ${a}`)}}this.gl.drawArrays(e,i,r),Fg(this.gl)}drawArraysInstanced(e,i,r,s){this.gl.drawArraysInstanced(e,i,r,s),Fg(this.gl)}drawElements(e,i,r,s){if(this._transformFeedbackRequestInfo)throw new Error("Cannot called drawElements during a transform feedback request");if(Sf()&&(this._numOfDrawCalls++,this._numOfTriangles+=Ebe(e,i)),this.gl.drawElements(e,i,r,s),Sf()){const n=hIe(this);if(n){const o=this.getBoundVAO(),a=o==null?void 0:o.indexBuffer,l=o==null?void 0:o.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},u={mode:e,count:i,type:r,offset:s},d=(a==null?void 0:a.size)??0,f=s+i,m=d<f?`. Buffer is too small. Attempted to draw index ${f} of ${d}`:"";console.error(`drawElements: ${n}${m}`,{args:u,vao:c})}}}logInfo(){Sf()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){Sf()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,i,r,s){r=Math.max(Math.round(r),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===e&&n.y===i&&n.width===r&&n.height===s||(n.x=e,n.y=i,n.width=r,n.height=s,this.gl.viewport(e,i,r,s))}setViewport4fv(e){this.setViewport(e[0],e[1],e[2],e[3])}restoreViewport({x:e,y:i,width:r,height:s}){this.setViewport(e,i,r,s)}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var i;this._state.program!==e&&((i=this._state.program)==null||i.stop(),this._state.program=e,this.gl.useProgram((e==null?void 0:e.glName)??null))}bindTexture(e,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[i];return(e==null?void 0:e.glName)==null?(s!=null&&(this.setActiveTexture(i,r),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[i]=null,s):r||s!==e?(this.setActiveTexture(i,r),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[i]=e,s):(e.isDirty&&(this.setActiveTexture(i,r),e.applyChanges()),s)}unbindTexture(e){if(e!=null)for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===e&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(e,i=!1){if(i||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(this._stateTracker.invalidateDrawBuffers(),e==null)return this.gl.bindFramebuffer(al.FRAMEBUFFER,null),void(this._state.readFramebuffer=this._state.drawFramebuffer=null);e.initializeAndBind(al.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,i,r=!1){const s=i===al.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(r||n!==e)&&(e==null?this.gl.bindFramebuffer(i,null):e.initializeAndBind(i),s?this._state.readFramebuffer=e??null:(this._stateTracker.invalidateDrawBuffers(),this._state.drawFramebuffer=e??null))}blitFramebuffer(e,i,r=0,s=0,n=e.width,o=e.height,a=0,l=0,c=i.width,u=i.height,d=jr.COLOR_BUFFER_BIT,f=di.NEAREST){this.bindFramebufferSeparate(e,al.READ_FRAMEBUFFER),this.bindFramebufferSeparate(i,al.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,s,n,o,a,l,c,u,d,f)}bindBuffer(e,i){if(e)switch(i??(i=e.bufferType),i){case Rt.ARRAY_BUFFER:this._state.vertexBuffer=wc(this.gl,e,i,this._state.vertexBuffer);break;case Rt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=wc(this.gl,e,i,this._state.indexBuffer);break;case Rt.UNIFORM_BUFFER:this._state.uniformBuffer=wc(this.gl,e,i,this._state.uniformBuffer);break;case Rt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=wc(this.gl,e,i,this._state.pixelPackBuffer);break;case Rt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=wc(this.gl,e,i,this._state.pixelUnpackBuffer);break;case Rt.COPY_READ_BUFFER:this._state.copyReadBuffer=wc(this.gl,e,i,this._state.copyReadBuffer);break;case Rt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=wc(this.gl,e,i,this._state.copyWriteBuffer);break;case Rt.TRANSFORM_FEEDBACK_BUFFER:this._state.transformFeedbackBuffer=wc(this.gl,e,i,this._state.transformFeedbackBuffer)}}bindRenderbuffer(e){const i=this.gl;e||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=e===Rt.UNIFORM_BUFFER?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let s=r[i];return s==null&&(s={buffer:null,offset:0,size:0},r[i]=s),s}bindBufferBase(e,i,r){const s=this._getBufferBinding(e,i);s!=null&&(s.buffer===r&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(e,i,r?r.glName:null),s.buffer=r,s.offset=0,s.size=0))}bindBufferRange(e,i,r,s,n){const o=this._getBufferBinding(e,i);o!=null&&(o.buffer===r&&o.offset===s&&o.size===n||(s%this._parameters.uniformBufferOffsetAlignment==0?(this.gl.bindBufferRange(e,i,r.glName,s,n),o.buffer=r,o.offset=s,o.size=n):console.error("Uniform buffer binding offset is not a multiple of the context offset alignment")))}bindUBO(e,i,r,s){i!=null?(Sf()&&(s??i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&s!==void 0?this.bindBufferRange(Rt.UNIFORM_BUFFER,e,i.buffer,r,s):this.bindBufferBase(Rt.UNIFORM_BUFFER,e,i.buffer)):this.bindBufferBase(Rt.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const s=this._state.uniformBufferBindingPoints[i];s!=null&&s.buffer===e.buffer&&this.bindBufferBase(Rt.UNIFORM_BUFFER,i,null)}}unbindBuffer(e){switch(e){case Rt.ARRAY_BUFFER:this._state.vertexBuffer=wc(this.gl,null,e,this._state.vertexBuffer);break;case Rt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=wc(this.gl,null,e,this._state.indexBuffer);break;case Rt.UNIFORM_BUFFER:this._state.uniformBuffer=wc(this.gl,null,e,this._state.uniformBuffer);break;case Rt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=wc(this.gl,null,e,this._state.pixelPackBuffer);break;case Rt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=wc(this.gl,null,e,this._state.pixelUnpackBuffer);break;case Rt.COPY_READ_BUFFER:this._state.copyReadBuffer=wc(this.gl,null,e,this._state.copyReadBuffer);break;case Rt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=wc(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}bindTransformFeedback(e){const{gl:i}=this;i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,e.glName)}beginTransformFeedback(e,i){if(this._transformFeedbackRequestInfo)throw new Error("Already in a transform feedback request");const{gl:r}=this;r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,e.glName),r.beginTransformFeedback(i),this._transformFeedbackRequestInfo={primitiveType:i}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw new Error("Not in a transform feedback request");const{gl:e}=this;e.endTransformFeedback(),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),this._transformFeedbackRequestInfo=null}async clientWaitAsync(e=10){const{gl:i}=this,r=i.fenceSync(lQ.SYNC_GPU_COMMANDS_COMPLETE,0);if(!r)throw new Error("Client wait failed, could not create sync object");let s;this.instanceCounter.increment(pn.Sync,r),i.flush();do await KS(e),s=i.clientWaitSync(r,0,0);while(s===TB.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(pn.Sync,r),i.deleteSync(r),s===TB.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=al.FRAMEBUFFER){return e===al.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Rt.ARRAY_BUFFER),this.unbindBuffer(Rt.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(Rt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Rt.PIXEL_PACK_BUFFER),this.unbindBuffer(Rt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Rt.COPY_READ_BUFFER),this.unbindBuffer(Rt.COPY_WRITE_BUFFER);for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(Be.ONE,Be.ZERO),this.setBlendEquation($_.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(qf.BACK),this.setFrontFace(kP.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(xr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(xr.ALWAYS,0,0),this.setStencilOp(Cs.KEEP,Cs.KEEP,Cs.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setDrawBuffers([ho.BACK]),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var r,s,n;const{gl:e}=this;e.bindVertexArray(null);for(let o=0;o<this.parameters.maxVertexAttributes;o++)e.disableVertexAttribArray(o);this._state.vertexBuffer?e.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):e.bindBuffer(Rt.ARRAY_BUFFER,null),this._state.indexBuffer?e.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):e.bindBuffer(Rt.ELEMENT_ARRAY_BUFFER,null),this._state.uniformBuffer?e.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):e.bindBuffer(Rt.UNIFORM_BUFFER,null);for(let o=0;o<this._parameters.maxUniformBufferBindings;o++){const a=this._state.uniformBufferBindingPoints[o];if(a!=null){const{buffer:l,offset:c,size:u}=a;l!==null?c===0&&u===0?e.bindBufferBase(Rt.UNIFORM_BUFFER,o,l.glName):e.bindBufferRange(Rt.UNIFORM_BUFFER,o,l.glName,c,u):e.bindBufferBase(Rt.UNIFORM_BUFFER,o,null)}}if(this._state.pixelPackBuffer?e.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):e.bindBuffer(Rt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?e.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):e.bindBuffer(Rt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?e.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):e.bindBuffer(Rt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?e.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):e.bindBuffer(Rt.COPY_WRITE_BUFFER,null),e.bindFramebuffer(al.READ_FRAMEBUFFER,null),e.readBuffer(e.BACK),this._state.readFramebuffer&&(e.bindFramebuffer(al.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),e.readBuffer(Xn.COLOR_ATTACHMENT0)),e.bindFramebuffer(al.DRAW_FRAMEBUFFER,((r=this._state.drawFramebuffer)==null?void 0:r.glName)??null),this._state.drawFramebuffer===null){const o=this._state.drawBuffers.defaultFramebuffer;e.drawBuffers(o??[ho.BACK])}else{const o=this._state.drawBuffers.fbos.get(this._state.drawFramebuffer);e.drawBuffers(o??[Xn.COLOR_ATTACHMENT0])}if(this._state.vertexArrayObject){const o=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(o)}e.useProgram(((s=this._state.program)==null?void 0:s.glName)??null),e.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),e.bindRenderbuffer(e.RENDERBUFFER,((n=this._state.renderbuffer)==null?void 0:n.glName)??null),this._state.blend===!0?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),e.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),e.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),e.clearDepth(this._state.clearDepth),e.clearStencil(this._state.clearStencil),e.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),e.cullFace(this._state.cullFace),e.depthFunc(this._state.depthFunction),e.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._state.depthWrite),e.frontFace(this._state.frontFace),e.lineWidth(1),this._state.faceCulling===!0?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),e.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._state.stencilWriteMask);for(let o=0;o<this.parameters.maxTextureImageUnits;o++){e.activeTexture(fq+o),e.bindTexture(js.TEXTURE_2D,null),e.bindTexture(js.TEXTURE_CUBE_MAP,null),e.bindTexture(js.TEXTURE_3D,null),e.bindTexture(js.TEXTURE_2D_ARRAY,null);const a=this._state.textureUnitMap[o];a!=null&&e.bindTexture(a.descriptor.target,a.glName)}e.activeTexture(fq+this._state.activeTexture);const i=this._state.viewport;e.viewport(i.x,i.y,i.width,i.height),this.resetInfo()}_loadExtensions(){this.gl.getExtension("KHR_parallel_shader_compile")}};function wc(t,e,i,r){return e?r!==e&&t.bindBuffer(i,e.glName):t.bindBuffer(i,null),e}function Ebe(t,e){switch(t){case Mi.POINTS:return 2*e;case Mi.TRIANGLES:return e/3;case Mi.TRIANGLE_STRIP:case Mi.TRIANGLE_FAN:return e-2;default:return 0}}let jkt=class extends Bkt{constructor(e,i,r){super(e,i),this.gl=e,this.newCache=r,this._appleAmdDriverHelper=null,this._refCount=1,this.screen=new tkt(this)}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){var e;super.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose(),this.screen.destroy()}bindTechnique(e,i,r,s,n){return this.useProgram(e.program),this.setPipelineState(e.getPipeline(!!n)),e.program.bindPass(r,i),s&&e.program.bindDraw(s,i,r),e.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??(this._appleAmdDriverHelper=new kze(this)),this._appleAmdDriverHelper.run())}get test(){}};function Cbe(t){return!!t.frameUpdate}let lM=class extends Ue{constructor(e,i,r){super({}),this._stage=e,this._techniques=i,this._rctx=r,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Ls,this._frameTask=e.view.resourceController.scheduler.registerTask(It.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(Gs.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniques.acquire(Oae,new $ae)),this._textureTechnique}acquire(e){const i=this._textures.get(e);return i?(i.ref(),i.loadingPromise??i):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(i=>{const r=i.texture.frameUpdate(i.previousToken);r>=0&&r!==i.previousToken&&(i.previousToken=r,e=!0)}),e&&this.events.emit("changed",cr.BACKGROUND)}_createNewRef(e){const i=this._stage.getObject(e);if(i==null)return bt(i!==void 0),null;const r=i.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(e)}),s=new Gkt(e,()=>{this._frameTask.schedule(()=>{s.isUnreferenced&&i.unload()})});return this._textures.set(e,s),s.ref(),i.glTexture?(this._updateGLTexture(s,i.glTexture),Cbe(i)&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),s):(this._loadingCount++,s.loadingPromise=this._stage.schedule(()=>{const n=i.load(this._rctx),o=l=>(this._loadingCount--,s.loadingPromise=null,this._updateGLTexture(s,l),Cbe(i)&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),s),a=l=>(this._loadingCount--,s.loadingPromise=null,us(l)||ne.getLogger(this).error(l),null);return Zu(n)?n.then(o,a):o(n)}),s.loadingPromise)}_updateGLTexture(e,i){e.glTexture=i,this.events.emit("changed",cr.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};h([p()],lM.prototype,"_loadingCount",void 0),h([p()],lM.prototype,"_frameTask",void 0),h([p()],lM.prototype,"updating",null),lM=h([I("esri.views.3d.webgl-engine.lib.TextureRepository")],lM);let Gkt=class{constructor(e,i){this.id=e,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(ne.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function Hkt(t,e){return new AFe(i=>Ext(i,t),i=>i,e)}let KI=class extends Ue{constructor(){super(...arguments),this._passParameters=new qkt,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=oc(this._resourcesTask),this._passParameters.waveNormal=Ut(this._passParameters.waveNormal),this._passParameters.wavePerturbation=Ut(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=My(async i=>{await Promise.allSettled([this._loadImageResource(e,tr("esri/images/materials/water/normals.jpg"),r=>this._passParameters.waveNormal=r,i),this._loadImageResource(e,tr("esri/images/materials/water/perturbation.jpg"),r=>this._passParameters.wavePerturbation=r,i)])})),this._resourcesTask.finished?ew.LOADED:ew.LOADING}async _loadImageResource(e,i,r,s){try{const n=await D_(i,{signal:s});Dt(s);const o=new es(n.width,n.height);o.pixelFormat=Ht.RGB,o.samplingMode=di.LINEAR_MIPMAP_LINEAR,o.hasMipmap=!0,o.maxAnisotropy=8,r(new Mr(e,o,n))}catch(n){ne.getLogger(this).error("Failed to load water material normal texture.",n)}}};h([p()],KI.prototype,"_resourcesTask",void 0),h([p({type:Boolean,readOnly:!0})],KI.prototype,"updating",null),KI=h([I("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],KI);let qkt=class extends Ur{};const Mbe=2048,Wkt=1.5,Zkt=8;function Ykt(t,e){const{format:i,quality:r,rotation:s,disableDecorations:n}=t||{},o=Hle(t,e.padding),a=iUt(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=tUt(t,a),u=nUt(i),d=uUt[u];return{format:u,quality:Ne(r??d,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!!(t!=null&&t.ignoreBackground),ignorePadding:!!(t!=null&&t.ignorePadding)}}function Xkt(t,e){const i=Ykt(t,e),r=i.area,s=i.width/r.width,n=Hle(i,e.padding),o=n.left+n.right,a=n.top+n.bottom,l=e.width-o,c=e.height-a,u=Math.floor(l*s+o),d=Math.floor(c*s+a),f=(t==null?void 0:t.layers)??[],m=i.ignoreBackground,g=i.ignorePadding;return{framebufferWidth:u,framebufferHeight:d,region:{x:Math.floor(r.x*s)+n.left,y:Math.floor(r.y*s)+n.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:f,disableDecorations:i.disableDecorations,ignoreBackground:m,ignorePadding:g,objectAndLayerIdColor:!1}}function dW(t,e,i){const{ctx:r,canvas:s}=Gze(t,i),n=r.getImageData(0,0,t.width,t.height),o=Qkt(s,e);return Hze(s),{dataUrl:o,data:n}}function pW(t,e){const{ctx:i,canvas:r}=Gze(t,e),s=i.getImageData(0,0,t.width,t.height);return Hze(r),s}function Gze(t,e){const i=Jkt();e.premultipliedAlpha&&aUt(t),i.width=t.width,i.height=t.height;const r=i.getContext("2d",{willReadFrequently:!0});return r.putImageData(t,0,0),e.flipY&&oUt(r),{ctx:r,canvas:i}}function Hze(t){t.width=0,t.height=0}function Jkt(){return fW==null&&(fW=document.createElement("canvas")),fW}let fW=null;function Qkt(t,e){const i=lUt[e.format],r=e.quality/100;return t.toDataURL(i,r)}function Kkt(t,e,i,r=0,s=0,n=t.width-r,o=t.height-s,a=!1){const{data:l}=t,{width:c,height:u,data:d}=e,f=n/c,m=o/u,g=Math.ceil(f/2),y=Math.ceil(m/2),v=t.width;for(let b=0;b<u;b++)for(let w=0;w<c;w++){const x=4*(w+(a?u-b-1:b)*c);let T=0,E=0,M=0,O=0,D=0,U=0;const k=(b+.5)*m;for(let H=Math.floor(b*m);H<(b+1)*m;H++){const V=Math.abs(k-(H+.5))/y,X=(w+.5)*f,q=V*V;for(let Z=Math.floor(w*f);Z<(w+1)*f;Z++){const ye=Math.abs(X-(Z+.5))/g,L=Math.sqrt(q+ye*ye);if(L>=1)continue;let N=2*L*L*L-3*L*L+1;const z=4*(r+Z+(s+H)*v);U+=N*l[z+3],E+=N,M+=N*l[z],O+=N*l[z+1],D+=N*l[z+2],T+=N}}d[x]=M/T,d[x+1]=O/T,d[x+2]=D/T,d[x+3]=U/E}return e}function eUt(t,e,i){if(!e)return t;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:o}=t,a=Hle(t,i),l=a.left+a.right,c=a.top+a.bottom,u=r-l,d=s-c,f=Math.min(Zkt,Math.min((Mbe-l)/u,(Mbe-c)/d));return f<Wkt?t:{...t,framebufferWidth:Math.round(u*f)+l,framebufferHeight:Math.round(d*f)+c,pixelRatio:n*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:r,height:s}}}function tUt(t,e){if(!t)return e;const i=t.width,r=t.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return e;const s=e.width/e.height;return r==null?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}function iUt(t,e){const i={x:0,y:0,width:e.width,height:e.height};if(t!=null&&t.area){t.area.x!=null&&(i.x=Math.floor(t.area.x)),t.area.y!=null&&(i.y=Math.floor(t.area.y));const r=t.area.width!=null?Math.floor(t.area.width):null,s=t.area.height!=null?Math.floor(t.area.height):null;if(i.width=e.width-i.x,i.height=e.height-i.y,r!=null&&s!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,s);else if(r==null&&s!=null){const n=Math.min(i.width,r);i.height=n/i.width*i.height,i.width=n}else if(r!=null&&s==null){const n=Math.min(i.height,s);i.width=n/i.height*i.width,i.height=n}}return rUt(sUt(i,t),e)}function rUt(t,e){const i=Math.floor(Math.max(t.x,0)),r=Math.floor(Math.max(t.y,0)),s={x:i,y:r,width:Math.floor(Math.min(t.width,e.width-i)),height:Math.floor(Math.min(t.height,e.height-r))},n=s.width/s.height,o=t.width/t.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),u=s.height-c;return{x:s.x,y:Math.floor(s.y+u/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function sUt(t,e){if((e==null?void 0:e.width)==null||e.height==null)return t;const i=e.width/e.height,r=t.width/t.height;if(r===i)return t;if(r<i){const n=Math.floor(t.height*i);return t.x-=(n-t.width)/2,t.width=n,t}const s=Math.floor(t.width/i);return t.y-=(s-t.height)/2,t.height=s,t}function Hle(t,e){return!e||t!=null&&t.ignorePadding?hUt:e}function nUt(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return cUt}}function oUt(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function aUt(t){const e=t.data,i=e.length;for(let r=0;r<i;r+=4){const s=e[r+3];if(s!==255&&s>0){const n=255/s;e[r]=e[r]*n,e[r+1]=e[r+1]*n,e[r+2]=e[r+2]*n}}}const lUt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Abe=98,cUt="png",uUt={png:100,jpg:Abe,jpeg:Abe},hUt={top:0,right:0,bottom:0,left:0};let dUt=class{constructor(e,i,r){this.parameters=e,this.frameHasDecorations=i,this.fbos=r}},pUt=class{constructor(e,i,r){this._rctx=e,this._renderFunctions=i,this._forceCameraHook=r,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(cr.BACKGROUND);const i=ma();return this._screenshotQueue.push({settings:e,resolver:i}),i.promise}update(e,i){for(const r of this._screenshotQueue){if(this._rctx==null){r.resolver.reject();continue}const s={...r.settings,pixelRatio:r.settings.pixelRatio*e.parameters.camera.pixelRatio},n=this._renderScreenshot(e,s,i);r.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,i,r){e.width=i.width,e.height=i.height;const s=e.getContext("2d"),n=r.pixelRatio;return s.save(),s.translate(0,i.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(n,n),i=this._renderFunctions.renderOverlay(e,r.disableDecorations?rc.OFF:rc.ON,i),s.restore(),i}_readbackScreenshot(e,i){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},i):this._readbackScreenshotImmediate(e,i)}_readbackScreenshotResampled(e,i){const{framebufferWidth:r,framebufferHeight:s,region:n,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=t7(r,s,a);this._rctx.gl.readPixels(0,0,r,s,Ht.RGBA,Et.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=t7(n.width,n.height,a);return Kkt(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,i){const{framebufferHeight:r,region:s}=e,n=this._ensureScreenshotEncodeCanvas(),o=t7(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,Ht.RGBA,Et.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(n,o,e)}_renderScreenshot(e,i,r){const s=e.parameters.camera,n={width:i.framebufferWidth,height:i.framebufferHeight};cS(n,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let o=!1;const a=i.disableDecorations&&e.frameHasDecorations,l=n.width!==s.fullWidth||n.height!==s.fullHeight,c=i.ignorePadding&&s.pixelRatio!==i.pixelRatio,u=l||a||c||i.objectAndLayerIdColor;let d=null,f=null;if(u){const v=s.clone();if(i.ignorePadding){const E=QD(v.padding);for(let M=0;M<4;M++)E[M]=Math.round(E[M]/v.pixelRatio*i.pixelRatio);v.padding=E}v.fullWidth=n.width,v.fullHeight=n.height,v.pixelRatio=i.pixelRatio;const b=s.fovX-v.fovX,w=s.fovY-v.fovY;b<0&&b<w?v.fovX=s.fovX:w<0&&w<b&&(v.fovY=s.fovY);const x={camera:v,contentCamera:v,mode:Ii.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio};this._forceCameraHook(x),o=!0;const T=this._renderFunctions.renderScene(x,r,i.objectAndLayerIdColor?Of.ObjectAndLayerID:Of.Screenshot,i.disableDecorations?rc.OFF:rc.ON);f=T.screen,d=T.oid}const m=()=>{this._rctx.bindFramebuffer(null),f==null||f.release()};this._rctx.bindFramebuffer(f==null?void 0:f.fbo);const g=this._readbackScreenshot(i,m);let y=null;if(i.objectAndLayerIdColor){const v=()=>{this._rctx.bindFramebuffer(null),d==null||d.release()};this._rctx.bindFramebuffer(d==null?void 0:d.fbo),y=this._readbackScreenshot(i,v),this._rctx.bindFramebuffer(null)}if(u&&!this._rctx.contextAttributes.alpha)for(let v=3;v<g.data.length;v+=4)g.data[v]=255;if(y&&!this._rctx.contextAttributes.alpha)for(let v=3;v<y.data.length;v+=4)y.data[v]=255;return o&&this._forceCameraHook(e.parameters),[g,y]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}};function tte(t,e={}){return t.getContext("webgl2",e)||null}let Ea=class extends Ue{constructor(e){super({}),this.events=new Ls,this.waterTextures=new KI,this.objectAndLayerIdRenderHelper=ue("enable-feature:objectAndLayerId-rendering")?new m5t:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode;try{this._initializeContext(e)}catch(s){return void console.error("Failed to initialize context",s)}const{memoryController:i}=e.view.resourceController;this.stippleTextures=Lwt(this._rctx,i),this.markerTextures=Hkt(this._rctx,i),this._techniques=new wFe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextures:this.stippleTextures,waterTextures:this.waterTextures,markerTextures:this.markerTextures}),this._textures=new lM(e,this._techniques,this._rctx),this.addHandles(this._textures.events.on("changed",s=>this.requestRender(s))),this._materials=new xFe(this._textures,this._techniques,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new K4t(this._rctx,this._techniques),this.renderer=new AV(e,this._materials,this._techniques,this._rctx,this._compositingHelper,s=>this.requestRender(s)),this.addHandles([te(()=>e.view.ready,s=>{s&&this._createRenderNodes(e.view,e.viewingMode)},pt),te(()=>{var s;return(s=this.waterTextures)==null?void 0:s.updating},()=>this.requestRender(),pt),te(()=>e.view.qualityProfile,s=>{var n;return(n=this.renderer)==null?void 0:n.updateRenderFeatures(s)},pr)]);const r={renderScene:(s,n,o,a)=>this.renderer.render(s,n,o,a),requestRenderScene:s=>this.requestRender(s),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(s,n,o)=>e.options.screenshot.renderOverlay(s,n,o)};this._screenshotManager=new pUt(this._rctx,r,s=>this.events.emit("force-camera-for-screenshot",s)),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Lr(this._frameTask),this._techniques=He(this._techniques),this._componentObjects=He(this._componentObjects),this._screenshotManager=He(this._screenshotManager),He(this.renderer),this._textures=He(this._textures),He(this.waterTextures),He(this.markerTextures),He(this.stippleTextures),this._canvas=null,this._container=null,this._rctx=He(this._rctx)}_createRenderNodes(e,i){new cT({view:e,isEnabled:()=>this.renderer.hasSSAO,techniques:this._techniques}),new v1({view:e,isEnabled:()=>this.renderer.hasSMAA,techniques:this._techniques}),new _1({view:e,techniques:this._techniques}),new aM({view:e,techniques:this._techniques}),new vT({view:e,viewingMode:i,techniques:this._techniques})}requestRender(e=cr.UPDATE){this._needsRender=!0,e===cr.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textures.updating||this.waterTextures.updating}get textures(){return this._textures}get compositingHelper(){return this._compositingHelper}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(i=>i[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,i,r,s,n,o=n){const a=s.constrainWindowSize(i,r,n*s.pixelRatio,o*s.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(a,l);let c=Number.MAX_VALUE;for(let u=0;u<a[2]*a[3];u++){const d=s5t(4*u,l,s.nearFar);c>d&&d!==s.nearFar[0]&&d!==s.nearFar[1]&&(c=d)}if(e){const u=e.pickDepth(i*s.pixelRatio,r*s.pixelRatio,s);u!=null&&c>u&&u!==s.nearFar[0]&&u!==s.nearFar[1]&&(c=u)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const i=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<i)&&(this._tmpDepthBuffer=new Uint8Array(i)),this._tmpDepthBuffer}async reloadShaders(){zUe(),await this._techniques.reloadAll(),this.requestRender()}_registerFrameTask(e){const i=e.view.state;let r=!1,s=cr.BACKGROUND,n=!1;const o={preRender:({time:a})=>{r=this.updating,s=this._needsUpdate?cr.UPDATE:cr.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||i.forcedAnimationTime!=null||r||this._needsRender){const c=l/this.renderer.animationTimeDilation,u=new QLe(i.camera,c,i.forcedAnimationTime);this.renderer.updateAnimation(u)&&this.requestRender(cr.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&i.camera.fullWidth>0&&i.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(i,a),n=!0,l&&this.renderer.hasReflections&&(this.requestRender(cr.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=this.renderer.hasSlicePlane||this.renderer.hasDecorations||this.renderer.hasHighlights,c=new dUt(i,l,this.renderer.fboCache);this._textures.update(),this._screenshotManager.update(c,a)},finish:()=>{n&&(this.renderer.finish(i.mode===Ii.IDLE?s:cr.UPDATE),n=!1)}};this._frameTask=t2(o)}_initializeContext(e){const i=e.options;this._canvas=i.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:i.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:i.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:i.preserveDrawingBuffer??!1},s=tte(this._canvas,r);s!=null?(this._rctx=fUt(s,e),this._loadShaderOnlyExtensions(),!i.alpha&&this._rctx.contextAttributes.alpha&&ne.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&ue("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):ne.getLogger(this).error("A WebGL2 context could not be created.")}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloatLinear")}getObjectAndLayerIdColor(e){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return this._componentObjects==null&&(this._componentObjects=new C4t(this.renderer.renderPassManager,this._viewingMode)),this._componentObjects}set componentObjectCollection(e){this._componentObjects=e}};function fUt(t,e){const i={disabledExtensions:e.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:e.options.debugWebGLExtensions||{},maxAnisotropy:8},r=(s,n)=>e.view.resourceController.memoryController.newCache(s,n);return new jkt(t,i,r)}h([p({type:Boolean,readOnly:!0})],Ea.prototype,"updating",null),h([p()],Ea.prototype,"_rctx",void 0),h([p()],Ea.prototype,"_container",void 0),h([p()],Ea.prototype,"_canvas",void 0),h([p()],Ea.prototype,"stippleTextures",void 0),h([p()],Ea.prototype,"markerTextures",void 0),h([p()],Ea.prototype,"waterTextures",void 0),h([p({readOnly:!0})],Ea.prototype,"objectAndLayerIdRenderHelper",void 0),h([p()],Ea.prototype,"_textures",void 0),h([p({readOnly:!0})],Ea.prototype,"renderer",void 0),h([p()],Ea.prototype,"_screenshotManager",void 0),h([p()],Ea.prototype,"componentObjectCollection",null),h([p()],Ea.prototype,"_componentObjects",void 0),h([p()],Ea.prototype,"_needsUpdate",void 0),h([p()],Ea.prototype,"_needsWaterReflectionUpdate",void 0),Ea=h([I("esri.views.3d.webgl-engine.parts.RenderView")],Ea);let mh=class extends Ue{constructor(e){super(e),this._model=new vV,this._layers=new ai,this._asyncChangeSet=new fQ,this._syncChangeSet=new fQ,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Ea(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(It.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.renderView.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),lj(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e!=null&&!this.destroyed&&this._model.remove(e)&&(lj(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){var i,r;e!=null&&((i=this._model)==null||i.removeMany(e),(r=this.renderView)==null||r.requestRender())}forEachOfType(e,i){this._model.forEachOfType(e,i)}handleEvent(e,i){this.destroyed||(this._model.dirtySet[e](i),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){if(this._frameTask.processQueue(e),this._commit(e),!e.hasProgressed)return pa}_commit(e){const i=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{if(e.done)return;const s=this._layerSyncSet.has(r.id)||r.updatePolicy===Ab.SYNC,n=s?this._syncChangeSet:this._asyncChangeSet;i.commitLayer(r.id,n),this._layerSyncSet.delete(r.id),n.empty||(this.renderer.modify(n,s?Nu:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Nu),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{e.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==Ab.ASYNC||(i.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(i=>{this._layerSyncSet.has(i.id)||i.updatePolicy===Ab.SYNC?(e.commitLayer(i.id,this._syncChangeSet),this._layerSyncSet.delete(i.id)):e.commitSyncUpdates(i.id,this._syncChangeSet)});for(const i of this._layerSyncSet)e.commitLayer(i,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Nu),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Nu),this.renderView.requestRender())}schedule(e,i){return this._frameTask.schedule(e,i)}reschedule(e,i){return this._frameTask.reschedule(e,i)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,Nu))}addRenderPlugin(e,i){const r=this.renderer.plugins.add(e,i),s=()=>{Uve(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if(Zu(r))return r.then(s);s()}removeRenderPlugin(e){this.destroyed||(Uve(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.plugins.remove(e))}get performanceInfo(){return this._model.getStats()}get test(){}};mh.DebugSettings={endFrameContentValidation:!1},h([p({constructOnly:!0})],mh.prototype,"view",void 0),h([p({constructOnly:!0})],mh.prototype,"options",void 0),h([p({readOnly:!0})],mh.prototype,"viewingMode",null),h([p({constructOnly:!0})],mh.prototype,"container",void 0),h([p({readOnly:!0})],mh.prototype,"updating",null),h([p({constructOnly:!0})],mh.prototype,"_model",void 0),h([p()],mh.prototype,"renderView",void 0),h([p({readOnly:!0})],mh.prototype,"renderer",null),h([p({readOnly:!0})],mh.prototype,"running",null),mh=h([I("esri.views.3d.webgl-engine.Stage")],mh);function Pbe(t){return t&&typeof t.highlight=="function"}function mUt(t){return t&&typeof t.maskOccludee=="function"}function gUt(t,e,i){return t==null||t>=i&&(e===0||t<=e)}function bpi(t,e){if(e&&t){const{minScale:i,maxScale:r}=t;if(yUt(i,r))return gUt(e,i,r)}return!0}function yUt(t,e){return t!=null&&t>0||e!=null&&e>0}function wpi(t){return!(t!=null&&t.minScale)||!t.maxScale||t.minScale>=t.maxScale}let mW;function _Ut(){return mW||(mW=wUt()),mW}let vUt=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}};function bUt(t){if(typeof WebGL2RenderingContext>"u")return null;const e=document.createElement("canvas");if(!e)return null;let i=tte(e,{failIfMajorPerformanceCaveat:!0});if(i==null&&(i=tte(e),i!=null&&(t.majorPerformanceCaveat=!0)),i==null)return i;t.available=!0,t.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const r=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return r&&(t.supportsHighPrecisionFragment=r.precision>0),i}function wUt(){const t=new vUt,e=bUt(t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function xUt(t){const e=_Ut();return e.available?t==="3d"&&e.majorPerformanceCaveat?new B("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):e.supportsHighPrecisionFragment?e.supportsVertexShaderSamplers?null:new B("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new B("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new B("webgl:required","WebGL2 is required but not supported.",new Error().stack)}function TUt(t){return t&&"nodeType"in t}function SUt(t){return t&&typeof t.render=="function"}const Obe={component:"esri-component"};let wT=class extends Ue{constructor(){super(...arguments),this.widget=null}destroy(){var e;this.node=null,(e=this.widget)==null||e.destroy()}get id(){var e,i;return this._get("id")??((e=this.widget)==null?void 0:e.id)??((i=this.node)==null?void 0:i.id)}set id(e){this._set("id",e)}set node(e){const i=this._get("node");e!==i&&(e&&e.classList.add(Obe.component),i&&i.classList.remove(Obe.component),this._set("node",e))}castNode(e){var i;return(i=this.widget)==null||i.destroy(),e?typeof e=="string"||TUt(e)?(this._set("widget",null),WG(e)):(SUt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};h([p()],wT.prototype,"id",null),h([p()],wT.prototype,"node",null),h([Qt("node")],wT.prototype,"castNode",null),h([p({readOnly:!0})],wT.prototype,"widget",void 0),wT=h([I("esri.views.ui.Component")],wT);const PV=wT,qze="calcite-mode-";function EUt(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function Wze(){return EUt().startsWith("dark")}function CUt(){return`${qze}${Wze()?"dark":"light"}`}function MUt(t){AUt(t),t.classList.add(CUt())}function AUt(t){Array.from(t.classList).forEach(e=>{e.startsWith(qze)&&t.classList.remove(e)})}const PUt={left:0,top:0,bottom:0,right:0},Zze={bottom:30,top:15,right:15,left:15},h0="esri-ui",cu={ui:h0,corner:`${h0}-corner`,innerContainer:`${h0}-inner-container`,manualContainer:`${h0}-manual-container`,cornerContainer:`${h0}-corner-container`,topLeft:`${h0}-top-left`,topRight:`${h0}-top-right`,bottomLeft:`${h0}-bottom-left`,bottomRight:`${h0}-bottom-right`};function OUt(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function J5(t){return t===0?"0":`${t}px`}function gW(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function yW(t,{top:e,bottom:i,left:r,right:s}){t.style.top=e,t.style.bottom=i,t.style.left=r,t.style.right=s}let pg=class extends Ls.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._removeWidgetHandleKey=Symbol("componentOnRemoveSymbol"),this._locale=zu(),this.view=null,this._applyViewPadding=()=>{const i=this.container;i&&yW(i,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const i=this._innerContainer;i&&yW(i,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([te(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,pt),te(()=>this.padding,this._applyUIPadding,pt),te(()=>[this.container,this._locale],([e,i])=>{e&&e.setAttribute("lang",i)},pt),vSe(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const i=this._get("container");e!==i&&(e&&(e.classList.add(cu.ui),MUt(e),this._attachContainers(e)),i&&(i.classList.remove(cu.ui),yW(i,{top:"",bottom:"",left:"",right:""}),DAe(i)),this._set("container",e))}get height(){var n;const e=((n=this.view)==null?void 0:n.height)??0;if(e===0)return e;const i=this._getViewPadding(),{top:r,bottom:s}=i;return Math.max(e-r-s,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...Zze,...e}}get width(){var n;const e=((n=this.view)==null?void 0:n.width)??0;if(e===0)return e;const i=this._getViewPadding(),{left:r,right:s}=i;return Math.max(e-r-s,0)}add(e,i){let r,s,n;if(Array.isArray(e))return void e.forEach(a=>this.add(a,i));const o=gW(e);o&&({index:r,position:i,component:e,key:s}=o),i&&typeof i=="object"&&({index:r,key:s,position:i,internal:n}=i),!e||i&&!this._isValidPosition(i)||this._add(e,i,r,s,n)}remove(e,i){var s,n;if(!e)return;if(Array.isArray(e))return e.map(o=>this.remove(o,i));const r=this._find(e);if(r){if(this._componentMap.has(r)&&((s=this._componentMap.get(r))==null?void 0:s.key)!==i)return;const o=this._components.indexOf(r),a=r.node.parentNode;return a==null||a.removeChild(r.node),this._componentMap.delete(r),(n=r.widget)==null||n.removeHandlesReference(this._removeWidgetHandleKey),this._components.splice(o,1)[0]}}empty(e,i={removeInternal:!1}){if(Array.isArray(e)){for(const n of e)this.empty(n,i);return}const r=this._positionNameToContainerLookup[e??"manual"],s=Array.prototype.slice.call(r.children).map(n=>this._findByNode(n)).filter(n=>{var o;return n==null?!1:!(((o=this._componentMap.get(n))==null?void 0:o.internal)??!1)||i.removeInternal});for(const n of s)this.remove(n)}move(e,i){if(Array.isArray(e)&&e.forEach(o=>this.move(o,i)),!e)return;let r;const s=gW(e)||gW(i);if(s&&(r=s.index,i=s.position,e=s.component||e),i&&!this._isValidPosition(i))return;const n=this.remove(e);n&&this.add(n,{position:i,index:r})}find(e){if(!e)return null;const i=this._findById(e);return i&&(i.widget||i.node)}getComponents(e,i={includeInternal:!1}){return e?Array.isArray(e)?e.flatMap(r=>this._getComponentsAtPosition(r,i)):this._getComponentsAtPosition(e,i):this._components.filter(r=>{var s;return i.includeInternal||!((s=this._componentMap.get(r))!=null&&s.internal)}).map(({widget:r,node:s})=>r??s)}getPosition(e){for(const i in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[i].contains(e))return i;return null}_add(e,i,r,s,n){e instanceof PV||(e=new PV({node:e}));const{widget:o}=e;o!=null&&o instanceof Ue&&o.addHandles(Gi(()=>{queueMicrotask(()=>this.remove(e))}),this._removeWidgetHandleKey),this._place({component:e,position:i,index:r}),this._components.push(e),this._componentMap.set(e,{key:s,internal:n})}_find(e){return e?e instanceof PV?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){var e;return((e=this.view)==null?void 0:e.padding)??PUt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(cu.innerContainer,cu.cornerContainer);const i=document.createElement("div");i.classList.add(cu.innerContainer,cu.manualContainer);const r=document.createElement("div");r.classList.add(cu.topLeft,cu.corner),e.appendChild(r);const s=document.createElement("div");s.classList.add(cu.topRight,cu.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(cu.bottomLeft,cu.corner),e.appendChild(n);const o=document.createElement("div");o.classList.add(cu.bottomRight,cu.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=i;const a=Zb();this._cornerNameToContainerLookup={"top-left":r,"top-right":s,"bottom-left":n,"bottom-right":o,"top-leading":a?s:r,"top-trailing":a?r:s,"bottom-leading":a?o:n,"bottom-trailing":a?n:o},this._positionNameToContainerLookup={manual:i,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const i=e.position??"manual",{component:r,index:s}=e,n=this._positionNameToContainerLookup[i],o=s!=null&&s>-1;if(OUt(r.widget)&&r.widget.startup(),!o)return void n.appendChild(r.node);const a=Array.from(n.children);if(s===0)return void(n.firstChild?kde(r.node,n.firstChild):n.appendChild(r.node));s>=a.length?n.appendChild(r.node):kde(r.node,a[s])}_toPixelPosition(e){return{top:J5(e.top),left:J5(e.left),right:J5(e.right),bottom:J5(e.bottom)}}_findByComponent(e){return this._components.find(i=>i===e)??null}_findById(e){return this._components.find(({id:i})=>i===e)??null}_findByNode(e){return this._components.find(({node:i})=>i===e)??null}_getComponentsAtPosition(e,i){const r=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(r.children).map(s=>this._findByNode(s)).filter(sd).filter(s=>{var n;return i.includeInternal||!((n=this._componentMap.get(s))!=null&&n.internal)}).map(({widget:s,node:n})=>s??n)}};h([p()],pg.prototype,"_locale",void 0),h([p()],pg.prototype,"container",null),h([p()],pg.prototype,"height",null),h([p({value:Zze})],pg.prototype,"padding",null),h([Qt("padding")],pg.prototype,"castPadding",null),h([p()],pg.prototype,"view",void 0),h([p()],pg.prototype,"width",null),pg=h([I("esri.views.ui.UI")],pg);const $Ut=pg,RUt={handleInterceptedEvent:(t,e,i,r)=>(t.scheduleRender(),e.properties[`on${r.type}`].apply(e.properties.bind||i,[r]))},IUt={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}},LUt=t=>({...IUt,...t}),DUt=(t,e)=>{const i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i},NUt=(t,e)=>t.find(e),$be=(t,e,i=!1)=>{let r=t;return e.forEach((s,n)=>{const o=r!=null&&r.children?NUt(r.children,a=>a.domNode===s):void 0;i&&!o&&n!==e.length-1||(r=o)}),r},FUt=t=>{let e;const i={...RUt,...t},r=LUt(i),s=r.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],u=(f,m,g)=>{var b;let y;r.eventHandlerInterceptor=(w,x,T,E)=>function(M){let O;s("domEvent",M);const D=DUt(M.currentTarget,y.domNode),U=D.some(H=>{var V;return customElements.get((V=H==null?void 0:H.tagName)==null?void 0:V.toLowerCase())});if(M.eventPhase===Event.CAPTURING_PHASE||!U)D.reverse(),O=$be(y.getLastRender(),D);else{const H=M.composedPath(),V=H.slice(H.indexOf(M.currentTarget),H.indexOf(y.domNode)).reverse();O=$be(y.getLastRender(),V,!0)}let k;return O&&(k=i.handleInterceptedEvent(e,O,this,M)),s("domEventProcessed",M),k},(b=i.postProcessProjectionOptions)==null||b.call(i,r);const v=g();y=f(m,v,r),r.eventHandlerInterceptor=void 0,l.push(y),c.push(g),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(y,v)};let d=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();s("rendered",void 0),l[f].update(m),s("patched",void 0)}s("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(d=i.modifyDoRenderImplementation(d,l,c)),e={renderNow:d,scheduleRender:()=>{n||a||(n=requestAnimationFrame(d))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(f,m)=>{u(ab.append,f,m)},insertBefore:(f,m)=>{u(ab.insertBefore,f,m)},merge:(f,m)=>{u(ab.merge,f,m)},replace:(f,m)=>{u(ab.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},e};/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
 * v2.11.1
 */const Yze="calcite-mode-auto",Xze="calcite-mode-dark",kUt="calcite-mode-light",Epi={autoMode:Yze,darkMode:Xze,lightMode:kUt,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"},Cpi={filter:250,nextTick:0,resize:150,reposition:100};/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
 * v2.11.1
 */const T_=globalThis.calciteConfig,Mpi=(T_==null?void 0:T_.focusTrapStack)||[],Api=(T_==null?void 0:T_.logLevel)||"info",Rbe="2.11.1",UUt="2024-08-02",VUt="dff26357be7ecaa7cefeb1bc2522fd54177aea87";function zUt(){if(T_&&T_.version)return;console.info(`Using Calcite Components ${Rbe} [Date: ${UUt}, Revision: ${VUt}]`);const t=T_||globalThis.calciteConfig||{};Object.defineProperty(t,"version",{value:Rbe,writable:!1}),globalThis.calciteConfig=t}var Bg={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,formAssociated:!1,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0,experimentalSlotFixes:!1},BUt=Object.defineProperty,jUt=(t,e)=>{for(var i in e)BUt(t,i,{get:e[i],enumerable:!0})},Jze=new WeakMap,cE=t=>Jze.get(t),GUt=(t,e)=>{const i={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return Jze.set(t,i)},Ibe=(t,e)=>e in t,VN=(t,e)=>(0,console.error)(t,e),Nj=new Map,HUt=[],qUt="slot-fb{display:contents}slot-fb[hidden]{display:none}",Lbe="http://www.w3.org/1999/xlink",zN=typeof window<"u"?window:{},rm=zN.document||{head:{}},Ppi=zN.HTMLElement||class{},Ha={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,i,r)=>t.addEventListener(e,i,r),rel:(t,e,i,r)=>t.removeEventListener(e,i,r),ce:(t,e)=>new CustomEvent(t,e)},WUt=(()=>{let t=!1;try{rm.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),ZUt=t=>Promise.resolve(t),YUt=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),ite=!1,rte=[],Qze=[],Kze=(t,e)=>i=>{t.push(i),ite||(ite=!0,e&&Ha.$flags$&4?XUt(ste):Ha.raf(ste))},Dbe=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(i){VN(i)}t.length=0},ste=()=>{Dbe(rte),Dbe(Qze),(ite=rte.length>0)&&Ha.raf(ste)},XUt=t=>ZUt().then(t),Opi=Kze(rte,!1),JUt=Kze(Qze,!0),QUt=t=>{const e=new URL(t,Ha.$resourcesUrl$);return e.origin!==zN.location.origin?e.href:e.pathname},KUt=t=>Ha.$resourcesUrl$=t,Nbe={},eVt="http://www.w3.org/2000/svg",tVt="http://www.w3.org/1999/xhtml",iVt=t=>t!=null,qle=t=>(t=typeof t,t==="object"||t==="function");function rVt(t){var e,i,r;return(r=(i=(e=t.head)==null?void 0:e.querySelector('meta[name="csp-nonce"]'))==null?void 0:i.getAttribute("content"))!=null?r:void 0}var sVt={};jUt(sVt,{err:()=>eBe,map:()=>nVt,ok:()=>nte,unwrap:()=>oVt,unwrapErr:()=>aVt});var nte=t=>({isOk:!0,isErr:!1,value:t}),eBe=t=>({isOk:!1,isErr:!0,value:t});function nVt(t,e){if(t.isOk){const i=e(t.value);return i instanceof Promise?i.then(r=>nte(r)):nte(i)}if(t.isErr){const i=t.value;return eBe(i)}throw"should never get here"}var oVt=t=>{if(t.isOk)return t.value;throw t.value},aVt=t=>{if(t.isErr)return t.value;throw t.value},$2=(t,e="")=>()=>{},tBe=(t,e,...i)=>{let r=null,s=null,n=null,o=!1,a=!1;const l=[],c=d=>{for(let f=0;f<d.length;f++)r=d[f],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof t!="function"&&!qle(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?Fj(null,r):r),a=o)};if(c(i),e){e.key&&(s=e.key),e.name&&(n=e.name);{const d=e.className||e.class;d&&(e.class=typeof d!="object"?d:Object.keys(d).filter(f=>d[f]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,uVt);const u=Fj(t,null);return u.$attrs$=e,l.length>0&&(u.$children$=l),u.$key$=s,u.$name$=n,u},Fj=(t,e)=>{const i={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return i.$attrs$=null,i.$key$=null,i.$name$=null,i},lVt={},cVt=t=>t&&t.$tag$===lVt,uVt={forEach:(t,e)=>t.map(Fbe).forEach(e),map:(t,e)=>t.map(Fbe).map(e).map(hVt)},Fbe=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),hVt=t=>{if(typeof t.vtag=="function"){const i={...t.vattrs};return t.vkey&&(i.key=t.vkey),t.vname&&(i.name=t.vname),tBe(t.vtag,i,...t.vchildren||[])}const e=Fj(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},dVt=t=>HUt.map(e=>e(t)).find(e=>!!e),pVt=(t,e)=>t!=null&&!qle(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,fVt=t=>t,$pi=(t,e,i)=>{const r=fVt(t);return{emit:s=>mVt(r,e,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:s})}},mVt=(t,e,i)=>{const r=Ha.ce(e,i);return t.dispatchEvent(r),r},kbe=new WeakMap,gVt=(t,e,i)=>{let r=Nj.get(t);YUt&&i?(r=r||new CSSStyleSheet,typeof r=="string"?r=e:r.replaceSync(e)):r=e,Nj.set(t,r)},yVt=(t,e,i)=>{var r;const s=iBe(e,i),n=Nj.get(s);if(t=t.nodeType===11?t:rm,n)if(typeof n=="string"){t=t.head||t;let o=kbe.get(t),a;if(o||kbe.set(t,o=new Set),!o.has(s)){{a=rm.createElement("style"),a.innerHTML=n;const l=(r=Ha.$nonce$)!=null?r:rVt(rm);l!=null&&a.setAttribute("nonce",l),t.insertBefore(a,t.querySelector("link"))}e.$flags$&4&&(a.innerHTML+=qUt),o&&o.add(s)}}else t.adoptedStyleSheets.includes(n)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,n]);return s},_Vt=t=>{const e=t.$cmpMeta$,i=t.$hostElement$,r=e.$flags$,s=$2("attachStyles",e.$tagName$),n=yVt(i.shadowRoot?i.shadowRoot:i.getRootNode(),e,t.$modeName$);r&10&&(i["s-sc"]=n,i.classList.add(n+"-h"),r&2&&i.classList.add(n+"-s")),s()},iBe=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),Ube=(t,e,i,r,s,n)=>{if(i!==r){let o=Ibe(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=Vbe(i),u=Vbe(r);l.remove(...c.filter(d=>d&&!u.includes(d))),l.add(...u.filter(d=>d&&!c.includes(d)))}else if(e==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?t.style.setProperty(l,r[l]):t.style[l]=r[l])}else if(e!=="key")if(e==="ref")r&&r(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n"){if(e[2]==="-"?e=e.slice(3):Ibe(zN,a)?e=a.slice(2):e=a[2]+e.slice(3),i||r){const l=e.endsWith(rBe);e=e.replace(bVt,""),i&&Ha.rel(t,e,i,l),r&&Ha.ael(t,e,r,l)}}else{const l=qle(r);if((o||l&&r!==null)&&!s)try{if(t.tagName.includes("-"))t[e]=r;else{const u=r??"";e==="list"?o=!1:(i==null||t[e]!=u)&&(t[e]=u)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),r==null||r===!1?(r!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(Lbe,e):t.removeAttribute(e)):(!o||n&4||s)&&!l&&(r=r===!0?"":r,c?t.setAttributeNS(Lbe,e,r):t.setAttribute(e,r))}}},vVt=/\s/,Vbe=t=>t?t.split(vVt):[],rBe="Capture",bVt=new RegExp(rBe+"$"),sBe=(t,e,i)=>{const r=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,s=t&&t.$attrs$||Nbe,n=e.$attrs$||Nbe;for(const o of zbe(Object.keys(s)))o in n||Ube(r,o,s[o],void 0,i,e.$flags$);for(const o of zbe(Object.keys(n)))Ube(r,o,s[o],n[o],i,e.$flags$)};function zbe(t){return t.includes("ref")?[...t.filter(e=>e!=="ref"),"ref"]:t}var cM,ote,oO,kj=!1,Uj=!1,Wle=!1,Ah=!1,Vj=(t,e,i,r)=>{var s;const n=e.$children$[i];let o=0,a,l,c;if(kj||(Wle=!0,n.$tag$==="slot"&&(cM&&r.classList.add(cM+"-s"),n.$flags$|=n.$children$?2:1)),n.$text$!==null)a=n.$elm$=rm.createTextNode(n.$text$);else if(n.$flags$&1)a=n.$elm$=rm.createTextNode("");else{if(Ah||(Ah=n.$tag$==="svg"),a=n.$elm$=rm.createElementNS(Ah?eVt:tVt,!kj&&Bg.slotRelocation&&n.$flags$&2?"slot-fb":n.$tag$),Ah&&n.$tag$==="foreignObject"&&(Ah=!1),sBe(null,n,Ah),iVt(cM)&&a["s-si"]!==cM&&a.classList.add(a["s-si"]=cM),Yle(a,r),n.$children$)for(o=0;o<n.$children$.length;++o)l=Vj(t,n,o,a),l&&a.appendChild(l);n.$tag$==="svg"?Ah=!1:a.tagName==="foreignObject"&&(Ah=!0)}return a["s-hn"]=oO,n.$flags$&3&&(a["s-sr"]=!0,a["s-cr"]=ote,a["s-sn"]=n.$name$||"",a["s-rf"]=(s=n.$attrs$)==null?void 0:s.ref,c=t&&t.$children$&&t.$children$[i],c&&c.$tag$===n.$tag$&&t.$elm$&&CD(t.$elm$,!1)),a},CD=(t,e)=>{Ha.$flags$|=1;const i=Array.from(t.childNodes);if(t["s-sr"]&&Bg.experimentalSlotFixes){let r=t;for(;r=r.nextSibling;)r&&r["s-sn"]===t["s-sn"]&&r["s-sh"]===oO&&i.push(r)}for(let r=i.length-1;r>=0;r--){const s=i[r];s["s-hn"]!==oO&&s["s-ol"]&&($b(aBe(s),s,Zle(s)),s["s-ol"].remove(),s["s-ol"]=void 0,s["s-sh"]=void 0,Wle=!0),e&&CD(s,e)}Ha.$flags$&=-2},nBe=(t,e,i,r,s,n)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===oO&&(o=o.shadowRoot);s<=n;++s)r[s]&&(a=Vj(null,i,s,t),a&&(r[s].$elm$=a,$b(o,a,Zle(e))))},oBe=(t,e,i)=>{for(let r=e;r<=i;++r){const s=t[r];if(s){const n=s.$elm$;uBe(s),n&&(Uj=!0,n["s-ol"]?n["s-ol"].remove():CD(n,!0),n.remove())}}},wVt=(t,e,i,r,s=!1)=>{let n=0,o=0,a=0,l=0,c=e.length-1,u=e[0],d=e[c],f=r.length-1,m=r[0],g=r[f],y,v;for(;n<=c&&o<=f;)if(u==null)u=e[++n];else if(d==null)d=e[--c];else if(m==null)m=r[++o];else if(g==null)g=r[--f];else if(Q5(u,m,s))uM(u,m,s),u=e[++n],m=r[++o];else if(Q5(d,g,s))uM(d,g,s),d=e[--c],g=r[--f];else if(Q5(u,g,s))(u.$tag$==="slot"||g.$tag$==="slot")&&CD(u.$elm$.parentNode,!1),uM(u,g,s),$b(t,u.$elm$,d.$elm$.nextSibling),u=e[++n],g=r[--f];else if(Q5(d,m,s))(u.$tag$==="slot"||g.$tag$==="slot")&&CD(d.$elm$.parentNode,!1),uM(d,m,s),$b(t,d.$elm$,u.$elm$),d=e[--c],m=r[++o];else{for(a=-1,l=n;l<=c;++l)if(e[l]&&e[l].$key$!==null&&e[l].$key$===m.$key$){a=l;break}a>=0?(v=e[a],v.$tag$!==m.$tag$?y=Vj(e&&e[o],i,a,t):(uM(v,m,s),e[a]=void 0,y=v.$elm$),m=r[++o]):(y=Vj(e&&e[o],i,o,t),m=r[++o]),y&&$b(aBe(u.$elm$),y,Zle(u.$elm$))}n>c?nBe(t,r[f+1]==null?null:r[f+1].$elm$,i,r,o,f):o>f&&oBe(e,n,c)},Q5=(t,e,i=!1)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:i?!0:t.$key$===e.$key$:!1,Zle=t=>t&&t["s-ol"]||t,aBe=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,uM=(t,e,i=!1)=>{const r=e.$elm$=t.$elm$,s=t.$children$,n=e.$children$,o=e.$tag$,a=e.$text$;let l;a===null?(Ah=o==="svg"?!0:o==="foreignObject"?!1:Ah,o==="slot"&&!kj||sBe(t,e,Ah),s!==null&&n!==null?wVt(r,s,e,n,i):n!==null?(t.$text$!==null&&(r.textContent=""),nBe(r,null,e,n,0,n.length-1)):s!==null&&oBe(s,0,s.length-1),Ah&&o==="svg"&&(Ah=!1)):(l=r["s-cr"])?l.parentNode.textContent=a:t.$text$!==a&&(r.data=a)},lBe=t=>{const e=t.childNodes;for(const i of e)if(i.nodeType===1){if(i["s-sr"]){const r=i["s-sn"];i.hidden=!1;for(const s of e)if(s!==i){if(s["s-hn"]!==i["s-hn"]||r!==""){if(s.nodeType===1&&(r===s.getAttribute("slot")||r===s["s-sn"])||s.nodeType===3&&r===s["s-sn"]){i.hidden=!0;break}}else if(s.nodeType===1||s.nodeType===3&&s.textContent.trim()!==""){i.hidden=!0;break}}}lBe(i)}},Q0=[],cBe=t=>{let e,i,r;for(const s of t.childNodes){if(s["s-sr"]&&(e=s["s-cr"])&&e.parentNode){i=e.parentNode.childNodes;const n=s["s-sn"];for(r=i.length-1;r>=0;r--)if(e=i[r],!e["s-cn"]&&!e["s-nr"]&&e["s-hn"]!==s["s-hn"]&&!Bg.experimentalSlotFixes)if(Bbe(e,n)){let o=Q0.find(a=>a.$nodeToRelocate$===e);Uj=!0,e["s-sn"]=e["s-sn"]||n,o?(o.$nodeToRelocate$["s-sh"]=s["s-hn"],o.$slotRefNode$=s):(e["s-sh"]=s["s-hn"],Q0.push({$slotRefNode$:s,$nodeToRelocate$:e})),e["s-sr"]&&Q0.map(a=>{Bbe(a.$nodeToRelocate$,e["s-sn"])&&(o=Q0.find(l=>l.$nodeToRelocate$===e),o&&!a.$slotRefNode$&&(a.$slotRefNode$=o.$slotRefNode$))})}else Q0.some(o=>o.$nodeToRelocate$===e)||Q0.push({$nodeToRelocate$:e})}s.nodeType===1&&cBe(s)}},Bbe=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",uBe=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(uBe)},$b=(t,e,i)=>{const r=t==null?void 0:t.insertBefore(e,i);return Yle(e,t),r},hBe=t=>{const e=[];return t&&e.push(...t["s-scs"]||[],t["s-si"],t["s-sc"],...hBe(t.parentElement)),e},Yle=(t,e,i=!1)=>{var r;if(t&&e&&t.nodeType===1){const s=new Set(hBe(e).filter(Boolean));if(s.size&&((r=t.classList)==null||r.add(...t["s-scs"]=[...s]),t["s-ol"]||i))for(const n of Array.from(t.childNodes))Yle(n,t,!0)}},xVt=(t,e,i=!1)=>{var r,s,n,o,a;const l=t.$hostElement$,c=t.$cmpMeta$,u=t.$vnode$||Fj(null,null),d=cVt(e)?e:tBe(null,null,e);if(oO=l.tagName,c.$attrsToReflect$&&(d.$attrs$=d.$attrs$||{},c.$attrsToReflect$.map(([f,m])=>d.$attrs$[m]=l[f])),i&&d.$attrs$)for(const f of Object.keys(d.$attrs$))l.hasAttribute(f)&&!["key","ref","style","class"].includes(f)&&(d.$attrs$[f]=l[f]);d.$tag$=null,d.$flags$|=4,t.$vnode$=d,d.$elm$=u.$elm$=l.shadowRoot||l,cM=l["s-sc"],kj=(c.$flags$&1)!==0,ote=l["s-cr"],Uj=!1,uM(u,d,i);{if(Ha.$flags$|=1,Wle){cBe(d.$elm$);for(const f of Q0){const m=f.$nodeToRelocate$;if(!m["s-ol"]){const g=rm.createTextNode("");g["s-nr"]=m,$b(m.parentNode,m["s-ol"]=g,m)}}for(const f of Q0){const m=f.$nodeToRelocate$,g=f.$slotRefNode$;if(g){const y=g.parentNode;let v=g.nextSibling;{let b=(r=m["s-ol"])==null?void 0:r.previousSibling;for(;b;){let w=(s=b["s-nr"])!=null?s:null;if(w&&w["s-sn"]===m["s-sn"]&&y===w.parentNode){for(w=w.nextSibling;w===m||w!=null&&w["s-sr"];)w=w==null?void 0:w.nextSibling;if(!w||!w["s-nr"]){v=w;break}}b=b.previousSibling}}(!v&&y!==m.parentNode||m.nextSibling!==v)&&m!==v&&(!m["s-hn"]&&m["s-ol"]&&(m["s-hn"]=m["s-ol"].parentNode.nodeName),$b(y,m,v),m.nodeType===1&&(m.hidden=(n=m["s-ih"])!=null?n:!1)),m&&typeof g["s-rf"]=="function"&&g["s-rf"](m)}else m.nodeType===1&&(i&&(m["s-ih"]=(o=m.hidden)!=null?o:!1),m.hidden=!0)}}Uj&&lBe(d.$elm$),Ha.$flags$&=-2,Q0.length=0}if(Bg.experimentalScopedSlotChanges&&c.$flags$&2)for(const f of d.$elm$.childNodes)f["s-hn"]!==oO&&!f["s-sh"]&&(i&&f["s-ih"]==null&&(f["s-ih"]=(a=f.hidden)!=null?a:!1),f.hidden=!0);ote=void 0},TVt=(t,e)=>{},Xle=(t,e)=>(t.$flags$|=16,TVt(t,t.$ancestorComponent$),JUt(()=>SVt(t,e))),SVt=(t,e)=>{const i=t.$hostElement$,r=$2("scheduleUpdate",t.$cmpMeta$.$tagName$),s=i;if(!s)throw new Error(`Can't render component <${i.tagName.toLowerCase()} /> with invalid Stencil runtime! Make sure this imported component is compiled with a \`externalRuntime: true\` flag. For more information, please refer to https://stenciljs.com/docs/custom-elements#externalruntime`);let n;return e?n=WA(s,"componentWillLoad"):n=WA(s,"componentWillUpdate"),n=jbe(n,()=>WA(s,"componentWillRender")),r(),jbe(n,()=>CVt(t,s,e))},jbe=(t,e)=>EVt(t)?t.then(e).catch(i=>{console.error(i),e()}):e(),EVt=t=>t instanceof Promise||t&&t.then&&typeof t.then=="function",CVt=async(t,e,i)=>{const r=t.$hostElement$,s=$2("update",t.$cmpMeta$.$tagName$);r["s-rc"],i&&_Vt(t);const n=$2("render",t.$cmpMeta$.$tagName$);MVt(t,e,r,i),n(),s(),AVt(t)},Gbe=null,MVt=(t,e,i,r)=>{try{Gbe=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(Bg.hasRenderFn||Bg.reflect)&&(Bg.vdomRender||Bg.reflect)&&(Bg.hydrateServerSide||xVt(t,e,r))}catch(l){VN(l,t.$hostElement$)}return Gbe=null,null},AVt=t=>{const e=t.$cmpMeta$.$tagName$,i=t.$hostElement$,r=$2("postUpdate",e),s=i;t.$ancestorComponent$,WA(s,"componentDidRender"),t.$flags$&64?(WA(s,"componentDidUpdate"),r()):(t.$flags$|=64,WA(s,"componentDidLoad"),r())},Rpi=t=>{{const e=cE(t),i=e.$hostElement$.isConnected;return i&&(e.$flags$&18)===2&&Xle(e,!1),i}},WA=(t,e,i)=>{if(t&&t[e])try{return t[e](i)}catch(r){VN(r)}},PVt=(t,e)=>cE(t).$instanceValues$.get(e),OVt=(t,e,i,r)=>{const s=cE(t),n=t,o=s.$instanceValues$.get(e),a=s.$flags$,l=n;i=pVt(i,r.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){s.$instanceValues$.set(e,i);{if(r.$watchers$&&a&128){const d=r.$watchers$[e];d&&d.map(f=>{try{l[f](i,o,e)}catch(m){VN(m,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,e)===!1)return;Xle(s,!1)}}}},$Vt=(t,e,i)=>{var r,s;const n=t.prototype;if(e.$members$||e.$watchers$||t.watchers){t.watchers&&!e.$watchers$&&(e.$watchers$=t.watchers);const o=Object.entries((r=e.$members$)!=null?r:{});o.map(([a,[l]])=>{(l&31||l&32)&&Object.defineProperty(n,a,{get(){return PVt(this,a)},set(c){OVt(this,a,c,e)},configurable:!0,enumerable:!0})});{const a=new Map;n.attributeChangedCallback=function(l,c,u){Ha.jmp(()=>{var d;const f=a.get(l);if(this.hasOwnProperty(f))u=this[f],delete this[f];else{if(n.hasOwnProperty(f)&&typeof this[f]=="number"&&this[f]==u)return;if(f==null){const m=cE(this),g=m==null?void 0:m.$flags$;if(g&&!(g&8)&&g&128&&u!==c){const v=this,b=(d=e.$watchers$)==null?void 0:d[l];b==null||b.forEach(w=>{v[w]!=null&&v[w].call(v,u,c,l)})}return}}this[f]=u===null&&typeof this[f]=="boolean"?!1:u})},t.observedAttributes=Array.from(new Set([...Object.keys((s=e.$watchers$)!=null?s:{}),...o.filter(([l,c])=>c[0]&15).map(([l,c])=>{var u;const d=c[1]||l;return a.set(d,l),c[0]&512&&((u=e.$attrsToReflect$)==null||u.push([l,d])),d})]))}}return t},RVt=async(t,e,i,r)=>{let s;if(!(e.$flags$&32)){e.$flags$|=32,i.$lazyBundleId$;{s=t.constructor;const o=t.localName;customElements.whenDefined(o).then(()=>e.$flags$|=128)}if(s&&s.style){let o;typeof s.style=="string"?o=s.style:typeof s.style!="string"&&(e.$modeName$=dVt(t),e.$modeName$&&(o=s.style[e.$modeName$]));const a=iBe(i,e.$modeName$);if(!Nj.has(a)){const l=$2("registerStyles",i.$tagName$);gVt(a,o,!!(i.$flags$&1)),l()}}}e.$ancestorComponent$,Xle(e,!0)},Hbe=t=>{},IVt=t=>{if(!(Ha.$flags$&1)){const e=cE(t),i=e.$cmpMeta$,r=$2("connectedCallback",i.$tagName$);e.$flags$&1?(dBe(t,e,i.$listeners$),e!=null&&e.$lazyInstance$?Hbe(e.$lazyInstance$):e!=null&&e.$onReadyPromise$&&e.$onReadyPromise$.then(()=>Hbe(e.$lazyInstance$))):(e.$flags$|=1,i.$flags$&12&&LVt(t),i.$members$&&Object.entries(i.$members$).map(([s,[n]])=>{if(n&31&&t.hasOwnProperty(s)){const o=t[s];delete t[s],t[s]=o}}),RVt(t,e,i)),r()}},LVt=t=>{const e=t["s-cr"]=rm.createComment("");e["s-cn"]=!0,$b(t,e,t.firstChild)},DVt=async t=>{if(!(Ha.$flags$&1)){const e=cE(t);e.$rmListeners$&&(e.$rmListeners$.map(i=>i()),e.$rmListeners$=void 0)}},Ipi=(t,e)=>{const i={$flags$:e[0],$tagName$:e[1]};i.$members$=e[2],i.$listeners$=e[3],i.$watchers$=t.$watchers$,i.$attrsToReflect$=[];const r=t.prototype.connectedCallback,s=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){GUt(this,i)},connectedCallback(){const n=cE(this);dBe(this,n,i.$listeners$),IVt(this),r&&r.call(this)},disconnectedCallback(){DVt(this),s&&s.call(this)},__attachShadow(){if(!this.shadowRoot)this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)});else if(this.shadowRoot.mode!=="open")throw new Error(`Unable to re-use existing shadow root for ${i.$tagName$}! Mode is set to ${this.shadowRoot.mode} but Stencil only supports open shadow roots.`)}}),t.is=i.$tagName$,$Vt(t,i)},Lpi=(t,e)=>e,dBe=(t,e,i,r)=>{i&&i.map(([s,n,o])=>{const a=FVt(t,s),l=NVt(e,o),c=kVt(s);Ha.ael(a,n,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>Ha.rel(a,n,l,c))})},NVt=(t,e)=>i=>{var r;try{Bg.lazyLoad||t.$hostElement$[e](i)}catch(s){VN(s)}},FVt=(t,e)=>e&4?rm:e&8?zN:e&16?rm.body:t,kVt=t=>WUt?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0;/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
 * v2.11.1
 */const pBe=()=>typeof navigator<"u"&&typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;function UVt(){return navigator.userAgentData}function Dpi(){if(!pBe())return"";const t=UVt();return t!=null&&t.brands?t.brands.map(({brand:e,version:i})=>`${e}/${i}`).join(" "):navigator.userAgent}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
 * v2.11.1
 */function qbe(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,i=()=>t.contains(Xze)||t.contains(Yze)&&e?"dark":"light",r=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),s=o=>{n!==o&&r(o),n=o};let n=i();r(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(i())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function VVt(){pBe()&&(document.readyState==="interactive"?qbe():document.addEventListener("DOMContentLoaded",()=>qbe(),{once:!0})),zUt()}const zVt=VVt;zVt();let fBe;function BVt(){try{QUt(".")}catch{KUt(Lu(tr(fBe)))}}function Cp(t){var i;const e=[];for(const r of Object.keys(t))customElements.get(`calcite-${r}`)||e.push((i=t[r])==null?void 0:i.call(t));return e.length>0?Promise.all(e):null}fBe="components/assets";const mBe=Symbol("widget"),gBe=Symbol("widget-test-data"),jVt=[],GVt={},zj=new WeakMap;function yBe(t,e){let i=e.children;if(i!=null&&i.length)for(let s=0;s<i.length;++s)i[s]=yBe(t,i[s]);else i=jVt;const r=e.vnodeSelector;if(Bj(r)){const s=e.properties||GVt,n=s.key||r;return{vnodeSelector:"div",properties:{key:n,afterCreate:HVt,afterUpdate:qVt,afterRemoved:_Be,parentWidget:t,widgetConstructor:r,widgetProperties:{...s,key:n,children:i}},children:void 0,text:void 0,domNode:null}}return e}function HVt(t,e,i,{parentWidget:r,widgetConstructor:s,widgetProperties:n}){var a;const o=new s(n);o.container=t,zj.set(t,o),(a=o.afterCreate)==null||a.call(o,o,t),r.addHandles(Gi(()=>_Be(t))),queueMicrotask(()=>{o[gBe].projector.renderNow()})}function qVt(t,e,i,{widgetProperties:r}){var n;const s=zj.get(t);s&&(s.set(r),(n=s.afterUpdate)==null||n.call(s,s,t))}function _Be(t){var i;const e=zj.get(t);e&&((i=e.afterRemoved)==null||i.call(e,e,t),e.destroy(),zj.delete(t))}function Bj(t){return typeof t=="function"&&t[mBe]}const Wbe=new Set;function WVt(t){Wbe.add(t),t.finally(()=>Wbe.delete(t))}var vBe;const ZVt="esri.widgets.Widget";let YVt=0;function bBe(t,e){const i=Object.prototype.hasOwnProperty;for(const r in e)i.call(e,r)&&i.call(t,r)&&(t[r]!=null&&e[r]!=null&&typeof t[r]=="object"&&typeof e[r]=="object"?bBe(t[r],e[r]):t[r]=e[r]);return t}const XVt=FUt({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,i=/capture$/i;t.eventHandlerInterceptor=(r,s,n,o)=>{const a=e==null?void 0:e(r,s,n,o),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in n)||l){const c=r[2].toLowerCase()+r.slice(3),u=m=>a==null?void 0:a.call(n,m);n.addEventListener(c,u,l);const d=()=>n.removeEventListener(c,u,l),f=o.afterRemoved;o.afterRemoved=m=>{f==null||f(m),d()}}return a}},handleInterceptedEvent(t,e,i,r){const{eventPhase:s,type:n}=r,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,l&&a in l))&&(QPe(),t.scheduleRender(),l[a].call(l.bind||i,r))}});let _W=!1,ra=class extends jD(Ls.EventedAccessor){constructor(e,i){super(e,i),this._attached=!1,this._projector=XVt,this._readyForTrueRender=!1,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=d_(async()=>{var l;if((l=this._messageBundleProps)!=null&&l.length){const c=await Promise.allSettled(this._messageBundleProps.map(async({bundlePath:u,propertyName:d})=>{if(this.destroyed)return;let f=await $2e(u);this.uiStrings&&Object.keys(this.uiStrings)&&(f=bBe(re(f),this.uiStrings)),this[d]=f}));if(this.destroyed)return;for(const u of c)u.status==="rejected"&&ne.getLogger(this).error("widget-intl:locale-error",this.declaredClass,u.reason)}await this.loadLocale()}),BVt();const r="esri-widget-uid-"+qG(),s=this.render.bind(this);this._trackingTarget=new bG(()=>{this.autoRenderingEnabled&&this.scheduleRender()});const n=()=>({vnodeSelector:"div",properties:{key:`${r}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}),o=()=>{var d,f;if(!this._readyForTrueRender||this.destroyed)return null;const l=s()??n(),c=l.properties??(l.properties={});if(c.key??(c.key=r),Bj(l.vnodeSelector)){if(!this.visible)return n()}else this.visible?c.styles||(c.styles={}):(c.class="",c.styles={display:"none"}),(d=c.styles).display??(d.display="");let u=0;return(f=l.children)==null||f.forEach(m=>{var g;Bj(m.vnodeSelector)||(m.properties??(m.properties={}),(g=m.properties).key??(g.key=`${this.id}--${u++}`))}),yBe(this,l)};this.render=()=>{if(_W)return o();let l=Hrt(this)??null;if(l)return l;this._trackingTarget.clear(),_W=!0;try{l=S_(this._trackingTarget,o)}catch(c){throw ne.getLogger(this).error(c),c}finally{_W=!1}return l&&qrt(this,l),l};const a=this.beforeFirstRender();a?this._resourcesFetch=a.then(()=>{this._readyForTrueRender=!0,this._postInitialize()}):(this._resourcesFetch=Promise.resolve().then(()=>{this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),WVt(this._resourcesFetch)}normalizeCtorArgs(e,i){const r={...e};return i&&(r.container=i),r}postInitialize(){}beforeFirstRender(){var i;const e=this.loadDependencies();return(i=this._messageBundleProps)!=null&&i.length||e?Promise.all([e,this._loadLocale()]).then(()=>{}).catch(bZ):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(He(this._trackingTarget),He(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,ZH(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return WG(e)}get domNode(){return this.container}set domNode(e){this.container=e}get icon(){return null}set icon(e){this._overrideIfSome("icon",e)}get id(){var e;return this._get("id")||((e=this.container)==null?void 0:e.id)||Date.now().toString(16)+"-widget-"+YVt++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(vBe=mBe,gBe)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(ZH(this),this._projector.scheduleRender())}own(e){I2e(ne.getLogger(this),"`Widget.own()` is deprecated in favor of 'Widget.addHandles()'",{replacement:"Widget.addHandles()",version:"4.28"}),this.addHandles(e)}classes(...e){return KPe.apply(this,e)}renderNow(){ZH(this),this._projector.renderNow()}_postInitialize(){var i;if(this.destroyed)return;this.scheduleRender(),(i=this._delegatedEventNames)!=null&&i.length&&this.addHandles(te(()=>this.viewModel,(r,s)=>{s&&this.removeHandles("delegated-events"),r&&yG(r)&&this.addHandles(this._delegatedEventNames.map(n=>fO(r,n,o=>{this.emit(n,o)})),"delegated-events")},pr)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(bZ),this.scheduleRender()};this.addHandles([vSe(e),te(()=>this.uiStrings,e),jo(()=>this.container,r=>{this.destroyed||this._attach(r)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var i;this._attached&&(this._projector.detach(this.render),this._attached=!1),(i=e==null?void 0:e.parentNode)==null||i.removeChild(e)}};ra[vBe]=!0,h([p()],ra.prototype,"_readyForTrueRender",void 0),h([p({value:null})],ra.prototype,"container",null),h([Qt("container")],ra.prototype,"castContainer",null),h([p()],ra.prototype,"icon",null),h([p()],ra.prototype,"id",null),h([p()],ra.prototype,"label",null),h([p()],ra.prototype,"renderable",null),h([p()],ra.prototype,"uiStrings",void 0),h([p()],ra.prototype,"viewModel",void 0),h([p({value:!0})],ra.prototype,"visible",null),h([p()],ra.prototype,"key",void 0),h([p()],ra.prototype,"children",void 0),h([p()],ra.prototype,"afterCreate",void 0),h([p()],ra.prototype,"afterUpdate",void 0),h([p()],ra.prototype,"afterRemoved",void 0),ra=h([I(ZVt)],ra);const Wo=ra;let OV,$V=null;const ZA=new Map;async function Fpi(t){$V==null&&(OV==null&&(OV=oe(()=>import("./Lyr3DWasmPerSceneView-D135v_d6.js"),__vite__mapDeps([197,68,5,69,116]))),$V=await OV);const e=t.view;let i=ZA.get(e);return i||(i=new $V.default({view:e}),ZA.set(e,i)),await i.initializeWasm(),i.add3DTilesLayerView(t)}function JVt(t){return ZA.get(t)}function kpi(t){const e=t.view,i=ZA.get(e);i&&i.remove3DTilesLayerView(t)<1&&(ZA.delete(e),ZA.size===0&&(OV=null,$V=null))}function Zbe(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function QVt(t,e){return t.length!==e.length||t.some((i,r)=>i.text!==e[r].text)}function iR(t,e,i){!i||!e||t.find(r=>r.layerView===e&&r.text===i)||t.push({text:i,layerView:e})}function KVt(t){return t.type==="bing-maps"}const d0=[];let hM=class extends Ue{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new Ke,this.view=null,this._allLayerViewsChange=i=>{var s;this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");const r=(s=this.view)==null?void 0:s.allLayerViews;r&&(this.addHandles(r.map(n=>te(()=>{var o;return[n.suspended,(o=n.layer)==null?void 0:o.attributionVisible]},()=>this._updateAttributionItems())).toArray(),"suspension"),r.forEach(n=>{n.declaredClass==="esri.views.3d.layers.Tiles3DLayerView3D"&&this.addHandles(n.on("visible-geometry-changed",()=>this._updateAttributionItems()),"visible-geometry-changed")})),i!=null&&i.removed&&i.removed.forEach(n=>{this._pendingAttributions.delete(n),this._fetchedAttributionData.delete(n)}),this._updateAttributionItems()},this.addHandles([on(()=>{var i;return(i=this.view)==null?void 0:i.allLayerViews},"change",i=>this._allLayerViewsChange(i),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),jo(()=>{var i;return((i=this.view)==null?void 0:i.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){var e;return(e=this.view)!=null&&e.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,i=e==null?void 0:e.allLayerViews;if(d0.length=0,!e||!i)return void this._clear();i.forEach(s=>{var a,l;if(s.suspended||!((a=s.layer)!=null&&a.attributionVisible))return;const n=s.layer;if(Zbe(n,"user"))return void iR(d0,s,n.copyright);if(n.hasAttributionData){if(this._fetchedAttributionData.has(s)){const c=this._fetchedAttributionData.get(s);return void(c?iR(d0,s,this._getDynamicAttribution(c,e,n)):Zbe(n)&&iR(d0,s,n.copyright))}return void this._fetchAttributionData(s)}const o="portalItem"in n?(l=n.portalItem)==null?void 0:l.accessInformation:void 0;iR(d0,s,o||n.copyright)});const r=i.find(s=>{var n;return((n=s.layer)==null?void 0:n.type)==="integrated-mesh-3dtiles"});if(this.view&&r){const s=JVt(this.view);if(s){const n=s.getAttributionText();for(let o=0;o<n.length;++o)iR(d0,r,n[o])}}QVt(this.items,d0)&&(this.items.removeAll(),this.items.addMany(d0)),d0.length=0,this.notifyChange("state")}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const i=await Qh(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const r=i.ok?this._createContributionIndex(i.value,KVt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,r)}this._updateAttributionItems()}_createContributionIndex(e,i){const r=e.contributors,s={};if(!r)return s;for(let n=0;n<r.length;n++){const o=r[n],a=o.coverageAreas;if(!a)return;for(const l of a){const c=l.bbox,u=l.zoomMin-(i&&l.zoomMin?1:0),d=l.zoomMax-(i&&l.zoomMax?1:0),f=new dr({xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:Ye.WGS84}),m={extent:ty(f),attribution:o.attribution||"",score:l.score!=null?l.score:100,id:n};for(let g=u;g<=d;g++)s[g]??(s[g]=[]),s[g].push(m)}}return s.maxKey=Math.max.apply(null,Object.keys(s)),s}_getDynamicAttribution(e,i,r){var u;const{extent:s,scale:n}=i;let o=((u=r.tileInfo)==null?void 0:u.scaleToZoom(n))??0;if(o=Math.min(e.maxKey??0,Math.round(o)),!s||o==null||o<=-1)return"";const a=e[o],l=qD(s.center.clone().normalize(),i.spatialReference),c=new Set;return a?a.filter(d=>{const f=d.id,m=!c.has(f)&&l&&d.extent&&Kre(d.extent,l);return m&&c.add(f),m}).sort((d,f)=>f.score-d.score||d.objectId-f.objectId).map(d=>d.attribution).join(", "):""}};h([p({readOnly:!0,type:Ke})],hM.prototype,"items",void 0),h([p({readOnly:!0})],hM.prototype,"state",null),h([p()],hM.prototype,"view",void 0),hM=h([I("esri.widgets.Attribution.AttributionViewModel")],hM);const wBe=hM,Jt={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"};function ezt(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:izt(t[e])}}}function tzt(t){const e=t==null?void 0:t.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function izt(t){return function(e,...i){tzt(e)?Xrt(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...i)}}function qo(t){return(e,i)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:i})}}var rzt=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},xBe=function(t,e){for(var i=0,r=t.length;i<r;i++){var s=t[i];Array.isArray(s)?xBe(s,e):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=rzt(s)),e.push(s))}},szt=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:i[0],domNode:null};var s=[];return xBe(i,s),{vnodeSelector:t,properties:e||void 0,children:s,text:void 0,domNode:null}};function Q(t,e,...i){return typeof t!="function"||Bj(t)?szt(t,e,...i):t(e,...i)}function nzt(...t){return t}const vC="esri-attribution",bC={base:vC,poweredBy:`${vC}__powered-by`,sources:`${vC}__sources`,open:`${vC}--open`,sourcesOpen:`${vC}__sources--open`,link:`${vC}__link`};let Rc=class extends Wo{constructor(e,i){super(e,i),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:s})=>this._checkSourceTextOverflow(s))),this.itemDelimiter=" | ",this.messages=null,this.viewModel=new wBe}initialize(){this.addHandles(on(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,i)=>(e.includes(i.text)||e.push(i.text),e),[]).join(this.itemDelimiter)}get icon(){return"description"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[bC.open]:this._isOpen};return Q("div",{bind:this,class:this.classes(bC.base,Jt.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return Q("div",{class:bC.poweredBy},"Powered by"," ",Q("a",{class:bC.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,i=this._isInteractive,r=i?0:void 0,{attributionText:s}=this,n={[bC.sourcesOpen]:e,[Jt.interactive]:i};return Q("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(bC.sources,n),innerHTML:s,tabIndex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let i=!1;const{clientHeight:r,clientWidth:s,scrollWidth:n}=e,o=n>s,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(i=!0),this._isOpen){const l=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,l&&(this._isOpen=!1,i=!0)}i&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};h([p()],Rc.prototype,"_isOpen",void 0),h([p()],Rc.prototype,"_isInteractive",null),h([p()],Rc.prototype,"_attributionTextOverflowed",void 0),h([p()],Rc.prototype,"_prevSourceNodeHeight",void 0),h([p({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Rc.prototype,"attributionText",null),h([p()],Rc.prototype,"icon",null),h([p()],Rc.prototype,"itemDelimiter",void 0),h([p()],Rc.prototype,"label",null),h([p(),qo("esri/widgets/Attribution/t9n/Attribution")],Rc.prototype,"messages",void 0),h([p()],Rc.prototype,"view",null),h([p({type:wBe})],Rc.prototype,"viewModel",void 0),h([ezt()],Rc.prototype,"_toggleState",null),Rc=h([I("esri.widgets.Attribution")],Rc);const ozt=Rc;function azt(t){var e,i;return((e=t==null?void 0:t.spatialReference)==null?void 0:e.isWebMercator)||((i=t==null?void 0:t.spatialReference)==null?void 0:i.isGeographic)||!1}const Jle=t=>{let e=class extends t{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return F2(r),this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return h([p()],e.prototype,"goToOverride",void 0),h([p()],e.prototype,"view",void 0),e=h([I("esri.widgets.support.GoTo")],e),e};let xT=class extends Jle(Ue){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(te(()=>this.view,this._updateRotationWatcher,pt))}destroy(){this.view=null}get canShowNorth(){return azt(this.view)}get state(){var e;return!((e=this.view)!=null&&e.ready)||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){var e,i;(e=this.view)!=null&&e.ready&&(((i=this.view)==null?void 0:i.type)==="2d"?this.callGoTo({target:{rotation:0},options:{animationMode:"always",duration:ue("mapview-essential-goto-duration")}}):this.callGoTo({target:{heading:0}}))}_updateForRotation(e){e!=null&&this._set("orientation",{z:e})}_updateForCamera(e){if(!e)return;const i=-e.heading;this._set("orientation",{x:0,y:0,z:i})}_updateRotationWatcher(e){this.removeAllHandles(),e&&this.addHandles(e.type==="2d"?te(()=>e==null?void 0:e.rotation,this._updateForRotation,pt):te(()=>e==null?void 0:e.camera,this._updateForCamera,pt))}};h([p({readOnly:!0})],xT.prototype,"canShowNorth",null),h([p({readOnly:!0})],xT.prototype,"orientation",void 0),h([p({readOnly:!0})],xT.prototype,"state",null),h([p()],xT.prototype,"view",void 0),xT=h([I("esri.widgets.Compass.CompassViewModel")],xT);const TBe=xT,Ybe="esri-compass",Xbe={base:Ybe,iconContainer:`${Ybe}__icon-container`};let P0=class extends Wo{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new TBe,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=r=>({transform:`rotateZ(${r.z}deg)`})}loadDependencies(){return Cp({button:()=>oe(()=>import("./calcite-button-wzbJSjju.js"),__vite__mapDeps([198,199,200,201,202,203,204,205,206,207,208,209,210])),icon:()=>oe(()=>import("./calcite-icon-eob-Ctv5.js"),__vite__mapDeps([211,209,200,201,208]))})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return this.viewModel.state==="rotation"?"arrow-up":"compass-needle"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:i}=this.viewModel,{messages:r}=this;return Q("div",{class:this.classes(Xbe.base,Jt.widget)},Q("calcite-button",{class:Jt.widgetButton,disabled:i==="disabled",kind:"neutral",label:r.reset,onclick:this._reset,round:!0,scale:"s",title:r.reset},Q("div",{"aria-hidden":"true",class:Xbe.iconContainer,title:r.reset},Q("calcite-icon",{icon:this.icon,styles:this._toRotationTransform(e)}))))}};h([p()],P0.prototype,"goToOverride",null),h([p()],P0.prototype,"icon",null),h([p()],P0.prototype,"label",null),h([p(),qo("esri/widgets/Compass/t9n/Compass")],P0.prototype,"messages",void 0),h([p()],P0.prototype,"view",null),h([p({type:TBe})],P0.prototype,"viewModel",void 0),P0=h([I("esri.widgets.Compass")],P0);const SBe=P0,Jbe="esri-navigation-toggle",Qbe={base:Jbe,isLayoutHorizontal:`${Jbe}--horizontal`};let dM=class extends Ue{constructor(e){super(e),this._navigationMode="pan",this.view=null}initialize(){this.addHandles(jo(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var e,i;return(e=this.view)!=null&&e.ready&&((i=this.view)==null?void 0:i.type)==="3d"?"ready":"disabled"}get navigationMode(){return this._navigationMode}set navigationMode(e){this._navigationMode=e,this._setNavigationMode()}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate")}_setNavigationMode(){var i;const e=(i=this.view)==null?void 0:i.inputManager;e&&(e.primaryDragAction=this._navigationMode==="pan"?"pan":"rotate")}};h([p({readOnly:!0})],dM.prototype,"state",null),h([p()],dM.prototype,"_navigationMode",void 0),h([p()],dM.prototype,"view",void 0),dM=h([I("esri.widgets.NavigationToggle.NavigationToggleViewModel")],dM);const EBe=dM;let O0=class extends Wo{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new EBe,this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{var s;const r=((s=this.viewModel)==null?void 0:s.navigationMode)==="pan"?this._rotateButton:this._panButton;r==null||r.setFocus(),this.toggle()}}loadDependencies(){return Cp({button:()=>oe(()=>import("./calcite-button-wzbJSjju.js"),__vite__mapDeps([198,199,200,201,202,203,204,205,206,207,208,209,210]))})}get icon(){return"move"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){var s,n;const e=((s=this.viewModel)==null?void 0:s.state)==="disabled",i=((n=this.viewModel)==null?void 0:n.navigationMode)==="pan",r=this.messages.toggle;return Q("div",{class:this.classes(Qbe.base,Jt.widget,{[Qbe.isLayoutHorizontal]:this.layout==="horizontal"})},Q("calcite-button",{afterCreate:o=>{this._panButton=o},appearance:i?"outline-fill":"solid",class:Jt.widgetButton,disabled:e,iconStart:"move",kind:"neutral",label:r,onclick:this._toggle,tabIndex:i?void 0:-1,title:r}),Q("calcite-button",{afterCreate:o=>{this._rotateButton=o},appearance:i?"solid":"outline-fill",class:Jt.widgetButton,disabled:e,iconStart:"rotate",kind:"neutral",label:r,onclick:this._toggle,tabIndex:i?-1:void 0,title:r}))}};h([p()],O0.prototype,"icon",null),h([p()],O0.prototype,"label",null),h([p({value:"vertical"})],O0.prototype,"layout",null),h([p(),qo("esri/widgets/NavigationToggle/t9n/NavigationToggle")],O0.prototype,"messages",void 0),h([p()],O0.prototype,"view",null),h([p({type:EBe})],O0.prototype,"viewModel",void 0),O0=h([I("esri.widgets.NavigationToggle")],O0);const lzt=O0;let TT=class extends Ue{get canZoomIn(){var r,s,n;if(!((r=this.view)==null?void 0:r.ready))return!1;const i=(n=(s=this.view)==null?void 0:s.constraints)==null?void 0:n.effectiveMaxScale;return i===0||this._scale>i}get canZoomOut(){var s;const{view:e}=this;if(!(e==null?void 0:e.ready))return!1;const r=(s=e.constraints)==null?void 0:s.effectiveMinScale;return r===0||this._scale<r}get _scale(){var i,r,s;const e=(r=(i=this.view)==null?void 0:i.animation)==null?void 0:r.target;return(e&&"then"in e||e==null?void 0:e.scale)??((s=this.view)==null?void 0:s.scale)??0}};h([p({readOnly:!0})],TT.prototype,"canZoomIn",null),h([p({readOnly:!0})],TT.prototype,"canZoomOut",null),h([p()],TT.prototype,"view",void 0),h([p()],TT.prototype,"_scale",null),TT=h([I("esri.widgets.Zoom.ZoomConditions2D")],TT);const czt=TT;let pM=class extends Ue{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};h([p({readOnly:!0})],pM.prototype,"canZoomIn",null),h([p({readOnly:!0})],pM.prototype,"canZoomOut",null),h([p()],pM.prototype,"view",void 0),pM=h([I("esri.widgets.Zoom.ZoomConditions3D")],pM);const uzt=pM;let w1=class extends Ue{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return this._zoomConditions!=null&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new czt({view:e}):e.type==="3d"&&(this._zoomConditions=new uzt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():h_(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():h_(e.goTo({zoomFactor:.5}))}};h([p()],w1.prototype,"_zoomConditions",void 0),h([p()],w1.prototype,"canZoomIn",null),h([p()],w1.prototype,"canZoomOut",null),h([p({readOnly:!0})],w1.prototype,"state",null),h([p()],w1.prototype,"view",null),w1=h([I("esri.widgets.Zoom.ZoomViewModel")],w1);const CBe=w1,Kbe={base:"esri-zoom",horizontalLayout:"esri-zoom--horizontal"};let $0=class extends Wo{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new CBe,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return Cp({button:()=>oe(()=>import("./calcite-button-wzbJSjju.js"),__vite__mapDeps([198,199,200,201,202,203,204,205,206,207,208,209,210]))})}get icon(){return"magnifying-glass-plus"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e={[Kbe.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:r}=this.viewModel,{zoomIn:s,zoomOut:n}=this.messages;return Q("div",{class:this.classes(Kbe.base,Jt.widget,e)},Q("calcite-button",{class:Jt.widgetButton,disabled:!i,iconStart:"plus",kind:"neutral",label:s,onclick:this.zoomIn,title:s}),Q("calcite-button",{class:Jt.widgetButton,disabled:!r,iconStart:"minus",kind:"neutral",label:n,onclick:this.zoomOut,title:n}))}};h([p()],$0.prototype,"icon",null),h([p()],$0.prototype,"label",null),h([p({value:"vertical"})],$0.prototype,"layout",null),h([p(),qo("esri/widgets/Zoom/t9n/Zoom")],$0.prototype,"messages",void 0),h([p()],$0.prototype,"view",null),h([p({type:CBe})],$0.prototype,"viewModel",void 0),$0=h([I("esri.widgets.Zoom")],$0);const hzt=$0;function dzt(t){return(t==null?void 0:t.view)!==void 0}let RV=class extends $Ut{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=i=>{this.components.forEach(r=>{const s=this._find(r),n=s==null?void 0:s.widget;dzt(n)&&(n.view=i)})},this._componentsWatcher=(i,r)=>{this._removeComponents(r),this._addComponents(i),this._adjustPadding(i)}}initialize(){this.addHandles([te(()=>this.components,this._componentsWatcher,pt),te(()=>this.view,this._updateViewAwareWidgets,pt)])}_add(e,i,r,s,n){let o=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;o=this._createComponent(e)}super._add(o,i,r,s,n)}_removeComponents(e){e.forEach(i=>{const r=this._find(i);r&&(this.remove(r),r.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:i}=this.padding;this.padding=i}}_addComponents(e){this.constructed&&e.forEach(i=>this.add(this._createComponent(i),this._defaultPositionLookup[i]))}_createComponent(e){const i=this._createWidget(e);return new PV({id:e,node:i})}_createWidget(e){const i=this.view;switch(e){case"attribution":return new ozt({view:i});case"compass":return new SBe({view:i});case"navigation-toggle":return new lzt({view:i});case"zoom":return new hzt({view:i})}}};h([p()],RV.prototype,"components",void 0),RV=h([I("esri.views.ui.DefaultUI")],RV);const MBe=RV;let IV=class extends MBe{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};h([p()],IV.prototype,"components",void 0),IV=h([I("esri.views.ui.3d.DefaultUI3D")],IV);const ABe=IV;let dt=class extends Qit(jot(hst(Ict))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new O_({slicePlane:gPe},this),this._resourceController=m3t(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new $K({view:this}),this.labeler=new mT({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new MP,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new jT,this.environment=new YC,this.environmentManager=new rf,this.floors=new Ke,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new Nct({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new gIt,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new ABe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new TUe,ttt();const e=(i=null)=>{i!=null&&i.type===Nr.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.addHandles([on(()=>{var i;return(i=this.map)==null?void 0:i.allLayers},"after-changes",i=>e(i),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),te(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new Wyt({view:this}),this.stateManager=new cn({view:this})}initialize(){this.groundView=new $ot({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.addHandles(on(()=>{var e;return(e=this.map)==null?void 0:e.allLayers},"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},pt),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},pt),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>F7e(e>0?1e3/Math.ceil(e):0),pt),this.updatingHandles.add(()=>{var e;return(e=this.map)==null?void 0:e.ground},t,pr),this.updatingHandles.add(()=>{var e,i;return(i=(e=this.map)==null?void 0:e.ground)==null?void 0:i.opacity},()=>this._updateDefaultHitTestOptions(),pr),this.addHandles(te(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),lr))}destroy(){var t;this.destroyed||(this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=He(this.sharedSymbolResources),this._set("labeler",He(this.labeler)),this._set("deconflictor",He(this.deconflictor)),this._resourceController=He(this._resourceController),this._set("stateManager",He(this.stateManager)),this._set("inputManager",He(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",He(this.environmentManager)),this._set("environment",He(this.environment)),this.groundView=He(this.groundView),this._exitBasemapTerrain(),(t=this._stage)==null||t.destroy())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var t;return(t=this.basemapTerrain)==null?void 0:t.spatialReference}get animation(){var t;return(t=this.state)==null?void 0:t.animation}get camera(){var t;return(t=this.stateManager)==null?void 0:t.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){var t;return(t=this.stateManager)==null?void 0:t.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){var t;return(t=this.stateManager)==null?void 0:t.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){if(this.viewingMode==="global")return null;const t=this.map;let e=this._userClippingArea||Wue(t,"clippingArea");return!this._userClippingArea&&!Wue(t,"clippingEnabled")||e==null?(this._clippingArea=null,null):e instanceof dr?this.spatialReference&&(e=K5(e,this.spatialReference),e==null)?(ne.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),e.intersection(this._groundAndLayersExtent)==null&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(ne.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&t!=null?ne.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===Je.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return e==null||t==null||e.spatialReference.equals(t)?e:K5(e,t)}get tileInfo(){var t,e;return(e=(t=this.basemapTerrain)==null?void 0:t.tilingScheme)==null?void 0:e.toTileInfo()}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||Ye.WGS84,i=K5(this.clippingArea,e);i!=null&&(t=t!=null?t.intersection(i):i);const r=this._get("dataExtent");return t!=null&&t.equals(r)?r:t}get _groundAndLayersExtent(){const t=this.spatialReference||Ye.WGS84;let e;const i=n=>{const o=K5(n,t);o!=null&&(e!=null?e.union(o):e=o.clone())},r=this.basemapTerrain;if(r!=null&&r.spatialReference){const n=r.groundExtent;i(new dr({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const n=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||i(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const s=this._get("_groundAndLayersExtent");return e.equals(s)?s:e}castEnvironment(t){var e;return t?t instanceof YC?t:t instanceof TP?((e=this.environment)==null?void 0:e.cloneWithWebsceneEnvironment(t))??YC.fromWebsceneEnvironment(t):nn(YC,t):new YC}get extent(){var t;return(t=this.stateManager)==null?void 0:t.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){var t;return(t=this.stateManager)==null?void 0:t.screenCenter}get frustum(){var t;return(t=this.stateManager)==null?void 0:t.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){var t;return this.navigating||(((t=this.toolViewManager)==null?void 0:t.interacting)??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){var t;return((t=this.state)==null?void 0:t.navigating)??!1}get padding(){var t;return(t=this.stateManager)==null?void 0:t.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){cV.isValidProfile(t)&&(cV.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||cV.getDefaultProfile()}set slicePlane(t){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:t}),t==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");H2(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){var t;return!!this.viewingMode&&!!((t=this.stateManager)!=null&&t.preinit(this.spatialReference))}get resolution(){return this.spatialReference!=null?Wit(this.scale,this.spatialReference):0}get scale(){var t;return(t=this.stateManager)==null?void 0:t.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get terrainScale(){var t;return(t=this.stateManager)==null?void 0:t.terrainScale}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?gw.deriveUnitFromSR(t,this.spatialReference):null}get updating(){var s,n,o,a;if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,i=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(l=>{if(l.isFulfilled()){if(l.updating){if(e=!0,l.suspended||$ee(l))return;++i,t+=l.updatingProgress}}else++i});for(const l of this._updatingObjects)l!=null&&l.updating&&(i+=.1,t+=.5*.1);for(const l of this._updatingObjectsWithProgress)l!=null&&l.updating&&(++i,t+=l.updatingProgress);const r=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||r||this._createGraphicsViewController||(s=this.inputManager)!=null&&s.updating||(o=(n=this.map)==null?void 0:n.allLayers)!=null&&o.some(l=>!l.isFulfilled())||(a=this.textures)!=null&&a.updating),e?(this._numUpdating=Math.max(i,this._numUpdating),t+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const l=performance.now();if(t<1){const c=Math.min((l-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-c)+t*c}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?l:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){var i;const t=this._predeterminedViewingMode;if(t!=null)return kH(t);const e=this.spatialReference;return e?((i=this.defaultsFromMap)==null?void 0:i.viewingMode)!=null&&e.equals(this.defaultsFromMap.spatialReference)?kH(this.defaultsFromMap.viewingMode):VL(e,Je.Global)?"global":"local":"global"}set viewingMode(t){this.ready?ne.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){var t;return(t=this.stateManager)==null?void 0:t.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get quality(){var t,e;return((e=(t=this._resourceController)==null?void 0:t.memoryController)==null?void 0:e.memoryFactor)??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new _3t(this)}on(t,e,i,r){return this.viewEvents.on(t,e,i,r)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return ne.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const i=cfe(t)?lfe(this,t):t;return $It(this,i,e,this._defaultToMapOptions)}toScreen(t){if(!this.ready)return ne.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(t.z==null?Gg(this.elevationProvider,t):null)??0;return xl(t,ek,this.renderSpatialReference,e),this.state.camera.projectToScreen(ek,vW),fp(vW[0],vW[1])}pixelSizeAt(t){return this.ready?t?(xl(t,ek,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(ek)):0:(ne.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t,()=>this.pixelSizeAt(t)):1}hitTest(t,e){if(!this.ready)return ne.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=cfe(t)?lfe(this,t):t;return OIt(this,i,e,this._defaultHitTestOptions)}async popupHitTest(t){return YIt(this,t)}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(t.parent==null)throw new B("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return dW(i,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return pW(i,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e);return[pW(i[0],this._pixelFormat()),pW(i[1],this._pixelFormat())]}_completeSettings(t){const e=Xkt(t,this);return e.pixelRatio/=this.state.pixelRatio,eUt(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){}async takeScreenshotWithObjectAndLayerId(t){if(!ue("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e),r=dW(i[0],e,this._pixelFormat()),s=this._completeSettings(t);return s.format="png",[r,dW(i[1],s,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return gfe.importLayerView(t)}hasLayerViewModule(t){return gfe.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var t,e,i;return this.map&&"initialViewProperties"in this.map&&((t=this.map.initialViewProperties)==null?void 0:t.spatialReference)||((e=this.defaultsFromMap)==null?void 0:e.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.ready)&&this._initialDefaultSpatialReference||null}async validate(){let t=xUt(this.type);const e=ue("safari");if(e&&e<9&&(t=new B("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),t!=null)throw ne.getLogger(this).warn("#validate()",t.message),t}get _predeterminedViewingMode(){var e;const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(e=this.map.initialViewProperties)==null?void 0:e.viewingMode:null)??null;return t!=null?Ede(t):null}getSpatialReferenceSupport(t,e){const i=this._predeterminedViewingMode;if(i!=null)return this._validateSpatialReferenceForViewingMode(t,e,i)?{constraints:this._makeSpatialReferenceConstraints(t,e,i)}:null;const r=this._validateSpatialReferenceForViewingMode(t,e,Je.Local),s=this._validateSpatialReferenceForViewingMode(t,e,Je.Global);return r||s?r&&s?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:r?{constraints:this._makeSpatialReferenceConstraints(t,e,Je.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,Je.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,i){return!!VL(t,i)&&(e==null||!!qhe(e)||(!x3(e)||N8(e,t,i)!=null)&&(!Hhe(e)||i!==Je.Global))}_makeSpatialReferenceConstraints(t,e,i){if(e==null)return[{spatialReference:t,viewingMode:i}];const{isWebMercator:r,isWGS84:s}=t;return qhe(e)&&(r||s)?!s||i===Je.Local||gle(e.tileInfo,e.fullExtent,t,Je.Global)===null?[{spatialReference:t,viewingMode:i},{spatialReference:Ye.WebMercator,viewingMode:i}]:[{spatialReference:r?Ye.WGS84:Ye.WebMercator,viewingMode:i}]:x3(e)||Hhe(e)||!r&&!s?x3(e)&&r&&i!==Je.Global?[{spatialReference:t,viewingMode:i},{spatialReference:Ye.WGS84,viewingMode:Je.Local}]:[{spatialReference:t,viewingMode:i}]:[{spatialReference:t,viewingMode:i},{spatialReference:r?Ye.WGS84:Ye.WebMercator,viewingMode:i}]}_validateSpatialReference(t){const e=this.getSpatialReferenceSupport(t)!=null,i=this._predeterminedViewingMode;return e||(i!=null?ne.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${kH(i)} viewing mode.`):t.isGeographic&&ne.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}trackGraphicState(t){if(!t.graphic)return ne.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let i=null,r=!1;const s=n=>{var o;!r&&n!=null&&"processor"in n&&((o=n.processor)==null?void 0:o.type)==="graphics-3d"&&n.processor.graphicsCore&&(i=n.processor.graphicsCore.trackGraphicState(t))};return e!=null?s(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),Gi(()=>{r=!0,i!=null&&(i.remove(),i=null)})}highlight(t){if(Array.isArray(t))return JS(t.map(i=>this.highlight(i)));if(Ke.isCollection(t))return JS(t.toArray().map(i=>this.highlight(i)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):Gi()}maskOccludee(t){if(!t)return ne.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let i=null,r=!1;const s=n=>{!r&&n!=null&&mUt(n)&&(i=n.maskOccludee(t))};return e!=null?s(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),Gi(()=>{r=!0,i!=null&&(i.remove(),i=null)})}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){this.graphicsView!=null&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await d2(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new B("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((i,r)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(t.layer)&&(s.remove(),this.whenLayerView(t.layer).then(i,r))})}):this.whenLayerView(t.layer)}_initBasemapTerrain(){this._set("basemapTerrain",new KNt({view:this})),this._set("elevationProvider",new jI({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Nc({view:this})),this._set("featureTiles",new sa({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{var i;const e=(i=this.basemapTerrain)==null?void 0:i.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const r=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?V_(kG(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(r):this.featureTiles.filterExtent=r}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>kr.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(oe(()=>import("./FeatureTileTree3DDebugger-BEIdKzph.js"),__vite__mapDeps([212,194]))).then(({FeatureTileTree3DDebugger:i})=>{!this._featureTreeDebugger&&kr.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new i({view:this}))}):e||!this._featureTreeDebugger||kr.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},pr),this.updatingHandles.add(()=>this.clippingArea,t,pr),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,pr)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new qIt(this.map,t));const e=this.state.isGlobal,i=qit(e,t);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",KIt.create(this.state.viewingMode,i)),e||this.addHandles(te(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.extent},r=>{const s=this.renderCoordsHelper.spatialReference;r==null||r[0]===0&&r[1]===0&&r[2]===0&&r[3]===0||!ZG(r,this.basemapTerrain.spatialReference,ewe,s)||(this.renderCoordsHelper.extent=ewe)},lr),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance($P/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){t!=null&&t.type===Nr.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(te(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),lr),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e,i){if(!this.overlay||!this.overlay.hasVisibleItems)return i;const r=t.getContext("2d");return r.putImageData(i,0,0),this.overlay.renderCanvas(t,{disableDecorations:e===rc.OFF}),r.getImageData(0,0,i.width,i.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(r,s,n)=>this._renderScreenshotOverlay(r,s,n)}},e=new DIt(this.state.viewingMode,r=>this._stage.layers.forAll(r),this);this._set("sceneIntersectionHelper",e);const i=WG(this.surface);this._stage=new mh({view:this,options:t,container:i}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,r=>this._stage.renderer.setParameters({highQualityTransparency:r}),pt),this.on("pointer-move",()=>{var r;return(r=this._stage)==null?void 0:r.renderer.resetAnimation()}),fO(this._stage.renderView.canvas,"webglcontextlost",r=>{this.fatalError=new B("webgl-context-lost",r.statusMessage)})],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance($P/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=He(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new x3t({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await oe(async()=>{const{default:i}=await import("./GraphicsView3D-HJTXYTRZ.js");return{default:i}},__vite__mapDeps([213,126,110,111,29,23,24,83]))).default;Dt(t),await d2(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.ready},t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=Ede(this.viewingMode);t===Je.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.addHandles(on(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded();const e=this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties:null,i=e==null?void 0:e.environment;i&&BAe(this.environment,i),this.timeExtent=e==null?void 0:e.timeExtent,this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect(),this._set("textures",new sA(this._stage,this.resourceController.scheduler));const r=this._resolveWhenReady;this._resolveWhenReady=[],r.forEach(s=>s(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._set("textures",He(this.textures)),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(Xb);for(const t of this.map.allLayers.items)RL(t.type)&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(Xb);for(const t of this.map.allLayers.items)RL(t.type)&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}};function K5(t,e){return t!=null&&Kc(t.spatialReference,e)?V_(t,e):null}dt.type="3d",h([p()],dt.prototype,"_userClippingArea",void 0),h([p()],dt.prototype,"_resourceController",void 0),h([p()],dt.prototype,"_stage",void 0),h([p({readOnly:!0})],dt.prototype,"deconflictor",void 0),h([p({readOnly:!0})],dt.prototype,"labeler",void 0),h([p(cX(MP,"analyses"))],dt.prototype,"analyses",void 0),h([p({type:FP,readOnly:!0})],dt.prototype,"animation",null),h([p({readOnly:!0})],dt.prototype,"basemapTerrain",void 0),h([p({readOnly:!0})],dt.prototype,"elevationProvider",void 0),h([p()],dt.prototype,"camera",null),h([p({type:ed})],dt.prototype,"contentCamera",null),h([p({readOnly:!0})],dt.prototype,"canvas",void 0),h([p({type:wt})],dt.prototype,"center",null),h([p({type:dr})],dt.prototype,"clippingArea",null),h([p({type:jT})],dt.prototype,"constraints",void 0),h([p({type:dr,readOnly:!0})],dt.prototype,"renderDataExtent",null),h([p({readOnly:!0})],dt.prototype,"tileInfo",null),h([p({type:dr,readOnly:!0})],dt.prototype,"dataExtent",null),h([p({type:dr,readOnly:!0})],dt.prototype,"_groundAndLayersExtent",null),h([p({type:YC})],dt.prototype,"environment",void 0),h([Qt("environment")],dt.prototype,"castEnvironment",null),h([p({readOnly:!0})],dt.prototype,"environmentManager",void 0),h([p({type:dr})],dt.prototype,"extent",null),h([p()],dt.prototype,"floors",void 0),h([p()],dt.prototype,"screenCenter",null),h([p()],dt.prototype,"frustum",null),h([p({type:Number,readOnly:!0})],dt.prototype,"fullOpacity",void 0),h([p({readOnly:!0})],dt.prototype,"graphicsView",void 0),h([p({readOnly:!0})],dt.prototype,"analysisViewManager",void 0),h([p()],dt.prototype,"groundView",void 0),h([p({type:Boolean})],dt.prototype,"initialExtentRequired",null),h([p()],dt.prototype,"_defaultsFromMapSettings",null),h([p()],dt.prototype,"interacting",null),h([p()],dt.prototype,"stationary",null),h([p()],dt.prototype,"navigating",null),h([p()],dt.prototype,"map",void 0),h([p({readOnly:!0})],dt.prototype,"mapCoordsHelper",void 0),h([p()],dt.prototype,"padding",null),h([p({type:Nc,readOnly:!0})],dt.prototype,"pointsOfInterest",void 0),h([p({type:sa,readOnly:!0})],dt.prototype,"featureTiles",void 0),h([p()],dt.prototype,"_featureTreeDebugger",void 0),h([p({type:Boolean})],dt.prototype,"screenSizePerspectiveEnabled",void 0),h([p({constructOnly:!0})],dt.prototype,"deactivatedWebGLExtensions",void 0),h([p({constructOnly:!0})],dt.prototype,"debugWebGLExtensions",void 0),h([p({constructOnly:!0})],dt.prototype,"renderCanvas",void 0),h([p({constructOnly:!0})],dt.prototype,"state",void 0),h([p({readOnly:!0})],dt.prototype,"inputManager",void 0),h([p({readOnly:!0})],dt.prototype,"stateManager",void 0),h([p({type:["low","medium","high"]})],dt.prototype,"qualityProfile",null),h([p({type:Vve,get(){let t=this._get("qualitySettings");return t||(t=new Vve,cV.apply(this.qualityProfile,t)),t}})],dt.prototype,"qualitySettings",void 0),h([p()],dt.prototype,"slicePlane",null),h([p({readOnly:!0})],dt.prototype,"typeSpecificPreconditionsReady",null),h([p({readOnly:!0})],dt.prototype,"renderCoordsHelper",void 0),h([p({readOnly:!0})],dt.prototype,"sceneIntersectionHelper",void 0),h([p({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],dt.prototype,"resolution",null),h([p({type:Number})],dt.prototype,"scale",null),h([p()],dt.prototype,"heightModelInfo",null),h([p()],dt.prototype,"spatialReference",void 0),h([p({type:Boolean,constructOnly:!0})],dt.prototype,"alphaCompositingEnabled",void 0),h([p({constructOnly:!0})],dt.prototype,"preserveDrawingBufferEnabled",void 0),h([p({type:Boolean})],dt.prototype,"supersampleScreenshotsEnabled",void 0),h([p({readOnly:!0})],dt.prototype,"type",void 0),h([p(),Qt(t=>t instanceof MBe?t:i2(ABe,t))],dt.prototype,"ui",void 0),h([p({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],dt.prototype,"updating",null),h([p()],dt.prototype,"_updatingObjects",null),h([p()],dt.prototype,"_updatingObjectsWithProgress",null),h([p({type:Number,readOnly:!0,dependsOn:["updating"]})],dt.prototype,"updatingProgress",void 0),h([p({type:["global","local"]})],dt.prototype,"viewingMode",null),h([p({type:um})],dt.prototype,"viewpoint",null),h([p({type:Number})],dt.prototype,"zoom",null),h([p({type:TUe})],dt.prototype,"highlightOptions",void 0),h([p({readOnly:!0})],dt.prototype,"quality",null),h([p({readOnly:!0})],dt.prototype,"resolutionScale",null),h([p()],dt.prototype,"textures",void 0),dt=h([I("esri.views.SceneView")],dt);const ek=C(),vW=Os(),ewe=oi(),twe=dt;function V8(t){return e=>{e.hasOwnProperty("_delegatedEventNames")||(e._delegatedEventNames=e._delegatedEventNames?e._delegatedEventNames.slice():[]);const i=e._delegatedEventNames,r=Array.isArray(t)?t:pzt(t);i.push(...r)}}function pzt(t){return t.split(",").map(e=>e.trim())}const PBe=()=>ne.getLogger("esri.widgets.support.geolocationUtils");function fzt(){const t=ue("esri-geolocation");return t||PBe().warn("geolocation-unsupported","Geolocation unsupported."),t}function mzt(){const t=window.isSecureContext;return t||PBe().warn("insecure-context","Geolocation requires a secure origin."),t}function gzt(){return fzt()&&mzt()}function yzt(t,e){const{position:i,view:r}=t,s=_zt(i),n=s==null?void 0:s.coords;if(!n)throw new B("geometry-service:no-coords","Geolocation has no coordinates");return bzt(vzt(n),r,e)}function _zt(t){const e=t&&t.coords||{},i={accuracy:e.accuracy,altitude:e.altitude,altitudeAccuracy:e.altitudeAccuracy,heading:e.heading,latitude:e.latitude,longitude:e.longitude,speed:e.speed};return t&&{coords:i,timestamp:t.timestamp}}function vzt({longitude:t,latitude:e,altitude:i}){return new wt({longitude:t,latitude:e,z:i||void 0,spatialReference:{wkid:4326}})}function bzt(t,e,i){if(!e)return Promise.resolve(t);const r=e.spatialReference;return r.isWGS84?Promise.resolve(t):r.isWebMercator?Promise.resolve(ty(t)):wzt(i).then(s=>{if(!s)throw new B("geometry-service:missing-url","Geometry service URL is missing");const n=new I8({geometries:[t],outSpatialReference:r});return dle(s,n,i).then(o=>o[0])})}function wzt(t){if(nr.geometryServiceUrl)return Promise.resolve(nr.geometryServiceUrl);const e=Kn.getDefault();return e.load(t).catch(()=>{}).then(()=>{var i,r;return(r=(i=e.helperServices)==null?void 0:i.geometry)==null?void 0:r.url})}const xzt=2500,OBe={type:"CIMPictureMarker",primitiveName:"headingOverride",enable:!0,anchorPoint:{x:0,y:-.5},anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:36,billboardMode3D:"FaceNearPlane",invertBackfaceTexture:!0,scaleX:1,textureFilter:"Picture",url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAkCAYAAACe0YppAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAYaSURBVHgBvVfNb1VFFD/nzP16xRYJKYREEiJoDLLShQkrSNzoHv8I2QgxwY8FJWHhxoVxISEu2AordWNiQjAxEBeEsKAmhCCwkPDRAn1t33v33jnH37n3Fam0pa8kTjOde+/MnN/5+J0z85jW08yYTpxgfzx0bS+fO0R0YHqyeb9w7YEtLTv+9rSdOH7ciNleJJJX/Do1JQ3AltdlT35fiN6gG8kD8akdmzO+6w/zM7wdw725rUY78DBXtmATA6PZntFgm9Kjm6o/HFJpdi5Xhp+16sDBC+H+gUmZfjIXHKC+35U42ZHZfpe30BZS7okNFnhu8wTRk2ek5LEV2q+N8nEj6yuNVRjHddftrt4ahyJbOxF+Uppi/Rf47NlA05Pp9vkyRNkkD8sqUJHwOGfSpYFQFXhTJryQBaZSeAxbFus+U1K0gJm2oy3QKwuZzqeuSK5kpW6BEsE6+nCsAHDXQWuaOljzU8uP/ToxUW4KcwKg8QzOSdFL6Swm0hurAC7N2qIW7ncwNgYKF4la3/w7RnzrUK29KseXWqmTKXGl45Zrd9CLrsSjr96fcw4kS46mTsJznSTrVBR6VQJQdDbpZTWexxgCYCFz30cquD8oYVQgtUAUzfo8wGtqGoNRFmFZ1KKulJMQu3Vpm/I8Pup3ekvES57GaabXo4lsszEA6zrkhcmAAkBNshi59O9wVsokBLZUCQAxllXVBkyCDRQuTlLLiLSEqw3gfUqU0kVdsKymsnzyPLm8fXZxDxVZgvUhg9QyaKDI7AhpSlRVEaA83JM+/V8pGO0PMTHyZwra9FQVk4i1e0D6dPK9v5agkmXAhc0Bw5MjlAQQE0lSDbUmbBX4kGfsiiQWuSZtdle1S4F73cUKJgviyw4mmmqlVSoR/FAK2d1noWQZ8N79MySw0tgNzhN00jRFaPM6y3IyLWBxXuOdvMfhaIy1MQctmvnEMGrMq2Y/ekC3dHF14I84gmZP2s0pgiJFHVwYhIIrMC1zgT4fQgsS0CG48LWtslAsgeKZK5U1c5Slj+nEvvJZqOWubr5ks8iE3bVqCMQCz4p5aiUqpMrOdHz2qLFTxAMSPLwY8WpmntNwrXIMCWvESGH+7n9hVi6ZJ6/sR5gnycFFQgsCQEEB8T9TbsCGy4PrZrEBjGyIt4EApoGRXWKP6Mt3fnvOvhWBjR4gdjtJEDmGQQkBSCS6Teys5qECABTPWOBwcPWgAPIU+E2+Rq3J8lsrQawMHNPbqAXvRqasWcMB/mK42N3twM6/FsbJTZK2Fru15K7niPVIp6RHn++9vRKErAg8ta+MFq4LBxAJKY1EajpxLj5KUzFzOMTni4btxoUzXPzIIOwLnEPxGVqlyWoTdO/WNRUXJhDmAgNAJVd0eABj8FTCvLbpEnxdOycJlFNXVq6MDvzthwOQ654LaMGGVofQWIWtXhM9xaCQp85QIZFMPXcpuUPH3uquJj6htVonvySD+KY6c2AulPAzHdVaZElvPCGBgvkIRUECr1J4qmV6LdGyJvAnu+94HZMla1Eg1AuGVyQWnNCwzqsUXK5+AIsUyPRc1Rbpi93X1xK9tsXtkj9U7INWSWvU0DaZ6OlVAmUDiqgbrwY2Z3ThRVKFXrgi/R0x9GMplxAyER6ynAtZin1DQoLVznLMU+/mywMf3dlDpbyMlbjLQDhLw/Sh24sm5dhTrlHKgS/T0X2zLw/sLeGr5OlEbg2uHwAFw5reKuKsJj8kcIj0zq9H5PqAj+z6E8y+YRIaUhnAEOrcWgv9m3shQ1H7mz5duVJtDLhZqZcNlrEDwXKwCzncdFg+PJeVf1m3uPUupLR7Hq6tHNyLhw1TCmdGbm0BmaUjr63LzaMBH943D9f+yO5uZ7HfcLktqdwqMU0jtPUDN6vDOfzgKFrXtta6q83vfHU4M5KoURbT4W3zsPIqrgQFO8GozV8ocZGOTN4dRdRowN6CnOLmKkk5t7H1i+HPNGJj2kj7buYajoRXh2+36eOt+2nENrrF3ozODEmFC0D4hjbQNgYc+DSYjd9qqGSJXqL/tZ16/DWdfvw9bbCt41hcpYn9RAEX9Q22fwC74ny5v9iplQAAAABJRU5ErkJggg=="},Tzt=new G_({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:0},anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:14,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:17,ymax:17},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[8.5,0],[7.02,.13],[5.59,.51],[4.25,1.14],[3.04,1.99],[1.99,3.04],[1.14,4.25],[.51,5.59],[.13,7.02],[0,8.5],[.13,9.98],[.51,11.41],[1.14,12.75],[1.99,13.96],[3.04,15.01],[4.25,15.86],[5.59,16.49],[7.02,16.87],[8.5,17],[9.98,16.87],[11.41,16.49],[12.75,15.86],[13.96,15.01],[15.01,13.96],[15.86,12.75],[16.49,11.41],[16.87,9.98],[17,8.5],[16.87,7.02],[16.49,5.59],[15.86,4.25],[15.01,3.04],[13.96,1.99],[12.75,1.14],[11.41,.51],[9.98,.13],[8.5,0]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Round",joinStyle:"Round",lineStyle3D:"Strip",miterLimit:10,width:2,color:[255,255,255,255]},{type:"CIMSolidFill",enable:!0,color:[0,122,194,255]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:0},anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:16,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:17,ymax:17},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[8.5,0],[7.02,.13],[5.59,.51],[4.25,1.14],[3.04,1.99],[1.99,3.04],[1.14,4.25],[.51,5.59],[.13,7.02],[0,8.5],[.13,9.98],[.51,11.41],[1.14,12.75],[1.99,13.96],[3.04,15.01],[4.25,15.86],[5.59,16.49],[7.02,16.87],[8.5,17],[9.98,16.87],[11.41,16.49],[12.75,15.86],[13.96,15.01],[15.01,13.96],[15.86,12.75],[16.49,11.41],[16.87,9.98],[17,8.5],[16.87,7.02],[16.49,5.59],[15.86,4.25],[15.01,3.04],[13.96,1.99],[12.75,1.14],[11.41,.51],[9.98,.13],[8.5,0]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Round",joinStyle:"Round",lineStyle3D:"Strip",miterLimit:10,width:0,color:[255,255,255,255]},{type:"CIMSolidFill",enable:!0,color:[0,0,0,66]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,offsetX:0,offsetY:-1},OBe],angleAlignment:"Map"},primitiveOverrides:[{type:"CIMPrimitiveOverride",primitiveName:"headingOverride",propertyName:"Rotation",valueExpressionInfo:{type:"CIMExpressionInfo",title:"Rotation override",expression:"360 - $feature.heading",returnType:"Default"}},{type:"CIMPrimitiveOverride",primitiveName:"headingOverride",propertyName:"TintColor",valueExpressionInfo:{type:"CIMExpressionInfo",title:"TintColor override",expression:"IIF(IsEmpty($feature.heading), [255, 255, 255, 0], [255, 255, 255, 1])",returnType:"Default"}}]}});let fg=class extends Jle(Ls.EventedMixin(Ue)){constructor(){super(...arguments),this._geolocationUsable=!0,this.geolocationOptions=null,this.goToLocationEnabled=!0,this.graphic=new ya({symbol:Tzt}),this.scale=null,this.rotationEnabled=!0,this.view=null}initialize(){gzt()||(this._geolocationUsable=!1),this.addHandles([te(()=>{var e;return(e=this.view)==null?void 0:e.type},()=>this._handleViewTypeChange(),pt)])}destroy(){this._clearGraphic(),this.view=null}_clearGraphic(){const{view:e,graphic:i}=this;e&&i&&e.graphics.remove(i)}_addGraphic(){const{view:e,graphic:i}=this;e!=null&&e.graphics&&i&&!e.graphics.includes(i)&&e.graphics.push(i)}_handleViewTypeChange(){var e;OBe.enable=((e=this.view)==null?void 0:e.type)==="2d"}_getScaleWithinConstraints(e,i){if(!i)return e;if(i.type==="2d"){const{effectiveMaxScale:r,effectiveMinScale:s}=i.constraints;return Math.min(s,Math.max(r,e))}return e}_getScale(e){const{scale:i}=this,r=typeof i=="number"?i:xzt;return this._getScaleWithinConstraints(r,e)}_getHeading(e,i){var o;const r=i==null?void 0:i.spatialReference,s=(r==null?void 0:r.isWebMercator)||(r==null?void 0:r.isGeographic),n=(o=e.coords)==null?void 0:o.heading;return!s||typeof n!="number"||isNaN(n)||n<0||n>360?null:n}_addHeading(e){const{heading:i,target:r,view:s}=e;s&&i!==null&&(s.type!=="3d"?s.type==="2d"&&(r.rotation=360-i):r.heading=i)}async _animatePoint(e,i,r,s){const{view:n}=this;if(!this.goToLocationEnabled||!n)return;const o={target:e,scale:i};this.rotationEnabled&&this._addHeading({heading:r,target:o,view:n});const a={signal:s.signal};Dt(a),await this.callGoTo({target:o,options:a})}async updatePosition(e,i){try{const r=this.view,s=await yzt({position:e,view:r},{signal:i.signal}),{graphic:n}=this,{timestamp:o,coords:a}=e,{accuracy:l,altitude:c,altitudeAccuracy:u,latitude:d,longitude:f,speed:m}=a,g=this._getHeading(e,r),y={timestamp:o,accuracy:l,altitude:c,altitudeAccuracy:u,heading:g,latitude:d,longitude:f,speed:m};n&&(n.geometry=s,n.attributes=y);const v=this._getScale(r);await this._animatePoint(s,v,g,i)}catch(r){if(!us(r))throw new B("geolocation-positioning:invalid-point","Cannot position invalid point",{error:r})}return e}};h([p()],fg.prototype,"_geolocationUsable",void 0),h([p()],fg.prototype,"geolocationOptions",void 0),h([p()],fg.prototype,"goToLocationEnabled",void 0),h([p({type:ya,nonNullable:!0})],fg.prototype,"graphic",void 0),h([p()],fg.prototype,"scale",void 0),h([p()],fg.prototype,"rotationEnabled",void 0),h([p()],fg.prototype,"view",void 0),fg=h([I("esri.widgets.support.GeolocationPositioning")],fg);const Szt=fg,Ezt=15e3;let Rd=class extends Szt{constructor(e){super(e),this._watchId=void 0,this._trackStartingTimeoutId=void 0,this._settingPosition=null,this._trackController=null,this.error=void 0,this.positionFilterFunction=null}destroy(){this._stopTracking()}get state(){return this._geolocationUsable?this.view&&!this.view.ready?"disabled":this._settingPosition||this._trackStartingTimeoutId!==void 0?"waiting":this.tracking?"tracking":this.error!=null?"error":"ready":"feature-unsupported"}get tracking(){return this._watchId!==void 0}start(){this.state!=="disabled"&&this.state!=="feature-unsupported"&&this._startTracking()}stop(){this.state!=="disabled"&&this.state!=="feature-unsupported"&&this._stopTracking()}_stopWatchingPosition(){this._watchId!==void 0&&(navigator.geolocation.clearWatch(this._watchId),this._watchId=void 0)}_stopTracking(){this._abortTrack(),this._clearWaitingTimer(),this._stopWatchingPosition(),this._clearGraphic()}_startTracking(){this._stopTracking();const e=d_(async i=>{this._abortTrack();const r=new AbortController;this._trackController=r;const{timestamp:s,coords:n}=i,o={timestamp:s,coords:{...n}};this.error=void 0;try{if(typeof this.positionFilterFunction=="function"&&!this.positionFilterFunction.call(null,{position:o})||(await this.updatePosition(i,r),this._trackController!==r))return;this._clearWaitingTimer(),this._addGraphic(),this.emit("track",{position:i}),this._trackController=null}catch(a){if(us(a))return;throw this._trackController=null,this._emitError(a),this._clearWaitingTimer(),a}},0);this._watchId=navigator.geolocation.watchPosition(i=>{this._settingPosition=e(i).catch(h_)},this._handleWatchPositionError.bind(this),this.geolocationOptions??void 0),this._trackStartingTimeoutId=setTimeout(()=>{this._trackStartingTimeoutId=void 0},Ezt)}_handleWatchPositionError(e){e.code===e.PERMISSION_DENIED&&this._stopTracking(),this._emitError(e)}_abortTrack(){var e;(e=this._trackController)==null||e.abort(),this._trackController=null}_clearWaitingTimer(){clearTimeout(this._trackStartingTimeoutId),this._trackStartingTimeoutId=void 0,this._settingPosition=null}_emitError(e){this.error=e,this.emit("track-error",{error:e})}};h([p()],Rd.prototype,"_watchId",void 0),h([p()],Rd.prototype,"_trackStartingTimeoutId",void 0),h([p()],Rd.prototype,"_settingPosition",void 0),h([p()],Rd.prototype,"error",void 0),h([p()],Rd.prototype,"positionFilterFunction",void 0),h([p({readOnly:!0})],Rd.prototype,"state",null),h([p({readOnly:!0})],Rd.prototype,"tracking",null),h([p()],Rd.prototype,"start",null),h([p()],Rd.prototype,"stop",null),Rd=h([I("esri.widgets.Track.TrackViewModel")],Rd);const $Be=Rd,Czt={base:"esri-track"};let Ic=class extends Wo{constructor(e,i){super(e,i),this.messages=null,this.viewModel=new $Be,this._toggleTracking=()=>{const r=this.viewModel;r&&r.state!=="feature-unsupported"&&r.state!=="disabled"&&(r.state!=="tracking"&&r.state!=="waiting"?this.viewModel.start():this.viewModel.stop())}}loadDependencies(){return Cp({button:()=>oe(()=>import("./calcite-button-wzbJSjju.js"),__vite__mapDeps([198,199,200,201,202,203,204,205,206,207,208,209,210])),tooltip:()=>oe(()=>import("./calcite-tooltip-BQEWocaS.js"),__vite__mapDeps([214,200,201,215,216,217,218]))})}get geolocationOptions(){return this.viewModel.geolocationOptions}set geolocationOptions(e){this.viewModel.geolocationOptions=e}get goToLocationEnabled(){return this.viewModel.goToLocationEnabled}set goToLocationEnabled(e){this.viewModel.goToLocationEnabled=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get icon(){return"compass-north-circle"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get rotationEnabled(){return this.viewModel.rotationEnabled}set rotationEnabled(e){this.viewModel.rotationEnabled=e}get scale(){return this.viewModel.scale}set scale(e){this.viewModel.scale=e}get tracking(){return this.viewModel.tracking}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}start(){this.viewModel.start()}stop(){this.viewModel.stop()}render(){var u;const{viewModel:e,messages:i,icon:r}=this,s=e==null?void 0:e.state,n=s==="tracking",o=this._localizeError((u=this.viewModel)==null?void 0:u.error),a=(n?i==null?void 0:i.stopTracking:i==null?void 0:i.startTracking)??"",l=s==="feature-unsupported",c=(s==="tracking"?"pause":void 0)??r;return Q("div",{class:this.classes(Czt.base,Jt.widget)},!l&&Q("calcite-button",{class:Jt.widgetButton,disabled:s==="disabled",iconStart:c,kind:"neutral",label:a,loading:s==="waiting",onclick:this._toggleTracking,title:a}),o?Q("calcite-tooltip",{open:!0,overlayPositioning:"fixed",referenceElement:this.container},o):null)}_localizeError(e){var i,r,s;return e instanceof GeolocationPositionError?e.code===GeolocationPositionError.PERMISSION_DENIED?(i=this.messages)==null?void 0:i.permissionError:e.code===GeolocationPositionError.TIMEOUT?(r=this.messages)==null?void 0:r.timeoutError:(s=this.messages)==null?void 0:s.positionUnavailable:e instanceof Error?e.message:void 0}};h([p()],Ic.prototype,"geolocationOptions",null),h([p()],Ic.prototype,"goToLocationEnabled",null),h([p()],Ic.prototype,"goToOverride",null),h([p()],Ic.prototype,"graphic",null),h([p()],Ic.prototype,"icon",null),h([p()],Ic.prototype,"label",null),h([p(),qo("esri/widgets/Track/t9n/Track")],Ic.prototype,"messages",void 0),h([p()],Ic.prototype,"rotationEnabled",null),h([p()],Ic.prototype,"scale",null),h([p({readOnly:!0})],Ic.prototype,"tracking",null),h([p()],Ic.prototype,"view",null),h([p({type:$Be}),V8(["track","track-error"])],Ic.prototype,"viewModel",void 0),Ic=h([I("esri.widgets.Track")],Ic);const Mzt=Ic;function jj(t,e,i,r){let s=null,n=1e3;typeof e=="number"?(n=e,r=i):(s=e??null,n=i);let o,a=0;const l=()=>{a=0,t.apply(r,o)},c=(...u)=>{s&&s.apply(r,u),o=u,n?a||(a=setTimeout(l,n)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}function ate(t){var e;switch(t==null?void 0:t.type){case"point":return t;case"extent":return t.center;case"polygon":return t.centroid;case"multipoint":case"polyline":return(e=t.extent)==null?void 0:e.center;default:return null}}function iwe(t){return t.icon?t.icon:"image"in t&&t.image||t.className?void 0:"question"}function RBe(t){return t?{backgroundImage:`url(${t})`}:{}}function Azt({action:t,feature:e}){const i=e==null?void 0:e.attributes,r="image"in t?t.image:void 0;return r&&i?Pg(r,i):r??""}function IBe(t,e,i){return t.units[e][i]}function GO(t,e,i,r=2,s="abbr"){return`${nc(e,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:e>0?"never":"exceptZero"})} ${IBe(t,i,s)}`}function z8(t,e,i,r=2,s="abbr"){return`${nc(e,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:"exceptZero"})} ${IBe(t,i,s)}`}function efi(t,e,i,r=2,s="abbr"){const n=Yre(e,i);return GO(t,Br(e,i,n),n,r,s)}function tfi(t,e,i,r=2,s="abbr"){const n=Yre(e,i);return z8(t,Br(e,i,n),n,r,s)}function ifi(t,e,i,r=2,s="abbr"){const n=Xre(e,i);return GO(t,Br(e,i,n),n,r,s)}function rfi(t,e,i,r=2,s="abbr"){const n=Xre(e,i);return z8(t,Br(e,i,n),n,r,s)}function sfi(t,e,i,r=2,s="abbr"){const n=Jre(e,i);return GO(t,Br(e,i,n),n,r,s)}function nfi(t,e,i,r=2,s="abbr"){const n=Jre(e,i);return z8(t,Br(e,i,n),n,r,s)}function ofi(t,e,i,r=2,s="abbr"){const n=Qre(e,i);return GO(t,Br(e,i,n),n,r,s)}function afi(t,e,i,r=2,s="abbr"){const n=Qre(e,i);return z8(t,Br(e,i,n),n,r,s)}function lfi(t,e,i,r=2,s="abbr"){const n=vYe(e,i);return GO(t,Br(e,i,n),n,r,s)}function cfi(t,e,i,r=2,s="abbr"){const n=bYe(e,i);return GO(t,Br(e,i,n),n,r,s)}const Pzt=(t,e)=>({style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:e,minimumFractionDigits:e,signDisplay:t>0?"never":"exceptZero"});function ufi(t,e,i,r,s,n=BG,o=!0){let a=n.normalize(jct(Br(t,e,"degrees"),i,r),0,o);const l=Pzt(a,s??2);return a=LBe(a,l),nc(a,l)}function hfi(t,e,i,r,s){i!==r&&(t=-t);const n={style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:s=s??2,minimumFractionDigits:s,signDisplay:"exceptZero"};let o=Br(t,e,"degrees")%360;return o=LBe(o,n),nc(o,n)}const rwe=new Map;function LBe(t,e){const i=JSON.stringify(e);let r=rwe.get(i);return r||(r=new Intl.NumberFormat("en-US",e),rwe.set(i,r)),/^[-+]?360\.?0*°?$/.test(r.format(t))?0:t}const swe=["B","kB","MB","GB","TB"];function Ozt(t,e){let i=(e=Math.round(e))===0?0:Math.floor(Math.log(e)/Math.log(wD.KILOBYTES));i=Ne(i,0,swe.length-1);const r=nc(e/wD.KILOBYTES**i,{maximumFractionDigits:2});return py(t.units.bytes[swe[i]],{fileSize:r})}function $zt(t){const{exifInfo:e,exifName:i,tagName:r}=t;if(!e||!i||!r)return null;const s=e.find(n=>n.name===i);return s?Rzt({tagName:r,tags:s.tags}):null}function Rzt(t){const{tagName:e,tags:i}=t;if(!i||!e)return null;const r=i.find(s=>s.name===e);return(r==null?void 0:r.value)||null}var lte;const Izt={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let du=lte=class extends Se{constructor(t){super(t),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:t}=this,e=$zt({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:t});return Izt[e]||null}clone(){return new lte({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};h([p({type:String})],du.prototype,"contentType",void 0),h([p()],du.prototype,"exifInfo",void 0),h([p({readOnly:!0})],du.prototype,"orientationInfo",null),h([p({type:Ji})],du.prototype,"id",void 0),h([p({type:String})],du.prototype,"globalId",void 0),h([p({type:String})],du.prototype,"keywords",void 0),h([p({type:String})],du.prototype,"name",void 0),h([p({json:{read:!1}})],du.prototype,"parentGlobalId",void 0),h([p({json:{read:!1}})],du.prototype,"parentObjectId",void 0),h([p({type:Ji})],du.prototype,"size",void 0),h([p({json:{read:!1}})],du.prototype,"url",void 0),du=lte=h([I("esri.rest.query.support.AttachmentInfo")],du);const Lzt=du;var cte;let Ca=cte=class extends Se{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new cte(re({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};h([p({type:[String],json:{write:!0}})],Ca.prototype,"attachmentTypes",void 0),h([p({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],Ca.prototype,"attachmentsWhere",void 0),h([p({type:Boolean,json:{write:!0}})],Ca.prototype,"cacheHint",void 0),h([p({type:[String],json:{write:!0}})],Ca.prototype,"keywords",void 0),h([p({type:[Number],json:{write:!0}})],Ca.prototype,"globalIds",void 0),h([p({json:{write:!0}})],Ca.prototype,"name",void 0),h([p({type:Number,json:{read:{source:"resultRecordCount"}}})],Ca.prototype,"num",void 0),h([p({type:[Number],json:{write:!0}})],Ca.prototype,"objectIds",void 0),h([p({type:Boolean,json:{default:!1,write:!0}})],Ca.prototype,"returnMetadata",void 0),h([p({type:[Number],json:{write:!0}})],Ca.prototype,"size",void 0),h([p({type:Number,json:{read:{source:"resultOffset"}}})],Ca.prototype,"start",void 0),h([Ze("start"),Ze("num")],Ca.prototype,"writeStart",null),h([p({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Ca.prototype,"where",void 0),Ca=cte=h([I("esri.rest.support.AttachmentQuery")],Ca),Ca.from=nn(Ca);const ute=Ca;function DBe(t){return mne(t)||Lat(t)||Dat(t)}function Qle(t,e){const{format:i,timeZoneOptions:r,fieldType:s}=e??{};let n,o;if(r&&({timeZone:n,timeZoneName:o}=b2e(r.layerTimeZone,r.datesInUnknownTimezone,r.viewTimeZone,W1(i||"short-date-short-time"),s)),typeof t=="string"&&isNaN(Date.parse(s==="time-only"?`1970-01-01T${t}Z`:t)))return t;switch(s){case"date-only":{const a=W1(i||"short-date");return typeof t=="string"?L9e(t,{...a}):ku(t,{...a,timeZone:dy})}case"time-only":{const a=W1(i||"short-time");return typeof t=="string"?D9e(t,a):ku(t,{...a,timeZone:dy})}case"timestamp-offset":{if(!n&&typeof t=="string"&&new Date(t).toISOString()!==t)return t;const a=i||r?W1(i||"short-date-short-time"):void 0,l=a?{...a,timeZone:n,timeZoneName:o}:void 0;return typeof t=="string"?N9e(t,l):ku(t,l)}default:{const a=i||r?W1(i||"short-date-short-time"):void 0;return ku(typeof t=="string"?new Date(t):t,a?{...a,timeZone:n,timeZoneName:o}:void 0)}}}const Dzt="esri.widgets.Feature.support.featureUtils",hte=()=>ne.getLogger(Dzt),Nzt=/href=(""|'')/gi,Fzt=/(\{([^{\r\n]+)\})/g,kzt=/'/g,NBe=/^\s*expression\//i,Uzt=/(\n)/gi,Vzt=/[\u00A0-\u9999<>&]/gim,zzt=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,Bzt=/^(?:mailto:|tel:)/,FBe="relationships/",nwe=W1("short-date-short-time");function kBe(t){if(t!=null)return(t.sourceLayer||t.layer)??void 0}async function Gj({type:t,value:e,event:i}){try{return typeof e=="function"?e(i):e}catch(r){return void hte().error("error",`An error occurred when calling the "${t}" function`,{error:r,graphic:i.graphic,value:e})}}function UBe(t=""){if(t)return!Bzt.test(t.trim().toLowerCase())}function Kle(t){return!!t&&NBe.test(t)}function jzt(t,e){if(!e||!Kle(e)||!t)return;const i=e.replace(NBe,"").toLowerCase();return t.find(({name:r})=>r.toLowerCase()===i)}function VBe(t,e){const i=jzt(e,t==null?void 0:t.fieldName);return i?i.title||null:t?t.label||t.fieldName:null}function Gzt(t,e){const i=e.get(t.toLowerCase());return`{${(i==null?void 0:i.fieldName)||t}}`}function Hzt(t){return t.replaceAll(Nzt,"")}function MD(t,e){const i=ece(e,t);return i?i.name:t}function qzt(t,e){return t&&t.map(i=>MD(i,e))}function ece(t,e){return t&&typeof t.getField=="function"&&e?t.getField(e)??null:null}function zBe(t){return`${t}`.trim()}function gS({attributes:t,globalAttributes:e,layer:i,text:r,expressionAttributes:s,fieldInfoMap:n}){return r?dte({formattedAttributes:e,template:Xzt(r,{...e,...s,...t},i),fieldInfoMap:n}):""}function dte({formattedAttributes:t,template:e,fieldInfoMap:i}){return zBe(Hzt(py(py(e,r=>Gzt(r,i)),t)))}function Wzt(t,e,i=!1){const r=e[t];if(typeof r=="string"){const s="%27",n=(i?encodeURIComponent(r):r).replaceAll(kzt,s);e[t]=n}}function Zzt(t,e=!1){const i={...t};return Object.keys(i).forEach(r=>Wzt(r,i,e)),i}function Yzt(t,e,i){const r=(e=zBe(e))&&e[0]!=="{";return py(t,Zzt(i,r||!1))}function pte(t,e){return t.replaceAll(Fzt,(i,r,s)=>{const n=ece(e,s);return n?`{${n.name}}`:r})}function Xzt(t,e,i){const r=pte(t,i);return r&&r.replaceAll(zzt,(s,n,o)=>Yzt(s,n||o,e))}function Jzt(t,e){if(typeof t=="string"&&e&&e.dateFormat==null&&(e.places!=null||e.digitSeparator!=null)){const i=Number(t);if(!isNaN(i))return i}return t}function Qzt(t){return t!=null&&typeof t=="object"&&"fieldsIndex"in t&&"geometryType"in t&&"getField"in t&&"load"in t&&"loaded"in t&&"objectIdField"in t&&"spatialReference"in t&&"type"in t&&(t.type==="feature"||t.type==="scene"||t.type==="sublayer")&&"when"in t}function Kzt(t){return t!=null&&typeof t=="object"&&"createQuery"in t&&"queryFeatureCount"in t&&"queryObjectIds"in t&&"queryRelatedFeatures"in t&&"queryRelatedFeaturesCount"in t&&"relationships"in t}function BBe(t){return Qzt(t)&&Kzt(t)}function eBt(t,e){var u;const{fieldInfos:i,fieldName:r,preventPlacesFormatting:s,layer:n,timeZone:o}=e,a=jBe(i,r),l=ece(n,r);if(a&&!$X(r)){const d=l==null?void 0:l.type,f=(u=a.format)==null?void 0:u.dateFormat;if(d==="date"||d==="date-only"||d==="time-only"||d==="timestamp-offset"||f)return Qle(t,{format:f,fieldType:d,timeZoneOptions:{layerTimeZone:n&&"preferredTimeZone"in n?n.preferredTimeZone:null,viewTimeZone:o,datesInUnknownTimezone:!(!n||!("datesInUnknownTimezone"in n))&&!!n.datesInUnknownTimezone}})}const c=a==null?void 0:a.format;return typeof t=="string"&&$X(r)&&c?tBt(t,c):typeof(t=Jzt(t,c))=="string"||t==null||c==null?BN(t):nc(t,s?{...mz(c),minimumFractionDigits:0,maximumFractionDigits:20}:mz(c))}function tBt(t,e){return t=t.trim(),/\d{2}-\d{2}/.test(t)?t:t.includes(",")?bW(t,",",", ",e):t.includes(";")?bW(t,";","; ",e):t.includes(" ")?bW(t," "," ",e):nc(Number(t),mz(e))}function bW(t,e,i,r){return t.trim().split(e).map(s=>nc(Number(s),mz(r))).join(i)}function jBe(t,e){if(t!=null&&t.length&&e)return t.find(i=>{var r;return((r=i.fieldName)==null?void 0:r.toLowerCase())===e.toLowerCase()})}function iBt({fieldName:t,graphic:e,layer:i}){if(c_(t)||!i||typeof i.getFeatureType!="function")return null;const{typeIdField:r}=i;if(!r||t!==r)return null;const s=i.getFeatureType(e);return s?s.name:null}function rBt({fieldName:t,value:e,graphic:i,layer:r}){if(c_(t)||!r||typeof r.getFieldDomain!="function")return null;const s=i&&r.getFieldDomain(t,{feature:i});return s&&s.type==="coded-value"?s.getName(e):null}function sBt(t,e,i,r){const{creatorField:s,creationDateField:n,editorField:o,editDateField:a}=t;if(!e)return;const l=b2e(r&&"preferredTimeZone"in r?r.preferredTimeZone:null,!(!r||!("datesInUnknownTimezone"in r))&&!!r.datesInUnknownTimezone,i,nwe,"date"),c={...nwe,...l},u=e[a];if(typeof u=="number"){const f=e[o];return{type:"edit",date:ku(u,c),user:f}}const d=e[n];if(typeof d=="number"){const f=e[s];return{type:"create",date:ku(d,c),user:f}}return null}function nBt(t,e){const i=new Map;if(!t)return i;for(const r of t){if(!r.fieldName)continue;const s=MD(r.fieldName,e);r.fieldName=s,i.set(s.toLowerCase(),r)}return i}function owe(t){const e=[];if(!t)return e;const{fieldInfos:i,content:r}=t;return i&&e.push(...i),r&&Array.isArray(r)&&r.forEach(s=>{if(s.type==="fields"){const n=s==null?void 0:s.fieldInfos;n&&e.push(...n)}}),e}function tce(t){return t.replaceAll(Vzt,e=>`&#${e.charCodeAt(0)};`)}function BN(t){return typeof t=="string"?t.replaceAll(Uzt,'<br class="esri-text-new-line" />'):t}function GBe(t){var d;const{value:e,fieldName:i,fieldInfos:r,fieldInfoMap:s,layer:n,graphic:o,timeZone:a}=t;if(e==null)return"";const l=rBt({fieldName:i,value:e,graphic:o,layer:n});if(l)return l;const c=iBt({fieldName:i,graphic:o,layer:n});if(c)return c;if(s.get(i.toLowerCase()))return eBt(e,{fieldInfos:r||Array.from(s.values()),fieldName:i,layer:n,timeZone:a});const u=(d=n==null?void 0:n.fieldsIndex)==null?void 0:d.get(i);return u&&(DBe(u)||gne(u))?Qle(e,{fieldType:u.type,timeZoneOptions:{layerTimeZone:n&&"preferredTimeZone"in n?n.preferredTimeZone:null,viewTimeZone:a,datesInUnknownTimezone:!(!n||!("datesInUnknownTimezone"in n))&&!!n.datesInUnknownTimezone}}):BN(e)}function wW({fieldInfos:t,attributes:e,layer:i,graphic:r,fieldInfoMap:s,relatedInfos:n,timeZone:o}){const a={};return n==null||n.forEach(l=>cBt({attributes:a,relatedInfo:l,fieldInfoMap:s,fieldInfos:t,layer:i,timeZone:o})),e&&Object.keys(e).forEach(l=>{const c=e[l];a[l]=GBe({fieldName:l,fieldInfos:t,fieldInfoMap:s,layer:i,value:c,graphic:r,timeZone:o})}),a}async function HBe(t,e){var u,d;const{layer:i,graphic:r,outFields:s,objectIds:n,returnGeometry:o,spatialReference:a}=t,l=n[0];if(typeof l!="number"&&typeof l!="string"){const f="Could not query required fields for the specified feature. The feature's ID is invalid.",m={layer:i,graphic:r,objectId:l,requiredFields:s};return hte().warn(f,m),null}if(!((d=(u=SCe(i))==null?void 0:u.operations)!=null&&d.supportsQuery)){const f="The specified layer cannot be queried. The following fields will not be available.",m={layer:i,graphic:r,requiredFields:s,returnGeometry:o};return hte().warn(f,m),null}const c=i.createQuery();return c.objectIds=n,c.outFields=s!=null&&s.length?s:[i.objectIdField],c.returnGeometry=!!o,c.returnZ=!!o,c.returnM=!!o,c.outSpatialReference=a,(await i.queryFeatures(c,e)).features[0]}async function oBt(t){var r;if(!((r=t.expressionInfos)!=null&&r.length))return!1;const e=await by(),{arcadeUtils:{hasGeometryFunctions:i}}=e;return i(t)}async function aBt({graphic:t,popupTemplate:e,layer:i,spatialReference:r},s){if(!i||!e||(typeof i.load=="function"&&await i.load(s),!t.attributes))return;const n=i.objectIdField,o=t.attributes[n];if(o==null)return;const a=[o],l=await e.getRequiredFields(i.fieldsIndex),c=jat(l,t),u=c?[]:l.includes(n)?l:[...l,n],d=e.returnGeometry||await oBt(e);if(c&&!d)return;const f=await HBe({layer:i,graphic:t,outFields:u,objectIds:a,returnGeometry:d,spatialReference:r},s);f&&(f.geometry&&(t.geometry=f.geometry),f.attributes&&(t.attributes={...t.attributes,...f.attributes}))}function c_(t=""){return!!t&&t.includes(FBe)}function lBt(t){return t?`${FBe}${t.layerId}/${t.fieldName}`:""}function awe({attributes:t,graphic:e,relatedInfo:i,fieldInfos:r,fieldInfoMap:s,layer:n,timeZone:o}){t&&e&&i&&Object.keys(e.attributes).forEach(a=>{const l=lBt({layerId:i.relation.id.toString(),fieldName:a}),c=e.attributes[a];t[l]=GBe({fieldName:l,fieldInfos:r,fieldInfoMap:s,layer:n,value:c,graphic:e,timeZone:o})})}function cBt({attributes:t,relatedInfo:e,fieldInfoMap:i,fieldInfos:r,layer:s,timeZone:n}){var o,a;t&&e&&((o=e.relatedFeatures)==null||o.forEach(l=>awe({attributes:t,graphic:l,relatedInfo:e,fieldInfoMap:i,fieldInfos:r,layer:s,timeZone:n})),(a=e.relatedStatsFeatures)==null||a.forEach(l=>awe({attributes:t,graphic:l,relatedInfo:e,fieldInfoMap:i,fieldInfos:r,layer:s,timeZone:n})))}const lwe=t=>{if(!t)return!1;const e=t.toUpperCase();return e.includes("CURRENT_TIMESTAMP")||e.includes("CURRENT_DATE")||e.includes("CURRENT_TIME")},qBe=({layer:t,method:e,query:i,definitionExpression:r})=>{var o,a;if(!((a=(o=t.capabilities)==null?void 0:o.query)!=null&&a.supportsCacheHint)||e==="attachments")return;const s=i.where!=null?i.where:null,n=i.geometry!=null?i.geometry:null;lwe(r)||lwe(s)||(n==null?void 0:n.type)==="extent"||i.resultType==="tile"||(i.cacheHint=!0)},uBt=({query:t,layer:e,method:i})=>{qBe({layer:e,method:i,query:t,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression??""}`})},hBt=({queryPayload:t,layer:e,method:i})=>{qBe({layer:e,method:i,query:t,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression??""}`})};function dBt(t,e,i){var r,s;return t&&e&&i?e.type==="sublayer"?cA({layers:(r=e.layer)==null?void 0:r.sublayers,map:t,relatedLayer:e,relationship:i})||cA({layers:(s=e.layer)==null?void 0:s.subtables,map:t,relatedLayer:e,relationship:i}):cA({layers:t.allLayers,map:t,relatedLayer:e,relationship:i})||cA({layers:t.allTables,map:t,relatedLayer:e,relationship:i}):null}function cwe(t,e){return t==null?void 0:t.allTables.find(i=>{var r;return i.type==="feature"&&i.layerId===e.id&&i.url===((r=e.layer)==null?void 0:r.url)})}function cA({map:t,relationship:e,relationship:{relatedTableId:i},relatedLayer:r,layers:s}){var n;if(!s)return null;for(const o of s){if(o.type==="map-image"){const l=cA({layers:o.sublayers,map:t,relatedLayer:r,relationship:e})||cA({layers:o.subtables,map:t,relatedLayer:r,relationship:e});if(l)return l;continue}if(!BBe(o))continue;if(r.type==="sublayer"){if(o!==r&&o.id===i)return o.isTable?cwe(t,o):o;continue}const a=r.type==="scene"&&r.associatedLayer?r.associatedLayer.url:r.url;if(!a)return null;if(o.type!=="sublayer"){if(o!==r&&o.url===a&&o.layerId===i)return o}else if(o!==r&&((n=o.layer)==null?void 0:n.url)===a&&o.id===i)return o.isTable?cwe(t,o):o}return null}const uwe={editing:!1,operations:{add:!0,update:!0,delete:!0}},WBe=Ke.ofType(Lzt);let pu=class extends Ue{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities={...uwe},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new WBe,this.fileInfos=new Ke,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles(te(()=>this.graphic,()=>this._graphicChanged(),pt))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(e){return{...uwe,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:e}=this;if(!e)return!1;const i=e.layer||e.sourceLayer;return(i==null?void 0:i.loaded)&&"capabilities"in i&&i.capabilities&&"operations"in i.capabilities&&"supportsResizeAttachments"in i.capabilities.operations&&i.capabilities.operations.supportsResizeAttachments||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:i}=this;if(!e||typeof e.queryAttachments!="function")throw new B("invalid-layer","getAttachments(): A valid layer is required.");const r=this._getObjectId(),s=new ute({objectIds:[r],returnMetadata:!0}),n=[],o=e.queryAttachments(s).then(l=>l[r]||n).catch(()=>n);this._getAttachmentsPromise=o,this.notifyChange("state");const a=await o;return i.destroyAll(),a.length&&i.addMany(a),this._getAttachmentsPromise=null,this.notifyChange("state"),a}async addAttachment(e,i=this.graphic){var l;const{_attachmentLayer:r,attachmentInfos:s,capabilities:n}=this;if(!i)throw new B("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:i});if(!e)throw new B("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!((l=n.operations)!=null&&l.add))throw new B("invalid-capabilities","addAttachment(): add capabilities are required.");if(!r||typeof r.addAttachment!="function")throw new B("invalid-layer","addAttachment(): A valid layer is required.");const o=r.addAttachment(i,e).then(c=>this._queryAttachment(c.objectId,i)),a=await o;return s.add(a),a}async deleteAttachment(e){var l;const{_attachmentLayer:i,attachmentInfos:r,graphic:s,capabilities:n}=this;if(!e)throw new B("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!((l=n.operations)!=null&&l.delete))throw new B("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!i||typeof i.deleteAttachments!="function")throw new B("invalid-layer","deleteAttachment(): A valid layer is required.");if(!s)throw new B("invalid-graphic","deleteAttachment(): A graphic is required.");const o=i.deleteAttachments(s,[e.id]).then(()=>e),a=await o;return r.remove(a),a.destroy(),a}async updateAttachment(e,i=this.activeAttachmentInfo){var u;const{_attachmentLayer:r,attachmentInfos:s,graphic:n,capabilities:o}=this;if(!e)throw new B("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!i)throw new B("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:i});if(!((u=o.operations)!=null&&u.update))throw new B("invalid-capabilities","updateAttachment(): Update capabilities are required.");const a=s.indexOf(i);if(!r||typeof r.updateAttachment!="function")throw new B("invalid-layer","updateAttachment(): A valid layer is required.");if(!n)throw new B("invalid-graphic","updateAttachment(): A graphic is required.");const l=r.updateAttachment(n,i.id,e).then(d=>this._queryAttachment(d.objectId)),c=await l;return s.splice(a,1,c),c}async commitFiles(){return await Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,i){if(!e||!i)return null;const r={file:e,form:i};return this.fileInfos.add(r),r}updateFile(e,i,r=this.activeFileInfo){if(!e||!i||!r)return null;const s=this.fileInfos.indexOf(r);return s>-1&&this.fileInfos.splice(s,1,{file:e,form:i}),this.fileInfos.items[s]}deleteFile(e){const i=this.fileInfos.find(r=>r.file===e);return i?(this.fileInfos.remove(i),i):null}async _queryAttachment(e,i){const{_attachmentLayer:r}=this;if(!e||!(r!=null&&r.queryAttachments))throw new B("invalid-attachment-id","Could not query attachment.");const s=this._getObjectId(i),n=new ute({objectIds:[s],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return r.queryAttachments(n).then(o=>o[s][0])}_getObjectId(e=this.graphic){return(e==null?void 0:e.getObjectId())??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,i=kBe(e);this._attachmentLayer=i?i.type==="scene"&&i.associatedLayer!=null?i.associatedLayer:i:null}};h([p()],pu.prototype,"capabilities",void 0),h([Qt("capabilities")],pu.prototype,"castCapabilities",null),h([p()],pu.prototype,"activeAttachmentInfo",void 0),h([p()],pu.prototype,"activeFileInfo",void 0),h([p({readOnly:!0,type:WBe})],pu.prototype,"attachmentInfos",void 0),h([p()],pu.prototype,"fileInfos",void 0),h([p({type:ya})],pu.prototype,"graphic",void 0),h([p()],pu.prototype,"mode",void 0),h([p({readOnly:!0})],pu.prototype,"state",null),h([p()],pu.prototype,"filesEnabled",void 0),h([p({readOnly:!0})],pu.prototype,"supportsResizeAttachments",null),pu=h([I("esri.widgets.Attachments.AttachmentsViewModel")],pu);const ice=pu;function hwe(t){const e=t.toLowerCase();return e==="image/bmp"||e==="image/emf"||e==="image/exif"||e==="image/gif"||e==="image/x-icon"||e==="image/jpeg"||e==="image/png"||e==="image/tiff"||e==="image/x-wmf"}function pBt(t){const e=tr("esri/themes/base/images/files/");return t?t==="text/plain"?`${e}text-32.svg`:t==="application/pdf"?`${e}pdf-32.svg`:t==="text/csv"?`${e}csv-32.svg`:t==="application/gpx+xml"?`${e}gpx-32.svg`:t==="application/x-dwf"?`${e}cad-32.svg`:t==="application/postscript"||t==="application/json"||t==="text/xml"||t==="model/vrml"?`${e}code-32.svg`:t==="application/x-zip-compressed"||t==="application/x-7z-compressed"||t==="application/x-gzip"||t==="application/x-tar"||t==="application/x-gtar"||t==="application/x-bzip2"||t==="application/gzip"||t==="application/x-compress"||t==="application/x-apple-diskimage"||t==="application/x-rar-compressed"||t==="application/zip"?`${e}zip-32.svg`:t.includes("image/")?`${e}image-32.svg`:t.includes("audio/")?`${e}sound-32.svg`:t.includes("video/")?`${e}video-32.svg`:t.includes("msexcel")||t.includes("ms-excel")||t.includes("spreadsheetml")?`${e}excel-32.svg`:t.includes("msword")||t.includes("ms-word")||t.includes("wordprocessingml")?`${e}word-32.svg`:t.includes("powerpoint")||t.includes("presentationml")?`${e}report-32.svg`:`${e}generic-32.svg`:`${e}generic-32.svg`}const r_={checkMark:"esri-icon-check-mark",close:"esri-icon-close",collapse:"esri-icon-collapse",down:"esri-icon-down",downArrow:"esri-icon-down-arrow",dragHorizontal:"esri-icon-drag-horizontal",dragVertical:"esri-icon-drag-vertical",duplicate:"esri-icon-duplicate",expand:"esri-icon-expand",fontFallbackText:"esri-icon-font-fallback-text",forward:"esri-icon-forward",handleVertical:"esri-icon-handle-vertical",icon:"esri-icon",left:"esri-icon-left",loadingIndicator:"esri-icon-loading-indicator",locateCircled:"esri-icon-locate-circled",minus:"esri-icon-minus",noticeTriangle:"esri-icon-notice-triangle",pause:"esri-icon-pause",play:"esri-icon-play",plus:"esri-icon-plus",radioChecked:"esri-icon-radio-checked",radioUnchecked:"esri-icon-radio-unchecked",refresh:"esri-icon-refresh",reverse:"esri-icon-reverse",right:"esri-icon-right",search:"esri-icon-search",swap:"esri-icon-swap",table:"esri-icon-table",trash:"esri-icon-trash",up:"esri-icon-up",upArrow:"esri-icon-up-arrow",upDownArrows:"esri-icon-up-down-arrows",urbanModel:"esri-icon-urban-model",zoomInMagnifyingGlass:"esri-icon-zoom-in-magnifying-glass",zoomToObject:"esri-icon-zoom-to-object"},dwe={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},Pr="esri-attachments",fi={base:Pr,loaderContainer:`${Pr}__loader-container`,loader:`${Pr}__loader`,fadeIn:`${Pr}--fade-in`,container:`${Pr}__container`,containerList:`${Pr}__container--list`,containerPreview:`${Pr}__container--preview`,actions:`${Pr}__actions`,deleteButton:`${Pr}__delete-button`,addAttachmentButton:`${Pr}__add-attachment-button`,errorMessage:`${Pr}__error-message`,items:`${Pr}__items`,item:`${Pr}__item`,itemButton:`${Pr}__item-button`,itemMask:`${Pr}__item-mask`,itemMaskIcon:`${Pr}__item-mask--icon`,itemImage:`${Pr}__image`,itemImageResizable:`${Pr}__image--resizable`,itemLabel:`${Pr}__label`,itemFilename:`${Pr}__filename`,itemChevronIcon:`${Pr}__item-chevron-icon`,itemLink:`${Pr}__item-link`,itemLinkOverlay:`${Pr}__item-link-overlay`,itemLinkOverlayIcon:`${Pr}__item-link-overlay-icon`,itemEditIcon:`${Pr}__item-edit-icon`,itemAddIcon:`${Pr}__item-add-icon`,itemAddButton:`${Pr}__item-add-button`,formNode:`${Pr}__form-node`,fileFieldset:`${Pr}__file-fieldset`,fileLabel:`${Pr}__file-label`,fileName:`${Pr}__file-name`,fileInput:`${Pr}__file-input`,metadata:`${Pr}__metadata`,metadataFieldset:`${Pr}__metadata-fieldset`,progressBar:`${Pr}__progress-bar`},xW=window.CSS;let Ka=class extends Wo{constructor(e,i){super(e,i),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...dwe},this._supportsImageOrientation=xW&&xW.supports&&xW.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(e){return e!=null&&e.viewModel||(e={viewModel:new ice,...e}),e}initialize(){this.addHandles([on(()=>{var e;return(e=this.viewModel)==null?void 0:e.attachmentInfos},"change",()=>this.scheduleRender()),on(()=>{var e;return(e=this.viewModel)==null?void 0:e.fileInfos},"change",()=>this.scheduleRender()),te(()=>{var e;return(e=this.viewModel)==null?void 0:e.mode},()=>this._modeChanged(),pt)])}loadDependencies(){return Cp({icon:()=>oe(()=>import("./calcite-icon-eob-Ctv5.js"),__vite__mapDeps([211,209,200,201,208]))})}get capabilities(){return this.viewModel.capabilities}set capabilities(e){this.viewModel.capabilities=e}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get icon(){return"attachment"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return{...dwe,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:i}=this;return this._set("submitting",!0),this._set("error",null),i.addAttachment(e).then(r=>(this._set("submitting",!1),this._set("error",null),i.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new B("attachments:add-attachment",this.messages.addErrorMessage,r)),r})}deleteAttachment(e){const{viewModel:i}=this;return this._set("submitting",!0),this._set("error",null),i.deleteAttachment(e).then(r=>(this._set("submitting",!1),this._set("error",null),i.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new B("attachments:delete-attachment",this.messages.deleteErrorMessage,r)),r})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:i}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(i).then(r=>(this._set("submitting",!1),this._set("error",null),e.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new B("attachments:update-attachment",this.messages.updateErrorMessage,r)),r})}addFile(){const e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){const{viewModel:e}=this,i=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",i}deleteFile(e){var r;const i=this.viewModel.deleteFile(e||((r=this.viewModel.activeFileInfo)==null?void 0:r.file));return this.viewModel.mode="view",i}render(){const{submitting:e,viewModel:i}=this,{state:r}=i;return Q("div",{class:this.classes(fi.base,Jt.widget)},e?this._renderProgressBar():null,r==="loading"?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){const{error:e,visibleElements:i}=this;return e&&i.errorMessage?Q("div",{class:fi.errorMessage,key:"error-message"},e.message):null}_renderAttachments(){const{activeFileInfo:e,mode:i,activeAttachmentInfo:r}=this.viewModel;return i==="add"?this._renderAddForm():i==="edit"?this._renderDetailsForm(r||e):this._renderAttachmentContainer()}_renderLoading(){return Q("div",{class:fi.loaderContainer,key:"loader"},Q("div",{class:fi.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?Q("div",{class:fi.progressBar,key:"progress-bar"}):null}_renderAddForm(){const{submitting:e,selectedFile:i}=this,r=e||!i,s=this.visibleElements.cancelAddButton?Q("button",{bind:this,class:this.classes(Jt.button,Jt.buttonTertiary,Jt.buttonSmall,Jt.buttonHalf,e&&Jt.buttonDisabled),disabled:e,onclick:this._cancelForm,type:"button"},this.messages.cancel):null,n=this.visibleElements.addSubmitButton?Q("button",{class:this.classes(Jt.button,Jt.buttonSecondary,Jt.buttonSmall,Jt.buttonHalf,{[Jt.buttonDisabled]:r}),disabled:r,type:"submit"},this.messages.add):null,o=i?Q("span",{class:fi.fileName,key:"file-name"},i.name):null,a=Q("form",{afterCreate:upe,afterRemoved:cpe,bind:this,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},Q("fieldset",{class:fi.fileFieldset},o,Q("label",{class:this.classes(fi.fileLabel,Jt.button,Jt.buttonSecondary)},i?this.messages.changeFile:this.messages.selectFile,Q("input",{bind:this,class:fi.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),n,s);return Q("div",{class:fi.formNode,key:"add-form-container"},a)}_renderDetailsForm(e){var T,E,M;const{visibleElements:i,viewModel:r,selectedFile:s,submitting:n}=this,{capabilities:o}=r,a=n||!s;let l,c,u,d;s?(l=s.type,c=s.name,u=s.size):e&&"file"in e?(l=e.file.type,c=e.file.name,u=e.file.size):e&&"contentType"in e&&(l=e.contentType,c=e.name,u=e.size,d=e.url);const f=o.editing&&((T=o.operations)!=null&&T.delete)&&i.deleteButton?Q("button",{bind:this,class:this.classes(Jt.button,Jt.buttonSmall,Jt.buttonTertiary,fi.deleteButton,{[Jt.buttonDisabled]:n}),disabled:n,key:"delete-button",onclick:O=>this._submitDeleteAttachment(O,e),type:"button"},this.messages.delete):void 0,m=o.editing&&((E=o.operations)!=null&&E.update)&&i.updateButton?Q("button",{class:this.classes(Jt.button,Jt.buttonSmall,Jt.buttonThird,{[Jt.buttonDisabled]:a}),disabled:a,key:"update-button",type:"submit"},this.messages.update):void 0,g=this.visibleElements.cancelUpdateButton?Q("button",{bind:this,class:this.classes(Jt.button,Jt.buttonSmall,Jt.buttonTertiary,Jt.buttonThird,{[Jt.buttonDisabled]:n}),disabled:n,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0,y=o.editing&&((M=o.operations)!=null&&M.update)?Q("fieldset",{class:fi.fileFieldset,key:"file"},Q("span",{class:fi.fileName,key:"file-name"},c),Q("label",{class:this.classes(fi.fileLabel,Jt.button,Jt.buttonSecondary)},this.messages.changeFile,Q("input",{bind:this,class:fi.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0,v=Q("fieldset",{class:fi.metadataFieldset,key:"size"},Q("label",null,Ozt(this.messagesUnits,u??0))),b=Q("fieldset",{class:fi.metadataFieldset,key:"content-type"},Q("label",null,l)),w=d!=null?Q("a",{class:fi.itemLink,href:d,rel:"noreferrer",target:"_blank"},this._renderImageMask(e,400),Q("div",{class:fi.itemLinkOverlay},Q("span",{class:fi.itemLinkOverlayIcon},Q("calcite-icon",{icon:"launch"})))):this._renderImageMask(e,400),x=Q("form",{afterCreate:upe,afterRemoved:cpe,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:O=>this._submitUpdateAttachment(O,e)},Q("div",{class:fi.metadata},v,b),y,Q("div",{class:fi.actions},f,g,m));return Q("div",{class:fi.formNode,key:"edit-form-container"},w,x)}_renderImageMask(e,i){return e?"file"in e?this._renderGenericImageMask(e.file.name,e.file.type):this._renderImageMaskForAttachment(e,i):null}_renderGenericImageMask(e,i){const{supportsResizeAttachments:r}=this.viewModel,s=pBt(i),n={[fi.itemImageResizable]:r};return Q("div",{class:this.classes(fi.itemMaskIcon,fi.itemMask),key:s},Q("img",{alt:e,class:this.classes(n,fi.itemImage),src:s,title:e}))}_renderImageMaskForAttachment(e,i){const{supportsResizeAttachments:r}=this.viewModel;if(!e)return null;const{contentType:s,name:n,url:o}=e;if(!r||!hwe(s))return this._renderGenericImageMask(n,s);const a=this._getCSSTransform(e),l=a?{transform:a,"image-orientation":"none"}:{},c=`${o}${o!=null&&o.includes("?")?"&":"?"}w=${i}`,u={[fi.itemImageResizable]:r};return Q("div",{class:this.classes(fi.itemMask),key:c},Q("img",{alt:n,class:this.classes(u,fi.itemImage),src:c,styles:l,title:n}))}_renderFile(e){const{file:i}=e;return Q("li",{class:fi.item,key:i},Q("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:fi.itemButton,key:"details-button",onclick:()=>this._startEditFile(e),title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(e),Q("label",{class:fi.itemLabel},Q("span",{class:fi.itemFilename},i.name||this.messages.noTitle),Q("span",{"aria-hidden":"true",class:this.classes(fi.itemChevronIcon,Zb(this.container)?r_.left:r_.right)}))))}_renderAttachmentInfo({attachmentInfo:e,displayType:i}){const{viewModel:r,effectiveDisplayType:s}=this,{capabilities:n,supportsResizeAttachments:o}=r,{contentType:a,name:l,url:c}=e,u=this._renderImageMask(e,i==="list"?48:400),d=n.editing?Q("span",{"aria-hidden":"true",class:this.classes(fi.itemChevronIcon,Zb(this.container)?r_.left:r_.right)}):null,f=[u,s==="preview"&&o&&hwe(a)?null:Q("label",{class:fi.itemLabel},Q("span",{class:fi.itemFilename},l||this.messages.noTitle),d)],m=n.editing?Q("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:fi.itemButton,"data-attachment-info-id":e.id,key:"details-button",onclick:()=>this._startEditAttachment(e),title:this.messages.attachmentDetails,type:"button"},f):Q("a",{class:fi.itemButton,href:c??void 0,key:"details-link",rel:"noreferrer",target:"_blank"},f);return Q("li",{class:fi.item,key:e},m)}_renderAttachmentContainer(){var g;const{effectiveDisplayType:e,viewModel:i,visibleElements:r}=this,{attachmentInfos:s,capabilities:n,fileInfos:o}=i,a=!!(s!=null&&s.length),l=!!(o!=null&&o.length),c={[fi.containerList]:e!=="preview",[fi.containerPreview]:e==="preview"},u=n.editing&&((g=n.operations)!=null&&g.add)&&r.addButton?Q("button",{bind:this,class:this.classes(Jt.button,Jt.buttonTertiary,fi.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:"button"},Q("span",{"aria-hidden":"true",class:this.classes(fi.itemAddIcon,r_.plus)}),this.messages.add):void 0,d=a?Q("ul",{class:fi.items,key:"attachments-list"},s.toArray().map(y=>this._renderAttachmentInfo({attachmentInfo:y,displayType:e}))):void 0,f=l?Q("ul",{class:fi.items,key:"file-list"},o.toArray().map(y=>this._renderFile(y))):void 0,m=l||a?void 0:Q("div",{class:Jt.empty},this.messages.noAttachments);return Q("div",{class:this.classes(fi.container,c),key:"attachments-container"},d,f,m,u)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){var s;const i=e.target,r=(s=i.files)==null?void 0:s.item(0);this._set("selectedFile",r)}_submitDeleteAttachment(e,i){e.preventDefault(),i&&("file"in i?this.deleteFile(i.file):i&&this.deleteAttachment(i))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,i){e.preventDefault(),i&&"file"in i?this.updateFile():this.updateAttachment()}_startEditAttachment(e){const{viewModel:i}=this;i.activeFileInfo=null,i.activeAttachmentInfo=e,i.mode="edit"}_startEditFile(e){const{viewModel:i}=this;i.activeAttachmentInfo=null,i.activeFileInfo=e,i.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){const{orientationInfo:i}=e;return!this._supportsImageOrientation&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};h([p()],Ka.prototype,"capabilities",null),h([p()],Ka.prototype,"displayType",void 0),h([p({readOnly:!0})],Ka.prototype,"effectiveDisplayType",null),h([p()],Ka.prototype,"graphic",null),h([p()],Ka.prototype,"icon",null),h([p()],Ka.prototype,"label",null),h([p(),qo("esri/widgets/Attachments/t9n/Attachments")],Ka.prototype,"messages",void 0),h([p(),qo("esri/core/t9n/Units")],Ka.prototype,"messagesUnits",void 0),h([p({readOnly:!0})],Ka.prototype,"selectedFile",void 0),h([p({readOnly:!0})],Ka.prototype,"submitting",void 0),h([p({readOnly:!0})],Ka.prototype,"error",void 0),h([p({type:ice})],Ka.prototype,"viewModel",void 0),h([p()],Ka.prototype,"visibleElements",void 0),h([Qt("visibleElements")],Ka.prototype,"castVisibleElements",null),Ka=h([I("esri.widgets.Attachments")],Ka);const fBt=Ka;let e3=class extends ice{constructor(e){super(e),this.description=null,this.title=null}};h([p()],e3.prototype,"description",void 0),h([p()],e3.prototype,"title",void 0),e3=h([I("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],e3);const rce=e3;function sce({level:t,class:e,...i},r){const s=ZBe(t);return Q(`h${s}`,{...i,"aria-level":String(s),class:KPe(Jt.heading,e),role:"heading"},r)}function ZBe(t){return Ne(Math.ceil(t),1,6)}function mfi(t,e=1){return ZBe(t+e)}const TW="esri-feature-element-info",SW={base:TW,title:`${TW}__title`,description:`${TW}__description`};let fM=class extends Wo{constructor(e,i){super(e,i),this.description=null,this.headingLevel=2,this.title=null}render(){return Q("div",{class:SW.base},this._renderTitle(),this._renderDescription())}_renderTitle(){const{title:e}=this;return e?Q(sce,{class:SW.title,innerHTML:e,level:this.headingLevel}):null}_renderDescription(){const{description:e}=this;return e?Q("div",{class:SW.description,innerHTML:e,key:"description"}):null}};h([p()],fM.prototype,"description",void 0),h([p()],fM.prototype,"headingLevel",void 0),h([p()],fM.prototype,"title",void 0),fM=h([I("esri.widgets.Feature.support.FeatureElementInfo")],fM);const B8=fM,mBt={base:"esri-feature-attachments"};let mg=class extends Wo{constructor(e,i){super(e,i),this._featureElementInfo=null,this.attachmentsWidget=new fBt,this.headingLevel=2,this.viewModel=new rce}initialize(){this._featureElementInfo=new B8,this.addHandles([te(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.description,(i=this.viewModel)==null?void 0:i.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),pt),te(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,pt)])}destroy(){var e;this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),(e=this._featureElementInfo)==null||e.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var i;const{attachmentsWidget:e}=this;return Q("div",{class:mBt.base},(i=this._featureElementInfo)==null?void 0:i.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){var s;const{description:e,title:i,headingLevel:r}=this;(s=this._featureElementInfo)==null||s.set({description:e,title:i,headingLevel:r})}};h([p({readOnly:!0})],mg.prototype,"attachmentsWidget",void 0),h([p()],mg.prototype,"description",null),h([p()],mg.prototype,"displayType",null),h([p()],mg.prototype,"graphic",null),h([p()],mg.prototype,"headingLevel",void 0),h([p()],mg.prototype,"title",null),h([p({type:rce})],mg.prototype,"viewModel",void 0),mg=h([I("esri.widgets.Feature.FeatureAttachments")],mg);const gBt=mg;let x1=class extends Ue{constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles(te(()=>this.creator,i=>{this._destroyContent(),this._createContent(i)},pt))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:i,destroyer:r}=this;e&&i&&(Gj({type:"content",value:r,event:{graphic:i}}),this._set("created",null))}async _createContent(e){const i=this.graphic;if(!i||!e)return;const r=Gj({type:"content",value:e,event:{graphic:i}});this._loadingPromise=r,this.notifyChange("state");const s=await r;r===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",s))}};h([p({readOnly:!0})],x1.prototype,"created",void 0),h([p()],x1.prototype,"creator",void 0),h([p()],x1.prototype,"destroyer",void 0),h([p({type:ya})],x1.prototype,"graphic",void 0),h([p({readOnly:!0})],x1.prototype,"state",null),x1=h([I("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],x1);const Hj=x1;function qj(t){return t&&typeof t.render=="function"}function yBt(t){return t&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}const EW="esri-feature-content",CW={base:EW,loaderContainer:`${EW}__loader-container`,loader:`${EW}__loader`};let mM=class extends Wo{constructor(e,i){super(e,i),this.viewModel=null,this._addTargetToAnchors=r=>{Array.from(r.querySelectorAll("a")).forEach(s=>{UBe(s.href)&&!s.hasAttribute("target")&&s.setAttribute("target","_blank")})}}get creator(){var e;return(e=this.viewModel)==null?void 0:e.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){var e;return(e=this.viewModel)==null?void 0:e.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}render(){var i;const e=(i=this.viewModel)==null?void 0:i.state;return Q("div",{class:CW.base},e==="loading"?this._renderLoading():this._renderCreated())}_renderLoading(){return Q("div",{class:CW.loaderContainer,key:"loader"},Q("div",{class:CW.loader}))}_renderCreated(){var i;const e=(i=this.viewModel)==null?void 0:i.created;return e?e instanceof HTMLElement?Q("div",{afterCreate:this._attachToNode,bind:e,key:e}):qj(e)?Q("div",{key:e},!e.destroyed&&e.render()):Q("div",{afterCreate:this._addTargetToAnchors,innerHTML:e,key:e}):null}_attachToNode(e){const i=this;e.appendChild(i)}};h([p()],mM.prototype,"creator",null),h([p()],mM.prototype,"graphic",null),h([p({type:Hj})],mM.prototype,"viewModel",void 0),mM=h([I("esri.widgets.Feature.FeatureContent")],mM);const LV=mM;let R0=class extends Ue{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:i}=this,r=[];return i==null||i.forEach(s=>{if(!(!s.hasOwnProperty("visible")||s.visible))return;const n=s.clone();n.label=VBe(n,e),r.push(n)}),r}};h([p()],R0.prototype,"attributes",void 0),h([p({type:[R$e]})],R0.prototype,"expressionInfos",void 0),h([p()],R0.prototype,"description",void 0),h([p({type:[sN]})],R0.prototype,"fieldInfos",void 0),h([p({readOnly:!0})],R0.prototype,"formattedFieldInfos",null),h([p()],R0.prototype,"title",void 0),R0=h([I("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],R0);const j8=R0,_Bt=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function vBt(t,e){if(typeof e!="string"||!e)return e;const i=_Bt.find(l=>l.pattern.test(e));if(!i)return e;const r=e.match(i.pattern),s=r==null?void 0:r[2],n=py(py(i.label,{messages:t,hierPart:s}),{appName:i.appName}),o=i.target?` target="${i.target}"`:"",a=i.target==="_blank"?' rel="noreferrer"':"";return e.replace(i.pattern,`<a${o} href="$1"${a}>${n}</a>`)}const tk="esri-feature-fields",ik={base:tk,fieldHeader:`${tk}__field-header`,fieldData:`${tk}__field-data`,fieldDataDate:`${tk}__field-data--date`};let uf=class extends Wo{constructor(e,i){super(e,i),this._featureElementInfo=null,this.viewModel=new j8,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new B8,this.addHandles(te(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.description,(i=this.viewModel)==null?void 0:i.title]},()=>this._setupFeatureElementInfo(),pt))}destroy(){var e;(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var e;return Q("div",{class:ik.base},(e=this._featureElementInfo)==null?void 0:e.render(),this._renderFields())}_renderFieldInfo(e,i){var u;const{attributes:r}=this.viewModel,s=e.fieldName||"",n=e.label||s,o=r?r[s]==null?"":r[s]:"",a=!!((u=e.format)!=null&&u.dateFormat),l=typeof o=="number"&&!a?this._forceLTR(o):vBt(this.messagesURIUtils,o),c={[ik.fieldDataDate]:a};return Q("tr",{key:`fields-element-info-row-${s}-${i}`},Q("th",{class:ik.fieldHeader,innerHTML:n,key:`fields-element-info-row-header-${s}-${i}`}),Q("td",{class:this.classes(ik.fieldData,c),innerHTML:l,key:`fields-element-info-row-data-${s}-${i}`}))}_renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e!=null&&e.length?Q("table",{class:Jt.table,summary:this.messages.fieldsSummary},Q("tbody",null,e.map((i,r)=>this._renderFieldInfo(i,r)))):null}_setupFeatureElementInfo(){var r;const{description:e,title:i}=this;(r=this._featureElementInfo)==null||r.set({description:e,title:i})}_forceLTR(e){return`&lrm;${e}`}};h([p()],uf.prototype,"attributes",null),h([p()],uf.prototype,"description",null),h([p()],uf.prototype,"expressionInfos",null),h([p()],uf.prototype,"fieldInfos",null),h([p()],uf.prototype,"title",null),h([p({type:j8,nonNullable:!0})],uf.prototype,"viewModel",void 0),h([p(),qo("esri/widgets/Feature/t9n/Feature")],uf.prototype,"messages",void 0),h([p(),qo("esri/widgets/support/t9n/uriUtils")],uf.prototype,"messagesURIUtils",void 0),uf=h([I("esri.widgets.Feature.FeatureFields")],uf);const YBe=uf,bBt=/^-?(\d+)(\.(\d+))?$/i;function wBt(t,e){return t-e}function xBt(t,e){let i,r;return i=Number(t.toFixed(e)),i<t?r=i+1/10**e:(r=i,i-=1/10**e),i=Number(i.toFixed(e)),r=Number(r.toFixed(e)),[i,r]}function TBt(t,e,i,r,s){const n=SBt(t,e,i,r),o=n.previous==null||n.previous<=s,a=n.next==null||n.next<=s;return o&&a||n.previous+n.next<=2*s}function XBe(t){const e=String(t),i=e.match(bBt);if(i!=null&&i[1])return{integer:i[1].split("").length,fractional:i[3]?i[3].split("").length:0};if(e.toLowerCase().includes("e")){const r=e.split("e"),s=r[0],n=r[1];if(s&&n){const o=Number(s);let a=Number(n);const l=a>0;l||(a=Math.abs(a));const c=XBe(o);return l?(c.integer+=a,a>c.fractional?c.fractional=0:c.fractional-=a):(c.fractional+=a,a>c.integer?c.integer=1:c.integer-=a),c}}return{integer:0,fractional:0}}function SBt(t,e,i,r){const s={previous:null,next:null};if(i!=null){const n=t-i,o=e-i-n;s.previous=Math.floor(Math.abs(100*o/n))}if(r!=null){const n=r-t,o=r-e-n;s.next=Math.floor(Math.abs(100*o/n))}return s}function xfi(t,e={}){const i=t.slice(0),{tolerance:r=2,strictBounds:s=!1,indexes:n=i.map((o,a)=>a)}=e;n.sort(wBt);for(let o=0;o<n.length;o++){const a=n[o],l=i[a],c=a===0?null:i[a-1],u=a===i.length-1?null:i[a+1],d=XBe(l).fractional;if(d){let f,m=0,g=!1;for(;m<=d&&!g;){const y=xBt(l,m);f=s&&o===0?y[1]:y[0],g=TBt(l,f,c,u,r),m++}g&&(i[a]=f)}}return i}const EBt={maximumFractionDigits:20};function CBt(t){return nc(t,EBt)}var fte;let ST=fte=class extends Se{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,i){e[i]=t??0}clone(){return new fte({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};h([p({type:je,json:{type:[Ji],write:!0}})],ST.prototype,"color",void 0),h([p({type:String,json:{write:!0}})],ST.prototype,"label",void 0),h([p({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],ST.prototype,"value",void 0),h([Ze("value")],ST.prototype,"writeValue",null),ST=fte=h([I("esri.renderers.visualVariables.support.ColorStop")],ST);const MBt=ST,ABt="<",PBt=">";function OBt(t,e,i,r){let s="";return e===0?s=`${ABt} `:e===i&&(s=`${PBt} `),s+(r?Qle(t,r):CBt(t))}const Tfi=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];async function $Bt(t){if(!("visualVariables"in t)||!t.visualVariables)return null;const e=t.visualVariables.find(o=>o.type==="color");if(!e)return null;let i=null,r=null;if(e.stops){if(e.stops.length===1)return e.stops[0].color;i=e.stops[0].value,r=e.stops[e.stops.length-1].value}const s=i!=null&&r!=null?i+(r-i)/2:0,{getColor:n}=await oe(async()=>{const{getColor:o}=await Promise.resolve().then(()=>m8);return{getColor:o}},void 0);return n(e,s)??null}async function Sfi(t,e){const i=t.trailCap,r=t.trailWidth||1,s=e||await $Bt(t)||t.color;return new Yu({cap:i,color:s,width:r})}function Efi(t){return t!=null&&typeof t=="object"&&"min"in t&&"max"in t}function RBt(t,e){var i,r;if(!e.field)return null;if("featureReduction"in t)switch((i=t.featureReduction)==null?void 0:i.type){case"cluster":case"binning":{const s=t.featureReduction.fields.find(({name:n})=>n.toLowerCase()===e.field.toLowerCase());return s&&"getField"in t?t.getField(s.onStatisticField):null}}return"getField"in t?(r=t.getField)==null?void 0:r.call(t,e.field):null}function IBt(t,e){var r,s,n;const i="popupTemplate"in t?(r=t.popupTemplate)==null?void 0:r.fieldInfos:null;if(i!=null&&i.length&&e)return(n=(s=i.find(o=>{var a;return((a=o.fieldName)==null?void 0:a.toLowerCase())===e.toLowerCase()}))==null?void 0:s.format)==null?void 0:n.dateFormat}function Cfi(t,e,i){var n,o,a,l;const r=RBt(t,e);if(!r||!DBe(r)&&!gne(r))return null;let s=IBt(t,r.name);if(!s&&r.type==="date"){let c=0,u=0;e.stops?(c=((o=(n=e.stops)==null?void 0:n.at(0))==null?void 0:o.value)??c,u=((l=(a=e.stops)==null?void 0:a.at(-1))==null?void 0:l.value)??u):"minDataValue"in e&&"maxDataValue"in e&&(c=e.minDataValue??c,u=e.maxDataValue??u),s=u-c>2*yY.days?"short-date":"short-date-short-time"}return{fieldType:r.type,format:s,timeZoneOptions:{layerTimeZone:"preferredTimeZone"in t?t.preferredTimeZone:null,viewTimeZone:i,datesInUnknownTimezone:"datesInUnknownTimezone"in t&&t.datesInUnknownTimezone}}}function Mfi(t){var e,i;if("authoringInfo"in t)return(i=(e=t.authoringInfo)==null?void 0:e.visualVariables)==null?void 0:i.find(({theme:r})=>r==="reference-size")}const LBt=new je([64,64,64]);function JBe(t,e){const i=[],r=t.length-1;return t.length===5?i.push(0,2,4):i.push(0,r),t.map((s,n)=>i.includes(n)?OBt(s,n,r,e):null)}async function DBt(t,e,i){let r=!1,s=[],n=[];if(t.stops){const c=t.stops;s=c.map(u=>u.value),r=c.some(u=>!!u.label),r&&(n=c.map(u=>u.label))}const o=s[0],a=s[s.length-1];if(o==null&&a==null)return null;const l=r?null:JBe(s,i);return(await Promise.all(s.map(async(c,u)=>({value:c,color:t.type==="opacity"?await NBt(c,t,e):(await oe(async()=>{const{getColor:d}=await Promise.resolve().then(()=>m8);return{getColor:d}},void 0)).getColor(t,c),label:r?n[u]:(l==null?void 0:l[u])??""})))).reverse()}async function NBt(t,e,i){const r=new je(i??LBt),s=(await oe(async()=>{const{getOpacity:n}=await Promise.resolve().then(()=>m8);return{getOpacity:n}},void 0)).getOpacity(e,t);return s!=null&&(r.a=s),r}function Afi(t){let e=!1,i=[],r=[];i=t.map(a=>a.value),e=t.some(a=>!!a.label),e&&(r=t.map(a=>a.label??""));const s=i[0],n=i[i.length-1];if(s==null&&n==null)return null;const o=e?null:JBe(i);return i.map((a,l)=>({value:a,color:FBt(a,t),label:e?r[l]:(o==null?void 0:o[l])??""})).reverse()}function FBt(t,e){const{startIndex:i,endIndex:r,weight:s}=kBt(t,e);if(i===r)return e[i].color;const n=je.blendColors(e[i].color,e[r].color,s);return new je(n)}function kBt(t,e){let i=0,r=e.length-1;return e.some((s,n)=>t<s.value?(r=n,!0):(i=n,!1)),{startIndex:i,endIndex:r,weight:(t-e[i].value)/(e[r].value-e[i].value)}}function Pfi(t,e){let i=[];if(t&&t.type==="multipart")t.colorRamps.reverse().forEach((r,s)=>{s===0?i.push({value:e.max,color:new je(r.toColor),label:"high"}):i.push({value:null,color:new je(r.toColor),label:""}),s===t.colorRamps.length-1?i.push({value:e.min,color:new je(r.fromColor),label:"low"}):i.push({value:null,color:new je(r.fromColor),label:""})});else{let r,s;t&&t.type==="algorithmic"?(r=t.fromColor,s=t.toColor):(r=[0,0,0,1],s=[255,255,255,1]),i=[{value:e.max,color:new je(s),label:"high"},{value:e.min,color:new je(r),label:"low"}]}return i}var mte;let t3=mte=class extends Se{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new mte({color:this.color&&this.color.clone(),ratio:this.ratio})}};h([p({type:je,json:{type:[Ji],default:null,write:!0}})],t3.prototype,"color",void 0),h([p({type:Number,json:{write:!0}})],t3.prototype,"ratio",void 0),t3=mte=h([I("esri.renderers.support.HeatmapColorStop")],t3);const hL=t3;function UBt(t){if(!t.colorStops)return[];const e=[...t.colorStops].filter(r=>{var s;return((s=r.color)==null?void 0:s.a)>0});let i=e.length-1;if(e&&e[0]){const r=e[i];r&&r.ratio!==1&&(e.push(new hL({ratio:1,color:r.color})),i++)}return e.map((r,s)=>{var o,a;let n="";return s===0?n=((o=t.legendOptions)==null?void 0:o.minLabel)||"low":s===i&&(n=((a=t.legendOptions)==null?void 0:a.maxLabel)||"high"),{color:r.color,label:n,ratio:r.ratio}}).reverse()}W1("short-date");async function oh(t,e,i){VD(t,e,()=>[]).push(...i)}async function VBt(t){var i,r;const e=new Map;if(!t)return e;if("visualVariables"in t&&t.visualVariables){const s=t.visualVariables.filter(n=>n.type==="color");for(const n of s){const o=(await DBt(n)??[]).map(a=>a.color);await oh(e,n.field||n.valueExpression,o)}}if(t.type==="heatmap"){const s=UBt(t).map(n=>n.color);await oh(e,t.field||t.valueExpression,s)}else if(t.type==="pie-chart"){for(const s of t.attributes)await oh(e,s.field||s.valueExpression,[s.color]);await oh(e,"default",[(i=t==null?void 0:t.othersCategory)==null?void 0:i.color,qE(t.backgroundFillSymbol,null)])}else if(t.type==="dot-density"){for(const s of t.attributes)await oh(e,s.field||s.valueExpression,[s.color]);await oh(e,"default",[t.backgroundColor])}else if(t.type==="unique-value")if(((r=t.authoringInfo)==null?void 0:r.type)==="predominance")for(const s of t.uniqueValueInfos??[])await oh(e,s.value.toString(),[qE(s.symbol,null)]);else{const s=(t.uniqueValueInfos??[]).map(c=>qE(c.symbol,null)),{field:n,field2:o,field3:a,valueExpression:l}=t;(n||l)&&await oh(e,n||l,s),o&&await oh(e,o,s),a&&await oh(e,a,s)}else if(t.type==="class-breaks"){const s=t.classBreakInfos.map(a=>qE(a.symbol,null)),{field:n,valueExpression:o}=t;await oh(e,n??o,s)}else t.type==="simple"&&await oh(e,"default",[qE(t.symbol,null)]);return"defaultSymbol"in t&&t.defaultSymbol&&await oh(e,"default",[qE(t.defaultSymbol,null)]),e.forEach((s,n)=>{const o=D2(s.filter(Boolean),(a,l)=>JSON.stringify(a)===JSON.stringify(l));e.set(n,o)}),e}const rk={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new Bf({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ye.WebMercator}),minus180Line:new Bf({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ye.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new Bf({paths:[[[180,-180],[180,180]]],spatialReference:Ye.WGS84}),minus180Line:new Bf({paths:[[[-180,-180],[-180,180]]],spatialReference:Ye.WGS84})}};function yS(t,e){return Math.ceil((t-e)/(2*e))}function QBe(t,e){const i=dL(t);for(const r of i)for(const s of r)s[0]+=e;return t}function dL(t){return ml(t)?t.rings:t.paths}async function zBt(t,e,i,r){const s=hle(t),n=e[0].spatialReference,o={...r,responseType:"json",query:{...s.query,f:"json",sr:nP(n),target:JSON.stringify({geometryType:bO(e[0]),geometries:e}),cutter:JSON.stringify(i)}},a=await fr(s.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(u=>{const d=_y(u);return d.spatialReference=n,d})}}async function BBt(t,e,i){const r=typeof t=="string"?gn(t):t,s=e[0].spatialReference,n=bO(e[0]),o={...i,query:{...r.query,f:"json",sr:nP(s),geometries:JSON.stringify(BIt(e))}},{data:a}=await fr(r.path+"/simplify",o);return SUe(a.geometries,n,s)}const KBe=()=>ne.getLogger("esri.geometry.support.normalizeUtils");function jBt(t){return t.type==="polygon"}function GBt(t){return t[0].type==="polygon"}function HBt(t){return t[0].type==="polyline"}function qBt(t,e){if(!(t instanceof Bf||t instanceof cm)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw KBe().error(s),new B(s)}const i=dL(t),r=[];for(const s of i){const n=[];r.push(n),n.push([s[0][0],s[0][1]]);for(let o=0;o<s.length-1;o++){const a=s[o][0],l=s[o][1],c=s[o+1][0],u=s[o+1][1],d=Math.sqrt((c-a)*(c-a)+(u-l)*(u-l)),f=(u-l)/d,m=(c-a)/d,g=d/e;if(g>1){for(let w=1;w<=g-1;w++){const x=w*e,T=m*x+a,E=f*x+l;n.push([T,E])}const y=(d+Math.floor(g-1)*e)/2,v=m*y+a,b=f*y+l;n.push([v,b])}n.push([c,u])}}return jBt(t)?new cm({rings:r,spatialReference:t.spatialReference}):new Bf({paths:r,spatialReference:t.spatialReference})}function pwe(t,e,i){if(e){const r=qBt(t,1e6);t=$M(r,!0)}return i&&(t=QBe(t,i)),t}function fwe(t,e,i){if(Array.isArray(t)){const r=t[0];if(r>e){const s=yS(r,e);t[0]=r+s*(-2*e)}else if(r<i){const s=yS(r,i);t[0]=r+s*(-2*i)}}else{const r=t.x;if(r>e){const s=yS(r,e);t=t.clone().offset(s*(-2*e),0)}else if(r<i){const s=yS(r,i);t=t.clone().offset(s*(-2*i),0)}}return t}function WBt(t,e){let i=-1;for(let r=0;r<e.cutIndexes.length;r++){const s=e.cutIndexes[r],n=e.geometries[r],o=dL(n);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let u=0;for(let f=0;f<l.length;f++){const m=l[f][0];u=m>u?m:u}u=Number(u.toFixed(9));const d=-360*yS(u,180);for(let f=0;f<l.length;f++){const m=n.getPoint(a,f);n.setPoint(a,f,m.clone().offset(d,0))}return!0}})}if(s===i){if(GBt(t))for(const a of dL(n))t[s]=t[s].addRing(a);else if(HBt(t))for(const a of dL(n))t[s]=t[s].addPath(a)}else i=s,t[s]=n}return t}async function eje(t,e,i){if(!Array.isArray(t))return eje([t],e);e&&typeof e!="string"&&KBe().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r=typeof e=="string"?e:(e==null?void 0:e.url)??nr.geometryServiceUrl;let s,n,o,a,l,c,u,d,f=0;const m=[],g=[];for(const T of t)if(T!=null)if(s||(s=T.spatialReference,n=ey(s),o=s.isWebMercator,c=o?102100:4326,a=rk[c].maxX,l=rk[c].minX,u=rk[c].plus180Line,d=rk[c].minus180Line),n)if(T.type==="mesh")g.push(T);else if(T.type==="point")g.push(fwe(T.clone(),a,l));else if(T.type==="multipoint"){const E=T.clone();E.points=E.points.map(M=>fwe(M,a,l)),g.push(E)}else if(T.type==="extent"){const E=T.clone()._normalize(!1,!1,n);g.push(E.rings?new cm(E):E)}else if(T.extent){const E=T.extent,M=yS(E.xmin,l)*(2*a);let O=M===0?T.clone():QBe(T.clone(),M);E.offset(M,0);let{xmin:D,xmax:U}=E;D=Number(D.toFixed(9)),U=Number(U.toFixed(9)),E.intersects(u)&&U!==a?(f=U>f?U:f,O=pwe(O,o),m.push(O),g.push("cut")):E.intersects(d)&&D!==l?(f=U*(2*a)>f?U*(2*a):f,O=pwe(O,o,360),m.push(O),g.push("cut")):g.push(O)}else g.push(T.clone());else g.push(T);else g.push(T);let y=yS(f,a),v=-90;const b=y,w=new Bf;for(;y>0;){const T=360*y-180;w.addPath([[T,v],[T,-1*v]]),v*=-1,y--}if(m.length>0&&b>0){const T=WBt(m,await zBt(r,m,w,i)),E=[],M=[];for(let U=0;U<g.length;U++){const k=g[U];if(k!=="cut")M.push(k);else{const H=T.shift(),V=t[U];V!=null&&V.type==="polygon"&&V.rings&&V.rings.length>1&&H.rings.length>=V.rings.length?(E.push(H),M.push("simplify")):M.push(o?ty(H):H)}}if(!E.length)return M;const O=await BBt(r,E,i),D=[];for(let U=0;U<M.length;U++){const k=M[U];k!=="simplify"?D.push(k):D.push(o?ty(O.shift()):O.shift())}return D}const x=[];for(let T=0;T<g.length;T++){const E=g[T];if(E!=="cut")x.push(E);else{const M=m.shift();x.push(o===!0?ty(M):M)}}return x}function tje(t){const e={};for(const i in t){if(i==="declaredClass")continue;const r=t[i];if(r!=null&&typeof r!="function")if(Array.isArray(r)){e[i]=[];for(let s=0;s<r.length;s++)e[i][s]=tje(r[s])}else typeof r=="object"?r.toJSON&&(e[i]=JSON.stringify(r)):e[i]=r}return e}var B1;(function(t){t[t.varint=0]="varint",t[t.fixed64=1]="fixed64",t[t.delimited=2]="delimited",t[t.fixed32=5]="fixed32",t[t.unknown=99]="unknown"})(B1||(B1={}));const mwe=4294967296,ZBt=new TextDecoder("utf-8"),YBt=ue("safari")||ue("ios")?6:ue("ff")?12:32;let gte=class DV{constructor(e,i,r=0,s=e?e.byteLength:0){this._tag=0,this._dataType=B1.unknown,this._init(e,i,r,s)}_init(e,i,r,s){this._data=e,this._dataView=i,this._pos=r,this._end=s}asUnsafe(){return this}clone(){return new DV(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const i=this._decodeVarint();if(this._tag=i>>3,this._dataType=7&i,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;if(e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128||(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128)||(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128)||(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128)||(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128))return e;throw new Error("Varint overflow")}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();return e>>>1^-(1&e)}getSInt64(){return this._decodeSVarint()}getBool(){const e=this._data[this._pos]!==0;return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,i=this._pos,r=e.getUint32(i,!0)+e.getUint32(i+4,!0)*mwe;return this._skip(8),r}getSFixed64(){const e=this._dataView,i=this._pos,r=e.getUint32(i,!0)+e.getInt32(i+4,!0)*mwe;return this._skip(8),r}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),i=this._pos,r=this._toString(this._data,i,i+e);return this._skip(e),r}getBytes(){const e=this._getLength(),i=this._pos,r=this._toBytes(this._data,i,i+e);return this._skip(e),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,i,r,s){const n=this.getMessage(),o=e(n,i,r,s);return n.release(),o}processMessage(e){const i=this.getMessage(),r=e(i);return i.release(),r}getMessage(){const e=this._getLength(),i=DV.pool.acquire();return i._init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),i}release(){DV.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case B1.varint:this._decodeVarint();break;case B1.fixed64:this._skip(8);break;case B1.delimited:this._skip(this._getLength());break;case B1.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let i=this._pos,r=0,s=0;if(this._end-i>=10)do{if(s=e[i++],r|=127&s,!(128&s)||(s=e[i++],r|=(127&s)<<7,!(128&s))||(s=e[i++],r|=(127&s)<<14,!(128&s))||(s=e[i++],r|=(127&s)<<21,!(128&s))||(s=e[i++],r+=268435456*(127&s),!(128&s))||(s=e[i++],r+=34359738368*(127&s),!(128&s))||(s=e[i++],r+=4398046511104*(127&s),!(128&s))||(s=e[i++],r+=562949953421312*(127&s),!(128&s))||(s=e[i++],r+=72057594037927940*(127&s),!(128&s))||(s=e[i++],r+=9223372036854776e3*(127&s),!(128&s)))break;throw new Error("Varint too long!")}while(!1);else{let n=1;for(;i!==this._end&&(s=e[i],128&s);)++i,r+=(127&s)*n,n*=128;if(i===this._end)throw new Error("Varint overrun!");++i,r+=s*n}return this._pos=i,r}_decodeSVarint(){const e=this._data;let i,r=0,s=0;const n=1&e[this._pos];if(s=e[this._pos++],r|=127&s,!(128&s)||(s=e[this._pos++],r|=(127&s)<<7,!(128&s))||(s=e[this._pos++],r|=(127&s)<<14,!(128&s))||(s=e[this._pos++],r|=(127&s)<<21,!(128&s))||(s=e[this._pos++],r+=268435456*(127&s),!(128&s))||(s=e[this._pos++],r+=34359738368*(127&s),!(128&s))||(s=e[this._pos++],r+=4398046511104*(127&s),!(128&s)))return n?-(r+1)/2:r/2;if(i=BigInt(r),s=e[this._pos++],i+=0x2000000000000n*BigInt(127&s),!(128&s)||(s=e[this._pos++],i+=0x100000000000000n*BigInt(127&s),!(128&s))||(s=e[this._pos++],i+=0x8000000000000000n*BigInt(127&s),!(128&s)))return Number(n?-(i+1n)/2n:i/2n);throw new Error("Varint too long!")}_getLength(){if(this._dataType!==B1.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,i,r){if((r=Math.min(this._end,r))-i>YBt){const o=e.subarray(i,r);return ZBt.decode(o)}let s="",n="";for(let o=i;o<r;++o){const a=e[o];128&a?n+="%"+a.toString(16):(s+=decodeURIComponent(n)+String.fromCharCode(a),n="")}return n.length&&(s+=decodeURIComponent(n)),s}_toBytes(e,i,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,i,r-i)}};gte.pool=new ga(gte,void 0,t=>{t._data=null,t._dataView=null});const ije=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];let Ofi=class{constructor(e){this._options=e,this.geometryTypes=ije,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new ZNe}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!(e!=null&&e.features)||!e.hasZ||!this._options.sourceSpatialReference||!e.spatialReference||ms(e.spatialReference,this._options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const i=M_(this._options.sourceSpatialReference)/M_(e.spatialReference);if(i!==1)for(const r of e.features){if(!nbt(r))continue;const s=r.geometry.coords;for(let n=2;n<s.length;n+=3)s[n]*=i}}addFeature(e,i){e.features.push(i)}createFeature(){return new M2}createSpatialReference(){return{wkid:0}}createGeometry(){return new El}addField(e,i){e.fields.push(i)}allocateCoordinates(e){e.coords.length=e.lengths.reduce((i,r)=>i+r,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,i){e.coords[this._coordinatePtr++]=i}addCoordinatePoint(e,i){e.coords.push(i)}addLength(e,i){e.lengths.push(i)}addQueryGeometry(e,i){e.queryGeometry=i.queryGeometry,e.queryGeometryType=i.queryGeometryType}createPointGeometry(){return new El}};const gwe=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML","esriFieldTypeBigInteger","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"],ywe=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],_we=["upperLeft","lowerLeft"];function vwe(t){return t>=gwe.length?null:gwe[t]}function XBt(t){return t>=ywe.length?null:ywe[t]}function bwe(t){return t>=_we.length?null:_we[t]}function wwe(t,e){return e>=t.geometryTypes.length?null:t.geometryTypes[e]}function JBt(t,e,i){const s=t.asUnsafe(),n=e.createPointGeometry(i);for(;s.next();)switch(s.tag()){case 3:{const o=s.getUInt32(),a=s.pos()+o;let l=0;for(;s.pos()<a;)e.addCoordinatePoint(n,s.getSInt64(),l++);break}default:s.skip()}return n}function QBt(t,e,i){const n=t.asUnsafe(),o=e.createGeometry(i),a=2+(i.hasZ?1:0)+(i.hasM?1:0);for(;n.next();)switch(n.tag()){case 2:{const l=n.getUInt32(),c=n.pos()+l;let u=0;for(;n.pos()<c;)e.addLength(o,n.getUInt32(),u++);break}case 3:{const l=n.getUInt32(),c=n.pos()+l;let u=0;for(e.allocateCoordinates(o);n.pos()<c;)e.addCoordinate(o,n.getSInt64(),u),u++,u===a&&(u=0);break}default:n.skip()}return o}function KBt(t){const s=t.asUnsafe(),n=new El;let o="esriGeometryPoint";for(;s.next();)switch(s.tag()){case 2:{const a=s.getUInt32(),l=s.pos()+a;for(;s.pos()<l;)n.lengths.push(s.getUInt32());break}case 3:{const a=s.getUInt32(),l=s.pos()+a;for(;s.pos()<l;)n.coords.push(s.getSInt64());break}case 1:o=ije[s.getEnum()];break;default:s.skip()}return{queryGeometry:n,queryGeometryType:o}}function ejt(t){const u=t.asUnsafe();for(;u.next();)switch(u.tag()){case 1:return u.getString();case 2:return u.getFloat();case 3:return u.getDouble();case 4:return u.getSInt32();case 5:return u.getUInt32();case 6:return u.getInt64();case 7:return u.getUInt64();case 8:return u.getSInt64();case 9:return u.getBool();default:return u.skip(),null}return null}function tjt(t){const a=t.asUnsafe(),l={type:vwe(0)};for(;a.next();)switch(a.tag()){case 1:l.name=a.getString();break;case 2:l.type=vwe(a.getEnum());break;case 3:l.alias=a.getString();break;case 4:l.sqlType=XBt(a.getEnum());break;case 5:a.skip();break;case 6:l.defaultValue=a.getString();break;default:a.skip()}return l}function ijt(t){const r={},s=t.asUnsafe();for(;s.next();)switch(s.tag()){case 1:r.name=s.getString();break;case 2:r.isSystemMaintained=s.getBool();break;default:s.skip()}return r}function rjt(t,e,i,r){const a=e.createFeature(i);let l=0;for(;t.next();)switch(t.tag()){case 1:{const c=r[l++].name;a.attributes[c]=t.processMessage(ejt);break}case 2:a.geometry=t.processMessageWithArgs(QBt,e,i);break;case 4:a.centroid=t.processMessageWithArgs(JBt,e,i);break;default:t.skip()}return a}function sjt(t){const n=[1,1,1,1],o=t.asUnsafe();for(;o.next();)switch(o.tag()){case 1:n[0]=o.getDouble();break;case 2:n[1]=o.getDouble();break;case 4:n[2]=o.getDouble();break;case 3:n[3]=o.getDouble();break;default:o.skip()}return n}function njt(t){const n=[0,0,0,0],o=t.asUnsafe();for(;o.next();)switch(o.tag()){case 1:n[0]=o.getDouble();break;case 2:n[1]=o.getDouble();break;case 4:n[2]=o.getDouble();break;case 3:n[3]=o.getDouble();break;default:o.skip()}return n}function ojt(t){const s={originPosition:bwe(0)},n=t.asUnsafe();for(;n.next();)switch(n.tag()){case 1:s.originPosition=bwe(n.getEnum());break;case 2:s.scale=n.processMessage(sjt);break;case 3:s.translate=n.processMessage(njt);break;default:n.skip()}return s}function ajt(t){const s={},n=t.asUnsafe();for(;n.next();)switch(n.tag()){case 1:s.shapeAreaFieldName=n.getString();break;case 2:s.shapeLengthFieldName=n.getString();break;case 3:s.units=n.getString();break;default:n.skip()}return s}function ljt(t,e){const a=e.createSpatialReference();for(;t.next();)switch(t.tag()){case 1:a.wkid=t.getUInt32();break;case 5:a.wkt=t.getString();break;case 2:a.latestWkid=t.getUInt32();break;case 3:a.vcsWkid=t.getUInt32();break;case 4:a.latestVcsWkid=t.getUInt32();break;default:t.skip()}return a}function cjt(t,e){const y=e.createFeatureResult(),v=t.asUnsafe();y.geometryType=wwe(e,0);let b=!1;for(;v.next();)switch(v.tag()){case 1:y.objectIdFieldName=v.getString();break;case 3:y.globalIdFieldName=v.getString();break;case 4:y.geohashFieldName=v.getString();break;case 5:y.geometryProperties=v.processMessage(ajt);break;case 7:y.geometryType=wwe(e,v.getEnum());break;case 8:y.spatialReference=v.processMessageWithArgs(ljt,e);break;case 10:y.hasZ=v.getBool();break;case 11:y.hasM=v.getBool();break;case 12:y.transform=v.processMessage(ojt);break;case 9:y.exceededTransferLimit=v.getBool();break;case 13:e.addField(y,v.processMessage(tjt));break;case 15:b||(e.prepareFeatures(y),b=!0),e.addFeature(y,v.processMessageWithArgs(rjt,e,y,y.fields));break;case 2:y.uniqueIdField=v.processMessage(ijt);break;default:v.skip()}return e.finishFeatureResult(y),y}function ujt(t,e){const s={};let n=null;for(;t.next();)switch(t.tag()){case 4:n=t.processMessageWithArgs(KBt);break;case 1:s.featureResult=t.processMessageWithArgs(cjt,e);break;default:t.skip()}return n!=null&&s.featureResult&&e.addQueryGeometry(s,n),s}function hjt(t,e){try{const r=new gte(new Uint8Array(t),new DataView(t)),s={};for(;r.next();)r.tag()===2?s.queryResult=r.processMessageWithArgs(ujt,e):r.skip();return s}catch(i){throw new B("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:i})}}function djt(t,e){const i=hjt(t,e),r=i.queryResult.featureResult,s=i.queryResult.queryGeometry,n=i.queryResult.queryGeometryType;if(r&&r.features&&r.features.length&&r.objectIdFieldName){const o=r.objectIdFieldName;for(const a of r.features)a.attributes&&(a.objectId=a.attributes[o])}return r&&(r.queryGeometry=s,r.queryGeometryType=n),r}function yte(t,e,i){if(!(i!=null&&i.features)||!i.hasZ)return;const r=JMe(i.geometryType,e,t.outSpatialReference);if(r!=null)for(const s of i.features)r(s.geometry)}const xwe="Layer does not support extent calculation.";function pjt(t,e){if(e&&t.type==="extent")return`${t.xmin},${t.ymin},${t.xmax},${t.ymax}`;if(e&&t.type==="point")return`${t.x},${t.y}`;const i=t.toJSON();return delete i.spatialReference,JSON.stringify(i)}function fjt(t,e){var l;const i=t.geometry,r=t.toJSON();delete r.compactGeometryEnabled,delete r.defaultSpatialReferenceEnabled;const s=r;let n,o,a;if(i!=null&&(o=i.spatialReference,a=nP(o),s.geometryType=bO(i),s.geometry=pjt(i,t.compactGeometryEnabled),s.inSR=a),r.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=r.groupByFieldsForStatistics.join(",")),r.objectIds&&(s.objectIds=r.objectIds.join(",")),r.orderByFields&&(s.orderByFields=r.orderByFields.join(",")),!r.outFields||!r.returnDistinctValues&&(e!=null&&e.returnCountOnly||e!=null&&e.returnExtentOnly||e!=null&&e.returnIdsOnly)?delete s.outFields:r.outFields.includes("*")?s.outFields="*":s.outFields=r.outFields.join(","),r.outSR?(s.outSR=nP(r.outSR),n=t.outSpatialReference):i&&(r.returnGeometry||r.returnCentroid)&&(s.outSR=s.inSR,n=o),r.returnGeometry&&delete r.returnGeometry,r.outStatistics&&(s.outStatistics=JSON.stringify(r.outStatistics)),r.fullText&&(s.fullText=JSON.stringify(r.fullText)),r.pixelSize&&(s.pixelSize=JSON.stringify(r.pixelSize)),r.quantizationParameters&&(t.defaultSpatialReferenceEnabled&&o!=null&&((l=t.quantizationParameters)==null?void 0:l.extent)!=null&&o.equals(t.quantizationParameters.extent.spatialReference)&&delete r.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(r.quantizationParameters)),r.parameterValues&&(s.parameterValues=JSON.stringify(r.parameterValues)),r.rangeValues&&(s.rangeValues=JSON.stringify(r.rangeValues)),r.dynamicDataSource&&(s.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r.timeExtent){const c=r.timeExtent,{start:u,end:d}=c;u==null&&d==null||(s.time=u===d?u:`${u??"null"},${d??"null"}`),delete r.timeExtent}return t.defaultSpatialReferenceEnabled&&o!=null&&n!=null&&o.equals(n)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function mjt(t,e,i,r){const s=e.timeExtent!=null&&e.timeExtent.isEmpty?{data:{features:[]}}:await jN(t,e,"json",r);return yte(e,i,s.data),s}async function Rfi(t,e,i,r){if(e.timeExtent!=null&&e.timeExtent.isEmpty)return{data:i.createFeatureResult()};const s=await gjt(t,e,r),n=s;return n.data=djt(s.data,i),n}function gjt(t,e,i){return jN(t,e,"pbf",i)}function Ifi(t,e,i){return e.timeExtent!=null&&e.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):jN(t,e,"json",i,{returnIdsOnly:!0})}function Lfi(t,e,i){return e.timeExtent!=null&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):jN(t,e,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}async function Dfi(t,e,i){if(e.timeExtent!=null&&e.timeExtent.isEmpty)return{data:{count:0,extent:null}};const r=await jN(t,e,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}),s=r.data;if(s.hasOwnProperty("extent"))return r;if(s.features)throw new Error(xwe);if(s.hasOwnProperty("count"))throw new Error(xwe);return r}async function jN(t,e,i,r={},s={}){const n=typeof t=="string"?gn(t):t,o=e.geometry?[e.geometry]:[],a=await eje(o,null,{signal:r.signal}),l=a==null?void 0:a[0];l!=null&&((e=e.clone()).geometry=l);const c=tje({...n.query,f:i,...s,...fjt(e,s)});return fr(Jh(n.path,yjt(e,s)?"query3d":"query"),{...r,responseType:i==="pbf"?"array-buffer":"json",query:{...c,...r.query}})}function yjt(t,e){return t.formatOf3DObjects!=null&&!(e.returnCountOnly||e.returnExtentOnly||e.returnIdsOnly)}var _te;const vte=new Qi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Ma=_te=class extends Se{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){var s;const i=Ye.fromJSON(e.spatialReference),r=[];for(let n=0;n<t.length;n++){const o=t[n],a=ya.fromJSON(o),l=(s=o.geometry)==null?void 0:s.spatialReference;a.geometry==null||l||(a.geometry.spatialReference=i);const c=o.aggregateGeometries,u=a.aggregateGeometries;if(c&&u!=null)for(const d in u){const f=u[d],m=c[d],g=m==null?void 0:m.spatialReference;f==null||g||(f.spatialReference=i)}r.push(a)}return r}writeGeometryType(t,e,i,r){if(t)return void vte.write(t,e,i,r);const{features:s}=this;if(s){for(const n of s)if((n==null?void 0:n.geometry)!=null)return void vte.write(n.geometry.type,e,i,r)}}readQueryGeometry(t,e){if(!t)return null;const i=!!t.spatialReference,r=_y(t);return r&&!i&&e.spatialReference&&(r.spatialReference=Ye.fromJSON(e.spatialReference)),r}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:i}=this;if(i){for(const r of i)if(r&&r.geometry!=null&&r.geometry.spatialReference)return void(e.spatialReference=r.geometry.spatialReference.toJSON())}}clone(){return new _te(this.cloneProperties())}cloneProperties(){return re({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let i=0;i<e.features.length;i++){const r=e.features[i];if(r.geometry){const s=t==null?void 0:t[i];r.geometry=(s==null?void 0:s.toJSON())||r.geometry}}return e}quantize(t){const{scale:[e,i],translate:[r,s]}=t,n=c=>Math.round((c-r)/e),o=c=>Math.round((s-c)/i),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,u=a.length;c<u;c++)l!=null&&l(a[c].geometry)||(a.splice(c,1),c--,u--);return this.transform=t,this}unquantize(){var f,m;const{geometryType:t,features:e,transform:i}=this;if(!i)return this;const{translate:[r,s],scale:[n,o]}=i,a=g=>g*n+r,l=g=>s-g*o;let c=null,u=null;if(this.hasZ&&((f=i==null?void 0:i.scale)==null?void 0:f[2])!=null){const{translate:[,,g],scale:[,,y]}=i;c=v=>v*y+g}if(this.hasM&&((m=i==null?void 0:i.scale)==null?void 0:m[3])!=null){const{translate:[,,,g],scale:[,,,y]}=i;u=v=>v==null?v:v*y+g}const d=this._getHydrationFunction(t,a,l,c,u);for(const{geometry:g}of e)g!=null&&d&&d(g);return this.transform=null,this}_quantizePoints(t,e,i){let r,s;const n=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];if(o>0){const c=e(l[0]),u=i(l[1]);c===r&&u===s||(n.push([c-r,u-s]),r=c,s=u)}else r=e(l[0]),s=i(l[1]),n.push([r,s])}return n.length>0?n:null}_getQuantizationFunction(t,e,i){return t==="point"?r=>(r.x=e(r.x),r.y=i(r.y),r):t==="polyline"||t==="polygon"?r=>{const s=ml(r)?r.rings:r.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,e,i);c&&n.push(c)}return n.length>0?(ml(r)?r.rings=n:r.paths=n,r):null}:t==="multipoint"?r=>{const s=this._quantizePoints(r.points,e,i);return s&&s.length>0?(r.points=s,r):null}:t==="extent"?r=>r:null}_getHydrationFunction(t,e,i,r,s){return t==="point"?n=>{n.x=e(n.x),n.y=i(n.y),r&&(n.z=r(n.z))}:t==="polyline"||t==="polygon"?n=>{const o=ml(n)?n.rings:n.paths;let a,l;for(let c=0,u=o.length;c<u;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const g=d[f];f>0?(a+=g[0],l+=g[1]):(a=g[0],l=g[1]),g[0]=e(a),g[1]=i(l)}}if(r&&s)for(let c=0,u=o.length;c<u;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const g=d[f];g[2]=r(g[2]),g[3]=s(g[3])}}else if(r)for(let c=0,u=o.length;c<u;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const g=d[f];g[2]=r(g[2])}}else if(s)for(let c=0,u=o.length;c<u;c++){const d=o[c];for(let f=0,m=d.length;f<m;f++){const g=d[f];g[2]=s(g[2])}}}:t==="extent"?n=>{n.xmin=e(n.xmin),n.ymin=i(n.ymin),n.xmax=e(n.xmax),n.ymax=i(n.ymax),r&&n.zmax!=null&&n.zmin!=null&&(n.zmax=r(n.zmax),n.zmin=r(n.zmin)),s&&n.mmax!=null&&n.mmin!=null&&(n.mmax=s(n.mmax),n.mmin=s(n.mmin))}:t==="multipoint"?n=>{const o=n.points;let a,l;for(let c=0,u=o.length;c<u;c++){const d=o[c];c>0?(a+=d[0],l+=d[1]):(a=d[0],l=d[1]),d[0]=e(a),d[1]=i(l)}if(r&&s)for(let c=0,u=o.length;c<u;c++){const d=o[c];d[2]=r(d[2]),d[3]=s(d[3])}else if(r)for(let c=0,u=o.length;c<u;c++){const d=o[c];d[2]=r(d[2])}else if(s)for(let c=0,u=o.length;c<u;c++){const d=o[c];d[2]=s(d[2])}}:null}};h([p({type:String,json:{write:!0}})],Ma.prototype,"displayFieldName",void 0),h([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ma.prototype,"exceededTransferLimit",void 0),h([p({type:[ya],json:{write:!0}})],Ma.prototype,"features",void 0),h([ze("features")],Ma.prototype,"readFeatures",null),h([p({type:[S6],json:{write:!0}})],Ma.prototype,"fields",void 0),h([p({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:vte.read}}})],Ma.prototype,"geometryType",void 0),h([Ze("geometryType")],Ma.prototype,"writeGeometryType",null),h([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ma.prototype,"hasM",void 0),h([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ma.prototype,"hasZ",void 0),h([p({types:B2,json:{write:!0}})],Ma.prototype,"queryGeometry",void 0),h([ze("queryGeometry")],Ma.prototype,"readQueryGeometry",null),h([p({type:Ye,json:{write:!0}})],Ma.prototype,"spatialReference",void 0),h([Ze("spatialReference")],Ma.prototype,"writeSpatialReference",null),h([p({json:{write:!0}})],Ma.prototype,"transform",void 0),Ma=_te=h([I("esri.rest.support.FeatureSet")],Ma),Ma.prototype.toJSON.isDefaultToJSON=!0;const nce=Ma;async function MW(t,e,i){const r=await _jt(t,e,i);return nce.fromJSON(r)}async function _jt(t,e,i){const r=hle(t),s={...i},n=qh.from(e),{data:o}=await mjt(r,n,n.sourceSpatialReference,s);return o}var bte;let xn=bte=class extends Se{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new bte(re({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};h([p({type:Boolean,json:{write:!0}})],xn.prototype,"cacheHint",void 0),h([p({type:xf,json:{write:!0}})],xn.prototype,"dynamicDataSource",void 0),h([p({type:String,json:{write:!0}})],xn.prototype,"gdbVersion",void 0),h([p({type:Number,json:{write:!0}})],xn.prototype,"geometryPrecision",void 0),h([p({type:Date})],xn.prototype,"historicMoment",void 0),h([Ze("historicMoment")],xn.prototype,"_writeHistoricMoment",null),h([p({type:Number,json:{write:!0}})],xn.prototype,"maxAllowableOffset",void 0),h([p({json:{write:!0}})],xn.prototype,"objectIds",void 0),h([p({type:[String],json:{write:!0}})],xn.prototype,"orderByFields",void 0),h([p({type:[String],json:{write:!0}})],xn.prototype,"outFields",void 0),h([p({type:Ye,json:{read:{source:"outSR"},write:{target:"outSR"}}})],xn.prototype,"outSpatialReference",void 0),h([p({json:{write:!0}})],xn.prototype,"relationshipId",void 0),h([p({type:Number,json:{read:{source:"resultOffset"}}})],xn.prototype,"start",void 0),h([Ze("start"),Ze("num")],xn.prototype,"writeStart",null),h([p({type:Number,json:{read:{source:"resultRecordCount"}}})],xn.prototype,"num",void 0),h([p({json:{write:!0}})],xn.prototype,"returnGeometry",void 0),h([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],xn.prototype,"returnM",void 0),h([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],xn.prototype,"returnZ",void 0),h([p({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],xn.prototype,"where",void 0),xn=bte=h([I("esri.rest.support.RelationshipQuery")],xn),xn.from=nn(xn);const aO=xn,Nfi=Object.freeze(Object.defineProperty({__proto__:null,default:aO},Symbol.toStringTag,{value:"Module"}));var wte;let gM=wte=class extends Se{constructor(t){super(t),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new wte({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};h([p({type:[String],json:{write:!0}})],gM.prototype,"groupByFields",void 0),h([p({type:Number,json:{write:!0}})],gM.prototype,"topCount",void 0),h([p({type:[String],json:{write:!0}})],gM.prototype,"orderByFields",void 0),gM=wte=h([I("esri.rest.support.TopFilter")],gM);const vjt=gM;var xte;const Twe=new Qi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),Swe=new Qi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Js=xte=class extends Se{constructor(t){super(t),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new xte(re({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};h([p({type:Boolean,json:{write:!0}})],Js.prototype,"cacheHint",void 0),h([p({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],Js.prototype,"distance",void 0),h([p({types:B2,json:{read:_y,write:!0}})],Js.prototype,"geometry",void 0),h([p({type:Number,json:{write:!0}})],Js.prototype,"geometryPrecision",void 0),h([p({type:Number,json:{write:!0}})],Js.prototype,"maxAllowableOffset",void 0),h([p({type:Number,json:{read:{source:"resultRecordCount"}}})],Js.prototype,"num",void 0),h([p({json:{write:!0}})],Js.prototype,"objectIds",void 0),h([p({type:[String],json:{write:!0}})],Js.prototype,"orderByFields",void 0),h([p({type:[String],json:{write:!0}})],Js.prototype,"outFields",void 0),h([p({type:Ye,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Js.prototype,"outSpatialReference",void 0),h([p({type:String,json:{write:!0}})],Js.prototype,"resultType",void 0),h([p({json:{write:!0}})],Js.prototype,"returnGeometry",void 0),h([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Js.prototype,"returnM",void 0),h([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Js.prototype,"returnZ",void 0),h([p({type:Number,json:{read:{source:"resultOffset"}}})],Js.prototype,"start",void 0),h([Ze("start"),Ze("num")],Js.prototype,"writeStart",null),h([p({type:String,json:{read:{source:"spatialRel",reader:Twe.read},write:{target:"spatialRel",writer:Twe.write}}})],Js.prototype,"spatialRelationship",void 0),h([p({type:za,json:{write:!0}})],Js.prototype,"timeExtent",void 0),h([p({type:vjt,json:{write:!0}})],Js.prototype,"topFilter",void 0),h([p({type:String,json:{read:Swe.read,write:{writer:Swe.write,overridePolicy(t){return{enabled:t!=null&&this.distance!=null&&this.distance>0}}}}})],Js.prototype,"units",void 0),h([p({type:String,json:{write:!0}})],Js.prototype,"where",void 0),Js=xte=h([I("esri.rest.support.TopFeaturesQuery")],Js),Js.from=nn(Js);const sk=Js,bjt="esri.widgets.Feature.support.relatedFeatureUtils",Ewe=()=>ne.getLogger(bjt),Cwe=new Map;function NV(t){if(!c_(t))return null;const[e,i]=t.split("/").slice(1);return{layerId:e,fieldName:i}}function wjt(t,e){if(!e.relationships)return null;let i=null;const{relationships:r}=e;return r.some(s=>s.id===parseInt(t,10)&&(i=s,!0)),i}function xjt({originRelationship:t,relationships:e,layerId:i}){return e.find(({relatedTableId:r,id:s})=>`${r}`===i&&s===(t==null?void 0:t.id))??null}function Tjt(t,e){const i=e.toLowerCase();for(const r in t)if(r.toLowerCase()===i)return t[r];return null}function Sjt(t,e){const i=wjt(t,e);if(i)return{url:`${e.url}/${i.relatedTableId}`,sourceSpatialReference:e.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function Ejt(t,e){if(!e||!t)return;const{features:i,statsFeatures:r}=t,s=i==null?void 0:i.value;e.relatedFeatures=s?s.features:[];const n=r==null?void 0:r.value;e.relatedStatsFeatures=n?n.features:[]}function Cjt(t,e,i,r){var n;const s=new aO;return s.outFields=["*"],s.relationshipId=typeof e.id=="number"?e.id:parseInt(e.id,10),s.objectIds=[t.attributes[i.objectIdField]],s.gdbVersion=i.gdbVersion??null,s.historicMoment=i.historicMoment??null,((n=i.queryRelatedFeatures)==null?void 0:n.call(i,s,r))??Promise.resolve({})}function Mjt(t,e,i){let r=0;const s=[];for(;r<e.length;)s.push(`${t} IN (${e.slice(r,i+r)})`),r+=i;return s.join(" OR ")}function Ajt(t){return t?D2(t):void 0}function Pjt(t){return t?D2(t,(e,i)=>JSON.stringify(e.toJSON())===JSON.stringify(i.toJSON())):void 0}async function Ojt(t,e,i,r){const s=i.layerId.toString(),{layerInfo:n,relation:o,relatedFields:a,outStatistics:l,url:c,sourceSpatialReference:u}=e,d=Ajt(a),f=Pjt(l);if(!n||!o)return null;const m=xjt({originRelationship:o,relationships:n.relationships,layerId:s});if(m!=null&&m.relationshipTableId&&m.keyFieldInRelationshipTable){const y=(await Cjt(t,m,i,r))[t.attributes[i.objectIdField]];if(!y)return null;const v=y.features.map(b=>b.attributes[n.objectIdField]);if(f!=null&&f.length&&n.supportsStatistics){const b=new qh;b.where=Mjt(n.objectIdField,v,1e3),b.outFields=d,b.outStatistics=f,b.sourceSpatialReference=u;const w={features:Promise.resolve(y),statsFeatures:MW(c,b)};return nm(w)}}const g=m==null?void 0:m.keyField;if(g){const y=m6(Djt(n.fields,g)),v=Tjt(t.attributes,o.keyField),b=y?`${g}=${v}`:`${g}='${v}'`,w=i.historicMoment,x=i.gdbVersion,T=MW(c,new qh({where:b,outFields:d,sourceSpatialReference:u,historicMoment:w,gdbVersion:x}),r),E=f!=null&&f.length&&n.supportsStatistics?MW(c,new qh({where:b,outFields:d,outStatistics:f,sourceSpatialReference:u}),r):null,M={features:T};return E&&(M.statsFeatures=E),nm(M)}return null}function $jt(t,e){return fr(t,{query:{f:"json"},signal:e==null?void 0:e.signal})}function Rjt({relatedInfos:t,layer:e},i){const r={};return t.forEach((s,n)=>{const{relation:o}=s;if(!o){const d=new B("relation-required","A relation is required on a layer to retrieve related records.");throw Ewe().error(d),d}const{relatedTableId:a}=o;if(typeof a!="number"){const d=new B("A related table ID is required on a layer to retrieve related records.");throw Ewe().error(d),d}const l=`${e.url}/${a}`,c=Cwe.get(l),u=c??$jt(l);c||Cwe.set(l,u),r[n]=u}),wre(nm(r),i)}function Ijt({graphic:t,relatedInfos:e,layer:i},r){const s={};return e.forEach((n,o)=>{n.layerInfo&&(s[o]=Ojt(t,n,i,r))}),nm(s)}function Ljt({relatedInfo:t,fieldName:e,fieldInfo:i}){var r,s;if((r=t.relatedFields)==null||r.push(e),i.statisticType){const n=new xRe({statisticType:i.statisticType,onStatisticField:e,outStatisticFieldName:e});(s=t.outStatistics)==null||s.push(n)}}function Djt(t,e){if(t!=null){e=e.toLowerCase();for(const i of t)if(i&&i.name.toLowerCase()===e)return i}return null}const Mwe={chartAnimation:!0};let Oo=class extends Ue{constructor(e){super(e),this.abilities={...Mwe},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{...Mwe,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:i}=this,r=(e+i)%i;this.activeMediaInfoIndex=r}_pageContentElementMedia(e){const{activeMediaInfoIndex:i}=this,r=i+e;this._setContentElementMedia(r)}_formatMediaInfos(){const{mediaInfos:e,layer:i}=this,r=this.attributes??{},s=this.formattedAttributes??{},n=this.expressionAttributes??{},o=this.fieldInfoMap??new Map;return(e==null?void 0:e.map(a=>{const l=a==null?void 0:a.clone();return l?(l.title=gS({attributes:r,fieldInfoMap:o,globalAttributes:s,expressionAttributes:n,layer:i,text:l.title}),l.caption=gS({attributes:r,fieldInfoMap:o,globalAttributes:s,expressionAttributes:n,layer:i,text:l.caption}),l.altText=gS({attributes:r,fieldInfoMap:o,globalAttributes:s,expressionAttributes:n,layer:i,text:l.altText}),l.type==="image"?l.value?(this._setImageValue({value:l.value,formattedAttributes:s,layer:i}),l.value.sourceURL?l:void 0):void 0:l.type==="pie-chart"||l.type==="line-chart"||l.type==="column-chart"||l.type==="bar-chart"?l.value?(this._setChartValue({value:l.value,chartType:l.type,attributes:r,formattedAttributes:s,layer:i,expressionAttributes:n}),l):void 0:null):null}).filter(sd))??[]}_setImageValue(e){const i=this.fieldInfoMap??new Map,{value:r,formattedAttributes:s,layer:n}=e,{linkURL:o,sourceURL:a}=r;if(a){const l=pte(a,n);r.sourceURL=dte({formattedAttributes:s,template:l,fieldInfoMap:i})}if(o){const l=pte(o,n);r.linkURL=dte({formattedAttributes:s,template:l,fieldInfoMap:i})}}_setChartValue(e){const{value:i,attributes:r,formattedAttributes:s,chartType:n,layer:o,expressionAttributes:a}=e,{popupTemplate:l,relatedInfos:c}=this,{fields:u,normalizeField:d}=i,f=o;if(i.fields=qzt(u,f),d&&(i.normalizeField=MD(d,f)),!u.some(g=>!!(s[g]!=null||c_(g)&&(c!=null&&c.size))))return;const m=(l==null?void 0:l.fieldInfos)??[];u.forEach((g,y)=>{var w;const v=(w=i.colors)==null?void 0:w[y];if(c_(g))return void(i.series=[...i.series,...this._getRelatedChartInfos({fieldInfos:m,fieldName:g,formattedAttributes:s,chartType:n,value:i,color:v})]);const b=this._getChartOption({value:i,attributes:r,chartType:n,formattedAttributes:s,expressionAttributes:a,fieldName:g,fieldInfos:m,color:v});i.series.push(b)})}_getRelatedChartInfos(e){var g;const{fieldInfos:i,fieldName:r,formattedAttributes:s,chartType:n,value:o,color:a}=e,l=[],c=NV(r),u=c&&((g=this.relatedInfos)==null?void 0:g.get(c.layerId.toString()));if(!u)return l;const{relatedFeatures:d,relation:f}=u;if(!f||!d)return l;const{cardinality:m}=f;return d.forEach(y=>{const{attributes:v}=y;v&&Object.keys(v).forEach(b=>{b===c.fieldName&&l.push(this._getChartOption({value:o,attributes:v,formattedAttributes:s,fieldName:r,chartType:n,relatedFieldName:b,hasMultipleRelatedFeatures:(d==null?void 0:d.length)>1,fieldInfos:i,color:a}))})}),m==="one-to-many"||m==="many-to-many"?l:[l[0]]}_getTooltip({label:e,value:i,chartType:r}){return r==="pie-chart"?`${e}`:`${e}: ${i}`}_getChartOption(e){var O;const{value:i,attributes:r,formattedAttributes:s,expressionAttributes:n,fieldName:o,relatedFieldName:a,fieldInfos:l,chartType:c,hasMultipleRelatedFeatures:u,color:d}=e,f=this.layer,m=this.fieldInfoMap??new Map,{normalizeField:g,tooltipField:y}=i,v=g?c_(g)?r[NV(g).fieldName]:r[g]:null,b=Kle(o)&&n&&n[o]!==void 0?n[o]:a&&r[a]!==void 0?r[a]:r[o]!==void 0?r[o]:s[o],w=new E$e({fieldName:o,color:d,value:b===void 0?null:b&&v?b/v:b});if(c_(o)){const D=m.get(o.toLowerCase()),U=y&&m.get(y.toLowerCase()),k=(D==null?void 0:D.fieldName)??o,H=u&&y?NV(y).fieldName:(U==null?void 0:U.fieldName)??y,V=u&&H?r[H]:s[H]??(D==null?void 0:D.label)??(D==null?void 0:D.fieldName)??a,X=u&&a?r[a]:s[k];return w.tooltip=this._getTooltip({label:V,value:X,chartType:c}),w}const x=jBe(l,o),T=MD(o,f),E=y&&s[y]!==void 0?s[y]:VBe(x||new sN({fieldName:T}),(O=this.popupTemplate)==null?void 0:O.expressionInfos),M=s[T];return w.tooltip=this._getTooltip({label:E,value:M,chartType:c}),w}};h([p()],Oo.prototype,"abilities",void 0),h([Qt("abilities")],Oo.prototype,"castAbilities",null),h([p()],Oo.prototype,"activeMediaInfoIndex",void 0),h([p({readOnly:!0})],Oo.prototype,"activeMediaInfo",null),h([p()],Oo.prototype,"attributes",void 0),h([p()],Oo.prototype,"description",void 0),h([p()],Oo.prototype,"fieldInfoMap",void 0),h([p()],Oo.prototype,"formattedAttributes",void 0),h([p()],Oo.prototype,"expressionAttributes",void 0),h([p({readOnly:!0})],Oo.prototype,"formattedMediaInfos",null),h([p()],Oo.prototype,"isAggregate",void 0),h([p()],Oo.prototype,"layer",void 0),h([p({readOnly:!0})],Oo.prototype,"formattedMediaInfoCount",null),h([p()],Oo.prototype,"mediaInfos",void 0),h([p()],Oo.prototype,"popupTemplate",void 0),h([p()],Oo.prototype,"relatedInfos",void 0),h([p()],Oo.prototype,"title",void 0),Oo=h([I("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],Oo);const _S=Oo,Eo="esri-feature-media",xc={base:Eo,mediaContainer:`${Eo}__container`,mediaItemContainer:`${Eo}__item-container`,mediaItem:`${Eo}__item`,mediaItemText:`${Eo}__item-text`,mediaItemTitle:`${Eo}__item-title`,mediaItemCaption:`${Eo}__item-caption`,mediaNavigation:`${Eo}__item-navigation`,mediaPagination:`${Eo}__pagination`,mediaPaginationText:`${Eo}__pagination-text`,mediaPrevious:`${Eo}__previous`,mediaPreviousIconLTR:`${Eo}__previous-icon`,mediaPreviousIconRTL:`${Eo}__previous-icon--rtl`,mediaNext:`${Eo}__next`,mediaNextIconLTR:`${Eo}__next-icon`,mediaNextIconRTL:`${Eo}__next-icon--rtl`,mediaChart:`${Eo}__chart`,mediaPaginationButton:`${Eo}__pagination-button`,mediaPaginationIcon:`${Eo}__pagination-icon`,mediaChartRendered:`${Eo}__chart--rendered`},AW=15,jv="category",rR="value",Njt="rgba(50, 50, 50, 1)",Fjt=250,kjt=500,Ujt=200;let Lc=class extends Wo{constructor(e,i){super(e,i),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new _S,this.messages=null,this._disposeChart=r=>{var s;(s=this._chartRootMap.get(r))==null||s.dispose(),this._chartRootMap.delete(r)},this._createChart=async r=>{const{destroyed:s,viewModel:n}=this;if(s||!n||!r)return;const{createRoot:o}=await oe(()=>import("./chartUtilsAm5-Cs1TIBZA.js"),__vite__mapDeps([219,220,221,222])),a=await o(r);this._chartRootMap.set(r,a),this._renderChart({mediaInfo:n.activeMediaInfo,root:a})}}initialize(){this._featureElementInfo=new B8,this.addHandles([te(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(i=this.viewModel)==null?void 0:i.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),pt),te(()=>{var e,i;return[(e=this.viewModel)==null?void 0:e.description,(i=this.viewModel)==null?void 0:i.title]},()=>this._setupFeatureElementInfo(),pt)])}loadDependencies(){return Cp({icon:()=>oe(()=>import("./calcite-icon-eob-Ctv5.js"),__vite__mapDeps([211,209,200,201,208]))})}destroy(){var e;this._clearMediaRefreshTimer(),(e=this._featureElementInfo)==null||e.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var e;return Q("div",{bind:this,class:xc.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this._renderMedia())}_renderMedia(){const{formattedMediaInfoCount:e,activeMediaInfoIndex:i}=this.viewModel,r=this._renderMediaText();return e?Q("div",{class:xc.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),Q("div",{class:xc.mediaNavigation},r,e>1?Q("div",{class:xc.mediaPagination},this._renderMediaPageButton("previous"),Q("span",{class:xc.mediaPaginationText},Pg(this.messages.pageText,{index:i+1,total:e})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const i=e&&e.title?Q("div",{class:xc.mediaItemTitle,innerHTML:e.title,key:"media-title"}):null,r=e&&e.caption?Q("div",{class:xc.mediaItemCaption,innerHTML:e.caption,key:"media-caption"}):null;return i||r?Q("div",{class:xc.mediaItemText,key:"media-text"},i,r):null}_renderImageMediaInfo(e){if(!e.value)return null;const{_refreshIntervalInfo:i}=this,{activeMediaInfoIndex:r,formattedMediaInfoCount:s}=this.viewModel,{value:n,refreshInterval:o,altText:a,title:l,type:c}=e,{sourceURL:u,linkURL:d}=n,f=UBe(d??void 0)?"_blank":"_self",m=f==="_blank"?"noreferrer":"",g=o?i:null,y=g?g.timestamp:0,v=g?g.sourceURL:u,b=Q("img",{alt:a||l,key:`media-${c}-${r}-${s}-${y}`,src:v??void 0});return(d?Q("a",{href:d,rel:m,target:f,title:l},b):null)??b}_renderChartMediaInfo(e){const{activeMediaInfoIndex:i,formattedMediaInfoCount:r}=this.viewModel;return Q("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:xc.mediaChart,key:`media-${e.type}-${i}-${r}`})}_renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this._renderImageMediaInfo(e):e.type.includes("chart")?this._renderChartMediaInfo(e):null:null}_renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;return e?Q("div",{class:xc.mediaItemContainer,key:"media-container"},Q("div",{class:xc.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const i=e==="previous",r=i?this.messages.previous:this.messages.next,s=i?"chevron-left":"chevron-right",n=i?"media-previous":"media-next",o=i?this._previous:this._next;return Q("button",{"aria-label":r,bind:this,class:xc.mediaPaginationButton,key:n,onclick:o,tabIndex:0,title:r,type:"button"},Q("calcite-icon",{class:xc.mediaPaginationIcon,icon:s,scale:"s"}))}_setupFeatureElementInfo(){var r;const{description:e,title:i}=this;(r=this._featureElementInfo)==null||r.set({description:e,title:i})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;const{isAggregate:e,layer:i}=this.viewModel;return e&&(i!=null&&i.featureReduction)&&"renderer"in i.featureReduction?i.featureReduction.renderer:i==null?void 0:i.renderer}async _getSeriesColors(e){const{colorAm5:i}=await oe(()=>import("./chartCommon-73TzNfEX.js"),__vite__mapDeps([223,220,224,221,225])),r=new Map;return e.forEach(s=>{s.color&&r.set(s,i(s.color.toCss(!0)))}),r}async _getRendererColors(){const{colorAm5:e}=await oe(()=>import("./chartCommon-73TzNfEX.js"),__vite__mapDeps([223,220,224,221,225])),i=new Map,r=this._getRenderer(),s="default";if(!r)return i;const n=await VBt(r);return n.delete(s),Array.from(n.values()).every(o=>(o==null?void 0:o.length)===1)&&Array.from(n.keys()).forEach(o=>{var l,c;const a=(c=(l=n.get(o))==null?void 0:l[0])==null?void 0:c.toCss(!0);a&&i.set(o,e(a))}),i}_handleMediaKeyup(e){const{key:i}=e;i==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),i==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!MRe()}_getChartAnimationMS(){return this._canAnimateChart()?Fjt:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?kjt:0}async _renderChart(e){const{root:i,mediaInfo:r}=e,{value:s,type:n}=r,{ResponsiveThemeAm5:o,DarkThemeAm5:a,AnimatedThemeAm5:l,ColorSetAm5:c,ThemeAm5:u,esriChartColorSet:d}=await oe(async()=>{const{ResponsiveThemeAm5:T,DarkThemeAm5:E,AnimatedThemeAm5:M,ColorSetAm5:O,ThemeAm5:D,esriChartColorSet:U}=await import("./chartCommon-73TzNfEX.js");return{ResponsiveThemeAm5:T,DarkThemeAm5:E,AnimatedThemeAm5:M,ColorSetAm5:O,ThemeAm5:D,esriChartColorSet:U}},__vite__mapDeps([223,220,224,221,225])),f=u.new(i);f.rule("ColorSet").set("colors",d),f.rule("ColorSet").set("reuse",!0);const m=[o.new(i),f];Wze()&&m.push(a.new(i)),this._canAnimateChart()&&m.push(l.new(i)),i.setThemes(m);const g=await this._getRendererColors(),y=await this._getSeriesColors(s.series),v=c.new(i,{}),b=y.get(s.series[0]),w=b?{lineSettings:{stroke:b}}:void 0,x=s.series.map((T,E)=>{const M=y.get(T)||g.get(T.fieldName)||v.getIndex(E);return{[jv]:T.tooltip,[rR]:T.value,columnSettings:{fill:M,stroke:M},...w}}).filter(T=>n!=="pie-chart"||T.value!=null&&T.value>0);n==="pie-chart"?this._createPieChart(e,x):this._createXYChart(e,x)}_getDirection(){return Zb(this.container)?"rtl":"ltr"}_isInversed(){return!!Zb(this.container)}async _customizeChartTooltip(e,i="horizontal"){var s;const{colorAm5:r}=await oe(()=>import("./chartCommon-73TzNfEX.js"),__vite__mapDeps([223,220,224,221,225]));e.setAll({pointerOrientation:i}),(s=e.get("background"))==null||s.setAll({stroke:r(Njt)}),e.label.setAll({direction:this._getDirection(),oversizedBehavior:"wrap",maxWidth:Ujt})}async _createPieChart(e,i){const{TooltipAm5:r}=await oe(()=>import("./chartCommon-73TzNfEX.js"),__vite__mapDeps([223,220,224,221,225])),{PieChartAm5:s,PieSeriesAm5:n}=await oe(async()=>{const{PieChartAm5:y,PieSeriesAm5:v}=await import("./pieChart-Yx89CjWe.js");return{PieChartAm5:y,PieSeriesAm5:v}},__vite__mapDeps([226,227,220,225,222])),{mediaInfo:o,root:a}=e,{title:l}=o,c=5,u=(o==null?void 0:o.altText)||(o==null?void 0:o.title)||"",d=a.container.children.push(s.new(a,{ariaLabel:u,focusable:!0,paddingBottom:c,paddingTop:c,paddingLeft:c,paddingRight:c})),f=`{category}: {valuePercentTotal.formatNumber('0.00')}%
 ({value})`,m=r.new(a,{labelText:f}),g=d.series.push(n.new(a,{name:l,valueField:rR,categoryField:jv,tooltip:m}));g.ticks.template.set("forceHidden",!0),g.labels.template.set("forceHidden",!0),g.slices.template.states.create("active",{shiftRadius:c}),this._customizeChartTooltip(m),g.slices.template.setAll({ariaLabel:f,focusable:!0,templateField:"columnSettings"}),g.data.setAll(i),g.appear(this._getChartSeriesAnimationMS()),d.appear(this._getChartAnimationMS()),d.root.dom.classList.toggle(xc.mediaChartRendered,!0)}_getMinSeriesValue(e){let i=0;return e.forEach(r=>i=Math.min(r.value,i)),i}async _createColumnChart(e,i,r){const{TooltipAm5:s,ScrollbarAm5:n}=await oe(()=>import("./chartCommon-73TzNfEX.js"),__vite__mapDeps([223,220,224,221,225])),{CategoryAxisAm5:o,AxisRendererXAm5:a,ValueAxisAm5:l,AxisRendererYAm5:c,ColumnSeriesAm5:u}=await oe(async()=>{const{CategoryAxisAm5:T,AxisRendererXAm5:E,ValueAxisAm5:M,AxisRendererYAm5:O,ColumnSeriesAm5:D}=await import("./xyChart-BLQ1eQtR.js");return{CategoryAxisAm5:T,AxisRendererXAm5:E,ValueAxisAm5:M,AxisRendererYAm5:O,ColumnSeriesAm5:D}},__vite__mapDeps([228,220,225,222,227,224])),{mediaInfo:d,root:f}=i,{value:m,title:g}=d;e.setAll({wheelX:"panX",wheelY:"zoomX"});const y=e.xAxes.push(o.new(f,{renderer:a.new(f,{inversed:this._isInversed()}),categoryField:jv}));y.get("renderer").labels.template.setAll({forceHidden:!0});const v=e.yAxes.push(l.new(f,{renderer:c.new(f,{inside:!1}),min:this._getMinSeriesValue(m.series)}));v.get("renderer").labels.template.setAll({direction:this._getDirection()});const b="{categoryX}",w=s.new(f,{labelText:b}),x=e.series.push(u.new(f,{name:g,xAxis:y,yAxis:v,valueYField:rR,categoryXField:jv,tooltip:w}));this._customizeChartTooltip(w),x.columns.template.setAll({ariaLabel:b,focusable:!0,templateField:"columnSettings"}),m.series.length>AW&&e.set("scrollbarX",n.new(f,{orientation:"horizontal"})),y.data.setAll(r),x.data.setAll(r),x.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createBarChart(e,i,r){const{TooltipAm5:s,ScrollbarAm5:n}=await oe(()=>import("./chartCommon-73TzNfEX.js"),__vite__mapDeps([223,220,224,221,225])),{CategoryAxisAm5:o,AxisRendererXAm5:a,ValueAxisAm5:l,AxisRendererYAm5:c,ColumnSeriesAm5:u}=await oe(async()=>{const{CategoryAxisAm5:T,AxisRendererXAm5:E,ValueAxisAm5:M,AxisRendererYAm5:O,ColumnSeriesAm5:D}=await import("./xyChart-BLQ1eQtR.js");return{CategoryAxisAm5:T,AxisRendererXAm5:E,ValueAxisAm5:M,AxisRendererYAm5:O,ColumnSeriesAm5:D}},__vite__mapDeps([228,220,225,222,227,224])),{mediaInfo:d,root:f}=i,{value:m,title:g}=d;e.setAll({wheelX:"panY",wheelY:"zoomY"});const y=e.yAxes.push(o.new(f,{renderer:c.new(f,{inversed:!0}),categoryField:jv}));y.get("renderer").labels.template.setAll({forceHidden:!0});const v=e.xAxes.push(l.new(f,{renderer:a.new(f,{inside:!1,inversed:this._isInversed()}),min:this._getMinSeriesValue(m.series)}));v.get("renderer").labels.template.setAll({direction:this._getDirection()});const b="{categoryY}",w=s.new(f,{labelText:b}),x=e.series.push(u.new(f,{name:g,xAxis:v,yAxis:y,valueXField:rR,categoryYField:jv,tooltip:w}));this._customizeChartTooltip(w,"vertical"),x.columns.template.setAll({ariaLabel:b,focusable:!0,templateField:"columnSettings"}),m.series.length>AW&&e.set("scrollbarY",n.new(f,{orientation:"vertical"})),y.data.setAll(r),x.data.setAll(r),x.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createLineChart(e,i,r){var E,M,O;const{TooltipAm5:s,ScrollbarAm5:n}=await oe(()=>import("./chartCommon-73TzNfEX.js"),__vite__mapDeps([223,220,224,221,225])),{CategoryAxisAm5:o,AxisRendererXAm5:a,ValueAxisAm5:l,AxisRendererYAm5:c,LineSeriesAm5:u}=await oe(async()=>{const{CategoryAxisAm5:D,AxisRendererXAm5:U,ValueAxisAm5:k,AxisRendererYAm5:H,LineSeriesAm5:V}=await import("./xyChart-BLQ1eQtR.js");return{CategoryAxisAm5:D,AxisRendererXAm5:U,ValueAxisAm5:k,AxisRendererYAm5:H,LineSeriesAm5:V}},__vite__mapDeps([228,220,225,222,227,224])),{root:d,mediaInfo:f}=i,{value:m,title:g}=f;e.setAll({wheelX:"panX",wheelY:"zoomX"});const y=e.xAxes.push(o.new(d,{renderer:a.new(d,{inversed:this._isInversed()}),categoryField:jv}));y.get("renderer").labels.template.setAll({forceHidden:!0});const v=e.yAxes.push(l.new(d,{renderer:c.new(d,{inside:!1}),min:this._getMinSeriesValue(m.series)}));v.get("renderer").labels.template.setAll({direction:this._getDirection()});const b="{categoryX}",w=(M=(E=r[0])==null?void 0:E.lineSettings)==null?void 0:M.stroke,x=s.new(d,{getFillFromSprite:!w,labelText:b});w&&((O=x.get("background"))==null||O.setAll({fill:w}));const T=e.series.push(u.new(d,{name:g,xAxis:y,yAxis:v,valueYField:rR,categoryXField:jv,tooltip:x}));T.strokes.template.setAll({templateField:"lineSettings"}),this._customizeChartTooltip(x,"vertical"),m.series.length>AW&&e.set("scrollbarX",n.new(d,{orientation:"horizontal"})),y.data.setAll(r),T.data.setAll(r),T.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())}async _createXYChart(e,i){const{XYChartAm5:r,XYCursorAm5:s}=await oe(()=>import("./xyChart-BLQ1eQtR.js"),__vite__mapDeps([228,220,225,222,227,224])),{root:n,mediaInfo:o}=e,{type:a}=o,l=(o==null?void 0:o.altText)||(o==null?void 0:o.title)||"",c=n.container.children.push(r.new(n,{ariaLabel:l,focusable:!0,panX:!0,panY:!0}));c.set("cursor",s.new(n,{})),a==="column-chart"&&await this._createColumnChart(c,e,i),a==="bar-chart"&&await this._createBarChart(c,e,i),a==="line-chart"&&await this._createLineChart(c,e,i),c.root.dom.classList.toggle(xc.mediaChartRendered,!0)}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const i=Date.now();this._refreshIntervalInfo={timestamp:i,sourceURL:e&&this._getImageSource(e,i)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;(e==null?void 0:e.type)==="image"&&(e==null?void 0:e.refreshInterval)>0&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:i,value:r}=e,s=6e4*i;this._updateMediaInfoTimestamp(r.sourceURL);const n=setInterval(()=>{this._updateMediaInfoTimestamp(r.sourceURL)},s);this._refreshTimer=n}_getImageSource(e,i){const r=e.includes("?")?"&":"?",[s,n=""]=e.split("#");return`${s}${r}timestamp=${i}${n?"#":""}${n}`}};h([p()],Lc.prototype,"_refreshIntervalInfo",void 0),h([p()],Lc.prototype,"attributes",null),h([p()],Lc.prototype,"activeMediaInfoIndex",null),h([p()],Lc.prototype,"description",null),h([p()],Lc.prototype,"fieldInfoMap",null),h([p()],Lc.prototype,"layer",null),h([p()],Lc.prototype,"mediaInfos",null),h([p()],Lc.prototype,"popupTemplate",null),h([p()],Lc.prototype,"relatedInfos",null),h([p()],Lc.prototype,"title",null),h([p({type:_S})],Lc.prototype,"viewModel",void 0),h([p(),qo("esri/widgets/Feature/t9n/Feature")],Lc.prototype,"messages",void 0),Lc=h([I("esri.widgets.Feature.FeatureMedia")],Lc);const rje=Lc;var Tte;let i3=Tte=class extends Se{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new Tte({minValue:this.minValue,maxValue:this.maxValue})}};h([p({type:Number,json:{write:!0}})],i3.prototype,"minValue",void 0),h([p({type:Number,json:{write:!0}})],i3.prototype,"maxValue",void 0),i3=Tte=h([I("esri.renderers.support.AuthoringInfoClassBreakInfo")],i3);var Ste;let j1=Ste=class extends Se{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=new Array}clone(){return new Ste({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:re(this.classBreakInfos)})}};h([p({type:String,json:{write:!0}})],j1.prototype,"field",void 0),h([p({type:String,json:{write:!0}})],j1.prototype,"normalizationField",void 0),h([p({type:String,json:{write:!0}})],j1.prototype,"label",void 0),h([p({type:[i3],json:{write:!0}})],j1.prototype,"classBreakInfos",void 0),j1=Ste=h([I("esri.renderers.support.AuthoringInfoFieldInfo")],j1);var Ete;let yM=Ete=class extends Se{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new Ete({label:this.label,value:this.value,size:this.size})}};h([p({type:String,json:{write:!0}})],yM.prototype,"label",void 0),h([p({type:Number,json:{write:!0}})],yM.prototype,"size",void 0),h([p({type:Number,json:{write:!0}})],yM.prototype,"value",void 0),yM=Ete=h([I("esri.renderers.support.AuthoringInfoSizeStop")],yM);const Vjt=yM;var Cte;const nk=new Qi({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),ok=new Qi({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),Awe={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},Pwe=["high-to-low","above-and-below","centered-on","extremes"],Owe=[...new Set(["high-to-low","above-and-below","centered-on","extremes","above","below","high-to-low","above-and-below","above","below","reference-size"])],$we=["seconds","minutes","hours","days","months","years"],zjt=["circle","diamond","hexagon-flat","hexagon-pointy","square"];let Aa=Cte=class extends Se{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}get normalizationField(){return this.theme==="reference-size"?this._get("normalizationField"):null}set normalizationField(t){this._set("normalizationField",t)}get referenceSizeScale(){return this.theme==="reference-size"?this._get("referenceSizeScale"):null}set referenceSizeScale(t){this._set("referenceSizeScale",t)}get referenceSizeSymbolStyle(){return this.theme==="reference-size"?this._get("referenceSizeSymbolStyle"):null}set referenceSizeSymbolStyle(t){this._set("referenceSizeSymbolStyle",t)}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get sizeStops(){return this.theme==="reference-size"?this._get("sizeStops"):null}set sizeStops(t){this._set("sizeStops",t)}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new Cte({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,normalizationField:this.normalizationField,referenceSizeScale:this.referenceSizeScale,referenceSizeSymbolStyle:this.referenceSizeSymbolStyle,sizeStops:re(this.sizeStops),startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};h([p({types:Awe,json:{write:!0}})],Aa.prototype,"endTime",void 0),h([Qt("endTime")],Aa.prototype,"castEndTime",null),h([p({type:String,json:{write:!0}})],Aa.prototype,"field",void 0),h([p({type:Number,json:{write:!0}})],Aa.prototype,"maxSliderValue",void 0),h([p({type:Number,json:{write:!0}})],Aa.prototype,"minSliderValue",void 0),h([p({type:String,json:{origins:{"web-scene":{write:!1}},write:!0}})],Aa.prototype,"normalizationField",null),h([p({type:Number,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],Aa.prototype,"referenceSizeScale",null),h([p({type:zjt,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],Aa.prototype,"referenceSizeSymbolStyle",null),h([p({types:Awe,json:{write:!0}})],Aa.prototype,"startTime",void 0),h([Qt("startTime")],Aa.prototype,"castStartTime",null),h([p({type:[Vjt],json:{origins:{"web-scene":{write:!1}},write:!0}})],Aa.prototype,"sizeStops",null),h([p({type:nk.apiValues,value:null,json:{type:nk.jsonValues,read:nk.read,write:nk.write}})],Aa.prototype,"style",null),h([p({type:Owe,value:null,json:{type:Owe,origins:{"web-scene":{type:Pwe,write:{writer:(t,e)=>{Pwe.includes(t)&&(e.theme=t)}}}},write:!0}})],Aa.prototype,"theme",null),h([p({type:ok.apiValues,json:{type:ok.jsonValues,read:ok.read,write:ok.write}})],Aa.prototype,"type",void 0),h([p({type:$we,json:{type:$we,write:!0}})],Aa.prototype,"units",void 0),Aa=Cte=h([I("esri.renderers.support.AuthoringInfoVisualVariable")],Aa);const Bjt=Aa;let FV=class extends Se{constructor(e){super(e),this.type=null}};h([p({readOnly:!0,json:{read:!1,write:!0}})],FV.prototype,"type",void 0),FV=h([I("esri.rest.support.ColorRamp")],FV);const oce=FV;var Mte;let ET=Mte=class extends oce{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new Mte({fromColor:re(this.fromColor),toColor:re(this.toColor),algorithm:this.algorithm})}};h([$t({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],ET.prototype,"algorithm",void 0),h([p({type:je,json:{type:[Ji],write:!0}})],ET.prototype,"fromColor",void 0),h([p({type:je,json:{type:[Ji],write:!0}})],ET.prototype,"toColor",void 0),h([p({type:["algorithmic"]})],ET.prototype,"type",void 0),ET=Mte=h([I("esri.rest.support.AlgorithmicColorRamp")],ET);const ace=ET;var Ate;let r3=Ate=class extends oce{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new Ate({colorRamps:re(this.colorRamps)})}};h([p({type:[ace],json:{write:!0}})],r3.prototype,"colorRamps",void 0),h([p({type:["multipart"]})],r3.prototype,"type",void 0),r3=Ate=h([I("esri.rest.support.MultipartColorRamp")],r3);const sje=r3,jjt={key:"type",base:oce,typeMap:{algorithmic:ace,multipart:sje}};function Gjt(t){return t!=null&&t.type?t.type==="algorithmic"?ace.fromJSON(t):t.type==="multipart"?sje.fromJSON(t):null:null}var Pte;const Cx=new Qi({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),ak=new Qi({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),Rwe=new Qi({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),Iwe=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],Hjt=["high-to-low","above-and-below","above","below"],qjt=["flow-line","wave-front"],Wjt=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let Rn=Pte=class extends Se{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?Gjt(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){var t;return new Pte({classificationMethod:this.classificationMethod,colorRamp:re(this.colorRamp),fadeRatio:re(this.fadeRatio),fields:(t=this.fields)==null?void 0:t.slice(0),field1:re(this.field1),field2:re(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(e=>e.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};h([p({type:Cx.apiValues,value:null,json:{type:Cx.jsonValues,read:Cx.read,write:Cx.write,origins:{"web-document":{default:"manual",type:Cx.jsonValues,read:Cx.read,write:Cx.write}}}})],Rn.prototype,"classificationMethod",null),h([p({types:jjt,json:{write:!0}})],Rn.prototype,"colorRamp",void 0),h([ze("colorRamp")],Rn.prototype,"readColorRamp",null),h([p({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Rn.prototype,"fadeRatio",void 0),h([p({type:[String],value:null,json:{write:!0}})],Rn.prototype,"fields",null),h([p({type:j1,value:null,json:{write:!0}})],Rn.prototype,"field1",null),h([p({type:j1,value:null,json:{write:!0}})],Rn.prototype,"field2",null),h([p({type:qjt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Rn.prototype,"flowTheme",null),h([p({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],Rn.prototype,"focus",null),h([p({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],Rn.prototype,"isAutoGenerated",void 0),h([p({type:Number,value:null,json:{type:Ji,write:!0}})],Rn.prototype,"numClasses",null),h([p({type:Iwe,json:{type:Iwe,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],Rn.prototype,"lengthUnit",void 0),h([p({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Rn.prototype,"maxSliderValue",void 0),h([p({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Rn.prototype,"minSliderValue",void 0),h([p({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Rn.prototype,"statistics",null),h([p({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],Rn.prototype,"standardDeviationInterval",null),h([p({type:ak.apiValues,value:null,json:{type:ak.jsonValues,read:ak.read,write:ak.write,origins:{"web-scene":{type:Rwe.jsonValues,write:{writer:Rwe.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],Rn.prototype,"type",null),h([p({type:[Bjt],json:{write:!0}})],Rn.prototype,"visualVariables",void 0),h([p({type:Wjt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Rn.prototype,"univariateSymbolStyle",null),h([p({type:Hjt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Rn.prototype,"univariateTheme",null),Rn=Pte=h([I("esri.renderers.support.AuthoringInfo")],Rn);const lce=Rn,PW=new Qi({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let s3=class extends Se{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const i=new Set;return await this.collectRequiredFields(i,e),Array.from(i).sort()}getSymbol(e,i){}async getSymbolAsync(e,i){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};h([p({type:lce,json:{write:!0}})],s3.prototype,"authoringInfo",void 0),h([p({type:PW.apiValues,readOnly:!0,json:{type:PW.jsonValues,read:!1,write:{writer:PW.write,ignoreOrigin:!0}}})],s3.prototype,"type",void 0),s3=h([I("esri.renderers.Renderer")],s3);const tv=s3;function Zjt(t){var e,i;return((i=(e=t.match(Yjt))==null?void 0:e[1])==null?void 0:i.replace(/\\'/g,"'"))??null}const Yjt=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var Ote;let YA=Ote=class extends Se{constructor(){super(...arguments),this.title=null}clone(){return new Ote({title:this.title})}};h([p({type:String,json:{write:!0}})],YA.prototype,"title",void 0),YA=Ote=h([I("esri.renderers.support.LegendOptions")],YA);var $te;let kV=$te=class extends YA{constructor(){super(...arguments),this.showLegend=null}clone(){return new $te({title:this.title,showLegend:this.showLegend})}};h([p({type:Boolean,json:{write:!0}})],kV.prototype,"showLegend",void 0),kV=$te=h([I("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],kV);const nje=kV,OW=new Qi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let hf=class extends Se{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(ne.getLogger(this).error(".field: field must be a string value"),null):zD(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};h([p()],hf.prototype,"index",void 0),h([p({type:OW.apiValues,readOnly:!0,json:{read:OW.read,write:OW.write}})],hf.prototype,"type",void 0),h([p({type:String,json:{write:!0}})],hf.prototype,"field",void 0),h([Qt("field")],hf.prototype,"castField",null),h([p({type:String,json:{write:!0}})],hf.prototype,"valueExpression",void 0),h([p({type:String,json:{write:!0}})],hf.prototype,"valueExpressionTitle",void 0),h([p({readOnly:!0})],hf.prototype,"arcadeRequired",null),h([p({type:nje,json:{write:!0}})],hf.prototype,"legendOptions",void 0),hf=h([I("esri.renderers.visualVariables.VisualVariable")],hf);const GN=hf;var Rte;let CT=Rte=class extends GN{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){var t;return new Rte({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:(t=this.legendOptions)==null?void 0:t.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};h([p({readOnly:!0})],CT.prototype,"cache",null),h([p({type:["color"],json:{type:["colorInfo"]}})],CT.prototype,"type",void 0),h([p({type:String,json:{write:!0}})],CT.prototype,"normalizationField",void 0),h([p({type:[MBt],json:{write:!0}})],CT.prototype,"stops",null),CT=Rte=h([I("esri.renderers.visualVariables.ColorVariable")],CT);const oje=CT;var Ite;let T1=Ite=class extends Se{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return pP(e.transparency)}writeOpacity(t,e,i){e[i]=ZD(t)}clone(){return new Ite({label:this.label,opacity:this.opacity,value:this.value})}};h([p({type:String,json:{write:!0}})],T1.prototype,"label",void 0),h([p({type:Number,json:{type:Ji,write:{target:"transparency"}}})],T1.prototype,"opacity",void 0),h([ze("opacity",["transparency"])],T1.prototype,"readOpacity",null),h([Ze("opacity")],T1.prototype,"writeOpacity",null),h([p({type:Number,json:{write:!0}})],T1.prototype,"value",void 0),T1=Ite=h([I("esri.renderers.visualVariables.support.OpacityStop")],T1);const Xjt=T1;var Lte;let MT=Lte=class extends GN{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value),this._set("stops",t)}clone(){var t;return new Lte({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:(t=this.legendOptions)==null?void 0:t.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};h([p({readOnly:!0})],MT.prototype,"cache",null),h([p({type:["opacity"],json:{type:["transparencyInfo"]}})],MT.prototype,"type",void 0),h([p({type:String,json:{write:!0}})],MT.prototype,"normalizationField",void 0),h([p({type:[Xjt],json:{write:!0}})],MT.prototype,"stops",null),MT=Lte=h([I("esri.renderers.visualVariables.OpacityVariable")],MT);const aje=MT;var Dte;let I0=Dte=class extends GN{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(t,e,i,r){if(r!=null&&r.messages){const s=`visualVariables[${this.index}]`;r.messages.push(new B("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:r}))}}clone(){var t;return new Dte({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:(t=this.legendOptions)==null?void 0:t.clone()})}};h([p({readOnly:!0})],I0.prototype,"cache",null),h([p({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],I0.prototype,"axis",void 0),h([p({type:["rotation"],json:{type:["rotationInfo"]}})],I0.prototype,"type",void 0),h([p({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],I0.prototype,"rotationType",void 0),h([p({type:String,json:{write:!0}})],I0.prototype,"valueExpressionTitle",void 0),h([Ze("web-scene","valueExpressionTitle")],I0.prototype,"writeValueExpressionTitleWebScene",null),I0=Dte=h([I("esri.renderers.visualVariables.RotationVariable")],I0);const lje=I0;function Jjt(t){return wr(t)}var Nte;let S1=Nte=class extends Se{constructor(t){super(t),this.label=null,this.size=null,this.value=null,this.useMinValue=null,this.useMaxValue=null}clone(){return new Nte({label:this.label,size:this.size,value:this.value,useMaxValue:this.useMaxValue,useMinValue:this.useMinValue})}};h([p({type:String,json:{write:!0}})],S1.prototype,"label",void 0),h([p({type:Number,cast:wr,json:{write:!0}})],S1.prototype,"size",void 0),h([p({type:Number,json:{write:!0}})],S1.prototype,"value",void 0),h([p({type:Boolean,json:{write:!1}})],S1.prototype,"useMinValue",void 0),h([p({type:Boolean,json:{write:!1}})],S1.prototype,"useMaxValue",void 0),S1=Nte=h([I("esri.renderers.visualVariables.support.SizeStop")],S1);const UV=S1;var Fte;let VV=Fte=class extends nje{constructor(){super(...arguments),this.customValues=null}clone(){var t;return new Fte({title:this.title,showLegend:this.showLegend,customValues:(t=this.customValues)==null?void 0:t.slice(0)})}};h([p({type:[Number],json:{write:!0}})],VV.prototype,"customValues",void 0),VV=Fte=h([I("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],VV);const Qjt=VV;var kte;const lk=new Qi({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),Ute=new Qi({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function Lwe(t){if(t!=null)return typeof t=="string"||typeof t=="number"?Jjt(t):t.type==="size"?ZM(t)?t:(delete(t={...t}).type,new Wr(t)):void 0}function Dwe(t,e,i){if(typeof t!="object")return t;const r=new Wr;return r.read(t,i),r}let Wr=kte=class extends GN{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&uFe.test(this.valueExpression)}}set index(t){ZM(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),ZM(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return lFe(this)}set maxDataValue(t){t&&this.stops&&(ne.getLogger(this).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(ne.getLogger(this).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return Lwe(t)}readMaxSize(t,e,i){return Dwe(t,e,i)}set minDataValue(t){t&&this.stops&&(ne.getLogger(this).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(ne.getLogger(this).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return Lwe(t)}readMinSize(t,e,i){return Dwe(t,e,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,i)=>e.value-i.value):t&&(ne.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return Fbt(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,i,r){if(t==="$view.scale"){if(r!=null&&r.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;r.messages.push(new B("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:r}))}}else e[i]=t}readValueUnit(t){return t?Ute.read(t):null}clone(){var t,e;return new kte({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:ZM(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:ZM(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:(t=this.stops)==null?void 0:t.map(i=>i.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:(e=this.legendOptions)==null?void 0:e.clone()})}flipSizes(){if(this.transformationType===oa.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===oa.Stops){const t=this.stops;if(!t)return this;const e=t.map(r=>r.size).reverse(),i=t.length;for(let r=0;r<i;r++)t[r].size=e[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){var t;return(t=this.stops)==null?void 0:t.map(e=>e.value||0)}};h([p({readOnly:!0})],Wr.prototype,"cache",null),h([p({type:lk.apiValues,json:{type:lk.jsonValues,origins:{"web-map":{read:!1}},read:lk.read,write:lk.write}})],Wr.prototype,"axis",void 0),h([p()],Wr.prototype,"index",null),h([p({type:String,readOnly:!0})],Wr.prototype,"inputValueType",null),h([p({type:Qjt,json:{write:!0}})],Wr.prototype,"legendOptions",void 0),h([p({type:Number,value:null,json:{write:!0}})],Wr.prototype,"maxDataValue",null),h([p({type:Number,value:null,json:{write:!0}})],Wr.prototype,"maxSize",null),h([Qt("maxSize")],Wr.prototype,"castMaxSize",null),h([ze("maxSize")],Wr.prototype,"readMaxSize",null),h([p({type:Number,value:null,json:{write:!0}})],Wr.prototype,"minDataValue",null),h([p({type:Number,value:null,json:{write:!0}})],Wr.prototype,"minSize",null),h([Qt("minSize")],Wr.prototype,"castMinSize",null),h([ze("minSize")],Wr.prototype,"readMinSize",null),h([p({type:String,json:{write:!0}})],Wr.prototype,"normalizationField",void 0),h([p({readOnly:!0})],Wr.prototype,"arcadeRequired",null),h([p({type:String})],Wr.prototype,"scaleBy",void 0),h([p({type:[UV],value:null,json:{write:!0}})],Wr.prototype,"stops",null),h([p({type:["outline"],json:{write:!0}})],Wr.prototype,"target",void 0),h([p({type:String,readOnly:!0})],Wr.prototype,"transformationType",null),h([p({type:["size"],json:{type:["sizeInfo"]}})],Wr.prototype,"type",void 0),h([p({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],Wr.prototype,"useSymbolValue",void 0),h([p({type:String,json:{write:!0}})],Wr.prototype,"valueExpression",void 0),h([ze("valueExpression",["valueExpression","expression"])],Wr.prototype,"readValueExpression",null),h([Ze("web-scene","valueExpression")],Wr.prototype,"writeValueExpressionWebScene",null),h([p({type:["radius","diameter","area","width","distance"],json:{write:!0}})],Wr.prototype,"valueRepresentation",void 0),h([p({type:Ute.apiValues,json:{write:Ute.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],Wr.prototype,"valueUnit",void 0),h([ze("valueUnit")],Wr.prototype,"readValueUnit",null),Wr=kte=h([I("esri.renderers.visualVariables.SizeVariable")],Wr);const cce=Wr,Kjt={color:oje,size:cce,opacity:aje,rotation:lje},eGt=new Qi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),tGt=/^\[([^\]]+)\]$/i;let zV=class extends Ue{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),e=e&&e.filter(i=>!!i),e==null?void 0:e.length){for(const i of e)switch(i.type){case"color":this.colorVariables.push(i);break;case"opacity":this.opacityVariables.push(i);break;case"rotation":this.rotationVariables.push(i);break;case"size":this.sizeVariables.push(i)}this.sizeVariables.length&&this.sizeVariables.some(i=>!!i.target)&&e.sort((i,r)=>{let s=null;return s=i.target===r.target?0:i.target?1:-1,s});for(let i=0;i<e.length;i++)e[i].index=i;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,i,r){const{rotationExpression:s,rotationType:n}=i,o=s==null?void 0:s.match(tGt),a=o==null?void 0:o[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:n,field:a})),e)return e.map(l=>{const c=eGt.read(l.type),u=Kjt[c];u||(ne.getLogger(this).warn(`Unknown variable type: ${c}`),r!=null&&r.messages&&r.messages.push(new fy("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:r})));const d=new u;return d.read(l,r),d})}writeVariables(e,i){const r=[];for(const s of e){const n=s.toJSON(i);n&&r.push(n)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};h([p()],zV.prototype,"visualVariables",null),zV=h([I("esri.renderers.visualVariables.VisualVariableFactory")],zV);const iGt=zV,rGt={base:GN,key:"type",typeMap:{opacity:aje,color:oje,rotation:lje,size:cce}},HO=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new iGt}set visualVariables(i){this._vvFactory.visualVariables=i,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(i,r,s){return this._vvFactory.readVariables(i,r,s)}writeVisualVariables(i,r,s,n){r[s]=this._vvFactory.writeVariables(i,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const i of this.visualVariables)if(i.arcadeRequired)return!0;return!1}hasVisualVariables(i,r){return i?this.getVisualVariablesForType(i,r).length>0:this.getVisualVariablesForType("size",r).length>0||this.getVisualVariablesForType("color",r).length>0||this.getVisualVariablesForType("opacity",r).length>0||this.getVisualVariablesForType("rotation",r).length>0}getVisualVariablesForType(i,r){const s=this.visualVariables;return s?s.filter(n=>n.type===i&&(typeof r=="string"?n.target===r:r!==!1||!n.target)):[]}async collectVVRequiredFields(i,r){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&Zc(i,r,n.field),n.normalizationField&&Zc(i,r,n.normalizationField),n.valueExpression&&(sGt(n.valueExpression,i,r)||await ac(i,r,n.valueExpression)))}};return h([p({types:[rGt],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),h([ze("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),h([Ze("visualVariables")],e.prototype,"writeVisualVariables",null),e=h([I("esri.renderers.mixins.VisualVariablesMixin")],e),e};function sGt(t,e,i){const r=Zjt(t);return r!=null&&(Zc(e,i,r),!0)}const G8={types:mRe,json:{write:{writer:Tj},origins:{"web-scene":{types:Qpe,write:{writer:Tj},read:{reader:gO({types:Qpe})}}}}},uce=lre({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},G8),cje={types:{base:Ml,key:"type",typeMap:{"simple-fill":VS.typeMap["simple-fill"],"picture-fill":VS.typeMap["picture-fill"],"polygon-3d":VS.typeMap["polygon-3d"]}},json:{write:{writer:Tj},origins:{"web-scene":{type:Tw,write:{writer:Tj}}}}},BV={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t==null?void 0:t.toString()}}}};var Vte;let E1=Vte=class extends Se{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){var t;return new Vte({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:((t=this.symbol)==null?void 0:t.clone())??null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};h([p({type:String,json:{write:!0}})],E1.prototype,"description",void 0),h([p({type:String,json:{write:!0}})],E1.prototype,"label",void 0),h([p({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],E1.prototype,"minValue",void 0),h([p({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],E1.prototype,"maxValue",void 0),h([p(uce)],E1.prototype,"symbol",void 0),E1=Vte=h([I("esri.renderers.support.ClassBreakInfo")],E1);const Wj=E1;var zte;const uje="log",jV="percent-of-total",GV="field",ck=new Qi({esriNormalizeByLog:uje,esriNormalizeByPercentOfTotal:jV,esriNormalizeByField:GV}),nGt=nn(Wj);let $o=zte=class extends HO(tv){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,i){if(!Array.isArray(t))return;let r=e.minValue;return t.map(s=>{const n=new Wj;return n.read(s,i),n.minValue==null&&(n.minValue=r),n.maxValue==null&&(n.maxValue=n.minValue),r=n.maxValue,n})}writeClassBreakInfos(t,e,i,r){const s=t.map(n=>n.write({},r));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),e[i]=s}castField(t){return t==null?t:typeof t=="function"?(ne.getLogger(this).error(".field: field must be a string value"),null):zD(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,i=this.normalizationTotal!=null;return e||i?(t=e&&GV||i&&jV||null,e&&i&&ne.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):t!==GV&&t!==jV||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,i){let r=null;r=typeof t=="number"?new Wj({minValue:t,maxValue:e,symbol:gRe(i)}):nGt(re(t)),this.classBreakInfos.push(r),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const s=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(s[0]===t&&s[1]===e){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(t,e){return this.valueExpression&&(e==null?void 0:e.arcade)==null&&ne.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let i=e;this.valueExpression&&(e==null?void 0:e.arcade)==null&&(i={...i,arcade:await by()});const r=this.getBreakIndex(t,i);return r!==-1?this.classBreakInfos[r]:null}getSymbol(t,e){if(this.valueExpression&&(e==null?void 0:e.arcade)==null)return void ne.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(t,e);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&(e==null?void 0:e.arcade)==null){const s=await by(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:s}}const r=this.getBreakIndex(t,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}getSymbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((r,s)=>r+s.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){var t,e;return new zte({field:this.field,backgroundFillSymbol:(t=this.backgroundFillSymbol)==null?void 0:t.clone(),defaultLabel:this.defaultLabel,defaultSymbol:(e=this.defaultSymbol)==null?void 0:e.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:re(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:re(this.visualVariables),legendOptions:re(this.legendOptions),authoringInfo:re(this.authoringInfo)})}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(t,e)),ac(t,e,this.valueExpression)];Zc(t,e,this.field),Zc(t,e,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:s,arcade:n,timeZone:o}=e??{},{valueExpression:a}=this;let l=this._compiledValueExpression.valueExpression===a?this._compiledValueExpression.compiledFunction:null;const c=n.arcadeUtils;if(!l){const d=c.createSyntaxTree(a);l=c.createFunction(d),this._compiledValueExpression.compiledFunction=l}this._compiledValueExpression.valueExpression=a;const u=c.executeFunction(l,c.createExecContext(t,c.getViewInfo({viewingMode:i,scale:r,spatialReference:s}),o));return this._getBreakIndexfromInfos(u)}_getBreakIndexForField(t){const e=this.field,i=t.attributes,r=this.normalizationType;let s=parseFloat(i[e]);if(r){const n=this.normalizationTotal,o=parseFloat(this.normalizationField?i[this.normalizationField]:void 0);if(r===uje)s=Math.log(s)*Math.LOG10E;else if(r!==jV||n==null||isNaN(n)){if(r===GV&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=t&&(e?t<=r[1]:t<r[1]))return i}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let i=1;i<e;i++)if(t[i-1].maxValue!==t[i].minValue)return!1;return!0}};h([p(cje)],$o.prototype,"backgroundFillSymbol",void 0),h([p({type:[Wj]})],$o.prototype,"classBreakInfos",void 0),h([ze("classBreakInfos")],$o.prototype,"readClassBreakInfos",null),h([Ze("classBreakInfos")],$o.prototype,"writeClassBreakInfos",null),h([p({type:String,json:{write:!0}})],$o.prototype,"defaultLabel",void 0),h([p(G8)],$o.prototype,"defaultSymbol",void 0),h([p({type:String,json:{write:!0}})],$o.prototype,"field",void 0),h([Qt("field")],$o.prototype,"castField",null),h([p({type:Boolean})],$o.prototype,"isMaxInclusive",void 0),h([p({type:YA,json:{write:!0}})],$o.prototype,"legendOptions",void 0),h([p({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],$o.prototype,"minValue",null),h([p({type:String,json:{write:!0}})],$o.prototype,"normalizationField",void 0),h([p({type:Number,cast:t=>Wd(t),json:{write:!0}})],$o.prototype,"normalizationTotal",void 0),h([p({type:ck.apiValues,value:null,json:{type:ck.jsonValues,read:ck.read,write:ck.write}})],$o.prototype,"normalizationType",null),h([$t({classBreaks:"class-breaks"})],$o.prototype,"type",void 0),h([p({type:String,json:{write:!0}})],$o.prototype,"valueExpression",void 0),h([p({type:String,json:{write:!0}})],$o.prototype,"valueExpressionTitle",void 0),$o=zte=h([I("esri.renderers.ClassBreaksRenderer")],$o);const hje=$o;let H8=class{};function oGt(t){return t instanceof cO?t===H8.instance:(t==null?void 0:t.toString().toLowerCase())==="unknown"}function Gfi(t){return oGt(t)?H8.instance:t}H8.instance=new Xh("Etc/UTC");function aGt(t){return"timeZone"in t}function lGt(t){return"timeZone"in t}function cGt(t){return"dateFieldsTimeZone"in t}const uGt=new Map;let dje=class HV{static fromJSON(e){return new HV(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new HV(e.fields??[],Fwe(e))}static fromLayerJSON(e){return new HV(e.fields??[],Fwe(e))}constructor(e=[],i){var s;this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=i?new Map(i):null;const r=[];for(const n of this.fields){const o=n==null?void 0:n.name,a=Nwe(o);if(o&&a){const l=KT(o);this._fieldsMap.set(o,n),this._fieldsMap.set(l,n),this._normalizedFieldsMap.set(a,n),r.push(`${l}:${n.type}:${(s=this._timeZoneByFieldName)==null?void 0:s.get(o)}`),mne(n)?(this.dateFields.push(n),this._dateFieldsSet.add(n)):m6(n)&&(this._numericFieldsSet.add(n),this.numericFields.push(n)),Hpe(n)||qpe(n)||(n.editable=n.editable==null||!!n.editable,n.nullable=n.nullable==null||!!n.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)Hpe(e)||qpe(e)||e.nullable||wat(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===(e==null?void 0:e.uid)}has(e){return this.get(e)!=null}get(e){if(!e)return;let i=this._fieldsMap.get(e);return i||(i=this._fieldsMap.get(KT(e))??this._normalizedFieldsMap.get(Nwe(e)),i&&this._fieldsMap.set(e,i),i)}getTimeZone(e){const i=this.get(e&&typeof e!="string"?e.name:e);return i?this._timeZoneByFieldName?this._timeZoneByFieldName.get(i.name):i.type==="date"||i.type==="esriFieldTypeDate"?(ne.getLogger("esri.layers.support.FieldsIndex").error(new B("getTimeZone:no-timezone-information",`no time zone information for field '${i.name}'`)),dy):pje.has(i.type)?QS:null:null}getLuxonTimeZone(e){const i=this.getTimeZone(e);return i?i===QS?H8.instance:i===dy?yl.utcInstance:VD(uGt,i,()=>Xh.create(i)):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return gne(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){var i;return((i=this.get(e))==null?void 0:i.name)??void 0}toJSON(){return{fields:this.fields.map(e=>Pz(e)?e.toJSON():e),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}};function KT(t){return t.trim().toLowerCase()}function Nwe(t){var e;return((e=nat(t))==null?void 0:e.toLowerCase())??""}const pje=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function Fwe(t){const e=new Map;if(!t.fields)return e;const i=t.datesInUnknownTimezone===!0,{timeInfo:r,editFieldsInfo:s}=t,n=(r?"startField"in r?r.startField:r.startTimeField:"")??"",o=(r?"endField"in r?r.endField:r.endTimeField:"")??"",a=cGt(t)?t.dateFieldsTimeZone??null:t.dateFieldsTimeReference?Ok(t.dateFieldsTimeReference):null,l=s?aGt(s)?s.timeZone??a:s.dateFieldsTimeReference?Ok(s.dateFieldsTimeReference):a??dy:null,c=r?lGt(r)?r.timeZone??a:r.timeReference?Ok(r.timeReference):a:null,u=new Map([[KT((s==null?void 0:s.creationDateField)??""),l],[KT((s==null?void 0:s.editDateField)??""),l],[KT(n),c],[KT(o),c]]);for(const{name:d,type:f}of t.fields)if(pje.has(f))e.set(d,QS);else if(f!=="date"&&f!=="esriFieldTypeDate")e.set(d,null);else if(i)e.set(d,QS);else{const m=u.get(KT(d??""))??a;e.set(d,m)}return e}const kwe="esri.renderers.support.DictionaryLoader",hGt={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let fje=class{constructor(e,i,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new _5e(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=e,this.config=i,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,i){var d;let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(i));try{r=await this._dictionaryPromise}catch(f){if(us(f))return this._dictionaryPromise=null,null}const s=(d=this._dictionaryVersion)==null?void 0:d.since(4,0),n={};if(this.fieldMap)for(const f of this._symbolFields){const m=I4e(this.fieldMap[f],this._fieldIndex);if(m){const g=e.attributes[m];n[f]=s?g:g!=null?""+e.attributes[m]:""}else n[f]=""}let o=null;try{o=r==null?void 0:r(n,i)}catch{return null}if(!o||typeof o!="string"||o==="invalid")return null;const a=o.split(";"),l=[],c=[];for(const f of a)if(f)if(f.includes("po:")){const m=f.substr(3).split("|");if(m.length===3){const g=m[0],y=m[1];let v=m[2];if(y==="DashTemplate")v=v.split(" ").map(b=>Number(b));else if(y==="Color"){const b=new je(v).toRgba();v=[b[0],b[1],b[2],255*b[3]]}else v=Number(v);c.push({primitiveName:g,propertyName:y,value:v,defaultValue:null})}}else if(f.includes("|")){for(const m of f.split("|"))if(this._itemNames.has(m)){l.push(m);break}}else this._itemNames.has(f)&&l.push(f);const u=e.geometry==null||!e.geometry.hasZ&&e.geometry.type==="point";return this._cimPartsToCIMSymbol(e,l,c,u,i)}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void ne.getLogger(kwe).error("no valid URL!");const i=fr(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:e!=null?e.signal:null}),[{data:r}]=await Promise.all([i,by()]);if(!r)throw this._dictionaryPromise=null,new B("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:s,dictionary_version:n,expression:o,itemsNames:a}=r,l=o;let c=!1;n&&(this._dictionaryVersion=SO.parse(n),c=this._dictionaryVersion.since(4,0)),this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(a),this._symbolFields=s.symbol;const u={};if(this.config){const m=this.config;for(const g in m)u[g]=m[g]}if(s.configuration)for(const m of s.configuration)u.hasOwnProperty(m.name)||(u[m.name]=m.value);const d=[];if(e!=null&&e.fields&&this.fieldMap)for(const m in this.fieldMap){const g=this.fieldMap[m],y=e.fields.filter(v=>v.name.toLowerCase()===(g==null?void 0:g.toLowerCase()));y.length>0&&d.push({...y[0],type:c?y[0].type:"esriFieldTypeString"})}d.length>0&&(this._fieldIndex=new dje(d));const f=iat(l,e!=null?e.spatialReference:null,d,u).then(m=>{const g={scale:0};return(y,v)=>{if(m==null)return null;const b=m.repurposeFeature({geometry:null,attributes:y});return g.scale=v!=null?v.scale??void 0:void 0,m.evaluate({$feature:b,$view:g},m.services)}}).catch(m=>(ne.getLogger(kwe).error("Creating dictionary expression failed:",m),null));return this._dictionaryPromise=f,f}async _cimPartsToCIMSymbol(e,i,r,s,n){const o=new Array(i.length);for(let c=0;c<i.length;c++)o[c]=this._getSymbolPart(i[c],n);let a=await Promise.all(o);const l=this.fieldMap;if(l){a=re(a);for(const c of a)KM.applyDictionaryTextOverrides(c,e,l,this._fieldIndex,ree(c))}return new G_({data:dGt(a,r,s)})}async _getSymbolPart(e,i){const r=this._symbolCache.get(e);if(r)return r;if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(o=>o.data);const s=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,e),n=fr(s,{responseType:"json",query:{f:"json"},...i});this._ongoingRequests.set(e,n),n.finally(()=>this._ongoingRequests.delete(e));try{const o=await n;return this._symbolCache.put(e,o.data),o.data}catch(o){throw o}}};function dGt(t,e,i){if(!t||t.length===0)return null;const r={...t[0]};if(t.length>1){r.symbolLayers=[];for(const s of t){const n=s;r.symbolLayers.unshift(...n.symbolLayers)}}return i&&(r.callout=hGt),{type:"CIMSymbolReference",symbol:r,primitiveOverrides:e}}var Bte;let df=Bte=class extends HO(tv){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new fje(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,i,r){r!=null&&r.origin||super.writeVisualVariables(t,e,i,r)}clone(){return new Bte({config:re(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:re(this.fieldMap),url:re(this.url),visualVariables:re(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await ac(t,e,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];e.has(r)&&t.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};h([p({type:fje})],df.prototype,"_loader",null),h([p({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],df.prototype,"config",void 0),h([p({type:Object,json:{write:!0}})],df.prototype,"fieldMap",void 0),h([p({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],df.prototype,"scaleExpression",void 0),h([Ze("scaleExpression")],df.prototype,"writeData",null),h([p({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],df.prototype,"scaleExpressionTitle",void 0),h([p({type:String,json:{write:!0}})],df.prototype,"url",void 0),h([Ze("visualVariables")],df.prototype,"writeVisualVariables",null),df=Bte=h([I("esri.renderers.DictionaryRenderer")],df);const pGt=df;var jte;let L0=jte=class extends Se{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(ne.getLogger(this).error(".field: field must be a string value"),null):zD(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){var t;return new jte({color:(t=this.color)==null?void 0:t.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};h([p({type:je,json:{type:[Number],write:!0}})],L0.prototype,"color",void 0),h([p({type:String,json:{write:!0}})],L0.prototype,"field",void 0),h([Qt("field")],L0.prototype,"castField",null),h([p({type:String,json:{write:!0}})],L0.prototype,"label",void 0),h([p({type:String,json:{write:!0}})],L0.prototype,"valueExpression",void 0),h([p({type:String,json:{write:!0}})],L0.prototype,"valueExpressionTitle",void 0),L0=jte=h([I("esri.renderers.support.AttributeColorInfo")],L0);const mje=L0;var Gte;let qV=Gte=class extends Se{constructor(){super(...arguments),this.unit=null}clone(){return new Gte({unit:this.unit})}};h([p({type:String,json:{write:!0}})],qV.prototype,"unit",void 0),qV=Gte=h([I("esri.renderers.support.DotDensityLegendOptions")],qV);const fGt=qV;var Hte;let fu=Hte=class extends HO(tv){constructor(t){super(t),this.attributes=null,this.backgroundColor=new je([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new Yu,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new H_({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){var t;return((t=this.attributes)==null?void 0:t.reduce((e,i)=>e+i.getAttributeHash(),""))??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new Hte({attributes:re(this.attributes),backgroundColor:re(this.backgroundColor),dotBlendingEnabled:re(this.dotBlendingEnabled),dotShape:re(this.dotShape),dotSize:re(this.dotSize),dotValue:re(this.dotValue),legendOptions:re(this.legendOptions),outline:re(this.outline),referenceScale:re(this.referenceScale),seed:re(this.seed),visualVariables:re(this.visualVariables),authoringInfo:re(this.authoringInfo)})}getControllerHash(){var e;return`${(e=this.attributes)==null?void 0:e.map(i=>i.field||i.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const i of this.attributes??[])i.valueExpression&&await ac(t,e,i.valueExpression),i.field&&t.add(i.field)}};h([p({type:[mje],json:{write:!0}})],fu.prototype,"attributes",void 0),h([p({type:je,json:{write:!0}})],fu.prototype,"backgroundColor",void 0),h([p({type:Boolean,json:{write:!0}})],fu.prototype,"dotBlendingEnabled",void 0),h([p({type:String,json:{write:!1}})],fu.prototype,"dotShape",void 0),h([p({type:Number,json:{write:!0}})],fu.prototype,"dotSize",void 0),h([p({type:fGt,json:{write:!0}})],fu.prototype,"legendOptions",void 0),h([p({type:Yu,json:{default:null,write:!0}})],fu.prototype,"outline",void 0),h([p({type:Number,json:{write:!0}})],fu.prototype,"dotValue",void 0),h([p({type:Number,json:{write:!0}})],fu.prototype,"referenceScale",void 0),h([p({type:Number,json:{write:!0}})],fu.prototype,"seed",void 0),h([$t({dotDensity:"dot-density"})],fu.prototype,"type",void 0),fu=Hte=h([I("esri.renderers.DotDensityRenderer")],fu);const mGt=fu;let _M=class extends ts(Se){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};h([p({type:String,json:{write:!0}})],_M.prototype,"minLabel",void 0),h([p({type:String,json:{write:!0}})],_M.prototype,"maxLabel",void 0),h([p({type:String,json:{write:!0}})],_M.prototype,"title",void 0),_M=h([I("esri.renderers.support.HeatmapLegendOptions")],_M);const hce=2.4;function gGt(t){return bo(t*hce)}function yGt(t){return mr(t)/hce}function _Gt(t,e,i,r){let{color:s,ratio:n}=e,{color:o,ratio:a}=i;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=Ne((r-n)/(a-n),0,1);XG(t,s.toArray(),o.toArray(),l)}function Wfi(t){const i=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),t.length<1)return i;let r=t[0],s=t[0],n=1;const o=ci();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<t.length;)r=s,s=t[n++];_Gt(o,r,s,l),i.set(o,4*a)}return i}function Zfi(t,e,i){const r=Math.sqrt(t**2+e**2)/i;return r>1?0:3/(Math.PI*i**2)*(1-r**2)**2}function Yfi(t){return typeof t=="function"?t:t?e=>+e[t]:()=>1}var qte;function Uwe(t){if(t!=null){const{maxDensity:e,minDensity:i,radius:r}=t;if(e!=null||i!=null||r!=null){const{blurRadius:s,maxPixelIntensity:n,minPixelIntensity:o,...a}=t;return a}}return t}let Pa=qte=class extends tv{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new hL({ratio:0,color:new je("rgba(255, 140, 0, 0)")}),new hL({ratio:.75,color:new je("rgba(255, 140, 0, 1)")}),new hL({ratio:.9,color:new je("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(t){return Uwe(t)}get blurRadius(){return yGt(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",gGt(t)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(hce**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(t,e){this._warnedProps[t]||bl(this).getDefaultOrigin()==="user"&&(this._warnedProps[t]=!0,k2(()=>{s_(ne.getLogger(this),t,{replacement:`${String(e)} (suggested value: ${this._get(e)})`,version:"4.24"})}))}read(t,e){t=Uwe(t),super.read(t,e)}getSymbol(){return new Oy}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const i=this.field,r=this.valueExpression;i&&typeof i=="string"&&Zc(t,e,i),r&&typeof r=="string"&&await ac(t,e,r)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new qte({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:re(this.colorStops),field:this.field,legendOptions:re(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};h([p({type:lce,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Pa.prototype,"authoringInfo",void 0),h([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Pa.prototype,"blurRadius",null),h([p({type:[hL],json:{write:!0}})],Pa.prototype,"colorStops",void 0),h([p({type:String,json:{write:!0}})],Pa.prototype,"field",void 0),h([p({type:_M,json:{write:!0}})],Pa.prototype,"legendOptions",void 0),h([p({type:Number,json:{write:!0}})],Pa.prototype,"maxDensity",void 0),h([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Pa.prototype,"maxPixelIntensity",null),h([p({type:Number,json:{write:!0}})],Pa.prototype,"minDensity",void 0),h([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Pa.prototype,"minPixelIntensity",null),h([p({type:Number,cast:wr,json:{write:!0}})],Pa.prototype,"radius",void 0),h([p({type:Number,range:{min:0},json:{default:0,write:!0}})],Pa.prototype,"referenceScale",void 0),h([$t({heatmap:"heatmap"})],Pa.prototype,"type",void 0),h([p({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],Pa.prototype,"valueExpression",void 0),h([p({type:String})],Pa.prototype,"valueExpressionTitle",void 0),h([p({readOnly:!0})],Pa.prototype,"_pixelIntensityToDensity",null),Pa=qte=h([I("esri.renderers.HeatmapRenderer")],Pa);const gje=Pa;let eS=class extends ts(Se){constructor(){super(...arguments),this.color=new je([0,0,0,0]),this.label=null,this.threshold=0}};h([p({type:je,json:{write:!0}})],eS.prototype,"color",void 0),h([p({type:String,json:{write:!0}})],eS.prototype,"label",void 0),h([p({type:Number,range:{min:0,max:1},json:{write:!0}})],eS.prototype,"threshold",void 0),eS=h([I("esri.renderers.support.OthersCategory")],eS);let WV=class extends ts(Se){constructor(){super(...arguments),this.title=null}};h([p({type:String,json:{write:!0}})],WV.prototype,"title",void 0),WV=h([I("esri.renderers.support.PieChartLegendOptions")],WV);let gh=class extends HO(ts(tv)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new je([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new eS,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new Oy({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(sd)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,i)=>e+i.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,i)=>e+JSON.stringify(i),"")}async collectRequiredFields(e,i){await this.collectVVRequiredFields(e,i);for(const r of this.attributes)r.valueExpression&&await ac(e,i,r.valueExpression),r.field&&e.add(r.field)}};h([p({type:[mje],json:{write:!0}})],gh.prototype,"attributes",void 0),h([p({type:H_,json:{default:null,write:!0}})],gh.prototype,"backgroundFillSymbol",void 0),h([p({type:je,json:{write:!0}})],gh.prototype,"defaultColor",void 0),h([p({type:String,json:{write:!0}})],gh.prototype,"defaultLabel",void 0),h([p({type:Number,range:{min:0,max:1},json:{write:!0}})],gh.prototype,"holePercentage",void 0),h([p({type:eS,json:{write:!0}})],gh.prototype,"othersCategory",void 0),h([p({type:WV,json:{write:!0}})],gh.prototype,"legendOptions",void 0),h([p({type:Yu,json:{default:null,write:!0}})],gh.prototype,"outline",void 0),h([p({type:Number,cast:wr,json:{write:!0}})],gh.prototype,"size",void 0),h([$t({pieChart:"pie-chart"})],gh.prototype,"type",void 0),gh=h([I("esri.renderers.PieChartRenderer")],gh);const vGt=gh;var Wte;let AT=Wte=class extends HO(tv){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(i=>i.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new Wte({description:this.description,label:this.label,symbol:re(this.symbol),visualVariables:re(this.visualVariables),authoringInfo:re(this.authoringInfo)})}};h([p({type:String,json:{write:!0}})],AT.prototype,"description",void 0),h([p({type:String,json:{write:!0}})],AT.prototype,"label",void 0),h([p(uce)],AT.prototype,"symbol",void 0),h([$t({simple:"simple"})],AT.prototype,"type",void 0),AT=Wte=h([I("esri.renderers.SimpleRenderer")],AT);const qO=AT,bGt=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function Zte(t){return t instanceof Ue}function Vwe(t){return t instanceof Ke?Object.keys(t.items):Zte(t)?bl(t).keys():t?Object.keys(t):[]}function uk(t,e){return t instanceof Ke?t.items[e]:t[e]}function wGt(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function pL(t){return t?t.declaredClass:null}function yje(t,e){var d;const i=t.diff;if(i&&typeof i=="function")return i(t,e);const r=Vwe(t),s=Vwe(e);if(r.length===0&&s.length===0)return;if(!r.length||!s.length||wGt(t,e))return{type:"complete",oldValue:t,newValue:e};const n=s.filter(f=>!r.includes(f)),o=r.filter(f=>!s.includes(f)),a=r.filter(f=>s.includes(f)&&uk(t,f)!==uk(e,f)).concat(n,o).sort(),l=pL(t);if(l&&bGt.has(l)&&a.length)return{type:"complete",oldValue:t,newValue:e};let c;const u=Zte(t)&&Zte(e);for(const f of a){const m=uk(t,f),g=uk(e,f);let y;if((u||typeof m!="function"&&typeof g!="function")&&m!==g&&(m!=null||g!=null)){if(i&&i[f]&&typeof i[f]=="function")y=(d=i[f])==null?void 0:d.call(i,m,g);else if(m instanceof Date&&g instanceof Date){if(m.getTime()===g.getTime())continue;y={type:"complete",oldValue:m,newValue:g}}else y=typeof m=="object"&&typeof g=="object"&&pL(m)===pL(g)?yje(m,g):{type:"complete",oldValue:m,newValue:g};y!=null&&(c!=null?c.diff[f]=y:c={type:"partial",diff:{[f]:y}})}}return c}function Kfi(t,e){return xGt(t,e)}function xGt(t,e){if(t==null)return!1;const i=e.split(".");let r=t;for(const s of i){if(r.type==="complete")return!0;if(r.type!=="partial")return!1;{const n=r.diff[s];if(!n)return!1;r=n}}return!0}function emi(t,e){if(!t)return!1;if(t.type==="partial"){const i=Object.keys(t.diff);return i.length===1&&i[0]===e}return!1}function TGt(t,e){if(typeof t!="function"&&typeof e!="function"&&(t!=null||e!=null))return t==null||e==null||typeof t=="object"&&typeof e=="object"&&pL(t)!==pL(e)?{type:"complete",oldValue:t,newValue:e}:yje(t,e)}function hk(t){if(t==null)return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const i of e.added)if(!hk(i))return!1;for(const i of e.removed)if(!hk(i))return!1;for(const i of e.changed)if(!hk(i))return!1;return!0}case"partial":for(const e in t.diff)if(!hk(t.diff[e]))return!1;return!0}}let vM=class extends ts(Se){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};h([p(BV)],vM.prototype,"value",void 0),h([p(BV)],vM.prototype,"value2",void 0),h([p(BV)],vM.prototype,"value3",void 0),vM=h([I("esri.renderers.support.UniqueValue")],vM);const XA=vM;let C1=class extends ts(Se){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const i=typeof(e=Array.isArray(e)?e:[e])[0];return i==="string"||i==="number"?e.map(r=>new XA({value:r})):i==="object"?e[0]instanceof XA?e:e.map(r=>new XA(r)):null}};h([p({type:String,json:{write:!0}})],C1.prototype,"description",void 0),h([p({type:String,json:{write:!0}})],C1.prototype,"label",void 0),h([p(G8)],C1.prototype,"symbol",void 0),h([p({type:[XA],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new XA({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const i=[];for(const r of t){const s=[r.value,r.value2,r.value3].filter(sd).map(n=>n.toString());i.push(s)}e.values=i}}}})],C1.prototype,"values",void 0),h([Qt("values")],C1.prototype,"castValues",null),C1=h([I("esri.renderers.support.UniqueValueClass")],C1);const _je=C1;let n3=class extends ts(Se){constructor(e){super(e),this.heading=null,this.classes=null}};h([p({type:String,json:{write:!0}})],n3.prototype,"heading",void 0),h([p({type:[_je],json:{write:!0}})],n3.prototype,"classes",void 0),n3=h([I("esri.renderers.support.UniqueValueGroup")],n3);const Yte=n3;var Xte;let PT=Xte=class extends Se{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new Xte({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){var e;const t=JSON.stringify((e=this.symbol)==null?void 0:e.toJSON());return`${this.value}.${t}`}};h([p({type:String,json:{write:!0}})],PT.prototype,"description",void 0),h([p({type:String,json:{write:!0}})],PT.prototype,"label",void 0),h([p(uce)],PT.prototype,"symbol",void 0),h([p(BV)],PT.prototype,"value",void 0),PT=Xte=h([I("esri.renderers.support.UniqueValueInfo")],PT);const fL=PT;var o3;const vje="esri.renderers.UniqueValueRenderer",Gv=()=>ne.getLogger(vje),zwe="uvInfos-watcher",Bwe="uvGroups-watcher",SGt=",",EGt=nn(fL);function CGt(t){const{field1:e,field2:i,field3:r,fieldDelimiter:s,uniqueValueInfos:n,valueExpression:o}=t,a=!(!e||!i);return[{classes:(n??[]).map(l=>{var b;const{symbol:c,label:u,value:d,description:f}=l,[m,g,y]=a?((b=d==null?void 0:d.toString())==null?void 0:b.split(s||""))||[]:[d],v=[];return(e||o)&&v.push(m),i&&v.push(g),r&&v.push(y),{symbol:c,label:u,values:[v],description:f}})}]}let hn=o3=class extends HO(tv){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,i){if(!e&&!i)return;if(!e||!i)return{type:"complete",oldValue:e,newValue:i};let r=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<i.length;n++){const o=e.find(a=>a.value===i[n].value);o?TGt(o,i[n])?(s.changed.push({type:"complete",oldValue:o,newValue:i[n]}),r=!0):s.unchanged.push({oldValue:o,newValue:i[n]}):(s.added.push(i[n]),r=!0)}for(let n=0;n<e.length;n++)i.find(o=>o.value===e[n].value)||(s.removed.push(e[n]),r=!0);return r?s:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:zD(t)}writeField(t,e,i,r){typeof t=="string"?e[i]=t:r!=null&&r.messages?r.messages.push(new B("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):Gv().error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,i){return i.portal||Kn.getDefault()}readStyleOrigin(t,e,i){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const r=Ub(e.styleUrl,i);return Object.freeze({styleUrl:r})}}writeStyleOrigin(t,e,i,r){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=u2(t.styleUrl,r))}set uniqueValueGroups(t){this.styleOrigin?Gv().error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?Gv().error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){var r;if(this.styleOrigin)return void Gv().error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof t=="object"?EGt(t):new fL({value:t,symbol:gRe(e)}),(r=this.uniqueValueInfos)==null||r.push(i),this._valueInfoMap[i.value]=i,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void Gv().error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e)for(let i=0;i<e.length;i++){const r=e[i];if(String(r.value)===String(t)){delete this._valueInfoMap[t],e.splice(i,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let i=e;return this.valueExpression&&(e==null?void 0:e.arcade)==null&&(i={...i,arcade:await by()}),this._getUniqueValueInfo(t,i)}getSymbol(t,e){if(this.valueExpression&&(e==null?void 0:e.arcade)==null)return void Gv().error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this._getUniqueValueInfo(t,e);return(i==null?void 0:i.symbol)||this.defaultSymbol}async getSymbolAsync(t,e){let i=e;if(this.valueExpression&&(i==null?void 0:i.arcade)==null){const s=await by(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:s}}const r=this._getUniqueValueInfo(t,i);return(r==null?void 0:r.symbol)||this.defaultSymbol}getSymbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){var r;const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),i=(r=this.uniqueValueInfos)==null?void 0:r.reduce((s,n)=>s+n.getMeshHash(),"");return`${t}.${e}.${i}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new o3({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:re(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:re(this.visualVariables),legendOptions:re(this.legendOptions),authoringInfo:re(this.authoringInfo),backgroundFillSymbol:re(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=re(this.uniqueValueInfos),i=re(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(re(this.styleOrigin))),Object.freeze(e),Object.freeze(i)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",i),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const i=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(i)}async collectSymbolFields(t,e){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(t,e)),ac(t,e,this.valueExpression)];Zc(t,e,this.field),Zc(t,e,this.field2),Zc(t,e,this.field3),await Promise.all(i)}populateFromStyle(){return Qae(this.styleOrigin,{portal:this.portal}).then(t=>{var i;const e=[];return this._valueInfoMap={},t!=null&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach(r=>{const s=new tE({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:r.name});this.defaultSymbol||r.name!==t.data.defaultItem||(this.defaultSymbol=s,this._isDefaultSymbolDerived=!0);const n=new fL({value:r.name,symbol:s});e.push(n),this._valueInfoMap[r.name]=n}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&((i=this.uniqueValueInfos)!=null&&i.length)&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",SGt)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[e.value+""]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(zwe);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const i of t)e.push(te(()=>({symbol:i.symbol,value:i.value,label:i.label,description:i.description}),(r,s)=>{r!==s&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,zwe)}}_watchUniqueValueGroups(){this.removeHandles(Bwe);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const i of t){e.push(te(()=>({classes:i.classes}),(r,s)=>{r!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const r of i.classes??[])e.push(te(()=>({symbol:r.symbol,values:r.values,label:r.label,description:r.description}),(s,n)=>{s!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,Bwe)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:i,field3:r,fieldDelimiter:s,uniqueValueGroups:n,valueExpression:o}=this;if(!e&&!o)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!e||!i);for(const l of n)for(const c of l.classes??[]){const{symbol:u,label:d,values:f,description:m}=c;for(const g of f??[]){const{value:y,value2:v,value3:b}=g,w=[y];i&&w.push(v),r&&w.push(b);const x=a?w.join(s||""):w[0]??void 0;t.push(new fL({symbol:u,label:d,value:x,description:m}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:i,valueExpression:r,fieldDelimiter:s,uniqueValueInfos:n}=this;if(!e&&!r||!n.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!e||!i),a=n.map(c=>{var b;const{symbol:u,label:d,value:f,description:m}=c,[g,y,v]=o?((b=f==null?void 0:f.toString())==null?void 0:b.split(s||""))||[]:[f];return new _je({symbol:u,label:d,description:m,values:[new XA({value:g,value2:y,value3:v})]})}),l=[new Yte({classes:a})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:i,scale:r,spatialReference:s,arcade:n,timeZone:o}=e??{};let a=this._cache.compiledFunc;const l=n.arcadeUtils;if(!a){const u=l.createSyntaxTree(this.valueExpression);a=l.createFunction(u),this._cache.compiledFunc=a}const c=l.executeFunction(a,l.createExecContext(t,l.getViewInfo({viewingMode:i,scale:r,spatialReference:s}),o));return this._valueInfoMap[c+""]}_getUnqiueValueInfoForFields(t){const e=this.field,i=t.attributes;let r;if(this.field2){const s=this.field2,n=this.field3,o=[];e&&o.push(i[e]),s&&o.push(i[s]),n&&o.push(i[n]),r=o.join(this.fieldDelimiter||"")}else e&&(r=i[e]);return this._valueInfoMap[r+""]}static fromPortalStyle(t,e){const i=new o3(e==null?void 0:e.properties);i._set("styleOrigin",Object.freeze({styleName:t})),i._set("portal",(e==null?void 0:e.portal)||Kn.getDefault());const r=i.populateFromStyle();return r.catch(s=>{Gv().error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",s)}),r}static fromStyleUrl(t,e){const i=new o3(e==null?void 0:e.properties);i._set("styleOrigin",Object.freeze({styleUrl:t}));const r=i.populateFromStyle();return r.catch(s=>{Gv().error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),r}};h([p({readOnly:!0})],hn.prototype,"_cache",null),h([$t({uniqueValue:"unique-value"})],hn.prototype,"type",void 0),h([p(cje)],hn.prototype,"backgroundFillSymbol",void 0),h([p({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],hn.prototype,"field",null),h([Qt("field")],hn.prototype,"castField",null),h([Ze("field")],hn.prototype,"writeField",null),h([p({type:String,value:null,json:{write:!0}})],hn.prototype,"field2",null),h([p({type:String,value:null,json:{write:!0}})],hn.prototype,"field3",null),h([p({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],hn.prototype,"orderByClassesEnabled",void 0),h([p({type:String,value:null,json:{write:!0}})],hn.prototype,"valueExpression",null),h([p({type:String,json:{write:!0}})],hn.prototype,"valueExpressionTitle",void 0),h([p({type:YA,json:{write:!0}})],hn.prototype,"legendOptions",void 0),h([p({type:String,json:{write:!0}})],hn.prototype,"defaultLabel",void 0),h([p(lre({...G8},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],hn.prototype,"defaultSymbol",null),h([p({type:String,value:null,json:{write:!0}})],hn.prototype,"fieldDelimiter",null),h([p({type:Kn,readOnly:!0})],hn.prototype,"portal",void 0),h([ze("portal",["styleName"])],hn.prototype,"readPortal",null),h([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],hn.prototype,"styleOrigin",void 0),h([ze("styleOrigin",["styleName","styleUrl"])],hn.prototype,"readStyleOrigin",null),h([Ze("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],hn.prototype,"writeStyleOrigin",null),h([p({type:[Yte],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,i)=>(e.uniqueValueGroups||CGt(e)).map(r=>Yte.fromJSON(r,i))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],hn.prototype,"uniqueValueGroups",null),h([p({type:[fL],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],hn.prototype,"uniqueValueInfos",null),hn=o3=h([I(vje)],hn);const dce=hn,q8={key:"type",base:tv,typeMap:{heatmap:gje,simple:qO,"unique-value":dce,"class-breaks":hje,"dot-density":mGt,dictionary:pGt,"pie-chart":vGt},errorContext:"renderer"},MGt={key:"type",base:tv,typeMap:{simple:qO,"unique-value":dce,"class-breaks":hje,heatmap:gje},errorContext:"renderer",validate:AGt};function AGt(t){switch(t.type){case"simple":return PGt(t);case"unique-value":return OGt(t);case"class-breaks":return $Gt(t);case"heatmap":return t}}function PGt(t){if(t.symbol)return t;ne.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}function OGt(t){const e=t.uniqueValueInfos,i=e==null?void 0:e.filter(({symbol:r,label:s},n)=>(r||ne.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${n}] ${s}) without a symbol from web scene.`),!!r));return(i==null?void 0:i.length)!==(e==null?void 0:e.length)&&(t.uniqueValueInfos=i),t}function $Gt(t){const e=t.classBreakInfos,i=e==null?void 0:e.filter(({symbol:r,label:s},n)=>(r||ne.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${n}] ${s}) without a symbol from web scene.`),!!r));return(i==null?void 0:i.length)!==(e==null?void 0:e.length)&&(t.classBreakInfos=i),t}function smi(t,e){return AD(t,null,e)}const RGt=gO({types:q8});function AD(t,e,i){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(i!=null&&i.messages&&i.messages.push(new fy("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:i})),null):RGt(t,e,i):null}const Ba=(t=>t)(["operational-layers","basemap","ground"]);var Jte;let OT=Jte=class extends Se{constructor(t){super(t),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new Jte({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};h([p({type:String,json:{write:!0}})],OT.prototype,"expression",void 0),h([p({type:String,json:{write:!0}})],OT.prototype,"name",void 0),h([p({type:["boolean","date","number","string"],json:{write:!0}})],OT.prototype,"returnType",void 0),h([p({type:String,json:{write:!0}})],OT.prototype,"title",void 0),OT=Jte=h([I("esri.form.ExpressionInfo")],OT);const IGt=OT;let $T=class extends Se{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};h([p({type:String,json:{write:!0}})],$T.prototype,"description",void 0),h([p({type:String,json:{write:!0}})],$T.prototype,"label",void 0),h([p()],$T.prototype,"type",void 0),h([p({type:String,json:{write:!0}})],$T.prototype,"visibilityExpression",void 0),$T=h([I("esri.form.elements.Element")],$T);const R2=$T;var Qte;let ZV=Qte=class extends Se{constructor(t){super(t),this.type=null}clone(){return new Qte({type:this.type})}};h([p({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],ZV.prototype,"type",void 0),ZV=Qte=h([I("esri.form.elements.inputs.AttachmentInput")],ZV);const LGt=ZV;var Kte;let RT=Kte=class extends R2{constructor(t){super(t),this.attachmentKeyword=null,this.editableExpression=null,this.input=null,this.type="attachment"}clone(){return new Kte({attachmentKeyword:this.attachmentKeyword,description:this.description,editableExpression:this.editableExpression,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};h([p({type:String,json:{write:!0}})],RT.prototype,"attachmentKeyword",void 0),h([p({type:String,json:{write:!0}})],RT.prototype,"editableExpression",void 0),h([p({type:LGt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],RT.prototype,"input",void 0),h([p({type:["attachment"],json:{read:!1,write:!0}})],RT.prototype,"type",void 0),RT=Kte=h([I("esri.form.elements.AttachmentElement")],RT);const jwe=RT;let YV=class extends Se{constructor(e){super(e),this.type=null}};h([p()],YV.prototype,"type",void 0),YV=h([I("esri.form.elements.inputs.Input")],YV);const iv=YV;let a3=class extends iv{constructor(e){super(e),this.maxLength=null,this.minLength=0}};h([p({type:Number,json:{write:!0}})],a3.prototype,"maxLength",void 0),h([p({type:Number,json:{write:!0}})],a3.prototype,"minLength",void 0),a3=h([I("esri.form.elements.inputs.TextInput")],a3);const pce=a3;var eie;let XV=eie=class extends pce{constructor(t){super(t),this.type="barcode-scanner"}clone(){return new eie({maxLength:this.maxLength,minLength:this.minLength})}};h([p({type:["barcode-scanner"],json:{read:!1,write:!0}})],XV.prototype,"type",void 0),XV=eie=h([I("esri.form.elements.inputs.BarcodeScannerInput")],XV);const DGt=XV;var tie;let bM=tie=class extends iv{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new tie({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};h([p({type:String,json:{write:!0}})],bM.prototype,"noValueOptionLabel",void 0),h([p({type:Boolean,json:{write:!0}})],bM.prototype,"showNoValueOption",void 0),h([p({type:["combo-box"],json:{read:!1,write:!0}})],bM.prototype,"type",void 0),bM=tie=h([I("esri.form.elements.inputs.ComboBoxInput")],bM);const NGt=bM;var iie;function Gwe(t){return t??null}function Hwe(t){return t??null}let gg=iie=class extends iv{constructor(t){super(t),this.max=null,this.min=null,this.type="date-picker"}readMax(t,e){return Gwe(e.max)}writeMax(t,e){e.max=Hwe(t)}readMin(t,e){return Gwe(e.min)}writeMin(t,e){e.min=Hwe(t)}clone(){return new iie({max:this.max,min:this.min})}};h([p({type:String,json:{type:String,write:!0}})],gg.prototype,"max",void 0),h([ze("max")],gg.prototype,"readMax",null),h([Ze("max")],gg.prototype,"writeMax",null),h([p({type:String,json:{type:String,write:!0}})],gg.prototype,"min",void 0),h([ze("min")],gg.prototype,"readMin",null),h([Ze("min")],gg.prototype,"writeMin",null),h([p({type:["date-picker"],json:{read:!1,write:!0}})],gg.prototype,"type",void 0),gg=iie=h([I("esri.form.elements.inputs.DatePickerInput")],gg);const FGt=gg;var rie;function $W(t){return t??null}function RW(t){return t??null}let mu=rie=class extends iv{constructor(t){super(t),this.includeTimeOffset=!0,this.max=null,this.min=null,this.timeResolution="minutes",this.type="datetimeoffset-picker"}readMax(t,e){return $W(e.max)}writeMax(t,e){e.max=RW(t)}readMin(t,e){return $W(e.min)}writeMin(t,e){e.min=RW(t)}readTimeResolution(t,e){return $W(e.timeResolution)}writeTimeResolution(t,e){e.timeResolution=RW(t)}clone(){return new rie({includeTimeOffset:this.includeTimeOffset,max:this.max,min:this.min,timeResolution:this.timeResolution})}};h([p({type:Boolean,json:{write:!0}})],mu.prototype,"includeTimeOffset",void 0),h([p({type:String,json:{type:String,write:!0}})],mu.prototype,"max",void 0),h([ze("max")],mu.prototype,"readMax",null),h([Ze("max")],mu.prototype,"writeMax",null),h([p({type:String,json:{type:String,write:!0}})],mu.prototype,"min",void 0),h([ze("min")],mu.prototype,"readMin",null),h([Ze("min")],mu.prototype,"writeMin",null),h([p({type:String,json:{type:String,write:!0}})],mu.prototype,"timeResolution",void 0),h([ze("timeResolution")],mu.prototype,"readTimeResolution",null),h([Ze("timeResolution")],mu.prototype,"writeTimeResolution",null),h([p({type:["datetimeoffset-picker"],json:{read:!1,write:!0}})],mu.prototype,"type",void 0),mu=rie=h([I("esri.form.elements.inputs.DateTimeOffsetPickerInput")],mu);const kGt=mu;var sie;function qwe(t){return t!=null?new Date(t):null}function Wwe(t){return t?t.getTime():null}let pf=sie=class extends iv{constructor(t){super(t),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(t,e){return qwe(e.max)}writeMax(t,e){e.max=Wwe(t)}readMin(t,e){return qwe(e.min)}writeMin(t,e){e.min=Wwe(t)}clone(){return new sie({includeTime:this.includeTime,max:this.max,min:this.min})}};h([p({type:Boolean,json:{write:!0}})],pf.prototype,"includeTime",void 0),h([p({type:Date,json:{type:Number,write:!0}})],pf.prototype,"max",void 0),h([ze("max")],pf.prototype,"readMax",null),h([Ze("max")],pf.prototype,"writeMax",null),h([p({type:Date,json:{type:Number,write:!0}})],pf.prototype,"min",void 0),h([ze("min")],pf.prototype,"readMin",null),h([Ze("min")],pf.prototype,"writeMin",null),h([p({type:["datetime-picker"],json:{read:!1,write:!0}})],pf.prototype,"type",void 0),pf=sie=h([I("esri.form.elements.inputs.DateTimePickerInput")],pf);const UGt=pf;var nie;let wM=nie=class extends iv{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new nie({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};h([p({type:String,json:{write:!0}})],wM.prototype,"noValueOptionLabel",void 0),h([p({type:Boolean,json:{write:!0}})],wM.prototype,"showNoValueOption",void 0),h([p({type:["radio-buttons"],json:{read:!1,write:!0}})],wM.prototype,"type",void 0),wM=nie=h([I("esri.form.elements.inputs.RadioButtonsInput")],wM);const VGt=wM;var oie;let xM=oie=class extends iv{constructor(t){super(t),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new oie({offValue:this.offValue,onValue:this.onValue})}};h([p({type:[String,Number],json:{write:!0}})],xM.prototype,"offValue",void 0),h([p({type:[String,Number],json:{write:!0}})],xM.prototype,"onValue",void 0),h([p({type:["switch"],json:{read:!1,write:!0}})],xM.prototype,"type",void 0),xM=oie=h([I("esri.form.elements.inputs.SwitchInput")],xM);const zGt=xM;var aie;let JV=aie=class extends pce{constructor(t){super(t),this.type="text-area"}clone(){return new aie({maxLength:this.maxLength,minLength:this.minLength})}};h([p({type:["text-area"],json:{read:!1,write:!0}})],JV.prototype,"type",void 0),JV=aie=h([I("esri.form.elements.inputs.TextAreaInput")],JV);const BGt=JV;var lie;let QV=lie=class extends pce{constructor(t){super(t),this.type="text-box"}clone(){return new lie({maxLength:this.maxLength,minLength:this.minLength})}};h([p({type:["text-box"],json:{read:!1,write:!0}})],QV.prototype,"type",void 0),QV=lie=h([I("esri.form.elements.inputs.TextBoxInput")],QV);const jGt=QV;var cie;function IW(t){return t??null}function LW(t){return t??null}let yh=cie=class extends iv{constructor(t){super(t),this.max=null,this.min=null,this.timeResolution="minutes",this.type="time-picker"}readMax(t,e){return IW(e.max)}writeMax(t,e){e.max=LW(t)}readMin(t,e){return IW(e.min)}writeMin(t,e){e.min=LW(t)}readTimeResolution(t,e){return IW(e.timeResolution)}writeTimeResolution(t,e){e.timeResolution=LW(t)}clone(){return new cie({max:this.max,min:this.min,timeResolution:this.timeResolution})}};h([p({type:String,json:{type:String,write:!0}})],yh.prototype,"max",void 0),h([ze("max")],yh.prototype,"readMax",null),h([Ze("max")],yh.prototype,"writeMax",null),h([p({type:String,json:{type:String,write:!0}})],yh.prototype,"min",void 0),h([ze("min")],yh.prototype,"readMin",null),h([Ze("min")],yh.prototype,"writeMin",null),h([p({type:String,json:{type:String,write:!0}})],yh.prototype,"timeResolution",void 0),h([ze("timeResolution")],yh.prototype,"readTimeResolution",null),h([Ze("timeResolution")],yh.prototype,"writeTimeResolution",null),h([p({type:["time-picker"],json:{read:!1,write:!0}})],yh.prototype,"type",void 0),yh=cie=h([I("esri.form.elements.inputs.TimePickerInput")],yh);const GGt=yh,HGt={base:iv,key:"type",typeMap:{"barcode-scanner":DGt,"combo-box":NGt,"date-picker":FGt,"datetime-picker":UGt,"datetimeoffset-picker":kGt,"radio-buttons":VGt,switch:zGt,"text-area":BGt,"text-box":jGt,"time-picker":GGt}};var uie;let Id=uie=class extends R2{constructor(t){super(t),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){return this._get("editable")??!0}set editable(t){this._set("editable",t)}clone(){return new uie({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};h([p({types:wRe,json:{read:{reader:T6},write:!0}})],Id.prototype,"domain",void 0),h([p({type:Boolean,json:{write:!0}})],Id.prototype,"editable",null),h([p({type:String,json:{write:!0}})],Id.prototype,"editableExpression",void 0),h([p({type:String,json:{write:!0}})],Id.prototype,"fieldName",void 0),h([p({type:String,json:{write:!0}})],Id.prototype,"hint",void 0),h([p({types:HGt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Id.prototype,"input",void 0),h([p({type:String,json:{write:!0}})],Id.prototype,"requiredExpression",void 0),h([p({type:String,json:{read:!1,write:!0}})],Id.prototype,"type",void 0),h([p({type:String,json:{write:!0}})],Id.prototype,"valueExpression",void 0),Id=uie=h([I("esri.form.elements.FieldElement")],Id);const Zwe=Id;var hie;let D0=hie=class extends R2{constructor(t){super(t),this.displayCount=null,this.displayType="list",this.editableExpression=null,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new hie({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editableExpression:this.editableExpression,label:this.label,orderByFields:re(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};h([p({type:Number,json:{write:!0}})],D0.prototype,"displayCount",void 0),h([p({type:["list"],json:{write:!0}})],D0.prototype,"displayType",void 0),h([p({type:String,json:{write:!0}})],D0.prototype,"editableExpression",void 0),h([p({type:[vne],json:{write:!0}})],D0.prototype,"orderByFields",void 0),h([p({type:Number,json:{write:!0}})],D0.prototype,"relationshipId",void 0),h([p({type:["relationship"],json:{read:!1,write:!0}})],D0.prototype,"type",void 0),D0=hie=h([I("esri.form.elements.RelationshipElement")],D0);const Ywe=D0;var die;let TM=die=class extends R2{constructor(t){super(t),this.text=null,this.textFormat="plain-text",this.type="text"}clone(){return new die({text:this.text,textFormat:this.textFormat,visibilityExpression:this.visibilityExpression})}};h([p({type:String,json:{write:!0}})],TM.prototype,"text",void 0),h([p({type:String,json:{write:!0}})],TM.prototype,"textFormat",void 0),h([p({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],TM.prototype,"type",void 0),TM=die=h([I("esri.form.elements.TextElement")],TM);const Xwe=TM;function bje(t){return{typesWithGroup:{base:R2,key:"type",typeMap:{attachment:jwe,field:Zwe,group:t,relationship:Ywe,text:Xwe}},typesWithoutGroup:{base:R2,key:"type",typeMap:{attachment:jwe,field:Zwe,relationship:Ywe,text:Xwe}}}}function wje(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function xje(t,e,i=!0){if(!t)return null;const r=i?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(s=>r[s.type]).map(s=>s.toJSON())}function Tje(t,e,i=!0){return t?t.map(r=>om(i?e.typesWithGroup:e.typesWithoutGroup,r)):null}var pie;let Tg=pie=class extends R2{constructor(t){super(t),this.elements=null,this.initialState="expanded",this.type="group"}castElements(t){return Tje(t,DW,!1)}readElements(t,e){return wje(e.formElements,DW,!1)}writeElements(t,e){e.formElements=xje(t,DW,!1)}clone(){return new pie({description:this.description,elements:re(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};h([p({json:{write:!0}})],Tg.prototype,"elements",void 0),h([Qt("elements")],Tg.prototype,"castElements",null),h([ze("elements",["formElements"])],Tg.prototype,"readElements",null),h([Ze("elements")],Tg.prototype,"writeElements",null),h([p({type:["collapsed","expanded"],json:{write:!0}})],Tg.prototype,"initialState",void 0),h([p({type:String,json:{read:!1,write:!0}})],Tg.prototype,"type",void 0),Tg=pie=h([I("esri.form.elements.GroupElement")],Tg);const DW=bje(Tg),qGt=Tg,WGt=t=>t.type==="field",ZGt=t=>t.type==="group",YGt=t=>t.type==="text";var fie;const NW=bje(qGt);let ff=fie=class extends Se{constructor(t){super(t),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(t){return Tje(t,NW)}readElements(t,e){return wje(e.formElements,NW)}writeElements(t,e){e.formElements=xje(t,NW)}clone(){return new fie({description:this.description,expressionInfos:re(this.expressionInfos),elements:re(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}async getFieldsUsed(t,e){const i=new Set,{description:r,elements:s,expressionInfos:n,title:o}=this;if(mL(i,t,r),mL(i,t,o),!s)return[];const a=XGt(s,n).map(l=>ac(i,t,l));await Promise.all(a);for(const l of s)Sje(i,{fieldsIndex:t,relationships:e},l);return Array.from(i).sort()}};function Sje(t,e,i){var s;const{fieldsIndex:r}=e;if(!r||r.fields.length!==t.size)switch(mL(t,r,i.label),mL(t,r,i.description),i.type){case"field":Zc(t,r,i.fieldName);break;case"group":i.elements.forEach(n=>Sje(t,e,n));break;case"relationship":if(e.relationships){const n=e.relationships.find(o=>o.id===i.relationshipId);n&&Zc(t,r,n.keyField)}v2(t,r,(s=i.orderByFields)==null?void 0:s.map(n=>n.field));break;case"text":mL(t,r,i.text)}}function XGt(t,e){if(!e||e.length===0)return[];const i=Eje(t),r=[];for(const s of e)i.has(s.name)&&r.push(s.expression);return r}function Eje(t){const e=new Set;for(const i of t)if(uhe(e,i.visibilityExpression),!YGt(i)){if(ZGt(i))wz(e,Eje(i.elements));else if(uhe(e,i.editableExpression),WGt(i)){const{requiredExpression:r,valueExpression:s}=i;wz(e,[r,s])}}return e}function mL(t,e,i){v2(t,e,T$e(i))}h([p({type:String,json:{write:!0}})],ff.prototype,"description",void 0),h([p({json:{write:!0}})],ff.prototype,"elements",void 0),h([Qt("elements")],ff.prototype,"castElements",null),h([ze("elements",["formElements"])],ff.prototype,"readElements",null),h([Ze("elements")],ff.prototype,"writeElements",null),h([p({type:[IGt],json:{write:!0}})],ff.prototype,"expressionInfos",void 0),h([p({type:Boolean,json:{default:!1,write:!0}})],ff.prototype,"preserveFieldValuesWhenHidden",void 0),h([p({type:String,json:{write:!0}})],ff.prototype,"title",void 0),ff=fie=h([I("esri.form.FormTemplate")],ff);const JGt=ff;function Jwe(t,e,i){if(t.hasM==null||t.hasZ)for(const r of e)for(const s of r)s.length>2&&(s[2]*=i)}function QGt(t,e,i){if(!t&&!e||!i)return;const r=M_(i);Qwe(t,i,r),Qwe(e,i,r)}function Qwe(t,e,i){if(t)for(const r of t)KGt(r.geometry,e,i)}function KGt(t,e,i){if(!(t!=null&&t.spatialReference)||ms(t.spatialReference,e))return;const r=M_(t.spatialReference)/i;if(r!==1){if("x"in t)t.z!=null&&(t.z*=r);else if("rings"in t)Jwe(t,t.rings,r);else if("paths"in t)Jwe(t,t.paths,r);else if("points"in t&&(t.hasM==null||t.hasZ))for(const s of t.points)s.length>2&&(s[2]*=r)}}let e6t=0,Z0=class extends yy.LoadableMixin(jD(Ke)){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const i=e!=null?e.signal:null;return this.addResolvingPromise(this._startWorker(i)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get _workerGeometryType(){var i;const e=(i=this.layer)==null?void 0:i.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,i={}){await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);yte(e,this.layer.spatialReference,r);const s=nce.fromJSON(r);if(!this._requiresClientGraphicMapping())return s;const n=this.layer.objectIdField;for(const o of s.features){const a=o.attributes[n],l=this._idToClientGraphic.get(a);l&&(o.geometry=l.geometry)}return s.geometryType=this.layer.geometryType,s}async queryFeaturesJSON(e,i={}){if(this._requiresClientGraphicMapping())throw new B("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(i);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,i);return yte(e,this.layer.spatialReference,r),r}queryFeatureCount(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,i))}queryObjectIds(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,i))}queryExtent(e,i={}){return this.load(i).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,i)).then(r=>({count:r.count,extent:dr.fromJSON(r.extent)}))}querySnapping(e,i={}){return this.load(i).then(()=>this._connection.invoke("querySnapping",e,i))}async _applyEdits(e){if(!this._connection)throw new B("feature-layer-source:edit-failure","Memory source not loaded");const i=this.layer.objectIdField;let r=null;const s=[],n=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const o=u=>"objectId"in u&&u.objectId!=null?u.objectId:"attributes"in u&&u.attributes[i]!=null?u.attributes[i]:null;if(e.addFeatures&&(r=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const u of e.deleteFeatures){const d=o(u);d!=null&&s.push(d)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const u of e.updateFeatures)if(n.push(this._serializeFeature(u)),a){const d=o(u);d!=null&&a.set(d,u)}}QGt(r?r.features:null,n,this.layer.spatialReference);const{fullExtent:l,featureEditResults:c}=await this._connection.invoke("applyEdits",{adds:r?r.features:[],updates:n,deletes:s});return this.fullExtent=l,r&&r.finish(c.uidToObjectId),this._updateClientGraphicIds(a,c),this._createEditsResult(c)}async _prepareClientMapping(e,i){if(this._layerOrSourceGeometryType!=="mesh"||e==null)return;const r=[];for(const{geometry:s}of e)s==null||s.type!=="mesh"||s.hasExtent||s.loaded||r.push(s.load({signal:i}));r.length&&await Promise.all(r)}_updateClientGraphicIds(e,i){if(this._idToClientGraphic){if(e)for(const r of i.updateResults){if(!r.success)continue;const s=e.get(r.objectId);s!=null&&this._addIdToClientGraphic(s)}for(const r of i.deleteResults)r.success&&this._idToClientGraphic.delete(r.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const i=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:i?new B("feature-layer-source:edit-failure",i.description,{code:i.code}):null}}_prepareAddFeatures(e){const i=new Map,r=new Array(e.length);let s=null;for(let o=0;o<e.length;o++){const a=e[o],l=this._serializeFeature(a);s||a.geometry==null||(s=a.geometry.type),r[o]=l,i.set(`${l.uid}`,a)}const n=this;return{features:r,inferredGeometryType:s,finish(o){const a=n.sourceJSON.objectIdField;for(const l in o){const c=o[l],u=i.get(l);u&&(u.attributes||(u.attributes={}),c===-1?delete u.attributes[a]:u.attributes[a]=c,n._addIdToClientGraphic(u))}}}}_addIdToClientGraphic(e){var s;if(!this._idToClientGraphic)return;const i=this.sourceJSON.objectIdField,r=(s=e.attributes)==null?void 0:s[i];r!=null&&this._idToClientGraphic.set(r,e)}get _layerOrSourceGeometryType(){var e,i;return((e=this.layer)==null?void 0:e.geometryType)??((i=this.sourceJSON)==null?void 0:i.geometryType)}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:i}=e,r=this._geometryForSerialization(e),s=(e6t++).toString();return r?{uid:s,geometry:r.toJSON(),attributes:i}:{uid:s,attributes:i}}_geometryForSerialization(e){const{geometry:i}=e;return i==null?null:this._geometryRequiresClientGraphicMapping(i)?i.extent?cm.fromExtent(i.extent):null:i}async _startWorker(e){this._connection=await itt("MemorySourceWorker",{strategy:ue("feature-layers-workers")?"dedicated":"local",signal:e,registryTarget:this});const{fields:i,spatialReference:r,objectIdField:s,hasM:n,hasZ:o,timeInfo:a,dateFieldsTimeZone:l}=this.layer,c=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const u=this._prepareAddFeatures(this.items);this.addHandles(this.on("before-changes",g=>{ne.getLogger(this).error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),g.preventDefault()}));const d={features:u.features,fields:i==null?void 0:i.map(g=>g.toJSON()),geometryType:hde.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&n,hasZ:this._layerOrSourceGeometryType==="mesh"||o,objectIdField:s,spatialReference:c?null:r&&r.toJSON(),timeInfo:(a==null?void 0:a.toJSON())??null,dateFieldsTimeZone:l},f=await this._connection.invoke("load",d,{signal:e});for(const g of f.warnings)ne.getLogger(this.layer).warn("#load()",`${g.message} (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{warning:g});f.featureErrors.length&&ne.getLogger(this.layer).warn("#load()",`Encountered ${f.featureErrors.length} validation errors while loading features. (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{errors:f.featureErrors});const m=f.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(u.inferredGeometryType)&&(m.geometryType=hde.toJSON(u.inferredGeometryType)),this.sourceJSON=m,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),u.finish(f.assignedObjectIds)}};h([zre({Type:ya,ensureType:nn(ya)})],Z0.prototype,"itemType",void 0),h([p()],Z0.prototype,"type",void 0),h([p({constructOnly:!0})],Z0.prototype,"layer",void 0),h([p({readOnly:!0})],Z0.prototype,"_workerGeometryType",null),h([p()],Z0.prototype,"sourceJSON",void 0),Z0=h([I("esri.layers.graphics.sources.MemorySource")],Z0);function t6t(t){return"portalItem"in t}const i6t=t=>{let e=class extends t{get apiKey(){var i;return this._isOverridden("apiKey")?this._get("apiKey"):t6t(this)?(i=this.portalItem)==null?void 0:i.apiKey:null}set apiKey(i){i!=null?this._override("apiKey",i):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return h([p({type:String})],e.prototype,"apiKey",null),e=h([I("esri.layers.mixins.APIKeyMixin")],e),e},r6t=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const i=TO(this.url);if(i!=null&&i.title)return i.title}return this._get("title")||""}set title(i){this._set("title",i)}set url(i){this._set("url",lKe(i,ne.getLogger(this)))}};return h([p()],e.prototype,"title",null),h([p({type:String})],e.prototype,"url",null),e=h([I("esri.layers.mixins.ArcGISService")],e),e},s6t={type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}},Kwe={read:{reader:fD},write:{allowNull:!0,writer:mD}},n6t={json:{read:!1,write:!1,origins:{"web-map":Kwe,"portal-item":Kwe}}},o6t=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return h([p(s6t)],e.prototype,"blendMode",void 0),h([p(n6t)],e.prototype,"effect",void 0),e=h([I("esri.layers.mixins.BlendLayer")],e),e},a6t=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return h([p({type:Object,json:{write:{overridePolicy:i=>({enabled:!!(i&&Object.keys(i).length>0)})}}})],e.prototype,"customParameters",void 0),e=h([I("esri.layers.mixins.CustomParametersMixin")],e),e},l6t=IKe(),Cje=new Map,Mje=new Map;async function cmi(t,e,i){if(!t||!i)return!1;if(!e)return!0;const r=new URL(t).host;let s=Cje.get(r);if(!s){const n=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");s=(await fr(n,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return s===e}async function umi(t,e,i=!1){var n,o,a;if(!t||!e)return!0;const r=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),s=(n=Mje.get(r))==null?void 0:n.entries();if(s){for(const[l,c]of s)if(c.name===e){const u=!((o=c.stack)!=null&&o.hasForwardEdits());if(!u&&i){const[{deleteForwardEdits:d},{default:f}]=await Promise.all([oe(()=>import("./deleteForwardEdits-C-f3XnIJ.js"),[]),oe(()=>import("./DeleteForwardEditsParameters-DulK4WLy.js"),[])]),m=await d(r,l,new f({sessionId:l6t,moment:c.moment}));return m.success&&((a=c.stack)==null||a.clearForwardEdits()),m.success}return u}}return!0}function c6t(t,e){var s;if(!t)return!1;const i=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),r=(s=Mje.get(i))==null?void 0:s.entries();if(r){for(const[n,o]of r)if(o.name===e)return o.lockType==="edit"}return!1}const fce=new Ls.EventEmitter;function u6t(t){return fce.on("apply-edits",new WeakRef(t))}function h6t(t){return fce.on("update-moment",new WeakRef(t))}function hmi(t,e,i=null,r=!1){const s=ma();return r=e==null||r,fce.emit("apply-edits",{serviceUrl:t,layerId:e,gdbVersion:i,mayReceiveServiceEdits:r,result:s.promise}),s}const Aje=Symbol();function dmi(t){return t!=null&&typeof t=="object"&&Aje in t}function sR(t){return t!=null&&typeof t=="object"&&"gdbVersion"in t}function FW(t,e,i){const r=new URL(t).host,s=Cje.get(r),n=o=>!o||o===s;return n(e)&&n(i)||e===i}const d6t=t=>{var e;let i=class extends t{constructor(...r){super(...r),this[e]=!0,this._applyEditsHandler=s=>{const{serviceUrl:n,layerId:o,gdbVersion:a,mayReceiveServiceEdits:l,result:c}=s,u=n===this.url,d=o!=null&&this.layerId!=null&&o===this.layerId,f=sR(this),m=sR(this)&&FW(n,a,this.gdbVersion);if(!u||f&&!m||!d&&!l)return;const g=c.then(y=>{var w;if(this.lastEditsEventDate=new Date,d&&(y.addedFeatures.length||y.updatedFeatures.length||y.deletedFeatures.length||y.addedAttachments.length||y.updatedAttachments.length||y.deletedAttachments.length))return this.emit("edits",re(y)),y;const v=(w=y.editedFeatures)==null?void 0:w.find(({layerId:x})=>x===this.layerId);if(v){const{adds:x,updates:T,deletes:E}=v.editedFeatures,M={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:x?x.map(({attributes:O})=>({objectId:this.objectIdField&&O[this.objectIdField],globalId:this.globalIdField&&O[this.globalIdField]})):[],deletedFeatures:E?E.map(({attributes:O})=>({objectId:this.objectIdField&&O[this.objectIdField],globalId:this.globalIdField&&O[this.globalIdField]})):[],updatedFeatures:T?T.map(({current:{attributes:O}})=>({objectId:this.objectIdField&&O[this.objectIdField],globalId:this.globalIdField&&O[this.globalIdField]})):[],editedFeatures:re(y.editedFeatures),exceededTransferLimit:!1,historicMoment:re(y.historicMoment)};return this.emit("edits",M),M}const b={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:re(y.editedFeatures),exceededTransferLimit:!1,historicMoment:re(y.historicMoment)};return"historicMoment"in this&&this._shouldUpdateHistoricMoment(n,a,b.historicMoment)&&this.emit("edits",b),b}).then(y=>("historicMoment"in this&&this._shouldUpdateHistoricMoment(n,a,y.historicMoment)&&(this.historicMoment=y.historicMoment),y));this.emit("apply-edits",{result:g})},this._updateMomentHandler=s=>{const{serviceUrl:n,gdbVersion:o,moment:a}=s,l=n===this.url,c=sR(this),u=sR(this)&&FW(n,o,this.gdbVersion),d=sR(this)&&!FW(n,this.gdbVersion,null);l&&c&&u&&d&&"historicMoment"in this&&this.historicMoment!==a&&(this.historicMoment=a)},this.when().then(()=>{this.addHandles(u6t(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(h6t(this._updateMomentHandler))},()=>{})}_shouldUpdateHistoricMoment(r,s,n){return"historicMoment"in this&&this.historicMoment!==n&&c6t(r,s)}};return e=Aje,h([p()],i.prototype,"lastEditsEventDate",void 0),i=h([I("esri.layers.mixins.EditBusLayer")],i),i};var mie;const kW=new Qi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),UW=new Qi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let yg=mie=class extends Se{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:i,spatialRelationship:r,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new qh({geometry:re(i),objectIds:re(n),spatialRelationship:r,timeExtent:re(s),where:e,units:o,distance:a,...t})}clone(){const{where:t,geometry:e,spatialRelationship:i,timeExtent:r,objectIds:s,units:n,distance:o}=this;return new mie({geometry:re(e),objectIds:re(s),spatialRelationship:i,timeExtent:re(r),where:t,units:n,distance:o})}};h([p({type:String,json:{write:!0}})],yg.prototype,"where",void 0),h([p({types:B2,json:{write:!0}})],yg.prototype,"geometry",void 0),h([p({type:kW.apiValues,json:{name:"spatialRel",read:{reader:kW.read},write:{allowNull:!1,writer:kW.write,overridePolicy(){return{enabled:this.geometry!=null}}}}})],yg.prototype,"spatialRelationship",void 0),h([p({type:Number,json:{write:{overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],yg.prototype,"distance",void 0),h([p({type:[Number],json:{write:!0}})],yg.prototype,"objectIds",void 0),h([p({type:UW.apiValues,json:{read:UW.read,write:{writer:UW.write,overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],yg.prototype,"units",void 0),h([p({type:za,json:{write:!0}})],yg.prototype,"timeExtent",void 0),yg=mie=h([I("esri.layers.support.FeatureFilter")],yg);const p6t=yg;var gie;const exe={read:{reader:fD},write:{writer:mD,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},txe={read:{reader:fD},write:{writer:mD,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},ixe={name:"showExcludedLabels",default:!0};let IT=gie=class extends Se{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){var r,s;const i=super.write(t,e);if(e!=null&&e.origin){if(i.filter){const n=Object.keys(i.filter);if(n.length>1||n[0]!=="where")return(r=e.messages)==null||r.push(new B("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in i)return(s=e.messages)==null||s.push(new B("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return i}clone(){return new gie({filter:this.filter!=null?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};h([p({type:p6t,json:{write:{allowNull:!0,writer(t,e,i,r){const s=t==null?void 0:t.write({},r);s&&Object.keys(s).length!==0?ua(i,s,e):ua(i,null,e)}}}})],IT.prototype,"filter",void 0),h([p({json:{read:fD,write:{writer:mD,allowNull:!0},origins:{"web-map":exe,"portal-item":exe}}})],IT.prototype,"includedEffect",void 0),h([p({json:{read:fD,write:{writer:mD,allowNull:!0},origins:{"web-map":txe,"portal-item":txe}}})],IT.prototype,"excludedEffect",void 0),h([p({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":ixe,"portal-item":ixe}}})],IT.prototype,"excludedLabelsVisible",void 0),IT=gie=h([I("esri.layers.support.FeatureEffect")],IT);const f6t=IT,rxe={write:{allowNull:!0}},m6t={type:f6t,json:{origins:{"web-map":rxe,"portal-item":rxe}}},g6t=t=>{let e=class extends t{constructor(){super(...arguments),this.featureEffect=null}};return h([p(m6t)],e.prototype,"featureEffect",void 0),e=h([I("esri.layers.mixins.FeatureEffectLayer")],e),e};var yie;let l3=yie=class extends Se{constructor(t){super(t)}async collectRequiredFields(t,e){return ac(t,e,this.expression)}clone(){return new yie({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};h([p({type:String,json:{write:!0}})],l3.prototype,"expression",void 0),h([p({type:String,json:{write:!0}})],l3.prototype,"title",void 0),l3=yie=h([I("esri.symbols.support.FeatureExpressionInfo")],l3);const sxe=l3;var _ie;const dk=lc()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),nxe=new Qi({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let N0=_ie=class extends Se{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,i,r){e[i]=t.write({},r),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):t!=null||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new _ie({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&Y9e(this.featureExpressionInfo,t.featureExpressionInfo)}};h([p({type:sxe,json:{write:!0}})],N0.prototype,"featureExpressionInfo",void 0),h([ze("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],N0.prototype,"readFeatureExpressionInfo",null),h([Ze("featureExpressionInfo",{featureExpressionInfo:{type:sxe},"featureExpression.value":{type:[0]}})],N0.prototype,"writeFeatureExpressionInfo",null),h([p({type:dk.apiValues,nonNullable:!0,json:{type:dk.jsonValues,read:dk.read,write:{writer:dk.write,isRequired:!0}}})],N0.prototype,"mode",null),h([p({type:Number,json:{write:!0}})],N0.prototype,"offset",void 0),h([p({type:W_t,json:{type:String,read:nxe.read,write:nxe.write}})],N0.prototype,"unit",null),N0=_ie=h([I("esri.symbols.support.ElevationInfo")],N0);const y6t=N0,_6t={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:Ba}}},mce={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,i){e[i]=!t}}}},gce={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:Ba}}},v6t={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:Vb}}},b6t={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:Ba}}},w6t={value:null,type:y6t,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:Ba}}};function pmi(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const Pje={write:{enabled:!0,layerContainerTypes:Ba},read:!0},vie={type:Number,json:{origins:{"web-document":Pje,"portal-item":{write:!0}}}},x6t={...vie,json:{...vie.json,origins:{"web-document":{...Pje,write:{enabled:!0,layerContainerTypes:Ba,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,i)=>{var r;return i&&i.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?(r=e.layerDefinition)!=null&&r.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?pP(e.layerDefinition.drawingInfo.transparency):void 0:pP(e.drawingInfo.transparency)}}}},fmi={type:dr,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const i=dr.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(i.spatialReference=Ye.fromJSON(e.spatialReference)),i}}}},read:!1}},T6t={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},S6t={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.minScale",write:{enabled:!0,layerContainerTypes:Ba}}},name:"layerDefinition.minScale",write:!0}},E6t={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.maxScale",write:{enabled:!0,layerContainerTypes:Ba}}},name:"layerDefinition.maxScale",write:!0}},Oje={json:{write:{ignoreOrigin:!0,layerContainerTypes:Ba},origins:{"web-map":{read:!1,write:!1}}}};let F0=class extends ts(Se){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.timeZone=null}};h([p()],F0.prototype,"creatorField",void 0),h([p()],F0.prototype,"creationDateField",void 0),h([p()],F0.prototype,"editorField",void 0),h([p()],F0.prototype,"editDateField",void 0),h([p()],F0.prototype,"realm",void 0),h([p(fz("dateFieldsTimeReference",!0))],F0.prototype,"timeZone",void 0),F0=h([I("esri.layers.support.EditFieldsInfo")],F0);const C6t=F0;let Sg=class extends ts(Se){constructor(e){super(e)}};h([p({constructOnly:!0,json:{write:!0}})],Sg.prototype,"name",void 0),h([p({constructOnly:!0,json:{write:!0}})],Sg.prototype,"fields",void 0),h([p({constructOnly:!0,json:{write:!0}})],Sg.prototype,"isAscending",void 0),h([p({constructOnly:!0,json:{write:!0}})],Sg.prototype,"indexType",void 0),h([p({constructOnly:!0,json:{write:!0}})],Sg.prototype,"isUnique",void 0),h([p({constructOnly:!0,json:{write:!0}})],Sg.prototype,"description",void 0),Sg=h([I("esri.layers.support.FeatureIndex")],Sg);async function M6t(t,e,i){e=e.clone(),t.capabilities.query.supportsMaxRecordCountFactor&&(e.maxRecordCountFactor=$je(t));const r=A6t(t),s=t.capabilities.query.supportsPagination;e.start=0,e.num=r;let n=null;for(;;){const o=await t.source.queryFeaturesJSON(e,i);if(n==null?n=o:n.features=n.features.concat(o.features),n.exceededTransferLimit=o.exceededTransferLimit,!s||!o.exceededTransferLimit)break;e.start+=r}return n}function A6t(t){return $je(t)*P6t(t)}function P6t(t){return t.capabilities.query.maxRecordCount||2e3}function $je(t){return t.capabilities.query.supportsMaxRecordCountFactor?qh.MAX_MAX_RECORD_COUNT_FACTOR:1}const bie=new Qi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function O6t(t,e,i,r){const s=await $w(t);if(await yce(t,e,r),!s.addAttachment)throw new B(r,"Layer source does not support addAttachment capability");return s.addAttachment(e,i)}function yce(t,e,i){var n,o;const{attributes:r}=e,{objectIdField:s}=t;return(o=(n=t.capabilities)==null?void 0:n.data)!=null&&o.supportsAttachment?e?r?s&&r[s]?Promise.resolve():Promise.reject(new B(i,`feature is missing the identifying attribute ${s}`)):Promise.reject(new B(i,"'attributes' are required on a feature to query attachments")):Promise.reject(new B(i,"A feature is required to add/delete/update attachments")):Promise.reject(new B(i,"this layer doesn't support attachments"))}async function $6t(t,e,i,r,s){const n=await $w(t);if(await yce(t,e,s),!n.updateAttachment)throw new B(s,"Layer source does not support updateAttachment capability");return n.updateAttachment(e,i,r)}async function R6t(t,e,i){const{applyEdits:r}=await oe(()=>import("./editingSupport-CM8xZqh_.js"),__vite__mapDeps([229,103])),s=await t.load();let n=i;return s.type==="feature"&&s.infoFor3D&&e.deleteFeatures!=null&&s.globalIdField!=null&&(n={...n,globalIdToObjectId:await X6t(s,e.deleteFeatures,s.globalIdField)}),r(s,s.source,e,i)}async function I6t(t,e,i){const{uploadAssets:r}=await oe(()=>import("./editingSupport-CM8xZqh_.js"),__vite__mapDeps([229,103])),s=await t.load();return r(s,s.source,e,i)}async function L6t(t,e,i,r){const s=await $w(t);if(await yce(t,e,r),!s.deleteAttachments)throw new B(r,"Layer source does not support deleteAttachments capability");return s.deleteAttachments(e,i)}async function D6t(t,e,i){const r=(await t.load({signal:e==null?void 0:e.signal})).source;if(!r.fetchRecomputedExtents)throw new B(i,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(e)}async function N6t(t,e,i,r){var m,g;e=ute.from(e),await t.load();const s=t.source,n=t.capabilities;if(!((m=n==null?void 0:n.data)!=null&&m.supportsAttachment))throw new B(r,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:u,start:d,where:f}=e;if(!((g=n==null?void 0:n.operations)!=null&&g.supportsQueryAttachments)&&((o==null?void 0:o.length)>0||(l==null?void 0:l.length)>0||(u==null?void 0:u.length)>0||c||d||f))throw new B(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(a!=null&&a.length||l!=null&&l.length||f))throw new B(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!s.queryAttachments)throw new B(r,"Layer source does not support queryAttachments capability",e);return s.queryAttachments(e)}async function F6t(t,e,i,r){const s=await $w(t);if(!s.queryObjectIds)throw new B(r,"Layer source does not support queryObjectIds capability");return s.queryObjectIds(qh.from(e)??t.createQuery(),i)}async function k6t(t,e,i,r){const s=await $w(t);if(!s.queryFeatureCount)throw new B(r,"Layer source does not support queryFeatureCount capability");return s.queryFeatureCount(qh.from(e)??t.createQuery(),i)}async function U6t(t,e,i,r){const s=await $w(t);if(!s.queryExtent)throw new B(r,"Layer source does not support queryExtent capability");return s.queryExtent(qh.from(e)??t.createQuery(),i)}async function V6t(t,e,i,r){const s=await $w(t);if(!s.queryRelatedFeatures)throw new B(r,"Layer source does not support queryRelatedFeatures capability");return s.queryRelatedFeatures(aO.from(e),i)}async function z6t(t,e,i,r){const s=await $w(t);if(!s.queryRelatedFeaturesCount)throw new B(r,"Layer source does not support queryRelatedFeaturesCount capability");return s.queryRelatedFeaturesCount(aO.from(e),i)}async function B6t(t){const e=t.source;if(e!=null&&e.refresh)try{const{dataChanged:i,updates:r}=await e.refresh();if(r!=null&&(t.sourceJSON={...t.sourceJSON,...r},t.read(r,{origin:"service",url:t.parsedUrl})),i)return!0}catch{}if(t.definitionExpression)try{return(await hne(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function j6t(t){var o,a;const e=new qh,i=(o=t.capabilities)==null?void 0:o.data,r=(a=t.capabilities)==null?void 0:a.query;e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,r&&(e.compactGeometryEnabled=r.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),i&&(i.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),i.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:s,timeExtent:n}=t;return e.timeExtent=s!=null&&n!=null?n.offset(-s.value,s.unit):n||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function Rje(t){const{globalIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeGlobalID")return r.name}}function Ije(t){const{objectIdField:e,fields:i}=t;if(e)return e;if(i){for(const r of i)if(r.type==="esriFieldTypeOID")return r.name}}function G6t(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}function H6t(t,e){const{subtypes:i,subtypeField:r}=t;if(!e||!(i!=null&&i.length)||!r)return null;const s=e.attributes[r];return s==null?null:i.find(n=>n.code===s)}async function $w(t){return(await t.load()).source}async function q6t(t,e){if(!Ci||Ci.findCredential(t))return;let i;try{const r=await TCe(t,e);r&&(i=await Ci.checkSignInStatus(`${r}/sharing`))}catch{}if(i)try{const r=e!=null?e.signal:null;await Ci.getCredential(t,{signal:r})}catch{}}async function W6t(t,e,i){var s;const r=(s=t.parsedUrl)==null?void 0:s.path;r&&t.authenticationTriggerEvent===e&&await q6t(r,i)}function Z6t(t){return!KV(t)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const VW=gO({types:mRe});function _ce(t,e){var i;if(t.defaultSymbol)return(i=t.types)!=null&&i.length?new dce({defaultSymbol:VW(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(r=>({id:r.id,symbol:VW(r.symbol,r,e)}))}):new qO({symbol:VW(t.defaultSymbol,t,e)})}function Y6t(t){var r,s,n;let e=(r=t.sourceJSON)==null?void 0:r.cacheMaxAge;if(!e)return!1;const i=(n=(s=t.editingInfo)==null?void 0:s.lastEditDate)==null?void 0:n.getTime();return i==null||(e*=1e3,Date.now()-i<e)}async function X6t(t,e,i){if(e==null)return null;const r=[],{objectIdField:s}=t;if(e.forEach(c=>{let u=null;if("attributes"in c){const{attributes:d}=c;u={globalId:d[i],objectId:d[s]!=null&&d[s]!==-1?d[s]:null}}else u={globalId:c.globalId,objectId:c.objectId!=null&&c.objectId!==-1?c.objectId:null};u.globalId!=null&&(u.objectId!=null&&u.objectId!==-1||r.push(u.globalId))}),r.length===0)return null;const n=t.createQuery();n.where=r.map(c=>`${i}='${c}'`).join(" OR "),n.returnGeometry=!1,n.outFields=[s,i],n.cacheHint=!1;const o=await eYe(M6t(t,n));if(!o.ok)return null;const a=new Map,l=o.value.features;for(const c of l){const u=c.attributes[i],d=c.attributes[s];u!=null&&d!=null&&d!==-1&&a.set(u,d)}return a}function J6t(t,e,i){if(!e||!i||!t)return null;const r=i.getAttribute(e);return r==null?null:t.find(s=>{const{id:n}=s;return n!=null&&n.toString()===r.toString()})??null}function KV(t){var e;return((e=t.sourceJSON)==null?void 0:e.isMultiServicesView)||Q6t(t)}function Q6t(t){var e,i;return!!((i=(e=t.sourceJSON)==null?void 0:e.capabilities)!=null&&i.toLowerCase().split(",").map(r=>r.trim()).includes("map"))}let SM=class extends ts(Se){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};h([p({type:String,json:{read:{source:"shapeAreaFieldName"}}})],SM.prototype,"shapeAreaField",void 0),h([p({type:String,json:{read:{source:"shapeLengthFieldName"}}})],SM.prototype,"shapeLengthField",void 0),h([p({type:String,json:{read:t=>AYe.read(t)||PYe.read(t)}})],SM.prototype,"units",void 0),SM=h([I("esri.layers.support.GeometryFieldsInfo")],SM);const K6t=SM;var wie;let EM=wie=class extends Se{constructor(t){super(t),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new Ke}clone(){return new wie({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};h([p({type:String,json:{write:!0}})],EM.prototype,"floorField",void 0),h([p({json:{read:!1,write:!1}})],EM.prototype,"viewAllMode",void 0),h([p({json:{read:!1,write:!1}})],EM.prototype,"viewAllLevelIds",void 0),EM=wie=h([I("esri.layers.support.LayerFloorInfo")],EM);const e8t=EM,oxe=new Qi({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),axe=new Qi({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Ld=class extends ts(Se){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};h([p({json:{read:oxe.read,write:oxe.write}})],Ld.prototype,"cardinality",void 0),h([p({json:{read:!0,write:!0}})],Ld.prototype,"composite",void 0),h([p({json:{read:!0,write:!0}})],Ld.prototype,"id",void 0),h([p({json:{read:!0,write:!0}})],Ld.prototype,"keyField",void 0),h([p({json:{read:!0,write:!0}})],Ld.prototype,"keyFieldInRelationshipTable",void 0),h([p({json:{read:!0,write:!0}})],Ld.prototype,"name",void 0),h([p({json:{read:!0,write:!0}})],Ld.prototype,"relatedTableId",void 0),h([p({json:{read:!0,write:!0}})],Ld.prototype,"relationshipTableId",void 0),h([p({json:{read:axe.read,write:axe.write}})],Ld.prototype,"role",void 0),Ld=h([I("esri.layers.support.Relationship")],Ld);const t8t=Ld;function qt(t,e,i){return!!Lje(t,e,i)}function c3(t,e,i){return Lje(t,e,i)}function Lje(t,e,i){return t&&t.hasOwnProperty(e)?t[e]:i}const i8t={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function r8t(t){var i;const e=(i=t==null?void 0:t.supportedSpatialAggregationStatistics)==null?void 0:i.map(r=>r.toLowerCase());return{envelope:!!(e!=null&&e.includes("envelopeaggregate")),centroid:!!(e!=null&&e.includes("centroidaggregate")),convexHull:!!(e!=null&&e.includes("convexhullaggregate"))}}function HN(t,e){var r;const i=(r=t==null?void 0:t.supportedOperationsWithCacheHint)==null?void 0:r.map(s=>s.toLowerCase());return!!(i!=null&&i.includes(e.toLowerCase()))}function Dje(t,e){return{analytics:s8t(t),attachment:n8t(t),data:o8t(t),metadata:a8t(t),operations:l8t(t.capabilities,t,e),query:c8t(t,e),queryRelated:u8t(t),queryTopFeatures:h8t(t),editing:d8t(t)}}function s8t(t){return{supportsCacheHint:HN(t.advancedQueryCapabilities,"queryAnalytics")}}function n8t(t){const e=t.attachmentProperties,i={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:HN(t.advancedQueryCapabilities,"queryAttachments"),supportsResize:qt(t,"supportsAttachmentsResizing",!1)};return e&&Array.isArray(e)&&e.forEach(r=>{const s=i8t[r.name];s&&(i[s]=!!r.isEnabled)}),i}function o8t(t){return{isVersioned:qt(t,"isDataVersioned",!1),supportsAttachment:qt(t,"hasAttachments",!1),supportsM:qt(t,"hasM",!1),supportsZ:qt(t,"hasZ",!1)}}function a8t(t){return{supportsAdvancedFieldProperties:qt(t,"supportsFieldDescriptionProperty",!1)}}function l8t(t,e,i){const r=t?t.toLowerCase().split(",").map(f=>f.trim()):[],s=i?TO(i):null,n=r.includes(s!=null&&s.serverType==="MapServer"?"data":"query"),o=r.includes("editing")&&!e.datesInUnknownTimezone;let a=o&&r.includes("create"),l=o&&r.includes("delete"),c=o&&r.includes("update");const u=r.includes("changetracking"),d=e.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:qt(e,"supportsCalculate",!1),supportsTruncate:qt(e,"supportsTruncate",!1),supportsValidateSql:qt(e,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:u,supportsQuery:n,supportsQueryAnalytics:qt(d,"supportsQueryAnalytic",!1),supportsQueryAttachments:qt(d,"supportsQueryAttachments",!1),supportsQueryTopFeatures:qt(d,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:qt(e,"supportsAttachmentsResizing",!1),supportsSync:r.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:qt(e,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:qt(e,"supportsAsyncConvert3D",!1)}}function c8t(t,e){const i=t.advancedQueryCapabilities,r=t.ownershipBasedAccessControlForFeatures,s=t.archivingInfo,n=t.currentVersion,o=e==null?void 0:e.includes("MapServer"),a=!o||n>=ue("mapserver-pbf-version-support"),l=pAe(e),c=new Set((t.supportedQueryFormats??"").split(",").map(u=>u.toLowerCase().trim()));return{maxRecordCount:c3(t,"maxRecordCount",void 0),maxRecordCountFactor:c3(t,"maxRecordCountFactor",void 0),standardMaxRecordCount:c3(t,"standardMaxRecordCount",void 0),supportedSpatialAggregationStatistics:r8t(i),supportsCacheHint:qt(i,"supportsQueryWithCacheHint",!1)||HN(i,"query"),supportsCentroid:qt(i,"supportsReturningGeometryCentroid",!1),supportsCompactGeometry:l,supportsDefaultSpatialReference:qt(i,"supportsDefaultSR",!1),supportsDisjointSpatialRelationship:qt(i,"supportsDisjointSpatialRel",!1),supportsDistance:qt(i,"supportsQueryWithDistance",!1),supportsDistinct:qt(i,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:qt(i,"supportsReturningQueryExtent",!1),supportsFormatPBF:a&&c.has("pbf"),supportsFullTextSearch:qt(i,"supportsFullTextSearch",!1),supportsGeometryProperties:qt(i,"supportsReturningGeometryProperties",!1),supportsHavingClause:qt(i,"supportsHavingClause",!1),supportsHistoricMoment:qt(s,"supportsQueryWithHistoricMoment",!1),supportsMaxRecordCountFactor:qt(i,"supportsMaxRecordCountFactor",!1),supportsOrderBy:qt(i,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:qt(i,"supportsPagination",!1),supportsPercentileStatistics:qt(i,"supportsPercentileStatistics",!1),supportsQuantization:qt(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:qt(t,"supportsQuantizationEditMode",!1),supportsQueryByAnonymous:qt(r,"allowAnonymousToQuery",!0),supportsQueryByOthers:qt(r,"allowOthersToQuery",!0),supportsQueryGeometry:qt(t,"supportsReturningQueryGeometry",!1),supportsResultType:qt(i,"supportsQueryWithResultType",!1),supportsSpatialAggregationStatistics:qt(i,"supportsSpatialAggregationStatistics",!1),supportsSqlExpression:qt(i,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:qt(t,"useStandardizedQueries",!1),supportsStatistics:qt(i,"supportsStatistics",t.supportsStatistics),supportsTopFeaturesQuery:qt(i,"supportsTopFeaturesQuery",!1),tileMaxRecordCount:c3(t,"tileMaxRecordCount",void 0)}}function u8t(t){const e=t.advancedQueryCapabilities,i=qt(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:qt(e,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i,supportsCacheHint:HN(e,"queryRelated")}}function h8t(t){return{supportsCacheHint:HN(t.advancedQueryCapabilities,"queryTopFilter")}}function d8t(t){const e=t.ownershipBasedAccessControlForFeatures,i=t?t.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:qt(t,"allowGeometryUpdates",!0),supportsGlobalId:qt(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:qt(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:qt(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:qt(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:qt(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:qt(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:qt(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:qt(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:qt(e,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:qt(i,"supportsAsyncApplyEdits",!1),zDefault:c3(t,"zDefault",void 0)}}function vmi(t){var e;return{operations:{supportsAppend:qt(t,"supportsAppend",!1),supportsExportClip:qt(t,"supportsExportClip",!1),supportsExportFrameset:qt(t,"supportsExportFrameset",!1),supportsMensuration:qt(t,"supportsMensuration",!1),supportsUpdate:qt(t,"supportsUpdate",!1)},query:{supportsCoverageQuery:((e=t==null?void 0:t.playbackInfo)==null?void 0:e.klv["0601"])??!1}}}let k0=class extends ts(Se){constructor(e){super(e),this.code=null,this.defaultValues={},this.domains=null,this.name=null}readDomains(e){if(!e)return null;const i={};for(const r of Object.keys(e))i[r]=T6(e[r]);return i}writeDomains(e,i){var s;if(!e)return;const r={};for(const n of Object.keys(e))e[n]&&(r[n]=(s=e[n])==null?void 0:s.toJSON());i.domains=r}};h([p({type:Number,json:{write:!0}})],k0.prototype,"code",void 0),h([p({type:Object,json:{write:!0}})],k0.prototype,"defaultValues",void 0),h([p({json:{write:!0}})],k0.prototype,"domains",void 0),h([ze("domains")],k0.prototype,"readDomains",null),h([Ze("domains")],k0.prototype,"writeDomains",null),h([p({type:String,json:{write:!0}})],k0.prototype,"name",void 0),k0=h([I("esri.layers.support.Subtype")],k0);const p8t=k0,f8t=t=>{let e=class extends t{constructor(){super(...arguments),this.copyright=null,this.capabilities=null,this.dateFieldsTimeZone=null,this.datesInUnknownTimezone=!1,this.definitionExpression=null,this.displayField=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.globalIdField=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.indexes=new(Ke.ofType(Sg)),this.isTable=!1,this.layerId=void 0,this.maxScale=0,this.minScale=0,this.objectIdField=null,this.preferredTimeZone=null,this.relationships=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.sourceJSON=null,this.spatialReference=Ye.WGS84,this.subtypeField=null,this.subtypes=null,this.trackIdField=null,this.version=void 0}get authenticationTriggerEvent(){if(!this.url)return null;const{capabilities:i}=this;if(i){const{query:s,operations:n,editing:o}=i;if(!s.supportsQueryByOthers||!s.supportsQueryByAnonymous||n.supportsEditing&&!(o.supportsUpdateByOthers&&o.supportsUpdateByAnonymous&&o.supportsDeleteByOthers&&o.supportsDeleteByAnonymous))return"load"}if(this.userHasUpdateItemPrivileges){if(Y6t(this))return"load";if(this.hasUpdateItemRestrictions)return i.operations.supportsQuery?"editing":"load"}if(this.userHasFullEditingPrivileges&&this.hasFullEditingRestrictions)return"editing";const r=this.editFieldsInfo;return(r!=null&&r.creatorField||r!=null&&r.editorField)&&(i!=null&&i.operations.supportsEditing)?"editing":null}readCapabilitiesFromService(i,r){return Dje(r,this.url)}readEditingInfo(i,r){const{editingInfo:s}=r;return s?{lastEditDate:s.lastEditDate!=null?new Date(s.lastEditDate):null}:null}get effectiveCapabilities(){const i=this.capabilities;if(!i)return null;const r=re(i),{operations:s,editing:n}=r;return KV(this)?(this.userHasUpdateItemPrivileges&&(s.supportsQuery=!0),r):this.userHasUpdateItemPrivileges?(s.supportsAdd=s.supportsDelete=s.supportsEditing=s.supportsQuery=s.supportsUpdate=n.supportsDeleteByOthers=n.supportsGeometryUpdate=n.supportsUpdateByOthers=!0,r):(this.userHasFullEditingPrivileges&&s.supportsEditing&&(s.supportsAdd=s.supportsDelete=s.supportsUpdate=n.supportsGeometryUpdate=!0),r)}readGlobalIdFieldFromService(i,r){return Rje(r)}get hasFullEditingRestrictions(){const i=this.capabilities;if(!i||KV(this))return!1;const{operations:r,editing:s}=i;return r.supportsEditing&&!(r.supportsAdd&&r.supportsDelete&&r.supportsUpdate&&s.supportsGeometryUpdate)}get hasUpdateItemRestrictions(){const i=this.capabilities;if(!i)return!1;const{operations:r,editing:s}=i;return KV(this)?!r.supportsQuery:!(r.supportsAdd&&r.supportsDelete&&r.supportsEditing&&r.supportsQuery&&r.supportsUpdate&&s.supportsDeleteByOthers&&s.supportsGeometryUpdate&&s.supportsUpdateByOthers)}readIsTableFromService(i,r){return r.type==="Table"}readMaxScale(i,r){return r.effectiveMaxScale||i||0}readMinScale(i,r){return r.effectiveMinScale||i||0}readObjectIdFieldFromService(i,r){return Ije(r)}readServiceDefinitionExpression(i,r){return r.definitionQuery||r.definitionExpression}set url(i){if(i==null)return void this._set("url",i);const r=cKe({layer:this,url:i,nonStandardUrlAllowed:!0,logger:ne.getLogger(this)});this._set("url",r.url),r.layerId!=null&&this._set("layerId",r.layerId)}writeUrl(i,r,s,n){uKe(this,i,null,r,n)}readVersion(i,r){return G6t(r)}};return h([p({readOnly:!0})],e.prototype,"authenticationTriggerEvent",null),h([p({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),h([p({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],e.prototype,"capabilities",void 0),h([ze("service","capabilities")],e.prototype,"readCapabilitiesFromService",null),h([p(fz("dateFieldsTimeReference"))],e.prototype,"dateFieldsTimeZone",void 0),h([p({type:Boolean})],e.prototype,"datesInUnknownTimezone",void 0),h([p({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],e.prototype,"definitionExpression",void 0),h([p({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],e.prototype,"displayField",void 0),h([p({readOnly:!0,type:C6t})],e.prototype,"editFieldsInfo",void 0),h([p({readOnly:!0})],e.prototype,"editingInfo",void 0),h([ze("editingInfo")],e.prototype,"readEditingInfo",null),h([p({readOnly:!0})],e.prototype,"effectiveCapabilities",null),h([p((()=>{const i=re(w6t),r=i.json.origins;return r["web-map"]={read:!1,write:!1},r["portal-item"]={read:!1,write:!1},i})())],e.prototype,"elevationInfo",void 0),h([p({type:e8t,json:{name:"layerDefinition.floorInfo",write:!0,origins:{"web-scene":{name:"layerDefinition.floorInfo",write:{enabled:!0,layerContainerTypes:Ba}}}}})],e.prototype,"floorInfo",void 0),h([p({type:dr,json:{origins:{service:{read:{source:"extent"}}}}})],e.prototype,"fullExtent",void 0),h([p()],e.prototype,"gdbVersion",void 0),h([p({readOnly:!0,type:K6t,json:{read:{source:"geometryProperties"}}})],e.prototype,"geometryFieldsInfo",void 0),h([p({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:bie.read}}}})],e.prototype,"geometryType",void 0),h([p({type:String})],e.prototype,"globalIdField",void 0),h([ze("service","globalIdField",["globalIdField","fields"])],e.prototype,"readGlobalIdFieldFromService",null),h([p({readOnly:!0})],e.prototype,"hasFullEditingRestrictions",null),h([p({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasM",void 0),h([p({readOnly:!0})],e.prototype,"hasUpdateItemRestrictions",null),h([p({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasZ",void 0),h([p({readOnly:!0,type:gw})],e.prototype,"heightModelInfo",void 0),h([p({type:Date})],e.prototype,"historicMoment",void 0),h([p({type:Ke.ofType(Sg),readOnly:!0})],e.prototype,"indexes",void 0),h([p({readOnly:!0})],e.prototype,"isTable",void 0),h([ze("service","isTable",["type"])],e.prototype,"readIsTableFromService",null),h([p({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],e.prototype,"layerId",void 0),h([p(E6t)],e.prototype,"maxScale",void 0),h([ze("service","maxScale",["maxScale","effectiveMaxScale"])],e.prototype,"readMaxScale",null),h([p(S6t)],e.prototype,"minScale",void 0),h([ze("service","minScale",["minScale","effectiveMinScale"])],e.prototype,"readMinScale",null),h([p({type:String})],e.prototype,"objectIdField",void 0),h([ze("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdFieldFromService",null),h([p(fz("preferredTimeReference"))],e.prototype,"preferredTimeZone",void 0),h([p({type:[t8t],readOnly:!0})],e.prototype,"relationships",void 0),h([p({type:Boolean})],e.prototype,"returnM",void 0),h([p({type:Boolean})],e.prototype,"returnZ",void 0),h([p({readOnly:!0,json:{write:!1}})],e.prototype,"serverGens",void 0),h([p({readOnly:!0})],e.prototype,"serviceDefinitionExpression",void 0),h([ze("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],e.prototype,"readServiceDefinitionExpression",null),h([p({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"serviceItemId",void 0),h([p()],e.prototype,"sourceJSON",void 0),h([p({type:Ye,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],e.prototype,"spatialReference",void 0),h([p({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],e.prototype,"subtypeField",void 0),h([p({type:[p8t],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"subtypes",void 0),h([p({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],e.prototype,"trackIdField",void 0),h([p(v6t)],e.prototype,"url",null),h([Ze("url")],e.prototype,"writeUrl",null),h([p({json:{origins:{service:{read:!0}},read:!1}})],e.prototype,"version",void 0),h([ze("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],e.prototype,"readVersion",null),e=h([I("esri.layers.mixins.FeatureLayerBase")],e),e};let CM=class extends ts(Se){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};h([p({type:String,json:{write:!0}})],CM.prototype,"expression",void 0),h([p({type:String,json:{write:!0}})],CM.prototype,"title",void 0),h([p({type:String,json:{write:!0}})],CM.prototype,"returnType",void 0),CM=h([I("esri.layers.support.ExpressionInfo")],CM);const vce=CM;var xie;let U0=xie=class extends Se{constructor(t){super(t),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new xie({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:re(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};h([p({type:Boolean,json:{write:!0}})],U0.prototype,"isAutoGenerated",void 0),h([p({type:String,json:{write:!0}})],U0.prototype,"name",void 0),h([p({type:String,json:{write:!0}})],U0.prototype,"alias",void 0),h([p({type:String,json:{write:!0}})],U0.prototype,"onStatisticField",void 0),h([p({type:vce,json:{write:!0}})],U0.prototype,"onStatisticExpression",void 0),h([p({type:String,json:{write:!0}})],U0.prototype,"statisticType",void 0),U0=xie=h([I("esri.layers.support.AggregateField")],U0);const I2=U0;let Rb=class extends Se{constructor(){super(...arguments),this.type=null}};h([p({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],Rb.prototype,"type",void 0),Rb=h([I("esri.layers.support.FeatureReduction")],Rb);var Tie;let M1=Tie=class extends Se{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(t,e){return e.value?RK(e.value):t}writeExpression(t,e,i){this.value!=null&&(t=RK(this.value)),t!=null&&(e[i]=t)}clone(){return new Tie({expression:this.expression,title:this.title,value:this.value})}};h([p({type:String,json:{write:{writerEnsuresNonNull:!0}}})],M1.prototype,"expression",void 0),h([ze("expression",["expression","value"])],M1.prototype,"readExpression",null),h([Ze("expression")],M1.prototype,"writeExpression",null),h([p({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],M1.prototype,"title",void 0),h([p({json:{read:!1,write:!1}})],M1.prototype,"value",void 0),M1=Tie=h([I("esri.layers.support.LabelExpressionInfo")],M1);const Nje=M1;var Sie;const pk=new Qi({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function fk(t,e,i){return{enabled:!xCe(i==null?void 0:i.layer)}}function Fje(t){var e;return!t||t.origin!=="service"&&((e=t.layer)==null?void 0:e.type)!=="map-image"}function m8t(t){return(t==null?void 0:t.type)==="map-image"}function kje(t){var e,i;return!!m8t(t)&&!!((i=(e=t.capabilities)==null?void 0:e.exportMap)!=null&&i.supportsArcadeExpressionForLabeling)}function g8t(t){return Fje(t)||kje(t==null?void 0:t.layer)}let zn=Sie=class extends Se{static evaluateWhere(t,e){const i=(r,s,n)=>{switch(s){case"=":return r==n;case"<>":return r!=n;case">":return r>n;case">=":return r>=n;case"<":return r<n;case"<=":return r<=n}return!1};try{if(t==null)return!0;const r=t.split(" ");if(r.length===3)return i(e[r[0]],r[1],r[2]);if(r.length===7){const s=i(e[r[0]],r[1],r[2]),n=r[3],o=i(e[r[4]],r[5],r[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=hEt,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const i=e.labelExpressionInfo;if(!i||!i.value&&!i.expression)return t}writeLabelExpression(t,e,i){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)t=x_t(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const r=Hoe(this.labelExpressionInfo.expression);r&&(t="["+r+"]")}}t!=null&&(e[i]=t)}writeLabelExpressionInfo(t,e,i,r){if(t==null&&this.labelExpression!=null&&Fje(r))t=new Nje({expression:this.getLabelExpressionArcade()});else if(!t)return;const s=t.toJSON(r);s.expression&&(e[i]=s)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return r8(this)}getLabelExpressionArcade(){return T_t(this)}getLabelExpressionSingleField(){return S_t(this)}hash(){return JSON.stringify(this)}clone(){return new Sie({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:re(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:re(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};h([p({type:String,json:{write:!0}})],zn.prototype,"name",void 0),h([p({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:fk}}}}})],zn.prototype,"allowOverrun",void 0),h([p({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:fk}}}}})],zn.prototype,"deconflictionStrategy",void 0),h([p({type:String,json:{write:{overridePolicy(t,e,i){return this.labelExpressionInfo&&(i==null?void 0:i.origin)==="service"&&kje(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],zn.prototype,"labelExpression",void 0),h([ze("labelExpression")],zn.prototype,"readLabelExpression",null),h([Ze("labelExpression")],zn.prototype,"writeLabelExpression",null),h([p({type:Nje,json:{write:{overridePolicy:(t,e,i)=>g8t(i)?{allowNull:!0}:{enabled:!1}}}})],zn.prototype,"labelExpressionInfo",void 0),h([Ze("labelExpressionInfo")],zn.prototype,"writeLabelExpressionInfo",null),h([p({type:pk.apiValues,json:{type:pk.jsonValues,read:pk.read,write:pk.write}})],zn.prototype,"labelPlacement",void 0),h([p({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],zn.prototype,"labelPosition",void 0),h([p({type:Number})],zn.prototype,"maxScale",void 0),h([Ze("maxScale")],zn.prototype,"writeMaxScale",null),h([p({type:Number})],zn.prototype,"minScale",void 0),h([Ze("minScale")],zn.prototype,"writeMinScale",null),h([p({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:fk}}}}})],zn.prototype,"repeatLabel",void 0),h([p({type:Number,cast:wr,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:fk}}}}})],zn.prototype,"repeatLabelDistance",void 0),h([p({types:zlt,json:{origins:{"web-scene":{types:Blt,write:I_e,default:null}},write:I_e,default:null}})],zn.prototype,"symbol",void 0),h([p({type:Boolean,json:{write:!0}})],zn.prototype,"useCodedValues",void 0),h([p({type:String,json:{write:!0}})],zn.prototype,"where",void 0),zn=Sie=h([I("esri.layers.support.LabelClass")],zn);const W8=zn;var Eie;let jl=Eie=class extends Rb{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=null,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.size=wr("12px"),this.fields=[],this.renderer=null}writeFields(t,e,i){const r=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());ua(i,r,e)}readRenderer(t,e,i){var s;const r=(s=e.drawingInfo)==null?void 0:s.renderer;return r?AD(r,e,i)??void 0:_ce(e,i)}clone(){return new Eie({fields:re(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:re(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:re(this.popupTemplate),renderer:re(this.renderer),binType:re(this.binType),size:this.size})}};h([$t({binning:"binning"})],jl.prototype,"type",void 0),h([$t({geohash:"geohash",square:"square"}),p({type:["geohash","square"]})],jl.prototype,"binType",void 0),h([p({type:Number,json:{write:!0}})],jl.prototype,"fixedBinLevel",void 0),h([p({type:[W8],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],jl.prototype,"labelingInfo",void 0),h([p(gce)],jl.prototype,"labelsVisible",void 0),h([p({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],jl.prototype,"maxScale",void 0),h([p(mce)],jl.prototype,"popupEnabled",void 0),h([p({type:nN,json:{name:"popupInfo",write:!0}})],jl.prototype,"popupTemplate",void 0),h([p({type:Number,cast:t=>t==="auto"?t:wr(t)})],jl.prototype,"size",void 0),h([p({type:[I2],json:{write:!0}})],jl.prototype,"fields",void 0),h([Ze("fields")],jl.prototype,"writeFields",null),h([p({types:q8,json:{write:{target:"drawingInfo.renderer"}}})],jl.prototype,"renderer",void 0),h([ze("renderer",["drawingInfo.renderer"])],jl.prototype,"readRenderer",null),jl=Eie=h([I("esri.layers.support.FeatureReductionBinning")],jl);const Uje=jl;var Cie;function lxe(t){var e;return t.type==="simple"&&!((e=t.visualVariables)!=null&&e.length)}let Ro=Cie=class extends Se{constructor(t){super(t),this.type="cluster",this.clusterRadius=wr("80px"),this.clusterMinSize=wr("12px"),this.clusterMaxSize=wr("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=[]}readRenderer(t,e,i){var s,n;const r=(s=e.drawingInfo)==null?void 0:s.renderer;return(n=r==null?void 0:r.authoringInfo)!=null&&n.isAutoGenerated?null:r?lxe(r)?null:AD(r,e,i)??void 0:_ce(e,i)}readSymbol(t,e,i){var s,n;const r=(s=e.drawingInfo)==null?void 0:s.renderer;if((n=r==null?void 0:r.authoringInfo)!=null&&n.isAutoGenerated)return null;if(r&&lxe(r)){const o=AD(r,e,i);return o==null?void 0:o.symbol}return null}writeSymbol(t,e,i,r){var n,o;const s=(o=(n=this.renderer)==null?void 0:n.authoringInfo)==null?void 0:o.isAutoGenerated;if(!this.renderer||s){const a=new qO({symbol:t});e.drawingInfo={renderer:a.write({},r)}}}writeFields(t,e,i){const r=t.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());ua(i,r,e)}readFields(t,e,i){return t.filter(r=>!r.isAutoGenerated).map(r=>I2.fromJSON(r))}clone(){return new Cie({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:re(this.labelingInfo),labelsVisible:this.labelsVisible,fields:re(this.fields),maxScale:this.maxScale,renderer:re(this.renderer),symbol:re(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:re(this.popupTemplate)})}};h([p({type:["cluster"],readOnly:!0,json:{write:!0}})],Ro.prototype,"type",void 0),h([p({type:Number,cast:t=>t==="auto"?t:wr(t),json:{write:!0}})],Ro.prototype,"clusterRadius",void 0),h([p({type:Number,cast:wr,json:{write:!0}})],Ro.prototype,"clusterMinSize",void 0),h([p({type:Number,cast:wr,json:{write:!0}})],Ro.prototype,"clusterMaxSize",void 0),h([p({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Ro.prototype,"maxScale",void 0),h([p(mce)],Ro.prototype,"popupEnabled",void 0),h([p({type:nN,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Ro.prototype,"popupTemplate",void 0),h([p({types:q8,json:{write:{target:"drawingInfo.renderer"}}})],Ro.prototype,"renderer",void 0),h([ze("renderer",["drawingInfo.renderer"])],Ro.prototype,"readRenderer",null),h([p({types:Ult})],Ro.prototype,"symbol",void 0),h([ze("symbol",["drawingInfo.renderer"])],Ro.prototype,"readSymbol",null),h([Ze("symbol")],Ro.prototype,"writeSymbol",null),h([p({type:[W8],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Ro.prototype,"labelingInfo",void 0),h([p(gce)],Ro.prototype,"labelsVisible",void 0),h([p({type:[I2],json:{write:!0}})],Ro.prototype,"fields",void 0),h([Ze("fields")],Ro.prototype,"writeFields",null),h([ze("fields")],Ro.prototype,"readFields",null),Ro=Cie=h([I("esri.layers.support.FeatureReductionCluster")],Ro);const Vje=Ro;var Mie;let ez=Mie=class extends Rb{constructor(t){super(t),this.type="selection"}clone(){return new Mie}};h([p({type:["selection"]})],ez.prototype,"type",void 0),ez=Mie=h([I("esri.layers.support.FeatureReductionSelection")],ez);const cxe=ez,uxe={key:"type",base:Rb,typeMap:{cluster:Vje,binning:Uje}},y8t={types:{key:"type",base:Rb,typeMap:{selection:cxe,cluster:Vje,binning:Uje}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:uxe},"portal-item":{types:uxe},"web-scene":{types:{key:"type",base:Rb,typeMap:{selection:cxe}},name:"layerDefinition.featureReduction",write:{layerContainerTypes:Ba}}}}},wC={Base64:0,Hex:1,String:2,Raw:3},JA=8,zje=(1<<JA)-1;function db(t,e){const i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function _8t(t){const e=[];for(let i=0,r=t.length*JA;i<r;i+=JA)e[i>>5]|=(t.charCodeAt(i/JA)&zje)<<i%32;return e}function v8t(t){const e=[];for(let i=0,r=32*t.length;i<r;i+=JA)e.push(String.fromCharCode(t[i>>5]>>>i%32&zje));return e.join("")}function b8t(t){const e="0123456789abcdef",i=[];for(let r=0,s=4*t.length;r<s;r++)i.push(e.charAt(t[r>>2]>>r%4*8+4&15)+e.charAt(t[r>>2]>>r%4*8&15));return i.join("")}function w8t(t){const e="=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=[];for(let s=0,n=4*t.length;s<n;s+=3){const o=(t[s>>2]>>s%4*8&255)<<16|(t[s+1>>2]>>(s+1)%4*8&255)<<8|t[s+2>>2]>>(s+2)%4*8&255;for(let a=0;a<4;a++)8*s+6*a>32*t.length?r.push(e):r.push(i.charAt(o>>6*(3-a)&63))}return r.join("")}function x8t(t,e){return t<<e|t>>>32-e}function Z8(t,e,i,r,s,n){return db(x8t(db(db(e,t),db(r,n)),s),i)}function Ll(t,e,i,r,s,n,o){return Z8(e&i|~e&r,t,e,s,n,o)}function Dl(t,e,i,r,s,n,o){return Z8(e&r|i&~r,t,e,s,n,o)}function Nl(t,e,i,r,s,n,o){return Z8(e^i^r,t,e,s,n,o)}function Fl(t,e,i,r,s,n,o){return Z8(i^(e|~r),t,e,s,n,o)}function T8t(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let i=1732584193,r=-271733879,s=-1732584194,n=271733878;for(let o=0;o<t.length;o+=16){const a=i,l=r,c=s,u=n;i=Ll(i,r,s,n,t[o],7,-680876936),n=Ll(n,i,r,s,t[o+1],12,-389564586),s=Ll(s,n,i,r,t[o+2],17,606105819),r=Ll(r,s,n,i,t[o+3],22,-1044525330),i=Ll(i,r,s,n,t[o+4],7,-176418897),n=Ll(n,i,r,s,t[o+5],12,1200080426),s=Ll(s,n,i,r,t[o+6],17,-1473231341),r=Ll(r,s,n,i,t[o+7],22,-45705983),i=Ll(i,r,s,n,t[o+8],7,1770035416),n=Ll(n,i,r,s,t[o+9],12,-1958414417),s=Ll(s,n,i,r,t[o+10],17,-42063),r=Ll(r,s,n,i,t[o+11],22,-1990404162),i=Ll(i,r,s,n,t[o+12],7,1804603682),n=Ll(n,i,r,s,t[o+13],12,-40341101),s=Ll(s,n,i,r,t[o+14],17,-1502002290),r=Ll(r,s,n,i,t[o+15],22,1236535329),i=Dl(i,r,s,n,t[o+1],5,-165796510),n=Dl(n,i,r,s,t[o+6],9,-1069501632),s=Dl(s,n,i,r,t[o+11],14,643717713),r=Dl(r,s,n,i,t[o],20,-373897302),i=Dl(i,r,s,n,t[o+5],5,-701558691),n=Dl(n,i,r,s,t[o+10],9,38016083),s=Dl(s,n,i,r,t[o+15],14,-660478335),r=Dl(r,s,n,i,t[o+4],20,-405537848),i=Dl(i,r,s,n,t[o+9],5,568446438),n=Dl(n,i,r,s,t[o+14],9,-1019803690),s=Dl(s,n,i,r,t[o+3],14,-187363961),r=Dl(r,s,n,i,t[o+8],20,1163531501),i=Dl(i,r,s,n,t[o+13],5,-1444681467),n=Dl(n,i,r,s,t[o+2],9,-51403784),s=Dl(s,n,i,r,t[o+7],14,1735328473),r=Dl(r,s,n,i,t[o+12],20,-1926607734),i=Nl(i,r,s,n,t[o+5],4,-378558),n=Nl(n,i,r,s,t[o+8],11,-2022574463),s=Nl(s,n,i,r,t[o+11],16,1839030562),r=Nl(r,s,n,i,t[o+14],23,-35309556),i=Nl(i,r,s,n,t[o+1],4,-1530992060),n=Nl(n,i,r,s,t[o+4],11,1272893353),s=Nl(s,n,i,r,t[o+7],16,-155497632),r=Nl(r,s,n,i,t[o+10],23,-1094730640),i=Nl(i,r,s,n,t[o+13],4,681279174),n=Nl(n,i,r,s,t[o],11,-358537222),s=Nl(s,n,i,r,t[o+3],16,-722521979),r=Nl(r,s,n,i,t[o+6],23,76029189),i=Nl(i,r,s,n,t[o+9],4,-640364487),n=Nl(n,i,r,s,t[o+12],11,-421815835),s=Nl(s,n,i,r,t[o+15],16,530742520),r=Nl(r,s,n,i,t[o+2],23,-995338651),i=Fl(i,r,s,n,t[o],6,-198630844),n=Fl(n,i,r,s,t[o+7],10,1126891415),s=Fl(s,n,i,r,t[o+14],15,-1416354905),r=Fl(r,s,n,i,t[o+5],21,-57434055),i=Fl(i,r,s,n,t[o+12],6,1700485571),n=Fl(n,i,r,s,t[o+3],10,-1894986606),s=Fl(s,n,i,r,t[o+10],15,-1051523),r=Fl(r,s,n,i,t[o+1],21,-2054922799),i=Fl(i,r,s,n,t[o+8],6,1873313359),n=Fl(n,i,r,s,t[o+15],10,-30611744),s=Fl(s,n,i,r,t[o+6],15,-1560198380),r=Fl(r,s,n,i,t[o+13],21,1309151649),i=Fl(i,r,s,n,t[o+4],6,-145523070),n=Fl(n,i,r,s,t[o+11],10,-1120210379),s=Fl(s,n,i,r,t[o+2],15,718787259),r=Fl(r,s,n,i,t[o+9],21,-343485551),i=db(i,a),r=db(r,l),s=db(s,c),n=db(n,u)}return[i,r,s,n]}function Bje(t,e=wC.Hex){const i=e||wC.Base64,r=T8t(_8t(t),t.length*JA);switch(i){case wC.Raw:return r;case wC.Hex:return b8t(r);case wC.String:return v8t(r);case wC.Base64:return w8t(r)}}const S8t=()=>ne.getLogger("esri.views.2d.layers.support.clusterUtils");ue.add("esri-cluster-arcade-enabled",!0);const E8t=ue("esri-cluster-arcade-enabled"),C8t=new Set(["simple-line","simple-fill","picture-fill"]);function hxe(t,e){let i=e.clone();if(!M8t(i))return i;if(e.getSymbols().some(r=>C8t.has(r.type))&&(i=new qO({symbol:new Oy})),i.authoringInfo||(i.authoringInfo=new lce),i.authoringInfo.isAutoGenerated=!0,"visualVariables"in i){const r=(i.visualVariables||[]).filter(s=>s.valueExpression!=="$view.scale");r.forEach(s=>{s.type==="rotation"?s.field?s.field=Mx(t,s.field,"avg_angle","number"):s.valueExpression&&(s.field=nR(t,s.valueExpression,"avg_angle","number"),s.valueExpression=null):s.normalizationField?(s.field=Mx(t,s.field,"avg_norm","number",s.normalizationField),s.normalizationField=null):s.field?s.field=Mx(t,s.field,"avg","number"):s.valueExpression&&(s.field=nR(t,s.valueExpression,"avg","number"),s.valueExpression=null)}),i.visualVariables=r}switch(i.type){case"simple":break;case"pie-chart":for(const r of i.attributes)r.field?r.field=Mx(t,r.field,"sum","number"):r.valueExpression&&(r.field=nR(t,r.valueExpression,"sum","number"),r.valueExpression=null);break;case"unique-value":i.field?i.field=Mx(t,i.field,"mode","string"):i.valueExpression&&(i.field=nR(t,i.valueExpression,"mode","string"),i.valueExpression=null);break;case"class-breaks":i.normalizationField?(i.field=Mx(t,i.field,"avg_norm","number",i.normalizationField),i.normalizationField=null):i.field?i.field=Mx(t,i.field,"avg","number"):i.valueExpression&&(i.field=nR(t,i.valueExpression,"avg","number"),i.valueExpression=null)}return i}const M8t=t=>{const e=i=>S8t().error(new B("Unsupported-renderer",i,{renderer:t}));if(!t)return!1;switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const i=t.normalizationType;if(i!=="field")return e(`FeatureReductionCluster does not support a normalizationType of ${i}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!E8t){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some(i=>!(!("valueExpression"in i)||!i.valueExpression)))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function A8t(t,e,i){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const r=i,s="field",n=e.toLowerCase()+",norm:"+s+","+r.toLowerCase();return"cluster_avg_"+Bje(n)}}}function nR(t,e,i,r){const s=Bje(e),n=i==="mode"?`cluster_type_${s}`:i==="sum"?`cluster_sum_${s}`:`cluster_avg_${s}`;return t.some(o=>o.name===n)||t.push(new I2({name:n,isAutoGenerated:!0,onStatisticExpression:new vce({expression:e,returnType:r}),statisticType:i})),n}function Mx(t,e,i,r,s){if(e==="cluster_count"||t.some(o=>o.name===e))return e;const n=A8t(i,e,s);return t.some(o=>o.name===n)||(i==="avg_norm"?t.push(new I2({name:n,isAutoGenerated:!0,onStatisticExpression:new vce({expression:`$feature.${e} / $feature.${s}`,returnType:r}),statisticType:"avg"})):t.push(new I2({name:n,isAutoGenerated:!0,onStatisticField:e,statisticType:i}))),n}const P8t=t=>{let e=class extends t{constructor(...i){super(...i),this.addHandles(te(()=>this.renderer,()=>{if(this.featureReduction){const r=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",r)}},lr))}set featureReduction(i){const r=this._normalizeFeatureReduction(i);this._set("featureReduction",r)}set renderer(i){}_withClusterVariable(i,r,s){const n=i.clone();return"visualVariables"in n&&(n.visualVariables||(n.visualVariables=[]),n.visualVariables.some(o=>o.type==="size")||n.visualVariables.push(new cce({field:"cluster_count",stops:[new UV({value:1}),new UV({useMinValue:!0,size:r}),new UV({useMaxValue:!0,size:s})]}))),n}_normalizeFeatureReduction(i){var d;if((i==null?void 0:i.type)!=="cluster")return i;const r=i.clone(),s=[new I2({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],n=(r.fields??[]).filter(f=>!f.isAutoGenerated),o=i.renderer&&!((d=i.renderer.authoringInfo)!=null&&d.isAutoGenerated),{clusterMinSize:a,clusterMaxSize:l}=r;if(o){r.fields=[...s,...n];const f=this._withClusterVariable(r.renderer,a,l);return r.effectiveFeatureRenderer=f,r.effectiveClusterRenderer=f,r}if(i.symbol){if(r.fields=[...s,...n],r.renderer=null,!this.renderer)return r.effectiveFeatureRenderer=null,r.effectiveClusterRenderer=null,r;const f=hxe(s,this.renderer),m=this._withClusterVariable(f,a,l),g="visualVariables"in m&&m.visualVariables?m.visualVariables:[],y=new qO({symbol:i.symbol,visualVariables:g});return r.fields=[...s,...n],r.effectiveFeatureRenderer=m,r.effectiveClusterRenderer=y,r}if(!this.renderer)return i;const c=hxe(s,this.renderer);r.fields=[...s,...n],r.renderer=c;const u=this._withClusterVariable(c,a,l);return r.effectiveFeatureRenderer=u,r.effectiveClusterRenderer=u,r}};return h([p(y8t)],e.prototype,"featureReduction",null),e=h([I("esri.layers.mixins.FeatureReductionLayer")],e),e},dxe={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GeoRSS:!0,GroupLayer:!0,KML:!0,KnowledgeGraphLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},pxe={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0},fxe={ArcGISFeatureLayer:!0,SubtypeGroupTable:!0},O8t={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,CatalogLayer:!0,CSV:!0,GeoJSON:!0,GroupLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,KML:!0,LineOfSightLayer:!0,MediaLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,RasterDataLayer:!0,VectorTileLayer:!0,Voxel:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-scene/basemap":{ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-scene/tables":{ArcGISFeatureLayer:!0},"web-map/operational-layers":dxe,"web-map/basemap":pxe,"web-map/tables":fxe,"link-chart/operational-layers":{...dxe,LinkChartLayer:!0},"link-chart/basemap":pxe,"link-chart/tables":fxe,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,BuildingSceneLayer:!0,IntegratedMesh3DTilesLayer:!0,IntegratedMeshLayer:!0,MediaLayer:!0,OrientedImageryLayer:!0,PointCloudLayer:!0,SubtypeGroupLayer:!0}},$8t=t=>{let e=class extends t{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId(i,r,s){var n;return((n=s==null?void 0:s.portalItem)==null?void 0:n.type)==="Group Layer"?void 0:i}writeListMode(i,r,s,n){(n&&n.layerContainerType==="ground"||i&&HWe(this,s,{},n))&&(r[s]=i)}writeOperationalLayerType(i,r,s,n){i&&(n==null?void 0:n.layerContainerType)!=="tables"&&(r.layerType=i)}writeTitle(i,r){r.title=i??"Layer"}readTimeExtent(i){return i?za.fromArray(i):null}writeTimeExtent(i,r,s,n){i&&n.layerContainerType!=="tables"&&(i.isEmpty?n!=null&&n.messages&&n.messages.push(new B("layer:invalid-visibilityTimeExtent","visibilityTimeExtent cannot be empty")):r[s]=i.toArray())}read(i,r){r&&(r.layer=this),TEe(this,i,s=>super.read(i,s),r)}write(i,r){var o,a;if(!this.persistenceEnabled&&!(r!=null&&r.ignorePersistenceEnabled))return null;if(r!=null&&r.origin){const l=`${r.origin}/${r.layerContainerType||"operational-layers"}`,c=O8t[l];let u=!!(c!=null&&c[this.operationalLayerType]);if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(u=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&l==="web-map/operational-layers"&&(u=!1),!u)return(o=r.messages)==null||o.push(new B("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const s=super.write(i,{...r,layer:this}),n=!!r&&!!r.messages&&!!r.messages.filter(l=>l instanceof B&&l.name==="web-document-write:property-required").length;return rP(s==null?void 0:s.url)?((a=r==null?void 0:r.messages)==null||a.push(new B("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return h([p({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),h([ze("id",["id"])],e.prototype,"readId",null),h([p(Oje)],e.prototype,"listMode",void 0),h([Ze("listMode")],e.prototype,"writeListMode",null),h([p({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:Ba}}}}})],e.prototype,"operationalLayerType",void 0),h([Ze("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),h([p(vie)],e.prototype,"opacity",void 0),h([p({type:Boolean,readOnly:!1})],e.prototype,"persistenceEnabled",void 0),h([p({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),h([Ze("title"),Ze(["web-scene"],"title")],e.prototype,"writeTitle",null),h([p({type:za,json:{origins:{"web-scene":{write:{layerContainerTypes:Ba}}}}})],e.prototype,"visibilityTimeExtent",void 0),h([ze("visibilityTimeExtent")],e.prototype,"readTimeExtent",null),h([Ze(["portal-item","web-map","web-scene"],"visibilityTimeExtent",{visibilityTimeExtent:{type:[[Ji,mO]]}})],e.prototype,"writeTimeExtent",null),h([p({type:Boolean,json:{origins:{"web-scene":{name:"visibility",write:{enabled:!0,layerContainerTypes:Ba}}},name:"visibility",write:!0}})],e.prototype,"visible",void 0),e=h([I("esri.layers.mixins.OperationalLayer")],e),e};var Aie;const mk=new Qi({asc:"ascending",desc:"descending"});let MM=Aie=class extends Se{constructor(t){super(t),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new Aie({field:this.field,valueExpression:this.valueExpression,order:this.order})}};h([p({type:String,json:{write:!0}})],MM.prototype,"field",void 0),h([p({type:String,json:{write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],MM.prototype,"valueExpression",void 0),h([p({type:mk.apiValues,json:{type:mk.jsonValues,read:mk.read,write:mk.write}})],MM.prototype,"order",void 0),MM=Aie=h([I("esri.layers.support.OrderByInfo")],MM);const jje=MM;function R8t(t,e,i){if(!t)return null;const r=t.find(n=>!!n.field);if(!r)return null;const s=new jje;return s.read(r,i),[s]}function I8t(t,e,i,r){const s=t.find(n=>!!n.field);s&&ua(i,[s.toJSON()],e)}const L8t={type:[jje],json:{origins:{"web-scene":{write:!1,read:!1}},name:"layerDefinition.orderBy",read:{reader:R8t},write:{writer:I8t}}},D8t=t=>{let e=class extends t{constructor(){super(...arguments),this.orderBy=null}};return h([p(L8t)],e.prototype,"orderBy",void 0),e=h([I("esri.layers.mixins.OrderedLayer")],e),e},N8t=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=He(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(i){i!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",i))}readPortalItem(i,r,s){if(r.itemId)return new AS({id:r.itemId,portal:s==null?void 0:s.portal})}writePortalItem(i,r){i!=null&&i.id&&(r.itemId=i.id)}async loadFromPortal(i,r){var s;if((s=this.portalItem)!=null&&s.id)try{const{load:n}=await oe(()=>import("./layersLoader-D9iTedwj.js"),__vite__mapDeps([230,9,7,8,6]));return Dt(r),await n({instance:this,supportedTypes:i.supportedTypes,validateItem:i.validateItem,supportsData:i.supportsData,layerModuleTypeMap:i.layerModuleTypeMap},r)}catch(n){throw us(n)||ne.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${n}`),n}}async finishLoadEditablePortalLayer(i){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(i).catch(r=>(Ql(r),!0)))}async setUserPrivileges(i,r){if(!nr.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(r);if(this.url)try{const{features:{edit:s,fullEdit:n},content:{updateItem:o}}=await this._fetchUserPrivileges(i,r);this._set("userHasEditingPrivileges",s),this._set("userHasFullEditingPrivileges",n),this._set("userHasUpdateItemPrivileges",o)}catch(s){Ql(s)}}async _fetchUserPrivileges(i,r){let s=this.portalItem;if(!i||!s||!s.loaded||s.sourceUrl)return this._fetchFallbackUserPrivileges(r);const n=i===s.id;if(n&&s.portal.user)return Sde(s);let o,a;if(n)o=s.portal.url;else try{o=await TCe(this.url,r)}catch(d){Ql(d)}if(!o||!cZe(o,s.portal.url))return this._fetchFallbackUserPrivileges(r);try{const d=r!=null?r.signal:null;a=await(Ci==null?void 0:Ci.getCredential(`${o}/sharing`,{prompt:!1,signal:d}))}catch(d){Ql(d)}const l=!0,c=!1,u=!1;if(!a)return{features:{edit:l,fullEdit:c},content:{updateItem:u}};try{if(n?await s.reload():(s=new AS({id:i,portal:{url:o}}),await s.load(r)),s.portal.user)return Sde(s)}catch(d){Ql(d)}return{features:{edit:l,fullEdit:c},content:{updateItem:u}}}async _fetchFallbackUserPrivileges(i){let r=!0;try{r=await this._fetchUserHasEditingPrivileges(i)}catch(s){Ql(s)}return{features:{edit:r,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(i){const r=this.url?Ci==null?void 0:Ci.findCredential(this.url):null;if(!r)return!0;const s=gk.credential===r?gk.user:await this._fetchEditingUser(i);return gk.credential=r,gk.user=s,(s==null?void 0:s.privileges)==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(i){var u,d;const r=(d=(u=this.portalItem)==null?void 0:u.portal)==null?void 0:d.user;if(r)return r;const s=Ci==null?void 0:Ci.findServerInfo(this.url??"");if(!(s!=null&&s.owningSystemUrl))return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=Kn.getDefault();if(o&&o.loaded&&lp(o.restUrl)===lp(n))return o.user;const a=`${n}/community/self`,l=i!=null?i.signal:null,c=await Qh(fr(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?ese.fromJSON(c.value.data):null}read(i,r){r&&(r.layer=this),super.read(i,r)}write(i,r){var o;const s=r==null?void 0:r.portal,n=((o=this.portalItem)==null?void 0:o.id)&&(this.portalItem.portal||Kn.getDefault());return s&&n&&!$Ee(n.restUrl,s.restUrl)?(r.messages&&r.messages.push(new B("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(i,{...r,layer:this})}};return h([p({type:AS})],e.prototype,"portalItem",null),h([ze("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),h([Ze("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),h([p({clonable:!1})],e.prototype,"resourceReferences",void 0),h([p({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),h([p({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),h([p({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=h([I("esri.layers.mixins.PortalLayer")],e),e},gk={credential:null,user:null};let u3=class extends Ue{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};h([p()],u3.prototype,"updating",void 0),h([p()],u3.prototype,"status",void 0),u3=h([I("esri.layers.support.PublishingInfo")],u3);const F8t=u3,k8t=Symbol(),U8t=t=>{var e;let i=class extends t{constructor(){super(...arguments),this[e]=!0}get publishingInfo(){if(this.destroyed)return null;const r=this._get("publishingInfo");if(r)return r;const s=new F8t;return this._checkPublishingStatus(s),s}_checkPublishingStatus(r){let o=0;const a=async c=>{let u;r.updating=!0;try{u=await this.fetchPublishingStatus()}catch{u="unavailable"}u!=="published"&&u!=="unavailable"||(r.status==="publishing"&&this.refresh(),l.remove()),r.status=u,r.updating=!1,l.removed||(o=setTimeout(a,c,c+125))},l={removed:!1,remove(){this.removed=!0,clearTimeout(o)}};this.when().catch(()=>l.remove()),a(250),this.addHandles(l)}};return e=k8t,h([p({readOnly:!0,clonable:!1})],i.prototype,"publishingInfo",null),i=h([I("esri.layers.mixins.PublishableLayer")],i),i},pb=new Ke,gL=new WeakMap;function V8t(t){B8t(t)&&pb.push(new WeakRef(t))}function z8t(t){const e=pb.find(i=>i.deref()===t);e&&pb.remove(e)}function B8t(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function Gje(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:Gje(e,t%e):0}let zW=0,yk=0;function j8t(){const t=Date.now();let e=!1;for(const i of pb){const r=i.deref();r?r.refreshInterval&&t-(gL.get(r)??0)+5>=6e4*r.refreshInterval&&(gL.set(r,t),r.refresh(t)):e=!0}if(e)for(let i=pb.length-1;i>=0;i--)pb.at(i).deref()||pb.removeAt(i)}Q2e(()=>{const t=Date.now();let e=0;for(const i of pb){const r=i.deref();r&&(e=Gje(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?gL.get(r)||gL.set(r,t):gL.delete(r))}if(e!==yk){if(yk=e,clearInterval(zW),yk===0)return void(zW=0);zW=setInterval(j8t,yk)}});function Smi(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const mxe=.1,G8t=t=>{let e=class extends t{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=d_(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||V8t(this)},()=>{})}destroy(){z8t(this)}castRefreshInterval(i){return i>=mxe?i:i<=0?0:mxe}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){h_(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{ne.getLogger(this).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}get test(){}};return h([p({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:Ba}}}}})],e.prototype,"refreshInterval",void 0),h([Qt("refreshInterval")],e.prototype,"castRefreshInterval",null),h([p({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),h([p({readOnly:!0})],e.prototype,"refreshParameters",null),e=h([I("esri.layers.mixins.RefreshableLayer")],e),e},H8t=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const i={minScale:this.minScale,maxScale:this.maxScale},r=this.parent;r&&"effectiveScaleRange"in r&&q8t(i,r.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===i.minScale&&s.maxScale===i.maxScale?s:i}};return h([p({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),h([p({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),h([p({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=h([I("esri.layers.mixins.ScaleRangeLayer")],e),e};function q8t(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}function gxe(t,e){return xP.fromJSON({value:t,unit:e})}let el=class extends ts(Se){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeZone=null,this.trackIdField=null,this.useTime=!0,this.stops=null}readFullTimeExtent(e,i){return i.timeExtent&&Array.isArray(i.timeExtent)&&i.timeExtent.length===2?za.fromArray(i.timeExtent):null}writeFullTimeExtent(e,i){(e==null?void 0:e.start)!=null&&e.end!=null?i.timeExtent=e.toArray():i.timeExtent=null}readInterval(e,i){return i.timeInterval&&i.timeIntervalUnits?gxe(i.timeInterval,i.timeIntervalUnits):i.defaultTimeInterval&&i.defaultTimeIntervalUnits?gxe(i.defaultTimeInterval,i.defaultTimeIntervalUnits):null}writeInterval(e,i){i.timeInterval=(e==null?void 0:e.toJSON().value)??null,i.timeIntervalUnits=(e==null?void 0:e.toJSON().unit)??null}};h([p({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],el.prototype,"cumulative",void 0),h([p({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],el.prototype,"endField",void 0),h([p({type:za,json:{write:{enabled:!0,allowNull:!0}}})],el.prototype,"fullTimeExtent",void 0),h([ze("fullTimeExtent",["timeExtent"])],el.prototype,"readFullTimeExtent",null),h([Ze("fullTimeExtent")],el.prototype,"writeFullTimeExtent",null),h([p({type:Boolean,json:{write:!0}})],el.prototype,"hasLiveData",void 0),h([p({type:xP,json:{write:{enabled:!0,allowNull:!0}}})],el.prototype,"interval",void 0),h([ze("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],el.prototype,"readInterval",null),h([Ze("interval")],el.prototype,"writeInterval",null),h([p({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],el.prototype,"startField",void 0),h([p(fz("timeReference",!0))],el.prototype,"timeZone",void 0),h([p({type:String,json:{write:{enabled:!0,allowNull:!0}}})],el.prototype,"trackIdField",void 0),h([p({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],el.prototype,"useTime",void 0),h([p({type:[Date],json:{read:!1}})],el.prototype,"stops",void 0),el=h([I("esri.layers.support.TimeInfo")],el);const Hje=el,W8t={type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation",layerContainerTypes:Ba}}},Z8t=t=>{let e=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(i,r){const s=r.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=Ese.fromJSON(s.timeOffsetUnits);return n&&o?new xP({value:n,unit:o}):null}set timeInfo(i){m$e(i,this.fieldsIndex),this._set("timeInfo",i)}};return h([p({type:za,json:{write:!1}})],e.prototype,"timeExtent",void 0),h([p({type:xP})],e.prototype,"timeOffset",void 0),h([ze("service","timeOffset",["timeInfo.exportOptions"])],e.prototype,"readOffset",null),h([p({value:null,type:Hje,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"timeInfo",null),h([p(W8t)],e.prototype,"useViewTime",void 0),e=h([I("esri.layers.mixins.TemporalLayer")],e),e},yxe=new Qi({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let A1=class extends ts(Se){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};h([p({json:{write:!0}})],A1.prototype,"name",void 0),h([p({json:{write:!0}})],A1.prototype,"description",void 0),h([p({json:{read:yxe.read,write:yxe.write}})],A1.prototype,"drawingTool",void 0),h([p({json:{write:!0}})],A1.prototype,"prototype",void 0),h([p({json:{write:!0}})],A1.prototype,"thumbnail",void 0),A1=h([I("esri.layers.support.FeatureTemplate")],A1);const bce=A1;let V0=class extends ts(Se){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const i={};for(const r of Object.keys(e))i[r]=T6(e[r]);return i}writeDomains(e,i){var s;const r={};for(const n of Object.keys(e))e[n]&&(r[n]=(s=e[n])==null?void 0:s.toJSON());i.domains=r}};h([p({json:{write:!0}})],V0.prototype,"id",void 0),h([p({json:{write:!0}})],V0.prototype,"name",void 0),h([p({json:{write:!0}})],V0.prototype,"domains",void 0),h([ze("domains")],V0.prototype,"readDomains",null),h([Ze("domains")],V0.prototype,"writeDomains",null),h([p({type:[bce],json:{write:!0}})],V0.prototype,"templates",void 0),V0=h([I("esri.layers.support.FeatureType")],V0);const qje=V0;function Y8t(){return{fields:{type:[S6],value:null,set:function(t){if(t&&ue("big-integer-warning-enabled")){const e=t.filter(i=>i.type==="big-integer"||i.type==="oid"&&(i.length||0)>=8);if(e.length){const i=e.map(r=>`'${r.name}'`).join(", ");ne.getLogger(this).warn("#fields",`Layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}') references big-integer field(s): ${i}, support for which is experimental. Only integers less than ${Number.MAX_SAFE_INTEGER} (Number.MAX_SAFE_INTEGER) are supported.`)}}this._set("fields",t)}},fieldsIndex:{readOnly:!0,get(){return dje.fromLayer(this)}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){var e;const t=this._userOutFields;if(!(t!=null&&t.length))return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const i of t)((e=this.fieldsIndex)==null?void 0:e.has(i))||ne.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${i} found in outFields`,{layer:this,outFields:t});return fne(this.fieldsIndex,t)}}}}const BW=()=>ne.getLogger("esri.layers.support.labelingInfo"),X8t=/\[([^[\]]+)\]/gi;function jW(t,e,i){return t?t.map(r=>{var n;const s=new W8;if(s.read(r,i),s.labelExpression){const o=e.fields||((n=e.layerDefinition)==null?void 0:n.fields)||this.fields;s.labelExpression=s.labelExpression.replaceAll(X8t,(a,l)=>`[${J8t(l,o)}]`)}return s}):null}function J8t(t,e){if(!e)return t;const i=t.toLowerCase();for(let r=0;r<e.length;r++){const s=e[r].name;if(s.toLowerCase()===i)return s}return t}const Q8t={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along","above-along","below-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};function Ami(t,e){const i=[];for(const r of t){const s=r.labelPlacement,n=Q8t[e];if(!r.symbol)return BW().warn("No ILabelClass symbol specified."),[];if(!n)return BW().error(new B("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),[];if(n.includes(s))i.push(r);else{const o=n[0];s&&BW().warn(`Found invalid label placement type ${s} for ${e}. Defaulting to ${o}`);const a=r.clone();a.labelPlacement=o,i.push(a)}}return i}const AM=[];function K8t(t,e){if(pAe(t.url??""))return!0;const{wkid:i}=e;for(const r of AM){if((t.version??0)>=r[0])return!0;if(typeof r[1]=="function"&&(r[1]=r[1]()),r[1].has(i))return!1}return!0}AM.push([10.91,()=>{const t=new Set([9709,9716,9741,9761,9766]);for(let e=9712;e<=9713;e++)t.add(e);for(let e=9748;e<=9749;e++)t.add(e);for(let e=20904;e<=20932;e++)t.add(e);for(let e=21004;e<=21032;e++)t.add(e);for(let e=21207;e<=21264;e++)t.add(e);for(let e=21307;e<=21364;e++)t.add(e);for(let e=23301;e<=23333;e++)t.add(e);for(let e=102759;e<=102760;e++)t.add(e);for(let e=102934;e<=102955;e++)t.add(e);return t}]),AM.push([10.9,()=>{const t=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let e=9356;e<=9360;e++)t.add(e);for(let e=9404;e<=9407;e++)t.add(e);for(let e=9476;e<=9482;e++)t.add(e);for(let e=9487;e<=9494;e++)t.add(e);for(let e=9697;e<=9699;e++)t.add(e);return t}]),AM.push([10.81,()=>{const t=new Set([9265,9333,103598,103699]);for(let e=9248;e<=9254;e++)t.add(e);for(let e=9271;e<=9273;e++)t.add(e);for(let e=9284;e<=9285;e++)t.add(e);for(let e=21453;e<=21463;e++)t.add(e);return t}]),AM.push([10.8,()=>{const t=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let e=8035;e<=8036;e++)t.add(e);for(let e=8455;e<=8456;e++)t.add(e);for(let e=8518;e<=8529;e++)t.add(e);for(let e=8533;e<=8536;e++)t.add(e);for(let e=8538;e<=8540;e++)t.add(e);for(let e=8677;e<=8679;e++)t.add(e);for(let e=8902;e<=8903;e++)t.add(e);for(let e=8907;e<=8910;e++)t.add(e);for(let e=8949;e<=8951;e++)t.add(e);for(let e=8972;e<=8987;e++)t.add(e);for(let e=9039;e<=9040;e++)t.add(e);for(let e=9068;e<=9069;e++)t.add(e);for(let e=9140;e<=9141;e++)t.add(e);for(let e=9148;e<=9150;e++)t.add(e);for(let e=9153;e<=9159;e++)t.add(e);for(let e=9205;e<=9218;e++)t.add(e);for(let e=9221;e<=9222;e++)t.add(e);for(let e=54098;e<=54101;e++)t.add(e);return t}]),AM.push([10.71,()=>{const t=new Set([6316]);for(let e=8351;e<=8353;e++)t.add(e);for(let e=9294;e<=9297;e++)t.add(e);for(let e=22619;e<=22621;e++)t.add(e);for(let e=103586;e<=103594;e++)t.add(e);return t}]);async function eHt(t,e,i){const r=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(r&&r.type==="unique-value"&&r.styleOrigin){const s=await Qh(r.populateFromStyle());if(Dt(i),s.ok===!1){const n=s.error;e!=null&&e.messages&&e.messages.push(new fy("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:e})),t.clear("renderer",e==null?void 0:e.origin)}}}function tHt({displayField:t,editFieldsInfo:e,fields:i,objectIdField:r,title:s},n){if(!i)return null;const o=nHt({editFieldsInfo:e,fields:i,objectIdField:r},n);if(!o.length)return null;const a=lHt({titleBase:s,fields:i,displayField:t}),l=aHt();return new nN({title:a,content:l,fieldInfos:o})}const iHt=(t,e)=>e.visibleFieldNames?e.visibleFieldNames.has(t.name):vat(t,e);function rHt(t,e){const i=t;return e&&(t=t.filter(r=>!e.includes(r.type))),t===i&&(t=t.slice()),t.sort(sHt),t}function sHt(t,e){return t.type==="oid"?-1:e.type==="oid"?1:_xe(t)?-1:_xe(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function nHt(t,e){const i=e==null?void 0:e.visibleFieldNames;return rHt(t.fields??[],(e==null?void 0:e.ignoreFieldTypes)||cHt).map(r=>new sN({fieldName:r.name,isEditable:_at(r,t),label:r.alias,format:oHt(r),visible:iHt(r,{...t,visibleFieldNames:i})}))}function oHt(t){switch(t.type){case"small-integer":case"integer":case"single":return new pU({digitSeparator:!0,places:0});case"double":return new pU({digitSeparator:!0,places:2});case"string":return $X(t.name)?new pU({digitSeparator:!0,places:0}):void 0;default:return}}function aHt(){return[new LP,new qL]}function lHt(t){const e=lat(t),{titleBase:i}=t;return e?`${i}: {${e.trim()}}`:i??""}function _xe(t){var i;return(t.name&&t.name.toLowerCase())==="name"?!0:((i=t.alias)==null?void 0:i.toLowerCase())==="name"}const cHt=["geometry","blob","raster","guid","xml"],Tc="FeatureLayer";function _k(t,e){return new B("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}function vxe(t){return t&&t instanceof Ke}const GW=Y8t();function HW(t,e,i){const r=!!(i!=null&&i.writeLayerSchema);return{enabled:r,ignoreOrigin:r}}let Lt=class extends f8t(P8t(g6t(U8t(d6t(o6t(D8t(Z8t(H8t(G8t(r6t($8t(N8t(_se(a6t(i6t(ts(UL))))))))))))))))){constructor(...t){super(...t),this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.resourceInfo=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=Ye.WGS84,this.subtypeCode=null,this.supportedSourceTypes=new Set(["Feature Layer","Oriented Imagery Layer","Table","Catalog Layer"]),this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0,this._debouncedSaveOperations=d_(async(e,i,r)=>{const{save:s,saveAs:n}=await oe(()=>import("./featureLayerUtils-C4C-OlQV.js"),__vite__mapDeps([231,232,9]));switch(e){case jg.SAVE:return s(this,i);case jg.SAVE_AS:return n(this,r,i)}})}destroy(){var t;(t=this.source)==null||t.destroy()}normalizeCtorArgs(t,e){return typeof t=="string"?{url:t,...e}:t}load(t){var r;const e=t!=null?t.signal:null;if((r=this.portalItem)!=null&&r.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(e).then(s=>this.initLayerProperties(s))),Promise.resolve(this);const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"]},t).catch(Ql).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const s=await this._fetchFirstValidLayerId(e);s!=null&&(this.layerId=s)}if(!this.url&&!this._hasMemorySource())throw new B("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(e))}).then(()=>W6t(this,"load",t));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(t,e){return e=e.layerDefinition||e,Dje(e,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){var t;return!(this.loaded&&!((t=this.capabilities)!=null&&t.operations.supportsEditing))&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(t){this._overrideIfSome("editingEnabled",t)}readEditingEnabled(t,e){return this._readEditingEnabled(e,!1)}readEditingEnabledFromWebMap(t,e,i){return this._readEditingEnabled(e,!0,i)}writeEditingEnabled(t,e){this._writeEditingEnabled(t,e,!1)}writeEditingEnabledToWebMap(t,e,i,r){this._writeEditingEnabled(t,e,!0,r)}get effectiveEditingEnabled(){return Z6t(this)}readIsTable(t,e){return(e=(e==null?void 0:e.layerDefinition)??e).type==="Table"||!e.geometryType}writeIsTable(t,e,i,r){r!=null&&r.writeLayerSchema&&ua(i,t?"Table":"Feature Layer",e)}readGlobalIdField(t,e){return Rje(e.layerDefinition||e)}readObjectIdField(t,e){return Ije(e.layerDefinition||e)}get parsedUrl(){const t=gn(this.url);return t!=null&&(this.dynamicDataSource!=null?t.path=Jh(t.path,"dynamicLayer"):this.layerId!=null&&(t.path=Jh(t.path,this.layerId.toString()))),t}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(t){jpe(t,this.fieldsIndex),this._set("renderer",t)}readRenderer(t,e,i){var s;e=e.layerDefinition||e;const r=(s=e.drawingInfo)==null?void 0:s.renderer;if(r){const n=AD(r,e,i)??void 0;return n||ne.getLogger(this).error("Failed to create renderer",{rendererDefinition:e.drawingInfo.renderer,layer:this,context:i}),n}return _ce(e,i)}set source(t){const e=this._get("source");e!==t&&(vxe(e)&&this._resetMemorySource(e),vxe(t)&&this._initMemorySource(t),this._set("source",t))}castSource(t){return t?Array.isArray(t)||t instanceof Ke?new Z0({layer:this,items:t}):t:null}readSource(t,e){const i=nce.fromJSON(e.featureSet);return new Z0({layer:this,items:(i==null?void 0:i.features)??[]})}readTemplates(t,e){const i=e.editFieldsInfo,r=i==null?void 0:i.creatorField,s=i==null?void 0:i.editorField;return t=t==null?void 0:t.map(n=>bce.fromJSON(n)),this._fixTemplates(t,r),this._fixTemplates(t,s),t}readTitle(t,e){var s,n,o;const i=((s=e.layerDefinition)==null?void 0:s.name)??e.name,r=e.title||((n=e.layerDefinition)==null?void 0:n.title);if(i){const a=(o=this.portalItem)==null?void 0:o.title;if(this.sublayerTitleMode==="item-title")return this.url?aKe(this.url,i):i;let l=i;if(!l&&this.url){const c=TO(this.url);c!=null&&(l=c.title)}return l?(this.sublayerTitleMode==="item-title-and-service-name"&&a&&a!==l&&(l=a+" - "+l),Sse(l)):void 0}if(this.sublayerTitleMode==="item-title"&&r)return r}readTitleFromWebMap(t,e){var i;return e.title||((i=e.layerDefinition)==null?void 0:i.name)}readTypeIdField(t,e){let i=(e=e.layerDefinition||e).typeIdField;if(i&&e.fields){i=i.toLowerCase();const r=e.fields.find(s=>s.name.toLowerCase()===i);r&&(i=r.name)}return i}readTypes(t,e){t=(e=e.layerDefinition||e).types;const i=e.editFieldsInfo,r=i==null?void 0:i.creatorField,s=i==null?void 0:i.editorField;return t==null?void 0:t.map(n=>(n=qje.fromJSON(n),this._fixTemplates(n.templates,r),this._fixTemplates(n.templates,s),n))}readVisible(t,e){var i;return((i=e.layerDefinition)==null?void 0:i.defaultVisibility)!=null?!!e.layerDefinition.defaultVisibility:e.visibility!=null?!!e.visibility:void 0}async addAttachment(t,e){return O6t(this,t,e,Tc)}async updateAttachment(t,e,i){return $6t(this,t,e,i,Tc)}async applyEdits(t,e){return R6t(this,t,e)}async uploadAssets(t,e){return I6t(this,t,e)}on(t,e){return super.on(t,e)}createPopupTemplate(t){return tHt(this,t)}async createGraphicsSource(t){if(this._hasMemorySource()&&this.source)return this.source.load({signal:t});const{default:e}=await wre(oe(()=>import("./FeatureLayerSource-CtSSYK5X.js"),__vite__mapDeps([233,102,103,101,229,31,28,234,235,236])),t);return new e({layer:this,supportedSourceTypes:this.supportedSourceTypes}).load({signal:t})}createQuery(){const t=j6t(this);t.dynamicDataSource=this.dynamicDataSource;const e=this.subtypeCode!=null?`${this.subtypeField} = ${this.subtypeCode}`:null,i=qot(this.definitionExpression,e);return t.where=i||"1=1",t}async deleteAttachments(t,e){return L6t(this,t,e,Tc)}async fetchRecomputedExtents(t){return D6t(this,t,Tc)}getFeatureType(t){return J6t(this.types,this.typeIdField,t)}getFieldDomain(t,e){var n;const i=e==null?void 0:e.feature,r=H6t(this,i);if(r){const o=(n=r.domains)==null?void 0:n[t];return(o==null?void 0:o.type)==="inherited"?this._getLayerDomain(t):o}const s=this.getFeatureType(i);if(s){const o=s.domains&&s.domains[t];if(o&&o.type!=="inherited")return o}return this._getLayerDomain(t)}getField(t){return this.fieldsIndex.get(t)}async queryAttachments(t,e){return N6t(this,t,e,Tc)}async queryFeatures(t,e){const i=await this.load(),r=await i.source.queryFeatures(qh.from(t)??i.createQuery(),e);if(r!=null&&r.features)for(const s of r.features)s.layer=s.sourceLayer=i;return r}async queryObjectIds(t,e){return F6t(this,t,e,Tc)}async queryFeatureCount(t,e){return k6t(this,t,e,Tc)}async queryExtent(t,e){return U6t(this,t,e,Tc)}async queryRelatedFeatures(t,e){return V6t(this,t,e,Tc)}async queryRelatedFeaturesCount(t,e){return z6t(this,t,e,Tc)}async queryTopFeatures(t,e){var n;const{source:i,capabilities:r}=await this.load();if(!i.queryTopFeatures||!((n=r==null?void 0:r.query)!=null&&n.supportsTopFeaturesQuery))throw new B(Tc,"Layer source does not support queryTopFeatures capability");const s=await i.queryTopFeatures(sk.from(t),e);if(s!=null&&s.features)for(const o of s.features)o.layer=o.sourceLayer=this;return s}async queryTopObjectIds(t,e){const{source:i,capabilities:r}=await this.load();if(!i.queryTopObjectIds||!(r!=null&&r.query.supportsTopFeaturesQuery))throw new B(Tc,"Layer source does not support queryTopObjectIds capability");return i.queryTopObjectIds(sk.from(t),e)}async queryTopFeaturesExtent(t,e){var s;const{source:i,capabilities:r}=await this.load();if(!i.queryTopExtents||!((s=r==null?void 0:r.query)!=null&&s.supportsTopFeaturesQuery))throw new B(Tc,"Layer source does not support queryTopExtents capability");return i.queryTopExtents(sk.from(t),e)}async queryTopFeatureCount(t,e){var s;const{source:i,capabilities:r}=await this.load();if(!i.queryTopCount||!((s=r==null?void 0:r.query)!=null&&s.supportsTopFeaturesQuery))throw new B(Tc,"Layer source does not support queryFeatureCount capability");return i.queryTopCount(sk.from(t),e)}read(t,e){const i=t.featureCollection;if((i||t.type==="Feature Collection")&&(this.resourceInfo=t),i){const r=i.layers;r&&r.length===1&&(super.read(r[0],e),i.showLegend!=null&&super.read({showLegend:i.showLegend},e))}super.read(t,e),e&&e.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo","dateFieldsTimeZone"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(t,e){e={...e,origin:(e==null?void 0:e.origin)??void 0,writeLayerSchema:(e==null?void 0:e.writeLayerSchema)??this._hasMemorySource()};const{origin:i,layerContainerType:r,messages:s}=e;if(this.dynamicDataSource)return s==null||s.push(_k(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if((i==="web-map"||i==="web-scene")&&r!=="tables")return s==null||s.push(_k(this,`a table source can only be written to tables, not ${r}`)),null;if(this._hasMemorySource())return s==null||s.push(_k(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&(i==="web-map"||i==="web-scene")&&r==="tables")return s==null||s.push(_k(this,"using a non-table source cannot be written to tables in web maps or web scenes")),null;return super.write(t,e)}clone(){if(this._hasMemorySource())throw new B(Tc,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(t){var e;return!!this.loaded&&(((e=this.source)==null?void 0:e.type)==="memory"||K8t(this,t))}async save(t){return this._debouncedSaveOperations(jg.SAVE,t)}async saveAs(t,e){return this._debouncedSaveOperations(jg.SAVE_AS,e,t)}_readEditingEnabled(t,e,i){var s;let r=(s=t.layerDefinition)==null?void 0:s.capabilities;return r?this._hasEditingCapability(r):(r=t.capabilities,e&&(i==null?void 0:i.origin)==="web-map"&&!this._hasMemorySource()&&r?this._hasEditingCapability(r):void 0)}_hasEditingCapability(t){return t.toLowerCase().split(",").map(e=>e.trim()).includes("editing")}_writeEditingEnabled(t,e,i,r){var s,n;if(!t){const o=(n=(s=this.capabilities)==null?void 0:s.operations)!=null&&n.supportsSync?"Query,Sync":"Query";ua("layerDefinition.capabilities",o,e),i&&!(r!=null&&r.writeLayerSchema)&&(e.capabilities=o)}}_getLayerDomain(t){const e=this.fieldsIndex.get(t);return e?e.domain:null}_fetchFirstValidLayerId(t){return fr(this.url??"",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:t}).then(e=>{const i=e.data;if(i)return this.findFirstValidLayerId(i)})}async initLayerProperties(t){var e;return this._set("source",t),t.sourceJSON&&(this.sourceJSON=t.sourceJSON,this.read(t.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:(e=this.portalItem)==null?void 0:e.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),jpe(this.renderer,this.fieldsIndex),m$e(this.timeInfo,this.fieldsIndex),eHt(this,{origin:"service"})}async hasDataChanged(){return B6t(this)}async fetchPublishingStatus(){const t=this.source;return t!=null&&t.fetchPublishingStatus?t.fetchPublishingStatus():"unavailable"}_verifyFields(){var e,i;const t=((e=this.parsedUrl)==null?void 0:e.path)??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+t+")"),this.isTable||this._hasMemorySource()||t.search(/\/FeatureServer\//i)!==-1||(i=this.fields)!=null&&i.some(r=>r.type==="geometry")||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+t+")")}_fixTemplates(t,e){t&&t.forEach(i=>{var s;const r=(s=i.prototype)==null?void 0:s.attributes;r&&e&&delete r[e]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new B("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new B("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(t){t.forEach(e=>{e.layer=this,e.sourceLayer=this}),this.addHandles([t.on("after-add",e=>{e.item.layer=this,e.item.sourceLayer=this}),t.on("after-remove",e=>{e.item.layer=null,e.item.sourceLayer=null})],"fl-source")}_resetMemorySource(t){t.forEach(e=>{e.layer=null,e.sourceLayer=null}),this.removeHandles("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}findFirstValidLayerId(t){return Array.isArray(t.layers)&&t.layers.length>0?t.layers[0].id:Array.isArray(t.tables)&&t.tables.length>0?t.tables[0].id:void 0}};h([ze("service","capabilities")],Lt.prototype,"readCapabilities",null),h([p({json:{origins:{"web-scene":{write:!1}},write:!0}})],Lt.prototype,"charts",void 0),h([p({readOnly:!0})],Lt.prototype,"createQueryVersion",null),h([p({json:{read:{source:"layerDefinition.copyrightText"}}})],Lt.prototype,"copyright",void 0),h([p({json:{read:{source:"layerDefinition.displayField"}}})],Lt.prototype,"displayField",void 0),h([p({types:VS,readOnly:!0})],Lt.prototype,"defaultSymbol",void 0),h([p({type:xf})],Lt.prototype,"dynamicDataSource",void 0),h([p({type:Boolean})],Lt.prototype,"editingEnabled",null),h([ze(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Lt.prototype,"readEditingEnabled",null),h([ze("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Lt.prototype,"readEditingEnabledFromWebMap",null),h([Ze(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Lt.prototype,"writeEditingEnabled",null),h([Ze("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Lt.prototype,"writeEditingEnabledToWebMap",null),h([p({readOnly:!0})],Lt.prototype,"effectiveEditingEnabled",null),h([p({...GW.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:HW}}}}})],Lt.prototype,"fields",void 0),h([p(GW.fieldsIndex)],Lt.prototype,"fieldsIndex",void 0),h([p({type:JGt,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Lt.prototype,"formTemplate",void 0),h([p({json:{read:{source:"layerDefinition.extent"}}})],Lt.prototype,"fullExtent",void 0),h([p({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:HW,writer(t,e,i){const r=t?bie.toJSON(t):null;r&&ua(i,r,e)}}}},read:{source:"layerDefinition.geometryType",reader:bie.read}}})],Lt.prototype,"geometryType",void 0),h([p({json:{read:{source:"layerDefinition.hasM"}}})],Lt.prototype,"hasM",void 0),h([p({json:{read:{source:"layerDefinition.hasZ"}}})],Lt.prototype,"hasZ",void 0),h([p(T6t)],Lt.prototype,"id",void 0),h([p({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],Lt.prototype,"infoFor3D",void 0),h([p({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Lt.prototype,"isTable",void 0),h([ze("service","isTable",["type","geometryType"]),ze("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Lt.prototype,"readIsTable",null),h([Ze("web-map","isTable")],Lt.prototype,"writeIsTable",null),h([p(gce)],Lt.prototype,"labelsVisible",void 0),h([p({type:[W8],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:jW,write:!1},"web-scene":{name:"layerDefinition.drawingInfo.labelingInfo",read:jW,write:{enabled:!0,layerContainerTypes:Ba}}},name:"layerDefinition.drawingInfo.labelingInfo",read:jW,write:!0}})],Lt.prototype,"labelingInfo",void 0),h([p((()=>{const t=re(x6t);return t.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,i,r){ua(r,ZD(e),i)}}},t})())],Lt.prototype,"opacity",void 0),h([p(b6t)],Lt.prototype,"legendEnabled",void 0),h([p({type:["show","hide"],json:(()=>{const t=re(Oje.json);return t.origins["portal-item"]={read:!1,write:!1},t})()})],Lt.prototype,"listMode",void 0),h([ze("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],Lt.prototype,"readGlobalIdField",null),h([p({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:HW}}}}})],Lt.prototype,"objectIdField",void 0),h([ze("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],Lt.prototype,"readObjectIdField",null),h([p({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Lt.prototype,"operationalLayerType",void 0),h([p(GW.outFields)],Lt.prototype,"outFields",void 0),h([p({readOnly:!0})],Lt.prototype,"parsedUrl",null),h([p({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Lt.prototype,"path",void 0),h([p(mce)],Lt.prototype,"popupEnabled",void 0),h([p({type:nN,json:{name:"popupInfo",write:!0}})],Lt.prototype,"popupTemplate",void 0),h([p({readOnly:!0})],Lt.prototype,"defaultPopupTemplate",null),h([p({types:q8,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:MGt,name:"layerDefinition.drawingInfo.renderer",write:{layerContainerTypes:Ba,overridePolicy:(t,e,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(t,e,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}})],Lt.prototype,"renderer",null),h([ze("service","renderer",["drawingInfo.renderer","defaultSymbol"]),ze("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Lt.prototype,"readRenderer",null),h([p()],Lt.prototype,"resourceInfo",void 0),h([p((()=>{const t=re(_6t);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],Lt.prototype,"screenSizePerspectiveEnabled",void 0),h([p({clonable:!1})],Lt.prototype,"source",null),h([Qt("source")],Lt.prototype,"castSource",null),h([ze("portal-item","source",["featureSet"]),ze("web-map","source",["featureSet"])],Lt.prototype,"readSource",null),h([p({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],Lt.prototype,"spatialReference",void 0),h([p({type:Number})],Lt.prototype,"subtypeCode",void 0),h([p({type:[bce]})],Lt.prototype,"templates",void 0),h([ze("templates",["editFieldsInfo","creatorField","editorField","templates"])],Lt.prototype,"readTemplates",null),h([p({type:Hje})],Lt.prototype,"timeInfo",void 0),h([p()],Lt.prototype,"title",void 0),h([ze("service","title",["name"]),ze("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Lt.prototype,"readTitle",null),h([ze("web-map","title",["layerDefinition.name","title"])],Lt.prototype,"readTitleFromWebMap",null),h([p({type:String})],Lt.prototype,"sublayerTitleMode",void 0),h([p({json:{read:!1}})],Lt.prototype,"type",void 0),h([p({type:String})],Lt.prototype,"typeIdField",void 0),h([ze("service","typeIdField"),ze("typeIdField",["layerDefinition.typeIdField"])],Lt.prototype,"readTypeIdField",null),h([p({type:[qje]})],Lt.prototype,"types",void 0),h([ze("service","types",["types"]),ze("types",["layerDefinition.types"])],Lt.prototype,"readTypes",null),h([p({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Lt.prototype,"visible",void 0),h([ze("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Lt.prototype,"readVisible",null),Lt=h([I("esri.layers.FeatureLayer")],Lt);const Wje=Lt,Pmi=Object.freeze(Object.defineProperty({__proto__:null,default:Wje},Symbol.toStringTag,{value:"Module"})),uHt="esri.widgets.Feature.support.arcadeFeatureUtils",bxe=()=>ne.getLogger(uHt);function hHt(t){return typeof t=="string"?BN(tce(t)):Array.isArray(t)?dHt(t):(t==null?void 0:t.declaredClass)==="esri.arcade.Dictionary"?pHt(t):t}function dHt(t){return`<ul class="esri-widget__list">${t.map(e=>`<li>${typeof e=="string"?BN(tce(e)):e}</li>`).join("")}</ul>`}function pHt(t){const e=t.keys().map(i=>{const r=t.field(i);return`<tr><th>${i}</th><td>${typeof r=="string"?BN(tce(r)):r}</td></tr>`}).join("");return`<table class="${Jt.table}">${e}</table>`}function Zje(){return oe(()=>import("./arcade-CZ_NVpYn.js"),__vite__mapDeps([237,27,71]))}function fHt(t){return"createQuery"in t&&"queryFeatures"in t}async function mHt({graphic:t,view:e,options:i}){const{isAggregate:r,layer:s}=t;if(!r||!s||(e==null?void 0:e.type)!=="2d")return[];const n=await e.whenLayerView(s);if(!fHt(n))return[];const o=n.createQuery(),a=t.getObjectId();o.aggregateIds=a!=null?[a]:[];const{features:l}=await n.queryFeatures(o,i);return l}function gHt({layer:t,aggregatedFeatures:e,interceptor:i}){const{fields:r,objectIdField:s,geometryType:n,spatialReference:o,displayField:a}=t;return new Wje({fields:r,objectIdField:s,geometryType:n,spatialReference:o,displayField:a,interceptor:i,...t.type==="feature"?{templates:t.templates,typeIdField:t.typeIdField,types:t.types}:null,source:e})}async function Yje({expressionInfo:t,arcade:e,interceptor:i,spatialReference:r,map:s,graphic:n,location:o,view:a,options:l}){var x;if(!(t!=null&&t.expression))return null;const{isAggregate:c}=n,u=(n.sourceLayer||n.layer)??void 0,d=c?"feature-reduction-popup":"popup",f=e.createArcadeProfile(d),m=e.createArcadeExecutor(t.expression,f).catch(T=>bxe().error("arcade-executor-error",{error:T,expressionInfo:t})),[g,y]=await Promise.all([mHt({graphic:n,view:a,options:l}),m]);if(!y)return null;const v=d==="feature-reduction-popup"?gHt({layer:u,aggregatedFeatures:g,interceptor:i}):void 0,b={...d==="feature-reduction-popup"?{$aggregatedFeatures:v}:{$datastore:u==null?void 0:u.url,$layer:(u==null?void 0:u.type)==="feature"||(u==null?void 0:u.type)==="subtype-sublayer"||(u==null?void 0:u.type)==="catalog-footprint"||(u==null?void 0:u.type)==="oriented-imagery"?u:(u==null?void 0:u.type)==="scene"&&u.associatedLayer!=null?u.associatedLayer:void 0,$map:s,$userInput:o,$graph:(u==null?void 0:u.type)==="knowledge-graph-sublayer"?(x=u==null?void 0:u.parentCompositeLayer)==null?void 0:x.knowledgeGraph:void 0},$feature:n},w={abortSignal:(l==null?void 0:l.signal)??void 0,interceptor:i??void 0,rawOutput:!0,spatialReference:r??void 0,timeZone:a==null?void 0:a.timeZone};return await y.executeAsync(b,w).catch(T=>bxe().error("arcade-execution-error",{error:T,graphic:n,expressionInfo:t})).finally(()=>v==null?void 0:v.destroy())}async function yHt({expressionInfos:t,spatialReference:e,graphic:i,interceptor:r,map:s,view:n,location:o,options:a}){if(!(t!=null&&t.length))return{};const l=await Zje(),c={};for(const f of t)c[`expression/${f.name}`]=Yje({expressionInfo:f,arcade:l,interceptor:r,spatialReference:e,map:s,graphic:i,location:o,view:n,options:a});const u=await nm(c),d={};for(const f in u)d[f]=hHt(u[f].value);return d}const _Ht=1;let gu=class extends Ue{constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._cancelQuery=()=>{const{_abortController:i}=this;i&&i.abort(),this._abortController=null},this._createVM=()=>{var s,n;const i=(s=this.contentElement)==null?void 0:s.type;(n=this.contentElementViewModel)==null||n.destroy();const r=i==="fields"?new j8:i==="media"?new _S:i==="text"?new Hj:null;this._set("contentElementViewModel",r)},this._compile=async()=>{this._cancelQuery();const i=new AbortController;this._abortController=i,await this._compileExpression(),this._abortController===i&&(this._abortController=null)},this._compileThrottled=jj(this._compile,_Ht,this),this._compileExpression=async()=>{const{expressionInfo:i,graphic:r,interceptor:s,spatialReference:n,map:o,location:a,view:l,_abortController:c}=this;if(!i||!r)return void this._set("contentElement",null);const u=await Zje();if(c!==this._abortController)return;const d=await Yje({arcade:u,expressionInfo:i,graphic:r,location:a,interceptor:s,map:o,spatialReference:n,view:l});if(!d||d.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const f=await d.castAsJsonAsync(c==null?void 0:c.signal),m=f==null?void 0:f.type,g=m==="media"?WL.fromJSON(f):m==="text"?DP.fromJSON(f):m==="fields"?LP.fromJSON(f):null;this._set("contentElement",g)},this.addHandles([te(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),pt),te(()=>[this.contentElement],()=>this._createVM(),pt)])}initialize(){this.addHandles(this._compileThrottled)}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)??null}set spatialReference(e){this._override("spatialReference",e)}get state(){const{_abortController:e,contentElement:i,contentElementViewModel:r}=this;return e?"loading":i||r?"ready":"disabled"}get map(){var e;return((e=this.view)==null?void 0:e.map)??null}set map(e){this._override("map",e)}};h([p()],gu.prototype,"_abortController",void 0),h([p({type:S$e})],gu.prototype,"expressionInfo",void 0),h([p({type:ya})],gu.prototype,"graphic",void 0),h([p({readOnly:!0})],gu.prototype,"contentElement",void 0),h([p({readOnly:!0})],gu.prototype,"contentElementViewModel",void 0),h([p()],gu.prototype,"interceptor",void 0),h([p({type:wt})],gu.prototype,"location",void 0),h([p()],gu.prototype,"spatialReference",null),h([p({readOnly:!0})],gu.prototype,"state",null),h([p()],gu.prototype,"map",null),h([p()],gu.prototype,"view",void 0),gu=h([I("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],gu);const wce=gu,wxe="esri-feature",xxe={base:`${wxe}-expression`,loadingSpinnerContainer:`${wxe}__loading-container`};let tz=class extends Wo{constructor(e,i){super(e,i),this._contentWidget=null,this.viewModel=new wce}initialize(){this.addHandles(te(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),pt))}loadDependencies(){return Cp({loader:()=>oe(()=>import("./calcite-loader-DzbGa04d.js"),__vite__mapDeps([238,210,201]))})}destroy(){this._destroyContentWidget()}render(){var i;const{state:e}=this.viewModel;return Q("div",{class:xxe.base},e==="loading"?this._renderLoading():e==="disabled"?null:(i=this._contentWidget)==null?void 0:i.render())}_renderLoading(){return Q("div",{class:xxe.loadingSpinnerContainer,key:"loading-container"},Q("calcite-loader",{inline:!0,label:""}))}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:i}=this.viewModel,r=i==null?void 0:i.type;this._destroyContentWidget();const s=e?r==="fields"?new YBe({viewModel:e}):r==="media"?new rje({viewModel:e}):r==="text"?new LV({viewModel:e}):null:null;this._contentWidget=s,this.scheduleRender()}};h([p({type:wce})],tz.prototype,"viewModel",void 0),tz=h([I("esri.widgets.Feature.FeatureExpression")],tz);const vHt=tz;var Txe;(function(t){t.TOO_SHORT="length-validation-error::too-short",t.TOO_LONG="length-validation-error::too-long"})(Txe||(Txe={}));const bHt=t=>{var i;const e=[];if(t.formTemplate){const{description:r,title:s}=t.formTemplate;(i=t.fields)==null||i.forEach(n=>{const o=s&&Hue(s,n.name),a=r&&Hue(r,n.name);(o||a)&&e.push(n.name)})}return e},qW=100;let ss=class extends ts(mw(Ue)){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:i}=this;i&&i.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:i}=this;i&&i.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:i}=this;i&&i.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const i=new AbortController;this._queryAbortController=i,await h_(this._query()),this._queryAbortController===i&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._loaded=!1,this._cancelQueryFeatureCount();const i=new AbortController;this._queryFeatureCountAbortController=i,await h_(this._queryFeatureCount()),this._queryFeatureCountAbortController===i&&(this._queryFeatureCountAbortController=null),this._loaded=!0},this._queryPageController=async()=>{const i=new AbortController;this._queryPageAbortController=i,await h_(this._queryPage()),this._queryPageAbortController===i&&(this._queryPageAbortController=null)},this._queryDebounced=d_(this._queryController,qW),this._queryFeatureCountDebounced=d_(this._queryFeatureCountController,qW),this._queryPageDebounced=d_(this._queryPageController,qW),this._query=async()=>{const{_queryAbortController:i,relatedFeatures:r}=this;this.featureCount&&(this._destroyRelatedFeatureViewModels(),this.featurePage=1,r.destroyAll(),this.destroyed||r.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:i==null?void 0:i.signal}))))},this.addHandles([te(()=>{var i;return[this.displayCount,this.graphic,this.layer,(i=this.layer)==null?void 0:i.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount]},()=>this._queryDebounced(),pt),te(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),te(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.destroyAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){const{featuresPerPage:i,featureCount:r}=this,s=1,n=Math.ceil(r/i)||1;this._set("featurePage",Math.min(Math.max(e,s),n))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:e,relatedLayer:i}=this;return e&&(i!=null&&i.loaded)?e.map(r=>{const s=r.clone();return s.field=MD(r.field,i),s}):e??[]}get supportsCacheHint(){var e,i,r;return!!((r=(i=(e=this.layer)==null?void 0:e.capabilities)==null?void 0:i.queryRelated)!=null&&r.supportsCacheHint)}get canLoad(){return!!this.map&&this.relationshipId!=null&&typeof this.objectId=="number"}get canQuery(){var i,r;const e=(r=(i=this.layer)==null?void 0:i.capabilities)==null?void 0:r.queryRelated;return!!(this.relatedLayer&&this.relationship&&this.relationshipId!=null&&this.objectId!=null&&(e!=null&&e.supportsCount)&&(e!=null&&e.supportsPagination))}get itemDescriptionFieldName(){var e;return((e=this.orderByFieldsFixedCasing[0])==null?void 0:e.field)||null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){var e,i;return(this.objectIdField&&((i=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:i[this.objectIdField]))??null}get objectIdField(){var e;return((e=this.layer)==null?void 0:e.objectIdField)||null}get relatedFeatures(){return this._get("relatedFeatures")||new Ke}get relatedLayer(){const{layer:e,map:i,relationship:r}=this;return e!=null&&e.loaded&&i&&r?dBt(i,e,r)??null:null}get relationship(){var r;const{relationshipId:e,layer:i}=this;return e!=null?((r=i==null?void 0:i.relationships)==null?void 0:r.find(({id:s})=>s===e))??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new Ke}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:i,_queryPageAbortController:r,canQuery:s,_loaded:n,canLoad:o}=this;return i||o&&!n?"loading":e||r?"querying":s?"ready":"disabled"}getRelatedFeatureByObjectId(e){return this.relatedFeatures.find(i=>i.getObjectId()===e)}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){var e;(e=this.relatedFeatureViewModels)==null||e.destroyAll()}async _queryFeatureCount(){const{layer:e,relatedLayer:i,relationshipId:r,objectId:s,_queryFeatureCountAbortController:n,canQuery:o,supportsCacheHint:a}=this;if(await(e==null?void 0:e.load()),await(i==null?void 0:i.load()),!o||!e||!i||s==null)return void this._set("featureCount",0);const l=i.createQuery(),{historicMoment:c,gdbVersion:u}=e,d=new aO({cacheHint:a,gdbVersion:u,historicMoment:c,relationshipId:r,returnGeometry:!1,objectIds:[s],where:l.where??void 0}),f=await e.queryRelatedFeaturesCount(d,{signal:n==null?void 0:n.signal});this._set("featureCount",f[s]||0)}_sliceFeatures(e){const{showAllEnabled:i,displayCount:r}=this;return i?e:r?e.slice(0,r):[]}async _queryPage(){const{relatedFeatures:e,featurePage:i,showAllEnabled:r,_queryPageAbortController:s,featureCount:n}=this;!r||i<2||!n||e.addMany(await this._queryRelatedFeatures({signal:s==null?void 0:s.signal}))}async _queryRelatedFeatures(e){var U;const{orderByFieldsFixedCasing:i,showAllEnabled:r,featuresPerPage:s,displayCount:n,layer:o,relationshipId:a,featurePage:l,featureCount:c,relatedLayer:u,supportsCacheHint:d}=this,{canQuery:f,objectId:m}=this;if(!f||!o||!u||m==null)return[];const g=r?((l-1)*s+c)%c:0,y=r?s:n,v=u.objectIdField,b=[...i.map(k=>k.field),...bHt(u),v].filter(sd),w=i.map(k=>`${k.field} ${k.order}`),x=u.createQuery(),{historicMoment:T,gdbVersion:E}=o,M=new aO({orderByFields:w,start:g,num:y,outFields:b,cacheHint:d,historicMoment:T,gdbVersion:E,relationshipId:a,returnGeometry:!1,objectIds:[m],where:x.where??void 0}),O=await o.queryRelatedFeatures(M,{signal:e==null?void 0:e.signal}),D=((U=O[m])==null?void 0:U.features)||[];return D.forEach(k=>{k.sourceLayer=u,k.layer=u}),D}};h([p()],ss.prototype,"_loaded",void 0),h([p()],ss.prototype,"_queryAbortController",void 0),h([p()],ss.prototype,"_queryPageAbortController",void 0),h([p()],ss.prototype,"_queryFeatureCountAbortController",void 0),h([p({value:1})],ss.prototype,"featurePage",null),h([p()],ss.prototype,"featuresPerPage",void 0),h([p({readOnly:!0})],ss.prototype,"orderByFieldsFixedCasing",null),h([p({readOnly:!0})],ss.prototype,"supportsCacheHint",null),h([p({readOnly:!0})],ss.prototype,"canLoad",null),h([p({readOnly:!0})],ss.prototype,"canQuery",null),h([p()],ss.prototype,"description",void 0),h([p({readOnly:!0})],ss.prototype,"itemDescriptionFieldName",null),h([p({value:3})],ss.prototype,"displayCount",null),h([p({type:ya})],ss.prototype,"graphic",void 0),h([p()],ss.prototype,"layer",void 0),h([p()],ss.prototype,"map",void 0),h([p({readOnly:!0})],ss.prototype,"objectId",null),h([p({readOnly:!0})],ss.prototype,"objectIdField",null),h([p()],ss.prototype,"orderByFields",void 0),h([p({readOnly:!0})],ss.prototype,"relatedFeatures",null),h([p({readOnly:!0})],ss.prototype,"relatedLayer",null),h([p({readOnly:!0})],ss.prototype,"relationship",null),h([p()],ss.prototype,"featureCount",void 0),h([p({readOnly:!0})],ss.prototype,"relatedFeatureViewModels",null),h([p()],ss.prototype,"relationshipId",void 0),h([p()],ss.prototype,"showAllEnabled",void 0),h([p()],ss.prototype,"state",null),h([p()],ss.prototype,"title",void 0),ss=h([I("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],ss);const xce=ss,iz="esri-feature",oR=`${iz}-relationship`,Hv={base:oR,listContainer:`${oR}__list`,listItem:`${oR}__list-item`,listItemHidden:`${oR}__list-item--hidden`,listContainerQuerying:`${oR}__list--querying`,featureObserver:`${iz}__feature-observer`,stickySpinnerContainer:`${iz}__sticky-loading-container`,loadingSpinnerContainer:`${iz}__loading-container`},Sxe={title:!0,description:!0};let Dc=class extends Wo{constructor(e,i){super(e,i),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([r])=>{r!=null&&r.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new xce,this.messages=null,this.messagesCommon=null,this.visibleElements={...Sxe},this._increaseFeaturePage=()=>{const{state:r,showAllEnabled:s,relatedFeatures:n,featuresPerPage:o,featurePage:a}=this.viewModel;r==="ready"&&s&&n.length>=o*a&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new B8,this.addHandles([te(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),pt),te(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),on(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return Cp({icon:()=>oe(()=>import("./calcite-icon-eob-Ctv5.js"),__vite__mapDeps([211,209,200,201,208])),list:()=>oe(()=>import("./calcite-list-CjOh8dex.js"),__vite__mapDeps([239,200,201,202,208,240,241,205,206,207,216,209,242,199,203,204,210,243])),"list-item":()=>oe(()=>import("./calcite-list-item-uP1R-DBp.js"),__vite__mapDeps([244,200,201,202,206,207,208,205,241,240,245,204,209,210])),loader:()=>oe(()=>import("./calcite-loader-DzbGa04d.js"),__vite__mapDeps([238,210,201])),notice:()=>oe(()=>import("./calcite-notice-DUqL5bU5.js"),__vite__mapDeps([246,247,208,200,201,205,206,207,217,204,209]))})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=He(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:e,featureCount:i,displayCount:r,state:s}=this.viewModel;return!e&&!!i&&s==="ready"&&(i>r||r===0)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get featureCountDescription(){const{messages:e}=this,{featureCount:i}=this.viewModel;return Pg(e==null?void 0:e.numberRecords,{number:i})}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}castVisibleElements(e){return{...Sxe,...e}}render(){var i;const{state:e}=this.viewModel;return Q("div",{class:this.classes(Hv.base,Jt.widget)},(i=this._featureElementInfo)==null?void 0:i.render(),e==="loading"?this._renderLoading():e==="disabled"?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_renderStickyLoading(){return this.viewModel.state==="querying"?Q("div",{class:Hv.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return Q("calcite-loader",{inline:!0,label:""})}_renderLoading(){return Q("div",{class:Hv.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return Q("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){const e=Zb(this.container)?"chevron-left":"chevron-right";return Q("calcite-icon",{icon:e,scale:"s",slot:"content-end"})}_renderRelatedFeature(e){var n;const{itemDescriptionFieldName:i}=this.viewModel,r=e.title;e.description=i&&((n=e.formattedAttributes)==null?void 0:n.global[i]);const s=e.state==="loading";return Q("calcite-list-item",{class:this.classes(Hv.listItem,{[Hv.listItemHidden]:s}),description:e.description??"",key:e.uid,label:r,onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:e})},this._renderChevronIconNode())}_renderShowAllListItem(){var e;return this.displayShowAllButton?Q("calcite-list-item",{description:this.featureCountDescription,key:"show-all-item",label:(e=this.messages)==null?void 0:e.showAll,onCalciteListItemSelect:()=>this.emit("show-all-records")},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){var e;return Q("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},Q("div",{slot:"message"},(e=this.messages)==null?void 0:e.noRelatedFeatures))}_renderFeatureObserver(){return Q("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:Hv.featureObserver,key:"feature-observer"})}_renderList(){const{relatedFeatureViewModels:e}=this.viewModel;return Q("calcite-list",null,e.toArray().map(i=>this._renderRelatedFeature(i)),this._renderShowAllListItem())}_renderRelatedFeatures(){const{displayListItems:e}=this,{state:i}=this.viewModel;return Q("div",{class:this.classes(Hv.listContainer,{[Hv.listContainerQuerying]:i==="querying"}),key:"list-container"},e?this._renderList():i==="ready"?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){var e;return Q("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},Q("div",{slot:"message"},(e=this.messages)==null?void 0:e.relationshipNotFound))}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:e}=this.viewModel,i="related-feature-viewmodels";this.removeHandles(i),e==null||e.forEach(r=>{this.addHandles(te(()=>[r.title,r.state],()=>this.scheduleRender(),pt),i)}),this.scheduleRender()}_setupFeatureElementInfo(){var n;const{headingLevel:e,visibleElements:i}=this,r=i.description&&this.description,s=i.title&&this.title;(n=this._featureElementInfo)==null||n.set({description:r,title:s,headingLevel:e})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:e,showAllEnabled:i}=this.viewModel;await KS(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&i&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};h([p()],Dc.prototype,"_relatedFeatureIntersectionObserverNode",void 0),h([p({readOnly:!0})],Dc.prototype,"displayShowAllButton",null),h([p({readOnly:!0})],Dc.prototype,"displayListItems",null),h([p()],Dc.prototype,"description",null),h([p({readOnly:!0})],Dc.prototype,"featureCountDescription",null),h([p()],Dc.prototype,"headingLevel",void 0),h([p()],Dc.prototype,"title",null),h([p({type:xce})],Dc.prototype,"viewModel",void 0),h([p(),qo("esri/widgets/Feature/t9n/Feature")],Dc.prototype,"messages",void 0),h([p(),qo("esri/t9n/common")],Dc.prototype,"messagesCommon",void 0),h([p()],Dc.prototype,"visibleElements",void 0),h([Qt("visibleElements")],Dc.prototype,"castVisibleElements",null),Dc=h([I("esri.widgets.Feature.FeatureRelationship")],Dc);const Exe=Dc;let wHt=class{constructor(e,i){this.preLayerQueryCallback=e,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=r=>{}),this.preRequestCallback||(this.preLayerQueryCallback=r=>{})}};var h3;const xHt=1,Cxe="content-view-models",Mxe="relationship-view-models",Axe={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let Ms=h3=class extends mw(Ue){constructor(t){super(t),this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=jj(this._graphicChanged,xHt,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...Axe},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=e=>{const{abilities:i}=this;return e.type==="attachments"&&!!i.attachmentsContent||e.type==="custom"&&!!i.customContent||e.type==="fields"&&!!i.fieldsContent||e.type==="media"&&!!i.mediaContent||e.type==="text"&&!!i.textContent||e.type==="expression"&&!!i.expressionContent||e.type==="relationship"&&!!i.relationshipContent},this.addHandles(te(()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone],()=>this._graphicChangedThrottled(),pt))}initialize(){this.addHandles(this._graphicChangedThrottled)}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return this.graphic!=null?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return nBt(owe(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return kBe(this.graphic)}castAbilities(t){return{...Axe,...t}}get isTable(){var t;return((t=this._sourceLayer)==null?void 0:t.isTable)||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(t){this._set("graphic",(t==null?void 0:t.clone())??null)}get spatialReference(){var t;return((t=this.view)==null?void 0:t.spatialReference)??null}set spatialReference(t){this._override("spatialReference",t)}get timeZone(){var t;return((t=this.view)==null?void 0:t.timeZone)??pp}set timeZone(t){this._overrideIfSome("timeZone",t)}get map(){var t;return((t=this.view)==null?void 0:t.map)||null}set map(t){this._override("map",t)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(t,e){const i=this.contentViewModels[t];i instanceof _S&&i.setActiveMedia(e)}nextMedia(t){const e=this.contentViewModels[t];e instanceof _S&&e.next()}previousMedia(t){const e=this.contentViewModels[t];e instanceof _S&&e.previous()}async updateGeometry(){var o;const{graphic:t,spatialReference:e,_sourceLayer:i}=this;await(i==null?void 0:i.load());const r=i==null?void 0:i.objectIdField;if(!r||!t||!i)return;const s=(o=t==null?void 0:t.attributes)==null?void 0:o[r];if(s==null)return;const n=[s];if(!t.geometry){const a=await HBe({layer:i,graphic:t,outFields:[],objectIds:n,returnGeometry:!0,spatialReference:e}),l=a==null?void 0:a.geometry;l&&(t.geometry=l)}}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:t}=this;if(!t)return;const e=new AbortController;this._featureAbortController=e;try{await this._queryFeature({signal:e.signal})}catch(i){us(i)||(this._error=i,ne.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:t,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===e&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:t}=this;t&&t.abort(),this._featureAbortController=null}_compileContentElement(t,e){return t.type==="attachments"?this._compileAttachments(t,e):t.type==="custom"?this._compileCustom(t,e):t.type==="fields"?this._compileFields(t,e):t.type==="media"?this._compileMedia(t,e):t.type==="text"?this._compileText(t,e):t.type==="expression"?this._compileExpression(t,e):t.type==="relationship"?this._compileRelationship(t,e):void 0}_compileContent(t){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(t)?t.filter(this._isAllowedContentType).map((e,i)=>this._compileContentElement(e,i)).filter(sd):typeof t=="string"?this._compileText(new DP({text:t}),0).text:t}_destroyContentViewModels(){this.removeHandles(Mxe),this.removeHandles(Cxe),this.contentViewModels.forEach(t=>t&&!t.destroyed&&t.destroy()),this._set("contentViewModels",[])}_matchesFeature(t,e){var s;const i=(s=t==null?void 0:t.graphic)==null?void 0:s.getObjectId(),r=e==null?void 0:e.getObjectId();return i!=null&&r!=null&&i===r}_setRelatedFeaturesViewModels({relatedFeatureViewModels:t,relatedFeatures:e,map:i}){const{view:r,spatialReference:s,timeZone:n}=this;e==null||e.filter(Boolean).forEach(o=>{t.some(a=>this._matchesFeature(a,o))||t.add(new h3({abilities:{relationshipContent:!1},map:i,view:r,spatialReference:s,timeZone:n,graphic:o}))}),t.forEach(o=>{(e==null?void 0:e.find(l=>this._matchesFeature(o,l)))||t.remove(o)})}_setExpressionContentVM(t,e){const i=this.formattedAttributes,{contentElement:r,contentElementViewModel:s}=t,n=r==null?void 0:r.type;s&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:e,formattedAttributes:i}),s.set(this._createFieldsVMParams(r,e))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:e,formattedAttributes:i}),s.set(this._createMediaVMParams(r,e))),n==="text"&&s.set(this._createTextVMParams(r)))}_compileRelationship(t,e){const{displayCount:i,orderByFields:r,relationshipId:s,title:n,description:o}=t,{_sourceLayer:a,graphic:l,map:c}=this;if(!BBe(a))return;const u=new xce({displayCount:i,graphic:l,orderByFields:r,relationshipId:s,layer:a,map:c,...this._compileTitleAndDesc({title:n,description:o})});return this.contentViewModels[e]=u,this.addHandles(on(()=>u.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(u)),Mxe),t}_compileExpression(t,e){const{expressionInfo:i}=t,{graphic:r,map:s,spatialReference:n,view:o,location:a}=this,l=new wce({expressionInfo:i,graphic:r,interceptor:h3.interceptor,map:s,spatialReference:n,view:o,location:a});return this.contentViewModels[e]=l,this.addHandles(te(()=>l.contentElementViewModel,()=>this._setExpressionContentVM(l,e),pt),Cxe),t}_compileAttachments(t,e){const{graphic:i}=this,{description:r,title:s}=t;return this.contentViewModels[e]=new rce({graphic:i,...this._compileTitleAndDesc({title:s,description:r})}),t}_compileCustom(t,e){const{graphic:i}=this,{creator:r,destroyer:s}=t;return this.contentViewModels[e]=new Hj({graphic:i,creator:r,destroyer:s}),t}_compileTitleAndDesc({title:t,description:e}){const{_fieldInfoMap:i,_sourceLayer:r,graphic:s,formattedAttributes:n}=this,o=s==null?void 0:s.attributes,a=this._expressionAttributes,l=n.global;return{title:gS({attributes:o,fieldInfoMap:i,globalAttributes:l,expressionAttributes:a,layer:r,text:t}),description:gS({attributes:o,fieldInfoMap:i,globalAttributes:l,expressionAttributes:a,layer:r,text:e})}}_createFieldsVMParams(t,e){const i=this._effectivePopupTemplate,r=this.formattedAttributes,s={...r==null?void 0:r.global,...r==null?void 0:r.content[e]},n=(t==null?void 0:t.fieldInfos)||(i==null?void 0:i.fieldInfos),o=n==null?void 0:n.filter(({fieldName:u})=>!!u&&(Kle(u)||c_(u)||s.hasOwnProperty(u))),a=i==null?void 0:i.expressionInfos,{description:l,title:c}=t;return{attributes:s,expressionInfos:a,fieldInfos:o,...this._compileTitleAndDesc({title:c,description:l})}}_compileFields(t,e){const i=t.clone(),r=new j8(this._createFieldsVMParams(t,e));return this.contentViewModels[e]=r,i.fieldInfos=r.formattedFieldInfos.slice(0),i}_createMediaVMParams(t,e){const{abilities:i,graphic:r,_fieldInfoMap:s,_effectivePopupTemplate:n,relatedInfos:o,_sourceLayer:a,_expressionAttributes:l}=this,c=this.formattedAttributes,u=(r==null?void 0:r.attributes)??{},{description:d,mediaInfos:f,title:m}=t;return{abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:t.activeMediaInfoIndex||0,attributes:u,isAggregate:r==null?void 0:r.isAggregate,layer:a,fieldInfoMap:s,formattedAttributes:{...c==null?void 0:c.global,...c==null?void 0:c.content[e]},expressionAttributes:l,mediaInfos:f,popupTemplate:n,relatedInfos:o,...this._compileTitleAndDesc({title:m,description:d})}}_compileMedia(t,e){const i=t.clone(),r=new _S(this._createMediaVMParams(t,e));return i.mediaInfos=r.formattedMediaInfos.slice(0),this.contentViewModels[e]=r,i}_createTextVMParams(t){var n;const{graphic:e,_fieldInfoMap:i,_sourceLayer:r,_expressionAttributes:s}=this;if(t&&t.text){const o=(e==null?void 0:e.attributes)??{},a=((n=this.formattedAttributes)==null?void 0:n.global)??{};t.text=gS({attributes:o,fieldInfoMap:i,globalAttributes:a,expressionAttributes:s,layer:r,text:t.text})}return{graphic:e,creator:t.text}}_compileText(t,e){const i=t.clone();return this.contentViewModels[e]=new Hj(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:t,_sourceLayer:e,graphic:i,timeZone:r}=this;if(!t)return;const{lastEditInfoEnabled:s}=t,n=e==null?void 0:e.editFieldsInfo;return s&&n?sBt(n,i==null?void 0:i.attributes,r,e):void 0}_compileTitle(t){var a;const{_fieldInfoMap:e,_sourceLayer:i,graphic:r,_expressionAttributes:s}=this,n=(r==null?void 0:r.attributes)??{},o=((a=this.formattedAttributes)==null?void 0:a.global)??{};return gS({attributes:n,fieldInfoMap:e,globalAttributes:o,expressionAttributes:s,layer:i,text:t})}async _getTitle(){const{_effectivePopupTemplate:t,graphic:e}=this;return e?Gj({type:"title",value:t==null?void 0:t.title,event:{graphic:e}}):null}async _getContent(){const{_effectivePopupTemplate:t,graphic:e}=this;return e?Gj({type:"content",value:t==null?void 0:t.content,event:{graphic:e}}):null}async _queryFeature(t){const{_featureAbortController:e,_sourceLayer:i,graphic:r,_effectivePopupTemplate:s}=this,n=this.map,o=this.view,a=this.spatialReference,l=this.location;if(e!==this._featureAbortController||!r)return;await aBt({graphic:r,popupTemplate:s,layer:i,spatialReference:a},t);const{content:{value:c},title:{value:u}}=await nm({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:d}}=await nm({checkForRelatedFeatures:this._checkForRelatedFeatures(t),expressionAttributes:yHt({expressionInfos:s==null?void 0:s.expressionInfos,spatialReference:a,graphic:r,map:n,interceptor:h3.interceptor,view:o,options:t,location:l})});e===this._featureAbortController&&r&&(this._expressionAttributes=d,this._graphicExpressionAttributes={...r.attributes,...d},this._set("formattedAttributes",this._createFormattedAttributes(c)),this._set("title",this._compileTitle(u)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(c)||null))}_createMediaFormattedAttributes({contentElement:t,contentElementIndex:e,formattedAttributes:i}){const{_effectivePopupTemplate:r,graphic:s,relatedInfos:n,_sourceLayer:o,_fieldInfoMap:a,_graphicExpressionAttributes:l,timeZone:c}=this;i.content[e]=wW({fieldInfos:r==null?void 0:r.fieldInfos,graphic:s,attributes:{...l,...t.attributes},layer:o,fieldInfoMap:a,relatedInfos:n,timeZone:c})}_createFieldsFormattedAttributes({contentElement:t,contentElementIndex:e,formattedAttributes:i}){if(t.fieldInfos){const{graphic:r,relatedInfos:s,_sourceLayer:n,_fieldInfoMap:o,_graphicExpressionAttributes:a,timeZone:l}=this;i.content[e]=wW({fieldInfos:t.fieldInfos,graphic:r,attributes:{...a,...t.attributes},layer:n,fieldInfoMap:o,relatedInfos:s,timeZone:l})}}_createFormattedAttributes(t){const{_effectivePopupTemplate:e,graphic:i,relatedInfos:r,_sourceLayer:s,_fieldInfoMap:n,_graphicExpressionAttributes:o,timeZone:a}=this,l=e==null?void 0:e.fieldInfos,c={global:wW({fieldInfos:l,graphic:i,attributes:o,layer:s,fieldInfoMap:n,relatedInfos:r,timeZone:a}),content:[]};return Array.isArray(t)&&t.forEach((u,d)=>{u.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:u,contentElementIndex:d,formattedAttributes:c}),u.type==="media"&&this._createMediaFormattedAttributes({contentElement:u,contentElementIndex:d,formattedAttributes:c})}),c}_checkForRelatedFeatures(t){const{graphic:e,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(e,owe(i),t)}async _queryRelatedInfos(t,e,i){const{relatedInfos:r,_sourceLayer:s}=this;r.clear();const n=(s==null?void 0:s.associatedLayer)!=null?await(s==null?void 0:s.associatedLayer.load(i)):s;if(!n||!t)return;const o=e.filter(c=>!!c.fieldName&&c_(c.fieldName));if(!(o!=null&&o.length))return;e.forEach(c=>this._configureRelatedInfo(c,n));const a=await Rjt({relatedInfos:r,layer:n},i);Object.keys(a).forEach(c=>{var f;const u=r.get(c.toString()),d=(f=a[c])==null?void 0:f.value;u&&d&&(u.layerInfo=d.data)});const l=await Ijt({graphic:t,relatedInfos:r,layer:n},i);Object.keys(l).forEach(c=>{var u;Ejt((u=l[c])==null?void 0:u.value,r.get(c.toString()))})}_configureRelatedInfo(t,e){const{relatedInfos:i}=this,r=NV(t.fieldName||"");if(!r)return;const{layerId:s,fieldName:n}=r;if(!s)return;const o=i.get(s.toString())||Sjt(s,e);o&&(Ljt({relatedInfo:o,fieldName:n,fieldInfo:t}),this.relatedInfos.set(s,o))}};Ms.interceptor=new wHt(uBt,hBt),h([p()],Ms.prototype,"_error",void 0),h([p()],Ms.prototype,"_featureAbortController",void 0),h([p({readOnly:!0})],Ms.prototype,"_effectivePopupTemplate",null),h([p({readOnly:!0})],Ms.prototype,"_fieldInfoMap",null),h([p({readOnly:!0})],Ms.prototype,"_sourceLayer",null),h([p()],Ms.prototype,"abilities",void 0),h([Qt("abilities")],Ms.prototype,"castAbilities",null),h([p({readOnly:!0})],Ms.prototype,"content",void 0),h([p({readOnly:!0})],Ms.prototype,"contentViewModels",void 0),h([p()],Ms.prototype,"description",void 0),h([p({type:Boolean})],Ms.prototype,"defaultPopupTemplateEnabled",void 0),h([p({readOnly:!0})],Ms.prototype,"isTable",null),h([p({readOnly:!0})],Ms.prototype,"state",null),h([p({readOnly:!0})],Ms.prototype,"formattedAttributes",void 0),h([p({type:ya,value:null})],Ms.prototype,"graphic",null),h([p({readOnly:!0})],Ms.prototype,"lastEditInfo",void 0),h([p({type:wt})],Ms.prototype,"location",void 0),h([p({readOnly:!0})],Ms.prototype,"relatedInfos",void 0),h([p()],Ms.prototype,"spatialReference",null),h([p()],Ms.prototype,"timeZone",null),h([p({readOnly:!0})],Ms.prototype,"title",void 0),h([p()],Ms.prototype,"map",null),h([p({readOnly:!0})],Ms.prototype,"waitingForContent",null),h([p()],Ms.prototype,"view",void 0),Ms=h3=h([I("esri.widgets.Feature.FeatureViewModel")],Ms);const Tce=Ms,Ja="esri-feature",jn={base:Ja,container:`${Ja}__size-container`,title:`${Ja}__title`,main:`${Ja}__main-container`,btn:`${Ja}__button`,icon:`${Ja}__icon`,content:`${Ja}__content`,contentNode:`${Ja}__content-node`,contentNodeText:`${Ja}__content-node--text`,contentElement:`${Ja}__content-element`,text:`${Ja}__text`,lastEditedInfo:`${Ja}__last-edited-info`,fields:`${Ja}__fields`,fieldHeader:`${Ja}__field-header`,fieldData:`${Ja}__field-data`,fieldDataDate:`${Ja}__field-data--date`,loadingSpinnerContainer:`${Ja}__loading-container`},Xje=t=>{let e=class extends t{constructor(){super(...arguments),this.renderNodeContent=i=>qj(i)&&!i.destroyed?Q("div",{class:jn.contentNode,key:i},i.render()):i instanceof HTMLElement?Q("div",{afterCreate:this._attachToNode,bind:i,class:jn.contentNode,key:i}):yBt(i)?Q("div",{afterCreate:this._attachToNode,bind:i.domNode,class:jn.contentNode,key:i}):null}_attachToNode(i){const r=this;i.appendChild(r)}};return e=h([I("esri.widgets.Feature.support.FeatureContentMixin")],e),e};var Pie;const Pxe={title:!0,content:!0,lastEditedInfo:!0},Oxe="relationship-handles";let Io=Pie=class extends Xje(Wo){constructor(t,e){super(t,e),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements={...Pxe},this.viewModel=new Tce}initialize(){this.addHandles(te(()=>{var t;return(t=this.viewModel)==null?void 0:t.contentViewModels},()=>this._setupContentWidgets(),pt))}loadDependencies(){return Cp({notice:()=>oe(()=>import("./calcite-notice-DUqL5bU5.js"),__vite__mapDeps([246,247,208,200,201,205,206,207,217,204,209])),loader:()=>oe(()=>import("./calcite-loader-DzbGa04d.js"),__vite__mapDeps([238,210,201]))})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(t){this.viewModel.graphic=t}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(t){this.viewModel.defaultPopupTemplateEnabled=t}get isTable(){return this.viewModel.isTable}get icon(){return"polygon"}set icon(t){this._overrideIfSome("icon",t)}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(t){this.viewModel.spatialReference=t}get timeZone(){return this.viewModel.timeZone}set timeZone(t){this.viewModel.timeZone=t}get title(){return this.viewModel.title}castVisibleElements(t){return{...Pxe,...t}}get map(){return this.viewModel.map}set map(t){this.viewModel.map=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}setActiveMedia(t,e){return this.viewModel.setActiveMedia(t,e)}nextMedia(t){return this.viewModel.nextMedia(t)}previousMedia(t){return this.viewModel.previousMedia(t)}render(){const{state:t}=this.viewModel,e=Q("div",{class:jn.container,key:"container"},this._renderTitle(),t==="error"?this._renderError():t==="loading"?this._renderLoading():this._renderContentContainer());return Q("div",{class:this.classes(jn.base,Jt.widget)},e)}_renderError(){const{messagesCommon:t,messages:e,visibleElements:i}=this;return Q("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},i.title?Q("div",{key:"error-title",slot:"title"},t.errorMessage):null,Q("div",{key:"error-message",slot:"message"},e.loadingError))}_renderLoading(){return Q("div",{class:jn.loadingSpinnerContainer,key:"loading-container"},Q("calcite-loader",{inline:!0,label:""}))}_renderContentContainer(){const{visibleElements:t}=this;return t.content?Q("div",{class:jn.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){const{visibleElements:t,title:e}=this;return t.title?Q(sce,{class:jn.title,innerHTML:e,level:this.headingLevel}):null}_renderContent(){const t=this.viewModel.content,e="content";if(!t)return null;if(Array.isArray(t))return t.length?Q("div",{class:jn.contentNode,key:`${e}-content-elements`},t.map(this._renderContentElement,this)):null;if(typeof t=="string"){const i=this._contentWidgets[0];return!i||i.destroyed?null:Q("div",{class:this.classes(jn.contentNode,jn.contentNodeText),key:`${e}-content`},i.render())}return this.renderNodeContent(t)}_renderContentElement(t,e){var r;const{visibleElements:i}=this;if(typeof i.content!="boolean"&&!((r=i.content)!=null&&r[t.type]))return null;switch(t.type){case"attachments":return this._renderAttachments(e);case"custom":return this._renderCustom(t,e);case"fields":return this._renderFields(e);case"media":return this._renderMedia(e);case"text":return this._renderText(t,e);case"expression":return this._renderExpression(e);case"relationship":return this._renderRelationship(e);default:return null}}_renderAttachments(t){const e=this._contentWidgets[t];if(!e||e.destroyed)return null;const{state:i,attachmentInfos:r}=e.viewModel;return i==="loading"||r.length>0?Q("div",{class:this.classes(jn.contentElement),key:this._buildKey("attachments-element",t)},e.render()):null}_renderRelationship(t){const e=this._contentWidgets[t];return e&&!e.destroyed&&this.flowItems?Q("div",{class:jn.contentElement,key:this._buildKey("relationship-element",t)},e.render()):null}_renderExpression(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:Q("div",{class:jn.contentElement,key:this._buildKey("expression-element",t)},e.render())}_renderCustom(t,e){const{creator:i}=t,r=this._contentWidgets[e];return!r||r.destroyed?null:i?Q("div",{class:jn.contentElement,key:this._buildKey("custom-element",e)},r.render()):null}_renderFields(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:Q("div",{class:jn.contentElement,key:this._buildKey("fields-element",t)},e.render())}_renderMedia(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:Q("div",{class:jn.contentElement,key:this._buildKey("media-element",t)},e.render())}_renderLastEditInfo(){const{visibleElements:t,messages:e}=this,{lastEditInfo:i}=this.viewModel;if(!i||!t.lastEditedInfo)return null;const{date:r,user:s}=i,n=i.type==="edit"?s?e.lastEditedByUser:e.lastEdited:s?e.lastCreatedByUser:e.lastCreated,o=Pg(n,{date:r,user:s});return Q("div",{class:this.classes(jn.lastEditedInfo,jn.contentElement),key:"edit-info-element"},o)}_renderText(t,e){const i=t.text,r=this._contentWidgets[e];return!r||r.destroyed?null:i?Q("div",{class:this.classes(jn.contentElement,jn.text),key:this._buildKey("text-element",e)},r.render()):null}_buildKey(t,...e){var i,r;return`${t}__${((r=(i=this.viewModel)==null?void 0:i.graphic)==null?void 0:r.uid)||"0"}-${e.join("-")}`}_destroyContentWidget(t){t&&(t.viewModel=null,!t.destroyed&&t.destroy())}_destroyContentWidgets(){this.removeHandles(Oxe),this._contentWidgets.forEach(t=>this._destroyContentWidget(t)),this._contentWidgets=[]}_addFeatureRelationshipHandles(t){const{flowItems:e,visibleElements:i}=this;this.addHandles([on(()=>t,"select-record",({featureViewModel:r})=>{e&&(r.abilities={relationshipContent:!0},e.push(new Pie({flowItems:e,viewModel:r,visibleElements:i})))}),on(()=>t,"show-all-records",()=>{if(!e)return;const{viewModel:r}=t;r.showAllEnabled=!0;const s=new Exe({visibleElements:{title:!1,description:!1},viewModel:r});this._addFeatureRelationshipHandles(s),e.push(s)})],Oxe)}_setupContentWidgets(){var s;this._destroyContentWidgets();const{headingLevel:t,visibleElements:e}=this,i=(s=this.viewModel)==null?void 0:s.content,{contentViewModels:r}=this.viewModel;if(Array.isArray(i))i.forEach((n,o)=>{if(n.type==="attachments"&&(this._contentWidgets[o]=new gBt({displayType:n.displayType,headingLevel:e.title&&t<6?t+1:t,viewModel:r[o]})),n.type==="fields"&&(this._contentWidgets[o]=new YBe({viewModel:r[o]})),n.type==="media"&&(this._contentWidgets[o]=new rje({viewModel:r[o]})),n.type==="text"&&(this._contentWidgets[o]=new LV({viewModel:r[o]})),n.type==="custom"&&(this._contentWidgets[o]=new LV({viewModel:r[o]})),n.type==="expression"&&(this._contentWidgets[o]=new vHt({viewModel:r[o]})),n.type==="relationship"){const a=new Exe({viewModel:r[o]});this._addFeatureRelationshipHandles(a),this._contentWidgets[o]=a}},this);else{const n=r[0];n&&!n.destroyed&&(this._contentWidgets[0]=new LV({viewModel:n}))}this.scheduleRender()}};h([p()],Io.prototype,"graphic",null),h([p()],Io.prototype,"defaultPopupTemplateEnabled",null),h([p()],Io.prototype,"flowItems",void 0),h([p()],Io.prototype,"headingLevel",void 0),h([p({readOnly:!0})],Io.prototype,"isTable",null),h([p()],Io.prototype,"icon",null),h([p()],Io.prototype,"label",null),h([p(),qo("esri/widgets/Feature/t9n/Feature")],Io.prototype,"messages",void 0),h([p(),qo("esri/t9n/common")],Io.prototype,"messagesCommon",void 0),h([p()],Io.prototype,"spatialReference",null),h([p()],Io.prototype,"timeZone",null),h([p({readOnly:!0})],Io.prototype,"title",null),h([p()],Io.prototype,"visibleElements",void 0),h([Qt("visibleElements")],Io.prototype,"castVisibleElements",null),h([p()],Io.prototype,"map",null),h([p()],Io.prototype,"view",null),h([p({type:Tce})],Io.prototype,"viewModel",void 0),Io=Pie=h([I("esri.widgets.Feature")],Io);const THt=Io;let LT=class extends Ls.EventedAccessor{constructor(e){super(e),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([jo(()=>{const i=this.screenLocationEnabled?this.view:null;return i?[i.size,i.type==="3d"?i.camera:i.viewpoint]:null},()=>this.notifyChange("screenLocation")),te(()=>this.screenLocation,(i,r)=>{i!=null&&r!=null&&this.emit("view-change")})])}destroy(){this.view=null}get screenLocation(){const{location:e,view:i,screenLocationEnabled:r}=this,s=i==null?void 0:i.spatialReference,n=s?eAe(e,s).geometry:null;return r&&n&&(i!=null&&i.ready)?i.toScreen(n):null}};h([p()],LT.prototype,"location",void 0),h([p()],LT.prototype,"screenLocation",null),h([p()],LT.prototype,"screenLocationEnabled",void 0),h([p()],LT.prototype,"view",void 0),LT=h([I("esri.widgets.support.AnchorElementViewModel")],LT);const Jje=LT;let rz=class extends Jje{constructor(e){super(e),this.visible=!1}};h([p()],rz.prototype,"visible",void 0),rz=h([I("esri.widgets.Spinner.SpinnerViewModel")],rz);const Qje=rz,WW="esri-spinner",ZW={base:WW,spinnerStart:`${WW}--start`,spinnerFinish:`${WW}--finish`};let DT=class extends Wo{constructor(e,i){super(e,i),this._animationDelay=500,this._animationPromise=null,this.viewModel=new Qje}initialize(){this.addHandles(te(()=>this.visible,e=>this._visibleChange(e)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}show(e){const{location:i,promise:r}=e??{};i&&(this.viewModel.location=i),this.visible=!0;const s=()=>this.hide();r&&r.catch(()=>{}).then(s)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:i}=this.viewModel,r=!!i,s=e&&r,n=!e&&r,o={[ZW.spinnerStart]:s,[ZW.spinnerFinish]:n},a=this._getPositionStyles();return Q("div",{class:this.classes(ZW.base,o),styles:a})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const i=KS(this._animationDelay);this._animationPromise=i,i.catch(()=>{}).then(()=>{this._animationPromise===i&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:i}=this.viewModel;if(i==null||e==null)return{};const{padding:r}=i;return{left:e.x-r.left+"px",top:e.y-r.top+"px"}}};h([p()],DT.prototype,"location",null),h([p()],DT.prototype,"view",null),h([p({type:Qje})],DT.prototype,"viewModel",void 0),h([p()],DT.prototype,"visible",null),DT=h([I("esri.widgets.Spinner")],DT);const SHt=DT,kl="esri-features",$a={icon:`${kl}__icon`,actionImage:`${kl}__action-image`,base:kl,container:`${kl}__container`,contentContainer:`${kl}__content-container`,contentFeature:`${kl}__content-feature`,flowItemCollapsed:`${kl}__flow-item--collapsed`,header:`${kl}__header`,footer:`${kl}__footer`,featureMenuObserver:`${kl}__feature-menu-observer`,actionExit:`${kl}__action--exit`,loader:`${kl}__loader`,featuresHeading:`${kl}__heading`,paginationActionBar:`${kl}__pagination-action-bar`,paginationPrevious:`${kl}__pagination-previous`,paginationNext:`${kl}__pagination-next`};let NT=class extends Wo{constructor(e,i){super(e,i),this.messages=null,this.closed=!1,this.closable=!0,this._handleOpenRelatedFeature=r=>{this.emit("open-related-feature",{feature:r})}}loadDependencies(){return Cp({action:()=>oe(()=>import("./calcite-action-Dhk8OhY7.js"),__vite__mapDeps([248,245,200,201,202,205,206,207,208,204,209,210])),"flow-item":()=>oe(()=>import("./calcite-flow-item-f0hju3wh.js"),__vite__mapDeps([249,200,201,202,205,206,207,208,250,245,204,209,210,215,216,251,217,218,243]))})}render(){const{flowItems:e}=this,i=e==null?void 0:e.toArray();return Q(nzt,null,i==null?void 0:i.map(r=>this._renderRelatedRecordsFlowItem(r)))}_handleCloseClick(){this.emit("close")}_handleExitClick(){this.emit("exit")}_handleRelatedRecordsBackClick(){var i;const e=(i=this.flowItems)==null?void 0:i.pop();e&&("showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e&&(e.viewModel=null,e.destroy()))}_renderRelatedRecordsFlowItem(e){var l;const{messages:i,closable:r,closed:s}=this,n="graphic"in e&&!e.isTable&&((l=e.graphic)==null?void 0:l.geometry),o=i.exitRelatedRecords,a=i.selectFeature;return Q("calcite-flow-item",{bind:this,closable:r,closed:s,description:this._getRelatedRecordsFlowItemDescription(e),heading:e.title??"",key:`flow-item-${e.viewModel.uid}`,onCalciteFlowItemBack:c=>{c.preventDefault(),this._handleRelatedRecordsBackClick()},onCalciteFlowItemClose:this._handleCloseClick},Q("calcite-action",{appearance:"transparent",bind:this,class:$a.actionExit,icon:"move-up",key:"exit-related-records-action",onclick:this._handleExitClick,slot:"header-actions-start",text:o,title:o}),n?Q("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-related-feature-action",onclick:()=>this._handleOpenRelatedFeature(e),slot:"header-actions-end",text:a,title:a}):null,Q("div",{class:$a.container},e.render()))}_getRelatedRecordsFlowItemDescription(e){return"featureCountDescription"in e?e.featureCountDescription:e.viewModel.description??""}};h([p()],NT.prototype,"flowItems",void 0),h([p(),qo("esri/widgets/Features/t9n/Features")],NT.prototype,"messages",void 0),h([p()],NT.prototype,"closed",void 0),h([p()],NT.prototype,"closable",void 0),NT=h([I("esri.widgets.Features.FeaturesRelatedRecords")],NT);const EHt=NT;let CHt=class{constructor(e){this._observable=new _O,this._set=new Set(e)}get size(){return Ft(this._observable),this._set.size}add(e){const i=this._set.size;return this._set.add(e),this._set.size!==i&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(e){const i=this._set.delete(e);return i&&this._observable.notify(),i}entries(){return Ft(this._observable),this._set.entries()}forEach(e,i){Ft(this._observable),this._set.forEach((r,s)=>e.call(i,r,s,this),i)}has(e){return Ft(this._observable),this._set.has(e)}keys(){return Ft(this._observable),this._set.keys()}values(){return Ft(this._observable),this._set.values()}[Symbol.iterator](){return Ft(this._observable),this._set[Symbol.iterator]()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}};var va;(function(t){t[t.size=22]="size",t[t.lineWidth=50]="lineWidth",t[t.maxSize=120]="maxSize",t[t.maxOutlineSize=80]="maxOutlineSize",t[t.tallSymbolWidth=20]="tallSymbolWidth"})(va||(va={}));const yL={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],meshSymbol3DFill:[{type:"path",path:"M -10,-8 L 6,0 L 6,6 L -10,6 L -10,-8 Z"},{type:"path",path:"M -10,-8 L -7,-10 L 9,-2 L 6,0 L -10,-8 Z"},{type:"path",path:"M 6,0 L 9,-2 L 9,4 L 6,6 L 6,0 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};function MHt(t,e,i){const r=va.size;let s=r,n=r;t<1?s*=.75:t>1&&(n*=1.25);const o=0,a=0;let l=r,c=r;return e&&i&&(s=n=l=c=0),[{type:"path",path:[{command:"M",values:[l,o]},{command:"L",values:[i?l:.875*l,o]},{command:"L",values:[i?s-.5*l:a,n-.5*c]},{command:"L",values:[s-.5*l,n-.5*c]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[l,o]},{command:"L",values:[l,e?o:.125*c]},{command:"L",values:[s-.5*l,e?n-.5*c:c]},{command:"L",values:[s-.5*l,n-.5*c]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[s-.5*l,n-.5*c]},{command:"L",values:[i?s-.5*l:a,n-.5*c]},{command:"L",values:[i?s-.5*l:a,e?n-.5*c:c]},{command:"L",values:[s-.5*l,e?n-.5*c:c]},{command:"Z",values:[]}]}]}function AHt(t){const e=va.size,i=.5*t,r=0,s=0;return[{type:"path",path:[{command:"M",values:[s,.7*e*.5]},{command:"L",values:[.3*e,.7*e]},{command:"L",values:[.3*e,.7*e+i]},{command:"L",values:[s,.7*e+i-.7*e*.5]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*e,.7*e]},{command:"L",values:[.3*e,.7*e+i]},{command:"L",values:[e,i]},{command:"L",values:[e,r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*e,r]},{command:"L",values:[e,r]},{command:"L",values:[.3*e,.7*e]},{command:"L",values:[s,.7*e*.5]},{command:"Z",values:[]}]}]}function PHt(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]}function OHt(t,e){let i=e?va.tallSymbolWidth:t;const r=t,s=e?4:6;i<=va.size?i-=.5*s:i-=s;const n=0,o=0,a=e?.35*i:.5*i;return[{type:"path",path:[{command:"M",values:[.5*i,n]},{command:"L",values:[i,.5*a]},{command:"L",values:[.5*i,a]},{command:"L",values:[o,.5*a]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[n,.5*a]},{command:"L",values:[.5*i,a]},{command:"L",values:[.5*i,r]},{command:"L",values:[o,r-.5*a]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*i,a]},{command:"L",values:[.5*i,r]},{command:"L",values:[i,r-.5*a]},{command:"L",values:[i,.5*a]},{command:"Z",values:[]}]}]}function $Ht(t,e){let i=e?va.tallSymbolWidth:t;const r=t,s=e?4:6;i<=va.size?i-=.5*s:i-=s;const n=.5*i,o=.15*i,a=0,l=r-o;return[{type:"ellipse",cx:.5*i,cy:l,rx:n,ry:o},{type:"path",path:[{command:"M",values:[a,o]},{command:"L",values:[a,l]},{command:"L",values:[i,l]},{command:"L",values:[i,o]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*i,cy:o,rx:n,ry:o}]}function RHt(t,e){let i=e?va.tallSymbolWidth:t;const r=t,s=e?4:6;i<=va.size?i-=.5*s:i-=s;const n=.15*i,o=r-n;return[{type:"ellipse",cx:.5*i,cy:o,rx:.5*i,ry:n},{type:"path",path:[{command:"M",values:[.5*i,0]},{command:"L",values:[i,o]},{command:"L",values:[0,o]},{command:"Z",values:[]}]}]}function IHt(t){let e=t;const i=t,r=6;e<va.size?e-=.5*r:e-=r;const s=.15*e,n=0;return[{type:"path",path:[{command:"M",values:[0,n]},{command:"L",values:[e,n]},{command:"L",values:[.5*e,i-s]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*e,cy:n,rx:.5*e,ry:s}]}function LHt(t){let e=t;const i=t,r=4;e<va.size?e-=.5*r:e-=r;const s=0,n=0,o=e,a=i,l=Math.floor(t/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*o,s]},{command:"L",values:[o,.5*a-l]},{command:"L",values:[.45*o-l,.5*a+l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*o,s]},{command:"L",values:[.45*o-l,.5*a+l]},{command:"L",values:[n,.5*a-l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[n,.5*a-l]},{command:"L",values:[.45*o-l,.5*a+l]},{command:"L",values:[.45*o,i]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*o,i]},{command:"L",values:[o,.5*a-l]},{command:"L",values:[.45*o-l,.5*a+l]},{command:"Z",values:[]}]}]}function DHt(t){const e=t,i=2;let r=t;r<va.size?r-=.5*i:r-=i;const s=0,n=0;return[{type:"path",path:[{command:"M",values:[.45*e,s]},{command:"L",values:[e,r]},{command:"L",values:[.45*e,.6*r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*e,s]},{command:"L",values:[.45*e,.6*r]},{command:"L",values:[n,r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[n,r]},{command:"L",values:[.45*e,.6*r]},{command:"L",values:[e,r]},{command:"Z",values:[]}]}]}function Ib(t,e){return Math.round(Math.min(Math.max(t+255*e*.75,0),255))}function Vmi(t,e){if(t==null)return new je;if("type"in t&&(t.type==="linear"||t.type==="pattern"))return t;const i=new je(t);return new je([Ib(i.r,e),Ib(i.g,e),Ib(i.b,e),i.a])}const NHt="http://www.w3.org/2000/svg";let FHt=0,kHt=0;const $xe=ue("android"),UHt=ue("chrome")||$xe&&$xe>=4?"auto":"optimizeLegibility",VHt={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},zHt=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let Tn={},qr={};const BHt=Math.PI;let jHt=1;function uA(t,e){const i=t*(BHt/180);return Math.abs(e*Math.sin(i))+Math.abs(e*Math.cos(i))}function Kje(t){return t.map(e=>`${e.command} ${e.values.join(" ")}`).join(" ").trim()}function eGe(t,e,i,r,s){if(t){if(t.type==="circle")return Q("circle",{cx:t.cx,cy:t.cy,fill:e,"fill-rule":"evenodd",r:t.r,stroke:i.color,"stroke-dasharray":i.dashArray,"stroke-dashoffset":i.dashOffset,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-miterlimit":"4","stroke-width":i.width});if(t.type==="ellipse")return Q("ellipse",{cx:t.cx,cy:t.cy,fill:e,"fill-rule":"evenodd",rx:t.rx,ry:t.ry,stroke:i.color,"stroke-dasharray":i.dashArray,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-miterlimit":"4","stroke-width":i.width});if(t.type==="rect")return Q("rect",{fill:e,"fill-rule":"evenodd",height:t.height,stroke:i.color,"stroke-dasharray":i.dashArray,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-miterlimit":"4","stroke-width":i.width,width:t.width,x:t.x,y:t.y});if(t.type==="image")return Q("image",{alt:s||"image",height:t.height,href:t.src,preserveAspectRatio:"none",width:t.width,x:t.x,y:t.y});if(t.type==="path"){const n=typeof t.path!="string"?Kje(t.path):t.path;return Q("path",{d:n,fill:e,"fill-rule":"evenodd",stroke:i.color,"stroke-dasharray":i.dashArray,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-miterlimit":"4","stroke-width":i.width})}if(t.type==="text")return F2(r),Q("text",{"dominant-baseline":r.dominantBaseline,fill:e,"fill-rule":"evenodd","font-family":r.font.family,"font-size":r.font.size,"font-style":r.font.style,"font-variant":r.font.variant,"font-weight":r.font.weight,kerning:r.kerning,rotate:r.rotate,stroke:i.color,"stroke-dasharray":i.dashArray,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-miterlimit":"4","stroke-width":i.width,"text-anchor":r.align,"text-decoration":r.decoration,"text-rendering":UHt,x:t.x,y:t.y},t.text)}return null}function tGe(t){const e={fill:"none",pattern:null,linearGradient:null};if(t){if("type"in t&&t.type==="pattern"){const i="patternId-"+ ++FHt;e.fill=`url(#${i})`,e.pattern={id:i,x:t.x,y:t.y,width:t.width,height:t.height,image:{x:0,y:0,width:t.width,height:t.height,href:t.src}}}else if("type"in t&&t.type==="linear"){const i="linearGradientId-"+ ++kHt;e.fill=`url(#${i})`,e.linearGradient={id:i,x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,stops:t.colors.map(r=>({offset:r.offset,color:r.color&&new je(r.color).toString()}))}}else if(t){const i=new je(t);e.fill=i.toString()}}return e}function iGe(t){const e={color:"none",width:1,cap:"butt",join:"4",dashArray:"none",dashOffset:"0"};return t&&(t.width!=null&&(e.width=t.width),t.cap&&(e.cap=t.cap),t.join&&(e.join=t.join.toString()),t.color&&(e.color=new je(t.color).toString()),t.dashArray&&(e.dashArray=t.dashArray),t.dashoffset&&(e.dashOffset=t.dashoffset),t.style&&!t.dashArray&&(e.dashArray=x5e(t).join(",")||"none")),e}function rGe(t,e){const i={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};if(t){const r=t.alignBaseline,s=r==="baseline"?"auto":r==="top"?"text-top":r==="bottom"?"hanging":r;i.align=t.align,i.dominantBaseline=s,i.decoration=t.decoration,i.kerning=t.kerning?"auto":"0",i.rotate=t.rotated?"90":"0",F2(e),i.font.style=e.style||"normal",i.font.variant=e.variant||"normal",i.font.weight=e.weight||"normal",i.font.size=e.size&&e.size.toString()||"10pt",i.font.family=e.family||"serif"}return i}function GHt(t){const{pattern:e,linearGradient:i}=t;if(e)return Q("pattern",{height:e.height,id:e.id,patternUnits:"userSpaceOnUse",width:e.width,x:e.x,y:e.y},Q("image",{height:e.image.height,href:e.image.href,width:e.image.width,x:e.image.x,y:e.image.y}));if(i){const r=i.stops.map((s,n)=>Q("stop",{key:`${n}-stop`,offset:s.offset,"stop-color":s.color}));return Q("linearGradient",{gradientUnits:"userSpaceOnUse",id:i.id,x1:i.x1,x2:i.x2,y1:i.y1,y2:i.y2},r)}return null}function HHt(t,e){if(!t||t.length===0)return null;const i=[];for(const r of t){const{shape:s,fill:n,stroke:o,font:a}=r,l=tGe(n),c=iGe(o),u=s.type==="text"?rGe(s,a):null,d=eGe(s,l.fill,c,u);d&&i.push(d)}return Q("mask",{id:e,maskUnits:"userSpaceOnUse"},Q("g",null,i))}function Rxe(t,e,i){return e5e(t,S8(t),[e,i])}function Ixe(t,e,i,r,s){return K4e(t,S8(t),[e,i]),t[4]=t[4]*e-r*e+r,t[5]=t[5]*i-s*i+s,t}function qHt(t,e,i,r){const s=e%360*Math.PI/180;Q4e(t,S8(t),s);const n=Math.cos(s),o=Math.sin(s),a=t[4],l=t[5];return t[4]=a*n-l*o+r*o-i*n+i,t[5]=l*n+a*o-i*o-r*n+r,t}function Sc(t,e){Tn&&"left"in Tn?(Tn.left!=null&&Tn.left>t&&(Tn.left=t),(Tn.right==null||Tn.right<t)&&(Tn.right=t),(Tn.top==null||Tn.top>e)&&(Tn.top=e),(Tn.bottom==null||Tn.bottom<e)&&(Tn.bottom=e)):Tn={left:t,bottom:e,right:t,top:e}}function Lxe(t){const e=t.args,i=e.length;let r;switch(t.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(r=0;r<i;r+=2)Sc(e[r],e[r+1]);qr.x=e[i-2],qr.y=e[i-1];break;case"H":for(r=0;r<i;++r)Sc(e[r],qr.y);qr.x=e[i-1];break;case"V":for(r=0;r<i;++r)Sc(qr.x,e[r]);qr.y=e[i-1];break;case"m":{let s=0;for(("x"in qr)||(Sc(qr.x=e[0],qr.y=e[1]),s=2),r=s;r<i;r+=2)Sc(qr.x+=e[r],qr.y+=e[r+1]);break}case"l":case"t":for(r=0;r<i;r+=2)Sc(qr.x+=e[r],qr.y+=e[r+1]);break;case"h":for(r=0;r<i;++r)Sc(qr.x+=e[r],qr.y);break;case"v":for(r=0;r<i;++r)Sc(qr.x,qr.y+=e[r]);break;case"c":for(r=0;r<i;r+=6)Sc(qr.x+e[r],qr.y+e[r+1]),Sc(qr.x+e[r+2],qr.y+e[r+3]),Sc(qr.x+=e[r+4],qr.y+=e[r+5]);break;case"s":case"q":for(r=0;r<i;r+=4)Sc(qr.x+e[r],qr.y+e[r+1]),Sc(qr.x+=e[r+2],qr.y+=e[r+3]);break;case"A":for(r=0;r<i;r+=7)Sc(e[r+5],e[r+6]);qr.x=e[i-2],qr.y=e[i-1];break;case"a":for(r=0;r<i;r+=7)Sc(qr.x+=e[r+5],qr.y+=e[r+6])}}function Dxe(t,e,i){const r=VHt[t.toLowerCase()];let s;typeof r=="number"&&(r?e.length>=r&&(s={action:t,args:e.slice(0,e.length-e.length%r)},i.push(s),Lxe(s)):(s={action:t,args:[]},i.push(s),Lxe(s)))}function WHt(t){const e=(typeof t.path!="string"?Kje(t.path):t.path).match(zHt),i=[];if(Tn={},qr={},!e)return null;let r="",s=[];const n=e.length;for(let a=0;a<n;++a){const l=e[a],c=parseFloat(l);isNaN(c)?(r&&Dxe(r,s,i),s=[],r=l):s.push(c)}Dxe(r,s,i);const o={x:0,y:0,width:0,height:0};return Tn&&"left"in Tn&&(o.x=Tn.left,o.y=Tn.top,o.width=Tn.right-Tn.left,o.height=Tn.bottom-Tn.top),o}function ZHt(t){const e={x:0,y:0,width:0,height:0};if(t.type==="circle")e.x=t.cx-t.r,e.y=t.cy-t.r,e.width=2*t.r,e.height=2*t.r;else if(t.type==="ellipse")e.x=t.cx-t.rx,e.y=t.cy-t.ry,e.width=2*t.rx,e.height=2*t.ry;else if(t.type==="image"||t.type==="rect")e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height;else if(t.type==="path"){const i=WHt(t);e.x=i.x,e.y=i.y,e.width=i.width,e.height=i.height}return e}function YHt(t){const e={x:0,y:0,width:0,height:0};let i=null,r=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(const n of t)i?(i.x=Math.min(i.x,n.x),i.y=Math.min(i.y,n.y),r=Math.max(r,n.x+n.width),s=Math.max(s,n.y+n.height)):(i=e,i.x=n.x,i.y=n.y,r=n.x+n.width,s=n.y+n.height);return i&&(i.width=r-i.x,i.height=s-i.y),i}function XHt(t,e,i,r,s,n,o,a,l){let c=(o&&n?uA(n,e):e)/2,u=(o&&n?uA(n,i):i)/2;if(l){const w=l[0],x=l[1];c=(o&&n?uA(n,w):w)/2,u=(o&&n?uA(n,x):x)/2}const d=t.width+r,f=t.height+r,m=see(),g=see();let y=!1;if(s&&d!==0&&f!==0){const w=e!==i?e/i:d/f,x=e>i?e:i;let T=1,E=1;isNaN(x)||(w>1?(T=x/d,E=x/w/f):(E=x/f,T=x*w/d)),YT(g,g,Ixe(m,T,E,c,u)),y=!0}const v=t.x+(d-r)/2,b=t.y+(f-r)/2;if(YT(g,g,Rxe(m,c-v,u-b)),!y&&(d>e||f>i)){const w=d/e>f/i,x=(w?e:i)/(w?d:f);YT(g,g,Ixe(m,x,x,v,b))}return n&&YT(g,g,qHt(m,n,v,b)),a&&YT(g,g,Rxe(m,a[0],a[1])),`matrix(${g[0]},${g[1]},${g[2]},${g[3]},${g[4]},${g[5]})`}function JHt(t,e,i){const r=t==null?void 0:t.effects.find(c=>c.type==="bloom");if(!r)return null;const{strength:s,radius:n}=r,o=s>0?n:0,a=(s+o)*e,l=4*s+1;return Q("filter",{filterUnits:"userSpaceOnUse",height:"300%",id:`bloom${i}`,width:"300%",x:"-100%",y:"-100%"},Q("feMorphology",{in:"SourceGraphic",operator:"dilate",radius:(s+.5*o)*(5**(e/100)*(.4+e/100)),result:"dilate"}),Q("feGaussianBlur",{in:"dilate",result:"blur",stdDeviation:a/25}),Q("feGaussianBlur",{in:"blur",result:"intensityBlur",stdDeviation:a/50}),Q("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},Q("feFuncR",{slope:l,type:"linear"}),Q("feFuncG",{slope:l,type:"linear"}),Q("feFuncB",{slope:l,type:"linear"})),Q("feMerge",null,Q("feMergeNode",{in:"intensityBlur"}),Q("feMergeNode",{in:"intensityBrightness"}),Q("feGaussianBlur",{stdDeviation:s/10})))}function QHt(t,e,i,r={}){var u;const s=[],n=[],o=++jHt,a=JHt(r.effectView,e,o);let l=null;if(a){const d=(u=r.effectView)==null?void 0:u.effects.find(y=>y.type==="bloom"),f=(d.strength?d.strength+d.radius/2:0)/3,m=e+e*f,g=i+i*f;l=[Math.max(m,10),Math.max(g,10)]}for(let d=0;d<t.length;d++){const f=t[d],m=[],g=[];let y=0,v=0,b=0;for(const T of f){const{shape:E,fill:M,stroke:O,font:D,offset:U}=T;r.ignoreStrokeWidth||E.type==="text"||(y+=(O==null?void 0:O.width)||0);const k=tGe(M),H=iGe(O),V=E.type==="text"?rGe(E,D):null;s.push(GHt(k)),m.push(eGe(E,k.fill,H,V,r.ariaLabel)),g.push(ZHt(E)),U&&(v+=U[0],b+=U[1])}const w=XHt(YHt(g),e,i,y,r.scale??!1,r.rotation,r.useRotationSize??!1,[v,b],l);let x=null;if(r.masking){const T=`mask-${d}`,E=r.masking[d];s.push(HHt(E,T)),x=`url(#${T})`}n.push(x?Q("g",{mask:x},Q("g",{transform:w},m)):Q("g",{transform:w},m))}return r.useRotationSize&&r.rotation&&(e=uA(r.rotation,e),i=uA(r.rotation,i)),a&&(F2(l),e=l[0],i=l[1]),Q("svg",{"aria-label":r.ariaLabel,focusable:!1,height:i,role:"img",style:"display: block;",width:e,xmlns:NHt},a,Q("defs",null,s),a?Q("g",{filter:`url(#bloom${o})`},n):n)}const Nxe=TX();function KHt(t,e){Nxe.append(t,e),Nxe.detach(e)}function Y8(t,e,i){const r=Math.ceil(e[0]),s=Math.ceil(e[1]);if(!t.some(o=>!!o.length))return null;const n=(i==null?void 0:i.node)||document.createElement("div");return i.opacity!=null&&(n.style.opacity=i.opacity.toString()),i.effectView!=null&&(n.style.filter=C5e(i.effectView)),KHt(n,()=>QHt(t,r,s,i)),n}function eqt(t,e){t=Math.ceil(t),e=Math.ceil(e);const i=document.createElement("canvas");i.width=t,i.height=e,i.style.width=t+"px",i.style.height=e+"px";const r=i.getContext("2d");return r.clearRect(0,0,t,e),r}function tqt(t,e,i){return t?fr(t,{responseType:"image"}).then(r=>{const s=r.data,n=s.width,o=s.height,a=n/o;let l=e;if(i){const c=Math.max(n,o);l=Math.min(l,c)}return{image:s,width:a<=1?Math.ceil(l*a):l,height:a<=1?l:Math.ceil(l/a)}}):Promise.reject(new B("renderUtils: imageDataSize","href not provided."))}function iqt(t,e){return!(!t||e==="ignore")&&(e!=="multiply"||t.r!==255||t.g!==255||t.b!==255||t.a!==1)}function rqt(t,e,i,r,s){switch(s){case"multiply":t[e]*=i[0],t[e+1]*=i[1],t[e+2]*=i[2],t[e+3]*=i[3];break;default:{const n=C6({r:t[e],g:t[e+1],b:t[e+2]});n.h=r.h,n.s=r.s,n.v=n.v/100*r.v;const o=iE(n);t[e]=o.r,t[e+1]=o.g,t[e+2]=o.b,t[e+3]*=i[3];break}}}function sqt(t,e,i,r,s){return tqt(t,e,s).then(n=>{const o=n.width??e,a=n.height??e;if(n.image&&iqt(i,r)){let l=n.image.width,c=n.image.height;ue("edge")&&/\.svg$/i.test(t)&&(l-=1,c-=1);const u=eqt(o,a);u.drawImage(n.image,0,0,l,c,0,0,o,a);const d=u.getImageData(0,0,o,a),f=[i.r/255,i.g/255,i.b/255,i.a],m=C6(i);for(let g=0;g<d.data.length;g+=4)rqt(d.data,g,f,m,r);u.putImageData(d,0,0),t=u.canvas.toDataURL("image/png")}else{const l=Ci==null?void 0:Ci.findCredential(t);if(l!=null&&l.token){const c=t.includes("?")?"&":"?";t=`${t}${c}token=${l.token}`}}return{url:t,width:o,height:a}}).catch(()=>({url:t,width:e,height:e}))}const tS=va.size,sz=va.maxSize,Sce=va.maxOutlineSize,Fxe=va.lineWidth,Oie=va.tallSymbolWidth;function hA(t){const e=t.outline,i=t.material!=null?t.material.color:null,r=i!=null?i.toHex():null;if(e==null||"pattern"in e&&e.pattern!=null&&e.pattern.type==="style"&&e.pattern.style==="none")return t.type==="fill"&&r==="#ffffff"?{color:"#bdc3c7",width:.75}:null;const s=mr(e.size)||0;return{color:"rgba("+(e.color!=null?e.color.toRgba():"255,255,255,1")+")",width:Math.min(s,Sce),style:"pattern"in e&&e.pattern!=null&&e.pattern.type==="style"?Wae(e.pattern.style):null,join:"butt",cap:"patternCap"in e?e.patternCap:"butt"}}async function nqt(t,e){var r,s,n;if((r=t.thumbnail)!=null&&r.url)return t.thumbnail.url;if(e.type==="icon"&&((s=e==null?void 0:e.resource)==null?void 0:s.href))return T5e(e);const i=tr("esri/images/Legend/legend3dsymboldefault.png");if(t.styleOrigin&&(t.styleOrigin.styleName||t.styleOrigin.styleUrl)){const o=await mke(t.styleOrigin,{portal:t.styleOrigin.portal},"webRef").catch(()=>null);if(o&&"thumbnail"in o&&((n=o.thumbnail)!=null&&n.url))return o.thumbnail.url}return i}function YW(t,e=1){const i=t.a,r=C6(t),s=r.h,n=r.s/e,o=100-(100-r.v)/e,{r:a,g:l,b:c}=iE({h:s,s:n,v:o});return[a,l,c,i]}function Zj(t){var e;return t.type==="water"?t.color==null?null:t.color:((e=t.material)==null?void 0:e.color)==null?null:t.material.color}function Yr(t,e=0){const i=Zj(t);if(!i){if(t.type==="fill")return null;const s=oCt.r,n=Ib(s,e);return[n,n,n,100]}const r=i.toRgba();for(let s=0;s<3;s++)r[s]=Ib(r[s],e);return r}async function sGe(t,e){const i=t.style;return i==="none"?null:{type:"pattern",x:0,y:0,src:await nCt(tr(`esri/symbols/patterns/${i}.png`),e.toCss(!0)),width:5,height:5}}function kxe(t){return t.outline?hA(t):{color:"rgba(0, 0, 0, 1)",width:1.5}}function Ece(t,e){const i=Zj(t);if(!i)return null;let r="rgba(";return r+=Ib(i.r,e)+",",r+=Ib(i.g,e)+",",r+=Ib(i.b,e)+",",r+i.a+");"}function $ie(t,e){const i=Ece(t,e);return i?"pattern"in t&&t.pattern!=null&&t.pattern.type==="style"&&t.pattern.style==="none"?null:{color:i,width:Math.min(t.size?mr(t.size):.75,Sce),style:"pattern"in t&&t.pattern!=null&&t.pattern.type==="style"?Wae(t.pattern.style):null,cap:"cap"in t?t.cap:null,join:"join"in t?t.join==="miter"?mr(2):t.join:null}:{}}function vk(t,e,i){const r=i!=null?.75*i:0;return{type:"linear",x1:r?.25*r:0,y1:r?.5*r:0,x2:r||4,y2:r?.5*r:4,colors:[{color:t,offset:0},{color:e,offset:1}]}}function oqt(t){const e=t.depth,i=t.height,r=t.width;return r!==0&&e!==0&&i!==0&&r===e&&r!=null&&i!=null&&r<i}function aqt(t,e,i){var s,n;const r=[];if(!t)return r;switch(t.type){case"icon":{const l=e,c=e;switch(((s=t.resource)==null?void 0:s.primitive)??J$e){case"circle":r.push({shape:{type:"circle",cx:0,cy:0,r:.5*e},fill:Yr(t,0),stroke:hA(t)});break;case"square":r.push({shape:{type:"path",path:[{command:"M",values:[0,c]},{command:"L",values:[0,0]},{command:"L",values:[l,0]},{command:"L",values:[l,c]},{command:"Z",values:[]}]},fill:Yr(t,0),stroke:hA(t)});break;case"triangle":r.push({shape:{type:"path",path:[{command:"M",values:[0,c]},{command:"L",values:[.5*l,0]},{command:"L",values:[l,c]},{command:"Z",values:[]}]},fill:Yr(t,0),stroke:hA(t)});break;case"cross":r.push({shape:{type:"path",path:[{command:"M",values:[.5*l,0]},{command:"L",values:[.5*l,c]},{command:"M",values:[0,.5*c]},{command:"L",values:[l,.5*c]}]},stroke:kxe(t)});break;case"x":r.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,c]},{command:"M",values:[l,0]},{command:"L",values:[0,c]}]},stroke:kxe(t)});break;case"kite":r.push({shape:{type:"path",path:[{command:"M",values:[0,.5*c]},{command:"L",values:[.5*l,0]},{command:"L",values:[l,.5*c]},{command:"L",values:[.5*l,c]},{command:"Z",values:[]}]},fill:Yr(t,0),stroke:hA(t)})}break}case"object":switch(((n=t.resource)==null?void 0:n.primitive)??Cne){case"cone":{const o=vk(Yr(t,0),Yr(t,-.6),i?Oie:e),a=RHt(e,i);r.push({shape:a[0],fill:o},{shape:a[1],fill:o});break}case"inverted-cone":{const o=Yr(t,0),a=vk(o,Yr(t,-.6),e),l=IHt(e);r.push({shape:l[0],fill:a},{shape:l[1],fill:o});break}case"cube":{const o=OHt(e,i);r.push({shape:o[0],fill:Yr(t,0)},{shape:o[1],fill:Yr(t,-.3)},{shape:o[2],fill:Yr(t,-.5)});break}case"cylinder":{const o=vk(Yr(t,0),Yr(t,-.6),i?Oie:e),a=$Ht(e,i);r.push({shape:a[0],fill:o},{shape:a[1],fill:o},{shape:a[2],fill:Yr(t,0)});break}case"diamond":{const o=LHt(e);r.push({shape:o[0],fill:Yr(t,-.3)},{shape:o[1],fill:Yr(t,0)},{shape:o[2],fill:Yr(t,-.3)},{shape:o[3],fill:Yr(t,-.7)});break}case"sphere":{const o=vk(Yr(t,0),Yr(t,-.6));o.x1=0,o.y1=0,o.x2=.25*e,o.y2=.25*e,r.push({shape:{type:"circle",cx:0,cy:0,r:.5*e},fill:o});break}case"tetrahedron":{const o=DHt(e);r.push({shape:o[0],fill:Yr(t,-.3)},{shape:o[1],fill:Yr(t,0)},{shape:o[2],fill:Yr(t,-.6)});break}}break}return r}function X8(t){const e=typeof(t==null?void 0:t.size)=="number"?t==null?void 0:t.size:null;return e?mr(e):null}function lqt(t){return t.type==="icon"?"multiply":"tint"}async function cqt(t,e){const i=X8(e),r=e!=null&&e.maxSize?mr(e.maxSize):null,s=(e==null?void 0:e.disableUpsampling)??!1,n=t.symbolLayers,o=[];let a=0,l=0;const c=n.at(-1);let u;c&&c.type==="icon"&&(u=c.size&&mr(c.size)),n.forEach(m=>{var v,b;if(m.type!=="icon"&&m.type!=="object")return;const g=m.type==="icon"?m.size&&mr(m.size):0,y=i||g?Math.ceil(Math.min(i||g,r||sz)):tS;if((v=m==null?void 0:m.resource)!=null&&v.href){const w=nqt(t,m).then(x=>{var M;const T=(M=m==null?void 0:m.material)==null?void 0:M.color,E=lqt(m);return sqt(x,y,T,E,s)}).then(x=>{const T=x.width,E=x.height;return a=Math.max(a,T),l=Math.max(l,E),[{shape:{type:"image",x:0,y:0,width:T,height:E,src:x.url},fill:null,stroke:null}]});o.push(w)}else{let w=y;m.type==="icon"&&u&&i&&(w=y*(g/u));const x=(e==null?void 0:e.symbolConfig)==="tall"||((b=e==null?void 0:e.symbolConfig)==null?void 0:b.isTall)||m.type==="object"&&oqt(m);a=Math.max(a,x?Oie:w),l=Math.max(l,w),o.push(Promise.resolve(aqt(m,w,x)))}});const d=await Promise.allSettled(o),f=[];return d.forEach(m=>{m.status==="fulfilled"?f.push(m.value):m.reason&&ne.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",m.reason)}),Y8(f,[a,l],{node:e==null?void 0:e.node,scale:!1,opacity:e==null?void 0:e.opacity,ariaLabel:e==null?void 0:e.ariaLabel})}function uqt(t,e){const i=t.symbolLayers,r=[],s=cCt(t),n=X8(e),o=(e!=null&&e.maxSize?mr(e.maxSize):null)||Sce;let a,l=0,c=0;return i.forEach((u,d)=>{if(!u||u.type!=="line"&&u.type!=="path")return;const f=[];switch(u.type){case"line":{const m=$ie(u,0);if(m==null)break;const g=(m==null?void 0:m.width)||0;d===0&&(a=g);const y=Math.min(n||g,o),v=d===0?y:n?y*(g/a):y,b=v>Fxe/2?2*v:Fxe;c=Math.max(c,v),l=Math.max(l,b),m.width=v,f.push({shape:{type:"path",path:[{command:"M",values:[0,.5*c]},{command:"L",values:[l,.5*c]}]},stroke:m});break}case"path":{const m=Math.min(n||tS,o),g=Yr(u,0),y=Yr(u,-.2),v=Ece(u,-.4),b=v?{color:v,width:1}:{};if(u.profile==="quad"){const w=u.width,x=u.height,T=MHt(w&&x?w/x:1,x===0,w===0),E={...b,join:"bevel"};f.push({shape:T[0],fill:y,stroke:E},{shape:T[1],fill:y,stroke:E},{shape:T[2],fill:g,stroke:E})}else f.push({shape:yL.pathSymbol3DLayer[0],fill:y,stroke:b},{shape:yL.pathSymbol3DLayer[1],fill:g,stroke:b});c=Math.max(c,m),l=c}}r.push(f)}),Promise.resolve(Y8(r,[l,c],{node:e==null?void 0:e.node,scale:s,opacity:e==null?void 0:e.opacity,ariaLabel:e==null?void 0:e.ariaLabel}))}async function hqt(t,e){const i=t.type==="mesh-3d",r=t.symbolLayers,s=X8(e),n=e!=null&&e.maxSize?mr(e.maxSize):null,o=s||tS,a=[];let l=0,c=0,u=!1;for(let d=0;d<r.length;d++){const f=r.at(d),m=[];if(!i||f.type==="fill"){switch(f.type){case"fill":{const g=Math.min(o,n||sz);if(l=Math.max(l,g),c=Math.max(c,g),u=!0,i){const y=yL.meshSymbol3DFill,v=Ece(f,-.4),b=v?{color:v,width:1,join:"round"}:{};m.push({shape:y[0],fill:Yr(f,0),stroke:b},{shape:y[1],fill:Yr(f,-.2),stroke:b},{shape:y[2],fill:Yr(f,-.6),stroke:b})}else{let y=Yr(f,0);const v="pattern"in f?f.pattern:null,b=hA(f),w=Zj(f);v!=null&&v.type==="style"&&v.style!=="solid"&&w&&(y=await sGe(v,w)),m.push({shape:yL.fill[0],fill:y,stroke:b})}break}case"line":{const g=$ie(f,0);if(g==null)break;const y={stroke:g,shape:yL.fill[0]};l=Math.max(l,tS),c=Math.max(c,tS),m.push(y);break}case"extrude":{const g={join:"round",width:1,...$ie(f,-.4)},y=Yr(f,0),v=Yr(f,-.2),b=Math.min(o,n||sz),w=AHt(b);g.width=1,m.push({shape:w[0],fill:v,stroke:g},{shape:w[1],fill:v,stroke:g},{shape:w[2],fill:y,stroke:g});const x=tS,T=.7*tS+.5*b;l=Math.max(l,x),c=Math.max(c,T);break}case"water":{const g=Zj(f),y=YW(g),v=YW(g,2),b=YW(g,3),w=PHt();u=!0,m.push({shape:w[0],fill:y},{shape:w[1],fill:v},{shape:w[2],fill:b});const x=Math.min(o,n||sz);l=Math.max(l,x),c=Math.max(c,x);break}}a.push(m)}}return Y8(a,[l,c],{node:e==null?void 0:e.node,scale:u,opacity:e==null?void 0:e.opacity,ariaLabel:e==null?void 0:e.ariaLabel})}function dqt(t,e){if(t.symbolLayers.length===0)return Promise.reject(new B("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(t.type){case"point-3d":return cqt(t,e);case"line-3d":return uqt(t,e);case"polygon-3d":case"mesh-3d":return hqt(t,e)}return Promise.reject(new B("symbolPreview: swatchInfo3D","symbol not supported."))}const pqt=Object.freeze(Object.defineProperty({__proto__:null,getPatternDescriptor:sGe,getSizeFromOptions:X8,getSymbolLayerFill:Yr,previewSymbol3D:dqt},Symbol.toStringTag,{value:"Module"}));let xC=null;const Uxe=[255,255,255];function Vxe(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function zmi(t,e,i){const{backgroundColor:r,outline:s,dotSize:n}=t,o=(i==null?void 0:i.swatchSize)||va.size,a=.8,l=Math.round(o*o/Math.max(n,.5)**2*a),c=window.devicePixelRatio,u=document.createElement("canvas"),d=o*c;u.width=d,u.height=d,u.style.width=u.width/c+"px",u.style.height=u.height/c+"px";const f=u.getContext("2d");if(r&&(f.fillStyle=r.toCss(!0),f.fillRect(0,0,d,d),f.fill()),f.fillStyle=(e==null?void 0:e.toCss(!0))??"",xC&&xC.length/2===l)for(let g=0;g<2*l;g+=2){const y=xC[g],v=xC[g+1];f.fillRect(y,v,n*c,n*c),f.fill()}else{xC=[];for(let g=0;g<2*l;g+=2){const y=Vxe(0,d),v=Vxe(0,d);xC.push(y,v),f.fillRect(y,v,n*c,n*c),f.fill()}}s&&(s.color&&(f.strokeStyle=s.color.toCss(!0)),f.lineWidth=s.width,f.strokeRect(0,0,d,d));const m=new Image(o,o);return m.src=u.toDataURL(),m.ariaLabel=(i==null?void 0:i.ariaLabel)??null,m.alt=(i==null?void 0:i.ariaLabel)??"",m}function Bmi(t,e={}){const i=e.radius||40,r=2*Math.PI*i,s=t.length,n=r/s,o=[],a=qae(e.outline);(a==null?void 0:a.width)!=null&&(a.width*=2),(a||e.backgroundColor)&&o.push({shape:{type:"circle",cx:i,cy:i,r:i},fill:e.backgroundColor,stroke:a,offset:[0,0]});const l=e.values,c=l&&l.length===s&&l.reduce((g,y)=>g+y,0)===100,u=[0];for(let g=0;g<s;g++){let y=null;c&&(y=l[g]*r/100,u.push(y+u[g])),o.push({shape:{type:"circle",cx:i,cy:i,r:i/2},fill:[0,0,0,0],stroke:{width:i,dashArray:`${(y??n)/2} ${r}`,dashoffset:"-"+(c?u[g]/2:g*(n/2)),color:t[g]},offset:[0,0]})}let d=null;const f=2*i+((a==null?void 0:a.width)||0),m=e.holePercentage;if(m){a&&o.push({shape:{type:"circle",cx:i,cy:i,r:i*m},fill:null,stroke:a,offset:[0,0]});const g=f/2;d=[[{shape:{type:"circle",cx:g,cy:g,r:g},fill:Uxe,stroke:a?{...a,color:Uxe}:null,offset:[0,0]},{shape:{type:"circle",cx:g,cy:g,r:i*m},fill:[0,0,0],stroke:null,offset:[0,0]}]]}return Y8([o],[f,f],{effectView:e.effectList,ignoreStrokeWidth:!0,masking:d,rotation:-90,ariaLabel:e.ariaLabel})}function jmi(t,e={}){const s=e.align==="horizontal",n=s?75:24,o=s?24:75,a=e.width??n,l=e.height??o,c=e.gradient??!0,u=window.devicePixelRatio,d=a*u,f=l*u,m=document.createElement("canvas");m.width=d,m.height=f,m.ariaLabel=e.ariaLabel??null,m.style.width=`${a}px`,m.style.height=`${l}px`;const g=m.getContext("2d"),y=s?d:0,v=s?0:f;if(c){const w=g.createLinearGradient(0,0,y,v),x=t.length,T=x===1?0:1/(x-1);t.forEach((E,M)=>w.addColorStop(M*T,E.toString())),g.fillStyle=w,g.fillRect(0,0,d,f)}else{const w=s?d/t.length:d,x=s?f:f/t.length;let T=0,E=0;for(const M of t)g.fillStyle=M.toString(),g.fillRect(T,E,w,x),T=s?T+w:0,E=s?0:E+x}const b=document.createElement("div");return b.style.width=`${a}px`,b.style.height=`${l}px`,fqt(b,e==null?void 0:e.effectList),b.appendChild(m),b}function fqt(t,e){if(!e)return;t.style.filter=C5e(e);const i=e.effects;if(i){for(const r of i)if((r==null?void 0:r.type)==="drop-shadow"){r.offsetX<0?t.style.marginLeft=`${Math.abs(r.offsetX)}px`:t.style.marginRight=`${r.offsetX}px`;break}}}async function mqt(t,e){switch(t.type){case"web-style":{const{previewWebStyleSymbol:i}=await oe(()=>import("./previewWebStyleSymbol-KKYJ_tQW.js"),[]);return i(t,mqt,e)}case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":{const{previewSymbol3D:i}=await oe(()=>Promise.resolve().then(()=>pqt),void 0);return i(t,e)}case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":{const{previewSymbol2D:i}=await oe(()=>import("./previewSymbol2D-CnE0VD7W.js"),[]);return i(t,e)}case"cim":{const{previewCIMSymbol:i}=await oe(()=>import("./previewCIMSymbol-DA6mZqPI.js"),__vite__mapDeps([252,253]));return i(t,e)}default:return}}function nGe(t){return t&&"opacity"in t?t.opacity*nGe(t.parent):1}async function zxe(t,e){var x;if(!t)return;const i=t.sourceLayer,r=(e!=null&&e.useSourceLayer?i:t.layer)??i,s=nGe(r);if(t.symbol!=null&&(e==null||e.ignoreGraphicSymbol!==!0)){const T=t.symbol.type==="web-style"?await TCt(t.symbol,{...e,cache:e!=null?e.webStyleCache:null}):t.symbol.clone();return K9(T,null,s),T}const n=(e==null?void 0:e.renderer)??gqt(r);let o=n&&"getSymbolAsync"in n?await n.getSymbolAsync(t,e):null;if(!o)return;if(o=o.type==="web-style"?await o.fetchSymbol({...e,cache:e!=null?e.webStyleCache:null}):o.clone(),!n||!("visualVariables"in n)||!((x=n.visualVariables)!=null&&x.length))return K9(o,null,s),o;if("arcadeRequiredForVisualVariables"in n&&n.arcadeRequiredForVisualVariables&&(e==null?void 0:e.arcade)==null){const T={...e};T.arcade=await by(),e=T}const{getColor:a,getOpacity:l,getAllSizes:c,getRotationAngle:u}=await oe(()=>Promise.resolve().then(()=>m8),void 0),d=[],f=[],m=[],g=[];for(const T of n.visualVariables)switch(T.type){case"color":d.push(T);break;case"opacity":f.push(T);break;case"rotation":g.push(T);break;case"size":T.target||m.push(T)}const y=!!d.length&&d[d.length-1],v=y?a(y,t,e):null,b=!!f.length&&f[f.length-1];let w=b?l(b,t,e):null;if(s!=null&&(w=w!=null?w*s:s),K9(o,v,w),m.length){const T=c(m,t,e);await wCt(o,T)}for(const T of g)xCt(o,u(T,t,e),T.axis);return o}function gqt(t){if(t)return"renderer"in t?t.renderer:void 0}const ZS=Ke.ofType({key:"type",defaultKeyValue:"button",base:AO,typeMap:{button:Y2,toggle:_6}}),vS=new Y2({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:r_.zoomInMagnifyingGlass}),Bxe=new Y2({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:r_.trash}),dA=new Y2({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:r_.zoomInMagnifyingGlass}),tb=new _6({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:r_.table,value:!1}),yqt="esri.widgets.Popup.PopupViewModel",Yj=()=>ne.getLogger(yqt),_qt=t=>{const{event:e,view:i,viewModel:r}=t,{action:s}=e;if(!s)return Promise.reject(new B("trigger-action:missing-arguments","Event has no action"));const{disabled:n,id:o}=s;if(!o)return Promise.reject(new B("trigger-action:invalid-action","action.id is missing"));if(n)return Promise.reject(new B("trigger-action:invalid-action","Action is disabled"));if(o===vS.id)return bqt(r).catch(bZ);if(o===dA.id)return wqt(r);if(o===tb.id)return r.browseClusterEnabled=!r.browseClusterEnabled,r.featureMenuOpen=r.browseClusterEnabled,Promise.resolve();if(o===Bxe.id){r.visible=!1;const{selectedFeature:a}=r;if(!a)return Promise.reject(new B(`trigger-action:${Bxe.id}`,"selectedFeature is required",{selectedFeature:a}));const{sourceLayer:l}=a;return l?l.remove(a):i==null||i.graphics.remove(a),Promise.resolve()}return Promise.resolve()};function oGe(t){const{selectedFeature:e,location:i,view:r}=t;return r?e??i??null:null}function iS(t){var e,i;return!!t&&t.isAggregate&&((i=(e=t.sourceLayer)==null?void 0:e.featureReduction)==null?void 0:i.type)==="cluster"}async function vqt(t,e){if((e==null?void 0:e.type)!=="3d"||!t||t.declaredClass!=="esri.Graphic")return!0;const i=e.getViewForGraphic(t);if(i&&"whenGraphicBounds"in i){let r=null;try{r=await i.whenGraphicBounds(t,{useViewElevation:!0})}catch{}return!r||!r.boundingBox||r.boundingBox[0]===r.boundingBox[3]&&r.boundingBox[1]===r.boundingBox[4]&&r.boundingBox[2]===r.boundingBox[5]}return!0}async function bqt(t){var u;const{location:e,selectedFeature:i,view:r,zoomFactor:s}=t,n=oGe(t);if(!r||!n){const d=new B("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:n,view:r});throw Yj().error(d),d}const o=r.scale/s,a=(u=t.selectedFeature)==null?void 0:u.geometry,l=a??e,c=l!=null&&l.type==="point"&&await vqt(i,r);vS.active=!0,vS.disabled=!0;try{await t.zoomTo({target:{target:n,scale:c?o:void 0}})}catch{const f=new B("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:i});Yj().error(f)}finally{vS.active=!1,vS.disabled=!1,t.zoomToLocation=null,c&&(t.location=l)}}async function wqt(t){const{selectedFeature:e,view:i}=t;if((i==null?void 0:i.type)!=="2d"){const o=new B("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw Yj().error(o),o}if(!e||!iS(e)){const o=new B("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:e});throw Yj().error(o),o}const[r,s]=await Cce(i,e);dA.active=!0,dA.disabled=!0;const{extent:n}=await r.queryExtent(s);n&&await t.zoomTo({target:n}),dA.active=!1,dA.disabled=!1}async function xqt(t){const{view:e,selectedFeature:i}=t;if(!e||!i)return;const[r,s]=await Cce(e,i),{extent:n}=await r.queryExtent(s);t.selectedClusterBoundaryFeature.geometry=n,e.graphics.add(t.selectedClusterBoundaryFeature)}async function Tqt(t){const{selectedFeature:e,view:i}=t;if(!i||!e)return;const[r,s]=await Cce(i,e);tb.active=!0,tb.disabled=!0;const{features:n}=await r.queryFeatures(s);tb.active=!1,tb.disabled=!1,tb.value=!0,t==null||t.open({features:[e].concat(n),featureMenuOpen:!0})}async function Cce(t,e){const i=await t.whenLayerView(e.sourceLayer),r=i.createQuery(),s=e.getObjectId();return r.aggregateIds=s!=null?[s]:[],[i,r]}function Sqt(t){tb.value=!1;const e=t.features.filter(i=>iS(i));e.length&&(t.features=e)}const XW="location-scale-handle",Eqt=()=>[vS.clone()],Cqt=()=>[dA.clone(),tb.clone()];let bk=null;function Mqt(t,e){return t==="building-scene"||e==="2d"&&(t==="map-image"||t==="tile"||t==="imagery"||t==="imagery-tile")}let Bi=class extends Jle(Jje){constructor(t){super(t),this._pendingPromises=new CHt,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this.actions=new ZS,this.activeFeature=null,this.autoCloseEnabled=!1,this.browseClusterEnabled=!1,this.content=null,this.defaultPopupTemplateEnabled=!1,this.featurePage=null,this.featuresPerPage=20,this.featureMenuOpen=!1,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new ya({symbol:new H_({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null,this._debouncedLocationUpdate=d_(async e=>{var n,o,a,l;const{spatialReference:i}=this,r=(o=(n=this.selectedFeature)==null?void 0:n.geometry)==null?void 0:o.type,s=this.location??e;if(r&&r!=="mesh"&&i&&s&&this.selectedFeature)if(r!=="point")try{const c=this.selectedFeature;let u=c.geometry;const d=this._getHighlightLayer(c),f=c.getObjectId();if(!d||!this.view)return;if(f){const m=(a=this.view)==null?void 0:a.allLayerViews.find(v=>v.layer.uid===d.uid);if(!m||!("queryFeatures"in m))return;const g=m.createQuery();g.outSpatialReference=i,g.objectIds=[f],g.returnGeometry=!0;const{features:y}=await m.queryFeatures(g);u=(l=y[0])==null?void 0:l.geometry}if(!u||u.type==="mesh")return;if(u=V_(u,i),bk||(bk=await oe(()=>import("./geometryEngineAsync-B74OE8T5.js"),[])),!await bk.intersects(u,s)){const m=(await bk.nearestCoordinate(u,s)).coordinate??s;this.selectedFeature===c&&(this.location=m)}}catch(c){us(c)||ne.getLogger(this).error(c)}else this.location=ate(this.selectedFeature.geometry)??s})}initialize(){this.addHandles([this.on("view-change",()=>this._autoClose()),te(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),te(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),te(()=>{var t,e;return(e=(t=this.view)==null?void 0:t.animation)==null?void 0:e.state},t=>this._animationStateChange(t)),te(()=>this.location,t=>this._locationChange(t)),te(()=>this.selectedFeature,t=>this._selectedFeatureChange(t)),te(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),te(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),te(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",t=>_qt({event:t,viewModel:this,view:this.view})),jo(()=>!this.waitingForResult,()=>this._waitingForResultChange(),lr),te(()=>[this.features,this.map,this.spatialReference,this.timeZone],()=>this._updateFeatureVMs()),te(()=>{var t;return(t=this.view)==null?void 0:t.scale},()=>this._viewScaleChange()),jo(()=>!this.visible,()=>this.browseClusterEnabled=!1),te(()=>this.browseClusterEnabled,t=>t?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null,this.map=null,this.spatialReference=null,this.timeZone=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const t=this._get("allActions")||new ZS;t.removeAll();const{actions:e,defaultActions:i,defaultPopupTemplateEnabled:r,includeDefaultActions:s,selectedFeature:n}=this,o=s?i.concat(e):e,a=n&&(typeof n.getEffectivePopupTemplate=="function"&&n.getEffectivePopupTemplate(r)||n.popupTemplate),l=a==null?void 0:a.actions,c=a!=null&&a.overwriteActions?l:(l==null?void 0:l.concat(o))??o;return c==null||c.filter(Boolean).forEach(u=>t.add(u)),t}get defaultActions(){const t=this._get("defaultActions")||new ZS;return t.removeAll(),t.addMany(iS(this.selectedFeature)?Cqt():Eqt()),t}get featureCount(){return this.features.length}set features(t){const e=t||[];this._set("features",e);const{pendingPromisesCount:i,promiseCount:r,selectedFeatureIndex:s}=this,n=r&&e.length;n&&i&&s===-1?this.selectedFeatureIndex=0:n&&s!==-1||(this.selectedFeatureIndex=e.length?0:-1)}set location(t){var s,n;let e=t;const i=(s=this.spatialReference)==null?void 0:s.isWebMercator;((n=t==null?void 0:t.spatialReference)==null?void 0:n.isWGS84)&&i&&(e=ty(t)),this._set("location",e)}get map(){var t;return((t=this.view)==null?void 0:t.map)??null}set map(t){this._override("map",t)}get pendingPromisesCount(){return this._pendingPromises.size}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(t){this._pendingPromises.clear(),this.features=[],Array.isArray(t)&&t.length?(this._set("promises",t),(t=t.slice(0)).forEach(e=>this._pendingPromises.add(e)),t.reduce((e,i)=>e.finally(()=>i.then(r=>{this._pendingPromises.has(i)&&this._updateFeatures(r)}).finally(()=>this._pendingPromises.delete(i)).catch(()=>{})),Promise.resolve())):this._set("promises",[])}get selectedFeature(){const{features:t,selectedFeatureIndex:e}=this;return e===-1?null:t[e]||null}get selectedFeatureIndex(){const t=this._get("selectedFeatureIndex");return typeof t=="number"?t:-1}set selectedFeatureIndex(t){const{featureCount:e}=this;t=isNaN(t)||t<-1||!e?-1:(t+e)%e,this.activeFeature=null,this._set("selectedFeatureIndex",t)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get spatialReference(){var t;return((t=this.view)==null?void 0:t.spatialReference)??null}set spatialReference(t){this._override("spatialReference",t)}get state(){const{view:t,map:e}=this;return t?t.ready?"ready":"disabled":e?"ready":"disabled"}get timeZone(){var t;return((t=this.view)==null?void 0:t.timeZone)??pp}set timeZone(t){this._overrideIfSome("timeZone",t)}get waitingForContents(){return this.featureViewModels.some(t=>t.waitingForContent)}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}centerAtLocation(){const{view:t}=this,e=oGe(this);return e&&t?this.callGoTo({target:{target:e,scale:t.scale}}):Promise.reject(new B("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:e,view:t}))}zoomTo(t){return this.callGoTo(t)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(t,e){var r;const{view:i}=this;if(!i||!t)throw new B("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:t,view:i});return i.fetchPopupFeatures(t,{pointerType:(r=e==null?void 0:e.event)==null?void 0:r.pointerType,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:e==null?void 0:e.signal})}open(t){const e={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...t,visible:!0},{fetchFeatures:i}=e;delete e.fetchFeatures,i&&this._setFetchFeaturesPromises(e.location);const r=["actionsMenuOpen","collapsed"];for(const s of r)delete e[s];this.set(e)}triggerAction(t){const e=this.allActions.at(t);e&&!e.disabled&&this.emit("trigger-action",{action:e})}next(){return this.selectedFeatureIndex++,this}previous(){return this.selectedFeatureIndex--,this}disableClusterBrowsing(){Sqt(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:t,selectedFeature:e}=this;(t==null?void 0:t.type)==="2d"?iS(e)?(await xqt(this),await Tqt(this)):ne.getLogger(this).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",e):ne.getLogger(this).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",e)}handleViewClick(t){this._fetchFeaturesAndOpen(t)}_animationStateChange(t){this.zoomToLocation||(vS.disabled=t==="waiting-for-target")}_clearBrowsedClusterGraphics(){var e,i;const t=[this.selectedClusterBoundaryFeature,this._selectedClusterFeature].filter(sd);(i=(e=this.view)==null?void 0:e.graphics)==null||i.removeMany(t),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(iS(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(t){const{selectedFeature:e,updateLocationEnabled:i,view:r}=this;r&&i&&t&&(!e||e.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:t,featureCount:e,featurePage:i,featuresPerPage:r,featureViewModels:s}=this;if(i===null)return;const n=((i-1)*r+e)%e,o=n+r;s.slice(n,o).forEach((a,l)=>{a&&(a.graphic??(a.graphic=t[n+l]))})}async _selectedFeatureChange(t){var n,o;const{location:e,updateLocationEnabled:i,view:r}=this;if(!t||!r)return;if(this.browseClusterEnabled)return this._selectedClusterFeature&&(r.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),iS(t)?void 0:(t.symbol=await zxe(t),this._selectedClusterFeature=t,void r.graphics.add(this._selectedClusterFeature));const s=(n=t.sourceLayer)==null?void 0:n.type;if(s!=="map-image"&&s!=="imagery"&&s!=="imagery-tile"||(t.symbol=await zxe(t)),!i&&e||!t.geometry){if(i&&!t.geometry){await this.centerAtLocation();const a=(o=r.center)==null?void 0:o.clone();a&&(this.location=a)}}else this.location=ate(t.geometry)}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}async _setFetchFeaturesPromises(t){const{pendingFeatures:e}=await this._fetchFeaturesWithController({mapPoint:t});this.promises=e}_destroyFeatureVMs(){this.featureViewModels.forEach(t=>t&&!t.destroyed&&t.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:t,features:e,featureViewModels:i,view:r,spatialReference:s,map:n,timeZone:o,location:a}=this;if(iS(t)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!(e!=null&&e.length))return;const l=i.slice(0),c=[];e.forEach((u,d)=>{if(!u)return;let f=null;if(l.some((m,g)=>(m&&m.graphic===u&&(f=m,l.splice(g,1)),!!f)),f)c[d]=f;else{const m=new Tce({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:s,graphic:u===t?u:null,location:a,map:n,view:r,timeZone:o});c[d]=m}}),l.forEach(u=>u&&!u.destroyed&&u.destroy()),this._set("featureViewModels",c)}async _getScreenPoint(t,e){const{spatialReference:i,view:r}=this;if(!r)return null;await(r==null?void 0:r.when());const s=t==null?void 0:t.spatialReference;return s&&i?(await xO(s,i,null,e),r.toScreen(t)):null}_cancelFetchingFeatures(){const t=this._fetchFeaturesController;t&&t.abort(),this._fetchFeaturesController=null}async _projectScreenPointAndFetchFeatures({mapPoint:t,screenPoint:e,event:i,signal:r}){return this.fetchFeatures(e??await this._getScreenPoint(t??this.location,{signal:r}),{signal:r,event:i})}_fetchFeaturesWithController({mapPoint:t,screenPoint:e,event:i}){this._cancelFetchingFeatures();const r=new AbortController,{signal:s}=r;this._fetchFeaturesController=r;const n=this._projectScreenPointAndFetchFeatures({mapPoint:t,screenPoint:e,signal:s,event:i});return n.catch(()=>{}).then(()=>{this._fetchFeaturesController=null}),n}async _fetchFeaturesAndOpen(t){const{mapPoint:e,screenPoint:i}=t,{view:r}=this;this.removeHandles(XW),this.addHandles([te(()=>{var n;return(n=this.view)==null?void 0:n.scale},()=>this._debouncedLocationUpdate(e).catch(n=>{us(n)||ne.getLogger(this).error(n)})),jo(()=>!this.visible,()=>{this.removeHandles(XW)},{once:!0})],XW);const{pendingFeatures:s}=await this._fetchFeaturesWithController({mapPoint:e,screenPoint:i,event:t});r!=null&&r.popup&&"open"in r.popup&&r.popup.open({location:e??void 0,promises:s})}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}async _getLayerView(t,e){return await t.when(),t.whenLayerView(e)}_getHighlightLayer(t){const{layer:e,sourceLayer:i}=t;return i&&"layer"in i&&i.layer?i.layer:(i==null?void 0:i.type)==="map-notes"||(i==null?void 0:i.type)==="subtype-group"?i:e}_getHighlightTarget(t,e,i){if(Mqt(e.type,i))return t;const r=t.getObjectId();if(r!=null)return r;const s=e.type==="imagery"?void 0:"objectIdField"in e?e.objectIdField||cUe:null,n=t.attributes;return n&&s&&n[s]||t}_mapIncludesLayer(t){var e,i;return!!((i=(e=this.map)==null?void 0:e.allLayers)!=null&&i.includes(t))}async _highlightActiveFeature(){const t="highlight-active-feature";this.removeHandles(t);const{highlightEnabled:e,view:i,activeFeature:r,visible:s}=this;if(!(r&&i&&e&&s))return;const n=this._getHighlightLayer(r);if(!(n&&n instanceof UL&&this._mapIncludesLayer(n)))return;const o=this._getLayerView(i,n);this._highlightActiveFeaturePromise=o;const a=await o;if(!(a&&Pbe(a)&&this._highlightActiveFeaturePromise===o&&this.activeFeature&&this.highlightEnabled))return;const l=a.highlight(this._getHighlightTarget(r,n,i.type));this.addHandles(l,t)}async _highlightSelectedFeature(){const t="highlight-selected-feature";this.removeHandles(t);const{selectedFeature:e,highlightEnabled:i,view:r,visible:s}=this;if(!(e&&r&&i&&s))return;const n=this._getHighlightLayer(e);if(!(n&&n instanceof UL&&this._mapIncludesLayer(n)))return;const o=this._getLayerView(r,n);this._highlightSelectedFeaturePromise=o;const a=await o;if(!(a&&Pbe(a)&&this._highlightSelectedFeaturePromise===o&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const l=a.highlight(this._getHighlightTarget(e,n,r.type));this.addHandles(l,t)}_updateFeatures(t){const{features:e}=this,i=t.filter(r=>!e.includes(r));i!=null&&i.length&&(this.features=e.concat(i))}};h([p()],Bi.prototype,"_fetchFeaturesController",void 0),h([p({type:ZS})],Bi.prototype,"actions",void 0),h([p({readOnly:!0})],Bi.prototype,"active",null),h([p()],Bi.prototype,"activeFeature",void 0),h([p({readOnly:!0})],Bi.prototype,"allActions",null),h([p()],Bi.prototype,"autoCloseEnabled",void 0),h([p()],Bi.prototype,"browseClusterEnabled",void 0),h([p()],Bi.prototype,"content",void 0),h([p({type:ZS,readOnly:!0})],Bi.prototype,"defaultActions",null),h([p({type:Boolean})],Bi.prototype,"defaultPopupTemplateEnabled",void 0),h([p({readOnly:!0})],Bi.prototype,"featureCount",null),h([p()],Bi.prototype,"featurePage",void 0),h([p({value:[]})],Bi.prototype,"features",null),h([p()],Bi.prototype,"featuresPerPage",void 0),h([p()],Bi.prototype,"featureMenuOpen",void 0),h([p()],Bi.prototype,"featureViewModelAbilities",void 0),h([p({readOnly:!0})],Bi.prototype,"featureViewModels",void 0),h([p()],Bi.prototype,"highlightEnabled",void 0),h([p()],Bi.prototype,"includeDefaultActions",void 0),h([p({type:wt})],Bi.prototype,"location",null),h([p()],Bi.prototype,"map",null),h([p({readOnly:!0})],Bi.prototype,"pendingPromisesCount",null),h([p({readOnly:!0})],Bi.prototype,"promiseCount",null),h([p()],Bi.prototype,"promises",null),h([p({readOnly:!0})],Bi.prototype,"selectedClusterBoundaryFeature",void 0),h([p({value:null,readOnly:!0})],Bi.prototype,"selectedFeature",null),h([p({value:-1})],Bi.prototype,"selectedFeatureIndex",null),h([p({readOnly:!0})],Bi.prototype,"selectedFeatureViewModel",null),h([p({readOnly:!0})],Bi.prototype,"state",null),h([p()],Bi.prototype,"timeZone",null),h([p()],Bi.prototype,"title",void 0),h([p()],Bi.prototype,"updateLocationEnabled",void 0),h([p()],Bi.prototype,"view",void 0),h([p()],Bi.prototype,"visible",void 0),h([p({readOnly:!0})],Bi.prototype,"waitingForContents",null),h([p({readOnly:!0})],Bi.prototype,"waitingForResult",null),h([p()],Bi.prototype,"zoomFactor",void 0),h([p()],Bi.prototype,"zoomToLocation",void 0),h([p()],Bi.prototype,"centerAtLocation",null),Bi=h([I("esri.widgets.Features.FeaturesViewModel")],Bi);const Mce=Bi;let mf=class extends Ue{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!1,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.flow=!0,this.heading=!0,this.spinner=!0}};h([p({type:Boolean,nonNullable:!0})],mf.prototype,"actionBar",void 0),h([p({type:Boolean,nonNullable:!0})],mf.prototype,"closeButton",void 0),h([p({type:Boolean,nonNullable:!0})],mf.prototype,"collapseButton",void 0),h([p({type:Boolean,nonNullable:!0})],mf.prototype,"featureNavigation",void 0),h([p({type:Boolean,nonNullable:!0})],mf.prototype,"featureListLayerTitle",void 0),h([p({type:Boolean,nonNullable:!0})],mf.prototype,"flow",void 0),h([p({type:Boolean,nonNullable:!0})],mf.prototype,"heading",void 0),h([p({type:Boolean,nonNullable:!0})],mf.prototype,"spinner",void 0),mf=h([I("esri.widgets.Features.FeaturesVisibleElements")],mf);const aGe=mf,jxe="selected-index",Aqt=0,Gxe="features-spinner",Pqt=50;function Hxe(t){return(t==null?void 0:t.declaredClass.startsWith("esri.layers."))??!1}let yr=class extends Xje(Wo){constructor(e,i){super(e,i),this._featureMenuIntersectionObserverCallback=([r])=>{r!=null&&r.isIntersecting&&this.viewModel.featurePage!=null&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._featureMenuIntersectionObserverNode=null,this._focusOn=null,this._spinner=null,this._feature=null,this._relatedRecordsFlowItems=new Ke,this._relatedRecordsWidget=new EHt({flowItems:this._relatedRecordsFlowItems}),this._rootFlowItemNode=null,this._featureMenuViewportNode=null,this._actionBarMenuNode=null,this.collapsed=!1,this.featureNavigationTop=!1,this.headerActions=new ZS,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new Mce,this.visibleElements=new aGe,this._renderAction=(r,s)=>{const n=this._getActionTitle(r),{type:o,active:a,uid:l,disabled:c,indicator:u}=r;return r.visible?Q("calcite-action",{active:o==="toggle"&&r.value,appearance:"solid",bind:this,"data-action-uid":l,disabled:c,icon:this._getActionIcon(r),indicator:u,key:`action-${s}`,loading:a,onclick:this._triggerAction,scale:"s",text:n,title:this._hideActionText?n:void 0},this._getFallbackIcon(r)):null},this._openFeatureMenu=()=>{this.featureMenuOpen=!0,this._focusOn="menu-flow-item"},this._previousFeature=()=>{this.viewModel.selectedFeatureIndex--},this._nextFeature=()=>{this.viewModel.selectedFeatureIndex++},this._handleFeatureMenuBack=()=>{this.featureMenuOpen&&(this._focusOn="root-flow-item",this.featureMenuOpen=!1)},this._focusFlowItemNode=r=>{this._focusOn===r&&requestAnimationFrame(async()=>{var s,n;switch(r){case"menu-flow-item":await((s=this._featureMenuViewportNode)==null?void 0:s.setFocus());break;case"root-flow-item":await((n=this._rootFlowItemNode)==null?void 0:n.setFocus())}this._focusOn=null})},this._focusFlowItemNodeThrottled=jj(this._focusFlowItemNode,Pqt),this._displaySpinnerThrottled=jj(()=>this._displaySpinner(),Aqt),this._addSelectedFeatureIndexHandle(),this.addHandles([this._displaySpinnerThrottled,this._focusFlowItemNodeThrottled,te(()=>{var r;return(r=this.viewModel)==null?void 0:r.active},()=>this._toggleScreenLocationEnabled()),te(()=>{var r;return(r=this.viewModel)==null?void 0:r.active},r=>this._relatedRecordsWidget.closed=!r),te(()=>{var r;return(r=this.visibleElements)==null?void 0:r.closeButton},r=>this._relatedRecordsWidget.closable=r),te(()=>{var r;return(r=this.visibleElements)==null?void 0:r.spinner},r=>this._spinnerEnabledChange(r)),te(()=>{var r;return(r=this.viewModel)==null?void 0:r.view},(r,s)=>this._viewChange(r,s)),te(()=>{var r,s;return(s=(r=this.viewModel)==null?void 0:r.view)==null?void 0:s.ready},(r,s)=>this._viewReadyChange(r??!1,s??!1)),te(()=>{var r,s;return[(r=this.viewModel)==null?void 0:r.waitingForResult,(s=this.viewModel)==null?void 0:s.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),te(()=>{var r;return(r=this.viewModel)==null?void 0:r.screenLocation},()=>this._closeOpenActionMenu()),te(()=>this.selectedFeatureWidget,()=>this._destroyRelatedRecordsFlowItemWidgets()),te(()=>{var s;const r=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel;return[r==null?void 0:r.title,r==null?void 0:r.state]},()=>this._setTitleFromFeatureWidget()),te(()=>{var s;const r=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel;return[r==null?void 0:r.content,r==null?void 0:r.state]},()=>this._setContentFromFeatureWidget()),te(()=>{var r;return(r=this.viewModel)==null?void 0:r.featureViewModels},()=>this._featureMenuViewportScrollTop()),this._relatedRecordsWidget.on("close",()=>this.close()),this._relatedRecordsWidget.on("exit",()=>this._destroyRelatedRecordsFlowItemWidgets()),this._relatedRecordsWidget.on("open-related-feature",({feature:r})=>this._openRelatedFeature(r))])}loadDependencies(){return Cp({action:()=>oe(()=>import("./calcite-action-Dhk8OhY7.js"),__vite__mapDeps([248,245,200,201,202,205,206,207,208,204,209,210])),"action-bar":()=>oe(()=>import("./calcite-action-bar-D6GZm2Cn.js"),__vite__mapDeps([254,247,208,200,201,205,206,207,255,250,245,202,204,209,210,215,216,251,217,218])),"action-group":()=>oe(()=>import("./calcite-action-group-C3SKU4KD.js"),__vite__mapDeps([256,255,247,208,205,206,200,201,207,250,245,202,204,209,210,215,216,251,217,218])),button:()=>oe(()=>import("./calcite-button-wzbJSjju.js"),__vite__mapDeps([198,199,200,201,202,203,204,205,206,207,208,209,210])),flow:()=>oe(()=>import("./calcite-flow-LTs5LM2h.js"),__vite__mapDeps([257,208,205])),"flow-item":()=>oe(()=>import("./calcite-flow-item-f0hju3wh.js"),__vite__mapDeps([249,200,201,202,205,206,207,208,250,245,204,209,210,215,216,251,217,218,243])),list:()=>oe(()=>import("./calcite-list-CjOh8dex.js"),__vite__mapDeps([239,200,201,202,208,240,241,205,206,207,216,209,242,199,203,204,210,243])),"list-item":()=>oe(()=>import("./calcite-list-item-uP1R-DBp.js"),__vite__mapDeps([244,200,201,202,206,207,208,205,241,240,245,204,209,210])),"list-item-group":()=>oe(()=>import("./calcite-list-item-group-Cdc0vdwT.js"),__vite__mapDeps([258,202,240])),loader:()=>oe(()=>import("./calcite-loader-DzbGa04d.js"),__vite__mapDeps([238,210,201]))})}destroy(){var e,i;this._destroyRelatedRecordsFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._unobserveFeatureMenuObserver(),(e=this._featureMenuIntersectionObserver)==null||e.disconnect(),(i=this._relatedRecordsWidget)==null||i.destroy()}get _hideActionText(){var i;if(!this.responsiveActionsEnabled)return!1;const e=(i=this.view)==null?void 0:i.widthBreakpoint;return e==="xsmall"||e==="small"||e==="medium"}get _featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get _isCollapsed(){return this._collapseEnabled&&this.collapsed}get _collapseEnabled(){return this.visibleElements.collapseButton&&!!this.title&&!!this.content}get active(){return this.viewModel.active}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get icon(){return null}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(e){this.viewModel.featureMenuOpen=e}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){const{_feature:e,headingLevel:i,_relatedRecordsFlowItems:r,timeZone:s,spatialReference:n,map:o}=this,{selectedFeatureViewModel:a}=this.viewModel,l={title:!1};return a?(e?(e.viewModel=a,e.visibleElements=l):this._feature=new THt({flowItems:r,headingLevel:i+1,timeZone:s,spatialReference:n,map:o,viewModel:a,visibleElements:l}),this._feature):null}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}blur(){var i;const{active:e}=this.viewModel;e?(i=this._rootFlowItemNode)==null||i.blur():ne.getLogger(this).warn("Features can only be blurred when currently active.")}clear(){return this.viewModel.clear()}close(){this.viewModel.visible=!1}fetchFeatures(e,i){return this.viewModel.fetchFeatures(e,i)}focus(){const{active:e}=this.viewModel;e?this._setFocusOn():ne.getLogger(this).warn("Features can only be focused when currently active.")}next(){return this.viewModel.next()}open(e){this.removeHandles(jxe);const i={collapsed:(e==null?void 0:e.collapsed)??!1};this.set(i),this.viewModel.open(e),this.addHandles(jo(()=>!this.viewModel.waitingForResult,()=>this._addSelectedFeatureIndexHandle(),{once:!0}))}previous(){return this.viewModel.previous()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){return Q("div",{bind:this,class:this.classes($a.base,Jt.widget,Jt.panel),onkeydown:this._onMainKeydown},this._renderHeader(),this._renderContentContainer())}_renderFeatureNavigation(){return[this._renderPagination(),this._renderFeatureMenuButton()]}_renderHeader(){return!this.featureMenuOpen&&this.featureNavigationTop&&this._featureNavigationVisible?Q("div",{class:$a.header,key:"header-actions"},this._renderFeatureNavigation()):null}_renderFooter(){return this.featureMenuOpen||this.featureNavigationTop||!this._featureNavigationVisible?null:Q("div",{class:$a.footer,key:"footer-actions",slot:"footer"},this._renderFeatureNavigation())}_renderFeatureMenuButton(){const{messages:e,viewModel:i}=this,{featureCount:r,selectedFeatureIndex:s,pendingPromisesCount:n}=i;return Q("calcite-action",{appearance:"solid",bind:this,icon:"list",key:"feature-menu-button",label:e.selectFeature,loading:n>0,onclick:this._openFeatureMenu,scale:"s",text:Pg(e.pageText,{index:nc(s+1),total:nc(r)}),textEnabled:!0,title:e.selectFeature})}_renderPagination(){const{previous:e,next:i}=this.messagesCommon.pagination;return Q("calcite-action-bar",{class:$a.paginationActionBar,expandDisabled:!0,key:"pagination-action-bar",layout:"horizontal",overflowActionsDisabled:!0,scale:"s"},Q("calcite-action-group",{scale:"s"},Q("calcite-action",{appearance:"solid",class:$a.paginationPrevious,icon:"chevron-left",iconFlipRtl:!0,label:e,onclick:this._previousFeature,scale:"s",text:e,title:e}),Q("calcite-action",{appearance:"solid",icon:"chevron-right",iconFlipRtl:!0,label:i,onclick:this._nextFeature,scale:"s",text:i,title:i})))}_renderFeatureMenuItem(e){const{selectedFeatureViewModel:i,featureViewModels:r}=this.viewModel,s=e===i,n=r.indexOf(e);return Q("calcite-list-item",{bind:this,"data-feature-index":n,key:`feature-menu-item-${e.uid}`,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onmouseleave:this._removeActiveFeature,onmouseover:this._setActiveFeature,selected:s,onCalciteListItemSelect:this._selectFeature},Q("span",{innerHTML:e.title||this.messagesCommon.untitled,slot:"content"}))}_groupResultsByLayer(){const{featureViewModels:e}=this.viewModel,i=new Map;return e.forEach(r=>{const s=r==null?void 0:r.graphic;if(!s)return;const{layer:n,sourceLayer:o}=s,a=(Hxe(n)?n:null)||(Hxe(o)?o:null),l=i.get(a)??[];i.set(a,[...l,r])}),i}_renderFeatureMenu(){const{featureViewModels:e}=this.viewModel,i=this._groupResultsByLayer();return e.length?Q("calcite-list",{selectionAppearance:"icon",selectionMode:"single"},Array.from(i.keys(),r=>{var o;const s=(o=i.get(r))==null?void 0:o.map(a=>this._renderFeatureMenuItem(a)),n=r?r.title??this.messagesCommon.untitled:null;return this.visibleElements.featureListLayerTitle&&n!==null?Q("calcite-list-item-group",{heading:n,key:(r==null?void 0:r.uid)||"map-graphics"},s):s})):null}_renderHeaderAction(e,i){const r=e.title||"";return e.visible?Q("calcite-action",{active:e.type==="toggle"&&e.value,appearance:"solid",bind:this,"data-action-uid":e.uid,disabled:e.disabled,icon:e.icon??void 0,indicator:e.indicator,key:`header-action-${i}`,loading:e.active,onclick:this._triggerHeaderAction,slot:"header-actions-end",text:r,title:r}):null}_renderHeaderActions(){return this.headerActions.map((e,i)=>this._renderHeaderAction(e,i)).toArray()}_renderContentFeature(){const{headingLevel:e,visibleElements:i,_isCollapsed:r,_collapseEnabled:s,featureNavigationTop:n}=this,{title:o,active:a}=this.viewModel,l=i.heading&&o?o:"";return Q("calcite-flow-item",{afterCreate:this._storeRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,class:this.classes({[$a.contentFeature]:!0,[$a.flowItemCollapsed]:r}),closable:i.closeButton,closed:!a,collapsed:r,collapseDirection:n?"down":"up",collapsible:s,headingLevel:e,key:"root-flow-item",onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},l?Q(sce,{class:this.classes($a.featuresHeading,Jt.heading),innerHTML:l,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),r?null:Q("div",{class:this.classes($a.container,$a.contentContainer)},this._renderContent()),this._renderFooter())}_renderFeatureMenuContainer(){const{viewModel:e,featureMenuOpen:i,messages:r,messagesCommon:s}=this,{active:n,featureViewModels:o,pendingPromisesCount:a}=e;return i?Q("calcite-flow-item",{afterCreate:this._storeFeatureMenuFlowItemNode,afterUpdate:this._focusFeatureMenuFlowItemNode,bind:this,closable:!1,closed:!n,description:Pg(r.total,{total:o.length}),heading:r.selectFeature,key:"feature-menu",loading:e.waitingForContents,onCalciteFlowItemBack:l=>{l.preventDefault(),this._handleFeatureMenuBack()}},a>0?Q("calcite-loader",{class:$a.loader,inline:!0,key:"feature-menu-loader",label:s.loading,slot:"header-actions-end"}):null,Q("div",{class:$a.container},this._renderFeatureMenu()),Q("div",{afterCreate:this._featureMenuIntersectionObserverCreated,bind:this,class:$a.featureMenuObserver}),Q("calcite-button",{appearance:"transparent",onclick:this._handleFeatureMenuBack,slot:"footer-actions",width:"full"},s.back)):null}_renderContentContainer(){const e=[this._renderContentFeature(),this._renderFeatureMenuContainer(),this._relatedRecordsWidget.render()];return this.visibleElements.flow?Q("calcite-flow",{key:"content-container"},e):e}_getFallbackIcon(e){const{className:i,icon:r}=e;if(r)return null;const s=Azt({action:e,feature:this.selectedFeature}),n={[$a.icon]:!!i,[$a.actionImage]:!!s};return i&&(n[i]=!0),s||i?Q("span",{"aria-hidden":"true",class:this.classes($a.icon,n),key:"icon",styles:RBe(s)}):null}_renderActionBar(){var e;return!this._isCollapsed&&this.visibleElements.actionBar&&((e=this.viewModel.allActions)!=null&&e.length)?Q("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},Q("calcite-action-group",{afterCreate:i=>this._actionBarMenuNode=i,overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map(this._renderAction)}_renderContent(){var i;const e=(i=this.viewModel)==null?void 0:i.content;return e?typeof e=="string"?Q("div",{class:jn.contentNode,innerHTML:e,key:e}):this.renderNodeContent(e):null}_setFocusOn(){this.renderNow(),requestAnimationFrame(()=>{this._focusOn=this.featureMenuOpen?"menu-flow-item":"root-flow-item"})}_handleCollapseToggle(){this.collapsed=!this.collapsed}async _openRelatedFeature(e){await e.viewModel.updateGeometry();const i=e.graphic,r=i==null?void 0:i.geometry;if(r==null||i==null)return;this._destroyRelatedRecordsFlowItemWidgets(),await this.viewModel.zoomTo({target:r});const s=ate(r);this.open({features:[i],location:s??void 0})}_focusRootFlowItemNode(){this._focusFlowItemNodeThrottled("root-flow-item")}_focusFeatureMenuFlowItemNode(){this._focusFlowItemNodeThrottled("menu-flow-item")}_storeRootFlowItemNode(e){this._rootFlowItemNode=e,this._focusFlowItemNodeThrottled("root-flow-item")}_storeFeatureMenuFlowItemNode(e){this._featureMenuViewportNode=e,this._focusFlowItemNodeThrottled("menu-flow-item")}_setActiveFeature(e){var s;const{viewModel:i}=this,r=e.currentTarget["data-feature-index"];i.activeFeature=((s=i.features)==null?void 0:s[r])||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_selectFeature(e){const i=e.currentTarget["data-feature-index"];isNaN(i)||(this.viewModel.selectedFeatureIndex=i),this._handleFeatureMenuBack()}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_getActionIcon(e){return e.icon?e.icon:e.image||e.className?void 0:"question"}_getActionTitle(e){const{messages:i,selectedFeature:r,messagesCommon:s}=this,{id:n}=e,o=r==null?void 0:r.attributes,a=e.title??"",l=n==="zoom-to-feature"?Pg(a,{messages:i}):n==="remove-selected-feature"?Pg(a,{messages:s}):n==="zoom-to-clustered-features"||n==="browse-clustered-features"?Pg(a,{messages:i}):e.title;return l&&o?Pg(l,o):l??""}_onMainKeydown(e){const{key:i}=e;i==="ArrowLeft"&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.previous()),i==="ArrowRight"&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.next())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&this._featureMenuViewportNode.scrollContentTo({top:0})}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:e,messagesCommon:i}=this,r=e==null?void 0:e.viewModel;e&&(this.viewModel.title=(r==null?void 0:r.state)==="error"?i==null?void 0:i.errorMessage:(r==null?void 0:r.title)||"")}_addSelectedFeatureIndexHandle(){const e=te(()=>{var i;return(i=this.viewModel)==null?void 0:i.selectedFeatureIndex},(i,r)=>this._selectedFeatureIndexUpdated(i,r));this.addHandles(e,jxe)}_selectedFeatureIndexUpdated(e,i){const{featureCount:r}=this.viewModel;r&&e!==i&&e!==-1&&(this._destroyRelatedRecordsFlowItemWidgets(),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_triggerHeaderAction(e){const i=e.currentTarget;if(i.disabled)return;const r=i.dataset.actionUid,s=this.headerActions.find(({uid:n})=>n===r);s&&!s.disabled&&((s==null?void 0:s.type)==="toggle"&&(s.value=!s.value),this.emit("trigger-header-action",{action:s}))}_triggerAction(e){const i=e.currentTarget;if(i.disabled)return;const r=i.dataset.actionUid,{allActions:s}=this.viewModel,n=s.findIndex(a=>a.uid===r),o=s.at(n);o&&o.type==="toggle"&&(o.value=!o.value),this.viewModel.triggerAction(n)}_createSpinner(e){e&&(this._spinner=new SHt({view:e}),e.ui.add(this._spinner,{key:Gxe,position:"manual",internal:!0}))}_wireUpView(e){var i;this._destroySpinner(),e&&((i=this.visibleElements)!=null&&i.spinner)&&this._createSpinner(e)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_viewReadyChange(e,i){var r;e?this._wireUpView((r=this.viewModel)==null?void 0:r.view):i&&this.viewModel.clear()}_viewChange(e,i){e&&i&&this.viewModel.clear()}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,!e.destroyed&&e.destroy()),this._feature=null}_closeOpenActionMenu(){const{_actionBarMenuNode:e}=this;e&&(e.menuOpen=!1)}_destroyRelatedRecordsFlowItemWidgets(){this._relatedRecordsFlowItems.drain(e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()})}_toggleScreenLocationEnabled(){const{viewModel:e}=this;e&&(e.screenLocationEnabled=e.active)}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:i,waitingForResult:r}=this.viewModel;r&&i?e.show({location:i}):e.hide()}_destroySpinner(){var r;const{_spinner:e,view:i}=this;e&&((r=i==null?void 0:i.ui)==null||r.remove(e,Gxe),e.destroy(),this._spinner=null)}_spinnerEnabledChange(e){var i;this._destroySpinner(),e&&this._createSpinner((i=this.viewModel)==null?void 0:i.view)}};h([p()],yr.prototype,"_focusOn",void 0),h([p()],yr.prototype,"_relatedRecordsFlowItems",void 0),h([p()],yr.prototype,"_hideActionText",null),h([p()],yr.prototype,"_featureNavigationVisible",null),h([p()],yr.prototype,"_isCollapsed",null),h([p()],yr.prototype,"_collapseEnabled",null),h([p({readOnly:!0})],yr.prototype,"active",null),h([p()],yr.prototype,"collapsed",void 0),h([p()],yr.prototype,"content",null),h([p()],yr.prototype,"icon",null),h([p()],yr.prototype,"featureMenuOpen",null),h([p()],yr.prototype,"featureNavigationTop",void 0),h([p()],yr.prototype,"features",null),h([p()],yr.prototype,"goToOverride",null),h([p({type:ZS})],yr.prototype,"headerActions",void 0),h([p()],yr.prototype,"headingLevel",void 0),h([p()],yr.prototype,"location",null),h([p()],yr.prototype,"label",null),h([p()],yr.prototype,"map",null),h([p(),qo("esri/widgets/Features/t9n/Features")],yr.prototype,"messages",void 0),h([p(),qo("esri/t9n/common")],yr.prototype,"messagesCommon",void 0),h([p()],yr.prototype,"promises",null),h([p()],yr.prototype,"responsiveActionsEnabled",void 0),h([p({readOnly:!0})],yr.prototype,"selectedFeature",null),h([p()],yr.prototype,"selectedFeatureIndex",null),h([p({readOnly:!0})],yr.prototype,"selectedFeatureWidget",null),h([p()],yr.prototype,"spatialReference",null),h([p()],yr.prototype,"title",null),h([p()],yr.prototype,"timeZone",null),h([p()],yr.prototype,"updateLocationEnabled",null),h([p()],yr.prototype,"view",null),h([p({type:Mce}),V8(["triggerAction","trigger-action"])],yr.prototype,"viewModel",void 0),h([p({type:aGe,nonNullable:!0})],yr.prototype,"visibleElements",void 0),h([p()],yr.prototype,"visible",null),yr=h([I("esri.widgets.Features")],yr);const Oqt=yr,_h="esri-popup",Ax=`${_h}--is-docked`,so={base:_h,baseHidden:`${_h}--hidden`,main:`${_h}__main-container`,shadow:`${_h}--shadow`,isDocked:Ax,isDockedTopLeft:`${Ax}-top-left`,isDockedTopCenter:`${Ax}-top-center`,isDockedTopRight:`${Ax}-top-right`,isDockedBottomLeft:`${Ax}-bottom-left`,isDockedBottomCenter:`${Ax}-bottom-center`,isDockedBottomRight:`${Ax}-bottom-right`,alignTopCenter:`${_h}--aligned-top-center`,alignBottomCenter:`${_h}--aligned-bottom-center`,alignTopLeft:`${_h}--aligned-top-left`,alignBottomLeft:`${_h}--aligned-bottom-left`,alignTopRight:`${_h}--aligned-top-right`,alignBottomRight:`${_h}--aligned-bottom-right`,pointer:`${_h}__pointer`,pointerDirection:`${_h}__pointer-direction`};let Rie=class extends Mce{constructor(e){super(e)}};Rie=h([I("esri.widgets.Popup.PopupViewModel")],Rie);const lGe=Rie;let _g=class extends Ue{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!0,this.featureNavigation=!0,this.featureListLayerTitle=!0,this.heading=!0,this.spinner=!0}};h([p({type:Boolean,nonNullable:!0})],_g.prototype,"actionBar",void 0),h([p({type:Boolean,nonNullable:!0})],_g.prototype,"closeButton",void 0),h([p({type:Boolean,nonNullable:!0})],_g.prototype,"collapseButton",void 0),h([p({type:Boolean,nonNullable:!0})],_g.prototype,"featureNavigation",void 0),h([p({type:Boolean,nonNullable:!0})],_g.prototype,"featureListLayerTitle",void 0),h([p({type:Boolean,nonNullable:!0})],_g.prototype,"heading",void 0),h([p({type:Boolean,nonNullable:!0})],_g.prototype,"spinner",void 0),_g=h([I("esri.widgets.Popup.PopupVisibleElements")],_g);const Iie=_g,qxe={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};let _r=class extends Wo{constructor(t,e){super(t,e),this._dockAction=new Y2({id:"popup-dock-action"}),this._featuresWidget=new Oqt({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this.alignment="auto",this.dockEnabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new lGe,this.visibleElements=new Iie}initialize(){this.addHandles([te(()=>{var t,e;return[(e=(t=this.viewModel)==null?void 0:t.view)==null?void 0:e.widthBreakpoint,this.dockEnabled]},()=>this._handleDockIcon(),pt),te(()=>{var t,e;return[this.dockEnabled,(t=this.messages)==null?void 0:t.undock,(e=this.messages)==null?void 0:e.dock]},()=>this._handleDockEnabled(),pt),te(()=>this.dockOptions,t=>{const{_dockAction:e}=this,i=this._featuresWidget.headerActions;i.remove(e),t.buttonEnabled&&i.add(e)},pt),te(()=>{var t;return(t=this.viewModel)==null?void 0:t.screenLocation},()=>this._positionContainer()),te(()=>{var t;return[(t=this.viewModel)==null?void 0:t.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),te(()=>{var t,e,i,r,s,n,o;return[(t=this.viewModel)==null?void 0:t.screenLocation,(i=(e=this.viewModel)==null?void 0:e.view)==null?void 0:i.padding,(s=(r=this.viewModel)==null?void 0:r.view)==null?void 0:s.size,(n=this.viewModel)==null?void 0:n.active,(o=this.viewModel)==null?void 0:o.location,this.alignment]},()=>this.reposition()),te(()=>{var t,e;return(e=(t=this.viewModel)==null?void 0:t.view)==null?void 0:e.size},(t,e)=>this._updateDockEnabledForViewSize(t,e)),te(()=>{var t;return(t=this.viewModel)==null?void 0:t.view},(t,e)=>this._viewChange(t,e)),te(()=>{var t,e;return(e=(t=this.viewModel)==null?void 0:t.view)==null?void 0:e.ready},(t,e)=>this._viewReadyChange(t??!1,e??!1)),te(()=>this.viewModel,()=>this._featuresWidget.viewModel=this.viewModel,pt),te(()=>this._featureNavigationTop,t=>this._featuresWidget.featureNavigationTop=t,pt),te(()=>this.headingLevel,t=>this._featuresWidget.headingLevel=t,pt),te(()=>this.visibleElements.actionBar,t=>this._featuresWidget.visibleElements.actionBar=!!t,pt),te(()=>this.visibleElements.closeButton,t=>this._featuresWidget.visibleElements.closeButton=!!t,pt),te(()=>this.visibleElements.collapseButton,t=>this._featuresWidget.visibleElements.collapseButton=!!t,pt),te(()=>this.visibleElements.heading,t=>this._featuresWidget.visibleElements.heading=!!t,pt),te(()=>this.visibleElements.spinner,t=>this._featuresWidget.visibleElements.spinner=!!t,pt),te(()=>this.visibleElements.featureNavigation,t=>this._featuresWidget.visibleElements.featureNavigation=!!t,pt),te(()=>this.visibleElements.featureListLayerTitle,t=>this._featuresWidget.visibleElements.featureListLayerTitle=!!t,pt),on(()=>this._featuresWidget,"trigger-header-action",t=>{t.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)})])}normalizeCtorArgs(t){const e={...t};return(t==null?void 0:t.visibleElements)!=null&&(e.visibleElements=new Iie(t.visibleElements),t.collapseEnabled!=null&&(e.visibleElements.collapseButton=t.collapseEnabled),t.spinnerEnabled!=null&&(e.visibleElements.spinner=t.spinnerEnabled)),e}destroy(){var t;this._dockAction.destroy(),(t=this._featuresWidget)==null||t.destroy()}get _featureNavigationTop(){const{currentAlignment:t,currentDockPosition:e}=this;return t==="bottom-left"||t==="bottom-center"||t==="bottom-right"||e==="top-left"||e==="top-center"||e==="top-right"}get actions(){return this.viewModel.actions}set actions(t){this.viewModel.actions=t}get active(){return this.viewModel.active}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(t){this.viewModel.autoCloseEnabled=t}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(t){this.viewModel.defaultPopupTemplateEnabled=t}get content(){return this.viewModel.content}set content(t){this.viewModel.content=t}get collapsed(){return this._featuresWidget.collapsed}set collapsed(t){this._featuresWidget.collapsed=t}get collapseEnabled(){return s_(ne.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton}set collapseEnabled(t){s_(ne.getLogger(this),"collapseEnabled",{replacement:"PopupVisibleElements.collapseButton",version:"4.29"}),this.visibleElements.collapseButton=t}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||qxe}set dockOptions(t){var a,l;const e={...qxe},i=(l=(a=this.viewModel)==null?void 0:a.view)==null?void 0:l.breakpoints,r={};i&&(r.width=i.xsmall,r.height=i.xsmall);const s={...e,...t},n={...e.breakpoint,...r},{breakpoint:o}=s;typeof o=="object"?s.breakpoint={...n,...o}:o&&(s.breakpoint=n),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(t){this.viewModel.featureMenuOpen=t}get features(){return this.viewModel.features}set features(t){this.viewModel.features=t}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(t){this.viewModel.goToOverride=t}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(t){this.viewModel.highlightEnabled=t}get icon(){return"popup"}set icon(t){this._overrideIfSome("icon",t)}get location(){return this.viewModel.location}set location(t){this.viewModel.location=t}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get promises(){return this.viewModel.promises}set promises(t){this.viewModel.promises=t}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(t){this.viewModel.selectedFeatureIndex=t}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get spinnerEnabled(){return s_(ne.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner}set spinnerEnabled(t){s_(ne.getLogger(this),"spinnerEnabled",{replacement:"PopupVisibleElements.spinner",version:"4.29"}),this.visibleElements.spinner=t}get title(){return this.viewModel.title}set title(t){this.viewModel.title=t}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(t){this.viewModel.updateLocationEnabled=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}get visible(){return this.viewModel.visible}set visible(t){this.viewModel.visible=t}blur(){const{active:t}=this.viewModel;t||ne.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(t,e){return this.viewModel.fetchFeatures(t,e)}focus(){const{active:t}=this.viewModel;t||ne.getLogger(this).warn("Popup can only be focused when currently active."),this.reposition(),requestAnimationFrame(()=>{this._featuresWidget.focus()})}next(){return this.viewModel.next()}open(t){const e=!!t&&!!t.featureMenuOpen,i={collapsed:!!t&&!!t.collapsed,featureMenuOpen:e};this.set(i),this.viewModel.open(t),this._shouldFocus(t)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(t){return this.viewModel.triggerAction(t)}render(){var u,d,f,m;const{dockEnabled:t,currentAlignment:e,currentDockPosition:i}=this,{active:r,screenLocation:s}=this.viewModel,n=r&&t,o=r&&!t,a=(d=(u=this.selectedFeature)==null?void 0:u.layer)==null?void 0:d.title,l=(m=(f=this.selectedFeature)==null?void 0:f.layer)==null?void 0:m.id,c={[so.alignTopCenter]:e==="top-center",[so.alignBottomCenter]:e==="bottom-center",[so.alignTopLeft]:e==="top-left",[so.alignBottomLeft]:e==="bottom-left",[so.alignTopRight]:e==="top-right",[so.alignBottomRight]:e==="bottom-right",[so.isDocked]:n,[so.shadow]:o,[so.isDockedTopLeft]:i==="top-left",[so.isDockedTopCenter]:i==="top-center",[so.isDockedTopRight]:i==="top-right",[so.isDockedBottomLeft]:i==="bottom-left",[so.isDockedBottomCenter]:i==="bottom-center",[so.isDockedBottomRight]:i==="bottom-right"};return Q("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,bind:this,class:this.classes(so.base,c,{[so.baseHidden]:!s&&!t}),"data-layer-id":l,"data-layer-title":a,role:"presentation"},r?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:Q("div",{class:so.pointer,key:"popup-pointer",role:"presentation"},Q("div",{class:this.classes(so.pointerDirection,so.shadow)}))}_renderMainContainer(){const{dockEnabled:t}=this,e={[so.shadow]:t};return Q("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(so.main,Jt.widget,e)},this._featuresWidget.render())}async _shouldFocus(t){t!=null&&t.shouldFocus&&(await d2(()=>{var e;return((e=this.viewModel)==null?void 0:e.active)===!0}),this.focus())}_isOutsideView(t){const{popupHeight:e,popupWidth:i,screenLocation:r,side:s,view:n}=t;if(isNaN(i)||isNaN(e)||!n||!r)return!1;const o=n.padding;return s==="right"&&r.x+i/2>n.width-o.right||s==="left"&&r.x-i/2<o.left||s==="top"&&r.y-e<o.top||s==="bottom"&&r.y+e>n.height-o.bottom}_calculateAutoAlignment(t){if(t!=="auto")return t;const{_pointerOffsetInPx:e,_containerNode:i,_mainContainerNode:r,viewModel:s}=this,{screenLocation:n,view:o}=s;if(n==null||!o||!i)return"top-center";function a(x){return parseInt(x.replaceAll(/[^-\d.]/g,""),10)}const l=r?window.getComputedStyle(r,null):null,c=l?a(l.getPropertyValue("max-height")):0,u=l?a(l.getPropertyValue("height")):0,{height:d,width:f}=i.getBoundingClientRect(),m=f+e,g=Math.max(d,c,u)+e,y=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"right",view:o}),v=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"left",view:o}),b=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"top",view:o}),w=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"bottom",view:o});return v?b?"bottom-right":"top-right":y?b?"bottom-left":"top-left":b?w?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(t){return typeof t=="function"?t.call(this):t}_getCurrentAlignment(){const{alignment:t,dockEnabled:e}=this;return e||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(t)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(t){const e=["left","right"];return Zb(this.container)&&e.reverse(),t==null?void 0:t.replace(/leading/gi,e[0]).replaceAll(/trailing/gi,e[1])}_callDockPosition(t){return typeof t=="function"?t.call(this):t}_getDockPosition(){var t;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((t=this.dockOptions)==null?void 0:t.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(t){var o;if(t!=="auto")return t;const e=(o=this.viewModel)==null?void 0:o.view,i=Zb(this.container)?"top-left":"top-right";if(!e)return i;const r=e.padding||{left:0,right:0,top:0,bottom:0},s=e.width-r.left-r.right,{breakpoints:n}=e;return n&&s<=n.xsmall?"bottom-center":i}_getDockIcon(){const t=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(t){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){var t,e;this._dockAction.title=this.dockEnabled?(t=this.messages)==null?void 0:t.undock:(e=this.messages)==null?void 0:e.dock}_setMainContainerNode(t){this._mainContainerNode=t}_positionContainer(t=this._containerNode){if(t&&(this._containerNode=t),!this._containerNode)return;const{screenLocation:e}=this.viewModel,{width:i}=this._containerNode.getBoundingClientRect(),r=this._calculatePositionStyle(e,i);r&&Object.assign(this._containerNode.style,r)}_calculateFullWidth(t){const{currentAlignment:e,_pointerOffsetInPx:i}=this;return e==="top-left"||e==="bottom-left"||e==="top-right"||e==="bottom-right"?t+i:t}_calculateAlignmentPosition(t,e,i,r){const{currentAlignment:s,_pointerOffsetInPx:n}=this;if(!i)return;const{padding:o}=i,a=r/2,l=i.height-e,c=i.width-t;return s==="bottom-center"?{top:e+n-o.top,left:t-a-o.left}:s==="top-left"?{bottom:l+n-o.bottom,right:c+n-o.right}:s==="bottom-left"?{top:e+n-o.top,right:c+n-o.right}:s==="top-right"?{bottom:l+n-o.bottom,left:t+n-o.left}:s==="bottom-right"?{top:e+n-o.top,left:t+n-o.left}:s==="top-center"?{bottom:l+n-o.bottom,left:t-a-o.left}:void 0}_calculatePositionStyle(t,e){const{dockEnabled:i,view:r}=this;if(!r)return;if(i)return{left:"",top:"",right:"",bottom:""};if(t==null||!e)return;const s=this._calculateFullWidth(e),n=this._calculateAlignmentPosition(t.x,t.y,r,s);return n?{top:n.top!==void 0?`${n.top}px`:"auto",left:n.left!==void 0?`${n.left}px`:"auto",bottom:n.bottom!==void 0?`${n.bottom}px`:"auto",right:n.right!==void 0?`${n.right}px`:"auto"}:void 0}_viewChange(t,e){t&&e&&(this.close(),this.clear())}_viewReadyChange(t,e){t?this._wireUpView():e&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(t,e,i){const[r,s]=t,[n,o]=e,{width:a=0,height:l=0}=i??{};return r<=a&&n>a||r>a&&n<=a||s<=l&&o>l||s>l&&o<=l}_updateDockEnabledForViewSize(t,e){var c,u;if(!t||!e)return;const i=((u=(c=this.viewModel)==null?void 0:c.view)==null?void 0:u.padding)||{left:0,right:0,top:0,bottom:0},r=i.left+i.right,s=i.top+i.bottom,n=[],o=[];n[0]=t[0]-r,n[1]=t[1]-s,o[0]=e[0]-r,o[1]=e[1]-s;const{dockOptions:a}=this,l=a.breakpoint;this._dockingThresholdCrossed(n,o,l)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){const{dockEnabled:t,viewModel:e}=this;if(!e)return;const i=e.active&&!t;e.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(t){var a,l;const e=t.breakpoint,i=(l=(a=this.viewModel)==null?void 0:a.view)==null?void 0:l.ui;if(!i)return!1;const{width:r,height:s}=i;if(isNaN(r)||isNaN(s)||!e)return!1;const n=e.hasOwnProperty("width")&&r<=(e.width??0),o=e.hasOwnProperty("height")&&s<=(e.height??0);return n||o}_setDockEnabledForViewSize(t){t.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(t))}};h([p({readOnly:!0})],_r.prototype,"_featureNavigationTop",null),h([p()],_r.prototype,"actions",null),h([p({readOnly:!0})],_r.prototype,"active",null),h([p()],_r.prototype,"alignment",void 0),h([p()],_r.prototype,"autoCloseEnabled",null),h([p()],_r.prototype,"defaultPopupTemplateEnabled",null),h([p()],_r.prototype,"content",null),h([p()],_r.prototype,"collapsed",null),h([p()],_r.prototype,"collapseEnabled",null),h([p({readOnly:!0})],_r.prototype,"currentAlignment",null),h([p({readOnly:!0})],_r.prototype,"currentDockPosition",null),h([p()],_r.prototype,"dockOptions",null),h([p()],_r.prototype,"dockEnabled",void 0),h([p({readOnly:!0})],_r.prototype,"featureCount",null),h([p()],_r.prototype,"featureMenuOpen",null),h([p()],_r.prototype,"features",null),h([p()],_r.prototype,"goToOverride",null),h([p()],_r.prototype,"headingLevel",void 0),h([p()],_r.prototype,"highlightEnabled",null),h([p()],_r.prototype,"icon",null),h([p()],_r.prototype,"location",null),h([p()],_r.prototype,"label",null),h([p(),qo("esri/widgets/Popup/t9n/Popup")],_r.prototype,"messages",void 0),h([p()],_r.prototype,"promises",null),h([p({readOnly:!0})],_r.prototype,"selectedFeature",null),h([p()],_r.prototype,"selectedFeatureIndex",null),h([p({readOnly:!0})],_r.prototype,"selectedFeatureWidget",null),h([p()],_r.prototype,"spinnerEnabled",null),h([p()],_r.prototype,"title",null),h([p()],_r.prototype,"updateLocationEnabled",null),h([p()],_r.prototype,"view",null),h([p({type:lGe}),V8(["triggerAction","trigger-action"])],_r.prototype,"viewModel",void 0),h([p()],_r.prototype,"visible",null),h([p({type:Iie,nonNullable:!0})],_r.prototype,"visibleElements",void 0),_r=h([I("esri.widgets.Popup")],_r);const cGe=_r,Wxe=Object.freeze(Object.defineProperty({__proto__:null,default:cGe},Symbol.toStringTag,{value:"Module"})),Dd="esri-layer-list",qp=`${Dd}__item`,ys={base:Dd,actionMenu:`${Dd}__action-menu`,actionGroup:`${Dd}__action-group`,filterNoResults:`${Dd}__filter-no-results`,item:qp,itemActive:`${qp}--active`,itemContent:`${qp}-content`,itemContentBottom:`${qp}-content-bottom`,itemMessage:`${qp}-message`,itemInvisible:`${qp}--invisible`,itemActionIcon:`${qp}-action-icon`,itemActionImage:`${qp}-action-image`,itemTemporaryIcon:`${qp}-temporary-icon`,itemTableIcon:`${qp}-table-icon`,itemCatalogIcon:`${qp}-catalog-icon`,statusIndicator:`${Dd}__status-indicator`,publishing:`${Dd}__publishing`,updating:`${Dd}__updating`,connectionStatus:`${Dd}__connection-status`,connectionStatusConnected:`${Dd}__connection-status--connected`,visibleToggle:`${Dd}__visible-toggle`,visibleIcon:`${Dd}__visible-icon`};var Lie;let P1=Lie=class extends AO{constructor(t){super(t),this.displayValueEnabled=!1,this.max=1,this.min=0,this.step=.1,this.type="slider",this.value=null}clone(){return new Lie({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,displayValueEnabled:this.displayValueEnabled,max:this.max,min:this.min,step:this.step,value:this.value})}};h([p()],P1.prototype,"displayValueEnabled",void 0),h([p()],P1.prototype,"max",void 0),h([p()],P1.prototype,"min",void 0),h([p()],P1.prototype,"step",void 0),h([p()],P1.prototype,"value",void 0),P1=Lie=h([I("esri.support.actions.ActionSlider")],P1);const $qt=P1,uGe={hide:"hide",hideChildren:"hide-children"},Rqt=10,Iqt=2;function Lqt({exclusive:t,visible:e,visibilityAppearance:i}){const r=i==="checkbox";return e?t?"circle-f":r?"check-square-f":"view-visible":t?"circle":r?"square":"view-hide"}function Dqt({connectionStatus:t,publishing:e}){return t?t==="connected"?"beacon":"offline":e?"square":"bullet-point"}function Nqt(t){return(t==null?void 0:t.listMode)===uGe.hideChildren}function Xj(t){return(t==null?void 0:t.listMode)??void 0}function Fqt(t){if(!t)return"inherited";const e=zqt(Ace(t)?t.layer:t);return e!=null?e?"independent":"inherited":"visibilityMode"in t&&t.visibilityMode!=null?t.visibilityMode:"independent"}function hGe(t){if(t&&(!("type"in t)||t.type!=="wmts"))return"sublayers"in t?"sublayers":"layers"in t?"layers":void 0}function kqt(t){const e=(t!=null&&t.layer&&Ace(t.layer)?t.layer.layer:void 0)??(t==null?void 0:t.layer);return!!e&&e.type!=="catalog"&&(Bqt(e)??!0)}function Uqt(t){return Xj(t)!==uGe.hide}function dGe(t,e){t==null||t.sort((i,r)=>{const s="uid"in i?e.indexOf(i.uid):-1,n="uid"in r?e.indexOf(r.uid):-1;return s>n?-1:s<n?1:0})}function Vqt(t,e){const i=t==null?void 0:t.layer;if(!i)return;const r=hGe(i);if(!r)return;let s;r==="layers"&&"layers"in i?s=i.layers:r==="sublayers"&&"sublayers"in i&&(s=i.sublayers),dGe(s,e)}function Zxe(t){const e=t==null?void 0:t.layer;return e&&"layers"in e?e.layers:null}function Ace(t){return t!=null&&"layer"in t&&t.layer!=null}function zqt(t){const e=pGe(t);return e!=null&&"supportsSublayerVisibility"in e?e.supportsSublayerVisibility:void 0}function Bqt(t){const e=pGe(t);return e!=null&&"supportsDynamicLayers"in e?e.supportsDynamicLayers:void 0}function pGe(t){return t&&"capabilities"in t&&t.capabilities!=null&&"exportMap"in t.capabilities?t.capabilities.exportMap:void 0}function Hm(t){return t==null?void 0:t["data-item"]}function Yxe(t){return t==null?void 0:t.getAttribute("data-layer-type")}function jqt({children:t,error:e,incompatible:i}){return!!(t!=null&&t.filter(r=>!r.hidden).length)&&!e&&!i}let tl=class extends mw(Wo){constructor(e,i){super(e,i),this._legend=null,this.className=null,this.content=null,this.flowEnabled=!1,this.image=null,this.listItem=null,this.open=!1,this.visible=!0}initialize(){this.addHandles([te(()=>this._canCreateLegend,()=>this._createLegend(),pt),te(()=>[this._legend,this._legendOptions],()=>this._updateLegend(),pt)])}destroy(){this._legend=He(this._legend)}get _canCreateLegend(){const{content:e,listItem:i}=this;if(!i)return!1;const r="legend";return e===r||e!=null&&!!Array.isArray(e)&&e.includes(r)}get _legendOptions(){const{listItem:e,_legendLayerInfo:i}=this,r=e==null?void 0:e.view;return i&&r?{view:r,layerInfos:[i]}:{}}get _legendLayerInfo(){var o;const e=(o=this.listItem)==null?void 0:o.layer;if(!e||e.type==="subtype-sublayer")return null;const i=Ace(e)?e:null,r=e==null?void 0:e.parent,s=r!=null&&"type"in r&&r.type==="map-image"?i==null?void 0:i.source:null,n="";return s&&r?{layer:r,title:n,sublayerIds:[s.mapLayerId]}:{layer:e,title:n}}get disabled(){var s;const{listItem:e,_legend:i,content:r}=this;return!e||!(Array.isArray(r)&&r.length>1)&&!!i&&(!((s=i.activeLayerInfos)!=null&&s.length)||!e.visibleAtCurrentScale||!e.visible)}set disabled(e){this._overrideIfSome("disabled",e)}get icon(){const{image:e}=this,i=this._getFirstWidget();return this._get("icon")??(!e&&i?i.icon:null)}set icon(e){this._overrideIfSome("icon",e)}get title(){var e;return this._get("title")||(((e=this._getFirstWidget())==null?void 0:e.label)??"")}set title(e){this._override("title",e)}render(){return Q("div",{class:"esri-list-item-panel"},this._renderContents())}_renderContent(e){const{_legend:i,disabled:r,open:s}=this;return e&&!r&&s?e==="legend"&&i?Q("div",{key:"legend-widget"},i.render()):typeof e=="string"?Q("div",{innerHTML:e,key:e}):qj(e)?Q("div",{key:"content-widget"},e.render()):e instanceof HTMLElement?Q("div",{afterCreate:this._attachToNode,bind:e,key:"content-element"}):null:null}_renderContents(){const{content:e,open:i}=this;return i?Array.isArray(e)?e.map(r=>this._renderContent(r)):this._renderContent(e):null}async _createLegend(){if(He(this._legend),this._legend=null,!this._canCreateLegend)return;const{default:e}=await oe(()=>import("./Legend-aSZ3Y5CP.js"),__vite__mapDeps([259,133,80,82,56,111])),i=new e(this._legendOptions);this._legend=i}_attachToNode(e){e.appendChild(this)}_updateLegend(){const e=this._legend;e&&e.set(this._legendOptions)}_getWidget(e){return e==="legend"?this._legend:qj(e)?e:null}_getFirstWidget(){const{content:e}=this;return Array.isArray(e)?e.map(i=>this._getWidget(i)).find(i=>i):this._getWidget(e)}};h([p()],tl.prototype,"_legend",void 0),h([p()],tl.prototype,"_canCreateLegend",null),h([p()],tl.prototype,"_legendOptions",null),h([p()],tl.prototype,"_legendLayerInfo",null),h([p()],tl.prototype,"className",void 0),h([p()],tl.prototype,"content",void 0),h([p()],tl.prototype,"disabled",null),h([p()],tl.prototype,"flowEnabled",void 0),h([p()],tl.prototype,"icon",null),h([p()],tl.prototype,"image",void 0),h([p()],tl.prototype,"listItem",void 0),h([p()],tl.prototype,"open",void 0),h([p()],tl.prototype,"title",null),h([p()],tl.prototype,"visible",void 0),tl=h([I("esri.widgets.LayerList.ListItemPanel")],tl);const fGe=tl;var d3;const Gqt=Ke.ofType({key:"type",defaultKeyValue:"button",base:AO,typeMap:{button:Y2,toggle:_6,slider:$qt}}),mGe=Ke.ofType(Gqt),JW="layer",wk="child-list-mode",Hqt="hide";let vs=d3=class extends mw(Ue){constructor(t){super(t),this.actionsSections=new mGe,this.actionsOpen=!1,this.checkPublishStatusEnabled=!1,this.children=new(Ke.ofType(d3)),this.childrenSortable=!0,this.hidden=!1,this.layer=null,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.open=!1,this.panel=null,this.parent=null,this.view=null}initialize(){if(this.addHandles([te(()=>{var t;return[this.layer,(t=this.layer)==null?void 0:t.listMode,this.listModeDisabled]},()=>this._watchLayerProperties(this.layer),pt),te(()=>this.checkPublishStatusEnabled,t=>this._updateChildrenPublishing(t),pt),te(()=>this.view,t=>this._updateChildrenView(t),pt),te(()=>this.panel,t=>this._setListItemOnPanel(t),pt)]),typeof this.listItemCreatedFunction=="function"){const t={item:this};this.listItemCreatedFunction.call(null,t)}}destroy(){var t;(t=this.panel)==null||t.destroy(),this.children.destroyAll(),this.view=null}get connectionStatus(){const{layerView:t,publishing:e}=this;if(!e&&t&&"connectionStatus"in t)return t.connectionStatus}get error(){var t;return(t=this.layer)==null?void 0:t.loadError}get incompatible(){const{layerView:t}=this;return!(!t||!("spatialReferenceSupported"in t))&&!t.spatialReferenceSupported}get layerView(){const{layer:t,view:e}=this;if(!t||!e||t.type==="sublayer")return null;const i=t.type==="subtype-sublayer"?t.parent:t;return e.allLayerViews.find(r=>r.layer===i)??null}castPanel(t){var e;return(e=this.panel)!=null&&e.open&&!t.hasOwnProperty("open")&&(t.open=!0),t?new fGe(t):null}get sortable(){var t;return((t=this.layer)==null?void 0:t.type)!=="knowledge-graph-sublayer"&&this._get("sortable")}set sortable(t){this._set("sortable",t)}get title(){const t=Gc(this,"layer.layer");return(!t||t&&Gc(this,"layer.layer.loaded"))&&Gc(this,"layer.title")||Gc(this,"layer.attributes.title")||""}set title(t){this._override("title",t)}get publishing(){var i;const{layer:t,checkPublishStatusEnabled:e}=this;return e&&t&&"publishingInfo"in t&&((i=t.publishingInfo)==null?void 0:i.status)==="publishing"}get updating(){const{layerView:t,connectionStatus:e,layer:i,publishing:r}=this;return!r&&!e&&(t?t.updating:(i==null?void 0:i.loadStatus)==="loading"||!1)}get visible(){var t;return(t=this.layer)==null?void 0:t.visible}set visible(t){const e=this.layer;e&&(e.visible=t)}get visibleAtCurrentScale(){var t;return((t=this.layerView)==null?void 0:t.visibleAtCurrentScale)??!0}get visibleAtCurrentTimeExtent(){var t;return((t=this.layerView)==null?void 0:t.visibleAtCurrentTimeExtent)??!0}get visibilityMode(){return Fqt(this.layer)}clone(){return new d3({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,checkPublishStatusEnabled:this.checkPublishStatusEnabled,children:this.children.clone(),childrenSortable:this.childrenSortable,hidden:this.hidden,layer:this.layer,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,open:this.open,panel:this.panel,parent:this.parent,sortable:this.sortable,title:this.title,view:this.view,visible:this.visible})}_setListItemOnPanel(t){t&&(t.listItem=this)}_updateChildrenPublishing(t){const e=this.children;e&&e.forEach(i=>i.checkPublishStatusEnabled=t)}_updateChildrenView(t){const e=this.children;e&&e.forEach(i=>i.view=t)}_createChildren(t){const{listModeDisabled:e,children:i}=this,r=t.filter(s=>!i.some(n=>n.layer===s));i.addMany(this._createChildItems(r,e))}_destroyChildren(t){const{children:e}=this,i=e.filter(r=>!t.includes(r.layer));e.destroyMany(i)}_sortChildren(t){this.children.sort((e,i)=>t.indexOf(i.layer)-t.indexOf(e.layer))}_destroyAllChildren(){this.removeHandles(wk),this.children.destroyAll()}_watchChildLayerListMode(t){this.removeHandles(wk),this.listModeDisabled||this.addHandles(t.toArray().map(e=>te(()=>e.listMode,()=>this._compileChildren(t))),wk)}_compileChildren(t){const e=this.listModeDisabled?t:t==null?void 0:t.filter(i=>Xj(i)!==Hqt);e!=null&&e.length?(this._createChildren(e),this._destroyChildren(e),this._sortChildren(e),this._watchChildLayerListMode(t)):this._destroyAllChildren()}_watchSublayerChanges(t){t&&this.addHandles(t.on("change",()=>this._compileChildren(t)),JW)}_initializeChildLayers(t){this._compileChildren(t),this._watchSublayerChanges(t)}_createChildItems(t,e){return t.map(i=>e||Uqt(i)?new d3({layer:i,checkPublishStatusEnabled:this.checkPublishStatusEnabled,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,parent:this,view:this.view}):null).filter(sd).reverse()}_watchLayerProperties(t){if(this.removeHandles(JW),this.removeHandles(wk),!t)return;if((!this.listModeDisabled&&Xj(t))==="hide-children")return void this.children.destroyAll();const e=hGe(t);e&&this.addHandles(te(()=>t[e],i=>{t.hasOwnProperty(e)&&this._initializeChildLayers(i)},pt),JW)}};h([p({type:mGe})],vs.prototype,"actionsSections",void 0),h([p()],vs.prototype,"actionsOpen",void 0),h([p()],vs.prototype,"checkPublishStatusEnabled",void 0),h([p({type:Ke})],vs.prototype,"children",void 0),h([p()],vs.prototype,"childrenSortable",void 0),h([p({readOnly:!0})],vs.prototype,"connectionStatus",null),h([p({readOnly:!0})],vs.prototype,"error",null),h([p()],vs.prototype,"hidden",void 0),h([p({readOnly:!0})],vs.prototype,"incompatible",null),h([p()],vs.prototype,"layer",void 0),h([p({readOnly:!0})],vs.prototype,"layerView",null),h([p()],vs.prototype,"listItemCreatedFunction",void 0),h([p({nonNullable:!0})],vs.prototype,"listModeDisabled",void 0),h([p()],vs.prototype,"open",void 0),h([p({type:fGe})],vs.prototype,"panel",void 0),h([Qt("panel")],vs.prototype,"castPanel",null),h([p()],vs.prototype,"parent",void 0),h([p({value:!0})],vs.prototype,"sortable",null),h([p()],vs.prototype,"title",null),h([p({readOnly:!0})],vs.prototype,"publishing",null),h([p({readOnly:!0})],vs.prototype,"updating",null),h([p()],vs.prototype,"view",void 0),h([p()],vs.prototype,"visible",null),h([p({readOnly:!0})],vs.prototype,"visibleAtCurrentScale",null),h([p({readOnly:!0})],vs.prototype,"visibleAtCurrentTimeExtent",null),h([p({readOnly:!0})],vs.prototype,"visibilityMode",null),vs=d3=h([I("esri.widgets.LayerList.ListItem")],vs);const Pce=vs,Wp={view:"view",viewLayers:"view-layers",mapLayers:"map-layers",layerViews:"layer-views",layerListMode:"layer-list-mode"},qqt="hide",gGe=Ke.ofType(Pce);let vg=class extends Ls.EventedAccessor{constructor(t){super(t),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.operationalItems=new gGe,this.view=null}initialize(){this.addHandles([te(()=>{var t;return((t=this.view)==null?void 0:t.ready)===!0},()=>this._viewHandles(),pt),te(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled,this.listModeDisabled],()=>this._recompileList())],Wp.view)}destroy(){this._removeAllItems(),this.view=null}get state(){const{view:t}=this;return t!=null&&t.ready?"ready":t?"loading":"disabled"}get totalItems(){return this.operationalItems.flatten(t=>t.children).length}triggerAction(t,e){t&&!t.disabled&&this.emit("trigger-action",{action:t,item:e})}moveListItem(t,e,i,r){var f,m;const s=t==null?void 0:t.layer;if(!s||s.type==="subtype-sublayer"||s.type==="sublayer")return;const n=(m=(f=this.view)==null?void 0:f.map)==null?void 0:m.layers,o=e?Zxe(e):n,a=i?Zxe(i):n;if(!o||!a)return;const{operationalItems:l}=this,c=(e==null?void 0:e.children)||l,u=(i==null?void 0:i.children)||l,d=a.length-r;t.parent=i||null,c.remove(t),o.remove(s),u.includes(t)||u.add(t,d),a.includes(s)||a.add(s,d),this._compileList()}_createLayerViewHandles(t){this.removeHandles(Wp.layerViews),this._compileList(),t&&this.addHandles(t.on("change",()=>this._compileList()),Wp.layerViews)}_createMapLayerHandles(t){this.removeHandles(Wp.mapLayers),this._compileList(),t&&this.addHandles(t.on("change",()=>this._compileList()),Wp.mapLayers)}_createListItem(t){const{view:e,listItemCreatedFunction:i,checkPublishStatusEnabled:r,listModeDisabled:s}=this;return new Pce({checkPublishStatusEnabled:r,listModeDisabled:s,layer:t,listItemCreatedFunction:i,view:e})}_removeAllItems(){this.operationalItems.destroyAll()}_getViewableLayers(t){return t?this.listModeDisabled?t:t.filter(e=>Xj(e)!==qqt):void 0}_watchLayersListMode(t){this.removeHandles(Wp.layerListMode),t&&!this.listModeDisabled&&this.addHandles(te(()=>t.filter(e=>"listMode"in e).map(e=>e.listMode).toArray(),()=>this._compileList()),Wp.layerListMode)}_compileList(){var i,r;const t=(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.layers;this._watchLayersListMode(t);const e=this._getViewableLayers(t);e!=null&&e.length?(this._createNewItems(e),this._removeItems(e),this._sortItems(e)):this._removeAllItems()}_createNewItems(t){const{operationalItems:e}=this;t.forEach(i=>{e.some(r=>r.layer===i)||e.add(this._createListItem(i))})}_removeItems(t){const{operationalItems:e}=this,i=[];e.forEach(r=>{r&&t&&t.includes(r.layer)||i.push(r)}),e.destroyMany(i)}_sortItems(t){const{operationalItems:e}=this;e.sort((i,r)=>{const s=t.indexOf(i.layer),n=t.indexOf(r.layer);return s>n?-1:s<n?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){const{view:t}=this;this.removeHandles([Wp.mapLayers,Wp.layerViews,Wp.viewLayers]),t!=null&&t.ready?this.addHandles([te(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.allLayers},e=>this._createMapLayerHandles(e),pt),te(()=>{var e;return(e=this.view)==null?void 0:e.allLayerViews},e=>this._createLayerViewHandles(e),pt)],Wp.viewLayers):this._removeAllItems()}};h([p()],vg.prototype,"checkPublishStatusEnabled",void 0),h([p()],vg.prototype,"listItemCreatedFunction",void 0),h([p({nonNullable:!0})],vg.prototype,"listModeDisabled",void 0),h([p({type:gGe})],vg.prototype,"operationalItems",void 0),h([p({readOnly:!0})],vg.prototype,"state",null),h([p()],vg.prototype,"totalItems",null),h([p()],vg.prototype,"view",void 0),vg=h([I("esri.widgets.LayerList.LayerListViewModel")],vg);const yGe=vg;let Nd=class extends Ue{constructor(){super(...arguments),this.catalogLayerList=!0,this.closeButton=!1,this.collapseButton=!1,this.errors=!1,this.filter=!1,this.flow=!0,this.heading=!1,this.statusIndicators=!0,this.temporaryLayerIndicators=!1}};h([p({type:Boolean,nonNullable:!0})],Nd.prototype,"catalogLayerList",void 0),h([p({type:Boolean,nonNullable:!0})],Nd.prototype,"closeButton",void 0),h([p({type:Boolean,nonNullable:!0})],Nd.prototype,"collapseButton",void 0),h([p({type:Boolean,nonNullable:!0})],Nd.prototype,"errors",void 0),h([p({type:Boolean,nonNullable:!0})],Nd.prototype,"filter",void 0),h([p({type:Boolean,nonNullable:!0})],Nd.prototype,"flow",void 0),h([p({type:Boolean,nonNullable:!0})],Nd.prototype,"heading",void 0),h([p({type:Boolean,nonNullable:!0})],Nd.prototype,"statusIndicators",void 0),h([p({type:Boolean,nonNullable:!0})],Nd.prototype,"temporaryLayerIndicators",void 0),Nd=h([I("esri.widgets.LayerList.LayerListVisibleElements")],Nd);const _Ge=Nd,Wqt=Ke.ofType(Pce);let Wi=class extends mw(Wo){constructor(t,e){super(t,e),this._activeItem=null,this._tooltipReferenceMap=new N3,this._focusRootFlowItem=!1,this._focusPanelFlowItem=!1,this._focusTableListFlowItem=!1,this._focusCatalogFlowItem=!1,this._lastDragDetail=null,this._selectedDragItemLayerUid=null,this._rootGroupUid=`operational-${this.uid}`,this.catalogLayerList=null,this.catalogOptions=null,this.collapsed=!1,this.dragEnabled=!1,this.filterPlaceholder="",this.filterText="",this.headingLevel=2,this.knowledgeGraphOptions=null,this.listItemCanGiveFunction=null,this.listItemCanReceiveFunction=null,this.messages=null,this.messagesCommon=null,this.minDragEnabledItems=Iqt,this.minFilterItems=Rqt,this.openCatalogItem=null,this.openTableListItem=null,this.selectedItems=new Wqt,this.selectionMode="none",this.tableList=null,this.viewModel=new yGe,this.visibilityAppearance="default",this.visibleElements=new _Ge,this._canMove=({dragEl:i,fromEl:r,toEl:s},n)=>{var T,E,M;const o=n==="pull"?this.listItemCanGiveFunction:this.listItemCanReceiveFunction,a=Hm(i);if(!(a!=null&&a.sortable))return!1;const l=Hm(r),c=Yxe(r),u=Hm(s),d=Yxe(s),f=!!c&&!!d&&c===d,m={selected:a,from:l,to:u},g=r.group,y=s.group,v=((T=l==null?void 0:l.layer)==null?void 0:T.type)??"",b=((E=u==null?void 0:u.layer)==null?void 0:E.type)??"",w=new Set(["map-image","catalog","knowledge-graph"]);return g&&y&&typeof o=="function"?o.call(null,m):f&&!w.has(v)&&!w.has(b)&&((M=a==null?void 0:a.layer)==null?void 0:M.type)!=="sublayer"},this._clearActiveItem=()=>{this._activeItem=null},this._setActiveItem=i=>{if(this.visibilityAppearance!=="default")return;const r=Array.from(i.composedPath()).find(s=>{var n;return(n=s.classList)==null?void 0:n.contains(ys.item)});this._activeItem=Hm(r)},this._onCalciteListOrderChange=i=>{const{_lastDragDetail:r}=this,{toEl:s,fromEl:n,dragEl:o,newIndex:a}=i;if(n&&s&&!((r==null?void 0:r.newIndex)===a&&(r==null?void 0:r.dragEl)===o&&(r==null?void 0:r.toEl)===s&&(r==null?void 0:r.fromEl)===n))if(this._lastDragDetail=i,n!==s)this._moveLayerFromChildList({toEl:s,fromEl:n,dragEl:o,newIndex:a});else{const l=Array.from(n.children).filter(c=>c==null?void 0:c.matches("calcite-list-item")).map(c=>c.value);this._sortLayers(n,l)}}}initialize(){this.addHandles([te(()=>this.openCatalogItem,t=>t?this._createCatalog():this._destroyCatalog()),te(()=>this.openTableListItem,t=>t?this._createTableList():this._destroyTableList())])}loadDependencies(){return Cp({action:()=>oe(()=>import("./calcite-action-Dhk8OhY7.js"),__vite__mapDeps([248,245,200,201,202,205,206,207,208,204,209,210])),"action-group":()=>oe(()=>import("./calcite-action-group-C3SKU4KD.js"),__vite__mapDeps([256,255,247,208,205,206,200,201,207,250,245,202,204,209,210,215,216,251,217,218])),"action-menu":()=>oe(()=>import("./calcite-action-menu-DkzMeh6a.js"),__vite__mapDeps([260,250,200,201,207,205,245,202,206,208,204,209,210,215,216,251,217,218])),button:()=>oe(()=>import("./calcite-button-wzbJSjju.js"),__vite__mapDeps([198,199,200,201,202,203,204,205,206,207,208,209,210])),flow:()=>oe(()=>import("./calcite-flow-LTs5LM2h.js"),__vite__mapDeps([257,208,205])),"flow-item":()=>oe(()=>import("./calcite-flow-item-f0hju3wh.js"),__vite__mapDeps([249,200,201,202,205,206,207,208,250,245,204,209,210,215,216,251,217,218,243])),icon:()=>oe(()=>import("./calcite-icon-eob-Ctv5.js"),__vite__mapDeps([211,209,200,201,208])),list:()=>oe(()=>import("./calcite-list-CjOh8dex.js"),__vite__mapDeps([239,200,201,202,208,240,241,205,206,207,216,209,242,199,203,204,210,243])),"list-item":()=>oe(()=>import("./calcite-list-item-uP1R-DBp.js"),__vite__mapDeps([244,200,201,202,206,207,208,205,241,240,245,204,209,210])),notice:()=>oe(()=>import("./calcite-notice-DUqL5bU5.js"),__vite__mapDeps([246,247,208,200,201,205,206,207,217,204,209])),tooltip:()=>oe(()=>import("./calcite-tooltip-BQEWocaS.js"),__vite__mapDeps([214,200,201,215,216,217,218]))})}destroy(){this._destroyTableList(),this._tooltipReferenceMap.clear()}get _totalItems(){return this.viewModel.operationalItems.flatten(t=>t.children.filter(e=>e.layer.type!=="catalog-dynamic-group")).length}get _dragEnabled(){return this._totalItems>=this.minDragEnabledItems&&this.dragEnabled}get _filterEnabled(){return this._totalItems>=this.minFilterItems&&this.visibleElements.filter}get icon(){return"layers"}set icon(t){this._overrideIfSome("icon",t)}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get listItemCreatedFunction(){return this.viewModel.listItemCreatedFunction}set listItemCreatedFunction(t){this.viewModel.listItemCreatedFunction=t}get multipleSelectionEnabled(){return s_(ne.getLogger(this),"multipleSelectionEnabled",{replacement:"selectionMode",version:"4.29",warnOnce:!0}),this.selectionMode==="multiple"}set multipleSelectionEnabled(t){s_(ne.getLogger(this),"multipleSelectionEnabled",{replacement:"selectionMode",version:"4.29",warnOnce:!0}),this.selectionMode=t?"multiple":this.selectionEnabled?"single":"none"}get operationalItems(){return this.viewModel.operationalItems}set operationalItems(t){this.viewModel.operationalItems=t}get selectionEnabled(){return s_(ne.getLogger(this),"selectionEnabled",{replacement:"selectionMode, dragEnabled",version:"4.29",warnOnce:!0}),this.selectionMode!=="none"&&this.dragEnabled}set selectionEnabled(t){s_(ne.getLogger(this),"selectionEnabled",{replacement:"selectionMode, dragEnabled",version:"4.29",warnOnce:!0}),this.dragEnabled=t,this.selectionMode=t?this.multipleSelectionEnabled?"multiple":"single":"none"}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}triggerAction(t,e){return this.viewModel.triggerAction(t,e)}render(){var r,s;const t=(r=this.viewModel)==null?void 0:r.state,e={[Jt.hidden]:t==="loading",[Jt.disabled]:t==="disabled"},i=(s=this.operationalItems)==null?void 0:s.filter(n=>!n.hidden&&(this.visibleElements.errors||!n.error));return Q("div",{class:this.classes(ys.base,Jt.widget,Jt.panel,e)},i!=null&&i.length?[this._renderItemTooltips(i),this._renderItems(i)]:this._renderNoItems())}_renderItemTooltip(t){const{_tooltipReferenceMap:e,messages:i}=this;return t?Q("calcite-tooltip",{key:`tooltip-${t.layer.uid}`,referenceElement:e.get(t.layer.uid)},i.layerIncompatibleTooltip):null}_renderItemTooltipNodes(t){var e;return t.incompatible?this._renderItemTooltip(t):(e=t.children)==null?void 0:e.filter(i=>!i.hidden).toArray().map(i=>this._renderItemTooltipNodes(i))}_renderItemTooltips(t){return t==null?void 0:t.toArray().map(e=>this._renderItemTooltipNodes(e))}_renderNoItemsMessage(){return Q("div",{slot:"message"},this.messages.noItemsToDisplay)}_renderNoItems(){return Q("div",{class:ys.itemMessage,key:"esri-layer-list__no-items"},Q("calcite-notice",{icon:"information",kind:"info",open:!0,width:"full"},this._renderNoItemsMessage()))}_destroyCatalog(){var t;(t=this.catalogLayerList)==null||t.destroy(),this._set("catalogLayerList",null)}_destroyTableList(){var t;(t=this.tableList)==null||t.destroy(),this._set("tableList",null)}async _createCatalog(){var u;this._destroyCatalog();const{default:t}=await oe(()=>import("./CatalogLayerList-CUxjbC2-.js"),[]),{headingLevel:e,catalogOptions:i,view:r,filterPlaceholder:s,listItemCreatedFunction:n,minFilterItems:o,selectionMode:a,visibilityAppearance:l}=this,c=(u=this.openCatalogItem)==null?void 0:u.layer;this._set("catalogLayerList",new t({headingLevel:e,view:r,filterPlaceholder:s,listItemCreatedFunction:n,minFilterItems:o,selectionMode:a,visibilityAppearance:l,...i,catalogLayer:c}))}_getTableListParams(t){const e=t==null?void 0:t.layer;return(e==null?void 0:e.type)==="knowledge-graph"?{...this.knowledgeGraphOptions,tables:e==null?void 0:e.tables}:null}async _createTableList(){var n;this._destroyTableList();const{default:t}=await oe(()=>import("./TableList-CCAIfdlA.js"),[]),e=this._getTableListParams(this.openTableListItem);if(!((n=e==null?void 0:e.tables)!=null&&n.length))return;const{headingLevel:i,selectionMode:r,dragEnabled:s}=this;this._set("tableList",new t({headingLevel:i,selectionMode:r,dragEnabled:s,...e}))}_renderCatalogFlowItem(){var r;const{openCatalogItem:t,messages:e}=this;if(!t)return null;const i=this._getLayerTitle(t);return Q("calcite-flow-item",{afterCreate:this._focusCatalogFlowItemNode,afterUpdate:this._focusCatalogFlowItemNode,bind:this,description:i,heading:e.catalogLayers,headingLevel:this.headingLevel,key:`flow-catalog-${t.uid}`,onCalciteFlowItemBack:s=>{s.preventDefault(),this.openCatalogItem=null,this._focusRootFlowItem=!0}},(r=this.catalogLayerList)==null?void 0:r.render())}_renderTableListFlowItem(){var r;const{openTableListItem:t,messages:e}=this;if(!t)return null;const i=this._getLayerTitle(t);return Q("calcite-flow-item",{afterCreate:this._focusTableListFlowItemNode,afterUpdate:this._focusTableListFlowItemNode,bind:this,description:i,heading:e.tables,headingLevel:this.headingLevel,key:`flow-table-list-${t.uid}`,onCalciteFlowItemBack:s=>{s.preventDefault(),this.openTableListItem=null,this._focusRootFlowItem=!0}},(r=this.tableList)==null?void 0:r.render())}_renderPanelFlowItems(t){return t?t.flatten(e=>e.children).filter(({hidden:e,panel:i})=>!e&&(i==null?void 0:i.open)&&!i.disabled&&i.flowEnabled).toArray().map(({title:e,panel:i})=>{const r=()=>this._handlePanelFlowItemBack(i);return Q("calcite-flow-item",{afterCreate:this._focusPanelFlowItemNode,afterUpdate:this._focusPanelFlowItemNode,bind:this,description:e,heading:i.title,headingLevel:this.headingLevel,key:`flow-panel-${i.uid}`,onCalciteFlowItemBack:s=>{s.preventDefault(),r()}},i.render(),Q("calcite-button",{appearance:"transparent",onclick:r,slot:"footer-actions",width:"full"},this.messagesCommon.back))}):[]}_handlePanelFlowItemBack(t){t.open=!1,this._focusRootFlowItem=!0}_focusRootFlowItemNode(t){this._focusRootFlowItem&&(this._focusRootFlowItem=!1,requestAnimationFrame(()=>t==null?void 0:t.setFocus()))}_focusCatalogFlowItemNode(t){this._focusCatalogFlowItem&&(this._focusCatalogFlowItem=!1,requestAnimationFrame(()=>t==null?void 0:t.setFocus()))}_focusTableListFlowItemNode(t){this._focusTableListFlowItem&&(this._focusTableListFlowItem=!1,requestAnimationFrame(()=>t==null?void 0:t.setFocus()))}_focusPanelFlowItemNode(t){this._focusPanelFlowItem&&(this._focusPanelFlowItem=!1,requestAnimationFrame(()=>t==null?void 0:t.setFocus()))}_renderItems(t){const{visible:e,collapsed:i,_filterEnabled:r,_rootGroupUid:s,visibleElements:{closeButton:n,collapseButton:o,heading:a,flow:l},_dragEnabled:c,selectionMode:u,filterText:d,filterPlaceholder:f,messages:m}=this,g=[Q("calcite-flow-item",{afterCreate:this._focusRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,closable:n,closed:!e,collapsed:i,collapsible:o,heading:a?m.widgetLabel:void 0,headingLevel:this.headingLevel,key:"root-flow-item",onCalciteFlowItemClose:()=>this.visible=!1},Q("calcite-list",{afterCreate:y=>{y.addEventListener("focusin",this._setActiveItem),y.addEventListener("focusout",this._clearActiveItem)},afterRemoved:y=>{y.removeEventListener("focusin",this._setActiveItem),y.removeEventListener("focusout",this._clearActiveItem)},canPull:y=>this._canMove(y,"pull"),canPut:y=>this._canMove(y,"put"),"data-layer-type":s,dragEnabled:c,filterEnabled:r,filterPlaceholder:f,filterText:r?d:"",group:s,key:"root-list",label:m.widgetLabel,onmouseleave:this._clearActiveItem,onmouseover:this._setActiveItem,selectionAppearance:"border",selectionMode:u,onCalciteListChange:y=>this._handleCalciteListChange(y),onCalciteListDragEnd:y=>this._handleCalciteListDragEnd(y.detail),onCalciteListFilter:y=>{var v;return this.filterText=((v=y.target)==null?void 0:v.filterText)??""},onCalciteListOrderChange:y=>this._onCalciteListOrderChange(y.detail)},t==null?void 0:t.toArray().map(y=>this._renderItem(y)),t!=null&&t.length&&r?Q("div",{class:ys.filterNoResults,slot:"filter-no-results"},Q("calcite-notice",{kind:"info",open:!0,width:"full"},this._renderNoItemsMessage())):null)),this._renderPanelFlowItems(t),this._renderTableListFlowItem(),this._renderCatalogFlowItem()];return e?l?Q("calcite-flow",{key:"root-flow"},g):g:null}_renderChildList(t,e=[]){var u,d,f,m;const{_dragEnabled:i,_rootGroupUid:r,viewModel:{listModeDisabled:s},messages:n,selectionMode:o}=this,{children:a}=t,l=((u=t.layer)==null?void 0:u.type)!=="catalog-dynamic-group"&&jqt(t),c=!(!s&&Nqt(t.layer))&&!l&&i&&((d=t.layer)==null?void 0:d.type)==="group";return l||c?Q("calcite-list",{canPull:g=>this._canMove(g,"pull"),canPut:g=>this._canMove(g,"put"),"data-item":t,"data-layer-type":r,dragEnabled:!!i&&t.childrenSortable&&kqt(t),group:`${r}-${t.layer.uid}`,key:`child-list-${t.layer.uid}`,selectionAppearance:"border",selectionMode:o},a==null?void 0:a.filter(g=>!g.hidden).toArray().map(g=>this._renderItem(g,t,[...e,t.title])),(m=(f=this._getTableListParams(t))==null?void 0:f.tables)!=null&&m.length?Q("calcite-list-item",{class:ys.item,"data-layer-id":t.layer.id,dragDisabled:!0,key:`list-item-table-list-tables-${t.layer.uid}`,title:n.tables,onCalciteListItemSelect:()=>{this.openTableListItem=t,this._focusTableListFlowItem=!0}},Q("div",{class:ys.itemContent,slot:"content"},n.tables),Q("calcite-icon",{class:ys.itemTableIcon,icon:"table",scale:"s",slot:"content-start"}),Q("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"})):null):null}_renderItemMessage(t){return t.error?Q("div",{class:ys.itemMessage,key:"esri-layer-list__error",slot:"content-bottom"},Q("calcite-notice",{icon:"exclamation-mark-triangle",kind:"warning",open:!0,scale:"s",width:"full"},Q("div",{slot:"message"},this.messages.layerError))):t.incompatible?Q("div",{class:ys.itemMessage,key:"esri-layer-list__incompatible",slot:"content-bottom"},Q("calcite-notice",{afterCreate:e=>this._setTooltipReference(e,t),afterRemoved:()=>this._removeTooltipReference(t),bind:this,icon:"exclamation-mark-triangle",kind:"warning",open:!0,scale:"s",tabIndex:0,width:"full"},Q("div",{slot:"message"},this.messages.layerIncompatible))):null}_getLayerTitle(t){return t.title||this.messages.untitledLayer}_renderItem(t,e,i){var x,T,E,M;const{_activeItem:r,_selectedDragItemLayerUid:s,selectionMode:n,selectedItems:o,messages:a,visibleElements:l}=this,c=this._getLayerTitle(t),u=t.visibleAtCurrentTimeExtent?t.visibleAtCurrentScale?c:`${c} (${a.layerInvisibleAtScale})`:`${c} (${a.layerInvisibleAtTime})`,d=this._filterActions(t.actionsSections),f=this._countActions(d),m=((T=(x=t.parent)==null?void 0:x.layer)==null?void 0:T.type)==="catalog",g=((E=t.layer)==null?void 0:E.type)==="catalog-footprint",y=((M=t.layer)==null?void 0:M.type)==="catalog-dynamic-group",v=g?Q("calcite-icon",{class:ys.itemCatalogIcon,icon:"footprint",key:"footprint",scale:"s",slot:"content-start"}):null,b=y?Q("calcite-icon",{class:ys.itemCatalogIcon,icon:"catalog-dataset",key:"catalog-dataset",scale:"s",slot:"content-start"}):null,w=l.catalogLayerList&&y?Q("calcite-action",{appearance:"transparent",disabled:!t.layer.visible,icon:"chevron-right",iconFlipRtl:!0,onclick:()=>{this.openCatalogItem=e,this._focusCatalogFlowItem=!0},scale:"s",slot:"actions-end",text:c}):null;return Q("calcite-list-item",{afterCreate:O=>this._focusSelectedDragEl(O,t),afterUpdate:O=>this._focusSelectedDragEl(O,t),class:this.classes(ys.item,{[ys.itemActive]:r===t}),"data-item":t,"data-layer-id":t.layer.id,dragDisabled:!t.sortable||m,dragSelected:t.layer.uid===s,id:t.layer.uid,key:`list-item-${t.layer.uid}`,label:c,metadata:{parentTitles:i,title:c},open:t.open,selected:n!=="none"&&o.includes(t),title:u,value:t.layer.uid,onCalciteListItemDragHandleChange:O=>this._handleCalciteListItemDragHandleChange(O,t),onCalciteListItemSelect:O=>this._handleCalciteListItemSelect(O,t,e),onCalciteListItemToggle:O=>this._handleCalciteListItemToggle(O,t)},v,b,Q("div",{class:this.classes({[ys.itemContent]:!0,[ys.itemInvisible]:!t.visibleAtCurrentScale||!t.visibleAtCurrentTimeExtent}),slot:"content"},c),this._renderItemStatus(t,e),this._renderItemToggle(t,e),w,this._renderItemTemporaryIcon(t),this._renderChildList(t,i),this._renderItemMessage(t),this._renderPanel(t.panel),this._renderPanelAction(t.panel),f>1?this._renderActionsSections(t,d):f===1?this._renderAction({item:t,action:this._getSingleAction(d),textEnabled:!1}):null)}_renderItemStatus(t,e){const{visibleElements:i}=this;if(!i.statusIndicators)return null;const{connectionStatus:r,publishing:s,updating:n}=t,o=n&&!e,a=!!r;return Q("calcite-icon",{class:this.classes({[ys.statusIndicator]:!0,[ys.publishing]:s,[ys.updating]:o,[ys.connectionStatus]:a,[ys.connectionStatusConnected]:a&&r==="connected"}),icon:Dqt({connectionStatus:r,publishing:s}),key:"layer-item-status",scale:"s",slot:"actions-end"})}_renderItemTemporaryIcon(t){return this.visibleElements.temporaryLayerIndicators&&"persistenceEnabled"in t.layer&&!t.layer.persistenceEnabled?Q("calcite-icon",{class:ys.itemTemporaryIcon,icon:"temporary",key:"temporary-icon",scale:"s",slot:"actions-start",title:this.messages.temporary}):null}_renderItemToggle(t,e){const{messages:i,visibilityAppearance:r}=this,{visible:s}=t,n=e==null?void 0:e.visibilityMode;if(n==="inherited")return null;const o=Lqt({visible:s,exclusive:n==="exclusive",visibilityAppearance:r}),a=r==="checkbox",l=i.layerVisibility;return Q("calcite-action",{appearance:"transparent",class:ys.visibleToggle,icon:a?o:void 0,key:"visibility-toggle",onclick:()=>this._toggleVisibility(t,e),scale:"s",slot:a?"actions-start":"actions-end",text:l,title:l},a?null:Q("calcite-icon",{class:this.classes({[ys.visibleIcon]:n!=="exclusive"&&s}),icon:o,scale:"s"}))}_renderPanel(t){return!(t!=null&&t.open)||t.disabled||t.flowEnabled?null:Q("div",{class:ys.itemContentBottom,key:`content-panel-${t.uid}`,slot:"content-bottom"},t.render())}_renderPanelAction(t){if(!(t!=null&&t.visible))return null;const{open:e,title:i,disabled:r}=t;return Q("calcite-action",{active:e,appearance:"transparent",disabled:r,icon:iwe(t),key:`action-${t.uid}`,onclick:()=>this._togglePanel(t),scale:"s",slot:"actions-end",text:i??"",title:i??void 0},this._renderFallbackIcon(t))}_renderActionsSections(t,e){const i=this.messagesCommon.options;return Q("calcite-action-menu",{appearance:"transparent",class:ys.actionMenu,key:"item-action-menu",label:this.messagesCommon.menu,open:t.actionsOpen,overlayPositioning:"fixed",placement:"bottom-end",scale:"s",slot:"actions-end",onCalciteActionMenuOpen:r=>t.actionsOpen=r.target.open},Q("calcite-action",{appearance:"transparent",icon:"ellipsis",scale:"s",slot:"trigger",text:i,title:i}),e.toArray().map((r,s)=>this._renderActionSection(t,r,s)))}_renderActionSection(t,e,i){return Q("calcite-action-group",{class:ys.actionGroup,key:`action-section-${i}`},e.toArray().map(r=>this._renderAction({item:t,action:r,textEnabled:!0})))}_renderFallbackIcon(t){const{className:e,icon:i}=t;if(i)return null;const r="image"in t?t.image:void 0,s={[ys.itemActionIcon]:!!e,[ys.itemActionImage]:!!r};return e&&(s[e]=!0),r||e?Q("span",{"aria-hidden":"true",class:this.classes(ys.itemActionIcon,s),key:"icon",styles:RBe(r)}):null}_renderAction(t){const{item:e,action:i,textEnabled:r}=t;if(!i)return null;const{active:s,disabled:n,title:o,type:a,indicator:l}=i;return Q("calcite-action",{active:a==="toggle"&&i.value,appearance:"transparent",disabled:n,icon:iwe(i),indicator:l,key:`action-${i.uid}`,loading:s,onclick:()=>this._triggerAction(e,i),scale:"s",slot:r?void 0:"actions-end",text:o??"",textEnabled:r,title:o??void 0},this._renderFallbackIcon(i))}_setTooltipReference(t,e){this._tooltipReferenceMap.set(e.layer.uid,t)}_removeTooltipReference(t){this._tooltipReferenceMap.delete(t.layer.uid)}_moveLayerFromChildList({toEl:t,fromEl:e,dragEl:i,newIndex:r}){const s=Hm(i),n=Hm(t),o=Hm(e);this.viewModel.moveListItem(s,o,n,r)}_handleCalciteListDragEnd(t){const{fromEl:e,dragEl:i,oldIndex:r}=t;e.insertBefore(i,e.children[r])}_sortLayers(t,e){var i,r;if(t)if(t.group===this._rootGroupUid)dGe((r=(i=this.view)==null?void 0:i.map)==null?void 0:r.layers,e);else{const s=Hm(t);if(!s)return;Vqt(s,e)}}_getSingleAction(t){return t.reduce(e=>e).find(e=>e&&(e.type==="button"||e.type==="toggle"))}_filterActions(t){return t.map(e=>e.filter(i=>i.visible))}_countActions(t){return t.reduce((e,i)=>e+i.length,0)}_triggerAction(t,e){e&&t&&(e.type==="toggle"&&(e.value=!e.value),this.triggerAction(e,t))}_handleCalciteListChange(t){const{selectionMode:e,selectedItems:i}=this;if(e==="none")return;const r=t.target.selectedItems.map(s=>Hm(s)).filter(Boolean);i.removeAll(),i.addMany(r)}_handleCalciteListItemToggle(t,e){t.stopPropagation(),e.open=t.target.open}_focusSelectedDragEl(t,e){this._selectedDragItemLayerUid===e.layer.uid&&requestAnimationFrame(()=>t==null?void 0:t.setFocus())}_handleCalciteListItemDragHandleChange(t,e){t.stopPropagation();const i=t.target.dragSelected;this._selectedDragItemLayerUid=i?e.layer.uid:null}_handleCalciteListItemSelect(t,e,i){Hm(t.target)===e&&this.selectionMode==="none"&&(i==null?void 0:i.visibilityMode)!=="inherited"&&this._toggleVisibility(e,i)}_togglePanel(t){t.open=!t.open,t.open&&(this._focusPanelFlowItem=!0)}_toggleVisibility(t,e){if(!t)return;(e==null?void 0:e.visibilityMode)==="exclusive"&&t.visible||(t.visible=!t.visible)}};h([p()],Wi.prototype,"_activeItem",void 0),h([p()],Wi.prototype,"_tooltipReferenceMap",void 0),h([p()],Wi.prototype,"_focusRootFlowItem",void 0),h([p()],Wi.prototype,"_focusPanelFlowItem",void 0),h([p()],Wi.prototype,"_focusTableListFlowItem",void 0),h([p()],Wi.prototype,"_focusCatalogFlowItem",void 0),h([p()],Wi.prototype,"_totalItems",null),h([p()],Wi.prototype,"_dragEnabled",null),h([p()],Wi.prototype,"_filterEnabled",null),h([p({readOnly:!0})],Wi.prototype,"catalogLayerList",void 0),h([p()],Wi.prototype,"catalogOptions",void 0),h([p()],Wi.prototype,"collapsed",void 0),h([p()],Wi.prototype,"dragEnabled",void 0),h([p()],Wi.prototype,"filterPlaceholder",void 0),h([p()],Wi.prototype,"filterText",void 0),h([p()],Wi.prototype,"headingLevel",void 0),h([p()],Wi.prototype,"icon",null),h([p()],Wi.prototype,"knowledgeGraphOptions",void 0),h([p()],Wi.prototype,"label",null),h([p()],Wi.prototype,"listItemCanGiveFunction",void 0),h([p()],Wi.prototype,"listItemCanReceiveFunction",void 0),h([p()],Wi.prototype,"listItemCreatedFunction",null),h([p(),qo("esri/widgets/LayerList/t9n/LayerList")],Wi.prototype,"messages",void 0),h([p(),qo("esri/t9n/common")],Wi.prototype,"messagesCommon",void 0),h([p()],Wi.prototype,"minDragEnabledItems",void 0),h([p()],Wi.prototype,"minFilterItems",void 0),h([p()],Wi.prototype,"multipleSelectionEnabled",null),h([p()],Wi.prototype,"openCatalogItem",void 0),h([p()],Wi.prototype,"openTableListItem",void 0),h([p()],Wi.prototype,"operationalItems",null),h([p()],Wi.prototype,"selectionEnabled",null),h([p()],Wi.prototype,"selectedItems",void 0),h([p()],Wi.prototype,"selectionMode",void 0),h([p({readOnly:!0})],Wi.prototype,"tableList",void 0),h([p()],Wi.prototype,"view",null),h([V8("trigger-action"),p({type:yGe})],Wi.prototype,"viewModel",void 0),h([p()],Wi.prototype,"visibilityAppearance",void 0),h([p({type:_Ge,nonNullable:!0})],Wi.prototype,"visibleElements",void 0),Wi=h([I("esri.widgets.LayerList")],Wi);const Zqt=Wi;let Yqt=class{constructor(){Pp(this,"spatialReference",{spatialReference_EPSG3111:{name:"",spatialReferenceObj:new Ye({wkid:3111})},spatialReference_EPSG28355:{name:"",spatialReferenceObj:new Ye({wkid:28355})},spatialReference_EPSG4326:{name:"",spatialReferenceObj:new Ye({wkid:3857})},spatialReference_EPSG3857:{name:"",spatialReferenceObj:Ye.WGS84},spatialReference_EPSG7844:{name:"",spatialReferenceObj:new Ye({wkid:7844})}});Pp(this,"view",null);Pp(this,"map",null)}addDefaultTools(e,i){xHe("en-GB"),this.setProjectionName(this.spatialReference);const r=this.view;r.ui.remove("navigation-toggle"),r.ui.move(["zoom","compass"],"bottom-right");let s=new SBe;s.view=r;var n=new Mzt;n.view=r,r.ui.add(n,"bottom-right"),console.debug(`Adding layer list to containe: ${e}`);const o=new Zqt({view:r,container:e});console.debug(o),i()}setProjectionName(e){for(let i in e){let r=e[i],s=`https://epsg.io/${r.spatialReferenceObj.wkid}.json`,n=new Request(s);fetch(n).then(function(o){if(console.debug(o),o.status===200)o.json().then(function(a){r.name=a.name,console.debug(a)});else throw new Error("Something went wrong on API server!")}).catch(function(o){console.error(o)}),console.log(i)}}initialiseMap(e,i,r){throw console.debug(e),console.debug(i),console.debug(r),new Error("The method can only be called from extended class. EG Map3D.")}};class Xqt extends Yqt{constructor(){super();Pp(this,"view",new twe);Pp(this,"map",new Fde)}initialiseMap(i,r,s){let n=null;console.log(window.location.href);const a=`${window.location.href}/map/MelbourneDigitalTwin.json`,l=new Request(a);fetch(l).then(c=>{if(console.debug(c),c.status===200)c.json().then(u=>{console.debug(u),n=Fde.fromJSON(u),this.map=n,this.setWebMap(n,i,r,s)});else throw new Error(`Request Error: ${a}`)})}setWebMap(i,r,s,n){const o=new twe({container:r,map:i,popupEnabled:!0,popup:new cGe});this.view=o,o.when().then(()=>{this.addDefaultTools(s,()=>{this.add3DWidgets(this)}),n()})}add3DWidgets(i){console.debug(i)}}const rS=class rS{constructor(){Pp(this,"elementLayerList2D",new HTMLElement);Pp(this,"elementLayerList3D",new HTMLElement)}static getInstance(){return rS.instance||(rS.instance=new rS),rS.instance}};Pp(rS,"instance");let Die=rS;class Jqt extends Die{}var vGe=(t=>(t.ARCGIS="ArcGIS",t))(vGe||{}),bGe=(t=>(t.TheeDimension="3D",t))(bGe||{});class Qqt{static getMapEngine(e,i){switch(e){case"ArcGIS":if(i=="3D")return new Xqt;throw new Error("Invalid Map Type.");default:throw new Error("Invalid Map Engine.")}}static getViewEngine(e){switch(e){case"ArcGIS":return Jqt.getInstance();default:throw new Error("Invalid View Engine.")}}}const G1=class G1{constructor(){Pp(this,"viewObj",null)}static getInstance(e){return G1.instance||(G1.instance=new G1,G1.instance.initialise(e)),G1.instance}initialise(e){this.viewObj=e,console.log("Initialise Map");const i=this.viewObj.map.id.THREED,r=this.viewObj.map.layerList.id.THREED,s=Qqt.getMapEngine(vGe.ARCGIS,bGe.TheeDimension);s.initialiseMap(i,r,this.postMapInitialise),console.debug(s)}postMapInitialise(){}};Pp(G1,"instance");let Nie=G1;const Kqt={data(){return{device:{isMobile:!1,isLandScape:!0},map:{id:{TWOD:"",THREED:""},active:"",isTopView:!0,layerList:{id:{TWOD:"",THREED:""}}},panel:{id:{MAP:"",LOCATE:"",LAYER_LIST:""},visible:{left:!0},active:"",obj:{resize:null,left:null,map:null}}}},methods:{leftPanelToggle:()=>{},viewResize:()=>{let t=window.__applicationView__.device;t.isMobile=Math.min(window.screen.width,window.screen.height)<768||navigator.userAgent.indexOf("Mobi")>-1,t.isLandScape=window.screen.width>window.screen.height}},created(){window.addEventListener("resize",this.viewResize),window.addEventListener("deviceorientation",this.viewResize)},destroyed(){window.removeEventListener("resize",this.viewResize),window.removeEventListener("deviceorientation",this.viewResize)},mounted(){const t=document.querySelector("#locate");this.panel.id.LOCATE=t?t.id:"";const e=document.querySelector("#layerList");this.panel.id.LAYER_LIST=e?e.id:"";const i=document.querySelector("#mapPanel");this.panel.id.MAP=i?i.id:"";let r=document.querySelector("#map2D");this.map.id.TWOD=r?r.id:"";let s=document.querySelector("#containerLayerList3D");this.map.layerList.id.TWOD=s?s.id:"";let n=document.querySelector("#map3D");this.map.id.THREED=n?n.id:"";let o=document.querySelector("#containerLayerList3D");this.map.layerList.id.THREED=o?o.id:"",this.panel.active=this.panel.id.LAYER_LIST,this.map.active=this.map.id.THREED;const a=Nie.getInstance(this);console.debug(a),Object.defineProperty(window,"applicationView",{value:{},enumerable:!1,configurable:!0,writable:!0}),window.__applicationView__=this,this.viewResize()}},e9t=(t,e)=>{const i=t.__vccOpts||t;for(const[r,s]of e)i[r]=s;return i},qN=t=>(_6e("data-v-316a75ee"),t=t(),v6e(),t),t9t={id:"leftPanel"},i9t={id:"locate",class:"panel"},r9t={id:"layerList",class:"panel"},s9t={id:"layerList2D"},n9t=qN(()=>ol("span",{class:"esri-icon-maps"},null,-1)),o9t=qN(()=>ol("div",{id:"containerLayerList2D"},"Layer List 2D",-1)),a9t=[n9t,o9t],l9t={id:"layerList3D"},c9t=qN(()=>ol("span",{class:"esri-icon-public"},null,-1)),u9t=qN(()=>ol("div",{id:"containerLayerList3D"},null,-1)),h9t=qN(()=>ol("div",{id:"map3D"},null,-1)),d9t=[h9t];function p9t(t,e,i,r,s,n){return d8e(),m8e(Mg,null,[Gy(ol("div",t9t,[Gy(ol("div",i9t," LOCATE ",512),[[Hy,s.panel.active==s.panel.id.LOCATE]]),Gy(ol("div",r9t,[Gy(ol("div",s9t,a9t,512),[[Hy,s.map.active==s.map.id.TWOD]]),Gy(ol("div",l9t,[c9t,Gy(ol("span",null,"Is Mobile",512),[[Hy,s.device.isMobile]]),Gy(ol("span",null,"Is DeskTop",512),[[Hy,!s.device.isMobile]]),Gy(ol("span",null,"Is LandScape",512),[[Hy,s.device.isLandScape]]),Gy(ol("span",null,"Is Portrait",512),[[Hy,!s.device.isLandScape]]),u9t],512),[[Hy,s.map.active==s.map.id.THREED]])],512),[[Hy,s.panel.active==s.panel.id.LAYER_LIST]])],512),[[Hy,s.panel.visible.left]]),ol("div",{id:"mapPanel",class:eG([{mapPanel:s.panel.visible.left,mapFull:!s.panel.visible.left}])},d9t,2)],64)}const f9t=e9t(Kqt,[["render",p9t],["__scopeId","data-v-316a75ee"]]);K8e(f9t).mount("#containerApplication");const m9t=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:$A,build:JRe},Symbol.toStringTag,{value:"Module"})),g9t=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:jne,build:yIe},Symbol.toStringTag,{value:"Module"})),y9t=Object.freeze(Object.defineProperty({__proto__:null,build:xIe},Symbol.toStringTag,{value:"Module"})),_9t=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:Xne,build:PIe},Symbol.toStringTag,{value:"Module"})),v9t=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:Jne,build:RIe},Symbol.toStringTag,{value:"Module"})),b9t=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:Kne,build:YIe},Symbol.toStringTag,{value:"Module"})),w9t=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:ioe,SimpleAtmospherePassParameters:R6,build:r3e},Symbol.toStringTag,{value:"Module"})),x9t=Object.freeze(Object.defineProperty({__proto__:null,build:A3e},Symbol.toStringTag,{value:"Module"})),T9t=Object.freeze(Object.defineProperty({__proto__:null,build:$3e},Symbol.toStringTag,{value:"Module"})),S9t=Object.freeze(Object.defineProperty({__proto__:null,build:dDe,calculateAnchorPosForRendering:oD},Symbol.toStringTag,{value:"Module"})),E9t=Object.freeze(Object.defineProperty({__proto__:null,build:hNe},Symbol.toStringTag,{value:"Module"})),C9t=Object.freeze(Object.defineProperty({__proto__:null,build:fNe,getRadius:c8},Symbol.toStringTag,{value:"Module"})),M9t=Object.freeze(Object.defineProperty({__proto__:null,build:_Ne},Symbol.toStringTag,{value:"Module"})),A9t=Object.freeze(Object.defineProperty({__proto__:null,build:bNe},Symbol.toStringTag,{value:"Module"})),P9t=Object.freeze(Object.defineProperty({__proto__:null,build:FNe},Symbol.toStringTag,{value:"Module"})),O9t=Object.freeze(Object.defineProperty({__proto__:null,build:HFe,ribbonlineNumRoundJoinSubdivisions:hD},Symbol.toStringTag,{value:"Module"})),$9t=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:Tae,build:bFe},Symbol.toStringTag,{value:"Module"})),R9t=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:Rae,build:s4e},Symbol.toStringTag,{value:"Module"})),I9t=Object.freeze(Object.defineProperty({__proto__:null,build:I5e},Symbol.toStringTag,{value:"Module"})),L9t=Object.freeze(Object.defineProperty({__proto__:null,build:W5e},Symbol.toStringTag,{value:"Module"})),D9t=Object.freeze(Object.defineProperty({__proto__:null,build:Pke},Symbol.toStringTag,{value:"Module"})),N9t=Object.freeze(Object.defineProperty({__proto__:null,build:Nke},Symbol.toStringTag,{value:"Module"})),F9t=Object.freeze(Object.defineProperty({__proto__:null,build:Uke},Symbol.toStringTag,{value:"Module"})),k9t=Object.freeze(Object.defineProperty({__proto__:null,build:Xke},Symbol.toStringTag,{value:"Module"})),U9t=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:Tle,build:qUe},Symbol.toStringTag,{value:"Module"})),V9t=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return uw},build:yVe},Symbol.toStringTag,{value:"Module"})),z9t=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:xVe,ColorizerStretchUniforms:wVe,ColorizerUniforms:F8,build:TVe},Symbol.toStringTag,{value:"Module"})),B9t=Object.freeze(Object.defineProperty({__proto__:null,build:DVe},Symbol.toStringTag,{value:"Module"})),j9t=Object.freeze(Object.defineProperty({__proto__:null,build:HVe},Symbol.toStringTag,{value:"Module"})),G9t=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:Nle,build:ZVe},Symbol.toStringTag,{value:"Module"})),H9t=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:Lle,blurSize:Dle,build:GVe,gridCellPixelSize:bf,outlineSize:TD},Symbol.toStringTag,{value:"Module"})),q9t=Object.freeze(Object.defineProperty({__proto__:null,build:eze},Symbol.toStringTag,{value:"Module"})),W9t=Object.freeze(Object.defineProperty({__proto__:null,MagnifierPassParameters:kle,build:rze},Symbol.toStringTag,{value:"Module"})),Z9t=Object.freeze(Object.defineProperty({__proto__:null,build:oze},Symbol.toStringTag,{value:"Module"})),Y9t=Object.freeze(Object.defineProperty({__proto__:null,build:cze},Symbol.toStringTag,{value:"Module"})),X9t=Object.freeze(Object.defineProperty({__proto__:null,build:dze},Symbol.toStringTag,{value:"Module"})),J9t=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:k8,build:mze},Symbol.toStringTag,{value:"Module"})),Q9t=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:Vle,build:yze},Symbol.toStringTag,{value:"Module"})),K9t=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:zle,build:bze},Symbol.toStringTag,{value:"Module"})),e7t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:jle,build:Aze},Symbol.toStringTag,{value:"Module"})),t7t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:UN,build:Mze},Symbol.toStringTag,{value:"Module"})),i7t=Object.freeze(Object.defineProperty({__proto__:null,ViewshedPassParameters:Gle,build:Lze},Symbol.toStringTag,{value:"Module"}));export{TGt as $,une as A,ha as B,ne as C,TO as D,AS as E,Kn as F,Ci as G,Ppi as H,H_ as I,Kc as J,ya as K,je as L,rui as M,Hg as N,$ne as O,pt as P,iRe as Q,Llt as R,Ue as S,K2 as T,fr as U,Ke as V,$O as W,Bt as X,Z3 as Y,Ab as Z,oe as _,I as a,aEe as a$,us as a0,te as a1,lr as a2,Eri as a3,Cri as a4,p_t as a5,Gi as a6,R_ as a7,qh as a8,pr as a9,fKe as aA,d2 as aB,SZt as aC,lLt as aD,Kci as aE,yUt as aF,wpi as aG,pci as aH,gle as aI,Ui as aJ,Smi as aK,jD as aL,Ls as aM,on as aN,ki as aO,qD as aP,GIt as aQ,fy as aR,tYe as aS,$t as aT,Se as aU,Ze as aV,iKe as aW,re as aX,Mj as aY,OPe as aZ,ri as a_,Qti as aa,coi as ab,XE as ac,FPt as ad,sd as ae,hXt as af,fne as ag,ai as ah,uZ as ai,KTe as aj,gN as ak,Dpi as al,Rpi as am,QUt as an,Cpi as ao,Opi as ap,Mpi as aq,wt as ar,Bf as as,vO as at,dr as au,Ye as av,hU as aw,Zue as ax,itt as ay,tSe as az,tBe as b,kMt as b$,vG as b0,tse as b1,u2 as b2,$L as b3,IQe as b4,sb as b5,Bh as b6,aXe as b7,rP as b8,lXe as b9,aYe as bA,ey as bB,Kii as bC,Zfi as bD,yY as bE,gne as bF,DBe as bG,by as bH,mr as bI,Yfi as bJ,Qi as bK,Aoi as bL,Jr as bM,UWt as bN,Ibt as bO,da as bP,id as bQ,Gh as bR,LMt as bS,vr as bT,YD as bU,Yb as bV,lw as bW,fee as bX,mee as bY,FMt as bZ,DMt as b_,Bje as ba,qG as bb,Jh as bc,K7t as bd,wZe as be,$Wt as bf,nce as bg,VD as bh,qoi as bi,SCe as bj,C as bk,Xl as bl,Rht as bm,qe as bn,mq as bo,yn as bp,bQt as bq,wQt as br,fB as bs,Dfe as bt,_Je as bu,eo as bv,ke as bw,KCe as bx,nd as by,Lb as bz,$pi as c,pe as c$,NMt as c0,B5e as c1,h8 as c2,G5e as c3,Dhe as c4,Br as c5,Kr as c6,xl as c7,$e as c8,nt as c9,ml as cA,Nf as cB,fQe as cC,QBe as cD,KJe as cE,yS as cF,Rot as cG,JS as cH,Tb as cI,Ng as cJ,Tf as cK,Dne as cL,cut as cM,gt as cN,Wn as cO,zRe as cP,Rh as cQ,oXt as cR,Gat as cS,mei as cT,nD as cU,gei as cV,Qr as cW,Go as cX,hm as cY,mt as cZ,Ce as c_,iy as ca,Nr as cb,Dk as cc,io as cd,LXt as ce,_ri as cf,oi as cg,ms as ch,yb as ci,ue as cj,Kh as ck,jo as cl,Bre as cm,gy as cn,UK as co,bpi as cp,My as cq,oc as cr,qot as cs,yYt as ct,Pz as cu,am as cv,rk as cw,_P as cx,OS as cy,Df as cz,lVt as d,Ne as d$,FL as d0,CHt as d1,Zoi as d2,It as d3,p6t as d4,wO as d5,wP as d6,V_ as d7,cc as d8,qZ as d9,Te as dA,de as dB,Ee as dC,fYt as dD,Xb as dE,as as dF,P6 as dG,_m as dH,ir as dI,fPe as dJ,Uo as dK,EA as dL,np as dM,YM as dN,KP as dO,MKt as dP,kS as dQ,ndt as dR,kQt as dS,NQt as dT,FQt as dU,$ as dV,Iae as dW,iYt as dX,fxt as dY,mxt as dZ,WP as d_,dn as da,HZ as db,ZZ as dc,kz as dd,iAe as de,gXe as df,Hb as dg,Gg as dh,gp as di,fa as dj,mo as dk,Lf as dl,HWt as dm,KZt as dn,Coe as dp,G2 as dq,wli as dr,Ve as ds,ve as dt,Os as du,rAe as dv,rr as dw,cYt as dx,KD as dy,sYt as dz,h as e,lR as e$,Uh as e0,I_t as e1,XB as e2,rt as e3,nK as e4,Cae as e5,Ar as e6,nve as e7,Nn as e8,z2 as e9,dje as eA,Mse as eB,wat as eC,pXt as eD,dy as eE,xbt as eF,Tbt as eG,bO as eH,sFe as eI,dri as eJ,hri as eK,C_ as eL,nat as eM,m6 as eN,M2 as eO,El as eP,Nat as eQ,gXt as eR,Iat as eS,mne as eT,mXt as eU,zf as eV,KXe as eW,Lu as eX,bH as eY,pri as eZ,ZNe as e_,Pn as ea,ht as eb,_w as ec,bli as ed,kt as ee,kG as ef,_y as eg,oKe as eh,tWt as ei,gn as ej,LWt as ek,sEt as el,nEt as em,oEt as en,zu as eo,d7t as ep,Whi as eq,v4t as er,c4t as es,VVe as et,Yhi as eu,w4t as ev,Jdt as ew,_Kt as ex,xMt as ey,eCe as ez,$8t as f,hle as f$,bOe as f0,gs as f1,hQ as f2,xb as f3,Eu as f4,Ru as f5,v7t as f6,dZe as f7,iP as f8,Fre as f9,Wje as fA,_5e as fB,TU as fC,blt as fD,yde as fE,cZ as fF,MZt as fG,_Ke as fH,OY as fI,Tde as fJ,DWt as fK,yKe as fL,xde as fM,jKe as fN,Cde as fO,dmi as fP,hmi as fQ,ma as fR,vXe as fS,Fb as fT,IZt as fU,eje as fV,fXt as fW,GD as fX,EZt as fY,eHt as fZ,bAe as f_,l7e as fa,xO as fb,S6 as fc,LMe as fd,xZt as fe,tr as ff,hy as fg,ore as fh,_7t as fi,TCt as fj,va as fk,ooi as fl,qae as fm,yL as fn,x5e as fo,Vmi as fp,Y8 as fq,rut as fr,nCt as fs,mSt as ft,Mlt as fu,bo as fv,ani as fw,KM as fx,X9 as fy,O7t as fz,N8t as g,qKt as g$,VIt as g0,zIt as g1,i2 as g2,BD as g3,ts as g4,o6t as g5,G8t as g6,H8t as g7,nr as g8,T6t as g9,yz as gA,Ub as gB,Z8t as gC,gYt as gD,nP as gE,za as gF,K8t as gG,fz as gH,Ji as gI,vb as gJ,eAe as gK,PS as gL,mY as gM,ua as gN,D3 as gO,y6t as gP,cX as gQ,Pf as gR,pAe as gS,Qt as gT,k2 as gU,bJe as gV,Sli as gW,wre as gX,wZ as gY,loi as gZ,TL as g_,b6t as ga,Ml as gb,Yu as gc,lN as gd,Oy as ge,PQe as gf,AQe as gg,ZJe as gh,d_ as gi,Zhe as gj,LZt as gk,Hre as gl,jg as gm,bl as gn,TKe as go,a6t as gp,i6t as gq,ja as gr,rCe as gs,RCe as gt,ICe as gu,Li as gv,Ali as gw,Eli as gx,Mli as gy,w6t as gz,f_ as h,nw as h$,pw as h0,Zu as h1,I8 as h2,dle as h3,$M as h4,ty as h5,fd as h6,J7t as h7,sWt as h8,Lzt as h9,s7t as hA,fvt as hB,Qn as hC,Svt as hD,pse as hE,wnt as hF,Sit as hG,pmi as hH,xY as hI,yy as hJ,tHt as hK,MGt as hL,mce as hM,nN as hN,Y8t as hO,xse as hP,BQe as hQ,Vs as hR,he as hS,yR as hT,$S as hU,ur as hV,IH as hW,Xti as hX,Yti as hY,yli as hZ,sB as h_,tje as ha,sk as hb,yte as hc,VKe as hd,h_ as he,fl as hf,Hc as hg,EKt as hh,VG as hi,go as hj,$s as hk,TG as hl,kr as hm,Va as hn,A_ as ho,bs as hp,cw as hq,Ai as hr,Qh as hs,In as ht,pY as hu,br as hv,Evt as hw,sre as hx,nre as hy,n7t as hz,pBe as i,Dfi as i$,xN as i0,ca as i1,W2 as i2,Di as i3,AP as i4,yst as i5,ene as i6,_Me as i7,Vct as i8,XP as i9,eri as iA,zh as iB,djt as iC,Ani as iD,qK as iE,WK as iF,_n as iG,Wf as iH,tYt as iI,Rit as iJ,woi as iK,Q2t as iL,fT as iM,t2 as iN,lUe as iO,KQe as iP,C3 as iQ,iWt as iR,W6t as iS,QGt as iT,umi as iU,c6t as iV,cmi as iW,l6t as iX,KS as iY,M8 as iZ,MW as i_,V3e as ia,xWt as ib,Dn as ic,hl as id,Btt as ie,pl as ig,hYt as ih,npt as ii,Lr as ij,BG as ik,Wd as il,p2 as im,cLt as io,jYt as ip,F2 as iq,Sot as ir,cde as is,OM as it,AY as iu,rri as iv,JMe as iw,sbt as ix,Xge as iy,VWt as iz,cm as j,Hje as j$,xf as j0,_jt as j1,Lfi as j2,Ifi as j3,Rfi as j4,aKe as j5,Sse as j6,cKe as j7,uKe as j8,zKe as j9,E6t as jA,S6t as jB,gO as jC,qO as jD,j6t as jE,JGt as jF,tv as jG,dce as jH,hje as jI,a5e as jJ,Vae as jK,o5e as jL,f8t as jM,d6t as jN,Z6t as jO,O6t as jP,$6t as jQ,R6t as jR,L6t as jS,D6t as jT,N6t as jU,F6t as jV,k6t as jW,U6t as jX,V6t as jY,z6t as jZ,B6t as j_,Vb as ja,D8t as jb,P8t as jc,g6t as jd,jpe as je,m$e as jf,gce as jg,W8 as jh,jW as ji,vie as jj,q8 as jk,_6t as jl,bce as jm,b2 as jn,OXt as jo,nUe as jp,ZYe as jq,hde as jr,qje as js,CS as jt,yZe as ju,my as jv,lp as jw,py as jx,AD as jy,_ce as jz,_se as k,tAe as k$,nm as k0,x6t as k1,Api as k2,VEe as k3,aO as k4,Yh as k5,Db as k6,wD as k7,U7e as k8,TMt as k9,Gs as kA,Y9e as kB,M_ as kC,ADe as kD,vre as kE,Qz as kF,poe as kG,Pe as kH,xr as kI,qf as kJ,Cs as kK,DMe as kL,vt as kM,Er as kN,KIt as kO,Je as kP,qit as kQ,ub as kR,tn as kS,rne as kT,Ili as kU,N3 as kV,jje as kW,J6t as kX,CEe as kY,$Ee as kZ,wr as k_,bKt as ka,qz as kb,JP as kc,Fh as kd,qWt as ke,w3e as kf,VYe as kg,cP as kh,ori as ki,cUe as kj,rN as kk,Ey as kl,BRe as km,JL as kn,BCe as ko,ka as kp,Sr as kq,oYt as kr,Vtt as ks,An as kt,CFe as ku,Ow as kv,QD as kw,moi as kx,hee as ky,sj as kz,r6t as l,Wz as l$,Ype as l0,tZt as l1,NP as l2,DXt as l3,nn as l4,p7t as l5,SO as l6,CZt as l7,Dje as l8,Ere as l9,Lqt as lA,Wo as lB,Lpi as lC,HD as lD,FG as lE,RH as lF,Tne as lG,H8 as lH,cO as lI,Xh as lJ,Jz as lK,jQe as lL,GQe as lM,bde as lN,aLt as lO,Mi as lP,Ir as lQ,Gr as lR,TN as lS,Dli as lT,Fpi as lU,JVt as lV,kpi as lW,wp as lX,tN as lY,j2 as lZ,wl as l_,Qb as la,GC as lb,ute as lc,Ami as ld,e8t as le,t8t as lf,yi as lg,yl as lh,TZt as li,HWe as lj,gSe as lk,Pce as ll,Xj as lm,Rqt as ln,Hm as lo,Cp as lp,Q as lq,Jt as lr,jqt as ls,Nqt as lt,Dqt as lu,VCe as lv,iwe as lw,RBe as lx,qo as ly,V8 as lz,B as m,$At as m$,ott as m0,Es as m1,ZFt as m2,C0t as m3,po as m4,$hi as m5,g_ as m6,mm as m7,Sl as m8,pN as m9,GO as mA,zct as mB,efi as mC,ifi as mD,sfi as mE,ofi as mF,ufi as mG,hfi as mH,z8 as mI,tfi as mJ,rfi as mK,lfi as mL,nfi as mM,afi as mN,cfi as mO,Yfe as mP,ike as mQ,ske as mR,Moi as mS,iL as mT,rL as mU,z5e as mV,rPt as mW,wMt as mX,$bt as mY,aFe as mZ,Lbt as m_,_o as ma,N6 as mb,k6 as mc,rE as md,Dsi as me,u3e as mf,U6 as mg,F6 as mh,iCe as mi,mZt as mj,yZt as mk,gZt as ml,fp as mm,Tli as mn,m_ as mo,Tl as mp,es as mq,Tt as mr,Ht as ms,di as mt,Mr as mu,m2 as mv,Ut as mw,F8 as mx,_Ut as my,TWt as mz,Ql as n,uHe as n$,OMt as n0,$Mt as n1,IAt as n2,AAt as n3,PAt as n4,RMt as n5,RAt as n6,Rbt as n7,OAt as n8,yp as n9,Ise as nA,jCe as nB,jh as nC,boi as nD,F as nE,yWt as nF,RD as nG,qb as nH,l7t as nI,Pg as nJ,CUt as nK,fHe as nL,$re as nM,Q7t as nN,fO as nO,YWe as nP,xG as nQ,rWt as nR,Y2e as nS,F7t as nT,N7t as nU,Ofi as nV,mri as nW,fri as nX,G7e as nY,j7e as nZ,rSe as n_,HA as na,ZE as nb,q2e as nc,$7t as nd,Epi as ne,B2 as nf,Wit as ng,v2 as nh,I2t as ni,put as nj,Jn as nk,eYe as nl,M6t as nm,dXt as nn,cXt as no,bZ as np,mjt as nq,j_ as nr,ND as ns,og as nt,H2 as nu,pei as nv,P_ as nw,Rr as nx,zse as ny,qu as nz,fde as o,lSe as o$,JWt as o0,qj as o1,AO as o2,Y2 as o3,_6 as o4,$qt as o5,Gc as o6,Iqt as o7,Yxe as o8,s_ as o9,gut as oA,Xd as oB,Ei as oC,kWt as oD,PG as oE,nZt as oF,Cy as oG,eWt as oH,O2e as oI,R$e as oJ,xP as oK,X6t as oL,Cli as oM,Rb as oN,cxe as oO,pP as oP,YKt as oQ,JKt as oR,B3e as oS,EIt as oT,SIt as oU,$Jt as oV,xDe as oW,jL as oX,SKt as oY,SP as oZ,g_t as o_,jN as oa,nri as ob,vDe as oc,f6t as od,aXt as oe,lXt as of,uXt as og,Zc as oh,jat as oi,rbt as oj,hne as ok,Wb as ol,smi as om,s6t as on,n6t as oo,m6t as op,y8t as oq,L8t as or,W8t as os,_Pe as ot,oit as ou,gUt as ov,Vc as ow,fXe as ox,fet as oy,P3 as oz,Ipi as p,nfe as p$,F_ as p0,IEe as p1,kre as p2,X7t as p3,tCe as p4,whe as p5,vCe as p6,Gfi as p7,oGt as p8,H5e as p9,Kfe as pA,gb as pB,OJt as pC,nXt as pD,nWt as pE,yit as pF,vmi as pG,lc as pH,YA as pI,MBt as pJ,VS as pK,h2 as pL,pYt as pM,yo as pN,R8 as pO,lB as pP,CIt as pQ,Gxt as pR,Fli as pS,xIt as pT,Uli as pU,kli as pV,ZG as pW,KWt as pX,QWt as pY,DJt as pZ,afe as p_,q$e as pa,Nb as pb,IMt as pc,Lre as pd,W_ as pe,Eoi as pf,vJe as pg,o_ as ph,WCe as pi,VXe as pj,_Qt as pk,$se as pl,Coi as pm,vQt as pn,Ari as po,I2e as pp,PJt as pq,RJt as pr,XL as ps,AKt as pt,PKt as pu,ofe as pv,HCe as pw,Cpt as px,fP as py,CKt as pz,Dt as q,a8 as q$,vli as q0,xli as q1,L$e as q2,fmi as q3,Et as q4,Qst as q5,ntt as q6,Bst as q7,vri as q8,uri as q9,are as qA,Wl as qB,LCe as qC,sJe as qD,mJe as qE,GCe as qF,bt as qG,kL as qH,mPe as qI,Ede as qJ,zb as qK,rJt as qL,Ytt as qM,bT as qN,wC as qO,xRe as qP,iNe as qQ,nae as qR,Eht as qS,q5e as qT,zEe as qU,PPe as qV,jK as qW,Woi as qX,_2 as qY,Iit as qZ,vii as q_,eFe as qa,iFe as qb,QNe as qc,Yge as qd,yri as qe,CG as qf,kk as qg,Lat as qh,Dat as qi,tye as qj,Nbt as qk,Qii as ql,RMe as qm,iZt as qn,mMe as qo,YWt as qp,HYe as qq,QYe as qr,rFe as qs,Kre as qt,CWt as qu,t4e as qv,Jxt as qw,_G as qx,v6 as qy,Nu as qz,ze as r,Kni as r$,ZB as r0,pWt as r1,FD as r2,g7t as r3,QL as r4,ci as r5,s2 as r6,jb as r7,Zti as r8,kIe as r9,pSe as rA,oHe as rB,Ope as rC,$li as rD,lle as rE,T5 as rF,RFe as rG,Xu as rH,_Zt as rI,wKt as rJ,oy as rK,EP as rL,Ss as rM,OO as rN,$h as rO,hFe as rP,dFe as rQ,Kti as rR,wb as rS,dm as rT,Jni as rU,AJt as rV,iE as rW,tut as rX,Cf as rY,qve as rZ,ioi as r_,wOe as ra,vtt as rb,IL as rc,cb as rd,xit as re,FIe as rf,zg as rg,pet as rh,rUe as ri,t3t as rj,zve as rk,nc as rl,A6t as rm,iSe as rn,ire as ro,z3e as rp,wWt as rq,bWt as rr,Ts as rs,vft as rt,Txt as ru,mp as rv,sMt as rw,A2 as rx,vSe as ry,$2e as rz,mw as s,XHt as s$,eoi as s0,toi as s1,Fee as s2,Gp as s3,If as s4,ll as s5,Wni as s6,Zci as s7,zae as s8,Ij as s9,Fa as sA,jli as sB,XFe as sC,pa as sD,z7t as sE,jf as sF,Ph as sG,hk as sH,cri as sI,wde as sJ,iri as sK,Q_t as sL,b6 as sM,Yoi as sN,tE as sO,K$t as sP,Zoe as sQ,mn as sR,mRt as sS,Zb as sT,KPe as sU,tGe as sV,iGe as sW,GHt as sX,eGe as sY,ZHt as sZ,YHt as s_,Hni as sa,Zni as sb,l5e as sc,qni as sd,Mu as se,Ou as sf,Uee as sg,Rj as sh,Vee as si,kee as sj,Xni as sk,GTt as sl,Qni as sm,gte as sn,xSt as so,Hsi as sp,Wve as sq,Q$t as sr,B1t as ss,V1t as st,Aut as su,Vii as sv,Uii as sw,O_ as sx,xri as sy,ko as sz,hi as t,Wbt as t$,C5e as t0,Yr as t1,cCt as t2,xfi as t3,Mfi as t4,aoi as t5,Sfi as t6,Wze as t7,soi as t8,XBe as t9,sce as tA,mfi as tB,QHt as tC,Kb as tD,GAe as tE,Ga as tF,HRe as tG,XG as tH,y2 as tI,U_ as tJ,kse as tK,bb as tL,JG as tM,pPe as tN,uYt as tO,vut as tP,ZWt as tQ,q3t as tR,lKe as tS,THe as tT,gWt as tU,HO as tV,lce as tW,jjt as tX,Gjt as tY,lje as tZ,wCt as t_,OBt as ta,SBt as tb,g5e as tc,FJe as td,kJe as te,cce as tf,IWt as tg,ABt as th,PBt as ti,jmi as tj,FBt as tk,Afi as tl,lee as tm,zmi as tn,Bmi as to,UBt as tp,Efi as tq,Pfi as tr,$Bt as ts,Tfi as tt,mqt as tu,Qjt as tv,Cfi as tw,DBt as tx,TX as ty,ezt as tz,He as u,PYe as u$,xCt as u0,pFe as u1,Wj as u2,H7t as u3,sje as u4,fL as u5,BXt as u6,jXt as u7,GXt as u8,NXe as u9,mR as uA,zz as uB,wYt as uC,aUe as uD,Bo as uE,wut as uF,dYt as uG,Utt as uH,Gz as uI,cPe as uJ,Mit as uK,lm as uL,wB as uM,hP as uN,bit as uO,Zse as uP,GRe as uQ,sZt as uR,BWt as uS,yut as uT,ctt as uU,E6 as uV,jct as uW,Bb as uX,OQe as uY,Bct as uZ,tP as u_,h6 as ua,rZt as ub,jz as uc,OG as ud,Joe as ue,Dci as uf,Jci as ug,U3t as uh,qS as ui,Pni as uj,Cr as uk,hr as ul,pm as um,$ni as un,NWt as uo,K1 as up,ONe as uq,Mee as ur,Og as us,Oni as ut,Q1 as uu,Be as uv,OLt as uw,$Lt as ux,C6 as uy,TS as uz,AL as v,_li as v$,AYe as v0,SWt as v1,ict as v2,yWe as v3,aY as v4,iQ as v5,xYe as v6,wg as v7,iMt as v8,tMt as v9,_Ye as vA,_Wt as vB,vWt as vC,MUt as vD,Q2e as vE,vIt as vF,_It as vG,bHe as vH,u7t as vI,bIt as vJ,IXt as vK,UG as vL,wIt as vM,QKt as vN,TJt as vO,Ose as vP,Uu as vQ,Mpt as vR,td as vS,Qtt as vT,mP as vU,xft as vV,KG as vW,qXe as vX,out as vY,aut as vZ,xJt as v_,YEe as va,ZEe as vb,YZ as vc,h7t as vd,pCe as ve,wYe as vf,$2t as vg,ent as vh,zst as vi,WWt as vj,eQe as vk,hCe as vl,uCe as vm,wJt as vn,EJt as vo,SJt as vp,CJt as vq,fCe as vr,MJt as vs,KKt as vt,bft as vu,nzt as vv,MRe as vw,V7e as vx,D7t as vy,IBe as vz,gw as w,Mn as w$,Gni as w0,Fni as w1,kni as w2,Uf as w3,see as w4,YT as w5,Z2t as w6,e5e as w7,Q4e as w8,qZt as w9,w_t as wA,R_t as wB,flt as wC,pp as wD,QS as wE,_2t as wF,nbt as wG,bri as wH,x9 as wI,T9 as wJ,Zre as wK,fbt as wL,Lni as wM,Z0e as wN,cue as wO,tjt as wP,ojt as wQ,gjt as wR,gri as wS,Bet as wT,emi as wU,Kfi as wV,tct as wW,Hi as wX,Wc as wY,gl as wZ,S as w_,Eni as wa,roi as wb,T2t as wc,ESt as wd,to as we,XD as wf,ap as wg,Xg as wh,Ini as wi,Rni as wj,Yni as wk,Yi as wl,Skt as wm,y7t as wn,S2t as wo,lni as wp,Uni as wq,Vni as wr,Nni as ws,Dni as wt,Cni as wu,Mni as wv,B7t as ww,t0e as wx,S8 as wy,p$e as wz,v6t as x,XKt as x$,Uy as x0,xt as x1,tt as x2,ft as x3,Fy as x4,G as x5,qi as x6,rd as x7,j as x8,Ki as x9,RB as xA,Ur as xB,NXt as xC,Dti as xD,KIe as xE,fs as xF,uNe as xG,Hr as xH,Wh as xI,vm as xJ,Mw as xK,Pi as xL,ho as xM,D3e as xN,Cb as xO,j$e as xP,xne as xQ,Dy as xR,Pli as xS,fli as xT,xee as xU,_Re as xV,XR as xW,dPe as xX,aYt as xY,lYt as xZ,nYt as x_,er as xa,Kt as xb,Q_ as xc,A6 as xd,Aw as xe,Wu as xf,K6 as xg,K_ as xh,ui as xi,Ty as xj,aw as xk,Pw as xl,i8 as xm,Xc as xn,sle as xo,zS as xp,__ as xq,e8 as xr,JMt as xs,qne as xt,kO as xu,I6 as xv,Lti as xw,Uoe as xx,$Xt as xy,plt as xz,p as y,ari as y$,ji as y0,_a as y1,Sw as y2,bYe as y3,vYe as y4,Jre as y5,Yre as y6,FWt as y7,Fr as y8,qti as y9,GWt as yA,ugt as yB,Bse as yC,hPe as yD,uit as yE,mtt as yF,Hdt as yG,qdt as yH,xp as yI,ZP as yJ,nNe as yK,fii as yL,sy as yM,pii as yN,qs as yO,zhi as yP,$_ as yQ,or as yR,UVe as yS,s4t as yT,E4t as yU,Lge as yV,$8 as yW,_vt as yX,Vhi as yY,Zee as yZ,Yee as y_,Lse as ya,jWt as yb,rYt as yc,Ay as yd,wse as ye,mOe as yf,fm as yg,VP as yh,Wt as yi,la as yj,Bu as yk,t8 as yl,Cw as ym,xq as yn,HDe as yo,Ds as yp,rDe as yq,Voe as yr,RXt as ys,LJt as yt,YL as yu,IJt as yv,uot as yw,sne as yx,uc as yy,GL as yz,UL as z,eZt as z0,a7t as z1,fui as z2,XWt as z3,lri as z4,$u as z5,Tw as z6,Q2 as z7,m7t as z8,Zjt as z9,qa as za,jvt as zb,vh as zc,ky as zd,Ny as ze,jr as zf,y_ as zg,Wfi as zh,sE as zi,Lz as zj,$y as zk,EN as zl,Vu as zm,doe as zn,eYt as zo,x0t as zp,ytt as zq,vZt as zr,wZt as zs,m8 as zt,Poi as zu,Hoi as zv,Nfi as zw,Pmi as zx};
